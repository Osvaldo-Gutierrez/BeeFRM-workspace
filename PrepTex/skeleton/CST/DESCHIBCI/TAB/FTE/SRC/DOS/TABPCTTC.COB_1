       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   TABPCTTC.
       AUTHOR.       BEE TEAM.
       DATE-WRITTEN. 19-APR-1999 12:22:15.

      *Programa Carga Tasas de TXC en tabla CAM

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
       COPY TABWGTMC.
       COPY TABBRCAM.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGSYS.
       01  PGM-VARI.
           03 PGM-NUM6                    PIC 9(06).
           03 PGM-CHR6 REDEFINES PGM-NUM6 PIC X(06).
           03 PGM-MTRA           VALUE 12 PIC 9(02).
           03 PGM-FECH.
              05 PGM-DECH                 PIC 9(02).
              05 PGM-MECH                 PIC 9(02).
              05 PGM-SECH                 PIC 9(02).
              05 PGM-AECH                 PIC 9(02).
              05 PGM-MNTO         COMP-3  PIC S9(11)V9(04).
           03 PGM-VCAM-EDT                PIC  ---.---.---.--9,9999.
           03 PGM-NREG                    PIC 9(04).
           03 PGM-I                       PIC 9(02).

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'TABPCTTC' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           DISPLAY 'INGRESE FECHA DE PROCESO )DDMMSSAA): '.
           ACCEPT PGM-FECH.
           DISPLAY 'FECHA INGRESADA: ' PGM-FECH.
      *VAL-FEC Validar Fecha
           MOVE PGM-DECH TO FEC-ITM1.
           MOVE PGM-MECH TO FEC-ITM2
           MOVE PGM-SECH TO FEC-ITM3.
           MOVE PGM-AECH TO FEC-ITM4.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-STAT ' - ' FEC-MENS
               PERFORM GNS-PRO-ABT.
           MOVE 0 TO PGM-NREG.
           DISPLAY '----------------------------------------------'.
       NRB-MAIN.
      *Busca para Moneda Nacional No Reajustable con plazo < 90
           MOVE 'TAB'  TO FIO-SIST.
           MOVE 'SXC'  TO TAB-COD-TTAB IN TAB.
           MOVE 'T$B9' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S' )
               GO TO NRS-MAIN.
           MOVE 'C1'     TO TMC-PLZO.
           MOVE '0999  ' TO TMC-VCOC.
           MOVE PGM-FECH TO TMC-FECH.
           PERFORM TAB-BUS-TMC.
           IF TMC-CMSG > SPACES
               GO TO NRS-MAIN.
           PERFORM GRA-CAM-MNRB.
       NRS-MAIN.
      *Busca para Moneda Nacional No Reajustable con plazo >= 90
           MOVE 'TAB'  TO FIO-SIST.
           MOVE 'SXC'  TO TAB-COD-TTAB IN TAB.
           MOVE 'T$S9' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S' )
               GO TO SRJ-MAIN.
           MOVE SPACES   TO TMC-PLZO.
           MOVE '0999  ' TO TMC-VCOC.
           MOVE PGM-FECH TO TMC-FECH.
           PERFORM TAB-BUS-TMC.
           IF TMC-CMSG > SPACES
               GO TO SRJ-MAIN.
           PERFORM GRA-CAM-MNRS.
       SRJ-MAIN.
      *Busca para Moneda Nacional Reajustable
           MOVE 'TAB'  TO FIO-SIST.
           MOVE 'SXC'  TO TAB-COD-TTAB IN TAB.
           MOVE 'TMRJ' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S' )
               GO TO MEX-MAIN.
           MOVE SPACES   TO TMC-PLZO.
           MOVE '0998  ' TO TMC-VCOC.
           MOVE PGM-FECH TO TMC-FECH.
           PERFORM TAB-BUS-TMC.
           IF TMC-CMSG > SPACES
               GO TO MEX-MAIN.
           PERFORM GRA-CAM-MSRJ.
       MEX-MAIN.
      *Busca para Moneda Extranjera
           MOVE 'TAB'  TO FIO-SIST.
           MOVE 'SXC'  TO TAB-COD-TTAB IN TAB.
           MOVE 'TMCX' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S' )
               GO TO FIN-MAIN.
           MOVE SPACES   TO TMC-PLZO.
           MOVE 'MEXT  ' TO TMC-VCOC.
           MOVE PGM-FECH TO TMC-FECH.
           PERFORM TAB-BUS-TMC.
           IF TMC-CMSG > SPACES
               GO TO FIN-MAIN.
           PERFORM GRA-CAM-MEXT.
       FIN-MAIN.
           DISPLAY '----------------------------------------------'.
           DISPLAY 'NUMERO DE REGISTROS GRABADOS : ' PGM-NREG.
           DISPLAY '----------------------------------------------'.
       EXT-MAIN.
           PERFORM GNS-PRO-END.

       GRA-CAM-MNRB SECTION.
       INI-GRA-CAM-MNRB.
           MOVE 0 TO PGM-I.
       LUP-GRA-CAM-MNRB.
           ADD 1 TO PGM-I.
           IF PGM-I > PGM-MTRA
               GO TO FIN-GRA-CAM-MNRB.
           IF TMC-VTMC(PGM-I) NOT > 0
               GO TO FIN-GRA-CAM-MNRB.
           MOVE PGM-DECH TO CAM-NUM-DCAM IN CAM(1).
           MOVE PGM-MECH TO CAM-NUM-MCAM IN CAM(1).
           MOVE PGM-SECH TO CAM-NUM-SCAM IN CAM(1).
           MOVE PGM-AECH TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           MOVE 'TB90  ' TO CAM-COD-VCAM IN CAM(1).
           MOVE TMC-MSTR(PGM-I) TO PGM-NUM6.
           MOVE PGM-CHR6 TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF FIO-STAT-OKS
               MOVE FIO-MOD TO FIO-CMND
           ELSE
               PERFORM INIT-REG-CAM
               MOVE FIO-PUT TO FIO-CMND.
           MOVE TMC-VTMC(PGM-I) TO CAM-SGV-VCAM IN CAM.
           PERFORM TAB-FIO-CAM.
           IF FIO-STAT-OKS
               PERFORM DISPLAY-STAT.
           GO TO LUP-GRA-CAM-MNRB.
       FIN-GRA-CAM-MNRB.
           EXIT.

       GRA-CAM-MNRS SECTION.
       INI-GRA-CAM-MNRS.
           MOVE 0 TO PGM-I.
       LUP-GRA-CAM-MNRS.
           ADD 1 TO PGM-I.
           IF PGM-I > PGM-MTRA
               GO TO FIN-GRA-CAM-MNRS.
           IF TMC-VTMC(PGM-I) NOT > 0
               GO TO FIN-GRA-CAM-MNRS.
           MOVE PGM-DECH TO CAM-NUM-DCAM IN CAM(1).
           MOVE PGM-MECH TO CAM-NUM-MCAM IN CAM(1).
           MOVE PGM-SECH TO CAM-NUM-SCAM IN CAM(1).
           MOVE PGM-AECH TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           MOVE 'TS90  ' TO CAM-COD-VCAM IN CAM(1).
           MOVE TMC-MSTR(PGM-I) TO PGM-NUM6.
           MOVE PGM-CHR6 TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF FIO-STAT-OKS
               MOVE FIO-MOD TO FIO-CMND
           ELSE
               PERFORM INIT-REG-CAM
               MOVE FIO-PUT TO FIO-CMND.
           MOVE TMC-VTMC(PGM-I) TO CAM-SGV-VCAM IN CAM.
           PERFORM TAB-FIO-CAM.
           IF FIO-STAT-OKS
               PERFORM DISPLAY-STAT.
           GO TO LUP-GRA-CAM-MNRS.
       FIN-GRA-CAM-MNRS.
           EXIT.

       GRA-CAM-MSRJ SECTION.
       INI-GRA-CAM-MSRJ.
      *Asume que solo existe un valor de tasa, por lo tanto ...
           MOVE PGM-DECH TO CAM-NUM-DCAM IN CAM(1).
           MOVE PGM-MECH TO CAM-NUM-MCAM IN CAM(1).
           MOVE PGM-SECH TO CAM-NUM-SCAM IN CAM(1).
           MOVE PGM-AECH TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           MOVE '0998  ' TO CAM-COD-VCAM IN CAM(1).
           MOVE 'TMXC  ' TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF FIO-STAT-OKS
               MOVE FIO-MOD TO FIO-CMND
           ELSE
               PERFORM INIT-REG-CAM
               MOVE FIO-PUT TO FIO-CMND.
           MOVE TMC-VTMC(1) TO CAM-SGV-VCAM IN CAM.
           PERFORM TAB-FIO-CAM.
           IF FIO-STAT-OKS
               PERFORM DISPLAY-STAT.
       FIN-GRA-CAM-MSRJ.
           EXIT.

       GRA-CAM-MEXT SECTION.
       INI-GRA-CAM-MEXT.
      *Asume que solo existe un valor de tasa, por lo tanto ...
           MOVE PGM-DECH TO CAM-NUM-DCAM IN CAM(1).
           MOVE PGM-MECH TO CAM-NUM-MCAM IN CAM(1).
           MOVE PGM-SECH TO CAM-NUM-SCAM IN CAM(1).
           MOVE PGM-AECH TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           MOVE 'TMEX  ' TO CAM-COD-VCAM IN CAM(1).
           MOVE 'TMXC  ' TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF FIO-STAT-OKS
               MOVE FIO-MOD TO FIO-CMND
           ELSE
               PERFORM INIT-REG-CAM
               MOVE FIO-PUT TO FIO-CMND.
           MOVE TMC-VTMC(1) TO CAM-SGV-VCAM IN CAM.
           PERFORM TAB-FIO-CAM.
           IF FIO-STAT-OKS
               PERFORM DISPLAY-STAT.
       FIN-GRA-CAM-MEXT.
           EXIT.

       INIT-REG-CAM SECTION.
       INI-INIT-REG-CAM.
           PERFORM GET-FHOY.
           MOVE HOY-STP-ITRN TO CAM-STP-ITRN IN CAM.
           MOVE 'I'          TO CAM-MSC-TACC IN CAM.
           MOVE 'S'          TO CAM-MSC-STAT IN CAM.
           MOVE 'BACH'       TO CAM-COD-OTRN IN CAM.
           MOVE 'TABPCTTC'   TO CAM-COD-ATRN IN CAM.
           MOVE SPACES       TO CAM-GLS-DISP IN CAM.
       FIN-INIT-REG-CAM.
           EXIT.

       DISPLAY-STAT SECTION.
       INI-DISPLAY-STAT.
           MOVE CAM-SGV-VCAM IN CAM TO PGM-VCAM-EDT.
           DISPLAY 'GRABADO REGISTRO CAM CON LLAVE : '
                   CAM-KEY-CAMB IN CAM ', Y TASA : ' PGM-VCAM-EDT.
           ADD 1 TO PGM-NREG.
       FIN-DISPLAY-STAT.
           EXIT.

       COPY TABBFCAM.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBBMSG.
       COPY TABBBTMC.
       COPY GNSBGEND.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBBSYS.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBGDTC.
       COPY GNSBGABT.
