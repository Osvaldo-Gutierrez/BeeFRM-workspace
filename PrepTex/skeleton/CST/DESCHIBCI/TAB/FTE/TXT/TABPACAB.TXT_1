*% PGM_PTC = TRUE
*% IF WSS
      *<<<< WSS                                                         
       COPY SGCBRDBC.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.        
       COPY TABBRWFC.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-WFC-REQA==.        
       COPY GNSWGCPT.                                                   
      *>>>>                                                             
*% END
*% IF FND_KEY
      *<<<< FND_KEY                                                     
           PERFORM VAL-EXI-WFC.                                         
           IF NOT FIO-STAT-OKS                                          
              MOVE '23'         TO PGM-STAT-CAB                         
              MOVE '00'         TO FIO-STAT                             
              MOVE SCR-STAT-CON TO SCR-STAT                             
              GO TO FIN-FND-KEY.                                        
                                                                        
           IF CAB-NUM-ICAB IN CAB-FLD NOT > ZEROES                      
              PERFORM BUS-COR-CAB.                                      
      *>>>>                                                             
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY                                                 
           IF SCR-CCPP = 'ING'                                          
              MOVE '23' TO FIO-STAT PGM-STAT-CAB.                       
      *>>>>                                                             
*% END
*% IF FIN_HBL_FLD
      *<<<< FIN_HBL_FLD                                                 
            IF SCR-CMND = 'AEW'                                         
               PERFORM PRO-FLD-CAB                                      
               MOVE FRM-CPIM-UBY TO CAB-IND-SMWI-ATR IN CAB-FLD.        
      *>>>>                                                             
*% END
*% IF EOF
      *<<<< EOF                                                         
       PGM-EBR-ALL SECTION.                                             
       INI-PGM-EBR-ALL.                                                 
           MOVE 'GNS' TO FIO-SIST.                                      
           MOVE FIO-EBR-ALL TO FIO-CMND.                                
           PERFORM GNS-FIO-TAB.                                         
       FIN-PGM-EBR-ALL.                                                 
           EXIT.                                                        
*% IF PGM_PQ
       COPY GNSBEGLS.                                                   
       COPY GNSBBTAB.
*% END
*% IF PGM_PU
       COPY GNSBVCOD.                                                   
       COPY GNSBVTAB.                                                   
       COPY GNSBEGLS.                                                   
*% END                                                   
       COPY SGCBFDBC.                                                   
       COPY TABBFWFC.                                                   
       COPY GNSBGVSM.                                                   
       COPY GNSBGCPT.                                                   
      *>>>>                                                             
*% IF PGM_PQ
      *<<<< EOF_PQ                                                      
       PRO-FLD-CAB SECTION.                                             
       INI-PRO-FLD-CAB.                                                 
           MOVE FRM-CPIM-AEY TO FRM-COD-METR-ATR IN CAB-FLD(1).         
           MOVE FRM-CPIM-AEY TO FRM-COD-METR-ATR IN CAB-FLD(2).         
           MOVE FRM-CPIM-AEY TO FRM-COD-METR-ATR IN CAB-FLD(3).         
           MOVE FRM-CPIM-AEY TO FRM-COD-METR-ATR IN CAB-FLD(4).         
           MOVE FRM-CPIM-AEY TO FRM-COD-METR-ATR IN CAB-FLD(5).         
           MOVE FRM-CPIM-AEY TO FRM-COD-METR-ATR IN CAB-FLD(6).         
           MOVE FRM-CPIM-AEY TO FRM-COD-METR-ATR IN CAB-FLD(7).         
           MOVE FRM-CPIM-AEY TO FRM-COD-METR-ATR IN CAB-FLD(8).         
           MOVE FRM-CPIM-AEY TO FRM-COD-METR-ATR IN CAB-FLD(9).         
           MOVE FRM-CPIM-AEY TO FRM-COD-METR-ATR IN CAB-FLD(10).        
           MOVE FRM-CPIM-AEY TO FRM-NUM-METR-ATR IN CAB-FLD(1).         
           MOVE FRM-CPIM-AEY TO FRM-NUM-METR-ATR IN CAB-FLD(2).         
           MOVE FRM-CPIM-AEY TO FRM-NUM-METR-ATR IN CAB-FLD(3).         
           MOVE FRM-CPIM-AEY TO FRM-NUM-METR-ATR IN CAB-FLD(4).         
           MOVE FRM-CPIM-AEY TO FRM-NUM-METR-ATR IN CAB-FLD(5).         
           MOVE FRM-CPIM-AEY TO FRM-NUM-METR-ATR IN CAB-FLD(6).         
           MOVE FRM-CPIM-AEY TO FRM-NUM-METR-ATR IN CAB-FLD(7).         
           MOVE FRM-CPIM-AEY TO FRM-NUM-METR-ATR IN CAB-FLD(8).         
           MOVE FRM-CPIM-AEY TO FRM-NUM-METR-ATR IN CAB-FLD(9).         
           MOVE FRM-CPIM-AEY TO FRM-NUM-METR-ATR IN CAB-FLD(10).        
           PERFORM PRO-CAB-CAB.                                         
           PERFORM PRO-WFC-CAB.                                         
           PERFORM PRO-DBC-CAB.                                         
       FIN-PRO-FLD-CAB.                                                 
           EXIT.                                                        
                                                                        
       PRO-CAB-CAB SECTION.                                             
       INI-PRO-CAB-CAB.                                                 
           MOVE FRM-CPIM-AEY TO CAB-IND-IWFL-ATR IN CAB-FLD.            
           MOVE FRM-CPIM-AEY TO CAB-IND-SMWI-ATR IN CAB-FLD.            
       FIN-PRO-CAB-CAB.                                                 
           EXIT.                                                        
                                                                        
       PRO-WFC-CAB SECTION.                                             
       INI-PRO-WFC-CAB.                                                 
       FIN-PRO-WFC-CAB.                                                 
           EXIT.                                                        
                                                                        
       PRO-DBC-CAB SECTION.                                             
       INI-PRO-DBC-CAB.                                                 
       FIN-PRO-DBC-CAB.                                                 
           EXIT.                                                        
                                                                        
       RET-STT-CAB SECTION.                                             
       INI-RET-STT-CAB.                                                 
           IF SCR-CCPP = 'ING'                                          
               MOVE 'I' TO CAB-MSC-TACC IN CAB                          
               MOVE 'I' TO CAB-MSC-STAT IN CAB                          
           ELSE                                                         
           IF SCR-CCPP = 'MOD'                                          
               MOVE 'M' TO CAB-MSC-TACC IN CAB                          
               MOVE 'M' TO CAB-MSC-STAT IN CAB.                         
       FIN-RET-STT-CAB.                                                 
           EXIT.                                                        
                                                                        
       RET-HDR-CAB SECTION.                                             
       INI-RET-HDR-CAB.                                                 
           PERFORM GET-FHOY.                                            
      *    Fecha Transaccion                                            
           MOVE HOY-FHOY TO CAB-FEC-FTRN IN CAB.                        
      *    Hora Transaccion                                             
           MOVE HOY-HHOY TO CAB-HRA-HRTR IN CAB.                        
      *    Codigo Origen transaccion                                    
      *<<<< NOT PGM_VMS                                                 
           MOVE SCR-OTRN TO CAB-COD-OTRN IN CAB.                        
      *    Autor Transaccion                                            
           MOVE SCR-USER TO CAB-COD-ATRN IN CAB.                        
      *>>>>                                                             
       FIN-RET-HDR-CAB.                                                 
           EXIT.                                                        
                                                                        
       BUS-COR-CAB SECTION.                                             
       INI-BUS-COR-CAB.                                                 
           MOVE 999 TO CAB-NUM-ICAB IN CAB.                             
           MOVE FIO-GET-LEQ TO FIO-CMND.                                
           PERFORM TAB-FIO-CAB.                                         
           IF NOT ( FIO-STAT-OKS AND                                    
                    CAB-CAI-CONV IN CAB-FLD = CAB-CAI-CONV IN CAB AND   
                    CAB-IIC-CONV IN CAB-FLD = CAB-IIC-CONV IN CAB AND   
                    CAB-IND-TIPO IN CAB-FLD = CAB-IND-TIPO IN CAB)      
               PERFORM KEY-ALL-CAB                                      
               MOVE ZEROES TO CAB-NUM-ICAB IN CAB.                      
           IF SCR-CCPP = 'ING'                                          
               ADD 1 TO CAB-NUM-ICAB IN CAB                             
               MOVE CAB-NUM-ICAB IN CAB TO CAB-NUM-ICAB IN CAB-FLD      
               PERFORM PUT-REG-CAB.                                     
       FIN-BUS-COR-CAB.                                                 
           EXIT.                                                        
                                                                        
       PUT-REG-CAB SECTION.                                             
       INI-PUT-REG-CAB.                                                 
           IF NOT SCR-OFRM-SRV                                          
              GO TO FIN-PUT-REG-CAB.                                    
           PERFORM RET-STT-CAB.                                         
           PERFORM RET-HDR-CAB.                                         
           MOVE SPACES TO CAB-IND-IWFL IN CAB.                          
           MOVE 'P'    TO CAB-IND-SMWI IN CAB.                          
           MOVE SPACES TO CAB-GLS-MEAB IN CAB.                          
           MOVE SPACES TO CAB-GLS-DISP IN CAB.                          
           MOVE FIO-PUT TO FIO-CMND.                                    
           PERFORM TAB-FIO-CAB.                                         
       FIN-PUT-REG-CAB.                                                 
           EXIT.                                                        
                                                                        
       VAL-EXI-WFC SECTION.                                             
       INI-VAL-EXI-WFC.                                                 
           MOVE CAB-CAI-CONV IN CAB-FLD TO WFC-CAI-CONV IN WFC.         
           MOVE CAB-IIC-CONV IN CAB-FLD TO WFC-IIC-CONV IN WFC.         
           MOVE 99999999                TO WFC-FEC-FCNV IN WFC.         
           MOVE 999999                  TO WFC-HRA-CONV IN WFC.         
           MOVE FIO-GET-LEQ TO FIO-CMND.                                
           PERFORM TAB-FIO-WFC.                                         
           MOVE FIO-STAT TO PGM-STAT-WFC.                               
           IF (FIO-STAT-OKS AND                                         
               WFC-CAI-CONV IN WFC = CAB-CAI-CONV IN CAB-FLD AND        
               WFC-IIC-CONV IN WFC = CAB-IIC-CONV IN CAB-FLD)           
               PERFORM PUT-WFC-CAB                                      
               PERFORM VAL-EXI-DBC                                      
           ELSE                                                         
              MOVE 'TAB'        TO MSG-COD-SIST                         
              MOVE 'WFC    NEX' TO MSG-COD-MENS                         
              PERFORM GET-MSG                                           
              MOVE MSG-GLS-DESC TO FRM-MENS                             
              MOVE '23' TO FIO-STAT PGM-STAT-WFC.                       
       FIN-VAL-EXI-WFC.                                                 
           EXIT.                                                        
                                                                        
       VAL-EXI-DBC SECTION.                                             
       INI-VAL-EXI-DBC.                                                 
           MOVE WFC-CAI-EMPR IN WFC TO DBC-CAI-ICLI IN DBC.             
           MOVE WFC-IIC-EMPR IN WFC TO DBC-IIC-ICLI IN DBC.             
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM SGC-FIO-DBC.                                         
           MOVE FIO-STAT TO PGM-STAT-DBC.                               
           IF FIO-STAT-OKS                                              
              PERFORM PUT-DBC-CAB.                                      
       FIN-VAL-EXI-DBC.                                                 
           EXIT.                                                        
      *>>>> 
*% END                                                            
*% END
*% IF CMN_ING
      *<<<<
           IF NOT SCR-OFRM-SRV                                          
              MOVE FIO-PUT TO FIO-CMND                                  
              PERFORM TAB-FIO-CAB                                       
              GO TO FIN-CMN-ING.                                        
                                                                        
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM TAB-FIO-CAB.                                         
           IF FIO-STAT-OKS                                              
              MOVE FIO-GET-KEY-UPD TO FIO-CMND                          
              PERFORM TAB-FIO-CAB                                       
              PERFORM RET-STT-CAB                                       
              PERFORM RET-ALL-CAB                                       
              PERFORM RET-HDR-CAB                                       
              MOVE FIO-MOD TO FIO-CMND                                  
           ELSE                                                         
              MOVE FIO-PUT TO FIO-CMND                                  
              PERFORM TAB-FIO-CAB.                                      
           GO TO FIN-CMN-ING.
      *>>>>
*% END
*% IF CMN_ACC
      *<<<< CMN_ACC                                                     
            MOVE FIO-STAT TO PGM-STAT-CAB.                              
            IF SCR-CMND = 'AEW'                                         
               MOVE FIO-MOD TO FIO-CMND                                 
               PERFORM TAB-FIO-CAB                                      
               MOVE FIO-STAT TO PGM-STAT-CAB                            
               IF NOT FIO-STAT-OKS                                      
                  MOVE 'S'  TO SCR-IERR                                 
                  GO TO FIN-CMN-ACC.                                    
      *>>>>                                                             
*% END
