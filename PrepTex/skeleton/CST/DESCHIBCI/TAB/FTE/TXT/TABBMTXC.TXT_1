*%! Codigo adicional para archivo
*% IF INI_UNP_KEY_TXC
     *<<<<<INI_UNP_KEY_TXC
           MOVE FRM-CPIM-UBY TO FRM-COD-STXC-ATR IN TXC-FLD.            
     *>>>>>
*% END
*% IF FRM_NUM_MSTR 
     *<<<<<FRM_NUM_MSTR 
           IF FRM-IND-NTRA IN TXC-FLD = 'N' AND FRM-IFLD = 1            
               MOVE WSS-HVAL TO FRM-NUM-MSTR IN TXC-FLD(FRM-IFLD).      
      *>>>>
*% END
*% IF FRM_SGV_VTXC
     *<<<<<FRM_SGV_VTXC
           IF FRM-NUM-MSTR IN TXC-FLD(FRM-IFLD) > ZEROES AND            
              FRM-SGV-VTXC IN TXC-FLD(FRM-IFLD) = ZEROES                
                PERFORM ERR-GLS                                         
           ELSE                                                         
           IF FRM-NUM-MSTR IN TXC-FLD(FRM-IFLD) NOT > ZEROES AND        
              FRM-SGV-VTXC IN TXC-FLD(FRM-IFLD) NOT = ZEROES            
                MOVE 'TAB'          TO MSG-COD-SIST                     
                MOVE 'TXCVTXCBLK<>' TO MSG-COD-MENS                     
                PERFORM GET-MSG                                         
                MOVE MSG-GLS-DESC TO FRM-MENS                           
                MOVE FRM-SUAR-MAL TO FRM-SUAR.                          
      *>>>>
*% END
*% IF VAL_CON_FLD_TXC
     *<<<<<VAL_CON_FLD_TXC
           PERFORM VAL-CON-MSTR.                                        
      *>>>>
*% END
*% IF INI_KEY_TXC_TXC
     *<<<<<INI_KEY_TXC_TXC
           MOVE TXC-COD-PLZO IN TXC-FLD TO TXC-COD-PLZO IN TXC.         
           MOVE TXC-COD-VCOC IN TXC-FLD TO TXC-COD-VCOC IN TXC.         
           MOVE TXC-NUM-DTXC IN TXC-FLD TO TXC-NUM-DTXC IN TXC.         
           MOVE TXC-NUM-MTXC IN TXC-FLD TO TXC-NUM-MTXC IN TXC.         
           MOVE TXC-NUM-STXC IN TXC-FLD TO TXC-NUM-STXC IN TXC.         
           MOVE TXC-NUM-ATXC IN TXC-FLD TO TXC-NUM-ATXC IN TXC.         
      *>>>>
*% END
*% IF INI_CLR_KEY_TXC
	     *<<<<INI_CLR_KEY_TXC
           MOVE SPACES TO FRM-COD-STXC IN TXC-FLD.                      
           MOVE SPACES TO TXC-COD-PLZO IN TXC-FLD.                      
           MOVE SPACES TO TXC-COD-VCOC IN TXC-FLD.                      
           MOVE ZEROES TO TXC-FEC-FTXC IN TXC-FLD.                      
*% END
*% IF INI_PRO_KEY_TXC
      *<<<< INI_PRO_KEY_TXC
           MOVE FRM-CPIM-AEY TO FRM-COD-STXC-ATR IN TXC-FLD.            
      *>>>>
*% END
*% IF INI_PRO_IKY_TXC
      *<<<< INI_PRO_IKY_TXC
           MOVE FRM-CPIM-AEY TO FRM-COD-STXC-ATR IN TXC-FLD.            
           MOVE FRM-CPIM-AEY TO TXC-FEC-FTXC-ATR IN TXC-FLD.            
      *>>>>
*% END
*% IF INI_UNP_IKY_TXC
      *<<<< INI_UNP_IKY_TXC
           MOVE FRM-CPIM-UBY TO FRM-COD-STXC-ATR.                       
           MOVE FRM-CPIM-UBY TO TXC-FEC-FTXC-ATR.                       
      *>>>>
*% END
*% IF INI_VAL_CON_IKY_TXC
      *<<<< INI_VAL_CON_IKY_TXC
           IF     FRM-COD-STXC IN TXC-FLD NOT > SPACES                  
              AND TXC-COD-PLZO IN TXC-FLD NOT > SPACES                  
              AND TXC-COD-VCOC IN TXC-FLD NOT > SPACES                  
              AND TXC-FEC-FTXC IN TXC-FLD NOT > SPACES                  
      *>>>>
*% END
*% IF INI_VAL_CON_KEY_TXC
      *<<<< INI_VAL_CON_KEY_TXC
           IF     FRM-COD-STXC IN TXC-FLD NOT > SPACES                  
              AND TXC-COD-PLZO IN TXC-FLD NOT > SPACES                  
              AND TXC-COD-VCOC IN TXC-FLD NOT > SPACES                  
              AND TXC-FEC-FTXC IN TXC-FLD NOT > SPACES                  
              AND TXC-NUM-DTXC IN TXC-FLD NOT > SPACES                  
              AND TXC-NUM-MTXC IN TXC-FLD NOT > SPACES                  
              AND TXC-NUM-STXC IN TXC-FLD NOT > SPACES                  
              AND TXC-NUM-ATXC IN TXC-FLD NOT > SPACES                  
      *>>>>
*% END
*% IF FIN_FRM_COD_STXC
      *<<<< FIN_FRM_COD_STXC
           IF FRM-SUAR = FRM-SUAR-MAL                                   
               GO TO FIN-VAL-FRM-COD-STXC.                              
           MOVE TAB-GLS-DATA IN TAB TO WSS-DATA.                        
           MOVE WSS-PLZO TO TXC-COD-PLZO IN TXC-FLD.                    
           MOVE WSS-VCOC TO TXC-COD-VCOC IN TXC-FLD.                    
           MOVE WSS-BASE TO FRM-COD-BASE IN TXC-FLD.                    
           MOVE WSS-NTRA TO FRM-IND-NTRA IN TXC-FLD.                    
           IF WSS-BASE = 'A'                                            
               MOVE 1 TO FRM-NUM-BASE IN TXC-FLD                        
           ELSE                                                         
               MOVE 12 TO FRM-NUM-BASE IN TXC-FLD.                      
           IF FRM-IND-NTRA IN TXC-FLD = 'N'                             
               MOVE WSS-HVAL TO FRM-NUM-MSTR IN TXC-FLD(1).
*% END
*% IF INI_VAL_NUM_FLD_TXC
      *<<<< INI_VAL_NUM_FLD_TXC
           MOVE FRM-NUM-BASE-ALF IN TXC-FLD TO NUM-NUME.                
           MOVE NUM-ZERO-S TO NUM-ZERO.                                 
           MOVE NUM-SGNO-N TO NUM-SGNO.                                 
           MOVE 3 TO NUM-NENT.                                          
           MOVE 0 TO NUM-NDCM.                                          
           PERFORM VAL-NUM.                                             
           IF NUM-STAT-OKS                                              
               MOVE NUM-NN9N TO FRM-NUM-BASE IN TXC-FLD                 
           ELSE                                                         
               MOVE NUM-MENS     TO FRM-MENS                            
               MOVE FRM-SUAR-MAL TO FRM-SUAR                            
               MOVE -9 TO FRM-NUM-BASE-LEN IN TXC-FLD                   
                GO TO FIN-VAL-NUM-FLD-TXC.                              
	      *>>>>
*% END
*% IF INI_VAL_IKY_TXC
      *<<<< INI_VAL_IKY_TXC
           PERFORM VAL-FRM-COD-STXC.                                    
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR        
                MOVE -1 TO FRM-COD-STXC-LEN IN TXC-FLD                  
                GO TO FIN-VAL-IKY-TXC.                                  
           PERFORM VAL-TXC-COD-PLZO.                                    
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR        
                MOVE -1 TO TXC-COD-PLZO-LEN IN TXC-FLD                  
                GO TO FIN-VAL-IKY-TXC.                                  
           PERFORM VAL-TXC-COD-VCOC.                                    
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR        
                MOVE -1 TO TXC-COD-VCOC-LEN IN TXC-FLD                  
                GO TO FIN-VAL-IKY-TXC.                                  
           PERFORM VAL-TXC-FEC-FTXC.                                    
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR        
                MOVE -1 TO TXC-FEC-FTXC-LEN IN TXC-FLD                  
                GO TO FIN-VAL-IKY-TXC.                                  
      *>>>>
*% END
*% IF EOF_BQ OR EOF_VAX 
       VAL-FRM-COD-STXC SECTION.                                        
       INI-VAL-FRM-COD-STXC.                                            
           IF FRM-COD-STXC IN TXC-FLD NOT > SPACES                      
                PERFORM ERR-GLS                                         
                GO TO FIN-VAL-FRM-COD-STXC.                             
      *VAL-COD Valida codigo de tabla                                   
           MOVE 'TAB' TO TAB-COD-SIST.                                  
           MOVE 'SXC ' TO TAB-COD-TTAB IN TAB.                          
           MOVE FRM-COD-STXC IN TXC-FLD TO TAB-COD-CTAB IN TAB.         
           PERFORM VAL-COD.                                             
           IF MSG-COD-MENS = 'COD    NEX' OR                            
              FRM-COD-STXC IN TXC-FLD NOT > SPACES                      
               MOVE SPACES TO FRM-GLS-STXC IN TXC-FLD                   
           ELSE                                                         
               MOVE TAB-GLS-DESC IN TAB TO                              
                    FRM-GLS-STXC IN TXC-FLD.                            
      *<<<< FIN_FRM_COD_STXC                                            
           IF FRM-SUAR = FRM-SUAR-MAL                                   
               GO TO FIN-VAL-FRM-COD-STXC.                              
           MOVE TAB-GLS-DATA IN TAB TO WSS-DATA.                        
           MOVE WSS-PLZO TO TXC-COD-PLZO IN TXC-FLD.                    
           MOVE WSS-VCOC TO TXC-COD-VCOC IN TXC-FLD.                    
           MOVE WSS-BASE TO FRM-COD-BASE IN TXC-FLD.                    
           MOVE WSS-NTRA TO FRM-IND-NTRA IN TXC-FLD.                    
           IF WSS-BASE = 'A'                                            
               MOVE 1 TO FRM-NUM-BASE IN TXC-FLD                        
           ELSE                                                         
               MOVE 12 TO FRM-NUM-BASE IN TXC-FLD.                      
           IF FRM-IND-NTRA IN TXC-FLD = 'N'                             
               MOVE WSS-HVAL TO FRM-NUM-MSTR IN TXC-FLD(1).             
      *>>>>                                                             
      *<<<< FIN_FRM_COD_STXC                                            
           IF FRM-SUAR = FRM-SUAR-MAL                                   
               GO TO FIN-VAL-FRM-COD-STXC.                              
           MOVE TAB-GLS-DATA IN TAB TO WSS-DATA.                        
           MOVE WSS-PLZO TO TXC-COD-PLZO IN TXC-FLD.                    
           MOVE WSS-VCOC TO TXC-COD-VCOC IN TXC-FLD.                    
           MOVE WSS-BASE TO FRM-COD-BASE IN TXC-FLD.                    
           MOVE WSS-NTRA TO FRM-IND-NTRA IN TXC-FLD.                    
           IF WSS-BASE = 'A'                                            
               MOVE 1 TO FRM-NUM-BASE IN TXC-FLD                        
           ELSE                                                         
               MOVE 12 TO FRM-NUM-BASE IN TXC-FLD.                      
           IF FRM-IND-NTRA IN TXC-FLD = 'N'                             
               MOVE WSS-HVAL TO FRM-NUM-MSTR IN TXC-FLD(1).             
      *>>>>                                                             
       FIN-VAL-FRM-COD-STXC.                                            
           EXIT.                                                        
                                                                          
       VAL-TXC-COD-PLZO SECTION.                                        
       INI-VAL-TXC-COD-PLZO.                                            
       FIN-VAL-TXC-COD-PLZO.                                            
           EXIT.                                                        
                                                                        
       VAL-TXC-COD-VCOC SECTION.                                        
       INI-VAL-TXC-COD-VCOC.                                            
       FIN-VAL-TXC-COD-VCOC.                                            
           EXIT.                                                        
                                                                        
       VAL-TXC-FEC-FTXC SECTION.                                        
       INI-VAL-TXC-FEC-FTXC.                                            
      *VAL-FEC Validar Fecha                                            
           MOVE TXC-FEC-FTXC IN TXC-FLD TO FEC-FECH.                    
           MOVE FEC-FORM-FEC TO FEC-FORM.                               
           MOVE FEC-FBLK-S  TO FEC-FBLK.                                
           MOVE FEC-CHOY-LE TO FEC-CHOY.                                
           MOVE FEC-VHBL-S TO FEC-VHBL.                                 
      *<<<< INI_TXC_FEC_FTXC                                            
           IF TXC-FEC-FTXC IN TXC-FLD NOT > ZEROES                      
               PERFORM GET-FHOY                                         
               MOVE HOY-DHOY TO TXC-NUM-DTXC IN TXC-FLD FEC-ITM1        
               MOVE HOY-MHOY TO TXC-NUM-MTXC IN TXC-FLD FEC-ITM2        
               MOVE HOY-SHOY TO TXC-NUM-STXC IN TXC-FLD FEC-ITM3        
               MOVE HOY-AHOY TO TXC-NUM-ATXC IN TXC-FLD FEC-ITM4.       
           IF SCR-CMND = 'ITR' OR 'CTX' OR 'VRF'                        
               MOVE FEC-CHOY-E  TO FEC-CHOY                             
               MOVE FEC-FBLK-N  TO FEC-FBLK                             
           ELSE                                                         
               MOVE FEC-CHOY-LE TO FEC-CHOY                             
               MOVE FEC-FBLK-N  TO FEC-FBLK.                            
           MOVE FEC-VHBL-N TO FEC-VHBL.                                 
      *PVG INI 31-JUL-2008
           IF SCR-CMND = 'CON'
              MOVE FEC-CHOY-N  TO FEC-CHOY.
      *PVG FIN 31-JUL-2008
      *>>>>                                                             
           MOVE FEC-VAL-FEC TO FEC-CMND.                                
           PERFORM PRO-FEC.                                             
           IF FEC-STAT-OKS                                              
               MOVE FEC-FECH TO TXC-FEC-FTXC IN TXC-FLD                 
           ELSE                                                         
               MOVE FRM-SUAR-MAL TO FRM-SUAR                            
               MOVE FEC-MENS     TO FRM-MENS                            
               GO TO FIN-VAL-TXC-FEC-FTXC.                              
       FIN-VAL-TXC-FEC-FTXC.                                            
           EXIT.                                                        
*% END
*% IF EOF_BU OR EOF_VAX
       PUT-FIN-MSTR SECTION.                                            
       INI-PUT-FIN-MSTR.                                                
           MOVE 0 TO FRM-IFLD.                                          
       LUP-PUT-FIN-MSTR.                                                
           ADD 1 TO FRM-IFLD.                                           
           IF FRM-IFLD > WSS-MTRA                                       
               GO TO FIN-PUT-FIN-MSTR.                                  
           IF FRM-NUM-MSTR IN TXC-FLD(FRM-IFLD) = WSS-HVAL              
               GO TO FIN-PUT-FIN-MSTR.                                  
           IF FRM-NUM-MSTR IN TXC-FLD(FRM-IFLD) NOT > ZEROES OR         
              FRM-IFLD = WSS-MTRA                                       
               MOVE WSS-HVAL TO FRM-NUM-MSTR IN TXC-FLD(FRM-IFLD)       
               GO TO FIN-PUT-FIN-MSTR.                                  
           GO TO LUP-PUT-FIN-MSTR.                                      
       FIN-PUT-FIN-MSTR.                                                
           EXIT.                                                        
                                                                        
       VAL-CON-MSTR SECTION.                                            
       INI-VAL-CON-MSTR.                                                
           MOVE SPACES TO MSG-COD-MENS.                                 
           IF FRM-NUM-MSTR IN TXC-FLD(1) NOT > ZEROES                   
               PERFORM ERR-GLS                                          
               GO TO FIN-VAL-CON-MSTR.                                  
           IF FRM-NUM-MSTR IN TXC-FLD(1) = WSS-HVAL                     
               MOVE 'S' TO WSS-IFIN                                     
           ELSE                                                         
               MOVE 'N' TO WSS-IFIN.                                    
           MOVE 1 TO WSS-I.                                             
       LUP-VAL-CON-MSTR.                                                
           MOVE WSS-I TO FRM-IFLD.                                      
           ADD 1 TO WSS-I.                                              
           IF WSS-I > WSS-MTRA                                          
               GO TO CHK-VAL-CON-MSTR.                                  
      *Si aparece un tramo con valor despues que ya habian terminado ...
      *o si no se aceptan mas tramos                                    
           IF FRM-NUM-MSTR IN TXC-FLD(WSS-I) > ZEROES AND               
              ( WSS-IFIN = 'S' OR FRM-IND-NTRA IN TXC-FLD = 'N' )       
               MOVE 'S' TO FRM-UCUR                                     
               MOVE -1 TO FRM-NUM-MSTR-LEN IN TXC-FLD(WSS-I)            
               MOVE 'TXCMSTRBLK<>' TO MSG-COD-MENS                      
               GO TO CHK-VAL-CON-MSTR.                                  
      *Si aparece un tramo con WSS-HVAL significa que aqui ya           
      *terminaron los tramos                                            
           IF FRM-NUM-MSTR IN TXC-FLD(WSS-I) = WSS-HVAL                 
               MOVE 'S' TO WSS-IFIN.                                    
           IF WSS-IFIN = 'S'                                            
               GO TO LUP-VAL-CON-MSTR.                                  
      *Si el valor del tramo no es mayor que el anterior ...            
           IF FRM-NUM-MSTR IN TXC-FLD(WSS-I) NOT >                      
              FRM-NUM-MSTR IN TXC-FLD(FRM-IFLD)                         
               MOVE 'S' TO FRM-UCUR                                     
               MOVE -1 TO FRM-NUM-MSTR-LEN IN TXC-FLD(WSS-I)            
               MOVE 'TXCMSTRNOASC' TO MSG-COD-MENS                      
               GO TO CHK-VAL-CON-MSTR.                                  
           GO TO LUP-VAL-CON-MSTR.                                      
       CHK-VAL-CON-MSTR.                                                
           IF WSS-IFIN = 'N'                                            
               MOVE 'TXCMSTRNOFIN' TO MSG-COD-MENS.                     
           IF MSG-COD-MENS > SPACES                                     
               MOVE 'TAB' TO MSG-COD-SIST                               
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE FRM-SUAR-MAL TO FRM-SUAR.                           
       FIN-VAL-CON-MSTR.                                                
           EXIT.                                                        
*% END
