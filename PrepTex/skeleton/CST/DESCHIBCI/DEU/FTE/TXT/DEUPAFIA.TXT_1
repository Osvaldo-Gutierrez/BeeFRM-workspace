*%! Codigo adicional enganche programa DEUPAFIA
*% IF ( PGM_CHI AND PGM_BCI ) OR ( PGM_PER )
*%! INCLUDE DE ELEMENTOS DE C.A. PARA PLATAFORMA COMERCIAL
*% INCLUDE 'GNSTXT:GNSPPPTC.TXT'
*% END
*%! LARGO_MI_COMMAREA = 850
*% LARGO_MI_COMMAREA = 351
*% IF CMT_ID_PQ
      *<<<< CMT_ID 
      *=============================================================*
      *                        MANTENCIONES                         *
      *=============================================================*
      * MANTENCION : FIANZAS FASE I
      * ETIQUETA   : *OGB-INI 25-FEB-2016 FIANZAS FASE I
      * OBJETIVO   : DESPLEGAR MENSAJE ADVERTENCIA CUANDO
      *              FEC VEN < FEC HOY
      * FECHA      : FEBRERO-2016
      * RESPONSABLE: CIMA-OGB
      *=============================================================*
      *>>>> CMT_ID
*% END
*% IF CMT_ID_PU
      *<<<< CMT_ID
      *=============================================================*
      *                        MANTENCIONES                         *
      *=============================================================*
      *OBJETIVO: DESACOPLAR RUTINA DE MARGENES
      *PROYECTO: LIMITE DE CREDITO SEGUN ARTICULO 84
      *FECHA   : MAYO 2015
      *AUTOR   : AFRI-CGC
      *ETIQUETA:
      *      AFRI-INI 05-MAY-2015 LIMITE DE CREDITO SEGUN ARTICULO 84
      *---------------------------------------------------------------
      * MANTENCION : FIANZAS FASE I
      * ETIQUETA   : *OGB-INI 25-FEB-2016 FIANZAS FASE I
      * OBJETIVO   : DESPLEGAR MENSAJE ADVERTENCIA CUANDO
      *              NO SE INFORMA FECHA DE VENCIMIENTO
      * FECHA      : FEBRERO-2016
      * RESPONSABLE: CIMA-OGB
      *=============================================================*

      *>>>> CMT_ID
*% END
*% IF PGM_BMS AND FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
       COPY LDCWGENG.
      *JSS-INI 21-MAR-1994
      *    03 SCR-CLF     VALUE SPACES              PIC X(64).
           03 FILLER        VALUE SPACES            PIC X(02).
           03 SCR-COD-TOGA  VALUE SPACES            PIC X(03).
           03 SCR-COD-OFIC  VALUE SPACES            PIC X(03).
           03 SCR-COD-EJEC  VALUE SPACES            PIC X(12).
           03 SCR-NUM-ICLI  VALUE SPACES            PIC X(08).
           03 SCR-VRF-ICLI  VALUE SPACES            PIC X(01).
           03 SCR-IND-ICLI  VALUE SPACES            PIC X(01).
           03 SCR-GLS-ICLI  VALUE SPACES            PIC X(03).
           03 SCR-VAL-CMAX  VALUE ZEROES            PIC 9(11).
           03 SCR-COD-VCCF  VALUE SPACES            PIC X(06).
           03 SCR-COD-TOOC  VALUE SPACES            PIC X(03).
           03 SCR-COD-AOOC  VALUE SPACES            PIC X(03).
      *LAV INI 23-MAR-1994
           03 SCR-COD-VCOC  VALUE SPACES            PIC X(06).
           03 SCR-CLF-DISP  VALUE SPACES            PIC X(02).
      *LAV FIN 23-MAR-1994
      *JSS-FIN 21-MAR-1994
           03 SCR-LDC     VALUE SPACES            PIC X(100).
      *>>>>
*% END
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
           03 SCR-FS-ARG                          PIC 9(02).
           03 SCR-ARG-DISP    VALUE SPACES        PIC X(48).
      *>>>>
*% END
*% IF WSS 
      *<<<< WSS 
*% IF PGM_PU 
      *MHM-INI 23-JUN-2006                                              
       COPY DEUMXW01.                                                   
      *MHM-FIN 23-JUN-2006 
*% END
       COPY LDCWGPMP.

      *>>>> WSS 
*% END
*% IF FIN_SCR_TRL
      *<<<< FIN_SCR_TRL
           IF SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) = 'S'
               MOVE 'F10FIANINLDC' TO MSG-COD-MENS
               PERFORM MSG-PF10.
      *>>>>
*% END
*% IF INI_PRO_CONF
      *<<<< INI_PRO_CONF
*% IF PGM_CHI AND PGM_BCI AND PGM_PU
      * PTC-INI-AUT                                                     
           IF SCR-OFRM-SRV AND                                          
               SCR-CONF NOT > SPACES                                    
               MOVE SPACES TO FRM-MENS.                                 
      * PTC-FIN-AUT
      *<<<< ISP-INI  24-JAN-1996 11:35:48 
           IF SCR-OFRM-SRV
               IF SCR-CONF NOT > SPACES
                   GO TO FIN-PRO-CONF.
      *>>>> ISP-FIN  24-JAN-1996 11:35:48 
*% END
           IF SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) = 'S'
               MOVE 'F10FIASINLDC' TO MSG-COD-MENS
               PERFORM MSG-PF10.
      *>>>>
*% END
*% IF FIN_SCR_GIKY OR FIN_SCR_GCNF OR FIN_SCR_GFLD
      *<<<< FIN_SCR_GIKY OR FIN_SCR_GCNF OR FIN_SCR_GFLD
           IF FRM-FFLD = FRM-FFLD-PF3 AND
              SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) = 'S'
               PERFORM EGR-FTER-CIC.
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
*% IF PGM_CHI AND PGM_BCI AND PGM_PQ
      *<<<< ISP-INI  24-JAN-1996 11:35:48
           IF SCR-OFRM-SRV
              MOVE WSS-IDX-IFIA TO SCR-IPRO
           ELSE
      *<<<< ISP-FIN  24-JAN-1996 11:35:48
*% END
      *LOP-INI 12-12-2002                                               
           MOVE SPACES TO WSS-IND-ALZA IN WSS-VARI.                     
           IF SCR-CMND ='VRS'                                           
              MOVE 'VRF' TO SCR-CMND                                    
              MOVE 'VRS' TO WSS-IND-ALZA IN WSS-VARI.                   
      *LOP-FIN 12-12-2002             
           IF SCR-DESDE-CMN
               MOVE SPACES TO SCR-VEC-ENG
               MOVE 1 TO SCR-IPRO
               GO TO FIN-INI-FIO.
           IF SCR-INST-EXT = WSS-INST-FPEN-CIC
               MOVE SPACES TO SCR-MSC-STAT
               MOVE WSS-INST-NULL TO SCR-INST-EXT
               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'FLDING' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO SCR-MENS-EXT
               PERFORM ING-FPEN-CIC.
       FIN-INI-FIO.
      *>>>>
*% END
*% IF FIN_HBL_IKY
      *<<<< FIN_HBL_IKY
           IF SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) = 'S'
               PERFORM HBL-KEY-FIA.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       MSG-PF10 SECTION.
       INI-MSG-PF10.
      *GET-MSG Busca mensaje en tabla
           MOVE 'DEU' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MEN2.
           MOVE FRM-MEN2     TO FIA-GLS-MEN2 IN FIA-FLD.
       FIN-MSG-PF10.
           EXIT.

       HBL-KEY-FIA SECTION.
       INI-HBL-KEY-FIA.
           PERFORM SCR-CLRA-FIA.
           MOVE SCR-CAI-IFIA IN SCR-VARI TO ESC-CAI-IESC IN FIA-FLD.
           MOVE SCR-IIC-IFIA IN SCR-VARI TO ESC-IIC-IESC IN FIA-FLD.
      *ISP   25-JUL-1990 DEBE SER REEMPLAZADO POR VARIABLE
      *     INHIBE MOVE FRM-CPSF TO FRM-CPIM-AEY
           MOVE '1' TO FRM-CPIM-AEY.
           MOVE FRM-CPIM-AEY TO ESC-CAI-IESC-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO ESC-IIC-IESC-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO FIA-NUM-IFIA-ATR IN FIA-FLD.
           MOVE +4 TO ESC-CAI-IESC-LEN IN FIA-FLD.
      *ISP: PARA COMPATIBILIDAD ENGANCHE - NO ENGANCHE
      *     PERFORM FND-KEY.
      *JSS-INI 21-MAR-1994
           MOVE SCR-COD-TOGA TO FIA-COD-TOFS IN FIA-FLD.
           MOVE SCR-NUM-ICLI TO FRM-NUM-ICLI IN FIA-FLD.
           MOVE SCR-VRF-ICLI TO FRM-VRF-ICLI IN FIA-FLD.
           MOVE SCR-IND-ICLI TO FRM-IND-ICLI IN FIA-FLD.
           MOVE SCR-GLS-ICLI TO FRM-GLS-ICLI IN FIA-FLD.
*% IF (PGM_CHI AND PGM_BCI)
      *RVM-CST-INI 6-JAN-1997 NO ASUMIR ESTOS CAMPOS
      *    MOVE SCR-VAL-CMAX TO FIA-VAL-LIMF IN FIA-FLD.
      *    MOVE SCR-COD-VCCF TO FIA-COD-VCLF IN FIA-FLD.
      *RVM-CST-FIN 6-JAN-1997 NO ASUMIR ESTOS CAMPOS
           MOVE SCR-VAL-CMAX TO FIA-VAL-LIMF IN FIA-FLD.                
           MOVE SCR-COD-VCCF TO FIA-COD-VCLF IN FIA-FLD.
*% ELSE
           MOVE SCR-VAL-CMAX TO FIA-VAL-LIMF IN FIA-FLD.
           MOVE SCR-COD-VCCF TO FIA-COD-VCLF IN FIA-FLD.
*% END
           MOVE SCR-COD-OFIC TO ESC-COD-OFEF IN FIA-FLD.
           MOVE SCR-COD-EJEC TO ESC-COD-RCTT IN FIA-FLD.
      *FLB CST  6-DEC-1994
           MOVE 'TAB' TO FIO-SIST.
           MOVE 'TIO ' TO TAB-COD-TTAB IN TAB.
           MOVE SCR-COD-TOGA TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF TAB-CIC-CTAB IN TAB NOT = 'AVL'
               MOVE SCR-COD-TOOC TO AMF-COD-TOOA IN FIA-FLD
               MOVE SCR-COD-AOOC TO AMF-COD-AOOA IN FIA-FLD
      *LAV INI 23-MAR-1994
               MOVE SCR-COD-VCOC TO AMF-COD-VCOA IN FIA-FLD
      *LAV FIN 23-MAR-1994
               MOVE 1 TO AMF-NUM-IAMF IN FIA-FLD.
      *FLB CST  6-DEC-1994 FIN

           PERFORM GET-FHOY.
           MOVE HOY-DHOY     TO ESC-NUM-DCTT IN FIA-FLD.
           MOVE HOY-MHOY     TO ESC-NUM-MCTT IN FIA-FLD.
           MOVE HOY-SHOY     TO ESC-NUM-SCTT IN FIA-FLD.
           MOVE HOY-AHOY     TO ESC-NUM-ACTT IN FIA-FLD.
      *JSS-FIN 21-MAR-1994
           PERFORM HBL-FLD.
           MOVE SCR-INST-GFL TO SCR-INST.

      *ISP SE REQUIEREN PARA BUS-COR-FIA
           MOVE SCR-CAI-IFIA IN SCR-VARI TO FIA-CAI-IESC IN FIA.
           MOVE SCR-IIC-IFIA IN SCR-VARI TO FIA-IIC-IESC IN FIA.
           PERFORM BUS-COR-FIA.
       CIC-HBL-KEY-FIA.
      *
           PERFORM EDT-KEY-FIA.
           PERFORM EDT-FLD-FIA.

           MOVE 'F10FIANINLDC' TO MSG-COD-MENS.
           PERFORM MSG-PF10.

           IF SCR-IND-FST IN SCR-VEC-FST(SCR-IPRO) = 'S'
               MOVE SPACES TO SCR-IND-FST IN SCR-VEC-FST(SCR-IPRO)
               PERFORM SCR-INIT
               PERFORM STP-EXIT
           ELSE
               PERFORM SCR-PUTA.
*% IF PGM_CHI AND PGM_BCI
      *<<<< ISP-INI  24-JAN-1996 11:35:48 
           IF SCR-OFRM-SRV
                EXEC CICS
                 RETURN
                END-EXEC.
      *<<<< ISP-FIN  24-JAN-1996 11:35:48 
*% END
           PERFORM SCR-EXIT.
       FIN-HBL-KEY-FIA.
           EXIT.

      *  CODIGO ADICIONAL PARA ENGANCHE PROGRAMAS
       ING-FPEN-CIC SECTION.
       INI-ING-FPEN-CIC.
           PERFORM ING-SETE.
           PERFORM SCR-CLRA-FIA.
           MOVE SCR-MENS-EXT TO FIA-GLS-MENS.
           PERFORM HBL-IKY.
       FIN-ING-FPEN-CIC.
           EXIT.

       ING-SETE SECTION.
       INI-ING-SETE.
           PERFORM CRG-TBL-ENG.
           MOVE WSS-NTRN(SCR-IPRO)     TO SCR-NTRN.
           MOVE WSS-PROG(SCR-IPRO)     TO SCR-PROG.
           MOVE WSS-NMAP(SCR-IPRO)     TO SCR-NMAP.
           MOVE WSS-NLIB(SCR-IPRO)     TO SCR-NLIB.

           MOVE WSS-NTRV(SCR-IPRO)     TO SCR-NTRV.
           MOVE WSS-PROV(SCR-IPRO)     TO SCR-PROV.
       FIN-ING-SETE.
           EXIT.

       EGR-FPEN-CIC SECTION.
       INI-EGR-FPEN-CIC.
           PERFORM CRG-TBL-ENG.
           ADD 1 TO SCR-IPRO.
           IF SCR-IPRO > WSS-TOT-IIDX
                  PERFORM EGR-FTER-CIC
                  GO TO FIN-EGR-FPEN-CIC.
           IF SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) = SPACES
               GO TO INI-EGR-FPEN-CIC.
           MOVE WSS-INST-FPEN-CIC TO SCR-INST-EXT.
           MOVE WSS-PROG(SCR-IPRO) TO SYS-PROG.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-XCTL TO SYS-CMND.
*% IF PGM_CHI AND PGM_BCI AND PGM_PU
      *<<<< ISP-INI  24-JAN-1996 11:35:48 
           IF SCR-OFRM-SRV
               MOVE WSS-IDX-IFIA TO SCR-IPRO
           ELSE
      *<<<< ISP-FIN  24-JAN-1996 11:35:48  
*% END
      * PTC-INI-AUT                                                     
           IF NOT SCR-OFRM-SRV                                          
      * PTC-FIN-AUT
           PERFORM GNS-PRO-SYS.
       FIN-EGR-FPEN-CIC.
           EXIT.

       EGR-FTER-CIC SECTION.
       INI-EGR-FTER-CIC.
           PERFORM CRG-TBL-ENG.
           MOVE WSS-IDX-ILDC TO SCR-IPRO.
           MOVE 'S' TO SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO).
           MOVE 'S' TO SCR-IND-FST IN SCR-VEC-FST(SCR-IPRO).
           MOVE WSS-INST-FPEN-CIC TO SCR-INST-EXT.
           MOVE WSS-PROG(SCR-IPRO) TO SYS-PROG.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-XCTL TO SYS-CMND.
*% IF PGM_CHI AND PGM_BCI AND PGM_PU
      *<<<< ISP-INI  24-JAN-1996 11:35:48 
           IF SCR-OFRM-SRV
               MOVE WSS-IDX-IFIA TO SCR-IPRO
           ELSE
      *<<<< ISP-FIN  24-JAN-1996 11:35:48  
*% END
      * PTC-INI-AUT                                                     
           IF NOT SCR-OFRM-SRV                                          
      * PTC-FIN-AUT  
           PERFORM GNS-PRO-SYS.
       FIN-EGR-FTER-CIC.
           EXIT.

       SCR-INIT SECTION.
       INI-SCR-INIT.
           MOVE 3  TO FRM-PLIN.
           MOVE 19 TO FRM-NLIN.
           MOVE FRM-CLR-FRM TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE FRM-SINI-DBNF TO FRM-SINI.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FIA-FLD TO FRM-DFLD.
           MOVE FRM-INI TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-INIT.
           EXIT.

       COPY LDCBGMPT.

      *>>>> END EOF
*% END
*%! Codigo adicional
*% RA1 = "DBC"
*% RA2 = "FIA"
*% FRM = "FIA"
*% NRA = 2
*% INCLUDE 'PFSALLALL'
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
           02 SCR-MSC-STAT                         PIC X(01).
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ESC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-FIA-REQA==.
      *JUS-INI 6-FEB-1996 15:09:42 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
      *JUS-FIN
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       COPY DEUBRESC.
       COPY DEUBRFIA.
       COPY SGCBRDBC.
       COPY GNSWGCPT.
       COPY GNSWGSTR.
       COPY GNSBRCIC.
       COPY GNSWGCIC.
       COPY TABBRTIO.
*% IF PGM_PU 
      *LOP-INI 6-DIC-2002                                               
       COPY LDCWGCCU.                                                   
       COPY LDCWGCEG.                                                   
       COPY LDCBRCLF.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CLF-REQA==.        
       COPY LDCBRRDC REPLACING RDC BY RDL.                              
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.        
      *LOP-FIN 6-DIC-2002
*% END

       01  WSS-VARI.
           03 WSS-COD-TUSR                          PIC X(05).
           03 WSS-KEY-IFIA.
              05 WSS-CIC-IESC.
                 07 WSS-CAI-IESC                    PIC X(04).
                 07 WSS-IIC-IESC                    PIC X(08).
              05 WSS-NUM-IFIA                       PIC 9(02).
           03 WSS-COD-TOAX.
              05 WSS-COD-TOOA                       PIC X(03).
              05 WSS-COD-AOOA                       PIC X(03).
           03 WSS-CIC-ICLI                          PIC X(12).
           03 WSS-IFIA                      VALUE 0 PIC 9(01).
              88 EXISTE-FIANZA              VALUE 1.
           03 WSS-IESC                      VALUE 0 PIC 9(01).
              88 EXISTE-ESCRITURA           VALUE 1.
           03 WSS-IAMF                      VALUE 0 PIC 9(01).
              88 EXISTE-AMBITO              VALUE 1.
           03 WSS-IKEY                      VALUE 0 PIC 9(01).
           03 WSS-ACIC                              PIC X(01).
           03 WSS-MENS.
              05 WSS-FIL1 VALUE SPACES              PIC X(01).
              05 WSS-MEN1 VALUE SPACES              PIC X(04).
              05 WSS-FIL2 VALUE SPACES              PIC X(01).
              05 WSS-MEN2 VALUE SPACES              PIC X(08).
*% IF PGM_PU
      *LOP-INI 6-DIC-2002                                               
           03 WSS-COD-CVMC.                                             
              05  WSS-COD-MENS                        PIC X(12).        
              05  WSS-COD-MEN2                        PIC X(12).        
              05  WSS-NUM-MENS                        PIC 9(02).        
              05  WSS-NUM-MEN2                        PIC 9(02).        
              05  WSS-CAMB                            PIC X(28).        
           03 WSS-FEC-FCIE        VALUE 0             PIC 9(08).        
           03 WSS-CIC-ICLF                            PIC X(12).        
           03 WSS-IBUS                                PIC 9(01).        
           03 WSS-IBUS-LDC                            PIC 9(01).        
           03 WSS-T               VALUE ZEROES        PIC 9(02).        
           03 WSS-IND-ALZA        VALUE SPACES        PIC X(03).        
           03 WSS-MENS2           VALUE SPACES        PIC X(40).        
      *LOP-INI 6-DIC-2002                                               
*% END
*% IF PGM_PQ
      *LOP-INI 12-12-2002                                               
           03 WSS-IND-ALZA          VALUE SPACES    PIC X(03).          
      *LOP-FIN 12-12-2002 
*% END
*% IF PGM_PU
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
           03 WSS-FEC-FHOY.
              05 WSS-NUM-SHOY                         PIC 9(02).
              05 WSS-NUM-AHOY                         PIC 9(02).
              05 WSS-NUM-MHOY                         PIC 9(02).
              05 WSS-NUM-DHOY                         PIC 9(02).
           03 WSS-CT-S          VALUE 'S'             PIC X(01).
           03 WSS-CT-DEU        VALUE 'DEU'           PIC X(03).
           03 WSS-CT-FVCTOINF   VALUE 'FIASFVCTOINF'  PIC X(12).
           03 WSS-CT-C00        VALUE '00'            PIC X(02).
           03 WSS-CT-FIAVCDA    VALUE 'FIAVENCIDA'    PIC X(10).

           03 WSS-CT-SNOACTINF  VALUE 'FIASNOACTINF'  PIC X(12).
           03 WSS-CT-AFVCTOHOY  VALUE 'FIAAFVCTOHOY'  PIC X(12).
           03 WSS-CT-AFVCTOFUT  VALUE 'FIAAFVCTOFUT'  PIC X(12).
           03 WSS-CT-NOACTVCDA  VALUE 'FIANOACTVCDA'  PIC X(12).
           03 WSS-CT-NOACTFECH  VALUE 'FIANOACTFECH'  PIC X(12).
           03 WSS-CT-NOACTFECF  VALUE 'FIANOACTFECF'  PIC X(12).
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
*% END
*% IF PGM_PQ
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
           03 WSS-GLS-MENS          VALUE SPACES    PIC X(39).
           03 WSS-IND-MEN-ADV       VALUE 'N'       PIC X(01).
           03 WSS-FEC-FHOY.
              05 WSS-NUM-SHOY                   PIC 9(02).
              05 WSS-NUM-AHOY                   PIC 9(02).
              05 WSS-NUM-MHOY                   PIC 9(02).
              05 WSS-NUM-DHOY                   PIC 9(02).
           03 WSS-CT-ING        VALUE 'ING'           PIC X(03).
           03 WSS-CT-INC        VALUE 'INC'           PIC X(03).
           03 WSS-CT-DEU        VALUE 'DEU'           PIC X(03).
           03 WSS-CT-VIGNFVCTO  VALUE 'FIAVIGNFVCTO'  PIC X(12).
           03 WSS-CT-C00        VALUE '00'            PIC X(02).
           03 WSS-CT-S          VALUE 'S'             PIC X(01).
           03 WSS-CT-NOACTINF   VALUE 'FIASNOACTINF'  PIC X(12).
           03 WSS-CT-NOACTVCDA  VALUE 'FIANOACTVCDA'  PIC X(12).
           03 WSS-CT-FIAVCDA    VALUE 'FIAVENCIDA  '  PIC X(12).
           03 WSS-CT-CON        VALUE 'CON'           PIC X(03).

           03 WSS-CT-AFVCTOHOY  VALUE 'FIAAFVCTOHOY'  PIC X(12).
           03 WSS-CT-AFVCTOFUT  VALUE 'FIAAFVCTOFUT'  PIC X(12).
           03 WSS-CT-NOACTFECH  VALUE 'FIANOACTFECH'  PIC X(12).
           03 WSS-CT-NOACTFECF  VALUE 'FIANOACTFECF'  PIC X(12).
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
*% END

      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
      *DAD  30-JAN-1991 
           IF SCR-DESDE-CMN
               MOVE SPACES TO SCR-MSC-STAT.
      *
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
           PERFORM KEY-ALL-FIA.
           IF SCR-CCPP NOT = 'ING'
               GO TO CON-FND-ACC.
           MOVE 'DEU' TO SCR-KEY-IDBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DEU-FIO-ESC.
           MOVE FIO-STAT TO PGM-STAT-ESC.
           IF FIO-STAT-OKS
*% IF PGM_PER
      *<<<< PGM_PER
      *JSS-JUS-INI 22-APR-1996 18:58:43 
      *FLB CST  28-MAR-1995 
      *         PERFORM VAL-OFI-USR
      *         IF MSG-COD-MENS > SPACES
      *             GO TO FIN-FND-KEY
      *         ELSE
      *FLB CST  28-MAR-1995 FIN
      *JSS-JUS-FIN
      *>>>>
*% END
               MOVE 1 TO WSS-IESC
               PERFORM PUT-ESC-FIA
               IF FIA-NUM-IFIA IN FIA > ZEROES
                   MOVE FIO-GET-KEY TO FIO-CMND
                   PERFORM DEU-FIO-FIA
                   MOVE FIO-STAT TO PGM-STAT-FIA
                   IF NOT FIO-STAT-OKS
                       MOVE 'DEU' TO MSG-COD-SIST
                       MOVE 'FIAIFIANEX' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE FIO-STAT-NEX TO FIO-STAT
                   ELSE
                       MOVE 'ESC' TO SCR-KEY-IFIA
                       MOVE ADR-FIA-REQA TO SCR-FIA-REQA
                       MOVE 1 TO WSS-IFIA
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                       PERFORM CHK-FEC-FVEN
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
                       PERFORM PUT-FIA-FIA
                       PERFORM BUS-COR-AMF
                       MOVE '23' TO FIO-STAT
               ELSE
                   PERFORM BUS-COR-FIA
                   MOVE 1 TO AMF-NUM-IAMF IN FIA-FLD
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                   PERFORM CHK-FEC-FVEN
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
                   MOVE '23' TO FIO-STAT
           ELSE
               MOVE 1 TO FIA-NUM-IFIA IN FIA-FLD
               MOVE 1 TO AMF-NUM-IAMF IN FIA-FLD.

           GO TO FIN-FND-KEY.
       CON-FND-ACC.
           IF FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF8
               IF SCR-KEY-IDBC = 'ESC'
                   PERFORM NXT-PRV-ESC
                   IF FIO-STAT-OKS
                       PERFORM SCR-CLRA-FIA
                       MOVE 1 TO WSS-IESC
*% IF PGM_PER
      *<<<< PGM_PER
      *JSS-JUS-INI 22-APR-1996 18:58:43 
      *FLB CST  28-MAR-1995 
      *                 PERFORM VAL-OFI-USR
      *                 IF MSG-COD-MENS > SPACES
      *                     GO TO FIN-FND-KEY
      *                 ELSE
      *FLB CST  28-MAR-1995 FIN
      *JSS-JUS-FIN
      *>>>>
*% END
                       PERFORM BUS-COR-FIA
                       IF FIA-NUM-IFIA IN FIA-FLD NOT > ZEROES
                           MOVE 'DEU' TO MSG-COD-SIST
                           MOVE 'FIAIFIANEX' TO MSG-COD-MENS
                           PERFORM SET-MSG
                           GO TO FIN-FND-KEY
                       ELSE
                           MOVE 'ESC' TO SCR-KEY-IFIA
                           MOVE ADR-FIA-REQA TO SCR-FIA-REQA
                           MOVE '00' TO PGM-STAT-FIA
                           MOVE 1 TO WSS-IFIA
                           MOVE '00' TO FIO-STAT
                           PERFORM BUS-COR-AMF
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                           PERFORM CHK-FEC-FVEN
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
                           IF AMF-NUM-IAMF IN FIA-FLD >  ZEROES
                               MOVE 1 TO WSS-IAMF
                               MOVE '00' TO PGM-STAT-AMF
                               MOVE '00' TO FIO-STAT
                               GO TO FIN-FND-KEY
                           ELSE
                               MOVE '00' TO FIO-STAT
                               GO TO FIN-FND-KEY
                   ELSE
                   MOVE SPACES TO PGM-STAT
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE 'DEU' TO MSG-COD-SIST
                       MOVE 'ESC    NOPRV' TO MSG-COD-MENS
                       PERFORM SET-MSG
                       GO TO FIN-FND-KEY
                   ELSE
                       MOVE 'DEU' TO MSG-COD-SIST
                       MOVE 'ESC    NONXT' TO MSG-COD-MENS
                       PERFORM SET-MSG
                       GO TO FIN-FND-KEY
               ELSE
               PERFORM LEE-NXT-PRV
               IF FIO-STAT-OKS
                   PERFORM SCR-CLRA-FIA
                   IF SCR-KEY-IDBC = 'FIA'
                       MOVE DBC-CIC-ICLI IN DBC TO FIA-CIC-ICFS 
                                                         IN FIA
                       PERFORM PUT-DBC-FIA
                       PERFORM BUS-FIA-SFI
                       IF NOT FIO-STAT-OKS
                           MOVE '00' TO FIO-STAT
                           MOVE SCR-STAT-CON TO SCR-STAT
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                           PERFORM CHK-FEC-FVEN
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
                           MOVE SPACES TO SCR-FIA-REQA
                           MOVE SPACES TO SCR-KEY-IFIA
                           GO TO FIN-FND-KEY
                       ELSE
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                          PERFORM CHK-FEC-FVEN
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
                           GO TO FIN-FND-KEY
                   ELSE
                       MOVE DBC-CIC-ICLI IN DBC TO FIA-CIC-ICLI 
                                                         IN FIA
                       PERFORM PUT-DBC-DEU
                       PERFORM BUS-FIA-SDE
                       IF NOT FIO-STAT-OKS
                           MOVE '00' TO FIO-STAT
                           MOVE SCR-STAT-CON TO SCR-STAT
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                          PERFORM CHK-FEC-FVEN
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
                           MOVE SPACES TO SCR-FIA-REQA
                           MOVE SPACES TO SCR-KEY-IFIA
                           GO TO FIN-FND-KEY
                       ELSE
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                          PERFORM CHK-FEC-FVEN
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
                           GO TO FIN-FND-KEY
               ELSE
                   MOVE SPACES TO PGM-STAT
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE 'SGC' TO MSG-COD-SIST
                       MOVE 'DBC    NOPRV' TO MSG-COD-MENS
                       PERFORM SET-MSG
                       GO TO FIN-FND-KEY
                   ELSE
                       MOVE 'SGC' TO MSG-COD-SIST
                       MOVE 'DBC    NONXT' TO MSG-COD-MENS
                       PERFORM SET-MSG
                       GO TO FIN-FND-KEY.

           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6
               PERFORM LEE-NXT-PRV-ESC
               IF MSG-COD-MENS = 'FIASI'
                   MOVE 1 TO WSS-IFIA
                   PERFORM BUS-ESC
                   IF FIO-STAT-OKS
                       PERFORM SCR-CLRA-FIA
                       PERFORM BUS-COR-AMF
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                       PERFORM CHK-FEC-FVEN
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
                       IF AMF-NUM-IAMF IN FIA-FLD >  ZEROES
                           MOVE 1 TO WSS-IAMF
                           MOVE '00' TO PGM-STAT-AMF
                           MOVE '00' TO FIO-STAT
                           GO TO FIN-FND-KEY
                        ELSE
                            MOVE '00' TO FIO-STAT
                            GO TO FIN-FND-KEY
                   ELSE
                       MOVE 'DEU' TO MSG-COD-SIST
                       MOVE 'CICIESCNEX' TO MSG-COD-MENS
                       PERFORM SET-MSG
                       GO TO FIN-FND-KEY
               ELSE
                   MOVE SPACES TO PGM-STAT
                   IF SCR-KEY-IFIA = 'FIA'
                       IF FRM-FFLD = FRM-FFLD-PF5
                           MOVE 'DEU' TO MSG-COD-SIST
                           MOVE 'CICICFSNOPRV' TO MSG-COD-MENS
                           PERFORM SET-MSG
                           GO TO FIN-FND-KEY
                       ELSE
                           MOVE 'DEU' TO MSG-COD-SIST
                           MOVE 'CICICFSNONXT' TO MSG-COD-MENS
                           PERFORM SET-MSG
                           GO TO FIN-FND-KEY
                   ELSE      
                   IF SCR-KEY-IFIA = 'DEU'
                       IF FRM-FFLD = FRM-FFLD-PF5
                           MOVE 'DEU' TO MSG-COD-SIST
                           MOVE 'CICICLINOPRV' TO MSG-COD-MENS
                           PERFORM SET-MSG
                           GO TO FIN-FND-KEY
                       ELSE
                           MOVE 'DEU' TO MSG-COD-SIST
                           MOVE 'CICICLINONXT' TO MSG-COD-MENS
                           PERFORM SET-MSG
                           GO TO FIN-FND-KEY
                   ELSE
                       IF FRM-FFLD = FRM-FFLD-PF5
                           MOVE 'DEU' TO MSG-COD-SIST
                           MOVE 'CICIESCNOPRV' TO MSG-COD-MENS
                           PERFORM SET-MSG
                           GO TO FIN-FND-KEY
                       ELSE
                           MOVE 'DEU' TO MSG-COD-SIST
                           MOVE 'CICIESCNONXT' TO MSG-COD-MENS
                           PERFORM SET-MSG
                           GO TO FIN-FND-KEY.

           IF ESC-IIC-IESC IN FIA-FLD NOT > ZEROES
               PERFORM ANL-KEY-FIA
               IF NOT FIO-STAT-OKS
                   MOVE '00' TO FIO-STAT
                   MOVE SCR-STAT-CON TO SCR-STAT
                   GO TO FIN-FND-KEY
               ELSE
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                   PERFORM CHK-FEC-FVEN
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
                   GO TO FIN-FND-KEY.
           PERFORM KEY-ALL-FIA.
           MOVE 'DEU' TO SCR-KEY-IDBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DEU-FIO-ESC.
           MOVE FIO-STAT TO PGM-STAT-ESC.
           IF FIO-STAT-OKS
               MOVE 'ESC' TO SCR-KEY-IDBC
               MOVE 1 TO WSS-IESC
      *        PERFORM PUT-ESC-FIA
*% IF PGM_PER
      *<<<< PGM_PER
      *JSS-JUS-INI 22-APR-1996 18:58:43 
      *FLB CST  28-MAR-1995 
      *         PERFORM VAL-OFI-USR
      *         IF MSG-COD-MENS > SPACES
      *             GO TO FIN-FND-KEY
      *         ELSE
      *FLB CST  28-MAR-1995 FIN
      *JSS-JUS-FIN
      *>>>>
*% END
               IF FIA-NUM-IFIA IN FIA > ZEROES
                   MOVE ESC-CIC-IESC IN ESC TO FIA-CIC-IESC IN FIA
                   MOVE FIO-GET-KEY TO FIO-CMND
                   PERFORM DEU-FIO-FIA
                   MOVE FIO-STAT TO PGM-STAT-FIA
                   IF NOT FIO-STAT-OKS
                       MOVE 'DEU' TO MSG-COD-SIST
                       MOVE 'FIAIFIANEX' TO MSG-COD-MENS
                       PERFORM SET-MSG
                       GO TO FIN-FND-KEY
                   ELSE
                       MOVE ADR-FIA-REQA TO SCR-FIA-REQA
                       MOVE 1 TO WSS-IFIA
                       MOVE 'ESC' TO SCR-KEY-IFIA
      *                PERFORM PUT-FIA-FIA
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                       PERFORM CHK-FEC-FVEN
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
                       IF AMF-NUM-IAMF IN AMF > ZEROES
                           MOVE FIA-KEY-IFIA IN FIA TO
                                AMF-KEY-IFIA IN AMF
                           MOVE FIO-GET-KEY TO FIO-CMND
                           PERFORM DEU-FIO-AMF
                           MOVE FIO-STAT TO PGM-STAT-AMF
                           IF NOT FIO-STAT-OKS
                               MOVE 'DEU' TO MSG-COD-SIST
                               MOVE 'AMFIAMFNEX' TO MSG-COD-MENS
                               PERFORM SET-MSG
                               GO TO FIN-FND-KEY
                           ELSE
                               MOVE 1 TO WSS-IAMF
      *                        PERFORM PUT-AMF-FIA
                               MOVE '00' TO FIO-STAT
                       ELSE
                           PERFORM BUS-COR-AMF
                           IF AMF-NUM-IAMF IN FIA-FLD > ZEROES
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                               PERFORM CHK-FEC-FVEN
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
                               MOVE 1 TO WSS-IAMF
                               MOVE '00' TO PGM-STAT-AMF
      *                        PERFORM PUT-AMF-FIA
                               MOVE '00' TO FIO-STAT
                           ELSE
                               PERFORM CLR-AMF
                               MOVE '00' TO FIO-STAT
               ELSE
                   PERFORM BUS-COR-FIA
                   IF FIA-NUM-IFIA IN FIA-FLD > ZEROES
                       MOVE 'ESC' TO SCR-KEY-IFIA
                       MOVE '00' TO PGM-STAT-FIA
                       MOVE ADR-FIA-REQA TO SCR-FIA-REQA
                       MOVE 1 TO WSS-IFIA
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                       PERFORM CHK-FEC-FVEN
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
      *                PERFORM PUT-FIA-FIA
                       IF AMF-NUM-IAMF IN AMF > ZEROES
                           MOVE FIA-KEY-IFIA IN FIA TO
                                AMF-KEY-IFIA IN AMF
                           MOVE FIO-GET-KEY TO FIO-CMND
                           PERFORM DEU-FIO-AMF
                           MOVE FIO-STAT TO PGM-STAT-AMF
                           IF NOT FIO-STAT-OKS
                               MOVE 'DEU' TO MSG-COD-SIST
                               MOVE 'AMFIAMFNEX' TO MSG-COD-MENS
                               PERFORM SET-MSG
                               GO TO FIN-FND-KEY
                           ELSE
                               MOVE 1 TO WSS-IAMF
      *                        PERFORM PUT-AMF-FIA
                               MOVE '00' TO FIO-STAT
                       ELSE
                           PERFORM BUS-COR-AMF
                           IF AMF-NUM-IAMF IN FIA-FLD > ZEROES
                               MOVE '00' TO PGM-STAT-AMF
                               MOVE 1 TO WSS-IAMF
      *                        PERFORM PUT-AMF-FIA
                               MOVE '00' TO FIO-STAT
                           ELSE
                               PERFORM CLR-AMF
                               MOVE '00' TO FIO-STAT
                   ELSE
                       PERFORM CLR-FIA
                       PERFORM CLR-AMF
                       MOVE '00' TO FIO-STAT
           ELSE
               NEXT SENTENCE.
           GO TO FIN-FND-KEY.
      *>>>>
*% END
*% IF INI_SCR_TRL
      *<<<< INI_SCR_TRL
*% IF PGM_PQ
      * PTC-INI-AUT                                                     
           IF SCR-STAT NOT = SCR-STPP                                   
               MOVE FRM-SUAR-MAL TO FRM-SUAR.                           
      * PTC-FIN-AUT
*% END
           MOVE SPACES TO MSG-COD-MENS.
           IF FRM-FFLD = FRM-FFLD-PF12
               GO TO CON-SCR-TRL.
           IF NOT EXISTE-ESCRITURA
               GO TO CON-SCR-TRL.
           IF NOT ( ESC-MSC-STAT IN ESC = 'N' OR
                    ESC-MSC-STAT IN ESC NOT > SPACES )
               MOVE ESC-MSC-STAT IN ESC TO SCR-MSC-STAT
               IF ( SCR-CCPP = 'ING' OR 'ELI' OR 'ACC' ) AND
                    SCR-CMND NOT = 'VRF'
                   MOVE 'ESCSTATSI' TO MSG-COD-MENS.
      *ALD         IF EXISTE-FIANZA
      *                MOVE ADR-FIA-REQA TO SCR-FIA-REQA
      *                GO TO MSG-SCR-TRL
      *            ELSE
      *                GO TO MSG-SCR-TRL.
           IF EXISTE-FIANZA
               MOVE ADR-FIA-REQA TO SCR-FIA-REQA
               IF FIA-FEC-FALZ > ZEROES
                  MOVE 'FIA    ALZ' TO MSG-COD-MENS
*% IF PGM_PQ
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                  MOVE SPACES        TO WSS-GLS-MENS
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
*% END
               ELSE
               IF FIA-FEC-FAUT > ZEROES
                  MOVE 'FIA    AUT' TO MSG-COD-MENS
*% IF PGM_PQ
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                  MOVE SPACES        TO WSS-GLS-MENS
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
*% END
               ELSE
               IF FIA-FEC-FSOL > ZEROES
                   MOVE 'FIA    SOL' TO MSG-COD-MENS
*% IF PGM_PQ
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
                  MOVE SPACES        TO WSS-GLS-MENS
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
*% END
               ELSE
               IF NOT ( FIA-MSC-STAT IN FIA = 'N' OR
                        FIA-MSC-STAT IN FIA NOT > SPACES )
                   MOVE 'FIASTATSI' TO MSG-COD-MENS
               ELSE
                   NEXT SENTENCE
           ELSE
               IF SCR-CMND = 'VRF'
                   MOVE 'FIAIFIANEX' TO MSG-COD-MENS.
       MSG-SCR-TRL.
           IF MSG-COD-MENS > SPACES
               MOVE 'DEU' TO MSG-COD-SIST
               PERFORM GET-MSG
               IF SCR-STAT = SCR-STAT-CON
                   MOVE MSG-GLS-DESC TO FRM-MEN2
               ELSE
                   MOVE SCR-STAT-CON TO SCR-STAT
                   MOVE MSG-GLS-DESC TO FRM-MENS.
*% IF PGM_PQ
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
           IF WSS-GLS-MENS > SPACES
              MOVE WSS-GLS-MENS TO FRM-MEN2.
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
*% END
       CON-SCR-TRL.
      *>>>>
*% END
*% IF INI_CMN_MOD
      *<<<< INI_CMN_MOD 
           PERFORM RET-ALL-FIA.
           PERFORM MOD-ESC-FIA.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-MOD.
           PERFORM RET-AMF-FIA.
           IF AMF-NUM-IAMF IN AMF = ZEROES
               GO TO FIN-CMN-MOD.
           PERFORM KEY-ALL-FIA.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DEU-FIO-AMF.      
           IF NOT FIO-STAT-OKS
      *ALD-BCI-INI                                                      
               MOVE SPACES TO AMF                                       
               PERFORM KEY-AMF-FIA                                      
      *ALD-BCI-FIN   
               PERFORM RET-AMF-FIA
               MOVE HOY-STP-ITRN TO AMF-STP-ITRN IN AMF
               MOVE FIO-PUT TO FIO-CMND
               PERFORM DEU-FIO-AMF
               GO TO FIN-CMN-MOD.
           PERFORM RET-ALL-FIA.
           MOVE HOY-STP-ITRN TO AMF-STP-ITRN IN AMF.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM DEU-FIO-AMF.
           GO TO FIN-CMN-MOD.
      *>>>>
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
      *GET-CIC Obtener CIC
           IF ESC-CAI-IESC IN FIA-FLD NOT > SPACES AND
              ESC-IIC-IESC IN FIA-FLD NOT > ZEROES
      *MHM-INI 23-JUN-2006                                              
      *        MOVE 'F'  TO CIC-COD-TCIC IN CIC                         
      *        MOVE ESC-COD-OFEF IN FIA-FLD TO CIC-COD-CCIC IN CIC      
               MOVE 'F600' TO CIC-CAI-ICIC IN CIC                       
      *MHM-FIN 23-JUN-2006 
               MOVE CIC-GET TO CIC-CMND
               PERFORM PRO-CIC
               IF CIC-STAT NOT = CIC-STAT-OKS
                   MOVE CIC-MENS TO FRM-MENS
                   MOVE FIO-STAT-NEX TO FIO-STAT
                   GO TO FIN-CMN-ING
               ELSE
                   MOVE CIC-CAI-ICIC TO ESC-CAI-IESC IN FIA-FLD
                   MOVE CIC-NUM-ICIC TO ESC-IIC-IESC IN FIA-FLD
                   MOVE 'S' TO WSS-ACIC
           ELSE
               MOVE 'N' TO WSS-ACIC.

      *PVC-INI 22-SEP-2010  GENERE NUMERO DE FIANZA                     
           IF SCR-CMND = 'INC' AND
              WSS-ACIC = 'S'                                            
               PERFORM GENERA-FIA
               IF WSS-ACIC NOT = 'S'                                    
                   GO TO FIN-CMN-ING.                                   
      *PVC-FIN 22-SEP-2010  
      *

           PERFORM RET-ALL-FIA.
           PERFORM MOD-ESC-FIA.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-ING.
      *>>>>
*% END
*% IF CMN_ING
      *<<<< CMN_ING
      *MHM-INI 23-JUN-2006                                              
           MOVE ESC-CAI-IESC IN FIA-FLD TO CIC-CAI-ICIC.                
           MOVE ESC-IIC-IESC IN FIA-FLD TO CIC-IIC-ICIC.                
           IF SCR-OFRM-SRV                                              
               MOVE PTC-FIA-TYPE TO QUE-TYPE                            
               MOVE TSK-TERM-ALF TO QUE-TERM                            
               MOVE QUE-DEL      TO QUE-CMND                            
               PERFORM GNS-PRO-QUE                                      
               MOVE PTC-FIA-TYPE TO QUE-TYPE                            
               MOVE TSK-TERM-ALF TO QUE-TERM                            
               MOVE PTC-FIA-LENG TO QUE-LITM                            
               MOVE CIC-CAI-ICIC TO PTC-FIA-FIA-CAI-IESC                
               MOVE CIC-IIC-ICIC TO PTC-FIA-FIA-IIC-IESC                
               MOVE FIA-NUM-IFIA IN FIA-FLD TO PTC-FIA-FIA-NUM-IFIA     
               MOVE PTC-FIA-ITEM TO QUE-ITEM                            
               MOVE QUE-PUT      TO QUE-CMND                            
               PERFORM GNS-PRO-QUE.                                     
      *MHM-FIN 23-JUN-2006    
           IF FIA-NUM-IFIA IN FIA-FLD NOT > ZEROES OR
              AMF-NUM-IAMF IN FIA-FLD NOT > ZEROES OR
              ( AMF-MSC-TVOA IN FIA-FLD NOT > SPACES AND
                AMF-COD-TOOA IN FIA-FLD NOT > SPACES AND
                AMF-COD-OFOA IN FIA-FLD NOT > SPACES AND
                AMF-CAI-IOCA IN FIA-FLD NOT > SPACES AND
                AMF-IIC-IOCA IN FIA-FLD NOT > ZEROES AND
                AMF-COD-VCOA IN FIA-FLD NOT > SPACES AND
                AMF-COD-AOOA IN FIA-FLD NOT > SPACES AND
                AMF-COD-CDOA IN FIA-FLD NOT > SPACES AND
                AMF-VAL-LIMA IN FIA-FLD NOT > ZEROES AND
                AMF-COD-VCLA IN FIA-FLD NOT > SPACES AND
                AMF-IND-TDEU IN FIA-FLD NOT > SPACES )
                IF FRM-FFLD = FRM-FFLD-PF10 AND
                   SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) = 'S'
                    PERFORM EGR-FPEN-CIC
                ELSE
                IF WSS-ACIC = 'S'
                    MOVE 'DEU'          TO MSG-COD-SIST
                    MOVE 'FIAING OKCIC' TO MSG-COD-MENS
                    PERFORM GET-MSG
                    MOVE MSG-GLS-DESC TO FRM-MEN1
                    MOVE ESC-CAI-IESC IN FIA-FLD TO WSS-MEN1
                    MOVE ESC-IIC-IESC IN FIA-FLD TO WSS-MEN2
                    MOVE WSS-MENS     TO FRM-MEN2
                    GO TO FIN-CMN-ING
                ELSE
                    GO TO FIN-CMN-ING.
           MOVE HOY-STP-ITRN TO AMF-STP-ITRN IN AMF.
      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
           IF FIO-STAT-OKS AND WSS-ACIC = 'S'
               MOVE 'DEU'          TO MSG-COD-SIST
               MOVE 'FIAING OKCIC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE ESC-CAI-IESC IN FIA-FLD TO WSS-MEN1
               MOVE ESC-IIC-IESC IN FIA-FLD TO WSS-MEN2
               MOVE WSS-MENS     TO FRM-MEN2.
      *>>>>
*% END
*% IF FIN_CMN_ING OR SCR_GFLD_VAL_MKY
      *<<<< FIN_CMN_ING OR SCR_GFLD_VAL_MKY
           IF FRM-FFLD = FRM-FFLD-PF10 AND
              SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) = 'S'
               PERFORM EGR-FPEN-CIC.
      *>>>>
*% END
*% IF INI_CMN_ELI
           IF AMF-NUM-IAMF IN FIA-FLD NOT > ZEROES
               IF FIA-NUM-IFIA IN FIA-FLD > ZEROES
                   PERFORM KEY-ALL-FIA
                   MOVE FIO-GET-KEY-UPD TO FIO-CMND
                   PERFORM DEU-FIO-FIA
                   IF NOT FIO-STAT-OKS
                       MOVE FIO-MENS TO FRM-MENS
                       GO TO FIN-CMN-ELI
                   ELSE
                       MOVE FIO-DEL TO FIO-CMND
                       PERFORM DEU-FIO-FIA
                       GO TO FIN-CMN-ELI
               ELSE
                   PERFORM KEY-ESC-FIA
                   MOVE FIO-GET-KEY-UPD TO FIO-CMND
                   PERFORM DEU-FIO-ESC
                   IF NOT FIO-STAT-OKS
                       MOVE FIO-MENS TO FRM-MENS
                       GO TO FIN-CMN-ELI
                   ELSE
                       MOVE FIO-DEL TO FIO-CMND
                       PERFORM DEU-FIO-ESC
                       GO TO FIN-CMN-ELI.
      *>>>>
*% END
*% IF ABT_CMN_ACC
      *<<<< ABT_CMN_ACC
               IF SCR-CMND = 'VRF'
                   MOVE 'DEU' TO MSG-COD-SIST
                   MOVE 'FIASTATNOMOD' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-CMN-ACC
               ELSE
      *>>>>
*% END
*% IF INI_CMN_ACC
      *<<<< INI_CMN_ACC
           IF SCR-CMND NOT = 'VRF'
               GO TO FIN-CMN-ACC.
           PERFORM KEY-FIA-FIA.
      *LOP-INI 20-DIC-2002                                              
      *    IF WSS-IND-ALZA IN WSS-VARI > SPACES                         
      *       GO TO SAL-CMN-ACC.                                        
           PERFORM RET-FIA-FIA.                                         
           MOVE FIA-CIC-ICFS IN FIA  TO CCU-CIC-ICLI IN CCU-VARI.       
           MOVE FIA-KEY-IFIA IN FIA  TO CCU-KEY-IFIA IN CCU-VARI.       
           PERFORM CCU-POR-MAR.                                         
      *    IF MSG-COD-MENS > SPACES                                     
      *       MOVE MSG-GLS-DESC TO FRM-MENS                             
      *       MOVE FRM-SUAR-MAL TO FRM-SUAR                             
      *       GO TO FIN-CMN-ACC.                                        
           IF CCU-NUM-MENS-MAR < 21                                     
              MOVE CCU-GLS-MON1-MAR TO FRM-MEN1                         
              MOVE CCU-GLS-MON2-MAR TO FRM-MEN2                         
              MOVE FRM-SUAR-MAL     TO FRM-SUAR                         
              GO TO FIN-CMN-ACC                                         
           ELSE                                                         
           IF CCU-NUM-MENS-MAR < 41 AND                                 
              WSS-IND-ALZA IN WSS-VARI NOT > SPACES                     
              MOVE CCU-GLS-MON1-MAR TO FRM-MEN1                         
              MOVE CCU-GLS-MON2-MAR TO FRM-MEN2                         
              MOVE FRM-SUAR-MAL     TO FRM-SUAR                         
              GO TO FIN-CMN-ACC                                         
           ELSE                                                         
           IF CCU-NUM-MENS-MAR < 41 AND                                 
              WSS-IND-ALZA IN WSS-VARI > SPACES                         
              MOVE CCU-GLS-MON1-MAR TO FRM-MEN2                         
              MOVE CCU-GLS-MON1-MAR TO WSS-MENS2                        
           ELSE                                                         
           IF CCU-NUM-MENS-MAR < 61                                     
              MOVE CCU-GLS-MON1-MAR TO WSS-MENS2                        
              MOVE CCU-GLS-MON1-MAR TO FRM-MEN2.                        
      *SAL-CMN-ACC.                                                     
      *LOP-FIN 20-DIC-2002                                              
           PERFORM KEY-FIA-FIA. 
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DEU-FIO-FIA.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ACC.

           PERFORM RET-FIA-FIA.
           PERFORM GET-FHOY.
           MOVE HOY-STP-ITRN TO FIA-STP-ITRN IN FIA.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM DEU-FIO-FIA.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ACC.

           PERFORM KEY-ESC-FIA.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DEU-FIO-ESC.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ACC.
           PERFORM RET-ESC-FIA.
           MOVE HOY-STP-ITRN TO ESC-STP-ITRN IN ESC.
           MOVE FIA-MSC-STAT IN FIA-FLD TO ESC-MSC-STAT IN ESC.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM DEU-FIO-ESC.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ACC.
           MOVE 'DEU' TO MSG-COD-SIST.
           MOVE 'FIASTATMOD' TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
      *LOP-INI 08-04-2003                                               
           IF WSS-MENS2 > SPACES                                        
              MOVE WSS-MENS2 TO FRM-MEN2.                               
      *LOP-FIN 08-04-2003  
           GO TO FIN-CMN-ACC.
      *>>>>
*% END
*% IF FIN_HBL_FLD
      *<<<< FIN_HBL_FLD
      *ISP: PARA COMPATIBILIDAD ENGANCHE - NO ENGANCHE
           IF SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) NOT = 'S'
           IF NOT ( SCR-MSC-STAT = 'N' OR SCR-MSC-STAT NOT > SPACES )
               PERFORM PRO-ESC-FIA.
           IF SCR-CMND = 'VRF'
               PERFORM PRO-MKY-FIA
               PERFORM PRO-FLD-FIA
               MOVE  0 TO FIA-COD-TOFS-LEN IN FIA-FLD
               MOVE -1 TO FIA-MSC-STAT-LEN IN FIA-FLD
               MOVE FRM-CPIM-UBY TO FIA-MSC-STAT-ATR IN FIA-FLD
               GO TO FIN-HBL-FLD
           ELSE
               MOVE FRM-CPIM-AEY TO FIA-MSC-STAT-ATR IN FIA-FLD
               MOVE 'N' TO FIA-MSC-STAT IN FIA-FLD.
      *ISP: PARA COMPATIBILIDAD ENGANCHE - NO ENGANCHE
           IF SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) NOT = 'S'
           IF FIA-NUM-IFIA-ALF IN FIA-FLD NOT > SPACES OR
              FIA-NUM-IFIA-ALF IN FIA-FLD = ZEROES
               PERFORM PRO-FIA-FIA
               PERFORM PRO-MKY-FIA
               MOVE  0 TO FIA-COD-TOFS-LEN IN FIA-FLD
               MOVE -1 TO ESC-COD-OFEF-LEN IN FIA-FLD.
      *ISP: PARA COMPATIBILIDAD ENGANCHE - NO ENGANCHE
           IF SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) NOT = 'S'
           IF AMF-NUM-IAMF-ALF IN FIA-FLD NOT > SPACES OR
              AMF-NUM-IAMF-ALF IN FIA-FLD = ZEROES
               PERFORM PRO-AMF-FIA.
      *JSS-INI 21-MAR-1994
           IF SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) NOT = 'S'
               GO TO CON-HBL-FLD.
           IF FIA-COD-TOFS IN FIA-FLD > SPACES
               MOVE  0           TO FIA-COD-TOFS-LEN IN FIA-FLD
               MOVE -1           TO FRM-NUM-ICFS-LEN IN FIA-FLD
               MOVE FRM-CPIM-AEY TO FIA-COD-TOFS-ATR IN FIA-FLD.
           IF ESC-COD-OFEF IN FIA-FLD > SPACES
               MOVE FRM-CPIM-AEY TO ESC-COD-OFEF-ATR IN FIA-FLD.
           IF ESC-FEC-FCTT IN FIA-FLD > ZEROES
               MOVE FRM-CPIM-AEY TO ESC-FEC-FCTT-ATR IN FIA-FLD.
           IF ESC-COD-RCTT IN FIA-FLD > SPACES
               MOVE FRM-CPIM-AEY TO ESC-COD-RCTT-ATR IN FIA-FLD.
           IF NOT ( FRM-NUM-ICLI IN FIA-FLD = ZEROES OR SPACES )
               MOVE FRM-CPIM-AEY TO FRM-NUM-ICLI-ATR IN FIA-FLD
               MOVE FRM-CPIM-AEY TO FRM-VRF-ICLI-ATR IN FIA-FLD
               MOVE FRM-CPIM-AEY TO FRM-IND-ICLI-ATR IN FIA-FLD
               MOVE FRM-CPIM-AEY TO FRM-GLS-ICLI-ATR IN FIA-FLD.
*% IF (PGM_CHI AND PGM_BCI)
      *RVM-CST-INI 6-JAN-1997 NO ASUMIR ESTOS CAMPOS
      *    IF FIA-VAL-LIMF IN FIA-FLD > ZEROES
      *        MOVE FRM-CPIM-AEY TO FIA-VAL-LIMF-ATR IN FIA-FLD.
      *    IF FIA-COD-VCLF IN FIA-FLD > SPACES
      *        MOVE FRM-CPIM-AEY TO FIA-COD-VCLF-ATR IN FIA-FLD.
      *RVM-CST-FIN 6-JAN-1997 NO ASUMIR ESTOS CAMPOS
           IF FIA-VAL-LIMF IN FIA-FLD > ZEROES                          
               MOVE FRM-CPIM-AEY TO FIA-VAL-LIMF-ATR IN FIA-FLD.        
           IF FIA-COD-VCLF IN FIA-FLD > SPACES                          
               MOVE FRM-CPIM-AEY TO FIA-COD-VCLF-ATR IN FIA-FLD.
*% ELSE
           IF FIA-VAL-LIMF IN FIA-FLD > ZEROES
               MOVE FRM-CPIM-AEY TO FIA-VAL-LIMF-ATR IN FIA-FLD.
           IF FIA-COD-VCLF IN FIA-FLD > SPACES
               MOVE FRM-CPIM-AEY TO FIA-COD-VCLF-ATR IN FIA-FLD.
*% END
           MOVE FRM-CPIM-AEY TO AMF-COD-TOOA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-COD-OFOA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-CAI-IOCA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-IIC-IOCA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-NUM-IAMF-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-COD-VCOA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-COD-AOOA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-COD-CDOA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-VAL-LIMA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-COD-VCLA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-IND-TDEU-ATR IN FIA-FLD.
       CON-HBL-FLD.
      *JSS-FIN 21-MAR-1994
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
*% IF PGM_PER
      *<<<< PGM_PER
      *JSS-JUS-INI 22-APR-1996 19:01:42 
      *FLB CST  28-MAR-1995 
      * COPY DEUBVUOF.
      *JSS-JUS-FIN
      *>>>>
*% END
       ANL-KEY-FIA SECTION.
       INI-ANL-KEY-FIA.
      * Si existe rut de Deudor y rut de Fiador
           IF FRM-NUM-ICLI IN FIA-FLD NOT = ZEROES AND
              FRM-NUM-ICFS IN FIA-FLD NOT = ZEROES
               MOVE 'DEU' TO SCR-KEY-IFIA
               MOVE 'DEU' TO SCR-KEY-IDBC
               PERFORM BUS-IDC-CIC-DEU
               IF FIO-STAT-OKS
                   MOVE ADR-DBC-REQA TO SCR-DBC-REQA
                   PERFORM BUS-IDC-CIC-FIA
                   IF FIO-STAT-OKS
                       PERFORM BUS-FIA-ADF
                   ELSE
                       NEXT SENTENCE
               ELSE
                   NEXT SENTENCE
           ELSE
      * Si existe rut de Deudor
           IF FRM-NUM-ICLI IN FIA-FLD NOT = ZEROES
               MOVE 'DEU' TO SCR-KEY-IFIA
               MOVE 'DEU' TO SCR-KEY-IDBC
               PERFORM BUS-IDC-CIC-DEU
               IF FIO-STAT-OKS
                   MOVE ADR-DBC-REQA TO SCR-DBC-REQA
                   PERFORM BUS-FIA-SDE
               ELSE
                   NEXT SENTENCE
           ELSE
      * Si existe rut de Fiador
           IF FRM-NUM-ICFS IN FIA-FLD NOT = ZEROES
               MOVE 'FIA' TO SCR-KEY-IFIA
               MOVE 'FIA' TO SCR-KEY-IDBC
               PERFORM BUS-IDC-CIC-FIA
               IF FIO-STAT-OKS
                   MOVE ADR-DBC-REQA TO SCR-DBC-REQA
                   PERFORM BUS-FIA-SFI
               ELSE
                   NEXT SENTENCE
           ELSE
      * Si existe nombre de Deudor y nombre de Fiador
           IF FRM-GLS-NOMC IN FIA-FLD > SPACES AND
              FRM-GLS-NOMF IN FIA-FLD > SPACES
               MOVE 'DEU' TO SCR-KEY-IFIA
               MOVE 'DEU' TO SCR-KEY-IDBC
               PERFORM BUS-NMB-CIC-DEU
               IF FIO-STAT-OKS
                   MOVE ADR-DBC-REQA TO SCR-DBC-REQA
                   PERFORM BUS-NMB-CIC-FIA
                   IF FIO-STAT-OKS
                       PERFORM BUS-FIA-ADF
                   ELSE
                       NEXT SENTENCE
               ELSE
                   NEXT SENTENCE
           ELSE
      * Si existe nombre de Deudor
           IF FRM-GLS-NOMC IN FIA-FLD     > SPACES
               MOVE 'DEU' TO SCR-KEY-IFIA
               MOVE 'DEU' TO SCR-KEY-IDBC
               PERFORM BUS-NMB-CIC-DEU
               IF FIO-STAT-OKS
                   MOVE ADR-DBC-REQA TO SCR-DBC-REQA
                   PERFORM BUS-FIA-SDE
               ELSE
                   NEXT SENTENCE
           ELSE
      * Si existe nombre de Fiador
           IF FRM-GLS-NOMF IN FIA-FLD     > SPACES
               MOVE 'FIA' TO SCR-KEY-IFIA
               MOVE 'FIA' TO SCR-KEY-IDBC
               PERFORM BUS-NMB-CIC-FIA
               IF FIO-STAT-OKS
                   MOVE ADR-DBC-REQA TO SCR-DBC-REQA
                   PERFORM BUS-FIA-SFI.
       FIN-ANL-KEY-FIA.
           EXIT.

       BUS-FIA-SDE SECTION.
       INI-BUS-FIA-SDE.    
           MOVE 1 TO WSS-IKEY.
           MOVE FIA-CIC-ICLI IN FIA TO WSS-CIC-ICLI.
           MOVE LOW-VALUES          TO FIA-CIC-ICFS IN FIA.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'FIA-GLS-ICYF'  TO FIO-AKEY.
           PERFORM DEU-FIO-FIA.
           IF FIO-STAT-OKS AND
              WSS-CIC-ICLI = FIA-CIC-ICLI IN FIA
               MOVE 1 TO WSS-IFIA
               MOVE '00' TO PGM-STAT-FIA
               MOVE 'DEU' TO SCR-KEY-IFIA 
               MOVE ADR-FIA-REQA TO SCR-FIA-REQA
               PERFORM BUS-ESC
               IF FIO-STAT-OKS
                   PERFORM BUS-COR-AMF
                   IF AMF-NUM-IAMF IN FIA-FLD > ZEROES
                       MOVE 1 TO WSS-IAMF
                       MOVE '00' TO PGM-STAT-AMF
      *                PERFORM PUT-AMF-FIA
                       MOVE '00' TO FIO-STAT
                   ELSE
                       PERFORM CLR-AMF
                       MOVE '00' TO FIO-STAT
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE 'DEU' TO MSG-COD-SIST
               MOVE 'CICICLINODEU' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT.
       FIN-BUS-FIA-SDE.
           EXIT.

       BUS-FIA-SFI SECTION.
       INI-BUS-FIA-SFI.    
           MOVE 2 TO WSS-IKEY.
           MOVE FIO-GET-KEY TO FIO-CMND
           MOVE 'FIA-CIC-ICFS'  TO FIO-AKEY
           PERFORM DEU-FIO-FIA
           IF FIO-STAT-OKS
               MOVE '00' TO PGM-STAT-FIA
               MOVE 'FIA' TO SCR-KEY-IFIA 
               MOVE ADR-FIA-REQA TO SCR-FIA-REQA
               MOVE 1 TO WSS-IFIA
               PERFORM BUS-ESC
               IF FIO-STAT-OKS
                   PERFORM BUS-COR-AMF
                   IF AMF-NUM-IAMF IN FIA-FLD > ZEROES
                       MOVE 1 TO WSS-IAMF
                       MOVE '00' TO PGM-STAT-AMF
      *                PERFORM PUT-AMF-FIA
                       MOVE '00' TO FIO-STAT
                   ELSE
                       PERFORM CLR-AMF
                       MOVE '00' TO FIO-STAT
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE 'DEU' TO MSG-COD-SIST
               MOVE 'CICICFSNOFIA' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT.
       FIN-BUS-FIA-SFI.
           EXIT.

       BUS-FIA-ADF SECTION.
       INI-BUS-FIA-ADF.
           MOVE 3 TO WSS-IKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           MOVE 'FIA-GLS-ICYF'  TO FIO-AKEY.
           PERFORM DEU-FIO-FIA.
           IF FIO-STAT-OKS
               MOVE '00' TO PGM-STAT-FIA
               MOVE 'DEU' TO SCR-KEY-IFIA 
               MOVE ADR-FIA-REQA TO SCR-FIA-REQA
               MOVE 1 TO WSS-IFIA
               PERFORM BUS-ESC
               IF FIO-STAT-OKS
                   PERFORM BUS-COR-AMF
                   IF AMF-NUM-IAMF IN FIA-FLD > ZEROES
                       MOVE 1 TO WSS-IAMF
                       MOVE '00' TO PGM-STAT-AMF
      *                PERFORM PUT-AMF-FIA
                       MOVE '00' TO FIO-STAT
                   ELSE
                       PERFORM CLR-AMF
                       MOVE '00' TO FIO-STAT
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE 'DEU' TO MSG-COD-SIST
               MOVE 'GLSICYFNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT.
       FIN-BUS-FIA-ADF.
           EXIT.

       BUS-ESC SECTION.
       INI-BUS-ESC.
           MOVE FIA-CIC-IESC IN FIA TO ESC-CIC-IESC IN ESC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DEU-FIO-ESC.
           MOVE FIO-STAT TO PGM-STAT-ESC.
           IF FIO-STAT-OKS
               MOVE 1 TO WSS-IESC
           ELSE
               MOVE 'DEU' TO MSG-COD-SIST
               MOVE 'CICIESCNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT.
       FIN-BUS-ESC.
           EXIT.

       BUS-NMB-CIC-DEU SECTION.
       INI-BUS-NMB-CIC-DEU.
      *NOM-CLI Busca Cliente por medio del Nombre
      *ALD
           MOVE SPACES TO DBC-GLS-NOMC IN DBC.
      *    UNSTRING FRM-GLS-NOMC IN FIA-FLD DELIMITED BY '/' INTO
      *                            DBC-GLS-APAT IN DBC
      *                            DBC-GLS-AMAT IN DBC
      *                            DBC-GLS-NOMB IN DBC.

           MOVE FRM-GLS-NOMC IN FIA-FLD TO STR-GLS-GSTR
           PERFORM STR-UNS
           MOVE STR-GLS-FUNS IN STR-VARI(1) TO DBC-GLS-APAT IN DBC
           MOVE STR-GLS-FUNS IN STR-VARI(2) TO DBC-GLS-AMAT IN DBC
           MOVE STR-GLS-FUNS IN STR-VARI(3) TO DBC-GLS-NOMB IN DBC.

           MOVE 'DBC-GLS-NOMC' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               MOVE ZEROES TO FRM-NUM-ICLI IN FIA-FLD
               MOVE SPACES TO FRM-VRF-ICLI IN FIA-FLD
               MOVE SPACES TO FRM-IND-ICLI IN FIA-FLD
               MOVE SPACES TO FRM-GLS-ICLI IN FIA-FLD
               MOVE 'DEU'          TO MSG-COD-SIST
               MOVE 'FRMNOMCNOSGC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT
           ELSE
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN            TO FRM-GLS-NOMC IN FIA-FLD
               MOVE DBC-NUM-ICLI IN DBC TO FRM-NUM-ICLI IN FIA-FLD
               MOVE DBC-VRF-ICLI IN DBC TO FRM-VRF-ICLI IN FIA-FLD
               MOVE DBC-IND-ICLI IN DBC TO FRM-IND-ICLI IN FIA-FLD
               MOVE DBC-GLS-ICLI IN DBC TO FRM-GLS-ICLI IN FIA-FLD
               MOVE DBC-CAI-ICLI IN DBC TO FIA-CAI-ICLI IN FIA
               MOVE DBC-IIC-ICLI IN DBC TO FIA-IIC-ICLI IN FIA.
       FIN-BUS-NMB-CIC-DEU.
           EXIT.

       BUS-NMB-CIC-FIA SECTION.
       INI-BUS-NMB-CIC-FIA.
      *NOM-CLI Busca Cliente por medio del Nombre
      *ALD
           MOVE SPACES TO DBC-GLS-NOMC IN DBC.
      *    UNSTRING FRM-GLS-NOMF IN FIA-FLD DELIMITED BY '/' INTO
      *                            DBC-GLS-APAT IN DBC
      *                            DBC-GLS-AMAT IN DBC
      *                            DBC-GLS-NOMB IN DBC.

           MOVE FRM-GLS-NOMF IN FIA-FLD TO STR-GLS-GSTR
           PERFORM STR-UNS
           MOVE STR-GLS-FUNS IN STR-VARI(1) TO DBC-GLS-APAT IN DBC
           MOVE STR-GLS-FUNS IN STR-VARI(2) TO DBC-GLS-AMAT IN DBC
           MOVE STR-GLS-FUNS IN STR-VARI(3) TO DBC-GLS-NOMB IN DBC.

           MOVE 'DBC-GLS-NOMC' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               MOVE ZEROES TO FRM-NUM-ICFS IN FIA-FLD
               MOVE SPACES TO FRM-VRF-ICFS IN FIA-FLD
               MOVE SPACES TO FRM-IND-ICFS IN FIA-FLD
               MOVE SPACES TO FRM-GLS-ICFS IN FIA-FLD
               MOVE 'DEU'          TO MSG-COD-SIST
               MOVE 'FRMNOMFNOSGC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT
           ELSE
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN            TO FRM-GLS-NOMF IN FIA-FLD
               MOVE DBC-NUM-ICLI IN DBC TO FRM-NUM-ICFS IN FIA-FLD
               MOVE DBC-VRF-ICLI IN DBC TO FRM-VRF-ICFS IN FIA-FLD
               MOVE DBC-IND-ICLI IN DBC TO FRM-IND-ICFS IN FIA-FLD
               MOVE DBC-GLS-ICLI IN DBC TO FRM-GLS-ICFS IN FIA-FLD
               MOVE DBC-CAI-ICLI IN DBC TO FIA-CAI-ICFS IN FIA
               MOVE DBC-IIC-ICLI IN DBC TO FIA-IIC-ICFS IN FIA.
       FIN-BUS-NMB-CIC-FIA.
           EXIT.

       BUS-IDC-CIC-DEU SECTION.
       INI-BUS-IDC-CIC-DEU.
           MOVE FRM-NUM-ICLI IN FIA-FLD TO DBC-NUM-ICLI IN DBC.
           MOVE FRM-IND-ICLI IN FIA-FLD TO DBC-IND-ICLI IN DBC.
           MOVE FRM-GLS-ICLI IN FIA-FLD TO DBC-GLS-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.
           IF FIO-STAT-OKS
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN            TO FRM-GLS-NOMC IN FIA-FLD
               MOVE DBC-CAI-ICLI IN DBC TO FIA-CAI-ICLI IN FIA
               MOVE DBC-IIC-ICLI IN DBC TO FIA-IIC-ICLI IN FIA
           ELSE
               MOVE 'DEU'          TO MSG-COD-SIST
               MOVE 'CICICLINOSGC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT.
       FIN-BUS-IDC-CIC-DEU.
           EXIT.

       BUS-IDC-CIC-FIA SECTION.
       INI-BUS-IDC-CIC-FIA.
           MOVE FRM-NUM-ICFS IN FIA-FLD TO DBC-NUM-ICLI IN DBC.
           MOVE FRM-IND-ICFS IN FIA-FLD TO DBC-IND-ICLI IN DBC.
           MOVE FRM-GLS-ICFS IN FIA-FLD TO DBC-GLS-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.
           IF FIO-STAT-OKS
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN            TO FRM-GLS-NOMF IN FIA-FLD
               MOVE DBC-CAI-ICLI IN DBC TO FIA-CAI-ICFS IN FIA
               MOVE DBC-IIC-ICLI IN DBC TO FIA-IIC-ICFS IN FIA
           ELSE
               MOVE 'DEU'          TO MSG-COD-SIST
               MOVE 'CICICFSNOSGC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT.
       FIN-BUS-IDC-CIC-FIA.
           EXIT.

       BUS-COR-FIA SECTION.
       INI-BUS-COR-FIA.
           MOVE 0 TO FIA-NUM-IFIA IN FIA-FLD.
           MOVE ESC-CAI-IESC IN ESC TO FIA-CAI-IESC IN FIA.
           MOVE ESC-IIC-IESC IN ESC TO FIA-IIC-IESC IN FIA.
           MOVE 99                  TO FIA-NUM-IFIA IN FIA.
           MOVE FIA-CIC-IESC IN FIA TO WSS-CIC-IESC.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM DEU-FIO-FIA.
           IF FIO-STAT-OKS AND WSS-CIC-IESC = FIA-CIC-IESC IN FIA
               MOVE FIA-NUM-IFIA IN FIA TO FIA-NUM-IFIA IN FIA-FLD.
           IF SCR-CCPP = 'ING' OR 'ACT'
               ADD 1 TO FIA-NUM-IFIA IN FIA-FLD.
       FIN-BUS-COR-FIA.
           EXIT.

       BUS-COR-AMF SECTION.
       INI-BUS-COR-AMF.
           MOVE 0 TO AMF-NUM-IAMF IN FIA-FLD.
           MOVE ESC-CAI-IESC IN ESC TO AMF-CAI-IESC IN AMF.
           MOVE ESC-IIC-IESC IN ESC TO AMF-IIC-IESC IN AMF.
           MOVE FIA-NUM-IFIA IN FIA TO AMF-NUM-IFIA IN AMF.
           MOVE 99                  TO AMF-NUM-IAMF IN AMF.
           MOVE AMF-KEY-IFIA IN AMF TO WSS-KEY-IFIA.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM DEU-FIO-AMF.
           IF FIO-STAT-OKS AND WSS-KEY-IFIA = AMF-KEY-IFIA IN AMF
               MOVE AMF-NUM-IAMF IN AMF TO AMF-NUM-IAMF IN FIA-FLD.
           IF SCR-CCPP = 'ING' OR 'ACT'
               ADD 1 TO AMF-NUM-IAMF IN FIA-FLD.
       FIN-BUS-COR-AMF.
           EXIT.

*% IF PGM_CHI AND PGM_BCI AND PGM_PU
      *PVC-INI 22-SEP-2010  GENERE NUMERO DE FIANZA                     
       GENERA-FIA SECTION.
       INI-GENERA-FIA.
       LUP-FIA.
           MOVE 'N' TO WSS-ACIC.                                        
           MOVE CIC-CAI-ICIC TO ESC-CAI-IESC IN ESC.
           MOVE CIC-NUM-ICIC TO ESC-IIC-IESC IN ESC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DEU-FIO-ESC.
           IF NOT FIO-STAT-OKS
               MOVE CIC-CAI-ICIC TO ESC-CAI-IESC IN FIA-FLD             
               MOVE CIC-NUM-ICIC TO ESC-IIC-IESC IN FIA-FLD             
               MOVE 'S' TO WSS-ACIC                                     
               GO TO FIN-GENERA-FIA.
           MOVE CIC-GET TO CIC-CMND.                                    
           PERFORM PRO-CIC.                                             
           IF CIC-STAT NOT = CIC-STAT-OKS                               
               MOVE CIC-MENS TO FRM-MENS                                
               MOVE FIO-STAT-NEX TO FIO-STAT                            
               GO TO FIN-GENERA-FIA
           ELSE
               GO TO LUP-FIA.
       FIN-GENERA-FIA.
           EXIT.
      *PVC-FIN 22-SEP-2010  
      *>>>> EOF
*% END

       MOD-ESC-FIA SECTION.
       INI-MOD-ESC-FIA.
           PERFORM KEY-ESC-FIA.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DEU-FIO-ESC.
           IF NOT FIO-STAT-OKS
*% IF PGM_CHI AND PGM_BCI AND PGM_PU
      *ALD-BCI-INI                                                      
               MOVE SPACES TO ESC                                       
               PERFORM KEY-ESC-FIA                                      
      *ALD-BCI-FIN  
*% END
               PERFORM RET-ESC-FIA
               MOVE FIO-PUT TO FIO-CMND
               PERFORM GET-FHOY
               MOVE HOY-DHOY TO ESC-NUM-DINP IN ESC
               MOVE HOY-MHOY TO ESC-NUM-MINP IN ESC
               MOVE HOY-SHOY TO ESC-NUM-SINP IN ESC
               MOVE HOY-AHOY TO ESC-NUM-AINP IN ESC
           ELSE
               PERFORM RET-ESC-FIA
               PERFORM GET-FHOY
               MOVE FIO-MOD TO FIO-CMND.
           MOVE HOY-STP-ITRN TO ESC-STP-ITRN IN ESC.
           PERFORM DEU-FIO-ESC.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-MOD-ESC-FIA.
       CON-MOD-FIA.
           PERFORM KEY-FIA-FIA.
           IF FIA-NUM-IFIA IN FIA NOT > ZEROES
               GO TO FIN-MOD-ESC-FIA.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DEU-FIO-FIA.
           IF NOT FIO-STAT-OKS
               PERFORM RET-FIA-FIA
               IF FIA-MSC-TVLF IN FIA-FLD NOT > SPACES AND
                  FIA-COD-TOFS IN FIA-FLD NOT > SPACES AND
                  FIA-VAL-LIMF IN FIA-FLD NOT > ZEROES AND
                  FIA-COD-VCLF IN FIA-FLD NOT > SPACES AND
                  FIA-FEC-FVEN IN FIA-FLD NOT > ZEROES AND
                  FIA-CAI-ICLI IN FIA-FLD NOT > SPACES AND
                  FIA-IIC-ICLI IN FIA-FLD NOT > SPACES AND
                  FIA-CAI-ICFS IN FIA-FLD NOT > SPACES AND
                  FIA-IIC-ICFS IN FIA-FLD NOT > SPACES
                   GO TO FIN-MOD-ESC-FIA
               ELSE
*% IF PGM_CHI AND PGM_BCI AND PGM_PU
      *ALD-BCI-INI                                                      
                  MOVE SPACES TO FIA                                    
                  PERFORM KEY-FIA-FIA                                   
                  PERFORM RET-FIA-FIA                                   
      *ALD-BCI-INI 
*% END
                   MOVE FIO-PUT TO FIO-CMND
                   MOVE ZEROES TO FIA-FEC-FSOL IN FIA
                   MOVE ZEROES TO FIA-FEC-FAUT IN FIA
                   MOVE ZEROES TO FIA-FEC-FALZ IN FIA
                   MOVE ZEROES TO FIA-FEC-FOUT IN FIA
                   MOVE SPACES TO FIA-COD-RAUT IN FIA
                   MOVE SPACES TO FIA-COD-ABOA IN FIA
           ELSE
               PERFORM RET-FIA-FIA
               MOVE FIO-MOD TO FIO-CMND.
           MOVE HOY-STP-ITRN TO FIA-STP-ITRN IN FIA.
           PERFORM DEU-FIO-FIA.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS.
       FIN-MOD-ESC-FIA.
           EXIT.

       CLR-ESC SECTION.
       INI-CLR-ESC.
           MOVE SPACES TO ESC-COD-OFEF IN ESC.
           MOVE SPACES TO ESC-FEC-FCTT IN ESC.
           MOVE SPACES TO ESC-COD-NOTC IN ESC.
           MOVE SPACES TO ESC-COD-RCTT IN ESC.
           MOVE SPACES TO ESC-COD-ABOC IN ESC.
       FIN-CLR-ESC.
           EXIT.

       CLR-FIA SECTION.
       INI-CLR-FIA.
           MOVE ZEROES TO FIA-NUM-IFIA IN FIA.
           MOVE SPACES TO FIA-MSC-TVLF IN FIA.
           MOVE SPACES TO FIA-COD-TOFS IN FIA.
           MOVE ZEROES TO FIA-VAL-LIMF IN FIA.
           MOVE SPACES TO FIA-COD-VCLF IN FIA.
           MOVE SPACES TO FIA-FEC-FVEN IN FIA.
           MOVE SPACES TO FIA-CAI-ICLI IN FIA.
           MOVE SPACES TO FIA-IIC-ICLI IN FIA.
           MOVE SPACES TO FIA-CAI-ICFS IN FIA.
           MOVE SPACES TO FIA-IIC-ICFS IN FIA.
       FIN-CLR-FIA.
           EXIT.

       CLR-AMF SECTION.
       INI-CLR-AMF.
           MOVE ZEROES TO AMF-NUM-IAMF IN AMF.
           MOVE SPACES TO AMF-MSC-TVOA IN AMF.
           MOVE SPACES TO AMF-COD-TOOA IN AMF.
           MOVE SPACES TO AMF-COD-OFOA IN AMF.
           MOVE SPACES TO AMF-CAI-IOCA IN AMF.
           MOVE ZEROES TO AMF-IIC-IOCA IN AMF.
           MOVE SPACES TO AMF-COD-VCOA IN AMF.
           MOVE SPACES TO AMF-COD-AOOA IN AMF.
           MOVE SPACES TO AMF-COD-CDOA IN AMF.
           MOVE ZEROES TO AMF-VAL-LIMA IN AMF.
           MOVE SPACES TO AMF-COD-VCLA IN AMF.
           MOVE SPACES TO AMF-IND-TDEU IN AMF.
       FIN-CLR-AMF.
           EXIT.

       PUT-DBC-FIA SECTION.
       INI-PUT-DBC-FIA.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN            TO FRM-GLS-NOMF IN FIA-FLD.
           MOVE DBC-NUM-ICLI IN DBC TO FRM-NUM-ICFS IN FIA-FLD.
           MOVE DBC-IND-ICLI IN DBC TO FRM-IND-ICFS IN FIA-FLD.
           MOVE DBC-VRF-ICLI IN DBC TO FRM-VRF-ICFS IN FIA-FLD.
           MOVE DBC-GLS-ICLI IN DBC TO FRM-GLS-ICFS IN FIA-FLD.
       FIN-PUT-DBC-FIA.
           EXIT.

       PUT-DBC-DEU SECTION.
       INI-PUT-DBC-DEU.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN            TO FRM-GLS-NOMC IN FIA-FLD.
           MOVE DBC-NUM-ICLI IN DBC TO FRM-NUM-ICLI IN FIA-FLD.
           MOVE DBC-IND-ICLI IN DBC TO FRM-IND-ICLI IN FIA-FLD.
           MOVE DBC-VRF-ICLI IN DBC TO FRM-VRF-ICLI IN FIA-FLD.
           MOVE DBC-GLS-ICLI IN DBC TO FRM-GLS-ICLI IN FIA-FLD.
       FIN-PUT-DBC-DEU.
           EXIT.

       SET-MSG SECTION.
       INI-SET-MSG.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE '00' TO FIO-STAT.
           MOVE SCR-STAT-CON TO SCR-STAT.
       FIN-SET-MSG.
           EXIT.

       LEE-NXT-PRV-ESC SECTION.
       INI-LEE-NXT-PRV-ESC.
           MOVE SPACES TO MSG-COD-MENS.
           IF SCR-FIA-REQA > SPACES
               PERFORM LEE-NXT-PRV-FIA
           ELSE
               MOVE 'FIANO' TO MSG-COD-MENS.
       FIN-LEE-NXT-PRV-ESC.
           EXIT.

       LEE-NXT-PRV-FIA SECTION.
       INI-LEE-NXT-PRV-FIA.
           MOVE SCR-FIA-REQA TO ADR-FIA-REQA.
           MOVE ADR-VKEY IN ADR-FIA-REQA TO WSS-CIC-ICLI IN WSS-VARI.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           IF FRM-FFLD = FRM-FFLD-PF5
               MOVE FIO-GET-PRV TO FIO-CMND
           ELSE
               MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DEU-FIO-FIA.
           IF FIO-STAT-OKS AND SCR-KEY-IFIA = 'DEU' AND
              FIA-CIC-ICLI IN FIA = WSS-CIC-ICLI IN WSS-VARI
               MOVE '00' TO PGM-STAT-FIA
               MOVE ADR-FIA-REQA TO SCR-FIA-REQA
               MOVE 'FIASI' TO MSG-COD-MENS
               GO TO FIN-LEE-NXT-PRV-FIA.
           IF FIO-STAT-OKS AND SCR-KEY-IFIA = 'FIA' AND
              FIA-CIC-ICFS IN FIA = WSS-CIC-ICLI IN WSS-VARI
               MOVE '00' TO PGM-STAT-FIA
               MOVE ADR-FIA-REQA TO SCR-FIA-REQA
               MOVE 'FIASI' TO MSG-COD-MENS
               GO TO FIN-LEE-NXT-PRV-FIA.
           IF FIO-STAT-OKS AND SCR-KEY-IFIA = 'ESC' AND
              FIA-CIC-IESC IN FIA = WSS-CIC-ICLI IN WSS-VARI
               MOVE '00' TO PGM-STAT-FIA
               MOVE ADR-FIA-REQA TO SCR-FIA-REQA
               MOVE 'FIASI' TO MSG-COD-MENS
               GO TO FIN-LEE-NXT-PRV-FIA.
           MOVE 'FIANO' TO MSG-COD-MENS.
       FIN-LEE-NXT-PRV-FIA.
           EXIT.

       LEE-NXT-PRV SECTION.
       INI-LEE-NXT-PRV.
           MOVE SPACES TO MSG-COD-MENS.
           IF SCR-DBC-REQA > SPACES
               PERFORM LEE-NXT-PRV-DBC
           ELSE
               PERFORM LEE-NXT-PRV-NOM.
       FIN-LEE-NXT-PRV.
           EXIT.

       LEE-NXT-PRV-DBC SECTION.
       INI-LEE-NXT-PRV-DBC.
           MOVE SCR-DBC-REQA TO ADR-DBC-REQA.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           IF FRM-FFLD = FRM-FFLD-PF7
               MOVE FIO-GET-PRV TO FIO-CMND
           ELSE
               MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE 'DBC-GLS-NOMC' TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.
           IF FIO-STAT-OKS
               MOVE ADR-DBC-REQA TO SCR-DBC-REQA.
       FIN-LEE-NXT-PRV-DBC.
           EXIT.

       LEE-NXT-PRV-NOM SECTION.
       INI-LEE-NXT-PRV-NOM.
           MOVE 'DEU' TO SCR-KEY-IDBC.
           MOVE FRM-GLS-NOMC IN FIA-FLD TO DBC-GLS-NOMC IN DBC.
           IF FRM-GLS-NOMF IN FIA-FLD > SPACES
               MOVE 'FIA' TO SCR-KEY-IDBC 
               MOVE FRM-GLS-NOMF IN FIA-FLD TO DBC-GLS-NOMC IN DBC.
           IF FRM-GLS-NOMC IN FIA-FLD > SPACES
               MOVE 'DEU' TO SCR-KEY-IDBC
               MOVE FRM-GLS-NOMC IN FIA-FLD TO DBC-GLS-NOMC IN DBC.
           IF DBC-GLS-NOMC IN DBC > SPACES
               MOVE FIO-GET-KEY    TO FIO-CMND
               MOVE 'DBC-GLS-NOMC' TO FIO-AKEY
               PERFORM SGC-FIO-DBC
               IF FIO-STAT-OKS
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE FIO-GET-PRV TO FIO-CMND
                   ELSE
                       MOVE FIO-GET-NXT TO FIO-CMND
               ELSE
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE FIO-GET-LEQ TO FIO-CMND
                   ELSE
                       MOVE FIO-GET-NLS TO FIO-CMND
           ELSE
               IF FRM-FFLD = FRM-FFLD-PF7
                   MOVE FIO-GET-LEQ TO FIO-CMND
               ELSE
                   MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'DBC-GLS-NOMC' TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.
           IF FIO-STAT-OKS
               MOVE ADR-DBC-REQA TO SCR-DBC-REQA.
       FIN-LEE-NXT-PRV-NOM.
           EXIT.

       NXT-PRV-ESC SECTION.
       INI-NXT-PRV-ESC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DEU-FIO-ESC.
           IF FRM-FFLD = FRM-FFLD-PF7
               MOVE FIO-GET-PRV TO FIO-CMND
           ELSE
               MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DEU-FIO-ESC.
           MOVE FIO-STAT TO PGM-STAT-ESC.
       FIN-NXT-PRV-ESC.
           EXIT.

       COPY DEUBFESC.
       COPY DEUBFFIA.
       COPY GNSBBMSC.
       COPY GNSBEGLS.
       COPY GNSBGCPT.
       COPY GNSBGSTR.
       COPY GNSBGCIC.
       COPY GNSBFCIC.
       COPY SGCBFDBC.

*% IF PGM_CHI AND PGM_BCI AND PGM_PU
      *LOP-INI 6-DIC-2002                                               
       COPY LDCBKCEG.                                                   
       COPY LDCBKCCU.                                                   
       COPY LDCBGCC1.                                                   
       COPY LDCBFCLF.                                                   
       COPY LDCBFRDC REPLACING RDC BY RDL.                              
       COPY DEUBGMAR.                                                   
       COPY LDCBGCCU.                                                   
      *LOP-FIN 6-DIC-2002                                               
      *AFRI-INI 05-MAY-2015 LIMITE DE CREDITO SEGUN ARTICULO 84
       COPY LDCBKMAR.
      *AFRI-FIN 05-MAY-2015 LIMITE DE CREDITO SEGUN ARTICULO 84
*% END
*% IF PGM_CHI AND PGM_BCI AND PGM_PQ
      *OGB-INI 25-FEB-2016 FIANZAS FASE I
      *----------------------------------------------------------
      * REVISA FECHA DE VENCIMIENTO VS FHOY Y DESPLIEGA MENSAJE
      *----------------------------------------------------------
       CHK-FEC-FVEN SECTION.
       INI-CHK-FEC-FVEN.

            IF (SCR-CMND = WSS-CT-ING OR WSS-CT-INC) AND
                FIA-MSC-STAT IN FIA NOT = WSS-CT-S
                GO TO FIN-CHK-FEC-FVEN.

      *FIA ACTIVADA Y SIN FECHA DE VENCIMIENTO
           IF FIA-MSC-STAT IN FIA = WSS-CT-S
              IF FIA-NUM-SVEN IN FIA NOT > ZEROES
                 MOVE WSS-CT-DEU       TO MSG-COD-SIST
                 MOVE WSS-CT-VIGNFVCTO TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO WSS-GLS-MENS
                 MOVE WSS-CT-C00   TO FIO-STAT
                 GO TO FIN-CHK-FEC-FVEN.

      *FIA NO ACTIVADA Y SIN FECHA DE VENCIMIENTO
           IF FIA-MSC-STAT IN FIA NOT = WSS-CT-S
              IF FIA-NUM-SVEN IN FIA NOT > ZEROES
                 MOVE WSS-CT-DEU       TO MSG-COD-SIST
                 MOVE WSS-CT-NOACTINF  TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO WSS-GLS-MENS
                 MOVE WSS-CT-C00   TO FIO-STAT
                 GO TO FIN-CHK-FEC-FVEN.

      *FIA ACTIVADA Y FEC VEN < FHOY (VENCIDA)
           IF FIA-MSC-STAT IN FIA = WSS-CT-S
              PERFORM GET-FHOY
              IF HOY-FHOY > FIA-FEC-FVEN IN FIA
                 MOVE WSS-CT-DEU     TO MSG-COD-SIST
                 MOVE WSS-CT-FIAVCDA TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO WSS-GLS-MENS
                 MOVE WSS-CT-C00   TO FIO-STAT
                 GO TO FIN-CHK-FEC-FVEN
      *FIA ACTIVADA Y FEC VEN = FHOY (CON FEC VCTO)
              ELSE
              IF HOY-FHOY = FIA-FEC-FVEN IN FIA
                 MOVE WSS-CT-DEU         TO MSG-COD-SIST
                 MOVE WSS-CT-AFVCTOHOY   TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO WSS-GLS-MENS
                 MOVE WSS-CT-C00   TO FIO-STAT
                 GO TO FIN-CHK-FEC-FVEN
      *FIA ACTIVADA Y FEC VEN > FHOY (CON FEC VCTO)
              ELSE
                 MOVE WSS-CT-DEU        TO MSG-COD-SIST
                 MOVE WSS-CT-AFVCTOFUT  TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO WSS-GLS-MENS
                 MOVE WSS-CT-C00   TO FIO-STAT
                 GO TO FIN-CHK-FEC-FVEN
           ELSE
      *FIA NO ACTIVADA Y FEC VEN < FHOY (VENCIDA)
              PERFORM GET-FHOY
              IF HOY-FHOY > FIA-FEC-FVEN IN FIA
                 MOVE WSS-CT-DEU       TO MSG-COD-SIST
                 MOVE WSS-CT-NOACTVCDA TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO WSS-GLS-MENS
                 MOVE WSS-CT-C00   TO FIO-STAT
                 GO TO FIN-CHK-FEC-FVEN
      *FIA NO ACTIVADA Y FEC VEN = FHOY (VENCE HOY)
              ELSE
              IF HOY-FHOY = FIA-FEC-FVEN IN FIA
                 MOVE WSS-CT-DEU        TO MSG-COD-SIST
                 MOVE WSS-CT-NOACTFECH  TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO WSS-GLS-MENS
                 MOVE WSS-CT-C00   TO FIO-STAT
                 GO TO FIN-CHK-FEC-FVEN
      *FIA NO ACTIVADA Y FEC VEN > FHOY (VENCE FUTURO)
              ELSE
              IF HOY-FHOY < FIA-FEC-FVEN IN FIA
                 MOVE WSS-CT-DEU        TO MSG-COD-SIST
                 MOVE WSS-CT-NOACTFECF  TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO WSS-GLS-MENS
                 MOVE WSS-CT-C00   TO FIO-STAT
                 GO TO FIN-CHK-FEC-FVEN.
       FIN-CHK-FEC-FVEN.
           EXIT.
      *OGB-FIN 25-FEB-2016 FIANZAS FASE I
*% END
      *>>>>
*% END
*% IF EOF_PQ
      *<<<< EOF_PQ
       RET-FIA-FIA SECTION.
       INI-RET-FIA-FIA.
           MOVE FIA-MSC-TVLF IN FIA-FLD TO FIA-MSC-TVLF IN FIA.
           MOVE FIA-COD-TOFS IN FIA-FLD TO FIA-COD-TOFS IN FIA.
           MOVE FIA-VAL-LIMF IN FIA-FLD TO FIA-VAL-LIMF IN FIA.
           MOVE FIA-COD-VCLF IN FIA-FLD TO FIA-COD-VCLF IN FIA.
           MOVE FIA-NUM-DVEN IN FIA-FLD TO FIA-NUM-DVEN IN FIA.
           MOVE FIA-NUM-MVEN IN FIA-FLD TO FIA-NUM-MVEN IN FIA.
           MOVE FIA-NUM-SVEN IN FIA-FLD TO FIA-NUM-SVEN IN FIA.
           MOVE FIA-NUM-AVEN IN FIA-FLD TO FIA-NUM-AVEN IN FIA.
           MOVE FIA-MSC-STAT IN FIA-FLD TO FIA-MSC-STAT IN FIA.
           MOVE FIA-CAI-ICLI IN FIA-FLD TO FIA-CAI-ICLI IN FIA.
           MOVE FIA-IIC-ICLI IN FIA-FLD TO FIA-IIC-ICLI IN FIA.
           MOVE FIA-CAI-ICFS IN FIA-FLD TO FIA-CAI-ICFS IN FIA.
           MOVE FIA-IIC-ICFS IN FIA-FLD TO FIA-IIC-ICFS IN FIA.
      *<<<< FIN_RET_FIA_FIA OR FIN_KEY_FIA_FIA
           MOVE ESC-CAI-IESC IN FIA-FLD TO FIA-CAI-IESC IN FIA.
           MOVE ESC-IIC-IESC IN FIA-FLD TO FIA-IIC-IESC IN FIA.
      *>>>>
       FIN-RET-FIA-FIA.
           EXIT.
       
       RET-ESC-FIA SECTION.
       INI-RET-ESC-FIA.
           MOVE ESC-COD-OFEF IN FIA-FLD TO ESC-COD-OFEF IN ESC.
           MOVE ESC-NUM-DCTT IN FIA-FLD TO ESC-NUM-DCTT IN ESC.
           MOVE ESC-NUM-MCTT IN FIA-FLD TO ESC-NUM-MCTT IN ESC.
           MOVE ESC-NUM-SCTT IN FIA-FLD TO ESC-NUM-SCTT IN ESC.
           MOVE ESC-NUM-ACTT IN FIA-FLD TO ESC-NUM-ACTT IN ESC.
           MOVE ESC-COD-NOTC IN FIA-FLD TO ESC-COD-NOTC IN ESC.
           MOVE ESC-COD-RCTT IN FIA-FLD TO ESC-COD-RCTT IN ESC.
           MOVE ESC-COD-ABOC IN FIA-FLD TO ESC-COD-ABOC IN ESC.
       FIN-RET-ESC-FIA.
           EXIT.
       
       PRO-FLD-FIA SECTION.
       INI-PRO-FLD-FIA.
           PERFORM PRO-FIA-FIA.
           PERFORM PRO-ESC-FIA.
           PERFORM PRO-AMF-FIA.
       FIN-PRO-FLD-FIA.
           EXIT.
       
       PRO-FIA-FIA SECTION.
       INI-PRO-FIA-FIA.
           MOVE FRM-CPIM-AEY TO FIA-COD-TOFS-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO FIA-VAL-LIMF-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO FIA-COD-VCLF-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO FIA-FEC-FVEN-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO FIA-MSC-STAT-ATR IN FIA-FLD.
       FIN-PRO-FIA-FIA.
           EXIT.
       
       PRO-ESC-FIA SECTION.
       INI-PRO-ESC-FIA.
           MOVE FRM-CPIM-AEY TO ESC-COD-OFEF-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO ESC-FEC-FCTT-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO ESC-COD-NOTC-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO ESC-COD-RCTT-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO ESC-COD-ABOC-ATR IN FIA-FLD.
       FIN-PRO-ESC-FIA.
           EXIT.
       
       PRO-AMF-FIA SECTION.
       INI-PRO-AMF-FIA.
           MOVE FRM-CPIM-AEY TO AMF-MSC-TVOA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-COD-TOOA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-COD-OFOA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-CAI-IOCA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-IIC-IOCA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-COD-VCOA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-COD-AOOA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-COD-CDOA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-VAL-LIMA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-COD-VCLA-ATR IN FIA-FLD.
           MOVE FRM-CPIM-AEY TO AMF-IND-TDEU-ATR IN FIA-FLD.
       FIN-PRO-AMF-FIA.
           EXIT.

      *>>>>
*% END
*% IF INI_SCR_EXIT
      *<<<< INI_SCR_EXIT
      *LOP-INI 12-12-2002                                               
           IF WSS-IND-ALZA IN WSS-VARI ='VRS'                           
              MOVE 'VRS' TO SCR-CMND.                                   
      *LOP-FIN 12-12-2002 

      *>>>> INI_SCR_EXIT
*% END
*% IF PFS_SCR_GFLD
      *<<<< PFS_SCR_GFLD
      *     IF NOT ((SCR-CCPP = 'MOD' OR  SCR-CCPP = 'ACC' OR            
      *              SCR-CCPP = 'ELI'                      OR            
      *             (SCR-CCPP = 'ACT' AND SCR-ACTU = SCR-ACTU-MOD)) AND  
      *             (FRM-FFLD = FRM-FFLD-PF8 OR                          
      *              FRM-FFLD = FRM-FFLD-PF7 OR                          
      *              FRM-FFLD = FRM-FFLD-PF5 OR                          
      *              FRM-FFLD = FRM-FFLD-PF6))  
      *>>>> PFS_SCR_GFLD
*% END
*% IF PFS_SCR_MOD
      *<<<< PFS_SCR_MOD
*% IF PGM_PQ
           IF (FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR               
                          FRM-FFLD-PF7 OR FRM-FFLD-PF8) AND             
               SCR-STAT = SCR-STAT-CON                                  
               PERFORM VAL-NUM-KEY-FIA                                  
               PERFORM VAL-NUM-FLD-FIA.                                 
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR                
                         FRM-FFLD-PF7 OR FRM-FFLD-PF8                   
               PERFORM RST-STAT                                         
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY                     
               IF SCR-STAT NOT = SCR-STAT-ABT                           
                   PERFORM SCR-TRL                                      
               ELSE                                                     
                   PERFORM GNS-CLR-RQA                                  
                   PERFORM DESSCRTRL                                    
                   GO TO FIN-SCR-MOD.                                   
           PERFORM GNS-CLR-RQA. 
*% END
      *>>>> PFS_SCR_MOD
*% END
*% IF EXIT_SCR AND PGM_PQ
      *<<<< EXIT_SCR
      *LOP-INI 12-12-2002                                               
           IF WSS-IND-ALZA IN WSS-VARI ='VRS'                           
              MOVE 'VRS' TO SCR-CMND.                                   
      *LOP-FIN 12-12-2002
      *>>>> EXIT_SCR
*% END
