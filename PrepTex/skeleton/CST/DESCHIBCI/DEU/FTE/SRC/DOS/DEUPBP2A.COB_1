       IDENTIFICATION DIVISION.
       PROGRAM-ID. DEUPBP2A.
       AUTHOR. P.JELDRES.
      *REMARKS. PAREA EL MAESTRO DE CUENTA 2A V/S
      *         TABLA OPC DE LA BASE DE DATOS 160.
      *         COMPARA LOS SALDOS,SI SON DIFERENTES IMPRIME
      *         EL REGISTRO.
      *         TAMBIEN DETECTA LOS QUE NO EXISTEN EN UNO U OTRO
      *         ARCHIVO.
      *         SEGUN PARAMETRO GRABA TABLA CAN 170 CON
      *         CANCELACION TOTAL EN EL CASO EN QUE NO EXISTA EN
      *         EL MAESTRO.
      ******************************************************************
      *  INTERSOFT                                                     *
      *  MIGRACION A COBOL OS/390                                      *
      *  FECHA: 30 DE MARZO DE 1998                                    *
      ******************************************************************
      *---------------------------------------------------------------*
      * MODIFICACION : ACTUALIZAR CAMPO OPC-MSC-STAT CON "E" EN TABLA *
      *                OPC-160 PARA LAS OPERACIONES QUE NO EXISTAN EN *
      *                EL ARCHIVO MAESTRO            ODONOSO 13/04/92 *
      *---------------------------------------------------------------*
      * MODIFICACION : SE CORRIGE MANTENCION ANTERIOR, PARA CONSIDERAR*
      *                ADEMAS QUE LA OPERACION EN LA TABLA OPC NO ESTE*
      *                YA EN ESTADO "E"                               *
      *                SEGUN PARAMETRO GRABA TABLA CAN 170 CON        *
      *                CANCELACION TOTAL EN EL CASO EN QUE NO EXISTA  *
      *                EN EL MAESTRO.                ODONOSO 30/04/92 *
      *---------------------------------------------------------------*
      ******************************************************************
      *      MANTENCIONES.
      *      ==============
      *
      *      PROGRAMADOR : FORMAT 2000 INC.
      *      FECHA       : 20.02.1998
      *      CAMBIO      : SE APLICA TECNICA WINDOWING PARA CONVERSION
      *                      2000 COMPLIANT.
      ******************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.

       SPECIAL-NAMES.
           C01 IS CANAL-1
           DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT CT2A            ASSIGN TO        CT2A
                                  ORGANIZATION IS INDEXED
                                  ACCESS IS SEQUENTIAL
                                  RECORD KEY IS ESPLI-KEY
                                  FILE STATUS IS FS-CT2A.

           SELECT LISTADO ASSIGN TO SYS020-UR-1403-S-LISTADO.

       DATA DIVISION.
       FILE SECTION.

       FD  LISTADO
           LABEL RECORD OMITTED
           RECORD CONTAINS 133 CHARACTERS.

       01  LINEA PIC X(133).

       FD  CT2A
      *    LARGO DE REGISTRO CABEZA 167 BYTES
      *    LARGO DE REGISTRO DE COLA 50 BYTES
      *    NUMERO MAXIMO DE COLAS 37
           BLOCK CONTAINS 175 TO 2048 CHARACTERS
           RECORD CONTAINS 167 TO 2017 CHARACTERS
           LABEL RECORD STANDARD.
       01  REG-ESPLINEA.
           05 ESPLI-CABEZA.
              10 ESPLI-SIZE               PIC X(1).
              10 ESPLI-IDENT              PIC X(1).
              10 ESPLI-KEY                PIC X(6).
              10 ESPLI-CUENTA REDEFINES ESPLI-KEY.
                 15 ESPLI-SUC             PIC X(2).
                 15 ESPLI-CTA             PIC X(4).
              10 ESPLI-DATE               PIC X(3).
              10 ESPLI-LASTJ              PIC X(4).
              10 ESPLI-LASTT              PIC X(2).
              10 ESPLI-STATS.
                 15 BYTE-UNO              PIC X(1).
                 15 BYTE-DOS              PIC X(1).
              10 ESPLI-MISC               PIC X(3).
              10 ESPLI-MTO-LINEACRED      PIC S9(9)V99     COMP-3.
              10 ESPLI-SDO-DEUDOR         PIC S9(9)V99     COMP-3.
              10 ESPLI-ABONOS-DIA-SINT    PIC S9(9)V99     COMP-3.
              10 ESPLI-ABONOS-CBZA        PIC S9(9)V99     COMP-3.
              10 ESPLI-ABONOS-ANT-DIA     PIC S9(9)V99     COMP-3.
              10 ESPLI-MICRF              PIC X(4).
              10 ESPLI-SDO-ACREEDOR       PIC S9(9)V99     COMP-3.
              10 ESPLI-SDO-ACREDOR1       PIC S9(9)V99     COMP-3.
              10 ESPLI-SDO-ACREDOR2       PIC S9(9)V99     COMP-3.
              10 ESPLI-RUT-DEU-DIR        PIC X(6).
              10 ESPLI-RUT-DEU-IND        PIC X(6).
              10 ESPLI-NRO-CTA-CTE        PIC X(6).
              10 ESPLI-NRO-CTA-CTE-R REDEFINES ESPLI-NRO-CTA-CTE.
                 15 ESPLI-IMPUTACION      PIC X(2).
                 15 ESPLI-CTA-CTE         PIC X(4).
              10 ESPLI-FEC-APERTURA-CTA   PIC X(3).
              10 ESPLI-TOT-INT-ANT        PIC S9(9)V99     COMP-3.
              10 ESPLI-TOT-NUM            PIC S9(11)V99    COMP-3.
              10 ESPLI-TOT-INT            PIC S9(9)V99     COMP-3.
              10 ESPLI-TOT-IMP            PIC S9(9)V99     COMP-3.
              10 ESPLI-ABONOS             PIC S9(9)V99     COMP-3.
              10 ESPLI-FULT-ABONO-CBZA    PIC X(3).
              10 ESPLI-FULT-CARGO-CC      PIC X(3).
              10 ESPLI-FULT-ABONO-CC      PIC X(3).
              10 ESPLI-FEC-VCTO-CTA       PIC X(3).
              10 ESPLI-SDO-PROM-MES-1     PIC S9(9)V99     COMP-3.
              10 ESPLI-SDO-PROM-MES-2     PIC S9(9)V99     COMP-3.
              10 ESPLI-SDO-PROM-MES-3     PIC S9(9)V99     COMP-3.
              10 FILLER                   PIC X(3).
              10 ESPLI-NRO-OPER           PIC 9(3)         COMP-3.
              10 ESPLI-CODIGO             PIC X(4).
              10 ESPLI-NRO-AVANCES        PIC 9(3)         COMP-3.
           05 ESPLI-AVANCES               OCCURS 0 TO 37 TIMES
                                          DEPENDING ON NUM-COLAS-M.
              10 ESPLI-LARGO              PIC X(1).
              10 ESPLI-IDENTIFICACION     PIC X(1).
              10 ESPLI-FECHA              PIC X(3).
              10 ESPLI-TERMINAL           PIC X(2).
              10 ESPLI-CAJERO             PIC X(1).
              10 ESPLI-LIBRE              PIC X(2).
              10 ESPLI-MONTO-CURSADO      PIC S9(9)V99     COMP-3.
              10 ESPLI-SDO-DEUDOR-AVAN    PIC S9(9)V99     COMP-3.
              10 ESPLI-NUM-AVAN           PIC S9(11)V99    COMP-3.
              10 ESPLI-INT-AVAN           PIC S9(9)V99     COMP-3.
              10 ESPLI-IMP-AVAN           PIC S9(9)V99     COMP-3.
              10 ESPLI-FCALC-NUMINT       PIC X(3).
              10 ESPLI-TAS-AVAN           PIC S9(3)V99     COMP-3.
              10 ESPLI-NRO-AVAN           PIC 9(3)         COMP-3.
              10 ESPLI-FILLER             PIC X(1).


       WORKING-STORAGE SECTION.
      *-----------------------
       77  FS-CT2A                   PIC 9(2)            VALUE ZEROES.
       77  LEIDOS                    PIC 9(9)            VALUE 0.
       77  REG-LEIDOS                PIC 9(9)            VALUE 0.
       77  LEIDOS-BD                 PIC 9(9)            VALUE 0.
       77  IGUALES                   PIC 9(9)            VALUE 0.
       77  VAL-IGUALES               PIC 9(9)            VALUE 0.
       77  VAL-DISTINTOS             PIC 9(9)            VALUE 0.
       77  ACTUALIZA-OPC             PIC 9(9)            VALUE 0.
       77  GRABADOS-CAN              PIC 9(9)            VALUE 0.
       77  REPETIDOS-CAN             PIC 9(9)            VALUE 0.
       77  CL                        PIC 99              VALUE 70.
       77  CP                        PIC 9(4)            VALUE 0.
       77  FIN-PGM                   PIC XX              VALUE 'NO'.
       77  SW-OPC                    PIC XXX             VALUE SPACES.
       77  VALOR-A                   PIC 9(12)V99.
       77  VALOR-B                   PIC 9(12)V99.

       01  AREAS-MANEJO-LARGOS.
      *    LARGO DE REGISTRO CABEZA 167 BYTES
      *    LARGO REGISTRO DE COLA    50 BYTES
      *    NUMERO DE MAXIMO DE COLAS 37
           05 NUM-COLAS-M            PIC 9(4) COMP     VALUE 37.
           05 PTR-COLAS              PIC 9(3) COMP-3   VALUE 0.
           05 LARGO-CABEZA.
              10 LARGO-CABE-DEC      PIC 9(4) COMP     VALUE 167.
           05 R-LARGO-CABEZA REDEFINES LARGO-CABEZA.
              10 FILLER              PIC X.
              10 LARGO-CAB-HEX       PIC X.

       01  TARJETA.
           05 FILLER      PIC X(18) VALUE 'GRABA TABLA CAN : '.
           05 OPCION-T    PIC X(02).
           05 FILLER      PIC X(01).
           05 FECHA-T.
              10 ANO-T    PIC X(02).
              10 MES-T    PIC X(02).
              10 DIA-T    PIC X(02).
           05 FILLER      PIC X(53).
       01  LLAVES.
           05 LLAVE-A.
              10 LLAVE-2A            PIC X(3).
              10 LLAVE-1A            PIC X(8).
           05 LLAVE-B.
              10 LLAVE-2B            PIC X(3).
              10 LLAVE-1B            PIC X(8).
           05 FECHA-HOY.
              10 AA-HOY PIC 99.
              10 MM-HOY PIC 99.
              10 DD-HOY PIC 99.
       01  CAMPOS-BCD.
           05 FEC-BCD.
              10 FECHA-BCD           PIC XXX.
              10 RFECHA-BCD REDEFINES FECHA-BCD.
                 15 R-DIA            PIC X.
                 15 R-MES            PIC X.
                 15 R-ANO            PIC X.
              10 FILLER              PIC 9 COMP-3 VALUE 0.
           05 RFEC-BCD REDEFINES FEC-BCD.
              10 FECHA-INT           PIC 9(6)V9 COMP-3.
           05 FECHA-EBCDIC           PIC 9(6).
           05 RFECHA-EBCDIC REDEFINES FECHA-EBCDIC.
              10 DIA-EBCDIC          PIC 99.
              10 MES-EBCDIC          PIC 99.
              10 ANO-EBCDIC          PIC 99.

           05 RUT-MAE                PIC X(6).
           05 FILLER REDEFINES RUT-MAE.
              10 RUT-BASE            PIC X(5).
              10 RUT-DV              PIC X.
           05 RUT-BCD.
              10 RUT-BCD-BASE        PIC X(5).
              10 FILLER-1            PIC 9 COMP-3 VALUE 0.
           05 RUT-COMP REDEFINES RUT-BCD PIC 9(11) COMP-3.
           05 RUT-EBCDIC             PIC 9(11).
           05 FILLER REDEFINES RUT-EBCDIC.
              10 FILLER              PIC 99.
              10 RUT-OK-EBCDIC       PIC 9(8).
              10 FILLER              PIC 9.

           05 WK-AREA-CTACTE-BCD.
              10 WK-CTACTE-BCD       PIC X(4).
              10 FILLER              PIC 9 COMP-3 VALUE 0.
           05 WK-AREA-CTACTE-EBCDIC REDEFINES WK-AREA-CTACTE-BCD.
              10 WK-CTACTE-DISP      PIC 9(8)V9 COMP-3.
           05 WK-CTACTE-EBCDIC       PIC 9(8).

           05 WK-AREA-OFIC-BCD.
              10 WK-OFIC-BCD         PIC XX.
              10 FILLER              PIC 9 COMP-3 VALUE 0.
           05 WK-AREA-OFIC-EBCDIC REDEFINES WK-AREA-OFIC-BCD.
              10 WK-OFIC-DISP        PIC 999V9 COMP-3.
           05 WK-OFIC-EBCDIC         PIC 999.


       01  TIT-1.
           05 FILLER PIC X(46) VALUE 'BANCO DE CREDITO E INVERSIONES'.
           05 FILLER PIC X(70) VALUE
              ' PAREADOR MAE. CUENTA 2A    V/S BASE DATOS 160'.
           05 FILLER PIC X(7) VALUE 'FECHA:'.
           05 T1-FECHA.
              10 T1-FECHA-DD    PIC X(2).
              10 FILLER         PIC X(1) VALUE '/'.
              10 T1-FECHA-MM    PIC X(2).
              10 FILLER         PIC X(1) VALUE '/'.
              10 T1-FECHA-AA    PIC X(2).
       01  TIT-2.
           05 FILLER PIC X(45) VALUE 'INTERFAZ COLOCACIONES'.
           05 FILLER PIC X(71) VALUE
              '-----------------------------------------------'.
           05 FILLER PIC X(7) VALUE 'PAG  :'.
           05 PAG-T1 PIC ZZZ9.
       01  RAYA PIC X(132) VALUE ALL '-'.
       01  ESPA PIC X(132) VALUE ALL SPACES.
       01  TIT-3.
           05 FILLER PIC XXX VALUE SPACES.
           05 FILLER PIC X(49)
              VALUE 'C L A V E       R U T       R U T     FECHA'.
           05 FILLER PIC X(49)
              VALUE 'FECHA   INDICA. INDICA.      MONTO'.
           05 FILLER PIC X(31)
              VALUE 'SALDO                SALDO'.

       01  TIT-4.
           05 FILLER PIC XXX VALUE SPACES.
           05 FILLER PIC X(49)
              VALUE '                D.D.        D.I.      CURSE'.
           05 FILLER PIC X(49)
              VALUE 'VCTO.   T.ACC.  STATUS    ORIGINAL'.
           05 FILLER PIC X(31)
              VALUE 'MAESTRO         BASE DATOS'.
       01  DETA-1.
           05 FILLER      PIC X VALUE SPACE.
           05 SUC-S       PIC XXXB.
           05 CLAVE-S     PIC X(8)BBB.
           05 RUTDD-S     PIC 9(9).
           05 FILLER      PIC X VALUE '-'.
           05 DVDD-S      PIC XBB.
           05 RUTDI-S     PIC 9(9).
           05 FILLER      PIC X VALUE '-'.
           05 DVDI-S      PIC X.
           05 FILLER      PIC X VALUE SPACE.
           05 DIAC-S      PIC 99.
           05 MESC-S      PIC 99.
           05 ANOC-S      PIC 99BB.
           05 DIAV-S      PIC 99.
           05 MESV-S      PIC 99.
           05 ANOV-S      PIC 99BBB.
           05 INDT-S      PIC XB(8).
           05 INDS-S      PIC XBBBB.
           05 MONTO-S     PIC ZZZZ.ZZZ.ZZ9,9999B.
           05 SALDOM-S    PIC ZZZZZ.ZZZ.ZZ9,9999B.
           05 SALDOB-S    PIC ZZZZZ.ZZZ.ZZ9,9999.

       01  DETA-2.
           05 FILLER      PIC X VALUE SPACE.
           05 CLAVE-2     PIC X(8)B.
           05 SUC-2       PIC XXXB(90).
           05 OBS-S       PIC X(28).

           EJECT
      *****************************************************************
      *          USER INFORMATION BLOCK
      *****************************************************************
       01  UIB.
           05 FILLER                 PIC X(32) VALUE 'DEUPBP2A'.
      *****************************************************************
      *           REQUEST AREA
      *****************************************************************
       01  REQ-AREA-OPC.
           03 OPC-COMMAND         PIC X(5).
           03 OPC-TABLE           PIC X(3)     VALUE 'OPC'.
           03 OPC-KEY             PIC X(5).
           03 OPC-RET-COD         PIC X(2)     VALUE SPACES.
           03 OPC-INT-RC          PIC X(1).
           03 OPC-DB-ID           PIC S9(4)    COMP VALUE +160.
           03 OPC-REC-ID          PIC X(7).
           03 FILLER              PIC X(25).
           03 OPC-CONT-MAX        PIC S9(4)    COMP.
           03 OPC-CONT-ID         PIC S9(4)    COMP.
           03 FILLER              PIC X(22).
           03 OPC-VALUE           PIC X(28).

       01  REQ-AREA-VEN.
           03 VEN-COMMAND         PIC X(5).
           03 VEN-TABLE           PIC X(3)     VALUE 'VEN'.
           03 VEN-KEY             PIC X(5).
           03 VEN-RET-COD         PIC X(2)     VALUE SPACES.
           03 VEN-INT-RC          PIC X(1).
           03 VEN-DB-ID           PIC S9(4)    COMP VALUE +160.
           03 VEN-REC-ID          PIC X(7).
           03 FILLER              PIC X(25).
           03 VEN-CONT-MAX        PIC S9(4)    COMP.
           03 VEN-CONT-ID         PIC S9(4)    COMP.
           03 FILLER              PIC X(22).
           03 VEN-VALUE           PIC X(40).

       01  REQ-AREA-CAN.
           03 CAN-COMMAND         PIC X(5).
           03 CAN-TABLE           PIC X(3)     VALUE 'CAN'.
           03 CAN-KEY             PIC X(5).
           03 CAN-RET-COD         PIC X(2)     VALUE SPACES.
           03 CAN-INT-RC          PIC X(1).
           03 CAN-DB-ID           PIC S9(4)    COMP VALUE +170.
           03 CAN-REC-ID          PIC X(7).
           03 FILLER              PIC X(25).
           03 CAN-CONT-MAX        PIC S9(4)    COMP.
           03 CAN-CONT-ID         PIC S9(4)    COMP.
           03 FILLER              PIC X(22).
           03 CAN-VALUE           PIC X(28).

       01  REQ-AREA-CAN-160.
           03 CAN-COMMAND-160     PIC X(5).
           03 CAN-TABLE-160       PIC X(3)     VALUE 'CAN'.
           03 CAN-KEY-160         PIC X(5).
           03 CAN-RET-COD-160     PIC X(2)     VALUE SPACES.
           03 CAN-INT-RC-160      PIC X(1).
           03 CAN-DB-ID-160       PIC S9(4)    COMP VALUE +160.
           03 CAN-REC-ID-160      PIC X(7).
           03 FILLER              PIC X(25).
           03 CAN-CONT-MAX-160    PIC S9(4)    COMP.
           03 CAN-CONT-ID-160     PIC S9(4)    COMP.
           03 FILLER              PIC X(22).
           03 CAN-VALUE-160.
              05 VALUE-12         PIC X(12).
              05 VALUE-3          PIC 9(03).
              05 FILLER           PIC X(25).
      ****************************************************************
      *                     WORK AREA
      ****************************************************************

       01  REG-OPC.
      *    COPYDD COL-R-OPC.COL-E-OPC00(PROD),01,D
      *                             EQUIVALENTE AL REGISTRO OPC
           02  COL-E-OPC00.
      *                             OPERACION CREDITO
               03  OPC.
      *                             FILLER COMPATIBILIDAD VSAM/MVS
                   04  OPC-GLS-FLAG PICTURE X(1).
      *                             CLAVE PRIMARIA REGISTRO
                   04  OPC-KEY-IREG.
      *                             KEY     IDENTIFICACION OPERACION CRE
                       05  OPC-KEY-IOPC.
      *                             COD. INT. COMP. OPERACION CREDITO
                       06  OPC-CIC-IOPC.
      *                             CENTRO ASIGNACION IDENTIFICACION
                       07  OPC-CAI-IOPC.
                       08  OPC-COD-TOPC
                                    PICTURE X(1).
                       08  OPC-COD-COPC
                                    PICTURE X(3).
      *                             IDENT. INTERNA COMPUTACIONAL
                       07  OPC-IIC-IOPC.
                       08  OPC-COD-OOPC.
                       09  OPC-COD-SOPC
                                    PICTURE X(2).
                       09  OPC-IND-SOPC
                                    PICTURE X(1).
                       08  OPC-GLS-NOPC
                                    PICTURE X(5).
      *                             TIME STAMP TRANSACCION
                       05  OPC-STP-ITRN.
      *                             FECHA TRANSACCION
                       06  OPC-FEC-FTRN.
                       07  OPC-NUM-STRN
                                    PICTURE 9(2).
                       07  OPC-NUM-ATRN
                                    PICTURE 9(2).
                       07  OPC-NUM-MTRN
                                    PICTURE 9(2).
                       07  OPC-NUM-DTRN
                                    PICTURE 9(2).
      *                             HORA TRANSACCION
                       06  OPC-HRA-HRTR.
                       07  OPC-NUM-HHTR
                                    PICTURE 9(2).
                       07  OPC-NUM-MMTR
                                    PICTURE 9(2).
                       07  OPC-NUM-SSTR
                                    PICTURE 9(2).
      *                             REQ INDICADOR TIPO ACCION
                   04  OPC-MSC-TACC PICTURE X(1).
      *                             INDICADOR STATUS
                   04  OPC-MSC-STAT PICTURE X(1).
      *                             REQ CODIGO ORIGEN TRANSACCION
                   04  OPC-COD-OTRN.
      *                             INDICADOR TIPO ORIGEN
                       05  OPC-MSC-TTRN
                                    PICTURE X(1).
      *                             CODIGO TIPO ORIGEN
                       05  OPC-COD-TTRN
                                    PICTURE X(3).
      *                             REQ AUTOR TRANSACCION
                   04  OPC-COD-ATRN PICTURE X(12).
      *                             REQ VALOR DE CAMBIO OPERACION CREDIT
                   04  OPC-COD-VCOC.
      *                             MISCELANEO TIPO VALOR
                       05  OPC-MSC-TVOC
                                    PICTURE X(1).
      *                             CODIGO VALOR
                       05  OPC-COD-CVOC
                                    PICTURE X(3).
      *                             CODIGO TIPO CAMBIO
                       05  OPC-COD-TCOC
                                    PICTURE X(2).
      *                             REQ CODIGO CLASE OPERACION CREDITO
                   04  OPC-COD-COOC.
      *                             CODIGO TIPO OPERACION
                       05  OPC-COD-TOOC
                                    PICTURE X(3).
      *                             CODIGO AUXILIAR OPERACION
                       05  OPC-COD-AOOC
                                    PICTURE X(3).
      *                             REQ CODIGO OFICINA OPERACION CREDITO
                   04  OPC-COD-OFOC PICTURE X(3).
      *                             RESPONSABLE MANTENCION OPERACION CRE
                   04  OPC-COD-RMOC PICTURE X(12).
      *                             CODIGO DESTINO OPERACION CREDITO
                   04  OPC-COD-CDOC PICTURE X(3).
      *                             COD. INT. COMP. LINEA DE CREDITO
                   04  OPC-CIC-ILDC.
      *                             CENTRO ASIGNACION IDENTIFICACION
                       05  OPC-CAI-ILDC.
                       06  OPC-COD-TLDC
                                    PICTURE X(1).
                       06  OPC-COD-CLDC
                                    PICTURE X(3).
      *                             IDENT. INTERNA COMPUTACIONAL
                       05  OPC-IIC-ILDC.
                       06  OPC-COD-OLDC.
                       07  OPC-COD-SLDC
                                    PICTURE X(2).
                       07  OPC-IND-SLDC
                                    PICTURE X(1).
                       06  OPC-GLS-NLDC
                                    PICTURE X(5).
      *                             REQ FECHA CURSE O COLOCACION
                   04  OPC-FEC-FCOL.
                       05  OPC-NUM-SCOL
                                    PICTURE 9(2).
                       05  OPC-NUM-ACOL
                                    PICTURE 9(2).
                       05  OPC-NUM-MCOL
                                    PICTURE 9(2).
                       05  OPC-NUM-DCOL
                                    PICTURE 9(2).
      *                             REQ FECHA CURSE CONTABLE
                   04  OPC-FEC-FING.
                       05  OPC-NUM-SING
                                    PICTURE 9(2).
                       05  OPC-NUM-AING
                                    PICTURE 9(2).
                       05  OPC-NUM-MING
                                    PICTURE 9(2).
                       05  OPC-NUM-DING
                                    PICTURE 9(2).
      *                             REQ FECHA CURSE COMPUTACIONAL
                   04  OPC-FEC-FINP.
                       05  OPC-NUM-SINP
                                    PICTURE 9(2).
                       05  OPC-NUM-AINP
                                    PICTURE 9(2).
                       05  OPC-NUM-MINP
                                    PICTURE 9(2).
                       05  OPC-NUM-DINP
                                    PICTURE 9(2).
      *                             REQ MONTO CREDITO
                   04  OPC-VAL-CRED PICTURE 9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             REQ SALDO VALOR CREDITO
                   04  OPC-VAL-SCRE PICTURE 9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             REQ ANALISIS FERIADOS (S/N)
                   04  OPC-IND-AFER PICTURE X(1).
      *                             REQ MODALIDAD CALCULO VALORES FINALE
                   04  OPC-MSC-MCVF PICTURE X(1).
      *                             REQ TIPO CALCULO VENCIMIENTOS
                   04  OPC-MSC-TCVE.
      *                             BASE CALCULO CREDITO
                       05  OPC-MSC-BCCR
                                    PICTURE X(1).
      *                             VALORES INFORMADOS CREDITO
                       05  OPC-MSC-VICR
                                    PICTURE X(1).
      *                             TIPO RENOVACION
                   04  OPC-IND-RENO PICTURE X(3).
      *                             CONDICION GARANTIA
                   04  OPC-IND-GARA PICTURE X(3).
      *                             VALOR COMISION
                   04  OPC-SGV-VCOM PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             VALOR GASTOS
                   04  OPC-VAL-GAST PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             CODIGO DE SEGURO DESGRAVAMEN
                   04  OPC-COD-SEGD.
                       05  OPC-COD-ISEG
                                    PICTURE X(3).
                       05  OPC-COD-CSEG
                                    PICTURE X(3).
                       05  OPC-COD-SSEG
                                    PICTURE X(3).
      *                             VALOR SEGURO
                   04  OPC-VAL-SEGD PICTURE 9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             VALOR LIQUIDO
                   04  OPC-SGV-LIQU PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             REQ NUMERO PROXIMO VENCIMIENTO
                   04  OPC-NUM-IVEN PICTURE 9(3).
      *                             REQ NUMERO VENCIMIENTOS ORIGINALES
                   04  OPC-NUM-VCOR PICTURE 9(3).
      *                             REQ NUMERO VENCIMIENTOS VIGENTES
                   04  OPC-NUM-VCVG PICTURE 9(3).
      *                             NUMERO VENCTOS CANCELADOS EN FORMA O
                   04  OPC-NUM-VCCO PICTURE 9(3).
      *                             NUMERO VENCIMIENTOS CANCELADOS MOROS
                   04  OPC-NUM-VCCM PICTURE 9(3).
      *                             NUMERO DE VENCIMIENTOS CANCELADOS VE
                   04  OPC-NUM-VCCV PICTURE 9(3).
      *                             REQ NUMERO TOTAL VENCIMIENTOS CANCEL
                   04  OPC-NUM-TVCC PICTURE 9(3).
      *                             INDICADOR VENCIMIENTOS ESTRUCTURADOS
                   04  OPC-IND-VSTR PICTURE X(1).
      *                             COD. INT. COMP. CREDITO ENLACE
                   04  OPC-CIC-ICEN.
      *                             CENTRO ASIGNACION IDENTIFICACION
                       05  OPC-CAI-ICEN.
                       06  OPC-COD-TCEN
                                    PICTURE X(1).
                       06  OPC-COD-CCEN
                                    PICTURE X(3).
      *                             IDENT. INTERNA COMPUTACIONAL
                       05  OPC-IIC-ICEN.
                       06  OPC-COD-OCEN.
                       07  OPC-COD-SCEN
                                    PICTURE X(2).
                       07  OPC-IND-SCEN
                                    PICTURE X(1).
                       06  OPC-GLS-NCEN
                                    PICTURE X(5).
      *                             CODIGO AREA GESTION
                   04  OPC-COD-AGES PICTURE X(2).
      *                             FLAG PARA ACTIVAR SIN CONTABILIZAR
                   04  FILLER       PICTURE X(1).
      *                             INDICADOR INSISTENCIA
                   04  FILLER       PICTURE X(1).
      *                             CANAL DE VENTA
                   04  FILLER       PICTURE X(1).
      *                             VALOR SEGURO
                   04  FILLER       PICTURE 9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             GLOSA DISPONIBLE
                   04  OPC-GLS-DISP PICTURE X(20).

       01  REG-VEN.
      *    COPYDD COL-R-VEN.COL-E-VEN00(PROD),01,D
      *                             EQUIVALENTE AL REGISTRO VEN
           02  COL-E-VEN00.
      *                             VENCIMIENTOS
               03  VEN.
      *                             FILLER COMPATIBILIDAD VSAM/MVS
                   04  VEN-GLS-FLAG PICTURE X(1).
      *                             CLAVE PRIMARIA REGISTRO
                   04  VEN-KEY-IREG.
      *                             KEY     IDENTIFICACION VENCIMIENTOS
                       05  VEN-KEY-IVEN.
      *                             COD. INT. COMP. OPERACION CREDITO
                       06  VEN-CIC-IOPC.
      *                             CENTRO ASIGNACION IDENTIFICACION
                       07  VEN-CAI-IOPC.
                       08  VEN-COD-TOPC
                                    PICTURE X(1).
                       08  VEN-COD-COPC
                                    PICTURE X(3).
      *                             IDENT. INTERNA COMPUTACIONAL
                       07  VEN-IIC-IOPC.
                       08  VEN-COD-OOPC.
                       09  VEN-COD-SOPC
                                    PICTURE X(2).
                       09  VEN-IND-SOPC
                                    PICTURE X(1).
                       08  VEN-GLS-NOPC
                                    PICTURE X(5).
      *                             NUMERO IDENTIFICACION VENCIMIENTO
                       06  VEN-NUM-IVEN
                                    PICTURE 9(3).
      *                             TIME STAMP TRANSACCION
                       05  VEN-STP-ITRN.
      *                             FECHA TRANSACCION
                       06  VEN-FEC-FTRN.
                       07  VEN-NUM-STRN
                                    PICTURE 9(2).
                       07  VEN-NUM-ATRN
                                    PICTURE 9(2).
                       07  VEN-NUM-MTRN
                                    PICTURE 9(2).
                       07  VEN-NUM-DTRN
                                    PICTURE 9(2).
      *                             HORA TRANSACCION
                       06  VEN-HRA-HRTR.
                       07  VEN-NUM-HHTR
                                    PICTURE 9(2).
                       07  VEN-NUM-MMTR
                                    PICTURE 9(2).
                       07  VEN-NUM-SSTR
                                    PICTURE 9(2).
      *                             REQ INDICADOR TIPO ACCION
                   04  VEN-MSC-TACC PICTURE X(1).
      *                             INDICADOR STATUS
                   04  VEN-MSC-STAT PICTURE X(1).
      *                             REQ CODIGO ORIGEN TRANSACCION
                   04  VEN-COD-OTRN.
      *                             INDICADOR TIPO ORIGEN
                       05  VEN-MSC-TTRN
                                    PICTURE X(1).
      *                             CODIGO TIPO ORIGEN
                       05  VEN-COD-TTRN
                                    PICTURE X(3).
      *                             REQ AUTOR TRANSACCION
                   04  VEN-COD-ATRN PICTURE X(12).
      *                             REQ FECHA VENCIMIENTO
                   04  VEN-FEC-FVEN.
                       05  VEN-NUM-SVEN
                                    PICTURE 9(2).
                       05  VEN-NUM-AVEN
                                    PICTURE 9(2).
                       05  VEN-NUM-MVEN
                                    PICTURE 9(2).
                       05  VEN-NUM-DVEN
                                    PICTURE 9(2).
      *                             REQ FECHA INICIO MORA VENCIMIENTO
                   04  VEN-FEC-FIMV.
                       05  VEN-NUM-SIMV
                                    PICTURE 9(2).
                       05  VEN-NUM-AIMV
                                    PICTURE 9(2).
                       05  VEN-NUM-MIMV
                                    PICTURE 9(2).
                       05  VEN-NUM-DIMV
                                    PICTURE 9(2).
      *                             REQ VALOR CAPITAL VENCIMIENTO
                   04  VEN-VAL-CAPI PICTURE 9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             REQ SALDO VALOR CAPITAL VENCIMIENTO
                   04  VEN-VAL-SCAP PICTURE 9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             REQ INT DEVENGADOS NO INCLUIDOS EN V
                   04  VEN-VAL-IDNI PICTURE 9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             REQ VALOR FINAL VENCIMIENTO
                   04  VEN-VAL-FINA PICTURE 9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             REQ SALDO VALOR FINAL VENCIMIENTO
                   04  VEN-VAL-SFIN PICTURE 9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             SITUACION CONTABLE
                   04  VEN-IND-SCTB PICTURE X(3).
      *                             REQ NUMERO IDENTIFICACION VENCIMIENT
                   04  VEN-NUM-IVCT PICTURE 9(3).
      *                             NUMERO IDENTIFICACION ESTRUCTURA VEN
                   04  VEN-NUM-IEVC PICTURE 9(3).
      *                             REQ NUMERO IDENTIFICACION DOCUMENTO
                   04  VEN-NUM-IDLC PICTURE 9(3).
      *                             INDICADOR CARGO AUTOMATICO
                   04  VEN-IND-CAUT PICTURE X(1).
      *                             SITUACION COBRANZA
                   04  VEN-IND-SCBZ PICTURE X(5).
      *                             MONTO TRASPASADO SITUACION CONTABLE
                   04  VEN-VAL-MTSC PICTURE 9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             INDICADOR TRASPASO SITUACION CONTAB.
                   04  VEN-IND-MTSC PICTURE X(1).
      *                             INDICADOR DE CALCULO
                   04  VEN-IND-CALC PICTURE X(1).
      *                             SITUACION CONTABLE ANTERIOR
                   04  VEN-IND-CTBA PICTURE X(3).
      *                             GLOSA DISPONIBLE
                   04  VEN-GLS-DISP PICTURE X(10).

       01  REG-CAN.
      *    COPYDD COL-R-CAN.COL-E-CAN00(PROD),01,D
      *                             EQUIVALENTE AL REGISTRO CAN
           02  COL-E-CAN00.
      *                             CANCELACIONES
               03  CAN.
      *                             FILLER COMPATIBILIDAD VSAM/MVS
                   04  CAN-GLS-FLAG PICTURE X(1).
      *                             CLAVE PRIMARIA REGISTRO
                   04  CAN-KEY-IREG.
      *                             KEY    IDENTIFICACION CANCELACION
                       05  CAN-KEY-ICAN.
      *                             COD. INT. COMP. OPERACION CREDITO
                       06  CAN-CIC-IOPC.
      *                             CENTRO ASIGNACION IDENTIFICACION
                       07  CAN-CAI-IOPC.
                       08  CAN-COD-TOPC
                                    PICTURE X(1).
                       08  CAN-COD-COPC
                                    PICTURE X(3).
      *                             IDENT. INTERNA COMPUTACIONAL
                       07  CAN-IIC-IOPC.
                       08  CAN-COD-OOPC.
                       09  CAN-COD-SOPC
                                    PICTURE X(2).
                       09  CAN-IND-SOPC
                                    PICTURE X(1).
                       08  CAN-GLS-NOPC
                                    PICTURE X(5).
      *                             NUMERO IDENTIFICACION CANCELACION
                       06  CAN-NUM-ICAN
                                    PICTURE 9(3).
      *                             TIME STAMP TRANSACCION
                       05  CAN-STP-ITRN.
      *                             FECHA TRANSACCION
                       06  CAN-FEC-FTRN.
                       07  CAN-NUM-STRN
                                    PICTURE 9(2).
                       07  CAN-NUM-ATRN
                                    PICTURE 9(2).
                       07  CAN-NUM-MTRN
                                    PICTURE 9(2).
                       07  CAN-NUM-DTRN
                                    PICTURE 9(2).
      *                             HORA TRANSACCION
                       06  CAN-HRA-HRTR.
                       07  CAN-NUM-HHTR
                                    PICTURE 9(2).
                       07  CAN-NUM-MMTR
                                    PICTURE 9(2).
                       07  CAN-NUM-SSTR
                                    PICTURE 9(2).
      *                             REQ INDICADOR TIPO ACCION
                   04  CAN-MSC-TACC PICTURE X(1).
      *                             INDICADOR STATUS
                   04  CAN-MSC-STAT PICTURE X(1).
      *                             REQ CODIGO ORIGEN TRANSACCION
                   04  CAN-COD-OTRN.
      *                             INDICADOR TIPO ORIGEN
                       05  CAN-MSC-TTRN
                                    PICTURE X(1).
      *                             CODIGO TIPO ORIGEN
                       05  CAN-COD-TTRN
                                    PICTURE X(3).
      *                             REQ AUTOR TRANSACCION
                   04  CAN-COD-ATRN PICTURE X(12).
      *                             REQ OFICINA CANCELACION
                   04  CAN-COD-OFCA PICTURE X(3).
      *                             CODIGO RESPONSABLE CANCELACION
                   04  CAN-COD-RCAN PICTURE X(12).
      *                             REQ CODIGO CANCELACION
                   04  CAN-MSC-CANC.
      *                             TIPO CANCELACION
                       05  CAN-MSC-TCAN
                                    PICTURE X(1).
      *                             FORMA CANCELACION
                       05  CAN-MSC-FCAN
                                    PICTURE X(1).
      *                             ENTIDAD CANCELACION
                       05  CAN-MSC-ECAN
                                    PICTURE X(1).
      *                             REQ FECHA CANCELACION REAL
                   04  CAN-FEC-FCAN.
                       05  CAN-NUM-SCAN
                                    PICTURE 9(2).
                       05  CAN-NUM-ACAN
                                    PICTURE 9(2).
                       05  CAN-NUM-MCAN
                                    PICTURE 9(2).
                       05  CAN-NUM-DCAN
                                    PICTURE 9(2).
      *                             REQ FECHA CANCELACION CONTABLE
                   04  CAN-FEC-FEGR.
                       05  CAN-NUM-SEGR
                                    PICTURE 9(2).
                       05  CAN-NUM-AEGR
                                    PICTURE 9(2).
                       05  CAN-NUM-MEGR
                                    PICTURE 9(2).
                       05  CAN-NUM-DEGR
                                    PICTURE 9(2).
      *                             REQ FECHA CANCELACION COMPUTACIONAL
                   04  CAN-FEC-FOUT.
                       05  CAN-NUM-SOUT
                                    PICTURE 9(2).
                       05  CAN-NUM-AOUT
                                    PICTURE 9(2).
                       05  CAN-NUM-MOUT
                                    PICTURE 9(2).
                       05  CAN-NUM-DOUT
                                    PICTURE 9(2).
      *                             VALOR GASTOS
                   04  CAN-SGV-GAST PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             VALOR TOTAL PAGADO
                   04  CAN-SGV-TPAG PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             VALOR TOTAL RENOVADO
                   04  CAN-SGV-TREN PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             TOTAL DE VENCIMIENTOS CANCELADOS
                   04  CAN-NUM-TVCC PICTURE S9(3).
      *                             DIFERENCIA, PAGO EFECT - DEBE PAGAR
                   04  CAN-SGV-DIFE PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             FECHA DEVENGO ANTERIOR
                   04  CAN-FEC-FDVA.
                       05  CAN-NUM-SDVA
                                    PICTURE 9(2).
                       05  CAN-NUM-ADVA
                                    PICTURE 9(2).
                       05  CAN-NUM-MDVA
                                    PICTURE 9(2).
                       05  CAN-NUM-DDVA
                                    PICTURE 9(2).
      *                             GLOSA DISPONIBLE
                   04  CAN-GLS-DISP PICTURE X(25).

      ******************************************************************
      *                     ELEMENT LIST
      ******************************************************************
       01  ELEM-LIST-OPC.
           05 ELEM-1          PIC X(5) VALUE 'OPC00'.
           05 ELEM-SEC        PIC X(1).
           05 FILLER          PIC X(5) VALUE SPACES.
       01  ELEM-LIST-VEN.
           05 ELEM-1          PIC X(5) VALUE 'VEN00'.
           05 ELEM-SEC        PIC X(1).
           05 FILLER          PIC X(5) VALUE SPACES.
       01  ELEM-LIST-CAN.
           05 ELEM-1          PIC X(5) VALUE 'CAN00'.
           05 ELEM-SEC        PIC X(1).
           05 FILLER          PIC X(5) VALUE SPACES.
      *
           COPY RLOVR001.

       PROCEDURE DIVISION.
      *------------------
             ENTRY 'DBMSCBL'

           OPEN OUTPUT LISTADO.
           ACCEPT FECHA-HOY FROM DATE.
           MOVE DD-HOY TO T1-FECHA-DD
           MOVE MM-HOY TO T1-FECHA-MM
           MOVE AA-HOY TO T1-FECHA-AA
           ACCEPT TARJETA
           PERFORM ABRIR-ARCHIVOS.
           PERFORM LEER-MAESTRO.
           PERFORM LEER-BD1.
           PERFORM PROCESO UNTIL (FIN-PGM = 'SI'
                   AND SW-OPC = 'FIN').
           PERFORM CERRAR-ARCHIVOS.
           CLOSE LISTADO.
           DISPLAY 'LEIDOS MAESTRO   :' LEIDOS
           DISPLAY 'LEIDOS BD        :' LEIDOS-BD
           DISPLAY 'CLAVES IGUALES   :' IGUALES
           DISPLAY 'SALDOS IGUALES   :' VAL-IGUALES
           DISPLAY 'SALDOS DISTINTOS :' VAL-DISTINTOS
           DISPLAY 'GRABADOS CAN-170 :' GRABADOS-CAN
           DISPLAY 'REPETIDOS CAN-170:' GRABADOS-CAN
           DISPLAY 'ACTUAL. "E" OPC  :' ACTUALIZA-OPC
           GOBACK.

       EJECT


       ABRIR-ARCHIVOS.
      *---------------
           OPEN INPUT  CT2A.
           IF FS-CT2A    NOT = '00'
           THEN DISPLAY '   ERROR OPEN CT2A   ... F.STATUS: '
                                     FS-CT2A
                DISPLAY '******  PROCESO CANCELADO. ******* '

                DISPLAY '   ERROR OPEN CT2A   ... F.STATUS: '
                                     FS-CT2A    UPON CONSOLE
                DISPLAY '******  PROCESO CANCELADO. ******* '
                                                  UPON CONSOLE
                GOBACK.


       CERRAR-ARCHIVOS.
      *----------------
           CLOSE CT2A.

       LEER-MAESTRO.
      *--------------
           READ CT2A    AT END MOVE 'SI' TO FIN-PGM
                               MOVE HIGH-VALUES TO LLAVE-A.
           IF FIN-PGM NOT = 'SI'
              MOVE ESPLI-SUC          TO WK-OFIC-BCD
              MOVE WK-OFIC-DISP       TO WK-OFIC-EBCDIC
              MOVE WK-OFIC-EBCDIC     TO LLAVE-2A
              MOVE ESPLI-CTA          TO WK-CTACTE-BCD
              MOVE WK-CTACTE-DISP     TO WK-CTACTE-EBCDIC
              MOVE WK-CTACTE-EBCDIC   TO LLAVE-1A
              ADD 1 TO LEIDOS.

       LEER-BD1.
      *----------
           MOVE 'B                 ' TO OPC-VALUE
           MOVE 'LOCKY'                   TO OPC-COMMAND
           MOVE 'OPC00'                   TO OPC-KEY
           CALL 'DBNTRY' USING UIB REQ-AREA-OPC OPC ELEM-LIST-OPC
           IF OPC-RET-COD = SPACES
              THEN
               MOVE 'REDLE'                   TO OPC-COMMAND
               MOVE 'OPC00'                   TO OPC-KEY
               CALL 'DBNTRY' USING UIB REQ-AREA-OPC OPC ELEM-LIST-OPC
               IF OPC-RET-COD NOT = SPACES
                  THEN DISPLAY 'ERROR EN REDLE :' OPC-RET-COD
                       GOBACK
                  ELSE
                   NEXT SENTENCE
              ELSE DISPLAY 'ERROR EN LOCKY :' OPC-RET-COD
                   GOBACK.
           ADD 1 TO LEIDOS-BD
           MOVE OPC-COD-COPC TO LLAVE-2B
           MOVE OPC-IIC-IOPC TO LLAVE-1B.

       ACCESO-OPC.
      *----------
           MOVE 'OPC00'                   TO OPC-KEY
           CALL 'DBNTRY' USING UIB REQ-AREA-OPC OPC ELEM-LIST-OPC.
           IF OPC-RET-COD NOT = SPACES
                 THEN
                  DISPLAY 'ERROR EN ' OPC-COMMAND ' : ' OPC-RET-COD
                  DISPLAY ' O P C'
                  DISPLAY 'REG LEIDOS:' REG-LEIDOS
                  MOVE 'FIN' TO SW-OPC
                  MOVE HIGH-VALUES TO LLAVE-B
                 ELSE ADD 1 TO REG-LEIDOS
                  IF OPC-COD-TOPC = 'B'
                     IF (OPC-COMMAND = 'REDNX')
                         ADD 1 TO LEIDOS-BD
                     END-IF
                      MOVE OPC-COD-COPC TO LLAVE-2B
                      MOVE OPC-IIC-IOPC TO LLAVE-1B
                     ELSE
                      MOVE HIGH-VALUES TO LLAVE-B
                      MOVE 'FIN' TO SW-OPC.

       PROCESO.
      *---------
      *****  DISPLAY 'LLAVES:' LLAVE-A ' ' LLAVE-B
             IF LLAVE-A = LLAVE-B
                THEN ADD 1 TO IGUALES
                 PERFORM PROCESO-IGUAL
                ELSE
                 IF LLAVE-A < LLAVE-B
                    THEN
                     PERFORM PROCESO-MENOR
                    ELSE
                     PERFORM PROCESO-MAYOR.

       PROCESO-IGUAL.
      *------------------
           MOVE ESPLI-SDO-DEUDOR        TO VALOR-A
           MOVE OPC-VAL-SCRE            TO VALOR-B
      **** DISPLAY 'VALORES:' VALOR-A ' ' VALOR-B
           IF VALOR-A = VALOR-B
              THEN ADD 1 TO VAL-IGUALES
              ELSE PERFORM RTN-IMPRESION
                  ADD 1 TO VAL-DISTINTOS.
            PERFORM LEER-MAESTRO.
            MOVE 'REDNX' TO OPC-COMMAND
            PERFORM ACCESO-OPC.

       PROCESO-MENOR.
      *---------------
           IF ESPLI-SDO-DEUDOR NOT = ZEROES
              MOVE LLAVE-1A        TO CLAVE-2
              MOVE LLAVE-2A        TO SUC-2
              MOVE 'CLAVE NO EXISTE EN BASE DATOS' TO OBS-S
              IF CL > 60
                 PERFORM ENCABEZADO
                 WRITE LINEA FROM DETA-2    AFTER 1
                 ADD 1 TO CL
              ELSE
                 WRITE LINEA FROM DETA-2    AFTER 1
                 ADD 1 TO CL.
           PERFORM LEER-MAESTRO.

       PROCESO-MAYOR.
      *---------------
           IF OPC-VAL-SCRE NOT = ZEROES
              PERFORM VER-SI-GRABA-TABLA-CAN
              MOVE LLAVE-1B        TO CLAVE-2
              MOVE LLAVE-2B        TO SUC-2
              MOVE 'CLAVE NO EXISTE EN MAESTRO' TO OBS-S
              IF CL > 60
                 PERFORM ENCABEZADO
                 WRITE LINEA FROM DETA-2    AFTER 1
                 ADD 1 TO CL
              ELSE
                 WRITE LINEA FROM DETA-2    AFTER 1
                 ADD 1 TO CL.

           IF (OPC-MSC-STAT NOT = 'E')
               MOVE 'RDUKY' TO OPC-COMMAND
               PERFORM ACCESO-OPC
               MOVE 'E' TO OPC-MSC-STAT
               MOVE 'UPDAT' TO OPC-COMMAND
               PERFORM ACCESO-OPC
               ADD 1 TO ACTUALIZA-OPC.

           MOVE 'REDNX' TO OPC-COMMAND
           PERFORM ACCESO-OPC.

       VER-SI-GRABA-TABLA-CAN.
      *----------------------
           IF OPCION-T = 'SI'
              PERFORM GRABA-TABLA-CAN.

       GRABA-TABLA-CAN.
      *---------------
           PERFORM MOVER-DATOS-CAN
           MOVE 'ADDIT'                   TO CAN-COMMAND
           MOVE 'CAN00'                   TO CAN-KEY
           CALL 'DBNTRY' USING UIB REQ-AREA-CAN CAN ELEM-LIST-CAN.
           IF CAN-RET-COD NOT = SPACES
              IF CAN-RET-COD = '10'
                 DISPLAY 'REG. CAN DUPLICADO:' CAN-KEY-ICAN
                 ADD 1 TO REPETIDOS-CAN
              ELSE
                 DISPLAY '--------------------'
                 DISPLAY 'NO GRABO ARCHIVO CAN, COD.RET :' CAN-RET-COD
                 DISPLAY '--------------------'
                 DISPLAY 'REQ. AREA :' REQ-AREA-CAN
                 DISPLAY 'REG:' CAN
                 DISPLAY 'PROCESO CANCELADO'
                 DISPLAY 'PROCESO CANCELADO' UPON CONSOLE
                 PERFORM CERRAR-ARCHIVOS
                 GOBACK
           ELSE
              ADD 1                       TO GRABADOS-CAN.

       MOVER-DATOS-CAN.
      *---------------
           MOVE    SPACES                         TO  CAN-GLS-FLAG.
      *            COD. INT. COMP. OPERACION CREDITO
      *                CENTRO ASIGNACION IDENTIFICACION

           MOVE    'B'                            TO  CAN-COD-TOPC.
           MOVE    OPC-COD-COPC                   TO  CAN-COD-COPC.

      *                IDENT. INTERNA COMPUTACIONAL

           MOVE    OPC-COD-OOPC                   TO  CAN-COD-OOPC.
           MOVE    OPC-GLS-NOPC                   TO  CAN-GLS-NOPC.

      *            NUMERO IDENTIFICACION CANCELACION
      *** AQUI
           PERFORM ACCESAR-BD160.
      *****MOVE    999                            TO  CAN-NUM-ICAN

      *        TIME STAMP TRANSACCION

      *            FECHA TRANSACCION

      *****MOVE   19                              TO  CAN-NUM-STRN
           MOVE   ANO-T                           TO  CAN-NUM-ATRN
           MOVE   MES-T                           TO  CAN-NUM-MTRN
           MOVE   DIA-T                           TO  CAN-NUM-DTRN
           IF ANO-T < ROLL-YY
              MOVE 20                             TO  CAN-NUM-STRN
           ELSE
              MOVE 19                             TO  CAN-NUM-STRN
           END-IF

      *            HORA TRANSACCION

           ACCEPT CAN-HRA-HRTR                    FROM TIME

      *REQ INDICADOR TIPO ACCION

           MOVE   'I'                             TO  CAN-MSC-TACC

      *    INDICADOR STATUS

           MOVE     SPACES                        TO  CAN-MSC-STAT

      *REQ CODIGO ORIGEN TRANSACCION

      *        INDICADOR TIPO ORIGEN

           MOVE     'C'                           TO  CAN-MSC-TTRN

      *        CODIGO TIPO ORIGEN

           MOVE        'DIA'                      TO  CAN-COD-TTRN

      *REQ AUTOR TRANSACCION

           MOVE    'CARGA BATCH'                  TO  CAN-COD-ATRN


      *REQ OFICINA CANCELACION                          TAB OFI

           MOVE OPC-COD-COPC                      TO  CAN-COD-OFCA.

      *    CODIGO RESPONSABLE CANCELACION               TAB USR

           MOVE     SPACES                        TO  CAN-COD-RCAN.

      *REQ CODIGO CANCELACION                           COL CANC

      *        TIPO CANCELACION                         COL TCAN

           MOVE     'C'                           TO  CAN-MSC-TCAN.

      *        FORMA CANCELACION                        COL FCAN
      *        ENTIDAD CANCELACION                      COL ECAN

           MOVE   'T'                        TO  CAN-MSC-FCAN
                                                 CAN-MSC-ECAN


      *REQ FECHA CANCELACION REAL
      *REQ FECHA CANCELACION CONTABLE
      *REQ FECHA CANCELACION COMPUTACIONAL


      *****MOVE  19                               TO  CAN-NUM-SCAN
      *****                                           CAN-NUM-SEGR
      *****                                           CAN-NUM-SOUT.
           IF ANO-T < ROLL-YY
              MOVE 20                             TO  CAN-NUM-SCAN
                                                      CAN-NUM-SEGR
                                                      CAN-NUM-SOUT
           ELSE
              MOVE 19                             TO  CAN-NUM-SCAN
                                                      CAN-NUM-SEGR
                                                      CAN-NUM-SOUT
           END-IF.
           MOVE  ANO-T                            TO  CAN-NUM-ACAN
                                                      CAN-NUM-AEGR
                                                      CAN-NUM-AOUT.
           MOVE  MES-T                            TO  CAN-NUM-MCAN
                                                      CAN-NUM-MEGR
                                                      CAN-NUM-MOUT.
           MOVE  DIA-T                            TO  CAN-NUM-DCAN
                                                      CAN-NUM-DEGR
                                                      CAN-NUM-DOUT.

      *    VALOR GASTOS

           MOVE   ZERO                            TO  CAN-SGV-GAST.

      *    VALOR TOTAL PAGADO

           MOVE  OPC-VAL-SCRE                     TO  CAN-SGV-TPAG.

      *    VALOR TOTAL RENOVADO

           MOVE   ZERO                            TO  CAN-SGV-TREN.
           MOVE   001                             TO  CAN-NUM-TVCC.
           MOVE   ZEROES                          TO  CAN-SGV-DIFE.

      *    GLOSA DISPONIBLE

           MOVE   SPACES                          TO  CAN-GLS-DISP.

       ACCESAR-BD160.
      *--------------
      ****  SE ACCESA TABLA CAN160 PARA OBTENER NRO. CANCELACION.
           MOVE    998                    TO  CAN-NUM-ICAN
           MOVE CAN-KEY-ICAN              TO  CAN-VALUE-160
           MOVE 'LOCKL'                   TO  CAN-COMMAND-160
           MOVE 'CAN00'                   TO  CAN-KEY-160
           CALL 'DBNTRY' USING UIB REQ-AREA-CAN-160.
           IF CAN-RET-COD-160 NOT = SPACES AND NOT = '14'
              DISPLAY '---------------------------------------'
              DISPLAY 'FALLA LOCKL TABLA CAN 160, COD.RET : '
                       CAN-RET-COD-160
              DISPLAY '---------------------------------------'
              DISPLAY 'REQ. AREA :' REQ-AREA-CAN-160
              DISPLAY 'REG:' CAN
              DISPLAY 'PROCESO CANCELADO'
              DISPLAY 'PROCESO CANCELADO' UPON CONSOLE
              PERFORM CERRAR-ARCHIVOS
              GOBACK
           ELSE
              IF CAN-RET-COD-160 = '14'
                 MOVE SPACES TO VALUE-12
              ELSE
                 NEXT SENTENCE.

      *** VERIFICA SI CAMBIO LA OPERACION
           IF VALUE-12 = CAN-CIC-IOPC

      *** SI NO HA CAMBIADO Y EXISTE NUM.CAN = 900 O MAYOR, SUMA 1
      *** SI CAMBIO O NO EXISTE NUM.CAN = 900 O MAYOR, MUEVE 900
              IF VALUE-3 NOT < 900
                 COMPUTE  CAN-NUM-ICAN = VALUE-3 + 1
              ELSE
                 MOVE  900    TO CAN-NUM-ICAN
           ELSE
              MOVE  900       TO CAN-NUM-ICAN.

       RTN-IMPRESION.
      *--------------
             IF CL > 60
                PERFORM ENCABEZADO.
             PERFORM DETALLE.

       ENCABEZADO.
      *------------
              ADD 1   TO CP.
              MOVE CP TO PAG-T1
              WRITE LINEA FROM TIT-1 AFTER CANAL-1
              WRITE LINEA FROM TIT-2 AFTER 1
              WRITE LINEA FROM RAYA  AFTER 2
              WRITE LINEA FROM TIT-3 AFTER 2
              WRITE LINEA FROM TIT-4 AFTER 2
              WRITE LINEA FROM RAYA  AFTER 1
              MOVE 10 TO CL.

       DETALLE.
      *---------
           MOVE LLAVE-1A             TO CLAVE-S
           MOVE LLAVE-2A             TO SUC-S

           MOVE ESPLI-RUT-DEU-DIR    TO RUT-MAE
           MOVE RUT-BASE             TO RUT-BCD-BASE
           MOVE RUT-COMP             TO RUT-EBCDIC
           MOVE RUT-EBCDIC           TO RUTDD-S
           MOVE RUT-DV               TO DVDD-S

           MOVE ESPLI-RUT-DEU-IND    TO RUT-MAE
           MOVE RUT-BASE             TO RUT-BCD-BASE
           MOVE RUT-COMP             TO RUT-EBCDIC
           MOVE RUT-EBCDIC           TO RUTDI-S
           MOVE RUT-DV               TO DVDI-S

           MOVE ESPLI-FEC-APERTURA-CTA     TO FECHA-BCD
           MOVE FECHA-INT                  TO FECHA-EBCDIC
           MOVE ANO-EBCDIC                 TO ANOC-S
           MOVE MES-EBCDIC                 TO MESC-S
           MOVE DIA-EBCDIC                 TO DIAC-S

           MOVE OPC-KEY-IOPC         TO VEN-CIC-IOPC
           MOVE 001                  TO VEN-NUM-IVEN
           MOVE VEN-KEY-IVEN         TO VEN-VALUE
           MOVE 'REDKY'              TO VEN-COMMAND
           MOVE 'VEN00'              TO VEN-KEY
           CALL 'DBNTRY' USING UIB REQ-AREA-VEN VEN ELEM-LIST-VEN.
           IF VEN-RET-COD NOT = SPACES
              THEN
                  DISPLAY '------------------------'
                  DISPLAY 'NO ACCESO VEN, COD.RET :' VEN-RET-COD
                  DISPLAY '------------------------'
                  DISPLAY 'REQ. AREA :' REQ-AREA-VEN
                  MOVE 0 TO ANOV-S
                  MOVE 0 TO MESV-S
                  MOVE 0 TO DIAV-S
              ELSE
               MOVE VEN-NUM-AVEN     TO ANOV-S
               MOVE VEN-NUM-MVEN     TO MESV-S
               MOVE VEN-NUM-DVEN     TO DIAV-S.

           MOVE OPC-MSC-TACC         TO INDT-S
           MOVE OPC-MSC-STAT         TO INDS-S
           MOVE OPC-VAL-CRED         TO MONTO-S
           MOVE OPC-VAL-SCRE         TO SALDOB-S
           MOVE ESPLI-SDO-DEUDOR       TO SALDOM-S.
           WRITE LINEA FROM DETA-1    AFTER 1
           ADD 1 TO CL.
       FIN-PROGRAMA.

