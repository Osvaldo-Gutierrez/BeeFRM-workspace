*%! Codigo adicional programa DAPPAIMP
*% NO_HDR_CST = TRUE
*% NO_TIENE_TIMESTAMP = TRUE
*% IF CMT_ID
      *<<<< CMT_ID
      *-----------------------------------------------------------------
      *  MODIFICACIONES:
      *  ---------------
      *  AUTOR      : CIMA-OGB
      *  FECHA      : ENERO 2015
      *  ETIQUETA   : CIMA-INI 26-ENE-2015 CUSTODIA DAP - IMPRESION 
      *  PROYECTO   : CUSTODIA DEPOSITOS A PLAZO
      *  CAMBIOS    :   
      *               PROGRAMA PU
      *               1. SE AGREGA CAMPO Y VALIDACION IMP-COD-AIMP 
      *               2. SE CAMBIA IMP-VAL-INTP POR IMP-SGV-INTP POR 
      *                  CAMBIO DE BR NO REGULARIZADO EN PANTALLA
      *               PROGRAMA PQ
      *               1. SE AGREGA VALIDACION COMANDO ATZ
      *-----------------------------------------------------------------
      *>>>> 
*% END
*% IF WSS
      *<<<< WSS
*% IF PGM_PQ
      *CIMA-INI 26-ENE-2015 CUSTODIA DAP - IMPRESION
       COPY DAPBROPD.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPD-REQA==.
       
       01  WSS-VARI.
           03 WSS-CT-DAP          VALUE 'DAP'        PIC X(03).
           03 WSS-CT-ORI          VALUE 'ORI'        PIC X(03).
           03 WSS-CT-ATZ          VALUE 'ATZ'        PIC X(03).
           03 WSS-CT-S            VALUE 'S'          PIC X(01).
           03 WSS-COD-NAUT    VALUE 'CODOFINOATZ '   PIC X(12).
           03 WSS-CT-MUNO   COMP   PIC S9(04) VALUE -1.
      *CIMA-FIN 26-ENE-2015 CUSTODIA DAP - IMPRESION
*% END
*% IF PGM_PU
      *CIMA-INI 26-ENE-2015 CUSTODIA DAP - IMPRESION
       COPY DAPBRLND.
       COPY DAPBRRCC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LND-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCC-REQA==.

       01  WSS-VARI.
           03 WSS-CT-ATZ    VALUE 'ATZ'                 PIC X(03).
           03 WSS-CT-KIOP   VALUE 'RCC-KEY-IOPD'        PIC X(12).
           03 PGM-STAT-RCC           VALUE '23'         PIC X(02).
              88 PGM-STAT-RCC-OKS    VALUE '00'.
              88 PGM-STAT-RCC-NUL    VALUE '  '.
           03 WSS-CT-L23    VALUE '23'                  PIC X(02).
           03 WSS-CT-I      VALUE 'I'                   PIC X(01).
           03 WSS-CT-NA     VALUE 'N/A'                 PIC X(03).
           03 WSS-CT-1      VALUE 1                     PIC 9(01).
           03 WSS-CT-1PT0   VALUE '1.0'                 PIC X(03).
           03 WSS-CT-OPD    VALUE 'OPD'                 PIC X(03).
           03 WSS-CT-DAP    VALUE 'DAP'                 PIC X(03).
           03 WSS-CT-CIM    VALUE 'CIM'                 PIC X(03).
           03 WSS-CT-MUNO   COMP   PIC S9(04) VALUE -1.
      *CIMA-FIN 26-ENE-2015 CUSTODIA DAP - IMPRESION
*% END
      *>>>> 
*% END
*% IF INI_FIO
      *<<<< INI_FIO                                                     
      * ISP-INI 31-07-1998 INICIALIZA CAMPOS DE REGISTROS               
           PERFORM CLR-REG-IMP.                                         
      * ISP-FIN 31-07-1998 INICIALIZA CAMPOS DE REGISTROS               
      *>>>> END
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      *CIMA-INI 26-ENE-2015 CUSTODIA DAP - IMPRESION
           IF FIO-STAT-OKS AND SCR-CMND = WSS-CT-ATZ
              MOVE SPACES TO OPD
              MOVE IMP-CIC-IOPD IN IMP TO OPD-CIC-IOPD IN OPD
              MOVE FIO-GET-KEY         TO FIO-CMND
              PERFORM DAP-FIO-OPD
              IF FIO-STAT-OKS
                 MOVE SPACES                TO TAB
                 MOVE WSS-CT-DAP            TO FIO-SIST
                 MOVE WSS-CT-ORI            TO TAB-COD-TTAB IN TAB
                 MOVE OPD-COD-OFIC IN OPD   TO TAB-COD-CTAB IN TAB
                 MOVE FIO-GET-KEY           TO FIO-CMND
                 PERFORM GNS-FIO-TAB
                 IF NOT(FIO-STAT-OKS AND
                    TAB-IND-VIGE IN TAB = WSS-CT-S)
                    MOVE WSS-COD-NAUT   TO MSG-COD-MENS
                    MOVE WSS-CT-DAP     TO MSG-COD-SIST
                    PERFORM GET-MSG
                    MOVE MSG-GLS-DESC TO FRM-MENS
                    PERFORM SCR-MSSG
                    MOVE SCR-STAT-ABT TO SCR-STAT.
      *CIMA-FIN 26-ENE-2015 CUSTODIA DAP - IMPRESION 
      *>>>> 
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
      *CIMA-INI 26-ENE-2015 CUSTODIA DAP - IMPRESION
      *SE GUARDA LOG DE NEGOCIOS COMANDO ATZ
           IF FIO-STAT-OKS AND SCR-CMND = WSS-CT-ATZ
              PERFORM PRO-LND.
      *CIMA-FIN 26-ENE-2015 CUSTODIA DAP - IMPRESION
      *>>>> 
*% END
*% IF EOF
      *<<<< EOF                                                         
      * ISP-INI 31-07-1998 INICIALIZA CAMPOS DE REGISTROS               
       COPY DAPBCIMP.                                                   
      * ISP-FIN 31-07-1998 INICIALIZA CAMPOS DE REGISTROS               
*% IF PGM_PQ
      *CIMA-INI 26-ENE-2015 CUSTODIA DAP - IMPRESION
       COPY DAPBFOPD.
      *CIMA-FIN 26-ENE-2015 CUSTODIA DAP - IMPRESION
*% END
*% IF PGM_PU
      *CIMA-INI 26-ENE-2015 CUSTODIA DAP - IMPRESION
       COPY GNSBVCOD.
       COPY GNSBVTAB.
       COPY DAPBFLND.
       COPY DAPBFRCC.
       
       PRO-LND SECTION.
       INI-PRO-LND.
           PERFORM GET-FHOY.
           MOVE SPACES TO LND.
           MOVE WSS-CT-ATZ    TO LND-COD-EVEN IN LND.
           MOVE WSS-CT-I      TO LND-COD-TACC IN LND
                                 LND-COD-STAT IN LND.
           MOVE WSS-CT-NA     TO LND-COD-INST IN LND.
           MOVE WSS-CT-1 TO LND-NUM-CLND IN LND
                            LND-NUM-COPD IN LND
                            LND-NUM-CCLI IN LND
                            LND-NUM-CAUT IN LND.
           PERFORM PRO-GRABA-REG-LND.
       FIN-PRO-LND.
            EXIT.
       
       
       PRO-GRABA-REG-LND SECTION.
       INI-GRABA-REG-LND.
           MOVE WSS-CT-1PT0   TO LND-COD-VERS IN LND.
           MOVE WSS-CT-OPD    TO LND-COD-ENTF IN LND
                                 LND-COD-ENTO IN LND
                                 LND-COD-ENTC IN LND
                                 LND-COD-ENTA IN LND
                                 LND-COD-ENTI IN LND.
           MOVE HOY-FHOY TO LND-FEC-FTRN IN LND
                            LND-FEC-FLND IN LND
                            LND-FEC-FOPD IN LND
                            LND-FEC-FCLI IN LND
                            LND-FEC-FAUT IN LND.
           MOVE HOY-HHOY TO LND-HRA-HRTR IN LND
                            LND-HRA-HHND IN LND
                            LND-HRA-HOPD IN LND
                            LND-HRA-HCLI IN LND
                            LND-HRA-HAUT IN LND.
           MOVE IMP-CIC-IOPD IN IMP TO LND-CIC-IOPD IN LND.
           MOVE EIBTRMID            TO LND-COD-OTRN IN LND.
           MOVE SCR-USER            TO LND-COD-ATRN IN LND
                                       LND-COD-AUTO IN LND.
           MOVE EIBTRNID            TO LND-COD-TCIC IN LND.
           MOVE SCR-CMND            TO LND-COD-CMND IN LND.
      *GUARDAMOS CODIGO DE AUTORIZACION DE IMPRESION
           MOVE IMP-COD-AIMP IN IMP TO LND-COD-LN01 IN LND.
           PERFORM GET-CUR-RCC.
           MOVE RCC-CIC-ICLI IN RCC TO LND-CIC-ICLI IN LND.
           
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-LND.
       FIN-GRABA-REG-LND.
           EXIT.
           
       GET-CUR-RCC SECTION.
      *--------------------
       INI-GET-CUR-RCC.
           MOVE SPACES TO RCC.
           MOVE IMP-CIC-IOPD IN IMP TO RCC-CIC-IOPD IN RCC.
           MOVE WSS-CT-KIOP         TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT (FIO-STAT-OKS AND
                   IMP-CIC-IOPD IN IMP = RCC-CIC-IOPD IN RCC)
                   MOVE WSS-CT-L23 TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-RCC.
       FIN-GET-CUR-RCC.
           EXIT.
      *CIMA-FIN 26-ENE-2015 CUSTODIA DAP - IMPRESION
*% END
      *>>>> END  
*% END
