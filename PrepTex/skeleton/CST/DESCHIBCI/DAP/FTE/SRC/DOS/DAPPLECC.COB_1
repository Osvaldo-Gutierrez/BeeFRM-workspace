       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      DAPPLECC.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    25-Aug-92 07:58 PM.

      * Programa Listador de Reporte ECC con Sort.

      ******************************************************************
      *  INTERSOFT                                                     *
      *  MODIFICACION: CONVERTIR REPORT-WRITER A LISTADO, MIGRAR A     *
      *                A COBOL FOR MVS Y CONVERSION 2000               *
      *  FECHA: ABRIL 1998                                             *
      ******************************************************************

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
      *DOS SELECT RPTECC         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTECC         ASSIGN TO        UT-S-RPTECC.
           SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.

      ***** CRW-COMIENZO
      *    SELECT RPTECC         ASSIGN TO        UT-S-RPTECC.
           SELECT RPTECC         ASSIGN TO             RPTECC.
      ***** CRW-FINAL


       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY DAPRRECC.

      ***** CRW-COMIENZO
      *FD  RPTECC LABEL RECORDS OMITTED
      *    REPORT IS RPT-ECC
      *    .

       FD  RPTECC
           RECORD CONTAINS 133 CHARACTERS
           BLOCK CONTAINS 0 RECORDS
           LABEL RECORD STANDARD.

       01  RPTECC-REG           PIC X(133).
      ***** CRW-FINAL

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY DAPBROPD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY DAPRWECC.
      *<<<< RW
       COPY DAPRWECI.
      *>>>>
       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
      *Entidades de GNS
       COPY GNSWGFEC.
       COPY GNSWGHOY.
      *Entidades de TAB
       COPY TABBRCAM.
       COPY TABBROFI.
       COPY TABBRVLR.

       01  WSS-VARI.
           03  WSS-FEC-FINI.
               05  WSS-NUM-DINI                      PIC 9(02).
               05  WSS-NUM-MINI                      PIC 9(02).
               05  WSS-NUM-SINI                      PIC 9(02).
               05  WSS-NUM-AINI                      PIC 9(02).
           03  WSS-FEC-FPRO.
               05  WSS-NUM-DPRO                      PIC 9(02).
               05  WSS-NUM-MPRO                      PIC 9(02).
               05  WSS-NUM-SPRO                      PIC 9(02).
               05  WSS-NUM-APRO                      PIC 9(02).
           03  WSS-FEC-FTER.
               05  WSS-NUM-STER                      PIC 9(02).
               05  WSS-NUM-ATER                      PIC 9(02).
               05  WSS-NUM-MTER                      PIC 9(02).
               05  WSS-NUM-DTER                      PIC 9(02).
           03  WSS-COD-TINT.
               05  WSS-COD-BCTI                      PIC X(01).
               05  WSS-COD-PBTI                      PIC X(01).
               05  WSS-COD-MCTI                      PIC X(02).
               05  WSS-COD-CVTI                      PIC X(03).
               05  WSS-GLS-REST                      PIC X(05).
           03  WSS-COD-OFIC                          PIC X(03).
           03  WSS-COD-VCAM                          PIC X(06).
      *JVM/BCI 01-06-93
           03  WSS-COD-UEFE                          PIC X(06).
           03  PDB-CIC-0998         VALUE '0998  '   PIC X(06).
      *JVM/BCI
           03  WSS-FINM             VALUE ZEROES     PIC 9(02).
           03  WSS-FINT             VALUE ZEROES     PIC 9(02).
           03  WSS-IND-PRI          VALUE ZEROES     PIC 9(01).
           03  WSS-IND-CORT         VALUE ZEROES     PIC 9(01).
           03  WSS-IND-ERR1         VALUE ZEROES     PIC 9(01).
           03  WSS-IND-ERR2         VALUE ZEROES     PIC 9(01).
           03  WSS-I                VALUE ZEROES     PIC 9(02).
           03  WSS-J                VALUE ZEROES     PIC 9(02).
           03  WSS-SUM-OPER         VALUE ZEROES     PIC 9(07).
           03  WSS-SUM-CAPT         VALUE ZEROES     PIC 9(11)V9999.
           03  WSS-SUM-OPET         VALUE ZEROES     PIC 9(07).
           03  WSS-SUM-CAPI         VALUE ZEROES     PIC 9(11)V9999.
           03  WSS-TOT-CAPT         VALUE ZEROES     PIC 9(11)V9999.
           03  WSS-TOT-OPET         VALUE ZEROES     PIC 9(07).
           03  WSS-TOT-CAPI         VALUE ZEROES     PIC 9(11)V9999.
           03  WSS-TOT-OPER         VALUE ZEROES     PIC 9(07).
           03  WSS-ACU-OPER         VALUE ZEROES     PIC 9(05)V99.
           03  WSS-ACU-CAPT         VALUE ZEROES     PIC 9(05)V99.
           03  WSS-COD-CTAB.
               05  WSS-COD-CTA1                      PIC X(06).
               05  WSS-COD-CTA2                      PIC X(03).
               05  WSS-COD-CTA3                      PIC 9(03).
           03  WSS-GLS-TINI.
               05  WSS-NUM-TINI                      PIC 9(08)V9(02).
           03  WSS-GLS-TFIN.
               05  WSS-NUM-TFIN                      PIC 9(08)V9(02).
           03  WSS-GLS-TASI.
               05  WSS-SGV-TASI                      PIC 9(06)V9(04).
           03  WSS-GLS-TASF.
               05  WSS-SGV-TASF                      PIC 9(06)V9(04).
           03  WSS-SGV-TINI                          PIC 9(11)V9(04).
           03  WSS-SGV-TFIN                          PIC 9(11)V9(04).
           03  WSS-KEY-ANT.
      *        05  WSS-COD-OFIA                      PIC X(03).
               05  WSS-COD-VCAA                      PIC X(06).
           03  WSS-KEY-SRT.
      *        05  WSS-KEY-OFIC                      PIC X(03).
               05  WSS-KEY-VCAM                      PIC X(06).
      *    Tasa Interes Informada
           03  INT-TINT           VALUE ZEROES       PIC 9(03)V9(06).

           03  WSS-TBL-MONT.
               05  WSS-TBL-VMON  OCCURS 20 TIMES.
                   07  WSS-GLS-TRAM             PIC X(20).
                   07  WSS-NUM-VFIN             PIC 9(11)V9(04).
                   07  WSS-NUM-OPER             PIC 9(06).
                   07  WSS-POR-OPER             PIC 9(03)V9(02).
                   07  WSS-POT-OPER             PIC 9(03)V9(02).
                   07  WSS-VAL-CAPT             PIC 9(11)V9(04).
                   07  WSS-POR-CAPT             PIC 9(03)V9(02).
                   07  WSS-POT-CAPT             PIC 9(03)V9(02).

           03  WSS-TBL-TASA.
               05  WSS-TBL-VTAS  OCCURS 20 TIMES.
                   07  WSS-GLS-TRAT             PIC X(20).
                   07  WSS-SGV-VFIN             PIC 9(06)V9(04).
                   07  WSS-NUM-OPET             PIC 9(06).
                   07  WSS-VAL-CAPI             PIC 9(11)V9(04).
      *>>>>
      *<<<< WSS_DTC
      *Entidades de TAB
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *>>>>

      ***** CRW-COMIENZO

      *REPORT SECTION.
      *--------------
      *COPY DAPRFECC.
      *    .
      *COPY DAPRTECC.
      *<<<< RT
      *COPY DAPRTECI.
      *>>>>

       01  RPT-VARIABLES.
           02 RPT-VARIABLES-VARIAS.
               03 RPT-VARI-LINEA              PIC 9(03) VALUE 60.
               03 RPT-VARI-PAGE-COUNTER       PIC 9(03).
           02 RPT-VARIABLES-CONTROL.
               03 RPT-CTRL-VAL-TRMO           PIC 9(03) VALUE 0.
           02 RPT-VARIABLES-TOTALES.
               03 RPT-TOT-SEGD-TRA            PIC 9(12)V9(04) VALUE 0.
               03 RPT-TOT-SEGD-BCO            PIC 9(12)V9(04) VALUE 0.

       01  PH-ECC.

           03  PH-ECC-01.
               05  RPT-HEAD-DUSU              PIC X(40).
               05  FILLER                     PIC X(082) VALUE SPACES.
               05  RPT-HEAD-FDMA              PIC 99B99B9999.

           03  PH-ECC-02.
               05  RPT-HEAD-DSIS              PIC X(40).
               05  FILLER                     PIC X(082) VALUE SPACES.
               05  FILLER                     PIC X(4)
                   VALUE 'PAG.'.
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-HEAD-PAGE-COUNTER      PIC ZZZZZ.

           03  PH-ECC-03.
               05  FILLER                     PIC X(038) VALUE SPACES.
               05  FILLER                     PIC X(39)
                   VALUE 'OPERACIONES POR TRAMOS DE CAPITAL EN MI'.
               05  FILLER                     PIC X(6)
                   VALUE 'LES AL'.
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-HEAD-NUM-DPRO          PIC 9(2).
               05  FILLER                     PIC X(1)
                   VALUE ALL '-'.
               05  RPT-HEAD-NUM-MPRO          PIC 9(2).
               05  FILLER                     PIC X(1)
                   VALUE ALL '-'.
               05  RPT-HEAD-NUM-SPRO          PIC 9(2).
               05  RPT-HEAD-NUM-APRO          PIC 9(2).

           03  PH-ECC-04.
               05  FILLER                     PIC X(9)
                   VALUE SPACES.
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  FILLER                     PIC X(3)   VALUE SPACES.
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  FILLER                     PIC X(25)  VALUE SPACES.
               05  FILLER                     PIC X(059) VALUE SPACES.
               05  FILLER                     PIC X(8)
                   VALUE 'MONEDA :'.
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-HEAD-GLS-VCAM          PIC X(25).

           03  PH-ECC-05.
               05  FILLER                     PIC X(132)
                   VALUE ALL '-'.

           03  PH-ECC-06.
               05  FILLER                     PIC X(39)
                   VALUE 'DETALLE DE TRAMOS              CANT. OP'.
               05  FILLER                     PIC X(39)
                   VALUE 'ER.       % TRAMO        % TOTAL       '.
               05  FILLER                     PIC X(39)
                   VALUE '         MONTO CAPITAL         % TRAMO '.
               05  FILLER                     PIC X(15)
                   VALUE '        % TOTAL'.

           03  PH-ECC-07.
               05  FILLER                     PIC X(132)
                   VALUE ALL '-'.

       01  DL-ECC.

           03  DL-ECC-08.
               05  RPT-DETA-GLS-TRAM          PIC X(25).
               05  FILLER                     PIC X(010) VALUE SPACES.
               05  RPT-DETA-NUM-OPER          PIC ZZZ.ZZZ.
               05  FILLER                     PIC X(008) VALUE SPACES.
               05  RPT-DETA-NUM-POTR          PIC ZZ9,99.
               05  FILLER                     PIC X(009) VALUE SPACES.
               05  RPT-DETA-VAL-POTT          PIC ZZ9,99.
               05  FILLER                     PIC X(010) VALUE SPACES.
               05  RPT-DETA-VAL-CAPT          PIC ZZ.ZZZ.ZZZ.ZZ9,9999.
               05  FILLER                     PIC X(010) VALUE SPACES.
               05  RPT-DETA-VAL-PCTR          PIC ZZ9,99.
               05  FILLER                     PIC X(010) VALUE SPACES.
               05  RPT-DETA-VAL-PCTT          PIC ZZ9,99.

       01  DL-TECC.

           03  DL-TEC-09.
               05  RPT-DETA-GLS-BLK1          PIC X.

           03  DL-TEC-10.
               05  FILLER                     PIC X(5)
                   VALUE 'TOTAL'.
               05  FILLER                     PIC X(030) VALUE SPACES.
               05  RPT-DETA-NUM-TOPE          PIC ZZZ.ZZZ.
               05  FILLER                     PIC X(039) VALUE SPACES.
               05  RPT-DETA-VAL-TCAP          PIC ZZ.ZZZ.ZZZ.ZZ9,9999.

           03  DL-TEC-11.
               05  RPT-DETA-GLS-BLK2          PIC X.

           03  DL-TEC-12.
               05  RPT-DETA-GLS-BLK3          PIC X.
               05  RPT-DETA-COD-OFIC          PIC X(3).
               05  RPT-DETA-COD-VCAM          PIC X(6).
               05  RPT-DETA-VAL-SCAP          PIC ZZ.ZZZ.ZZZ.ZZ9,9999.
               05  RPT-DETA-SGV-TINT          PIC 999,9999.

       01  DL-EECI.

           03  DL-EEC-01.
               05  FILLER                     PIC X(038) VALUE SPACES.
               05  FILLER                     PIC X(39)
                   VALUE 'OPERACIONES POR TRAMOS DE TASAS DE INTE'.
               05  FILLER                     PIC X(6)
                   VALUE 'RES AL'.
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-DETA-NUM-DPRO          PIC 9(2).
               05  FILLER                     PIC X(1)
                   VALUE ALL '-'.
               05  RPT-DETA-NUM-MPRO          PIC 9(2).
               05  FILLER                     PIC X(1)
                   VALUE ALL '-'.
               05  RPT-DETA-NUM-SPRO          PIC 9(2).
               05  RPT-DETA-NUM-APRO          PIC 9(2).

           03  DL-EEC-02.
               05  FILLER                     PIC X(132)
                   VALUE ALL '-'.

           03  DL-EEC-03.
               05  FILLER                     PIC X(39)
                   VALUE 'DETALLE DE TRAMOS            CANT. OPER'.
               05  FILLER                     PIC X(31)
                   VALUE '.                 MONTO CAPITAL'.

           03  DL-EEC-04.
               05  FILLER                     PIC X(132)
                   VALUE ALL '-'.

       01  DL-ECI.

           03  DL-ECI-05.
               05  RPT-DETA-GLS-TRAM          PIC X(25).
               05  FILLER                     PIC X(008) VALUE SPACES.
               05  RPT-DETA-NUM-OPER          PIC ZZZ.ZZ9.
               05  FILLER                     PIC X(011) VALUE SPACES.
               05  RPT-DETA-VAL-CAPT          PIC ZZ.ZZZ.ZZZ.ZZ9,9999.

       01  DL-TECI.

           03  DL-TEC-06.
               05  RPT-DETA-GLS-BLK0          PIC X.

           03  DL-TEC-07.
               05  FILLER                     PIC X(5)
                   VALUE 'TOTAL'.
               05  FILLER                     PIC X(028) VALUE SPACES.
               05  RPT-DETA-NUM-TOPE          PIC ZZZ.ZZ9.
               05  FILLER                     PIC X(011) VALUE SPACES.
               05  RPT-DETA-VAL-TCAP          PIC ZZ.ZZZ.ZZZ.ZZ9,9999.

      ***** CRW-FINAL

       PROCEDURE DIVISION.
      *==================

      ***** CRW-COMIENZO
      *DECLARATIVES.
      ***** CRW-FINAL

       DEC-PH-ECC SECTION.

      ***** CRW-COMIENZO
      *    USE BEFORE REPORTING PH-ECC.
      ***** CRW-FINAL

       INI-PH-ECC.
      *<<<< IF PH_ECC
      *Recupera glosa de oficina
      *    MOVE WSS-COD-OFIA IN WSS-VARI TO WSS-COD-OFIC IN WSS-ECC.
      *    MOVE WSS-COD-OFIA IN WSS-VARI TO OFI-COD-OFIC IN OFI.
      *    PERFORM BUS-OFI.

      *Recupera glosa de moneda
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'VLR' TO TAB-COD-TTAB IN TAB.
           MOVE WSS-COD-VCAA IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-VCAM IN WSS-ECC.
      *>>>>
       FIN-PH-ECC.
           EXIT.

      ***** CRW-COMIENZO
      *END DECLARATIVES.
      ***** CRW-FINAL

       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'DAPPLECC' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      *<<<< INI
           DISPLAY ' '.
           DISPLAY 'INICIO CAPTURA PARAMETROS '.
           DISPLAY ' '.
      * Captura parametros
           DISPLAY 'INGRESE FECHA DE PROCESO (DDMMSSAA) : '.
           ACCEPT WSS-FEC-FPRO IN WSS-VARI.
           DISPLAY WSS-FEC-FPRO IN WSS-VARI.

      *    DISPLAY 'INGRESE CODIGO OFICINA      (XXX/*) :  '.
      *    ACCEPT WSS-COD-OFIC IN WSS-VARI.
      *    DISPLAY WSS-COD-OFIC IN WSS-VARI.

           DISPLAY 'INGRESE CODIGO MONEDA    (X(06)/*)  :  '.
           ACCEPT WSS-COD-VCAM IN WSS-VARI.
           DISPLAY WSS-COD-VCAM IN WSS-VARI.

           DISPLAY 'FIN CAPTURA PARAMETROS '.
           DISPLAY ' '.
           DISPLAY 'INICIO VALIDACION PARAMETROS '.

      *VAL-FEC Valida Fecha de Proceso
           MOVE WSS-FEC-FPRO IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N TO FEC-FBLK.
           MOVE FEC-CHOY-N TO FEC-CHOY.
           MOVE FEC-VHBL-N TO FEC-VHBL.
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR VALIDACION EN FECHA DE PROCESO: '
                         WSS-FEC-FPRO '  ' FEC-MENS
               PERFORM GNS-PRO-ABT.

      *VAL-OFI Valida Codigo de oficina
      *    IF WSS-COD-OFIC IN WSS-VARI > SPACES AND
      *       WSS-COD-OFIC IN WSS-VARI NOT = '*'
      *       DISPLAY WSS-COD-OFIC IN WSS-VARI
      *       MOVE WSS-COD-OFIC IN WSS-VARI TO OFI-COD-OFIC IN OFI
      *       PERFORM VAL-OFI
      *       IF MSG-GLS-MENS = 'COD    NEX'
      *           DISPLAY ' '
      *           DISPLAY ' PROCESO CANCELADO '
      *           DISPLAY ' ERROR VALIDACION OFICINA: '
      *                     WSS-COD-OFIC IN WSS-VARI
      *           PERFORM GNS-PRO-ABT.

      *BUS-TAB Valida Codigo de moneda
           IF WSS-COD-VCAM IN WSS-VARI > SPACES AND
              WSS-COD-VCAM IN WSS-VARI NOT = '*'
              DISPLAY WSS-COD-VCAM IN WSS-VARI
              MOVE 'TAB' TO TAB-COD-SIST
              MOVE 'VLR' TO TAB-COD-TTAB IN TAB
              MOVE WSS-COD-VCAM IN WSS-VARI TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              IF MSG-GLS-MENS = 'COD    NEX'
                  DISPLAY ' '
                  DISPLAY ' PROCESO CANCELADO '
                  DISPLAY ' ERROR VALIDACION COD. MONEDA: ' WSS-COD-VCAM
                  PERFORM GNS-PRO-ABT.

      *JVM/BCI 01-06-93
      * Obtiene Codigo Valor de Cambio de UF Mediante CIC de la Moneda '
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE PDB-CIC-0998   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0998  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
               PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-UEFE IN WSS-VARI.
      *JVM/BCI
           MOVE WSS-NUM-DPRO IN WSS-VARI TO WSS-NUM-DPRO IN WSS-ECC
                                            WSS-NUM-DPRO IN WSS-ECI
                                            WSS-NUM-DTER IN WSS-VARI.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO WSS-NUM-MPRO IN WSS-ECC
                                            WSS-NUM-MPRO IN WSS-ECI
                                            WSS-NUM-MTER IN WSS-VARI.
           MOVE WSS-NUM-SPRO IN WSS-VARI TO WSS-NUM-SPRO IN WSS-ECC
                                            WSS-NUM-SPRO IN WSS-ECI
                                            WSS-NUM-STER IN WSS-VARI.
           MOVE WSS-NUM-APRO IN WSS-VARI TO WSS-NUM-APRO IN WSS-ECC
                                            WSS-NUM-APRO IN WSS-ECI
                                            WSS-NUM-ATER IN WSS-VARI.
           DISPLAY ' '.
           DISPLAY 'FIN VALIDACION PARAMETROS '.
           DISPLAY ' '.
      *>>>>
           SORT GNSSRT
       COPY DAPRSECC.
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
           IF PGM-STAT-SRT-MAL OR SORT-RETURN > 0
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
       FST-INP-SRT.
      *<<<< INI_FST_INP
           MOVE ZEROES TO OPD-FEC-FCMP IN OPD.
           MOVE ZEROES TO WSS-FEC-FINI IN WSS-VARI.
           MOVE 'OPD-FEC-FCMP' TO FIO-AKEY.

           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR AL ACCESAR OPD POR OPD-FEC-FCMP : '
                                                     FIO-STAT
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.
           IF OPD-FEC-FCMP IN OPD > WSS-FEC-FTER IN WSS-VARI
               DISPLAY 'NO HAY REGISTROS OPD EN RANGO DE FECHAS : '
                       'DESDE ' WSS-FEC-FINI IN WSS-VARI
                       ' A    ' WSS-FEC-FPRO IN WSS-VARI
               GO TO FIN-INP-SRT
           ELSE
               GO TO LUP-INP-SRT.
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
      *Controla ingreso de registros validos
      *    IF WSS-COD-OFIC IN WSS-VARI > SPACES AND
      *       WSS-COD-OFIC IN WSS-VARI NOT = '*'
      *       IF WSS-COD-OFIC IN WSS-VARI NOT = OPD-COD-OFIC IN OPD
      *          GO TO NXT-INP-SRT.

           IF WSS-COD-VCAM IN WSS-VARI > SPACES AND
              WSS-COD-VCAM IN WSS-VARI NOT = '*'
              IF WSS-COD-VCAM IN WSS-VARI NOT = OPD-COD-VCAM IN OPD
                 GO TO NXT-INP-SRT.

           IF OPD-VAL-SCAP IN OPD > ZEROES AND
              OPD-COD-STAT IN OPD = 'G'
              NEXT SENTENCE
           ELSE
              GO TO NXT-INP-SRT.

           MOVE OPD-COD-TINT IN OPD TO WSS-COD-TINT IN WSS-VARI.
           PERFORM OBT-TASA-BAS.
           MOVE INT-TINT TO OPD-SGV-TINT IN OPD.

      *JVM/BCI 01-06-93
           IF OPD-COD-VCAM IN OPD NOT = WSS-COD-UEFE IN WSS-VARI
              DIVIDE OPD-VAL-SCAP IN OPD BY 1000 GIVING
                                         OPD-VAL-SCAP IN OPD.
      *JVM/BCI
      *>>>>
       MOV-INP-SRT.
       COPY DAPRMECC.
           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
      *Ubica registro en OPD por fecha
           MOVE 'OPD-FEC-FCMP' TO FIO-AKEY.
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
      *<<<< FIN_NXT_INP
      *Controla ingreso de registros por fecha termino
           IF OPD-FEC-FCMP IN OPD > WSS-FEC-FTER IN WSS-VARI
              GO TO FIN-INP-SRT.
      *>>>>
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM DAP-FIO-OPD.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
           OPEN OUTPUT RPTECC.
           CALL 'GNSPLHDR' USING RPT-VARI.

      ***** CRW-COMIENZO
      *    INITIATE RPT-ECC.
      ***** CRW-FINAL

           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
      *<<<< FST_OUT
      *Carga tabla para primer registro
           PERFORM CLR-TBL-MON VARYING WSS-I FROM 1 BY 1 UNTIL
                                                     WSS-I > 20.
           PERFORM CLR-TBL-TAS VARYING WSS-J FROM 1 BY 1 UNTIL
                                                     WSS-J > 20.
           PERFORM CLR-VAR-ACU.
           PERFORM GEN-TBL-MON1.
           PERFORM GEN-TBL-TAS1.
           MOVE WSS-I IN WSS-VARI TO WSS-FINM IN WSS-VARI.
           MOVE WSS-J IN WSS-VARI TO WSS-FINT IN WSS-VARI.
      *    MOVE OPD-COD-OFIC IN SRT TO WSS-COD-OFIA IN WSS-VARI.
           MOVE OPD-COD-VCAM IN SRT TO WSS-COD-VCAA IN WSS-VARI.
           MOVE 1 TO WSS-IND-PRI IN WSS-VARI.
      *>>>>
       LUP-OUT-SRT.
      *<<<< LUP_OUT
      *     DISPLAY 'SRT ' SRT.
      *Genera datos desde archivo SORT.
      *    MOVE OPD-COD-OFIC IN SRT TO WSS-KEY-OFIC IN WSS-VARI.
           MOVE OPD-COD-VCAM IN SRT TO WSS-KEY-VCAM IN WSS-VARI.
           IF NOT ( WSS-KEY-SRT IN WSS-VARI = WSS-KEY-ANT IN WSS-VARI )
              PERFORM ACU-LST-MON
              PERFORM ACU-LST-TAS
      *       MOVE OPD-COD-OFIC IN SRT TO WSS-COD-OFIA IN WSS-VARI
              MOVE OPD-COD-VCAM IN SRT TO WSS-COD-VCAA IN WSS-VARI
              PERFORM CLR-VAR-ACU
              PERFORM CLR-TBL-MON VARYING WSS-I FROM 1 BY 1 UNTIL
                                                        WSS-I > 20
              PERFORM CLR-TBL-TAS VARYING WSS-J FROM 1 BY 1 UNTIL
                                                        WSS-J > 20
              PERFORM GEN-TBL-MON1
              PERFORM GEN-TBL-TAS1
              MOVE WSS-I IN WSS-VARI TO WSS-FINM IN WSS-VARI
              MOVE WSS-J IN WSS-VARI TO WSS-FINT IN WSS-VARI
              PERFORM GEN-TBL-MON2 VARYING WSS-I FROM 1 BY 1 UNTIL
                                                   WSS-I > WSS-FINM
              PERFORM GEN-TBL-TAS2 VARYING WSS-J FROM 1 BY 1 UNTIL
                                                   WSS-J > WSS-FINT
              MOVE 0 TO WSS-IND-PRI IN WSS-VARI
              MOVE 0 TO WSS-IND-CORT IN WSS-VARI
           ELSE
              MOVE 1 TO WSS-IND-CORT IN WSS-VARI
              PERFORM GEN-TBL-MON2 VARYING WSS-I FROM 1 BY 1 UNTIL
                                                   WSS-I > WSS-FINM
              PERFORM GEN-TBL-TAS2 VARYING WSS-J FROM 1 BY 1 UNTIL
                                                   WSS-J > WSS-FINT.

           GO TO NXT-OUT-SRT.
      *>>>>
       GEN-OUT-SRT.

      ***** CRW-COMIENZO
      *    GENERATE DL-ECC.

      ***** CRW-FINAL

       NXT-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
      *<<<< FIN_OUT
           IF WSS-IND-CORT IN WSS-VARI = 1 OR
              WSS-IND-PRI  IN WSS-VARI = 1
              PERFORM GEN-TBL-MON2 VARYING WSS-I FROM 1 BY 1 UNTIL
                                                   WSS-I > WSS-FINM
              PERFORM GEN-TBL-TAS2 VARYING WSS-J FROM 1 BY 1 UNTIL
                                                   WSS-J > WSS-FINT
              PERFORM ACU-LST-MON
              PERFORM ACU-LST-TAS.
      *>>>>

      ***** CRW-COMIENZO
      *    TERMINATE RPT-ECC.
      ***** CRW-FINAL

           CLOSE RPTECC.
       EXT-OUT-SRT.
           EXIT.

       COPY DAPBFOPD.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGABT.

      *<<<< EOF
      *Limpia matriz
       CLR-TBL-MON SECTION.
       INI-CLR-TBL-MON.
           MOVE SPACES TO WSS-GLS-TRAM IN WSS-VARI(WSS-I).
           MOVE ZEROES TO WSS-NUM-VFIN IN WSS-VARI(WSS-I).
           MOVE ZEROES TO WSS-NUM-OPER IN WSS-VARI(WSS-I).
           MOVE ZEROES TO WSS-POR-OPER IN WSS-VARI(WSS-I).
           MOVE ZEROES TO WSS-POT-OPER IN WSS-VARI(WSS-I).
           MOVE ZEROES TO WSS-VAL-CAPT IN WSS-VARI(WSS-I).
           MOVE ZEROES TO WSS-POR-CAPT IN WSS-VARI(WSS-I).
           MOVE ZEROES TO WSS-POT-CAPT IN WSS-VARI(WSS-I).
       FIN-CLR-TBL-MON.
           EXIT.

       CLR-TBL-TAS SECTION.
       INI-CLR-TBL-TAS.
           MOVE SPACES TO WSS-GLS-TRAT IN WSS-VARI(WSS-J).
           MOVE ZEROES TO WSS-SGV-VFIN IN WSS-VARI(WSS-J).
           MOVE ZEROES TO WSS-NUM-OPET IN WSS-VARI(WSS-J).
           MOVE ZEROES TO WSS-VAL-CAPI IN WSS-VARI(WSS-J).
       FIN-CLR-TBL-TAS.
           EXIT.

       CLR-VAR-ACU SECTION.
       INI-CLR-VAR-ACU.
           MOVE ZEROES TO WSS-TOT-OPER IN WSS-VARI.
           MOVE ZEROES TO WSS-TOT-CAPT IN WSS-VARI.
           MOVE ZEROES TO WSS-ACU-CAPT IN WSS-VARI.
           MOVE ZEROES TO WSS-ACU-OPER IN WSS-VARI.
       FIN-CLR-VAR-ACU.
           EXIT.

       GEN-TBL-MON1 SECTION.
       INI-GEN-TBL-MON1.
           MOVE 0 TO WSS-IND-ERR1 IN WSS-VARI.
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'TMO' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-VCAM IN SRT TO WSS-COD-CTA1 IN WSS-VARI.
           MOVE SPACES              TO WSS-COD-CTA2 IN WSS-VARI.
           MOVE 001                 TO WSS-COD-CTA3 IN WSS-VARI.
           MOVE WSS-COD-CTAB IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS IN MSG = 'COD    NEX'
              DISPLAY 'ERROR EN ACCESO A TAB-TMO ' TAB-COD-CTAB
              MOVE 1 TO WSS-IND-ERR1 IN WSS-VARI
              GO TO FIN-GEN-TBL-MON1.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-CTAB IN WSS-VARI.
           MOVE ZEROS TO WSS-I IN WSS-VARI.

       LUP-MON.
           IF NOT ( FIO-STAT-OKS AND
              OPD-COD-VCAM IN SRT = WSS-COD-CTA1 IN WSS-VARI )
              GO TO FIN-GEN-TBL-MON1.
           ADD 1 TO WSS-I IN WSS-VARI
                    WSS-FINM IN WSS-VARI.
           MOVE TAB-GLS-DESC IN TAB TO
                                     WSS-GLS-TRAM IN WSS-VARI(WSS-I).
           MOVE TAB-GLS-DAT1 IN TAB TO
                                     WSS-GLS-TFIN IN WSS-VARI.
           MOVE WSS-NUM-TFIN IN WSS-VARI TO
                                     WSS-SGV-TFIN IN WSS-VARI.
           MOVE WSS-SGV-TFIN IN WSS-VARI TO
                                     WSS-NUM-VFIN IN WSS-VARI(WSS-I).
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF TAB-COD-TTAB IN TAB NOT = 'TMO'
              MOVE '23' TO FIO-STAT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-CTAB IN WSS-VARI.
           GO TO LUP-MON.
       FIN-GEN-TBL-MON1.
           EXIT.

       GEN-TBL-MON2 SECTION.
       INI-GEN-TBL-MON2.
           IF OPD-VAL-SCAP IN SRT NOT >
                                    WSS-NUM-VFIN IN WSS-VARI(WSS-I)
              ADD 1 TO WSS-NUM-OPER IN WSS-VARI(WSS-I)
              ADD OPD-VAL-SCAP IN SRT TO
                                    WSS-VAL-CAPT IN WSS-VARI(WSS-I)
              MOVE 20 TO WSS-I.
       FIN-GEN-TBL-MON2.
           EXIT.

       GEN-TBL-TAS1 SECTION.
       INI-GEN-TBL-TAS1.
           MOVE 0 TO WSS-IND-ERR2 IN WSS-VARI.
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'TTA' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-VCAM IN SRT TO WSS-COD-CTA1 IN WSS-VARI.
           MOVE SPACES              TO WSS-COD-CTA2 IN WSS-VARI.
           MOVE 001                 TO WSS-COD-CTA3 IN WSS-VARI.
           MOVE WSS-COD-CTAB IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS IN MSG = 'COD    NEX'
              DISPLAY 'ERROR EN ACCESO A TAB-TTA ' TAB-COD-CTAB
              MOVE 1 TO WSS-IND-ERR2 IN WSS-VARI
              GO TO FIN-GEN-TBL-TAS1.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-CTAB IN WSS-VARI.
           MOVE ZEROES TO WSS-J IN WSS-VARI.

       LUP-TAS.
           IF NOT ( FIO-STAT-OKS AND
              OPD-COD-VCAM IN SRT = WSS-COD-CTA1 IN WSS-VARI )
              GO TO FIN-GEN-TBL-TAS1.
           ADD 1 TO WSS-J IN WSS-VARI
                    WSS-FINT IN WSS-VARI.
           MOVE TAB-GLS-DESC IN TAB TO
                                     WSS-GLS-TRAT IN WSS-VARI(WSS-J).
           MOVE TAB-GLS-DAT1 IN TAB TO
                                     WSS-GLS-TASF IN WSS-VARI.
           MOVE WSS-SGV-TASF IN WSS-VARI TO
                                     WSS-SGV-VFIN IN WSS-VARI(WSS-J).
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF TAB-COD-TTAB IN TAB NOT = 'TTA'
              MOVE '23' TO FIO-STAT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-CTAB IN WSS-VARI.
           GO TO LUP-TAS.
       FIN-GEN-TBL-TAS1.
           EXIT.

       GEN-TBL-TAS2 SECTION.
       INI-GEN-TBL-TAS2.
           IF OPD-SGV-TINT IN SRT NOT >
                                    WSS-SGV-VFIN IN WSS-VARI(WSS-J)
              ADD 1 TO WSS-NUM-OPET IN WSS-VARI(WSS-J)
              ADD OPD-VAL-SCAP IN SRT TO
                                    WSS-VAL-CAPI IN WSS-VARI(WSS-J)
              MOVE 20 TO WSS-J.
       FIN-GEN-TBL-TAS2.
           EXIT.

       ACU-LST-MON SECTION.
       INI-ACU-LST-MON.
      *Genera datos desde TABLA en WSS.
           PERFORM ACU-REG-MON VARYING WSS-I FROM 1 BY 1 UNTIL
                                                 WSS-I > WSS-FINM.
           PERFORM CAL-REG-MON VARYING WSS-I FROM 1 BY 1 UNTIL
                                                 WSS-I > WSS-FINM.
           PERFORM LST-REG-MON VARYING WSS-I FROM 1 BY 1 UNTIL
                                                 WSS-I > WSS-FINM.
           PERFORM LST-TOT-MON.
       FIN-ACU-LST-MON.
           EXIT.

       ACU-REG-MON SECTION.
       INI-ACU-REG-MON.
           ADD WSS-NUM-OPER IN WSS-VARI(WSS-I)  TO
                                       WSS-TOT-OPER IN WSS-VARI.
           ADD WSS-VAL-CAPT IN WSS-VARI(WSS-I)  TO
                                       WSS-TOT-CAPT IN WSS-VARI.
       FIN-ACU-REG-MON.
           EXIT.

       CAL-REG-MON SECTION.
       INI-CAL-REG-MON.
           IF WSS-TOT-OPER IN WSS-VARI = ZEROS
              MOVE ZEROS TO WSS-POR-OPER IN WSS-VARI(WSS-I)
           ELSE
              COMPUTE WSS-POR-OPER IN WSS-VARI(WSS-I) ROUNDED =
                  (WSS-NUM-OPER IN WSS-VARI(WSS-I) * 100) /
                                      WSS-TOT-OPER IN WSS-VARI.
      *Calcula porcentaje operacion
           IF WSS-POR-OPER IN WSS-VARI(WSS-I) = ZEROES
              MOVE ZEROES  TO WSS-POT-OPER IN WSS-VARI(WSS-I)
           ELSE
              ADD WSS-POR-OPER IN WSS-VARI(WSS-I) TO
                                       WSS-ACU-OPER IN WSS-VARI
              MOVE WSS-ACU-OPER IN WSS-VARI TO
                                WSS-POT-OPER IN WSS-VARI(WSS-I).
      *Calcula porcentaje capital
           IF WSS-TOT-CAPT IN WSS-VARI = ZEROS
              MOVE ZEROS TO WSS-POR-CAPT IN WSS-VARI(WSS-I)
           ELSE
              COMPUTE WSS-POR-CAPT IN WSS-VARI(WSS-I) ROUNDED =
                  (WSS-VAL-CAPT IN WSS-VARI(WSS-I) * 100) /
                                      WSS-TOT-CAPT IN WSS-VARI.
      *Acumula porcentaje capital
           IF WSS-POR-CAPT IN WSS-VARI(WSS-I) = ZEROES
              MOVE ZEROES  TO WSS-POT-CAPT IN WSS-VARI(WSS-I)
           ELSE
              ADD WSS-POR-CAPT IN WSS-VARI(WSS-I) TO
                                       WSS-ACU-CAPT IN WSS-VARI
              MOVE WSS-ACU-CAPT IN WSS-VARI TO
                                WSS-POT-CAPT IN WSS-VARI(WSS-I).
       FIN-CAL-REG-MON.
           EXIT.

       LST-REG-MON SECTION.
       INI-LST-REG-MON.
           MOVE WSS-GLS-TRAM IN WSS-VARI(WSS-I)  TO
                                       WSS-GLS-TRAM IN WSS-ECC.
           MOVE WSS-NUM-OPER IN WSS-VARI(WSS-I)  TO
                                       WSS-NUM-OPER IN WSS-ECC.
           MOVE WSS-POR-OPER IN WSS-VARI(WSS-I)  TO
                                       WSS-NUM-POTR IN WSS-ECC.
           MOVE WSS-POT-OPER IN WSS-VARI(WSS-I)  TO
                                       WSS-VAL-POTT IN WSS-ECC.
           MOVE WSS-VAL-CAPT IN WSS-VARI(WSS-I)  TO
                                       WSS-VAL-CAPT IN WSS-ECC.
           MOVE WSS-POR-CAPT IN WSS-VARI(WSS-I)  TO
                                       WSS-VAL-PCTR IN WSS-ECC.
           MOVE WSS-POT-CAPT IN WSS-VARI(WSS-I)  TO
                                       WSS-VAL-PCTT IN WSS-ECC.
           ADD WSS-NUM-OPER IN WSS-ECC TO
                                      WSS-SUM-OPER IN WSS-VARI.
           ADD WSS-VAL-CAPT IN WSS-ECC TO
                                      WSS-SUM-CAPT IN WSS-VARI.

      ***** CRW-COMIENZO
      *    GENERATE DL-ECC.

           MOVE WSS-GLS-TRAM IN WSS-ECC        TO RPT-DETA-GLS-TRAM
                                                  IN DL-ECC-08
           MOVE WSS-NUM-OPER IN WSS-ECC        TO RPT-DETA-NUM-OPER
                                                  IN DL-ECC-08
           MOVE WSS-NUM-POTR IN WSS-ECC        TO RPT-DETA-NUM-POTR
           MOVE WSS-VAL-POTT IN WSS-ECC        TO RPT-DETA-VAL-POTT
           MOVE WSS-VAL-CAPT IN WSS-ECC        TO RPT-DETA-VAL-CAPT
                                                  IN DL-ECC-08
           MOVE WSS-VAL-PCTR IN WSS-ECC        TO RPT-DETA-VAL-PCTR
           MOVE WSS-VAL-PCTT IN WSS-ECC        TO RPT-DETA-VAL-PCTT
           MOVE WSS-GLS-BLK1 IN WSS-ECC        TO RPT-DETA-GLS-BLK1

           IF RPT-VARI-LINEA > 59 OR RPT-VARI-PAGE-COUNTER = 0
              PERFORM TITULOS
           END-IF.
           WRITE RPTECC-REG FROM  DL-ECC-08.
           ADD 01 TO RPT-VARI-LINEA.
           GO TO FIN-LST-REG-MON.

       TITULOS.
      *********
           PERFORM DEC-PH-ECC.
           MOVE RPT-DUSU                       TO RPT-HEAD-DUSU
           MOVE RPT-FDMA                       TO RPT-HEAD-FDMA
           MOVE RPT-DSIS                       TO RPT-HEAD-DSIS
           MOVE WSS-NUM-DPRO IN WSS-ECC        TO RPT-HEAD-NUM-DPRO
           MOVE WSS-NUM-MPRO IN WSS-ECC        TO RPT-HEAD-NUM-MPRO
           MOVE WSS-NUM-SPRO IN WSS-ECC        TO RPT-HEAD-NUM-SPRO
           MOVE WSS-NUM-APRO IN WSS-ECC        TO RPT-HEAD-NUM-APRO
      *    MOVE WSS-COD-OFIC IN WSS-ECC        TO RPT-HEAD-COD-OFIC
      *    MOVE OFI-GLS-DESC                   TO RPT-HEAD-GLS-DESC
           MOVE WSS-GLS-VCAM IN WSS-ECC        TO RPT-HEAD-GLS-VCAM
           ADD 1 TO RPT-VARI-PAGE-COUNTER
           MOVE RPT-VARI-PAGE-COUNTER TO RPT-HEAD-PAGE-COUNTER
           MOVE SPACES TO RPTECC-REG
           WRITE RPTECC-REG AFTER PAGE
           WRITE RPTECC-REG FROM  PH-ECC-01
           WRITE RPTECC-REG FROM  PH-ECC-02
           WRITE RPTECC-REG FROM  PH-ECC-03
           WRITE RPTECC-REG FROM  PH-ECC-04
           WRITE RPTECC-REG FROM  PH-ECC-05
           WRITE RPTECC-REG FROM  PH-ECC-06
           WRITE RPTECC-REG FROM  PH-ECC-07
           MOVE 09 TO RPT-VARI-LINEA.
      ***** CRW-FINAL

       FIN-LST-REG-MON.
           EXIT.

       LST-TOT-MON SECTION.
       INI-LST-TOT-MON.
           MOVE WSS-SUM-OPER IN WSS-VARI TO
                                       WSS-NUM-TOPE IN WSS-ECC.
           MOVE WSS-SUM-CAPT IN WSS-VARI TO
                                       WSS-VAL-TCAP IN WSS-ECC.

      ***** CRW-COMIENZO
      *    GENERATE DL-TECC.

           MOVE WSS-NUM-TOPE IN WSS-ECC        TO RPT-DETA-NUM-TOPE
                                                  IN DL-TEC-10
           MOVE WSS-VAL-TCAP IN WSS-ECC        TO RPT-DETA-VAL-TCAP
                                                  IN DL-TEC-10
           MOVE WSS-GLS-BLK2 IN WSS-ECC        TO RPT-DETA-GLS-BLK2
           MOVE WSS-GLS-BLK3 IN WSS-ECC        TO RPT-DETA-GLS-BLK3
      *    MOVE OPD-COD-OFIC IN SRT            TO RPT-DETA-COD-OFIC
           MOVE OPD-COD-VCAM IN SRT            TO RPT-DETA-COD-VCAM
           MOVE OPD-VAL-SCAP IN SRT            TO RPT-DETA-VAL-SCAP
           MOVE OPD-SGV-TINT IN SRT            TO RPT-DETA-SGV-TINT

           IF RPT-VARI-LINEA > 59 OR RPT-VARI-PAGE-COUNTER = 0
              PERFORM TITULOS
           END-IF.
           WRITE RPTECC-REG FROM  DL-TEC-09.
           WRITE RPTECC-REG FROM  DL-TEC-10.
           WRITE RPTECC-REG FROM  DL-TEC-11.
           ADD 03 TO RPT-VARI-LINEA.

      ***** CRW-FINAL

           MOVE ZEROES TO WSS-SUM-OPER IN WSS-VARI.
           MOVE ZEROES TO WSS-SUM-CAPT IN WSS-VARI.
       FIN-LST-TOT-MON.
           EXIT.

       ACU-LST-TAS SECTION.
       INI-ACU-LST-TAS.
      *Genera datos desde TABLA en WSS.
           PERFORM ACU-REG-TAS VARYING WSS-J FROM 1 BY 1 UNTIL
                                                 WSS-J > WSS-FINT.

      ***** CRW-COMIENZO
      *    GENERATE DL-EECI.

           MOVE WSS-NUM-DPRO IN WSS-ECI        TO RPT-DETA-NUM-DPRO
           MOVE WSS-NUM-MPRO IN WSS-ECI        TO RPT-DETA-NUM-MPRO
           MOVE WSS-NUM-SPRO IN WSS-ECI        TO RPT-DETA-NUM-SPRO
           MOVE WSS-NUM-APRO IN WSS-ECI        TO RPT-DETA-NUM-APRO

           PERFORM TITULOS-1.

      ***** CRW-FINAL

           PERFORM LST-REG-TAS VARYING WSS-J FROM 1 BY 1 UNTIL
                                                 WSS-J > WSS-FINT.

           PERFORM LST-TOT-TAS.
       FIN-ACU-LST-TAS.
           EXIT.

       ACU-REG-TAS SECTION.
       INI-ACU-REG-TAS.
           ADD WSS-NUM-OPET IN WSS-VARI(WSS-J)  TO
                                       WSS-TOT-OPET IN WSS-VARI.
           ADD WSS-VAL-CAPI IN WSS-VARI(WSS-J)  TO
                                       WSS-TOT-CAPI IN WSS-VARI.
       FIN-ACU-REG-TAS.
           EXIT.

       LST-REG-TAS SECTION.
       INI-LST-REG-TAS.
           MOVE WSS-GLS-TRAT IN WSS-VARI(WSS-J)  TO
                                       WSS-GLS-TRAM IN WSS-ECI.
           MOVE WSS-NUM-OPET IN WSS-VARI(WSS-J)  TO
                                       WSS-NUM-OPER IN WSS-ECI.
           MOVE WSS-VAL-CAPI IN WSS-VARI(WSS-J)  TO
                                       WSS-VAL-CAPT IN WSS-ECI.
           ADD WSS-NUM-OPER IN WSS-ECI TO
                                      WSS-SUM-OPET IN WSS-VARI.
           ADD WSS-VAL-CAPT IN WSS-ECI TO
                                      WSS-SUM-CAPI IN WSS-VARI.

      ***** CRW-COMIENZO
      *    GENERATE DL-ECI.

           MOVE WSS-GLS-TRAM IN WSS-ECI        TO RPT-DETA-GLS-TRAM
                                                  IN DL-ECI-05
           MOVE WSS-NUM-OPER IN WSS-ECI        TO RPT-DETA-NUM-OPER
                                                  IN DL-ECI-05
           MOVE WSS-VAL-CAPT IN WSS-ECI        TO RPT-DETA-VAL-CAPT
                                                  IN DL-ECI-05
           IF RPT-VARI-LINEA > 59 OR RPT-VARI-PAGE-COUNTER = 0
              PERFORM TITULOS-1
           END-IF.
           WRITE RPTECC-REG FROM  DL-ECI-05.
           ADD 01 TO RPT-VARI-LINEA.
           GO TO FIN-LST-REG-TAS.

       TITULOS-1.
      ***********
           WRITE RPTECC-REG FROM  DL-EEC-01.
           WRITE RPTECC-REG FROM  DL-EEC-02.
           WRITE RPTECC-REG FROM  DL-EEC-03.
           WRITE RPTECC-REG FROM  DL-EEC-04.
           ADD 04 TO RPT-VARI-LINEA.

      ***** CRW-FINAL

       FIN-LST-REG-TAS.
           EXIT.

       LST-TOT-TAS SECTION.
       INI-LST-TOT-TAS.
           MOVE WSS-SUM-OPET IN WSS-VARI TO
                                       WSS-NUM-TOPE IN WSS-ECI.
           MOVE WSS-SUM-CAPI IN WSS-VARI TO
                                       WSS-VAL-TCAP IN WSS-ECI.

      ***** CRW-COMIENZO
      *    GENERATE DL-TECI.

           MOVE WSS-GLS-BLK0 IN WSS-ECI        TO RPT-DETA-GLS-BLK0
           MOVE WSS-NUM-TOPE IN WSS-ECI        TO RPT-DETA-NUM-TOPE
                                                  IN DL-TEC-07
           MOVE WSS-VAL-TCAP IN WSS-ECI        TO RPT-DETA-VAL-TCAP
                                                  IN DL-TEC-07
           WRITE RPTECC-REG FROM  DL-TEC-06.
           WRITE RPTECC-REG FROM  DL-TEC-07.
           ADD 02 TO RPT-VARI-LINEA.

      *    MOVE '67' TO LINE-COUNTER.
           MOVE 67 TO RPT-VARI-LINEA.
      ***** CRW-FINAL

           MOVE ZEROES TO WSS-SUM-OPET IN WSS-VARI.
           MOVE ZEROES TO WSS-SUM-CAPI IN WSS-VARI.
       FIN-LST-TOT-TAS.
           EXIT.

      *Entidades  de GNS
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBBMSG.
       COPY GNSBBTAB.

      *Entidades  de TAB
       COPY TABBFCAM.
       COPY TABBFOFI.
       COPY TABBBOFI.
       COPY TABBVOFI.

      * Obtiene tasa base para operaciones con T. Variable
       OBT-TASA-BAS SECTION.
       INI-OBT-TASA-BAS.
           MOVE OPD-SGV-TINT IN OPD TO INT-TINT.
      *Si es tasa variable
           IF ( WSS-COD-CVTI IN WSS-VARI > SPACES )
                MOVE OPD-FEC-FREA IN OPD TO CAM-FEC-FCAM IN CAM(1)
                MOVE OPD-FEC-FREA IN OPD TO CAM-FEC-FCAM IN CAM(2)
                MOVE 'I'          TO CAM-MSC-TVAL IN CAM(1)
                MOVE WSS-COD-CVTI TO CAM-COD-CVAL IN CAM(1)
                MOVE WSS-COD-PBTI TO CAM-COD-TCAM IN CAM(1)
                MOVE OPD-COD-VCAM IN OPD TO CAM-COD-VCAM IN CAM(2)

                MOVE FIO-GET-KEY TO FIO-CMND
                PERFORM TAB-FIO-CAM
                IF ( NOT FIO-STAT-OKS ) OR
                   ( CAM-MSC-STAT IN CAM NOT = 'S' )
                    DISPLAY 'NO EXISTE VALOR DE CAMBIO TASA BASE'
                             CAM-KEY-IREG IN CAM
                ELSE
                    ADD CAM-SGV-VCAM IN CAM TO INT-TINT
                    DISPLAY 'TASA BASE ' CAM-SGV-VCAM IN CAM ' '
                         OPD-SGV-TINT IN OPD ' ' INT-TINT.
       FIN-OBT-TASA-BAS.
           EXIT.
      *>>>>

