000000 IDENTIFICATION DIVISION.
000000*=======================
000000 PROGRAM-ID.      DAPPLRDC.
000000 AUTHOR.          P CONCHA L.
000000 DATE-WRITTEN.    30-NOV-93.
      ******************************************************************
      *  INTERSOFT                                                     *
      *  MIGRACION A COBOL OS/390                                      *
      *  FECHA: 30 DE MARZO DE 1998                                    *
      ******************************************************************
000000******************************************************************
000000*  SISTEMA    : DEPOSITOS A PLAZO
000000*  SUB-SISTEMA: INFORMES DAP
000000*  ANALISTA   : CECILIA PIZARRO.
000000*  OBJETIVO :
000000*           - GENERAR INFORME RESUMEN DIARIO DE CAPTACIONES
000000*  ARCHIVOS :
000000*  INP      :
000000*             DAPTGROF TABLA DE GRUPO DE OFICINAS
000000*             DAPTGRPL TABLA DE GRUPO DE PLAZOS
000000*             DAPTFACT TABLA DE VALORES DE ACTUALIZACION
000000*             DAPDEST  ARCHIVO DE ACUMULACION DE SALDOS DIARIOS
000000*             TABLA TAB: BD 150
000000*  OUT      :
000000*             DAPLRDC  INFORME RESUMEN DIARIO DE CAPTACIONES
000000*  WRK      :
000000*             FSORT    ARCHIVO PARA ORDENAMIENTO
000000*
000000*   CECILIA PIZARRO. 26.01.94
000000*           - SE MODIFICA LA FORMA DE CALCULO DE TASA REAL
000000*
000000*   P CONCHA L.      29.04.94
000000*           - SE MODIFICA LA FORMA DE CALCULO DE TASA REAL
000000*
000000******************************************************************
000000     EJECT
000000 ENVIRONMENT DIVISION.
000000*====================
000000 CONFIGURATION SECTION.
000000*---------------------
000000 SPECIAL-NAMES.
000000      C01 IS CANAL-1
000000      DECIMAL-POINT IS COMMA.
000000 INPUT-OUTPUT SECTION.
000000*--------------------
000000 FILE-CONTROL.
000000     SELECT DAPTGROF       ASSIGN TO        UT-S-DAPTGROF.
000000     SELECT DAPTGRPL       ASSIGN TO        UT-S-DAPTGRPL.
000000     SELECT DAPTFACT       ASSIGN TO        UT-S-DAPTFACT.
000000     SELECT DAPDEST        ASSIGN TO        DAPDEST
000000        ORGANIZATION IS INDEXED
000000        ACCESS       IS DYNAMIC
000000        RECORD KEY   IS DAPDEST-KEY-IEST
000000        FILE STATUS  IS FS-DAPDEST.
000000     SELECT FSORT          ASSIGN TO        UT-S-SORTWK1.
000000     SELECT DAPLRDC        ASSIGN TO        UT-S-DAPLRDC.
000000     EJECT
000000 DATA DIVISION.
000000*=============
000000 FILE SECTION.
000000*
000000 FD  DAPTGROF
000000     RECORDING MODE IS F
000000     BLOCK CONTAINS 0 RECORDS
000000     LABEL RECORDS STANDARD.
000000 01  REG-DAPTGROF.
000000     05 DAPTGROF-COD-OFIC PIC X(03).
000000     05 FILLER            PIC X(01).
000000     05 DAPTGROF-COD-GROF PIC X(01).
000000     05 FILLER            PIC X(01).
000000     05 DAPTGROF-GLS-GROF PIC X(09).
000000     05 FILLER            PIC X(65).
000000*
000000 FD  DAPTGRPL
000000     RECORDING MODE IS F
000000     BLOCK CONTAINS 0 RECORDS
000000     LABEL RECORDS STANDARD.
000000 01  REG-DAPTGRPL.
000000     05 DAPTGRPL-COD-VCAM PIC X(06).
000000     05 FILLER            PIC X(01).
000000     05 DAPTGRPL-PLZ-MINI PIC 9(03).
000000     05 FILLER            PIC X(01).
000000     05 DAPTGRPL-PLZ-MAXI PIC 9(03).
000000     05 FILLER            PIC X(01).
000000     05 DAPTGRPL-GLS-GRPL PIC X(10).
000000     05 FILLER            PIC X(55).
000000*
000000 FD  DAPTFACT
000000     RECORDING MODE IS F
000000     BLOCK CONTAINS 0 RECORDS
000000     LABEL RECORDS STANDARD.
000000 01  REG-DAPTFACT.
000000     05 DAPTFACT-FEC-FPRO PIC X(08).
000000     05 FILLER            PIC X(01).
000000     05 DAPTFACT-COD-VCAM PIC X(06).
000000     05 FILLER            PIC X(01).
000000     05 DAPTFACT-PLZ-MINI PIC 9(03).
000000     05 FILLER            PIC X(01).
000000     05 DAPTFACT-PLZ-MAXI PIC 9(03).
000000     05 FILLER            PIC X(01).
000000     05 DAPTFACT-VAL-FACT PIC 9(02)V9(04).
000000     05 FILLER            PIC X(50).
000000*
      *
       FD  DAPDEST
      ******************************************************************
      * ARCHIVO: DAPDEST    TIPO: VSAM KSDS   REGISTRO: FIJO
      *
      * ARCHIVO DE DATOS ESTADISTICOS DEPOSITOS A PLAZO
      *
      * LARGO REGISTRO             130 BYTES
      ******************************************************************
           LABEL RECORD STANDARD.
       01  REG-DAPDEST.
           05 DAPDEST-KEY-IEST.
              10 DAPDEST-FEC-FPRO.
                 15 DAPDEST-NUM-SPRO     PIC 9(02).
                 15 DAPDEST-NUM-APRO     PIC 9(02).
                 15 DAPDEST-NUM-MPRO     PIC 9(02).
                 15 DAPDEST-NUM-DPRO     PIC 9(02).
              10 DAPDEST-COD-OFIC        PIC X(03).
              10 DAPDEST-COD-VCAM        PIC X(06).
              10 DAPDEST-NUM-DURV        PIC 9(05).
           05 DAPDEST-OPE-SALD-TOTA      PIC S9(13)V9(04) COMP-3.
           05 DAPDEST-OPE-NUME-TOTA      PIC S9(11)       COMP-3.
           05 DAPDEST-OPE-SALD-TPLA      PIC S9(13)V9(04) COMP-3.
           05 DAPDEST-OPE-NUME-TPLA      PIC S9(11)       COMP-3.
           05 DAPDEST-OPE-SALD-TAUT      PIC S9(13)V9(04) COMP-3.
           05 DAPDEST-OPE-NUME-TAUT      PIC S9(11)       COMP-3.
           05 DAPDEST-OPE-TASA-MINI      PIC S9(05)V9(04) COMP-3.
           05 DAPDEST-OPE-TASA-MAXI      PIC S9(05)V9(04) COMP-3.
           05 DAPDEST-OPE-SUMA-MIXTI     PIC S9(13)V9(04) COMP-3.
           05 DAPDEST-OPE-PROM-PLZO      PIC S9(05)       COMP-3.
           05 DAPDEST-OPE-SUMA-MIXPI     PIC S9(13)V9(04) COMP-3.
           05 FILLER                     PIC X(32).
      *
000000*
000000 SD  FSORT.
000000 01  REG-FSORT.
000000     05 FSORT-KEY.
000000        10 FSORT-FEC-FPRO        PIC X(08).
000000        10 FSORT-COD-VCAM        PIC X(06).
000000        10 FSORT-COD-GRPL        PIC X(06).
000000        10 FSORT-COD-GROF        PIC X(01).
000000     05 FSORT-OPE-SALD-TOTA      PIC S9(13)V9(04) COMP-3.
000000     05 FSORT-OPE-NUME-TOTA      PIC S9(11)       COMP-3.
000000     05 FSORT-OPE-SALD-TPLA      PIC S9(13)V9(04) COMP-3.
000000     05 FSORT-OPE-NUME-TPLA      PIC S9(11)       COMP-3.
000000     05 FSORT-OPE-SALD-TAUT      PIC S9(13)V9(04) COMP-3.
000000     05 FSORT-OPE-NUME-TAUT      PIC S9(11)       COMP-3.
000000     05 FSORT-OPE-TASA-MINI      PIC S9(05)V9(04) COMP-3.
000000     05 FSORT-OPE-TASA-MAXI      PIC S9(05)V9(04) COMP-3.
000000     05 FSORT-OPE-SUMA-MIXTI     PIC S9(13)V9(04) COMP-3.
000000     05 FSORT-OPE-SUMA-MIXPI     PIC S9(13)V9(04) COMP-3.
000000     05 FSORT-GLS-GRPL           PIC X(10).
000000     05 FSORT-GLS-GROF           PIC X(09).
000000*
000000 FD  DAPLRDC
000000     RECORDING MODE IS F
000000     BLOCK CONTAINS 0 RECORDS
000000     LABEL RECORDS STANDARD.
000000 01  REG-DAPLRDC       PIC X(132).
000000*
000000     EJECT
000000 WORKING-STORAGE SECTION.
000000*-----------------------
000000*
000000     COPY BIBBAUD1.
000000*
000000 01  W-CONTADORES.
000000     05 CNT-DAPTGROF-L           PIC 9(08) VALUE 0.
000000     05 CNT-DAPTGRPL-L           PIC 9(08) VALUE 0.
000000     05 CNT-DAPTFACT-L           PIC 9(08) VALUE 0.
000000     05 CNT-DAPDEST-L            PIC 9(08) VALUE 0.
000000     05 CNT-DAPDEST-S            PIC 9(08) VALUE 0.
000000     05 CNT-DAPDEST-I            PIC 9(08) VALUE 0.
000000     05 CNT-FSORT-G              PIC 9(08) VALUE 0.
000000     05 CNT-FSORT-L              PIC 9(08) VALUE 0.
000000     05 CNT-LINE-DAPLRDC         PIC 9(03) VALUE 0.
000000        88 SALTO-PAG-DAPLRDC               VALUE 60 THRU 99.
000000     05 CNT-PAGE-DAPLRDC         PIC 9(04) VALUE 0.
000000*
000000 01  WE-EXTERNAS.
000000     05 WE-FECHA-DATE.
000000        10 WE-AA-DATE            PIC 9(02).
000000        10 WE-MM-DATE            PIC 9(02).
000000        10 WE-DD-DATE            PIC 9(02).
000000*
000000 01  F-FILE-STATUS.
000000     05 FS-DAPTGROF              PIC 9(01) VALUE 0.
000000     05 FS-DAPTGRPL              PIC 9(01) VALUE 0.
000000     05 FS-DAPTFACT              PIC 9(01) VALUE 0.
000000     05 FS-DAPDEST               PIC 9(02) VALUE 0.
000000     05 FS-FSORT                 PIC 9(01) VALUE 0.
000000*
000000 01  W-VARIABLES.
000000     05 SW-CANCEL                PIC 9(01) VALUE 0.
000000*
000000 01  W-PARAMETROS.
000000* FECHA DE PROCESO
000000     05 WP-FEC-FPRI.
000000        10 WP-NUM-DPRI           PIC X(02).
000000        10 WP-NUM-MPRI           PIC X(02).
000000        10 WP-NUM-SPRI           PIC X(02).
000000        10 WP-NUM-APRI           PIC X(02).
000000*
000000 01  W-REGISTROS-DE-TRABAJO.
000000     05 WR-COD-VCAM              PIC X(06) VALUE SPACES.
000000     05 WR-GLS-VCAM              PIC X(20) VALUE SPACES.
000000     05 WR-COD-GRPL              PIC X(06) VALUE SPACES.
000000     05 WR-GLS-GRPL              PIC X(10) VALUE SPACES.
000000     05 WS-GLS-GRPL              PIC X(10) VALUE SPACES.
000000     05 WR-COD-GROF              PIC X(01) VALUE SPACES.
000000     05 WR-GLS-GROF              PIC X(09) VALUE SPACES.
000000     05 WS-GLS-GROF              PIC X(09) VALUE SPACES.
000000     05 WR-FEC-FPRO              PIC X(08) VALUE SPACES.
000000     05 WS-PERIODO               PIC 9(04) VALUE 0.
000000     05 WS-FEC-FFAC.
000000        10 WS-NUM-SFAC           PIC 9(02).
000000        10 WS-NUM-AFAC           PIC 9(02).
000000        10 WS-NUM-MFAC           PIC 9(02).
000000        10 WS-NUM-DFAC           PIC 9(02).
000000     05 WR-VAL-FACT     PIC S9(03)V9(04)        VALUE +0.
000000     05 WR-TASA-MINI    PIC S9(05)V9(04) COMP-3 VALUE +99999,9999.
000000     05 WR-TASA-MAXI    PIC S9(05)V9(04) COMP-3 VALUE +0.
000000*
000000 01  ACM-GROF.
000000     05 ACM-GROF-SALD-TOTA     PIC S9(14)V9(04) COMP-3.
000000     05 ACM-GROF-NUME-TOTA     PIC S9(08)       COMP-3.
000000     05 ACM-GROF-SALD-TPLA     PIC S9(14)V9(04) COMP-3.
000000     05 ACM-GROF-NUME-TPLA     PIC S9(08)       COMP-3.
000000     05 ACM-GROF-SALD-TAUT     PIC S9(14)V9(04) COMP-3.
000000     05 ACM-GROF-NUME-TAUT     PIC S9(08)       COMP-3.
000000     05 ACM-GROF-TASA-MINI     PIC S9(05)V9(04) COMP-3.
000000     05 ACM-GROF-TASA-MAXI     PIC S9(05)V9(04) COMP-3.
000000     05 ACM-GROF-SUMA-MIXTI    PIC S9(14)V9(04) COMP-3.
000000     05 ACM-GROF-PROM-PLZO     PIC S9(05)       COMP-3.
000000     05 ACM-GROF-SUMA-MIXPI    PIC S9(14)V9(04) COMP-3.
000000*
000000     EJECT
000000*
000000* TABLA DE GRUPO DE OFICINAS
000000*
000000 01  TABLA-GROF.
000000     05 TB-CNT-GROF                   PIC 9(08) VALUE IS 0.
000000     05 TB-BUS-GROF.
000000        10 TB-BUS-GROF-COD-OFIC       PIC X(03).
000000     05 TAB-GROF     OCCURS 0 TO 300 TIMES
000000                       DEPENDING ON TB-CNT-GROF
000000                       INDEXED BY IX-GROF.
000000        10 TB-GROF.
000000           15 TB-GROF-KEY.
000000              20 TB-GROF-KEY-COD-OFIC PIC X(03).
000000           15 TB-GROF-COD-GROF        PIC X(01).
000000           15 TB-GROF-GLS-GROF        PIC X(09).
000000*
000000     EJECT
000000*
000000* TABLA DE GRUPO DE PLAZOS
000000*
000000 01  TABLA-GRPL.
000000     05 TB-CNT-GRPL                   PIC 9(08) VALUE IS 0.
000000     05 TB-BUS-GRPL.
000000        10 TB-BUS-GRPL-COD-VCAM       PIC X(06).
000000        10 TB-BUS-GRPL-NUM-DURV       PIC 9(03).
000000     05 TAB-GRPL       OCCURS 0 TO 300 TIMES
000000                       DEPENDING ON TB-CNT-GRPL
000000                       INDEXED BY IX-GRPL.
000000        10 TB-GRPL.
000000           15 TB-GRPL-KEY.
000000              20 TB-GRPL-KEY-COD-VCAM    PIC X(06).
000000              20 TB-GRPL-KEY-COD-GRPL.
000000                 25 TB-GRPL-KEY-PLZ-MINI PIC 9(03).
000000                 25 TB-GRPL-KEY-PLZ-MAXI PIC 9(03).
000000           15 TB-GRPL-GLS-GRPL           PIC X(10).
000000*
000000     EJECT
000000*
000000* TABLA DE FACTORES DE ACTUALIZACION
000000*
000000 01  TABLA-FACT.
000000     05 TB-CNT-FACT                   PIC 9(08) VALUE IS 0.
000000     05 TB-BUS-FACT.
000000        10 TB-BUS-FACT-FEC-FPRO       PIC X(08).
000000        10 TB-BUS-FACT-COD-VCAM       PIC X(06).
000000        10 TB-BUS-FACT-COD-GRPL       PIC X(06).
000000     05 TAB-FACT       OCCURS 0 TO 300 TIMES
000000                       DEPENDING ON TB-CNT-FACT
000000                       INDEXED BY IX-FACT.
000000        10 TB-FACT.
000000           15 TB-FACT-KEY.
000000              20 TB-FACT-KEY-FEC-FPRO    PIC X(08).
000000              20 TB-FACT-KEY-COD-VCAM    PIC X(06).
000000              20 TB-FACT-KEY-COD-GRPL.
000000                 25 TB-FACT-KEY-PLZ-MINI PIC 9(03).
000000                 25 TB-FACT-KEY-PLZ-MAXI PIC 9(03).
000000           15 TB-FACT-VAL-FACT           PIC S9(03)V9(04).
000000*
000000     EJECT
000000*
000000* TABLA DE ACUMULACION Y CALCULO
000000*
000000 01  TABLA-ACMDIA.
000000     05 TB-CNT-ACMDIA  PIC 9(08) VALUE IS 0.
000000     05 TB-ACMDIA-BUS.
000000        10 TB-ACMDIA-BUS-FEC-FPRO PIC X(08).
000000        10 TB-ACMDIA-BUS-COD-VCAM PIC X(06).
000000        10 TB-ACMDIA-BUS-COD-GRPL PIC X(06).
000000        10 TB-ACMDIA-BUS-COD-GROF PIC X(01).
000000     05 TB-ACMDIA-AUX.
000000        10 TB-ACMDIA-KEY-AUX.
000000           15 TB-ACMDIA-KEY-FEC-FPRO-AUX PIC X(08).
000000           15 TB-ACMDIA-KEY-COD-VCAM-AUX PIC X(06).
000000           15 TB-ACMDIA-KEY-COD-GRPL-AUX PIC X(06).
000000           15 TB-ACMDIA-KEY-COD-GROF-AUX PIC X(01).
000000        10 TB-ACMDIA-SALD-TOTA-AUX       PIC S9(16)       COMP-3.
000000        10 TB-ACMDIA-NUME-TOTA-AUX       PIC S9(08)       COMP-3.
000000        10 TB-ACMDIA-SALD-TPLA-AUX       PIC S9(16)       COMP-3.
000000        10 TB-ACMDIA-NUME-TPLA-AUX       PIC S9(08)       COMP-3.
000000        10 TB-ACMDIA-SALD-TAUT-AUX       PIC S9(16)       COMP-3.
000000        10 TB-ACMDIA-NUME-TAUT-AUX       PIC S9(08)       COMP-3.
000000        10 TB-ACMDIA-TASA-MINI-AUX       PIC S9(03)V9(04) COMP-3.
000000        10 TB-ACMDIA-TASA-MAXI-AUX       PIC S9(03)V9(04) COMP-3.
000000        10 TB-ACMDIA-SUMA-MIXTI-AUX      PIC S9(14)V9(04) COMP-3.
000000        10 TB-ACMDIA-PROM-PLZO-AUX       PIC S9(05)       COMP-3.
000000        10 TB-ACMDIA-SUMA-MIXPI-AUX      PIC S9(14)V9(04) COMP-3.
000000        10 TB-ACMDIA-TASA-PROM-AUX       PIC S9(03)V9(04) COMP-3.
000000        10 TB-ACMDIA-VAL-FACT-AUX        PIC S9(03)V9(04) COMP-3.
000000        10 TB-ACMDIA-TASA-TRPA-AUX       PIC S9(03)V9(04) COMP-3.
000000        10 TB-ACMDIA-GLS-GRPL-AUX        PIC X(10).
000000        10 TB-ACMDIA-GLS-GROF-AUX        PIC X(09).
000000     05 TAB-ACMDIA     OCCURS 0 TO 5000 TIMES
000000                       DEPENDING ON TB-CNT-ACMDIA
000000                       INDEXED BY IX-ACMDIA
000000                                  IY-ACMDIA.
000000        10 TB-ACMDIA.
000000           15 TB-ACMDIA-KEY.
000000              20 TB-ACMDIA-KEY-FEC-FPRO PIC X(08).
000000              20 TB-ACMDIA-KEY-COD-VCAM PIC X(06).
000000              20 TB-ACMDIA-KEY-COD-GRPL PIC X(06).
000000              20 TB-ACMDIA-KEY-COD-GROF PIC X(01).
000000           15 TB-ACMDIA-SALD-TOTA       PIC S9(16)       COMP-3.
000000           15 TB-ACMDIA-NUME-TOTA       PIC S9(08)       COMP-3.
000000           15 TB-ACMDIA-SALD-TPLA       PIC S9(16)       COMP-3.
000000           15 TB-ACMDIA-NUME-TPLA       PIC S9(08)       COMP-3.
000000           15 TB-ACMDIA-SALD-TAUT       PIC S9(16)       COMP-3.
000000           15 TB-ACMDIA-NUME-TAUT       PIC S9(08)       COMP-3.
000000           15 TB-ACMDIA-TASA-MINI       PIC S9(03)V9(04) COMP-3.
000000           15 TB-ACMDIA-TASA-MAXI       PIC S9(03)V9(04) COMP-3.
000000           15 TB-ACMDIA-SUMA-MIXTI      PIC S9(14)V9(04) COMP-3.
000000           15 TB-ACMDIA-PROM-PLZO       PIC S9(05)       COMP-3.
000000           15 TB-ACMDIA-SUMA-MIXPI      PIC S9(14)V9(04) COMP-3.
000000           15 TB-ACMDIA-TASA-PROM       PIC S9(03)V9(04) COMP-3.
000000           15 TB-ACMDIA-VAL-FACT        PIC S9(03)V9(04) COMP-3.
000000           15 TB-ACMDIA-TASA-TRPA       PIC S9(03)V9(04) COMP-3.
000000           15 TB-ACMDIA-GLS-GRPL        PIC X(10).
000000           15 TB-ACMDIA-GLS-GROF        PIC X(09).
000000*
000000     EJECT
000000******************************************************************
000000*                   WORK AREA                                    *
000000******************************************************************
000000*
000000 01  REG-TAB.
000000*    COPYDD TAB-R-TAB.TAB-E-TAB00(PROD),02,D
      *                             EQUIVALENTE AL REGISTRO TAB
           02  TAB-E-TAB00.
      *                             REGISTRO GENERICO DE TABLAS
               04  TAB.
      *                             FILLER COMPATIBILIDAD VSAM/MVS
                   06  TAB-GLS-FLAG PICTURE X(1).
      *                             CLAVE PRIMARIA REGISTRO
                   06  TAB-KEY-IREG.
      *                             KEY     TIPO + CODIGO ( LLAVE PRIMAR
                       08  TAB-COD-TABL.
      *                             CODIGO TIPO TABLA
                       10  TAB-COD-TTAB
                                    PICTURE X(3).
      *                             CODIGO TABLA
                       10  TAB-COD-CTAB
                                    PICTURE X(12).
      *                             TIME STAMP TRANSACCION
                       08  TAB-STP-ITRN.
      *                             FECHA TRANSACCION
                       10  TAB-FEC-FTRN.
                       12  TAB-NUM-STRN
                                    PICTURE 9(2).
                       12  TAB-NUM-ATRN
                                    PICTURE 9(2).
                       12  TAB-NUM-MTRN
                                    PICTURE 9(2).
                       12  TAB-NUM-DTRN
                                    PICTURE 9(2).
      *                             HORA TRANSACCION
                       10  TAB-HRA-HRTR.
                       12  TAB-NUM-HHTR
                                    PICTURE 9(2).
                       12  TAB-NUM-MMTR
                                    PICTURE 9(2).
                       12  TAB-NUM-SSTR
                                    PICTURE 9(2).
      *                             INDICADOR TIPO ACCION
                   06  TAB-MSC-TACC PICTURE X(1).
      *                             INDICADOR STATUS
                   06  TAB-MSC-STAT PICTURE X(1).
      *                             INDICADOR VIGENCIA
                   06  TAB-IND-VIGE
                             REDEFINES TAB-MSC-STAT
                                    PICTURE X(1).
      *                             CODIGO ORIGEN TRANSACCION
                   06  TAB-COD-OTRN.
      *                             INDICADOR TIPO ORIGEN
                       08  TAB-MSC-TTRN
                                    PICTURE X(1).
      *                             CODIGO TIPO ORIGEN
                       08  TAB-COD-TTRN
                                    PICTURE X(3).
      *                             AUTOR TRANSACCION
                   06  TAB-COD-ATRN PICTURE X(12).
      *                             KEY TIPO + CODIGO ( INTERNO COMPUTAC
                   06  TAB-CIC-TABL.
      *                             CODIGO TIPO TABLA
                       08  TAB-CIC-TTAB
                                    PICTURE X(3).
      *                             CODIGO TABLA
                       08  TAB-CIC-CTAB
                                    PICTURE X(12).
      *                             CODIGO EXTERNO
                   06  TAB-EXT-TABL.
      *                             CODIGO TIPO TABLA
                       08  TAB-EXT-TTAB
                                    PICTURE X(3).
      *                             CODIGO TABLA
                       08  TAB-EXT-CTAB
                                    PICTURE X(5).
      *                             DESCRIPCION CORTA
                   06  TAB-GLS-DCOR PICTURE X(12).
      *                             ABREVIACION DESCRIPCION
                   06  TAB-GLS-ABRV PICTURE X(5).
      *                             DESCRIPCION DEL CODIGO
                   06  TAB-GLS-DESC PICTURE X(40).
      *                             DATOS ANEXOS
                   06  TAB-GLS-DATA PICTURE X(60).
      *                             CLAVE SOUNDEX
                   06  TAB-SNX-TABL.
                       08  TAB-SNX-TTAB
                                    PICTURE X(3).
                       08  TAB-SNX-CTAB
                                    PICTURE X(3).
               04  TAB-REDEF REDEFINES TAB
                                    PICTURE X(194).
000000*
000000     EJECT
000000*
000000* LINEAS DE IMPRESION
000000*
000000 01  TIT-01.
000000     05 FILLER                   PIC X(30)  VALUE
000000        'BANCO CREDITO INVERSIONES     '.
000000     05 FILLER                   PIC X(82)  VALUE SPACES.
000000     05 FILLER                   PIC X(10)  VALUE 'DAPPLRDC  '.
000000     05 TIT-01-FEC-FPRO.
000000        10 TIT-01-NUM-DPRO       PIC 9(02).
000000        10 FILLER                PIC X(01) VALUE '/'.
000000        10 TIT-01-NUM-MPRO       PIC 9(02).
000000        10 FILLER                PIC X(01) VALUE '/'.
000000        10 TIT-01-NUM-SPRO       PIC 9(02).
000000        10 TIT-01-NUM-APRO       PIC 9(02).
000000*
000000 01  TIT-02.
000000     05 TIT-02-RPT-DSIS          PIC X(30)  VALUE
000000        'DEPOSITOS A PLAZO'.
000000     05 FILLER                   PIC X(17)  VALUE SPACES.
000000     05 FILLER                   PIC X(32)  VALUE
000000        'RESUMEN DIARIO DE CAPTACIONES  ('.
000000     05 TIT-02-FEC-FPRI.
000000        10 TIT-02-NUM-DPRI       PIC 9(02).
000000        10 FILLER                PIC X(01) VALUE '/'.
000000        10 TIT-02-NUM-MPRI       PIC 9(02).
000000        10 FILLER                PIC X(01) VALUE '/'.
000000        10 TIT-02-NUM-SPRI       PIC 9(02).
000000        10 TIT-02-NUM-APRI       PIC 9(02).
000000     05 FILLER                   PIC X(01)  VALUE ')'.
000000     05 FILLER                   PIC X(32)  VALUE SPACES.
000000     05 FILLER                   PIC X(07)  VALUE 'PAGINA '.
000000     05 TIT-02-NUM-PAGE          PIC ZZZ.
000000*
000000 01  TIT-03.
000000     05 FILLER                   PIC X(09) VALUE 'MONEDA : '.
000000     05 TIT-03-GLS-VCAM          PIC X(20).
000000     05 FILLER                   PIC X(17) VALUE SPACES.
000000     05 FILLER                   PIC X(44) VALUE
000000        '(INCLUYE CAPTACIONES Y RENOVACIONES DEL DIA)'.
000000*
000000 01  TIT-04.
000000     05 FILLER                   PIC X(132) VALUE ALL '-'.
000000*
000000 01  TIT-05.
000000     05 FILLER                   PIC X(10) VALUE 'PLAZO     '.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(09) VALUE 'OFICINA  '.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(24) VALUE
000000        '     CAPTACIONES TOTALES'.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(24) VALUE
000000        ' CAPTACIONES TASA PLANT.'.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(24) VALUE
000000        ' CAPTACIONES TASA AUTOR.'.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(08) VALUE '  TASA  '.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(08) VALUE '  TASA  '.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(08) VALUE '  TASA  '.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(08) VALUE '  TASA  '.
000000*
000000 01  TIT-06.
000000     05 FILLER                   PIC X(10) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(09) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(24) VALUE
000000        '        MONTO     CANTID'.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(24) VALUE
000000        '        MONTO     CANTID'.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(24) VALUE
000000        '        MONTO     CANTID'.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(08) VALUE '  PROM  '.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(08) VALUE '  MINI  '.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(08) VALUE '  MAXI  '.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(08) VALUE '  REAL  '.
000000*
000000 01  TIT-07.
000000     05 FILLER                   PIC X(10) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(09) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(24) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(24) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(24) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(08) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(08) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(08) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(08) VALUE '  PROM  '.
000000*
000000 01  TIT-08.
000000     05 FILLER                   PIC X(10) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(09) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(24) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(24) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(24) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 FILLER                   PIC X(08) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(08) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(08) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(08) VALUE 'ANUALIZ.'.
000000*
000000 01  DET-01.
000000     05 DET-01-GLS-GRPL          PIC X(10).
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 DET-01-GLS-GROF          PIC X(09).
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 DET-01-SALD-TOTA         PIC ZZZZZZZZZ.ZZZ.ZZ9.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 DET-01-NUME-TOTA         PIC ZZZZZ9.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 DET-01-SALD-TPLA         PIC ZZZZZZZZZ.ZZZ.ZZ9.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 DET-01-NUME-TPLA         PIC ZZZZZ9.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 DET-01-SALD-TAUT         PIC ZZZZZZZZZ.ZZZ.ZZ9.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 DET-01-NUME-TAUT         PIC ZZZZZ9.
000000     05 FILLER                   PIC X(01) VALUE '|'.
000000     05 DET-01-TASA-PROM         PIC --9,9999.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 DET-01-TASA-MINI         PIC --9,9999.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 DET-01-TASA-MAXI         PIC --9,9999.
000000     05 FILLER                   PIC X(01) VALUE SPACES.
000000     05 DET-01-TASA-TRPA         PIC --9,9999.
000000*
000000     EJECT
000000* AREA DE COMUNICACION CON RUTINA RUTUVALF
000000 01  RUTWVALF.
000000     05 RUTWVALF-FECHA.
000000        10 RUTWVALF-FECHA-D      PIC 9(02).
000000        10 RUTWVALF-FECHA-M      PIC 9(02).
000000        10 RUTWVALF-FECHA-A.
000000           15 RUTWVALF-FECHA-AM  PIC 9(02).
000000           15 RUTWVALF-FECHA-AA  PIC 9(02).
000000     05 RUTWVALF-CODRET          PIC 9(01)  VALUE 0.
000000     EJECT
000000     COPY RTNWCALE.
000000     EJECT
000000     COPY RUTWTTAB.
000000     EJECT
000000     COPY RLOVR001.
000000*
000000* MODULO DE CONTROL
000000*
000000 PROCEDURE DIVISION.
000000*
000000 A-CONTROL SECTION.
000000     ENTRY 'DBMSCBL'.
000000     COPY BIBBAUD2.
000000*
000000 AA-INICIALIZACION.
000000     PERFORM B-INICIALIZAR.
000000*
000000 AB-PROCESAMIENTO.
000000     PERFORM C-PROCESAR.
000000*
000000 AC-TERMINACION.
000000     PERFORM D-TERMINAR.
000000*
000000 AZZ-FIN-PROC.
000000     GOBACK.
000000     EJECT
000000*
000000*
000000*
000000 B-INICIALIZAR SECTION.
000000*
000000 BA-CONTROL-PROCESO.
000000     PERFORM BB-PROC-CALENDARIO
000000     PERFORM BC-ACCEPT-TARJETA
000000     PERFORM BD-PROC-FECHA
000000     PERFORM BE-PROC-DAPTGROF
000000     PERFORM BF-PROC-DAPTGRPL
000000     PERFORM BG-PROC-DAPTFACT
000000     PERFORM BM-ABRE-ARCH
000000     PERFORM BZ-VERIFICA
000000     GO TO BZZ-FIN-SECC.
000000*
000000 BB-PROC-CALENDARIO.
000000     MOVE 'CARGAR' TO CALEAREA-FUNCION
000000     MOVE ALL '0'  TO CALEAREA-FECHA-1
000000     CALL 'RUTUCALE' USING RTNWCALE
000000     IF CALEAREA-FUNCION = 'CANCEL'
000000           DISPLAY ' '
000000        DISPLAY
000000           'ERROR EN CARGA CALENDARIO FS= ' CALEAREA-COD-RET
000000        MOVE 1 TO SW-CANCEL.
000000*
000000 BC-ACCEPT-TARJETA.
000000     DISPLAY ' '.
000000     DISPLAY 'INICIO CAPTURA DE PARAMETROS'.
000000     DISPLAY ' '.
000000     DISPLAY 'INGRESE FECHA DE PROCESO (DDMMSSAA)   : '.
000000     ACCEPT WP-FEC-FPRI
000000     DISPLAY WP-FEC-FPRI
000000*
000000     DISPLAY 'FIN    CAPTURA    DE PARAMETROS'.
000000     DISPLAY ' '.
000000     DISPLAY 'INICIO VALIDACION DE PARAMETROS'.
000000*
000000* VALIDA FECHA DE PROCESO
000000     DISPLAY WP-FEC-FPRI
000000     MOVE WP-NUM-DPRI TO RUTWVALF-FECHA-D
000000     MOVE WP-NUM-MPRI TO RUTWVALF-FECHA-M
000000     MOVE WP-NUM-SPRI TO RUTWVALF-FECHA-AM
000000     MOVE WP-NUM-APRI TO RUTWVALF-FECHA-AA
000000     CALL 'RUTUVALF' USING RUTWVALF-FECHA RUTWVALF-CODRET
000000     IF RUTWVALF-CODRET NOT = 0
000000           DISPLAY ' '
000000        DISPLAY
000000           '* FECHA PROCESO INVALIDA. ' WP-FEC-FPRI
000000        MOVE 1 TO SW-CANCEL.
000000     DISPLAY ' '.
000000     DISPLAY 'FIN VALIDACION PARAMETROS'.
000000*
000000 BD-PROC-FECHA.
000000* ACEPTAR FECHA DEL COMPUTADOR
000000     ACCEPT WE-FECHA-DATE FROM DATE
000000     MOVE WE-DD-DATE             TO TIT-01-NUM-DPRO
000000     MOVE WE-MM-DATE             TO TIT-01-NUM-MPRO
000000     MOVE WE-AA-DATE             TO TIT-01-NUM-APRO
000000*****IF WE-AA-DATE NOT < 80
000000     IF WE-AA-DATE < ROLL-YY
000000        MOVE 20                  TO TIT-01-NUM-SPRO
000000     ELSE
000000        MOVE 19                  TO TIT-01-NUM-SPRO.
000000* PONE FECHA DE PROCESO (PARAMETRO) COMO ACTUAL
000000     MOVE WP-NUM-DPRI            TO WS-NUM-DFAC
000000                                    TIT-02-NUM-DPRI
000000     MOVE WP-NUM-MPRI            TO WS-NUM-MFAC
000000                                    TIT-02-NUM-MPRI
000000     MOVE WP-NUM-SPRI            TO WS-NUM-SFAC
000000                                    TIT-02-NUM-SPRI
000000     MOVE WP-NUM-APRI            TO WS-NUM-AFAC
000000                                    TIT-02-NUM-APRI.
000000*
000000 BE-PROC-DAPTGROF.
000000     OPEN INPUT DAPTGROF
000000     PERFORM BE1-LEER-DAPTGROF
000000     PERFORM BE2-CARGA-DAPTGROF UNTIL
000000        FS-DAPTGROF = 1
000000     CLOSE DAPTGROF.
000000*
000000 BE1-LEER-DAPTGROF.
000000     READ DAPTGROF AT END MOVE 1 TO FS-DAPTGROF.
000000     IF FS-DAPTGROF = 0
000000        ADD 1 TO CNT-DAPTGROF-L.
000000*
000000 BE2-CARGA-DAPTGROF.
000000     IF TB-CNT-GROF < 300
000000        ADD 1                 TO TB-CNT-GROF
000000        SET IX-GROF         TO TB-CNT-GROF
000000        MOVE DAPTGROF-COD-OFIC TO
000000           TB-GROF-KEY-COD-OFIC (IX-GROF)
000000        MOVE DAPTGROF-COD-GROF TO
000000           TB-GROF-COD-GROF     (IX-GROF)
000000        MOVE DAPTGROF-GLS-GROF TO
000000           TB-GROF-GLS-GROF     (IX-GROF)
000000     ELSE
000000        DISPLAY '*** TABLA DE GRUPO DE OFICINAS EXCEDIDA DE 300.'
000000        MOVE 1                TO SW-CANCEL.
000000     PERFORM BE1-LEER-DAPTGROF.
000000*
000000 BF-PROC-DAPTGRPL.
000000     OPEN INPUT DAPTGRPL
000000     PERFORM BF1-LEER-DAPTGRPL
000000     PERFORM BF2-CARGA-DAPTGRPL UNTIL
000000        FS-DAPTGRPL = 1
000000     CLOSE DAPTGRPL.
000000*
000000 BF1-LEER-DAPTGRPL.
000000     READ DAPTGRPL AT END MOVE 1 TO FS-DAPTGRPL.
000000     IF FS-DAPTGRPL = 0
000000        ADD 1 TO CNT-DAPTGRPL-L.
000000*
000000 BF2-CARGA-DAPTGRPL.
000000     IF TB-CNT-GRPL < 300
000000        ADD 1               TO TB-CNT-GRPL
000000        SET IX-GRPL         TO TB-CNT-GRPL
000000        MOVE DAPTGRPL-COD-VCAM TO
000000           TB-GRPL-KEY-COD-VCAM (IX-GRPL)
000000        MOVE DAPTGRPL-PLZ-MINI TO
000000           TB-GRPL-KEY-PLZ-MINI (IX-GRPL)
000000        MOVE DAPTGRPL-PLZ-MAXI TO
000000           TB-GRPL-KEY-PLZ-MAXI (IX-GRPL)
000000        MOVE DAPTGRPL-GLS-GRPL TO
000000           TB-GRPL-GLS-GRPL     (IX-GRPL)
000000     ELSE
000000        DISPLAY '*** TABLA DE GRUPO DE PLAZOS   EXCEDIDA DE 300.'
000000        MOVE 1                TO SW-CANCEL.
000000     PERFORM BF1-LEER-DAPTGRPL.
000000*
000000 BG-PROC-DAPTFACT.
000000     OPEN INPUT DAPTFACT
000000     PERFORM BG1-LEER-DAPTFACT
000000     PERFORM BG2-CARGA-DAPTFACT UNTIL
000000        FS-DAPTFACT = 1
000000     CLOSE DAPTFACT.
000000*
000000 BG1-LEER-DAPTFACT.
000000     READ DAPTFACT AT END MOVE 1 TO FS-DAPTFACT.
000000     IF FS-DAPTFACT = 0
000000        ADD 1 TO CNT-DAPTFACT-L.
000000*
000000 BG2-CARGA-DAPTFACT.
000000     IF DAPTFACT-FEC-FPRO = WS-FEC-FFAC
000000        IF TB-CNT-FACT < 300
000000           ADD 1               TO TB-CNT-FACT
000000           SET IX-FACT         TO TB-CNT-FACT
000000           MOVE DAPTFACT-FEC-FPRO TO
000000              TB-FACT-KEY-FEC-FPRO (IX-FACT)
000000           MOVE DAPTFACT-COD-VCAM TO
000000              TB-FACT-KEY-COD-VCAM (IX-FACT)
000000           MOVE DAPTFACT-PLZ-MINI TO
000000              TB-FACT-KEY-PLZ-MINI (IX-FACT)
000000           MOVE DAPTFACT-PLZ-MAXI TO
000000              TB-FACT-KEY-PLZ-MAXI (IX-FACT)
000000           MOVE DAPTFACT-VAL-FACT TO
000000              TB-FACT-VAL-FACT     (IX-FACT)
000000        ELSE
000000           DISPLAY
000000              '*** TABLA FACT. DE ACTUALIZACION EXCEDIDA DE 300.'
000000           MOVE 1                TO SW-CANCEL.
000000     PERFORM BG1-LEER-DAPTFACT.
000000*
000000 BM-ABRE-ARCH.
000000     OPEN INPUT  DAPDEST
000000          OUTPUT DAPLRDC.
000000     IF FS-DAPDEST > 0
000000        DISPLAY '*** ERROR OPEN DAPDEST. FS=' FS-DAPDEST
000000        MOVE 1 TO SW-CANCEL.
000000*
000000 BZ-VERIFICA.
000000     IF SW-CANCEL = 1
000000        DISPLAY '*** ERRORES EN INICIALIZACION ***'
000000        PERFORM D-TERMINAR.
000000*
000000 BZZ-FIN-SECC.
000000     EXIT.
000000     EJECT
000000*
000000*
000000*
000000 C-PROCESAR SECTION.
000000*
000000 CA-CONTROL.
000000     SORT FSORT
000000        ASCENDING KEY
000000           FSORT-FEC-FPRO
000000           FSORT-COD-VCAM
000000           FSORT-COD-GRPL
000000           FSORT-COD-GROF
000000        INPUT  PROCEDURE  E-ENTRADA-SORT
000000        OUTPUT PROCEDURE  F-SALIDA-SORT.
000000*
000000     IF SORT-RETURN NOT = 0
000000        DISPLAY '**  ####################### **'
000000        DISPLAY '**  HUBO ERROR EN SORT      **'
000000        DISPLAY '**  ####################### **'
000000        MOVE 1 TO SW-CANCEL
000000        PERFORM D-TERMINAR.
000000*
000000     IF TB-CNT-ACMDIA > 0
000000        PERFORM G-CALCULA
000000        PERFORM H-IMPRIME.
000000*
000000 CZZ-FIN-SECC.
000000     EXIT.
000000     EJECT
000000*
000000*
000000*
000000 D-TERMINAR  SECTION.
000000*
000000 DA-TOTALES.
000000     CLOSE DAPDEST DAPLRDC
000000     DISPLAY ' '
000000     DISPLAY '+---------------------------------------------+'
000000     DISPLAY '+ ESTADISTICAS DE PROCESO.  PROGRAMA DAPPLRDC +'
000000     DISPLAY '+---------------------------------------------+'
000000     DISPLAY ' '
000000     DISPLAY 'REG DAPTGROF LEIDOS...............' CNT-DAPTGROF-L
000000     DISPLAY 'REG DAPTGROF CARGAD...............' TB-CNT-GROF
000000     DISPLAY 'REG DAPTGRPL LEIDOS...............' CNT-DAPTGRPL-L
000000     DISPLAY 'REG DAPTGRPL CARGAD...............' TB-CNT-GRPL
000000     DISPLAY 'REG DAPTFACT LEIDOS...............' CNT-DAPTFACT-L
000000     DISPLAY 'REG DAPTFACT CARGAD...............' TB-CNT-FACT
000000     DISPLAY 'REG DAPDEST  LEIDOS...............' CNT-DAPDEST-L
000000     DISPLAY 'REG DAPDEST  SELECC...............' CNT-DAPDEST-S
000000     DISPLAY 'REG DAPDEST  IGNORA...............' CNT-DAPDEST-I
000000     DISPLAY 'REG FSORT    GRABAD...............' CNT-FSORT-G
000000     DISPLAY 'REG FSORT    LEIDOS...............' CNT-FSORT-L
000000     DISPLAY ' '
000000     DISPLAY '***********************************************'
000000     DISPLAY ' '
000000     IF SW-CANCEL    = 1
000000        DISPLAY ' HAY MENSAJES PARA EL EXPLOTADOR'
000000        DISPLAY ' '
000000        DISPLAY '************************************************'
000000        DISPLAY '************************************************'
000000        DISPLAY '****                                        ****'
000000        DISPLAY '****      TERMINO ERRONEO DEL PROCESO       ****'
000000        DISPLAY '****                                        ****'
000000        DISPLAY '************************************************'
000000        DISPLAY '************************************************'
000000        MOVE 100 TO RETURN-CODE
000000        GOBACK
000000     ELSE
000000        DISPLAY ' NO HAY MENSAJES PARA EL EXPLOTADOR'
000000        DISPLAY ' '
000000        DISPLAY '*** PROCESO TERMINO EN FORMA NORMAL ***'.
000000*
000000 DZZ-FIN-SECC.
000000     EXIT.
000000     EJECT
000000*
000000*
000000*
000000 E-ENTRADA-SORT SECTION.
000000*
000000 EA-CONTROL.
000000* SELECCIONA LOS REGISTROS DAPDEST CON FECHA ACTUAL
000000     MOVE LOW-VALUE   TO DAPDEST-KEY-IEST
000000     MOVE WS-FEC-FFAC TO DAPDEST-FEC-FPRO
000000     START DAPDEST KEY = DAPDEST-FEC-FPRO
000000     IF FS-DAPDEST = 0
000000        PERFORM EB-LEER-DAPDEST
000000        PERFORM ED-SELECCIONA UNTIL
000000           DAPDEST-FEC-FPRO NOT = WS-FEC-FFAC OR
000000           FS-DAPDEST = 10
000000     ELSE
000000        DISPLAY ' '
000000        DISPLAY '*** NO HAY INFORMACION REGISTRADA CON FECHA '
000000           WS-NUM-DFAC
000000           WS-NUM-MFAC
000000           WS-NUM-SFAC
000000           WS-NUM-AFAC.
000000     GO TO EZZ-FIN-SECC.
000000*
000000 EB-LEER-DAPDEST.
000000     READ DAPDEST NEXT RECORD
000000     IF FS-DAPDEST = 0
000000        ADD 1 TO CNT-DAPDEST-L.
000000*
000000 ED-SELECCIONA.
000000* SELECCION Y ASIGNACION DE GRUPO DE PLAZO Y OFICINA
000000     IF DAPDEST-OPE-SALD-TOTA = 0
000000        DISPLAY '*** SALDO TOTAL ES CERO. SE IGNORA. CLAVE= '
000000                DAPDEST-KEY-IEST
000000        DISPLAY ' '
000000        ADD 1 TO CNT-DAPDEST-I
000000     ELSE
000000        PERFORM EE-BUSCA-GRPL
000000        PERFORM EF-BUSCA-GROF
000000        IF WR-COD-GRPL = SPACES OR
000000           WR-COD-GROF = SPACES
000000              ADD 1 TO CNT-DAPDEST-I
000000        ELSE
000000           ADD 1        TO CNT-DAPDEST-S
000000           PERFORM EK-GRABA-FSORT.
000000     PERFORM EB-LEER-DAPDEST.
000000*
000000 EE-BUSCA-GRPL.
000000     MOVE SPACES                 TO WR-COD-GRPL
000000     MOVE DAPDEST-COD-VCAM       TO TB-BUS-GRPL-COD-VCAM
000000     MOVE DAPDEST-NUM-DURV       TO TB-BUS-GRPL-NUM-DURV
000000     SET IX-GRPL                 TO 1
000000     SEARCH TAB-GRPL
000000        AT END
000000           DISPLAY
000000              '*** NO EXISTE GRUPO DE PLAZO (GRPL) PARA'
000000              ' PLAZO DE DOCUMENTO (DIAS).'
000000           DISPLAY 'MONEDA = ' DAPDEST-COD-VCAM ' '
000000                   'PLAZO  = ' DAPDEST-NUM-DURV
000000           DISPLAY ' '
000000        WHEN
000000           (TB-GRPL-KEY-COD-VCAM (IX-GRPL) =
000000              TB-BUS-GRPL-COD-VCAM AND
000000                 (TB-GRPL-KEY-PLZ-MINI (IX-GRPL) NOT >
000000                     TB-BUS-GRPL-NUM-DURV AND
000000                  TB-GRPL-KEY-PLZ-MAXI (IX-GRPL) NOT <
000000                     TB-BUS-GRPL-NUM-DURV))
000000              MOVE TB-GRPL-KEY-COD-GRPL (IX-GRPL) TO WR-COD-GRPL
000000              MOVE TB-GRPL-GLS-GRPL (IX-GRPL)     TO WR-GLS-GRPL.
000000*
000000 EF-BUSCA-GROF.
000000     MOVE SPACES                 TO WR-COD-GROF
000000     MOVE DAPDEST-COD-OFIC       TO TB-BUS-GROF-COD-OFIC
000000     SET IX-GROF                 TO 1
000000     SEARCH TAB-GROF
000000        AT END
000000           DISPLAY
000000              '*** NO EXISTE GRUPO OFICINAS (GROF) PARA'
000000              ' CODIGO DE OFICINA. ' DAPDEST-COD-OFIC
000000           DISPLAY ' '
000000        WHEN
000000           TB-GROF-KEY (IX-GROF) = TB-BUS-GROF
000000              MOVE TB-GROF-COD-GROF (IX-GROF) TO WR-COD-GROF
000000              MOVE TB-GROF-GLS-GROF (IX-GROF) TO WR-GLS-GROF.
000000*
000000 EK-GRABA-FSORT.
000000     MOVE DAPDEST-FEC-FPRO       TO FSORT-FEC-FPRO
000000     MOVE DAPDEST-COD-VCAM       TO FSORT-COD-VCAM
000000     MOVE WR-COD-GRPL            TO FSORT-COD-GRPL
000000     MOVE WR-COD-GROF            TO FSORT-COD-GROF
000000     MOVE DAPDEST-OPE-SALD-TOTA  TO FSORT-OPE-SALD-TOTA
000000     MOVE DAPDEST-OPE-NUME-TOTA  TO FSORT-OPE-NUME-TOTA
000000     MOVE DAPDEST-OPE-SALD-TPLA  TO FSORT-OPE-SALD-TPLA
000000     MOVE DAPDEST-OPE-NUME-TPLA  TO FSORT-OPE-NUME-TPLA
000000     MOVE DAPDEST-OPE-SALD-TAUT  TO FSORT-OPE-SALD-TAUT
000000     MOVE DAPDEST-OPE-NUME-TAUT  TO FSORT-OPE-NUME-TAUT
000000     MOVE DAPDEST-OPE-TASA-MINI  TO FSORT-OPE-TASA-MINI
000000     MOVE DAPDEST-OPE-TASA-MAXI  TO FSORT-OPE-TASA-MAXI
000000     MOVE DAPDEST-OPE-SUMA-MIXTI TO FSORT-OPE-SUMA-MIXTI
000000     MOVE DAPDEST-OPE-SUMA-MIXPI TO FSORT-OPE-SUMA-MIXPI
000000     MOVE WR-GLS-GRPL            TO FSORT-GLS-GRPL
000000     MOVE WR-GLS-GROF            TO FSORT-GLS-GROF
000000     RELEASE REG-FSORT
000000     ADD 1                       TO CNT-FSORT-G.
000000*
000000 EZZ-FIN-SECC.
000000     EXIT.
000000     EJECT
000000*
000000*
000000*
000000 F-SALIDA-SORT SECTION.
000000*
000000 FA-LEER-FSORT.
000000     RETURN FSORT AT END MOVE 1 TO FS-FSORT.
000000     IF FS-FSORT = 0
000000        ADD 1 TO CNT-FSORT-L.
000000*
000000 FB-CTRL-PROC.
000000     PERFORM FC-CTRL-X-FPRO UNTIL
000000        FS-FSORT = 1
000000     GO TO FZZ-FIN-SECC.
000000*
000000 FC-CTRL-X-FPRO.
000000*  FECHA
000000     MOVE FSORT-FEC-FPRO                     TO WR-FEC-FPRO
000000     PERFORM FD-CTRL-X-VCAM UNTIL
000000        FSORT-FEC-FPRO NOT = WR-FEC-FPRO OR
000000        FS-FSORT = 1.
000000*
000000 FD-CTRL-X-VCAM.
000000*  MONEDA
000000     MOVE FSORT-COD-VCAM                     TO WR-COD-VCAM
000000     PERFORM FE-CTRL-X-GRPL UNTIL
000000        FSORT-FEC-FPRO NOT = WR-FEC-FPRO OR
000000        FSORT-COD-VCAM NOT = WR-COD-VCAM OR
000000        FS-FSORT = 1.
000000*
000000 FE-CTRL-X-GRPL.
000000*  GRUPO DE PLAZOS
000000     MOVE FSORT-COD-GRPL              TO WR-COD-GRPL
000000     MOVE FSORT-GLS-GRPL              TO WR-GLS-GRPL
000000                                         WS-GLS-GRPL
000000     PERFORM FE1-BUSCA-VAL-FACT
000000     PERFORM FF-CTRL-X-GROF UNTIL
000000        FSORT-FEC-FPRO NOT = WR-FEC-FPRO OR
000000        FSORT-COD-VCAM NOT = WR-COD-VCAM OR
000000        FSORT-COD-GRPL NOT = WR-COD-GRPL OR
000000        FS-FSORT = 1.
000000*
000000 FE1-BUSCA-VAL-FACT.
000000* BUSCA FACTOR DE ACTUALIZACION PARA FECHA-MONEDA-PLAZO
000000     MOVE +0                     TO WR-VAL-FACT
000000     MOVE WR-FEC-FPRO            TO TB-BUS-FACT-FEC-FPRO
000000     MOVE WR-COD-VCAM            TO TB-BUS-FACT-COD-VCAM
000000     MOVE WR-COD-GRPL            TO TB-BUS-FACT-COD-GRPL
000000     SET IX-FACT                 TO 1
000000     SEARCH TAB-FACT
000000        WHEN
000000           TB-FACT-KEY (IX-FACT) = TB-BUS-FACT
000000              MOVE TB-FACT-VAL-FACT (IX-FACT) TO
000000                 WR-VAL-FACT.
000000*
000000 FF-CTRL-X-GROF.
000000*  GRUPO DE OFICINAS
000000     INITIALIZE ACM-GROF
000000     MOVE +99999,9999                 TO ACM-GROF-TASA-MINI
000000     MOVE +0                          TO ACM-GROF-TASA-MAXI
000000     MOVE FSORT-COD-GROF              TO WR-COD-GROF
000000     MOVE FSORT-GLS-GROF              TO WR-GLS-GROF
000000                                         WS-GLS-GROF
000000     PERFORM FG-ACUMULA UNTIL
000000        FSORT-FEC-FPRO NOT = WR-FEC-FPRO OR
000000        FSORT-COD-VCAM NOT = WR-COD-VCAM OR
000000        FSORT-COD-GRPL NOT = WR-COD-GRPL OR
000000        FSORT-COD-GROF NOT = WR-COD-GROF OR
000000        FS-FSORT = 1
000000     PERFORM FF9-TOTALES-GROF.
000000*
000000 FF9-TOTALES-GROF.
000000* ACUMULA EN GRUPO REAL
000000     MOVE WR-FEC-FPRO       TO TB-ACMDIA-BUS-FEC-FPRO
000000     MOVE WR-COD-VCAM       TO TB-ACMDIA-BUS-COD-VCAM
000000     MOVE WR-COD-GRPL       TO TB-ACMDIA-BUS-COD-GRPL
000000     MOVE WR-COD-GROF       TO TB-ACMDIA-BUS-COD-GROF
000000     MOVE WS-GLS-GRPL       TO WR-GLS-GRPL
000000     MOVE WS-GLS-GROF       TO WR-GLS-GROF
000000     PERFORM FM-BUSCA-ACMDIA.
000000* ACUMULA EN GRUPO FICTICIO    PARA TOTALES   (GROF)
000000     MOVE WR-FEC-FPRO       TO TB-ACMDIA-BUS-FEC-FPRO
000000     MOVE WR-COD-VCAM       TO TB-ACMDIA-BUS-COD-VCAM
000000     MOVE WR-COD-GRPL       TO TB-ACMDIA-BUS-COD-GRPL
000000     MOVE HIGH-VALUE        TO TB-ACMDIA-BUS-COD-GROF
000000     MOVE WS-GLS-GRPL       TO WR-GLS-GRPL
000000     MOVE 'TOTAL'           TO WR-GLS-GROF
000000     PERFORM FM-BUSCA-ACMDIA.
000000* ACUMULA EN GRUPO FICTICIO    PARA TOTALES   (PLZO)
000000     MOVE WR-FEC-FPRO       TO TB-ACMDIA-BUS-FEC-FPRO
000000     MOVE WR-COD-VCAM       TO TB-ACMDIA-BUS-COD-VCAM
000000     MOVE HIGH-VALUE        TO TB-ACMDIA-BUS-COD-GRPL
000000     MOVE WR-COD-GROF       TO TB-ACMDIA-BUS-COD-GROF
000000     MOVE 'TOTAL'           TO WR-GLS-GRPL
000000     MOVE WS-GLS-GROF       TO WR-GLS-GROF
000000     PERFORM FM-BUSCA-ACMDIA.
000000* ACUMULA EN GRUPO FICTICIO    PARA TOTALES   (VCAM)
000000     MOVE WR-FEC-FPRO       TO TB-ACMDIA-BUS-FEC-FPRO
000000     MOVE WR-COD-VCAM       TO TB-ACMDIA-BUS-COD-VCAM
000000     MOVE HIGH-VALUE        TO TB-ACMDIA-BUS-COD-GRPL
000000     MOVE HIGH-VALUE        TO TB-ACMDIA-BUS-COD-GROF
000000     MOVE 'TOTAL'           TO WR-GLS-GRPL
000000     MOVE 'GENERAL'         TO WR-GLS-GROF
000000     PERFORM FM-BUSCA-ACMDIA.
000000*
000000 FG-ACUMULA.
000000* ACUMULA VALORES POR GROF (GRUPO DE OFICINAS) (VCAM-GRPL-GROF)
000000     ADD FSORT-OPE-SALD-TOTA  TO ACM-GROF-SALD-TOTA   ROUNDED
000000     ADD FSORT-OPE-NUME-TOTA  TO ACM-GROF-NUME-TOTA   ROUNDED
000000     ADD FSORT-OPE-SALD-TPLA  TO ACM-GROF-SALD-TPLA   ROUNDED
000000     ADD FSORT-OPE-NUME-TPLA  TO ACM-GROF-NUME-TPLA   ROUNDED
000000     ADD FSORT-OPE-SALD-TAUT  TO ACM-GROF-SALD-TAUT   ROUNDED
000000     ADD FSORT-OPE-NUME-TAUT  TO ACM-GROF-NUME-TAUT   ROUNDED
000000     ADD FSORT-OPE-SUMA-MIXTI TO ACM-GROF-SUMA-MIXTI  ROUNDED
000000     ADD FSORT-OPE-SUMA-MIXPI TO ACM-GROF-SUMA-MIXPI  ROUNDED
000000     IF FSORT-OPE-TASA-MINI < ACM-GROF-TASA-MINI
000000        MOVE FSORT-OPE-TASA-MINI TO
000000           ACM-GROF-TASA-MINI.
000000     IF FSORT-OPE-TASA-MAXI > ACM-GROF-TASA-MAXI
000000        MOVE FSORT-OPE-TASA-MAXI TO
000000           ACM-GROF-TASA-MAXI.
000000     PERFORM FA-LEER-FSORT.
000000*
000000 FM-BUSCA-ACMDIA.
000000     SET IX-ACMDIA TO 1
000000     SEARCH TAB-ACMDIA
000000        AT END
000000           PERFORM FN-CREA-ACMDIA
000000        WHEN
000000           TB-ACMDIA-KEY (IX-ACMDIA) = TB-ACMDIA-BUS
000000              PERFORM FQ-ACTU-ACMDIA.
000000*
000000 FN-CREA-ACMDIA.
000000     IF TB-CNT-ACMDIA < 5000
000000        ADD 1              TO TB-CNT-ACMDIA
000000        SET IX-ACMDIA      TO TB-CNT-ACMDIA
000000        MOVE TB-ACMDIA-BUS TO TB-ACMDIA-KEY          (IX-ACMDIA)
000000        MOVE +0            TO TB-ACMDIA-SALD-TOTA    (IX-ACMDIA)
000000                              TB-ACMDIA-NUME-TOTA    (IX-ACMDIA)
000000                              TB-ACMDIA-SALD-TPLA    (IX-ACMDIA)
000000                              TB-ACMDIA-NUME-TPLA    (IX-ACMDIA)
000000                              TB-ACMDIA-SALD-TAUT    (IX-ACMDIA)
000000                              TB-ACMDIA-NUME-TAUT    (IX-ACMDIA)
000000        MOVE +99999,9999   TO TB-ACMDIA-TASA-MINI    (IX-ACMDIA)
000000        MOVE +0            TO TB-ACMDIA-TASA-MAXI    (IX-ACMDIA)
000000        MOVE +0            TO TB-ACMDIA-SUMA-MIXTI   (IX-ACMDIA)
000000                              TB-ACMDIA-PROM-PLZO    (IX-ACMDIA)
000000                              TB-ACMDIA-SUMA-MIXPI   (IX-ACMDIA)
000000                              TB-ACMDIA-TASA-PROM    (IX-ACMDIA)
000000        MOVE WR-VAL-FACT   TO TB-ACMDIA-VAL-FACT     (IX-ACMDIA)
000000        MOVE +0            TO TB-ACMDIA-TASA-TRPA    (IX-ACMDIA)
000000        MOVE WR-GLS-GRPL   TO TB-ACMDIA-GLS-GRPL     (IX-ACMDIA)
000000        MOVE WR-GLS-GROF   TO TB-ACMDIA-GLS-GROF     (IX-ACMDIA)
000000        PERFORM FQ-ACTU-ACMDIA
000000     ELSE
000000        DISPLAY '*** TABLA ACMDIA EXCEDIDA DE 5000.'
000000        MOVE 16 TO SORT-RETURN.
000000*
000000 FQ-ACTU-ACMDIA.
000000     ADD  ACM-GROF-SALD-TOTA    TO
000000        TB-ACMDIA-SALD-TOTA   (IX-ACMDIA) ROUNDED
000000     ADD  ACM-GROF-NUME-TOTA    TO
000000        TB-ACMDIA-NUME-TOTA   (IX-ACMDIA) ROUNDED
000000     ADD  ACM-GROF-SALD-TPLA    TO
000000        TB-ACMDIA-SALD-TPLA   (IX-ACMDIA) ROUNDED
000000     ADD  ACM-GROF-NUME-TPLA    TO
000000        TB-ACMDIA-NUME-TPLA   (IX-ACMDIA) ROUNDED
000000     ADD  ACM-GROF-SALD-TAUT    TO
000000        TB-ACMDIA-SALD-TAUT   (IX-ACMDIA) ROUNDED
000000     ADD  ACM-GROF-NUME-TAUT    TO
000000        TB-ACMDIA-NUME-TAUT   (IX-ACMDIA) ROUNDED
000000     ADD  ACM-GROF-SUMA-MIXTI   TO
000000        TB-ACMDIA-SUMA-MIXTI  (IX-ACMDIA) ROUNDED
000000     ADD  ACM-GROF-SUMA-MIXPI   TO
000000        TB-ACMDIA-SUMA-MIXPI  (IX-ACMDIA) ROUNDED
000000     IF ACM-GROF-TASA-MINI < TB-ACMDIA-TASA-MINI (IX-ACMDIA)
000000        MOVE ACM-GROF-TASA-MINI TO
000000           TB-ACMDIA-TASA-MINI (IX-ACMDIA).
000000     IF ACM-GROF-TASA-MAXI > TB-ACMDIA-TASA-MAXI (IX-ACMDIA)
000000        MOVE ACM-GROF-TASA-MAXI TO
000000           TB-ACMDIA-TASA-MAXI (IX-ACMDIA).
000000*
000000 FZZ-FIN-SECC.
000000     EXIT.
000000     EJECT
000000*
000000*
000000*
000000 G-CALCULA SECTION.
000000*
000000 GA-CONTROL.
000000* RECORRE SECUENCIALMENTE LA TABLA DE ACUMULACION
000000     SET IX-ACMDIA       TO 1
000000     PERFORM GC-CALCULA UNTIL
000000        IX-ACMDIA > TB-CNT-ACMDIA
000000     GO TO GZZ-FIN-SECC.
000000*
000000 GC-CALCULA.
000000     COMPUTE TB-ACMDIA-TASA-PROM (IX-ACMDIA) ROUNDED =
000000        TB-ACMDIA-SUMA-MIXTI(IX-ACMDIA) /
000000           TB-ACMDIA-SALD-TOTA (IX-ACMDIA)
000000     COMPUTE TB-ACMDIA-PROM-PLZO (IX-ACMDIA) ROUNDED =
000000        TB-ACMDIA-SUMA-MIXPI(IX-ACMDIA) /
000000           TB-ACMDIA-SALD-TOTA (IX-ACMDIA)
000000     IF TB-ACMDIA-KEY-COD-VCAM (IX-ACMDIA) = '0998  '
000000        PERFORM GC1-CALC-UEFES
000000     ELSE
000000        IF TB-ACMDIA-KEY-COD-VCAM (IX-ACMDIA) = '0999  '
000000           PERFORM GC2-CALC-PESOS
000000        ELSE
000000           IF TB-ACMDIA-KEY-COD-VCAM (IX-ACMDIA) = '1013  '
000000              PERFORM GC3-CALC-DOLAR
000000           ELSE
000000              MOVE +0 TO TB-ACMDIA-TASA-TRPA (IX-ACMDIA).
000000     SET IX-ACMDIA UP BY 1.
000000*
000000 GC1-CALC-UEFES.
000000     COMPUTE TB-ACMDIA-TASA-TRPA (IX-ACMDIA) ROUNDED =
000000        (((((TB-ACMDIA-TASA-PROM (IX-ACMDIA) / 100,0000000000) /
000000           4,0000000000) + 1) **
000000              4,0000000000) - 1) * 100,0000000000.
000000*
000000 GC2-CALC-PESOS.
000000     COMPUTE TB-ACMDIA-TASA-TRPA (IX-ACMDIA) ROUNDED =
000000        (((((TB-ACMDIA-TASA-PROM (IX-ACMDIA) -
000000           TB-ACMDIA-VAL-FACT (IX-ACMDIA)) /
000000              100,0000000000) + 1) **
000000                 12,0000000000) - 1) * 100,0000000000.
000000*
000000 GC3-CALC-DOLAR.
000000     COMPUTE TB-ACMDIA-TASA-TRPA (IX-ACMDIA) ROUNDED =
000000        (((((TB-ACMDIA-TASA-PROM (IX-ACMDIA) / 100,0000000000) /
000000           12,0000000000) + 1) **
000000              12,0000000000) - 1) * 100,0000000000.
000000*
000000 GZZ-FIN-SECC.
000000     EXIT.
000000     EJECT
000000*
000000*
000000*
000000 H-IMPRIME SECTION.
000000*
000000 HA-CONTROL.
000000     PERFORM HB-ORDENA-TABLA
000000* RECORRE SECUENCIALMENTE LA TABLA DE ACUMULACION
000000     SET IX-ACMDIA       TO 1
000000     PERFORM HC-CTRL-X-FPRO UNTIL
000000        IX-ACMDIA > TB-CNT-ACMDIA
000000     GO TO HZZ-FIN-SECC.
000000*
000000 HB-ORDENA-TABLA.
000000* ORDENA LA TABLA DE ACUMULACION METODO BURBUJA
000000     PERFORM HB1-ORDENA-TABLA
000000        VARYING IX-ACMDIA  FROM 1 BY 1 UNTIL
000000           IX-ACMDIA = TB-CNT-ACMDIA
000000        AFTER IY-ACMDIA FROM 1 BY 1 UNTIL
000000           IY-ACMDIA > TB-CNT-ACMDIA.
000000*
000000 HB1-ORDENA-TABLA.
000000     IF IY-ACMDIA = 1
000000        SET IY-ACMDIA  TO IX-ACMDIA
000000        SET IY-ACMDIA  UP BY 1.
000000     IF TB-ACMDIA-KEY (IX-ACMDIA) > TB-ACMDIA-KEY (IY-ACMDIA)
000000        MOVE TB-ACMDIA (IY-ACMDIA)  TO TB-ACMDIA-AUX
000000        MOVE TB-ACMDIA (IX-ACMDIA)  TO TB-ACMDIA (IY-ACMDIA)
000000        MOVE TB-ACMDIA-AUX          TO TB-ACMDIA (IX-ACMDIA).
000000*
000000 HC-CTRL-X-FPRO.
000000*  MONEDA
000000     MOVE 99                                 TO CNT-LINE-DAPLRDC
000000     MOVE 0                                  TO CNT-PAGE-DAPLRDC
000000     MOVE TB-ACMDIA-KEY-FEC-FPRO (IX-ACMDIA) TO WR-FEC-FPRO
000000     PERFORM HD-CTRL-X-VCAM UNTIL
000000        TB-ACMDIA-KEY-FEC-FPRO (IX-ACMDIA) NOT = WR-FEC-FPRO OR
000000        IX-ACMDIA > TB-CNT-ACMDIA.
000000*
000000 HD-CTRL-X-VCAM.
000000*  MONEDA
000000     MOVE 99                                 TO CNT-LINE-DAPLRDC
000000     MOVE 0                                  TO CNT-PAGE-DAPLRDC
000000     MOVE TB-ACMDIA-KEY-COD-VCAM (IX-ACMDIA) TO WR-COD-VCAM
000000     PERFORM HD1-BUSCA-GLOSA-VCAM
000000     MOVE WR-GLS-VCAM                        TO TIT-03-GLS-VCAM
000000     PERFORM HE-CTRL-X-GRPL UNTIL
000000        TB-ACMDIA-KEY-FEC-FPRO (IX-ACMDIA) NOT = WR-FEC-FPRO OR
000000        TB-ACMDIA-KEY-COD-VCAM (IX-ACMDIA) NOT = WR-COD-VCAM OR
000000        IX-ACMDIA > TB-CNT-ACMDIA.
000000*
000000 HD1-BUSCA-GLOSA-VCAM.
000000*  BUSCA GLOSA MONEDA
000000     MOVE +150                TO RUTWTTAB-BASE
000000     MOVE 'VLR'               TO RUTWTTAB-TABLA
000000     MOVE WR-COD-VCAM         TO RUTWTTAB-CLAVE
000000     CALL 'RUTUTTAB' USING RUTWTTAB
000000     EVALUATE RUTWTTAB-RETURN-CODE
000000        WHEN SPACES
000000           MOVE RUTWTTAB-REGISTRO-TAB TO REG-TAB
000000           MOVE TAB-GLS-DESC          TO WR-GLS-VCAM
000000        WHEN '14'
000000           MOVE ALL '?'               TO WR-GLS-VCAM
000000        WHEN OTHER
000000           DISPLAY 'ERROR EN ACCESO TABLA TAB (RUTUTTAB). '
000000                   'COD-RET = ' RUTWTTAB-RETURN-CODE
000000           DISPLAY 'BASE  = ' RUTWTTAB-BASE ' '
000000                   'TABLA = ' RUTWTTAB-TABLA ' '
000000                   'CLAVE = ' RUTWTTAB-CLAVE
000000           MOVE 20 TO SORT-RETURN
000000     END-EVALUATE.
000000*
000000 HE-CTRL-X-GRPL.
000000*  GRUPO DE PLAZO
000000     MOVE TB-ACMDIA-KEY-COD-GRPL (IX-ACMDIA) TO WR-COD-GRPL
000000     MOVE TB-ACMDIA-GLS-GRPL     (IX-ACMDIA) TO WR-GLS-GRPL
000000     PERFORM HF-CTRL-X-GROF UNTIL
000000        TB-ACMDIA-KEY-FEC-FPRO (IX-ACMDIA) NOT = WR-FEC-FPRO OR
000000        TB-ACMDIA-KEY-COD-VCAM (IX-ACMDIA) NOT = WR-COD-VCAM OR
000000        TB-ACMDIA-KEY-COD-GRPL (IX-ACMDIA) NOT = WR-COD-GRPL OR
000000        IX-ACMDIA > TB-CNT-ACMDIA.
000000     IF SALTO-PAG-DAPLRDC
000000        PERFORM HV-TITULOS.
000000     WRITE REG-DAPLRDC FROM TIT-04 AFTER 1
000000     ADD 1                                TO CNT-LINE-DAPLRDC.
000000*
000000 HF-CTRL-X-GROF.
000000*  GRUPO DE OFICINA
000000     MOVE TB-ACMDIA-KEY-COD-GROF (IX-ACMDIA)  TO WR-COD-GROF
000000     MOVE TB-ACMDIA-GLS-GROF     (IX-ACMDIA)  TO WR-GLS-GROF
000000     PERFORM HG-IMPRIME UNTIL
000000        TB-ACMDIA-KEY-FEC-FPRO (IX-ACMDIA) NOT = WR-FEC-FPRO OR
000000        TB-ACMDIA-KEY-COD-VCAM (IX-ACMDIA) NOT = WR-COD-VCAM OR
000000        TB-ACMDIA-KEY-COD-GRPL (IX-ACMDIA) NOT = WR-COD-GRPL OR
000000        TB-ACMDIA-KEY-COD-GROF (IX-ACMDIA) NOT = WR-COD-GROF OR
000000        IX-ACMDIA > TB-CNT-ACMDIA.
000000*
000000 HG-IMPRIME.
000000* IMPRIME TOTALES DE (MONEDA-PLAZO-GRUPO)
000000     IF SALTO-PAG-DAPLRDC
000000        PERFORM HV-TITULOS.
000000     MOVE WR-GLS-GRPL                     TO DET-01-GLS-GRPL
000000     MOVE WR-GLS-GROF                     TO DET-01-GLS-GROF
000000     MOVE TB-ACMDIA-SALD-TOTA (IX-ACMDIA) TO DET-01-SALD-TOTA
000000     MOVE TB-ACMDIA-NUME-TOTA (IX-ACMDIA) TO DET-01-NUME-TOTA
000000     MOVE TB-ACMDIA-SALD-TPLA (IX-ACMDIA) TO DET-01-SALD-TPLA
000000     MOVE TB-ACMDIA-NUME-TPLA (IX-ACMDIA) TO DET-01-NUME-TPLA
000000     MOVE TB-ACMDIA-SALD-TAUT (IX-ACMDIA) TO DET-01-SALD-TAUT
000000     MOVE TB-ACMDIA-NUME-TAUT (IX-ACMDIA) TO DET-01-NUME-TAUT
000000     MOVE TB-ACMDIA-TASA-PROM (IX-ACMDIA) TO DET-01-TASA-PROM
000000     MOVE TB-ACMDIA-TASA-MINI (IX-ACMDIA) TO DET-01-TASA-MINI
000000     MOVE TB-ACMDIA-TASA-MAXI (IX-ACMDIA) TO DET-01-TASA-MAXI
000000     MOVE TB-ACMDIA-TASA-TRPA (IX-ACMDIA) TO DET-01-TASA-TRPA
000000     WRITE REG-DAPLRDC FROM DET-01     AFTER 1
000000     ADD 1                                TO CNT-LINE-DAPLRDC.
000000     IF TB-ACMDIA-KEY-COD-GRPL (IX-ACMDIA) = HIGH-VALUE
000000        NEXT SENTENCE
000000     ELSE
000000        MOVE SPACES                  TO WR-GLS-GRPL.
000000*
000000     SET IX-ACMDIA UP BY 1.
000000*
000000 HV-TITULOS.
000000     ADD 1                       TO CNT-PAGE-DAPLRDC
000000     MOVE CNT-PAGE-DAPLRDC       TO TIT-02-NUM-PAGE
000000     WRITE REG-DAPLRDC FROM TIT-01 AFTER CANAL-1
000000     WRITE REG-DAPLRDC FROM TIT-02 AFTER 1
000000     WRITE REG-DAPLRDC FROM TIT-03 AFTER 1
000000     WRITE REG-DAPLRDC FROM TIT-04 AFTER 2
000000     WRITE REG-DAPLRDC FROM TIT-05 AFTER 1
000000     WRITE REG-DAPLRDC FROM TIT-06 AFTER 1
000000     WRITE REG-DAPLRDC FROM TIT-07 AFTER 1
000000     WRITE REG-DAPLRDC FROM TIT-08 AFTER 1
000000     WRITE REG-DAPLRDC FROM TIT-04 AFTER 1
000000     MOVE 10                     TO CNT-LINE-DAPLRDC.
000000*
000000 HZZ-FIN-SECC.
000000     EXIT.
000000     EJECT

