       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      DAPPLCDU.
       AUTHOR.          ADA LTDA..
       DATE-WRITTEN.    07-Jul-00 04:23 PM.

      * Programa Listador de Reporte CDU sin Sort.
      *
      * V 1.1.2
      *

      * Emite informes con Depositos a Plazo CADUCADOS

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.

            C01 IS SALTO
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT RPTCDU       ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTCDU       ASSIGN TO        UT-S-RPTCDU.
           SELECT RPTCDU       ASSIGN TO        UT-S-RPTCDU.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       FD  RPTCDU LABEL RECORDS OMITTED
           BLOCK CONTAINS 0 RECORDS
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-CDU     PIC X(132).

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CDU-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY DAPBRCDU.
       COPY DAPRRCDU.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSWGGRC.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY DAPRWCDU.
       COPY DAPRNCDU.
       COPY DAPROCDU.
       COPY GNSWGSYS.
       01  PGM-HRSR-CDU   VALUE 'N'       PIC X(01).
           88 HAY-REGISTROS-EN-SORT-CDU  VALUE 'S'.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       01  WSS-VARI.
           03  WSS-FEC-FPAR.
               05  WSS-NUM-SPAR                            PIC 9(02).
               05  WSS-NUM-APAR                            PIC 9(02).
               05  WSS-NUM-MPAR                            PIC 9(02).
               05  WSS-NUM-DPAR                            PIC 9(02).
           03  WSS-FEC-FPRO.
               05  WSS-NUM-DPRO                            PIC 9(02).
               05  WSS-NUM-MPRO                            PIC 9(02).
               05  WSS-NUM-SPRO                            PIC 9(02).
               05  WSS-NUM-APRO                            PIC 9(02).
      *
       COPY DAPBROPD.
       COPY DAPBRRCC.
       COPY DAPBRVEN.

       COPY SGCBRDBC.
       COPY SGCBRRCD.

       COPY TABBROFI.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGCPT.
      *>>>>
      *Entidades de TAB
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
      *Entidades de DAP
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
      *Entidades de SGC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>>

      * AQUI EXISTIA LABEL RF INI
      * AQUI EXISTIA LABEL RF FIN
       COPY DAPRTCDU.

       PROCEDURE DIVISION.
      *==================

      * AQUI EXISTIA LABEL FIN_DEC INI
      * AQUI EXISTIA LABEL FIN_DEC FIN

       MAIN SECTION.
      *------------
       INI-MAIN.
      *    MOVE SYS-MXFL TO SYS-CMND.
      *    PERFORM GNS-PRO-SYS.
       COPY GNSBGEDB.
      *    MOVE 'DAP' TO RPT-SIST.
           MOVE 'DAPPLCDU' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *<<<< INI
           DISPLAY 'INGRESE FECHA DE PROCESO (SSAAMMDD): '
           ACCEPT  WSS-FEC-FPAR IN WSS-VARI.
           DISPLAY WSS-FEC-FPAR IN WSS-VARI.


      *CONVIERTE FECHA DE (SSAAMMDD) A (DDMMSSAA)
           MOVE WSS-NUM-SPAR IN WSS-VARI TO WSS-NUM-SPRO IN WSS-VARI.
           MOVE WSS-NUM-APAR IN WSS-VARI TO WSS-NUM-APRO IN WSS-VARI.
           MOVE WSS-NUM-MPAR IN WSS-VARI TO WSS-NUM-MPRO IN WSS-VARI.
           MOVE WSS-NUM-DPAR IN WSS-VARI TO WSS-NUM-DPRO IN WSS-VARI.
      *VAL-FEC Valida Fecha de Inicio
           MOVE WSS-FEC-FPRO IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR: FECHA DE PROCESO NO VALIDA: '
                         WSS-FEC-FPAR ' ' FEC-MENS
               PERFORM GNS-PRO-ABT.
      *>>>>
       INI-INP-SRT.
      *     MOVE 'DAPPLCDU' TO RPT-NPGM.
           PERFORM CAL-HDR.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM DAP-FIO-CDU.
       FST-INP-SRT.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM DAP-FIO-CDU.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
       COPY DAPRMCDU.
       INI-OUT-SRT.
           OPEN OUTPUT RPTCDU.
           PERFORM INITIATE-RPTCDU.
           MOVE SRT TO SRT-OLD-CDU.
           MOVE SRT TO SRT-CUR-CDU.
      *    PERFORM CDU-FST-PRO-CTL.
       LUP-MAIN.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
      *<<<< LUP_INP
      * RESCATA DATOS DE OPD
           MOVE CDU-CIC-IOPD IN CDU TO OPD-CIC-IOPD IN OPD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR: NO EXISTE DAPOPD : '
                        OPD-CIC-IOPD IN OPD 'FS: ' FIO-STAT
               GO TO NXT-INP-SRT.

      *Procesa solo OPD en estado 'G'
           IF OPD-COD-STAT IN OPD NOT = 'G'
               DISPLAY 'OPD NO PROCESADA : ' OPD-CIC-IOPD IN OPD
                '  NO ESTA EN ESTADO .G. : ' OPD-COD-STAT IN OPD
               GO TO NXT-INP-SRT.

      *Procesa solo OPD FIJAS
           IF OPD-COD-RENO IN OPD = 'S'
               GO TO NXT-INP-SRT.
      *>>>>
       MOV-INP-SRT.
       COPY DAPRMCDU.
       LUP-OUT-SRT.
      *<<<< LUP_OUT
      * MUEVA A LINEA DE TITULOS
           IF CDU-IND-TREG IN CDU = '1'
               MOVE ' PARA PUBLICACION' TO WSS-GLS-TITU IN WSS-CDU
           ELSE
               MOVE '   PARA EL FISCO ' TO WSS-GLS-TITU IN WSS-CDU.

      * OBTIENE GLOSA DE OFICINA
           IF OPD-COD-OFIC IN OPD > SPACES
               MOVE OPD-COD-OFIC IN OPD TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFIC IN WSS-CDU
           ELSE
               MOVE SPACES TO WSS-GLS-OFIC IN WSS-CDU.

      * OBTIENE GLOSA DE MONEDA
           IF OPD-COD-VCAM IN OPD > SPACES
               MOVE OPD-COD-VCAM IN OPD TO WSS-COD-VCAM IN WSS-CDU
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE OPD-COD-VCAM IN OPD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-VCAM IN WSS-CDU
           ELSE
               MOVE SPACES TO WSS-COD-VCAM IN WSS-CDU.
               MOVE SPACES TO WSS-GLS-VCAM IN WSS-CDU.
      *>>>>
           PERFORM GENERATE-DL-CDU.
      *<<<< FIN_GEN_OUT
      * OBTIENE NOMBRE DEL CLIENTE Y RUT
           MOVE OPD-CIC-IOPD IN OPD TO RCC-CIC-IOPD IN RCC.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT (FIO-STAT-OKS AND
              OPD-CIC-IOPD IN OPD = RCC-CIC-IOPD IN RCC)
               GO TO FIN-LEE-CLI.
        LUP-LEE-CLI.
           IF FIO-STAT-OKS AND
              (OPD-CIC-IOPD IN OPD = RCC-CIC-IOPD IN RCC)
               MOVE RCC-CIC-ICLI IN RCC TO DBC-CIC-ICLI IN DBC
               PERFORM SGC-FIO-DBC
               IF FIO-STAT-OKS
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN TO WSS-GLS-NOMC IN WSS-CDU
                   MOVE DBC-NUM-ICLI IN DBC TO WSS-NUM-ICLI IN WSS-CDU
                   MOVE DBC-VRF-ICLI IN DBC TO WSS-VRF-ICLI IN WSS-CDU
               ELSE
                   MOVE SPACES   TO WSS-GLS-NOMC IN WSS-CDU
                   MOVE SPACES   TO WSS-NUM-ICLI IN WSS-CDU
                   MOVE SPACES   TO WSS-VRF-ICLI IN WSS-CDU
                   MOVE SPACES   TO WSS-NUM-ICLI IN WSS-CDU
                   MOVE SPACES   TO WSS-VRF-ICLI IN WSS-CDU
           ELSE
               MOVE SPACES   TO WSS-GLS-NOMC IN WSS-CDU
               MOVE SPACES   TO WSS-NUM-ICLI IN WSS-CDU
               MOVE SPACES   TO WSS-VRF-ICLI IN WSS-CDU
               MOVE SPACES   TO WSS-NUM-ICLI IN WSS-CDU
               MOVE SPACES   TO WSS-VRF-ICLI IN WSS-CDU
               GO TO FIN-LEE-CLI.

      * RESCATA DIRECCION PRINCIPAL DEL CLIENTE
           IF FIO-STAT-OKS
               MOVE RCC-CIC-ICLI IN RCC TO RCD-CIC-ICLI IN RCD
               MOVE RCC-NUM-DIRE IN RCC TO RCD-NUM-DIRE IN RCD
               MOVE 'RCD-KEY-IRCD' TO FIO-AKEY
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM SGC-FIO-RCD
               IF FIO-STAT-OKS
                   MOVE RCD-GLS-DIRE IN RCD TO WSS-GLS-DOMI IN WSS-CDU
                   IF RCD-COD-LUGA IN RCD > SPACES
                       PERFORM BUSCA-COMUNA
                   ELSE
                       MOVE SPACES TO WSS-GLS-COMU IN WSS-CDU
               ELSE
                   MOVE SPACES TO WSS-GLS-DOMI IN WSS-CDU
                   MOVE SPACES TO WSS-GLS-COMU IN WSS-CDU
           ELSE
               MOVE SPACES TO WSS-GLS-DOMI IN WSS-CDU
               MOVE SPACES TO WSS-GLS-COMU IN WSS-CDU.

           PERFORM GENERATE-DL-CLI.
       NXT-LEE-CLI.
           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           PERFORM DAP-FIO-RCC.
           GO TO LUP-LEE-CLI.
       FIN-LEE-CLI.
           PERFORM GENERATE-DL-LIN.
      *>>>>
       NXT-INP-SRT.
       NXT-OUT-SRT.
           MOVE SRT TO SRT-OLD-CDU.
       RET-OUT-SRT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-CDU.
           GO TO LUP-MAIN.
       FIN-MAIN.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM DAP-FIO-CDU.
       FIN-OUT-SRT.
           IF HAY-REGISTROS-EN-SORT-CDU
                PERFORM TERMINATE-RPTCDU.
           CLOSE RPTCDU.
           IF PGM-STAT-SRT-MAL
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       COPY DAPBFCDU.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGIRH.
       COPY DAPRECDU.
      *    07-JUL-00 04:22 PM     ,PAI= ,CLI= ,SOP=MVS  V 1.1.3
       D-CH-CDU-OPD-COD-OFIC SECTION.
       INI-CH-CDU-OPD-COD-OFIC.
       FIN-CH-CDU-OPD-COD-OFIC.
           EXIT.
       D-CH-CDU-CDU-IND-TREG SECTION.
       INI-CH-CDU-CDU-IND-TREG.
       FIN-CH-CDU-CDU-IND-TREG.
           EXIT.
       D-PH-CDU SECTION.
       INI-PH-CDU.
       FIN-PH-CDU.
           EXIT.
       D-DL-CDU SECTION.
       INI-DL-CDU.
       FIN-DL-CDU.
           EXIT.
       D-DL-CLI SECTION.
       INI-DL-CLI.
       FIN-DL-CLI.
           EXIT.
       D-DL-LIN SECTION.
       INI-DL-LIN.
       FIN-DL-LIN.
           EXIT.
       COPY GNSBGABT.

      *<<<< EOF
       BUSCA-COMUNA SECTION.
       INI-BUSCA-COMUNA.
           MOVE 'TAB' TO FIO-SIST.
           MOVE 'COM'               TO TAB-COD-TTAB IN TAB.
           MOVE RCD-COD-LUGA IN RCD TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-COMU IN WSS-CDU
           ELSE
               MOVE SPACES              TO WSS-GLS-COMU IN WSS-CDU.
       FIN-BUSCA-COMUNA.
           EXIT.

       COPY DAPBFOPD.
       COPY DAPBFRCC.
       COPY DAPBFVEN.

      *Entidades de SGC
       COPY SGCBFDBC.
       COPY SGCBFRCD.

       COPY TABBFOFI.
       COPY TABBBOFI.
       COPY GNSBGHOY.
       COPY GNSBBMSG.
       COPY GNSBGFEC.
       COPY GNSBGCPT.
       COPY GNSBBTAB.
      *>>>>
