       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      DAPPLSAD.
       AUTHOR.          BEE-TEAM.
       DATE-WRITTEN.    29-May-00 12:03 PM.

      * Programa Listador de Reporte SAD con Sort.
      *
      * V 1.1.2
      *

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            C01 IS SALTO
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
      *DOS SELECT RPTSAD         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTSAD         ASSIGN TO        UT-S-RPTSAD.
           SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT RPTSAD         ASSIGN TO        UT-S-RPTSAD.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY DAPRRSAD.
      *<<<< RR
           05 OPD-COD-PBTI PIC X(1).
      *>>>>
       FD  RPTSAD LABEL RECORDS OMITTED
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-SAD     PIC X(132).

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY DAPBROPD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSWGGRC.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY DAPRWSAD.
       COPY DAPRNSAD.
       COPY DAPROSAD.
       COPY GNSWGSYS.
       01  PGM-HRSR-SAD   VALUE 'N'       PIC X(01).
           88 HAY-REGISTROS-EN-SORT-SAD  VALUE 'S'.

       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
      *Entidades de GNS
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGCPT.
      *Entidades de TAB
       COPY TABBRUSR.
       COPY TABBROFI.
       COPY TABBRVLR.
      *Entidades de DAP
       COPY DAPBRRCC.
       COPY DAPBRPTD.
      * RRM-INI 18-AUG-1998.
       COPY DAPBRSAD.
       COPY GNSWGPES.
      * RRM-FIN 18-AUG-1998.
      *Entidades de SGC
       COPY SGCBRDBC.

       01  WSS-VARI.
           03 WSS-TOT-AUXI                      PIC 9(07)V9(07) VALUE 0.
           03 WSS-TOT-AUXI-EDT                  PIC Z.ZZZ.ZZ9,9999999.
           03 WSS-VAL-MONTO                     PIC 9(11)V9(04) VALUE 0.
           03 WSS-CIC-IOPD                        PIC X(12).
           03 WSS-I              VALUE 0          PIC 9(04).
           03 WSS-NUM-JUL        VALUE 0          PIC 9(06).
           03 WSS-NDIA                            PIC 9(04).
           03 WSS-TRM-DIA                         PIC 9(04).
           03 WSS-TRM-DIA-TEMP                    PIC 9(04).
           03 WSS-TRM-MTO                         PIC 9(04).
           03 WSS-IND-TDIA                        PIC X(01).
           03 WSS-IND-TMTO                        PIC X(01).
           03 WSS-IDX-INT                         PIC 9(04).
           03  WSS-FEC-FINI.
               05  WSS-NUM-DINI                      PIC 9(02).
               05  WSS-NUM-MINI                      PIC 9(02).
               05  WSS-NUM-SINI                      PIC 9(02).
               05  WSS-NUM-AINI                      PIC 9(02).
           03  WSS-FEC-FFIN.
               05  WSS-NUM-DFIN                      PIC 9(02).
               05  WSS-NUM-MFIN                      PIC 9(02).
               05  WSS-NUM-SFIN                      PIC 9(02).
               05  WSS-NUM-AFIN                      PIC 9(02).
           03  WSS-FEC-FPRI.
               05  WSS-NUM-SPRI                      PIC 9(02).
               05  WSS-NUM-APRI                      PIC 9(02).
               05  WSS-NUM-MPRI                      PIC 9(02).
               05  WSS-NUM-DPRI                      PIC 9(02).
           03  WSS-FEC-FTER.
               05  WSS-NUM-STER                      PIC 9(02).
               05  WSS-NUM-ATER                      PIC 9(02).
               05  WSS-NUM-MTER                      PIC 9(02).
               05  WSS-NUM-DTER                      PIC 9(02).
           03  WSS-FEC-FREA                          PIC 9(08).
           03  WSS-FEC-FREA-R REDEFINES WSS-FEC-FREA.
               05  WSS-NUM-SREA                      PIC 9(02).
               05  WSS-NUM-AREA                      PIC 9(02).
               05  WSS-NUM-MREA                      PIC 9(02).
               05  WSS-NUM-DREA                      PIC 9(02).
           03  WSS-FEC-FPVC                          PIC 9(08).
           03  WSS-FEC-FPVC-R REDEFINES WSS-FEC-FPVC.
               05  WSS-NUM-SPVC                      PIC 9(02).
               05  WSS-NUM-APVC                      PIC 9(02).
               05  WSS-NUM-MPVC                      PIC 9(02).
               05  WSS-NUM-DPVC                      PIC 9(02).
           03  WSS-HRA-HRTR                          PIC 9(06).
           03  WSS-HRA-HRTR-R REDEFINES WSS-HRA-HRTR.
               05  WSS-NUM-HHTR                      PIC 9(02).
               05  WSS-NUM-MMTR                      PIC 9(02).
               05  WSS-NUM-SSTR                      PIC 9(02).
           03  WSS-COD-OFIC                          PIC X(03).
           03  WSS-COD-COPD                          PIC X(06).
           03  WSS-COD-VCAM                          PIC X(06).
           03  WSS-COD-VIGE                          PIC X(03).
           03  WSS-TOT-COPD        VALUE ZEROES      PIC 9(05).
           03  WSS-TOT-VCAM        VALUE ZEROES      PIC 9(05).
           03  WSS-TOT-OFIC        VALUE ZEROES      PIC 9(05).
           03  WSS-TOT-FECH        VALUE ZEROES      PIC 9(05).
           03  WSS-GLS-DEST.
               05  WSS-GLS-DES1                      PIC X(20).
               05  WSS-GLS-DES2                      PIC X(20).
      * DAPR0025-INI(RRM) 10-FEB-2000
           03  WSS-IDX-TMAR        VALUE ZEROES             PIC 9(04).
           03  WSS-IDX-TEMP        VALUE ZEROES             PIC 9(04).
           03  WSS-IDX-TEMP-OLD    VALUE ZEROES             PIC 9(04).
           03  WSS-NUM-RNGO        VALUE ZEROES             PIC 9(01).
           03  WSS-SGV-TMAX        VALUE ZEROES COMP PIC S9(03)V9(04).
           03  WSS-SGV-TMAR        VALUE ZEROES COMP PIC S9(03)V9(04).
           03  WSS-SGV-TSPM        VALUE ZEROES COMP PIC S9(03)V9(04).
           03  WSS-TIT-TAS0                                 PIC X(25)
                   VALUE                  'MAX RANGO    MARGINAL    '.
           03  WSS-TIT-TAS1                                 PIC X(25)
                   VALUE                  ' MARGINAL  SUPER MARGINAL'.
           03  WSS-TIT-RTP0                                 PIC X(42)
                   VALUE '  OPERACIONES DAP CON TASAS ESPECIALES    '.
           03  WSS-TIT-RTP1                                 PIC X(42)
                   VALUE 'OPERACIONES DAP CON TASAS SUPER MARGINALES'.
           03  WSS-IND-TIT-FEC                              PIC X(01).
           03  WSS-TIT-FEC-IGUAL.
               05 FILLER        VALUE '  FECHA DE PROCESO ' PIC X(19).
               05 WSS-TIT-EQ-DFEC                           PIC 9(02).
               05 FILLER        VALUE '-'                   PIC X(01).
               05 WSS-TIT-EQ-MFEC                           PIC 9(02).
               05 FILLER        VALUE '-'                   PIC X(01).
               05 WSS-TIT-EQ-SFEC                           PIC 9(02).
               05 WSS-TIT-EQ-AFEC                           PIC 9(02).
               05 FILLER        VALUE SPACES                PIC X(05).
           03  WSS-TIT-FEC-DIFF.
               05 FILLER        VALUE 'DESDE '              PIC X(07).
               05 WSS-TIT-NEQ-DFECI                         PIC 9(02).
               05 FILLER        VALUE '-'                   PIC X(01).
               05 WSS-TIT-NEQ-MFECI                         PIC 9(02).
               05 FILLER        VALUE '-'                   PIC X(01).
               05 WSS-TIT-NEQ-SFECI                         PIC 9(02).
               05 WSS-TIT-NEQ-AFECI                         PIC 9(02).
               05 FILLER        VALUE ' HASTA '             PIC X(07).
               05 WSS-TIT-NEQ-DFECF                         PIC 9(02).
               05 FILLER        VALUE '-'                   PIC X(01).
               05 WSS-TIT-NEQ-MFECF                         PIC 9(02).
               05 FILLER        VALUE '-'                   PIC X(01).
               05 WSS-TIT-NEQ-SFECF                         PIC 9(02).
               05 WSS-TIT-NEQ-AFECF                         PIC 9(02).
      * DAPR0025-FIN(RRM) 10-FEB-2000
      * DAPR0029-INI(RRM) 10-MAY-2000
           03  WSS-FEC-FTRN.
               05 WSS-NUM-STRN                              PIC X(02).
               05 WSS-NUM-ATRN                              PIC X(02).
               05 WSS-NUM-MTRN                              PIC X(02).
               05 WSS-NUM-DTRN                              PIC X(02).
      * DAPR0029-FIN(RRM) 10-MAY-2000
      * RRM-INI 17-AUG-1998
      * PLAZO DEL PRODUCTO SEGUN TASA ( M = 30, A = 360 )
           03  WSS-COD-0999                          PIC X(06).
           03  WSS-NUM-PPRD        VALUE ZEROES      PIC 9(03).
      *
           03  WSS-VAL-CAPT           PIC  ZZ.ZZZ.ZZZ.ZZ9,9999.
           03  WSS-SGV-TSMX           PIC             ZZ9,9999.
           03  WSS-SGV-TINT           PIC             ZZ9,9999.
           03  WSS-EDT-COFI           PIC         ZZZ.ZZ9,9999.

       01  WSS-MAT-PBT.
           03 WSS-TBL-PBT OCCURS 10 TIMES.
              05 WSS-PBT-CTAB PIC X(12).
              05 WSS-PBT-PLZO PIC 9(05).
       01 WSS-TOT-PBT  VALUE ZEROES       PIC 9(03).
       01 WSS-IDX-PBT  VALUE ZEROES       PIC 9(03).
       01 WSS-HAY-PBT  VALUE SPACES       PIC X(01).
      * RRM-FIN 17-AUG-1998

      * ISP: VARIABLES WSS-PTD
       COPY DAPWG004.
      *>>>>
      *<<<< WSS_DTC
      *Entidades de TAB
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
      *RRM:
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
      *Entidades de DAP
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PTD-REQA==.
      * RRM-INI 18-AUG-1998
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-SAD-REQA==.
      *Entidades de SGC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>>

      * AQUI EXISTIA LABEL RF INI
      * AQUI EXISTIA LABEL RF FIN
       COPY DAPRTSAD.

       PROCEDURE DIVISION.
      *==================

      * AQUI EXISTIA LABEL FIN_DEC INI
      * AQUI EXISTIA LABEL FIN_DEC FIN

       MAIN SECTION.
      *------------
       INI-MAIN.
      *    MOVE SYS-MXFL TO SYS-CMND.
      *    PERFORM GNS-PRO-SYS.
       COPY GNSBGEDB.
      *    MOVE 'DAP' TO RPT-SIST.
           MOVE 'DAPPLSAD' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *<<<< INI
           DISPLAY ' '.
           DISPLAY 'INICIO CAPTURA PARAMETROS '.
           DISPLAY ' '.
      * Captura codigo de oficina
           DISPLAY 'INGRESE COD. DE OFICINA (*/XXX) : '.
           ACCEPT  WSS-COD-OFIC IN WSS-VARI.
           DISPLAY WSS-COD-OFIC IN WSS-VARI.

           DISPLAY 'INGRESE FECHA DE INICIO (DDMMSSAA) : '.
           ACCEPT WSS-FEC-FINI IN WSS-VARI.
           DISPLAY WSS-FEC-FINI IN WSS-VARI.

           DISPLAY 'INGRESE FECHA DE TERMINO (DDMMSSAA) : '.
           ACCEPT WSS-FEC-FFIN IN WSS-VARI.
           DISPLAY WSS-FEC-FFIN IN WSS-VARI.

           DISPLAY 'INGRESE CODIGO MONEDA  (*/XXXXXX)   :  '.
           ACCEPT WSS-COD-VCAM IN WSS-VARI.
           DISPLAY WSS-COD-VCAM IN WSS-VARI.

           DISPLAY 'INICIO VALIDACION PARAMETROS '.
           DISPLAY ' '.
      *VAL-OFI Valida Codigo de oficina
           IF WSS-COD-OFIC IN WSS-VARI > SPACES AND
              WSS-COD-OFIC IN WSS-VARI NOT = '*'
              MOVE WSS-COD-OFIC IN WSS-VARI TO OFI-COD-OFIC IN OFI
              PERFORM VAL-OFI
               IF MSG-GLS-MENS = 'COD    NEX'
                  DISPLAY ' '
                  DISPLAY ' PROCESO CANCELADO '
                  DISPLAY ' ERROR VALIDACION OFICINA: ' WSS-COD-OFIC
                  PERFORM GNS-PRO-ABT.

      *VAL-FEC Valida Fecha de Inicio
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N TO FEC-FBLK.
           MOVE FEC-CHOY-N TO FEC-CHOY.
           MOVE FEC-VHBL-N TO FEC-VHBL.
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR VALIDACION EN FECHA DE INICIO: '
                         WSS-FEC-FINI '  ' FEC-MENS
               PERFORM GNS-PRO-ABT.

      *VAL-FEC Valida Fecha de Termino
           MOVE WSS-FEC-FFIN IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N TO FEC-FBLK.
           MOVE FEC-CHOY-N TO FEC-CHOY.
           MOVE FEC-VHBL-N TO FEC-VHBL.
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR VALIDACION EN FECHA DE TERMINO: '
                         WSS-FEC-FFIN '  ' FEC-MENS
               PERFORM GNS-PRO-ABT.

      *CMP-FEC Compara Fecha de Inicio con Fecha de Termino
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FEC1.
           MOVE WSS-FEC-FFIN IN WSS-VARI TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-GRT
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' FECHA INICIO > FECHA TERMINO: '
                         WSS-FEC-FINI ' > ' WSS-FEC-FFIN
               PERFORM GNS-PRO-ABT.

      *VAL-TAB Valida Codigo de moneda
           IF WSS-COD-VCAM IN WSS-VARI > SPACES AND
              WSS-COD-VCAM IN WSS-VARI NOT = '*'
              DISPLAY WSS-COD-VCAM IN WSS-VARI
              MOVE 'TAB'               TO TAB-COD-SIST
              MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
              MOVE WSS-COD-VCAM IN WSS-VARI TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
               IF MSG-GLS-MENS = 'COD    NEX'
                  DISPLAY ' '
                  DISPLAY ' PROCESO CANCELADO '
                  DISPLAY ' ERROR VALIDACION COD. MONEDA: ' WSS-COD-VCAM
                  PERFORM GNS-PRO-ABT.
      *DAPR0025-INI(RRM) 14-FEB-2000
      *    MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DINI IN WSS-SAD.
      *    MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MINI IN WSS-SAD.
      *    MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SINI IN WSS-SAD.
      *    MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AINI IN WSS-SAD.
      *    MOVE WSS-NUM-DFIN IN WSS-VARI TO WSS-NUM-DFIN IN WSS-SAD.
      *    MOVE WSS-NUM-MFIN IN WSS-VARI TO WSS-NUM-MFIN IN WSS-SAD.
      *    MOVE WSS-NUM-SFIN IN WSS-VARI TO WSS-NUM-SFIN IN WSS-SAD.
      *    MOVE WSS-NUM-AFIN IN WSS-VARI TO WSS-NUM-AFIN IN WSS-SAD.
      *DAPR0025-FIN(RRM) 14-FEB-2000
           DISPLAY ' '.

           DISPLAY 'FIN VALIDACION PARAMETROS '.
           DISPLAY ' '.

      * RRM-INI 18-AUG-1998
      * Obtiene Codigo Valor de Cambio de Pesos Mediante CIC de la Moned
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE PDB-CIC-0999   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY ' '
               DISPLAY 'PROCESO CANCELADO ' MSG-GLS-DESC ' : '
                                            TAB-CIC-CTAB
               PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-0999 IN WSS-VARI.

      * Se abre archivo SAD.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM DAP-FIO-SAD.
           IF NOT FIO-STAT-OKS
               DISPLAY '   '
               DISPLAY 'ERROR AL ABRIR ARCHIVO SAD, PROCESO ABORTADO'
               PERFORM GNS-PRO-ABT.
      * RRM-FIN
      *>>>>
           SORT GNSSRT
       COPY DAPRSSAD.
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
      *<<<< FIN
      * RRM:
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM DAP-FIO-SAD.
      *>>>>
           IF PGM-STAT-SRT-MAL OR SORT-RETURN > 0
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
       FST-INP-SRT.
      *<<<< INI_FST_INP
      *Abre otros archivos del PGM.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-DBC.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM DAP-FIO-RCC.

      *Genera registros en archivo SORT.
           MOVE WSS-NUM-DINI IN WSS-VARI TO OPD-NUM-DCMP IN OPD.
           MOVE WSS-NUM-MINI IN WSS-VARI TO OPD-NUM-MCMP IN OPD.
           MOVE WSS-NUM-SINI IN WSS-VARI TO OPD-NUM-SCMP IN OPD.
           MOVE WSS-NUM-AINI IN WSS-VARI TO OPD-NUM-ACMP IN OPD.


           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DPRI IN WSS-VARI.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MPRI IN WSS-VARI.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SPRI IN WSS-VARI.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-APRI IN WSS-VARI.
           MOVE WSS-NUM-DFIN IN WSS-VARI TO WSS-NUM-DTER IN WSS-VARI.
           MOVE WSS-NUM-MFIN IN WSS-VARI TO WSS-NUM-MTER IN WSS-VARI.
           MOVE WSS-NUM-SFIN IN WSS-VARI TO WSS-NUM-STER IN WSS-VARI.
           MOVE WSS-NUM-AFIN IN WSS-VARI TO WSS-NUM-ATER IN WSS-VARI.

      * INICIA BUSQUEDA RETROACTIVA
      *GEN-FEC-INI Genera Fecha de Inicio
           MOVE FEC-RST-DIA              TO FEC-CMND.
           MOVE FEC-FORM-FEC             TO FEC-FORM.
           MOVE 10                       TO FEC-NDIA.
           MOVE OPD-NUM-DCMP IN OPD TO FEC-ITM1.
           MOVE OPD-NUM-MCMP IN OPD TO FEC-ITM2.
           MOVE OPD-NUM-SCMP IN OPD TO FEC-ITM3.
           MOVE OPD-NUM-ACMP IN OPD TO FEC-ITM4.
           PERFORM CAL-FEC.
           MOVE FEC-ITM1 TO OPD-NUM-DCMP IN OPD.
           MOVE FEC-ITM2 TO OPD-NUM-MCMP IN OPD.
           MOVE FEC-ITM3 TO OPD-NUM-SCMP IN OPD.
           MOVE FEC-ITM4 TO OPD-NUM-ACMP IN OPD.

           DISPLAY 'INICIO DE BUSQUEDA ' OPD-NUM-DCMP IN OPD '-'
                                         OPD-NUM-MCMP IN OPD '-'
                                         OPD-NUM-SCMP IN OPD
                                         OPD-NUM-ACMP IN OPD.

      *JVM: Accesa archivo por llave alternativa.
           MOVE 'OPD-FEC-FCMP' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR AL ACCESAR OPD POR OPD-FEC-FCMP : '
                                                     FIO-STAT
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.
           IF OPD-FEC-FCMP IN OPD > WSS-FEC-FTER IN WSS-VARI
               DISPLAY 'NO HAY REGISTROS OPD EN RANGO DE FECHAS : '
                       'DESDE ' WSS-FEC-FINI IN WSS-VARI
                       ' A    ' WSS-FEC-FFIN IN WSS-VARI
               GO TO FIN-INP-SRT
           ELSE
               GO TO LUP-INP-SRT.
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
      *Controla ingreso de regs. vigentes o no vigentes validos
           IF WSS-COD-OFIC IN WSS-VARI > SPACES AND
              WSS-COD-OFIC IN WSS-VARI NOT = '*'
              IF WSS-COD-OFIC IN WSS-VARI NOT = OPD-COD-OFIC IN OPD
                 GO TO NXT-INP-SRT.

           IF WSS-COD-VCAM IN WSS-VARI > SPACES AND
              WSS-COD-VCAM IN WSS-VARI NOT = '*'
              IF WSS-COD-VCAM IN WSS-VARI NOT = OPD-COD-VCAM IN OPD
                 GO TO NXT-INP-SRT.

           IF OPD-COD-EATE IN OPD NOT > SPACES
              GO TO NXT-INP-SRT.

      *DAPR0029-INI(RRM) 10-MAY-2000
           IF OPD-COD-STAT IN OPD NOT = 'G'
              GO TO NXT-INP-SRT.

           IF OPD-COD-SCTB IN OPD NOT = 'VIG'
              GO TO NXT-INP-SRT.
      *DAPR0029-INI(RRM) 10-MAY-2000

      *DAPR0025-INI(RRM) 10-FEB-2000
      *VERIFICA SI ES TASA NORMAL, ESPECIAL O SUPER MARGINAL.
           PERFORM VRF-TASA.
           IF SRT-NUM-TIPT IN SRT = SPACES
              GO TO NXT-INP-SRT.
      *DAPR0025-FIN(RRM) 10-FEB-2000


      * ISP:  22-MAR-1993 07:43:08
           MOVE OPD-CIC-IOPD IN OPD TO WSS-CIC-IOPD.
           MOVE OPD-CIC-ORIG IN OPD TO OPD-CIC-IOPD IN OPD.

           IF OPD-FEC-FTRN IN OPD < WSS-FEC-FPRI IN WSS-VARI
      *DAPR0029-INI(RRM) 29-05-2000 MODIFICACION POR OBS. POSTERIOR.
              OR OPD-FEC-FTRN IN OPD > WSS-FEC-FTER IN WSS-VARI
      *DAPR0029-FIN(RRM) 29-05-2000
      *        DISPLAY 'CAPTACION RECHAZADA FUERA DE RANGO '
      *                OPD-CIC-IOPD IN OPD
              GO TO NXT-INP-SRT.

           MOVE 1 TO SRT-NUM-NOPD IN SRT.

           MOVE 'OPD-FEC-FCMP' TO FIO-AKEY.
      *>>>>
       MOV-INP-SRT.
       COPY DAPRMSAD.
      *<<<< RM
           MOVE OPD-COD-PBTI IN OPD TO OPD-COD-PBTI IN SRT.
      *RRM-INI 24-APR-2000 (BORRADO DE LA EXTENSION DEL RUT)
           MOVE SPACES TO DBC-IND-ICLI IN SRT.
           MOVE SPACES TO WSS-GLS-AUXI IN SRT.
           MOVE SPACES TO DBC-GLS-ICLI IN SRT.
      *RRM-FIN 24-APR-2000
      *>>>>
           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
      *Ubica registro en OPD por fecha
           MOVE 'OPD-FEC-FCMP' TO FIO-AKEY.
           MOVE WSS-CIC-IOPD TO OPD-CIC-IOPD.
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
      *<<<< FIN_NXT_INP
      *Controla ingreso de registros por fecha termino
           IF OPD-FEC-FCMP IN OPD > WSS-FEC-FTER IN WSS-VARI
              GO TO FIN-INP-SRT.
      *>>>>
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM DAP-FIO-OPD.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
           OPEN OUTPUT RPTSAD.
      *     MOVE 'DAPPLSAD' TO RPT-NPGM.
           PERFORM CAL-HDR.
           PERFORM INITIATE-RPTSAD.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           MOVE SRT TO SRT-OLD-SAD.
           MOVE SRT TO SRT-CUR-SAD.
      *    PERFORM SAD-FST-PRO-CTL.
       LUP-OUT-SRT.
      *<<<< LUP_OUT
      *DAPR0025-INI(RRM) 11-FEB-2000
      *Selecciona tipos de titulo
           MOVE 'FECHA EMISION' TO WSS-GLS-FEMI IN WSS-SAD.
           IF SRT-NUM-TIPT IN SRT = '1'
              MOVE WSS-TIT-RTP1 IN WSS-VARI TO WSS-GLS-TITU IN WSS-SAD
              MOVE WSS-TIT-TAS1 IN WSS-VARI TO WSS-GLS-TTAS IN WSS-SAD
           ELSE
              MOVE WSS-TIT-RTP0 IN WSS-VARI TO WSS-GLS-TITU IN WSS-SAD
              MOVE WSS-TIT-TAS0 IN WSS-VARI TO WSS-GLS-TTAS IN WSS-SAD.

           IF WSS-FEC-FINI IN WSS-VARI = WSS-FEC-FFIN IN WSS-VARI
              MOVE WSS-NUM-DINI      IN WSS-VARI   TO
                   WSS-TIT-EQ-DFEC   IN WSS-VARI
              MOVE WSS-NUM-MINI      IN WSS-VARI   TO
                   WSS-TIT-EQ-MFEC   IN WSS-VARI
              MOVE WSS-NUM-SINI      IN WSS-VARI   TO
                   WSS-TIT-EQ-SFEC   IN WSS-VARI
              MOVE WSS-NUM-AINI      IN WSS-VARI   TO
                   WSS-TIT-EQ-AFEC   IN WSS-VARI
              MOVE WSS-TIT-FEC-IGUAL IN WSS-VARI   TO
                   WSS-GLS-RNGO      IN WSS-SAD
      *DAPR0029-INI(RRM) 11-MAY-2000
      *       MOVE SPACES TO OPD-NUM-DREA IN SRT OPD-NUM-MREA IN SRT
      *                      OPD-NUM-SREA IN SRT OPD-NUM-AREA IN SRT
      *                      WSS-GLS-SEP1 IN WSS-SAD
      *                      WSS-GLS-SEP2 IN WSS-SAD
      *                      WSS-GLS-FEMI IN WSS-SAD
              MOVE '-'             TO WSS-GLS-SEP1 IN WSS-SAD
                                      WSS-GLS-SEP2 IN WSS-SAD
      *DAPR0029-FIN(RRM) 11-MAY-2000
           ELSE
              MOVE '-'             TO WSS-GLS-SEP1 IN WSS-SAD
                                      WSS-GLS-SEP2 IN WSS-SAD
              MOVE WSS-NUM-DINI      IN WSS-VARI   TO
                   WSS-TIT-NEQ-DFECI
              MOVE WSS-NUM-MINI      IN WSS-VARI   TO
                   WSS-TIT-NEQ-MFECI
              MOVE WSS-NUM-SINI      IN WSS-VARI   TO
                   WSS-TIT-NEQ-SFECI
              MOVE WSS-NUM-AINI      IN WSS-VARI   TO
                   WSS-TIT-NEQ-AFECI
              MOVE WSS-NUM-DFIN      IN WSS-VARI   TO
                   WSS-TIT-NEQ-DFECF
              MOVE WSS-NUM-MFIN      IN WSS-VARI   TO
                   WSS-TIT-NEQ-MFECF
              MOVE WSS-NUM-SFIN      IN WSS-VARI   TO
                   WSS-TIT-NEQ-SFECF
              MOVE WSS-NUM-AFIN      IN WSS-VARI   TO
                   WSS-TIT-NEQ-AFECF
              MOVE WSS-TIT-FEC-DIFF  IN WSS-VARI   TO
                   WSS-GLS-RNGO      IN WSS-SAD.
      *DAPR0025-FIN(RRM) 11-FEB-2000

      *Limpia FIO-AKEY para lectura de otros archivos
           MOVE SPACES TO FIO-AKEY.

      *Genera glosas,datos de clientes y tasa de interes
           MOVE OPD-CAI-IOPD IN SRT TO RCC-CAI-IOPD IN RCC.
           MOVE OPD-IIC-IOPD IN SRT TO RCC-IIC-IOPD IN RCC.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF FIO-STAT-OKS
              PERFORM GET-RCC-DBC
           ELSE
              PERFORM RST-DBC.


      *RRM-INI 24-APR-2000 (BORRADO DEL "-" DE LA EXTENSION DEL RUT)
           MOVE SPACES TO WSS-GLS-AUXI IN SRT.
      *RRM-FIN 24-APR-2000


      *DAPR0025-INI(RRM) 14-FEB-2000
      *Recupera tasa maxima
      *    PERFORM GET-TINT.
      *    IF MSG-COD-MENS > SPACES
      *        DISPLAY 'ERROR AL ACCESAR PTD ' MSG-COD-MENS
      *    ELSE
      *       PERFORM BUS-SGV-TINT.
      *
      *Obtiene glosas de ejecutivos: captador y autorizador
           PERFORM OBT-GLS-EJEC-EATE.

      *DAPR0025-FIN(RRM) 14-FEB-2000

      *Recupera glosa de tasa
           MOVE 'TAB'        TO TAB-COD-SIST.
           MOVE 'INT'        TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-TINT IN SRT  TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TINT IN WSS-SAD.

      *RRM-INI 17-AUG-1998
           PERFORM BUS-PBT.
           PERFORM CAL-COFI.
      * RRM-FIN 17-AUG-1998

      * RRM-INI 25-SEP-1998
           IF WSS-TOT-AUXI IN WSS-VARI = ZEROES
                 GO TO NXT-OUT-SRT.
      * RRM-FIN 25-SEP-1998
      *>>>>
       GEN-OUT-SRT.
           PERFORM GENERATE-DL-SAD.
      *<<<< FIN_GEN_OUT
           ADD SRT-NUM-NOPD IN SRT TO WSS-TOT-VCAM IN WSS-VARI.
           ADD SRT-NUM-NOPD IN SRT TO WSS-TOT-COPD IN WSS-VARI.
           ADD SRT-NUM-NOPD IN SRT TO WSS-TOT-OFIC IN WSS-VARI.
           ADD SRT-NUM-NOPD IN SRT TO WSS-TOT-FECH IN WSS-VARI.

      * RRM-INI 17-AUG-1998
           PERFORM LLENA-ARCH-SAD.
      * RRM-FIN 17-AUG-1998
      *>>>>
       NXT-OUT-SRT.
           MOVE SRT TO SRT-OLD-SAD.
       RET-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
           IF HAY-REGISTROS-EN-SORT-SAD
                PERFORM TERMINATE-RPTSAD.
           CLOSE RPTSAD.
       EXT-OUT-SRT.
           EXIT.
       COPY DAPBFOPD.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGIRH.
       COPY DAPRESAD.
      *    11-MAY-00 09:45 AM     ,PAI= ,CLI= ,SOP=MVS  V 1.1.3
       D-CF-SAD-OPD-COD-VCAM SECTION.
       INI-CF-SAD-OPD-COD-VCAM.
      *<<<< CF_SAD_OPD_COD_VCAM
           MOVE WSS-TOT-VCAM IN WSS-VARI TO
                          WSS-TOT-VCAM IN WSS-SAD.
           MOVE ZEROES TO WSS-TOT-VCAM IN WSS-VARI.
      *>>>>
       FIN-CF-SAD-OPD-COD-VCAM.
           EXIT.
       D-CF-SAD-OPD-COD-COPD SECTION.
       INI-CF-SAD-OPD-COD-COPD.
      *<<<< CF_SAD_OPD_COD_COPD
           MOVE WSS-TOT-COPD IN WSS-VARI TO
                          WSS-TOT-COPD IN WSS-SAD.
           MOVE ZEROES TO WSS-TOT-COPD IN WSS-VARI.
      *>>>>
       FIN-CF-SAD-OPD-COD-COPD.
           EXIT.
       D-CF-SAD-OPD-COD-OFIC SECTION.
       INI-CF-SAD-OPD-COD-OFIC.
      *<<<< CF_SAD_OPD_COD_OFIC
           MOVE WSS-TOT-OFIC IN WSS-VARI TO
                          WSS-TOT-OFIC IN WSS-SAD.
           MOVE ZEROES TO WSS-TOT-OFIC IN WSS-VARI.
      *DAPR0025-INI(RRM) 15-FEB-2000.
           MOVE ZEROES TO RPT-SAD-PAGE-COUNTER IN RPT-VARI-SAD.
      *DAPR0025-FIN(RRM) 15-FEB-2000.
      *>>>>
       FIN-CF-SAD-OPD-COD-OFIC.
           EXIT.
       D-CF-SAD-OPD-FEC-FTRN SECTION.
       INI-CF-SAD-OPD-FEC-FTRN.
      *<<<< CF_SAD_OPD_FEC_FTRN
           MOVE WSS-TOT-FECH IN WSS-VARI TO
                          WSS-TOT-FECH IN WSS-SAD.
           IF WSS-FEC-FINI IN WSS-VARI = WSS-FEC-FFIN IN WSS-VARI
               MOVE SPACES                   TO WSS-NUM-DTRN IN WSS-SAD
               MOVE SPACES                   TO WSS-GLS-RAY1 IN WSS-SAD
               MOVE SPACES                   TO WSS-NUM-MTRN IN WSS-SAD
               MOVE SPACES                   TO WSS-GLS-RAY2 IN WSS-SAD
               MOVE SPACES                   TO WSS-NUM-STRN IN WSS-SAD
               MOVE SPACES                   TO WSS-NUM-ATRN IN WSS-SAD
           ELSE
               MOVE OPD-FEC-FTRN-OLD         TO WSS-FEC-FTRN IN WSS-VARI
               MOVE WSS-NUM-DTRN IN WSS-VARI TO WSS-NUM-DTRN IN WSS-SAD
               MOVE '-'                      TO WSS-GLS-RAY1 IN WSS-SAD
               MOVE WSS-NUM-MTRN IN WSS-VARI TO WSS-NUM-MTRN IN WSS-SAD
               MOVE '-'                      TO WSS-GLS-RAY2 IN WSS-SAD
               MOVE WSS-NUM-STRN IN WSS-VARI TO WSS-NUM-STRN IN WSS-SAD
               MOVE WSS-NUM-ATRN IN WSS-VARI TO WSS-NUM-ATRN IN WSS-SAD.
           MOVE ZEROES TO WSS-TOT-FECH IN WSS-VARI.
      *>>>>
       FIN-CF-SAD-OPD-FEC-FTRN.
           EXIT.
       D-PH-SAD SECTION.
       INI-PH-SAD.
      *<<<< IF PH_SAD
      *Recupera glosa de oficina
           MOVE OPD-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI.
           PERFORM BUS-OFI.

      *Recupera glosa de moneda
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'VLR' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-VCAM IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-VCAM IN WSS-SAD.

      *Recupera glosa de operacion
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'TIO' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-TOPD IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-DES1 IN WSS-VARI.
      *
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-COPD IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-DES2 IN WSS-VARI.
           MOVE WSS-GLS-DEST IN WSS-VARI TO
                                        WSS-GLS-COPD IN WSS-SAD.
      *>>>>
       FIN-PH-SAD.
           EXIT.
       D-DL-SAD SECTION.
       INI-DL-SAD.
       FIN-DL-SAD.
           EXIT.
       COPY GNSBGABT.

      *<<<< EOF
      * Lee con CIC CLIENTE archivo DBC
       GET-RCC-DBC SECTION.
       INI-GET-RCC-DBC.
           MOVE RCC-CIC-ICLI IN RCC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
              PERFORM RST-DBC
           ELSE
              MOVE '-'  TO WSS-GLS-AUXI IN SRT
              MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
              PERFORM CPT-BLKS
              MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC.
       FIN-GET-RCC-DBC.
           EXIT.

      * Limpia datos cliente
       RST-DBC SECTION.
       INI-RST-DBC.
           MOVE 'CLIENTE INEXISTENTE' TO DBC-GLS-NOMC IN DBC.
           MOVE SPACES TO DBC-NUM-ICLI IN DBC.
           MOVE SPACES TO DBC-VRF-ICLI IN DBC.
           MOVE SPACES TO DBC-IND-ICLI IN DBC.
           MOVE SPACES TO WSS-GLS-AUXI IN SRT.
           MOVE SPACES TO DBC-GLS-ICLI IN DBC.
       FIN-RST-DBC.
           EXIT.

       GET-TINT SECTION.
       INI-GET-TINT.
      *    obtener ptd mas actual y vigente
      *    acceso a ptd con VCAM de la pantalla
           MOVE OPD-COD-VCAM IN SRT     TO PTD-COD-VCAM IN PTD.
           MOVE SPACES                  TO PTD-COD-OFIC IN PTD.
           MOVE SPACES                  TO PTD-COD-TOPD IN PTD.
           MOVE SPACES                  TO PTD-COD-AOPD IN PTD.
           PERFORM GET-FHOY.
           IF OPD-FEC-FREA IN SRT = OPD-FEC-FCMP IN SRT
              MOVE OPD-HRA-HRTR IN SRT TO WSS-HRA-HRTR IN WSS-VARI
              MOVE WSS-NUM-HHTR IN WSS-VARI TO PTD-NUM-HHPT IN PTD
              MOVE WSS-NUM-MMTR IN WSS-VARI TO PTD-NUM-MMPT IN PTD
              MOVE WSS-NUM-SSTR IN WSS-VARI TO PTD-NUM-SSPT IN PTD
           ELSE
           IF OPD-FEC-FREA IN SRT < OPD-FEC-FCMP IN SRT
              MOVE '23'                     TO PTD-NUM-HHPT IN PTD
              MOVE '59'                     TO PTD-NUM-MMPT IN PTD
              MOVE '59'                     TO PTD-NUM-SSPT IN PTD
           ELSE
              MOVE 'COD    NEX' TO MSG-COD-MENS
              DISPLAY 'FECHA DE EMISION MAYOR QUE FECHA COMP. '
                       OPD-FEC-FREA IN SRT ' ' OPD-FEC-FCMP IN SRT
              GO TO FIN-GET-TINT.

           MOVE OPD-NUM-DREA IN SRT TO PTD-NUM-DPTD IN PTD.
           MOVE OPD-NUM-MREA IN SRT TO PTD-NUM-MPTD IN PTD.
           MOVE OPD-NUM-SREA IN SRT TO PTD-NUM-SPTD IN PTD.
           MOVE OPD-NUM-AREA IN SRT TO PTD-NUM-APTD IN PTD.

      * ISP: DAPBG004
           PERFORM CMP-FEC-PTD.

           MOVE FIO-GET-NLS TO FIO-CMND.

       LUP-GET-TINT.
           PERFORM DAP-FIO-PTD.
           IF NOT ( FIO-STAT-OKS AND
                    OPD-COD-VCAM IN SRT = PTD-COD-VCAM IN PTD )
      *        ptd inexistente
               MOVE 'PTD    NEX' TO MSG-COD-MENS
               GO TO FIN-GET-TINT.

           IF NOT ( ( PTD-COD-STAT IN PTD = 'S' )
                    AND
                    ( PTD-COD-TOPD IN PTD = '*' OR
                      PTD-COD-TOPD IN PTD = OPD-COD-TOPD IN SRT )
                    AND
                    ( PTD-COD-AOPD IN PTD = '*' OR
                      PTD-COD-AOPD IN PTD = OPD-COD-AOPD IN SRT )
                    AND
                    ( PTD-COD-OFIC IN PTD = '*' OR
                      PTD-COD-OFIC IN PTD = OPD-COD-OFIC IN SRT ) )
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-GET-TINT.
       FIN-GET-TINT.
           EXIT.

       BUS-SGV-TINT SECTION.
       INI-BUS-SGV-TINT.
      *VAL-FEC diferencia de fechas para calcular valor final
           MOVE OPD-FEC-FREA IN SRT TO WSS-FEC-FREA IN WSS-VARI.
           MOVE WSS-NUM-DREA IN WSS-VARI TO FEC-DEC1.
           MOVE WSS-NUM-MREA IN WSS-VARI TO FEC-MEC1.
           MOVE WSS-NUM-SREA IN WSS-VARI TO FEC-SEC1.
           MOVE WSS-NUM-AREA IN WSS-VARI TO FEC-AEC1.
           MOVE OPD-FEC-FPVC IN SRT TO WSS-FEC-FPVC IN WSS-VARI.
           MOVE WSS-NUM-DPVC IN WSS-VARI TO FEC-DEC2.
           MOVE WSS-NUM-MPVC IN WSS-VARI TO FEC-MEC2.
           MOVE WSS-NUM-SPVC IN WSS-VARI TO FEC-SEC2.
           MOVE WSS-NUM-APVC IN WSS-VARI TO FEC-AEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA TO FEC-CMND.
           PERFORM CAL-FEC.
           IF FEC-STAT-OKS
               MOVE FEC-NDIA TO WSS-NDIA IN WSS-VARI
           ELSE
               DISPLAY 'NDIA NOESPEC ' WSS-NDIA
               GO TO FIN-BUS-SGV-TINT.

           MOVE 10 TO WSS-TRM-DIA.
           MOVE 5  TO WSS-TRM-MTO.

           MOVE 'N' TO WSS-IND-TDIA.
           PERFORM BUS-TRM-DIA VARYING WSS-I FROM 1 BY 1 UNTIL
                   WSS-I > 10 OR WSS-IND-TDIA = 'S'.

           IF WSS-IND-TDIA = 'N'
      *        tramo dia no especificado
               MOVE 'TDIA NOESPEC' TO MSG-COD-MENS
               DISPLAY 'TDIA NOESPEC ' WSS-IND-TDIA
               GO TO FIN-BUS-SGV-TINT.

           MOVE 'N' TO WSS-IND-TMTO.
           PERFORM BUS-TRM-MTO VARYING WSS-I FROM 5 BY -1 UNTIL
                   WSS-I < 1 OR WSS-IND-TMTO = 'S'.

      *     IF WSS-IND-TMTO = 'N'
      *        tramo monto no especificado
      *         MOVE 'TMTO NOESPEC' TO MSG-COD-MENS
      *         DISPLAY 'TMTO NOESPEC' WSS-IND-TMTO
      *         GO TO FIN-BUS-SGV-TINT.

           IF WSS-IND-TMTO = 'N'
                MOVE 1 TO WSS-TRM-MTO.

           MULTIPLY WSS-TRM-DIA BY 5 GIVING WSS-IDX-INT.
           SUBTRACT 5 FROM WSS-IDX-INT.
           ADD WSS-TRM-MTO TO WSS-IDX-INT.

           IF WSS-IND-TMTO = 'N'
               MOVE PTD-SGV-TMIN IN PTD(WSS-IDX-INT) TO
               PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
               MOVE ZEROES TO PTD-SGV-TADC IN PTD(WSS-TRM-MTO).

           MOVE PTD-SGV-TMAX IN PTD(WSS-IDX-INT) TO
                                         SRT-SGV-TMAX IN SRT.
      *     DISPLAY 'WSS-NDIA ' WSS-NDIA.
      *     DISPLAY 'TRM-DIA  ' WSS-TRM-DIA.
      *     DISPLAY 'TRM-MTO  ' WSS-TRM-MTO.
      *     DISPLAY 'IDX-INT  ' WSS-IDX-INT.
      *     DISPLAY 'SGV-TMAX ' SRT-SGV-TMAX IN SRT.
      *     DISPLAY '         '.
       FIN-BUS-SGV-TINT.
           EXIT.

       BUS-TRM-DIA SECTION.
       INI-BUS-TRM-DIA.
           IF WSS-NDIA IN WSS-VARI NOT >
              PTD-NUM-DIAS IN PTD(WSS-I)
               MOVE WSS-I TO WSS-TRM-DIA
               MOVE 'S' TO WSS-IND-TDIA.
       FIN-BUS-TRM-DIA.
           EXIT.

       BUS-TRM-MTO SECTION.
       INI-BUS-TRM-MTO.
           IF PTD-VAL-MNTO IN PTD(WSS-I) > ZEROES
      *RRM     IF OPD-VAL-CAPT IN SRT >
               IF OPD-VAL-CAPT IN OPD >
                 PTD-VAL-MNTO IN PTD(WSS-I)
                 MOVE WSS-I TO WSS-TRM-MTO
                 MOVE 'S' TO WSS-IND-TMTO.
       FIN-BUS-TRM-MTO.
           EXIT.

      *RRM-INI 18-AUG-1998
       BUS-PBT SECTION.
       INI-BUS-PBT.
      * Busca en matriz el plazo producto (30 o 360).
      * De no existir en ella, lo busca en TAB PBT y lo incorpora a la
      * matriz.
           MOVE 'N' TO WSS-HAY-PBT.
           PERFORM BUS-PBT-MAT VARYING WSS-IDX-PBT FROM 1 BY 1
                               UNTIL WSS-IDX-PBT > WSS-TOT-PBT OR
                                     WSS-HAY-PBT = 'S'.
           IF WSS-HAY-PBT = 'S'
                SUBTRACT 1 FROM WSS-IDX-PBT
                MOVE WSS-PBT-PLZO IN WSS-MAT-PBT(WSS-IDX-PBT) TO
                     WSS-NUM-PPRD IN WSS-VARI
           ELSE
               ADD 1 TO WSS-TOT-PBT
               MOVE OPD-COD-PBTI IN SRT TO WSS-PBT-CTAB IN
                                    WSS-MAT-PBT(WSS-IDX-PBT)
      *Obtiene plazo del producto de TAB PBT.
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'PBT' TO TAB-COD-TTAB IN TAB
               MOVE OPD-COD-PBTI IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS > SPACES
                  DISPLAY '   '
                  DISPLAY 'ERROR AL OBTENER PLAZO PRODUCTO'
                  DISPLAY 'PARA OPERACION ' OPD-CAI-IOPD IN SRT '-'
                  DISPLAY                   OPD-IIC-IOPD IN SRT
                  MOVE ZEROES TO WSS-TOT-COFI IN WSS-SAD
               ELSE
                   IF TAB-CIC-CTAB = 'M'
                      MOVE 30 TO WSS-PBT-PLZO IN
                                       WSS-MAT-PBT(WSS-TOT-PBT)
                      MOVE 30 TO WSS-NUM-PPRD IN WSS-VARI
                  ELSE
                  IF TAB-CIC-CTAB = 'A'
                      MOVE 360 TO WSS-PBT-PLZO IN
                                       WSS-MAT-PBT(WSS-TOT-PBT)
                      MOVE 360 TO WSS-NUM-PPRD IN WSS-VARI.
       FIN-BUS-PBT.
           EXIT.

       BUS-PBT-MAT SECTION.
       INI-BUS-PBT-MAT.
           IF OPD-COD-PBTI IN SRT = WSS-PBT-CTAB IN
                                    WSS-MAT-PBT(WSS-IDX-PBT)
                 MOVE 'S' TO WSS-HAY-PBT.
       FIN-BUS-PBT-MAT.
           EXIT.

       CAL-COFI SECTION.
       INI-CAL-COFI.

      * Estas lineas se "*" porque truncaban valores intermedios del
      * calculo, por lo tanto variaba el valor final.
      *     COMPUTE WSS-TOT-COFI IN WSS-SAD =
      *     ( ( ( ( OPD-SGV-TINT IN SRT - SRT-SGV-TMAX IN SRT) / 100 ) *
      *         OPD-NUM-DURV IN SRT ) / WSS-NUM-PPRD IN WSS-VARI ) *
      *      OPD-VAL-CAPT IN SRT.
      * El calculo se realizo paso por paso:

           IF OPD-SGV-TINT IN SRT NOT > SRT-SGV-TMAX IN SRT
               MOVE ZEROES TO WSS-TOT-AUXI
               GO TO FIN-CAL-COFI.

           COMPUTE WSS-TOT-AUXI =
                             OPD-SGV-TINT IN SRT - SRT-SGV-TMAX IN SRT.

           COMPUTE WSS-TOT-AUXI  = WSS-TOT-AUXI / 100.

           COMPUTE WSS-TOT-AUXI  = WSS-TOT-AUXI * OPD-NUM-DURV IN SRT.

           COMPUTE WSS-TOT-AUXI  = WSS-TOT-AUXI / WSS-NUM-PPRD IN
                                                              WSS-VARI.

           COMPUTE WSS-TOT-AUXI  = WSS-TOT-AUXI * OPD-VAL-CAPT IN SRT.

           MOVE WSS-TOT-AUXI TO WSS-TOT-COFI IN WSS-SAD.

           IF OPD-COD-VCAM IN SRT = WSS-COD-0999
               MOVE WSS-TOT-COFI IN WSS-SAD TO PES-SGV-DECI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE TO WSS-TOT-COFI IN WSS-SAD.
       FIN-CAL-COFI.
           EXIT.

       LLENA-ARCH-SAD SECTION.
       INI-LLENA-ARCH-SAD.
           MOVE SPACES TO SAD.
           MOVE WSS-GLS-VCAM IN WSS-SAD  TO SAD-GLS-VCAM IN      SAD.
           MOVE OFI-GLS-DESC IN OFI      TO SAD-GLS-OFIC IN      SAD.
           MOVE OPD-NUM-DURV IN SRT      TO SAD-NUM-DURV IN      SAD.
      *    MOVE WSS-NUM-IDTX IN SRT      TO SAD-NUM-IDTX IN      SAD.
           MOVE ZEROES                   TO SAD-NUM-IDTX IN      SAD.
           MOVE OPD-CAI-IOPD IN SRT      TO SAD-CAI-IOPD IN      SAD.
           MOVE OPD-IIC-IOPD IN SRT      TO SAD-IIC-IOPD IN      SAD.
           MOVE OPD-CAI-ISER IN SRT      TO SAD-CAI-ISER IN      SAD.
           MOVE OPD-IIC-ISER IN SRT      TO SAD-IIC-ISER IN      SAD.
           MOVE OPD-FEC-FREA IN SRT      TO SAD-FEC-FREA IN      SAD.
           MOVE WSS-GLS-COPD IN WSS-SAD  TO SAD-GLS-COPD IN      SAD.
           MOVE WSS-GLS-TINT IN WSS-SAD  TO SAD-GLS-TINT IN      SAD.
           MOVE OPD-VAL-CAPT IN SRT      TO WSS-VAL-CAPT IN WSS-VARI.
           MOVE WSS-VAL-CAPT IN WSS-VARI TO SAD-VAL-CAPT IN      SAD.
           MOVE SRT-SGV-TMAX IN SRT      TO WSS-SGV-TSMX IN WSS-VARI.
           MOVE WSS-SGV-TSMX IN WSS-VARI TO SAD-SGV-TMAX IN      SAD.
           MOVE OPD-SGV-TINT IN SRT      TO WSS-SGV-TINT IN WSS-VARI.
           MOVE WSS-SGV-TINT IN WSS-VARI TO SAD-SGV-TINT IN      SAD.
           MOVE OPD-COD-EATE IN SRT      TO SAD-COD-EATE IN      SAD.
      * RRM-INI 25-SEP-1998
      *    MOVE WSS-TOT-COFI IN WSS-SAD  TO SAD-TOT-COFI IN      SAD.
           MOVE WSS-TOT-COFI IN WSS-SAD  TO WSS-EDT-COFI IN WSS-VARI.
           MOVE WSS-EDT-COFI IN WSS-VARI TO SAD-TOT-COFI IN      SAD.
      * RRM-FIN 25-SEP-1998
           MOVE DBC-NUM-ICLI IN DBC      TO SAD-NUM-ICLI IN      SAD.
           MOVE DBC-VRF-ICLI IN DBC      TO SAD-VRF-ICLI IN      SAD.
           MOVE DBC-GLS-NOMC IN DBC      TO SAD-GLS-NOMC IN      SAD.
      *Grabando los datos en el archivo secuencial SAD.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-SAD.
           IF NOT FIO-STAT-OKS
                 DISPLAY '  '
                 DISPLAY 'ERROR AL GRABAR DATOS EN DAPSAD'
                 DISPLAY 'PARA OPERACION ' OPD-CAI-IOPD IN SRT '-'
                                                    OPD-IIC-IOPD IN SRT.
        FIN-LLENA-ARCH-SAD.
           EXIT.
      * RRM-FIN 18-AUG-1998

      *DAPR0025-INI(RRM) 10-FEB-2000
       VRF-TASA SECTION.
       INI-VRF-TASA.
           MOVE SPACES TO MSG-COD-MENS.
           PERFORM GET-PTD.
           IF MSG-COD-MENS > SPACES
               DISPLAY 'ERROR AL ACCESAR PTD ' MSG-COD-MENS
           ELSE
              PERFORM OBT-DIF-TASAS.
       FIN-VRF-TASA.
           EXIT.


       OBT-DIF-TASAS SECTION.
       INI-OBT-DIF-TASAS.
      *VAL-FEC diferencia de fechas para calcular valor final
           MOVE OPD-FEC-FREA IN OPD TO WSS-FEC-FREA IN WSS-VARI.
           MOVE WSS-NUM-DREA IN WSS-VARI TO FEC-DEC1.
           MOVE WSS-NUM-MREA IN WSS-VARI TO FEC-MEC1.
           MOVE WSS-NUM-SREA IN WSS-VARI TO FEC-SEC1.
           MOVE WSS-NUM-AREA IN WSS-VARI TO FEC-AEC1.
           MOVE OPD-FEC-FPVC IN OPD TO WSS-FEC-FPVC IN WSS-VARI.
           MOVE WSS-NUM-DPVC IN WSS-VARI TO FEC-DEC2.
           MOVE WSS-NUM-MPVC IN WSS-VARI TO FEC-MEC2.
           MOVE WSS-NUM-SPVC IN WSS-VARI TO FEC-SEC2.
           MOVE WSS-NUM-APVC IN WSS-VARI TO FEC-AEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA TO FEC-CMND.
           PERFORM CAL-FEC.
           IF FEC-STAT-OKS
               MOVE FEC-NDIA TO WSS-NDIA IN WSS-VARI
           ELSE
               DISPLAY 'NDIA NOESPEC ' WSS-NDIA
               GO TO FIN-OBT-DIF-TASAS.

           MOVE 10 TO WSS-TRM-DIA.
           MOVE 5  TO WSS-TRM-MTO.

           MOVE 'N' TO WSS-IND-TDIA.
           PERFORM BUS-TRM-DIA VARYING WSS-I FROM 1 BY 1 UNTIL
                   WSS-I > 10 OR WSS-IND-TDIA = 'S'.

           IF WSS-IND-TDIA = 'N'
      *        tramo dia no especificado
               MOVE 'TDIA NOESPEC' TO MSG-COD-MENS
               DISPLAY 'TDIA NOESPEC ' WSS-IND-TDIA
               GO TO FIN-OBT-DIF-TASAS.

           MOVE 'N' TO WSS-IND-TMTO.
           PERFORM BUS-TRM-MTO VARYING WSS-I FROM 5 BY -1 UNTIL
                   WSS-I < 1 OR WSS-IND-TMTO = 'S'.

           IF WSS-IND-TMTO = 'N'
                MOVE 1 TO WSS-TRM-MTO.

           MULTIPLY WSS-TRM-DIA BY 5 GIVING WSS-IDX-INT.
           SUBTRACT 5 FROM WSS-IDX-INT.
           ADD WSS-TRM-MTO TO WSS-IDX-INT.

           IF WSS-IND-TMTO = 'N'
               MOVE PTD-SGV-TMIN IN PTD(WSS-IDX-INT) TO
               PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
               MOVE ZEROES TO PTD-SGV-TADC IN PTD(WSS-TRM-MTO).

           MOVE PTD-SGV-TMAX IN PTD(WSS-IDX-INT) TO
                                         WSS-SGV-TMAX IN WSS-VARI
                                         SRT-SGV-TMAX IN SRT.

      *DAPR0025-INI(RRM) 8-MAR-2000
           MOVE WSS-TRM-DIA TO WSS-TRM-DIA-TEMP.
           MOVE WSS-IDX-INT TO WSS-IDX-TEMP.
      *CALCULO PARA TASA MARGINAL SEGUN EL TRAMO-MONTO:
       LUP-TMAR-MNTO.
           IF PTD-COD-TACO IN PTD > SPACES
              MOVE WSS-IDX-TEMP TO WSS-IDX-TEMP-OLD
              ADD 5 TO WSS-IDX-TEMP
              IF PTD-SGV-TMAX(WSS-IDX-TEMP) > ZEROES
                 AND WSS-IDX-TEMP NOT > 50
                   GO TO LUP-TMAR-MNTO
              ELSE
                   MOVE WSS-IDX-TEMP-OLD TO WSS-IDX-TMAR
                   MOVE PTD-SGV-TMAX IN PTD(WSS-IDX-TMAR) TO
                                            WSS-SGV-TMAR IN WSS-VARI
           ELSE
      *DAPR0025-FIN(RRM) 8-MAR-2000

      *CALCULOS PARA OBTENER TASA MARGINAL SEGUN EL TRAMO-DIA:
           MULTIPLY WSS-TRM-DIA BY 5 GIVING WSS-IDX-TMAR.
       LUP-BUS-TMAR.
           IF WSS-IDX-TMAR > WSS-IDX-INT
              IF PTD-SGV-TMAX IN PTD(WSS-IDX-TMAR) > ZEROES
                 MOVE PTD-SGV-TMAX IN PTD(WSS-IDX-TMAR) TO
                                            WSS-SGV-TMAR IN WSS-VARI
              ELSE
                 SUBTRACT 1 FROM WSS-IDX-TMAR IN WSS-VARI
                 GO TO LUP-BUS-TMAR
           ELSE
              MOVE WSS-SGV-TMAX IN WSS-VARI TO WSS-SGV-TMAR IN WSS-VARI.

      *CALCULOS PARA OBTENER TASA SUPER MARGINAL:

      *DAPR0025-INI(RRM) 6-MAR-2000
           MOVE WSS-SGV-TMAR IN WSS-VARI TO WSS-SGV-TSPM IN WSS-VARI.

      *TASAS ADICIONALES POR COLUMNA
           IF PTD-COD-TACO IN PTD > SPACES
                IF PTD-COD-TACO IN PTD = 'M'
                    ADD  PTD-SGV-TADC IN PTD(WSS-TRM-MTO) TO
                         WSS-SGV-TSPM IN WSS-VARI
                ELSE
                    MOVE PTD-SGV-TADC IN PTD(WSS-TRM-MTO) TO
                         WSS-SGV-TSPM IN WSS-VARI

      *    MOVE WSS-SGV-TMAR IN WSS-VARI TO WSS-SGV-TSPM IN WSS-VARI.

      * TASAS ADICIONALES POR FILA
           ELSE
            IF PTD-COD-TAFI IN PTD > SPACES
               IF PTD-COD-TAFI IN PTD = 'M'
                  ADD PTD-SGV-TAFI IN PTD(WSS-TRM-DIA) TO
                  WSS-SGV-TSPM IN WSS-VARI
                ELSE
                  MOVE PTD-SGV-TAFI IN PTD(WSS-TRM-DIA) TO
                  WSS-SGV-TSPM IN WSS-VARI.
      *DAPR0025-FIN(RRM) 6-MAR-2000

      *DETERMINA TASA NORMAL, ESPECIAL, SUPER MARGINAL.
           MOVE SPACES TO SRT-NUM-TIPT IN SRT.

           IF OPD-SGV-TINT IN OPD NOT > WSS-SGV-TMAX IN WSS-VARI
              GO TO FIN-OBT-DIF-TASAS.

           IF OPD-SGV-TINT IN OPD     > WSS-SGV-TMAX IN WSS-VARI AND
              OPD-SGV-TINT IN OPD NOT > WSS-SGV-TMAR IN WSS-VARI
              MOVE '0' TO SRT-NUM-TIPT IN SRT
              MOVE WSS-SGV-TMAX IN WSS-VARI TO SRT-SGV-TAS1 IN SRT
              MOVE WSS-SGV-TMAR IN WSS-VARI TO SRT-SGV-TAS2 IN SRT
              GO TO FIN-OBT-DIF-TASAS.

           IF OPD-SGV-TINT IN OPD     > WSS-SGV-TMAR IN WSS-VARI
      *       AND OPD-SGV-TINT IN OPD NOT > WSS-SGV-TSPM IN WSS-VARI
              MOVE '1' TO SRT-NUM-TIPT IN SRT
              MOVE WSS-SGV-TMAR IN WSS-VARI TO SRT-SGV-TAS1 IN SRT
              MOVE WSS-SGV-TSPM IN WSS-VARI TO SRT-SGV-TAS2 IN SRT
              GO TO FIN-OBT-DIF-TASAS.
       FIN-OBT-DIF-TASAS.
           EXIT.
      *DAPR0025-FIN(RRM) 10-FEB-2000
      *DAPR0025-INI(RRM) 14-FEB-2000
       OBT-GLS-EJEC-EATE SECTION.
       INI-OBT-GLS-EJEC-EATE.
      *Obtiene glosa de ejecutivo captador
           MOVE OPD-COD-EJEC IN SRT TO USR-COD-USER IN USR.
           PERFORM VAL-USR.
           IF MSG-COD-MENS NOT = 'COD    NEX'
               MOVE USR-GLS-DESC IN USR TO WSS-GLS-EJEC IN WSS-SAD
           ELSE
               MOVE SPACES TO WSS-GLS-EJEC IN WSS-SAD.

      *Obtiene glosa de ejecutivo autorizador de tasa especial
           MOVE OPD-COD-EATE IN SRT TO USR-COD-USER IN USR.
           PERFORM VAL-USR.
           IF MSG-COD-MENS NOT = 'COD    NEX'
               MOVE USR-GLS-DESC IN USR TO WSS-GLS-EATE IN WSS-SAD
           ELSE
               MOVE SPACES TO WSS-GLS-EATE IN WSS-SAD.
       FIN-OBT-GLS-EJEC-EATE.
           EXIT.

       GET-PTD SECTION.
       INI-GET-PTD.
      *    obtener ptd mas actual y vigente
      *    acceso a ptd con VCAM de la pantalla
           MOVE OPD-COD-VCAM IN OPD     TO PTD-COD-VCAM IN PTD.
           MOVE SPACES                  TO PTD-COD-OFIC IN PTD.
           MOVE SPACES                  TO PTD-COD-TOPD IN PTD.
           MOVE SPACES                  TO PTD-COD-AOPD IN PTD.
           PERFORM GET-FHOY.
           IF OPD-FEC-FREA IN OPD = OPD-FEC-FCMP IN OPD
              MOVE OPD-HRA-HRTR IN OPD TO WSS-HRA-HRTR IN WSS-VARI
              MOVE WSS-NUM-HHTR IN WSS-VARI TO PTD-NUM-HHPT IN PTD
              MOVE WSS-NUM-MMTR IN WSS-VARI TO PTD-NUM-MMPT IN PTD
              MOVE WSS-NUM-SSTR IN WSS-VARI TO PTD-NUM-SSPT IN PTD
           ELSE
           IF OPD-FEC-FREA IN OPD < OPD-FEC-FCMP IN OPD
              MOVE '23'                     TO PTD-NUM-HHPT IN PTD
              MOVE '59'                     TO PTD-NUM-MMPT IN PTD
              MOVE '59'                     TO PTD-NUM-SSPT IN PTD
           ELSE
              MOVE 'COD    NEX' TO MSG-COD-MENS
              DISPLAY 'FECHA DE EMISION MAYOR QUE FECHA COMP. '
                       OPD-FEC-FREA IN OPD ' ' OPD-FEC-FCMP IN OPD
              GO TO FIN-GET-PTD.

           MOVE OPD-NUM-DREA IN OPD TO PTD-NUM-DPTD IN PTD.
           MOVE OPD-NUM-MREA IN OPD TO PTD-NUM-MPTD IN PTD.
           MOVE OPD-NUM-SREA IN OPD TO PTD-NUM-SPTD IN PTD.
           MOVE OPD-NUM-AREA IN OPD TO PTD-NUM-APTD IN PTD.

      * ISP: DAPBG004
           PERFORM CMP-FEC-PTD.

           MOVE FIO-GET-NLS TO FIO-CMND.

       LUP-GET-PTD.
           PERFORM DAP-FIO-PTD.
           IF NOT ( FIO-STAT-OKS AND
                    OPD-COD-VCAM IN OPD = PTD-COD-VCAM IN PTD )
      *        ptd inexistente
               MOVE 'PTD    NEX' TO MSG-COD-MENS
               GO TO FIN-GET-PTD.

           IF NOT ( ( PTD-COD-STAT IN PTD = 'S' )
                    AND
                    ( PTD-COD-TOPD IN PTD = '*' OR
                      PTD-COD-TOPD IN PTD = OPD-COD-TOPD IN OPD )
                    AND
                    ( PTD-COD-AOPD IN PTD = '*' OR
                      PTD-COD-AOPD IN PTD = OPD-COD-AOPD IN OPD )
                    AND
                    ( PTD-COD-OFIC IN PTD = '*' OR
                      PTD-COD-OFIC IN PTD = OPD-COD-OFIC IN OPD ) )
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-GET-PTD.
       FIN-GET-PTD.
           EXIT.
      *DAPR0025-FIN(RRM) 14-FEB-2000

      *Entidades  de GNS
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY GNSBGHOY.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY GNSBGCPT.

      *Entidades  de SGC
       COPY SGCBFDBC.

      *Entidades  de DAP
       COPY DAPBFRCC.
       COPY DAPBFPTD.
       COPY DAPBG004.
      *RRM:
       COPY DAPBFSAD.
       COPY GNSBGPES.

      *Entidades  de TAB
       COPY TABBFOFI.
       COPY TABBBOFI.
       COPY TABBVOFI.
      *DAPR0025-INI(RRM) 14-FEB-2000
       COPY TABBBUSR.
       COPY TABBVUSR.
       COPY TABBFUSR.
      *DAPR0025-FIN(RRM) 14-FEB-2000
      *>>>>
