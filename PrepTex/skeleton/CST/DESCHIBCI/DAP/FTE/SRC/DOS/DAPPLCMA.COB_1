000000 IDENTIFICATION DIVISION.
000000 PROGRAM-ID. DAPPLCMA.
000000 AUTHOR.     P CONCHA L.
000000*REMARKS.
      ******************************************************************
      *  INTERSOFT                                                     *
      *  MIGRACION A COBOL OS/390                                      *
      *  FECHA: 30 DE MARZO DE 1998                                    *
      ******************************************************************
000000******************************************************************
000000*  SISTEMA    : DEPOSITOS A PLAZO
000000*  SUB-SISTEMA: INFORMES DAP
000000*  ANALISTA   : P CONCHA L.
000000*  OBJETIVO :
000000*           - GENERAR INFORME DE OPERACIONES MAYORES A MONTO
000000*             POR MONEDA, A PARTIR DE ARCHIVO PLANO
000000*  ARCHIVOS :
000000*  INP      :
000000*             DAPDOPD ARCHIVO IMAGEN DE TABLA OPD + VEN (SAM)
000000*             TABLA RCC: BD 370
000000*             TABLA TAB: BD 150
000000*             TABLA DBC: BD 100
000000*  OUT      :
000000*             DAPLCMA  ARCHIVO DE DATOS.
000000*  WRK      :
000000*             FSORT    ARCHIVO PARA ORDENAMIENTO
000000*
000000******************************************************************
      ******************************************************************
      *      MANTENCIONES.
      *      ==============
      *
      *      PROGRAMADOR : FORMAT 2000 INC.
      *      FECHA       : 20.02.1998
      *      CAMBIO      : SE APLICA TECNICA WINDOWING PARA CONVERSION
      *                      2000 COMPLIANT.
      ******************************************************************
000000     EJECT
000000 ENVIRONMENT DIVISION.
000000 CONFIGURATION SECTION.
000000 SPECIAL-NAMES.
000000     C01 IS CANAL-1
000000     DECIMAL-POINT IS COMMA.
000000*
000000 INPUT-OUTPUT SECTION.
000000 FILE-CONTROL.
000000     SELECT DAPDOPD  ASSIGN UT-S-DAPDOPD.
000000     SELECT FSORT    ASSIGN UT-S-SORTWK1.
000000     SELECT DAPLCMA  ASSIGN UT-S-DAPLCMA.
000000     EJECT
000000 DATA DIVISION.
000000*
000000 FILE SECTION.
000000*
000000*
000000 FD  DAPDOPD
000000     RECORDING MODE IS F
000000     LABEL RECORD STANDARD
000000     BLOCK CONTAINS    0 RECORDS.
000000 01  REG-DAPDOPD.
000000*    COPYDD DAP-R-OPD.DAP-E-OPD00(PROD),02,D
      *                             EQUIVALENTE AL REGISTRO OPD
           02  DAP-E-OPD00.
      *                             OPERACION DEPOSITO A PLAZO
               04  OPD.
      *                             FILLER COMPATIBILIDAD VSAM/MVS
                   06  OPD-GLS-FLAG PICTURE X(1).
      *                             IDENTIFICACION OPERACION DAP
                   06  OPD-KEY-IOPD.
      *                             COD. INT. COMP. OPERACION DAP
                       08  OPD-CIC-IOPD.
      *                             CENTRO ASIGNACION IDENTIFICACION
                       10  OPD-CAI-IOPD
                                    PICTURE X(4).
      *                             IDENT. INTERNA COMPUTACIONAL
                       10  OPD-IIC-IOPD
                                    PICTURE X(8).
      *                             TIME STAMP TRANSACCION
                   06  OPD-STP-ITRN.
      *                             FECHA TRANSACCION
                       08  OPD-FEC-FTRN
                                    PICTURE 9(8).
      *                             HORA TRANSACCION
                       08  OPD-HRA-HRTR
                                    PICTURE 9(6).
      *                             INDICADOR TIPO ACCION
                   06  OPD-COD-TACC PICTURE X(1).
      *                             INDICADOR STATUS
                   06  OPD-COD-STAT PICTURE X(1).
      *                             CODIGO ORIGEN TRANSACCION
                   06  OPD-COD-OTRN PICTURE X(4).
      *                             AUTOR TRANSACCION
                   06  OPD-COD-ATRN PICTURE X(12).
      *                             VALOR DE CAMBIO OPERACION DAP
                   06  OPD-COD-VCAM.
      *                             MISCELANEO TIPO VALOR
                       08  OPD-MSC-TVAL
                                    PICTURE X(1).
      *                             CODIGO VALOR
                       08  OPD-COD-CVAL
                                    PICTURE X(3).
      *                             CODIGO TIPO CAMBIO
                       08  OPD-COD-TCAM
                                    PICTURE X(2).
      *                             CODIGO CLASE OPERACION DAP
                   06  OPD-COD-COPD.
      *                             CODIGO TIPO OPERACION
                       08  OPD-COD-TOPD
                                    PICTURE X(3).
      *                             CODIGO AUXILIAR OPERACION
                       08  OPD-COD-AOPD
                                    PICTURE X(3).
      *                             CODIGO OFICINA OPERACION DAP
                   06  OPD-COD-OFIC PICTURE X(3).
      *                             RESPONSABLE MANTENCION OPERACION DAP
                   06  OPD-COD-EJEC PICTURE X(12).
      *                             COD. INT. COMP. SERIAL CDP
                   06  OPD-CIC-ISER.
      *                             CENTRO ASIGNACION IDENTIFICACION
                       08  OPD-CAI-ISER
                                    PICTURE X(4).
      *                             IDENT. INTERNA COMPUTACIONAL
                       08  OPD-IIC-ISER
                                    PICTURE X(8).
      *                             FECHA CAPTACION REAL
                   06  OPD-FEC-FREA.
                       08  OPD-NUM-SREA
                                    PICTURE 9(2).
                       08  OPD-NUM-AREA
                                    PICTURE 9(2).
                       08  OPD-NUM-MREA
                                    PICTURE 9(2).
                       08  OPD-NUM-DREA
                                    PICTURE 9(2).
      *                             FECHA EMISION CONTABLE
                   06  OPD-FEC-FCTB.
                       08  OPD-NUM-SCTB
                                    PICTURE 9(2).
                       08  OPD-NUM-ACTB
                                    PICTURE 9(2).
                       08  OPD-NUM-MCTB
                                    PICTURE 9(2).
                       08  OPD-NUM-DCTB
                                    PICTURE 9(2).
      *                             FECHA INGRESO COMPUTACIONAL
                   06  OPD-FEC-FCMP.
                       08  OPD-NUM-SCMP
                                    PICTURE 9(2).
                       08  OPD-NUM-ACMP
                                    PICTURE 9(2).
                       08  OPD-NUM-MCMP
                                    PICTURE 9(2).
                       08  OPD-NUM-DCMP
                                    PICTURE 9(2).
      *                             MONTO CAPTACION
                   06  OPD-VAL-CAPT PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             SALDO VALOR CAPTACION
                   06  OPD-VAL-SCAP PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             MONTO A PAGAR POR CAJA
                   06  OPD-VAL-CAJA PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             ANALISIS FERIADOS (S/N)
                   06  OPD-COD-AFER PICTURE X(1).
      *                             CONDICION GARANTIA
                   06  OPD-COD-GARA PICTURE X(1).
      *                             CODIGO UBICACION FISICA CDP
                   06  OPD-COD-UBFD.
                       08  OPD-COD-IUBF
                                    PICTURE X(3).
                       08  OPD-COD-CUBF
                                    PICTURE X(3).
                       08  OPD-COD-SUBF
                                    PICTURE X(3).
      *                             NUMERO PROXIMO VENCIMIENTO
                   06  OPD-NUM-IVEN PICTURE 9(3).
      *                             FECHA PROXIMO VENCIMIENTO
                   06  OPD-FEC-FPVC.
                       08  OPD-NUM-SPVC
                                    PICTURE 9(2).
                       08  OPD-NUM-APVC
                                    PICTURE 9(2).
                       08  OPD-NUM-MPVC
                                    PICTURE 9(2).
                       08  OPD-NUM-DPVC
                                    PICTURE 9(2).
      *                             CODIGO TIPO TASA INTERES
                   06  OPD-COD-TINT.
      *                             CODIGO TIPO TASA
                       08  OPD-COD-TIPT.
      *                             BASE CALCULO TASA INTERES
                       10  OPD-COD-BCTI
                                    PICTURE X(1).
      *                             PERIODO BASE TASA INTERES
                       10  OPD-COD-PBTI
                                    PICTURE X(1).
      *                             MODALIDAD CALCULO TASA INTERES
                       10  OPD-COD-MCTI.
      *                             BAJO PERIODO BASE TASA
                       12  OPD-COD-BPBT
                                    PICTURE X(1).
      *                             SOBRE PERIODO BASE TASA
                       12  OPD-COD-SPBT
                                    PICTURE X(1).
      *                             CODIGO VALOR TASA INTERES
                       08  OPD-COD-CVTI
                                    PICTURE X(3).
      *                             TIPO FECHA PERIODO REPACTO
                       08  OPD-COD-TFPR
                                    PICTURE X(1).
      *                             NUMERO PERIODO REPACTO
                       08  OPD-NUM-PREP
                                    PICTURE 9(3).
      *                             UNIDAD TIEMPO OPD-NUM-PREP
                       08  OPD-MSC-PREP
                                    PICTURE X(1).
      *                             VALOR SPREAD
                   06  OPD-SGV-SPRD PICTURE S9(5)V9(4)
                                        COMPUTATIONAL.
      *                             VALOR TASA
                   06  OPD-SGV-TINT PICTURE S9(5)V9(4)
                                        COMPUTATIONAL.
      *                             RETENCION DOCUMENTO
                   06  OPD-NUM-RETD PICTURE 9(3).
      *                             UNIDAD TIEMPO OPD-NUM-RETD
                   06  OPD-IND-RETD PICTURE X(1).
      *                             IND DEVOLUCION DINERO DOC S/FONDOS
                   06  OPD-COD-DEVL PICTURE X(1).
      *                             INDICADOR CUSTODIA
                   06  OPD-COD-CUST PICTURE X(1).
      *                             CONDICION GARANTIA ( EN POD )
                   06  OPD-COD-GPOD PICTURE X(1).
      *                             SEPARACION ENTRE VENCIMIENTOS
                   06  OPD-NUM-SEVE PICTURE 9(4)
                                        COMPUTATIONAL.
      *                             UNIDAD DE TIEMPO OPD-NUM-SEVE
                   06  OPD-IND-SEVE PICTURE X(1).
      *                             DURACION VENCIMIENTOS
                   06  OPD-NUM-DURV PICTURE 9(4)
                                        COMPUTATIONAL.
      *                             UNIDAD DE TIEMPO OPD-NUM-DURV
                   06  OPD-IND-DURV PICTURE X(1).
      *                             NUMERO VENCIMIENTOS NO LIQUIDADOS
                   06  OPD-NUM-VNLQ PICTURE 9(3).
      *                             NUMERO VENCIMIENTOS LIQUIDADOS
                   06  OPD-NUM-VSLQ PICTURE 9(3).
      *                             MODALIDAD DE RETIRO
                   06  OPD-COD-MORE PICTURE X(2).
      *                             MONTO O PORCENTAJE DEL RETIRO
                   06  OPD-SGV-MPRE PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             INDICADOR ORDEN NO PAGO
                   06  OPD-COD-IONP PICTURE X(1).
      *                             SITUACION CONTABLE
                   06  OPD-COD-SCTB PICTURE X(3).
      *                             INDICADOR RENOVABILIDAD
                   06  OPD-COD-RENO PICTURE X(1).
      *                             INDICADOR ENDOSABILIDAD
                   06  OPD-COD-ENDO PICTURE X(1).
      *                             VALOR REAJUSTES DEVENGADOS
                   06  OPD-VAL-READ PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             VALOR INTERESES DEVENGADOS
                   06  OPD-VAL-INTD PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             USUARIO QUE AUTORIZA TASA ESPECIAL
                   06  OPD-COD-EATE PICTURE X(12).
      *                             TASA PERIODO
                   06  OPD-VAL-SINT PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             FECHA DEVENGO ( ULTIMO PAGO TOTAL IN
                   06  OPD-FEC-FDEV.
                       08  OPD-NUM-SDEV
                                    PICTURE 9(2).
                       08  OPD-NUM-ADEV
                                    PICTURE 9(2).
                       08  OPD-NUM-MDEV
                                    PICTURE 9(2).
                       08  OPD-NUM-DDEV
                                    PICTURE 9(2).
      *                             FECHA TERMINO DE LA OPERACION
                   06  OPD-FEC-FTER.
                       08  OPD-NUM-STER
                                    PICTURE 9(2).
                       08  OPD-NUM-ATER
                                    PICTURE 9(2).
                       08  OPD-NUM-MTER
                                    PICTURE 9(2).
                       08  OPD-NUM-DTER
                                    PICTURE 9(2).
      *                             TIPO CERTIF DAP
                   06  OPD-COD-TCDP PICTURE X(3).
      *                             CODIGO RESCATE
                   06  OPD-COD-RESC PICTURE X(1).
      *                             CODIGO PLAZO PAGO RESCATE
                   06  OPD-COD-PLPA PICTURE X(1).
      *                             PLAZO RESCATE
                   06  OPD-NUM-PLRE PICTURE 9(3).
      *                             UNIDAD TIEMPO PLAZO RESCATE
                   06  OPD-IND-PLRE PICTURE X(1).
      *                             PERIODO NEGOCIACION TASA ESPECIAL
                   06  OPD-NUM-PNTE PICTURE 9(3).
      *                             UNIDAD TIEMPO OPD-NUM-PNTE
                   06  OPD-IND-PNTE PICTURE X(1).
      *                             PLAZO CONTABLE
                   06  OPD-COD-PLZO PICTURE X(2).
      *                             RESERVADO SAFE
                   06  OPD-GLS-SAFE PICTURE X(18).
      *                             FECHA DE CAPTACION ORIGINAL
                   06  OPD-FEC-FPCO.
                       08  OPD-NUM-SPCO
                                    PICTURE 9(2).
                       08  OPD-NUM-APCO
                                    PICTURE 9(2).
                       08  OPD-NUM-MPCO
                                    PICTURE 9(2).
                       08  OPD-NUM-DPCO
                                    PICTURE 9(2).
      *                             PERIODO PRIMER VENCIMIENTO
                   06  OPD-NUM-PVEN PICTURE 9(5)
                                        COMPUTATIONAL-3.
      *                             UNIDAD TIEMPO OPD-NUM-PVEN
                   06  OPD-IND-PVEN PICTURE X(1).
      *                             NUMERO DE OPERACION QUE GENERO RENOV
                   06  OPD-CIC-GREN.
                       08  OPD-CAI-GREN
                                    PICTURE X(4).
                       08  OPD-IIC-GREN
                                    PICTURE X(8).
      *                             INDICADOR ABONO AUTOMATICO A CUENTA
                   06  OPD-COD-AACC PICTURE X(1).
      *                             NUMERO DE OPERACION ORIGINAL
                   06  OPD-CIC-ORIG.
                       08  OPD-CAI-ORIG
                                    PICTURE X(4).
                       08  OPD-IIC-ORIG
                                    PICTURE X(8).
      *                             MULTIPLES CLIENTES ?
                   06  OPD-IND-MCLI PICTURE X(1).
      *                             INGRESO NO LINEA ? ( S = ODB, N = OD
                   06  OPD-IND-IDIF PICTURE X(1).
      *                             MONTO CAPTACION EN PESOS
                   06  OPD-VAL-IPES PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             INDICADOR CUSTODIA ORIGINAL
                   06  OPD-COD-CUSO PICTURE X(1).
      *                             GLOSA DISPONIBLE
                   06  OPD-GLS-DISP PICTURE X(9).
000000*    COPYDD DAP-R-VEN.DAP-E-VEN00(PROD),02,D
      *                             EQUIVALENTE AL REGISTRO VEN
           02  DAP-E-VEN00.
      *                             VENCIMIENTOS DAP
               04  VEN.
      *                             FILLER COMPATIBILIDAD VSAM/MVS
                   06  VEN-GLS-FLAG PICTURE X(1).
      *                             CLAVE PRIMARIA REGISTRO
                   06  VEN-KEY-IVEN.
      *                             COD. INT. COMP. OPERAC. DAP
                       08  VEN-CIC-IOPD.
      *                             CENTRO ASIGNAC. IDENTIFICACION
                       10  VEN-CAI-IOPD
                                    PICTURE X(4).
      *                             IDENT. INTERNA COMPUTACIONAL
                       10  VEN-IIC-IOPD
                                    PICTURE X(8).
      *                             NUM. IDENTIFICACION VENCIMIENTO
                       08  VEN-NUM-IVEN
                                    PICTURE 9(3).
      *                             TIME STAMP TRANSACCION
                   06  VEN-STP-ITRN.
      *                             FECHA TRANSACCION
                       08  VEN-FEC-FTRN
                                    PICTURE 9(8).
      *                             HORA TRANSACCION
                       08  VEN-HRA-HRTR
                                    PICTURE 9(6).
      *                             INDICADOR TIPO ACCION
                   06  VEN-COD-TACC PICTURE X(1).
      *                             INDICADOR STATUS
                   06  VEN-COD-STAT PICTURE X(1).
      *                             CODIGO ORIGEN TRANSACCION
                   06  VEN-COD-OTRN PICTURE X(4).
      *                             AUTOR TRANSACCION
                   06  VEN-COD-ATRN PICTURE X(12).
      *                             FECHA VENCIMIENTO
                   06  VEN-FEC-FVEN.
                       08  VEN-NUM-SVEN
                                    PICTURE 9(2).
                       08  VEN-NUM-AVEN
                                    PICTURE 9(2).
                       08  VEN-NUM-MVEN
                                    PICTURE 9(2).
                       08  VEN-NUM-DVEN
                                    PICTURE 9(2).
      *                             VALOR CAPITAL VENCIMIENTO ORIGINAL
                   06  VEN-VAL-CAPI PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             SALDO VALOR CAPITAL VCMTO.
                   06  VEN-VAL-SCAP PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             INT DEVENGADOS NO LIQUIDADOS
                   06  VEN-VAL-IDNI PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             VALOR FINAL VENCIMIENTO
                   06  VEN-VAL-FINA PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             SALDO VALOR FINAL VCMTO.
                   06  VEN-VAL-SFIN PICTURE S9(11)V9(4)
                                        COMPUTATIONAL-3.
      *                             SITUACION CONTABLE
                   06  VEN-COD-SCTB PICTURE X(3).
      *                             GLOSA DISPONIBLE
                   06  VEN-GLS-DISP PICTURE X(20).
000000*
000000 FD  DAPLCMA
000000     RECORDING MODE IS F
000000     LABEL RECORD STANDARD
000000     BLOCK CONTAINS    0 RECORDS.
000000 01  REG-DAPLCMA                   PIC X(132).
000000*
000000 SD  FSORT.
000000 01  REG-FSORT.
000000     05 FSORT-KEY-IOPD.
000000        10 FSORT-CIC-IOPD.
000000           15 FSORT-CAI-IOPD      PIC X(04).
000000           15 FSORT-IIC-IOPD      PIC X(08).
000000     05 FSORT-COD-VCAM            PIC X(06).
000000     05 FSORT-COD-COPD.
000000        10 FSORT-COD-TOPD         PIC X(03).
000000        10 FSORT-COD-AOPD         PIC X(03).
000000     05 FSORT-CIC-ISER.
000000        10 FSORT-CAI-ISER         PIC X(04).
000000        10 FSORT-IIC-ISER         PIC X(08).
000000     05 FSORT-VAL-CAPT            PIC S9(13)V9(04) COMP-3.
000000*
000000     EJECT
000000 WORKING-STORAGE SECTION.
000000*
000000     COPY BIBBAUD1.
000000*
000000 01  W-CONTADORES.
000000     05 CNT-DAPDOPD-L            PIC 9(08) VALUE 0.
000000     05 CNT-DAPDOPD-S            PIC 9(08) VALUE 0.
000000     05 CNT-FSORT-G              PIC 9(08) VALUE 0.
000000     05 CNT-FSORT-L              PIC 9(08) VALUE 0.
000000     05 CNT-LINE-DAPLCMA         PIC 9(03) VALUE 0.
000000        88 SALTO-PAG-DAPLCMA               VALUE 58 THRU 99.
000000     05 CNT-PAGE-DAPLCMA         PIC 9(04) VALUE 0.
000000*
000000 01  WE-EXTERNAS.
000000     05 WE-FECHA-DATE.
000000        10 WE-AA-DATE            PIC 9(02).
000000        10 WE-MM-DATE            PIC 9(02).
000000        10 WE-DD-DATE            PIC 9(02).
000000*
000000 01  F-FILE-STATUS.
000000     05 FS-DAPDOPD               PIC 9(01) VALUE 0.
000000     05 FS-FSORT                 PIC 9(01) VALUE 0.
000000*
000000 01  W-VARIABLES.
000000     05 SW-CANCEL                PIC 9(01) VALUE 0.
000000     05 SW-PROC-REG              PIC 9(01) VALUE 0.
000000*
000000 01  W-REGISTROS-DE-TRABAJO.
000000     05 WR-COD-VCAM              PIC X(06) VALUE SPACES.
000000     05 WR-GLS-VCAM              PIC X(20) VALUE SPACES.
000000     05 WR-ABR-VCAM              PIC X(05) VALUE SPACES.
000000     05 WR-GLS-NOMC              PIC X(75) VALUE SPACES.
000000     05 WS-FEC-FPRI.
000000        10 WS-NUM-DPRI           PIC 9(02).
000000        10 WS-NUM-MPRI           PIC 9(02).
000000        10 WS-NUM-SPRI           PIC 9(02).
000000        10 WS-NUM-APRI           PIC 9(02).
000000     05 WS-MAX-VCAM.
000000        10 WS-MAX-VCAM-MDA1      PIC X(06).
000000        10 FILLER                PIC X(01).
000000        10 WS-MAX-VCAM-VAL1      PIC 9(12).
000000        10 FILLER                PIC X(02).
000000        10 WS-MAX-VCAM-MDA2      PIC X(06).
000000        10 FILLER                PIC X(01).
000000        10 WS-MAX-VCAM-VAL2      PIC 9(12).
000000        10 FILLER                PIC X(02).
000000        10 WS-MAX-VCAM-MDA3      PIC X(06).
000000        10 FILLER                PIC X(01).
000000        10 WS-MAX-VCAM-VAL3      PIC 9(12).
000000*
000000 01  ACUMULADORES.
000000     05 ACM-VCAM.
000000        10 ACM-VCAM-NUME         PIC S9(11)       COMP-3 VALUE 0.
000000        10 ACM-VCAM-VAL-CAPT     PIC S9(13)V9(04) COMP-3 VALUE 0.
000000*
000000     EJECT
000000*
000000* LINEAS DE IMPRESION
000000*
000000 01  TIT-01.
000000     05 FILLER                   PIC X(30)  VALUE
000000        'BANCO CREDITO INVERSIONES     '.
000000     05 FILLER                   PIC X(82)  VALUE SPACES.
000000     05 FILLER                   PIC X(10)  VALUE 'DAPPLCMA  '.
000000     05 TIT-01-FEC-FPRO.
000000        10 TIT-01-NUM-DPRO       PIC 9(02).
000000        10 FILLER                PIC X(01) VALUE SPACES.
000000        10 TIT-01-NUM-MPRO       PIC 9(02).
000000        10 FILLER                PIC X(01) VALUE SPACES.
000000        10 TIT-01-NUM-SPRO       PIC 9(02).
000000        10 TIT-01-NUM-APRO       PIC 9(02).
000000*
000000 01  TIT-02.
000000     05 TIT-02-RPT-DSIS          PIC X(30)  VALUE
000000        'DEPOSITOS A PLAZO'.
000000     05 FILLER                   PIC X(17)  VALUE SPACES.
000000     05 FILLER                   PIC X(29)  VALUE
000000        'INFORMACION DE CARTERA AL :  '.
000000     05 TIT-02-FEC-FFIN.
000000        10 TIT-02-NUM-DFIN       PIC X(02).
000000        10 FILLER                PIC X(01)  VALUE '-'.
000000        10 TIT-02-NUM-MFIN       PIC X(02).
000000        10 FILLER                PIC X(01)  VALUE '-'.
000000        10 TIT-02-NUM-SFIN       PIC X(02).
000000        10 TIT-02-NUM-AFIN       PIC X(02).
000000     05 FILLER                   PIC X(36)  VALUE SPACES.
000000     05 FILLER                   PIC X(07)  VALUE 'PAGINA '.
000000     05 TIT-02-NUM-PAGE          PIC ZZZ.
000000*
000000 01  TIT-03.
000000     05 FILLER                   PIC X(16)  VALUE
000000        'OPERACIONES EN: '.
000000     05 TIT-03-GLS-VCAM          PIC X(20).
000000     05 FILLER                   PIC X(11)  VALUE
000000        'MAYORES A: '.
000000     05 TIT-03-VAL-CAPT          PIC ZZZ.ZZZ.ZZZ.ZZ9.
000000     05 FILLER                   PIC X(02)  VALUE SPACES.
000000     05 TIT-03-ABR-VCAM          PIC X(05).
000000     05 FILLER                   PIC X(11)  VALUE SPACES.
000000     05 FILLER                   PIC X(38)  VALUE
000000        '(DOCUMENTOS VIGENTES)'.
000000*
000000 01  TIT-04.
000000     05 FILLER                   PIC X(132) VALUE ALL '-'.
000000*
000000 01  TIT-05.
000000     05 FILLER                   PIC X(12) VALUE 'OPERACION   '.
000000     05 FILLER                   PIC X(02) VALUE SPACES.
000000     05 FILLER                   PIC X(12) VALUE 'SERIAL      '.
000000     05 FILLER                   PIC X(02) VALUE SPACES.
000000     05 FILEER                   PIC X(06) VALUE 'COD.OP'.
000000     05 FILLER                   PIC X(02) VALUE SPACES.
000000     05 FILLER                   PIC X(33) VALUE
000000        'NOMBRE / RAZON SOCIAL           '.
000000     05 FILLER                   PIC X(02) VALUE SPACES.
000000     05 FILLER                   PIC X(10) VALUE 'RUT       '.
000000     05 FILLER                   PIC X(02) VALUE SPACES.
000000     05 FILLER                   PIC X(18) VALUE
000000        ' MONTO CAPITAL    '.
000000*
000000 01  DET-01.
000000     05 DET-01-CAI-IOPD          PIC X(04).
000000     05 DET-01-IIC-IOPD          PIC X(08).
000000     05 FILLER                   PIC X(02) VALUE SPACES.
000000     05 DET-01-CAI-ISER          PIC X(04).
000000     05 DET-01-IIC-ISER          PIC X(08).
000000     05 FILLER                   PIC X(02) VALUE SPACES.
000000     05 DET-01-COD-COPD          PIC X(06).
000000     05 FILLER                   PIC X(02) VALUE SPACES.
000000     05 DET-01-GLS-NOMC          PIC X(33).
000000     05 FILLER                   PIC X(02) VALUE SPACES.
000000     05 DET-01-NUM-ICLI          PIC ZZZZZZZZ.
000000     05 FILLER                   PIC X(01) VALUE '-'.
000000     05 DET-01-VRF-ICLI          PIC X(01).
000000     05 FILLER                   PIC X(02) VALUE SPACES.
000000     05 DET-01-VAL-CAPT          PIC Z.ZZZ.ZZZ.ZZ9,9999.
000000*
000000 01  TOT-01.
000000     05 FILLER                   PIC X(28) VALUE SPACES.
000000     05 TOT-01-TIP-TOT           PIC X(13) VALUE SPACES.
000000     05 TOT-01-TOT-OPE           PIC ZZZZZZZ.
000000     05 FILLER                   PIC X(10) VALUE SPACES.
000000     05 TOT-01-LIT-TOT           PIC X(15) VALUE SPACES.
000000     05 FILLER                   PIC X(10) VALUE SPACES.
000000     05 TOT-01-VAL-CAPT          PIC Z.ZZZ.ZZZ.ZZ9,9999.
000000*
000000     EJECT
000000* AREA DE COMUNICACION CON RUTINA RUTUVALF
000000 01  RUTWVALF.
000000     05 RUTWVALF-FECHA.
000000        10 RUTWVALF-FECHA-D      PIC 9(02).
000000        10 RUTWVALF-FECHA-M      PIC 9(02).
000000        10 RUTWVALF-FECHA-A.
000000           15 RUTWVALF-FECHA-AM  PIC 9(02).
000000           15 RUTWVALF-FECHA-AA  PIC 9(02).
000000     05 RUTWVALF-CODRET          PIC 9(01)  VALUE 0.
000000*
000000     EJECT
000000     COPY RUTWTTAB.
000000     EJECT
000000     COPY RUTWCMNN.
000000     EJECT
000000******************************************************************
000000*      USER INFORMATION BLOCK                                    *
000000******************************************************************
000000*
000000 01  UIB.
000000     05 FILLER                 PIC X(32) VALUE 'DAPPLCMA'.
000000*
000000******************************************************************
000000*      REQUEST AREA                                              *
000000******************************************************************
000000*
000000 01  REQ-AREA-RCC.
000000     02 REQ-CMD-RCC          PIC X(05).
000000     02 REQ-TBLNM-RCC        PIC X(03)  VALUE 'RCC'.
000000     02 REQ-KEYNM-RCC        PIC X(05)  VALUE 'RCC01'.
000000     02 REQ-RETURN-CODE-RCC  PIC X(02)  VALUE SPACES.
000000     02 REQ-INRCD-RCC        PIC X(01).
000000     02 REQ-DBIDE-RCC        PIC S9(4)  COMP VALUE +370.
000000     02 REQ-TBLID-RCC        PIC X(07).
000000     02 FILLER               PIC X(25).
000000     02 REQ-CTMAX-RCC        PIC S9(4)  COMP.
000000     02 REQ-IOCNT-RCC        PIC S9(4)  COMP.
000000     02 FILLER               PIC X(22).
000000     02 REQ-KYVAL-RCC.
000000        03 REQ-KEY-RCC-CIC   PIC X(12).
000000*
000000 01  REQ-AREA-DBC.
000000     02 REQ-CMD-DBC          PIC X(05).
000000     02 REQ-TBLNM-DBC        PIC X(03)  VALUE 'DBC'.
000000     02 REQ-KEYNM-DBC        PIC X(05)  VALUE 'DBC00'.
000000     02 REQ-RETURN-CODE-DBC  PIC X(02)  VALUE SPACES.
000000     02 REQ-INRCD-DBC        PIC X(01).
000000     02 REQ-DBIDE-DBC        PIC S9(4)  COMP VALUE +100.
000000     02 REQ-TBLID-DBC        PIC X(07).
000000     02 FILLER               PIC X(25).
000000     02 REQ-CTMAX-DBC        PIC S9(4)  COMP.
000000     02 REQ-IOCNT-DBC        PIC S9(4)  COMP.
000000     02 FILLER               PIC X(22).
000000     02 REQ-KYVAL-DBC.
000000        03 REQ-KEY-DBC-ICLI  PIC X(12).
000000*
000000******************************************************************
000000*                   WORK AREA                                    *
000000******************************************************************
000000*
000000 01  REG-RCC.
000000*    COPYDD DAP-R-RCC.DAP-E-RCC00(PROD),02,D
      *                             EQUIVALENTE AL REGISTRO RCC
           02  DAP-E-RCC00.
      *                             RELACION CLIENTE CAPTACION
               04  RCC.
      *                             FILLER COMPATIBILIDAD VSAM/MVS
                   06  RCC-GLS-FLAG PICTURE X(1).
      *                             CLAVE PRIMARIA REGISTRO
                   06  RCC-KEY-IREG.
      *                             IDENTIFICACION RELACION CLIENTE OPER
                       08  RCC-KEY-IRCC.
      *                             COD. INT. COMP. CLIENTE
                       10  RCC-CIC-ICLI.
      *                             CENTRO ASIGNACION IDENTIFICACION
                       12  RCC-CAI-ICLI
                                    PICTURE X(4).
      *                             IDENT. INTERNA COMPUTACIONAL
                       12  RCC-IIC-ICLI
                                    PICTURE X(8).
      *                             IDENTIFICACION OPERACION DAP
                       10  RCC-KEY-IOPD.
      *                             COD. INT. COMP. OPERACION
                       12  RCC-CIC-IOPD.
      *                             CENTRO ASIGNACION IDENTIFICACION
                       14  RCC-CAI-IOPD
                                    PICTURE X(4).
      *                             IDENT. INTERNA COMPUTACIONAL
                       14  RCC-IIC-IOPD
                                    PICTURE X(8).
      *                             TIME STAMP TRANSACCION
                       08  RCC-STP-ITRN.
      *                             FECHA TRANSACCION
                       10  RCC-FEC-FTRN
                                    PICTURE 9(8).
      *                             HORA TRANSACCION
                       10  RCC-HRA-HRTR
                                    PICTURE 9(6).
      *                             INDICADOR TIPO ACCION
                   06  RCC-MSC-TACC PICTURE X(1).
      *                             INDICADOR STATUS
                   06  RCC-MSC-STAT PICTURE X(1).
      *                             CODIGO ORIGEN TRANSACCION
                   06  RCC-COD-OTRN.
      *                             INDICADOR TIPO ORIGEN
                       08  RCC-MSC-TTRN
                                    PICTURE X(1).
      *                             CODIGO TIPO ORIGEN
                       08  RCC-COD-TTRN
                                    PICTURE X(3).
      *                             AUTOR TRANSACCION
                   06  RCC-COD-ATRN PICTURE X(12).
      *                             CODIGO STATUS
                   06  RCC-COD-STAT PICTURE X(3).
      *                             COD RELACION CLIENTE OPERACION
                   06  RCC-COD-RCOP PICTURE X(3).
      *                             NUMERO DE DIRECCION
                   06  RCC-NUM-DIRE PICTURE 9(2).
      *                             PORCENTAJE RELACION
                   06  RCC-VAL-PRCO PICTURE 9(3)V9(6)
                                        COMPUTATIONAL.
      *                             CODIGO CLASE OPERACION
                   06  RCC-COD-COPD.
      *                             CODIGO TIPO OPERACION
                       08  RCC-COD-TOPD
                                    PICTURE X(3).
      *                             CODIGO AUXILIAR OPERACION
                       08  RCC-COD-AOPD
                                    PICTURE X(3).
      *                             DISPONIBLE
                   06  RCC-GLS-DISP PICTURE X(17).
000000*
000000 01  REG-DBC.
000000*    COPYDD DGC-R-DBC.DGC-E-DBC00(PROD),02,D
      *                             EQUIVALENTE AL REGISTRO DBC
           02  DGC-E-DBC00.
      *                             DATOS BASICOS DEL CLIENTE
               04  DBC.
      *                             FILLER COMPATIBILIDAD VSAM/MVS
                   06  DBC-GLS-FLAG PICTURE X(1).
      *                             KEY CLAVE PRIMARIA REGISTRO
                   06  DBC-KEY-IREG.
      *                             IDENTIFICACION DATOS BASICOS CLIENTE
                       08  DBC-KEY-IDBC.
      *                             COD. INT. COMP. CLIENTE
                       10  DBC-CIC-ICLI.
      *                             CENTRO ASIGNACION IDENTIFICACION
                       12  DBC-CAI-ICLI.
                       14  DBC-COD-TCLI
                                    PICTURE X(1).
                       14  DBC-COD-CCLI
                                    PICTURE X(3).
      *                             IDENT. INTERNA COMPUTACIONAL
                       12  DBC-IIC-ICLI
                                    PICTURE X(8).
      *                             TIME STAMP TRANSACCION
                       08  DBC-STP-ITRN.
      *                             FECHA TRANSACCION
                       10  DBC-FEC-FTRN.
                       12  DBC-NUM-STRN
                                    PICTURE 9(2).
                       12  DBC-NUM-ATRN
                                    PICTURE 9(2).
                       12  DBC-NUM-MTRN
                                    PICTURE 9(2).
                       12  DBC-NUM-DTRN
                                    PICTURE 9(2).
      *                             HORA TRANSACCION
                       10  DBC-HRA-HRTR.
                       12  DBC-NUM-HHTR
                                    PICTURE 9(2).
                       12  DBC-NUM-MMTR
                                    PICTURE 9(2).
                       12  DBC-NUM-SSTR
                                    PICTURE 9(2).
      *                             INDICADOR TIPO ACCION
                   06  DBC-MSC-TACC PICTURE X(1).
      *                             INDICADOR STATUS
                   06  DBC-MSC-STAT PICTURE X(1).
      *                             CODIGO ORIGEN TRANSACCION
                   06  DBC-COD-OTRN.
      *                             INDICADOR TIPO ORIGEN
                       08  DBC-MSC-TTRN
                                    PICTURE X(1).
      *                             CODIGO TIPO ORIGEN
                       08  DBC-COD-TTRN
                                    PICTURE X(3).
      *                             AUTOR TRANSACCION
                   06  DBC-COD-ATRN PICTURE X(12).
      *                             KEY RUT CLIENTE + INDICADOR O CALIFI
                   06  DBC-IDC-ICLI.
      *                             RUT CLIENTE
                       08  DBC-NUM-ICLI
                                    PICTURE X(8).
      *                             INDICADOR TIPO RUT
                       08  DBC-IND-ICLI
                                    PICTURE X(1).
      *                             EXTENSION DEL RUT
                       08  DBC-GLS-ICLI
                                    PICTURE X(3).
      *                             KEY DIGITO VERIFICADOR DEL RUT
                   06  DBC-VRF-ICLI PICTURE X(1).
      *                             KEY NOMBRE CLIENTE GENERICO (PERSONA
                   06  DBC-GLS-NOMC.
                       08  DBC-GLS-APAT
                                    PICTURE X(25).
                       08  DBC-GLS-AMAT
                                    PICTURE X(25).
                       08  DBC-GLS-NOMB
                                    PICTURE X(25).
      *                             SOUNDEX DEL NOMBRE DE CLIENTE
                   06  DBC-SNX-NOMC.
                       08  DBC-SNX-APAT
                                    PICTURE X(3).
                       08  DBC-SNX-AMAT
                                    PICTURE X(3).
                       08  DBC-SNX-NOMB
                                    PICTURE X(3).
      *                             NUMERO DE DIRECCION DE ENVIO CORRESP
                   06  DBC-NUM-DCOR PICTURE 9(2).
      *                             OPR IND TIPO CLIENTE ( PERSONA O EMP
                   06  DBC-IND-TICL PICTURE X(1).
      *                             TIPO CLIENTE (POTENCIAL,NO CLIENTE,G
                   06  DBC-COD-TICL PICTURE X(2).
      *                             CODIGO CLASIFICACION COMERCIAL
                   06  DBC-COD-CLCM PICTURE X(2).
      *                             RCM CODIGO DEL EJECUTIVO ENCARGADO D
                   06  DBC-COD-EJEC PICTURE X(12).
      *                             OPR CODIGO DE OFICINA DONDE OPERA EL
                   06  DBC-COD-OFIC PICTURE X(3).
      *                             RCM INDICADOR SI OPERA EN OTRA OFICI
                   06  DBC-IND-OOFI PICTURE X(1).
      *                             EXT CODIGO ACTIVIDAD ECONOMICA
                   06  DBC-COD-ACTI PICTURE X(9).
      *                             EXT ORIGEN Y DESTINO SECT (COMP.INST
                   06  DBC-COD-ODSE PICTURE X(3).
      *                             INF FECHA INGRESO AL PLAN
                   06  DBC-FEC-FPLN.
                       08  DBC-NUM-SPLN
                                    PICTURE 9(2).
                       08  DBC-NUM-APLN
                                    PICTURE 9(2).
                       08  DBC-NUM-MPLN
                                    PICTURE 9(2).
                       08  DBC-NUM-DPLN
                                    PICTURE 9(2).
      *                             CODIGO DE SEGMENTO
                   06  DBC-COD-SETO PICTURE X(5).
      *                             PERIODO DE SEGMENTO (SSAAMM)
                   06  DBC-PDO-SETO PICTURE X(6).
      *                             INF INDICADOR DE MULTAS BANCO CENTRA
                   06  DBC-IND-MUBC PICTURE X(1).
      *                             INF INDICADOR DE JUICIOS BANCO CENTR
                   06  DBC-IND-JUBC PICTURE X(1).
      *                             EXT CODIGO ESTADO CLIENTE ( COMO DEU
                   06  DBC-MSC-SCLI PICTURE X(1).
      *                             FECHA ESTADO CLIENTE
                   06  DBC-FEC-FSCL.
                       08  DBC-NUM-SSCL
                                    PICTURE 9(2).
                       08  DBC-NUM-ASCL
                                    PICTURE 9(2).
                       08  DBC-NUM-MSCL
                                    PICTURE 9(2).
                       08  DBC-NUM-DSCL
                                    PICTURE 9(2).
      *                             CODIGO DE BLOQUEO DEL CLIENTE
                   06  DBC-COD-BLOC PICTURE X(2).
      *                             NUMERO TOTAL DE DIRECCIONES
                   06  DBC-NUM-TDIR PICTURE 9(2).
      *                             NUMERO TOTAL DE COMENTARIOS
                   06  DBC-NUM-TCMT PICTURE 9(3).
      *                             FECHA INICIO OPERACION
                   06  DBC-FEC-FIOP.
                       08  DBC-NUM-SIOP
                                    PICTURE 9(2).
                       08  DBC-NUM-AIOP
                                    PICTURE 9(2).
                       08  DBC-NUM-MIOP
                                    PICTURE 9(2).
                       08  DBC-NUM-DIOP
                                    PICTURE 9(2).
      *                             FECHA TERMINO OPERACION
                   06  DBC-FEC-FTOP.
                       08  DBC-NUM-STOP
                                    PICTURE 9(2).
                       08  DBC-NUM-ATOP
                                    PICTURE 9(2).
                       08  DBC-NUM-MTOP
                                    PICTURE 9(2).
                       08  DBC-NUM-DTOP
                                    PICTURE 9(2).
      *                             NUMERO OPERACIONES FECHA TERMINO NUL
                   06  DBC-NUM-OFTN PICTURE 9(3).
      *                             FECHA INGRESO DE DATOS A LA BASE DE
                   06  DBC-FEC-FINP.
                       08  DBC-NUM-SINP
                                    PICTURE 9(2).
                       08  DBC-NUM-AINP
                                    PICTURE 9(2).
                       08  DBC-NUM-MINP
                                    PICTURE 9(2).
                       08  DBC-NUM-DINP
                                    PICTURE 9(2).
000000*
000000 01  REG-TAB.
000000*    COPYDD TAB-R-TAB.TAB-E-TAB00(PROD),02,D
      *                             EQUIVALENTE AL REGISTRO TAB
           02  TAB-E-TAB00.
      *                             REGISTRO GENERICO DE TABLAS
               04  TAB.
      *                             FILLER COMPATIBILIDAD VSAM/MVS
                   06  TAB-GLS-FLAG PICTURE X(1).
      *                             CLAVE PRIMARIA REGISTRO
                   06  TAB-KEY-IREG.
      *                             KEY     TIPO + CODIGO ( LLAVE PRIMAR
                       08  TAB-COD-TABL.
      *                             CODIGO TIPO TABLA
                       10  TAB-COD-TTAB
                                    PICTURE X(3).
      *                             CODIGO TABLA
                       10  TAB-COD-CTAB
                                    PICTURE X(12).
      *                             TIME STAMP TRANSACCION
                       08  TAB-STP-ITRN.
      *                             FECHA TRANSACCION
                       10  TAB-FEC-FTRN.
                       12  TAB-NUM-STRN
                                    PICTURE 9(2).
                       12  TAB-NUM-ATRN
                                    PICTURE 9(2).
                       12  TAB-NUM-MTRN
                                    PICTURE 9(2).
                       12  TAB-NUM-DTRN
                                    PICTURE 9(2).
      *                             HORA TRANSACCION
                       10  TAB-HRA-HRTR.
                       12  TAB-NUM-HHTR
                                    PICTURE 9(2).
                       12  TAB-NUM-MMTR
                                    PICTURE 9(2).
                       12  TAB-NUM-SSTR
                                    PICTURE 9(2).
      *                             INDICADOR TIPO ACCION
                   06  TAB-MSC-TACC PICTURE X(1).
      *                             INDICADOR STATUS
                   06  TAB-MSC-STAT PICTURE X(1).
      *                             INDICADOR VIGENCIA
                   06  TAB-IND-VIGE
                             REDEFINES TAB-MSC-STAT
                                    PICTURE X(1).
      *                             CODIGO ORIGEN TRANSACCION
                   06  TAB-COD-OTRN.
      *                             INDICADOR TIPO ORIGEN
                       08  TAB-MSC-TTRN
                                    PICTURE X(1).
      *                             CODIGO TIPO ORIGEN
                       08  TAB-COD-TTRN
                                    PICTURE X(3).
      *                             AUTOR TRANSACCION
                   06  TAB-COD-ATRN PICTURE X(12).
      *                             KEY TIPO + CODIGO ( INTERNO COMPUTAC
                   06  TAB-CIC-TABL.
      *                             CODIGO TIPO TABLA
                       08  TAB-CIC-TTAB
                                    PICTURE X(3).
      *                             CODIGO TABLA
                       08  TAB-CIC-CTAB
                                    PICTURE X(12).
      *                             CODIGO EXTERNO
                   06  TAB-EXT-TABL.
      *                             CODIGO TIPO TABLA
                       08  TAB-EXT-TTAB
                                    PICTURE X(3).
      *                             CODIGO TABLA
                       08  TAB-EXT-CTAB
                                    PICTURE X(5).
      *                             DESCRIPCION CORTA
                   06  TAB-GLS-DCOR PICTURE X(12).
      *                             ABREVIACION DESCRIPCION
                   06  TAB-GLS-ABRV PICTURE X(5).
      *                             DESCRIPCION DEL CODIGO
                   06  TAB-GLS-DESC PICTURE X(40).
      *                             DATOS ANEXOS
                   06  TAB-GLS-DATA PICTURE X(60).
      *                             CLAVE SOUNDEX
                   06  TAB-SNX-TABL.
                       08  TAB-SNX-TTAB
                                    PICTURE X(3).
                       08  TAB-SNX-CTAB
                                    PICTURE X(3).
               04  TAB-REDEF REDEFINES TAB
                                    PICTURE X(194).
000000*
000000     EJECT
000000******************************************************************
000000*                 ELEMENT LIST                                   *
000000******************************************************************
000000*
000000 01  ELM-LIS-RCC.
000000     03 ELEM-RCC             PIC X(05)  VALUE 'RCC00'.
000000     03 ELSE-RCC             PIC X(01).
000000     03 FILLER               PIC X(05)  VALUE SPACES.
000000*
000000 01  ELM-LIS-DBC.
000000     03 ELEM-DBC             PIC X(05)  VALUE 'DBC00'.
000000     03 ELSE-DBC             PIC X(01).
000000     03 FILLER               PIC X(05)  VALUE SPACES.
000000*
           COPY RLOVR001.
000000     EJECT
000000*
000000* MODULO DE CONTROL
000000*
000000 PROCEDURE DIVISION.
000000*
000000 A-CONTROL SECTION.
000000     ENTRY 'DBMSCBL'.
000000     COPY BIBBAUD2.
000000*
000000 AA-INICIALIZACION.
000000     PERFORM B-INICIALIZAR.
000000*
000000 AB-PROCESAMIENTO.
000000     PERFORM C-PROCESAR.
000000*
000000 AC-TERMINACION.
000000     PERFORM D-TERMINAR.
000000*
000000 AZZ-FIN-PROC.
000000     GOBACK.
000000     EJECT
000000*
000000*
000000*
000000 B-INICIALIZAR SECTION.
000000*
000000 BA-CONTROL-PROCESO.
000000     PERFORM BB-ACCEPT-TARJETA
000000     PERFORM BM-ABRE-ARCH
000000     PERFORM BZ-VERIFICA
000000     GO TO BZZ-FIN-SECC.
000000*
000000 BB-ACCEPT-TARJETA.
000000*
000000     DISPLAY ' '.
000000     DISPLAY 'INICIO CAPTURA DE PARAMETROS'.
000000     DISPLAY ' '.
000000     DISPLAY 'INGRESE FECHA DE PROCESO (DDMMSSAA) : '.
000000     ACCEPT  WS-FEC-FPRI
000000     DISPLAY WS-FEC-FPRI
000000
000000     DISPLAY 'INGRESE VALORES MAXIMOS POR MONEDA  :  '.
000000     ACCEPT WS-MAX-VCAM
000000     DISPLAY WS-MAX-VCAM
000000
000000     DISPLAY 'FIN    CAPTURA    DE PARAMETROS'.
000000     DISPLAY ' '.
000000     DISPLAY 'INICIO VALIDACION DE PARAMETROS'.
000000
000000*VAL-FEC VALIDA FECHA DE PROCESO
000000     DISPLAY WS-FEC-FPRI
000000     MOVE WS-NUM-DPRI TO RUTWVALF-FECHA-D
000000     MOVE WS-NUM-MPRI TO RUTWVALF-FECHA-M
000000     MOVE WS-NUM-SPRI TO RUTWVALF-FECHA-AM
000000     MOVE WS-NUM-APRI TO RUTWVALF-FECHA-AA
000000     CALL 'RUTUVALF' USING RUTWVALF-FECHA RUTWVALF-CODRET
000000     IF RUTWVALF-CODRET NOT = 0
000000        DISPLAY
000000           '* FECHA PROCESO INVALIDA. ' WS-FEC-FPRI
000000        MOVE 1 TO SW-CANCEL.
000000     MOVE WS-NUM-DPRI TO TIT-02-NUM-DFIN
000000     MOVE WS-NUM-MPRI TO TIT-02-NUM-MFIN
000000     MOVE WS-NUM-SPRI TO TIT-02-NUM-SFIN
000000     MOVE WS-NUM-APRI TO TIT-02-NUM-AFIN
000000*
000000*VAL-TAB VALIDA CODIGO DE MONEDA (PARAMETRO 1)
000000     MOVE +150                TO RUTWTTAB-BASE
000000     MOVE 'VLR'               TO RUTWTTAB-TABLA
000000     MOVE WS-MAX-VCAM-MDA1    TO RUTWTTAB-CLAVE
000000     CALL 'RUTUTTAB' USING RUTWTTAB
000000     IF RUTWTTAB-RETURN-CODE  NOT = SPACES
000000        DISPLAY ' '
000000        DISPLAY
000000           ' ERROR VALIDACION COD. MONEDA: ' WS-MAX-VCAM-MDA1
000000        DISPLAY
000000           ' SE IGNORA SELECCION ASUMIENDO VALOR 0).'
000000        MOVE 0 TO WS-MAX-VCAM-VAL1.
000000     IF WS-MAX-VCAM-VAL1 NOT NUMERIC OR
000000        WS-MAX-VCAM-VAL1 = 0
000000           DISPLAY ' '
000000           DISPLAY
000000              ' ERROR VALIDACION VAL. MONEDA: ' WS-MAX-VCAM-VAL1
000000           DISPLAY
000000              ' SE IGNORA SELECCION.'.
000000*
000000*VAL-TAB VALIDA CODIGO DE MONEDA (PARAMETRO 2)
000000     MOVE +150                TO RUTWTTAB-BASE
000000     MOVE 'VLR'               TO RUTWTTAB-TABLA
000000     MOVE WS-MAX-VCAM-MDA2    TO RUTWTTAB-CLAVE
000000     CALL 'RUTUTTAB' USING RUTWTTAB
000000     IF RUTWTTAB-RETURN-CODE  NOT = SPACES
000000        DISPLAY ' '
000000        DISPLAY
000000           ' ERROR VALIDACION COD. MONEDA: ' WS-MAX-VCAM-MDA2
000000        DISPLAY
000000           ' SE IGNORA SELECCION ASUMIENDO VALOR 0).'
000000        MOVE 0 TO WS-MAX-VCAM-VAL2.
000000     IF WS-MAX-VCAM-VAL2 NOT NUMERIC OR
000000        WS-MAX-VCAM-VAL2 = 0
000000           DISPLAY ' '
000000           DISPLAY
000000              ' ERROR VALIDACION VAL. MONEDA: ' WS-MAX-VCAM-VAL2
000000           DISPLAY
000000              ' SE IGNORA SELECCION.'.
000000*
000000*VAL-TAB VALIDA CODIGO DE MONEDA (PARAMETRO 3)
000000     MOVE +150                TO RUTWTTAB-BASE
000000     MOVE 'VLR'               TO RUTWTTAB-TABLA
000000     MOVE WS-MAX-VCAM-MDA3    TO RUTWTTAB-CLAVE
000000     CALL 'RUTUTTAB' USING RUTWTTAB
000000     IF RUTWTTAB-RETURN-CODE  NOT = SPACES
000000        DISPLAY ' '
000000        DISPLAY
000000           ' ERROR VALIDACION COD. MONEDA: ' WS-MAX-VCAM-MDA3
000000        DISPLAY
000000           ' SE IGNORA SELECCION ASUMIENDO VALOR 0).'
000000        MOVE 0 TO WS-MAX-VCAM-VAL3.
000000     IF WS-MAX-VCAM-VAL3 NOT NUMERIC OR
000000        WS-MAX-VCAM-VAL3 = 0
000000           DISPLAY ' '
000000           DISPLAY
000000              ' ERROR VALIDACION VAL. MONEDA: ' WS-MAX-VCAM-VAL3
000000           DISPLAY
000000              ' SE IGNORA SELECCION.'.
000000*
000000     IF WS-MAX-VCAM-VAL1 = 0 AND
000000        WS-MAX-VCAM-VAL2 = 0 AND
000000        WS-MAX-VCAM-VAL3 = 0
000000           DISPLAY ' '
000000           DISPLAY
000000              ' ERROR EN PARAMETROS DE SELECCION.'
000000           MOVE 1 TO SW-CANCEL.
000000*
000000     DISPLAY 'FIN VALIDACION PARAMETROS'.
000000* ACCEPTAR FECHA
000000     ACCEPT WE-FECHA-DATE FROM DATE
000000     MOVE WE-DD-DATE TO TIT-01-NUM-DPRO
000000     MOVE WE-MM-DATE TO TIT-01-NUM-MPRO
000000     MOVE WE-AA-DATE TO TIT-01-NUM-APRO
000000*****IF WE-AA-DATE NOT < 80
000000     IF WE-AA-DATE < ROLL-YY
000000        MOVE 20      TO TIT-01-NUM-SPRO
000000     ELSE
000000        MOVE 19      TO TIT-01-NUM-SPRO.
000000*
000000 BM-ABRE-ARCH.
000000     OPEN INPUT  DAPDOPD
000000          OUTPUT DAPLCMA.
000000*
000000 BZ-VERIFICA.
000000     IF SW-CANCEL = 1
000000        DISPLAY '*** ERRORES EN INICIALIZACION ***'
000000        PERFORM D-TERMINAR.
000000*
000000 BZZ-FIN-SECC.
000000     EXIT.
000000     EJECT
000000*
000000*
000000*
000000 C-PROCESAR SECTION.
000000*
000000 CA-CONTROL.
000000     SORT FSORT
000000        ASCENDING KEY
000000           FSORT-COD-VCAM
000000        DESCENDING KEY
000000           FSORT-VAL-CAPT
000000        INPUT  PROCEDURE  E-ENTRADA-SORT
000000        OUTPUT PROCEDURE  F-SALIDA-SORT.
000000*
000000     IF SORT-RETURN NOT = 0
000000        DISPLAY '**  ####################### **'
000000        DISPLAY '**  HUBO ERROR EN SORT      **'
000000        DISPLAY '**  ####################### **'
000000        MOVE 1 TO SW-CANCEL.
000000*
000000 CZZ-FIN-SECC.
000000     EXIT.
000000     EJECT
000000*
000000*
000000*
000000 D-TERMINAR  SECTION.
000000*
000000 DA-TOTALES.
000000     CLOSE DAPDOPD DAPLCMA
000000     DISPLAY ' '
000000     DISPLAY '+---------------------------------------------+'
000000     DISPLAY '+ ESTADISTICAS DE PROCESO.  PROGRAMA DAPPLCMA +'
000000     DISPLAY '+---------------------------------------------+'
000000     DISPLAY ' '
000000     DISPLAY 'REG DAPDOPD LEIDOS..................' CNT-DAPDOPD-L
000000     DISPLAY 'REG DAPDOPD SELECC..................' CNT-DAPDOPD-S
000000     DISPLAY 'REG FSORT GRABAD....................' CNT-FSORT-G
000000     DISPLAY 'REG FSORT LEIDOS....................' CNT-FSORT-L
000000     DISPLAY ' '
000000     DISPLAY '***********************************************'
000000     DISPLAY ' '
000000     IF SW-CANCEL    = 1
000000        DISPLAY ' HAY MENSAJES PARA EL EXPLOTADOR'
000000        DISPLAY ' '
000000        DISPLAY '************************************************'
000000        DISPLAY '************************************************'
000000        DISPLAY '****                                        ****'
000000        DISPLAY '****      TERMINO ERRONEO DEL PROCESO       ****'
000000        DISPLAY '****                                        ****'
000000        DISPLAY '************************************************'
000000        DISPLAY '************************************************'
000000        MOVE 100 TO RETURN-CODE
000000        GOBACK
000000     ELSE
000000        DISPLAY ' NO HAY MENSAJES PARA EL EXPLOTADOR'
000000        DISPLAY ' '
000000        DISPLAY '*** PROCESO TERMINO EN FORMA NORMAL ***'.
000000*
000000 DZZ-FIN-SECC.
000000     EXIT.
000000     EJECT
000000*
000000*
000000*
000000 E-ENTRADA-SORT SECTION.
000000*
000000 EA-LEER-DAPDOPD.
000000     READ DAPDOPD AT END MOVE 1 TO FS-DAPDOPD.
000000     IF FS-DAPDOPD = 0
000000        ADD 1 TO CNT-DAPDOPD-L.
000000*
000000 EC-CTRL-PROC.
000000     PERFORM ED-SELECCIONA UNTIL
000000        FS-DAPDOPD = 1
000000     GO TO EZZ-FIN-SECC.
000000*
000000 ED-SELECCIONA.
000000** SELECCIONA REGISTROS PARA CARGARLOS EN EL SORT
000000     IF OPD-COD-STAT = 'G'
000000        PERFORM EE-REVISA-SELEC.
000000     PERFORM EA-LEER-DAPDOPD.
000000*
000000 EE-REVISA-SELEC.
000000*CONTROLA INGRESO DE REGS. VIGENTES O NO VIGENTES VALIDOS
000000     MOVE 0 TO SW-PROC-REG
000000     IF OPD-COD-VCAM = WS-MAX-VCAM-MDA1 AND
000000        OPD-VAL-CAPT > WS-MAX-VCAM-VAL1
000000           MOVE 1 TO SW-PROC-REG.
000000     IF OPD-COD-VCAM = WS-MAX-VCAM-MDA2 AND
000000        OPD-VAL-CAPT > WS-MAX-VCAM-VAL2
000000           MOVE 1 TO SW-PROC-REG.
000000     IF OPD-COD-VCAM = WS-MAX-VCAM-MDA3 AND
000000        OPD-VAL-CAPT > WS-MAX-VCAM-VAL3
000000           MOVE 1 TO SW-PROC-REG.
000000     IF SW-PROC-REG = 1
000000        ADD 1        TO CNT-DAPDOPD-S
000000        PERFORM EK-GRABA-FSORT.
000000*
000000 EK-GRABA-FSORT.
000000     MOVE OPD-KEY-IOPD           TO FSORT-KEY-IOPD
000000     MOVE OPD-COD-VCAM           TO FSORT-COD-VCAM
000000     MOVE OPD-COD-COPD           TO FSORT-COD-COPD
000000     MOVE OPD-CIC-ISER           TO FSORT-CIC-ISER
000000     MOVE OPD-VAL-CAPT           TO FSORT-VAL-CAPT
000000     RELEASE REG-FSORT
000000     ADD 1                       TO CNT-FSORT-G.
000000*
000000 EZZ-FIN-SECC.
000000     EXIT.
000000     EJECT
000000*
000000*
000000*
000000 F-SALIDA-SORT SECTION.
000000*
000000 FA-LEER-FSORT.
000000     RETURN FSORT AT END MOVE 1 TO FS-FSORT.
000000     IF FS-FSORT = 0
000000        ADD 1 TO CNT-FSORT-L.
000000*
000000 FB-CTRL-PROC.
000000     PERFORM FC-CTRL-X-VCAM UNTIL
000000        FS-FSORT = 1
000000     GO TO FZZ-FIN-SECC.
000000*
000000 FC-CTRL-X-VCAM.
000000* MONEDA
000000     MOVE 99                TO CNT-LINE-DAPLCMA
000000     INITIALIZE ACM-VCAM
000000     MOVE FSORT-COD-VCAM    TO WR-COD-VCAM
000000     IF WR-COD-VCAM = WS-MAX-VCAM-MDA1
000000        MOVE WS-MAX-VCAM-VAL1 TO TIT-03-VAL-CAPT.
000000     IF WR-COD-VCAM = WS-MAX-VCAM-MDA2
000000        MOVE WS-MAX-VCAM-VAL2 TO TIT-03-VAL-CAPT.
000000     IF WR-COD-VCAM = WS-MAX-VCAM-MDA3
000000        MOVE WS-MAX-VCAM-VAL3 TO TIT-03-VAL-CAPT.
000000     PERFORM FC1-BUSCA-GLOSA-VCAM
000000     MOVE WR-GLS-VCAM       TO TIT-03-GLS-VCAM
000000     MOVE WR-ABR-VCAM       TO TIT-03-ABR-VCAM
000000     PERFORM FD-PROCESA UNTIL
000000        FSORT-COD-VCAM NOT = WR-COD-VCAM OR
000000        FS-FSORT = 1
000000     PERFORM FC9-TOTALES-VCAM.
000000*
000000 FC1-BUSCA-GLOSA-VCAM.
000000* BUSCA GLOSA MONEDA
000000     MOVE +150                TO RUTWTTAB-BASE
000000     MOVE 'VLR'               TO RUTWTTAB-TABLA
000000     MOVE WR-COD-VCAM         TO RUTWTTAB-CLAVE
000000     CALL 'RUTUTTAB' USING RUTWTTAB
000000     EVALUATE RUTWTTAB-RETURN-CODE
000000        WHEN SPACES
000000           MOVE RUTWTTAB-REGISTRO-TAB TO REG-TAB
000000           MOVE TAB-GLS-DESC          TO WR-GLS-VCAM
000000           MOVE TAB-GLS-ABRV          TO WR-ABR-VCAM
000000        WHEN '14'
000000           MOVE ALL '?'               TO WR-GLS-VCAM
000000           MOVE ALL '?'               TO WR-ABR-VCAM
000000        WHEN OTHER
000000           DISPLAY 'ERROR EN ACCESO TABLA TAB (RUTUTTAB). '
000000                   'COD-RET = ' RUTWTTAB-RETURN-CODE
000000           DISPLAY 'BASE  = ' RUTWTTAB-BASE ' '
000000                   'TABLA = ' RUTWTTAB-TABLA ' '
000000                   'CLAVE = ' RUTWTTAB-CLAVE
000000           MOVE 20 TO SORT-RETURN
000000     END-EVALUATE.
000000*
000000 FC9-TOTALES-VCAM.
000000* TOTALIZAR POR VCAM
000000     IF SALTO-PAG-DAPLCMA
000000        PERFORM FV-TITULOS.
000000     MOVE SPACES                 TO TOT-01
000000     MOVE 'TOTAL:       '        TO TOT-01-TIP-TOT
000000     MOVE ACM-VCAM-NUME          TO TOT-01-TOT-OPE
000000     MOVE 'OPERACION(ES)  '      TO TOT-01-LIT-TOT
000000     MOVE ACM-VCAM-VAL-CAPT      TO TOT-01-VAL-CAPT
000000     WRITE REG-DAPLCMA FROM TOT-01     AFTER 2.
000000*
000000 FD-PROCESA.
000000     PERFORM FK-BUSCA-CLIENTE
000000     PERFORM FU-IMPRIME
000000     PERFORM FA-LEER-FSORT.
000000*
000000 FK-BUSCA-CLIENTE.
000000* CON EL CODIGO DE LA OPERACION VA A LA RCC PARA OBTENER EL CIC
000000* DEL CLIENTE Y CON ESTE VA A LA DBC PARA OBTENER LOS DATOS DE
000000* CLIENTE A IMPRIMIR.
000000     MOVE 'REDKY'          TO REQ-CMD-RCC
000000     MOVE SPACES           TO REQ-RETURN-CODE-RCC
000000     MOVE FSORT-CIC-IOPD   TO REQ-KEY-RCC-CIC
000000     CALL 'DBNTRY' USING UIB REQ-AREA-RCC REG-RCC ELM-LIS-RCC
000000     EVALUATE REQ-RETURN-CODE-RCC
000000        WHEN SPACES
000000           PERFORM FK1-BUSCA-CLIENTE-DBC
000000        WHEN '14'
000000           MOVE SPACES                TO DBC-IDC-ICLI
000000           MOVE SPACES                TO DBC-VRF-ICLI
000000           MOVE 'CLIENTE INEXISTENTE' TO WR-GLS-NOMC
000000        WHEN OTHER
000000           DISPLAY '* ERROR: REDKY TABLA RCC *'
000000           DISPLAY '* TABLA          : ' REQ-TBLNM-RCC
000000           DISPLAY '* CODIGO RETORNO : ' REQ-RETURN-CODE-RCC
000000           DISPLAY '* REQ. AREA      : ' REQ-AREA-RCC
000000           MOVE 20 TO SORT-RETURN
000000     END-EVALUATE.
000000*
000000 FK1-BUSCA-CLIENTE-DBC.
000000     MOVE 'REDKY'          TO REQ-CMD-DBC
000000     MOVE SPACES           TO REQ-RETURN-CODE-DBC
000000     MOVE RCC-CIC-ICLI     TO REQ-KEY-DBC-ICLI
000000     CALL 'DBNTRY' USING UIB REQ-AREA-DBC REG-DBC ELM-LIS-DBC
000000     EVALUATE REQ-RETURN-CODE-DBC
000000        WHEN SPACES
000000           PERFORM FL-COMPACTA-NOMBRE
000000        WHEN '14'
000000           MOVE SPACES                TO DBC-IDC-ICLI
000000           MOVE SPACES                TO DBC-VRF-ICLI
000000           MOVE 'CLIENTE INEXISTENTE' TO WR-GLS-NOMC
000000        WHEN OTHER
000000           DISPLAY '* ERROR: REDKY TABLA DBC *'
000000           DISPLAY '* TABLA          : ' REQ-TBLNM-DBC
000000           DISPLAY '* CODIGO RETORNO : ' REQ-RETURN-CODE-DBC
000000           DISPLAY '* REQ. AREA      : ' REQ-AREA-DBC
000000           MOVE 20 TO SORT-RETURN
000000     END-EVALUATE.
000000*
000000 FL-COMPACTA-NOMBRE.
000000     MOVE DBC-GLS-APAT      TO RUTWCMNN-INP-APAT
000000     MOVE DBC-GLS-AMAT      TO RUTWCMNN-INP-AMAT
000000     MOVE DBC-GLS-NOMB      TO RUTWCMNN-INP-NOMB
000000     CALL 'RUTUCMNN' USING RUTWCMNN
000000     MOVE RUTWCMNN-OUT-NOMB TO WR-GLS-NOMC.
000000*
000000 FU-IMPRIME.
000000** GENERA LINEA DETALLE PARA OPERACION.
000000     IF SALTO-PAG-DAPLCMA
000000        PERFORM FV-TITULOS.
000000     MOVE FSORT-CAI-IOPD        TO DET-01-CAI-IOPD
000000     MOVE FSORT-IIC-IOPD        TO DET-01-IIC-IOPD
000000     MOVE FSORT-CAI-ISER        TO DET-01-CAI-ISER
000000     MOVE FSORT-IIC-ISER        TO DET-01-IIC-ISER
000000     MOVE FSORT-COD-COPD        TO DET-01-COD-COPD
000000     MOVE WR-GLS-NOMC           TO DET-01-GLS-NOMC
000000     MOVE DBC-NUM-ICLI          TO DET-01-NUM-ICLI
000000     MOVE DBC-VRF-ICLI          TO DET-01-VRF-ICLI
000000     MOVE FSORT-VAL-CAPT        TO DET-01-VAL-CAPT
000000     ADD FSORT-VAL-CAPT         TO ACM-VCAM-VAL-CAPT
000000     ADD 1                      TO ACM-VCAM-NUME
000000     WRITE REG-DAPLCMA FROM DET-01     AFTER 1
000000     ADD 1                       TO CNT-LINE-DAPLCMA.
000000*
000000 FV-TITULOS.
000000     ADD 1                       TO CNT-PAGE-DAPLCMA
000000     MOVE CNT-PAGE-DAPLCMA       TO TIT-02-NUM-PAGE
000000     WRITE REG-DAPLCMA FROM TIT-01 AFTER CANAL-1
000000     WRITE REG-DAPLCMA FROM TIT-02 AFTER 1
000000     WRITE REG-DAPLCMA FROM TIT-03 AFTER 2
000000     WRITE REG-DAPLCMA FROM TIT-04 AFTER 1
000000     WRITE REG-DAPLCMA FROM TIT-05 AFTER 1
000000     WRITE REG-DAPLCMA FROM TIT-04 AFTER 1
000000     MOVE 7                      TO CNT-LINE-DAPLCMA.
000000*
000000 FZZ-FIN-SECC.
000000     EXIT.
000000     EJECT

