*%! Codigo adicional para archivo LDCPQLCC
*% IF SETTAG
*% FNCPQ = "PROYECTO-LOF"
*% VSNPQ = "05.11.10.1"
*% FNCPU = "PROYECTO-LOF"
*% VSNPU = "05.11.10.1"
*% END

*% LARGO_MI_COMMAREA = 20
*% PGM_PTC = TRUE
*% IF CMT_ID
      *-----------------------------------------------------------------
      *MODIFICACIONES:
      *--------------
      *OBJETIVO: SE MODIFICAN LOS COMANDOS LIB Y RBJ
      *PROYECTO: LOF CON CANCELACIONES
      *FECHA   : JULIO DE 2009
      *AUTOR   : CHC
      *ETIQUETA: *AFRI-INI/LOF/CHC/07-2009
      *-----------------------------------------------------------------
*% IF PGM_PQ
      *OBJETIVO: SE CREA COMANDO BLI
      *PROYECTO: IMPRESION DOCUMENTO FOGAPE
      *FECHA   : AGOSTO 2015
      *ETIQUETA: *AFRI-INI/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
      *-----------------------------------------------------------------
*% END
*% IF PGM_PU
      *MODIFICACIONES:
      *OBJETIVO: SE MODIFICA EL COMANDO RBJ
      *PROYECTO: GARANTIAS ESTATALES
      *FECHA   : SEPTIEMBRE-2010
      *AUTOR   : AFRI-CHC
      *ETIQUETA: *AFRI-INI 15-SEP-2010 GARANTIAS ESTATALES
      *-----------------------------------------------------------------
*% END
*% END
*% IF MI_COMMAREA                                                 
      *<<<< MI_COMMAREA                                                 
           03 CMA-VARI.                                                 
              05 SCR-IMAX      COMP                   PIC S9(04).       
              05 SCR-I         COMP                   PIC S9(04).
              05 SCR-FS-ACG                           PIC 9(02).       
      *>>>>
*% END
*% IF WSS                                                         
      *<<<< WSS                                                         
*% IF PGM_PQ
      *AFRI-INI/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
       COPY COLBRROV.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
      *AFRI-FIN/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
      *AFRI-INI/LOF/CHC/07-2009
       COPY LDCBRARG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ARG-REQA==.
       COPY COLBRTOC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
      *AFRI-FIN/LOF/CHC/07-2009
       COPY GNSWGCPT.
       COPY TABBRCAM.
       COPY LDCBRRDC REPLACING RDC BY RDL.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDL-REQA==.
       COPY COLBROPC.
       COPY COLBRRDC.
       COPY LDCBRCLF.
       COPY LDCBRLDC.
       COPY LDCBRLCC.
       COPY LDCBRACG.
       COPY SGCBRDBC.
       COPY GNSWGPES.
       COPY LDCWGLIC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CLF-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ACG-REQA==.
*% END
*% IF PGM_PU
       COPY GNSWGCPT.                                                   
       COPY TABBRCAM.                                                   
       COPY LDCBRRDC REPLACING RDC BY RDL.                              
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDL-REQA==.        
       COPY COLBROPC.                                                   
       COPY COLBRCXE.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CXE-REQA==.        
       COPY COLBRRDC.                                                   
       COPY COLBRRCV.                                                   
       COPY COLBRCAN.                                                   
       COPY LDCBRCLF.                                                   
       COPY LDCBRLDC.                                                   
       COPY LDCBRLCC.                                                   
       COPY LDCBRACG.                                                   
       COPY SGCBRDBC.                                                   
       COPY GNSWGPES.                                                   
       COPY LDCWGLIC.                                                   
      *AFRI-INI/LOF/CHC/07-2009
       COPY COLW2CAN.
       COPY BGLBRGMO.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GMO-REQA==.
       COPY BGLBRGDG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY BGLBRGDO.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDO-REQA==.
       COPY BGLBRGAP.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GAP-REQA==.
       COPY BGLBRGUB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GUB-REQA==.
       COPY BGLBRGVT.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.
       COPY BGLBRGES.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GES-REQA==.
       COPY BGLBRGDD.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.
       COPY TABBROFI.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSBRCIC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGCIC.
       COPY BGLBRTAG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       COPY COLBRROV.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.        
       COPY COLBRVEN.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.        
       COPY COLBRCYA.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.        
       COPY COLBREVC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.        
       COPY COLBRICG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.        
       COPY COLBRDLC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.        
       COPY COLBRTOC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.        
      *COPY COLWGTRA.
       COPY COLWGVEN.
       COPY COLWGINT.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-BDO-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PTT-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==.        
      *AFRI-FIN/LOF/CHC/07-2009
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CLF-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LDC-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LCC-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ACG-REQA==.        
*% END

       01 WSS.
*% IF PGM_PU
      *AFRI-INI/LOF/CHC/07-2009
          03  WSS-VAL-MLIB        VALUE ZEROES   PIC 9(11)V9(04).
          03  WSS-COD-CDOC        VALUE SPACES   PIC X(03).
          03  WSS-FEC-FCAN.
              05 WSS-NUM-SCAN     VALUE ZEROES   PIC 9(02).             
              05 WSS-NUM-ACAN     VALUE ZEROES   PIC 9(02).             
              05 WSS-NUM-MCAN     VALUE ZEROES   PIC 9(02).             
              05 WSS-NUM-DCAN     VALUE ZEROES   PIC 9(02).             
          03  WSS-FEC-FCOL.
              05 WSS-NUM-SCOL     VALUE ZEROES   PIC 9(02).             
              05 WSS-NUM-ACOL     VALUE ZEROES   PIC 9(02).             
              05 WSS-NUM-MCOL     VALUE ZEROES   PIC 9(02).             
              05 WSS-NUM-DCOL     VALUE ZEROES   PIC 9(02).             
          03  WSS-IND-VTAG        VALUE SPACES   PIC X(01).
          03  WSS-IND-MONE        VALUE SPACES   PIC X(01).
          03  WSS-EXI-RCXE        VALUE SPACES   PIC X(01).
          03  WSS-COD-PESO        VALUE SPACES   PIC X(06).
          03  WSS-POR-MLIB        VALUE ZEROES   PIC 9(11)V9(04).
          03  WSS-IND-EGDD        VALUE SPACES   PIC X(01).
          03  WSS-IND-EGVT        VALUE SPACES   PIC X(01).
          03  WSS-IND-EGES        VALUE SPACES   PIC X(01).
          03  WSS-IND-EGDO        VALUE SPACES   PIC X(01).
          03  WSS-IND-EGAP        VALUE SPACES   PIC X(01).
          03  WSS-IND-EGUB        VALUE SPACES   PIC X(01).
          03  WSS-CIC-GTIA        VALUE SPACES   PIC X(12).
          03 WSS-IDC-ICLI.
              05 WSS-NUM-ICLI                    PIC 9(08).
              05 WSS-IND-ICLI                    PIC X(01).
              05 WSS-GLS-ICLI                    PIC X(03).
          03 WSS-NUM-PORC         VALUE ZEROES   PIC 9(03).
          03 WSS-VAL-PON          VALUE ZEROES   PIC 9(11)V9(04).
          03 VLI-GLS-NOMP                        PIC X(50).
          03 VLI-IDC-IPRO.
              05  VLI-NUM-IPRO                   PIC X(08).
              05  VLI-IND-IPRO                   PIC X(01).
              05  VLI-GLS-IPRO                   PIC X(03).
          03 VLI-VRF-IPRO                        PIC X(01).
      *AFRI-FIN/LOF/CHC/07-2009
*% END
*% IF PGM_PQ
      *AFRI-INI/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
          03  WSS-NUM-ZERO  VALUE ZERO           PIC 9(01).
          03  WSS-NUM-MUNO  VALUE -1             PIC S9(01).
          03  WSS-GLS-STAT  VALUE '00'           PIC X(02).
          03  WSS-GLS-PROG  VALUE 'COLPPLIC'     PIC X(08).
          03  WSS-GLS-IBLI  VALUE 'BLI'          PIC X(03).
          03  WSS-GLS-AAAA  VALUE 'A'            PIC X(01).
          03  WSS-GLS-LLLL  VALUE 'L'            PIC X(01).
          03  WSS-GLS-IPRO  VALUE 'PRO'          PIC X(03).
          03  WSS-GLS-IREN  VALUE 'REN'          PIC X(03).
          03  WSS-GLS-IBCS  VALUE 'BCS'          PIC X(03).
          03  WSS-GLS-NOVA  VALUE 'NOVA'         PIC X(04).
          03  WSS-GLS-IBCI  VALUE 'BCI'          PIC X(03).
      *AFRI-FIN/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
*% END
          03  WSS-IFIN      VALUE SPACES   PIC X(01).
          03  WSS-IFLD       VALUE ZEROES        PIC 9(02).
          03  WSS-IMAX       VALUE ZEROES        PIC 9(02).
          03  WSS-MOV        VALUE ZEROES        PIC 9(02).
          03  ACG-KEY-IACG.
               05  ACG-KEY-ILDC.
                   07  ACG-CAI-ICLF               PIC X(04).
                   07  ACG-IIC-ICLF               PIC X(08).
                   07  ACG-NUM-ILDC               PIC 9(02).
          03  WSS-GLS-DATA.
               05  WSS-GLS-FIL1            PIC X(03).
               05  WSS-GLS-ENTI            PIC X(05).
               05  WSS-GLS-FIL2            PIC X(52).        
*% IF PGM_PQ
      *AFRI-INI/LOF/CHC/07-2009
          03  WSS-QUE-VERS                 PIC X(01).
          03  WSS-OPEC       VALUE SPACES  PIC X(08).
          03  WSS-IND-AVC    VALUE SPACES  PIC X(01).
          03  WSS-COD-FGPE   VALUE ZEROES  PIC X(08).
          03  WSS-COD-COCF.
               05  WSS-COD-TIP             PIC X(03).
               05  WSS-COD-STP             PIC X(03).
      *AFRI-FIN/LOF/CHC/07-2009
*% END
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<<
      *AFRI-INI/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
           IF SCR-CMND NOT = WSS-GLS-IBLI
               GO TO CONT-FND-KEY.
           MOVE RLO-CAI-IOPC IN RLO-FLD TO OPC-CAI-IOPC IN OPC.
           MOVE RLO-IIC-IOPC IN RLO-FLD TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC
           IF NOT FIO-STAT-OKS
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'OPC    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT                            
               MOVE SCR-STAT-CON TO SCR-STAT                            
               MOVE PGM-SRNF     TO PGM-STAT-RLO
               GO TO FIN-FND-KEY.
           IF OPC-MSC-STAT IN OPC = WSS-GLS-AAAA
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'OPC    ACAYA' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE WSS-GLS-STAT TO FIO-STAT                            
               MOVE SCR-STAT-CON TO SCR-STAT                            
               MOVE PGM-SRNF     TO PGM-STAT-RLO
               GO TO FIN-FND-KEY.
           IF OPC-MSC-STAT IN OPC NOT = WSS-GLS-LLLL
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'OPC    NOLIQ' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT                            
               MOVE PGM-SRNF     TO PGM-STAT-RLO
               MOVE SCR-STAT-CON TO SCR-STAT                            
               GO TO FIN-FND-KEY.
           MOVE SCR-QIDD             TO VLI-CCU-QIDD.                   
           MOVE SCR-LIDD             TO VLI-CCU-LIDD.                   
           MOVE OPC-CIC-IOPC IN OPC  TO VLI-OPC-CIC-IOPC.               
           IF OPC-IND-RENO IN OPC     = WSS-GLS-IPRO                    
              MOVE OPC-CAI-IOPC IN OPC     TO VLI-OPC-CAI-INEW          
              MOVE OPC-IIC-IOPC IN OPC     TO VLI-OPC-IIC-INEW          
              PERFORM LEER-ROV-RLO
              MOVE ROV-CAI-IOPV IN ROV     TO VLI-OPC-CAI-IOPC          
              MOVE ROV-IIC-IOPV IN ROV     TO VLI-OPC-IIC-IOPC          
           ELSE                                                         
           IF OPC-IND-RENO IN OPC     = WSS-GLS-IREN                    
              MOVE OPC-CAI-IOPC IN OPC     TO VLI-OPC-CAI-INEW          
              MOVE OPC-IIC-IOPC IN OPC     TO VLI-OPC-IIC-INEW          
              PERFORM LEER-ROV-RLO
              MOVE ROV-CAI-IOPV IN ROV     TO VLI-OPC-CAI-IOPC          
              MOVE ROV-IIC-IOPV IN ROV     TO VLI-OPC-IIC-IOPC.         
           MOVE OPC-IND-RENO IN OPC  TO VLI-ACC.                        
           MOVE WSS-GLS-IBLI         TO VLI-CMND.                       
           IF SCR-HDR-MRCA = WSS-GLS-IBCS                               
               MOVE WSS-GLS-NOVA          TO VLI-COD-ENTI               
           ELSE                                                         
               MOVE WSS-GLS-IBCI          TO VLI-COD-ENTI.              
                                                                        
           MOVE IDD-FSIS IN IDD-VARI TO VLI-VIDD.                       
           MOVE FIO-MSFL IN FIO-CTTS TO VLI-MSFL.                       
           MOVE VLI-CMMA   TO SYS-CMMA.                                 
           MOVE WSS-GLS-PROG TO SYS-PROG.                               
           MOVE VLI-TCMA   TO SYS-TCMA.                                 
           MOVE SYS-LINK   TO SYS-CMND.                                 
           PERFORM GNS-PRO-SYS.                                         
           MOVE SYS-CMMA TO VLI-CMMA.                                   
           MOVE VLI-MSFL TO FIO-MSFL.                                   
           IF VLI-COD-MENS > SPACES                                     
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE VLI-COD-MENS TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT                            
               MOVE SCR-STAT-CON TO SCR-STAT                            
               MOVE PGM-SRNF     TO PGM-STAT-RLO
               GO TO FIN-FND-KEY.
           PERFORM MOV-DAT-RLO.
           MOVE WSS-GLS-STAT TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-RLO.                               
           GO TO FIN-FND-KEY.
       CONT-FND-KEY.
      *AFRI-FIN/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
      *AFRI-INI/LOF/CHC/07-2009
           IF SCR-CMND = 'RBJ' OR SCR-CMND = 'LIB'
               MOVE RLO-CAI-IOPC IN RLO-FLD TO OPC-CAI-IOPC IN OPC
               MOVE RLO-IIC-IOPC IN RLO-FLD TO OPC-IIC-IOPC IN OPC
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM COL-FIO-OPC
               IF NOT FIO-STAT-OKS OR
                RLO-NUM-IOPC IN RLO-FLD NOT = ZEROES
                   MOVE 'COL'        TO MSG-COD-SIST
                   MOVE 'COMNOVALPL' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-FND-KEY.
           IF SCR-CMND = 'ING' AND
            RLO-CAI-IOPC IN RLO-FLD > SPACES AND
            RLO-IIC-IOPC IN RLO-FLD > SPACES AND
            RLO-NUM-IOPC IN RLO-FLD NOT > ZEROES
               PERFORM VAL-OPC-AVC
               IF WSS-IND-AVC IN WSS = 'S'
                   MOVE '00' TO FIO-STAT
                   MOVE SCR-STAT-CON TO SCR-STAT
                   GO TO FIN-FND-KEY
               ELSE
                   PERFORM DET-COM-OPER
                   PERFORM DET-QUE-VERS
                   IF WSS-QUE-VERS IN WSS = 'N'
                       NEXT SENTENCE
                   ELSE
                       IF WSS-OPEC = 'B' AND
                        TAB-CIC-CTAB IN TAB NOT = 'LCF'
                           MOVE 'DEU'         TO MSG-COD-SIST
                           MOVE 'BGT CON LCF' TO MSG-COD-MENS
                           PERFORM GET-MSG
                           MOVE MSG-GLS-DESC TO FRM-MENS
                           MOVE '00' TO FIO-STAT
                           MOVE SCR-STAT-CON TO SCR-STAT
                           GO TO FIN-FND-KEY
                       ELSE
                           NEXT SENTENCE.
      *AFRI-FIN/LOF/CHC/07-2009
*% END
*% IF FND_KEY
      *INI-AFRI/PDM JUN07                                               
           IF RLO-CAI-ILIC IN RLO-FLD > SPACES AND                      
              RLO-IIC-ILIC IN RLO-FLD > SPACES AND                      
              RLO-CAI-IOPC IN RLO-FLD > SPACES AND                      
              RLO-IIC-IOPC IN RLO-FLD > SPACES                          
*% END
*% IF FND_KEY_CMND
           IF RLO-CAI-ILIC IN RLO-FLD NOT > SPACES AND                  
              RLO-IIC-ILIC IN RLO-FLD NOT > SPACES AND                  
              RLO-CAI-IOPC IN RLO-FLD > SPACES AND                      
              RLO-IIC-IOPC IN RLO-FLD > SPACES                          
              MOVE 'RLO-KEY-IOPC' TO FIO-AKEY.                          
              MOVE FIO-GET-KEY TO FIO-CMND.                             
      *FIN-AFRI/PDM JUN07                                               
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      *INI-AFRI JUN07                                                   
           IF SCR-CMND = 'ELI' AND PGM-STAT-RLO-OKS AND                 
               RLO-MSC-STAT IN RLO NOT = 'I'                            
               MOVE 'DEU' TO MSG-COD-SIST                               
               MOVE 'CMNDELINEX' TO MSG-COD-MENS                        
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE '00' TO FIO-STAT                                    
               MOVE SCR-STAT-CON TO SCR-STAT                            
               GO TO FIN-FND-KEY.                                       
      *FIN-AFRI JUN07                                                   
               PERFORM BUS-ENT-ANEX.                                    
               IF WSS-IFIN = 'S'                                        
                  GO TO FIN-FND-KEY.                                    
           MOVE PGM-STAT-RLO TO FIO-STAT.                               
      *>>>>
*% END
*% IF PUT_SCR
      *<<<<
           PERFORM BUS-ENT-ANEX.
      *>>>>
*% END
*% IF FIN_HBL_FLD 
      *<<<< FIN_HBL_FLD
*% IF PGM_PU
           IF SCR-CMND = 'ING'                                          
              MOVE FRM-CPIM-AEY TO RLO-COD-CGTA-ATR IN RLO-FLD          
              MOVE FRM-CPIM-AEY TO RLO-COD-DENV-ATR IN RLO-FLD          
              MOVE FRM-CPIM-AEY TO FRM-VAL-MLIB-ATR IN RLO-FLD.         
*% END
           IF SCR-CMND = 'RBJ'                                          
              MOVE FRM-CPIM-AEY TO FRM-VAL-MLIB-ATR IN RLO-FLD.         
*% IF PGM_PQ
           IF SCR-CMND = 'ING'                                          
              MOVE FRM-CPIM-AEY TO RLO-COD-CGTA-ATR IN RLO-FLD          
              MOVE FRM-CPIM-AEY TO RLO-COD-DENV-ATR IN RLO-FLD          
              MOVE FRM-CPIM-AEY TO FRM-VAL-MLIB-ATR IN RLO-FLD          
              MOVE 0            TO RLO-COD-CGTA-LEN IN RLO-FLD.         
           IF SCR-CMND = 'LIB'                                          
              MOVE FRM-CPIM-AEY TO RLO-COD-CGTA-ATR IN RLO-FLD          
              MOVE FRM-CPIM-AEY TO RLO-COD-DENV-ATR IN RLO-FLD          
              MOVE FRM-CPIM-AEY TO RLO-COD-CGAR-ATR IN RLO-FLD          
              MOVE FRM-CPIM-AEY TO RLO-COD-DESO-ATR IN RLO-FLD          
              MOVE 0            TO RLO-COD-CGTA-LEN IN RLO-FLD          
              MOVE -1           TO FRM-VAL-MLIB-LEN IN RLO-FLD          
              MOVE FRM-CPIM-UBY TO FRM-VAL-MLIB-ATR IN RLO-FLD.         
           IF SCR-CMND = 'ANC'                                          
              MOVE FRM-CPIM-AEY TO RLO-COD-CGTA-ATR IN RLO-FLD          
              MOVE FRM-CPIM-AEY TO RLO-COD-DENV-ATR IN RLO-FLD          
              MOVE FRM-CPIM-AEY TO RLO-COD-CGAR-ATR IN RLO-FLD          
              MOVE FRM-CPIM-AEY TO RLO-COD-DESO-ATR IN RLO-FLD          
              MOVE 0            TO RLO-COD-CGTA-LEN IN RLO-FLD          
              MOVE -1           TO FRM-VAL-MLIB-LEN IN RLO-FLD          
              MOVE FRM-CPIM-UBY TO FRM-VAL-MLIB-ATR IN RLO-FLD.         
       FIN-HBL-FLD.                                                     
*% END 
      *>>>>
*% END 
*% IF INI_CMN_ING
      *AFRI-INI/LOF/CHC/07-2009
           MOVE RLO-CAI-IOPC IN RLO-FLD TO RLO-CAI-IOPC IN RLO.
           MOVE RLO-IIC-IOPC IN RLO-FLD TO RLO-IIC-IOPC IN RLO.
           MOVE RLO-NUM-IOPC IN RLO-FLD TO RLO-NUM-IOPC IN RLO.
           MOVE 'RLO-KEY-IOPC'          TO FIO-AKEY.
           MOVE FIO-GET-KEY             TO FIO-CMND.
           PERFORM LDC-FIO-RLO.
           IF FIO-STAT-OKS AND
            RLO-CAI-IOPC IN RLO-FLD = RLO-CAI-IOPC IN RLO AND
            RLO-IIC-IOPC IN RLO-FLD = RLO-IIC-IOPC IN RLO AND
            RLO-NUM-IOPC IN RLO-FLD = RLO-NUM-IOPC IN RLO
               MOVE 'DEU'          TO MSG-COD-SIST                      
               MOVE 'RLO    YAEXI' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC   TO FRM-MENS                          
               MOVE FRM-SUAR-MAL   TO FRM-SUAR                          
               GO TO FIN-CMN-ING.                                       
      *AFRI-FIN/LOF/CHC/07-2009
           MOVE SPACES TO RLO.                                          
*% END 
*% IF CMN_MOD
      *AFRI-INI/LOF/CHC/01-2008
           IF SCR-CMND = 'TRL'
               PERFORM PRO-GRA-TRL
               MOVE FIO-DEL TO FIO-CMND                                 
           ELSE
      *AFRI-FIN/LOF/CHC/01-2008
      *AFRI-INI/LOF/CHC/07-2009
           IF SCR-CMND = 'LIB' AND FRM-VAL-MLIB IN RLO-FLD > ZEROES
               COMPUTE RLO-VAL-SGAR IN RLO = RLO-VAL-SGAR IN RLO
               - FRM-VAL-MLIB IN RLO-FLD
               PERFORM PRO-GRA-LCC.
      *AFRI-FIN/LOF/CHC/07-2009
*% END 
*% IF FIN_CMN_MOD 
      *<<<< FIN_CMN_MOD 
      *AFRI-ALD/SEP2008
      *    IF SCR-CMND = 'RBJ'                                          
           IF SCR-CMND = 'RBJ' OR 'TRL'                                 
      *AFRI-ALD/SEP2008
              MOVE SCR-QIDD             TO VLI-CCU-QIDD                 
              MOVE SCR-LIDD             TO VLI-CCU-LIDD                 
              MOVE RLO-CIC-IOPC IN RLO  TO VLI-OPC-CIC-IOPC             
              IF SCR-HDR-MRCA = 'BCS'                                   
                 MOVE 'NOVA'                TO VLI-COD-ENTI             
              ELSE                                                      
                 MOVE 'BCI'                 TO VLI-COD-ENTI             
              END-IF                                                    
              IF RLO-NUM-IOPC IN RLO NOT > ZEROES                       
                 MOVE 'COL'             TO VLI-COD-SIST                 
                 MOVE 'COLPPLIC'        TO SYS-PROG                     
      *AFRI-ALD/SEP2008
                 IF SCR-CMND = 'TRL'
                     MOVE 'TRL'             TO VLI-CMND                 
                     MOVE FRM-CAI-ILIC IN RLO-FLD TO VLI-CAI-ILIC       
                     MOVE FRM-IIC-ILIC IN RLO-FLD TO VLI-IIC-ILIC       
                 ELSE
      *AFRI-ALD/SEP2008
                 MOVE 'RBJ'             TO VLI-CMND                     
                 MOVE RLO-CIC-ILIC IN RLO TO VLI-CIC-ILIC               
      *AFRI-ALD/SEP2008
                 END-IF
      *AFRI-ALD/SEP2008
              ELSE                                                      
                 MOVE 'LDC'             TO VLI-COD-SIST                 
                 MOVE 'LDCPPLIC'        TO SYS-PROG                     
                 MOVE RLO-CIC-ILIC IN RLO TO VLI-CIC-ILIC               
      *AFRI-ALD/SEP2008
                 IF SCR-CMND = 'TRL'
                     MOVE 'TRL'             TO VLI-CMND                 
                     MOVE FRM-CAI-ILIC IN RLO-FLD TO VLI-CAI-ILIC       
                     MOVE FRM-IIC-ILIC IN RLO-FLD TO VLI-IIC-ILIC       
                 ELSE
      *AFRI-ALD/SEP2008
                 MOVE 'RBJ'             TO VLI-CMND                     
      *AFRI-ALD/SEP2008
                 END-IF
      *AFRI-ALD/SEP2008
              END-IF                                                    
              MOVE IDD-FSIS IN IDD-VARI TO VLI-VIDD                     
              MOVE FIO-MSFL IN FIO-CTTS TO VLI-MSFL                     
              MOVE VLI-CMMA   TO SYS-CMMA                               
              MOVE VLI-TCMA   TO SYS-TCMA                               
              MOVE SYS-LINK   TO SYS-CMND                               
              PERFORM GNS-PRO-SYS                                       
              MOVE SYS-CMMA TO VLI-CMMA                                 
              MOVE VLI-MSFL TO FIO-MSFL                                 
              IF VLI-COD-MENS > SPACES                                  
                 MOVE 'DEU'                TO MSG-COD-SIST              
                 MOVE VLI-COD-MENS         TO MSG-COD-MENS              
                 PERFORM GET-MSG                                        
                 MOVE MSG-GLS-DESC         TO FRM-MENS                  
                 MOVE FIO-BCK-OUT          TO FIO-CMND                  
                 PERFORM COL-FIO-OPC                                    
                 MOVE 'S' TO SCR-IERR                                   
                 GO TO FIN-CMN-MOD                                      
              ELSE                                                      
      *AFRI-ALD/SEP2008
                 IF SCR-CMND NOT = 'TRL'
      *AFRI-ALD/SEP2008
                 IF RLO-NUM-IOPC IN RLO NOT > ZEROES                    
                   MOVE RLO-CIC-IOPC IN RLO TO OPC-CIC-IOPC IN OPC      
                   MOVE FIO-GET-KEY-UPD     TO FIO-CMND                 
                   PERFORM COL-FIO-OPC                                  
                   IF FIO-STAT-OKS                                      
                      MOVE RLO-COD-CGTA IN RLO TO OPC-IND-GARA IN OPC   
                      MOVE RLO-COD-DENV IN RLO TO OPC-COD-CDOC IN OPC   
                      MOVE FIO-MOD             TO FIO-CMND              
                      PERFORM COL-FIO-OPC.                              
                                                                        
      *AFRI-INI/LOF/CHC/07-2009
           IF SCR-CMND = 'RBJ'
               PERFORM RBJ-MOD-GDG
               IF MSG-COD-MENS > SPACES
                   GO TO FIN-CMN-MOD.

           IF SCR-CMND NOT = 'LIB'
               GO TO CONT-PRO-CMN-MOD.

           MOVE ZEROES TO WSS-POR-MLIB IN WSS.

           PERFORM OBT-COD-VLR.
           IF WSS-COD-PESO IN WSS = ZEROES
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE 'CODTVLRNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-CMN-MOD.

      *RUTINA BDO
           MOVE RLO-CAI-IOPC IN RLO-FLD TO BDO-CAI-IOPC IN BDO-VARI.
           MOVE RLO-IIC-IOPC IN RLO-FLD TO BDO-IIC-IOPC IN BDO-VARI.
           PERFORM GET-FHOY.
           MOVE HOY-FHOY TO BDO-FEC-FPRO IN BDO-VARI.

           PERFORM OBT-OPE-ANT.
           PERFORM OBT-OPE-ORI.
           MOVE BDO-CIC-ORIG TO BDO-CIC-IOPC IN BDO-VARI.
           IF (BDO-CIC-PROR > SPACES)
               MOVE BDO-CIC-PROR TO BDO-CIC-IOPC IN BDO-VARI.

           PERFORM OBT-SAL-OPC.
           MOVE RLO-CAI-IOPC IN RLO-FLD TO BDO-CAI-IOPC IN BDO-VARI.
           MOVE RLO-IIC-IOPC IN RLO-FLD TO BDO-IIC-IOPC IN BDO-VARI.
           PERFORM BUS-OPC-VOPC.
      *RUTINA BDO

       CONT-PRO-CMN-MOD.

           IF SCR-CMND = 'LIB' AND
            FRM-VAL-MLIB IN RLO-FLD > ZEROES
               MOVE SPACES TO MSG-COD-MENS
               PERFORM RLO-MOD-GDG
               IF MSG-COD-MENS > SPACES
                   GO TO FIN-CMN-MOD.

           IF SCR-CMND = 'LIB'
               GO TO FIN-CMN-MOD.
      *AFRI-FIN/LOF/CHC/07-2009

           IF SCR-CMND = 'LIB' OR 'ANC'                                 
               MOVE RLO-CIC-IOPC IN RLO  TO VLI-OPC-CIC-IOPC            
               MOVE SCR-QIDD             TO VLI-CCU-QIDD                
               MOVE SCR-LIDD             TO VLI-CCU-LIDD                
               IF SCR-HDR-MRCA = 'BCS'                                  
                  MOVE 'NOVA'                TO VLI-COD-ENTI            
               ELSE                                                     
                 MOVE 'BCI'                 TO VLI-COD-ENTI             
               END-IF                                                   
               MOVE 'LIB'                TO VLI-ACC                     
               MOVE 'LIB'                TO VLI-CMND                    
               MOVE FRM-VAL-MLIB IN RLO-FLD TO VLI-VAL-CAPI             
               MOVE 'COL'                TO VLI-COD-SIST                
               MOVE IDD-FSIS IN IDD-VARI TO VLI-VIDD                    
               MOVE FIO-MSFL IN FIO-CTTS TO VLI-MSFL                    
               MOVE VLI-CMMA   TO SYS-CMMA                              
               MOVE 'COLPPLIC' TO SYS-PROG                              
               MOVE VLI-TCMA   TO SYS-TCMA                              
               MOVE SYS-LINK   TO SYS-CMND                              
               PERFORM GNS-PRO-SYS.                                     
               MOVE SYS-CMMA TO VLI-CMMA                                
               MOVE VLI-MSFL TO FIO-MSFL                                
               IF VLI-COD-MENS > SPACES                                 
                  MOVE 'DEU'                TO MSG-COD-SIST             
                  MOVE VLI-COD-MENS         TO MSG-COD-MENS             
                  PERFORM GET-MSG                                       
                  MOVE MSG-GLS-DESC         TO FRM-MENS                 
                  MOVE FIO-BCK-OUT          TO FIO-CMND                 
                  PERFORM COL-FIO-OPC                                   
                  MOVE 'S' TO SCR-IERR                                  
                  GO TO FIN-CMN-MOD.                                    
      *BCK-CMN-ACC-NEXT.                                                
      *>>>> 
*% END
*% IF EOF_PQ                                                         
      *<<<< EOF_PQ
       BUS-ENT-ANEX SECTION.
       INI-BUS-ENT-ANEX.
      *AFRI-INI/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
           IF NOT PGM-STAT-RLO-OKS
               IF SCR-CMND = WSS-GLS-IBLI
                   GO TO FIN-BUS-ENT-ANEX.                              
      *AFRI-FIN/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
           MOVE RLO-CIC-ILIC IN RLO TO LCC-CIC-ILIC IN LCC.             
           MOVE 'LCC-KEY-ILIC'      TO FIO-AKEY.                        
           MOVE FIO-GET-KEY         TO FIO-CMND.                        
           PERFORM LDC-FIO-LCC.                                         
           IF NOT FIO-STAT-OKS                                          
      *        RLO no tiene LCC asociado                                
               MOVE 'DEU' TO MSG-COD-SIST                               
               MOVE 'LCC    NEX' TO MSG-COD-MENS                        
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE '00' TO FIO-STAT                                    
               MOVE SCR-STAT-CON TO SCR-STAT                            
               MOVE 'S'          TO WSS-IFIN                            
               GO TO FIN-BUS-ENT-ANEX.                                  
                                                                        
           MOVE SPACES              TO WSS-IFIN IN WSS.                 
           MOVE LCC-CAI-ICLF IN LCC TO CLF-CAI-ICLF IN CLF.             
           MOVE LCC-IIC-ICLF IN LCC TO CLF-IIC-ICLF IN CLF.             
           MOVE FIO-GET-KEY    TO FIO-CMND.                             
           PERFORM LDC-FIO-CLF.                                         
           IF NOT FIO-STAT-OKS                                          
      *        LDC no tiene CLF asociado                                
               MOVE 'DEU' TO MSG-COD-SIST                               
               MOVE 'CLF    NEX' TO MSG-COD-MENS                        
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE '00' TO FIO-STAT                                    
               MOVE SCR-STAT-CON TO SCR-STAT                            
               MOVE 'S'          TO WSS-IFIN                            
               GO TO FIN-BUS-ENT-ANEX.                                  
           MOVE LCC-CAI-ICLF IN LCC TO LDC-CAI-ICLF IN LDC.             
           MOVE LCC-IIC-ICLF IN LCC TO LDC-IIC-ICLF IN LDC.             
           MOVE LCC-NUM-ILCC IN LCC TO LDC-NUM-ILDC IN LDC.             
           MOVE FIO-GET-KEY    TO FIO-CMND.                             
           PERFORM LDC-FIO-LDC.                                         
      *    MOVE FIO-STAT TO PGM-STAT-RLO.                               
           IF NOT FIO-STAT-OKS                                          
      *        LDC no tiene CLF asociado                                
                  MOVE 'DEU' TO MSG-COD-SIST                            
                  MOVE 'LDC    NEX' TO MSG-COD-MENS                     
                  PERFORM GET-MSG                                       
                  MOVE MSG-GLS-DESC TO FRM-MENS                         
                  MOVE '00' TO FIO-STAT                                 
                  MOVE SCR-STAT-CON TO SCR-STAT                         
                  MOVE 'S'          TO WSS-IFIN                         
                  GO TO FIN-BUS-ENT-ANEX.                               
                                                                        
                  MOVE CLF-CAI-ICLF IN CLF TO RDC-CAI-ICLF IN RDL.      
                  MOVE CLF-IIC-ICLF IN CLF TO RDC-IIC-ICLF IN RDL.      
                  MOVE 'RDC-KEY-ICLF' TO FIO-AKEY.                      
                  MOVE FIO-GET-NLS    TO FIO-CMND.                      
                  PERFORM LDC-FIO-RDC.                                  
                  IF  NOT FIO-STAT-OKS                                  
      *           IF (NOT FIO-STAT-OKS) OR                              
      *              (RDC-CIC-ICLF IN RDL NOT = CLF-CIC-ICLF IN CLF)    
      *        CLF no tiene RDC asociado                                
                      MOVE 'DEU'         TO MSG-COD-SIST                
                      MOVE 'RDC    NEX'  TO MSG-COD-MENS                
                      PERFORM GET-MSG                                   
                      MOVE MSG-GLS-DESC  TO FRM-MENS                    
                      MOVE '00'          TO FIO-STAT                    
                      MOVE SCR-STAT-CON  TO SCR-STAT                    
                      MOVE 'S'           TO WSS-IFIN                    
                      GO TO FIN-BUS-ENT-ANEX                            
                  ELSE                                                  
                      MOVE RDC-CIC-ICLI IN RDL  TO DBC-CIC-ICLI IN DBC  
                      MOVE FIO-GET-KEY  TO FIO-CMND                     
                      PERFORM SGC-FIO-DBC                               
      *               MOVE FIO-STAT     TO PGM-STAT-RLO                 
                      IF NOT FIO-STAT-OKS                               
      *           RDC NO TIENE DBC ASOCIADO                             
                         MOVE 'DEU'         TO MSG-COD-SIST             
                         MOVE 'DBC    NEX'  TO MSG-COD-MENS             
                         PERFORM GET-MSG                                
                         MOVE MSG-GLS-DESC  TO FRM-MENS                 
                         MOVE '00'          TO FIO-STAT                 
                         MOVE SCR-STAT-CON  TO SCR-STAT                 
                         MOVE 'S'           TO WSS-IFIN                 
                         GO TO FIN-BUS-ENT-ANEX                         
                      ELSE                                              
                         MOVE DBC-GLS-NOMC IN DBC  TO CPT-STRN          
                         PERFORM CPT-BLKS                               
                         MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC.          
                                                                        
                  MOVE LDC-COD-TIPO IN LDC TO FRM-COD-TIPO IN RLO-FLD.  
                  MOVE LDC-GLS-DESC IN LDC TO FRM-GLS-DESC IN RLO-FLD.  
                  MOVE DBC-GLS-NOMC IN DBC TO FRM-GLS-NOMB IN RLO-FLD.  
                  MOVE DBC-NUM-ICLI IN DBC TO FRM-NUM-CLIE IN RLO-FLD.  
                  MOVE DBC-IND-ICLI IN DBC TO FRM-IND-CLIE IN RLO-FLD.  
                  MOVE DBC-GLS-ICLI IN DBC TO FRM-GLS-CLIE IN RLO-FLD.  
                  MOVE DBC-VRF-ICLI IN DBC TO FRM-VRF-CLIE IN RLO-FLD.  
                      IF RLO-NUM-IOPC IN RLO-FLD NOT > ZEROES           
                         PERFORM BUSCA-DAT-COL                          
      *AFRI-INI/LOF/CHC/07-2009
      *DETERMINA SI ES OPC FOGAPE
                         PERFORM DET-FGP-OPC
      *AFRI-FIN/LOF/CHC/07-2009
                      ELSE                                              
      *AFRI-INI/LOF/CHC/07-2009
      *                  PERFORM BUSCA-DAT-LDC.
                                                                        
      *DETERMINA SI ES LINEA FOGAPE
                         PERFORM DET-FGP-LDC.
      *AFRI-FIN/LOF/CHC/07-2009

      *ALD-AFRI/SEP2008
                  IF SCR-CMND = 'TRL'
                      GO TO FIN-BUS-ENT-ANEX.                           
      *ALD-AFRI/SEP2008
                                                                        
      *AFRI-INI/LOF/CHC/07-2009
               IF SCR-CMND = 'RBJ' AND WSS-COD-FGPE IN WSS = 'SIFOGAPE'
                   MOVE 'DEU'          TO MSG-COD-SIST
                   MOVE 'RBJPARANOFGP' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE SCR-STAT-CON TO SCR-STAT
                   MOVE '00' TO FIO-STAT
                   MOVE 'S'          TO WSS-IFIN
                   GO TO FIN-BUS-ENT-ANEX.
               IF ((SCR-CMND = 'ING' OR SCR-CMND = 'CON' OR
                SCR-CMND = 'ELI') AND WSS-COD-FGPE IN WSS = 'NOFOGAPE')
                OR (SCR-CMND = 'RBJ' OR SCR-CMND = 'LIB' OR
                SCR-CMND = 'ANC')
      *VALIDA SI LA LICITACION ES FOGAPE
                   MOVE 'TAB'               TO FIO-SIST
                   MOVE 'TIO'               TO TAB-CIC-TTAB
                   MOVE 'FGL'               TO TAB-CIC-CTAB
                   MOVE 'TAB-CIC-TABL'      TO FIO-AKEY
                   MOVE FIO-GET-KEY TO FIO-CMND
                   PERFORM GNS-FIO-TAB
                   IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S' AND
                    TAB-COD-CTAB IN TAB = CLF-COD-TOCF IN CLF
                       MOVE CLF-COD-TOCF IN CLF TO WSS-COD-TIP IN WSS
                       MOVE CLF-COD-AOCF IN CLF TO WSS-COD-STP IN WSS
                       MOVE 'TAB'               TO FIO-SIST
                       MOVE 'AUX'               TO TAB-CIC-TTAB
                       MOVE 'FGLFGF'            TO TAB-CIC-CTAB
                       MOVE 'TAB-CIC-TABL'      TO FIO-AKEY
                       MOVE FIO-GET-KEY TO FIO-CMND
                       PERFORM GNS-FIO-TAB
                       IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S' AND
                        TAB-COD-CTAB IN TAB = WSS-COD-COCF IN WSS
                           GO TO CON-CIC-RLO.
      *AFRI-FIN/LOF/CHC/07-2009
                  IF CLF-MSC-STAT IN CLF = 'C'                          
      *        LDC eliminada                                            
                      MOVE 'DEU'           TO MSG-COD-SIST              
                      MOVE 'CLF    EXTING' TO MSG-COD-MENS              
                      PERFORM GET-MSG                                   
                      MOVE MSG-GLS-DESC TO FRM-MENS                     
                      MOVE SCR-STAT-CON TO SCR-STAT                     
                      MOVE '00' TO FIO-STAT                             
                      MOVE 'S'          TO WSS-IFIN                     
                      GO TO FIN-BUS-ENT-ANEX.                           
                                                                        
                  IF CLF-MSC-STAT IN CLF = 'R'                          
      *        CLF fue renovada                                         
                      MOVE 'DEU'           TO MSG-COD-SIST              
                      MOVE 'LIC    MCAYA' TO MSG-COD-MENS               
                      PERFORM GET-MSG                                   
                      MOVE MSG-GLS-DESC TO FRM-MENS                     
                      MOVE SCR-STAT-CON TO SCR-STAT                     
                      MOVE '00' TO FIO-STAT                             
                      MOVE 'S'          TO WSS-IFIN                     
                      GO TO FIN-BUS-ENT-ANEX.                           
                                                                        
                  IF CLF-MSC-STAT IN CLF = 'A'                          
      *        LDC activada                                             
                      MOVE 'DEU'          TO MSG-COD-SIST               
                      MOVE 'CLF    ACAYA' TO MSG-COD-MENS               
                      PERFORM GET-MSG                                   
                      MOVE MSG-GLS-DESC TO FRM-MENS                     
                      MOVE SCR-STAT-CON TO SCR-STAT                     
                      MOVE '00' TO FIO-STAT                             
                      MOVE 'S'          TO WSS-IFIN                     
                      GO TO FIN-BUS-ENT-ANEX.                           
                                                                        
      *AFRI-INI/LOF/CHC/07-2009
       CON-CIC-RLO.
      *AFRI-FIN/LOF/CHC/07-2009
                                                                        
                  IF SCR-CCPP = 'ACC' AND SCR-STAT = SCR-STAT-CON       
                      MOVE PGM-STAT-RLO TO FIO-STAT                     
                      MOVE 'S'          TO WSS-IFIN                     
                      GO TO FIN-BUS-ENT-ANEX.                           
                                                                        
                 IF SCR-CCPP = 'ING'                                    
                      MOVE PGM-STAT-RLO TO FIO-STAT                     
                      MOVE 'S'          TO WSS-IFIN                     
                      GO TO FIN-BUS-ENT-ANEX.                           
                                                                        
       FIN-BUS-ENT-ANEX.
           EXIT.

       BUSCA-DAT-COL SECTION.
       INI-BUSCA-DAT-COL.
           MOVE RLO-CAI-IOPC IN RLO-FLD TO OPC-CAI-IOPC IN OPC          
           MOVE RLO-IIC-IOPC IN RLO-FLD TO OPC-IIC-IOPC IN OPC          
           MOVE FIO-GET-KEY             TO FIO-CMND                     
           PERFORM COL-FIO-OPC                                          
           IF NOT FIO-STAT-OKS                                          
              MOVE 'DEU'          TO MSG-COD-SIST
              MOVE 'OPC    NEX'   TO MSG-COD-MENS
              PERFORM GET-MSG                                           
              MOVE MSG-GLS-DESC TO FRM-MENS                             
              MOVE SCR-STAT-CON TO SCR-STAT                             
              MOVE '00' TO FIO-STAT                                     
              MOVE 'S'          TO WSS-IFIN                             
              GO TO FIN-BUSCA-DAT-COL.                                  
           MOVE OPC-COD-CDOC IN OPC TO RLO-COD-DESO IN RLO-FLD.         
           MOVE OPC-IND-GARA IN OPC TO RLO-COD-CGAR IN RLO-FLD.         
           MOVE OPC-VAL-CRED IN OPC TO FRM-VAL-MOPC IN RLO-FLD.         
           MOVE OPC-VAL-SCRE IN OPC TO FRM-VAL-SOPC IN RLO-FLD.         
           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.             
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.             
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.                             
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-RDC.                                         
           IF NOT FIO-STAT-OKS                                          
              MOVE 'DEU'          TO MSG-COD-SIST
              MOVE 'RDC    NEX'   TO MSG-COD-MENS
              PERFORM GET-MSG                                           
              MOVE MSG-GLS-DESC TO FRM-MENS                             
              MOVE SCR-STAT-CON TO SCR-STAT                             
              MOVE '00' TO FIO-STAT                                     
              MOVE 'S'          TO WSS-IFIN                             
              GO TO FIN-BUSCA-DAT-COL.                                  
              MOVE RDC-CIC-ICLI  IN RDC  TO DBC-CIC-ICLI IN DBC         
              MOVE FIO-GET-KEY  TO FIO-CMND                             
              PERFORM SGC-FIO-DBC                                       
      *       MOVE FIO-STAT     TO PGM-STAT-RLO                         
              IF NOT FIO-STAT-OKS                                       
                 MOVE 'DEU'         TO MSG-COD-SIST                     
                 MOVE 'DBC    NEX'  TO MSG-COD-MENS                     
                 PERFORM GET-MSG                                        
                 MOVE MSG-GLS-DESC  TO FRM-MENS                         
                 MOVE '00'          TO FIO-STAT                         
                 MOVE SCR-STAT-CON  TO SCR-STAT                         
                 MOVE 'S'           TO WSS-IFIN                         
                 GO TO FIN-BUSCA-DAT-COL.                               
           MOVE DBC-GLS-NOMC IN DBC  TO CPT-STRN                        
           PERFORM CPT-BLKS                                             
           MOVE CPT-STRN TO FRM-GLS-NOMC IN RLO-FLD.                    
                                                                        
           MOVE DBC-NUM-ICLI IN DBC TO FRM-NUM-ICLI IN RLO-FLD.         
           MOVE DBC-IND-ICLI IN DBC TO FRM-IND-ICLI IN RLO-FLD.         
           MOVE DBC-GLS-ICLI IN DBC TO FRM-GLS-ICLI IN RLO-FLD.         
           MOVE DBC-VRF-ICLI IN DBC TO FRM-VRF-ICLI IN RLO-FLD.         
           IF SCR-CMND = 'ING'                                          
              MOVE DBC-COD-ACTI IN DBC TO RLO-COD-ACTI IN RLO-FLD.      
       FIN-BUSCA-DAT-COL.                                               
           EXIT.                                                        
       BUSCA-DAT-LDC SECTION.                                           
       INI-BUSCA-DAT-LDC.                                               
           MOVE RLO-CAI-IOPC IN RLO-FLD TO LDC-CAI-ICLF IN LDC.         
           MOVE RLO-IIC-IOPC IN RLO-FLD TO LDC-IIC-ICLF IN LDC.         
           MOVE RLO-NUM-IOPC IN RLO-FLD TO LDC-NUM-ILDC IN LDC.         
           MOVE FIO-GET-KEY             TO FIO-CMND                     
           PERFORM LDC-FIO-LDC                                          
           IF NOT FIO-STAT-OKS                                          
              MOVE 'DEU'        TO MSG-COD-SIST
              MOVE 'LDC INEX'   TO MSG-COD-MENS
              PERFORM GET-MSG                                           
               MOVE MSG-GLS-DESC TO FRM-MENS                            
              MOVE SCR-STAT-CON TO SCR-STAT                             
              MOVE '00' TO FIO-STAT                                     
              MOVE 'S'          TO WSS-IFIN                             
              GO TO FIN-BUSCA-DAT-LDC.                                  
           MOVE SPACES              TO RLO-COD-DESO IN RLO-FLD.         
           MOVE SPACES              TO RLO-COD-CGAR IN RLO-FLD.         
           MOVE LDC-VAL-CMAX IN LDC TO FRM-VAL-MOPC IN RLO-FLD.         
           MOVE LDC-VAL-CMAX IN LDC TO FRM-VAL-SOPC IN RLO-FLD.         
           MOVE 'RDC-KEY-ICLF' TO FIO-AKEY.                             
           MOVE LDC-CAI-ICLF IN LDC   TO RDC-CAI-ICLF IN RDL.           
           MOVE LDC-IIC-ICLF IN LDC   TO RDC-IIC-ICLF IN RDL.           
           MOVE FIO-GET-NLS    TO FIO-CMND.                             
           PERFORM LDC-FIO-RDC.                                         
      *     IF (NOT FIO-STAT-OKS) OR                                    
      *        (RDC-CIC-ICLF IN RDL NOT = CLF-CIC-ICLF IN CLF)          
            IF NOT ( FIO-STAT-OKS AND                                   
               LDC-CAI-ICLF IN LDC = RDC-CAI-ICLF IN RDL AND            
               LDC-IIC-ICLF IN LDC = RDC-IIC-ICLF IN RDL )              
                MOVE 'DEU'         TO MSG-COD-SIST                      
                MOVE 'RDC    NEX'  TO MSG-COD-MENS                      
                PERFORM GET-MSG                                         
                MOVE MSG-GLS-DESC  TO FRM-MENS                          
                MOVE '00'          TO FIO-STAT                          
                MOVE SCR-STAT-CON  TO SCR-STAT                          
                MOVE 'S'           TO WSS-IFIN                          
                GO TO FIN-BUSCA-DAT-LDC.                                
           MOVE RDC-CIC-ICLI  IN RDL  TO DBC-CIC-ICLI IN DBC            
           MOVE FIO-GET-KEY  TO FIO-CMND                                
           PERFORM SGC-FIO-DBC                                          
      *    MOVE FIO-STAT     TO PGM-STAT-RLO                            
           IF NOT FIO-STAT-OKS                                          
              MOVE 'DEU'         TO MSG-COD-SIST                        
              MOVE 'DBC    NEX'  TO MSG-COD-MENS                        
              PERFORM GET-MSG                                           
              MOVE MSG-GLS-DESC  TO FRM-MENS                            
              MOVE '00'          TO FIO-STAT                            
              MOVE SCR-STAT-CON  TO SCR-STAT                            
              MOVE 'S'           TO WSS-IFIN                            
              GO TO FIN-BUSCA-DAT-LDC.                                  
           MOVE DBC-GLS-NOMC IN DBC  TO CPT-STRN                        
           PERFORM CPT-BLKS                                             
           MOVE CPT-STRN TO FRM-GLS-NOMC IN RLO-FLD.                    
                                                                        
           MOVE DBC-NUM-ICLI IN DBC TO FRM-NUM-ICLI IN RLO-FLD.         
           MOVE DBC-IND-ICLI IN DBC TO FRM-IND-ICLI IN RLO-FLD.         
           MOVE DBC-GLS-ICLI IN DBC TO FRM-GLS-ICLI IN RLO-FLD.         
           MOVE DBC-VRF-ICLI IN DBC TO FRM-VRF-ICLI IN RLO-FLD.         
           IF SCR-CMND = 'ING'                                          
              MOVE DBC-COD-ACTI IN DBC TO RLO-COD-ACTI IN RLO-FLD.      
       FIN-BUSCA-DAT-LDC.                                               
           EXIT.                                                        
                                                                        
      *AFRI-INI/LOF/CHC/07-2009
       DET-FGP-OPC SECTION.
       INI-DET-FGP-OPC.
           MOVE 'NOFOGAPE'          TO WSS-COD-FGPE IN WSS.
           MOVE 'COL'               TO FIO-SIST.
           MOVE 'GARA'              TO MSC-COD-TMSC IN MSC.
           MOVE OPC-IND-GARA IN OPC TO MSC-COD-CMSC IN MSC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT (FIO-STAT-OKS AND MSC-IND-VIGE IN MSC = 'S')
               GO TO FIN-DET-FGP-OPC.
           IF MSC-GLS-DATA IN MSC(60:1) NOT = 'F'
               GO TO FIN-DET-FGP-OPC.
           MOVE 'COL'               TO TAB-COD-SIST FIO-SIST.
           MOVE 'DES'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-CDOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
               IF (TAB-GLS-DATA IN TAB(60:1) = 'K' OR
                TAB-GLS-DATA IN TAB(60:1) = 'I')
                  MOVE 'SIFOGAPE' TO WSS-COD-FGPE IN WSS.
       FIN-DET-FGP-OPC.
           EXIT.

       DET-FGP-LDC SECTION.
       INI-DET-FGP-LDC.
           MOVE 'NOFOGAPE'          TO WSS-COD-FGPE IN WSS.
           MOVE LDC-CIC-ICLF IN LDC TO ARG-CIC-ICLF IN ARG.
           MOVE LDC-NUM-ILDC IN LDC TO ARG-NUM-ILDC IN ARG.
           MOVE ZEROES              TO ARG-NUM-IARG IN ARG.
           MOVE FIO-GET-NLS         TO FIO-CMND.
       LUP-DET-FGP-LDC.
           PERFORM LDC-FIO-ARG.
           IF NOT (FIO-STAT-OKS AND
            ARG-CIC-ICLF IN ARG = LDC-CIC-ICLF IN LDC AND
            ARG-NUM-ILDC IN ARG = LDC-NUM-ILDC IN LDC)
               GO TO FIN-DET-FGP-LDC.
           IF (ARG-COD-TOGA IN ARG = '952' AND
            ARG-COD-AOGA IN ARG = '101')
               MOVE 'SIFOGAPE' TO WSS-COD-FGPE IN WSS
               GO TO FIN-DET-FGP-LDC.
           MOVE FIO-GET-NXT TO FIO-CMND
           GO TO LUP-DET-FGP-LDC.
       FIN-DET-FGP-LDC.
           EXIT.

       VAL-OPC-AVC SECTION.
       INI-VAL-OPC-AVC.
           MOVE 'N' TO WSS-IND-AVC IN WSS.
           MOVE RLO-CAI-IOPC IN RLO-FLD TO OPC-CAI-IOPC IN OPC.
           MOVE RLO-IIC-IOPC IN RLO-FLD TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY             TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
              MOVE 'DEU'        TO MSG-COD-SIST
              MOVE 'OPC    NEX' TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              GO TO FIN-VAL-OPC-AVC.
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'TIO'          TO TAB-CIC-TTAB.
           MOVE 'AVC'          TO TAB-CIC-CTAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S' AND
            TAB-COD-CTAB = OPC-COD-TOOC IN OPC
               MOVE 'DEU'          TO MSG-COD-SIST
               MOVE 'RLONOPER AVC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE 'S' TO WSS-IND-AVC IN WSS.
       FIN-VAL-OPC-AVC.
           EXIT.

       DET-COM-OPER SECTION.
       INI-DET-COM-OPER.
           MOVE SPACES TO WSS-OPEC IN WSS.
           MOVE OPC-COD-TOOC IN OPC TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM COL-FIO-TOC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'OPCTOOCNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00' TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-DET-COM-OPER.
           MOVE TOC-MSC-OPEC IN TOC TO WSS-OPEC IN WSS.
       FIN-DET-COM-OPER.
           EXIT.

       DET-QUE-VERS SECTION.
       INI-DET-QUE-VERS.
           MOVE 'DEU'       TO TAB-COD-SIST FIO-SIST.
           MOVE 'VTA'       TO TAB-COD-TTAB IN TAB.
           MOVE SPACES      TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
               MOVE 'A' TO WSS-QUE-VERS IN WSS
           ELSE
               IF TAB-GLS-DATA IN TAB(60:1) = 'N'
                   MOVE 'N' TO WSS-QUE-VERS IN WSS
               ELSE
                   MOVE 'A' TO WSS-QUE-VERS IN WSS.

           MOVE RLO-CAI-ILIC IN RLO-FLD TO LCC-CAI-ILIC IN LCC.
           MOVE RLO-IIC-ILIC IN RLO-FLD TO LCC-IIC-ILIC IN LCC.
           MOVE 'LCC-KEY-ILIC'          TO FIO-AKEY.
           MOVE FIO-GET-KEY             TO FIO-CMND.
           PERFORM LDC-FIO-LCC.

           MOVE LCC-CAI-ICLF IN LCC TO LDC-CAI-ICLF IN LDC.
           MOVE LCC-IIC-ICLF IN LCC TO LDC-IIC-ICLF IN LDC.
           MOVE LCC-NUM-ILCC IN LCC TO LDC-NUM-ILDC IN LDC.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM LDC-FIO-LDC.

           MOVE 'DEU'                 TO TAB-COD-SIST FIO-SIST          
           MOVE 'TLL'                 TO TAB-COD-TTAB IN TAB            
           MOVE LDC-COD-TIPO IN LDC   TO TAB-COD-CTAB IN TAB            
           MOVE FIO-GET-KEY TO FIO-CMND                                 
           PERFORM GNS-FIO-TAB                                          
           IF TAB-IND-VIGE IN TAB NOT = 'S'                             
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'TLL    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00' TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT.
       FIN-DET-QUE-VERS.
           EXIT.
      *AFRI-FIN/LOF/CHC/07-2009

       LEER-ROV-RLO SECTION.
       INI-LEER-ROV-RLO.
           MOVE OPC-CAI-IOPC IN OPC     TO ROV-CAI-IOPC IN ROV.         
           MOVE OPC-IIC-IOPC IN OPC     TO ROV-IIC-IOPC IN ROV.         
           MOVE SPACES                  TO ROV-CIC-IOPV IN ROV.         
           MOVE ZEROES                  TO ROV-NUM-IVCT IN ROV.         
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM COL-FIO-ROV.                                         
       FIN-LEER-ROV-RLO.
           EXIT.
       MOV-DAT-RLO SECTION.
       INI-MOV-DAT-RLO.
           MOVE VLI-CAI-ILIC        TO RLO-CAI-ILIC IN RLO-FLD.         
           MOVE VLI-IIC-ILIC        TO RLO-IIC-ILIC IN RLO-FLD.         
           MOVE VLI-CAI-ILIC        TO RLO-CAI-ILIC IN RLO.             
           MOVE VLI-IIC-ILIC        TO RLO-IIC-ILIC IN RLO.             
           MOVE RLO-CAI-IOPC IN RLO-FLD TO RLO-CAI-IOPC IN RLO.         
           MOVE RLO-IIC-IOPC IN RLO-FLD TO RLO-IIC-IOPC IN RLO.         
           MOVE ZEROES              TO RLO-NUM-IOPC IN RLO.             
           MOVE SPACES              TO RLO-CIC-ENTI IN RLO.             
           MOVE SPACES              TO RLO-COD-ACTI IN RLO.             
           MOVE ZEROES              TO RLO-NUM-UNIL IN RLO.             
           MOVE ZEROES              TO RLO-VAL-MGAR IN RLO.             
           MOVE ZEROES              TO RLO-VAL-SGAR IN RLO.             
           MOVE VLI-VAL-COMF        TO RLO-VAL-PGAR IN RLO.             
           MOVE SPACES              TO RLO-COD-CGAR IN RLO.             
           MOVE SPACES              TO RLO-COD-CGTA IN RLO.             
           MOVE SPACES              TO RLO-COD-DESO IN RLO.             
           MOVE SPACES              TO RLO-COD-DENV IN RLO.             
           MOVE ZEROES              TO RLO-NUM-DACT IN RLO.             
           MOVE ZEROES              TO RLO-NUM-MACT IN RLO.             
           MOVE ZEROES              TO RLO-NUM-SACT IN RLO.             
           MOVE ZEROES              TO RLO-NUM-AACT IN RLO.             
       FIN-MOV-DAT-RLO.
           EXIT.
      *>>>>
*% END
*% IF EOF                                                        
      *<<<< EOF
*% IF PGM_PU
      *AFRI-INI/LOF/CHC/07-2009
       COPY TABBFCAM.
       COPY GNSBGPES.
       COPY BGLBFGDO.
       COPY BGLBFGMO.
       COPY BGLBFGAP.
       COPY BGLBFGUB.
       COPY BGLBFGDG.
       COPY BGLBFGVT.
       COPY BGLBFGES.
       COPY BGLBFGDD.
       COPY TABBFOFI.
       COPY GNSBFCIC.
       COPY GNSBGCIC.
       COPY BGLBFTAG.
       COPY COLBFROV.
       COPY COLBFVEN.
       COPY COLBFCYA.
       COPY COLBFEVC.
       COPY COLBFICG.
       COPY COLBFDLC.
       COPY COLBFTOC.
       COPY COLBGVEN.
       COPY COLBGINT.
       COPY GNSBPFEC.
      *AFRI-FIN/LOF/CHC/07-2009
*% END
*% IF PGM_PQ
      *AFRI-INI/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
       COPY COLBFROV.
      *AFRI-FIN/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
      *AFRI-INI/LOF/CHC/07-2009
       COPY LDCBFARG.
       COPY COLBFTOC.
      *AFRI-FIN/LOF/CHC/07-2009
*% END
       COPY GNSBBTAB.                                                 
       COPY GNSBGCPT.
       COPY SGCBFDBC.
       COPY LDCBFLDC.
       COPY COLBFOPC.
       COPY COLBFRDC.
       COPY LDCBFLCC.
       COPY LDCBFRDC REPLACING RDC BY RDL
                    ==ADR-RDC-REQA== BY ==ADR-RDL-REQA==.
       COPY LDCBFCLF.
       COPY LDCBFACG.
*% IF PGM_PU
       COPY COLBFCXE.                                                   
       COPY COLBFCAN.                                                   
       COPY COLBFRCV.                                                   
      *AFRI-INI/LOF/CHC/01-2008
      *---------------------------------------------------------------- 
      *MODIFICA LCC - SE RESTA AL MONTO UTILIZADO [LCC-VAL-MUTI] EL     
      *MONTO LIBERADO
      *---------------------------------------------------------------- 
       PRO-GRA-TRL SECTION.                                             
       INI-PRO-GRA-TRL.                                                 
           MOVE RLO-CAI-ILIC IN RLO-FLD TO LCC-CAI-ILIC IN LCC.         
           MOVE RLO-IIC-ILIC IN RLO-FLD TO LCC-IIC-ILIC IN LCC.         
           MOVE 'LCC-KEY-ILIC'          TO FIO-AKEY.                    
           MOVE FIO-GET-KEY             TO FIO-CMND.                    
           PERFORM LDC-FIO-LCC.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'DEU' TO MSG-COD-SIST                               
               MOVE 'NOEXIS   LCC' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE FRM-SUAR-MAL TO FRM-SUAR                            
               GO TO FIN-PRO-GRA-TRL.                                   
           MOVE FIO-GET-KEY-UPD         TO FIO-CMND.                    
           PERFORM LDC-FIO-LCC.                                         
           COMPUTE LCC-VAL-MUTI IN LCC = LCC-VAL-MUTI IN LCC -
           RLO-VAL-SGAR IN RLO.
           MOVE FIO-MOD TO FIO-CMND.                                    
           PERFORM LDC-FIO-LCC.
           IF NOT FIO-STAT-OKS
               MOVE 'DEU' TO MSG-COD-SIST                               
               MOVE 'NOEXIS   LCC' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE FRM-SUAR-MAL TO FRM-SUAR.                           
           IF RLO-NUM-IOPC IN RLO-FLD > ZEROES
               GO TO PROCESA-REG-LDC.
           MOVE RLO-CIC-IOPC  IN RLO TO CXE-CIC-IOPC IN CXE.            
           MOVE ZEROES               TO CXE-NUM-EVEN IN CXE.            
           MOVE 'CUR'                TO CXE-COD-EVEN IN CXE.            
           MOVE SPACES               TO CXE-CIC-IOPV IN CXE.            
           MOVE ZEROES               TO CXE-NUM-IVCT IN CXE.            
           MOVE 'COMFGF'             TO CXE-COD-CPTO IN CXE.            
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-CXE.                                         
           IF FIO-STAT-OKS                                              
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-CXE
               MOVE CXE-SGV-MCAL IN CXE TO CXE-SGV-SALD IN CXE
               MOVE RLO-CIC-ILIC IN RLO TO CXE-CIC-IPLA IN CXE
               MOVE FIO-MOD TO FIO-CMND
               PERFORM COL-FIO-CXE.
           MOVE RLO-CIC-IOPC  IN RLO TO CXE-CIC-IOPC IN CXE.            
           MOVE ZEROES               TO CXE-NUM-EVEN IN CXE.            
           MOVE 'CUR'                TO CXE-COD-EVEN IN CXE.            
           MOVE SPACES               TO CXE-CIC-IOPV IN CXE.            
           MOVE ZEROES               TO CXE-NUM-IVCT IN CXE.            
           MOVE 'COMFGB'             TO CXE-COD-CPTO IN CXE.            
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-CXE.                                         
           IF FIO-STAT-OKS                                              
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-CXE
               MOVE CXE-SGV-MCAL IN CXE TO CXE-SGV-SALD IN CXE
               MOVE RLO-CIC-ILIC IN RLO TO CXE-CIC-IPLA IN CXE
               MOVE FIO-MOD TO FIO-CMND
               PERFORM COL-FIO-CXE.
               GO TO FIN-PRO-GRA-TRL.                                   
           GO TO FIN-PRO-GRA-TRL.                                       
       PROCESA-REG-LDC.
           MOVE RLO-CIC-IOPC  IN RLO TO CXE-CIC-IOPC IN CXE.            
           MOVE RLO-NUM-IOPC  IN RLO TO CXE-NUM-EVEN IN CXE.            
           MOVE 'AFG'                TO CXE-COD-EVEN IN CXE.            
           MOVE SPACES               TO CXE-CIC-IOPV IN CXE.            
           MOVE ZEROES               TO CXE-NUM-IVCT IN CXE.            
           MOVE 'COMFGF'             TO CXE-COD-CPTO IN CXE.            
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-CXE.                                         
           IF FIO-STAT-OKS                                              
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-CXE
               MOVE CXE-SGV-MCAL IN CXE TO CXE-SGV-SALD IN CXE
               MOVE RLO-CIC-ILIC IN RLO TO CXE-CIC-IPLA IN CXE
               MOVE FIO-MOD TO FIO-CMND
               PERFORM COL-FIO-CXE.
               GO TO FIN-PRO-GRA-TRL.                                   
           MOVE RLO-CIC-IOPC  IN RLO TO CXE-CIC-IOPC IN CXE.            
           MOVE RLO-NUM-IOPC  IN RLO TO CXE-NUM-EVEN IN CXE.            
           MOVE 'AFG'                TO CXE-COD-EVEN IN CXE.            
           MOVE SPACES               TO CXE-CIC-IOPV IN CXE.            
           MOVE ZEROES               TO CXE-NUM-IVCT IN CXE.            
           MOVE 'COMFGB'             TO CXE-COD-CPTO IN CXE.            
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-CXE.                                         
           IF FIO-STAT-OKS                                              
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-CXE
               MOVE CXE-SGV-MCAL IN CXE TO CXE-SGV-SALD IN CXE
               MOVE RLO-CIC-ILIC IN RLO TO CXE-CIC-IPLA IN CXE
               MOVE FIO-MOD TO FIO-CMND
               PERFORM COL-FIO-CXE.
               GO TO FIN-PRO-GRA-TRL.                                   
       FIN-PRO-GRA-TRL.                                                 
           EXIT.                                                        
      *AFRI-FIN/LOF/CHC/01-2008
      *>>>>                                                             
      *AFRI-INI/LOF/CHC/07-2009
      *----------------------------------------------------------------
      *GRABA MONTO LIBERADO EN LA CXE
      *----------------------------------------------------------------
       PRO-GRA-CXE SECTION.
       INI-PRO-GRA-CXE.
           MOVE LOW-VALUES               TO CXE.
           MOVE SPACES                   TO CXE-GLS-FLAG IN CXE.
           MOVE OPC-CAI-IOPC IN OPC      TO CXE-CAI-IOPC IN CXE.
           MOVE OPC-IIC-IOPC IN OPC      TO CXE-IIC-IOPC IN CXE.
           MOVE 'CAN'                    TO CXE-COD-EVEN IN CXE.
           MOVE CAN-NUM-ICAN IN CAN      TO CXE-NUM-EVEN IN CXE.
           MOVE SPACES                   TO CXE-CIC-IOPV IN CXE.
           MOVE ZEROES                   TO CXE-NUM-IVCT IN CXE.
           MOVE 'LIBLIC'                 TO CXE-COD-CPTO IN CXE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CXE.
           IF FIO-STAT-OKS
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-CXE
               MOVE FIO-MOD TO FIO-CMND
           ELSE
               MOVE FIO-PUT TO FIO-CMND.
           MOVE WSS-POR-MLIB IN WSS TO CXE-SGV-MNTO IN CXE.
           MOVE WSS-POR-MLIB IN WSS TO CXE-SGV-MCAL IN CXE.
           MOVE CAN-FEC-FCAN IN CAN TO CXE-FEC-FVEN IN CXE.
           PERFORM COL-FIO-CXE.
       FIN-PRO-GRA-CXE.
           EXIT.
      *----------------------------------------------------------------
      *MODIFICA LCC - SE RESTA AL MONTO UTILIZADO [LCC-VAL-MUTI] EL
      *MONTO LIBERADO
      *----------------------------------------------------------------
       PRO-GRA-LCC SECTION.
       INI-PRO-GRA-LCC.
           MOVE RLO-CAI-ILIC IN RLO-FLD TO LCC-CAI-ILIC IN LCC.
           MOVE RLO-IIC-ILIC IN RLO-FLD TO LCC-IIC-ILIC IN LCC.
           MOVE 'LCC-KEY-ILIC'          TO FIO-AKEY.
           MOVE FIO-GET-KEY-UPD         TO FIO-CMND.
           PERFORM LDC-FIO-LCC.
           IF NOT FIO-STAT-OKS
               MOVE 'DEU' TO MSG-COD-SIST
               MOVE 'NOEXIS   LCC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-PRO-GRA-LCC.
           COMPUTE LCC-VAL-MUTI IN LCC = LCC-VAL-MUTI IN LCC -
           FRM-VAL-MLIB IN RLO-FLD.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM LDC-FIO-LCC.
           IF NOT FIO-STAT-OKS
               MOVE 'DEU' TO MSG-COD-SIST
               MOVE 'NOEXIS   LCC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
       FIN-PRO-GRA-LCC.
           EXIT.

       PRO-GRA-GAR SECTION.
       INI-PRO-GRA-GAR.
           MOVE 'S' TO WSS-IND-EGDD.
           MOVE 'S' TO WSS-IND-EGVT.
           MOVE 'S' TO WSS-IND-EGES.
           MOVE 'S' TO WSS-IND-EGDO.
           MOVE 'S' TO WSS-IND-EGAP.
           MOVE 'S' TO WSS-IND-EGUB.
      *BUSCAR CIC DEL CLIENTE POR RUT
           MOVE FRM-NUM-ICLI IN RLO-FLD TO DBC-NUM-ICLI IN DBC.         
           MOVE FRM-IND-ICLI IN RLO-FLD TO DBC-IND-ICLI IN DBC.         
           MOVE FRM-GLS-ICLI IN RLO-FLD TO DBC-GLS-ICLI IN DBC.         
           MOVE 'DBC-IDC-ICLI'          TO FIO-AKEY.                    
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM SGC-FIO-DBC.                                         
           IF NOT FIO-STAT-OKS
               MOVE 'NO EXIS CLI' TO VLI-COD-MENS
               GO TO FIN-PRO-GRA-GAR.
      *BUSCAR CIC
           PERFORM BUS-NUM-CIC.
           IF CIC-STAT NOT = CIC-STAT-OKS
               MOVE 'NO EXIS CIC' TO VLI-COD-MENS
               GO TO FIN-PRO-GRA-GAR.
      *GRABA GDG
           PERFORM PRO-GRB-GDG.
           IF VLI-COD-MENS > SPACES
               GO TO FIN-PRO-GRA-GAR.
      *GRABA GDD
           PERFORM PRO-GRB-GDD.
           IF VLI-COD-MENS > SPACES
               PERFORM PRO-ELI-GAR
               GO TO FIN-PRO-GRA-GAR.
      *GRABA GVT
           PERFORM PRO-GRB-GVT.
           IF VLI-COD-MENS > SPACES
               PERFORM PRO-ELI-GAR
               GO TO FIN-PRO-GRA-GAR.
      *GRABA GES
           PERFORM PRO-GRB-GES.
           IF VLI-COD-MENS > SPACES
               PERFORM PRO-ELI-GAR
               GO TO FIN-PRO-GRA-GAR.
      *GRABA GDO
           PERFORM PRO-GRB-GDO.
           IF VLI-COD-MENS > SPACES
               PERFORM PRO-ELI-GAR
               GO TO FIN-PRO-GRA-GAR.
      *GRABA GAP
           PERFORM PRO-GRB-GAP.
           IF VLI-COD-MENS > SPACES
               PERFORM PRO-ELI-GAR
               GO TO FIN-PRO-GRA-GAR.
      *GRABA GUB
           PERFORM PRO-GRB-GUB.
           IF VLI-COD-MENS > SPACES
               PERFORM PRO-ELI-GAR
               GO TO FIN-PRO-GRA-GAR.

           PERFORM PRO-VAL-ENT.
       FIN-PRO-GRA-GAR.
           EXIT.

       PRO-GRB-GDG SECTION.
       INI-PRO-GRB-GDG.
      *    Filler Compatibilidad VSAM/MVS
           MOVE SPACES              TO  GDG-GLS-FLAG IN GDG.

      *    Clave Primaria Registro
           MOVE CIC-CIC-ICIC IN CIC TO  GDG-KEY-IGDG IN GDG.

      *    Time Stamp Transaccion
           MOVE HOY-STP-ITRN TO  GDG-STP-ITRN IN GDG.

      *    TIPO ACCION
           MOVE 'I'    TO  GDG-MSC-TACC IN GDG.

      *Estado del registro
           MOVE 'COL'                   TO TAB-COD-SIST FIO-SIST.
           MOVE 'DES'                   TO TAB-COD-TTAB IN TAB.
           MOVE RLO-COD-DENV IN RLO     TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
               MOVE TAB-GLS-DATA IN TAB(60:1) TO WSS-COD-CDOC.

           IF WSS-COD-CDOC = 'K'
               MOVE 'A'    TO  GDG-MSC-STAT IN GDG
           ELSE
               MOVE 'I'    TO  GDG-MSC-STAT IN GDG.

      *REQ Codigo Origen Transaccion
           MOVE SPACES TO    GDG-COD-OTRN IN GDG.

      *REQ Autor Transaccion
           MOVE 'LDCPURLO' TO    GDG-COD-ATRN IN GDG.

      *    Codigo oficina
           MOVE VLI-OPC-COD-OFIC  TO    GDG-COD-OFIC IN GDG.

      *    Codigo Clase Garantia
           MOVE '952101' TO    GDG-COD-CGTA IN GDG.

      *    Valor de Cambio de la Garantia
           MOVE  VLI-OPC-COD-VCOC  TO   GDG-COD-VCAM IN GDG.

      *    Fecha Solicitud Constitucion
           MOVE VLI-OPC-FEC-FCOL  TO    GDG-FEC-FSOL IN GDG.

      *    Fecha Escritura Constitucion
           MOVE HOY-FHOY TO    GDG-FEC-FEST IN GDG.

      *    Fecha Vencimiento Garantia
           MOVE VLI-DLC-FEC-FMAV TO  GDG-FEC-FVTO IN GDG.

      *    Grado de Garantia
           MOVE '1' TO    GDG-COD-GGTA IN GDG.

      *    Limite de la Garantia
           MOVE 'E' TO    GDG-COD-LGTA IN GDG.

      *    Indicador cliente Banco
           MOVE 'S'    TO   GDG-IND-CBAN IN GDG.

      *    Cod. Int. Comp. Cliente Dueno
           MOVE VLI-CIC-ICLI TO    GDG-CIC-ICLI IN GDG.
           MOVE VLI-CIC-IAFG TO    GDG-CIC-ICLI IN GDG.

      *    RFC del propietario
           MOVE SPACES TO    GDG-COD-RFCP IN GDG.
           MOVE VLI-IDC-IPRO TO    GDG-COD-RFCP IN GDG.

      *    Nombre del propietario
           MOVE SPACES TO    GDG-GLS-NOMP IN GDG.
           MOVE VLI-GLS-NOMP TO    GDG-GLS-NOMP IN GDG.
           MOVE VLI-VRF-IPRO TO    GDG-VRF-IPRO IN GDG.

      *    Estado 1 de la Garantia
           IF WSS-COD-CDOC = 'K'
               MOVE '10' TO    GDG-IND-EST1 IN GDG
           ELSE
               MOVE '05' TO    GDG-IND-EST1 IN GDG.

      *    Identif. Autorizador del Estado 1
           MOVE SPACES     TO    GDG-COD-EST1 IN GDG.

      *    Estado 2 de la Garantia
           MOVE SPACES TO    GDG-COD-EST2 IN GDG.

      *    Fecha Alzamiento
           MOVE ZEROES TO    GDG-FEC-FALZ IN GDG.

      *    Estado 1 Anterior Garantia (Ant BGL-ES1)
           MOVE '05' TO    GDG-COD-ESTA IN GDG.

      *    Indicador Obligatoriedad Inspeccion
           MOVE 'N' TO    GDG-IND-INOB IN GDG.

      *    Indicador de Garantia Completa
           MOVE 'N' TO    GDG-IND-GTAC IN GDG.

      *    Indicador de Existencia de GDG
           MOVE 'S' TO    GDG-IND-EGDG IN GDG.

      *    Indicador de Existencia de GDD
           MOVE SPACES TO GDG-IND-EGDD IN GDG.

      *    Indicador Existencia GES
           MOVE SPACES TO GDG-IND-EGES IN GDG.

      *    Indicador Existencia de GLE
           MOVE SPACES TO    GDG-IND-EGLE IN GDG.

      *    Indicador Existencia de GDO
      *    MOVE SPACES TO    GDG-IND-EGDO IN GDG.

      *    Indicador Existencia de GSE
           MOVE SPACES TO    GDG-IND-EGSE IN GDG.

      *    Indicador Existencia de GVT
           MOVE SPACES TO GDG-IND-EGVT IN GDG.

      *    Indicador Existencia de GTP
           MOVE SPACES TO    GDG-IND-EGTP IN GDG.

      *    Indicador Existencia de GUB
           MOVE SPACES TO    GDG-IND-EGUB IN GDG.

      *    Indicador Existencia de GAP
           MOVE SPACES TO    GDG-IND-EGAP IN GDG.

      *    Indicador Existencia de GIN
           MOVE SPACES TO    GDG-IND-EGIN IN GDG.

      *    Indicador de Existencia de GSI
           MOVE SPACES TO    GDG-IND-EGSI IN GDG.

      *    Ind. de Existencia de Depreciacion
           MOVE SPACES TO    GDG-IND-EGDP IN GDG.

      *    Ind de existencia de tabla de inmuebles
           MOVE SPACES TO    GDG-IND-EGIM IN GDG.

      *    Ind de existencia de la tabla de vehiculos
           MOVE SPACES TO    GDG-IND-EGVE IN GDG.

      *    Identif. Ejecutivo Original
           MOVE DBC-COD-EJEC IN DBC  TO    GDG-CIC-EJOR IN GDG.

      *    Codigo Tipo Especificacion
           MOVE SPACES TO    GDG-IND-TESP IN GDG.

      *    Valor de Cambio Contabilizacion
           MOVE VLI-OPC-COD-VCOC TO    GDG-COD-VCON IN GDG.

      *    NUMERO ULT. TASACION
           MOVE '001' TO    GDG-COD-TSCN IN GDG.

      *    Descripcion 1 de la Garantia
           MOVE 'BGL' TO FIO-SIST.
           MOVE 'MSG' TO TAB-COD-TTAB.
           MOVE 'DESBGLGDG01' TO TAB-COD-CTAB.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DESC TO GDG-GLS-DGTA IN GDG
           ELSE
               MOVE 'GARANTIA FOGAPE' TO GDG-GLS-DGTA IN GDG.
      *    Descripcion 1 de la Garantia
           MOVE 'BGL' TO FIO-SIST.
           MOVE 'MSG' TO TAB-COD-TTAB.
           MOVE 'DESBGLGDG02' TO TAB-COD-CTAB.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DESC TO GDG-GLS-DGT1 IN GDG
           ELSE
               MOVE SPACES       TO GDG-GLS-DGT1 IN GDG.

      *    Indicador Restriccion Alzamiento
           MOVE 'N' TO    GDG-IND-RALZ IN GDG.

      *    Indicador de utilidad
           MOVE SPACES TO    GDG-IND-UTIL IN GDG.

      *    Valor Creditos Consumo
           MOVE ZEROES TO    GDG-VAL-CCON IN GDG.

      *    Valor Creditos Comerciales
           MOVE ZEROES TO    GDG-VAL-CCOM IN GDG.

      *    Codigo de desposecion
           MOVE ZEROES TO    GDG-COD-DESP IN GDG.

      *    Clase de garantia
           MOVE SPACES TO    GDG-IND-CLAS IN GDG.

      *    Monto de la gar a favor del banco
           MOVE ZEROES  TO    GDG-VAL-MNTO IN GDG.

      *    Ident de la gar en otro sistema
           MOVE SPACES TO    GDG-COD-GORI IN GDG.

      *    Clave fisica unica del bien
           MOVE SPACES TO    GDG-COD-UNIC IN GDG.

      *    Fecha Ingreso del Registro GDG
           MOVE VLI-OPC-FEC-FCOL TO    GDG-FEC-FING IN GDG.

      *    Usuario Ingreso Datos Generales.
           MOVE SPACES TO    GDG-CIC-UING IN GDG.

      *    Tipo de Garantia para Control de Margen
           MOVE SPACES TO    GDG-COD-TGCM IN GDG.

      *    Motivo Alzamiento
           MOVE SPACES TO    GDG-COD-MALZ IN GDG.

      *    Indicador Excepcion Comercial Renovacion Seguro
           MOVE SPACES TO    GDG-IND-ECRS IN GDG.

      *    Responsable Excepcion Comercial Renovacion Seguro
           MOVE SPACES TO    GDG-COD-RERS IN GDG.

      *    Fecha Vencimiento Excepcion Comercial Renovacion Seguro
           MOVE ZEROES TO    GDG-FEC-FVES IN GDG.

      *    Indicador Excepcion Comercial Retasacion
           MOVE SPACES TO    GDG-IND-ECRT IN GDG.

      *    Responsable Excepcion Comercial Retasacion
           MOVE SPACES TO    GDG-COD-RERT IN GDG.

      *    Fecha Vencimiento Excepcion Comercial Retasacion
           MOVE ZEROES TO    GDG-FEC-FVET IN GDG.

      *    ROL
           MOVE SPACES TO    GDG-COD-CROL IN GDG.

      *    Glosa Disponible
           MOVE SPACES TO    GDG-GLS-DISP IN GDG.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'BGLGDGNOPUT' TO VLI-COD-MENS.
           MOVE GDG-CIC-GTIA IN GDG TO WSS-CIC-GTIA.

       FIN-PRO-GRB-GDG.
           EXIT.

       PRO-GRB-GDD SECTION.
       INI-PRO-GRB-GDD.

      *    Filler Compatibilidad VSAM/MVS
           MOVE SPACES TO    GDD-GLS-FLAG IN GDD.

      *    COD. INT. COMP. CLIENTE
           MOVE DBC-CIC-ICLI IN DBC TO   GDD-CIC-DCLI IN GDD.

      *    LLAVE ALTERNATIVA
           MOVE GDG-KEY-IGDG IN GDG TO GDD-KEY-AGDD IN GDD.

      *    Time Stamp Transaccion
           MOVE ZEROES TO    GDD-STP-ITRN IN GDD.

      *    Tipo de accion
           MOVE SPACES TO    GDD-MSC-TACC IN GDD.

      *    Estado del registro
           MOVE SPACES TO    GDD-MSC-STAT IN GDD.

      *REQ Codigo Origen Transaccion
           MOVE SPACES TO    GDD-COD-OTRN IN GDD.

      *REQ Autor Transaccion
           MOVE SPACES TO    GDD-COD-ATRN IN GDD.

      *    Monto limite por deudor
           MOVE ZEROES TO    GDD-SGV-VLIM IN GDD.

      *    Porcentaje Limite Por Deudor
           MOVE 100 TO    GDD-SGV-PLIM IN GDD.

      *    Fecha de Ingreso Registro GDD
           MOVE HOY-FHOY TO    GDD-FEC-FING IN GDD.

      *    Usuario Que Ingreso Deudor
           MOVE 'LDCPURLO' TO    GDD-CIC-UING IN GDD.

      *    Disponible
           MOVE SPACES TO    GDD-GLS-DISP IN GDD.

           MOVE FIO-PUT TO FIO-CMND.

           PERFORM BGL-FIO-GDD.

           IF NOT FIO-STAT-OKS
               MOVE 'BGLGDDNOPUT' TO VLI-COD-MENS
               MOVE 'N' TO WSS-IND-EGDD.

       FIN-PRO-GRB-GDD.
           EXIT.

       PRO-GRB-GVT SECTION.
       INI-PRO-GRB-GVT.

      *    Filler Compatibilidad VSAM/MVS
           MOVE SPACES TO    GVT-GLS-FLAG IN GVT.

      *    Cod. Int. Comp. Garantia
           MOVE GDG-KEY-IGDG IN GDG TO GVT-CIC-GTIA IN GVT.

           MOVE 1                   TO GVT-COD-TASN IN GVT.

      *    Time Stamp Transaccion
           MOVE ZEROES TO    GVT-STP-ITRN IN GVT.

           MOVE SPACES TO    GVT-MSC-TACC IN GVT.

           MOVE 'A'    TO    GVT-MSC-STAT IN GVT.

      *REQ Codigo Origen Transaccion
           MOVE SPACES TO    GVT-COD-OTRN IN GVT.
      *
      *REQ Autor Transaccion
           MOVE SPACES TO    GVT-COD-ATRN IN GVT.

      *    Fecha Tasacion
           MOVE VLI-OPC-FEC-FCOL         TO GVT-FEC-FTSN IN GVT.

      *    MOVE 100  TO WSS-NUM-PORC IN WSS.
           MOVE RLO-VAL-PGAR IN RLO TO WSS-NUM-PORC IN WSS.

      *    Valor Liquidacion Tasacion
           COMPUTE  GVT-SGV-LTSN IN GVT =
                 ( VLI-OPC-VAL-SCRE * WSS-NUM-PORC IN WSS) / 100.

      *    Valor Comercial Tasacion
           COMPUTE GVT-SGV-VCTS IN GVT =
                  ( VLI-OPC-VAL-SCRE * WSS-NUM-PORC IN WSS) / 100.

           IF GDG-COD-VCAM IN GDG = '0999  '
               MOVE GVT-SGV-VCTS IN GVT TO PES-SGV-DECI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE TO GVT-SGV-VCTS IN GVT
               MOVE GVT-SGV-LTSN IN GVT TO PES-SGV-DECI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE TO GVT-SGV-LTSN IN GVT.

           MOVE '952'                    TO TAG-COD-TOPE  IN TAG.
           MOVE '101'                    TO TAG-COD-SOPE  IN TAG.
           MOVE FIO-GET-KEY              TO FIO-CMND.
           PERFORM BGL-FIO-TAG.
           IF NOT FIO-STAT-OKS
               MOVE 'BGLTAGNOEXI' TO VLI-COD-MENS
               GO TO FIN-PRO-GRB-GVT.

      *    Porcentaje de Ponderacion
           MOVE TAG-SGV-PPON IN TAG      TO GVT-SGV-PPCT IN GVT.

           MOVE 100          TO   WSS-VAL-PON.

      *    Valor Ponderacion
           MOVE WSS-VAL-PON TO    GVT-SGV-VPND IN GVT.
           IF GDG-COD-VCAM IN GDG = '0999  '
               MOVE GVT-SGV-VPND IN GVT TO PES-SGV-DECI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE TO GVT-SGV-VPND IN GVT.

      *    Porcentaje de Ajuste
           MOVE ZEROES               TO   GVT-SGV-PAJU IN GVT.

      *    Valor Garantia Ajustado Sup
           MOVE GVT-SGV-VCTS IN GVT TO GVT-SGV-VGAS IN GVT.

      *    Valor Siniestrable
           MOVE ZEROES TO    GVT-SGV-VSIN IN GVT.

      *    Identificacion del Tasador
           MOVE '997'  TO    GVT-COD-ITSD IN GVT.

      *    Identificacion del Supervisor
           MOVE '033'  TO    GVT-COD-ISVS IN GVT.

      *     M2 terreno
            MOVE ZEROES TO    GVT-VAL-TTM2 IN GVT.

      *     Metros Cuadrados Construidos
            MOVE SPACES TO    GVT-COD-M2CT IN GVT.

      *    Fecha Revalorizacion
           MOVE VLI-OPC-FEC-FCOL TO GVT-FEC-FRVL IN GVT.

           MOVE SPACES TO   GVT-COD-CRIT IN GVT.
           MOVE SPACES TO   GVT-COD-OAVA IN GVT.
           MOVE ZEROES TO   GVT-SGV-FISI IN GVT.
           MOVE SPACES TO   GVT-COD-ADAG IN GVT.
           MOVE SPACES TO   GVT-COD-SDAG IN GVT.
      *    FECHA INGRESO DEL REG. GVT
           MOVE HOY-FHOY TO    GVT-FEC-FING IN GVT.

      *    Usuario Ingreso Valor O Tasacion
           MOVE 'LDCPURLO' TO    GVT-CIC-UING IN GVT.

      *    Disponible
           MOVE SPACES TO    GVT-GLS-DISP IN GVT.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF NOT FIO-STAT-OKS
               MOVE 'BGLGVTNOPUT' TO VLI-COD-MENS
               MOVE 'N' TO WSS-IND-EGVT.

       FIN-PRO-GRB-GVT.
           EXIT.

       PRO-GRB-GES SECTION.
       INI-PRO-GRB-GES.

      *    Filler Compatibilidad VSAM/MVS
           MOVE SPACES              TO    GES-GLS-FLAG IN GES.

      *    CODIGO INT. COMPUTACIONAL DE LA GARANTIA
           MOVE GDG-KEY-IGDG IN GDG TO GES-CIC-GTIA IN GES.

      *    CORRELATIVO ESPECIFICACION
           MOVE 1                   TO GES-NUM-IGES.

      *    Time Stamp Transaccion
           MOVE ZEROES TO    GES-STP-ITRN IN GES.

      *    INDICADOR TIPO ACCION
           MOVE SPACES TO    GES-MSC-TACC IN GES.

      *    INDICADOR STATUS
           MOVE SPACES TO    GES-MSC-STAT IN GES.

      *REQ Codigo Origen Transaccion
           MOVE SPACES TO    GES-COD-OTRN IN GES.

      *REQ Autor Transaccion
           MOVE SPACES TO    GES-COD-ATRN IN GES.

      *    Sistema al que Pert. el Credito
           MOVE 'CRE'    TO    GES-COD-SIST IN GES.

      *    OperaciOn de CrEdito
           MOVE VLI-OPC-CIC-IOPC TO    GES-KEY-IOPE IN GES.
           MOVE    1             TO    GES-NUM-IDLC IN GES.

      *    Prioridad del Acreedor
           MOVE '01'    TO    GES-COD-PACR IN GES.

      *    Fecha Vcto. Credito
           MOVE VLI-DLC-FEC-FMAV  TO    GES-FEC-FVCR IN GES.

      *    Producto
           MOVE VLI-OPC-COD-TOOC TO    GES-COD-TOPE IN GES.
           MOVE VLI-OPC-COD-AOOC TO    GES-COD-SOPE IN GES.

      *    Valor de Cambio del Credito
           MOVE VLI-OPC-COD-VCOC  TO    GES-COD-VCMC IN GES.

      *    Destino del Credito
           MOVE VLI-OPC-COD-CDOC TO   GES-COD-DCRE IN GES.

      *    Tipo de Deuda Especificada (Directa/Indirecta)
           MOVE 'D'      TO    GES-IND-TDEU IN GES.

      *    Moneda del Valor Limite del Credito
           MOVE SPACES TO    GES-COD-MVLC IN GES.

      *    Valor limite credito
           MOVE ZEROES TO    GES-SGV-VLCR IN GES.

      *    Porcentaje limite credito
           MOVE 100    TO    GES-SGV-PLCR IN GES.

      *    Indica Saldo del CrEdito si es = 0 O mayor
           MOVE 'S'    TO    GES-IND-SCRE IN GES.

      * Codigo de proyecto
           MOVE SPACES TO   GES-KEY-IDGP IN GES.

      *    Fecha de Ingreso del Reg. GES
           MOVE HOY-FHOY TO    GES-FEC-FING IN GES.

      *    Codigo usuario ingreso
           MOVE 'LDCPURLO' TO    GES-CIC-UING IN GES.

      *    Solicitud BEE
           MOVE ZEROES TO    GES-KEY-IGSL IN GES.

      *    Glosa disponible
           MOVE SPACES TO    GES-GLS-DISP IN GES.

           MOVE FIO-PUT TO FIO-CMND.

           PERFORM BGL-FIO-GES.

           IF NOT FIO-STAT-OKS
               MOVE 'BGLGVTNOPUT' TO VLI-COD-MENS
               MOVE 'N' TO WSS-IND-EGES.

       FIN-PRO-GRB-GES.
           EXIT.

       PRO-GRB-GDO SECTION.
       INI-PRO-GRB-GDO.
           MOVE SPACES              TO GDO-GLS-FLAG IN GDO.
           MOVE GDG-KEY-IGDG IN GDG TO GDO-CIC-GTIA IN GDO.
           MOVE 1                   TO GDO-NUM-IGDO IN GDO.
           MOVE ZEROES              TO GDO-STP-ITRN IN GDO.
           MOVE SPACES              TO GDO-MSC-TACC IN GDO.
           MOVE SPACES              TO GDO-MSC-STAT IN GDO.
           MOVE SPACES              TO GDO-COD-OTRN IN GDO.
           MOVE SPACES              TO GDO-COD-ATRN IN GDO.
           MOVE VLI-OPC-IIC-IOPC    TO GDO-COD-DOCU IN GDO.
           MOVE '952'               TO GDO-COD-TDOC IN GDO.
           MOVE VLI-OPC-FEC-FCOL    TO GDO-FEC-FCAP IN GDO.
           MOVE SPACES              TO GDO-COD-IEMI IN GDO.
           MOVE ZEROES              TO GDO-FEC-FING IN GDO.
           MOVE SPACES              TO GDO-CIC-UING IN GDO.
           MOVE 'BCO'               TO GDO-COD-TIEM IN GDO.
           MOVE '016'               TO GDO-COD-INEM IN GDO.
           MOVE SPACES              TO GDO-COD-SIEM IN GDO.
           MOVE SPACES              TO GDO-GLS-DISP IN GDO.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GDO.
           IF NOT FIO-STAT-OKS
               MOVE 'BGLGDONOPUT' TO VLI-COD-MENS
               MOVE 'N' TO WSS-IND-EGDO.
       FIN-PRO-GRB-GDO.
           EXIT.

       PRO-GRB-GAP SECTION.
       INI-PRO-GRB-GAP.
           MOVE SPACES              TO GAP-GLS-FLAG IN GAP.
           MOVE GDG-KEY-IGDG IN GDG TO GAP-COD-CGTA IN GAP.
           MOVE 1                   TO GAP-COD-PACR IN GAP.
           MOVE ZEROES              TO GAP-STP-ITRN IN GAP.
           MOVE 'I'                 TO GAP-MSC-TACC IN GAP.
           MOVE 'I'                 TO GAP-MSC-STAT IN GAP.
           MOVE SPACES              TO GAP-COD-OTRN IN GAP.
           MOVE SPACES              TO GAP-COD-ATRN IN GAP.
           MOVE 'S'                 TO GAP-IND-ESBA IN GAP.
           MOVE 'N'                 TO GAP-IND-ESCL IN GAP.
           MOVE 'S'                 TO GAP-IND-MASC IN GAP.
           MOVE 'BGL'               TO TAB-COD-SIST FIO-SIST.
           MOVE 'IDC '              TO TAB-COD-TTAB IN TAB.
           IF (GAP-IND-ESBA IN GAP  = 'S' AND
               GAP-CAI-GTIA IN GAP = '0800')
               MOVE 'IDCBCS'  TO TAB-COD-CTAB IN TAB
           ELSE
               MOVE 'IDCBCO'  TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           MOVE TAB-GLS-DCOR IN TAB TO WSS-IDC-ICLI IN WSS.
           MOVE WSS-NUM-ICLI IN WSS TO DBC-NUM-ICLI IN DBC.
           MOVE WSS-IND-ICLI IN WSS TO DBC-IND-ICLI IN DBC.
           MOVE WSS-GLS-ICLI IN WSS TO DBC-GLS-ICLI IN DBC.
           MOVE TAB-COD-DAT1 IN TAB(1) TO DBC-VRF-ICLI IN DBC.
           MOVE 'DBC-IDC-ICLI'   TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           MOVE DBC-CIC-ICLI IN DBC TO GAP-CIC-ICLI IN GAP.
           MOVE SPACES              TO GAP-COD-RFCA IN GAP.
           MOVE 'BANCO CREDITO INVERSIONES'  TO GAP-GLS-NOMA IN GAP.
           MOVE 'P'                 TO GAP-IND-MACR IN GAP.
           MOVE 100                 TO GAP-SGV-MACR IN GAP.
           MOVE SPACES              TO GAR-FOJ-ICR-ACR IN GAP.
           MOVE ZEROES              TO GAR-NUM-ICR-ACR IN GAP.
           MOVE ZEROES              TO GAR-ANO-ICR-ACR IN GAP.
           MOVE HOY-FHOY            TO GAP-FEC-FING IN GAP.
           MOVE 'LDCPURLO'          TO GAP-CIC-UING IN GAP.
           MOVE 'E'                 TO GAP-COD-GPRE IN GAP.
           MOVE SPACES              TO GAP-GLS-DISP IN GAP.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GAP.
           IF NOT FIO-STAT-OKS
               MOVE 'BGLGAPNOPUT' TO VLI-COD-MENS
               MOVE 'N' TO WSS-IND-EGAP.
       FIN-PRO-GRB-GAP.
           EXIT.

       PRO-GRB-GUB SECTION.
       INI-PRO-GRB-GUB.
           MOVE VLI-OPC-COD-OFIC    TO OFI-COD-OFIC IN OFI.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-OFI.

           MOVE SPACES              TO GUB-GLS-FLAG IN GUB.
           MOVE GDG-KEY-IGDG IN GDG TO GUB-CIC-GTIA IN GUB.
           MOVE ZEROES              TO GUB-STP-ITRN IN GUB.
           MOVE SPACES              TO GUB-MSC-TACC IN GUB.
           MOVE SPACES              TO GUB-MSC-STAT IN GUB.
           MOVE SPACES              TO GUB-COD-OTRN IN GUB.
           MOVE SPACES              TO GUB-COD-ATRN IN GUB.
           MOVE SPACES              TO GUB-COD-IALM IN GUB.
           MOVE ZEROES              TO GUB-FEC-FDEP IN GUB.
           MOVE SPACES              TO GUB-COD-AADN IN GUB.
           MOVE 'CUS'               TO GUB-COD-UDOC IN GUB.
           MOVE OFI-GLS-DESC IN OFI TO GUB-GLS-CLLE IN GUB.
           MOVE VLI-OPC-COD-OFIC    TO GUB-GLS-NUME IN GUB.
           MOVE SPACES              TO GUB-GLS-OTRS IN GUB.
           MOVE SPACES              TO GUB-COD-LOCU IN GUB.
           MOVE OFI-COD-COMU IN OFI TO GUB-COD-COMU IN GUB.
           MOVE SPACES              TO GUB-COD-COLO IN GUB.
           MOVE SPACES              TO GUB-COD-POST IN GUB.
           MOVE SPACES              TO GUB-COD-REGN IN GUB.
           MOVE SPACES              TO GUB-COD-AREA IN GUB.
           MOVE ZEROES              TO GUB-FEC-FING IN GUB.
           MOVE SPACES              TO GUB-CIC-UING IN GUB.
           MOVE SPACES              TO GUB-GLS-DISP IN GUB.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GUB.
           IF NOT FIO-STAT-OKS
               MOVE 'BGLGUBNOPUT' TO VLI-COD-MENS
               MOVE 'N' TO WSS-IND-EGUB.
       FIN-PRO-GRB-GUB.
           EXIT.

       PRO-VAL-ENT SECTION.
       INI-PRO-VAL-ENT.
           MOVE CIC-CIC-ICIC IN CIC TO  GDG-KEY-IGDG IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
              MOVE 'ERRORVALENT' TO VLI-COD-MENS
              GO TO FIN-PRO-VAL-ENT.

           MOVE WSS-IND-EGDD TO GDG-IND-EGDD IN GDG.
           MOVE WSS-IND-EGVT TO GDG-IND-EGVT IN GDG.
           MOVE WSS-IND-EGES TO GDG-IND-EGES IN GDG.
           MOVE WSS-IND-EGDO TO GDG-IND-EGDO IN GDG.
           MOVE WSS-IND-EGAP TO GDG-IND-EGAP IN GDG.
           MOVE WSS-IND-EGUB TO GDG-IND-EGUB IN GDG.

           MOVE FIO-MOD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
              MOVE 'ERRORVALENT' TO VLI-COD-MENS
              GO TO FIN-PRO-VAL-ENT.

       FIN-PRO-VAL-ENT.
           EXIT.

       PRO-ELI-GAR SECTION.
       INI-PRO-ELI-GAR.
           PERFORM PRO-ELI-GDG.
           PERFORM PRO-ELI-GDD.
           PERFORM PRO-ELI-GVT.
           PERFORM PRO-ELI-GES.
           PERFORM PRO-ELI-GDO.
           PERFORM PRO-ELI-GAP.
           PERFORM PRO-ELI-GUB.
       FIN-PRO-ELI-GAR.
           EXIT.

       PRO-ELI-GDG SECTION.
       INI-PRO-ELI-GDG.
           MOVE WSS-CIC-GTIA        TO  GDG-KEY-IGDG IN GDG.
           MOVE FIO-GET-KEY-UPD     TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF FIO-STAT-OKS
              MOVE FIO-DEL TO FIO-CMND
              PERFORM BGL-FIO-GDG
           ELSE
              MOVE 'ERRORELIENT' TO VLI-COD-MENS.
       FIN-PRO-ELI-GDG.
           EXIT.

       PRO-ELI-GDD SECTION.
       INI-PRO-ELI-GDD.
           MOVE DBC-CIC-ICLI IN DBC TO  GDD-CIC-DCLI IN GDD.
           MOVE WSS-CIC-GTIA        TO  GDD-KEY-AGDD IN GDD.
           MOVE FIO-GET-KEY-UPD     TO FIO-CMND.
           PERFORM BGL-FIO-GDD.
           IF FIO-STAT-OKS
               MOVE FIO-DEL TO FIO-CMND
               PERFORM BGL-FIO-GDD
           ELSE
               MOVE 'ERRORELIENT' TO VLI-COD-MENS.
       FIN-PRO-ELI-GDD.
           EXIT.

       PRO-ELI-GVT SECTION.
       INI-PRO-ELI-GVT.
           MOVE WSS-CIC-GTIA        TO  GVT-CIC-GTIA IN GVT.
           MOVE 1                   TO  GVT-COD-TASN IN GVT.
           MOVE FIO-GET-KEY-UPD     TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF FIO-STAT-OKS
              MOVE FIO-DEL TO FIO-CMND
              PERFORM BGL-FIO-GVT
           ELSE
              MOVE 'ERRORELIENT' TO VLI-COD-MENS.
       FIN-PRO-ELI-GVT.
           EXIT.

       PRO-ELI-GES SECTION.
       INI-PRO-ELI-GES.
           MOVE WSS-CIC-GTIA        TO  GES-CIC-GTIA IN GES.
           MOVE 1                   TO  GES-NUM-IGES IN GES.
           MOVE FIO-GET-KEY-UPD     TO FIO-CMND.
           PERFORM BGL-FIO-GES.
           IF FIO-STAT-OKS
              MOVE FIO-DEL TO FIO-CMND
              PERFORM BGL-FIO-GES
           ELSE
              MOVE 'ERRORELIENT' TO VLI-COD-MENS.
       FIN-PRO-ELI-GES.
           EXIT.

       PRO-ELI-GDO SECTION.
       INI-PRO-ELI-GDO.
           MOVE WSS-CIC-GTIA        TO  GDO-CIC-GTIA IN GDO.
           MOVE 1                   TO  GDO-NUM-IGDO IN GDO.
           MOVE FIO-GET-KEY-UPD     TO FIO-CMND.
           PERFORM BGL-FIO-GDO.
           IF FIO-STAT-OKS
              MOVE FIO-DEL TO FIO-CMND
              PERFORM BGL-FIO-GDO
           ELSE
              MOVE 'ERRORELIENT' TO VLI-COD-MENS.
       FIN-PRO-ELI-GDO.
           EXIT.

       PRO-ELI-GAP SECTION.
       INI-PRO-ELI-GAP.
           MOVE WSS-CIC-GTIA        TO  GAP-COD-CGTA IN GAP.
           MOVE 1                   TO  GAP-COD-PACR IN GAP.
           MOVE FIO-GET-KEY-UPD     TO FIO-CMND.
           PERFORM BGL-FIO-GAP.
           IF FIO-STAT-OKS
              MOVE FIO-DEL TO FIO-CMND
              PERFORM BGL-FIO-GAP
           ELSE
              MOVE 'ERRORELIENT' TO VLI-COD-MENS.
       FIN-PRO-ELI-GAP.
           EXIT.

       PRO-ELI-GUB SECTION.
       INI-PRO-ELI-GUB.
           MOVE WSS-CIC-GTIA        TO  GUB-CIC-GTIA IN GUB.
           MOVE FIO-GET-KEY-UPD     TO FIO-CMND.
           PERFORM BGL-FIO-GUB.
           IF FIO-STAT-OKS
              MOVE FIO-DEL TO FIO-CMND
              PERFORM BGL-FIO-GUB
           ELSE
              MOVE 'ERRORELIENT' TO VLI-COD-MENS.
       FIN-PRO-ELI-GUB.
           EXIT.

       BUS-NUM-CIC SECTION.
       INI-BUS-NUM-CIC.
           MOVE '0'        TO CIC-COD-TCIC IN CIC.
           MOVE '500'      TO CIC-COD-CCIC IN CIC.
           MOVE CIC-GET    TO CIC-CMND.
           PERFORM PRO-CIC.
       FIN-BUS-NUM-CIC.
           EXIT.

       RLO-MOD-GDG SECTION.
       INI-RLO-MOD-GDG.
           MOVE OPC-IIC-IOPC IN OPC TO GES-IIC-IOPC IN GES.             
           MOVE OPC-CAI-IOPC IN OPC TO GES-CAI-IOPC IN GES.             
           MOVE 1                   TO GES-NUM-IDLC IN GES.             
           MOVE 'GES-KEY-IOPE'      TO FIO-AKEY.                        
           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM BGL-FIO-GES.                                         
       LUP-REG-GES.                                                     
           IF (NOT FIO-STAT-OKS OR                                      
            OPC-CAI-IOPC IN OPC NOT = GES-CAI-IOPC IN GES OR            
            OPC-IIC-IOPC IN OPC NOT = GES-IIC-IOPC IN GES OR            
            GES-NUM-IDLC IN GES NOT = 1)                                
               MOVE ZEROES TO FIO-STAT
               GO TO FIN-RLO-MOD-GDG                                    
           ELSE                                                         
               MOVE GES-CAI-GTIA IN GES TO GDG-CAI-GTIA IN GDG          
               MOVE GES-IIC-GTIA IN GES TO GDG-IIC-GTIA IN GDG          
               MOVE FIO-GET-KEY  TO  FIO-CMND                           
               PERFORM BGL-FIO-GDG                                      
               IF FIO-STAT-OKS AND GDG-COD-CGTA IN GDG NOT = '952101'   
                   MOVE 'GES-KEY-IOPE' TO FIO-AKEY                      
                   MOVE FIO-GET-NXT TO FIO-CMND                         
                   PERFORM BGL-FIO-GES                                  
                   GO TO LUP-REG-GES.                                   

           PERFORM LIB-GRB-GVT.

           IF GVT-SGV-LTSN IN GVT NOT > ZEROES
               PERFORM RLO-ALZ-GDG
           ELSE
               PERFORM PRO-GRA-GMO.
       FIN-RLO-MOD-GDG.
           EXIT.

       LIB-GRB-GVT SECTION.
       INI-LIB-GRB-GVT.

      *LEE LA GVT

           MOVE GES-CAI-GTIA IN GES TO GVT-CAI-GTIA IN GVT.             
           MOVE GES-IIC-GTIA IN GES TO GVT-IIC-GTIA IN GVT.             
           MOVE 999                 TO GVT-COD-TASN IN GVT.             
           MOVE FIO-GET-LEQ TO FIO-CMND.                                
           PERFORM BGL-FIO-GVT.                                         
           IF NOT (FIO-STAT-OKS AND                                     
            GES-CAI-GTIA IN GES = GVT-CAI-GTIA IN GVT AND               
            GES-IIC-GTIA IN GES = GVT-IIC-GTIA IN GVT)                  
               MOVE ZEROES TO FIO-STAT
               GO TO FIN-LIB-GRB-GVT.                                   
           MOVE GVT-FEC-FTSN IN GVT TO ACL-FEC-FTSN IN ACL-VARI.
           MOVE GVT-SGV-VGAS IN GVT TO ACL-SGV-VGAS IN ACL-VARI.

           MOVE FRM-VAL-MLIB IN RLO-FLD TO WSS-VAL-MLIB IN WSS.
           PERFORM PRO-MON-GVT.
           COMPUTE GVT-SGV-LTSN IN GVT ROUNDED =
                         GVT-SGV-LTSN IN GVT - WSS-VAL-MLIB IN WSS.

           IF GDG-COD-VCAM IN GDG = '0999  '
               MOVE GVT-SGV-LTSN IN GVT TO PES-SGV-DECI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE TO GVT-SGV-LTSN IN GVT.

           IF GVT-SGV-LTSN IN GVT NOT > ZEROES
               GO TO FIN-LIB-GRB-GVT.                                   

      *GRABA LA GVT

           PERFORM GET-FHOY.

           MOVE GDG-KEY-IGDG IN GDG      TO GVT-CIC-GTIA IN GVT.        
           COMPUTE GVT-COD-TASN IN GVT = GVT-COD-TASN IN GVT + 1.       
           MOVE HOY-STP-ITRN             TO GVT-STP-ITRN IN GVT.        
           MOVE 'M'                      TO GVT-MSC-TACC IN GVT.        
           MOVE 'A'                      TO GVT-MSC-STAT IN GVT.        
           MOVE SPACES                   TO GVT-COD-OTRN IN GVT.        
           MOVE 'LDCPURLO'               TO GVT-COD-ATRN IN GVT.        
           MOVE WSS-FEC-FCAN IN WSS      TO GVT-FEC-FTSN IN GVT.
           MOVE GVT-SGV-LTSN IN GVT      TO GVT-SGV-VCTS IN GVT.        
           MOVE GVT-SGV-LTSN IN GVT      TO GVT-SGV-LTSN IN GVT.        
                                                                        
           PERFORM PRO-LEE-TAG.
           IF (WSS-IND-VTAG IN WSS = 'N')
               GO TO FIN-LIB-GRB-GVT.                                   

           COMPUTE GVT-SGV-VPND IN GVT = ( GVT-SGV-VCTS IN GVT *        
                    TAG-SGV-PPON IN TAG ) / 100.                        

           MOVE GVT-SGV-VCTS IN GVT      TO GVT-SGV-VGAS IN GVT.        
           MOVE GVT-SGV-VCTS IN GVT      TO GVT-SGV-VSIN IN GVT.        
           MOVE HOY-FHOY                 TO GVT-FEC-FRVL IN GVT.        
           MOVE WSS-FEC-FCAN IN WSS      TO GVT-FEC-FRVL IN GVT.
           MOVE GVT-FEC-FING IN GVT      TO GVT-FEC-FING IN GVT.        
           MOVE GVT-FEC-FURV IN GVT      TO GVT-FEC-FURV IN GVT.        
           MOVE GVT-SGV-VTTL IN GVT      TO GVT-SGV-VTTL IN GVT.        
           MOVE FIO-PUT TO FIO-CMND.                                    
           PERFORM BGL-FIO-GVT.                                         
           IF FIO-STAT-OKS                                              
               PERFORM PRO-MOD-GDG.
       FIN-LIB-GRB-GVT.
           EXIT.

      *ACTUALIZA LA GARANTIA
       RLO-ALZ-GDG SECTION.
       INI-RLO-ALZ-GDG.
           MOVE GVT-CAI-GTIA IN GVT TO GDG-CAI-GTIA IN GDG.             
           MOVE GVT-IIC-GTIA IN GVT TO GDG-IIC-GTIA IN GDG.             
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           MOVE FIO-MOD TO FIO-CMND.
           MOVE WSS-FEC-FCAN IN WSS TO GDG-FEC-FALZ IN GDG.
           MOVE '20'                TO GDG-IND-EST1 IN GDG.
           MOVE '011'               TO GDG-COD-EST1 IN GDG.
           MOVE '006'               TO GDG-COD-MALZ IN GDG.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'ERRORALZGDG' TO MSG-COD-MENS
               MOVE 'BGL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
           ELSE
               PERFORM GRA-REG-GMO.
       FIN-RLO-ALZ-GDG.
           EXIT.

      *ACTUALIZA LA GARANTIA
       RBJ-MOD-GDG SECTION.
       INI-RBJ-MOD-GDG.
           MOVE 'COL'                   TO TAB-COD-SIST FIO-SIST.
           MOVE 'DES'                   TO TAB-COD-TTAB IN TAB.
           MOVE RLO-COD-DENV IN RLO     TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
               MOVE TAB-GLS-DATA IN TAB(60:1) TO WSS-COD-CDOC.

           MOVE RLO-IIC-IOPC IN RLO-FLD TO GES-IIC-IOPC IN GES.         
           MOVE RLO-CAI-IOPC IN RLO-FLD TO GES-CAI-IOPC IN GES.         
           MOVE 1                   TO GES-NUM-IDLC IN GES.             
           MOVE 'GES-KEY-IOPE'      TO FIO-AKEY.                        
           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM BGL-FIO-GES.                                         
       LUP-REG-GES.                                                     
           IF (NOT FIO-STAT-OKS OR                                      
            RLO-CAI-IOPC IN RLO-FLD NOT = GES-CAI-IOPC IN GES OR        
            RLO-IIC-IOPC IN RLO-FLD NOT = GES-IIC-IOPC IN GES OR        
            GES-NUM-IDLC IN GES NOT = 1)                                
               MOVE ZEROES TO FIO-STAT
               GO TO FIN-RBJ-MOD-GDG                                    
           ELSE                                                         
               MOVE GES-CAI-GTIA IN GES TO GDG-CAI-GTIA IN GDG          
               MOVE GES-IIC-GTIA IN GES TO GDG-IIC-GTIA IN GDG          
               MOVE FIO-GET-KEY  TO  FIO-CMND                           
               PERFORM BGL-FIO-GDG                                      
               IF FIO-STAT-OKS AND GDG-COD-CGTA IN GDG NOT = '952101'   
                   MOVE 'GES-KEY-IOPE' TO FIO-AKEY                      
                   MOVE FIO-GET-NXT TO FIO-CMND                         
                   PERFORM BGL-FIO-GES                                  
                   GO TO LUP-REG-GES.                                   

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
      *AFRI-INI 15-SEP-2010 GARANTIAS ESTATALES
      *    MOVE FIO-MOD TO FIO-CMND.
      *    IF WSS-COD-CDOC = 'K'
      *        MOVE 'S'    TO  GDG-IND-GTAC IN GDG
      *        MOVE 'A'    TO  GDG-MSC-STAT IN GDG
      *        MOVE '10' TO    GDG-IND-EST1 IN GDG
      *    ELSE
      *        MOVE 'N'    TO  GDG-IND-GTAC IN GDG
      *        MOVE 'I'    TO  GDG-MSC-STAT IN GDG
      *        MOVE '05' TO    GDG-IND-EST1 IN GDG.
           MOVE SPACES TO MSG-COD-MENS.
           PERFORM PRO-LEE-ETG.
           IF MSG-COD-MENS > SPACES
               MOVE 'ERROTABETG' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-RBJ-MOD-GDG.
           MOVE FIO-MOD TO FIO-CMND.
      *AFRI-FIN 15-SEP-2010 GARANTIAS ESTATALES
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'ERRORACTGDG' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-RBJ-MOD-GDG.                                   
      *AFRI-INI 15-SEP-2010 GARANTIAS ESTATALES
      *    IF WSS-COD-CDOC = 'K'
           IF GDG-IND-EST1 IN GDG = '10'
      *AFRI-FIN 15-SEP-2010 GARANTIAS ESTATALES
               PERFORM PRO-CON-GVT
               PERFORM GRABA-GMO
               IF NOT FIO-STAT-OKS
                   MOVE 'ERRORACTGMO' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-RBJ-MOD-GDG.                               
       FIN-RBJ-MOD-GDG.
           EXIT.

       PRO-LEE-TAG SECTION.                                             
       INI-PRO-LEE-TAG.                                                 

           MOVE 'S' TO WSS-IND-VTAG IN WSS.

           MOVE GDG-TIP-CGTA IN GDG TO TAG-COD-TOPE IN TAG.             
           MOVE GDG-STP-CGTA IN GDG TO TAG-COD-SOPE IN TAG.             
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-TAG.                                         
           IF NOT FIO-STAT-OKS                                          
              MOVE 'N' TO WSS-IND-VTAG IN WSS.

       FIN-PRO-LEE-TAG.                                                 
           EXIT.                                                        

       PRO-LEE-LCC SECTION.                                             
       INI-PRO-LEE-LCC.                                                 
           MOVE RLO-CIC-ILIC IN RLO TO LCC-CIC-ILIC IN LCC.
           MOVE 'LCC-KEY-ILIC'      TO FIO-AKEY.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM LDC-FIO-LCC.
       FIN-PRO-LEE-LCC.                                                 
           EXIT.                                                        

       PRO-MOD-GDG SECTION.                                             
       INI-PRO-MOD-GDG.                                                 
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.                            
           PERFORM BGL-FIO-GDG.                                         
           IF NOT FIO-STAT-OKS                                          
               GO TO FIN-PRO-MOD-GDG.                                   
                                                                        
           MOVE GVT-COD-TASN IN GVT TO GDG-COD-TSCN IN GDG.             

           MOVE FIO-MOD TO FIO-CMND.                                    
           PERFORM BGL-FIO-GDG.                                         

       FIN-PRO-MOD-GDG.                                                 
           EXIT.                                                        

       PRO-CAM-CXE SECTION.
       INI-PRO-CAM-CXE.
           MOVE LCC-COD-VCOC IN LCC    TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN WSS    TO CAM-COD-VCAM IN CAM(2).
           MOVE OPC-NUM-DCOL IN OPC    TO CAM-NUM-DCAM IN CAM(1).
           MOVE OPC-NUM-MCOL IN OPC    TO CAM-NUM-MCAM IN CAM(1).
           MOVE OPC-NUM-SCOL IN OPC    TO CAM-NUM-SCAM IN CAM(1).
           MOVE OPC-NUM-ACOL IN OPC    TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT (FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
              MOVE 'TAB'        TO MSG-COD-SIST
              MOVE 'CAM    NEX' TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE FRM-SUAR-MAL TO FRM-SUAR
              GO TO FIN-PRO-CAM-CXE
           ELSE
              MULTIPLY WSS-POR-MLIB IN WSS BY CAM-SGV-VCAM IN CAM
                                             GIVING WSS-POR-MLIB IN WSS
              MOVE WSS-POR-MLIB IN WSS TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO WSS-POR-MLIB IN WSS.
       FIN-PRO-CAM-CXE.
           EXIT.

       PRO-MON-GVT SECTION.
       INI-PRO-MON-GVT.
           IF OPC-COD-VCOC IN OPC = LCC-COD-VCOC IN LCC
               GO TO FIN-PRO-MON-GVT.
           IF LCC-COD-VCOC IN LCC NOT = WSS-COD-PESO IN WSS
               MOVE LCC-COD-VCOC IN LCC    TO CAM-COD-VCAM IN CAM(1)
               MOVE WSS-COD-PESO IN WSS    TO CAM-COD-VCAM IN CAM(2)
               MOVE WSS-NUM-DCOL IN WSS    TO CAM-NUM-DCAM IN CAM(1)
               MOVE WSS-NUM-MCOL IN WSS    TO CAM-NUM-MCAM IN CAM(1)
               MOVE WSS-NUM-SCOL IN WSS    TO CAM-NUM-SCAM IN CAM(1)
               MOVE WSS-NUM-ACOL IN WSS    TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT (FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
                   MOVE 'TAB'        TO MSG-COD-SIST
                   MOVE 'CAM    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-PRO-MON-GVT
               ELSE
                   MULTIPLY WSS-VAL-MLIB IN WSS BY CAM-SGV-VCAM IN CAM
                                             GIVING WSS-VAL-MLIB IN WSS.
           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS
               GO TO CON-MON-GVT.
           MOVE OPC-COD-VCOC IN OPC    TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN WSS    TO CAM-COD-VCAM IN CAM(2).
           MOVE WSS-NUM-DCOL IN WSS    TO CAM-NUM-DCAM IN CAM(1).
           MOVE WSS-NUM-MCOL IN WSS    TO CAM-NUM-MCAM IN CAM(1).
           MOVE WSS-NUM-SCOL IN WSS    TO CAM-NUM-SCAM IN CAM(1).
           MOVE WSS-NUM-ACOL IN WSS    TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT (FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
              MOVE 'TAB'        TO MSG-COD-SIST
              MOVE 'CAM    NEX' TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE FRM-SUAR-MAL TO FRM-SUAR
              GO TO FIN-PRO-MON-GVT
           ELSE
              DIVIDE WSS-VAL-MLIB IN WSS BY CAM-SGV-VCAM IN CAM
                                             GIVING WSS-VAL-MLIB IN WSS.

       CON-MON-GVT.

           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS
              MOVE WSS-VAL-MLIB IN WSS TO PES-SGV-DECI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE TO WSS-VAL-MLIB IN WSS.

       FIN-PRO-MON-GVT.
           EXIT.

      *COLBGBDO
      *-----------------------------------------------------
       OBT-OPE-ORI SECTION.                                             
       INI-OBT-OPE-ORI.                                                 
      *OBTIENE OPC ORIGINAL

      *    LIMPIA VARIABLES
           MOVE SPACES TO BDO-CIC-ORIG IN BDO-VARI.
           MOVE SPACES TO BDO-CIC-PROR IN BDO-VARI.

      *    BUSCA OPC
           MOVE BDO-CIC-IOPC  IN BDO-VARI   TO OPC-CIC-IOPC IN OPC      
           MOVE FIO-GET-KEY TO FIO-CMND                                 
           PERFORM COL-FIO-OPC                                          
           IF NOT FIO-STAT-OKS                                          
               GO TO FIN-OBT-OPE-ORI.                                   
                                                                        
      *    OPC-IND-RENO = SPACES => OPC ORIG
           IF OPC-IND-RENO IN OPC NOT > SPACES                          
               MOVE BDO-CIC-IOPC IN BDO-VARI TO BDO-CIC-ORIG IN BDO-VARI
               GO TO FIN-OBT-OPE-ORI.                                   
                                                                        
      *    OPC-IND-RENO = 'PRO' => PRORROGA
      *    BDO-CIC-ORIG = N  OPC ORIGINAL
      *    BDO-CIC-PROR = N  OPC INFORMACION ORIGINAL
           IF OPC-IND-RENO IN OPC = 'PRO'                               
                MOVE BDO-CIC-IOPC IN BDO-VARI   TO DLC-CIC-IOPC IN DLC  
                MOVE ZEROES                     TO DLC-NUM-IDLC IN DLC  
                MOVE FIO-GET-NLS TO FIO-CMND                            
                PERFORM COL-FIO-DLC                                     
                IF FIO-STAT-OKS AND                                     
                   BDO-CIC-IOPC IN BDO-VARI = DLC-CIC-IOPC IN DLC       
                   MOVE DLC-CIC-IOCO IN DLC TO BDO-CIC-PROR IN BDO-VARI 
                   MOVE OPC-CIC-IOPC IN OPC TO BDO-CIC-ORIG IN BDO-VARI 
                   MOVE SPACES TO ROV                                   
                   MOVE  'N'                TO  BDO-1 IN BDO-VARI       
                   GO TO FIN-OBT-OPE-ORI.                               
                                                                        
           MOVE SPACES TO ROV.                                          
           MOVE SPACES TO BDO-CIC-ORIG IN BDO-VARI.                     
           MOVE SPACES TO BDO-1        IN BDO-VARI.                     
       NXT-OBT-OPE-ORI.                                                 
           MOVE BDO-CIC-IOPC IN BDO-VARI  TO ROV-CIC-IOPC IN ROV.       
           MOVE ROV-CIC-IOPC IN ROV       TO BDO-COD-OPCR IN BDO-VARI.  
       LUP-OBT-OPE-ORI.                                                 
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM COL-FIO-ROV.                                         
           IF NOT ( FIO-STAT-OKS AND                                    
                    BDO-COD-OPCR  = ROV-CIC-IOPC IN ROV )               
              GO TO FIN-OBT-OPE-ORI.                                    

           IF BDO-1 IN BDO-VARI = SPACES                                
              MOVE ROV-CIC-IOPV IN ROV TO  BDO-CIC-ORIG IN BDO-VARI     
              MOVE  'N'                TO  BDO-1 IN BDO-VARI.           

           MOVE ROV-CIC-IOPV IN ROV TO DLC-CIC-IOPC IN DLC.             
           MOVE ROV-CIC-IOPV IN ROV TO BDO-COD-OPCR IN BDO-VARI.        
           MOVE 001                 TO DLC-NUM-IDLC IN DLC.             
           MOVE FIO-GET-KEY         TO FIO-CMND.                        
           PERFORM COL-FIO-DLC.                                         
           IF NOT FIO-STAT-OKS                                          
              GO TO FIN-OBT-OPE-ORI.                                    

           MOVE ROV-CIC-IOPV IN ROV TO  BDO-CIC-ORIG IN BDO-VARI.       
           IF ( DLC-IND-SCTB IN DLC = SPACES OR 'MUL' )                 
                 MOVE ROV-CIC-IOPV IN ROV TO  BDO-CIC-ORIG IN BDO-VARI  
                 GO TO FIN-OBT-OPE-ORI                                  
           ELSE                                                         
              MOVE SPACES TO ROV                                        
              MOVE BDO-COD-OPCR TO ROV-CIC-IOPC IN ROV                  
              GO TO LUP-OBT-OPE-ORI.                                    
                                                                        
       FIN-OBT-OPE-ORI.                                                 
           EXIT.                                                        
      *-----------------------------------------------------
       OBT-OPE-ANT SECTION.                                             
       INI-OBT-OPE-ANT.                                                 
      *    LIMPIA VARIABLES
           MOVE SPACES TO BDO-CIC-ANTE IN BDO-VARI.
           MOVE SPACES TO BDO-CIC-PROR IN BDO-VARI.

      *    BUSCA OPC
           MOVE BDO-CIC-IOPC  IN BDO-VARI   TO OPC-CIC-IOPC IN OPC      
           MOVE FIO-GET-KEY TO FIO-CMND                                 
           PERFORM COL-FIO-OPC                                          
           IF NOT FIO-STAT-OKS                                          
               GO TO FIN-OBT-OPE-ANT.                                   
                                                                        
      *    OPC-IND-RENO = SPACES => OPC ANTE
           IF OPC-IND-RENO IN OPC NOT > SPACES                          
               MOVE BDO-CIC-IOPC IN BDO-VARI TO BDO-CIC-ANTE IN BDO-VARI
               GO TO FIN-OBT-OPE-ANT.                                   
                                                                        
      *    OPC-IND-RENO = 'PRO' => PRORROGA
      *    BDO-CIC-ANTE = N  OPC ANTERIOR
      *    BDO-CIC-PROR = N  OPC INFORMACION ANTERIOR
           IF OPC-IND-RENO IN OPC = 'PRO'                               
                MOVE BDO-CIC-IOPC IN BDO-VARI TO ROV-CIC-IOPC IN ROV    
                MOVE FIO-GET-NLS         TO FIO-CMND                    
                PERFORM COL-FIO-ROV                                     
                IF (NOT FIO-STAT-OKS OR                                 
                    BDO-CIC-IOPC IN BDO-VARI NOT = ROV-CIC-IOPC IN ROV) 
                    GO TO FIN-OBT-OPE-ANT                               
                ELSE
                    MOVE ROV-CIC-IOPV IN ROV TO BDO-CIC-ANTE IN BDO-VARI
                    GO TO FIN-OBT-OPE-ANT.                              

      *    => RENOVACIONES
                                                                        
           MOVE SPACES TO ROV.                                          
           MOVE SPACES TO BDO-1        IN BDO-VARI.                     
                                                                        
           MOVE BDO-CIC-IOPC IN BDO-VARI  TO ROV-CIC-IOPC IN ROV.       
           MOVE ROV-CIC-IOPC IN ROV       TO BDO-COD-OPCR IN BDO-VARI.  
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM COL-FIO-ROV.                                         
           IF NOT ( FIO-STAT-OKS AND                                    
                    BDO-COD-OPCR  = ROV-CIC-IOPC IN ROV )               
              GO TO FIN-OBT-OPE-ANT.                                    

           IF BDO-1 IN BDO-VARI = SPACES                                
              MOVE ROV-CIC-IOPV IN ROV TO  BDO-CIC-ANTE IN BDO-VARI     
              MOVE  'N'                TO  BDO-1 IN BDO-VARI.           

           MOVE ROV-CIC-IOPV IN ROV TO DLC-CIC-IOPC IN DLC.             
           MOVE ROV-CIC-IOPV IN ROV TO BDO-COD-OPCR IN BDO-VARI.        
           MOVE 001                 TO DLC-NUM-IDLC IN DLC.             
           MOVE FIO-GET-KEY         TO FIO-CMND.                        
           PERFORM COL-FIO-DLC.                                         
           IF NOT FIO-STAT-OKS                                          
              GO TO FIN-OBT-OPE-ANT.                                    

           MOVE ROV-CIC-IOPV IN ROV TO  BDO-CIC-ANTE IN BDO-VARI.       
           IF ( DLC-IND-SCTB IN DLC = SPACES OR 'MUL' )                 
                 MOVE ROV-CIC-IOPV IN ROV TO  BDO-CIC-ANTE IN BDO-VARI  
                 GO TO FIN-OBT-OPE-ANT.                                 
                                                                        
       FIN-OBT-OPE-ANT.                                                 
           EXIT.                                                        
      *-----------------------------------------------------
       OBT-SAL-OPC SECTION.                                             
       INI-OBT-SAL-OPC.                                                 

      *    INICIALIZO VARIABLES:
           MOVE ZEROES TO BDO-VAL-SCRE IN BDO-VARI.
           MOVE SPACES TO BDO-COD-ERRO IN BDO-VARI.
           MOVE SPACES TO BDO-GLS-STAT IN BDO-VARI.
           MOVE SPACES TO BDO-IND-SCTB IN BDO-VARI.
           MOVE SPACES TO BDO-CIC-IOPE IN BDO-VARI.
           MOVE SPACES TO VECTOR-OPC.

      *    BUSCO VCAM PESO
           PERFORM BUS-PESO.
           IF (BDO-COD-PESO IN BDO-VARI NOT > SPACES)                   
                MOVE 'VCAM NOEX' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.


           MOVE BDO-CIC-IOPC IN BDO-VARI TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-OPC.                                         
           IF (NOT FIO-STAT-OKS)                                        
                MOVE 'OPC  INEX' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           MOVE OPC-VAL-CRED IN OPC TO BDO-VAL-CRED IN BDO-VARI.
           MOVE OPC-IND-VSTR IN OPC TO BDO-IND-VSTR IN BDO-VARI.        
           MOVE OPC-VAL-SCRE IN OPC TO BDO-VAL-SCRE IN BDO-VARI.
           MOVE OPC-COD-VCOC IN OPC TO BDO-COD-VCOC IN BDO-VARI.
           MOVE OPC-NUM-VCOR IN OPC TO BDO-NUM-CTOT IN BDO-VARI.
           MOVE OPC-FEC-FCOL IN OPC TO BDO-FEC-FCAM IN BDO-VARI.

           IF (OPC-MSC-STAT IN OPC NOT = 'A')                           
                MOVE 'OPC NOACA' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           MOVE OPC TO OPC-RES.

           PERFORM OBT-EST-OPC.

           PERFORM BUS-SAL-OPC.

           COMPUTE BDO-VAL-SCRE IN BDO-VARI =
                   BDO-VAL-CRED IN BDO-VARI -
                   BDO-CAN-SCRE IN BDO-VARI.

           IF (BDO-VAL-SCRE IN BDO-VARI NOT > ZEROES)
                MOVE ZEROES TO BDO-VAL-SCRE IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           IF (BDO-NUM-CTOT IN BDO-VARI NOT > BDO-CAN-IVCT)
                MOVE 'CTOT<IVCT' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           IF (BDO-IND-ICTT IN BDO-VARI = 'S')
                MOVE ZEROES  TO BDO-VAL-SCRE IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           COMPUTE BDO-NUM-IVEN IN BDO-VARI =
                   BDO-CAN-IVCT IN BDO-VARI + 1.

           COMPUTE BDO-NUM-CPEN IN BDO-VARI =
                   BDO-NUM-CTOT IN BDO-VARI - BDO-CAN-IVCT IN BDO-VARI.

           MOVE BDO-CAN-IVCT IN BDO-VARI TO BDO-NUM-VPAG IN BDO-VARI.
       FIN-OBT-SAL-OPC.                                                 
           EXIT.                                                        
      *-----------------------------------------------------
       BUS-SAL-OPC SECTION.                                             
       INI-BUS-SAL-OPC.                                                 
      *BUSCA SALDO REAL DE OPC

           MOVE ZEROES       TO BDO-NUM-IVEN IN BDO-VARI.
           MOVE ZEROES       TO BDO-CAN-SCRE IN BDO-VARI.
           MOVE ZEROES       TO BDO-VAL-CAPI IN BDO-VARI.
           MOVE SPACES       TO BDO-IND-ICTT IN BDO-VARI.
           MOVE ZEROES       TO BDO-NUM-IVEN IN BDO-VARI.

      *COMIENZA EL PROCESO
           MOVE BDO-CIC-IOPC IN BDO-VARI TO CAN-CIC-IOPC IN CAN.        
           MOVE ZEROES                   TO CAN-NUM-ICAN IN CAN.        
           MOVE FIO-GET-NLS              TO FIO-CMND.                   
       LUP-SAL-OPC.                                                     
           PERFORM COL-FIO-CAN.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               BDO-CIC-IOPC IN BDO-VARI NOT = CAN-CIC-IOPC IN CAN)      
                GO TO FIN-BUS-SAL-OPC
           ELSE
                MOVE ADR-CAN-REQA TO ADR-BDO-REQA.                      

           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO NXT-SAL-OPC.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                GO TO NXT-SAL-OPC.

           IF CAN-FEC-FCAN IN CAN > BDO-FEC-FPRO IN BDO-VARI
                GO TO FIN-BUS-SAL-OPC.

      *    VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                PERFORM BUS-CAPI
                ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-CAN-SCRE IN BDO-VARI
                MOVE 'S' TO BDO-IND-ICTT IN BDO-VARI
                GO TO FIN-BUS-SAL-OPC.

      *    VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                PERFORM BUS-CAPI
                ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-CAN-SCRE IN BDO-VARI
                GO TO NXT-SAL-OPC.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                PERFORM BUS-CAPI
                ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-CAN-SCRE IN BDO-VARI
                COMPUTE BDO-CAN-IVCT IN BDO-VARI =
                        BDO-CAN-IVCT IN BDO-VARI - 1
                GO TO NXT-SAL-OPC.

      *    VALIDO TIPO DE CANCELACION: PRORROGA
           IF (CAN-MSC-CANC IN CAN = 'PTT' OR 'KTT')                    
                PERFORM BUS-CAPI
                MOVE BDO-VAL-CAPI IN BDO-VARI TO
                     BDO-VAL-CRED IN BDO-VARI
                PERFORM BUS-SAL-PTT
                GO TO FIN-BUS-SAL-OPC.

      *    VALIDA SI CANCELACION ES PRODUCTO DE TRASPASO
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.             
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.             
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.             
           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-CYA.                                         
                                                                        
      *    SIN CYA => CAN NO TRASPASO
           IF NOT (FIO-STAT-OKS AND                                     
               CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND            
               CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA)               
                PERFORM BUS-CAPI
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    MOVE BDO-VAL-CAPI IN BDO-VARI TO
                    BDO-VAL-CRED IN BDO-VARI
                    PERFORM BUS-SAL-PTT
                    GO TO FIN-BUS-SAL-OPC
               ELSE
                    ADD BDO-VAL-CAPI IN BDO-VARI TO
                        BDO-CAN-SCRE IN BDO-VARI
                    GO TO NXT-SAL-OPC.                                  
                                                                        

      *--------- PRODUCTO TRASPASO ---------                            
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.        
                                                                        
      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND                 
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')                    
                ADD 1 TO BDO-NUM-VPAG IN BDO-VARI
                ADD 1 TO BDO-CAN-IVCT IN BDO-VARI
                PERFORM BUS-CAPI
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    MOVE BDO-VAL-CAPI IN BDO-VARI TO
                    BDO-VAL-CRED IN BDO-VARI
                    PERFORM BUS-SAL-PTT
                    GO TO FIN-BUS-SAL-OPC
               ELSE
                    ADD BDO-VAL-CAPI IN BDO-VARI TO
                        BDO-CAN-SCRE IN BDO-VARI
                    GO TO NXT-SAL-OPC.                                  

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR                      
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')                        
                ADD 1 TO BDO-NUM-CTRS IN BDO-VARI
                PERFORM BUS-NEW-CAN
      *         NUEVA OPERACION IMPAGA
                IF (BDO-IND-CANC IN BDO-VARI NOT = 'S')
                     ADD BDO-ACU-CAPI IN BDO-VARI TO
                         BDO-CAN-SCRE IN BDO-VARI
                     GO TO FIN-BUS-SAL-OPC                              
      *         NUEVA OPERACION CANCELADA
                ELSE
                     MOVE BDO-RES-IVCT TO BDO-CAN-IVCT IN BDO-VARI
                     ADD BDO-RES-CAPI IN BDO-VARI TO
                         BDO-CAN-SCRE IN BDO-VARI
                     GO TO NXT-SAL-OPC.                                 

       NXT-SAL-OPC.                                                     
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           MOVE ADR-BDO-REQA TO ADR-CAN-REQA.                           
           MOVE FIO-KDEF-S TO FIO-KDEF.                                 
           GO TO LUP-SAL-OPC.

       FIN-BUS-SAL-OPC.                                                 
           EXIT.                                                        
      *-----------------------------------------------------
       BUS-CAPI SECTION.                                                
       INI-BUS-CAPI.                                                    

           MOVE ZEROES              TO BDO-VAL-CAPI IN BDO-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.             
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.             
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.             
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.             
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM COL-FIO-RCV.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR         
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)           
               ADD ZEROES           TO BDO-VAL-CAPI IN BDO-VARI
               GO TO FIN-BUS-CAPI
           ELSE
               ADD  RCV-SGV-CAPI IN RCV TO BDO-VAL-CAPI IN BDO-VARI
               MOVE RCV-NUM-IVCT IN RCV TO BDO-CAN-IVCT IN BDO-VARI
               GO TO FIN-BUS-CAPI.
                                                                        
       FIN-BUS-CAPI.                                                    
           EXIT.                                                        
      *-----------------------------------------------------
       BUS-NEW-CAN SECTION.                                             
       INI-BUS-NEW-CAN.                                                 

           MOVE 'N'    TO BDO-IND-CANC IN BDO-VARI.
           MOVE ZEROES TO BDO-ACU-INTN IN BDO-VARI.
           MOVE ZEROES TO BDO-ACU-CAPI IN BDO-VARI.

           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.             
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.             
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.             
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.             
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM COL-FIO-RCV.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR         
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)           
                 GO TO FIN-BUS-NEW-CAN.                                 
           MOVE RCV-SGV-CAPI IN RCV TO BDO-RES-CAPI IN BDO-VARI.
           MOVE RCV-SGV-INTM IN RCV TO BDO-RES-INTM IN BDO-VARI.
           MOVE RCV-NUM-IVCT IN RCV TO BDO-RES-IVCT IN BDO-VARI.

           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                 GO TO FIN-BUS-NEW-CAN.                                 

      *    CAMBIA INTERESES NORMALES A MONEDA OPERACION
           MOVE RCV-SGV-INTN IN RCV TO BDO-INI-INTN IN BDO-VARI.
           PERFORM  CAL-CAM-INTN.
           MOVE BDO-CAM-INTN  TO BDO-RES-INTN IN BDO-VARI.
           MOVE BDO-CAM-INTN  TO BDO-VAL-SINT IN BDO-VARI.

       LUP-NEW-CAN.
      *--------- BUSCA NUEVA OPERACION -----                            
           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPC IN ROV.        

           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV         
                MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV         
                MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.

           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-ROV.                                         
                                                                        
           IF (NOT FIO-STAT-OKS OR                                      
               (CAN-MSC-TCAN IN CAN = 'P' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPC IN ROV) OR       
               (CAN-MSC-TCAN IN CAN = 'R' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPV IN ROV))         
                 GO TO FIN-BUS-NEW-CAN.                                 


           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE ROV-CIC-IOPC IN ROV TO RES-CIC-IOPC IN OPC-RES     
                MOVE ROV-CIC-IOPC IN ROV TO RCV-CIC-IOPV IN RCV.        

           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE ROV-CIC-IOPV IN ROV TO RES-CIC-IOPC IN OPC-RES     
                MOVE ROV-CIC-IOPV IN ROV TO RCV-CIC-IOPV IN RCV.        

       LUP-OPC.                                                         
           MOVE RES-CIC-IOPC IN OPC-RES TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-OPC.                                         

           IF NOT FIO-STAT-OKS                                          
               GO TO FIN-BUS-NEW-CAN.                                   

           IF (OPC-MSC-STAT IN OPC NOT = 'A')                           
               GO TO FIN-BUS-NEW-CAN.                                   

           PERFORM OBT-EST-OPC.

           MOVE OPC-CIC-IOPC IN OPC TO CAN-CIC-IOPC IN CAN.             
           MOVE ZEROES              TO CAN-NUM-ICAN IN CAN.             
           MOVE FIO-GET-NLS TO FIO-CMND.                                
       LUP-CAN-TRV.
           PERFORM COL-FIO-CAN.                                         
           IF (NOT FIO-STAT-OKS  OR                                     
               OPC-CIC-IOPC IN OPC NOT = CAN-CIC-IOPC IN CAN)           
                GO TO FIN-BUS-NEW-CAN.

           IF CAN-FEC-FCAN IN CAN > BDO-FEC-FPRO IN BDO-VARI
                GO TO FIN-BUS-NEW-CAN.

      *   VALIDO CANCELACION ACTIVA
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                MOVE FIO-GET-NXT TO FIO-CMND                            
                GO TO LUP-CAN-TRV.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                MOVE FIO-GET-NXT TO FIO-CMND                            
                GO TO LUP-CAN-TRV.

      *   VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                MOVE 'S' TO BDO-IND-CANC IN BDO-VARI
                GO TO FIN-BUS-NEW-CAN.                                  

      *   VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                MOVE 'S' TO BDO-IND-CANC IN BDO-VARI
                GO TO FIN-BUS-NEW-CAN.                                  

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                PERFORM BUS-CAPI-TRV
                COMPUTE BDO-NUM-IVCT IN BDO-VARI =
                        BDO-RES-IVCT IN BDO-VARI - 1
                MOVE FIO-GET-NXT TO FIO-CMND                            
                GO TO LUP-CAN-TRV.

           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.             
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.             
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.             
           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-CYA.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               CAN-CIC-IOPC IN CAN NOT = CYA-CIC-IOPC IN CYA OR         
               CAN-NUM-ICAN IN CAN NOT = CYA-NUM-ICAN IN CYA)           
                GO TO INI-BUS-NEW-CAN.                                  
                                                                        
                                                                        
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.        
                                                                        
      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND                 
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')                    
                GO TO LUP-NEW-CAN.

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR                      
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')                        
                GO TO LUP-NEW-CAN.

       FIN-BUS-NEW-CAN.                                                 
           EXIT.                                                        
      *-----------------------------------------------------
       BUS-CAPI-TRV SECTION.
       INI-BUS-BUS-CAPI-TRV.

           MOVE ZEROES              TO BDO-CAN-INTN IN BDO-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)
                GO TO FIN-BUS-CAPI-TRV.

           IF (RCV-SGV-CAPI IN RCV NOT > ZEROES)
                GO TO FIN-BUS-CAPI-TRV.

           IF BDO-COD-VCOC = OPC-COD-VCOC IN OPC
               MOVE RCV-SGV-CAPI IN RCV TO BDO-SGV-CAPI IN BDO-VARI
           ELSE
               PERFORM CAL-CAM-CAPI.

           IF (BDO-VAL-SINT IN BDO-VARI = BDO-SGV-CAPI IN BDO-VARI)
               MOVE BDO-SGV-CAPI IN BDO-VARI TO BDO-ACU-INTN IN BDO-VARI
               MOVE BDO-SGV-CAPI IN BDO-VARI TO BDO-CAN-INTN IN BDO-VARI
                GO TO VAL-SINT.

           IF (BDO-VAL-SINT IN BDO-VARI < BDO-SGV-CAPI IN BDO-VARI)
               MOVE BDO-RES-INTN IN BDO-VARI TO BDO-ACU-INTN IN BDO-VARI
               MOVE BDO-RES-INTN IN BDO-VARI TO BDO-CAN-INTN IN BDO-VARI
               GO TO VAL-SINT.

           IF (BDO-VAL-SINT IN BDO-VARI > BDO-SGV-CAPI IN BDO-VARI)
                ADD BDO-SGV-CAPI IN BDO-VARI TO BDO-ACU-INTN IN BDO-VARI
               MOVE BDO-SGV-CAPI IN BDO-VARI TO BDO-CAN-INTN IN BDO-VARI
                GO TO VAL-SINT.

       VAL-SINT.

           IF   BDO-VAL-SINT IN BDO-VARI NOT > ZEROES
                 MOVE ZEROES TO BDO-CAN-INTN IN BDO-VARI.

           COMPUTE BDO-VAL-SINT IN BDO-VARI =
                  (BDO-RES-INTN IN BDO-VARI -
                   BDO-ACU-INTN IN BDO-VARI).

           IF   BDO-VAL-SINT IN BDO-VARI NOT > ZEROES
                 MOVE ZEROES TO BDO-VAL-SINT IN BDO-VARI.

       VAL-CAPI.
           COMPUTE BDO-ACU-CAPI IN BDO-VARI =
                   BDO-ACU-CAPI IN BDO-VARI +
                  (BDO-SGV-CAPI IN BDO-VARI  -
                   BDO-CAN-INTN IN BDO-VARI).

       FIN-BUS-CAPI-TRV.
           EXIT.
      *-----------------------------------------------------
       CAL-CAM-INTN SECTION.                                            
       INI-CAL-CAM-INTN.                                                
                                                                        
           IF (BDO-COD-VCOC IN BDO-VARI = BDO-COD-PESO IN BDO-VARI)     
                MOVE BDO-INI-INTN IN BDO-VARI TO BDO-CAM-INTN           
                GO TO FIN-CAL-CAM-INTN.                                 
                                                                        
           MOVE BDO-COD-VCOC IN BDO-VARI TO CAM-COD-VCAM IN CAM(1).     
           MOVE BDO-COD-PESO IN BDO-VARI TO CAM-COD-VCAM IN CAM(2).     
           MOVE BDO-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(1).     
           MOVE BDO-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(2).     
                                                                        
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM TAB-FIO-CAM.                                         
           IF (NOT FIO-STAT-OKS OR CAM-IND-VIGE IN CAM NOT = 'S' )      
                MOVE ZEROES              TO BDO-CAM-INTN IN BDO-VARI    
                GO TO FIN-CAL-CAM-INTN.                                 
                                                                        
           COMPUTE  BDO-CAM-INTN IN BDO-VARI ROUNDED =                  
                    BDO-INI-INTN IN BDO-VARI /                          
                    CAM-SGV-VCAM IN CAM.                                

       FIN-CAL-CAM-INTN.                                                
           EXIT.                                                        
      *-----------------------------------------------------
       BUS-CAM-OPC SECTION.                                             
       INI-BUS-CAM-OPC.                                                 
                                                                        
           IF (BDO-COD-VCOC IN BDO-VARI = BDO-COD-PESO IN BDO-VARI)     
                MOVE BDO-VAL-SCRE IN BDO-VARI TO BDO-CAM-SCRE           
                GO TO FIN-BUS-CAM-OPC.                                  
                                                                        
           MOVE BDO-COD-VCOC IN BDO-VARI TO CAM-COD-VCAM IN CAM(1).     
           MOVE BDO-COD-PESO IN BDO-VARI TO CAM-COD-VCAM IN CAM(2).     
           MOVE BDO-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(1).     
           MOVE BDO-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(2).     
                                                                        
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM TAB-FIO-CAM.                                         
           IF (NOT FIO-STAT-OKS OR CAM-IND-VIGE IN CAM NOT = 'S' )      
                MOVE ZEROES TO       BDO-CAM-SCRE                       
                GO TO FIN-BUS-CAM-OPC.                                  
                                                                        
           COMPUTE  BDO-CAM-SCRE IN BDO-VARI ROUNDED =                  
                    BDO-VAL-SCRE IN BDO-VARI /                          
                    CAM-SGV-VCAM IN CAM.                                
                                                                        
       FIN-BUS-CAM-OPC.                                                 
           EXIT.                                                        
      *-----------------------------------------------------
       BUS-PESO SECTION.                                                
       INI-BUS-PESO.                                                    
      *OBTIENE CODIGO VALOR DE CAMBIO DE PESOS                          
                                                                        
           MOVE SPACES         TO BDO-COD-PESO IN BDO-VARI.             
           MOVE 'TAB'          TO FIO-SIST.                             
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.                  
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.                  
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.                             
           MOVE FIO-GET-KEY    TO FIO-CMND.                             
           PERFORM GNS-FIO-TAB.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'TAB'          TO MSG-COD-SIST                      
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS.                     
           MOVE TAB-COD-CTAB IN TAB TO BDO-COD-PESO IN BDO-VARI.        
                                                                        
       FIN-BUS-PESO.                                                    
           EXIT.                                                        
      *-----------------------------------------------------
       BUS-SAL-PTT SECTION.                                             
       INI-BUS-SAL-PTT.                                                 
      *BUSCA SALDO REAL DE OPC (PTT)

           MOVE ZEROES       TO BDO-NUM-IVEN IN BDO-VARI.
           MOVE ZEROES       TO BDO-CAN-SCRE IN BDO-VARI.
           MOVE ZEROES       TO BDO-VAL-CAPI IN BDO-VARI.
           MOVE SPACES       TO BDO-IND-ICTT IN BDO-VARI.
           MOVE ZEROES       TO BDO-NUM-IVEN IN BDO-VARI.

      *    BUSCA NUEVA OPERACION
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.             
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.             
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-KEY         TO FIO-CMND.                        
           PERFORM COL-FIO-ROV.                                         
           IF (NOT FIO-STAT-OKS)                                        
                 GO TO FIN-BUS-SAL-PTT.                                 

           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-OPC.                                         
           IF (NOT FIO-STAT-OKS)                                        
                MOVE 'PTT  INEX' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-BUS-SAL-PTT.

           MOVE OPC-IND-VSTR IN OPC TO BDO-IND-VSTR IN BDO-VARI.        
           MOVE OPC-COD-VCOC IN OPC TO BDO-COD-VCOC IN BDO-VARI.
           MOVE OPC-COD-VCOC IN OPC TO BDO-NUM-CTOT IN BDO-VARI.
           MOVE OPC-FEC-FCOL IN OPC TO BDO-FEC-FCAM IN BDO-VARI.

           IF (OPC-MSC-STAT IN OPC NOT = 'A')                           
                MOVE 'PTT NOACA' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-BUS-SAL-PTT.

           MOVE OPC TO OPC-RES.
           PERFORM OBT-EST-OPC.

      *---------------------------
      *    PERFORM BUS-SAL-OPC.
      *---------------------------

      *COMIENZA EL PROCESO
           MOVE OPC-CIC-IOPC IN OPC      TO CAN-CIC-IOPC IN CAN.        
           MOVE ZEROES                   TO CAN-NUM-ICAN IN CAN.        
           MOVE FIO-GET-NLS              TO FIO-CMND.                   
       LUP-SAL-PTT.                                                     
           PERFORM COL-FIO-CAN.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               OPC-CIC-IOPC IN OPC NOT = CAN-CIC-IOPC IN CAN)           
                GO TO FIN-BUS-SAL-PTT
           ELSE
                MOVE ADR-CAN-REQA TO ADR-PTT-REQA.                      

           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO NXT-SAL-PTT.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                GO TO NXT-SAL-PTT.

           IF CAN-FEC-FCAN IN CAN > BDO-FEC-FPRO IN BDO-VARI
                GO TO FIN-BUS-SAL-PTT.

      *    VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                PERFORM BUS-CAPI
                ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-CAN-SCRE IN BDO-VARI
                MOVE 'S' TO BDO-IND-ICTT IN BDO-VARI
                GO TO FIN-BUS-SAL-PTT.

      *    VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                PERFORM BUS-CAPI
                ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-CAN-SCRE IN BDO-VARI
                GO TO NXT-SAL-PTT.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                PERFORM BUS-CAPI
                ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-CAN-SCRE IN BDO-VARI
                COMPUTE BDO-CAN-IVCT IN BDO-VARI =
                        BDO-CAN-IVCT IN BDO-VARI - 1
                GO TO NXT-SAL-PTT.

      *    VALIDO TIPO DE CANCELACION: PRORROGA
           IF (CAN-MSC-CANC IN CAN = 'PTT' OR 'KTT')                    
                GO TO INI-BUS-SAL-PTT.

      *    VALIDA SI CANCELACION ES PRODUCTO DE TRASPASO
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.             
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.             
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.             
           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-CYA.                                         
                                                                        
      *    SIN CYA => CAN NO TRASPASO
           IF (NOT FIO-STAT-OKS OR                                      
               CAN-CIC-IOPC IN CAN NOT = CYA-CIC-IOPC IN CYA OR         
               CAN-NUM-ICAN IN CAN NOT = CYA-NUM-ICAN IN CYA)           
                PERFORM BUS-CAPI
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    GO TO INI-BUS-SAL-PTT
               ELSE
                    ADD BDO-VAL-CAPI IN BDO-VARI TO
                        BDO-CAN-SCRE IN BDO-VARI
                GO TO NXT-SAL-PTT.                                      
                                                                        

      *--------- PRODUCTO TRASPASO ---------                            
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.        
                                                                        
      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND                 
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')                    
                ADD 1 TO BDO-CAN-IVCT IN BDO-VARI
                PERFORM BUS-CAPI
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    GO TO INI-BUS-SAL-PTT
               ELSE
                    ADD BDO-VAL-CAPI IN BDO-VARI TO
                        BDO-CAN-SCRE IN BDO-VARI
                GO TO NXT-SAL-PTT.                                      

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR                      
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')                        
                ADD 1 TO BDO-NUM-CTRS IN BDO-VARI
                PERFORM BUS-NEW-CAN
      *         NUEVA OPERACION IMPAGA
                IF (BDO-IND-CANC IN BDO-VARI NOT = 'S')
                     ADD BDO-ACU-CAPI IN BDO-VARI TO
                         BDO-CAN-SCRE IN BDO-VARI
                     GO TO FIN-BUS-SAL-PTT                              
      *         NUEVA OPERACION CANCELADA
                ELSE
                     MOVE BDO-RES-IVCT TO BDO-CAN-IVCT IN BDO-VARI
                     ADD BDO-RES-CAPI IN BDO-VARI TO
                         BDO-CAN-SCRE IN BDO-VARI
                     GO TO NXT-SAL-PTT.                                 

       NXT-SAL-PTT.                                                     
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           MOVE ADR-PTT-REQA TO ADR-CAN-REQA.                           
           MOVE FIO-KDEF-S TO FIO-KDEF.                                 
           GO TO LUP-SAL-PTT.

       FIN-BUS-SAL-PTT.                                                 
           EXIT.                                                        
      *-----------------------------------------------------
       CAL-CAM-CAPI SECTION.                                            
       INI-CAL-CAM-CAPI.                                                
                                                                        
           MOVE ZEROES TO  BDO-SGV-CAPI IN BDO-VARI.

           IF (BDO-COD-VCOC IN BDO-VARI = BDO-COD-PESO IN BDO-VARI)     
               MOVE RCV-SGV-CAPI IN RCV TO BDO-SGV-CAPI IN BDO-VARI
                GO TO FIN-CAL-CAM-CAPI.                                 
                                                                        
           MOVE BDO-COD-VCOC IN BDO-VARI TO CAM-COD-VCAM IN CAM(1).     
           MOVE BDO-COD-PESO IN BDO-VARI TO CAM-COD-VCAM IN CAM(2).     
           MOVE BDO-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(1).     
           MOVE BDO-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(2).     
                                                                        
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM TAB-FIO-CAM.                                         
           IF (NOT FIO-STAT-OKS OR CAM-IND-VIGE IN CAM NOT = 'S' )      
                MOVE ZEROES              TO BDO-SGV-CAPI IN BDO-VARI    
                GO TO FIN-CAL-CAM-CAPI.                                 
                                                                        
           COMPUTE  BDO-SGV-CAPI IN BDO-VARI ROUNDED =                  
                    RCV-SGV-CAPI IN RCV /                               
                    CAM-SGV-VCAM IN CAM.                                
                                                                        
       FIN-CAL-CAM-CAPI.                                                
           EXIT.                                                        
      *-----------------------------------------------------
       GRB-VOPC SECTION.                                                
       INI-GRB-VOPC.                                                    
                                                                        
           MOVE 'N'    TO BDO-IND-BUSQ.                                 
           SET BDO-NUM-VOPC TO 1.                                       
       LUP-GRB-VOPC.                                                    
           IF (BDO-NUM-VOPC > 200)
                GO TO FIN-GRB-VOPC.
                                                                        
           IF (VOPC-CIC-IOPC(BDO-NUM-VOPC) NOT > SPACES )               
                MOVE 'S'    TO BDO-IND-BUSQ                             
                MOVE BDO-CIC-IOPE IN BDO-VARI TO                        
                     VOPC-CIC-IOPC(BDO-NUM-VOPC)                        
                MOVE BDO-NUM-ICAN IN BDO-VARI TO                        
                     VOPC-NUM-ICAN(BDO-NUM-VOPC)                        
                MOVE BDO-NUM-IVEN IN BDO-VARI TO                        
                     VOPC-NUM-IVEN(BDO-NUM-VOPC)                        
                MOVE BDO-RCV-CAPI IN BDO-VARI TO                        
                     VOPC-SGV-CAPI(BDO-NUM-VOPC)                        
                GO TO FIN-GRB-VOPC                                      
           ELSE                                                         
                SET BDO-NUM-VOPC UP BY 1                                
                GO TO LUP-GRB-VOPC.                                     
                                                                        
       FIN-GRB-VOPC.                                                    
           EXIT.                                                        
      *-------------------------------------------------------------
      *-------------------------------------------------------------
       BUS-VOPC SECTION.                                                
       INI-BUS-VOPC.                                                    
                                                                        
           MOVE 'N'    TO BDO-IND-BUSQ.                                 
           SET BDO-NUM-VOPC TO 1.                                       
                                                                        
       LUP-BUS-VOPC.                                                    
           IF (BDO-NUM-VOPC > 200)
                GO TO FIN-BUS-VOPC.                                     
                                                                        
           IF (VOPC-CIC-IOPC(BDO-NUM-VOPC) NOT > SPACES )               
                GO TO FIN-BUS-VOPC.                                     
                                                                        
           IF (VOPC-CIC-IOPC(BDO-NUM-VOPC) = OPC-CIC-IOPC IN OPC)       
                MOVE 'S'    TO BDO-IND-BUSQ                             
                GO TO FIN-BUS-VOPC                                      
           ELSE                                                         
                SET BDO-NUM-VOPC UP BY 1                                
                GO TO LUP-BUS-VOPC.                                     
                                                                        
       FIN-BUS-VOPC.                                                    
           EXIT.                                                        
      *-------------------------------------------------------------
      *-------------------------------------------------------------
       LIM-VOPC SECTION.                                                
       INI-LIM-VOPC.                                                    
                                                                        
           SET BDO-NUM-VOPC TO 1.                                       
       LUP-LIM-VOPC.                                                    
           IF (BDO-NUM-VOPC NOT > 200)
                MOVE SPACES TO VOPC-CIC-IOPC(BDO-NUM-VOPC)              
                SET BDO-NUM-VOPC UP BY 1                                
                GO TO LUP-LIM-VOPC.                                     
                                                                        
           IF (BDO-NUM-VOPC > 200)
                SET BDO-NUM-VOPC TO 1                                   
                GO TO FIN-LIM-VOPC.                                     
                                                                        
       FIN-LIM-VOPC.                                                    
           EXIT.                                                        
      *-------------------------------------------------------------
      *-------------------------------------------------------------
       BUS-VAL-MORP SECTION.                                            
       INI-BUS-VAL-MORP.                                                
                                                                        
           MOVE ZEROES  TO BDO-VAL-MORP.

           IF BDO-FEC-FVEN NOT < BDO-FEC-FPRO
               MOVE 'S'                TO BDO-IND-ERRO
               GO TO FIN-BUS-VAL-MORP.                                  

           MOVE SPACES                   TO BDO-IND-ERRO.
           MOVE BDO-CIC-IOPC             TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY              TO FIO-CMND.                   
           PERFORM COL-FIO-OPC.                                         
           IF (NOT FIO-STAT-OKS)                                        
                GO TO FIN-BUS-VAL-MORP.

           MOVE OPC-CIC-IOPC IN OPC      TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-NLS              TO FIO-CMND.

           IF OPC-IND-VSTR IN OPC = 'S'                                 
               MOVE 1             TO VEN-NUM-IVEN IN VEN
           ELSE
               MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN.

       LUP-BUS-VAL-MORP.                                                
           PERFORM COL-FIO-VEN                                          
           IF NOT ( FIO-STAT-OKS  AND                                   
              BDO-CIC-IOPC        =  VEN-CIC-IOPC )
                   GO TO FIN-BUS-VAL-MORP.                              

           IF VEN-FEC-FVEN IN VEN NOT < BDO-FEC-FPRO
               MOVE 'S'                TO BDO-IND-ERRO
               GO TO FIN-BUS-VAL-MORP.                                  

           IF VEN-VAL-SFIN IN VEN NOT > ZEROES
               GO TO NXT-BUS-VAL-MORP.                                  

           IF VEN-FEC-FVEN IN VEN NOT < BDO-FEC-FVEN        AND
              VEN-FEC-FVEN IN VEN < BDO-FEC-FPRO
               ADD VEN-VAL-SCAP IN VEN TO BDO-VAL-MORP.

       NXT-BUS-VAL-MORP.                                                
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           GO TO LUP-BUS-VAL-MORP.                                      
       FIN-BUS-VAL-MORP.                                                
           EXIT.                                                        
      *-------------------------------------------------------------
       BUS-FEC-RCV SECTION.                                             
       INI-BUS-FEC-RCV.                                                 

           MOVE ZEROES TO BDO-VAL-CCIE.

           MOVE SPACES                   TO BDO-IND-ERRO.
           MOVE BDO-CIC-IOPC             TO RCV-CIC-IOPV IN RCV.
           MOVE BDO-NUM-IVEN IN BDO-VARI TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-BUS-FEC-RCV.                                                 
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           PERFORM COL-FIO-RCV.
           IF NOT ( FIO-STAT-OKS   AND                                  
               BDO-CIC-IOPC             = RCV-CIC-IOPV IN RCV )
                ADD ZEROES              TO BDO-VAL-MORP
                GO TO VAL-RCV-TOT.                                      

           IF(RCV-NUM-IVCT IN RCV NOT > ZEROES)
                GO TO VAL-RCV-TOT.                                      

           MOVE RCV-CIC-IOPC IN RCV TO CAN-CIC-IOPC IN CAN.             
           MOVE RCV-NUM-ICAN IN RCV TO CAN-NUM-ICAN IN CAN.             
           MOVE FIO-GET-KEY         TO FIO-CMND.                        
           PERFORM COL-FIO-CAN.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               RCV-CIC-IOPC IN RCV NOT = CAN-CIC-IOPC IN CAN OR         
               RCV-NUM-ICAN IN RCV NOT = CAN-NUM-ICAN IN CAN)           
                GO TO NXT-BUS-FEC-RCV.                                  

           IF (CAN-MSC-CANC IN CAN = 'CIE')
                ADD RCV-SGV-CAPI IN RCV TO BDO-VAL-CCIE
                GO TO NXT-BUS-FEC-RCV.                                  

      *    BUSCA NUEVA OPERACION
           MOVE RCV-CIC-IOPC IN RCV TO ROV-CIC-IOPV IN ROV.             
           MOVE RCV-NUM-ICAN IN RCV TO ROV-NUM-IVCT IN ROV.             
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-ROV.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               RCV-CIC-IOPC IN RCV NOT = ROV-CIC-IOPV IN ROV OR         
               RCV-NUM-ICAN IN RCV NOT = ROV-NUM-IVCT IN ROV)           
                ADD ZEROES              TO BDO-VAL-MORP
                GO TO NXT-BUS-FEC-RCV.                                  

           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-OPC.                                         
           IF (NOT FIO-STAT-OKS)                                        
                ADD ZEROES              TO BDO-VAL-MORP
                GO TO NXT-BUS-FEC-RCV.                                  

           IF OPC-FEC-FCOL IN OPC NOT < BDO-FEC-FPRO
                ADD ZEROES              TO BDO-VAL-MORP
                MOVE 'S'                TO BDO-IND-ERRO
                GO TO FIN-BUS-FEC-RCV.                                  

           IF OPC-FEC-FCOL IN OPC NOT < BDO-FEC-FVEN        AND
              OPC-FEC-FCOL IN OPC < BDO-FEC-FPRO
               ADD RCV-SGV-CAPI IN RCV TO BDO-VAL-MORP.

           GO TO NXT-BUS-FEC-RCV.                                       
       VAL-RCV-TOT.
           MOVE SPACES                   TO BDO-IND-ERRO.
           MOVE BDO-CIC-IOPC             TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES                   TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           PERFORM COL-FIO-RCV.
           IF  NOT( FIO-STAT-OKS   AND                                  
               BDO-CIC-IOPC             = RCV-CIC-IOPV IN RCV AND
               ZEROES                   =  RCV-NUM-IVCT IN RCV )
                GO TO FIN-BUS-FEC-RCV.                                  

      *    BUSCA NUEVA OPERACION
           MOVE RCV-CIC-IOPC IN RCV TO ROV-CIC-IOPV IN ROV.             
           MOVE RCV-NUM-ICAN IN RCV TO ROV-NUM-IVCT IN ROV.             
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-ROV.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               RCV-CIC-IOPC IN RCV NOT = ROV-CIC-IOPV IN ROV OR         
               RCV-NUM-ICAN IN RCV NOT = ROV-NUM-IVCT IN ROV)           
                GO TO FIN-BUS-FEC-RCV.                                  

           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-OPC.                                         
           IF (NOT FIO-STAT-OKS)                                        
                ADD ZEROES              TO BDO-VAL-MORP
                GO TO FIN-BUS-FEC-RCV.                                  

           IF OPC-FEC-FCOL IN OPC NOT < BDO-FEC-FPRO
               ADD ZEROES              TO BDO-VAL-MORP
               MOVE 'S'                TO BDO-IND-ERRO
               GO TO FIN-BUS-FEC-RCV.                                   

           IF OPC-FEC-FCOL IN OPC > BDO-FEC-FPRO
               ADD RCV-SGV-CAPI IN RCV TO BDO-VAL-MORP
               GO TO FIN-BUS-FEC-RCV.                                   

           MOVE RCV-CIC-IOPC IN RCV TO CAN-CIC-IOPC IN CAN.             
           MOVE RCV-NUM-ICAN IN RCV TO CAN-NUM-ICAN IN CAN.             
           MOVE FIO-GET-KEY         TO FIO-CMND.                        
           PERFORM COL-FIO-CAN.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               RCV-CIC-IOPC IN RCV NOT = CAN-CIC-IOPC IN CAN OR         
               RCV-NUM-ICAN IN RCV NOT = CAN-NUM-ICAN IN CAN)           
               GO TO FIN-BUS-FEC-RCV.                                   

           PERFORM BUS-SAL-MOR.
           ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-VAL-MORP.
           GO TO FIN-BUS-FEC-RCV.                                       

       NXT-BUS-FEC-RCV.                                                 
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           GO TO LUP-BUS-FEC-RCV.                                       
       FIN-BUS-FEC-RCV.                                                 
           COMPUTE BDO-VAL-MORP ROUNDED = BDO-VAL-MORP - BDO-VAL-CCIE.
           PERFORM BUS-SAL-CIE.
           COMPUTE BDO-VAL-MORP ROUNDED = BDO-VAL-MORP - BDO-ACU-CCIE.
           IF (BDO-VAL-MORP NOT > ZEROES)
                MOVE ZEROES TO BDO-VAL-MORP.

           EXIT.                                                        
      *-------------------------------------------------------------
       BUS-SAL-CIE SECTION.                                             
       INI-BUS-SAL-CIE.                                                 

           MOVE ZEROES TO BDO-ACU-CCIE.
           MOVE BDO-NUM-IVEN IN BDO-VARI TO BDO-NUM-SVEN IN BDO-VARI.

      *COMIENZA EL PROCESO
           MOVE BDO-CIC-IOPC IN BDO-VARI TO CAN-CIC-IOPC IN CAN.        
           MOVE BDO-NUM-SVEN IN BDO-VARI TO CAN-NUM-ICAN IN CAN.        
           MOVE FIO-GET-NLS              TO FIO-CMND.                   
       LUP-SAL-CIE.                                                     
           PERFORM COL-FIO-CAN.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               BDO-CIC-IOPC IN BDO-VARI NOT = CAN-CIC-IOPC IN CAN OR    
               BDO-NUM-SVEN IN BDO-VARI NOT = CAN-NUM-ICAN IN CAN)      
                GO TO FIN-BUS-SAL-CIE
           ELSE
                MOVE ADR-CAN-REQA TO ADR-BDO-REQA.                      

           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO NXT-SAL-CIE.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                GO TO NXT-SAL-CIE.

           IF CAN-FEC-FCAN IN CAN > BDO-FEC-FVEN
                GO TO FIN-BUS-SAL-CIE.

      *    VALIDA SI CANCELACION ES PRODUCTO DE TRASPASO
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.             
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.             
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.             
           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-CYA.                                         
                                                                        
      *    SIN CYA => CAN NO TRASPASO
           IF NOT (FIO-STAT-OKS AND                                     
               CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND            
               CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA)               
                 GO TO NXT-SAL-CIE.                                     

      *--------- PRODUCTO TRASPASO ---------                            
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.        
                                                                        
      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND                 
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')                    
                 GO TO NXT-SAL-CIE.                                     

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR                      
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')                        
                PERFORM BUS-NEW-CIE
                GO TO NXT-SAL-CIE.                                      

       NXT-SAL-CIE.                                                     
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           MOVE ADR-BDO-REQA TO ADR-CAN-REQA.                           
           MOVE FIO-KDEF-S TO FIO-KDEF.                                 
           GO TO LUP-SAL-CIE.

       FIN-BUS-SAL-CIE.                                                 
           EXIT.                                                        
      *-------------------------------------------------------------
       BUS-NEW-CIE SECTION.                                             
       INI-BUS-NEW-CIE.                                                 

           MOVE ZEROES TO BDO-ACU-INTN IN BDO-VARI.
           MOVE ZEROES TO BDO-ACU-CAPI IN BDO-VARI.

           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.             
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.             
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.             
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.             
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM COL-FIO-RCV.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR         
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)           
                 GO TO FIN-BUS-NEW-CIE.                                 
           MOVE RCV-SGV-CAPI IN RCV TO BDO-RES-CAPI IN BDO-VARI.
           MOVE RCV-SGV-INTM IN RCV TO BDO-RES-INTM IN BDO-VARI.
           MOVE RCV-NUM-IVCT IN RCV TO BDO-RES-IVCT IN BDO-VARI.

      *   VALIDO CANCELACION ACTIVA
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO FIN-BUS-NEW-CIE.                                  

      *    CAMBIA INTERESES NORMALES A MONEDA OPERACION
           MOVE RCV-SGV-INTN IN RCV TO BDO-INI-INTN IN BDO-VARI.
           PERFORM  CAL-CAM-INTN.
           MOVE BDO-CAM-INTN  TO BDO-RES-INTN IN BDO-VARI.
           MOVE BDO-CAM-INTN  TO BDO-VAL-SINT IN BDO-VARI.

       LUP-NEW-CIE.
      *--------- BUSCA NUEVA OPERACION -----                            
           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPC IN ROV.        

           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV         
                MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV         
                MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.

           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-ROV.                                         
                                                                        
           IF (NOT FIO-STAT-OKS OR                                      
               (CAN-MSC-TCAN IN CAN = 'P' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPC IN ROV) OR       
               (CAN-MSC-TCAN IN CAN = 'R' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPV IN ROV))         
                 GO TO FIN-BUS-NEW-CIE.                                 

           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE ROV-CIC-IOPC IN ROV TO RES-CIC-IOPC IN OPC-RES     
                MOVE ROV-CIC-IOPC IN ROV TO RCV-CIC-IOPV IN RCV.        

           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE ROV-CIC-IOPV IN ROV TO RES-CIC-IOPC IN OPC-RES     
                MOVE ROV-CIC-IOPV IN ROV TO RCV-CIC-IOPV IN RCV.        

       LUP-CIE.                                                         
           MOVE RES-CIC-IOPC IN OPC-RES TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-OPC.                                         

           IF NOT FIO-STAT-OKS                                          
               GO TO FIN-BUS-NEW-CIE.                                   

           IF (OPC-MSC-STAT IN OPC NOT = 'A')                           
               GO TO FIN-BUS-NEW-CIE.                                   

           MOVE OPC-CIC-IOPC IN OPC TO CAN-CIC-IOPC IN CAN.             
           MOVE ZEROES              TO CAN-NUM-ICAN IN CAN.             
           MOVE FIO-GET-NLS TO FIO-CMND.                                
       LUP-CIE-TRV.
           PERFORM COL-FIO-CAN.                                         
           IF (NOT FIO-STAT-OKS  OR                                     
               OPC-CIC-IOPC IN OPC NOT = CAN-CIC-IOPC IN CAN)           
                GO TO FIN-BUS-NEW-CIE.

           IF CAN-FEC-FCAN IN CAN > BDO-FEC-FPRO
                GO TO FIN-BUS-NEW-CIE.

      *   VALIDO CANCELACION ACTIVA
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                MOVE FIO-GET-NXT TO FIO-CMND                            
                GO TO LUP-CIE-TRV.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                MOVE FIO-GET-NXT TO FIO-CMND                            
                GO TO LUP-CIE-TRV.

      *   VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT' OR 'CTE')
                GO TO FIN-BUS-NEW-CIE.                                  

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                PERFORM BUS-CAPI-CIE
                MOVE FIO-GET-NXT TO FIO-CMND                            
                GO TO LUP-CIE-TRV.

           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.             
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.             
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.             
           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-CYA.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               CAN-CIC-IOPC IN CAN NOT = CYA-CIC-IOPC IN CYA OR         
               CAN-NUM-ICAN IN CAN NOT = CYA-NUM-ICAN IN CYA)           
                GO TO LUP-NEW-CIE.                                      
                                                                        
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.        
                                                                        
      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND                 
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')                    
                GO TO LUP-NEW-CIE.                                      

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR                      
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')                        
                GO TO LUP-NEW-CIE.

       FIN-BUS-NEW-CIE.                                                 
           EXIT.                                                        
      *-------------------------------------------------------------
       BUS-CAPI-CIE SECTION.
       INI-BUS-CAPI-CIE.

           MOVE ZEROES              TO BDO-CAN-INTN IN BDO-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)
                GO TO FIN-BUS-CAPI-CIE.

           IF (RCV-SGV-CAPI IN RCV NOT > ZEROES)
                GO TO FIN-BUS-CAPI-CIE.

           IF BDO-COD-VCOC = OPC-COD-VCOC IN OPC
               MOVE RCV-SGV-CAPI IN RCV TO BDO-SGV-CAPI IN BDO-VARI
           ELSE
               PERFORM CAL-CAM-CAPI.

           IF (BDO-VAL-SINT IN BDO-VARI = BDO-SGV-CAPI IN BDO-VARI)
               MOVE BDO-SGV-CAPI IN BDO-VARI TO BDO-ACU-INTN IN BDO-VARI
               MOVE BDO-SGV-CAPI IN BDO-VARI TO BDO-CAN-INTN IN BDO-VARI
                GO TO VAL-SINT.

           IF (BDO-VAL-SINT IN BDO-VARI < BDO-SGV-CAPI IN BDO-VARI)
               MOVE BDO-RES-INTN IN BDO-VARI TO BDO-ACU-INTN IN BDO-VARI
               MOVE BDO-RES-INTN IN BDO-VARI TO BDO-CAN-INTN IN BDO-VARI
               GO TO VAL-SINT.

           IF (BDO-VAL-SINT IN BDO-VARI > BDO-SGV-CAPI IN BDO-VARI)
                ADD BDO-SGV-CAPI IN BDO-VARI TO BDO-ACU-INTN IN BDO-VARI
               MOVE BDO-SGV-CAPI IN BDO-VARI TO BDO-CAN-INTN IN BDO-VARI
                GO TO VAL-SINT.

       VAL-SINT.

           IF   BDO-VAL-SINT IN BDO-VARI NOT > ZEROES
                 MOVE ZEROES TO BDO-CAN-INTN IN BDO-VARI.

           COMPUTE BDO-VAL-SINT IN BDO-VARI =
                  (BDO-RES-INTN IN BDO-VARI -
                   BDO-ACU-INTN IN BDO-VARI).

           IF   BDO-VAL-SINT IN BDO-VARI NOT > ZEROES
                 MOVE ZEROES TO BDO-VAL-SINT IN BDO-VARI.

       VAL-CAPI.
           COMPUTE BDO-ACU-CCIE IN BDO-VARI =
                   BDO-ACU-CCIE IN BDO-VARI +
                  (BDO-SGV-CAPI IN BDO-VARI  -
                   BDO-CAN-INTN IN BDO-VARI).

       FIN-BUS-CAPI-CIE.
           EXIT.
      *-------------------------------------------------------------
       BUS-SAL-MOR SECTION.                                             
       INI-BUS-SAL-MOR.                                                 

           MOVE BDO-CIC-IOPC             TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES                   TO BDO-VAL-CAPI IN BDO-VARI.

           MOVE BDO-CIC-IOPC            TO OPC-CIC-IOPC IN OPC.         
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-OPC.                                         
           IF NOT FIO-STAT-OKS                                          
               GO TO FIN-BUS-SAL-MOR.                                   

           MOVE OPC-NUM-IVEN IN OPC TO BDO-NUM-SVEN IN BDO-VARI.
           MOVE OPC-IND-VSTR IN OPC TO BDO-IND-VSTR IN BDO-VARI.

       LUP-OPC.                                                         
           MOVE BDO-CIC-IOPC            TO OPC-CIC-IOPC IN OPC.         
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-OPC.                                         
           IF NOT FIO-STAT-OKS                                          
               GO TO FIN-BUS-SAL-MOR.                                   

           MOVE BDO-NUM-SVEN IN BDO-VARI TO VEN-NUM-IVEN IN VEN.
           MOVE BDO-CIC-IOPC             TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
       LUP-VEN.                                                         

      *VENCIMIENTO ESTRUCTURADO: EJECUTA RUTINA DE EXPANSION DE VEN
           IF (BDO-IND-VSTR IN BDO-VARI = 'S')                          
                MOVE BDO-NUM-SVEN IN BDO-VARI TO VEN-NUM-IVEN IN VEN
                PERFORM COL-OBT-VEN                                     
                IF (NOT VEN-STAT-OKS)                                   
                     GO TO FIN-BUS-SAL-MOR
                ELSE                                                    
                     MOVE VEN-NUM-IVCT IN VEN  TO
                          BDO-NUM-SVEN IN BDO-VARI.
                                                                        
      *VENCIMIENTO NO ESTRUCTURADO: EJECUTA BUSQUEDA DIRECTO EN VEN
           IF (BDO-IND-VSTR IN BDO-VARI NOT = 'S')                      
               PERFORM COL-FIO-VEN                                      
                IF (NOT FIO-STAT-OKS)                                   
                     GO TO FIN-BUS-SAL-MOR
                ELSE                                                    
                     MOVE VEN-NUM-IVEN IN VEN  TO
                          BDO-NUM-SVEN IN BDO-VARI
                     MOVE ADR-VEN-REQA TO ADR-AUX-REQA.                 

      *    RESPALDO CAPITAL DE VENCIMIENTO ORIGINAL

           IF VEN-FEC-FVEN IN VEN > BDO-FEC-FPRO
               GO TO FIN-BUS-SAL-MOR.

           ADD VEN-VAL-CAPI IN VEN TO BDO-VAL-CAPI IN BDO-VARI.

       NXT-VEN.                                                         
           IF (BDO-IND-VSTR IN BDO-VARI NOT = 'S')                      
               MOVE FIO-GET-NXT TO FIO-CMND                             
               MOVE ADR-AUX-REQA TO ADR-VEN-REQA                        
               MOVE FIO-KDEF-S TO FIO-KDEF                              
           ELSE
               MOVE FIO-GET-KEY TO FIO-CMND.                            
           ADD 1 TO BDO-NUM-SVEN IN BDO-VARI.
           GO TO LUP-OPC.

       FIN-BUS-SAL-MOR.                                                 
           EXIT.                                                        
      *-------------------------------------------------------------
       BUS-OPC-VOPC SECTION.                                            
       INI-BUS-OPC-VOPC.                                                
      *BUSCA OPERACIONES ASOCIADAS A OPC ORIG

           MOVE SPACES       TO BDO-IND-ICTT IN BDO-VARI.
           MOVE ZEROES       TO BDO-NUM-IVEN IN BDO-VARI.


           MOVE BDO-CIC-IOPC IN BDO-VARI TO BDO-CIC-IOPE IN BDO-VARI.
           MOVE ZEROES                   TO BDO-NUM-ICAN IN BDO-VARI.
           MOVE ZEROES                   TO BDO-NUM-IVEN IN BDO-VARI.
           PERFORM GRB-VOPC.

      *COMIENZA EL PROCESO
           MOVE BDO-CIC-IOPC IN BDO-VARI TO CAN-CIC-IOPC IN CAN.        
           MOVE ZEROES                   TO CAN-NUM-ICAN IN CAN.        
           MOVE FIO-GET-NLS              TO FIO-CMND.                   
       LUP-BUS-OPC-VOPC.                                                
           PERFORM COL-FIO-CAN.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               BDO-CIC-IOPC IN BDO-VARI NOT = CAN-CIC-IOPC IN CAN)      
                GO TO FIN-BUS-OPC-VOPC
           ELSE
                MOVE ADR-CAN-REQA TO ADR-BDO-REQA.                      

           MOVE CAN-NUM-ICAN IN CAN TO BDO-NUM-ICAN IN BDO-VARI.
           PERFORM BUS-RCV-VOPC.
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO NXT-BUS-OPC-VOPC.

      **************************
           MOVE BDO-CIC-IOPC IN BDO-VARI TO OPC-CIC-IOPC IN OPC.        
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-OPC.                                         

           PERFORM BUS-REG-CXE.
           IF WSS-EXI-RCXE IN WSS = 'S'
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO NXT-BUS-OPC-VOPC.

           COMPUTE WSS-POR-MLIB IN WSS = RLO-VAL-PGAR IN RLO *
            BDO-RCV-CAPI IN BDO-VARI.

           DIVIDE WSS-POR-MLIB IN WSS BY 100 GIVING WSS-POR-MLIB IN WSS.

           PERFORM PRO-LEE-LCC.
           PERFORM DET-MON-LIC.

           IF WSS-IND-MONE IN WSS = 'N'
               MOVE SPACES TO MSG-COD-MENS
               PERFORM PRO-CAM-CXE
               IF MSG-COD-MENS > SPACES
                   GO TO FIN-BUS-OPC-VOPC.

           IF WSS-POR-MLIB IN WSS > ZEROES
               PERFORM PRO-GRA-CXE.

           MOVE CAN-FEC-FCAN IN CAN TO WSS-FEC-FCAN IN WSS.
           MOVE OPC-FEC-FCOL IN OPC TO WSS-FEC-FCOL IN WSS.

           MOVE ZEROES TO WSS-POR-MLIB IN WSS.
      **************************

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                GO TO NXT-BUS-OPC-VOPC.

      *    VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                MOVE 'S' TO BDO-IND-ICTT IN BDO-VARI
                GO TO FIN-BUS-OPC-VOPC.

      *    VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                GO TO NXT-BUS-OPC-VOPC.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                GO TO NXT-BUS-OPC-VOPC.

      *    VALIDO TIPO DE CANCELACION: PRORROGA
           IF (CAN-MSC-CANC IN CAN = 'PTT' OR 'KTT')                    
                PERFORM BUS-VOPC-PTT
                GO TO FIN-BUS-OPC-VOPC.

      *    VALIDA SI CANCELACION ES PRODUCTO DE TRASPASO
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.             
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.             
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.             
           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-CYA.                                         
                                                                        
      *    SIN CYA => CAN NO TRASPASO
           IF NOT (FIO-STAT-OKS AND                                     
               CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND            
               CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA)               
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    PERFORM BUS-VOPC-PTT
                    GO TO FIN-BUS-OPC-VOPC
               ELSE
                    GO TO NXT-BUS-OPC-VOPC.                             

      *--------- PRODUCTO TRASPASO ---------                            
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.        
                                                                        
      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND                 
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')                    
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    GO TO FIN-BUS-OPC-VOPC
               ELSE
                    GO TO NXT-BUS-OPC-VOPC.                             

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR                      
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')                        
                PERFORM BUS-NEW-VOPC
                     GO TO NXT-BUS-OPC-VOPC.                            

       NXT-BUS-OPC-VOPC.                                                
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           MOVE ADR-BDO-REQA TO ADR-CAN-REQA.                           
           MOVE FIO-KDEF-S TO FIO-KDEF.                                 
           GO TO LUP-BUS-OPC-VOPC.

       FIN-BUS-OPC-VOPC.                                                
           EXIT.                                                        
      *-------------------------------------------------------------
       BUS-VOPC-PTT SECTION.                                            
       INI-BUS-VOPC-PTT.                                                

           MOVE SPACES       TO BDO-IND-ICTT IN BDO-VARI.
           MOVE ZEROES       TO BDO-NUM-IVEN IN BDO-VARI.

      *    BUSCA NUEVA OPERACION
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.             
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.             
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-KEY         TO FIO-CMND.                        
           PERFORM COL-FIO-ROV.                                         
           IF (NOT FIO-STAT-OKS)                                        
                 GO TO FIN-BUS-VOPC-PTT.                                

           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-OPC.                                         
           IF (NOT FIO-STAT-OKS)                                        
                MOVE 'PTT  INEX' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-BUS-VOPC-PTT.

           MOVE OPC-CIC-IOPC IN OPC TO BDO-CIC-IOPE IN BDO-VARI.
           PERFORM GRB-VOPC.
           MOVE OPC-IND-VSTR IN OPC TO BDO-IND-VSTR IN BDO-VARI.        
           MOVE OPC-COD-VCOC IN OPC TO BDO-COD-VCOC IN BDO-VARI.
           MOVE OPC-COD-VCOC IN OPC TO BDO-NUM-CTOT IN BDO-VARI.
           MOVE OPC-FEC-FCOL IN OPC TO BDO-FEC-FCAM IN BDO-VARI.

           IF (OPC-MSC-STAT IN OPC NOT = 'A')                           
                MOVE 'PTT NOACA' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-BUS-VOPC-PTT.

           MOVE OPC TO OPC-RES.

      *COMIENZA EL PROCESO
           MOVE OPC-CIC-IOPC IN OPC      TO CAN-CIC-IOPC IN CAN.        
           MOVE ZEROES                   TO CAN-NUM-ICAN IN CAN.        
           MOVE FIO-GET-NLS              TO FIO-CMND.                   
       LUP-BUS-VOPC-PTT.                                                
           PERFORM COL-FIO-CAN.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               OPC-CIC-IOPC IN OPC NOT = CAN-CIC-IOPC IN CAN)           
                GO TO FIN-BUS-VOPC-PTT
           ELSE
                MOVE ADR-CAN-REQA TO ADR-PTT-REQA.                      

           MOVE CAN-NUM-ICAN IN CAN TO BDO-NUM-ICAN IN BDO-VARI.
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO NXT-BUS-VOPC-PTT.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                GO TO NXT-BUS-VOPC-PTT.

      *    VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                MOVE 'S' TO BDO-IND-ICTT IN BDO-VARI
                GO TO FIN-BUS-VOPC-PTT.

      *    VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                GO TO NXT-BUS-VOPC-PTT.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                GO TO NXT-BUS-VOPC-PTT.

      *    VALIDO TIPO DE CANCELACION: PRORROGA
           IF (CAN-MSC-CANC IN CAN = 'PTT' OR 'KTT')                    
                GO TO INI-BUS-VOPC-PTT.

      *    VALIDA SI CANCELACION ES PRODUCTO DE TRASPASO
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.             
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.             
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.             
           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-CYA.                                         
                                                                        
      *    SIN CYA => CAN NO TRASPASO
           IF (NOT FIO-STAT-OKS OR                                      
               CAN-CIC-IOPC IN CAN NOT = CYA-CIC-IOPC IN CYA OR         
               CAN-NUM-ICAN IN CAN NOT = CYA-NUM-ICAN IN CYA)           
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    GO TO INI-BUS-VOPC-PTT
               ELSE
                GO TO NXT-BUS-VOPC-PTT.                                 

      *--------- PRODUCTO TRASPASO ---------                            
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.        
                                                                        
      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND                 
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')                    
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    GO TO INI-BUS-VOPC-PTT
               ELSE
                GO TO NXT-BUS-VOPC-PTT.                                 

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR                      
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')                        
                PERFORM BUS-NEW-VOPC
      *         NUEVA OPERACION IMPAGA
                IF (BDO-IND-CANC IN BDO-VARI NOT = 'S')
                     GO TO FIN-BUS-VOPC-PTT                             
      *         NUEVA OPERACION CANCELADA
                ELSE
                     GO TO NXT-BUS-VOPC-PTT.                            

       NXT-BUS-VOPC-PTT.                                                
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           MOVE ADR-PTT-REQA TO ADR-CAN-REQA.                           
           MOVE FIO-KDEF-S TO FIO-KDEF.                                 
           GO TO LUP-BUS-VOPC-PTT.

       FIN-BUS-VOPC-PTT.                                                
           EXIT.                                                        
      *-----------------------------------------------------
       BUS-NEW-VOPC SECTION.                                            
       INI-BUS-NEW-VOPC.                                                

           MOVE 'N'    TO BDO-IND-CANC IN BDO-VARI.

           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.             
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.             
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.             
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.             
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM COL-FIO-RCV.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR         
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)           
                 GO TO FIN-BUS-NEW-VOPC.                                

           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                 GO TO FIN-BUS-NEW-VOPC.                                

      *    CAMBIA INTERESES NORMALES A MONEDA OPERACION

       LUP-NEW-VOPC.
      *--------- BUSCA NUEVA OPERACION -----                            
           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPC IN ROV.        

           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV         
                MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV         
                MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.

           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-ROV.                                         
                                                                        
           IF (NOT FIO-STAT-OKS OR                                      
               (CAN-MSC-TCAN IN CAN = 'P' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPC IN ROV) OR       
               (CAN-MSC-TCAN IN CAN = 'R' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPV IN ROV))         
                 GO TO FIN-BUS-NEW-VOPC.                                

           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE ROV-CIC-IOPC IN ROV TO RES-CIC-IOPC IN OPC-RES     
                MOVE ROV-CIC-IOPC IN ROV TO RCV-CIC-IOPV IN RCV.        

           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE ROV-CIC-IOPV IN ROV TO RES-CIC-IOPC IN OPC-RES     
                MOVE ROV-CIC-IOPV IN ROV TO RCV-CIC-IOPV IN RCV.        

       LUP-VOPC.                                                        
           MOVE RES-CIC-IOPC IN OPC-RES TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-OPC.                                         

           IF NOT FIO-STAT-OKS                                          
               GO TO FIN-BUS-NEW-VOPC.                                  

           IF (OPC-MSC-STAT IN OPC NOT = 'A')                           
               GO TO FIN-BUS-NEW-VOPC.                                  

           MOVE OPC-CIC-IOPC IN OPC TO BDO-CIC-IOPE IN BDO-VARI.
           PERFORM GRB-VOPC.

           MOVE OPC-CIC-IOPC IN OPC TO CAN-CIC-IOPC IN CAN.             
           MOVE ZEROES              TO CAN-NUM-ICAN IN CAN.             
           MOVE FIO-GET-NLS TO FIO-CMND.                                
       LUP-VOPC-TRV.
           PERFORM COL-FIO-CAN.                                         
           IF (NOT FIO-STAT-OKS  OR                                     
               OPC-CIC-IOPC IN OPC NOT = CAN-CIC-IOPC IN CAN)           
                GO TO FIN-BUS-NEW-VOPC.

           MOVE CAN-NUM-ICAN IN CAN TO BDO-NUM-ICAN IN BDO-VARI.

      *   VALIDO CANCELACION ACTIVA
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                MOVE FIO-GET-NXT TO FIO-CMND                            
                GO TO LUP-VOPC-TRV.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                MOVE FIO-GET-NXT TO FIO-CMND                            
                GO TO LUP-VOPC-TRV.

      *   VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                MOVE 'S' TO BDO-IND-CANC IN BDO-VARI
                GO TO FIN-BUS-NEW-VOPC.                                 

      *   VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                MOVE 'S' TO BDO-IND-CANC IN BDO-VARI
                GO TO FIN-BUS-NEW-VOPC.                                 

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                MOVE FIO-GET-NXT TO FIO-CMND                            
                GO TO LUP-VOPC-TRV.

           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.             
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.             
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.             
           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-CYA.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               CAN-CIC-IOPC IN CAN NOT = CYA-CIC-IOPC IN CYA OR         
               CAN-NUM-ICAN IN CAN NOT = CYA-NUM-ICAN IN CYA)           
                GO TO INI-BUS-NEW-VOPC.                                 
                                                                        
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.        
                                                                        
      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND                 
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')                    
                GO TO LUP-NEW-VOPC.

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR                      
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')                        
                GO TO LUP-NEW-VOPC.

       FIN-BUS-NEW-VOPC.                                                
           EXIT.                                                        
      *-----------------------------------------------------
       BUS-RCV-VOPC SECTION.                                            
       INI-BUS-RCV-VOPC.                                                

           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.             
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.             
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.             
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.             
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM COL-FIO-RCV.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR         
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)           
               GO TO FIN-BUS-CAPI.

           MOVE RCV-NUM-IVCT IN RCV TO BDO-NUM-IVEN IN BDO-VARI.
           MOVE RCV-SGV-CAPI IN RCV TO BDO-RCV-CAPI IN BDO-VARI.

       FIN-BUS-RCV-VOPC.                                                
           EXIT.                                                        
      *-----------------------------------------------------
       OBT-EST-OPC SECTION.                                             
       INI-OBT-EST-OPC.                                                 

           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.             
           MOVE 1                   TO DLC-NUM-IDLC IN DLC.             
           MOVE FIO-GET-KEY         TO FIO-CMND.                        
           PERFORM COL-FIO-DLC.                                         
           IF (NOT FIO-STAT-OKS)                                        
                GO TO FIN-OBT-EST-OPC.                                  


           IF (BDO-IND-SCTB IN BDO-VARI = 'CAS'  OR
               DLC-IND-SCTB IN DLC      = 'CAS')
                MOVE 'CAS' TO BDO-GLS-STAT IN BDO-VARI
                GO TO FIN-OBT-EST-OPC.                                  

           IF (BDO-IND-SCTB IN BDO-VARI = 'VCD' OR
               DLC-IND-SCTB IN DLC      = 'VCD')
                MOVE 'VCD' TO BDO-GLS-STAT IN BDO-VARI
                GO TO FIN-OBT-EST-OPC.                                  

           IF (BDO-IND-SCTB IN BDO-VARI = 'MOR' OR 'MUL')
                GO TO FIN-OBT-EST-OPC.                                  

           IF (BDO-IND-SCTB IN BDO-VARI = 'VIG')
                GO TO FIN-OBT-EST-OPC.                                  

       FIN-OBT-EST-OPC.                                                 
           EXIT.                                                        
      *----------------------------------------------------------------
      *RESPALDA ENTIDADES UTILIZADAS POR LA RUTINA BDO
      *----------------------------------------------------------------
       LOC-LLE-ENT SECTION.
       INI-LOC-LLE-ENT.
           MOVE SPACES TO OPC-RESP IN LOC-VARI.
           MOVE SPACES TO DLC-RESP IN LOC-VARI.
           MOVE SPACES TO ROV-RESP IN LOC-VARI.
           MOVE SPACES TO CAN-RESP IN LOC-VARI.
           MOVE SPACES TO CYA-RESP IN LOC-VARI.
           MOVE SPACES TO RCV-RESP IN LOC-VARI.
           MOVE SPACES TO VEN-RESP IN LOC-VARI.
           MOVE SPACES TO CAM-RESP IN LOC-VARI.
           MOVE SPACES TO TAB-RESP IN LOC-VARI.

           MOVE OPC TO OPC-RESP IN LOC-VARI.
           MOVE DLC TO DLC-RESP IN LOC-VARI.
           MOVE ROV TO ROV-RESP IN LOC-VARI.
           MOVE CAN TO CAN-RESP IN LOC-VARI.
           MOVE CYA TO CYA-RESP IN LOC-VARI.
           MOVE RCV TO RCV-RESP IN LOC-VARI.
           MOVE VEN TO VEN-RESP IN LOC-VARI.
           MOVE CAM TO CAM-RESP IN LOC-VARI.
           MOVE TAB TO TAB-RESP IN LOC-VARI.
       FIN-LOC-LLE-ENT.
           EXIT.
      *----------------------------------------------------------------
      *RESTAURA ENTIDADES UTILIZADAS POR LA RUTINA BDO
      *----------------------------------------------------------------
       LOC-RES-ENT SECTION.
       INI-LOC-RES-ENT.
           MOVE OPC-RESP IN LOC-VARI TO OPC.
           MOVE DLC-RESP IN LOC-VARI TO DLC.
           MOVE ROV-RESP IN LOC-VARI TO ROV.
           MOVE CAN-RESP IN LOC-VARI TO CAN.
           MOVE CYA-RESP IN LOC-VARI TO CYA.
           MOVE RCV-RESP IN LOC-VARI TO RCV.
           MOVE VEN-RESP IN LOC-VARI TO VEN.
           MOVE CAM-RESP IN LOC-VARI TO CAM.
           MOVE TAB-RESP IN LOC-VARI TO TAB.
       FIN-LOC-RES-ENT.
           EXIT.
       INI-GMO SECTION.
       INI-INI-GMO.
           MOVE SPACES TO GMO-GLS-FLAG IN GMO.
           MOVE SPACES TO GMO-FEC-FMOV IN GMO.
           MOVE SPACES TO GMO-HRA-HMOV IN GMO.
           MOVE SPACES TO GMO-CAI-GTIA IN GMO.
           MOVE SPACES TO GMO-IIC-GTIA IN GMO.
           MOVE ZEROES TO GMO-NUM-IMOV IN GMO.
           MOVE ZEROES TO GMO-NUM-TASN IN GMO.
           MOVE SPACES TO GMO-COD-CMPO IN GMO.
           MOVE SPACES TO GMO-IND-VALO IN GMO.
           MOVE SPACES TO GMO-IND-CLVE IN GMO.
           MOVE SPACES TO GMO-COD-CLVA IN GMO.
           MOVE SPACES TO GMO-GLS-CMPA IN GMO.
           MOVE ZEROES TO GMO-SGV-CMPA IN GMO.
           MOVE SPACES TO GMO-COD-NCLV IN GMO.
           MOVE SPACES TO GMO-GLS-NCMP IN GMO.
           MOVE ZEROES TO GMO-SGV-NCMP IN GMO.
           MOVE SPACES TO GMO-FEC-FING IN GMO.
           MOVE SPACES TO GMO-COD-TMOV IN GMO.
           MOVE SPACES TO GMO-GLS-DISP IN GMO.

           PERFORM GET-FHOY.
           MOVE HOY-FHOY TO GMO-FEC-FMOV IN GMO.
           MOVE HOY-HHOY TO GMO-HRA-HMOV IN GMO.
      *FLB CST  13-OCT-1993
           MOVE 'COL'    TO GMO-TML-TMOV IN GMO.
           MOVE 'LDCPURLO' TO GMO-CIC-UING IN GMO.
      *FLB CST  13-OCT-1993
           MOVE HOY-FHOY TO GMO-FEC-FING IN GMO.
           MOVE GDG-CAI-GTIA IN GDG TO GMO-CAI-GTIA IN GMO.
           MOVE GDG-IIC-GTIA IN GDG TO GMO-IIC-GTIA IN GMO.
           MOVE GDG-COD-OFIC IN GDG TO GMO-COD-OFMV IN GMO.
           ADD 1 TO GMO-NUM-IMOV IN GMO.
           MOVE 'S' TO GMO-IND-VALO IN GMO.
           MOVE 'N' TO GMO-IND-CLVE IN GMO.
           MOVE SPACES TO GMO-COD-CLVA IN GMO.
           MOVE SPACES TO GMO-COD-NCLV IN GMO.
           MOVE ZEROES TO GMO-SGV-CMPA IN GMO.
           MOVE ZEROES TO GMO-SGV-NCMP IN GMO.
           MOVE SPACES TO GMO-GLS-CMPA IN GMO.
           MOVE SPACES TO GMO-GLS-NCMP IN GMO.
           MOVE '1' TO GMO-COD-MOVI IN GMO.
       FIN-INI-GMO.
           EXIT.
       GRABA-GMO SECTION.
       INI-GRABA-GMO.
           PERFORM INI-GMO.
           MOVE 'GVT005' TO GMO-COD-CMPO IN GMO.
           MOVE GVT-FEC-FTSN IN GVT TO GMO-GLS-NCMP IN GMO.
           MOVE GVT-SGV-VGAS IN GVT TO GMO-SGV-NCMP IN GMO.
           ADD 1 TO GMO-NUM-IMOV IN GMO.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GMO.
       FIN-GRABA-GMO.
           EXIT.
       PRO-CON-GVT SECTION.
       INI-PRO-CON-GVT.
           MOVE GDG-CAI-GTIA IN GDG TO GVT-CAI-GTIA IN GVT.
           MOVE GDG-IIC-GTIA IN GDG TO GVT-IIC-GTIA IN GVT.
           MOVE 999                 TO GVT-COD-TASN IN GVT.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
       FIN-PRO-CON-GVT.
           EXIT.
      *----------------------------------------------------------------
      *GRABA GMO
      *----------------------------------------------------------------
       PRO-GRA-GMO SECTION.
       INI-PRO-GRA-GMO.
           MOVE SPACES                   TO GMO-GLS-FLAG IN GMO.
           MOVE 'GVT005'                 TO GMO-COD-CMPO IN GMO.
           MOVE SPACES                   TO GMO-COD-CLVA IN GMO.
           MOVE ACL-FEC-FTSN IN ACL-VARI TO GMO-GLS-CMPA IN GMO.
           MOVE ACL-SGV-VGAS IN ACL-VARI TO GMO-SGV-CMPA IN GMO.
           MOVE SPACES                   TO GMO-COD-NCLV IN GMO.
           IF GVT-FEC-FURV IN GVT NOT > SPACES OR
            GVT-FEC-FURV IN GVT NOT > ZEROES
               MOVE GVT-FEC-FTSN IN GVT  TO GMO-GLS-NCMP IN GMO
           ELSE
               MOVE GVT-FEC-FURV IN GVT  TO GMO-GLS-NCMP IN GMO.
           MOVE GVT-SGV-VGAS IN GVT      TO GMO-SGV-NCMP IN GMO.
           MOVE SPACES                   TO GMO-GLS-DISP IN GMO.
           PERFORM GET-FHOY.
           MOVE HOY-SHOY                 TO GMO-NUM-SMOV IN GMO.
           MOVE HOY-AHOY                 TO GMO-NUM-AMOV IN GMO.
           MOVE HOY-MHOY                 TO GMO-NUM-MMOV IN GMO.
           MOVE HOY-DHOY                 TO GMO-NUM-DMOV IN GMO.
           MOVE HOY-HHOY                 TO GMO-HRA-HMOV IN GMO.
           MOVE 'CAN'                    TO GMO-TML-TMOV IN GMO.
           MOVE 'LDCPURLO'               TO GMO-CIC-UING IN GMO.
           MOVE GVT-FEC-FING IN GVT      TO GMO-FEC-FING IN GMO.
           MOVE GDG-CIC-GTIA IN GDG      TO GMO-CIC-GTIA IN GMO.
           MOVE GDG-COD-OFIC IN GDG      TO GMO-COD-OFMV IN GMO.
           ADD 1                         TO GMO-NUM-IMOV IN GMO.
           MOVE 'S'                      TO GMO-IND-VALO IN GMO.
           MOVE 'N'                      TO GMO-IND-CLVE IN GMO.

           SUBTRACT 1 FROM GVT-COD-TASN IN GVT GIVING
                       GMO-NUM-TASN IN GMO.
           MOVE '2' TO GMO-COD-MOVI IN GMO.
           MOVE 'R' TO GMO-COD-TMOV IN GMO.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GMO.
       FIN-PRO-GRA-GMO.
           EXIT.
       GRA-REG-GMO SECTION.
       INI-GRA-REG-GMO.
           MOVE HOY-FHOY            TO GMO-FEC-FMOV IN GMO.
           MOVE HOY-HHOY            TO GMO-HRA-HMOV IN GMO.
           MOVE SCR-OTRN            TO GMO-TML-TMOV IN GMO.
           MOVE SCR-USER            TO GMO-CIC-UING IN GMO.
           MOVE HOY-FHOY            TO GMO-FEC-FING IN GMO.
           MOVE GDG-CAI-GTIA IN GDG TO GMO-CAI-GTIA IN GMO.
           MOVE GDG-IIC-GTIA IN GDG TO GMO-IIC-GTIA IN GMO.
           MOVE ZEROES              TO GMO-NUM-IMOV IN GMO.
           MOVE '3'                 TO GMO-COD-MOVI IN GMO.
           MOVE GDG-COD-TSCN IN GDG TO GMO-NUM-TASN IN GMO.
           MOVE 'GDG001'            TO GMO-COD-CMPO IN GMO.
           MOVE 'N'                 TO GMO-IND-VALO IN GMO.
           MOVE 'S'                 TO GMO-IND-CLVE IN GMO.
           MOVE SPACES              TO GMO-GLS-CMPA IN GMO.
           MOVE ZEROES              TO GMO-SGV-CMPA IN GMO.
           MOVE GDG-IND-EST1 IN GDG TO GMO-COD-NCLV IN GMO.
           MOVE SPACES              TO GMO-GLS-NCMP IN GMO.
           MOVE ZEROES              TO GMO-SGV-NCMP IN GMO.
           MOVE GDG-COD-OFIC IN GDG TO GMO-COD-OFMV IN GMO.
           MOVE SPACES              TO GMO-COD-CLVA IN GMO.
           MOVE SPACES              TO GMO-COD-TMOV IN GMO.
           MOVE SPACES              TO GMO-GLS-DISP IN GMO.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GMO.
       FIN-GRA-REG-GMO.
           EXIT.
      *----------------------------------------------------------------
      *AFRI-FIN/LOF/CHC/07-2009
      *AFRI-INI 15-SEP-2010 GARANTIAS ESTATALES
       PRO-LEE-ETG SECTION.
       INI-PRO-LEE-ETG.
           MOVE 'TAB'        TO FIO-SIST.
           MOVE 'ETG'        TO TAB-COD-TTAB.
           MOVE WSS-COD-CDOC TO TAB-COD-CTAB.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
               MOVE 'ERROTABETG' TO MSG-COD-MENS
               GO TO FIN-PRO-LEE-ETG
           ELSE
               MOVE TAB-GLS-DAT1 TO GDG-IND-EST1 IN GDG.

           IF GDG-IND-EST1 IN GDG = '10'
               MOVE 'S' TO GDG-IND-GTAC IN GDG
               MOVE 'A' TO GDG-MSC-STAT IN GDG
           ELSE
               MOVE 'N' TO GDG-IND-GTAC IN GDG
               MOVE 'I' TO GDG-MSC-STAT IN GDG.
       FIN-PRO-LEE-ETG.
           EXIT.
      *AFRI-FIN 15-SEP-2010 GARANTIAS ESTATALES
      *>>>>
*% END
      *>>>>
*% END
