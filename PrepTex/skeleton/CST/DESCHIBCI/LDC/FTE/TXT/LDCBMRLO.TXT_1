*% IF SETTAG
      *-----------------------------------------------------------------
      *MODIFICACIONES:                                                  
      *--------------                                                   
      *OBJETIVO: SE MODIFICAN LOS COMANDOS LIB Y RBJ                    
      *PROYECTO: LOF CON CANCELACIONES                                  
      *FECHA   : JULIO DE 2009                                          
      *AUTOR   : CHC                                                    
      *ETIQUETA: *AFRI-INI/LOF/CHC/07-2009                              
      *-----------------------------------------------------------------
*% IF PGM_BQ
      *OBJETIVO: SE CREA COMANDO BLI
      *PROYECTO: IMPRESION DOCUMENTO FOGAPE
      *FECHA   : AGOSTO 2015
      *ETIQUETA: *AFRI-INI/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
      *-----------------------------------------------------------------
*% END
*% END
*% IF INI_RLO_CAI_ILIC
      *<<<<
      *AFRI-INI/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
           IF SCR-CMND = WSS-GLS-IBLI
                GO TO FIN-VAL-RLO-CAI-ILIC.                             
      *AFRI-FIN/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
      *>>>>
           IF RLO-CAI-ILIC IN RLO-FLD NOT > SPACES AND                  
              SCR-CMND NOT = 'CON'                                      
                PERFORM ERR-GLS                                         
                GO TO FIN-VAL-RLO-CAI-ILIC.                             
           GO TO FIN-VAL-RLO-CAI-ILIC.
*% END
*% IF INI_FST_FLD_RLO
      *<<<< INI-FST-FLD-RLO.                                            
           IF SCR-CMND = 'TRL'                                          
               MOVE -1 TO FRM-CAI-ILIC-LEN IN RLO-FLD                   
           ELSE                                                         
      *>>>>                                                             

*% END
*% IF FIN_FST_KEY_RLO AND PGM_BQ
      *<<<<
      *AFRI-INI/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
           IF SCR-CMND = WSS-GLS-IBLI
               MOVE WSS-NUM-ZERO  TO RLO-CAI-ILIC-LEN IN RLO-FLD        
               MOVE WSS-NUM-MUNO  TO RLO-CAI-IOPC-LEN IN RLO-FLD.       
      *AFRI-FIN/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
      *>>>>
*% END
*% IF FIN_UNP_IKY_RLO AND PGM_BQ
      *<<<<
      *AFRI-INI/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
           IF SCR-CMND = WSS-GLS-IBLI
               MOVE FRM-CPIM-AEY TO RLO-CAI-ILIC-ATR                    
               MOVE FRM-CPIM-AEY TO RLO-IIC-ILIC-ATR                    
               MOVE FRM-CPIM-AEY TO RLO-NUM-IOPC-ATR.                   
      *AFRI-FIN/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
      *>>>>
*% END
*% IF FIN_UNP_FLD_RLO
      *<<<< FIN-UNP-FLD-RLO                                             
           IF SCR-CMND = 'TRL'                                          
               MOVE FRM-CPIM-AEY TO RLO-COD-CGTA-ATR IN RLO-FLD         
               MOVE FRM-CPIM-AEY TO RLO-COD-DENV-ATR IN RLO-FLD         
               MOVE FRM-CPIM-AEY TO FRM-VAL-MLIB-ATR IN RLO-FLD.        
      *>>>>                                                             
*% END
*% IF FRM_IIC_ILIC
      *<<<< INI-VAL-FRM-IIC-ILIC                                        
           IF SCR-CMND NOT = 'TRL'                                      
               GO TO FIN-VAL-FRM-IIC-ILIC.                              
           IF FRM-CAI-ILIC IN RLO-FLD = RLO-CAI-ILIC IN RLO-FLD AND     
              FRM-IIC-ILIC IN RLO-FLD = RLO-IIC-ILIC IN RLO-FLD         
              MOVE 'DEU'          TO MSG-COD-SIST                       
              MOVE 'LCC NO IGUAL' TO MSG-COD-MENS                       
              PERFORM GET-MSG                                           
              MOVE MSG-GLS-DESC   TO FRM-MENS                           
              MOVE FRM-SUAR-MAL   TO FRM-SUAR                           
              GO TO FIN-VAL-FRM-IIC-ILIC.                               
           MOVE FRM-CAI-ILIC IN RLO-FLD TO LCC-CAI-ILIC IN LCC.         
           MOVE FRM-IIC-ILIC IN RLO-FLD TO LCC-IIC-ILIC IN LCC.         
           MOVE 'LCC-KEY-ILIC' TO FIO-AKEY.                             
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM LDC-FIO-LCC                                          
           IF NOT FIO-STAT-OKS                                          
              MOVE 'DEU'          TO MSG-COD-SIST                       
              MOVE 'LCC NO EXIST' TO MSG-COD-MENS                       
              PERFORM GET-MSG                                           
              MOVE MSG-GLS-DESC   TO FRM-MENS                           
              MOVE FRM-SUAR-MAL   TO FRM-SUAR.                          
           GO TO FIN-VAL-FRM-IIC-ILIC.
      *>>>>                                                             
*% END
*% IF FIN_KEY_ALL_RLO
      *<<<< FIN_KEY_ALL_RLO                                             
           IF RLO-NUM-IOPC IN RLO-FLD > ZEROES                          
              MOVE 'LDC'    TO RLO-COD-CPTO IN RLO                      
           ELSE                                                         
              MOVE 'OPC'    TO RLO-COD-CPTO IN RLO.                     
      *>>>>                                                             
*% END
*% IF INI_FRM_GLS_ICLI
                                                                        
           IF FRM-GLS-ICLI IN RLO-FLD NOT > IDC-INIC-GLS                
              MOVE IDC-INIC-GLS TO FRM-GLS-ICLI IN RLO-FLD.             
      *VAL-GLS para IDC valida glosa ( extension ) de identificador     
      *    MOVE FRM-GLS-ICLI IN RLO-FLD TO IDC-GLS-RUTV.                
      *    PERFORM VAL-GLS.                                             
      *    MOVE IDC-GLS-RUTV TO FRM-GLS-ICLI IN RLO-FLD.                
           GO TO FIN-VAL-FRM-GLS-ICLI.      
*% END
*% IF INI_RLO_IIC_ILIC
      *<<<<
      *AFRI-INI/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
           IF SCR-CMND = WSS-GLS-IBLI
                GO TO FIN-VAL-RLO-IIC-ILIC.                             
      *AFRI-FIN/AGOSTO 2015 IMPRESION DOCUMENTO FOGAPE
      *>>>>         
           IF RLO-IIC-ILIC IN RLO-FLD NOT > SPACES AND                  
              SCR-CMND NOT = 'CON'                                      
                PERFORM ERR-GLS                                         
                GO TO FIN-VAL-RLO-IIC-ILIC.                             
           GO TO FIN-VAL-RLO-IIC-ILIC.
*% END
*% IF FIN_RLO_CAI_IOPC
      *AFRI-INI/JUN07                                                   
      *AFRI-INI/LOF/CHC/07-2009                                         
      *    IF SCR-CMND = 'RBJ' AND                                      
           IF (SCR-CMND = 'RBJ' OR SCR-CMND = 'ING') AND                
      *AFRI-FIN/LOF/CHC/07-2009                                         
              RLO-NUM-IOPC IN RLO-FLD NOT > ZEROES                      
              MOVE RLO-CAI-IOPC IN RLO-FLD TO OPC-CAI-IOPC IN OPC       
              MOVE RLO-IIC-IOPC IN RLO-FLD TO OPC-IIC-IOPC IN OPC       
              MOVE FIO-GET-KEY             TO FIO-CMND                  
              PERFORM COL-FIO-OPC                                       
              IF NOT FIO-STAT-OKS                                       
                 MOVE 'COL' TO MSG-COD-SIST                             
      *AFRI-INI/LOF/CHC/07-2009                                         
                 MOVE 'OPC    NEX' TO MSG-COD-MENS                      
      *AFRI-FIN/LOF/CHC/07-2009                                         
                 PERFORM GET-MSG                                        
                 MOVE MSG-GLS-DESC TO FRM-MENS                          
                 MOVE FRM-SUAR-MAL TO FRM-SUAR                          
                 GO TO FIN-VAL-RLO-CAI-IOPC                             
              ELSE                                                      
                 PERFORM GET-FHOY                                       
                 IF OPC-FEC-FINP IN OPC = HOY-FHOY                      
                    MOVE 'DEU' TO MSG-COD-SIST                          
                    MOVE 'RBJ NO VAL' TO MSG-COD-MENS                   
                    PERFORM GET-MSG                                     
                    MOVE MSG-GLS-DESC TO FRM-MENS                       
                    MOVE FRM-SUAR-MAL TO FRM-SUAR.                      
      *AFRI-FIN/JUN07                                                   
      *>>>>
*% END
*% IF FIN_RLO_IIC_IOPC
      *AFRI-INI/JUN07                                                   
      *AFRI-INI/LOF/CHC/07-2009                                         
      *    IF SCR-CMND = 'RBJ' AND                                      
           IF (SCR-CMND = 'RBJ' OR SCR-CMND = 'ING') AND                
      *AFRI-FIN/LOF/CHC/07-2009                                         
              RLO-NUM-IOPC IN RLO-FLD NOT > ZEROES                      
              MOVE RLO-CAI-IOPC IN RLO-FLD TO OPC-CAI-IOPC IN OPC       
              MOVE RLO-IIC-IOPC IN RLO-FLD TO OPC-IIC-IOPC IN OPC       
              MOVE FIO-GET-KEY             TO FIO-CMND                  
              PERFORM COL-FIO-OPC                                       
              IF NOT FIO-STAT-OKS                                       
                 MOVE 'COL' TO MSG-COD-SIST                             
      *AFRI-INI/LOF/CHC/07-2009                                         
                 MOVE 'OPC    NEX' TO MSG-COD-MENS                      
      *AFRI-FIN/LOF/CHC/07-2009                                         
                 PERFORM GET-MSG                                        
                 MOVE MSG-GLS-DESC TO FRM-MENS                          
                 MOVE FRM-SUAR-MAL TO FRM-SUAR                          
                 GO TO FIN-VAL-RLO-IIC-IOPC                             
              ELSE                                                      
                 PERFORM GET-FHOY                                       
                 IF OPC-FEC-FINP IN OPC = HOY-FHOY                      
                    MOVE 'DEU' TO MSG-COD-SIST                          
                    MOVE 'RBJ NO VAL' TO MSG-COD-MENS                   
                    PERFORM GET-MSG                                     
                    MOVE MSG-GLS-DESC TO FRM-MENS                       
                    MOVE FRM-SUAR-MAL TO FRM-SUAR.                      
      *AFRI-FIN/JUN07 
      *>>>>                                                  
*% END
*% IF INI_RLO_NUM_IOPC
      *>>>>
      *AFRI-INI/LOF/CHC/07-2009                                         
           IF SCR-CMND = 'ING' AND RLO-NUM-IOPC IN RLO-FLD > ZEROES     
               MOVE 'COL' TO MSG-COD-SIST                               
               MOVE 'RBJNOVALPL' TO MSG-COD-MENS                        
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE FRM-SUAR-MAL TO FRM-SUAR                            
               GO TO FIN-VAL-RLO-NUM-IOPC.                              
      *AFRI-FIN/LOF/CHC/07-2009                                         
      *>>>>
*% END
*% IF INI_RLO_COD_CGTA
      *<<<<
           IF RLO-COD-CGTA IN RLO-FLD NOT > SPACES                      
              MOVE SPACES TO RLO-COD-CGTA IN RLO-FLD.                   
           IF RLO-COD-CGTA IN RLO-FLD NOT > SPACES AND SCR-CMND = 'RBJ' 
              PERFORM ERR-GLS.                                          
                                                                        
           IF SCR-CMND NOT = 'RBJ'                                      
              GO TO FIN-VAL-RLO-COD-CGTA.                               
           MOVE 'COL'                   TO FIO-SIST.                    
           MOVE 'GARA'                  TO MSC-COD-TMSC IN MSC.         
           MOVE RLO-COD-CGTA IN RLO-FLD TO MSC-COD-CMSC IN MSC.         
           MOVE FIO-GET-KEY    TO FIO-CMND.                             
           PERFORM GNS-FIO-MSC.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'GNS'          TO MSG-COD-SIST                      
               MOVE 'COD    NEX'   TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC   TO FRM-MENS                          
               MOVE FRM-SUAR-MAL   TO FRM-SUAR                          
               GO TO FIN-VAL-RLO-COD-CGTA.                              
           IF  MSC-IND-VIGE IN MSC NOT = 'S'                            
               MOVE 'GNS'          TO MSG-COD-SIST                      
               MOVE 'COD    NVG'   TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC   TO FRM-MENS                          
               MOVE FRM-SUAR-MAL   TO FRM-SUAR                          
               GO TO FIN-VAL-RLO-COD-CGTA.
           MOVE MSC-GLS-DATA IN MSC TO VLI-TAB-GLS-GARA.                
           IF VLI-TAB-MSC-GARA NOT = 'F'                                
               MOVE 'DEU'          TO MSG-COD-SIST                      
               MOVE 'GAR NO FOGAP' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC   TO FRM-MENS                          
               MOVE FRM-SUAR-MAL   TO FRM-SUAR.                       
           GO TO FIN-VAL-RLO-COD-CGTA.
      *>>>>
*% END                                    
*% IF INI_RLO_FEC_FACT
      *<<<<
           IF RLO-FEC-FACT IN RLO-FLD  NOT > ZEROES                     
              PERFORM GET-FHOY                                          
              MOVE HOY-DHOY TO RLO-NUM-DACT IN RLO-FLD                  
              MOVE HOY-MHOY TO RLO-NUM-MACT IN RLO-FLD                  
              MOVE HOY-SHOY TO RLO-NUM-SACT IN RLO-FLD                  
              MOVE HOY-AHOY TO RLO-NUM-AACT IN RLO-FLD.                 
           GO TO FIN-VAL-RLO-FEC-FACT.
      *>>>>
*% END                                    
*% IF INI_FRM_GLS_CLIE
                                                                        
           IF FRM-GLS-CLIE IN RLO-FLD NOT > IDC-INIC-GLS                
              MOVE IDC-INIC-GLS TO FRM-GLS-CLIE IN RLO-FLD.             
      *VAL-GLS para IDC valida glosa ( extension ) de identificador     
           MOVE FRM-GLS-CLIE IN RLO-FLD TO IDC-GLS-RUTV.                
      *AFRI-INI/LOF/CHC/07-2009
      *    PERFORM VAL-GLS.                                             
      *AFRI-INI/LOF/CHC/07-2009
           MOVE IDC-GLS-RUTV TO FRM-GLS-CLIE IN RLO-FLD.                
                                                                        
           GO TO FIN-VAL-FRM-GLS-CLIE.
*% END                                    
*% IF FIN_RLO_COD_DENV
           IF RLO-COD-DENV IN RLO-FLD NOT > SPACES AND SCR-CMND = 'RBJ' 
              PERFORM ERR-GLS.                                          
           IF SCR-CMND NOT = 'RBJ'                                      
              GO TO FIN-VAL-RLO-COD-DENV.                               
           MOVE 'COL'              TO TAB-COD-SIST FIO-SIST.            
           MOVE 'DES'              TO TAB-COD-TTAB IN TAB.              
           MOVE RLO-COD-DENV IN RLO-FLD   TO TAB-COD-CTAB IN TAB.       
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM GNS-FIO-TAB.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'GNS'          TO MSG-COD-SIST                      
               MOVE 'COD    NEX'   TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC   TO FRM-MENS                          
               MOVE FRM-SUAR-MAL   TO FRM-SUAR                          
               GO TO FIN-VAL-RLO-COD-DENV.                              
           IF  MSC-IND-VIGE IN MSC NOT = 'S'                            
               MOVE 'GNS'          TO MSG-COD-SIST                      
               MOVE 'COD    NVG'   TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC   TO FRM-MENS                          
               MOVE FRM-SUAR-MAL   TO FRM-SUAR                          
               GO TO FIN-VAL-RLO-COD-DENV.                              
           MOVE TAB-GLS-DATA IN TAB TO VLI-TAB-GLS-CDOC.                
           IF NOT ( VLI-TAB-COD-CDOC = 'K' OR                           
              VLI-TAB-COD-CDOC = 'I')                                   
              MOVE 'DEU'          TO MSG-COD-SIST                       
              MOVE 'DES NO FOGAP' TO MSG-COD-MENS                       
              PERFORM GET-MSG                                           
              MOVE MSG-GLS-DESC   TO FRM-MENS                           
              MOVE FRM-SUAR-MAL   TO FRM-SUAR.                          
*% END
*% IF FIN_FRM_VAL_MLIB
           IF SCR-CMND = 'ANC' AND FRM-VAL-MLIB IN RLO-FLD NOT > ZEROES 
      *AFRI-INI/LOF/CHC/07-2009
      *        PERFORM ERR-GLS
               MOVE 'DEU'          TO MSG-COD-SIST
               MOVE 'ANC Y MLIB=0' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC   TO FRM-MENS
               MOVE FRM-SUAR-MAL   TO FRM-SUAR
      *AFRI-FIN/LOF/CHC/07-2009
               GO TO FIN-VAL-FRM-VAL-MLIB.

      *AFRI-INI/LOF/CHC/07-2009
           IF SCR-CMND NOT = 'LIB'
              GO TO FIN-VAL-FRM-VAL-MLIB.                               
                                                                        
           MOVE ZEROES TO WSS-POR-MLIB IN WSS.
      *AFRI-FIN/LOF/CHC/07-2009
           IF FRM-VAL-MLIB IN RLO-FLD >  ZEROES                         
      *AFRI-INI/LOF/CHC/07-2009
               MOVE 'DEU'         TO MSG-COD-SIST
               MOVE 'MLIB > 0'    TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC  TO FRM-MENS
               MOVE FRM-SUAR-MAL  TO FRM-SUAR
               MOVE ZEROES TO FRM-VAL-MLIB IN RLO-FLD
      *AFRI-FIN/LOF/CHC/07-2009
               GO TO FIN-VAL-FRM-VAL-MLIB.                              
           IF RLO-NUM-IOPC IN RLO-FLD NOT = ZEROES                      
      *AFRI-INI/LOF/CHC/07-2009
      *        MOVE 'DEU'         TO MSG-COD-SIST
      *        MOVE 'NUMIOPC > 0' TO MSG-COD-MENS
      *        PERFORM GET-MSG
      *        MOVE MSG-GLS-DESC  TO FRM-MENS
      *        MOVE FRM-SUAR-MAL  TO FRM-SUAR
               GO TO FIN-VAL-FRM-VAL-MLIB.                              

           MOVE RLO-CAI-IOPC IN RLO-FLD TO OPC-CAI-IOPC IN OPC.
           MOVE RLO-IIC-IOPC IN RLO-FLD TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'OPC    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-FRM-VAL-MLIB.                              

           IF OPC-COD-TOOC IN OPC = 'AVC'
               MOVE 'DEU'        TO MSG-COD-SIST
               MOVE 'TOOC=AVC'   TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-FRM-VAL-MLIB.

           MOVE RLO-CAI-ILIC IN RLO-FLD TO RLO-CAI-ILIC IN RLO.
           MOVE RLO-IIC-ILIC IN RLO-FLD TO RLO-IIC-ILIC IN RLO.
           MOVE 'OPC'                   TO RLO-COD-CPTO IN RLO.
           MOVE RLO-CAI-IOPC IN RLO-FLD TO RLO-CAI-IOPC IN RLO.
           MOVE RLO-IIC-IOPC IN RLO-FLD TO RLO-IIC-IOPC IN RLO.
           MOVE ZEROES                  TO RLO-NUM-IOPC IN RLO.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM LDC-FIO-RLO.
           IF NOT FIO-STAT-OKS
               MOVE 'DEU' TO MSG-COD-SIST
               MOVE 'LDC NO LIC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-FRM-VAL-MLIB.

           IF RLO-IND-CMND IN RLO NOT = 'RBJ'
               MOVE 'DEU'        TO MSG-COD-SIST
               MOVE 'PREVNORBJ'  TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-FRM-VAL-MLIB.

           MOVE RLO-CIC-ILIC IN RLO TO LCC-CIC-ILIC IN LCC.
           MOVE 'LCC-KEY-ILIC'      TO FIO-AKEY.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM LDC-FIO-LCC.
           IF NOT FIO-STAT-OKS
               MOVE 'DEU' TO MSG-COD-SIST
               MOVE 'NOEXIS   LCC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-FRM-VAL-MLIB.

           MOVE LCC-CAI-ICLF IN LCC TO CLF-CAI-ICLF IN CLF.
           MOVE LCC-IIC-ICLF IN LCC TO CLF-IIC-ICLF IN CLF.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM LDC-FIO-CLF.
           IF NOT FIO-STAT-OKS
               MOVE 'DEU'        TO MSG-COD-SIST
               MOVE 'CLF    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-FRM-VAL-MLIB.

           PERFORM OBT-COD-VLR.
           IF WSS-COD-PESO IN WSS = ZEROES
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE 'CODTVLRNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-FRM-VAL-MLIB.
      *AFRI-FIN/LOF/CHC/07-2009
      *********************************
      *RUTINA BDO
      *    PERFORM LOC-LLE-ENT.
      *    INGRESA PARAMETROS DE ENTRADA BGBDO
           MOVE RLO-CAI-IOPC IN RLO-FLD TO BDO-CAI-IOPC IN BDO-VARI.
           MOVE RLO-IIC-IOPC IN RLO-FLD TO BDO-IIC-IOPC IN BDO-VARI.
           PERFORM GET-FHOY.
           MOVE HOY-FHOY TO BDO-FEC-FPRO IN BDO-VARI.

           PERFORM OBT-OPE-ANT.
           PERFORM OBT-OPE-ORI.
           MOVE BDO-CIC-ORIG TO BDO-CIC-IOPC IN BDO-VARI.
           IF (BDO-CIC-PROR > SPACES)
               MOVE BDO-CIC-PROR TO BDO-CIC-IOPC IN BDO-VARI.

           PERFORM OBT-SAL-OPC.
           MOVE RLO-CAI-IOPC IN RLO-FLD TO BDO-CAI-IOPC IN BDO-VARI.
           MOVE RLO-IIC-IOPC IN RLO-FLD TO BDO-IIC-IOPC IN BDO-VARI.
           PERFORM BUS-OPC-VOP2.
      *    PERFORM LOC-RES-ENT.
      *RUTINA BDO
      *********************************
      *    MOVE RLO-CAI-IOPC IN RLO-FLD TO CAN-CAI-IOPC IN CAN.
      *    MOVE RLO-IIC-IOPC IN RLO-FLD TO CAN-IIC-IOPC IN CAN.
      *    MOVE ZEROES                  TO CAN-NUM-ICAN IN CAN.
      *    MOVE FIO-GET-NLS TO FIO-CMND.
      *LEE-SIG-CAN.
      *    PERFORM COL-FIO-CAN.
      *    IF NOT ( FIO-STAT-OKS AND
      *       RLO-CAI-IOPC IN RLO-FLD =  CAN-CAI-IOPC IN CAN AND
      *       RLO-IIC-IOPC IN RLO-FLD =  CAN-IIC-IOPC IN CAN )
      *AFRI-INI/LOF/CHC/07-2009
      *    IF NOT FIO-STAT-OKS
      *        MOVE 'COL'        TO MSG-COD-SIST
      *        MOVE 'CAN    NEX' TO MSG-COD-MENS
      *       PERFORM GET-MSG
      *       MOVE MSG-GLS-DESC   TO FRM-MENS
      *        MOVE FRM-SUAR-MAL TO FRM-SUAR
      *        GO TO FIN-VAL-FRM-VAL-MLIB.

      *    IF NOT (RLO-CAI-IOPC IN RLO-FLD = CAN-CAI-IOPC IN CAN AND
      *     RLO-IIC-IOPC IN RLO-FLD = CAN-IIC-IOPC IN CAN )
      *AFRI-FIN/LOF/CHC/07-2009
      *        GO TO FIN-VAL-FRM-VAL-MLIB.
      *    IF CAN-MSC-STAT IN CAN NOT = 'A'
      *        MOVE FIO-GET-NXT TO FIO-CMND
      *        GO TO LEE-SIG-CAN.
      *AFRI-INI/LOF/CHC/07-2009
      *    PERFORM BUS-REG-CXE.
      *    IF WSS-EXI-RCXE IN WSS = 'S'
      *        MOVE FIO-GET-NXT TO FIO-CMND
      *        GO TO LEE-SIG-CAN.
      *AFRI-FIN/LOF/CHC/07-2009
      *    MOVE CAN-KEY-ICAN IN CAN TO RCV-KEY-ICAN IN RCV
      *    MOVE SPACES              TO RCV-CIC-IOPV IN RCV
      *    MOVE ZEROES              TO RCV-NUM-IVCT IN RCV
      *    MOVE FIO-GET-NLS TO FIO-CMND.
      *    PERFORM COL-FIO-RCV.
      *    IF NOT ( FIO-STAT-OKS AND
      *       CAN-KEY-ICAN IN CAN = RCV-KEY-ICAN IN RCV )
      *        MOVE FIO-GET-NXT TO FIO-CMND
      *        GO TO LEE-SIG-CAN.
      *AFRI-INI/LOF/CHC/07-2009
      *    COMPUTE WSS-POR-MLIB IN WSS = RLO-VAL-PGAR IN RLO *
      *     RCV-SGV-CAPI IN RCV.
      *    DIVIDE WSS-POR-MLIB IN WSS BY 100 GIVING WSS-POR-MLIB IN WSS.
      *    PERFORM DET-MON-LIC.
      *AFRI-FIN/LOF/CHC/07-2009
      *    COMPUTE FRM-VAL-MLIB IN RLO-FLD = FRM-VAL-MLIB IN RLO-FLD +
      *AFRI-INI/LOF/CHC/07-2009
      *            RCV-SGV-CAPI IN RCV.
      *            WSS-POR-MLIB IN WSS.
      *AFRI-FIN/LOF/CHC/07-2009
      *    MOVE FIO-GET-NXT TO FIO-CMND.
      *AFRI-INI/LOF/CHC/07-2009
      *    MOVE ZEROES TO WSS-POR-MLIB IN WSS.
      *AFRI-FIN/LOF/CHC/07-2009
      *    GO TO LEE-SIG-CAN.
*% END
*% IF EOF_BU
                                                                        
      *AFRI-INI/LOF/CHC/07-2009
      *----------------------------------------------------------------
      *DETERMINA LA MONEDA DE LA LICITACION
      *----------------------------------------------------------------
       DET-MON-LIC SECTION.
       INI-DET-MON-LIC.
           IF WSS-COD-PESO IN WSS = LCC-COD-VCOC IN LCC
               MOVE 'S' TO WSS-IND-MONE IN WSS
           ELSE
               MOVE 'N' TO WSS-IND-MONE IN WSS.
           IF OPC-COD-VCOC IN OPC = LCC-COD-VCOC IN LCC
               GO TO FIN-DET-MON-LIC.
           IF OPC-COD-VCOC IN OPC NOT = WSS-COD-PESO IN WSS
               MOVE OPC-COD-VCOC IN OPC    TO CAM-COD-VCAM IN CAM(1)
               MOVE WSS-COD-PESO IN WSS    TO CAM-COD-VCAM IN CAM(2)
               MOVE OPC-NUM-DCOL IN OPC    TO CAM-NUM-DCAM IN CAM(1)
               MOVE OPC-NUM-MCOL IN OPC    TO CAM-NUM-MCAM IN CAM(1)
               MOVE OPC-NUM-SCOL IN OPC    TO CAM-NUM-SCAM IN CAM(1)
               MOVE OPC-NUM-ACOL IN OPC    TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT (FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
                   MOVE 'TAB'        TO MSG-COD-SIST
                   MOVE 'CAM    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-DET-MON-LIC
               ELSE
                   MULTIPLY WSS-POR-MLIB IN WSS BY CAM-SGV-VCAM IN CAM
                                     GIVING WSS-POR-MLIB IN WSS ROUNDED.
           IF LCC-COD-VCOC IN LCC = WSS-COD-PESO IN WSS
               GO TO FIN-DET-MON-LIC.
           MOVE LCC-COD-VCOC IN LCC    TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN WSS    TO CAM-COD-VCAM IN CAM(2).
           MOVE OPC-NUM-DCOL IN OPC    TO CAM-NUM-DCAM IN CAM(1).
           MOVE OPC-NUM-MCOL IN OPC    TO CAM-NUM-MCAM IN CAM(1).
           MOVE OPC-NUM-SCOL IN OPC    TO CAM-NUM-SCAM IN CAM(1).
           MOVE OPC-NUM-ACOL IN OPC    TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT (FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
              MOVE 'TAB'        TO MSG-COD-SIST
              MOVE 'CAM    NEX' TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE FRM-SUAR-MAL TO FRM-SUAR
              GO TO FIN-DET-MON-LIC
           ELSE
              DIVIDE WSS-POR-MLIB IN WSS BY CAM-SGV-VCAM IN CAM
                                     GIVING WSS-POR-MLIB IN WSS ROUNDED.
           IF LCC-COD-VCOC IN LCC = WSS-COD-PESO IN WSS
              MOVE WSS-POR-MLIB IN WSS TO PES-SGV-DECI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE TO WSS-POR-MLIB IN WSS.
       FIN-DET-MON-LIC.
           EXIT.
      *----------------------------------------------------------------
      *OBTIENE CODIGO DE PESO DE LA TABLA VLR
      *----------------------------------------------------------------
       OBT-COD-VLR SECTION.
       INI-OBT-COD-VLR.
           MOVE ZEROES TO WSS-COD-PESO IN WSS.
           MOVE 'TAB'          TO TAB-COD-SIST FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999'         TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
               GO TO FIN-OBT-COD-VLR
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS.
       FIN-OBT-COD-VLR.
           EXIT.
      *----------------------------------------------------------------
      *
      *----------------------------------------------------------------
       BUS-REG-CXE SECTION.
       INI-BUS-REG-CXE.
           MOVE OPC-CAI-IOPC IN OPC      TO CXE-CAI-IOPC IN CXE.
           MOVE OPC-IIC-IOPC IN OPC      TO CXE-IIC-IOPC IN CXE.
           MOVE 'CAN'                    TO CXE-COD-EVEN IN CXE.
           MOVE CAN-NUM-ICAN IN CAN      TO CXE-NUM-EVEN IN CXE.
           MOVE SPACES                   TO CXE-CIC-IOPV IN CXE.
           MOVE ZEROES                   TO CXE-NUM-IVCT IN CXE.
           MOVE 'LIBLIC'                 TO CXE-COD-CPTO IN CXE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CXE.
           IF FIO-STAT-OKS
               MOVE 'S' TO WSS-EXI-RCXE IN WSS
           ELSE
               MOVE 'N' TO WSS-EXI-RCXE IN WSS.
       FIN-BUS-REG-CXE.
           EXIT.
      *----------------------------------------------------------------
      *
      *----------------------------------------------------------------
       BUS-OPC-VOP2 SECTION.
       INI-BUS-OPC-VOP2.
      *BUSCA OPERACIONES ASOCIADAS A OPC ORIG
                                                                        
           MOVE SPACES       TO BDO-IND-ICTT IN BDO-VARI.
           MOVE ZEROES       TO BDO-NUM-IVEN IN BDO-VARI.
                                                                        
           MOVE BDO-CIC-IOPC IN BDO-VARI TO BDO-CIC-IOPE IN BDO-VARI.
           MOVE ZEROES                   TO BDO-NUM-ICAN IN BDO-VARI.
           MOVE ZEROES                   TO BDO-NUM-IVEN IN BDO-VARI.
           PERFORM GRB-VOPC.

      *COMIENZA EL PROCESO
           MOVE BDO-CIC-IOPC IN BDO-VARI TO CAN-CIC-IOPC IN CAN.        
           MOVE ZEROES                   TO CAN-NUM-ICAN IN CAN.        
           MOVE FIO-GET-NLS              TO FIO-CMND.                   
       LUP-BUS-OPC-VOP2.                                                
           PERFORM COL-FIO-CAN.                                         
           IF (NOT FIO-STAT-OKS OR                                      
               BDO-CIC-IOPC IN BDO-VARI NOT = CAN-CIC-IOPC IN CAN)      
                GO TO FIN-BUS-OPC-VOP2
           ELSE
                MOVE ADR-CAN-REQA TO ADR-BDO-REQA.                      

           MOVE CAN-NUM-ICAN IN CAN TO BDO-NUM-ICAN IN BDO-VARI.
           PERFORM BUS-RCV-VOPC.
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO NXT-BUS-OPC-VOP2.

      **************************
           MOVE BDO-CIC-IOPC IN BDO-VARI TO OPC-CIC-IOPC IN OPC.        
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM COL-FIO-OPC.                                         

           PERFORM BUS-REG-CXE.
           IF WSS-EXI-RCXE IN WSS = 'S'
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO NXT-BUS-OPC-VOP2.

           COMPUTE WSS-POR-MLIB IN WSS = RLO-VAL-PGAR IN RLO *
            BDO-RCV-CAPI IN BDO-VARI.

           DIVIDE WSS-POR-MLIB IN WSS BY 100 GIVING WSS-POR-MLIB IN WSS.

      *    PERFORM PRO-LEE-LCC.
           PERFORM DET-MON-LIC.

           COMPUTE FRM-VAL-MLIB IN RLO-FLD = FRM-VAL-MLIB IN RLO-FLD +
                                             WSS-POR-MLIB IN WSS.

      *    IF WSS-IND-MONE IN WSS = 'N'
      *        MOVE SPACES TO MSG-COD-MENS
      *        PERFORM PRO-CAM-CXE
      *        IF MSG-COD-MENS > SPACES
      *            GO TO FIN-BUS-OPC-VOP2.

      *    IF WSS-POR-MLIB IN WSS > ZEROES
      *        PERFORM PRO-GRA-CXE.

      *    MOVE CAN-FEC-FCAN IN CAN TO WSS-FEC-FCAN IN WSS.

           MOVE ZEROES TO WSS-POR-MLIB IN WSS.
      **************************

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                GO TO NXT-BUS-OPC-VOP2.

      *    VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                MOVE 'S' TO BDO-IND-ICTT IN BDO-VARI
                GO TO FIN-BUS-OPC-VOP2.

      *    VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                GO TO NXT-BUS-OPC-VOP2.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                GO TO NXT-BUS-OPC-VOP2.

      *    VALIDO TIPO DE CANCELACION: PRORROGA
           IF (CAN-MSC-CANC IN CAN = 'PTT' OR 'KTT')                    
                PERFORM BUS-VOPC-PTT
                GO TO FIN-BUS-OPC-VOP2.

      *    VALIDA SI CANCELACION ES PRODUCTO DE TRASPASO
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.             
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.             
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.             
           MOVE FIO-GET-NLS         TO FIO-CMND.                        
           PERFORM COL-FIO-CYA.                                         
                                                                        
      *    SIN CYA => CAN NO TRASPASO
           IF NOT (FIO-STAT-OKS AND                                     
               CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND            
               CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA)               
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    PERFORM BUS-VOPC-PTT
                    GO TO FIN-BUS-OPC-VOP2
               ELSE
                    GO TO NXT-BUS-OPC-VOP2.                             

      *--------- PRODUCTO TRASPASO ---------                            
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.        
                                                                        
      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND                 
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')                    
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    GO TO FIN-BUS-OPC-VOP2
               ELSE
                    GO TO NXT-BUS-OPC-VOP2.                             

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR                      
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')                        
                PERFORM BUS-NEW-VOPC
                     GO TO NXT-BUS-OPC-VOP2.                            

       NXT-BUS-OPC-VOP2.                                                
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           MOVE ADR-BDO-REQA TO ADR-CAN-REQA.                           
           MOVE FIO-KDEF-S TO FIO-KDEF.                                 
           GO TO LUP-BUS-OPC-VOP2.

       FIN-BUS-OPC-VOP2.
           EXIT.
      *----------------------------------------------------------------
      *
      *----------------------------------------------------------------
      *AFRI-FIN/LOF/CHC/07-2009
*% END
