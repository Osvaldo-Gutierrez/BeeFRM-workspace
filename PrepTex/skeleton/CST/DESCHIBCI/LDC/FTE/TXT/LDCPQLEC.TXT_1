*%! NO_TIENE_TIMESTAMP = TRUE
*% FRM = 'LEC'
*% FNCPQ = ""
*% VSNPQ = ""
*% GEN_BCI = TRUE
*% FMT_CHI = TRUE
*% LARGO_MI_COMMAREA = 10
*% PGM_PTC = TRUE
*% IF MI_COMMAREA
      *<<<< MI_COMMAREA                                                 
              05 SCR-IMAX      COMP                   PIC S9(04).       
              05 SCR-I         COMP                   PIC S9(04).       
      *>>>>                                                             
*% END
*% IF WSS
      *<<<< WSS                                                         
       COPY LDCWXLEC.                                                   
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<<                                                             
           MOVE SPACES TO FRM-MEN1.                                     
           IF FRM-FFLD = FRM-FFLD-PF5                                   
               MOVE PGM-SNUL TO PGM-STAT-LMO                            
               MOVE PGM-SNUL TO PGM-STAT-LMO                            
               SUBTRACT 1 FROM SCR-I GIVING LEC-I                       
               IF LEC-I NOT > ZEROES                                    
                   MOVE 'LMO LDCPRV' TO MSG-COD-MENS                    
                   GO TO ERR-FND-KEY                                    
               ELSE                                                     
                   GO TO CARGA-LEC                                      
           ELSE                                                         
           IF FRM-FFLD = FRM-FFLD-PF6                                   
               MOVE PGM-SNUL TO PGM-STAT-LMO                            
               MOVE PGM-SNUL TO PGM-STAT-LMO                            
               ADD 1 SCR-I GIVING LEC-I                                 
               IF LEC-I > SCR-IMAX                                      
                   MOVE 'LMO LDCNXT' TO MSG-COD-MENS                    
                   GO TO ERR-FND-KEY                                    
               ELSE                                                     
                   GO TO CARGA-LEC.                                     
           GO TO CON-FND-KEY.                                           
      *>>>>                                                             
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY                                                 
           IF NOT FIO-STAT-OKS                                          
               GO TO FIN-FND-KEY.                                       
       CON-FND-KEY.                                                     
           MOVE ZEROES TO SCR-IMAX.                                     
           MOVE 1 TO SCR-I.                                             
           MOVE '00' TO FIO-STAT.                                       
           PERFORM OBT-DAT-TS.                                          
           MOVE 1 TO SCR-I.                                             
           MOVE SCR-I TO LEC-I.                                         
       CARGA-LEC.                                                       
           MOVE SPACES TO MSG-COD-MENS.                                 
           IF NOT SCR-OFRM-SRV                                          
             PERFORM PUT-TAB-LEC.                                       
             MOVE '00' TO FIO-STAT.                                     
             GO TO FIN-FND-KEY.                                         
      *                                                                 
       ERR-FND-KEY.                                                     
           MOVE SCR-STAT-CON TO SCR-STAT.                               
           MOVE 'LDC'  TO MSG-COD-SIST.                                 
           PERFORM GET-MSG.                                             
           MOVE MSG-GLS-DESC TO FRM-MEN1.                               
           MOVE '00' TO FIO-STAT.                                       
           GO TO FIN-FND-KEY.                                           
      *>>>>                                                             
*% END
*% IF EOF
      *<<<<
       CAR-MOR-LMO SECTION.                                             
       INI-CAR-MOR-LMO.                                                 
           MOVE LMO-NUM-SMOV IN LEC-FLD TO LMO-NUM-SMOV IN LMO.         
           MOVE LMO-NUM-AMOV IN LEC-FLD TO LMO-NUM-AMOV IN LMO.         
           MOVE LMO-NUM-MMOV IN LEC-FLD TO LMO-NUM-MMOV IN LMO.         
           MOVE LMO-NUM-DMOV IN LEC-FLD TO LMO-NUM-DMOV IN LMO.         
           MOVE SPACES                  TO LMO-HRA-HMOV IN LMO.         
           MOVE SPACES                  TO LMO-CIC-ICLF IN LMO.         
           MOVE ZEROES                  TO LMO-NUM-ILDC IN LMO.         
           MOVE ZEROES                  TO LMO-NUM-IMOV IN LMO.         
           MOVE FIO-GET-NLS TO FIO-CMND.                                
       LUP-CAR-MOR-LMO.                                                 
           PERFORM LDC-FIO-LMO.                                         
           IF NOT ( FIO-STAT-OKS AND                                    
               LMO-NUM-DMOV IN LMO = LMO-NUM-DMOV IN LEC-FLD AND        
               LMO-NUM-MMOV IN LMO = LMO-NUM-MMOV IN LEC-FLD AND        
               LMO-NUM-SMOV IN LMO = LMO-NUM-SMOV IN LEC-FLD AND        
               LMO-NUM-AMOV IN LMO = LMO-NUM-AMOV IN LEC-FLD )          
               GO TO FIN-CAR-MOR-LMO.                                   
                                                                        
           MOVE LMO-CAI-ICLF IN LMO TO LMO-CAI-ICLF IN                  
                                       LEC-ARRE-TS(LEC-I).              
           MOVE LMO-IIC-ICLF IN LMO TO LMO-IIC-ICLF IN                  
                                       LEC-ARRE-TS(LEC-I).              
                                                                        
       NXT-CAR-MOR-LMO.                                                 
           PERFORM INC-REG-TS.                                          
       SIG-CAR-MOR-LMO.                                                 
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           GO TO LUP-CAR-MOR-LMO.                                       
                                                                        
       FIN-CAR-MOR-LMO.                                                 
           EXIT.                                                        
                                                                        
                                                                        
       OBT-PARAM SECTION.                                               
       INI-OBT-PARAM.                                                   
       FIN-OBT-PARAM.                                                   
           EXIT.                                                        
                                                                        
       OBT-DAT-TS SECTION.                                              
       INI-OBT-DAT-TS.                                                  
           EXEC CICS HANDLE CONDITION QIDERR(CON-OBT-DAT-TS)            
                                     ITEMERR(CON-OBT-DAT-TS)            
           END-EXEC.                                                    
                                                                        
           MOVE LEC-NOM-TSLEC    TO QUE-COLA.                           
           MOVE QUE-DEL          TO QUE-CMND.                           
           PERFORM GNS-PRO-QUE.                                         
       CON-OBT-DAT-TS.                                                  
           MOVE LEC-SI-IMP TO LEC-IMP.                                  
           PERFORM CLR-VEC-TS VARYING LEC-I FROM 1 BY 1 UNTIL           
                   LEC-I > LEC-IMAX.                                    
           MOVE 1 TO LEC-I.                                             
           PERFORM CAR-MOR-LMO.                                         
                                                                        
       NXT-OBT-DAT-TS.                                                  
           IF LEC-IMP = LEC-SI-IMP                                      
               PERFORM WRT-TS.                                          
       FIN-OBT-DAT-TS.                                                  
           EXIT.                                                        
                                                                        
       PUT-TAB-LEC SECTION.                                             
       INI-PUT-TAB-LEC.                                                 
           PERFORM RED-TS.                                              
           PERFORM LLE-DAT-PNT VARYING LEC-I FROM 1 BY 1                
                   UNTIL LEC-I > LEC-IMAX.                              
       FIN-PUT-TAB-LEC.                                                 
           EXIT.                                                        
                                                                        
       LLE-DAT-PNT SECTION.                                             
       INI-LLE-DAT-PNT.                                                 
           MOVE LMO-CAI-ICLF IN LEC-ARRE-TS(LEC-I) TO                   
                FRM-CAI-ICLF IN LEC-FLD(LEC-I).                         
           MOVE LMO-IIC-ICLF IN LEC-ARRE-TS(LEC-I) TO                   
                FRM-IIC-ICLF IN LEC-FLD(LEC-I).                         
       FIN-LLE-DAT-PNT.                                                 
           EXIT.                                                        
                                                                        
       INC-REG-TS SECTION.                                              
       INI-INC-REG-TS.                                                  
           MOVE LEC-SI-IMP TO LEC-IMP.                                  
           ADD 1 TO LEC-I.                                              
           IF LEC-I > LEC-IMAX                                          
               PERFORM WRT-TS                                           
               PERFORM CLR-VEC-TS VARYING LEC-I FROM 1 BY 1             
                                     UNTIL LEC-I > LEC-IMAX             
               MOVE 1 TO LEC-I                                          
               MOVE LEC-NO-IMP TO LEC-IMP.                              
       FIN-INC-REG-TS.                                                  
           EXIT.                                                        
                                                                        
      *<<<<                                                             
      *>>>>                                                             
                                                                        
       WRT-TS SECTION.                                                  
       INI-WRT-TS.                                                      
           ADD 1 TO SCR-IMAX.                                           
           MOVE LEC-NOM-TSLEC     TO QUE-COLA.                          
           MOVE LEC-TS            TO QUE-ITEM.                          
           MOVE LEC-LEN-TSLEC     TO QUE-LITM.                          
           MOVE LEC-I             TO QUE-NITM.                          
           MOVE QUE-PUT           TO QUE-CMND.                          
           PERFORM GNS-PRO-QUE.                                         
       FIN-WRT-TS.                                                      
           EXIT.                                                        
                                                                        
       RED-TS SECTION.                                                  
       INI-RED-TS.                                                      
           MOVE LEC-I TO SCR-I.                                         
           EXEC CICS HANDLE CONDITION QIDERR(FIN-RED-TS)                
                                     ITEMERR(FIN-RED-TS)                
           END-EXEC.                                                    
           MOVE LEC-NOM-TSLEC      TO QUE-COLA.                         
           MOVE LEC-TS             TO QUE-ITEM.                         
           MOVE LEC-LEN-TSLEC      TO QUE-LITM.                         
           MOVE LEC-I              TO QUE-NITM.                         
           MOVE QUE-GET            TO QUE-CMND.                         
           PERFORM GNS-PRO-QUE.                                         
           MOVE QUE-ITEM           TO LEC-TS.                           
       FIN-RED-TS.                                                      
           EXIT.                                                        
                                                                        
       CLR-VEC-TS SECTION.                                              
       INI-CLR-VEC-TS.                                                  
           MOVE SPACES TO LMO-CAI-ICLF IN LEC-ARRE-TS(LEC-I).           
           MOVE ZEROES TO LMO-IIC-ICLF IN LEC-ARRE-TS(LEC-I).           
       FIN-CLR-VEC-TS.                                                  
           EXIT.                                                        
                                                                        
       RST-STAT SECTION.                                                
       INI-RST-STAT.                                                    
           MOVE SCR-STPP     TO SCR-STAT.                               
           MOVE SCR-MFLD-NOT TO SCR-MFLD.                               
       FIN-RST-STAT.                                                    
           EXIT.                                                        
                                                                        
      *>>>>                                                             
*% END
