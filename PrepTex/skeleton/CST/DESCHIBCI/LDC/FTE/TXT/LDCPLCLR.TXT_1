*%! Codigo adicional para archivo LDCPLCLR
*% IF CMT_ID
      *<<<< CMT_ID
      *PROGRAMA PARA GENERAR RESUMENES POR TIPO DE LINEA Y TOTAL GENERAL
      *BANCO, UTILIZANDO ARCHIVO SORT GENERADO POR LDCPLCLF
      *>>>>
*% END
*% IF IOS
      *<<<< IOS
           SELECT RPTRBC       ASSIGN TO UT-S-RPTRBC.
      *>>>>
*% END
*% IF FD_RPT
      *<<<< FD_RPT
      *>>>>
*% END
*% IF FLS
      *<<<< FLS
       FD  RPTRBC LABEL RECORDS OMITTED
           REPORT IS RPT-RBC.
       01  PASO.
           03 FILLER                              PIC X(01).
      *>>>>
*% END
*% IF RR
      *<<<< RR
      *>>>>
*% END
*% IF RW
      *<<<< RW
       COPY LDCRWRBC.
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       01  WSS-VARI.
           03  WSS-COD-TIPO-ANT       VALUE SPACES   PIC X(03).
           03  WSS-COD-OFIC-ANT       VALUE SPACES   PIC X(03).
           03  WSS-COD-PESO                          PIC X(06).
           03  WSS-COD-UF                            PIC X(06).
           03  WSS-SGV-VCAM-UF                       PIC 9(11)V9(4).
           03  WSS-SGV-UF                            PIC 9(11)V9(4).
           03  WSS-FEC-FHOY.
               05 WSS-NUM-SHOY                       PIC 9(02).
               05 WSS-NUM-AHOY                       PIC 9(02).
               05 WSS-NUM-MHOY                       PIC 9(02).
               05 WSS-NUM-DHOY                       PIC 9(02).
       COPY GNSBRMSC.
       COPY GNSWGHOY.
       COPY GNSWGFEC.
       COPY GNSWGPES.
       COPY TABBRCAM.
       COPY TABWGTVC.
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
      *>>>>
*% END
*% IF RF
      *<<<< RF
      *>>>>
*% END
*% IF RT
      *<<<< RT
       COPY LDCRFRBC.
           .
       COPY LDCRTRBC.
      *>>>>
*% END
*% IF FIN_DEC
      *<<<< FIN_DEC
      *>>>>
*% END
*% IF INI
      *<<<< INI

      * OBTIENE COD. VALOR DE CAMBIO UF CON CIC DE LA MONEDA '0998'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0998  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO '
              DISPLAY ' ERROR EN OBTENCION CIC MONEDA 0998 : '
                        TAB-COD-CTAB IN TAB ' FS: ' FIO-STAT
              PERFORM GNS-PRO-ABT.

           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-UF IN WSS-VARI.

      * OBTIENE COD. VALOR DE CAMBIO PESOS CON CIC DE LA MONEDA '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO '
              DISPLAY ' ERROR EN OBTENCION CIC MONEDA 0999 : '
                        TAB-COD-CTAB IN TAB ' FS: ' FIO-STAT
              PERFORM GNS-PRO-ABT.

           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS-VARI.

           PERFORM GET-FHOY.
           MOVE HOY-SHOY           TO WSS-NUM-SHOY IN WSS-VARI.
           MOVE HOY-AHOY           TO WSS-NUM-AHOY IN WSS-VARI.
           MOVE HOY-MHOY           TO WSS-NUM-MHOY IN WSS-VARI.
           MOVE HOY-DHOY           TO WSS-NUM-DHOY IN WSS-VARI.

           MOVE WSS-NUM-DHOY IN WSS-VARI TO CAM-NUM-DCAM IN CAM(1).
           MOVE WSS-NUM-MHOY IN WSS-VARI TO CAM-NUM-MCAM IN CAM(1).
           MOVE WSS-NUM-SHOY IN WSS-VARI TO CAM-NUM-SCAM IN CAM(1).
           MOVE WSS-NUM-AHOY IN WSS-VARI TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
      *BUSCA VALOR DE CAMBIO DE UF A PESO
           MOVE WSS-COD-UF   IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT ( FIO-STAT-OKS AND CAM-MSC-STAT IN CAM = 'S' AND
                    CAM-SGV-VCAM IN CAM > 0 )
               DISPLAY 'ERROR: NO EXISTE VALOR DE CAMBIO DE : '
                 CAM-COD-VCAM IN CAM(1) ' A : '
                 CAM-COD-VCAM IN CAM(2) ' AL : '
                 CAM-FEC-FCAM IN CAM(1)
               PERFORM GNS-PRO-ABT
           ELSE
               MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-VCAM-UF IN WSS-VARI.
      *>>>>
*% END
*% IF INI_INP
      *<<<< INI_INP
      *>>>>
*% END
*% IF INI_FST_INP
      *<<<< INI_FST_INP
      *>>>>
*% END
*% IF FIN_FST_INP
      *<<<< FIN_FST_INP
      *MUEVE REGISTRO CABECERA
           IF CLR-GLS-FLAG1 IN CLR = '1'
               MOVE CLR-NUM-DPRO IN CLR TO WSS-NUM-DHAS IN WSS-RTL
               MOVE CLR-NUM-MPRO IN CLR TO WSS-NUM-MHAS IN WSS-RTL
               MOVE CLR-NUM-SPRO IN CLR TO WSS-NUM-SHAS IN WSS-RTL
               MOVE CLR-NUM-APRO IN CLR TO WSS-NUM-AHAS IN WSS-RTL

               MOVE CLR-NUM-DPRO IN CLR TO WSS-NUM-DHAS IN WSS-RBC
               MOVE CLR-NUM-MPRO IN CLR TO WSS-NUM-MHAS IN WSS-RBC
               MOVE CLR-NUM-SPRO IN CLR TO WSS-NUM-SHAS IN WSS-RBC
               MOVE CLR-NUM-APRO IN CLR TO WSS-NUM-AHAS IN WSS-RBC
               MOVE FIO-GET-NXT TO FIO-CMND
               PERFORM LDC-FIO-CLR
               IF NOT FIO-STAT-OKS
                   DISPLAY 'ERROR: NO HAY REGISTROS DETALLES EN LDCCLR'
                   DISPLAY ' '
                      PERFORM GNS-PRO-ABT.

           MOVE CLR-COD-TIPO IN CLR TO SRT-COD-TIPO IN SRT.
           MOVE CLR-COD-TIPO IN CLR TO WSS-COD-TIPO-ANT IN WSS-VARI.
           MOVE CLR-COD-OFIC IN CLR TO WSS-COD-OFIC IN WSS-RTL.
           MOVE CLR-COD-OFIC IN CLR TO WSS-COD-OFIC-ANT IN WSS-VARI.

           MOVE ZEROES TO WSS-VAL-ATRZ IN WSS-RTL.
           MOVE ZEROES TO WSS-VAL-UTIL IN WSS-RTL.
           MOVE ZEROES TO WSS-NUM-TLIN IN WSS-RTL.

           MOVE ZEROES TO WSS-VAL-ATRZ IN WSS-RBC.
           MOVE ZEROES TO WSS-VAL-UTIL IN WSS-RBC.
           MOVE ZEROES TO WSS-NUM-TLIN IN WSS-RBC.

           PERFORM BUS-GLS-TIPO.
      *>>>>
*% END
*% IF INI_OUT
      *<<<< INI_OUT
           OPEN OUTPUT RPTRBC.
           INITIATE RPT-RBC.
      *>>>>
*% END
*% IF FST_OUT
      *<<<< FST_OUT
      *>>>>
*% END
*% IF LUP_INP
      *<<<< LUP_INP
      *>>>>
*% END
*% IF RM
      *<<<< RM
      *>>>>
*% END
*% IF LUP_OUT
      *<<<< LUP_OUT

           IF CLR-COD-TIPO IN CLR = WSS-COD-TIPO-ANT IN WSS-VARI
               ADD 1 TO WSS-NUM-TLIN IN WSS-RBC
               IF CLR-COD-OFIC IN CLR = WSS-COD-OFIC-ANT IN WSS-VARI
                   ADD 1 TO WSS-NUM-TLIN IN WSS-RTL
                   IF CLR-COD-VCLC IN CLR = WSS-COD-UF IN WSS-VARI
      *MOVER VALORES EN UF
                     ADD CLR-VAL-CMAX IN CLR TO WSS-VAL-ATRZ IN WSS-RTL
                     ADD CLR-VAL-CMAX IN CLR TO WSS-VAL-ATRZ IN WSS-RBC
                     PERFORM CNV-ME-A-UF-UTIL
                   ELSE
      *CONVERTIR A UF
                     PERFORM CNV-ME-A-UF-ATRZ
                     PERFORM CNV-ME-A-UF-UTIL
               ELSE
      *NUEVA OFICINA
                   GENERATE DL-RTL
                   MOVE 1                   TO WSS-NUM-TLIN IN WSS-RTL
                   MOVE CLR-COD-OFIC IN CLR TO WSS-COD-OFIC IN WSS-RTL
                   MOVE CLR-COD-OFIC IN CLR TO
                        WSS-COD-OFIC-ANT IN WSS-VARI
                   MOVE ZEROES TO WSS-VAL-ATRZ IN WSS-RTL
                   MOVE ZEROES TO WSS-VAL-UTIL IN WSS-RTL
                   IF CLR-COD-VCLC IN CLR = WSS-COD-UF IN WSS-VARI
      *MOVER VALORES EN UF
                     ADD CLR-VAL-CMAX IN CLR TO WSS-VAL-ATRZ IN WSS-RTL
                     ADD CLR-VAL-CMAX IN CLR TO WSS-VAL-ATRZ IN WSS-RBC
                     PERFORM CNV-ME-A-UF-UTIL
                   ELSE
      *CONVERTIR A UF
                     PERFORM CNV-ME-A-UF-ATRZ
                     PERFORM CNV-ME-A-UF-UTIL
           ELSE
      *NUEVO TIPO DE LINEA
             GENERATE DL-RTL
             MOVE 1                   TO WSS-NUM-TLIN IN WSS-RTL
             MOVE CLR-COD-OFIC IN CLR TO WSS-COD-OFIC IN WSS-RTL
             MOVE CLR-COD-OFIC IN CLR TO WSS-COD-OFIC-ANT IN WSS-VARI
             MOVE ZEROES TO WSS-VAL-ATRZ IN WSS-RTL
             MOVE ZEROES TO WSS-VAL-UTIL IN WSS-RTL
             GENERATE DL-RBC
             PERFORM BUS-GLS-TIPO
             MOVE CLR-COD-TIPO IN CLR TO SRT-COD-TIPO IN SRT
             MOVE CLR-COD-TIPO IN CLR TO WSS-COD-TIPO-ANT IN WSS-VARI
             MOVE 1                   TO WSS-NUM-TLIN IN WSS-RBC
             MOVE ZEROES              TO WSS-VAL-ATRZ IN WSS-RBC
             MOVE ZEROES              TO WSS-VAL-UTIL IN WSS-RBC
             IF CLR-COD-VCLC IN CLR = WSS-COD-UF IN WSS-VARI
      *MOVER VALORES EN UF
               ADD CLR-VAL-CMAX IN CLR TO WSS-VAL-ATRZ IN WSS-RTL
               ADD CLR-VAL-CMAX IN CLR TO WSS-VAL-ATRZ IN WSS-RBC
               PERFORM CNV-ME-A-UF-UTIL
             ELSE
      *CONVERTIR A UF
               PERFORM CNV-ME-A-UF-ATRZ
               PERFORM CNV-ME-A-UF-UTIL.

      *SE SALTA GENERATE DEL PROGRAMA
           GO TO NXT-INP-SRT.
      *>>>>
*% END
*% IF FIN_GEN_OUT
      *<<<< FIN_GEN_OUT
      *>>>>
*% END
*% IF INI_NXT_INP
      *<<<< INI_NXT_INP
      *>>>>
*% END
*% IF FIN_NXT_INP
      *<<<< FIN_NXT_INP
      *>>>>
*% END
*% IF FIN_INP
      *<<<< FIN_INP
      *>>>>
*% END
*% IF FIN_OUT
      *<<<< FIN_OUT
           GENERATE DL-RTL.
           GENERATE DL-RBC.
      *>>>>
*% END
*% IF FIN_TMT
      *<<<< FIN_TMT
           TERMINATE RPT-RBC.
      *>>>>
*% END
*% IF FIN
      *<<<< FIN
           CLOSE RPTRBC.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF

       CNV-ME-A-UF-ATRZ SECTION.
       INI-CNV-ME-A-UF-ATRZ.
      *CONVIERTE DE MONEDA EXTRANJERA A UF

           IF CLR-COD-VCLC IN CLR = WSS-COD-UF IN WSS-VARI
               GO TO FIN-CNV-ME-A-UF-ATRZ.

           IF CLR-COD-VCLC IN CLR = WSS-COD-PESO IN WSS-VARI
               COMPUTE WSS-VAL-ATRZ IN WSS-RTL ROUNDED =
                  WSS-VAL-ATRZ IN WSS-RTL  + 
                ( CLR-VAL-CMAX IN CLR / WSS-SGV-VCAM-UF IN WSS-VARI )

               COMPUTE WSS-VAL-ATRZ IN WSS-RBC ROUNDED =
                WSS-VAL-ATRZ IN WSS-RBC  + 
                ( CLR-VAL-CMAX IN CLR / WSS-SGV-VCAM-UF IN WSS-VARI )
               GO TO FIN-CNV-ME-A-UF-ATRZ.

      *PRIMERO CONVIERTE DE MONEDA EXTRANJERA A PESO
           MOVE CLR-VAL-CMAX IN CLR      TO TVC-VALO IN TVC-VARI.
           MOVE CLR-COD-VCLC IN CLR      TO TVC-MON1 IN TVC-VARI.
           MOVE WSS-COD-PESO IN WSS-VARI TO TVC-MON2 IN TVC-VARI.
           MOVE WSS-NUM-DHOY IN WSS-VARI TO TVC-DCAM IN TVC-VARI.
           MOVE WSS-NUM-MHOY IN WSS-VARI TO TVC-MCAM IN TVC-VARI.
           MOVE WSS-NUM-SHOY IN WSS-VARI TO TVC-SCAM IN TVC-VARI.
           MOVE WSS-NUM-AHOY IN WSS-VARI TO TVC-ACAM IN TVC-VARI.
           MOVE 4                        TO PES-NUM-DECI IN PES-VARI.
           PERFORM TAB-PRO-TVC.
           IF TVC-CMSG IN TVC-VARI > SPACES
               DISPLAY 'ERROR: NO EXISTE VALOR DE CAMBIO DE : '
                   TVC-MON1 IN TVC-VARI ' A : '
                   TVC-MON2 IN TVC-VARI ' AL : '
                   TVC-FCAM IN TVC-VARI
                   MOVE ZEROES TO WSS-SGV-UF IN WSS-VARI
                   MOVE '23' TO FIO-STAT
                   GO TO FIN-CNV-ME-A-UF-ATRZ
           ELSE
               MOVE TVC-VALO IN TVC-VARI TO 
                    WSS-SGV-UF IN WSS-VARI.

           COMPUTE WSS-VAL-ATRZ IN WSS-RTL ROUNDED =
              WSS-VAL-ATRZ IN WSS-RTL  + 
              ( WSS-SGV-UF IN WSS-VARI / WSS-SGV-VCAM-UF IN WSS-VARI ).

           COMPUTE WSS-VAL-ATRZ IN WSS-RBC ROUNDED =
              WSS-VAL-ATRZ IN WSS-RBC  + 
              ( WSS-SGV-UF IN WSS-VARI / WSS-SGV-VCAM-UF IN WSS-VARI ).

       FIN-CNV-ME-A-UF-ATRZ.
           EXIT.

       CNV-ME-A-UF-UTIL SECTION.
       INI-CNV-ME-A-UF-UTIL.
      *CONVIERTE DE MONEDA EXTRANJERA A UF

           IF CLR-COD-VCCF IN CLR = WSS-COD-UF IN WSS-VARI
               ADD CLR-VAL-CUTI IN CLR TO WSS-VAL-UTIL IN WSS-RTL
               ADD CLR-VAL-CUTI IN CLR TO WSS-VAL-UTIL IN WSS-RBC
               GO TO FIN-CNV-ME-A-UF-UTIL.

           IF CLR-COD-VCCF IN CLR = WSS-COD-PESO IN WSS-VARI
               COMPUTE WSS-VAL-UTIL IN WSS-RTL ROUNDED =
                  WSS-VAL-UTIL IN WSS-RTL      +
                ( CLR-VAL-CUTI IN CLR / WSS-SGV-VCAM-UF IN WSS-VARI )
               COMPUTE WSS-VAL-UTIL IN WSS-RBC ROUNDED =
                  WSS-VAL-UTIL IN WSS-RBC      +
                ( CLR-VAL-CUTI IN CLR / WSS-SGV-VCAM-UF IN WSS-VARI )
               GO TO FIN-CNV-ME-A-UF-UTIL.

      *PRIMERO CONVIERTE DE MONEDA EXTRANJERA A PESO
           MOVE CLR-VAL-CUTI IN CLR      TO TVC-VALO IN TVC-VARI.
           MOVE CLR-COD-VCCF IN CLR      TO TVC-MON1 IN TVC-VARI.
           MOVE WSS-COD-PESO IN WSS-VARI TO TVC-MON2 IN TVC-VARI.
           MOVE WSS-NUM-DHOY IN WSS-VARI TO TVC-DCAM IN TVC-VARI.
           MOVE WSS-NUM-MHOY IN WSS-VARI TO TVC-MCAM IN TVC-VARI.
           MOVE WSS-NUM-SHOY IN WSS-VARI TO TVC-SCAM IN TVC-VARI.
           MOVE WSS-NUM-AHOY IN WSS-VARI TO TVC-ACAM IN TVC-VARI.
           MOVE 4                        TO PES-NUM-DECI IN PES-VARI.
           PERFORM TAB-PRO-TVC.
           IF TVC-CMSG IN TVC-VARI > SPACES
               DISPLAY 'ERROR: NO EXISTE VALOR DE CAMBIO DE : '
                   TVC-MON1 IN TVC-VARI ' A : '
                   TVC-MON2 IN TVC-VARI ' AL : '
                   TVC-FCAM IN TVC-VARI
                   MOVE ZEROES TO WSS-SGV-UF IN WSS-VARI
                   MOVE '23' TO FIO-STAT
                   GO TO FIN-CNV-ME-A-UF-UTIL
           ELSE
               MOVE TVC-VALO IN TVC-VARI TO
                    WSS-SGV-UF IN WSS-VARI.

           COMPUTE WSS-VAL-UTIL IN WSS-RTL ROUNDED =
              WSS-VAL-UTIL IN WSS-RTL      +
              ( WSS-SGV-UF IN WSS-VARI / WSS-SGV-VCAM-UF IN WSS-VARI ).

           COMPUTE WSS-VAL-UTIL IN WSS-RBC ROUNDED =
              WSS-VAL-UTIL IN WSS-RBC      +
              ( WSS-SGV-UF IN WSS-VARI / WSS-SGV-VCAM-UF IN WSS-VARI ).

       FIN-CNV-ME-A-UF-UTIL.
           EXIT.

       BUS-GLS-TIPO SECTION.
       INI-BUS-GLS-TIPO.
           MOVE 'DEU'               TO TAB-COD-SIST.
           MOVE 'TLC'               TO TAB-COD-TTAB IN TAB.
           MOVE CLR-COD-TIPO IN CLR TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               DISPLAY 'CODIGO INEXISTENTE TABLA TLC '
                       CLR-COD-TIPO IN CLR
           ELSE
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TIPO IN WSS-RBC
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TIPO IN WSS-RTL.
       FIN-BUS-GLS-TIPO.
           EXIT.

       COPY GNSBGHOY.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY GNSBVTAB.
       COPY GNSBBMSC.
       COPY GNSBVMSC.
       COPY GNSBFMSC.
       COPY GNSBGPES.
       COPY TABBFCAM.
       COPY TABBGTVC.
      *>>>>
*% END
