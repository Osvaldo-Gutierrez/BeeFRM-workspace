       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   LDCPQCLS.
       AUTHOR.       BEE.
       DATE-WRITTEN. 08-May-19 12:07 PM.

      * NOMBRE PROGRAMA                   LDCPQCLS
      * VERSION PGM                       3.1
      * VERSION SKL                       19.04.15
      * OPCION                            CON
      * ARCHIVO BASE                      LDCCLF
      * PANTALLA                          LDCCLS
      * INP/OUT                           DATACOM
      * TAMANO COMMAREA                   250

      *>>>>
      *XON-INI 02-JUN-2008                                              
      *        modifica filtro para que muestre ultima clf 'a' o 'r'.   
      *XON-FIN 02-JUN-2008
      *>>>>                                              

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.
       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
      * COPY GNSWGSCR.
       COPY GNSWGCVT.
       77  WSS-TAG-LDCPQCLS-INI PIC X(125) VALUE                        
           '<IDNPGM NOM=$LDCPQCLS$ SKL=$19.04.15$ VSN=${vsnpq}$        
      -    'GEN=$08-May-19 12:07 PM$ FNC=${fncpq}$/>'.    

       COPY GNSWCSCR.
      *PTC-INI
      *PTC-SUB
      * COPY GNSWVSCR.
       COPY GNSWV3CR.
      *PTC-FIN
           03 SCR-NUM-PANT               PIC 9(0002).
           03 SCR-CLS-FLD                PIC X(1300).
       COPY LDCWICLS.

       COPY LDCBRCLF.


       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CLF-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSBRMSC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSWGFRM.
       COPY GNSWG3CF.
       COPY GNSWGTSK.
       COPY GNSWGQUE.
      *PTC-FIN
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       COPY GNSWGIDC.
       COPY GNSWGSYS.

      *<<<< WSS
       COPY LDCBRRDC.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.        
       COPY SGCBRDBC.                                                   
       COPY SGCBRREC.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-REC-REQA==.        
       COPY BGLBRGDD.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.        
       COPY BGLBRGDG.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.        
       COPY BGLBRGVT.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.        
       COPY BGLBRTAG.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.        
                                                                        
       COPY GNSWGCPT.                                                   
       COPY GNSWGSTR.                                                   
       COPY LDCWXCLS.                                                   
       COPY LDCWGMPC.                                                   
                                                                        
       COPY LDCBRSLC.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-SLC-REQA==.        
       COPY LDCWGCCU.                                                   
       COPY TABWGTVC.                                                   
       COPY TABBRCAM.                                                   
      * GVI-INI mod. MEC 30-OCT-2006                                    
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITK-REQA==.        
      *COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PTK-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RTK-REQA==.        
      * GVI-FIN                                                         
      *>>>>
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *>>>>
       01  CLS-VARI.                                                    
      *XON-INI 02-JUN-2008                                              
           03  WSS-IND-RENO         VALUE SPACES       PIC X(001).      
           03  WSS-IND-ING          VALUE SPACES       PIC X(001).      
           03  WSS-IND-ACT          VALUE SPACES       PIC X(001).      
           03  WSS-IND-CER          VALUE SPACES       PIC X(001).      
           03  WSS-IND-VRF          VALUE SPACES       PIC X(001).      
           03  WSS-GLS-CLFR         VALUE SPACES       PIC X(183).      
           03  WSS-GLS-CLFI         VALUE SPACES       PIC X(183).      
           03  WSS-GLS-CLFC         VALUE SPACES       PIC X(183).      
           03  WSS-GLS-CLFV         VALUE SPACES       PIC X(183).      
           03  WSS-IND-LEN0         VALUE SPACES       PIC X(01).       
      *XON-FIN 02-JUN-2008                                              
      *AFRI-INI/OCT-2006                                                
           03  WSS-CLI.                                                 
               05  WSS-ETIQ                            PIC X(03).       
               05  WSS-NOMC                            PIC X(60).       
      *AFRI-FIN/OCT-2006                                                
      *AFRI-INI/MAYO-2007 (MAE - ALD)                                   
          03  WSS-IND-SGLB     VALUE SPACES             PIC X(01).      
          03  WSS-IND-SOCU     VALUE SPACES             PIC X(01).      
      *AFRI-FIN/MAYO-2007 (MAE - ALD)                                   
           03  WSS-NUM-CCUR.                                            
               05 WSS-NUM-ICUR-EDT                     PIC  ZZ9.        
               05 WSS-NUM-ICUR-ALF                     PIC X(03).       
               05 WSS-NUM-ICUR      REDEFINES                           
                  WSS-NUM-ICUR-ALF                     PIC 9(03).       
           03  WSS-MONE.                                                
               05  WSS-COD-UEFES VALUE SPACES          PIC X(06).       
               05  WSS-SGV-UEFES       COMP-3          PIC S9(09)V9(9). 
               05  WSS-COD-PESOS VALUE SPACES          PIC X(06).       
           03  WSS-IND-VBEE      VALUE 'N'             PIC X(01).       
           03  MPC-NUM-DELAY     VALUE SPACES          PIC X(01).       
      * GVI-INI Mod. MEC 30-oct-2006                                    
       COPY GNSWGTCK.                                                   
       COPY GNSWGTPK.                                                   
       77  SXI-NUM-L6                         PIC 9(006).               
       01  SXI-GNSPPSXI VALUE SPACES.                                   
           03 SXI-GLS-DRIVE                   PIC X(031).               
           03 SXI-COD-TCPIP                   PIC X(006).               
           03 SXI-COD-ISGMT                   PIC X(001).               
           03 SXI-PT.                                                   
              05 SXI-GLS-HDR                  PIC X(100).               
              05 SXI-GLS-PT-CREQ              PIC X(003).               
              05 SXI-GLS-PT-DMSG              PIC X(859).               
       COPY GNSWGAMB.                                                   
       COPY GNSMXWS1.                                                   
       COPY GNSBRITK.                                                   
      *COPY GNSBRPTK.                                                   
       COPY GNSBRRTK.                                                   
      * GVI-FIN                                                         
                                                                        
       01  PGM-VARI.
           03 PGM-ICLR                  VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-TODO          VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-LLAVES        VALUE 'K'       PIC X(01).
           03 PGM-LIMPIAR-CAMPOS        VALUE 'F'       PIC X(01).
           03 PGM-NO-LIMPIAR-NADA       VALUE 'N'       PIC X(01).
           03 PGM-PROG                                  PIC X(08).
           03 PGM-NTRN                                  PIC X(04).
           03 PGM-STAT.
              05 PGM-STAT-DBC.
                 88 PGM-STAT-DBC-NUL    VALUE '  '.
                 07 PGM-STT1-DBC        VALUE '2' PIC X(01).
                    88 PGM-STAT-DBC-OKS VALUE '0'.
                 07 PGM-STT2-DBC        VALUE '3' PIC X(01).
              05 PGM-STAT-CLF.
                 88 PGM-STAT-CLF-NUL    VALUE '  '.
                 07 PGM-STT1-CLF        VALUE '2' PIC X(01).
                    88 PGM-STAT-CLF-OKS VALUE '0'.
                 07 PGM-STT2-CLF        VALUE '3' PIC X(01).
              05 PGM-STAT-RDC.
                 88 PGM-STAT-RDC-NUL    VALUE '  '.
                 07 PGM-STT1-RDC        VALUE '2' PIC X(01).
                    88 PGM-STAT-RDC-OKS VALUE '0'.
                 07 PGM-STT2-RDC        VALUE '3' PIC X(01).
              05 PGM-STAT-REC.
                 88 PGM-STAT-REC-NUL    VALUE '  '.
                 07 PGM-STT1-REC        VALUE '2' PIC X(01).
                    88 PGM-STAT-REC-OKS VALUE '0'.
                 07 PGM-STT2-REC        VALUE '3' PIC X(01).
              05 PGM-STAT-GDD.
                 88 PGM-STAT-GDD-NUL    VALUE '  '.
                 07 PGM-STT1-GDD        VALUE '2' PIC X(01).
                    88 PGM-STAT-GDD-OKS VALUE '0'.
                 07 PGM-STT2-GDD        VALUE '3' PIC X(01).
           03 PGM-SRNF                  VALUE '23'      PIC X(02).
           03 PGM-SOKS                  VALUE '00'      PIC X(02).
           03 PGM-SNUL                  VALUE '  '      PIC X(02).
           03 PGM-SUAR                  VALUE SPACES    PIC X(15).
           03 PGM-CMMA.
              05 PGM-CMMA-CHR OCCURS 3000 PIC X(01).
       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 DFH-CMMA OCCURS 3000 PIC X(01).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
       LUP-MAIN.
           IF SCR-INST = SCR-INST-HCM
                 PERFORM SCR-COM.
           IF SCR-CCPP = 'ACC'
                 PERFORM SCR-ACC
           ELSE
                 MOVE SCR-INST-HCM TO SCR-INST.
           GO TO LUP-MAIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
       COPY GNSBGEIB.
       COPY GNSBGEDB.
           MOVE LOW-VALUES TO CLS-FLD.
           MOVE LOW-VALUES TO CLS-EDT.
           PERFORM GNS-PRO-RCK.
           PERFORM GNS-BUS-VCA.
           MOVE +3000 TO SCR-TCMA.
           PERFORM GNS-HDL-SYS.
           PERFORM GNS-HDL-FRM.
           MOVE 'LDCPQCLS' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      *PTC-INI
           PERFORM GNS-ERR-QUE.
           PERFORM GET-TSK-TERM.
      *PTC-FIN
      *<<<< INI_FIO
                                                                        
           MOVE TSK-TERM-NUM   TO SXI-NUM-L6.                           
                                                                        
           IF SCR-OFRM-SRV                                              
                MOVE TSK-TERM-ALF TO MPC-NUM-TASK-K                     
                MOVE TSK-TERM-ALF TO MPC-NUM-TASK                       
                MOVE TSK-TERM-ALF TO CLS-COD-TERM                       
                MOVE TSK-TERM-ALF TO CLS-COD-TERM-MAS                   
           ELSE                                                         
                MOVE EIBTRMID     TO MPC-NUM-TASK-K                     
                MOVE EIBTRMID     TO MPC-NUM-TASK                       
                MOVE EIBTRMID     TO CLS-COD-TERM                       
                MOVE EIBTRMID     TO CLS-COD-TERM-MAS.                  
           MOVE +3859 TO SCR-TCMA.                                      
           PERFORM GNS-ERR-QUE.                                         
           IF ( FRM-FFLD = FRM-FFLD-PF5 ) AND ( SCR-NUM-PANT = 1 )      
               MOVE SCR-CLS-FLD TO CLS-FLD                              
               GO TO FIN-INI.                                           
                                                                        
           IF ( FRM-FFLD = FRM-FFLD-PF6 )                               
               MULTIPLY SCR-NUM-PANT BY WSS-IMAX GIVING QUE-NITM        
               ADD 1              TO QUE-NITM                           
               MOVE CLS-NOM-TSCLS TO QUE-COLA                           
               MOVE CLS-LEN-TSCLS TO QUE-LITM                           
               MOVE QUE-GET       TO QUE-CMND                           
               PERFORM GNS-PRO-QUE                                      
               IF QUE-STAT NOT = QUE-STAT-OKS                           
                  MOVE SCR-CLS-FLD TO CLS-FLD                           
                  GO TO FIN-INI.                                        
                                                                        
      * OBTIENE CODIGO VALOR DE CAMBIO DE PESOS MEDIANTE CIC DE LA MONED
           MOVE 'TAB'          TO FIO-SIST.                             
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.                  
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.                  
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.                             
           MOVE FIO-GET-KEY    TO FIO-CMND.                             
           PERFORM GNS-FIO-TAB.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'TAB'          TO MSG-COD-SIST                      
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               PERFORM PRG-ABT.                                         
           MOVE TAB-COD-CTAB IN TAB TO CCU-COD-PESO IN CCU-VARI.        
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESOS TVC-MNAC.          
                                                                        
           PERFORM GET-FHOY.                                            
           MOVE HOY-SHOY                 TO CAM-NUM-SCAM IN CAM(1).     
           MOVE HOY-AHOY                 TO CAM-NUM-ACAM IN CAM(1).     
           MOVE HOY-MHOY                 TO CAM-NUM-MCAM IN CAM(1).     
           MOVE HOY-DHOY                 TO CAM-NUM-DCAM IN CAM(1).     
           MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2).     
           MOVE CCU-COD-PESO IN CCU-VARI TO CAM-COD-VCAM IN CAM(2).     
                                                                        
      *VALOR DE CAMBIO PARA UF                                          
           MOVE 'TAB'          TO FIO-SIST.                             
           MOVE 'VLR'          TO TAB-CIC-TTAB.                         
           MOVE '0998'         TO TAB-CIC-CTAB.                         
           MOVE FIO-GET-KEY    TO FIO-CMND.                             
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.                             
           PERFORM GNS-FIO-TAB.                                         
           IF NOT FIO-STAT-OKS                                          
               GO TO FIN-INI.                                           
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-UEFES.                   
                                                                        
           MOVE WSS-COD-UEFES TO CAM-COD-VCAM IN CAM(1).                
           MOVE FIO-GET-KEY   TO FIO-CMND.                              
           PERFORM TAB-FIO-CAM.                                         
           IF NOT (FIO-STAT-OKS AND CAM-IND-VIGE IN CAM = 'S')          
               MOVE 1 TO WSS-SGV-UEFES                                  
           ELSE                                                         
               MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-UEFES.               
                                                                        
      * Obtiene cic de garantia real                                    
           MOVE 'BGL'          TO FIO-SIST.                             
           MOVE 'RAL'          TO TAB-CIC-TTAB IN TAB.                  
           MOVE 'R'            TO TAB-CIC-CTAB IN TAB.                  
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.                             
           MOVE FIO-GET-KEY    TO FIO-CMND.                             
           PERFORM GNS-FIO-TAB.                                         
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-REAL IN WSS-VARI.        
                                                                        
           MOVE ZEROES TO MPC-LMAX.                                     
           MOVE ZEROES TO MPC-LFAC.                                     
           MOVE ZEROES TO MPC-TMAX.                                     
      * Obtiene Tipo de Realacion valida proyecto MEC                   
           MOVE 'DEU'          TO FIO-SIST.                             
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.                  
           MOVE 'TRECMEC     ' TO TAB-COD-CTAB IN TAB.                  
           MOVE FIO-GET-KEY    TO FIO-CMND.                             
           PERFORM GNS-FIO-TAB.                                         
           IF FIO-STAT-OKS AND TAB-MSC-STAT = 'S'                       
              MOVE TAB-COD-DAT2(1) TO WSS-COD-TREC IN WSS-VARI          
              MOVE TAB-COD-DAT2(2) TO WSS-COD-RELI IN WSS-VARI          
              MOVE TAB-COD-DAT3(1) TO MPC-LMAX-ALF                      
              MOVE TAB-COD-DAT1(1) TO MPC-NUM-DELAY                     
           ELSE                                                         
              MOVE 'CD'            TO WSS-COD-TREC IN WSS-VARI          
              MOVE 'DC'            TO WSS-COD-RELI IN WSS-VARI.         
                                                                        
           IF MPC-LMAX NOT > ZEROES                                     
              MOVE 10 TO MPC-LMAX.                                      
           IF MPC-NUM-DELAY NOT > SPACES                                
              MOVE '2' TO MPC-NUM-DELAY.                                
                                                                        
           MOVE ZEROES TO WSS-VAL-MTSM IN WSS-VARI.                     
      *>>>>                                                             
       FIN-INI.
           EXIT.

       COPY GNSBHSYS.
       COPY GNSBHFRM.
       COPY GNSBPRCK.
       GNS-BUS-VCA SECTION.
       INI-GNS-BUS-VCA.
           MOVE 0 TO FRM-IFLD.
       LUP-GNS-BUS-VCA.
           ADD 1 TO FRM-IFLD.
           IF FRM-IFLD NOT > EIBCALEN AND
              FRM-IFLD NOT > 3000
                MOVE DFH-CMMA(FRM-IFLD) TO PGM-CMMA-CHR(FRM-IFLD)
                GO TO LUP-GNS-BUS-VCA.
           MOVE PGM-CMMA TO SCR-VARI.
       FIN-GNS-BUS-VCA.
           EXIT.
       COPY GNSBBIDD.

       SCR-COM SECTION.
       INI-SCR-COM.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-CLS.
           PERFORM EDT-KEY-CLS.
           PERFORM EDT-FLD-CLS.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-HCM TO SCR-INST.
           MOVE SCR-CMNP     TO SYS-PROG.
           MOVE SCR-VARI     TO SYS-CMMA.
           MOVE SCR-TCMA     TO SYS-TCMA.
           MOVE SYS-XCTL     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       XCT-ERR.
           MOVE 'XCTERR    ' TO MSG-COD-MENS.
           MOVE 'GNS'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO SYS-MEN1.
           MOVE SYS-PROG     TO SYS-MEN2.
           MOVE SYS-ABOR     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       COPY GNSBGGBK.
       FIN-SCR-COM.
           EXIT.



       SCR-ACC SECTION.
       INI-SCR-ACC.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ACC
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-ACC.
           PERFORM DESSCRTRL.
      *<<<< PFS_SCR_ACC
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6
               PERFORM VAL-NUM-KEY-CLS
               PERFORM VAL-NUM-FLD-CLS
               PERFORM SCRL-TAB-CLS
               PERFORM SCR-TRL.
      *>>>>
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ACC.
           EXIT.

       BRW-SCR-ACC SECTION.
       INI-BRW-SCR-ACC.
       FIN-BRW-SCR-ACC.
           EXIT.




       SCR-DMSG SECTION.
       INI-SCR-DMSG.
           IF PGM-ICLR = PGM-NO-LIMPIAR-NADA
               NEXT SENTENCE
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-TODO
               PERFORM SCR-CLRA-CLS
               PERFORM EDT-KEY-CLS
               PERFORM EDT-FLD-CLS
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-LLAVES
               PERFORM CLR-KEY-CLS
               PERFORM EDT-KEY-CLS
           ELSE
               PERFORM CLR-FLD-CLS
               PERFORM EDT-FLD-CLS.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-DMSG.
           EXIT.

       SCR-KEY SECTION.
       INI-SCR-KEY.
           PERFORM SCR-RST.
           PERFORM GET-KEY.
           IF FRM-STAT-ABT
                   MOVE SPACES TO FRM-MENS
                   PERFORM SCR-MSSG
                   GO TO FIN-SCR-KEY.
       FND-SCR-KEY.
           MOVE SPACES TO FRM-MENS.
           PERFORM FND-KEY.
           IF FIO-STAT-OKS
               PERFORM PUT-SCR
               MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
               GO TO FIN-SCR-KEY.
      *JSS ELSE
      *        PERFORM CLR-FLD-CLS.
       ERR-SCR-KEY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR.
           IF FRM-MENS NOT > SPACES
               IF FIO-STAT-EOF
                   MOVE 'REGEOF    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
               IF FIO-STAT = FIO-STAT-NEX
                   MOVE 'REGNEX    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
           MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-SCR-KEY.
           EXIT.

       SCR-RST SECTION.
       INI-SCR-RST.
           MOVE SPACES       TO PGM-ICLR.
           MOVE SPACES       TO SCR-ACTU.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
           MOVE LOW-VALUES   TO CLS-FLD.
           MOVE LOW-VALUES TO CLS-EDT.
       FIN-SCR-RST.
           EXIT.

       GET-KEY SECTION.
       INI-GET-KEY.
           PERFORM SCR-GKEY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-KEY.
           EXIT.

       GET-IKY SECTION.
       INI-GET-IKY.
           PERFORM SCR-GIKY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-IKY.
           EXIT.

       FND-KEY SECTION.
       INI-FND-KEY.
      *<<<< INI_FND_KEY
      * GVI-INI                                                         
            SET WSS-NO-TIMEOUT TO TRUE.                                 
            SET SCR-IERR-NOT TO TRUE.                                   
                                                                        
            IF WSS-IND-SWT3 = 'S'                   AND                 
               FRM-GLS-TICK IN CLS-FLD > SPACES     AND                 
               DBC-NUM-ICLI IN CLS-FLD = ZEROES     AND                 
               DBC-GLS-NOMC IN CLS-FLD = SPACES                         
                                                                        
               GO TO FIN-BUS-CLI-KEY.                                   
      * GVI-FIN                                                                                                                                 

           IF DBC-NUM-ICLI IN CLS-FLD NOT = ZEROES
      *IDC-CLI Busca Cliente por medio de IdC
               MOVE DBC-NUM-ICLI IN CLS-FLD TO DBC-NUM-ICLI IN DBC
               MOVE DBC-IND-ICLI IN CLS-FLD TO DBC-IND-ICLI IN DBC
               MOVE DBC-GLS-ICLI IN CLS-FLD TO DBC-GLS-ICLI IN DBC
               MOVE 'DBC-IDC-ICLI' TO FIO-AKEY
               MOVE FIO-GET-KEY    TO FIO-CMND
               PERFORM GET-CLI
               IF MSG-COD-MENS NOT > SPACES
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN            TO DBC-GLS-NOMC IN CLS-FLD
                   MOVE DBC-CAI-ICLI IN DBC TO DBC-CAI-ICLI IN CLS-FLD
                   MOVE DBC-IIC-ICLI IN DBC TO DBC-IIC-ICLI IN CLS-FLD
                   MOVE '00' TO PGM-STAT-DBC
                   GO TO FIN-BUS-CLI-KEY
               ELSE
                   MOVE MSG-GLS-DESC TO FRM-MENS CLS-GLS-MENS
                   MOVE 'S' TO SCR-IERR.

           IF DBC-GLS-NOMC IN CLS-FLD > SPACES
      *NOM-CLI Busca Cliente por medio del Nombre
               MOVE DBC-GLS-NOMC IN CLS-FLD TO STR-GLS-GSTR
               PERFORM STR-UNS
               MOVE STR-GLS-FUNS IN STR-VARI(1) TO DBC-GLS-APAT IN DBC
               MOVE STR-GLS-FUNS IN STR-VARI(2) TO DBC-GLS-AMAT IN DBC
               MOVE STR-GLS-FUNS IN STR-VARI(3) TO DBC-GLS-NOMB IN DBC
               MOVE 'DBC-GLS-NOMC' TO FIO-AKEY
               MOVE FIO-GET-NLS    TO FIO-CMND
               PERFORM GET-CLI
               IF MSG-COD-MENS NOT > SPACES
                   MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN CLS-FLD
                   MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN CLS-FLD
                   MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN CLS-FLD
                   MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN CLS-FLD
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN            TO DBC-GLS-NOMC IN CLS-FLD
                   MOVE DBC-CAI-ICLI IN DBC TO DBC-CAI-ICLI IN CLS-FLD
                   MOVE DBC-IIC-ICLI IN DBC TO DBC-IIC-ICLI IN CLS-FLD
                   MOVE '00' TO PGM-STAT-DBC
                   GO TO FIN-BUS-CLI-KEY
               ELSE
                   MOVE MSG-GLS-DESC TO FRM-MENS CLS-GLS-MENS
                   MOVE 'S' TO SCR-IERR.

           IF DBC-CAI-ICLI IN CLS-FLD > SPACES OR
              DBC-IIC-ICLI IN CLS-FLD > SPACES
              MOVE DBC-CAI-ICLI IN CLS-FLD TO DBC-CAI-ICLI IN DBC
              MOVE DBC-IIC-ICLI IN CLS-FLD TO DBC-IIC-ICLI IN DBC
              MOVE FIO-GET-KEY    TO FIO-CMND
              PERFORM SGC-FIO-DBC
              IF FIO-STAT-OKS
                 MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN CLS-FLD
                 MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN CLS-FLD
                 MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN CLS-FLD
                 MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN CLS-FLD
                 MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                 PERFORM CPT-BLKS
                 MOVE CPT-STRN            TO DBC-GLS-NOMC IN CLS-FLD
                 MOVE '00' TO PGM-STAT-DBC
                 GO TO FIN-BUS-CLI-KEY
              ELSE
                 MOVE 'CLI    NEX' TO MSG-COD-MENS                      
                 MOVE MSG-GLS-DESC TO FRM-MENS CLS-GLS-MENS
                 MOVE 'S' TO SCR-IERR.

       FIN-BUS-CLI-KEY.
           IF MSG-COD-MENS > SPACES
              GO TO MSG-FND-KEY.

           MOVE '00' TO PGM-STAT-DBC.
           GO TO CON-FND-KEY.
      *>>>>
           PERFORM KEY-ALL-CLS.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM LDC-FIO-CLF.
           MOVE FIO-STAT TO PGM-STAT-CLF.
      *<<<< FIN_FND_KEY
       CON-FND-KEY.
      * GVI-INI mod. MEC 30-OCT-2006                                    
           IF WSS-NO-TIMEOUT                                            
              SET WSS-CLI-NORMAL TO TRUE                                
           ELSE                                                         
              SET WSS-NO-TIMEOUT TO TRUE                                
              SET WSS-CLI-PESADO TO TRUE.                               
                                                                        
      * Solo si NO estamos en simulacisn se evaluan los Switch.         
      *    IF FRM-IIC-ISLC IN CLS-FLD > SPACES                          
      *       PERFORM FIN-BUS-TICK.                                     
                                                                        
ZX    * SI ESTAMOS EN SIMULACISN SE FORZAN SW1 Y SW2 A N                
ZX         IF FRM-IIC-ISLC IN CLS-FLD > SPACES                          
ZX            MOVE 'N' TO WSS-IND-SWT1                                  
ZX                        WSS-IND-SWT2.                                 
                                                                        
      * Solo si algun Switch esta = S y NO es Cliente Pesado se evaluan 
      * los Switch                                                      
           IF (WSS-IND-SWT1 = 'S' OR                                    
               WSS-IND-SWT2 = 'S' OR                                    
      *        WSS-IND-SWT3 = 'S' OR                                    
               WSS-IND-SWT4 = 'S') AND                                  
              WSS-CLI-NORMAL                                            
           THEN                                                         
              MOVE 'TAB'                    TO TAB-COD-SIST             
              MOVE 'RPE'                    TO TAB-COD-TTAB IN TAB      
              MOVE  DBC-NUM-ICLI IN CLS-FLD TO WSS-NUM-IKLI             
              MOVE  DBC-VRF-ICLI IN CLS-FLD TO WSS-VRF-IKLI             
              MOVE  DBC-IND-ICLI IN CLS-FLD TO WSS-IND-IKLI             
              MOVE  DBC-GLS-ICLI IN CLS-FLD TO WSS-GLS-IKLI             
              MOVE  WSS-COD-IKLI            TO TAB-COD-CTAB IN TAB      
              MOVE TAB-COD-SIST TO FIO-SIST                             
              MOVE FIO-GET-KEY TO FIO-CMND                              
              PERFORM GNS-FIO-TAB                                       
              IF FIO-STAT-OKS                                           
                 IF TAB-IND-VIGE IN TAB = 'S'                           
                    SET WSS-CLI-PESADO TO TRUE                          
                 ELSE                                                   
                    GO TO FIN-BUS-TICK.                                 
                                                                        
                                                                        
      * Busca el ticket indicado y que sea completado                   
           IF WSS-IND-SWT3 = 'S'     AND                                
              FRM-GLS-TICK IN CLS-FLD > SPACES                          
           THEN                                                         
              SET WSS-CLI-PESADO TO TRUE                                
              PERFORM FND-ITK-TICK                                      
              IF MSG-COD-MENS NOT > SPACES                              
                 PERFORM GET-RUT-ICLI                                   
              ELSE                                                      
                 MOVE 'S' TO SCR-IERR                                   
                 MOVE MSG-GLS-DESC TO FRM-MENS CLS-GLS-MENS             
                 GO TO MSG-FND-KEY.                                     
                                                                        
      * Busca el ticket en fecha y hora indicadas y que sea completado  
           IF WSS-IND-SWT3 = 'S'              AND                       
              FRM-FEC-FECH IN CLS-FLD > ZEROS AND                       
              FRM-HRA-HORA IN CLS-FLD > ZEROS AND                       
              FRM-GLS-TICK IN CLS-FLD = SPACES                          
           THEN                                                         
              PERFORM FND-ITK-FECH                                      
              IF WSS-TICKET-OK                                          
                 SET WSS-CLI-PESADO TO TRUE                             
              ELSE                                                      
                 MOVE 'S' TO SCR-IERR                                   
                 MOVE 'TICK   NEX' TO MSG-COD-MENS                      
                 GO TO MSG-FND-KEY.                                     
                                                                        
           PERFORM VAL-SWITCH.                                          
                                                                        
       FIN-BUS-TICK.                                                    
                                                                        
                                                                        
      * GVI-FIN                                                         
                                                                        
      ********************************************                      
           IF FRM-IIC-ISLC IN CLS-FLD > SPACES                          
              PERFORM LEE-SLC-CCU                                       
              IF MSG-COD-MENS > SPACES                                  
                 MOVE 'S' TO SCR-IERR                                   
                 GO TO MSG-FND-KEY.                                     
                                                                        
           MOVE DBC-CIC-ICLI IN DBC TO WSS-CIC-ICLI-CLS.                
           PERFORM CRG-CIC-NIVEL.                                       
           IF MSG-COD-MENS > SPACES                                     
              MOVE 'S' TO SCR-IERR                                      
              GO TO MSG-FND-KEY.                                        
                                                                        
      * GVI-INI mod. MEC 30-OCT-2006                                    
      * SI CORRESPONDE, DESPUES DE INSERTAR LOS REGISTROS PTK, SE LLAMA 
      * programa que ejecuta el batch.                                  
           IF MPC-NMAX NOT > ZEROS                                      
              SET WSS-CLI-NORMAL TO TRUE.                               
                                                                        
           IF WSS-PUT-PTK AND WSS-CLI-PESADO                            
              PERFORM SUB-ITK-BATCH                                     
              MOVE 'TICK   INS' TO MSG-COD-MENS                         
              GO TO MSG-FND-KEY.                                        
                                                                        
           IF WSS-CLI-NORMAL                                            
      * GVI-FIN                                                         
                                                                        
           PERFORM LEE-TOT-DMPC.                                        
                                                                        
      * GVI-INI                                                         
           IF WSS-SI-TIMEOUT AND                                        
              (WSS-IND-SWT1 = 'S' OR                                    
               WSS-IND-SWT2 = 'S' OR                                    
               WSS-IND-SWT3 = 'S' OR                                    
               WSS-IND-SWT4 = 'S')                                      
              MOVE SPACES TO MSG-COD-MENS                               
              GO TO CON-FND-KEY.                                        
      * GVI-FIN                                                         
                                                                        
           IF MSG-COD-MENS > SPACES                                     
              MOVE 'S' TO SCR-IERR                                      
              GO TO MSG-FND-KEY.                                        
      ********************************************                      
                                                                        
           PERFORM PUT-TAB.                                             
                                                                        
           MOVE '00' TO FIO-STAT.                                       
           MOVE SCR-STAT-CON TO SCR-STAT.                               
           GO TO FIN-FND-KEY.                                           
      *----------------------------------------------------------       
       MSG-FND-KEY.                                                     
           IF FRM-MENS NOT > SPACES                                     
              MOVE 'DEU' TO MSG-COD-SIST                                
              PERFORM GET-MSG                                           
           MOVE MSG-GLS-DESC TO FRM-MENS.                               
                                                                        
           MOVE '00' TO FIO-STAT.                                       
           MOVE SCR-STAT-CON TO SCR-STAT.                               
           GO TO FIN-FND-KEY.                                           
      *>>>>
       FIN-FND-KEY.
           IF FIO-STAT = FIO-STAT-NEX
               MOVE 'S' TO SCR-IERR.
       EXT-FND-KEY.
           EXIT.
 
       PUT-SCR SECTION.
       INI-PUT-SCR.
           PERFORM PUT-ALL-CLS.
       FIN-PUT-SCR.
           EXIT.

       STP-EXIT SECTION.
       INI-STP-EXIT.
           MOVE SCR-PROG TO PGM-PROG.
           MOVE SCR-NTRN TO PGM-NTRN.

           MOVE SCR-PROV TO SCR-PROG.
           MOVE SCR-NTRV TO SCR-NTRN.

           MOVE PGM-PROG TO SCR-PROV
           MOVE PGM-NTRN TO SCR-NTRV.
       FIN-STP-EXIT.
           EXIT.

       SCR-EXIT SECTION.
       INI-SCR-EXIT.
           MOVE 'P'      TO SCR-ICMN.
           MOVE SCR-NTRN TO SYS-NTRN.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-RTRN TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       FIN-SCR-EXIT.
           EXIT.

       SCR-PUTA SECTION.
       INI-SCR-PUTA.
      *PTC-INI
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE CLS-FLD TO FRM-DFLD.
           MOVE FRM-PUT-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-PUTA.
           EXIT.

       SCR-MSSG SECTION.
       INI-SCR-MSSG.
           IF FRM-MEN1 NOT > SPACES
               MOVE SPACES TO FRM-MEN1.
           IF FRM-MEN2 NOT > SPACES
               MOVE SPACES TO FRM-MEN2.
           MOVE FRM-MENS TO CLS-GLS-MENS.
       FIN-SCR-MSSG.
           EXIT.

       SCR-GKEY SECTION.
       INI-SCR-GKEY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-CLS
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO CLS-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GKEY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-CLS.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-CLS
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-CLS.
           PERFORM VAL-IKY-CLS.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-MKY-CLS.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-AKY-CLS.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-CON-KEY-CLS.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GKEY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-CLS.
       ERR-SCR-GKEY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-CLS.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GKEY.
           PERFORM SCR-MSSG.

       SCR-GIKY SECTION.
       INI-SCR-GIKY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-CLS
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO CLS-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GIKY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-CLS.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-IKY-CLS
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-CLS.
           PERFORM VAL-IKY-CLS.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GIKY.
           PERFORM VAL-CON-IKY-CLS.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GIKY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-CLS.
       ERR-SCR-GIKY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-IKY-CLS.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GIKY.
           PERFORM SCR-MSSG.

       GET-CON SECTION.
       INI-GET-CON.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
      *<<<< PFS_GET_CON
           IF NOT ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 )
      *>>>>
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO CLS-GLS-MEN2
               MOVE SCR-PRMT     TO CLS-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO CLS-FLD.
       FIN-GET-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.

       CLR-MSG SECTION.
       INI-CLR-MSG.
           MOVE SPACES TO CLS-GLS-MENS.
       FIN-CLR-MSG.
           EXIT.

       HBL-IKY SECTION.
       INI-HBL-IKY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE CLS-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO CLS-FLD
      * FLB  7-NOV-1994
               PERFORM CLR-KEY-CLS

               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO CLS-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO CLS-GLS-MENS.
           PERFORM PRO-MKY-CLS.
           PERFORM PRO-AKY-CLS.
           PERFORM UNP-IKY-CLS.
           PERFORM FST-KEY-CLS.
       FIN-HBL-IKY.
           EXIT.

       HBL-KEY SECTION.
       INI-HBL-KEY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE CLS-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO CLS-FLD
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO CLS-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO CLS-GLS-MENS.
           PERFORM UNP-KEY-CLS.
           PERFORM FST-KEY-CLS.
      *<<<<
      * GVI-INI mod. MEC 30-OCT-2006                                    
           MOVE 'NNNN'     TO FRM-COD-SWIX IN CLS-FLD.                  
      * GVI-FIN                                                         
      *>>>>
       FIN-HBL-KEY.
           EXIT.

       HBL-FLD SECTION.
       INI-HBL-FLD.
           PERFORM PRO-IKY-CLS.
           PERFORM PRO-AKY-CLS.
           PERFORM UNP-MKY-CLS.
           PERFORM UNP-FLD-CLS.
           PERFORM FST-FLD-CLS.
       FIN-HBL-FLD.
           EXIT.

       FST-MSG SECTION.
       INI-FST-MSG.
           MOVE -1 TO CLS-GLS-MENS-LEN.
       FIN-FST-MSG.
           EXIT.

       PRO-ALL SECTION.
       INI-PRO-ALL.
           PERFORM PRO-KEY-CLS.
           PERFORM FST-MSG.
       FIN-PRO-ALL.
           EXIT.

       SCR-TRL SECTION.
       INI-SCR-TRL.
      *PTC-INI
           IF SCR-STAT NOT = SCR-STPP
               MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           IF FRM-MEN1 NOT > SPACES
               MOVE SCR-PRMT TO FRM-MEN1.
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM HBL-FLD
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-CLS
               PERFORM EDT-FLD-CLS
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GFL TO SCR-INST
               PERFORM SCR-EXIT.
           IF SCR-STAT = SCR-STAT-SON
               PERFORM PRO-ALL
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-CLS
               PERFORM EDT-FLD-CLS
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GCS TO SCR-INST
               PERFORM SCR-EXIT.
      *ASUME SCR-STAT-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.
      *    MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-CLS.
           PERFORM EDT-FLD-CLS.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-GAB TO SCR-INST.
           PERFORM SCR-EXIT.
       FIN-SCR-TRL.
           EXIT.

       DESSCRTRL SECTION.
       INI-DESSCRTRL.
           MOVE SCR-VFLD-NOT TO SCR-VFLD.
           MOVE FRM-FFLD TO SCR-FFLD.
       FIN-DESSCRTRL.
           IF SCR-FFLD-PF10 OR SCR-FFLD-PF3
                 MOVE SCR-INST-HCM TO SCR-INST
           ELSE
                 MOVE SCR-INST-HKY TO SCR-INST.
       EXT-DESSCRTRL.
           EXIT.

      * PGM-EBR-ALL SECTION.
      * INI-PGM-EBR-ALL.
      *     MOVE 'GNS' TO FIO-SIST.
      *     MOVE FIO-EBR-ALL TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      * FIN-PGM-EBR-ALL.
      *     EXIT.

       COPY LDCBQCLS.
       COPY GNSBVNUM.
       COPY LDCBFCLF.
       COPY GNSBFMSG.
       COPY GNSBGSYS.
       COPY GNSBGDTC.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSBGFRM.
       COPY GNSBG3CF.
      *PTC-FIN
       COPY GNSBGMSG.
       COPY GNSBEKEY.
       COPY GNSBIABT.
       COPY GNSBFTAB.
       COPY GNSBVIND.
       COPY GNSBVMSC.
       COPY GNSBFMSC.
       COPY GNSBVIDC.
       COPY GNSBPVRF.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
      *PTC-INI
       COPY GNSBGQUE.
       COPY GNSBGTSK.
      *PTC-FIN

      *<<<< EOF
       COPY LDCBFRDC.                                                   
       COPY GNSBPFEC.                                                   
                                                                        
      * GVI-INI mod. MEC 30-OCT-2006                                    
       COPY GNSBVCOD.                                                   
       COPY GNSBVTAB.                                                   
       COPY GNSBGVSM.                                                   
       COPY GNSBFITK.                                                   
      *COPY GNSBFPTK.                                                   
       COPY GNSBFRTK.                                                   
      * GVI-FIN                                                         
                                                                        
                                                                        
       PUT-TAB SECTION.                                                 
       INI-PUT-TAB.                                                     
           MOVE CLS-NOM-TSCLS    TO QUE-COLA.                           
           MOVE QUE-DEL          TO QUE-CMND.                           
           PERFORM GNS-PRO-QUE.                                         
                                                                        
           MOVE CLS-TSCLS-MAS    TO QUE-COLA.                           
           MOVE QUE-DEL          TO QUE-CMND.                           
           PERFORM GNS-PRO-QUE.                                         
                                                                        
           MOVE 1 TO SCR-NUM-PANT.                                      
           MOVE LOW-VALUES TO WSS-GLS-NOMC-IDX.                         
      *                                                                 
           MOVE 1 TO FRM-IFLD.                                          
           MOVE ZEROES  TO WSS-NITM IN WSS-VARI.                        
                                                                        
           MOVE 1 TO WSS-J IN WSS-VARI.                                 
       LUP-PUT-TAB.                                                     
           IF WSS-J IN WSS-VARI > WSS-FMAX IN WSS-VARI                  
              GO TO FIN-PUT-TAB.                                        
           IF WSS-CIC-NODO-CLS(WSS-J) > SPACES                          
              PERFORM PUT-TAB-CLS                                       
              PERFORM PUT-CLS-QUE                                       
              PERFORM SET-FRM-IFLD                                      
           ELSE                                                         
           IF FRM-IFLD = 1 AND                                          
              FRM-IIC-ICLI IN CLS-FLD(FRM-IFLD) NOT > SPACES            
              MOVE 'DEU' TO MSG-COD-SIST                                
              MOVE 'CLS    NEX' TO MSG-COD-MENS                         
              PERFORM GET-MSG                                           
              MOVE MSG-GLS-DESC TO FRM-MENS                             
              MOVE '00' TO FIO-STAT                                     
              MOVE 'S' TO SCR-IERR                                      
              GO TO FIN-PUT-TAB                                         
           ELSE                                                         
              MOVE '00' TO FIO-STAT                                     
              GO TO FIN-PUT-TAB.                                        
                                                                        
           ADD 1 TO WSS-J IN WSS-VARI.                                  
           GO TO LUP-PUT-TAB.                                           
       FIN-PUT-TAB.                                                     
                                                                        
           MOVE HOY-DHOY TO FEC-ITM1.                                   
           MOVE HOY-MHOY TO FEC-ITM2.                                   
           MOVE HOY-SHOY TO FEC-ITM3.                                   
           MOVE HOY-AHOY TO FEC-ITM4.                                   
           MOVE 1            TO FEC-NDIA.                               
           MOVE FEC-FORM-FEC TO FEC-FORM.                               
           MOVE FEC-RST-DIA  TO FEC-CMND.                               
           PERFORM CAL-FEC.                                             
           MOVE FEC-ITM1 TO FRM-NUM-DINF.                               
           MOVE FEC-ITM2 TO FRM-NUM-MINF.                               
           MOVE FEC-ITM3 TO FRM-NUM-SINF.                               
           MOVE FEC-ITM4 TO FRM-NUM-AINF.                               
                                                                        
      *INI-MARGEN SUBGRUPO                                              
           MOVE DBC-CAI-ICLI IN CLS-FLD TO DBC-CAI-ICLI IN DBC.         
           MOVE DBC-IIC-ICLI IN CLS-FLD TO DBC-IIC-ICLI IN DBC.         
           MOVE FIO-GET-KEY    TO FIO-CMND.                             
           PERFORM SGC-FIO-DBC.                                         
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.                        
           PERFORM CPT-BLKS.                                            
           MOVE CPT-STRN            TO DBC-GLS-NOMC IN DBC.             
           MOVE FIO-STAT TO PGM-STAT-DBC.                               
           MOVE DBC-CIC-ICLI IN DBC TO CCU-CIC-ICLI IN CCU-VARI.        
           MOVE 'S' TO WSS-IND-GRPO IN WSS-VARI.                        
           PERFORM BUS-CLI-CLF.                                         
           IF CCU-COD-MENS > SPACES                                     
              MOVE ZEROES                  TO WSS-VAL-MNAC-CLS          
           ELSE                                                         
              MOVE CLF-VAL-CMAX IN CLF TO WSS-VAL-MONE-CLS              
              MOVE CLF-COD-VCCF IN CLF TO WSS-VCAM-CLS                  
              PERFORM OBT-VAL-MNAC-CLS.                                 
      *FIN-MARGEN SUBGRUPO                                              
      *SUMA MONTO SIMULADO A MARGEN SUBGRUPO                            
           ADD WSS-VAL-MTSM IN WSS-VARI TO WSS-VAL-MNAC-CLS.            
              DIVIDE WSS-VAL-MNAC-CLS BY 1000 GIVING                    
                     FRM-VAL-MARS IN CLS-FLD ROUNDED.                   
                                                                        
      *SUMA MONTO SIMULADO A UTILIZADO SUBGRUPO                         
           ADD WSS-VAL-MTSM IN WSS-VARI TO WSS-VAL-UTLG IN WSS-VARI.    
                                                                        
           DIVIDE WSS-VAL-APRG IN WSS-VARI BY 1000 GIVING               
                  FRM-VAL-APRS IN CLS-FLD ROUNDED.                      
           DIVIDE WSS-VAL-UTLG IN WSS-VARI BY 1000 GIVING               
                  FRM-VAL-UTLS IN CLS-FLD ROUNDED.                      
           DIVIDE WSS-VAL-DISG IN WSS-VARI BY 1000 GIVING               
                  FRM-VAL-DISS IN CLS-FLD ROUNDED.                      
           DIVIDE WSS-VAL-GARG IN WSS-VARI BY 1000 GIVING               
                  FRM-VAL-GARS IN CLS-FLD ROUNDED.                      
                                                                        
      *CALCULO DISPONIBLE = MARGEN - UTILIZADO                          
           SUBTRACT FRM-VAL-UTLS IN CLS-FLD FROM                        
                    FRM-VAL-MARS IN CLS-FLD GIVING                      
                    FRM-VAL-DISS IN CLS-FLD ROUNDED.                    
                                                                        
           IF FRM-IIC-ISLC IN CLS-FLD NOT > SPACES                      
              GO TO CON-PUT-TAB.                                        
                                                                        
      *SIMULACION                                                       
           MOVE HOY-DHOY               TO CAM-NUM-DCAM IN CAM(1).       
           MOVE HOY-MHOY               TO CAM-NUM-MCAM IN CAM(1).       
           MOVE HOY-SHOY               TO CAM-NUM-SCAM IN CAM(1).       
           MOVE HOY-AHOY               TO CAM-NUM-ACAM IN CAM(1).       
           MOVE ZEROES                 TO WSS-NUM-CAMB IN WSS-VARI.     
           GO TO LUP-LLENA-VALORES.                                     
                                                                        
       LUP-FECHA-ANTERIOR.                                              
           MOVE CAM-NUM-DCAM IN CAM(1) TO FEC-ITM1.                     
           MOVE CAM-NUM-MCAM IN CAM(1) TO FEC-ITM2.                     
           MOVE CAM-NUM-SCAM IN CAM(1) TO FEC-ITM3.                     
           MOVE CAM-NUM-ACAM IN CAM(1) TO FEC-ITM4.                     
           MOVE FEC-FORM-FEC TO FEC-FORM.                               
           MOVE FEC-RST-DIA  TO FEC-CMND.                               
           MOVE 1            TO FEC-NDIA.                               
           PERFORM CAL-FEC.                                             
           MOVE FEC-ITM1               TO CAM-NUM-DCAM IN CAM(1).       
           MOVE FEC-ITM2               TO CAM-NUM-MCAM IN CAM(1).       
           MOVE FEC-ITM3               TO CAM-NUM-SCAM IN CAM(1).       
           MOVE FEC-ITM4               TO CAM-NUM-ACAM IN CAM(1).       
                                                                        
       LUP-LLENA-VALORES.                                               
           ADD 1                         TO WSS-NUM-CAMB IN WSS-VARI.   
           MOVE 'UCAP01'                 TO CAM-COD-VCAM IN CAM(1).     
           MOVE '0999  '                 TO CAM-COD-VCAM IN CAM(2).     
           MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2).     
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM TAB-FIO-CAM.                                         
           IF NOT ( FIO-STAT-OKS AND CAM-IND-VIGE = 'S')                
               IF WSS-NUM-CAMB IN WSS-VARI NOT > 61                     
                  GO TO LUP-FECHA-ANTERIOR                              
               ELSE                                                     
                  MOVE ZEROES TO FRM-SGV-MGRP IN CLS-FLD                
                  MOVE ZEROES TO FRM-SGV-UTRP IN CLS-FLD                
           ELSE                                                         
              COMPUTE FRM-SGV-MGRP IN CLS-FLD ROUNDED =                 
              ( FRM-VAL-MARS IN CLS-FLD * 100 / CAM-SGV-VCAM IN CAM )   
                                                                        
              COMPUTE FRM-SGV-UTRP IN CLS-FLD ROUNDED =                 
              ( FRM-VAL-UTLS IN CLS-FLD * 100 / CAM-SGV-VCAM IN CAM ).  
                                                                        
                                                                        
       CON-PUT-TAB.                                                     
           MOVE PGM-STAT-DBC TO FIO-STAT.                               
           MOVE 1                  TO QUE-NITM.                         
           MOVE CLS-LEN-TSCLS-MAS  TO QUE-LITM.                         
           MOVE CLS-TSCLS-MAS      TO QUE-COLA.                         
                                                                        
           IF WSS-NITM > CLS-TOT-OCC-CLS                                
              MOVE 'S'           TO CLS-MAS-IND-HMAS                    
           ELSE                                                         
              MOVE 'N'           TO CLS-MAS-IND-HMAS.                   
                                                                        
           MOVE WSS-NITM         TO WSS-NUM-ICUR.                       
           MOVE WSS-NUM-ICUR     TO WSS-NUM-ICUR-EDT.                   
           MOVE WSS-NUM-ICUR-EDT TO WSS-NUM-ICUR-ALF.                   
           MOVE WSS-NUM-ICUR-ALF TO CLS-MAS-NUM-TOCC.                   
           MOVE CLS-MAS-ITEM     TO QUE-ITEM.                           
           MOVE QUE-PUT          TO QUE-CMND.                           
           PERFORM GNS-PRO-QUE.                                         
           IF WSS-NITM > WSS-IMAX                                       
               MOVE 'DEU' TO MSG-COD-SIST                               
               MOVE 'CLSMECDMAS' TO MSG-COD-MENS                        
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MEN2.                           
       EXT-PUT-TAB.                                                     
           EXIT.                                                        
                                                                        
       SET-FRM-IFLD SECTION.                                            
       INI-SET-FRM-IFLD.                                                
           IF SCR-OFRM-SRV                                              
                MOVE 1 TO FRM-IFLD                                      
           ELSE                                                         
                ADD 1 TO FRM-IFLD.                                      
       FIN-SET-FRM-IFLD.                                                
           EXIT.                                                        
      *--------------------------------------------                     
       SCRL-TAB-CLS SECTION.                                            
       INI-SCRL-TAB-CLS.                                                
           MOVE SPACES TO MSG-COD-MENS.                                 
                                                                        
           IF FRM-FFLD = FRM-FFLD-PF6                                   
               PERFORM PUT-TAB-ASC                                      
           ELSE                                                         
               PERFORM PUT-TAB-DSC.                                     
           IF MSG-COD-MENS > SPACES                                     
               MOVE 'DEU' TO MSG-COD-SIST                               
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MEN2.                           
       FIN-SCRL-TAB-CLS.                                                
           EXIT.                                                        
                                                                        
      *--------------------------------------------                     
       PUT-TAB-CLS SECTION.                                             
       INI-PUT-TAB-CLS.                                                 
           PERFORM CLR-WSS.                                             
                                                                        
           MOVE WSS-CIC-NODO-CLS(WSS-J) TO DBC-CIC-ICLI IN DBC.         
           MOVE FIO-GET-KEY             TO FIO-CMND.                    
           PERFORM SGC-FIO-DBC.                                         
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.                        
           PERFORM CPT-BLKS.                                            
           MOVE CPT-STRN            TO WSS-GLS-NOMC IN WSS-VARI.        
                                                                        
      *AFRI-INI/OCT-2006                                                
           IF WSS-CIC-ISLC        = DBC-CIC-ICLI IN DBC                 
                MOVE '(*)'                    TO WSS-ETIQ IN CLS-VARI   
                MOVE WSS-GLS-NOMC IN WSS-VARI TO WSS-NOMC IN CLS-VARI   
                MOVE WSS-CLI IN CLS-VARI TO                             
                  WSS-GLS-NOMC IN WSS-VARI.                             
                                                                        
      *AFRI-FIN/OCT-2006                                                
                                                                        
           MOVE DBC-NUM-ICLI IN DBC TO WSS-NUM-ICLI IN WSS-VARI.        
           MOVE DBC-VRF-ICLI IN DBC TO WSS-VER-ICLI IN WSS-VARI.        
           MOVE DBC-IND-ICLI IN DBC TO WSS-IND-ICLI IN WSS-VARI.        
           MOVE DBC-GLS-ICLI IN DBC TO WSS-GLS-ICLI IN WSS-VARI.        
                                                                        
           MOVE WSS-CAI-NODO-CLS(WSS-J) TO WSS-CAI-ICLI-S IN WSS-VARI.  
           MOVE WSS-IIC-NODO-CLS(WSS-J) TO WSS-IIC-ICLI-S IN WSS-VARI.  
                                                                        
           MOVE WSS-VAL-MARC-CLS(WSS-J) TO WSS-VAL-MNAC-CLS.            
                                                                        
      *INI SOLICITUD BANCO (ESPECIAL)                                   
           IF WSS-VAL-APRI-CLS(WSS-J) > WSS-VAL-MNAC-CLS                
              MOVE WSS-VAL-MNAC-CLS TO WSS-VAL-APRI-CLS(WSS-J)          
              SUBTRACT WSS-VAL-UTLI-CLS(WSS-J) FROM                     
                       WSS-VAL-APRI-CLS(WSS-J) GIVING                   
                       WSS-VAL-DISI-CLS(WSS-J).                         
                                                                        
           IF WSS-VAL-APRA-CLS(WSS-J) > WSS-VAL-MNAC-CLS                
              MOVE WSS-VAL-MNAC-CLS TO WSS-VAL-APRA-CLS(WSS-J)          
              SUBTRACT WSS-VAL-UTLA-CLS(WSS-J) FROM                     
                       WSS-VAL-APRA-CLS(WSS-J) GIVING                   
                       WSS-VAL-DISA-CLS(WSS-J).                         
                                                                        
           IF WSS-VAL-APRM-CLS(WSS-J) > WSS-VAL-MNAC-CLS                
              MOVE WSS-VAL-MNAC-CLS TO WSS-VAL-APRM-CLS(WSS-J)          
              SUBTRACT WSS-VAL-UTLM-CLS(WSS-J) FROM                     
                       WSS-VAL-APRM-CLS(WSS-J) GIVING                   
                       WSS-VAL-DISM-CLS(WSS-J).                         
                                                                        
           IF WSS-VAL-APRL-CLS(WSS-J) > WSS-VAL-MNAC-CLS                
              MOVE WSS-VAL-MNAC-CLS TO WSS-VAL-APRL-CLS(WSS-J)          
              SUBTRACT WSS-VAL-UTLL-CLS(WSS-J) FROM                     
                       WSS-VAL-APRL-CLS(WSS-J) GIVING                   
                       WSS-VAL-DISL-CLS(WSS-J).                         
                                                                        
           IF WSS-VAL-APRF-CLS(WSS-J) > WSS-VAL-MNAC-CLS                
              MOVE WSS-VAL-MNAC-CLS TO WSS-VAL-APRF-CLS(WSS-J)          
              SUBTRACT WSS-VAL-UTLF-CLS(WSS-J) FROM                     
                       WSS-VAL-APRF-CLS(WSS-J) GIVING                   
                       WSS-VAL-DISF-CLS(WSS-J).                         
                                                                        
           IF WSS-VAL-APRB-CLS(WSS-J) > WSS-VAL-MNAC-CLS                
              MOVE WSS-VAL-MNAC-CLS TO WSS-VAL-APRB-CLS(WSS-J)          
              SUBTRACT WSS-VAL-UTLB-CLS(WSS-J) FROM                     
                       WSS-VAL-APRB-CLS(WSS-J) GIVING                   
                       WSS-VAL-DISB-CLS(WSS-J).                         
      *FIN SOLICITUD BANCO (ESPECIAL)                                   
                                                                        
           IF WSS-CIC-ISLC IN WSS-VARI = WSS-CIC-NODO-CLS(WSS-J)        
              ADD WSS-VAL-MTSM IN WSS-VARI TO WSS-VAL-MNAC-CLS.         
                                                                        
           DIVIDE WSS-VAL-MNAC-CLS BY 1000 GIVING                       
                  WSS-VAL-MARC IN WSS-VARI ROUNDED.                     
                                                                        
           DIVIDE WSS-VAL-CAPR-CLS(WSS-J) BY 1000 GIVING                
                  WSS-VAL-APRC IN WSS-VARI ROUNDED.                     
                                                                        
           DIVIDE WSS-VAL-CUTI-CLS(WSS-J) BY 1000 GIVING                
                  WSS-VAL-UTLC IN WSS-VARI ROUNDED.                     
                                                                        
           DIVIDE WSS-VAL-CDIS-CLS(WSS-J) BY 1000 GIVING                
                  WSS-VAL-DISC IN WSS-VARI ROUNDED.                     
                                                                        
           DIVIDE WSS-VAL-GARS-CLS(WSS-J) BY 1000 GIVING                
                  WSS-VAL-GARC IN WSS-VARI ROUNDED.                     
                                                                        
      *CALCULO DISPONIBLE = MARGEN - UTILIZADO                          
           SUBTRACT WSS-VAL-UTLC IN WSS-VARI FROM                       
                    WSS-VAL-MARC IN WSS-VARI GIVING                     
                    WSS-VAL-DISC IN WSS-VARI ROUNDED.                   
                                                                        
                                                                        
            DIVIDE WSS-VAL-APRI-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-APRI IN WSS-VARI ROUNDED.                    
            DIVIDE WSS-VAL-UTLI-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-UTLI IN WSS-VARI ROUNDED.                    
            DIVIDE WSS-VAL-DISI-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-DISI IN WSS-VARI ROUNDED.                    
                                                                        
            DIVIDE WSS-VAL-APRA-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-APRA IN WSS-VARI ROUNDED.                    
            DIVIDE WSS-VAL-UTLA-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-UTLA IN WSS-VARI ROUNDED.                    
            DIVIDE WSS-VAL-DISA-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-DISA IN WSS-VARI ROUNDED.                    
                                                                        
            DIVIDE WSS-VAL-APRM-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-APRM IN WSS-VARI ROUNDED.                    
            DIVIDE WSS-VAL-UTLM-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-UTLM IN WSS-VARI ROUNDED.                    
            DIVIDE WSS-VAL-DISM-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-DISM IN WSS-VARI ROUNDED.                    
                                                                        
            DIVIDE WSS-VAL-APRL-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-APRL IN WSS-VARI ROUNDED.                    
            DIVIDE WSS-VAL-UTLL-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-UTLL IN WSS-VARI ROUNDED.                    
            DIVIDE WSS-VAL-DISL-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-DISL IN WSS-VARI ROUNDED.                    
                                                                        
            DIVIDE WSS-VAL-APRF-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-APRF IN WSS-VARI ROUNDED.                    
            DIVIDE WSS-VAL-UTLF-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-UTLF IN WSS-VARI ROUNDED.                    
            DIVIDE WSS-VAL-DISF-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-DISF IN WSS-VARI ROUNDED.                    
                                                                        
            DIVIDE WSS-VAL-APRB-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-APRB IN WSS-VARI ROUNDED.                    
            DIVIDE WSS-VAL-UTLB-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-UTLB IN WSS-VARI ROUNDED.                    
            DIVIDE WSS-VAL-DISB-CLS(WSS-J) BY 1000 GIVING               
                   WSS-VAL-DISB IN WSS-VARI ROUNDED.                    
                                                                        
      *XON-INI 29-SEP-2008                                              
           IF  WSS-STA-CERR-CLS(WSS-J) = 'S'                            
               PERFORM LINEA-EN-ZEROS.                                  
      *XON-FIN 29-SEP-2008                                              
                                                                        
      *EDITA CAMPOS SOLO EN VERSION BEE                                 
           IF SCR-OFRM-SRV AND WSS-IND-VBEE = 'S'                       
              PERFORM EDT-VAL-CLS.                                      
                                                                        
           IF FRM-IFLD > WSS-IMAX                                       
              GO TO FIN-PUT-TAB-CLS.                                    
                                                                        
                                                                        
           MOVE WSS-GLS-NOMC IN WSS-VARI TO                             
                FRM-GLS-NOMC IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-NUM-ICLI IN WSS-VARI TO                             
                FRM-NUM-ICLI IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VER-ICLI IN WSS-VARI TO                             
                FRM-VER-ICLI IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-IND-ICLI IN WSS-VARI TO                             
                FRM-IND-ICLI IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-GLS-ICLI IN WSS-VARI TO                             
                FRM-GLS-ICLI IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-CAI-ICLI-S IN WSS-VARI TO                           
                FRM-CAI-ICLI IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-IIC-ICLI-S IN WSS-VARI TO                           
                FRM-IIC-ICLI IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-MARC IN WSS-VARI TO                             
                FRM-VAL-MARC IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-APRC IN WSS-VARI TO                             
                FRM-VAL-APRC IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-UTLC IN WSS-VARI TO                             
                FRM-VAL-UTLC IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-DISC IN WSS-VARI TO                             
                FRM-VAL-DISC IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-GARC IN WSS-VARI TO                             
                FRM-VAL-GARC IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-APRB IN WSS-VARI TO                             
                FRM-VAL-APRB IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-UTLB IN WSS-VARI TO                             
                FRM-VAL-UTLB IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-DISB IN WSS-VARI TO                             
                FRM-VAL-DISB IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-APRF IN WSS-VARI TO                             
                FRM-VAL-APRF IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-UTLF IN WSS-VARI TO                             
                FRM-VAL-UTLF IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-DISF IN WSS-VARI TO                             
                FRM-VAL-DISF IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-APRL IN WSS-VARI TO                             
                FRM-VAL-APRL IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-UTLL IN WSS-VARI TO                             
                FRM-VAL-UTLL IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-DISL IN WSS-VARI TO                             
                FRM-VAL-DISL IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-APRM IN WSS-VARI TO                             
                FRM-VAL-APRM IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-UTLM IN WSS-VARI TO                             
                FRM-VAL-UTLM IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-DISM IN WSS-VARI TO                             
                FRM-VAL-DISM IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-APRA IN WSS-VARI TO                             
                FRM-VAL-APRA IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-UTLA IN WSS-VARI TO                             
                FRM-VAL-UTLA IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-DISA IN WSS-VARI TO                             
                FRM-VAL-DISA IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-APRI IN WSS-VARI TO                             
                FRM-VAL-APRI IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-UTLI IN WSS-VARI TO                             
                FRM-VAL-UTLI IN CLS-FLD(FRM-IFLD).                      
           MOVE WSS-VAL-DISI IN WSS-VARI TO                             
                FRM-VAL-DISI IN CLS-FLD(FRM-IFLD).                      
       FIN-PUT-TAB-CLS.                                                 
           EXIT.                                                        
      *                                                                 
      *XON-INI 29-SEP-2008                                              
       LINEA-EN-ZEROS  SECTION.                                         
      *------------------------                                         
       INI-LINEA-EN-ZEROS.                                              
           MOVE  ZEROES  TO  WSS-VAL-MARC IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-APRC IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-UTLC IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-DISC IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-GARC IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-APRB IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-UTLB IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-DISB IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-APRF IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-UTLF IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-DISF IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-APRI IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-APRL IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-UTLL IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-DISL IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-UTLI IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-APRM IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-UTLM IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-DISM IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-DISI IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-APRA IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-UTLA IN WSS-VARI                   
           MOVE  ZEROES  TO  WSS-VAL-DISA IN WSS-VARI.                  
       FIN-LINEA-EN-ZEROS.                                              
           EXIT.                                                        
      *XON-FIN 29-SEP-2008                                              
      *                                                                 
      *----------------------------------------------------             
       PUT-CLS-QUE SECTION.                                             
       INI-PUT-CLS-QUE.                                                 
           ADD 1 TO WSS-NITM.                                           
           MOVE CLS-NOM-TSCLS    TO QUE-COLA.                           
           MOVE CLS-LEN-TSCLS    TO QUE-LITM.                           
           MOVE WSS-NITM         TO QUE-NITM.                           
           MOVE SPACES           TO QUE-ITEM.                           
           MOVE WSS-GLS-NOMC-IDX TO QUE-ITEM.                           
           MOVE QUE-PUT          TO QUE-CMND.                           
           PERFORM GNS-PRO-QUE.                                         
       FIN-PUT-CLS-QUE.                                                 
           EXIT.                                                        
      *----------------------------------------------------             
                                                                        
       PUT-TAB-ASC SECTION.                                             
       INI-PUT-TAB-ASC.                                                 
           MOVE SPACES TO MSG-COD-MENS.                                 
           MULTIPLY SCR-NUM-PANT BY WSS-IMAX GIVING QUE-NITM.           
           MOVE 0 TO FRM-IFLD.                                          
       LUP-PUT-TAB-ASC.                                                 
           ADD 1              TO QUE-NITM.                              
           MOVE CLS-NOM-TSCLS TO QUE-COLA.                              
           MOVE CLS-LEN-TSCLS TO QUE-LITM.                              
           MOVE QUE-GET       TO QUE-CMND.                              
           PERFORM GNS-PRO-QUE.                                         
           IF QUE-STAT NOT = QUE-STAT-OKS                               
               IF FRM-IFLD = 0                                          
                   MOVE 'CLSMECNONXT' TO MSG-COD-MENS                   
                   GO TO FIN-PUT-TAB-ASC                                
               ELSE                                                     
                   GO TO FIN-PUT-TAB-ASC.                               
           ADD 1 TO FRM-IFLD.                                           
           MOVE QUE-ITEM TO FRM-GLS-NOMC-IDX(FRM-IFLD).                 
           IF FRM-IFLD < WSS-IMAX                                       
               GO TO LUP-PUT-TAB-ASC.                                   
       FIN-PUT-TAB-ASC.                                                 
           IF FRM-IFLD > 0 AND FRM-IFLD < WSS-IMAX                      
               ADD 1 FRM-IFLD GIVING WSS-I                              
               PERFORM CLR-FRM VARYING WSS-I FROM WSS-I BY 1            
                                 UNTIL WSS-I > WSS-IMAX.                
           IF FRM-IFLD > 0                                              
               ADD 1 TO SCR-NUM-PANT.                                   
           IF FRM-IFLD = WSS-IMAX                                       
               ADD 1              TO QUE-NITM                           
               MOVE CLS-NOM-TSCLS TO QUE-COLA                           
               MOVE CLS-LEN-TSCLS TO QUE-LITM                           
               MOVE QUE-GET       TO QUE-CMND                           
               PERFORM GNS-PRO-QUE                                      
               IF QUE-STAT = QUE-STAT-OKS                               
                   MOVE 'DEU'        TO MSG-COD-SIST                    
                   MOVE 'CLSMECDMAS' TO MSG-COD-MENS.                   
       EXT-PUT-TAB-ASC.                                                 
           EXIT.                                                        
                                                                        
       PUT-TAB-DSC SECTION.                                             
       INI-PUT-TAB-DSC.                                                 
           MOVE SPACES TO MSG-COD-MENS.                                 
           IF SCR-NUM-PANT = 1                                          
               MOVE 'CLSMECNOPRV' TO MSG-COD-MENS                       
               GO TO EXT-PUT-TAB-DSC.                                   
                                                                        
           SUBTRACT 1 FROM SCR-NUM-PANT GIVING QUE-NITM.                
           MULTIPLY QUE-NITM BY WSS-IMAX GIVING QUE-NITM.               
           ADD 1 TO QUE-NITM.                                           
           ADD 1 WSS-IMAX GIVING FRM-IFLD.                              
       LUP-PUT-TAB-DSC.                                                 
           SUBTRACT  1 FROM QUE-NITM.                                   
           MOVE CLS-NOM-TSCLS TO QUE-COLA                               
           MOVE CLS-LEN-TSCLS TO QUE-LITM                               
           MOVE QUE-GET       TO QUE-CMND.                              
           PERFORM GNS-PRO-QUE.                                         
           IF QUE-STAT NOT = QUE-STAT-OKS                               
               IF FRM-IFLD > WSS-IMAX                                   
                   MOVE 'CLSMECNOPRV' TO MSG-COD-MENS                   
                   GO TO FIN-PUT-TAB-DSC                                
               ELSE                                                     
                   GO TO FIN-PUT-TAB-DSC.                               
           SUBTRACT 1 FROM FRM-IFLD.                                    
           MOVE QUE-ITEM TO FRM-GLS-NOMC-IDX(FRM-IFLD).                 
           IF FRM-IFLD > 1                                              
               GO TO LUP-PUT-TAB-DSC.                                   
       FIN-PUT-TAB-DSC.                                                 
                                                                        
           IF FRM-IFLD NOT > WSS-IMAX AND FRM-IFLD > 1                  
               SUBTRACT 1 FROM FRM-IFLD GIVING WSS-I                    
               PERFORM CLR-FRM VARYING WSS-I FROM WSS-I BY -1           
                                 UNTIL WSS-I < 1.                       
                                                                        
           IF FRM-IFLD NOT > WSS-IMAX                                   
               SUBTRACT 1 FROM SCR-NUM-PANT                             
               MOVE 'DEU'        TO MSG-COD-SIST                        
               MOVE 'CLSMECDMAS' TO MSG-COD-MENS.                       
       EXT-PUT-TAB-DSC.                                                 
           EXIT.                                                        
      *--------------------------------------------                     
       COPY SGCBFDBC.                                                   
       COPY SGCBFREC.                                                   
       COPY SGCBGCLI.                                                   
                                                                        
       COPY GNSBGCPT.                                                   
       COPY GNSBGSTR.                                                   
                                                                        
       EDT-VAL-CLS SECTION.                                             
       INI-EDT-VAL-CLS.                                                 
              MOVE WSS-VAL-MARC     IN WSS-VARI TO                      
                   FRM-VAL-MARC-EDT IN CLS-EDT.                         
              MOVE FRM-VAL-MARC-EDT IN CLS-EDT  TO                      
                   WSS-VAL-MARC-ALF IN WSS-VARI.                        
                                                                        
              MOVE WSS-VAL-APRC     IN WSS-VARI TO                      
                   FRM-VAL-APRC-EDT IN CLS-EDT.                         
              MOVE FRM-VAL-APRC-EDT IN CLS-EDT  TO                      
                   WSS-VAL-APRC-ALF IN WSS-VARI.                        
                                                                        
              MOVE WSS-VAL-UTLC     IN WSS-VARI TO                      
                   FRM-VAL-UTLC-EDT IN CLS-EDT.                         
              MOVE FRM-VAL-UTLC-EDT IN CLS-EDT  TO                      
                   WSS-VAL-UTLC-ALF IN WSS-VARI.                        
                                                                        
              MOVE WSS-VAL-DISC     IN WSS-VARI TO                      
                   FRM-VAL-DISC-EDT IN CLS-EDT.                         
              MOVE FRM-VAL-DISC-EDT IN CLS-EDT  TO                      
                   WSS-VAL-DISC-ALF IN WSS-VARI.                        
                                                                        
              MOVE WSS-VAL-GARC     IN WSS-VARI TO                      
                   FRM-VAL-GARC-EDT IN CLS-EDT.                         
              MOVE FRM-VAL-GARC-EDT IN CLS-EDT  TO                      
                   WSS-VAL-GARC-ALF IN WSS-VARI.                        
                                                                        
              MOVE WSS-VAL-APRB     IN WSS-VARI TO                      
                   FRM-VAL-APRB-EDT IN CLS-EDT.                         
              MOVE FRM-VAL-APRB-EDT IN CLS-EDT  TO                      
                   WSS-VAL-APRB-ALF IN WSS-VARI.                        
                                                                        
              MOVE WSS-VAL-UTLB     IN WSS-VARI TO                      
                   FRM-VAL-UTLB-EDT IN CLS-EDT.                         
              MOVE FRM-VAL-UTLB-EDT IN CLS-EDT  TO                      
                   WSS-VAL-UTLB-ALF IN WSS-VARI.                        
                                                                        
              MOVE WSS-VAL-DISB     IN WSS-VARI TO                      
                   FRM-VAL-DISB-EDT IN CLS-EDT.                         
              MOVE FRM-VAL-DISB-EDT IN CLS-EDT  TO                      
                   WSS-VAL-DISB-ALF IN WSS-VARI.                        
                                                                        
              MOVE WSS-VAL-APRF     IN WSS-VARI TO                      
                   FRM-VAL-APRF-EDT IN CLS-EDT.                         
              MOVE FRM-VAL-APRF-EDT IN CLS-EDT  TO                      
                   WSS-VAL-APRF-ALF IN WSS-VARI.                        
                                                                        
              MOVE WSS-VAL-UTLF     IN WSS-VARI TO                      
                   FRM-VAL-UTLF-EDT IN CLS-EDT.                         
              MOVE FRM-VAL-UTLF-EDT IN CLS-EDT  TO                      
                   WSS-VAL-UTLF-ALF IN WSS-VARI.                        
                                                                        
              MOVE WSS-VAL-DISF     IN WSS-VARI TO                      
                   FRM-VAL-DISF-EDT IN CLS-EDT.                         
              MOVE FRM-VAL-DISF-EDT IN CLS-EDT  TO                      
                   WSS-VAL-DISF-ALF IN WSS-VARI.                        
                                                                        
              MOVE WSS-VAL-APRI     IN WSS-VARI TO                      
                   FRM-VAL-APRI-EDT IN CLS-EDT.                         
              MOVE FRM-VAL-APRI-EDT IN CLS-EDT  TO                      
                   WSS-VAL-APRI-ALF IN WSS-VARI.                        
                                                                        
              MOVE WSS-VAL-APRL     IN WSS-VARI TO                      
                   FRM-VAL-APRL-EDT IN CLS-EDT.                         
              MOVE FRM-VAL-APRL-EDT IN CLS-EDT  TO                      
                   WSS-VAL-APRL-ALF IN WSS-VARI.                        
       FIN-EDT-VAL-CLS.                                                 
           EXIT.                                                        
                                                                        
       COPY LDCBKCCU.                                                   
       COPY TABBFCAM.                                                   
                                                                        
       VAL-REC SECTION.                                                 
       INI-VAL-REC.                                                     
           MOVE 'N' TO WSS-IND-STAT IN WSS-VARI.                        
           IF ( REC-IND-VIGE IN REC = 'S' AND                           
               (REC-FEC-FINI IN REC < HOY-FHOY OR                       
                REC-FEC-FINI IN REC = HOY-FHOY OR                       
                REC-FEC-FINI IN REC NOT > ZEROES ) AND                  
               (REC-FEC-FTER IN REC > HOY-FHOY OR                       
                REC-FEC-FTER IN REC = HOY-FHOY OR                       
                REC-FEC-FTER IN REC NOT > ZEROES ) )                    
                MOVE 'S' TO WSS-IND-STAT IN WSS-VARI.                   
       FIN-VAL-REC.                                                     
           EXIT.                                                        
                                                                        
       VAL-CLF-IDC SECTION.                                             
       INI-VAL-CLF-IDC.                                                 
      *MHM-INI 07-OCT-2008                                              
           MOVE SPACES TO WSS-IND-LEN0.                                 
      *MHM-FIN 07-OCT-2008                                              
           MOVE 'N'              TO WSS-IND-STAT IN WSS-VARI.           
      *XON-INI 02-JUN-2008                                              
           MOVE  SPACES          TO WSS-IND-RENO IN CLS-VARI.           
           MOVE  SPACES          TO WSS-IND-ING  IN CLS-VARI.           
           MOVE  SPACES          TO WSS-IND-ACT  IN CLS-VARI.           
           MOVE  SPACES          TO WSS-IND-CER  IN CLS-VARI.           
           MOVE  SPACES          TO WSS-IND-VRF  IN CLS-VARI.           
      *XON-FIN 02-JUN-2008                                              
           MOVE WSS-CIC-ICLI-RDC TO RDC-CIC-ICLI IN RDC.                
           MOVE SPACES           TO RDC-CIC-ICLF IN RDC.                
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM LDC-FIO-RDC.                                         
           MOVE FIO-STAT TO PGM-STAT-RDC.                               
           IF NOT ( FIO-STAT-OKS AND                                    
                    WSS-CIC-ICLI-RDC = RDC-CIC-ICLI IN RDC)             
               MOVE 'N' TO WSS-IND-STAT IN WSS-VARI                     
      *MHM-INI 07-OCT-2008                                              
               MOVE 'S' TO WSS-IND-LEN0                                 
      *MHM-FIN 07-OCT-2008                                              
               GO TO BRW-VAL-CLF-IDC.                                   
       LUP-VAL-CLF-IDC.                                                 
           MOVE RDC-CIC-ICLF IN RDC TO CLF-CIC-ICLF IN CLF.             
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM LDC-FIO-CLF.                                         
           IF NOT FIO-STAT-OKS                                          
               GO TO NXT-VAL-CLF-IDC.                                   
                                                                        
      *XON-INI 07-OCT-2008                                              
           IF  CLF-COD-TOCF IN CLF = 'CLF' AND                          
              (CLF-MSC-STAT IN CLF = 'I' OR 'V' OR 'C')                 
               MOVE 'S' TO  WSS-IND-STAT IN WSS-VARI.                   
      *XON-FIN 07-OCT-2008                                              
      *XON-INI 02-JUN-2008                                              
                                                                        
           IF CLF-MSC-STAT IN CLF = 'A' AND                             
              CLF-COD-TOCF IN CLF = 'CLF'                               
               MOVE 'S' TO WSS-IND-STAT IN WSS-VARI                     
               MOVE 'S' TO WSS-IND-ACT  IN CLS-VARI                     
               GO TO BRW-VAL-CLF-IDC.                                   
                                                                        
           IF CLF-COD-TOCF IN CLF = 'CLF'                               
               IF CLF-MSC-STAT IN CLF = 'C'                             
                   MOVE CLF TO WSS-GLS-CLFC IN CLS-VARI                 
                   MOVE 'S' TO WSS-IND-CER  IN CLS-VARI                 
               ELSE                                                     
               IF CLF-MSC-STAT IN CLF = 'R'                             
                   MOVE CLF TO WSS-GLS-CLFR IN CLS-VARI                 
                   MOVE 'S' TO WSS-IND-RENO IN CLS-VARI                 
               ELSE                                                     
               IF CLF-MSC-STAT IN CLF = 'I'                             
                   MOVE CLF TO WSS-GLS-CLFI IN CLS-VARI                 
                   MOVE 'S' TO WSS-IND-ING  IN CLS-VARI                 
               ELSE                                                     
               IF CLF-MSC-STAT IN CLF = 'V'                             
                   MOVE CLF TO WSS-GLS-CLFV IN CLS-VARI                 
                   MOVE 'S' TO WSS-IND-VRF  IN CLS-VARI.                
                                                                        
      *XON-FIN 02-JUN-2008                                              
                                                                        
       NXT-VAL-CLF-IDC.                                                 
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           PERFORM LDC-FIO-RDC.                                         
           MOVE FIO-STAT TO PGM-STAT-RDC.                               
           IF FIO-STAT-OKS AND WSS-CIC-ICLI-RDC = RDC-CIC-ICLI IN RDC   
              GO TO LUP-VAL-CLF-IDC.                                    
                                                                        
      *XON-INI 02-JUN-2008                                              
           IF WSS-IND-VRF IN CLS-VARI = 'S'                             
               MOVE  WSS-GLS-CLFV IN CLS-VARI TO CLF                    
               IF CLF-CIC-CREN IN CLF NOT > SPACES                      
                  MOVE 'S' TO WSS-IND-LEN0                              
                  GO TO BRW-VAL-CLF-IDC                                 
               ELSE                                                     
                  MOVE CLF-CIC-CREN IN CLF TO CLF-CIC-ICLF              
                  MOVE FIO-GET-KEY TO FIO-CMND                          
                  PERFORM LDC-FIO-CLF                                   
                  GO TO BRW-VAL-CLF-IDC.                                
                                                                        
           IF WSS-IND-ING IN CLS-VARI = 'S'                             
               MOVE  WSS-GLS-CLFI IN CLS-VARI TO CLF                    
               IF CLF-CIC-CREN IN CLF NOT > SPACES                      
                  MOVE 'S' TO WSS-IND-LEN0                              
                  GO TO BRW-VAL-CLF-IDC                                 
               ELSE                                                     
                  MOVE CLF-CIC-CREN IN CLF TO CLF-CIC-ICLF              
                  MOVE FIO-GET-KEY TO FIO-CMND                          
                  PERFORM LDC-FIO-CLF                                   
                  GO TO BRW-VAL-CLF-IDC.                                
                                                                        
           IF WSS-IND-CER IN CLS-VARI = 'S'                             
               MOVE 'S' TO WSS-IND-LEN0                                 
               MOVE  WSS-GLS-CLFC IN CLS-VARI TO CLF.                   
                                                                        
      *XON-FIN 02-JUN-2008                                              
       BRW-VAL-CLF-IDC.                                                 
           IF PGM-STAT-RDC-OKS                                          
               MOVE FIO-END-BRW TO FIO-CMND                             
               PERFORM LDC-FIO-RDC.                                     
       FIN-VAL-CLF-IDC.                                                 
           EXIT.                                                        
                                                                        
                                                                        
       CRG-CIC-NIVEL SECTION.                                           
       INI-CRG-CIC-NIVEL.                                               
           MOVE ZEROES TO MPC-N.                                        
           MOVE ZEROES TO WSS-ACT.                                      
           MOVE 1      TO WSS-C.                                        
           MOVE ZEROES TO WSS-F IN WSS-VARI.                            
           PERFORM CRG-CIC-NVLA.                                        
           IF WSS-F IN WSS-VARI NOT > ZEROES                            
              MOVE 'REC   NEX' TO MSG-COD-MENS                          
              GO TO FIN-CRG-CIC-NIVEL.                                  
                                                                        
       CON-CRG-CIC-NIVEL.                                               
           PERFORM CRG-VAL-VEC.                                         
           IF MSG-COD-MENS > SPACES                                     
              GO TO FIN-CRG-CIC-NIVEL.                                  
           IF WSS-I IN WSS-VARI = 1 AND MPC-N = ZEROES                  
              MOVE 'REC    NEX' TO MSG-COD-MENS.                        
       FIN-CRG-CIC-NIVEL.                                               
           EXIT.                                                        
                                                                        
       CRG-CIC-NVLA SECTION.                                            
       INI-CRG-CIC-NVLA.                                                
           MOVE ZEROES                       TO WSS-F IN WSS-VARI.      
           PERFORM CRG-CIC-NVLA-IDC.                                    
                                                                        
           MOVE WSS-CIC-ICLI-CLS IN WSS-VARI TO REC-CIC-ICLI IN REC.    
           MOVE WSS-COD-TREC IN WSS-VARI     TO REC-COD-TREC IN REC.    
           MOVE SPACES                       TO REC-CIC-IREL IN REC.    
           MOVE ZEROES                       TO REC-NUM-TREC IN REC.    
           MOVE FIO-GET-NLS TO FIO-CMND.                                
       LUP-CRG-CIC-NVLA.                                                
           PERFORM SGC-FIO-REC.                                         
           MOVE FIO-STAT TO PGM-STAT-REC.                               
           IF NOT ( FIO-STAT-OKS AND                                    
              REC-CIC-ICLI IN REC = WSS-CIC-ICLI-CLS IN WSS-VARI AND    
              REC-COD-TREC IN REC = WSS-COD-TREC IN WSS-VARI )          
              GO TO EXT-CRG-CIC-NVLA.                                   
                                                                        
           PERFORM VAL-REC.                                             
           IF WSS-IND-STAT IN WSS-VARI = 'N'                            
              GO TO NXT-CRG-CIC-NVLA.                                   
                                                                        
      *CARGA CIC SUBGRUPO/GRUPO/EMPRESA                                 
           ADD 1 TO WSS-F IN WSS-VARI.                                  
           IF WSS-F IN WSS-VARI > WSS-FMAX IN WSS-VARI                  
              GO TO EXT-CRG-CIC-NVLA.                                   
                                                                        
           MOVE WSS-C                    TO WSS-IND-NVLN(WSS-C,WSS-F).  
           MOVE 'E'                      TO WSS-IND-TCLI(WSS-C,WSS-F).  
           MOVE WSS-CIC-ICLI-CLS     TO WSS-CIC-PDRE(WSS-C,WSS-F).      
           MOVE REC-CIC-IREL IN REC      TO WSS-CIC-NODO(WSS-C,WSS-F).  
                                                                        
            MOVE WSS-CIC-NODO(WSS-C,WSS-F) TO  WSS-CIC-ICLI-RDC.        
           PERFORM VAL-CLF-IDC.                                         
           IF WSS-IND-STAT IN WSS-VARI = 'N'                            
              MOVE ZEROES TO WSS-VAL-MARC-M(WSS-C,WSS-F)                
              MOVE SPACES TO WSS-CIC-ICLF-M(WSS-C,WSS-F)                
           ELSE                                                         
              MOVE CLF-CIC-ICLF IN CLF TO WSS-CIC-ICLF-M(WSS-C,WSS-F)   
              MOVE CLF-VAL-CMAX IN CLF TO WSS-VAL-MONE-CLS              
              MOVE CLF-COD-VCCF IN CLF TO WSS-VCAM-CLS                  
              PERFORM OBT-VAL-MNAC-CLS                                  
              MOVE WSS-VAL-MNAC-CLS TO WSS-VAL-MARC-M(WSS-C,WSS-F).     
      *XON-INI 02-OCT-2008                                              
           MOVE WSS-IND-LEN0        TO WSS-STA-CERR-M(WSS-C,WSS-F).     
      *XON-FIN 02-OCT-2008                                              
                                                                        
       NXT-CRG-CIC-NVLA.                                                
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           GO TO LUP-CRG-CIC-NVLA.                                      
       EXT-CRG-CIC-NVLA.                                                
           IF PGM-STAT-REC-OKS                                          
              MOVE FIO-END-BRW TO FIO-CMND                              
              PERFORM SGC-FIO-REC.                                      
       FIN-CRG-CIC-NVLA.                                                
           EXIT.                                                        
                                                                        
       CRG-VAL-VEC SECTION.                                             
       INI-CRG-VAL-VEC.                                                 
           MOVE 1 TO WSS-I WSS-C WSS-F.                                 
       LUP-CRG-VAL-VEC.                                                 
           MOVE WSS-CIC-NODO(WSS-C,WSS-F)   TO CCU-CIC-ICLI IN CCU-VARI.
           MOVE WSS-CIC-ICLF-M(WSS-C,WSS-F) TO CCU-CIC-ICLF IN CCU-VARI.
                                                                        
           PERFORM CRG-VAL-PCCU.                                        
                                                                        
ZX         IF SCR-IERR = 'S'                                            
ZX            GO TO FIN-CRG-VAL-VEC                                     
ZX         ELSE                                                         
              IF CCU-CIC-ICLF IN CCU-VARI NOT > SPACES                  
                 PERFORM CRG-VEC-FRM.                                   
                                                                        
           ADD 1 TO WSS-I.                                              
       NXT-CRG-VAL-VEC.                                                 
           ADD 1 TO WSS-F.                                              
           IF WSS-F > WSS-FMAX                                          
              GO TO EXT-CRG-VAL-VEC.                                    
           IF WSS-CIC-NODO(WSS-C,WSS-F) NOT > SPACES                    
              GO TO EXT-CRG-VAL-VEC.                                    
           GO TO LUP-CRG-VAL-VEC.                                       
       EXT-CRG-VAL-VEC.                                                 
      *CARGA TOTAL DE PROCESAMIENTO PARALELOS                           
           MOVE MPC-N TO MPC-NMAX.                                      
       FIN-CRG-VAL-VEC.                                                 
           EXIT.                                                        
                                                                        
       CRG-CIC-NVLA-IDC SECTION.                                        
       INI-CRG-CIC-NVLA-IDC.                                            
           MOVE WSS-CIC-ICLI-CLS IN WSS-VARI TO WSS-CIC-ICLI-RDC.       
           PERFORM VAL-CLF-IDC.                                         
           IF WSS-IND-STAT IN WSS-VARI = 'N'                            
              GO TO FIN-CRG-CIC-NVLA-IDC.                               
                                                                        
      *GENERA SUBGRUPO COMO EMPRESA                                     
           MOVE WSS-CIC-ICLI-CLS IN WSS-VARI TO REC-CIC-ICLI IN REC.    
           MOVE WSS-COD-TREC IN WSS-VARI TO REC-COD-TREC IN REC.        
           MOVE SPACES                   TO REC-CIC-IREL IN REC.        
           MOVE ZEROES                   TO REC-NUM-TREC IN REC.        
           MOVE FIO-GET-NLS  TO FIO-CMND.                               
       LUP-CRG-CIC-NVLA-IDC.                                            
           PERFORM SGC-FIO-REC.                                         
           MOVE FIO-STAT TO PGM-STAT-REC.                               
           IF NOT ( FIO-STAT-OKS AND                                    
              REC-CIC-ICLI IN REC = WSS-CIC-ICLI-CLS IN WSS-VARI AND    
              REC-COD-TREC IN REC = WSS-COD-TREC IN WSS-VARI )          
              GO TO EXT-CRG-CIC-NVLA-IDC.                               
                                                                        
           PERFORM VAL-REC.                                             
           IF WSS-IND-STAT IN WSS-VARI = 'N'                            
              GO TO NXT-CRG-CIC-NVLA-IDC.                               
                                                                        
           ADD 1 TO WSS-F IN WSS-VARI.                                  
           IF WSS-F IN WSS-VARI > WSS-FMAX IN WSS-VARI                  
              GO TO EXT-CRG-CIC-NVLA-IDC.                               
                                                                        
           MOVE WSS-C                  TO WSS-IND-NVLN(WSS-C,WSS-F).    
           MOVE 'E'                    TO WSS-IND-TCLI(WSS-C,WSS-F).    
           MOVE WSS-CIC-ICLI-CLS  TO WSS-CIC-PDRE(WSS-C,WSS-F).         
           MOVE WSS-CIC-ICLI-CLS  TO WSS-CIC-NODO(WSS-C,WSS-F).         
           MOVE CLF-CIC-ICLF IN CLF TO WSS-CIC-ICLF-M(WSS-C,WSS-F).     
      *XON-INI 02-OCT-2008                                              
           MOVE WSS-IND-LEN0        TO WSS-STA-CERR-M(WSS-C,WSS-F).     
      *XON-FIN 02-OCT-2008                                              
           MOVE CLF-VAL-CMAX IN CLF TO WSS-VAL-MONE-CLS.                
           MOVE CLF-COD-VCCF IN CLF TO WSS-VCAM-CLS.                    
           PERFORM OBT-VAL-MNAC-CLS.                                    
           MOVE WSS-VAL-MNAC-CLS TO WSS-VAL-MARC-M(WSS-C,WSS-F).        
           GO TO EXT-CRG-CIC-NVLA-IDC.                                  
       NXT-CRG-CIC-NVLA-IDC.                                            
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           GO TO LUP-CRG-CIC-NVLA-IDC.                                  
       EXT-CRG-CIC-NVLA-IDC.                                            
           IF PGM-STAT-REC-OKS                                          
              MOVE FIO-END-BRW TO FIO-CMND                              
              PERFORM SGC-FIO-REC.                                      
       FIN-CRG-CIC-NVLA-IDC.                                            
           EXIT.                                                        
                                                                        
                                                                        
       CRG-VEC-FRM SECTION.                                             
       INI-CRG-VEC-FRM.                                                 
           MOVE WSS-I TO WSS-IND-SGRP(WSS-C,WSS-F).                     
           MOVE WSS-CIC-PDRE(WSS-C,WSS-F)   TO WSS-CIC-PDRE-CLS(WSS-I). 
           MOVE WSS-CIC-NODO(WSS-C,WSS-F)   TO WSS-CIC-NODO-CLS(WSS-I). 
           MOVE WSS-VAL-CAPR(WSS-C,WSS-F)   TO WSS-VAL-CAPR-CLS(WSS-I)  
           MOVE WSS-VAL-CUTI(WSS-C,WSS-F)   TO WSS-VAL-CUTI-CLS(WSS-I)  
           MOVE WSS-VAL-CDIS(WSS-C,WSS-F)   TO WSS-VAL-CDIS-CLS(WSS-I). 
           MOVE WSS-VAL-TGAR(WSS-C,WSS-F)   TO WSS-VAL-GARS-CLS(WSS-I). 
                                                                        
           MOVE WSS-VAL-APRI-M(WSS-C,WSS-F) TO WSS-VAL-APRI-CLS(WSS-I). 
           MOVE WSS-VAL-UTLI-M(WSS-C,WSS-F) TO WSS-VAL-UTLI-CLS(WSS-I). 
           MOVE WSS-VAL-DISI-M(WSS-C,WSS-F) TO WSS-VAL-DISI-CLS(WSS-I). 
                                                                        
           MOVE WSS-VAL-APRA-M(WSS-C,WSS-F) TO WSS-VAL-APRA-CLS(WSS-I). 
           MOVE WSS-VAL-UTLA-M(WSS-C,WSS-F) TO WSS-VAL-UTLA-CLS(WSS-I). 
           MOVE WSS-VAL-DISA-M(WSS-C,WSS-F) TO WSS-VAL-DISA-CLS(WSS-I). 
                                                                        
           MOVE WSS-VAL-APRM-M(WSS-C,WSS-F) TO WSS-VAL-APRM-CLS(WSS-I). 
           MOVE WSS-VAL-UTLM-M(WSS-C,WSS-F) TO WSS-VAL-UTLM-CLS(WSS-I). 
           MOVE WSS-VAL-DISM-M(WSS-C,WSS-F) TO WSS-VAL-DISM-CLS(WSS-I). 
                                                                        
           MOVE WSS-VAL-APRL-M(WSS-C,WSS-F) TO WSS-VAL-APRL-CLS(WSS-I). 
           MOVE WSS-VAL-UTLL-M(WSS-C,WSS-F) TO WSS-VAL-UTLL-CLS(WSS-I). 
           MOVE WSS-VAL-DISL-M(WSS-C,WSS-F) TO WSS-VAL-DISL-CLS(WSS-I). 
                                                                        
           MOVE WSS-VAL-APRF-M(WSS-C,WSS-F) TO WSS-VAL-APRF-CLS(WSS-I). 
           MOVE WSS-VAL-UTLF-M(WSS-C,WSS-F) TO WSS-VAL-UTLF-CLS(WSS-I). 
           MOVE WSS-VAL-DISF-M(WSS-C,WSS-F) TO WSS-VAL-DISF-CLS(WSS-I). 
                                                                        
           MOVE WSS-VAL-APRB-M(WSS-C,WSS-F) TO WSS-VAL-APRB-CLS(WSS-I). 
           MOVE WSS-VAL-UTLB-M(WSS-C,WSS-F) TO WSS-VAL-UTLB-CLS(WSS-I). 
           MOVE WSS-VAL-DISB-M(WSS-C,WSS-F) TO WSS-VAL-DISB-CLS(WSS-I). 
                                                                        
           MOVE WSS-VAL-MARC-M(WSS-C,WSS-F) TO WSS-VAL-MARC-CLS(WSS-I). 
      *XON-INI 02-OCT-2008                                              
           MOVE WSS-STA-CERR-M(WSS-C,WSS-F) TO WSS-STA-CERR-CLS(WSS-I). 
      *XON-FIN 02-OCT-2008                                              
       FIN-CRG-VEC-FRM.                                                 
           EXIT.                                                        
                                                                        
       CRG-VAL-PCCU SECTION.                                            
       INI-CRG-VAL-PCCU.                                                
GGG        MOVE 'N' TO WSS-IND-SOCU.                                    
           IF WSS-CIC-ISLC IN WSS-VARI = CCU-CIC-ICLI IN CCU-VARI       
              PERFORM CRG-SLC-CCU                                       
              MOVE 'S' TO MPC-IND-CGAR                                  
      *INI AFRI MAY 2007                                                
              MOVE 'S' TO WSS-IND-SOCU                                  
      *FIN AFRI MYT 2007                                                
              PERFORM CRG-VEC-CLS                                       
      *INI AFRI OCT 2006                                                
              PERFORM CRG-VEC-FRM                                       
      *FIN-AFRI OCT 2006                                                
              GO TO FIN-CRG-VAL-PCCU.                                   
                                                                        
           IF CCU-CIC-ICLF IN CCU-VARI > SPACES                         
              PERFORM PRO-CCU-MULT                                      
           ELSE                                                         
              MOVE ZEROES TO CTOT-MPC(1)                                
              MOVE 'S'    TO MPC-IND-CGAR                               
      *INI AFRI MAY 2007                                                
           MOVE 'N' TO WSS-IND-SOCU                                     
      *FIN AFRI MAY 2007                                                
           PERFORM CRG-VEC-CLS.                                         
       FIN-CRG-VAL-PCCU.                                                
           EXIT.                                                        
                                                                        
       CRG-VEC-CLS SECTION.                                             
       INI-CRG-VEC-CLS.                                                 
           MOVE ZEROES TO WSS-K IN WSS-VARI.                            
       LUP-CRG-VEC-CLS.                                                 
           ADD 1 TO WSS-K IN WSS-VARI.                                  
           IF WSS-K IN WSS-VARI > WSS-KMAX IN WSS-VARI OR               
              CTOT-MPC(WSS-K) NOT > ZEROES OR                           
              CTOT-MPC(WSS-K) NOT NUMERIC                               
              GO TO CNT-CRG-VEC-CLS.                                    
           ADD CTOT-MPC(WSS-K)    TO WSS-VAL-CAPR(WSS-C,WSS-F).         
           ADD CUTI-MPC(WSS-K)    TO WSS-VAL-CUTI(WSS-C,WSS-F).         
           ADD CDIS-MPC(WSS-K)    TO WSS-VAL-CDIS(WSS-C,WSS-F).         
                                                                        
           MOVE TIPO-MPC(WSS-K)   TO WSS-COD-TLCR(WSS-C,WSS-F).         
      *AFRI-INI/MAYO-2007 (MAE - ALD)                                   
           IF WSS-IND-SOCU = 'S'                                        
              IF TIPO-MPC(WSS-K) = 'GLB'                                
                 MOVE 'LBR' TO TIPO-MPC(WSS-K)                          
              END-IF                                                    
              IF TIPO-MPC(WSS-K) NOT > SPACES                           
                 MOVE 'LBR' TO TIPO-MPC(WSS-K)                          
              END-IF                                                    
              MOVE 'LDC'           TO FIO-SIST                          
              MOVE 'TLC'           TO TAB-COD-TTAB IN TAB               
              MOVE TIPO-MPC(WSS-K) TO TAB-COD-CTAB IN TAB               
              MOVE FIO-GET-KEY     TO FIO-CMND                          
              PERFORM GNS-FIO-TAB                                       
              MOVE TAB-COD-DAT3(10) TO TIPO-MPC(WSS-K).                 
      *AFRI-FIN/MAYO-2007 (MAE - ALD)                                   
      *TOTALES SEGUN UNIDAD DE NEGOCIO                                  
           IF TIPO-MPC(WSS-K) = 'CDB'                                   
              ADD CTOT-MPC(WSS-K) TO WSS-VAL-APRI-M(WSS-C,WSS-F)        
              ADD CUTI-MPC(WSS-K) TO WSS-VAL-UTLI-M(WSS-C,WSS-F)        
              ADD CDIS-MPC(WSS-K) TO WSS-VAL-DISI-M(WSS-C,WSS-F)        
           ELSE                                                         
           IF TIPO-MPC(WSS-K) = 'AFM'                                   
              ADD CTOT-MPC(WSS-K) TO WSS-VAL-APRA-M(WSS-C,WSS-F)        
              ADD CUTI-MPC(WSS-K) TO WSS-VAL-UTLA-M(WSS-C,WSS-F)        
              ADD CDIS-MPC(WSS-K) TO WSS-VAL-DISA-M(WSS-C,WSS-F)        
           ELSE                                                         
           IF TIPO-MPC(WSS-K) = 'MDD'                                   
              ADD CTOT-MPC(WSS-K) TO WSS-VAL-APRM-M(WSS-C,WSS-F)        
              ADD CUTI-MPC(WSS-K) TO WSS-VAL-UTLM-M(WSS-C,WSS-F)        
              ADD CDIS-MPC(WSS-K) TO WSS-VAL-DISM-M(WSS-C,WSS-F)        
           ELSE                                                         
           IF TIPO-MPC(WSS-K) = 'LSG'                                   
              ADD CTOT-MPC(WSS-K) TO WSS-VAL-APRL-M(WSS-C,WSS-F)        
              ADD CUTI-MPC(WSS-K) TO WSS-VAL-UTLL-M(WSS-C,WSS-F)        
              ADD CDIS-MPC(WSS-K) TO WSS-VAL-DISL-M(WSS-C,WSS-F)        
           ELSE                                                         
           IF TIPO-MPC(WSS-K) = 'FAC'                                   
              ADD CTOT-MPC(WSS-K) TO WSS-VAL-APRF-M(WSS-C,WSS-F)        
              ADD CUTI-MPC(WSS-K) TO WSS-VAL-UTLF-M(WSS-C,WSS-F)        
              ADD CDIS-MPC(WSS-K) TO WSS-VAL-DISF-M(WSS-C,WSS-F)        
           ELSE                                                         
              ADD CTOT-MPC(WSS-K) TO WSS-VAL-APRB-M(WSS-C,WSS-F)        
              ADD CUTI-MPC(WSS-K) TO WSS-VAL-UTLB-M(WSS-C,WSS-F)        
              ADD CDIS-MPC(WSS-K) TO WSS-VAL-DISB-M(WSS-C,WSS-F).       
                                                                        
      *TOTALES GENERALES DEL SUBGRUPO                                   
           ADD CTOT-MPC(WSS-K) TO WSS-VAL-APRG IN WSS-VARI.             
           ADD CUTI-MPC(WSS-K) TO WSS-VAL-UTLG IN WSS-VARI.             
           ADD CDIS-MPC(WSS-K) TO WSS-VAL-DISG IN WSS-VARI.             
       NXT-CRG-VEC-CLS.                                                 
           GO TO LUP-CRG-VEC-CLS.                                       
       CNT-CRG-VEC-CLS.                                                 
           IF MPC-IND-CGAR = 'N'                                        
              MOVE MPC-VAL-GARE TO WSS-VAL-GARE IN WSS-VARI             
           ELSE                                                         
              MOVE ZEROES       TO WSS-VAL-GARE IN WSS-VARI             
           PERFORM CARGA-GAR.                                           
                                                                        
           MOVE WSS-VAL-GARE IN WSS-VARI TO WSS-VAL-TGAR(WSS-C,WSS-F).  
           ADD WSS-VAL-GARE IN WSS-VARI  TO WSS-VAL-GARG IN WSS-VARI.   
                                                                        
      *SUMA MONTO SIMULADO A UTILIZADO POR EMPRESA                      
           IF WSS-CIC-ISLC IN WSS-VARI = CCU-CIC-ICLI IN CCU-VARI       
              ADD WSS-VAL-MTSM IN WSS-VARI TO                           
                                       WSS-VAL-CUTI(WSS-C,WSS-F).       
       EXT-CRG-VEC-CLS.                                                 
           EXIT.                                                        
                                                                        
       BUS-CLI-CLF SECTION.                                             
       INI-BUS-CLI-CLF.                                                 
           MOVE 99      TO CCU-NUM-MENS.                                
           MOVE 99      TO CCU-NUM-MEN2.                                
                                                                        
           MOVE SPACES  TO CCU-COD-MENS                                 
                           CCU-COD-MEN2                                 
                           CCU-COD-SIST.                                
                                                                        
           MOVE CCU-CIC-ICLI IN CCU-VARI TO RDC-CIC-ICLI IN RDC.        
           MOVE LOW-VALUES               TO RDC-KEY-ICLF IN RDC.        
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM LDC-FIO-RDC.                                         
           IF NOT ( FIO-STAT-OKS AND                                    
                    RDC-CIC-ICLI IN RDC = CCU-CIC-ICLI IN CCU-VARI )    
              MOVE 'RDC    NEX' TO CCU-COD-MENS                         
              MOVE 20           TO CCU-NUM-MENS                         
              IF FIO-STAT-OKS                                           
                 MOVE FIO-END-BRW TO FIO-CMND                           
                 PERFORM LDC-FIO-RDC.                                   
                                                                        
           IF CCU-COD-MENS NOT = 'RDC    NEX'                           
              GO TO LUP-BUS-CLI-CLF.                                    
           IF CCU-CAI-IOPC IN CCU-VARI(1) NOT > SPACES OR               
              CCU-IIC-IOPC IN CCU-VARI(1) = ZEROES                      
              GO TO FIN-BUS-CLI-CLF.                                    
       NO-ERROR-CLF-NEX.                                                
           MOVE 51 TO CCU-NUM-MENS.                                     
           GO TO FIN-BUS-CLI-CLF.                                       
       LUP-BUS-CLI-CLF.                                                 
           MOVE RDC-KEY-ICLF IN RDC TO CCU-CIC-ICLF IN CCU-VARI.        
           PERFORM BUS-CLF.                                             
           IF NOT FIO-STAT-OKS OR                                       
              FIO-STAT-OKS AND CCU-NUM-MENS = 99                        
               GO TO FIN-BUS-CLI-CLF.                                   
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           PERFORM LDC-FIO-RDC.                                         
           IF FIO-STAT-OKS AND                                          
              RDC-CIC-ICLI IN RDC = CCU-CIC-ICLI IN CCU-VARI            
               GO TO LUP-BUS-CLI-CLF.                                   
       FIN-BUS-CLI-CLF.                                                 
           EXIT.                                                        
                                                                        
       BUS-CLF SECTION.                                                 
       INI-BUS-CLF.                                                     
           MOVE CCU-CIC-ICLF IN CCU-VARI TO CLF-KEY-ICLF IN CLF.        
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM LDC-FIO-CLF.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'CLF    NEX' TO CCU-COD-MENS                        
               MOVE 1            TO CCU-NUM-MENS                        
               GO TO FIN-BUS-CLF.                                       
                                                                        
           IF ( CLF-COD-STAT IN CLF = 'M' OR 'X' )                      
              AND CCU-IIC-IOPC(1) > ZEROES                              
                   OR                                                   
              ( CLF-COD-STAT IN CLF = 'M' OR 'X' ) AND                  
              CCU-IIC-IOPC(1) NOT > ZEROES AND CLF-MSC-STAT NOT = 'V'   
               MOVE CLF-CIC-CREN IN CLF TO CLF-KEY-ICLF IN CLF          
               MOVE FIO-GET-KEY TO FIO-CMND                             
               PERFORM LDC-FIO-CLF                                      
               IF NOT FIO-STAT-OKS                                      
                   MOVE 'CLF    NEX' TO CCU-COD-MENS                    
                   MOVE 1            TO CCU-NUM-MENS                    
                   GO TO FIN-BUS-CLF                                    
               ELSE                                                     
                   MOVE 'A' TO CLF-MSC-STAT IN CLF                      
                   MOVE 'CLFREN-' TO CCU-COD-TMSG                       
                   MOVE 'M'       TO CCU-COD-CMSG                       
                   MOVE 51        TO CCU-NUM-MENS.                      
                                                                        
           IF CLF-FEC-FVEN IN CLF NOT > HOY-FHOY                        
               MOVE 'CLF    NOVIG' TO CCU-COD-MENS                      
               MOVE 2              TO CCU-NUM-MENS                      
               GO TO FIN-BUS-CLF.                                       
                                                                        
           IF CLF-MSC-STAT IN CLF = 'V' AND                             
              CCU-IIC-IOPC(1) NOT > ZEROES                              
               MOVE 'CLF    NOACA' TO CCU-COD-MENS                      
               MOVE 51             TO CCU-NUM-MENS                      
               GO TO FIN-BUS-CLF.                                       
                                                                        
           IF CLF-MSC-STAT IN CLF NOT = 'A'                             
               AND CCU-ESTA NOT > SPACES                                
      *XON-INI 02-JUN-2008                                              
               AND CLF-MSC-STAT IN CLF NOT = 'R'                        
      *XON-FIN 02-JUN-2008                                              
               MOVE 'CLF    NOVIG' TO CCU-COD-MENS                      
               MOVE 2              TO CCU-NUM-MENS                      
               GO TO FIN-BUS-CLF.                                       
                                                                        
           IF CCU-ESTA > SPACES AND                                     
              CLF-MSC-STAT IN CLF NOT = CCU-ESTA                        
               MOVE 'CLFSTATNOVAL' TO CCU-COD-MENS                      
               MOVE 2              TO CCU-NUM-MENS                      
               GO TO FIN-BUS-CLF.                                       
                                                                        
           IF ( WSS-IND-GRPO IN WSS-VARI = 'S' AND                      
                CLF-COD-TOCF IN CLF  NOT = 'CGE' )                      
               MOVE 'CLF    NOACA' TO CCU-COD-MENS                      
               MOVE 2              TO CCU-NUM-MENS                      
               GO TO FIN-BUS-CLF.                                       
                                                                        
           MOVE 99     TO CCU-NUM-MENS.                                 
           MOVE SPACES TO CCU-COD-MENS.                                 
       FIN-BUS-CLF.                                                     
           EXIT.                                                        
                                                                        
       OBT-VAL-MNAC-CLS SECTION.                                        
       INI-OBT-VAL-MNAC-CLS.                                            
      * Transforma monto a moneda corriente del dia                     
           MOVE WSS-VAL-MONE-CLS TO WSS-VAL-MNAC-CLS.                   
           IF (WSS-VCAM-CLS > SPACES AND                                
              WSS-VCAM-CLS NOT = WSS-COD-PESOS AND                      
               WSS-VAL-MONE-CLS > ZEROES AND WSS-VCAM-CLS NOT = 'P')    
              IF WSS-VCAM-CLS = WSS-COD-UEFES                           
                 MULTIPLY WSS-SGV-UEFES BY WSS-VAL-MONE-CLS             
                                    GIVING WSS-VAL-MNAC-CLS ROUNDED     
              ELSE                                                      
               MOVE WSS-VCAM-CLS TO CAM-COD-VCAM IN CAM(1)              
               MOVE FIO-GET-KEY TO FIO-CMND                             
               PERFORM TAB-FIO-CAM                                      
               IF NOT (FIO-STAT-OKS AND CAM-IND-VIGE IN CAM = 'S')      
                   MOVE 'CAM    NEX' TO CCU-COD-MENS                    
                   MOVE 20           TO CCU-NUM-MENS                    
                   MOVE CAM-KEY-CAMB IN CAM TO CCU-CAMB                 
               ELSE                                                     
                    MULTIPLY CAM-SGV-VCAM IN CAM BY WSS-VAL-MONE-CLS    
                                     GIVING WSS-VAL-MNAC-CLS ROUNDED.   
       FIN-OBT-VAL-MNAC-CLS.                                            
           EXIT.                                                        
                                                                        
       CLR-FRM SECTION.                                                 
       INI-CLR-FRM.                                                     
           MOVE SPACES TO FRM-GLS-NOMC IN CLS-FLD(WSS-I).               
           MOVE SPACES TO FRM-VER-ICLI IN CLS-FLD(WSS-I).               
           MOVE SPACES TO FRM-IND-ICLI IN CLS-FLD(WSS-I).               
           MOVE SPACES TO FRM-GLS-ICLI IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-NUM-ICLI IN CLS-FLD(WSS-I).               
           MOVE SPACES TO FRM-CAI-ICLI IN CLS-FLD(WSS-I).               
           MOVE SPACES TO FRM-IIC-ICLI IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-MARC IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-APRC IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-UTLC IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-DISC IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-GARC IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-APRB IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-UTLB IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-DISB IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-APRF IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-UTLF IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-DISF IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-APRL IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-UTLL IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-DISL IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-APRM IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-UTLM IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-DISM IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-APRA IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-UTLA IN CLS-FLD(WSS-I).               
           MOVE ZEROES TO FRM-VAL-DISA IN CLS-FLD(WSS-I).               
       FIN-CLR-FRM.                                                     
           EXIT.                                                        
                                                                        
       CLR-WSS SECTION.                                                 
       INI-CLR-WSS.                                                     
           MOVE SPACES TO WSS-GLS-NOMC IN WSS-VARI.                     
           MOVE SPACES TO WSS-VER-ICLI IN WSS-VARI.                     
           MOVE SPACES TO WSS-IND-ICLI IN WSS-VARI.                     
           MOVE SPACES TO WSS-GLS-ICLI IN WSS-VARI.                     
           MOVE ZEROES TO WSS-NUM-ICLI IN WSS-VARI.                     
           MOVE SPACES TO WSS-CAI-ICLI-S IN WSS-VARI.                   
           MOVE SPACES TO WSS-IIC-ICLI-S IN WSS-VARI.                   
           MOVE ZEROES TO WSS-VAL-MARC IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-APRC IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-UTLC IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-DISC IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-GARC IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-APRB IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-UTLB IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-DISB IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-APRF IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-UTLF IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-DISF IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-APRL IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-UTLL IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-DISL IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-APRM IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-UTLM IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-DISM IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-APRA IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-UTLA IN WSS-VARI.                     
           MOVE ZEROES TO WSS-VAL-DISA IN WSS-VARI.                     
           IF SCR-OFRM-SRV                                              
               PERFORM CLR-FRM-MTX.                                     
       FIN-CLR-WSS.                                                     
           EXIT.                                                        
                                                                        
       CLR-FRM-MTX SECTION.                                             
       INI-CLR-FRM-MTX.                                                 
           MOVE SPACES TO FRM-GLS-NOMC IN CLS-FLD(1).                   
           MOVE SPACES TO FRM-VER-ICLI IN CLS-FLD(1).                   
           MOVE SPACES TO FRM-IND-ICLI IN CLS-FLD(1).                   
           MOVE SPACES TO FRM-GLS-ICLI IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-NUM-ICLI IN CLS-FLD(1).                   
           MOVE SPACES TO FRM-CAI-ICLI IN CLS-FLD(1).                   
           MOVE SPACES TO FRM-IIC-ICLI IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-MARC IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-APRC IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-UTLC IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-DISC IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-GARC IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-APRB IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-UTLB IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-DISB IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-APRF IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-UTLF IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-DISF IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-APRL IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-UTLL IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-DISL IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-APRM IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-UTLM IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-DISM IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-APRA IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-UTLA IN CLS-FLD(1).                   
           MOVE ZEROES TO FRM-VAL-DISA IN CLS-FLD(1).                   
       FIN-CLR-FRM-MTX.                                                 
           EXIT.                                                        
      *------------------------------------------------------           
                                                                        
       LEE-SLC-CCU SECTION.                                             
       INI-LEE-SLC-CCU.                                                 
           MOVE FRM-CAI-ISLC IN CLS-FLD TO SLC-CAI-ISLC IN SLC.         
           MOVE FRM-IIC-ISLC IN CLS-FLD TO SLC-IIC-ISLC IN SLC.         
           MOVE 1                       TO SLC-NUM-ISLC IN SLC.         
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM LDC-FIO-SLC.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'SLC    NEX' TO MSG-COD-MENS                        
           ELSE                                                         
               MOVE SLC-CIC-ICLI IN SLC TO WSS-CIC-ISLC IN WSS-VARI.    
       FIN-LEE-SLC-CCU.                                                 
           EXIT.                                                        
                                                                        
       CRG-SLC-CCU SECTION.                                             
       INI-CRG-SLC-CCU.                                                 
           MOVE ZEROES TO WSS-M.                                        
           MOVE FRM-CAI-ISLC IN CLS-FLD TO SLC-CAI-ISLC IN SLC.         
           MOVE FRM-IIC-ISLC IN CLS-FLD TO SLC-IIC-ISLC IN SLC.         
           MOVE ZEROES                  TO SLC-NUM-ISLC IN SLC.         
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM LDC-FIO-SLC.                                         
       LUP-CRG-SLC-CCU.                                                 
           ADD 1 TO WSS-M.                                              
                                                                        
      *AFRI-INI/MAYO-2007 (MAE - ALD)                                   
      *    MOVE SLC-TIPO-LCR IN SLC TO TIPO-MPC(WSS-M).                 
      *    MOVE SLC-CAPR-LCR IN SLC TO CTOT-MPC(WSS-M).                 
      *    MOVE SLC-CTOT-LCR IN SLC TO CTOT-MPC(WSS-M).                 
      *    MOVE SLC-CUTI-LCR IN SLC TO CUTI-MPC(WSS-M).                 
      *    MOVE SLC-CDIS-LCR IN SLC TO CDIS-MPC(WSS-M).                 
      *    ADD  SLC-VAL-MNTO IN SLC TO WSS-VAL-MTSM IN WSS-VARI.        
           IF SLC-TIPO-LCR IN SLC = 'GLB'                               
               MOVE 'S'    TO WSS-IND-SGLB                              
               MOVE SLC-TIPO-LCR IN SLC TO TIPO-MPC(WSS-M)              
               MOVE SLC-CAPR-LCR IN SLC TO CTOT-MPC(WSS-M)              
               MOVE SLC-CTOT-LCR IN SLC TO CTOT-MPC(WSS-M)              
               MOVE SLC-CUTI-LCR IN SLC TO CUTI-MPC(WSS-M)              
               MOVE SLC-CDIS-LCR IN SLC TO CDIS-MPC(WSS-M)              
               ADD  SLC-VAL-MNTO IN SLC TO WSS-VAL-MTSM IN WSS-VARI     
      *        ADD  SLC-VAL-MNTO IN SLC TO CUTI-MPC(WSS-M)              
           ELSE                                                         
               MOVE 'N'    TO WSS-IND-SGLB                              
               MOVE SLC-TIPO-LCR IN SLC TO TIPO-MPC(WSS-M)              
               MOVE SLC-CAPR-LCR IN SLC TO CTOT-MPC(WSS-M)              
               MOVE SLC-CTOT-LCR IN SLC TO CTOT-MPC(WSS-M)              
               MOVE SLC-CUTI-LCR IN SLC TO CUTI-MPC(WSS-M)              
               MOVE SLC-CDIS-LCR IN SLC TO CDIS-MPC(WSS-M)              
               ADD  SLC-VAL-MNTO IN SLC TO CUTI-MPC(WSS-M)              
               SUBTRACT SLC-VAL-MNTO IN SLC FROM                        
                        CDIS-MPC(WSS-M)     GIVING                      
                        CDIS-MPC(WSS-M)     ROUNDED.                    
      *AFRI-FIN/MAYO-2007 (MAE - ALD)                                   
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           PERFORM LDC-FIO-SLC.                                         
           IF NOT ( FIO-STAT-OKS AND                                    
              SLC-CAI-ISLC IN SLC = FRM-CAI-ISLC IN CLS-FLD AND         
              SLC-IIC-ISLC IN SLC = FRM-IIC-ISLC IN CLS-FLD )           
              GO TO EXT-CRG-SLC-CCU                                     
           ELSE                                                         
           GO TO LUP-CRG-SLC-CCU.                                       
       EXT-CRG-SLC-CCU.                                                 
           IF FIO-STAT-OKS                                              
              MOVE FIO-END-BRW TO FIO-CMND                              
              PERFORM LDC-FIO-SLC.                                      
                                                                        
           ADD 1 TO WSS-M.                                              
           IF WSS-M > WSS-MMAX                                          
               GO TO FIN-CRG-SLC-CCU.                                   
                                                                        
           MOVE ZEROES TO CMAJ-MPC(WSS-M).                              
           MOVE ZEROES TO CTOT-MPC(WSS-M).                              
           MOVE ZEROES TO CUTI-MPC(WSS-M).                              
           MOVE ZEROES TO CDIS-MPC(WSS-M).                              
       FIN-CRG-SLC-CCU.                                                 
           EXIT.                                                        
                                                                        
       PRO-CCU-MULT SECTION.                                            
       INI-PRO-CCU-MULT.                                                
           ADD 1    TO MPC-N.                                           
           MOVE 'N' TO MPC-STAT(MPC-N).                                 
                                                                        
           MOVE CCU-CIC-ICLF IN CCU-VARI TO MPC-CIC-ICLF.               
           MOVE CCU-CIC-ICLI IN CCU-VARI TO MPC-CIC-CLIC.               
           MOVE WSS-C                    TO MPC-NUM-COLC.               
           MOVE WSS-F                    TO MPC-NUM-FILC.               
           MOVE WSS-I                    TO MPC-NUM-POSC.               
           MOVE CCU-COD-PESO IN CCU-VARI TO MPC-COD-PESO.               
           MOVE WSS-COD-UEFES            TO MPC-COD-UEFE.               
           MOVE WSS-SGV-UEFES            TO MPC-SGV-UEFE.               
           MOVE WSS-COD-REAL IN WSS-VARI TO MPC-COD-REAL.               
           MOVE SPACES                   TO MPC-IND-TPRO                
           MOVE ZEROES                   TO MPC-NUM-TPRO                
           MOVE SPACES                   TO MPC-GLS-DISP.               
           MOVE MPC-N                    TO MPC-NUM-CORR.               
                                                                        
           MOVE MPC-N        TO MPC-NUM-CORR-K.                         
                                                                        
                                                                        
      * GVI-INI mod. MEC 30-OCT-2006                                    
           IF WSS-CLI-PESADO  AND WSS-GET-RTK                           
                                                                        
              PERFORM CRG-RTK-MPC                                       
              IF WSS-RTK-OK                                             
                 MOVE WSS-I TO WSS-G                                    
                 PERFORM TOT-RTK-DMPC                                   
                 MOVE WSS-G TO WSS-I                                    
                 GO TO FIN-PRO-CCU-MULT                                 
              ELSE                                                      
                 GO TO FIN-PRO-CCU-MULT.                                
                                                                        
           IF WSS-CLI-PESADO  AND WSS-PUT-PTK AND MPC-N = 1             
              PERFORM ACT-ITK-TCKT.                                     
                                                                        
ZX         IF SCR-IERR = 'S'                                            
ZX            GO TO FIN-PRO-CCU-MULT.                                   
                                                                        
           IF WSS-CLI-PESADO  AND WSS-PUT-PTK                           
              PERFORM INS-PTK-CCU                                       
              GO TO FIN-PRO-CCU-MULT.                                   
      * GVI-FIN                                                         
                                                                        
           MOVE MPC-NOM-KMPC TO QUE-COLA.                               
           MOVE +1           TO QUE-LITM.                               
           MOVE +1           TO QUE-NITM.                               
           MOVE 'S'          TO QUE-ITEM.                               
           MOVE QUE-PUT      TO QUE-CMND.                               
           PERFORM GNS-PRO-QUE.                                         
           MOVE SCR-QIDD                 TO MPC-QIDD.                   
           MOVE SCR-LIDD                 TO MPC-LIDD.                   
           MOVE FIO-MSFL                 TO MPC-MSFL.                   
           MOVE MPC-CMMA                 TO SYS-CMMA.                   
           MOVE MPC-TCMA                 TO SYS-TCMA.                   
      *PROGRAMA=LDCPPMPC                                                
           EXEC CICS START                                              
                TRANSID( 'DQ71' )                                       
                FORM   ( SYS-CMMA )                                     
                LENGTH ( SYS-TCMA )                                     
           END-EXEC.                                                    
       FIN-PRO-CCU-MULT.                                                
           EXIT.                                                        
                                                                        
       COPY LDCBFSLC.                                                   
                                                                        
       LEE-TOT-DMPC SECTION.                                            
       INI-LEE-TOT-DMPC.                                                
           PERFORM DELAY-QMPC-N.                                        
           MOVE ZEROES TO MPC-L.                                        
           MOVE ZEROES TO MPC-NCLI.                                     
       LUP-LEE-TOT-DMPC.                                                
           ADD 1 TO MPC-L.                                              
           IF MPC-L > MPC-LMAX                                          
              GO TO FIN-LEE-TOT-DMPC.                                   
                                                                        
           PERFORM LEE-QUE-DMPC.                                        
           IF ( MSG-COD-MENS > SPACES OR MPC-NCLI = MPC-NMAX )          
              GO TO FIN-LEE-TOT-DMPC.                                   
                                                                        
       NXT-LEE-TOT-DMPC.                                                
           PERFORM DELAY-QMPC-1.                                        
           GO TO LUP-LEE-TOT-DMPC.                                      
       FIN-LEE-TOT-DMPC.                                                
           PERFORM DEL-ALL-MPC.                                         
           IF (MSG-COD-MENS NOT > SPACES AND MPC-NCLI NOT = MPC-NMAX)   
                                                                        
      * GVI-INI                                                         
              SET WSS-SI-TIMEOUT TO TRUE                                
RF2910        PERFORM INS-RUT-TBRPE                                     
      * GVI-FIN                                                         
                                                                        
              MOVE 'TIMEOUT  MEC' TO MSG-COD-MENS.                      
       EXT-LEE-TOT-DMPC.                                                
           EXIT.                                                        
RF2910*---------  INSERTA RUT DE LA EMPRESA EN TABLA RPE -------*       
RF2910 INS-RUT-TBRPE SECTION.                                           
RF2910 INI-INS-RUT-TBRPE.                                               
RF2910     MOVE SPACES                   TO TAB.                        
RF2910     MOVE 'TAB'                    TO TAB-COD-SIST.               
RF2910     MOVE 'RPE'                    TO TAB-COD-TTAB IN TAB.        
RF2910     MOVE  DBC-NUM-ICLI IN CLS-FLD TO WSS-NUM-IKLI.               
RF2910     MOVE  DBC-VRF-ICLI IN CLS-FLD TO WSS-VRF-IKLI.               
RF2910     MOVE  DBC-IND-ICLI IN CLS-FLD TO WSS-IND-IKLI.               
RF2910     MOVE  DBC-GLS-ICLI IN CLS-FLD TO WSS-GLS-IKLI.               
RF2910     MOVE  WSS-COD-IKLI            TO TAB-COD-CTAB IN TAB.        
RF2910     MOVE  WSS-COD-IKLI            TO TAB-CIC-CTAB IN TAB.        
RF2910     MOVE  'CLI.PESA.MEC'          TO TAB-GLS-DCOR IN TAB.        
RF2910     MOVE  'CLIPE'                 TO TAB-GLS-ABRV IN TAB.        
RF2910     MOVE  'CLIENTE PESADO MEC'    TO TAB-GLS-DESC IN TAB.        
RF2910     MOVE  'S'                     TO TAB-IND-VIGE.               
RF2910     MOVE HOY-SHOY                 TO TAB-NUM-STRN.               
RF2910     MOVE HOY-AHOY                 TO TAB-NUM-ATRN.               
RF2910     MOVE HOY-MHOY                 TO TAB-NUM-MTRN.               
RF2910     MOVE HOY-DHOY                 TO TAB-NUM-DTRN.               
RF2910     MOVE TAB-COD-SIST TO FIO-SIST.                               
RF2910     MOVE FIO-PUT TO FIO-CMND.                                    
RF2910     PERFORM GNS-FIO-TAB.                                         
RF2910 FIN-INS-RUT-TBRPE.                                               
RF2910     EXIT.                                                        
                                                                        
       LEE-QUE-DMPC SECTION.                                            
       INI-LEE-QUE-DMPC.                                                
           MOVE ZEROES TO MPC-N.                                        
       LUP-LEE-QUE-DMPC.                                                
           ADD 1 TO MPC-N.                                              
           IF MPC-N > MPC-NMAX                                          
              GO TO FIN-LEE-QUE-DMPC.                                   
                                                                        
           IF MPC-STAT(MPC-N) = 'S' OR MPC-STAT(MPC-N) NOT > SPACES     
              GO TO NXT-LEE-QUE-DMPC.                                   
                                                                        
           MOVE MPC-N  TO MPC-NUM-CORR.                                 
           PERFORM GET-MPC-RESP.                                        
           IF (MSG-COD-MENS > SPACES OR MPC-NCLI = MPC-NMAX)            
              GO TO FIN-LEE-QUE-DMPC.                                   
                                                                        
       NXT-LEE-QUE-DMPC.                                                
           GO TO LUP-LEE-QUE-DMPC.                                      
       FIN-LEE-QUE-DMPC.                                                
           EXIT.                                                        
                                                                        
       GET-MPC-RESP SECTION.                                            
       INI-GET-MPC-RESP.                                                
           PERFORM LEE-TS-DMPC.                                         
           IF QUE-STAT NOT = QUE-STAT-OKS                               
              GO TO FIN-GET-MPC-RESP.                                   
                                                                        
           MOVE QUE-ITEM TO MPC-ITEM.                                   
           IF MPC-IND-STAT = 'E'                                        
              MOVE MPC-COD-MENS TO MSG-COD-MENS                         
              MOVE MPC-MENS     TO FRM-MENS                             
              GO TO FIN-GET-MPC-RESP.                                   
                                                                        
           MOVE 'S'          TO MPC-STAT(MPC-N).                        
           ADD 1    TO MPC-NCLI.                                        
           PERFORM PRO-VEC-FRM.                                         
       FIN-GET-MPC-RESP.                                                
           EXIT.                                                        
                                                                        
       LEE-TS-DMPC SECTION.                                             
       INI-LEE-TS-DMPC.                                                 
           MOVE MPC-NOM-DMPC  TO QUE-COLA.                              
           MOVE MPC-LITM      TO QUE-LITM.                              
           MOVE +1            TO QUE-NITM.                              
           MOVE QUE-GET       TO QUE-CMND.                              
           PERFORM GNS-PRO-QUE.                                         
       FIN-LEE-TS-DMPC.                                                 
           EXIT.                                                        
                                                                        
       PRO-VEC-FRM SECTION.                                             
       INI-PRO-VEC-FRM.                                                 
           MOVE SPACES       TO CCU-COD-MENS IN CCU-VARI.               
           MOVE MPC-CIC-CLIQ TO CCU-CIC-ICLI IN CCU-VARI.               
           MOVE MPC-NUM-COLQ TO WSS-C.                                  
           MOVE MPC-NUM-FILQ TO WSS-F.                                  
           MOVE MPC-NUM-POSQ TO WSS-I.                                  
           MOVE 'N'          TO MPC-IND-CGAR.                           
           PERFORM CRG-VEC-CLS.                                         
           PERFORM CRG-VEC-FRM.                                         
       FIN-PRO-VEC-FRM.                                                 
           EXIT.                                                        
                                                                        
       DEL-ALL-MPC SECTION.                                             
       INI-DEL-ALL-MPC.                                                 
           MOVE 'E'      TO MPC-IND-TPRO.                               
           MOVE MPC-NMAX TO MPC-NUM-TPRO.                               
           MOVE ZEROES   TO MPC-NUM-CORR.                               
                                                                        
           MOVE SCR-QIDD TO MPC-QIDD.                                   
           MOVE SCR-LIDD TO MPC-LIDD.                                   
           MOVE FIO-MSFL TO MPC-MSFL.                                   
           MOVE MPC-CMMA TO SYS-CMMA.                                   
           MOVE MPC-TCMA TO SYS-TCMA.                                   
           EXEC CICS START                                              
                TRANSID( 'DQ71' )                                       
                FORM   ( SYS-CMMA )                                     
                LENGTH ( SYS-TCMA )                                     
           END-EXEC.                                                    
       FIN-DEL-ALL-MPC.                                                 
           EXIT.                                                        
                                                                        
       DELAY-QMPC-1 SECTION.                                            
       INI-DELAY-QMPC-1.                                                
           EXEC CICS DELAY INTERVAL(000001)                             
           END-EXEC.                                                    
       FIN-DELAY-QMPC-1.                                                
           EXIT.                                                        
                                                                        
       DELAY-QMPC-N SECTION.                                            
       INI-DELAY-QMPC-N.                                                
           IF MPC-NUM-DELAY = '1'                                       
              GO TO PRO-DELAY-1.                                        
           IF MPC-NUM-DELAY = '2'                                       
              GO TO PRO-DELAY-2.                                        
           IF MPC-NUM-DELAY = '3'                                       
              GO TO PRO-DELAY-3.                                        
           IF MPC-NUM-DELAY = '4'                                       
              GO TO PRO-DELAY-4.                                        
       PRO-DELAY-1.                                                     
           EXEC CICS DELAY INTERVAL(000001)                             
           END-EXEC.                                                    
           GO TO FIN-DELAY-QMPC-N.                                      
       PRO-DELAY-2.                                                     
           EXEC CICS DELAY INTERVAL(000002)                             
           END-EXEC.                                                    
           GO TO FIN-DELAY-QMPC-N.                                      
       PRO-DELAY-3.                                                     
           EXEC CICS DELAY INTERVAL(000003)                             
           END-EXEC.                                                    
           GO TO FIN-DELAY-QMPC-N.                                      
       PRO-DELAY-4.                                                     
           EXEC CICS DELAY INTERVAL(000004)                             
           END-EXEC.                                                    
           GO TO FIN-DELAY-QMPC-N.                                      
       FIN-DELAY-QMPC-N.                                                
           EXIT.                                                        
                                                                        
       CARGA-GAR SECTION.                                               
       INI-CARGA-GAR.                                                   
           MOVE CCU-CIC-ICLI IN CCU-VARI   TO GDD-CIC-DCLI IN GDD.      
           MOVE LOW-VALUES                 TO GDD-KEY-AGDD IN GDD.      
           MOVE FIO-GET-NLS  TO FIO-CMND.                               
           PERFORM BGL-FIO-GDD.                                         
           MOVE FIO-STAT TO PGM-STAT-GDD.                               
           IF NOT (FIO-STAT-OKS AND                                     
                   GDD-CIC-DCLI IN GDD = CCU-CIC-ICLI IN CCU-VARI)      
               GO TO BRW-CARGA-GAR.                                     
                                                                        
       LUP-CARGA-GAR.                                                   
           PERFORM CARGA-GVT.                                           
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           PERFORM BGL-FIO-GDD.                                         
           MOVE FIO-STAT TO PGM-STAT-GDD.                               
           IF FIO-STAT-OKS AND                                          
              GDD-CIC-DCLI IN GDD = CCU-CIC-ICLI IN CCU-VARI            
               GO TO LUP-CARGA-GAR.                                     
       BRW-CARGA-GAR.                                                   
           MOVE PGM-STAT-GDD TO FIO-STAT.                               
           IF FIO-STAT-OKS                                              
               MOVE FIO-END-BRW TO FIO-CMND                             
               PERFORM BGL-FIO-GDD.                                     
       FIN-CARGA-GAR.                                                   
           EXIT.                                                        
                                                                        
       CARGA-GVT SECTION.                                               
       INI-CARGA-GVT.                                                   
           MOVE GDD-KEY-AGDD IN GDD TO GDG-CIC-GTIA IN GDG.             
           MOVE FIO-GET-KEY  TO FIO-CMND.                               
           PERFORM BGL-FIO-GDG.                                         
           IF NOT ( FIO-STAT-OKS AND                                    
                    GDG-IND-GTAC IN GDG = 'S' AND                       
                    GDG-FEC-FALZ IN GDG NOT > ZEROES )                  
               GO TO FIN-CARGA-GVT.                                     
                                                                        
           MOVE GDG-COD-CGTA IN GDG TO TAG-COD-AGTA IN TAG.             
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-TAG.                                         
           IF TAG-IND-TREA IN TAG NOT = WSS-COD-REAL IN WSS-VARI        
               GO TO FIN-CARGA-GVT.                                     
                                                                        
           MOVE GDD-KEY-AGDD IN GDD TO GVT-KEY-IGVT IN GVT.             
           MOVE GDG-COD-TSCN IN GDG TO GVT-COD-TASN IN GVT.             
           MOVE FIO-GET-KEY  TO FIO-CMND.                               
           PERFORM BGL-FIO-GVT.                                         
           IF NOT ( FIO-STAT-OKS AND GVT-SGV-VPND IN GVT > ZEROES )     
               GO TO FIN-CARGA-GVT.                                     
                                                                        
           MOVE GVT-SGV-VCTS IN GVT TO WSS-VAL-MONE-CLS.                
           MOVE GDG-COD-VCAM IN GDG TO WSS-VCAM-CLS.                    
           PERFORM OBT-VAL-MNAC-CLS.                                    
GGX        IF WSS-CLI-PESADO                                            
GGX           ADD WSS-VAL-MNAC-CLS TO MPC-VAL-GARE                      
GGX        ELSE                                                         
              ADD WSS-VAL-MNAC-CLS TO WSS-VAL-GARE IN WSS-VARI.         
       FIN-CARGA-GVT.                                                   
           EXIT.                                                        
                                                                        
       COPY BGLBFGDD.                                                   
       COPY BGLBFGDG.                                                   
       COPY BGLBFGVT.                                                   
       COPY BGLBFTAG.                                                   
                                                                        
      * GVI-INI mod. MEC 30-OCT-2006                                    
       VAL-SWITCH SECTION.                                              
       INI-VAL-SWITCH.                                                  
                                                                        
           IF WSS-IND-SWT1 = 'S'                                        
                                                                        
      * Consulta BD Intermedia de Ticket.                               
      * Tomar la mas reciente consulta terminada                        
              PERFORM FND-ITK-RCNT                                      
              IF WSS-TICKET-OK                                          
                 SET WSS-GET-RTK TO TRUE                                
                                                                        
              ELSE                                                      
                                                                        
                 IF WSS-IND-SWT2 = 'S'                                  
                                                                        
      * Generar un nzmero de ticket, actualizar Base de Datos de Ticket 
      * Llamar ls rutina que ejecutara el pedido batch y informar Ticket
      *             PERFORM ACT-ITK-TCKT                                
                    SET WSS-PUT-PTK TO TRUE                             
                 ELSE                                                   
                    IF WSS-IND-SWT3 = 'S'                               
                                                                        
      * Con el Rut principal, armar el arbol.                           
      * Luego con Rut-Ticket consultar la BD y armar respuesta          
                       SET WSS-GET-RTK TO TRUE                          
                                                                        
                    ELSE                                                
                                                                        
                       IF WSS-IND-SWT4 = 'S'                            
                                                                        
      * Generar un nzmero de ticket, actualizar Base de Datos de Ticket 
      * Llamar ls rutina que ejecutara el pedido batch y informar Ticket
                                                                        
      *                   PERFORM ACT-ITK-TCKT                          
                          SET WSS-PUT-PTK TO TRUE                       
                                                                        
                       ELSE                                             
                                                                        
      * No se trabaja con ticket                                        
                          SET WSS-CLI-NORMAL TO TRUE.                   
                                                                        
           IF WSS-IND-SWT1 = 'N'                                        
                                                                        
                 IF WSS-IND-SWT2 = 'S'                                  
                                                                        
      * GENERAR UN NUMERO DE TICKET, ACTUALIZAR BASE DE DATOS DE TICKET 
      * Llamar ls rutina que ejecutara el pedido batch y informar Ticket
      *             PERFORM ACT-ITK-TCKT                                
                    SET WSS-PUT-PTK TO TRUE                             
                 ELSE                                                   
                    IF WSS-IND-SWT3 = 'S'                               
                                                                        
      * Con el Rut principal, armar el arbol.                           
      * Luego con Rut-Ticket consultar la BD y armar respuesta          
                       SET WSS-GET-RTK TO TRUE                          
                                                                        
                    ELSE                                                
                                                                        
                       IF WSS-IND-SWT4 = 'S'                            
                                                                        
      * Generar un nzmero de ticket, actualizar Base de Datos de Ticket 
      * Llamar ls rutina que ejecutara el pedido batch y informar Ticket
                                                                        
      *                   PERFORM ACT-ITK-TCKT                          
                          SET WSS-PUT-PTK TO TRUE                       
                                                                        
                       ELSE                                             
                                                                        
      * No se trabaja con ticket                                        
                          SET WSS-CLI-NORMAL TO TRUE.                   
       FIN-VAL-SWITCH.                                                  
           EXIT.                                                        
                                                                        
       FND-ITK-TICK SECTION.                                            
      * Busca el Ticket indicado en pantalla y que sea completado       
       INI-FND-ITK-TICK.                                                
           MOVE FRM-GLS-TICK IN CLS-FLD TO ITK-KEY-IITK IN ITK.         
           MOVE FIO-GET-KEY TO FIO-CMND                                 
           PERFORM GNS-FIO-ITK.                                         
           IF   FIO-STAT-OKS         AND                                
                ITK-IND-RESP IN ITK  = '1'                              
              MOVE ITK-FEC-FPRO IN ITK  TO WSS-FEC-FECH                 
              MOVE WSS-NUM-DFEC         TO FRM-NUM-DECH IN CLS-FLD      
              MOVE WSS-NUM-MFEC         TO FRM-NUM-MECH IN CLS-FLD      
              MOVE WSS-NUM-SFEC         TO FRM-NUM-SECH IN CLS-FLD      
              MOVE WSS-NUM-AFEC         TO FRM-NUM-AECH IN CLS-FLD      
              MOVE ITK-HRA-HRPR IN ITK  TO FRM-HRA-HORA IN CLS-FLD      
           ELSE                                                         
              MOVE 'TICK   NEX'         TO MSG-COD-MENS.                
       FIN-FND-ITK-TICK.                                                
           EXIT.                                                        
                                                                        
       GET-RUT-ICLI SECTION.                                            
       INI-GET-RUT-ICLI.                                                
      * Busca Cliente indicado en el ticket                             
           MOVE ITK-COD-ENTI IN ITK(1:8) TO DBC-NUM-ICLI IN DBC         
           MOVE SPACES                   TO DBC-IND-ICLI IN DBC         
           MOVE SPACES                   TO DBC-GLS-ICLI IN DBC         
           MOVE 'DBC-IDC-ICLI' TO FIO-AKEY                              
           MOVE FIO-GET-KEY    TO FIO-CMND                              
           PERFORM GET-CLI                                              
           IF MSG-COD-MENS NOT > SPACES                                 
              MOVE DBC-NUM-ICLI IN DBC   TO DBC-NUM-ICLI IN CLS-FLD     
              MOVE DBC-VRF-ICLI IN DBC   TO DBC-VRF-ICLI IN CLS-FLD     
              MOVE DBC-GLS-NOMC IN DBC   TO CPT-STRN                    
              PERFORM CPT-BLKS                                          
              MOVE CPT-STRN              TO DBC-GLS-NOMC IN CLS-FLD     
              MOVE DBC-CAI-ICLI IN DBC   TO DBC-CAI-ICLI IN CLS-FLD     
              MOVE DBC-IIC-ICLI IN DBC   TO DBC-IIC-ICLI IN CLS-FLD     
              MOVE '00' TO PGM-STAT-DBC                                 
           ELSE                                                         
              MOVE MSG-GLS-DESC TO FRM-MENS CLS-GLS-MENS                
              MOVE 'S' TO SCR-IERR.                                     
       FIN-GET-RUT-ICLI.                                                
           EXIT.                                                        
                                                                        
                                                                        
                                                                        
       FND-ITK-FECH SECTION.                                            
      * Busca el Ticket por RUT y FECHA indicados en pantalla           
      * y que sea completado                                            
       INI-FND-ITK-FECH.                                                
           MOVE WSS-COD-SIST            TO ITK-COD-SIST IN ITK.         
           MOVE WSS-COD-TPRO            TO ITK-COD-TPRO IN ITK.         
           MOVE DBC-NUM-ICLI IN CLS-FLD TO WSS-NUM-IKLI                 
           MOVE DBC-VRF-ICLI IN CLS-FLD TO WSS-VRF-IKLI                 
           MOVE DBC-IND-ICLI IN CLS-FLD TO WSS-IND-IKLI                 
           MOVE DBC-GLS-ICLI IN CLS-FLD TO WSS-GLS-IKLI                 
           MOVE WSS-COD-ENTI            TO ITK-COD-ENTI IN ITK.         
           MOVE FRM-NUM-DECH IN CLS-FLD TO WSS-NUM-DFEC                 
           MOVE FRM-NUM-MECH IN CLS-FLD TO WSS-NUM-MFEC                 
           MOVE FRM-NUM-SECH IN CLS-FLD TO WSS-NUM-SFEC                 
           MOVE FRM-NUM-AECH IN CLS-FLD TO WSS-NUM-AFEC                 
           MOVE WSS-FEC-FECH            TO ITK-FEC-FPRO IN ITK.         
           MOVE FRM-HRA-HORA IN CLS-FLD TO ITK-HRA-HRPR IN ITK.         
           MOVE HIGH-VALUE              TO ITK-NUM-UNIC IN ITK.         
           MOVE FIO-GET-LEQ             TO FIO-CMND.                    
       LUP-FND-ITK-FECH.                                                
           MOVE 'ITK-KEY-AITK'          TO FIO-AKEY                     
           PERFORM GNS-FIO-ITK                                          
                                                                        
           IF NOT (FIO-STAT-OKS                              AND        
                   ITK-COD-SIST IN ITK   = WSS-COD-SIST      AND        
                   ITK-COD-TPRO IN ITK   = WSS-COD-TPRO      AND        
                   ITK-COD-ENTI IN ITK (1:13) = WSS-COD-ENTI AND        
                   ITK-FEC-FPRO IN ITK   = WSS-FEC-FECH      AND        
                   ITK-HRA-HRPR IN ITK   = FRM-HRA-HORA IN CLS-FLD )    
                                                                        
              SET WSS-TICKET-KO TO TRUE                                 
           ELSE                                                         
              IF  ITK-IND-RESP IN ITK   = '1'                           
                 MOVE ITK-CIC-IITK IN ITK  TO FRM-GLS-TICK IN CLS-FLD   
                 SET WSS-TICKET-OK TO TRUE                              
              ELSE                                                      
                 MOVE FIO-GET-PRV       TO FIO-CMND                     
                 GO TO LUP-FND-ITK-FECH.                                
       FIN-FND-ITK-FECH.                                                
           EXIT.                                                        
                                                                        
       FND-ITK-RCNT SECTION.                                            
      * Busca el mas reciente Ticket completado                         
       INI-FND-ITK-RCNT.                                                
           MOVE WSS-COD-SIST            TO ITK-COD-SIST IN ITK.         
           MOVE WSS-COD-TPRO            TO ITK-COD-TPRO IN ITK.         
           MOVE DBC-IND-ICLI IN CLS-FLD TO WSS-IND-ICLI                 
           MOVE DBC-GLS-ICLI IN CLS-FLD TO WSS-GLS-ICLI                 
           MOVE WSS-COD-ENTI            TO ITK-COD-ENTI IN ITK.         
           MOVE WSS-FEC-FPRO            TO ITK-FEC-FPRO IN ITK.         
           MOVE WSS-HRA-HRPR            TO ITK-HRA-HRPR IN ITK.         
           MOVE HIGH-VALUE              TO ITK-NUM-UNIC IN ITK          
                                                                        
           MOVE FIO-GET-LEQ             TO FIO-CMND.                    
       LUP-FND-ITK-RCNT.                                                
           MOVE 'ITK-KEY-AITK'          TO FIO-AKEY                     
           PERFORM GNS-FIO-ITK                                          
           IF NOT ( FIO-STAT-OKS                             AND        
                   ITK-COD-SIST IN ITK        = WSS-COD-SIST AND        
                   ITK-COD-TPRO IN ITK        = WSS-COD-TPRO AND        
                   ITK-COD-ENTI IN ITK (1:13) = WSS-COD-ENTI )          
              SET WSS-TICKET-KO TO TRUE                                 
           ELSE                                                         
              IF ITK-IND-RESP IN ITK        = '1'                       
                 MOVE ITK-CIC-IITK IN ITK  TO FRM-GLS-TICK IN CLS-FLD   
                 MOVE ITK-FEC-FPRO IN ITK  TO WSS-FEC-FECH              
                 MOVE WSS-NUM-DFEC         TO FRM-NUM-DECH IN CLS-FLD   
                 MOVE WSS-NUM-MFEC         TO FRM-NUM-MECH IN CLS-FLD   
                 MOVE WSS-NUM-SFEC         TO FRM-NUM-SECH IN CLS-FLD   
                 MOVE WSS-NUM-AFEC         TO FRM-NUM-AECH IN CLS-FLD   
                 MOVE ITK-HRA-HRPR IN ITK  TO FRM-HRA-HORA IN CLS-FLD   
                 SET WSS-TICKET-OK TO TRUE                              
              ELSE                                                      
                 MOVE FIO-GET-PRV       TO FIO-CMND                     
                 GO TO LUP-FND-ITK-RCNT.                                
       FIN-FND-ITK-RCNT.                                                
           EXIT.                                                        
                                                                        
       ACT-ITK-TCKT SECTION.                                            
       INI-ACT-ITK-TCKT.                                                
           MOVE SPACES       TO TCK-CMMA.                               
           MOVE WSS-COD-IITK TO TCK-CAI-ITCK.                           
           MOVE WSS-COD-SIST TO TCK-COD-SIST.                           
           MOVE WSS-COD-TPRO TO TCK-COD-TPRO.                           
           MOVE WSS-COD-ENTI TO TCK-COD-ENTI.                           
           MOVE WSS-NUM-SECU TO TCK-NUM-SECU                            
           MOVE WSS-COD-WITK TO TCK-COD-WITK.                           
                                                                        
           MOVE WSS-GNSPPADT TO SYS-PROG.                               
           MOVE TCK-TCMA     TO SYS-TCMA.                               
           MOVE TCK-CMMA     TO SYS-CMMA.                               
           MOVE SYS-LINK     TO SYS-CMND.                               
                                                                        
           PERFORM GNS-PRO-SYS.                                         
                                                                        
GGG        MOVE SYS-CMMA      TO TCK-CMMA                               
                                                                        
           MOVE TCK-COD-MENS  TO MSG-COD-MENS                           
           MOVE TCK-GLS-MENS  TO MSG-GLS-DESC                           
                                                                        
           IF MSG-COD-MENS NOT > SPACES                                 
              MOVE TCK-CIC-ITCK TO ITK-CIC-IITK                         
           ELSE                                                         
              MOVE MSG-GLS-DESC TO FRM-MENS CLS-GLS-MENS                
              MOVE 'S' TO SCR-IERR.                                     
ZX    *       GO TO MSG-FND-KEY.                                        
                                                                        
       FIN-ACT-ITK-TCKT.                                                
           EXIT.                                                        
                                                                        
                                                                        
      *  Valoriza el area MPC                                           
      *  Primero se lee la respuesta CCU (3 registros RTK).             
       CRG-RTK-MPC SECTION.                                             
           MOVE ITK-CAI-IITK IN ITK      TO RTK-CAI-IITK IN RTK         
           MOVE ITK-IIC-IITK IN ITK      TO RTK-IIC-IITK IN RTK.        
           MOVE 1                        TO RTK-NUM-SECT IN RTK.        
           MOVE CCU-CIC-ICLF IN CCU-VARI TO WSS-CIC-ICLF IN WSS-VARI    
           MOVE CCU-CIC-ICLI IN CCU-VARI TO WSS-CIC-CLIC IN WSS-VARI.   
           MOVE WSS-COD-ENTT IN WSS-VARI TO RTK-COD-ENTT IN RTK.        
                                                                        
           MOVE 1                        TO RTK-NUM-CORT IN RTK.        
           MOVE FIO-GET-KEY              TO FIO-CMND                    
           PERFORM GNS-FIO-RTK                                          
           IF FIO-STAT-OKS                                              
              SET WSS-RTK-OK             TO TRUE                        
              MOVE RTK-GLS-RESP IN RTK   TO WSS-CCU-RTK1 IN WSS-VARI    
           ELSE                                                         
              SET WSS-RTK-KO             TO TRUE                        
              GO TO FIN-CRG-RTK-MPC.                                    
      *       MOVE 'S'                   TO SCR-IERR                    
      *       MOVE 'RTK    NEX'          TO MSG-COD-MENS                
      *       GO TO MSG-FND-KEY.                                        
                                                                        
           MOVE 2                        TO RTK-NUM-CORT IN RTK.        
           MOVE FIO-GET-KEY              TO FIO-CMND                    
           PERFORM GNS-FIO-RTK                                          
           IF FIO-STAT-OKS                                              
              MOVE RTK-GLS-RESP IN RTK   TO WSS-CCU-RTK2 IN WSS-VARI    
           ELSE                                                         
              MOVE 'S'                   TO SCR-IERR                    
              MOVE 'RTK    NEX'          TO MSG-COD-MENS                
ZX            GO TO FIN-CRG-RTK-MPC.                                    
ZX    *       GO TO MSG-FND-KEY.                                        
                                                                        
           MOVE 3                        TO RTK-NUM-CORT IN RTK.        
           MOVE FIO-GET-KEY              TO FIO-CMND                    
           PERFORM GNS-FIO-RTK                                          
           IF FIO-STAT-OKS                                              
              MOVE RTK-GLS-RESP IN RTK   TO WSS-CCU-RTK3 IN WSS-VARI    
           ELSE                                                         
              MOVE 'S'                   TO SCR-IERR                    
              MOVE 'RTK    NEX'          TO MSG-COD-MENS                
ZX            GO TO FIN-CRG-RTK-MPC.                                    
ZX    *       GO TO MSG-FND-KEY.                                        
      *  Sumariza la respuesta CCU en el area MPC (clon de LDCPPMPC)    
       INI-LDCPPMPC.                                                    
           MOVE ZEROES       TO MPC-VAL-GARE.                           
           MOVE ZEROES       TO CTOT-MPC(1).                            
           MOVE WSS-CCU-RTK IN WSS-VARI TO CCU-CMMA IN CCU-VARI.        
                                                                        
           MOVE 'S'          TO MPC-IND-STAT.                           
           MOVE SPACES       TO MPC-MENS.                               
           IF OK-OPCS-ANTIGUAS AND OK-OPC-EN-CURSE                      
               GO TO CNT-MAIN.                                          
                                                                        
      *    PERFORM ANL-CCU-MENS.                                        
       CNT-MAIN.                                                        
           IF MPC-IND-STAT = 'S'                                        
              PERFORM CRG-MPC-VEC                                       
GGX           MOVE MPC-CIC-CLIC TO CCU-CIC-ICLI IN CCU-VARI             
              PERFORM CARGA-GAR                                         
           ELSE                                                         
              MOVE CCU-COD-MENS TO MPC-COD-MENS.                        
                                                                        
           MOVE MPC-CIC-CLIC   TO MPC-CIC-CLIQ.                         
           MOVE MPC-NUM-COLC   TO MPC-NUM-COLQ.                         
           MOVE MPC-NUM-FILC   TO MPC-NUM-FILQ.                         
           MOVE MPC-NUM-POSC   TO MPC-NUM-POSQ.                         
       FIN-LDCPPMPC.                                                    
       FIN-CRG-RTK-MPC.                                                 
           EXIT.                                                        
                                                                        
                                                                        
       CRG-MPC-VEC SECTION.                                             
       INI-CRG-MPC-VEC.                                                 
           MOVE ZEROES TO MPC-I.                                        
       LUP-CRG-MPC-VEC.                                                 
           ADD 1 TO MPC-I.                                              
           IF MPC-I > MPC-TLCR                                          
              GO TO FIN-CRG-MPC-VEC.                                    
                                                                        
      *MHM-INI 04-ENE-2009 MEC                                          
      *    IF CTOT-LCR(MPC-I) NOT > ZEROES OR                           
      *       CTOT-LCR(MPC-I) NOT NUMERIC                               
      *       MOVE ZEROES TO CTOT-MPC(MPC-I)                            
      *       GO TO FIN-CRG-MPC-VEC.                                    
           IF CTOT-LCR(MPC-I) NOT NUMERIC                               
              MOVE ZEROES TO CTOT-MPC(MPC-I)                            
              GO TO FIN-CRG-MPC-VEC.                                    
           IF CTOT-LCR(MPC-I) NOT > ZEROES                              
              MOVE ZEROES TO CTOT-MPC(MPC-I)                            
              GO TO FIN-CRG-MPC-VEC.                                    
      *MHM-FIN 04-ENE-2009 MEC                                          
                                                                        
      *TRASPASA VECTOR DE LCR(CCU) A VEC(MPC).                          
           MOVE CMAJ-LCR(MPC-I) TO CMAJ-MPC(MPC-I).                     
           MOVE CTOT-LCR(MPC-I) TO CTOT-MPC(MPC-I).                     
           MOVE CUTI-LCR(MPC-I) TO CUTI-MPC(MPC-I).                     
           MOVE CDIS-LCR(MPC-I) TO CDIS-MPC(MPC-I).                     
           MOVE MENS-LCR(MPC-I) TO MENS-MPC(MPC-I).                     
           MOVE MEN2-LCR(MPC-I) TO MEN2-MPC(MPC-I).                     
           MOVE NMSG-LCR(MPC-I) TO NMSG-MPC(MPC-I).                     
           MOVE NMS2-LCR(MPC-I) TO NMS2-MPC(MPC-I).                     
                                                                        
      *AFRI-INI/MAYO-2007 (MAE - ALD)                                   
      *    IF WSS-IND-SOCU  = 'S'                                       
      *       GO TO FIN-CRG-MPC-VEC.                                    
      *    IF TIPO-MPC(MPC-I) = 'GLB'                                   
      *       MOVE 'LBR' TO TIPO-MPC(MPC-I).                            
      *AFRI-FIN/MAYO-2007 (MAE - ALD)                                   
                                                                        
           IF TIPO-MPC(MPC-I) NOT > SPACES                              
              MOVE 'LBR' TO TIPO-MPC(MPC-I).                            
           MOVE 'LDC'           TO FIO-SIST.                            
           MOVE 'TLC'           TO TAB-COD-TTAB IN TAB.                 
           MOVE TIPO-MPC(MPC-I) TO TAB-COD-CTAB IN TAB.                 
           MOVE FIO-GET-KEY     TO FIO-CMND.                            
           PERFORM GNS-FIO-TAB.                                         
           MOVE TAB-COD-DAT3(10) TO TIPO-MPC(MPC-I).                    
           GO TO LUP-CRG-MPC-VEC.                                       
       FIN-CRG-MPC-VEC.                                                 
           EXIT.                                                        
                                                                        
       ANL-CCU-MENS SECTION.                                            
       INI-ANL-CCU-MENS.                                                
           MOVE CCU-COD-SIST IN CCU-VARI TO MSG-COD-SIST.               
           IF CCU-NUM-MENS > ZEROES AND                                 
              ( CCU-NUM-MEN2 > ZEROES OR CCU-CAMB > SPACES )            
               MOVE CCU-COD-MENS IN CCU-VARI TO MSG-COD-MENS            
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO CCU-MEN1                            
               IF CCU-CAMB > SPACES                                     
                   MOVE CCU-CAMB TO CCU-MEN2                            
               ELSE                                                     
                   MOVE CCU-COD-MEN2 IN CCU-VARI TO MSG-COD-MENS        
                   PERFORM GET-MSG                                      
                   MOVE MSG-GLS-DESC TO CCU-MEN2                        
           ELSE                                                         
           IF CCU-NUM-MENS > ZEROES                                     
               MOVE CCU-COD-MENS IN CCU-VARI TO MSG-COD-MENS            
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO CCU-MEN2                            
           ELSE                                                         
               MOVE CCU-COD-MEN2 IN CCU-VARI TO MSG-COD-MENS            
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO CCU-MEN2.                           
      *                                                                 
           IF CCU-NUM-MENS < CCU-NUM-CALC AND CCU-NUM-MENS > ZEROES     
              IF CCU-MEN1 > SPACES AND CCU-MEN2 > SPACES                
                 MOVE CCU-MENS TO MPC-MENS                              
                 MOVE 'E' TO MPC-IND-STAT                               
              ELSE                                                      
                 IF CCU-MEN1 > SPACES                                   
                    MOVE CCU-MEN1 TO MPC-MEN1                           
                    MOVE 'E' TO MPC-IND-STAT                            
                 ELSE                                                   
                 IF CCU-MEN2 > SPACES                                   
                    MOVE CCU-MEN2 TO MPC-MEN2.                          
       FIN-ANL-CCU-MENS.                                                
           EXIT.                                                        
                                                                        
       OBT-VAL-MNAC SECTION.                                            
       INI-OBT-VAL-MNAC.                                                
      * Transforma monto a moneda corriente del dia                     
           MOVE MPC-VAL-MONE TO MPC-VAL-MNAC.                           
           IF (MPC-VCAM > SPACES AND MPC-VCAM NOT = MPC-COD-PESO AND    
               MPC-VAL-MONE > ZEROES AND MPC-VCAM NOT = 'P')            
              IF MPC-VCAM = MPC-COD-UEFE                                
                 MULTIPLY MPC-SGV-UEFE BY MPC-VAL-MONE                  
                                   GIVING MPC-VAL-MNAC ROUNDED          
              ELSE                                                      
               MOVE MPC-VCAM TO CAM-COD-VCAM IN CAM(1)                  
               MOVE FIO-GET-KEY TO FIO-CMND                             
               PERFORM TAB-FIO-CAM                                      
                 IF NOT (FIO-STAT-OKS AND CAM-IND-VIGE IN CAM = 'S')    
                   MOVE 'CAM    NEX' TO CCU-COD-MENS                    
                   MOVE 20           TO CCU-NUM-MENS                    
                   MOVE CAM-KEY-CAMB IN CAM TO CCU-CAMB                 
               ELSE                                                     
                    MULTIPLY CAM-SGV-VCAM IN CAM BY MPC-VAL-MONE        
                                     GIVING MPC-VAL-MNAC ROUNDED.       
       FIN-OBT-VAL-MNAC.                                                
           EXIT.                                                        
                                                                        
       TOT-RTK-DMPC SECTION.                                            
           IF MPC-IND-STAT = 'E'                                        
              MOVE MPC-COD-MENS TO MSG-COD-MENS                         
              MOVE MPC-MENS     TO FRM-MENS                             
              GO TO FIN-GET-MPC-RESP.                                   
                                                                        
           MOVE 'S' TO MPC-STAT(MPC-N).                                 
           ADD 1    TO MPC-NCLI.                                        
           PERFORM PRO-VEC-FRM.                                         
       FIN-TOT-RTK-DMPC.                                                
           EXIT.                                                        
                                                                        
      * Por cada par de cic ICLI y ICLF se inserta un registro PTK      
       INS-PTK-CCU SECTION.                                             
       INI-INS-PTK-CCU.                                                 
           MOVE SPACES                   TO TPK-CMMA.                   
                                                                        
           MOVE ITK-KEY-IITK IN ITK      TO TPK-CIC-IITK                
           MOVE 1                        TO TPK-NUM-SECU                
           MOVE MPC-N                    TO TPK-NUM-CORP                
           MOVE CCU-CIC-ICLF IN CCU-VARI TO WSS-CIC-ICLF IN WSS-VARI    
           MOVE CCU-CIC-ICLI IN CCU-VARI TO WSS-CIC-CLIC IN WSS-VARI    
           MOVE WSS-COD-ENTT IN WSS-VARI TO TPK-GLS-PARA                
                                                                        
           MOVE WSS-GNSPPPDT             TO SYS-PROG.                   
           MOVE TPK-TCMA                 TO SYS-TCMA.                   
           MOVE TPK-CMMA                 TO SYS-CMMA.                   
           MOVE SYS-LINK                 TO SYS-CMND.                   
           PERFORM GNS-PRO-SYS.                                         
                                                                        
GGG        MOVE SYS-CMMA                 TO TPK-CMMA.                   
                                                                        
           MOVE TPK-COD-MENS             TO MSG-COD-MENS                
           MOVE TPK-GLS-MENS             TO MSG-GLS-DESC                
           IF MSG-COD-MENS     > SPACES                                 
              MOVE 'S'                   TO SCR-IERR                    
              MOVE MSG-GLS-DESC          TO FRM-MENS CLS-GLS-MENS.      
ZX    *       GO TO MSG-FND-KEY.                                        
       FIN-INS-PTK-CCU.                                                 
           EXIT.                                                        
                                                                        
       SUB-ITK-BATCH SECTION.                                           
       INI-SUB-ITK-BATCH.                                               
                                                                        
           MOVE SPACES     TO WSS-HDR.                                  
           MOVE SPACES     TO PT-010.                                   
           MOVE 'HV01'     TO WSS-HDR-VERS.                             
           MOVE 'BCI'      TO WSS-HDR-BNCO.                             
           MOVE 'BCI'      TO WSS-HDR-MRCA.                             
           MOVE 'BEE'      TO WSS-HDR-CART.                             
           MOVE 'ES'       TO WSS-HDR-LENG.                             
           MOVE 'CL'       TO WSS-HDR-PAIS.                             
           MOVE 'GNSPPTPG' TO WSS-HDR-PROG.                             
                                                                        
           MOVE WSS-HDR    TO PT-010-AHDR.                              
           MOVE '010'      TO PT-010-CREQ.                              
           MOVE 'GMEC'     TO PT-010-01-BCH-COD-PROC.                   
           MOVE 'LDC'      TO PT-010-05-APT-COD-SIST.                   
                                                                        
           MOVE SXI-NUM-L6 TO SXI-COD-TCPIP.                            
           MOVE 'X'        TO SXI-COD-ISGMT.                            
           MOVE ITK-CIC-IITK IN ITK TO                                  
                PT-010-02-FRM-DAT-DATO IN PT-010(1).                    
           MOVE '0001' TO                                               
                PT-010-02-FRM-DAT-DATO IN PT-010(2).                    
           MOVE PT-010     TO SXI-PT.                                   
                                                                        
           MOVE 'GNSPPSXY' TO SYS-PROG.                                 
           MOVE +1000 TO SYS-TCMA.                                      
           MOVE SXI-GNSPPSXI TO SYS-CMMA.                               
           MOVE SYS-LINK TO SYS-CMND.                                   
           PERFORM GNS-PRO-SYS.                                         
                                                                        
                                                                        
???   *   MSG-COD-MENS, MSG-GLS-DESC                                    
                                                                        
           IF MSG-COD-MENS NOT > SPACES                                 
              MOVE TCK-CIC-ITCK IN TCK-CMMA TO FRM-GLS-TICK IN CLS-FLD  
              MOVE TCK-FEC-FPRO IN TCK-CMMA TO WSS-FEC-FECH             
              MOVE WSS-NUM-DFEC             TO FRM-NUM-DECH IN CLS-FLD  
              MOVE WSS-NUM-MFEC             TO FRM-NUM-MECH IN CLS-FLD  
              MOVE WSS-NUM-SFEC             TO FRM-NUM-SECH IN CLS-FLD  
              MOVE WSS-NUM-AFEC             TO FRM-NUM-AECH IN CLS-FLD  
              MOVE TCK-HRA-HRPR IN TCK-CMMA TO FRM-HRA-HORA IN CLS-FLD  
           ELSE                                                         
              MOVE MSG-GLS-DESC    TO FRM-MENS CLS-GLS-MENS             
              MOVE 'S' TO SCR-IERR.                                     
       FIN-SUB-ITK-BATCH.                                               
           EXIT.                                                        
                                                                        
      * GVI-FIN                                                         
                                                                        
      *>>>> EOF                                                         
