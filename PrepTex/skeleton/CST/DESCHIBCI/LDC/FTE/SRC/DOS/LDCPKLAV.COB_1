       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.       LDCPKLAV.
       AUTHOR.           CONSIST(RVM).
       DATE-WRITTEN.     18-OCT-1995 18:05:32.

      * PROGRAMA BATCH QUE SE RECORRE LA ENTIDAD LDCLDC, Y CAMBIA
      * EL CAMPO LDC-COD-TIPO QUE DICE 'LAV' POR 'MLC'

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *=====================
       SPECIAL-NAMES.
           DECIMAL-POINT IS COMMA.

       INPUT-OUTPUT SECTION.
      *====================
       FILE-CONTROL.
      *-------------

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY LDCBRLDC.

       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSBRMSC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LDC-REQA==.

       01  WSS-VARI.
           03  WSS-NUM-LDCL         VALUE ZEROES    PIC 9(05).
           03  WSS-NUM-LDCM         VALUE ZEROES    PIC 9(05).
           03  WSS-NUM-RBAD         VALUE ZEROES    PIC 9(01).

       PROCEDURE DIVISION.
      *===================
       MAIN SECTION.
      *------------
       INI-MAIN.
      *
       COPY GNSBGEDB.
      *EFECTUA APERTURA DE ARCHIVOS
           PERFORM INICIO-LAV.

      *PROCESO PRINCIPAL
           PERFORM PROCESO-LAV.

      *CIERRA ARCHIVOS
           PERFORM FINAL-LAV.
      *
       FIN-MAIN.
           DISPLAY ' '.
           DISPLAY 'ESTADISTICAS  LDCPKLAV'.
           DISPLAY '----------------------'.
           DISPLAY 'REG. LDCLDC LEIDOS      : '
                   WSS-NUM-LDCL IN WSS-VARI.
           DISPLAY 'REG. LDCLDC MODIFICADOS : '
                   WSS-NUM-LDCM IN WSS-VARI.
           DISPLAY ' '.
      *
           IF WSS-NUM-RBAD IN WSS-VARI > ZEROES
      *        PERFORM GNS-PRG-ABT
               MOVE 99 TO RETURN-CODE
               PERFORM PRG-ABT
           ELSE
               PERFORM GNS-PRO-END.

      ***********************************************************
      * PROCESO DE APERTURA DE ARCHIVOS Y LECTURA DE PARAMETROS *
      ***********************************************************
       INICIO-LAV SECTION.
      *---------------
       INI-INICIO-LAV.
           MOVE 'LDCPKLAV' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

      *APERTURA DE ARCHIVOS

      *LDCLDC
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM LDC-FIO-LDC.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR AL ABRIR ARCHIVO LDCLDC '
               DISPLAY 'DE UPDATE  '    FIO-STAT
               MOVE 1 TO WSS-NUM-RBAD IN WSS-VARI
               GO TO FIN-INICIO-LAV.

       FIN-INICIO-LAV.
           EXIT.

       PROCESO-LAV SECTION.
      *--------------------
       INI-PROCESO-LAV.

      *LEE A PARTIR DESDE LA PRIMERA LDC
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM LDC-FIO-LDC.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTEN REGISTROS LDCLDC'
               MOVE 1 TO WSS-NUM-RBAD IN WSS-VARI
               GO TO FIN-PROCESO-LAV.

       LUP-PROCESO-LAV.
           IF NOT FIO-STAT-OKS
               GO TO FIN-PROCESO-LAV.

      *CONTADOR DE REGISTROS LEIDOS
           ADD 1 TO WSS-NUM-LDCL IN WSS-VARI.

           IF LDC-COD-TIPO IN LDC = 'LAV'
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM LDC-FIO-LDC
               IF NOT FIO-STAT-OKS
                   DISPLAY 'ERROR: AL TOMAR DE UPD REGISTRO LDC '
                      LDC-KEY-ILDC IN LDC
                   MOVE 1 TO WSS-NUM-RBAD IN WSS-VARI
                   GO TO FIN-PROCESO-LAV
               ELSE
                   MOVE 'MLT' TO LDC-COD-TIPO IN LDC 
                   MOVE FIO-MOD TO FIO-CMND
                   PERFORM LDC-FIO-LDC
                   IF NOT FIO-STAT-OKS
                       DISPLAY 'ERROR: AL MODIFICAR REGISTRO LDC '
                          LDC-KEY-ILDC IN LDC
                       MOVE 1 TO WSS-NUM-RBAD IN WSS-VARI
                       GO TO FIN-PROCESO-LAV
                   ELSE
      *CONTADOR DE REGISTROS MODIFICADOS
                       ADD 1 TO WSS-NUM-LDCM IN WSS-VARI.
               
       NXT-PROCESO-LAV.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM LDC-FIO-LDC.
           GO TO LUP-PROCESO-LAV.

       FIN-PROCESO-LAV.
           EXIT.

       FINAL-LAV SECTION.
       INI-FINAL-LAV.
      *-------------------------------------
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM LDC-FIO-LDC.
      *-------------------------------------
       FIN-FINAL-LAV.
           EXIT.
      *

       COPY LDCBFLDC.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBGABT.
       COPY GNSBBTAB.
       COPY GNSBFMSG.
       COPY GNSBBMSG.
       COPY GNSBFTAB.
       COPY GNSBFMSC.
       COPY GNSBGEND.
