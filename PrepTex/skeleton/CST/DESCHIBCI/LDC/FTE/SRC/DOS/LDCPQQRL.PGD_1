       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   LDCPQQRL.
       AUTHOR.       BEE.
       DATE-WRITTEN. 29-Mar-19 12:41 PM.

      * NOMBRE PROGRAMA                   LDCPQQRL
      * VERSION PGM                       3.1
      * VERSION SKL                       07.08.21
      * OPCION                            CON
      * ARCHIVO BASE                      LDCLDC
      * PANTALLA                          LDCQRL
      * INP/OUT                           DATACOM
      * TAMANO COMMAREA                   250


       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.
       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
      * COPY GNSWGSCR.
       COPY GNSWGCVT.
       77  WSS-TAG-LDCPQQRL-INI PIC X(125) VALUE                        
           '<IDNPGM NOM=$LDCPQQRL$ SKL=$07.08.21$ VSN=${vsnpq}$        
      -    'GEN=$29-Mar-19 12:41 PM$ FNC=${fncpq}$/>'.    

       COPY GNSWCSCR.
      *PTC-INI
      *PTC-SUB
      * COPY GNSWVSCR.
       COPY GNSWV3CR.
      *PTC-FIN
           03 SCR-NUM-PANT               PIC 9(0012).
           03 SCR-QRL-FLD                PIC X(1100).
           03 SCR-CIC-ICLI.
              05 SCR-CAI-ICLI            PIC X(04).
              05 SCR-IIC-ICLI            PIC X(08).
       COPY LDCWIQRL.

       COPY LDCBRLDC.


       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSWGFRM.
       COPY GNSWG3CF.
       COPY GNSWGTSK.
       COPY GNSWGQUE.
      *PTC-FIN
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGSYS.

      *<<<< WSS 
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY LDCBRCLF.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CLF-REQA==.
       COPY LDCBRRDC REPLACING RDC BY RDL.                              
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDL-REQA==.
       COPY COLBRRDC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY LDCBRRLC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RLC-REQA==.
       COPY COLBROPC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY COLBRDLC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY COLBRICG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY LDCWXQRL.
      *>>>>
      *<<<< WSS_DTC
       01 WSS-NUM-CCUR.
           03 WSS-NUM-ICUR-EDT  PIC  ZZ9.
           03 WSS-NUM-ICUR-ALF       PIC X(03).
           03 WSS-NUM-ICUR      REDEFINES
              WSS-NUM-ICUR-ALF       PIC 9(03).
      *>>>>
       01  PGM-VARI.
           03 PGM-ICLR                  VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-TODO          VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-LLAVES        VALUE 'K'       PIC X(01).
           03 PGM-LIMPIAR-CAMPOS        VALUE 'F'       PIC X(01).
           03 PGM-NO-LIMPIAR-NADA       VALUE 'N'       PIC X(01).
           03 PGM-PROG                                  PIC X(08).
           03 PGM-NTRN                                  PIC X(04).
           03 PGM-STAT.
              05 PGM-STAT-LDC.
                 88 PGM-STAT-LDC-NUL    VALUE '  '.
                 07 PGM-STT1-LDC        VALUE '2' PIC X(01).
                    88 PGM-STAT-LDC-OKS VALUE '0'.
                 07 PGM-STT2-LDC        VALUE '3' PIC X(01).
           03 PGM-STAT.
              05 PGM-STAT-LDC.
                 88 PGM-STAT-LDC-NUL    VALUE '  '.
                 07 PGM-STT1-LDC        VALUE '2' PIC X(01).
                    88 PGM-STAT-LDC-OKS VALUE '0'.
                 07 PGM-STT2-LDC        VALUE '3' PIC X(01).
           03 PGM-SRNF                  VALUE '23'      PIC X(02).
           03 PGM-SOKS                  VALUE '00'      PIC X(02).
           03 PGM-SNUL                  VALUE '  '      PIC X(02).
           03 PGM-SUAR                  VALUE SPACES    PIC X(15).
           03 PGM-CMMA.
              05 PGM-CMMA-CHR OCCURS 3000 PIC X(01).

       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 DFH-CMMA OCCURS 3000 PIC X(01).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
       LUP-MAIN.
           IF SCR-INST = SCR-INST-HCM
                 PERFORM SCR-COM.
           IF SCR-CCPP = 'ACC'
                 PERFORM SCR-ACC
           ELSE
                 MOVE SCR-INST-HCM TO SCR-INST.
           GO TO LUP-MAIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
       COPY GNSBGEIB.
       COPY GNSBGEDB.
           MOVE LOW-VALUES TO QRL-FLD.
           MOVE LOW-VALUES TO QRL-EDT.
           MOVE LOW-VALUES TO QRL-EDT.
           PERFORM GNS-PRO-RCK.
           PERFORM GNS-BUS-VCA.
           MOVE +3000 TO SCR-TCMA.
           PERFORM GNS-HDL-SYS.
           PERFORM GNS-HDL-FRM.
           MOVE 'LDCPQQRL' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      *PTC-INI
           PERFORM GNS-ERR-QUE.
           PERFORM GET-TSK-TERM.
      *PTC-FIN
      *<<<< INI_FIO
           IF SCR-OFRM-SRV
                MOVE TSK-TERM-ALF TO QRL-COD-TERM
                MOVE TSK-TERM-ALF TO QRL-COD-TERM-MAS
           ELSE
                MOVE EIBTRMID     TO QRL-COD-TERM
                MOVE EIBTRMID     TO QRL-COD-TERM-MAS.
           MOVE +3859 TO SCR-TCMA.
           PERFORM GNS-ERR-QUE.
           IF ( FRM-FFLD = FRM-FFLD-PF5 ) AND ( SCR-NUM-PANT = 1 )
               MOVE SCR-QRL-FLD TO QRL-FLD
               GO TO FIN-INI.

           IF ( FRM-FFLD = FRM-FFLD-PF6 )
               MULTIPLY SCR-NUM-PANT BY WSS-IMAX GIVING QUE-NITM
               ADD 1              TO QUE-NITM
               MOVE QRL-NOM-TSQRL TO QUE-COLA
               MOVE QRL-LEN-TSQRL TO QUE-LITM
               MOVE QUE-GET       TO QUE-CMND
               PERFORM GNS-PRO-QUE
               IF QUE-STAT NOT = QUE-STAT-OKS
                  MOVE SCR-QRL-FLD TO QRL-FLD
                  GO TO FIN-INI.

      *>>>>
       FIN-INI.
           EXIT.

       COPY GNSBHSYS.
       COPY GNSBHFRM.
       COPY GNSBPRCK.
       GNS-BUS-VCA SECTION.
       INI-GNS-BUS-VCA.
           MOVE 0 TO FRM-IFLD.
       LUP-GNS-BUS-VCA.
           ADD 1 TO FRM-IFLD.
           IF FRM-IFLD NOT > EIBCALEN AND
              FRM-IFLD NOT > 3000
                MOVE DFH-CMMA(FRM-IFLD) TO PGM-CMMA-CHR(FRM-IFLD)
                GO TO LUP-GNS-BUS-VCA.
           MOVE PGM-CMMA TO SCR-VARI.
       FIN-GNS-BUS-VCA.
           EXIT.
       COPY GNSBBIDD.

       SCR-COM SECTION.
       INI-SCR-COM.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-QRL.
           PERFORM EDT-KEY-QRL.
           PERFORM EDT-FLD-QRL.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-HCM TO SCR-INST.
           MOVE SCR-CMNP     TO SYS-PROG.
           MOVE SCR-VARI     TO SYS-CMMA.
           MOVE SCR-TCMA     TO SYS-TCMA.
           MOVE SYS-XCTL     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       XCT-ERR.
           MOVE 'XCTERR    ' TO MSG-COD-MENS.
           MOVE 'GNS'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO SYS-MEN1.
           MOVE SYS-PROG     TO SYS-MEN2.
           MOVE SYS-ABOR     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       COPY GNSBGGBK.
       FIN-SCR-COM.
           EXIT.



       SCR-ACC SECTION.
       INI-SCR-ACC.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ACC
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-ACC.
           PERFORM DESSCRTRL.
      *<<<< PFS_SCR_ACC
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6
               PERFORM VAL-NUM-KEY-QRL
               PERFORM VAL-NUM-FLD-QRL
               PERFORM SCRL-TAB-QRL
               PERFORM SCR-TRL.
      *>>>>
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ACC.
           EXIT.

       BRW-SCR-ACC SECTION.
       INI-BRW-SCR-ACC.
       FIN-BRW-SCR-ACC.
           EXIT.




       SCR-DMSG SECTION.
       INI-SCR-DMSG.
           IF PGM-ICLR = PGM-NO-LIMPIAR-NADA
               NEXT SENTENCE
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-TODO
               PERFORM SCR-CLRA-QRL
               PERFORM EDT-KEY-QRL
               PERFORM EDT-FLD-QRL
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-LLAVES
               PERFORM CLR-KEY-QRL
               PERFORM EDT-KEY-QRL
           ELSE
               PERFORM CLR-FLD-QRL
               PERFORM EDT-FLD-QRL.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-DMSG.
           EXIT.

       SCR-KEY SECTION.
       INI-SCR-KEY.
           PERFORM SCR-RST.
           PERFORM GET-KEY.
           IF FRM-STAT-ABT
                   MOVE SPACES TO FRM-MENS
                   PERFORM SCR-MSSG
                   GO TO FIN-SCR-KEY.
       FND-SCR-KEY.
           MOVE SPACES TO FRM-MENS.
           PERFORM FND-KEY.
           IF FIO-STAT-OKS
               PERFORM PUT-SCR
               MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
               GO TO FIN-SCR-KEY.
      *JSS ELSE
      *        PERFORM CLR-FLD-QRL.
       ERR-SCR-KEY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR.
           IF FRM-MENS NOT > SPACES
               IF FIO-STAT-EOF
                   MOVE 'REGEOF    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
               IF FIO-STAT = FIO-STAT-NEX
                   MOVE 'REGNEX    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
           MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-SCR-KEY.
           EXIT.

       SCR-RST SECTION.
       INI-SCR-RST.
           MOVE SPACES       TO PGM-ICLR.
           MOVE SPACES       TO SCR-ACTU.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
           MOVE LOW-VALUES   TO QRL-FLD.
           MOVE LOW-VALUES TO QRL-EDT.
           MOVE LOW-VALUES TO QRL-EDT.
       FIN-SCR-RST.
           EXIT.

       GET-KEY SECTION.
       INI-GET-KEY.
           PERFORM SCR-GKEY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-KEY.
           EXIT.

       GET-IKY SECTION.
       INI-GET-IKY.
           PERFORM SCR-GIKY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-IKY.
           EXIT.

       FND-KEY SECTION.
       INI-FND-KEY.
      *<<<< INI_FND_KEY
           IF FRM-COD-CNPT IN QRL-FLD = 'NOP'
               GO TO CNT-CPTO-NOP.

           MOVE LDC-CAI-ICLF IN QRL-FLD TO RLC-CAI-ICLF IN RLC.
           MOVE LDC-IIC-ICLF IN QRL-FLD TO RLC-IIC-ICLF IN RLC.
           MOVE LDC-NUM-ILDC IN QRL-FLD TO RLC-NUM-ILDC IN RLC.
           IF FRM-COD-CNPT IN QRL-FLD = 'ALL'                                   
              MOVE SPACES                  TO RLC-COD-CPTO IN RLC               
           ELSE                                                                 
              MOVE FRM-COD-CNPT IN QRL-FLD TO RLC-COD-CPTO IN RLC.              
           MOVE SPACES                  TO RLC-KEY-IOPC IN RLC.

           IF FRM-IND-HMAS IN QRL-FLD = 'S'
              MOVE FRM-CAI-IOPK IN QRL-FLD TO RLC-CAI-IOPC IN RLC
              MOVE FRM-IIC-IOPK IN QRL-FLD TO RLC-IIC-IOPC IN RLC
              MOVE FRM-NUM-ILDC IN QRL-FLD TO RLC-NUM-IOPC IN RLC.              

           MOVE ZEROES TO WSS-J IN WSS-VARI.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-LEE-RLC.
           PERFORM LDC-FIO-RLC.
           IF NOT FIO-STAT-OKS OR FIO-STAT-EOF
               GO TO CON-FND-KEY.

           IF RLC-CAI-ICLF IN RLC NOT = LDC-CAI-ICLF IN QRL-FLD OR
              RLC-IIC-ICLF IN RLC NOT = LDC-IIC-ICLF IN QRL-FLD OR
              RLC-NUM-ILDC IN RLC NOT = LDC-NUM-ILDC IN QRL-FLD
               GO TO CON-FND-KEY.

           IF RLC-COD-CPTO IN RLC = 'LDC' AND
              (FRM-COD-CNPT IN QRL-FLD = 'LDC' OR 'ALL')
               PERFORM CRG-VEC-QRL-LDC.
               
           IF RLC-COD-CPTO IN RLC = 'OPC' AND
              (FRM-COD-CNPT IN QRL-FLD = 'OPC' OR 'ALL')
               PERFORM CRG-VEC-QRL-OPC.
           
           IF (SCR-OFRM-SRV AND WSS-J > WSS-NITMMAX)
               GO TO CON-FND-KEY.

           IF ((NOT SCR-OFRM-SRV) AND WSS-J > WSS-JMAX)
               GO TO CON-FND-KEY.

       NXT-LEE-RLC.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-LEE-RLC.

       CNT-CPTO-NOP.
           MOVE 'N' TO WSS-IND-SGTE IN WSS-VARI.                                
           MOVE SPACES TO WSS-COD-TIPO IN WSS-VARI.
           MOVE LDC-CAI-ICLF IN QRL-FLD TO LDC-CAI-ICLF IN LDC.
           MOVE LDC-IIC-ICLF IN QRL-FLD TO LDC-IIC-ICLF IN LDC.
           MOVE LDC-NUM-ILDC IN QRL-FLD TO LDC-NUM-ILDC IN LDC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM LDC-FIO-LDC.
           IF FIO-STAT-OKS
               MOVE LDC-COD-TIPO IN LDC TO WSS-COD-TIPO IN WSS-VARI.

HRS        MOVE SPACES                  TO CLF-CIC-ICLF IN CLF.                 
HRS        MOVE LDC-CAI-ICLF IN LDC     TO CLF-CAI-ICLF IN CLF.                 
HRS        MOVE LDC-IIC-ICLF IN LDC     TO CLF-IIC-ICLF IN CLF.                 
           MOVE FIO-GET-KEY             TO FIO-CMND.                            
           PERFORM LDC-FIO-CLF.                                                 
           IF FIO-STAT-OKS                                                      
               MOVE LDC-COD-TIPO IN LDC TO WSS-COD-TIPO IN WSS-VARI.            
                                                                                
           MOVE LDC-CAI-ICLF IN QRL-FLD TO RDC-CAI-ICLF IN RDL.
           MOVE LDC-IIC-ICLF IN QRL-FLD TO RDC-IIC-ICLF IN RDL.
           MOVE 'RDC-KEY-ICLF' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM LDC-FIO-RDC.
           IF NOT FIO-STAT-OKS
               GO TO CON-FND-KEY.
           
           MOVE RDC-CAI-ICLI IN RDL TO RDC-CAI-ICLI IN RDC.
           MOVE RDC-IIC-ICLI IN RDL TO RDC-IIC-ICLI IN RDC.
           MOVE SPACES              TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-LEE-RDC.
           PERFORM COL-FIO-RDC.
           IF NOT (FIO-STAT-OKS AND
               RDC-CAI-ICLI IN RDC = RDC-CAI-ICLI IN RDL AND
               RDC-IIC-ICLI IN RDC = RDC-IIC-ICLI IN RDL)
               GO TO CON-FND-KEY.
           
           IF RDC-NUM-IDLC IN RDC NOT = ZEROES
               GO TO NXT-LEE-RDC.

           MOVE RDC-CAI-IOPC IN RDC TO OPC-CAI-IOPC IN OPC.
           MOVE RDC-IIC-IOPC IN RDC TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               GO TO NXT-LEE-RDC.
HRS        IF OPC-MSC-STAT IN OPC NOT = 'A'                                     
HRS            GO TO NXT-LEE-RDC.                                               
                                                                                
HRS        IF OPC-IND-RENO IN OPC NOT = SPACES                                  
HRS            GO TO NXT-LEE-RDC.                                               
                                                                                
HRS        IF OPC-FEC-FCOL IN OPC < CLF-FEC-FAPE IN CLF                         
HRS            GO TO NXT-LEE-RDC.                                               
                                                                                
           IF OPC-CAI-IOPC IN OPC = FRM-CAI-IOPK IN QRL-FLD AND                 
              OPC-IIC-IOPC IN OPC = FRM-IIC-IOPK IN QRL-FLD                     
               MOVE 'S' TO WSS-IND-SGTE IN WSS-VARI.                            
                                                                                
           IF WSS-IND-SGTE IN WSS-VARI = 'N' AND                                
              FRM-CAI-IOPK IN QRL-FLD > SPACES                                  
               GO TO NXT-LEE-RDC.                                               

           MOVE OPC-CAI-IOPC IN OPC TO RLC-CAI-IOPC IN RLC.
           MOVE OPC-IIC-IOPC IN OPC TO RLC-IIC-IOPC IN RLC.
           MOVE ZEROES              TO RLC-NUM-IOPC IN RLC.
           MOVE 'RLC-KEY-IOPC' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM LDC-FIO-RLC.
           IF FIO-STAT-OKS
               GO TO NXT-LEE-RDC.
               
           PERFORM OBT-TIP-LCRE.

           IF WSS-LCRE IN WSS-VARI NOT = WSS-COD-TIPO IN WSS-VARI
               GO TO NXT-LEE-RDC.

           PERFORM CRG-VEC-QRL-OPC.


       NXT-LEE-RDC.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-LEE-RDC.

      *>>>>
           PERFORM KEY-ALL-QRL.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM LDC-FIO-LDC.
           MOVE FIO-STAT TO PGM-STAT-LDC.
      *<<<< FIN_FND_KEY
           MOVE FIO-STAT TO PGM-STAT-LDC.
       CON-FND-KEY.
           PERFORM PUT-TAB.

           MOVE '00' TO FIO-STAT.
           MOVE SCR-STAT-CON TO SCR-STAT.
           GO TO FIN-FND-KEY.
      *----------------------------------------------------------
       MSG-FND-KEY.
           MOVE 'TAB' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE '00' TO FIO-STAT.
           MOVE SCR-STAT-CON TO SCR-STAT.
           GO TO FIN-FND-KEY.
      *>>>>
       FIN-FND-KEY.
           IF FIO-STAT = FIO-STAT-NEX
               MOVE 'S' TO SCR-IERR.
       EXT-FND-KEY.
           EXIT.
 
       PUT-SCR SECTION.
       INI-PUT-SCR.
           PERFORM PUT-ALL-QRL.
       FIN-PUT-SCR.
           EXIT.

       STP-EXIT SECTION.
       INI-STP-EXIT.
           MOVE SCR-PROG TO PGM-PROG.
           MOVE SCR-NTRN TO PGM-NTRN.

           MOVE SCR-PROV TO SCR-PROG.
           MOVE SCR-NTRV TO SCR-NTRN.

           MOVE PGM-PROG TO SCR-PROV
           MOVE PGM-NTRN TO SCR-NTRV.
       FIN-STP-EXIT.
           EXIT.

       SCR-EXIT SECTION.
       INI-SCR-EXIT.
           MOVE 'P'      TO SCR-ICMN.
           MOVE SCR-NTRN TO SYS-NTRN.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-RTRN TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       FIN-SCR-EXIT.
           EXIT.

       SCR-PUTA SECTION.
       INI-SCR-PUTA.
      *PTC-INI
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE QRL-FLD TO FRM-DFLD.
           MOVE FRM-PUT-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-PUTA.
           EXIT.

       SCR-MSSG SECTION.
       INI-SCR-MSSG.
           IF FRM-MEN1 NOT > SPACES
               MOVE SPACES TO FRM-MEN1.
           IF FRM-MEN2 NOT > SPACES
               MOVE SPACES TO FRM-MEN2.
           MOVE FRM-MENS TO QRL-GLS-MENS.
       FIN-SCR-MSSG.
           EXIT.

       SCR-GKEY SECTION.
       INI-SCR-GKEY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-QRL
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO QRL-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GKEY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-QRL.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-QRL
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-QRL.
           PERFORM VAL-IKY-QRL.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-MKY-QRL.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-AKY-QRL.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-CON-KEY-QRL.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GKEY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-QRL.
       ERR-SCR-GKEY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-QRL.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GKEY.
           PERFORM SCR-MSSG.

       SCR-GIKY SECTION.
       INI-SCR-GIKY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-QRL
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO QRL-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GIKY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-QRL.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-IKY-QRL
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-QRL.
           PERFORM VAL-IKY-QRL.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GIKY.
           PERFORM VAL-CON-IKY-QRL.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GIKY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-QRL.
       ERR-SCR-GIKY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-IKY-QRL.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GIKY.
           PERFORM SCR-MSSG.

       GET-CON SECTION.
       INI-GET-CON.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
      *<<<< PFS_GET_CON
           IF NOT ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 )
      *>>>>
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO QRL-GLS-MEN2
               MOVE SCR-PRMT     TO QRL-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO QRL-FLD.
       FIN-GET-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.

       CLR-MSG SECTION.
       INI-CLR-MSG.
           MOVE SPACES TO QRL-GLS-MENS.
       FIN-CLR-MSG.
           EXIT.

       HBL-IKY SECTION.
       INI-HBL-IKY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE QRL-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO QRL-FLD
      * FLB  7-NOV-1994
               PERFORM CLR-KEY-QRL

               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO QRL-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO QRL-GLS-MENS.
           PERFORM PRO-MKY-QRL.
           PERFORM PRO-AKY-QRL.
           PERFORM UNP-IKY-QRL.
           PERFORM FST-KEY-QRL.
       FIN-HBL-IKY.
           EXIT.

       HBL-KEY SECTION.
       INI-HBL-KEY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE QRL-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO QRL-FLD
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO QRL-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO QRL-GLS-MENS.
           PERFORM UNP-KEY-QRL.
           PERFORM FST-KEY-QRL.
       FIN-HBL-KEY.
           EXIT.

       HBL-FLD SECTION.
       INI-HBL-FLD.
           PERFORM PRO-IKY-QRL.
           PERFORM PRO-AKY-QRL.
           PERFORM UNP-MKY-QRL.
           PERFORM UNP-FLD-QRL.
           PERFORM FST-FLD-QRL.
       FIN-HBL-FLD.
           EXIT.

       FST-MSG SECTION.
       INI-FST-MSG.
           MOVE -1 TO QRL-GLS-MENS-LEN.
       FIN-FST-MSG.
           EXIT.

       PRO-ALL SECTION.
       INI-PRO-ALL.
           PERFORM PRO-KEY-QRL.
           PERFORM FST-MSG.
       FIN-PRO-ALL.
           EXIT.

       SCR-TRL SECTION.
       INI-SCR-TRL.
      *PTC-INI
           IF SCR-STAT NOT = SCR-STPP
               MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           IF FRM-MEN1 NOT > SPACES
               MOVE SCR-PRMT TO FRM-MEN1.
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM HBL-FLD
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-QRL
               PERFORM EDT-FLD-QRL
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GFL TO SCR-INST
               PERFORM SCR-EXIT.
           IF SCR-STAT = SCR-STAT-SON
               PERFORM PRO-ALL
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-QRL
               PERFORM EDT-FLD-QRL
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GCS TO SCR-INST
               PERFORM SCR-EXIT.
      *ASUME SCR-STAT-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.
      *    MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-QRL.
           PERFORM EDT-FLD-QRL.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-GAB TO SCR-INST.
           PERFORM SCR-EXIT.
       FIN-SCR-TRL.
           EXIT.

       DESSCRTRL SECTION.
       INI-DESSCRTRL.
           MOVE SCR-VFLD-NOT TO SCR-VFLD.
           MOVE FRM-FFLD TO SCR-FFLD.
       FIN-DESSCRTRL.
           IF SCR-FFLD-PF10 OR SCR-FFLD-PF3
                 MOVE SCR-INST-HCM TO SCR-INST
           ELSE
                 MOVE SCR-INST-HKY TO SCR-INST.
       EXT-DESSCRTRL.
           EXIT.

      * PGM-EBR-ALL SECTION.
      * INI-PGM-EBR-ALL.
      *     MOVE 'GNS' TO FIO-SIST.
      *     MOVE FIO-EBR-ALL TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      * FIN-PGM-EBR-ALL.
      *     EXIT.

       COPY LDCBQQRL.
       COPY GNSBVNUM.
       COPY LDCBFLDC.
       COPY GNSBFMSG.
       COPY GNSBGSYS.
       COPY GNSBGDTC.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSBGFRM.
       COPY GNSBG3CF.
      *PTC-FIN
       COPY GNSBGMSG.
       COPY GNSBEKEY.
       COPY GNSBIABT.
       COPY GNSBFTAB.
       COPY GNSBEGLS.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
      *PTC-INI
       COPY GNSBGQUE.
       COPY GNSBGTSK.
      *PTC-FIN

      *<<<< EOF
       COPY GNSBVNUM.
       COPY GNSBEGLS.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBBTAB.
       COPY GNSBVTAB.
       COPY GNSBVCOD.
       COPY LDCBFCLF.
       COPY COLBFRDC.
       COPY LDCBFRLC.
       COPY COLBFOPC.
       COPY COLBFICG.
       COPY COLBFDLC.
       COPY LDCBFRDC REPLACING RDC BY RDL                               
                  ==ADR-RDC-REQA== BY ==ADR-RDL-REQA==.                 

       PUT-TAB SECTION.
       INI-PUT-TAB.
           MOVE QRL-NOM-TSQRL     TO QUE-COLA.
           MOVE QUE-DEL           TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           MOVE QRL-NOM-TSQRL-MAS TO QUE-COLA.
           MOVE QUE-DEL           TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           MOVE 1 TO SCR-NUM-PANT.
           MOVE LOW-VALUES TO WSS-GLS-NQRL-IDX-MTI.
           MOVE LOW-VALUES TO WSS-GLS-NQRL-IDX-FRM.
      *
           MOVE 1 TO FRM-IFLD.
           MOVE ZEROES  TO WSS-NITM IN WSS-VARI.

           MOVE 1 TO WSS-F IN WSS-VARI.
       LUP-PUT-TAB.
           IF WSS-F IN WSS-VARI > WSS-FMAX IN WSS-VARI
              GO TO FIN-PUT-TAB.
           IF WSS-IIC-IOPC-V(WSS-F) > ZEROES
             PERFORM PUT-TAB-QRL
              PERFORM PUT-QRL-QUE
              PERFORM SET-FRM-IFLD
           ELSE
           IF FRM-IFLD = 1 AND WSS-F = 1
      *        MOVE 'TAB' TO MSG-COD-SIST
              MOVE 'DEU' TO MSG-COD-SIST
              MOVE 'QRL    NEX' TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE '00' TO FIO-STAT
      *       MOVE 'S' TO SCR-IERR
              GO TO FIN-PUT-TAB
           ELSE
              MOVE '00' TO FIO-STAT
              GO TO FIN-PUT-TAB.

           ADD 1 TO WSS-F IN WSS-VARI.
           GO TO LUP-PUT-TAB.
       FIN-PUT-TAB.
           MOVE 1                  TO QUE-NITM.
           MOVE QRL-LEN-TSQRL-MAS  TO QUE-LITM.
           MOVE QRL-NOM-TSQRL-MAS  TO QUE-COLA.

           IF WSS-NITM > WSS-NITMMAX
              MOVE 'S'           TO QRL-MAS-IND-HMAS
           ELSE
              MOVE 'N'           TO QRL-MAS-IND-HMAS.

           MOVE WSS-NITM         TO WSS-NUM-ICUR.
           MOVE WSS-NUM-ICUR     TO WSS-NUM-ICUR-EDT.
           MOVE WSS-NUM-ICUR-EDT TO WSS-NUM-ICUR-ALF.
           MOVE WSS-NUM-ICUR-ALF TO QRL-MAS-NUM-TOCC.
           MOVE QRL-MAS-ITEM     TO QUE-ITEM.
           MOVE QUE-PUT          TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF WSS-NITM > WSS-IMAX
      *         MOVE 'TAB' TO MSG-COD-SIST
               MOVE 'DEU' TO MSG-COD-SIST
               MOVE 'QRLTABDMAS' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.
       EXT-PUT-TAB.
           EXIT.

       SET-FRM-IFLD SECTION.
       INI-SET-FRM-IFLD.
           IF SCR-OFRM-SRV
                MOVE 1 TO FRM-IFLD
           ELSE
                ADD 1 TO FRM-IFLD.
       FIN-SET-FRM-IFLD.
           EXIT.
      *--------------------------------------------
       SCRL-TAB-QRL SECTION.
       INI-SCRL-TAB-QRL.
           MOVE SPACES TO MSG-COD-MENS.

           IF FRM-FFLD = FRM-FFLD-PF6
               PERFORM PUT-TAB-ASC
           ELSE
               PERFORM PUT-TAB-DSC.
           IF MSG-COD-MENS > SPACES
      *         MOVE 'TAB' TO MSG-COD-SIST
               MOVE 'DEU' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.
       FIN-SCRL-TAB-QRL.
           EXIT.

      *--------------------------------------------
       PUT-TAB-QRL SECTION.
       INI-PUT-TAB-QRL.

           PERFORM CLR-WSS.
           MOVE WSS-CAI-IOPC-V(WSS-F) TO WSS-CAI-IOPC-QRL IN WSS-VARI.
           MOVE WSS-IIC-IOPC-V(WSS-F) TO WSS-IIC-IOPC-QRL IN WSS-VARI.
           MOVE WSS-NUM-ILDK-V(WSS-F) TO WSS-NUM-ILDK-QRL IN WSS-VARI.
           MOVE WSS-COD-CDOC-V(WSS-F) TO WSS-COD-CDOC-QRL IN WSS-VARI.
           MOVE WSS-IND-SCTB-V(WSS-F) TO WSS-IND-SCTB-QRL IN WSS-VARI.
           MOVE WSS-COD-ENTI-V(WSS-F) TO WSS-COD-ENTI-QRL IN WSS-VARI.
           MOVE WSS-COD-CPTO-V(WSS-F) TO WSS-COD-CPTO-QRL IN WSS-VARI.
           MOVE WSS-VAL-CRED-V(WSS-F) TO WSS-VAL-CRED-QRL IN WSS-VARI.
           MOVE WSS-SGV-TINT-V(WSS-F) TO WSS-SGV-TINT-QRL IN WSS-VARI.
           MOVE WSS-COD-TINT-V(WSS-F) TO WSS-COD-TINT-QRL IN WSS-VARI.
           MOVE WSS-VAL-SCRE-V(WSS-F) TO WSS-VAL-SCRE-QRL IN WSS-VARI.
           MOVE WSS-VAL-MGAR-V(WSS-F) TO WSS-VAL-MGAR-QRL IN WSS-VARI.
           MOVE WSS-VAL-SGAR-V(WSS-F) TO WSS-VAL-SGAR-QRL IN WSS-VARI.
           MOVE WSS-FEC-FCOL-V(WSS-F) TO WSS-FEC-FCOL-QRL IN WSS-VARI.
           MOVE WSS-COD-COOC-V(WSS-F) TO WSS-COD-COOC-QRL IN WSS-VARI.
           MOVE WSS-COD-VCOC-V(WSS-F) TO WSS-COD-VCOC-QRL IN WSS-VARI.
           MOVE WSS-FEC-FMAV-V(WSS-F) TO WSS-FEC-FMAV-QRL IN WSS-VARI.
           MOVE WSS-COD-ESTA-V(WSS-F) TO WSS-COD-ESTA-QRL IN WSS-VARI.
           MOVE WSS-GLS-SIST-V(WSS-F) TO WSS-GLS-SIST-QRL IN WSS-VARI.

           MOVE WSS-CAI-IOPC-QRL IN WSS-VARI TO WSS-CAI-IOPC-FRM.
           MOVE WSS-IIC-IOPC-QRL IN WSS-VARI TO WSS-IIC-IOPC-FRM.
           MOVE WSS-NUM-ILDK-QRL IN WSS-VARI TO WSS-NUM-ILDK-FRM.
           MOVE WSS-COD-CDOC-QRL IN WSS-VARI TO WSS-COD-CDOC-FRM.
           MOVE WSS-IND-SCTB-QRL IN WSS-VARI TO WSS-IND-SCTB-FRM.
           MOVE WSS-COD-ENTI-QRL IN WSS-VARI TO WSS-COD-ENTI-FRM.
           MOVE WSS-COD-CPTO-QRL IN WSS-VARI TO WSS-COD-CPTO-FRM.
           MOVE WSS-VAL-CRED-QRL IN WSS-VARI TO WSS-VAL-CRED-FRM.
           MOVE WSS-SGV-TINT-QRL IN WSS-VARI TO WSS-SGV-TINT-FRM.
           MOVE WSS-COD-TINT-QRL IN WSS-VARI TO WSS-COD-TINT-FRM.
           MOVE WSS-VAL-SCRE-QRL IN WSS-VARI TO WSS-VAL-SCRE-FRM.
           MOVE WSS-VAL-MGAR-QRL IN WSS-VARI TO WSS-VAL-MGAR-FRM.
           MOVE WSS-VAL-SGAR-QRL IN WSS-VARI TO WSS-VAL-SGAR-FRM.
           MOVE WSS-FEC-FCOL-QRL IN WSS-VARI TO WSS-FEC-FCOL-FRM.
           MOVE WSS-COD-COOC-QRL IN WSS-VARI TO WSS-COD-COOC-FRM.
           MOVE WSS-COD-VCOC-QRL IN WSS-VARI TO WSS-COD-VCOC-FRM.
           MOVE WSS-FEC-FMAV-QRL IN WSS-VARI TO WSS-FEC-FMAV-FRM.
           MOVE WSS-COD-ESTA-QRL IN WSS-VARI TO WSS-COD-ESTA-FRM.
           MOVE WSS-GLS-SIST-QRL IN WSS-VARI TO WSS-GLS-SIST-FRM.
           IF FRM-IFLD > WSS-IMAX
              GO TO FIN-PUT-TAB-QRL.

           MOVE WSS-CAI-IOPC-QRL IN WSS-VARI TO 
                FRM-CAI-IOPC IN QRL-FLD(FRM-IFLD).
           MOVE WSS-IIC-IOPC-QRL IN WSS-VARI TO 
                FRM-IIC-IOPC IN QRL-FLD(FRM-IFLD).
           MOVE WSS-NUM-ILDK-QRL IN WSS-VARI TO 
                FRM-NUM-ILDK IN QRL-FLD(FRM-IFLD).
           MOVE WSS-COD-CDOC-QRL IN WSS-VARI TO 
                FRM-COD-CDOC IN QRL-FLD(FRM-IFLD).
           MOVE WSS-IND-SCTB-QRL IN WSS-VARI TO 
                FRM-IND-SCTB IN QRL-FLD(FRM-IFLD).
           MOVE WSS-COD-ENTI-QRL IN WSS-VARI TO 
                FRM-COD-ENTI IN QRL-FLD(FRM-IFLD).
           MOVE WSS-COD-CPTO-QRL IN WSS-VARI TO
                FRM-COD-CPTO IN QRL-FLD(FRM-IFLD).
           MOVE WSS-VAL-CRED-QRL IN WSS-VARI TO 
                FRM-VAL-CRED IN QRL-FLD(FRM-IFLD).
           MOVE WSS-SGV-TINT-QRL IN WSS-VARI TO 
                FRM-SGV-TINT IN QRL-FLD(FRM-IFLD).
           MOVE WSS-COD-TINT-QRL IN WSS-VARI TO 
                FRM-COD-TINT IN QRL-FLD(FRM-IFLD).
           MOVE WSS-VAL-SCRE-QRL IN WSS-VARI TO 
                FRM-VAL-SCRE IN QRL-FLD(FRM-IFLD).
           MOVE WSS-VAL-MGAR-QRL IN WSS-VARI TO 
                FRM-VAL-MGAR IN QRL-FLD(FRM-IFLD).
           MOVE WSS-VAL-SGAR-QRL IN WSS-VARI TO 
                FRM-VAL-SGAR IN QRL-FLD(FRM-IFLD).
           MOVE WSS-FEC-FCOL-QRL IN WSS-VARI TO 
                FRM-FEC-FCOL IN QRL-FLD(FRM-IFLD).
           MOVE WSS-COD-COOC-QRL IN WSS-VARI TO 
                FRM-COD-COOC IN QRL-FLD(FRM-IFLD).
           MOVE WSS-COD-VCOC-QRL IN WSS-VARI TO 
                FRM-COD-VCOC IN QRL-FLD(FRM-IFLD).
           MOVE WSS-FEC-FMAV-QRL IN WSS-VARI TO 
                FRM-FEC-FMAV IN QRL-FLD(FRM-IFLD).
           MOVE WSS-COD-ESTA-QRL IN WSS-VARI TO 
                FRM-COD-ESTA IN QRL-FLD(FRM-IFLD).
           MOVE WSS-GLS-SIST-QRL IN WSS-VARI TO 
                FRM-GLS-SIST IN QRL-FLD(FRM-IFLD).
       FIN-PUT-TAB-QRL.
           EXIT.
      *----------------------------------------------------
       PUT-QRL-QUE SECTION.
       INI-PUT-QRL-QUE.
           PERFORM PRO-FLD-QUE.
           ADD 1 TO WSS-NITM.
           MOVE QRL-NOM-TSQRL    TO QUE-COLA.
           MOVE QRL-LEN-TSQRL    TO QUE-LITM.
           MOVE WSS-NITM         TO QUE-NITM.
           MOVE SPACES           TO QUE-ITEM.
           IF SCR-OFRM-SRV
              MOVE WSS-GLS-NQRL-IDX-MTI  TO QUE-ITEM
           ELSE
              MOVE WSS-GLS-NQRL-IDX-FRM  TO QUE-ITEM.
           MOVE QUE-PUT  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
       FIN-PUT-QRL-QUE.
           EXIT.
      *----------------------------------------------------

       PUT-TAB-ASC SECTION.
       INI-PUT-TAB-ASC.
           MOVE SPACES TO MSG-COD-MENS.
           MULTIPLY SCR-NUM-PANT BY WSS-IMAX GIVING QUE-NITM.
           MOVE 0 TO FRM-IFLD.
       LUP-PUT-TAB-ASC.
           ADD 1              TO QUE-NITM.
           MOVE QRL-NOM-TSQRL TO QUE-COLA.
           MOVE QRL-LEN-TSQRL TO QUE-LITM.
           MOVE QUE-GET       TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               IF FRM-IFLD = 0
                   MOVE 'QRLTABNONXT' TO MSG-COD-MENS
                   GO TO FIN-PUT-TAB-ASC
               ELSE
                   GO TO FIN-PUT-TAB-ASC.
           ADD 1 TO FRM-IFLD.
           MOVE QUE-ITEM TO FRM-CAI-IOPC-IDX(FRM-IFLD).
           IF FRM-IFLD < WSS-IMAX
               GO TO LUP-PUT-TAB-ASC.
       FIN-PUT-TAB-ASC.
           IF FRM-IFLD > 0 AND FRM-IFLD < WSS-IMAX
               ADD 1 FRM-IFLD GIVING WSS-I
               PERFORM CLR-FRM VARYING WSS-I FROM WSS-I BY 1
                                 UNTIL WSS-I > WSS-IMAX.
           IF FRM-IFLD > 0
               ADD 1 TO SCR-NUM-PANT.
           IF FRM-IFLD = WSS-IMAX
               ADD 1              TO QUE-NITM
               MOVE QRL-NOM-TSQRL TO QUE-COLA
               MOVE QRL-LEN-TSQRL TO QUE-LITM
               MOVE QUE-GET       TO QUE-CMND
               PERFORM GNS-PRO-QUE
               IF QUE-STAT = QUE-STAT-OKS
      *             MOVE 'LDC'        TO MSG-COD-SIST
                   MOVE 'DEU'        TO MSG-COD-SIST
                   MOVE 'QRLTABDMAS' TO MSG-COD-MENS.
       EXT-PUT-TAB-ASC.
           EXIT.

       PUT-TAB-DSC SECTION.
       INI-PUT-TAB-DSC.
           MOVE SPACES TO MSG-COD-MENS.
           IF SCR-NUM-PANT = 1
               MOVE 'QRLTABNOPRV' TO MSG-COD-MENS
               GO TO EXT-PUT-TAB-DSC.

           SUBTRACT 1 FROM SCR-NUM-PANT GIVING QUE-NITM.
           MULTIPLY QUE-NITM BY WSS-IMAX GIVING QUE-NITM.
           ADD 1 TO QUE-NITM.
           ADD 1 WSS-IMAX GIVING FRM-IFLD.
       LUP-PUT-TAB-DSC.
           SUBTRACT  1 FROM QUE-NITM.
           MOVE QRL-NOM-TSQRL TO QUE-COLA
           MOVE QRL-LEN-TSQRL TO QUE-LITM
           MOVE QUE-GET       TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               IF FRM-IFLD > WSS-IMAX
                   MOVE 'QRLTABNOPRV' TO MSG-COD-MENS
                   GO TO FIN-PUT-TAB-DSC
               ELSE
                   GO TO FIN-PUT-TAB-DSC.
           SUBTRACT 1 FROM FRM-IFLD.
           MOVE QUE-ITEM TO FRM-CAI-IOPC-IDX(FRM-IFLD).
           IF FRM-IFLD > 1
               GO TO LUP-PUT-TAB-DSC.
       FIN-PUT-TAB-DSC.

           IF FRM-IFLD NOT > WSS-IMAX AND FRM-IFLD > 1
               SUBTRACT 1 FROM FRM-IFLD GIVING WSS-I
               PERFORM CLR-FRM VARYING WSS-I FROM WSS-I BY -1
                                 UNTIL WSS-I < 1.

           IF FRM-IFLD NOT > WSS-IMAX
               SUBTRACT 1 FROM SCR-NUM-PANT
      *         MOVE 'LDC'        TO MSG-COD-SIST
               MOVE 'DEU'        TO MSG-COD-SIST
               MOVE 'QRLTABDMAS' TO MSG-COD-MENS.
       EXT-PUT-TAB-DSC.
           EXIT.

       CLR-FRM SECTION.
       INI-CLR-FRM.
           MOVE SPACES TO FRM-CAI-IOPC IN QRL-FLD(WSS-I).
           MOVE ZEROES TO FRM-IIC-IOPC IN QRL-FLD(WSS-I).
           MOVE ZEROES TO FRM-NUM-ILDK IN QRL-FLD(WSS-I).
           MOVE SPACES TO FRM-COD-CDOC IN QRL-FLD(WSS-I).
           MOVE SPACES TO FRM-IND-SCTB IN QRL-FLD(WSS-I).
           MOVE SPACES TO FRM-COD-ENTI IN QRL-FLD(WSS-I).
           MOVE SPACES TO FRM-COD-CPTO IN QRL-FLD(WSS-I).
           MOVE ZEROES TO FRM-VAL-CRED IN QRL-FLD(WSS-I).
           MOVE ZEROES TO FRM-SGV-TINT IN QRL-FLD(WSS-I).
           MOVE SPACES TO FRM-COD-TINT IN QRL-FLD(WSS-I).
           MOVE ZEROES TO FRM-VAL-SCRE IN QRL-FLD(WSS-I).
           MOVE ZEROES TO FRM-VAL-MGAR IN QRL-FLD(WSS-I).
           MOVE ZEROES TO FRM-VAL-SGAR IN QRL-FLD(WSS-I).
           MOVE SPACES TO FRM-FEC-FCOL IN QRL-FLD(WSS-I).
           MOVE SPACES TO FRM-COD-COOC IN QRL-FLD(WSS-I).
           MOVE SPACES TO FRM-COD-VCOC IN QRL-FLD(WSS-I).
           MOVE SPACES TO FRM-FEC-FMAV IN QRL-FLD(WSS-I).
           MOVE SPACES TO FRM-COD-ESTA IN QRL-FLD(WSS-I).
           MOVE SPACES TO FRM-GLS-SIST IN QRL-FLD(WSS-I).
       FIN-CLR-FRM.
           EXIT.

       CLR-WSS SECTION.
       INI-CLR-WSS.
           MOVE SPACES TO WSS-CAI-IOPC-QRL IN WSS-VARI.
           MOVE ZEROES TO WSS-IIC-IOPC-QRL IN WSS-VARI.
           MOVE ZEROES TO WSS-NUM-ILDK-QRL IN WSS-VARI.
           MOVE SPACES TO WSS-COD-CDOC-QRL IN WSS-VARI.
           MOVE SPACES TO WSS-IND-SCTB-QRL IN WSS-VARI.
           MOVE SPACES TO WSS-COD-ENTI-QRL IN WSS-VARI.
           MOVE SPACES TO WSS-COD-CPTO-QRL IN WSS-VARI.
           MOVE ZEROES TO WSS-VAL-CRED-QRL IN WSS-VARI.
           MOVE ZEROES TO WSS-SGV-TINT-QRL IN WSS-VARI.
           MOVE SPACES TO WSS-COD-TINT-QRL IN WSS-VARI.
           MOVE ZEROES TO WSS-VAL-SCRE-QRL IN WSS-VARI.
           MOVE ZEROES TO WSS-VAL-MGAR-QRL IN WSS-VARI.
           MOVE ZEROES TO WSS-VAL-SGAR-QRL IN WSS-VARI.
           MOVE SPACES TO WSS-FEC-FCOL-QRL IN WSS-VARI.
           MOVE SPACES TO WSS-COD-COOC-QRL IN WSS-VARI.
           MOVE SPACES TO WSS-COD-VCOC-QRL IN WSS-VARI.
           MOVE SPACES TO WSS-FEC-FMAV-QRL IN WSS-VARI.
           MOVE SPACES TO WSS-COD-ESTA-QRL IN WSS-VARI.
           MOVE SPACES TO WSS-GLS-SIST-QRL IN WSS-VARI.
           IF SCR-OFRM-SRV
               PERFORM CLR-FRM-MTX.
       FIN-CLR-WSS.
           EXIT.

       CLR-FRM-MTX SECTION.
       INI-CLR-FRM-MTX.
           MOVE SPACES TO FRM-CAI-IOPC IN QRL-FLD(1).
           MOVE ZEROES TO FRM-IIC-IOPC IN QRL-FLD(1).
           MOVE ZEROES TO FRM-NUM-ILDK IN QRL-FLD(1).
           MOVE SPACES TO FRM-COD-CDOC IN QRL-FLD(1).
           MOVE SPACES TO FRM-IND-SCTB IN QRL-FLD(1).
           MOVE SPACES TO FRM-COD-ENTI IN QRL-FLD(1).
           MOVE SPACES TO FRM-COD-CPTO IN QRL-FLD(1).
           MOVE ZEROES TO FRM-VAL-CRED IN QRL-FLD(1).
           MOVE ZEROES TO FRM-SGV-TINT IN QRL-FLD(1).
           MOVE SPACES TO FRM-COD-TINT IN QRL-FLD(1).
           MOVE ZEROES TO FRM-VAL-SCRE IN QRL-FLD(1).
           MOVE ZEROES TO FRM-VAL-MGAR IN QRL-FLD(1).
           MOVE ZEROES TO FRM-VAL-SGAR IN QRL-FLD(1).
           MOVE SPACES TO FRM-FEC-FCOL IN QRL-FLD(1).
           MOVE SPACES TO FRM-COD-COOC IN QRL-FLD(1).
           MOVE SPACES TO FRM-COD-VCOC IN QRL-FLD(1).
           MOVE SPACES TO FRM-FEC-FMAV IN QRL-FLD(1).
           MOVE SPACES TO FRM-COD-ESTA IN QRL-FLD(1).
           MOVE SPACES TO FRM-GLS-SIST IN QRL-FLD(1).
       FIN-CLR-FRM-MTX.
           EXIT.

       CRG-VEC-QRL-LDC SECTION.
       INI-CRG-VEC-QRL-LDC.
           ADD 1 TO WSS-J.
           IF WSS-J IN WSS-VARI > WSS-JMAX IN WSS-VARI
               GO TO FIN-CRG-VEC-QRL-LDC.

           PERFORM CLR-QRL-VEC.

           MOVE RLC-CAI-IOPC IN RLC TO 
                          WSS-CAI-IOPC-V IN WSS-VARI(WSS-J).
           MOVE RLC-IIC-IOPC IN RLC TO 
                          WSS-IIC-IOPC-V IN WSS-VARI(WSS-J).
           MOVE RLC-NUM-IOPC IN RLC TO
                          WSS-NUM-ILDK-V IN WSS-VARI(WSS-J).
           MOVE SPACES TO WSS-COD-CDOC-V IN WSS-VARI(WSS-J).
           MOVE SPACES TO WSS-IND-SCTB-V IN WSS-VARI(WSS-J).
           MOVE RLC-CIC-ENTI IN RLC TO 
                          WSS-COD-ENTI-V IN WSS-VARI(WSS-J).
           MOVE FRM-COD-CNPT IN QRL-FLD TO
                          WSS-COD-CPTO-V IN WSS-VARI(WSS-J).
           MOVE RLC-CAI-IOPC IN RLC TO LDC-CAI-ICLF IN LDC.
           MOVE RLC-IIC-IOPC IN RLC TO LDC-IIC-ICLF IN LDC.
           MOVE RLC-NUM-IOPC IN RLC TO LDC-NUM-ILDC IN LDC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM LDC-FIO-LDC
           IF NOT FIO-STAT-OKS
               GO TO CNT-CRG-VEC-QRL-LDC.

           IF SCR-OFRM-SRV
              MOVE LDC-VAL-CMAX IN LDC TO FRM-VAL-CRED-EDT
              MOVE FRM-VAL-CRED-EDT TO 
                          WSS-VAL-CRED-V IN WSS-VARI(WSS-J)
              MOVE LDC-VAL-CMAX IN LDC TO FRM-VAL-SCRE-EDT
              MOVE FRM-VAL-SCRE-EDT TO 
                          WSS-VAL-SCRE-V IN WSS-VARI(WSS-J)
           ELSE
              MOVE LDC-VAL-CMAX IN LDC TO 
                          WSS-VAL-CRED-V IN WSS-VARI(WSS-J)
              MOVE LDC-VAL-CMAX IN LDC TO 
                          WSS-VAL-SCRE-V IN WSS-VARI(WSS-J).

           MOVE LDC-NUM-DINI IN LDC TO WSS-NUM-DTRA IN WSS-VARI.                
           MOVE LDC-NUM-MINI IN LDC TO WSS-NUM-MTRA IN WSS-VARI.                
           MOVE LDC-NUM-SINI IN LDC TO WSS-NUM-STRA IN WSS-VARI.                
           MOVE LDC-NUM-AINI IN LDC TO WSS-NUM-ATRA IN WSS-VARI.                
           MOVE WSS-FEC-FTRA IN WSS-VARI TO   
                          WSS-FEC-FCOL-V IN WSS-VARI(WSS-J).
           MOVE LDC-COD-TIPO IN LDC TO
                          WSS-COD-COOC-V IN WSS-VARI(WSS-J).
           MOVE LDC-COD-VCLC IN LDC TO
                          WSS-COD-VCOC-V IN WSS-VARI(WSS-J).
           MOVE LDC-NUM-DVEN IN LDC TO WSS-NUM-DTRA IN WSS-VARI.                
           MOVE LDC-NUM-MVEN IN LDC TO WSS-NUM-MTRA IN WSS-VARI.                
           MOVE LDC-NUM-SVEN IN LDC TO WSS-NUM-STRA IN WSS-VARI.                
           MOVE LDC-NUM-AVEN IN LDC TO WSS-NUM-ATRA IN WSS-VARI.                
           MOVE WSS-FEC-FTRA IN WSS-VARI TO 
                          WSS-FEC-FMAV-V IN WSS-VARI(WSS-J).
           IF LDC-IND-VIGE IN LDC = 'S'
               MOVE 'VIG' TO WSS-COD-ESTA-V IN WSS-VARI(WSS-J)
           ELSE
               MOVE 'CAN' TO WSS-COD-ESTA-V IN WSS-VARI(WSS-J).

       CNT-CRG-VEC-QRL-LDC.
           MOVE ZEROES TO WSS-SGV-TINT-V IN WSS-VARI(WSS-J).
           MOVE SPACES TO WSS-COD-TINT-V IN WSS-VARI(WSS-J).
           MOVE 'LDC'  TO WSS-GLS-SIST-V IN WSS-VARI(WSS-J).

           IF SCR-OFRM-SRV
              MOVE RLC-VAL-MGAR IN RLC TO FRM-VAL-MGAR-EDT
              MOVE FRM-VAL-MGAR-EDT TO 
                            WSS-VAL-MGAR-V IN WSS-VARI(WSS-J)
              MOVE RLC-VAL-SGAR IN RLC TO FRM-VAL-SGAR-EDT
              MOVE FRM-VAL-SGAR-EDT TO 
                            WSS-VAL-SGAR-V IN WSS-VARI(WSS-J)
           ELSE
              MOVE RLC-VAL-MGAR IN RLC TO 
                            WSS-VAL-MGAR-V IN WSS-VARI(WSS-J)
              MOVE RLC-VAL-SGAR IN RLC TO 
                            WSS-VAL-SGAR-V IN WSS-VARI(WSS-J).

       FIN-CRG-VEC-QRL-LDC.
           EXIT.

       CRG-VEC-QRL-OPC SECTION.
       INI-CRG-VEC-QRL-OPC.
           ADD 1 TO WSS-J.
           IF WSS-J IN WSS-VARI > WSS-JMAX IN WSS-VARI
               GO TO FIN-CRG-VEC-QRL-OPC.

           PERFORM CLR-QRL-VEC.

           MOVE RLC-CAI-IOPC IN RLC TO 
                          WSS-CAI-IOPC-V IN WSS-VARI(WSS-J).
           MOVE RLC-IIC-IOPC IN RLC TO 
                          WSS-IIC-IOPC-V IN WSS-VARI(WSS-J).
           MOVE RLC-CAI-IOPC IN RLC TO OPC-CAI-IOPC IN OPC.
           MOVE RLC-IIC-IOPC IN RLC TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC
           IF NOT FIO-STAT-OKS
               GO TO CNT-CRG-VEC-QRL-OPC.

HRS        IF OPC-MSC-STAT IN OPC NOT = 'A'                                     
HRS            GO TO CNT-CRG-VEC-QRL-OPC.                                       
                                                                                
           MOVE OPC-CAI-IOPC IN OPC TO DLC-CAI-IOPC IN DLC.
           MOVE OPC-IIC-IOPC IN OPC TO DLC-IIC-IOPC IN DLC.
           MOVE 1                   TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC
           IF FIO-STAT-OKS
               MOVE DLC-NUM-DMAV IN DLC TO WSS-NUM-DTRA IN WSS-VARI             
               MOVE DLC-NUM-MMAV IN DLC TO WSS-NUM-MTRA IN WSS-VARI             
               MOVE DLC-NUM-SMAV IN DLC TO WSS-NUM-STRA IN WSS-VARI             
               MOVE DLC-NUM-AMAV IN DLC TO WSS-NUM-ATRA IN WSS-VARI             
               MOVE WSS-FEC-FTRA IN WSS-VARI TO     
                          WSS-FEC-FMAV-V IN WSS-VARI(WSS-J)
               MOVE DLC-IND-SCTB IN DLC TO
                          WSS-IND-SCTB-V IN WSS-VARI(WSS-J).
                          
           MOVE OPC-COD-CDOC IN OPC TO 
                          WSS-COD-CDOC-V IN WSS-VARI(WSS-J).
           MOVE RLC-CIC-ENTI IN RLC TO 
                          WSS-COD-ENTI-V IN WSS-VARI(WSS-J).
           MOVE FRM-COD-CNPT IN QRL-FLD TO
                          WSS-COD-CPTO-V IN WSS-VARI(WSS-J).
           IF SCR-OFRM-SRV
              MOVE OPC-VAL-CRED IN OPC TO FRM-VAL-CRED-EDT
              MOVE FRM-VAL-CRED-EDT TO 
                          WSS-VAL-CRED-V-ALF IN WSS-VARI(WSS-J)                 
      *                   WSS-VAL-CRED-V IN WSS-VARI(WSS-J)                     
              MOVE OPC-VAL-SCRE IN OPC TO FRM-VAL-SCRE-EDT
              MOVE FRM-VAL-SCRE-EDT TO 
                          WSS-VAL-SCRE-V-ALF IN WSS-VARI(WSS-J)                 
      *                   WSS-VAL-SCRE-V IN WSS-VARI(WSS-J)                     
           ELSE
              MOVE OPC-VAL-CRED IN OPC TO 
                          WSS-VAL-CRED-V IN WSS-VARI(WSS-J)
              MOVE OPC-VAL-SCRE IN OPC TO 
                          WSS-VAL-SCRE-V IN WSS-VARI(WSS-J).

           MOVE OPC-NUM-DCOL IN OPC TO WSS-NUM-DTRA IN WSS-VARI.                
           MOVE OPC-NUM-MCOL IN OPC TO WSS-NUM-MTRA IN WSS-VARI.                
           MOVE OPC-NUM-SCOL IN OPC TO WSS-NUM-STRA IN WSS-VARI.                
           MOVE OPC-NUM-ACOL IN OPC TO WSS-NUM-ATRA IN WSS-VARI.                
           MOVE WSS-FEC-FTRA IN WSS-VARI TO                                     
                          WSS-FEC-FCOL-V IN WSS-VARI(WSS-J).
           MOVE OPC-COD-COOC IN OPC TO
                          WSS-COD-COOC-V IN WSS-VARI(WSS-J).
           MOVE OPC-COD-VCOC IN OPC TO
                          WSS-COD-VCOC-V IN WSS-VARI(WSS-J).
           IF OPC-VAL-SCRE IN OPC > ZEROES
               MOVE 'VIG' TO WSS-COD-ESTA-V IN WSS-VARI(WSS-J)
           ELSE
               MOVE 'CAN' TO WSS-COD-ESTA-V IN WSS-VARI(WSS-J).

           MOVE 'TAB'               TO FIO-SIST TAB-COD-SIST.
           MOVE 'TIO'               TO TAB-COD-TTAB
           MOVE OPC-COD-TOOC IN OPC TO TAB-COD-CTAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'LDC'  TO WSS-GLS-SIST-V IN WSS-VARI(WSS-J)
           ELSE
               MOVE TAB-GLS-DAT1 IN TAB TO WSS-COD-DAT1 IN WSS-VARI
               MOVE WSS-COD-SIST IN WSS-VARI TO 
                              WSS-GLS-SIST-V IN WSS-VARI(WSS-J).

       CNT-CRG-VEC-QRL-OPC.
           PERFORM OBT-TSA-OPC.
           IF MSG-COD-MENS NOT > SPACES
               MOVE ICG-COD-TINT TO WSS-COD-TINT-V IN WSS-VARI(WSS-J)
               IF ICG-COD-CVTI IN ICG > SPACES
                  MOVE ICG-SGV-SPRD IN ICG TO 
                                    WSS-SGV-TINT-V IN WSS-VARI(WSS-J)
               ELSE
                  MOVE ICG-SGV-TINT IN ICG TO 
                                    WSS-SGV-TINT-V IN WSS-VARI(WSS-J).
           
           IF SCR-OFRM-SRV
              MOVE RLC-VAL-MGAR IN RLC TO FRM-VAL-MGAR-EDT
              MOVE FRM-VAL-MGAR-EDT TO 
                            WSS-VAL-MGAR-V-ALF IN WSS-VARI(WSS-J)               
      *                     WSS-VAL-MGAR-V IN WSS-VARI(WSS-J)                   
              MOVE RLC-VAL-SGAR IN RLC TO FRM-VAL-SGAR-EDT
              MOVE FRM-VAL-SGAR-EDT TO 
                            WSS-VAL-SGAR-V-ALF IN WSS-VARI(WSS-J)               
      *                     WSS-VAL-SGAR-V IN WSS-VARI(WSS-J)                   
           ELSE
              MOVE RLC-VAL-MGAR IN RLC TO 
                            WSS-VAL-MGAR-V IN WSS-VARI(WSS-J)
              MOVE RLC-VAL-SGAR IN RLC TO 
                            WSS-VAL-SGAR-V IN WSS-VARI(WSS-J).

       FIN-CRG-VEC-QRL-OPC.
           EXIT.

       CLR-QRL-VEC SECTION.
       INI-CLR-QRL-VEC.
           MOVE SPACES TO WSS-CAI-IOPC-V(WSS-J).
           MOVE ZEROES TO WSS-IIC-IOPC-V(WSS-J).
           MOVE ZEROES TO WSS-NUM-ILDK-V(WSS-J).
           MOVE SPACES TO WSS-COD-CDOC-V(WSS-J).
           MOVE SPACES TO WSS-IND-SCTB-V(WSS-J).
           MOVE SPACES TO WSS-COD-ENTI-V(WSS-J).
           MOVE SPACES TO WSS-COD-CPTO-V(WSS-J).
           MOVE ZEROES TO WSS-VAL-CRED-V(WSS-J).
           MOVE ZEROES TO WSS-SGV-TINT-V(WSS-J).
           MOVE SPACES TO WSS-COD-TINT-V(WSS-J).
           MOVE ZEROES TO WSS-VAL-SCRE-V(WSS-J).
           MOVE ZEROES TO WSS-VAL-MGAR-V(WSS-J).
           MOVE ZEROES TO WSS-VAL-SGAR-V(WSS-J).
           MOVE SPACES TO WSS-FEC-FCOL-V(WSS-J).
           MOVE SPACES TO WSS-COD-COOC-V(WSS-J).
           MOVE SPACES TO WSS-COD-VCOC-V(WSS-J).
           MOVE SPACES TO WSS-FEC-FMAV-V(WSS-J).
           MOVE SPACES TO WSS-COD-ESTA-V(WSS-J).
           MOVE SPACES TO WSS-GLS-SIST-V(WSS-J).
       FIN-CLR-QRL-VEC.
           EXIT.

       PRO-FLD-QUE SECTION.
       INI-PRO-FLD-QUE.
           MOVE 'P' TO WSS-CAI-IOPC-ATR.
           MOVE 'P' TO WSS-IIC-IOPC-ATR.
           MOVE 'P' TO WSS-NUM-ILDK-ATR.
           MOVE 'P' TO WSS-COD-CDOC-ATR.
           MOVE 'P' TO WSS-IND-SCTB-ATR.
           MOVE 'P' TO WSS-COD-ENTI-ATR.
           MOVE 'P' TO WSS-COD-CPTO-ATR.
           MOVE 'P' TO WSS-VAL-CRED-ATR.
           MOVE 'P' TO WSS-SGV-TINT-ATR.
           MOVE 'P' TO WSS-COD-TINT-ATR.
           MOVE 'P' TO WSS-VAL-SCRE-ATR.
           MOVE 'P' TO WSS-VAL-MGAR-ATR.
           MOVE 'P' TO WSS-VAL-SGAR-ATR.
           MOVE 'P' TO WSS-FEC-FCOL-ATR.
           MOVE 'P' TO WSS-COD-COOC-ATR.
           MOVE 'P' TO WSS-COD-VCOC-ATR.
           MOVE 'P' TO WSS-FEC-FMAV-ATR.
           MOVE 'P' TO WSS-COD-ESTA-ATR.
           MOVE 'P' TO WSS-GLS-SIST-ATR.
       FIN-PRO-FLD-QUE.
           EXIT.

       OBT-TSA-OPC SECTION.
       INI-OBT-TSA-OPC.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE OPC-CAI-IOPC IN OPC TO ICG-CAI-IOPC IN ICG.
           MOVE OPC-IIC-IOPC IN OPC TO ICG-IIC-IOPC IN ICG.
           MOVE ZEROES              TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE 'INT'               TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF NOT (FIO-STAT-OKS AND
                   ICG-CAI-IOPC IN ICG = OPC-CAI-IOPC IN OPC AND
                   ICG-IIC-IOPC IN ICG = OPC-IIC-IOPC IN OPC AND
                   ICG-NUM-ICAN IN ICG = ZEROES AND
                   ICG-CIC-IOPV IN ICG = SPACES AND
                   ICG-NUM-IVCT IN ICG = ZEROES AND
                   ICG-IND-TTAS IN ICG = 'INT')
                MOVE 'ICG    NEX' TO MSG-COD-MENS.
       FIN-OBT-TSA-OPC.
              EXIT.

       OBT-TIP-LCRE SECTION.
       INI-OBT-TIP-LCRE.
      * Obtiene Tipo de L.CRE a partir de Pos. 52 en Datos Anexos
           MOVE 'COL'                   TO TAB-COD-SIST.
           MOVE 'AUX'                   TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-COOC IN OPC     TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DAT3 IN TAB TO WSS-DAT3 IN WSS-VARI.

      *Debe chequear la TIO si AUX no tiene definida TLC
      *
           IF WSS-LCRE IN WSS-VARI = SPACES
              MOVE SPACES TO WSS-DAT3 IN WSS-VARI

      * Obtiene Tipo de L.CRE a partir de Pos. 52 en Datos Anexos
              MOVE 'TAB'                   TO TAB-COD-SIST
              MOVE 'TIO'                   TO TAB-COD-TTAB IN TAB
              MOVE OPC-COD-TOOC IN OPC     TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              MOVE TAB-GLS-DAT3 IN TAB TO WSS-DAT3 IN WSS-VARI.
       FIN-OBT-TIP-LCRE.
           EXIT.
      *>>>> EOF
