*%! Codigo adicional para archivo
*% NO_HDR_CST = TRUE
*% PGM_PTC = TRUE
*%!
*% IF CMT_ID_PU
      *<<<<
      *--------------------------------------------------------------   
      *  MODIFICACIONES:
      *  ---------------
      *
      *  AUTOR      : AFRI (MAE-ALD)
      *  FECHA      : 29 ABRIL 2013
      *  PROYECTO   : MOVILIDADES FASE III (COLOCACIONES)
      *  ETIQUETA   : AFRI-INI/29-ABR-2013 MOVILIDADES III
      *  CAMBIOS    : SE INCORPORA GRABACION DE TICKET (GNS-ITK)
      *--------------------------------------------------------------   
      *>>>>
*% END
*% FRM = "AUM"
*% PADRE = "DBC"
*% KEY_PADRE = "DBC-GLS-NOMC"
*% LARGO_KEY_PADRE = 75
*% FIO_PADRE = "SGC-FIO-DBC"
*% SIST_PADRE = "SGC"
*% KEY_BROWSE_PADRE = "DBC-GLS-NOMC"
*% ORG_PADRE_VSI = TRUE
*% INICIALIZAR_VARIABLES = FALSE
*% 
*% ACEPTE_PF7 = TRUE
*% ACEPTE_PF8 = TRUE
*% COLAR_ENT = TRUE
*%
*% GNSTCA_ORIG = 300
*% GNSTCA = 300
*% IF SYS_SCOD
           MOVE +300 TO SCR-TCMA.
*% END
*% IF PGM_POS_EDB  AND  PGM_PU
           MOVE +300 TO SCR-TCMA.
*% END
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI                                                
           03 SCR-CIC-ICLI.
              05  SCR-CAI-ICLI                         PIC X(04).
              05  SCR-IIC-ICLI                         PIC X(08).
      *    TIPO CAMBIO
           03 WSS-COD-CAMB.                                             
              05 WSS-IND-VEJE       VALUE  SPACES  PIC X(01).           
              05 WSS-IND-VOFI       VALUE  SPACES  PIC X(01).           
              05 WSS-IND-VBAN       VALUE  SPACES  PIC X(01).           

      *AFRI-INI/29-ABR-2013 MOVILIDADES III
      *    PARAMETROS CAMBIO
           03 WSS-GLS-PARA                             PIC X(80).
           03 WSS-IIC-IREG                             PIC 9(08).

      *CONSTANTES
       01 WCC-VARI.
           03 WCC-M                 VALUE 'M'        PIC X(01).
           03 WCC-CF3               VALUE 'CF3'      PIC X(03).

           03 WCC-S                 VALUE 'S'        PIC X(01).
           03 WCC-I                 VALUE 'I'        PIC X(01).

           03 WCC-PGM               VALUE 'SGCPUAUM' PIC X(08).
           03 WCC-SIST              VALUE 'COL'      PIC X(03).
           03 WCC-ARCH              VALUE 'COLAUM'   PIC X(06).

           03 WCC-1                 VALUE 1        PIC 9(01).

           03 WSS-COD-ETAPA     VALUE '00000000001'  PIC X(11).
           03 WSS-UNO-CERO      VALUE '0'            PIC X(01).
           03 WSS-DOS-CERO      VALUE '00'           PIC X(02).
           03 WSS-GLS-TPOK  VALUE 'TICKET PROCESADO OK' PIC X(19).
      *AFRI-INI/MOVII/SOP-AFRI/JUL-2013
           03 WSS-CON-OCOL          VALUE  '365'   PIC X(03).
           03 WSS-CON-PCOL          VALUE  'Y'     PIC X(01).
           03 WSS-CON-S             VALUE  'S'     PIC X(01).
           03 WSS-CON-P             VALUE  'P'     PIC X(01).
           03 WSS-CON-E             VALUE  'E'     PIC X(01).
           03 WSS-CON-CCTE          VALUE  'CCT'   PIC X(03).
           03 WSS-CON-M100          VALUE  'M100'  PIC X(04).
           03 WSS-CON-PRGM          VALUE  'SGCPUAUM' PIC X(08).           
      *AFRI-FIN/MOVII/SOP-AFRI/JUL-2013


      *AFRI-FIN/29-ABR-2013 MOVILIDADES III

      *>>>>                                                             
*% END  
*% IF WSS  
      *AFRI-INI/29-ABR-2013 MOVILIDADES III
       COPY GNSBRITK.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITK-REQA==.
       COPY GNSBRPTK.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PTK-REQA==.
       COPY GNSBRRTK.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RTK-REQA==.
       COPY GNSBRCIC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGCIC.
      *AFRI-FIN/29-ABR-2013 MOVILIDADES III

      *<<<< WSS
       COPY GNSWGCPT.
       COPY GNSWGSTR.

       COPY SGCBRDCP.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCP-REQA==.
       COPY SGCBRDCE.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCE-REQA==.
       COPY SGCBRDCC.
       COPY SGCBRRCO.
       COPY SGCBROPE.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCC-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.        
       COPY SGCWGEJE.
       COPY SGCWGSUC.
       COPY SGCWGBAN.
       COPY SGCWGMOV.
       COPY GNSWGHOY.

      *>>>>
*% END
*% IF EOF_IBM  
      *<<<< EOF 
      *
       COPY SGCBFDCP.
       COPY SGCBFDCE.
      *
       COPY GNSBBTAB.
       COPY GNSBGCPT.
       COPY GNSBGSTR.
       COPY SGCBFDCC.
       COPY SGCBFRCO.
       COPY SGCBFOPE.
       COPY SGCBGEJE.
       COPY SGCBGSUC.
       COPY SGCBGBAN.
       COPY SGCBGMOV.
       COPY GNSBGHOY.
       COPY GNSBEGLS.
      *AFRI-INI/29-ABR-2013 MOVILIDADES III
       COPY GNSBFITK.
       COPY GNSBFPTK.
       COPY GNSBFRTK.
       COPY GNSBFCIC.
       COPY GNSBGCIC.
      *AFRI-FIN/29-ABR-2013 MOVILIDADES III
      *>>>>                                                             
*% END
*% IF INI_CMN_MOD
      *    INVOCACION RUTINA
           IF SCR-CMND = 'VRF' OR 'ACT'
               PERFORM COM-VAL-MOV
               MOVE '00' TO FIO-STAT
               GO TO FIN-CMN-MOD.
*% END
*% IF EOF_PU   
       VAL-REG-AUM SECTION.                                             
       INI-VAL-REG-AUM.                                                 


      *    VALIDO CLIENTE
           MOVE DBC-NUM-ICLI IN AUM-FLD TO MOV-NUM-ICLI IN MOV-INP.
           PERFORM BUS-REG-DBC.
           IF WSS-IND-ERRO = 'S'
               GO TO FIN-VAL-REG-AUM.

           PERFORM VAL-CLI-PER.
           IF WSS-IND-ERRO = 'S'
               GO TO FIN-VAL-REG-AUM.

           PERFORM BUS-COD-JOF.
           IF WSS-IND-ERRO = 'S'
               GO TO FIN-VAL-REG-AUM.

           PERFORM BUS-REG-BAN.
           IF WSS-IND-ERRO = 'S'
               GO TO FIN-VAL-REG-AUM.

           MOVE DBC-COD-OFIC IN DBC     TO WSS-COD-OFIO IN SUC-INP.
           MOVE FRM-COD-OFID IN AUM-FLD TO WSS-COD-OFID IN SUC-INP.
           MOVE DBC-COD-EJEC IN DBC     TO WSS-COD-EJEO IN EJE-INP.
           MOVE FRM-COD-EJED IN AUM-FLD TO WSS-COD-EJED IN EJE-INP.
           MOVE WSS-COD-TBAN IN BAN-OUT TO WSS-COD-TBAO IN BAN-INP.
           MOVE FRM-COD-TBAD IN AUM-FLD TO WSS-COD-TBAD IN BAN-INP.
           MOVE WSS-COD-TPLN IN BAN-OUT TO WSS-COD-PLAO IN BAN-INP.
           MOVE FRM-COD-TPLD IN AUM-FLD TO WSS-COD-PLAD IN BAN-INP.


      *    VALIDA SI CLIENTE ES DE CUENTAS ESPECIALES
           PERFORM  VAL-CLI-CESP.
           IF WSS-IND-ERRO = 'S'
               GO TO FIN-VAL-REG-AUM.

      *    VALIDA SI CLIENTE ES TITULAR CTA CTE
           PERFORM  BUS-REG-RCO.
           IF WSS-IND-ERRO = 'S'
               GO TO FIN-VAL-REG-AUM.


      *    SI HAY CAMBIO DE EJECUTIVO, LO VALIDA
           IF WSS-IND-VEJE = 'S'
               PERFORM VAL-MOV-EJE
               IF WSS-IND-ERRO = 'S'
                   GO TO FIN-VAL-REG-AUM.

      *    SI HAY CAMBIO DE BANCA, LO VALIDA
           IF WSS-IND-VBAN = 'S'
               PERFORM VAL-MOV-BAN
               IF WSS-IND-ERRO = 'S'
                   GO TO FIN-VAL-REG-AUM.

      *    SI HAY CAMBIO DE SUCURSAL, LO VALIDA
           IF WSS-IND-VOFI = 'S'
               PERFORM VAL-MOV-SUC
               IF WSS-IND-ERRO = 'S'
                   GO TO FIN-VAL-REG-AUM.

       FIN-VAL-REG-AUM.                                                 
           EXIT.                                                        
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       BUS-COD-JOF SECTION.                                             
       INI-BUS-COD-JOF.                                                 
                                                                        
           MOVE SPACES                  TO WSS-COD-JOFO IN EJE-INP.
           MOVE SPACES                  TO WSS-COD-JOFD IN EJE-INP.

           MOVE DBC-COD-OFIC IN DBC     TO WSS-COD-OFIC.
           PERFORM BUS-TBL-OFI.
           IF WSS-IND-ERRO NOT = 'S'
               MOVE WSS-COD-JFOF        TO WSS-COD-JOFO IN EJE-INP
           ELSE
               GO TO FIN-BUS-COD-JOF.

           IF WSS-IND-VOFI NOT = 'S'
               MOVE WSS-COD-JFOF        TO WSS-COD-JOFD IN EJE-INP.

           IF WSS-IND-VOFI = 'S'
               MOVE FRM-COD-OFID IN AUM-FLD TO WSS-COD-OFIC
               PERFORM BUS-TBL-OFI
               IF WSS-IND-ERRO NOT = 'S'
                   MOVE WSS-COD-JFOF    TO WSS-COD-JOFD IN EJE-INP
               ELSE
                   GO TO FIN-BUS-COD-JOF.

       FIN-BUS-COD-JOF.                                                 
           EXIT.                                                        
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       COM-VAL-MOV SECTION.                                             
       INI-COM-VAL-MOV.                                                 
                                                                        
           MOVE WSS-COD-CAMB TO WSS-COD-TCAM IN MOV-OUT.
           PERFORM BUS-TBL-VSN.
           IF WSS-IND-ERRO = 'S'
               GO TO FIN-COM-VAL-MOV.                                   

           PERFORM VAL-REG-AUM.
           IF WSS-IND-ERRO = 'S'
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE WSS-COD-ERRO   TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE 'S'            TO SCR-IERR
               GO TO FIN-COM-VAL-MOV.


           IF SCR-CMND = 'VRF'
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'VALCLIOK'     TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-COM-VAL-MOV.


      *    SI ES COMANDO 'ACT' ACTUALIZA REGISTRO
           PERFORM UPD-REG-MOV.
           IF WSS-IND-ERRO = 'S'
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE WSS-COD-ERRO   TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE 'S'            TO SCR-IERR
               GO TO FIN-COM-VAL-MOV
           ELSE
      *AFRI-INI/29-ABR-2013 MOVILIDADES III
               PERFORM GRB-REG-ITK
      *AFRI-FIN/29-ABR-2013 MOVILIDADES III
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'MOVCLIOK'     TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-COM-VAL-MOV.



       FIN-COM-VAL-MOV.                                                 
           EXIT.                                                        
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       UPD-REG-MOV SECTION.                                             
       INI-UPD-REG-MOV.                                                 
                                                                        
           MOVE SPACES TO WSS-IND-ERRO.
           MOVE SPACES TO WSS-COD-ERRO.
           PERFORM GET-FHOY.

      *    BUSCO CLIENTE DBC                                            
           MOVE SPACES                  TO DBC-IDC-ICLI IN DBC.
           MOVE DBC-NUM-ICLI IN AUM-FLD TO DBC-NUM-ICLI IN DBC.         
           MOVE 'DBC-IDC-ICLI'          TO FIO-AKEY.
           MOVE FIO-GET-KEY             TO FIO-CMND.                    
           PERFORM SGC-FIO-DBC.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M019' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               GO TO FIN-UPD-REG-MOV.                                   

           PERFORM CHK-PNT.
      *    ACTUALIZA DCP/DCE
           IF WSS-IND-VBAN = 'S'
               PERFORM UPD-REG-BAN
               IF WSS-IND-ERRO = 'S'
                   GO TO FIN-UPD-REG-MOV.

      *    SI HAY CAMBIO DE OFICINA ACTUALIZA OPE
           IF WSS-IND-VOFI = 'S' OR
              WSS-IND-VEJE = 'S'
               PERFORM VAL-REG-RCO
               IF WSS-IND-ERRO = 'S'
                   GO TO FIN-UPD-REG-MOV.

      *AFRI-INI/MOVII/SOP-AFRI/JUL-2013
      *    SI HAY CAMBIO DE OFICINA NO COLABORADOR A
      *    COLABORADOR SE ACTUALIZA A PLAN COLABORADOR
           IF WSS-IND-VOFI = WSS-CON-S AND
              DBC-COD-OFIC IN AUM-FLD NOT = WSS-CON-OCOL AND
              FRM-COD-OFID IN AUM-FLD = WSS-CON-OCOL
               PERFORM UPD-REG-PLN
               IF WSS-IND-ERRO = WSS-CON-S
                   GO TO FIN-UPD-REG-MOV.
      *AFRI-FIN/MOVII/SOP-AFRI/JUL-2013
                                                                        
      *    ACTUALIZA DBC
           PERFORM UPD-REG-DBC.
           IF WSS-IND-ERRO = 'S'
               GO TO FIN-UPD-REG-MOV.
                                                                        

       FIN-UPD-REG-MOV.                                                 
           EXIT.                                                        
      *----------------------------------------------------------------
      *----------------------------------------------------------------
      *AFRI-INI/MOVII/SOP-AFRI/JUL-2013
       UPD-REG-PLN SECTION.
       INI-UPD-REG-PLN.

           MOVE SPACES TO WSS-IND-ERRO.

           IF DBC-IND-TICL IN DBC = WSS-CON-P
               PERFORM UPD-REG-DCP-PLN
               GO TO FIN-UPD-REG-PLN.

           IF DBC-IND-TICL IN DBC = WSS-CON-E
               PERFORM UPD-REG-DCE-PLN
               GO TO FIN-UPD-REG-PLN.

       FIN-UPD-REG-PLN.
           EXIT.
      *-------------------------------------------------------------
      *-------------------------------------------------------------
       UPD-REG-DCE-PLN SECTION.
       INI-UPD-REG-DCE-PLN.


           MOVE SPACES              TO WSS-IND-ERRO.
           MOVE DBC-CIC-ICLI IN DBC TO DCE-CIC-ICLI IN DCE.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM SGC-FIO-DCE.
           IF NOT FIO-STAT-OKS
               MOVE WSS-CON-S       TO WSS-IND-ERRO
               MOVE WSS-CON-M100    TO WSS-COD-ERRO
               PERFORM GRB-VERR
               GO TO FIN-UPD-REG-DCE-PLN.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM SGC-FIO-DCE.
           MOVE FIO-MOD TO FIO-CMND.
           IF NOT FIO-STAT-OKS
               MOVE WSS-CON-S       TO WSS-IND-ERRO
               MOVE WSS-CON-M100    TO WSS-COD-ERRO
               PERFORM GRB-VERR
               GO TO FIN-UPD-REG-DCE-PLN.

           MOVE WSS-CON-PCOL        TO DCE-COD-TPLN IN DCE.

           MOVE WSS-CON-PRGM        TO DCE-COD-ATRN IN DCE.
           MOVE HOY-FHOY            TO DCE-FEC-FTRN IN DCE.
           MOVE HOY-HHOY            TO DCE-HRA-HRTR IN DCE.
                                                                        
           PERFORM SGC-FIO-DCE.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE WSS-CON-S       TO WSS-IND-ERRO
               MOVE WSS-CON-M100    TO WSS-COD-ERRO
               PERFORM GRB-VERR
               PERFORM BCK-OUT
               GO TO FIN-UPD-REG-DCE-PLN.                  


       FIN-UPD-REG-DCE-PLN.
           EXIT.
      *-------------------------------------------------------------
      *-------------------------------------------------------------
       UPD-REG-DCP-PLN SECTION.
       INI-UPD-REG-DCP-PLN.

           MOVE SPACES              TO WSS-IND-ERRO.
           MOVE DBC-CIC-ICLI IN DBC TO DCP-CIC-ICLI IN DCP.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM SGC-FIO-DCP.
           IF NOT FIO-STAT-OKS
               MOVE WSS-CON-S       TO WSS-IND-ERRO
               MOVE WSS-CON-M100    TO WSS-COD-ERRO
               PERFORM GRB-VERR
               GO TO FIN-UPD-REG-DCP-PLN.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM SGC-FIO-DCP.
           MOVE FIO-MOD TO FIO-CMND.
           IF NOT FIO-STAT-OKS
               MOVE WSS-CON-S       TO WSS-IND-ERRO
               MOVE WSS-CON-M100    TO WSS-COD-ERRO
               PERFORM GRB-VERR
               GO TO FIN-UPD-REG-DCP-PLN.

           MOVE WSS-CON-PCOL        TO DCP-COD-TPLN IN DCP.

           MOVE WSS-CON-PRGM        TO DCP-COD-ATRN IN DCP.
           MOVE HOY-FHOY            TO DCP-FEC-FTRN IN DCP.
           MOVE HOY-HHOY            TO DCP-HRA-HRTR IN DCP.
                                                                        
           PERFORM SGC-FIO-DCP.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE WSS-CON-S       TO WSS-IND-ERRO
               MOVE WSS-CON-M100    TO WSS-COD-ERRO
               PERFORM GRB-VERR
               PERFORM BCK-OUT
               GO TO FIN-UPD-REG-DCP-PLN.    


       FIN-UPD-REG-DCP-PLN.
           EXIT.
      *-------------------------------------------------------------
      *-------------------------------------------------------------           
      *AFRI-FIN/MOVII/SOP-AFRI/JUL-2013
      
       UPD-REG-BAN SECTION.                                             
       INI-UPD-REG-BAN.                                                 
                                                                        
           MOVE SPACES TO WSS-IND-ERRO.                                 
                                                                        
           IF DBC-IND-TICL IN DBC = 'P'
               PERFORM UPD-REG-DCP
               GO TO FIN-UPD-REG-BAN.

           IF DBC-IND-TICL IN DBC = 'E'
               PERFORM UPD-REG-DCE
               GO TO FIN-UPD-REG-BAN.
                                                                        

       FIN-UPD-REG-BAN.                                                 
           EXIT.                                                        
      *-------------------------------------------------------------
      *-------------------------------------------------------------
       UPD-REG-DBC SECTION.                                             
       INI-UPD-REG-DBC.                                                 
                                                                        
           MOVE SPACES          TO WSS-IND-ERRO.                        
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.                            
           PERFORM SGC-FIO-DBC.                                         
           MOVE FIO-MOD         TO FIO-CMND.                            
           IF NOT FIO-STAT-OKS                                          
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M100' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               GO TO FIN-UPD-REG-DBC.                                   
                                                                        
      *    ACTUALIZA EJECUTIVO
           IF WSS-IND-VEJE  = 'S'
               MOVE FRM-COD-EJED IN AUM-FLD TO DBC-COD-EJEC IN DBC.

      *    ACTUALIZA OFICINA
           IF WSS-IND-VOFI  = 'S'
               MOVE FRM-COD-OFID IN AUM-FLD TO DBC-COD-OFIC IN DBC.

           MOVE 'SGCPUAUM'         TO DBC-COD-ATRN IN DBC.
           MOVE HOY-FHOY           TO DBC-FEC-FTRN IN DBC.
           MOVE HOY-HHOY           TO DBC-HRA-HRTR IN DBC.
                                                                        
           PERFORM SGC-FIO-DBC.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M100' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               PERFORM BCK-OUT
               GO TO FIN-UPD-REG-DBC.                                   

                                                                        

       FIN-UPD-REG-DBC.                                                 
           EXIT.                                                        
      *-------------------------------------------------------------
      *-------------------------------------------------------------
       UPD-REG-DCE SECTION.                                             
       INI-UPD-REG-DCE.                                                 
                                                                        
                                                                        
           MOVE SPACES              TO WSS-IND-ERRO.
           MOVE DBC-CIC-ICLI IN DBC TO DCE-CIC-ICLI IN DCE.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM SGC-FIO-DCE.
           IF NOT FIO-STAT-OKS
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M100' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               GO TO FIN-UPD-REG-DCE.
                                                                        
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.                            
           PERFORM SGC-FIO-DCE.                                         
           MOVE FIO-MOD TO FIO-CMND.                                    
           IF NOT FIO-STAT-OKS                                          
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M100' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               GO TO FIN-UPD-REG-DCE.                                   
                                                                        
           MOVE FRM-COD-TBAD IN AUM-FLD TO DCE-COD-TBAN IN DCE.
      *AFRI-INI/MOVII/SOP-AFRI/JUL-2013
      *    MOVE FRM-COD-TPLD IN AUM-FLD TO DCE-COD-TPLN IN DCE.
           IF (DBC-COD-OFIC IN AUM-FLD NOT = WSS-CON-OCOL AND
               FRM-COD-OFID IN AUM-FLD = WSS-CON-OCOL)
              MOVE WSS-CON-PCOL        TO DCE-COD-TPLN IN DCE.
      *AFRI-FIN/MOVII/SOP-AFRI/JUL-2013

           MOVE 'SGCPUAUM'          TO DCE-COD-ATRN IN DCE.
           MOVE HOY-FHOY            TO DCE-FEC-FTRN IN DCE.
           MOVE HOY-HHOY            TO DCE-HRA-HRTR IN DCE.
                                                                        
           PERFORM SGC-FIO-DCE.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M100' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               PERFORM BCK-OUT
               GO TO FIN-UPD-REG-DCE.                                   

                                                                        

       FIN-UPD-REG-DCE.                                                 
           EXIT.                                                        
      *-------------------------------------------------------------
      *-------------------------------------------------------------
       UPD-REG-DCP SECTION.                                             
       INI-UPD-REG-DCP.                                                 
                                                                        
                                                                        
           MOVE SPACES              TO WSS-IND-ERRO.
           MOVE DBC-CIC-ICLI IN DBC TO DCP-CIC-ICLI IN DCP.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM SGC-FIO-DCP.
           IF NOT FIO-STAT-OKS
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M100' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               GO TO FIN-UPD-REG-DCP.
                                                                        
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.                            
           PERFORM SGC-FIO-DCP.                                         
           MOVE FIO-MOD TO FIO-CMND.                                    
           IF NOT FIO-STAT-OKS                                          
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M100' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               GO TO FIN-UPD-REG-DCP.                                   
                                                                        
           MOVE FRM-COD-TBAD IN AUM-FLD TO DCP-COD-TBAN IN DCP.
      *AFRI-INI/MOVII/SOP-AFRI/JUL-2013
      *    MOVE FRM-COD-TPLD IN AUM-FLD TO DCP-COD-TPLN IN DCP.
           IF (DBC-COD-OFIC IN AUM-FLD NOT = WSS-CON-OCOL AND
               FRM-COD-OFID IN AUM-FLD = WSS-CON-OCOL)
              MOVE WSS-CON-PCOL        TO DCE-COD-TPLN IN DCE.
      *AFRI-FIN/MOVII/SOP-AFRI/JUL-2013           

           MOVE 'SGCPGAMV'          TO DCP-COD-ATRN IN DCP.
           MOVE HOY-FHOY            TO DCP-FEC-FTRN IN DCP.
           MOVE HOY-HHOY            TO DCP-HRA-HRTR IN DCP.
                                                                        
           PERFORM SGC-FIO-DCP.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M100' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               PERFORM BCK-OUT
               GO TO FIN-UPD-REG-DCP.                                   


       FIN-UPD-REG-DCP.                                                 
           EXIT.                                                        
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       VAL-REG-RCO SECTION.                                             
       INI-VAL-REG-RCO.                                                 

           MOVE SPACES       TO WSS-IND-ERRO.

      *    ENTRO A VMV                                                  
           MOVE DBC-CIC-ICLI IN DBC TO RCO-CIC-ICLI IN RCO.             
           MOVE SPACES              TO RCO-CIC-IOPE IN RCO.             
           MOVE FIO-GET-NLS  TO FIO-CMND.                               
                                                                        
       LUP-VAL-REG-RCO.                                                 
           PERFORM SGC-FIO-RCO.                                         
           IF NOT FIO-STAT-OKS OR                                       
              DBC-CIC-ICLI IN DBC NOT = RCO-CIC-ICLI IN RCO             
               GO TO FIN-VAL-REG-RCO.                                   


           IF RCO-COD-STAT IN RCO NOT = 'VIG' OR
              RCO-COD-RCOP IN RCO NOT = 'TIT'
               GO TO NXT-VAL-REG-RCO.

           MOVE RCO-CIC-IOPE IN RCO TO OPE-CIC-IOPE IN OPE.             
           MOVE FIO-GET-KEY  TO FIO-CMND.                               
           PERFORM SGC-FIO-OPE.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M047' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               PERFORM BCK-OUT
               GO TO FIN-VAL-REG-RCO.                                   

      *AFRI-INI/MOVII/SOP-AFRI/JUL-2013
           IF OPE-COD-TOPR IN OPE NOT = WSS-CON-CCTE
               GO TO NXT-VAL-REG-RCO.
      *AFRI-FIN/MOVII/SOP-AFRI/JUL-2013
                                                                        
      *    VALIDA QUE OFICINA DE ORIGEN SEA LA DE OPERACION
           IF WSS-IND-VOFI  = 'S' AND
              OPE-COD-OFOP IN OPE NOT = DBC-COD-OFIC IN DBC
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M047' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               PERFORM BCK-OUT
               GO TO FIN-VAL-REG-RCO.                                   
                                                                        
      *    VALIDA QUE EJECUTIVO ORIGEN SEA EL DE OPERACION
           IF WSS-IND-VEJE  = 'S' AND
              OPE-COD-EJOP IN OPE NOT = DBC-COD-EJEC IN DBC
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M047' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               PERFORM BCK-OUT
               GO TO FIN-VAL-REG-RCO.                                   
                                                                        
      *    ACTUALIZA REGISTRO OPE
           PERFORM UPD-REG-OPE.
           IF WSS-IND-ERRO = 'S'
               GO TO FIN-VAL-REG-RCO.
                                                                        
       NXT-VAL-REG-RCO.                                                 
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           GO TO LUP-VAL-REG-RCO.                                       
                                                                        
       FIN-VAL-REG-RCO.                                                 
           EXIT.                                                        
      *-------------------------------------------------------------
      *-------------------------------------------------------------
       UPD-REG-OPE SECTION.                                             
       INI-UPD-REG-OPE.                                                 
                                                                        
           MOVE SPACES          TO WSS-IND-ERRO.                        
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.                            
           PERFORM SGC-FIO-OPE.                                         
           MOVE FIO-MOD         TO FIO-CMND.                            
           IF NOT FIO-STAT-OKS                                          
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M047' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               GO TO FIN-UPD-REG-OPE.                                   
                                                                        
           IF WSS-IND-VOFI  = 'S'
               MOVE FRM-COD-OFID IN AUM-FLD TO OPE-COD-OFOP IN OPE.

           IF WSS-IND-VEJE  = 'S'
               MOVE FRM-COD-EJED IN AUM-FLD TO OPE-COD-EJOP IN OPE.


           MOVE 'SGCPUAUM'          TO OPE-COD-ATRN IN OPE.
           MOVE HOY-FHOY            TO OPE-FEC-FTRN IN OPE.
           MOVE HOY-HHOY            TO OPE-HRA-HRTR IN OPE.
                                                                        
           PERFORM SGC-FIO-OPE.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'S'    TO WSS-IND-ERRO
               MOVE 'M100' TO WSS-COD-ERRO
               PERFORM GRB-VERR
               PERFORM BCK-OUT
               GO TO FIN-UPD-REG-OPE.                                   

       FIN-UPD-REG-OPE.                                                 
           EXIT.                                                        
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       CHK-PNT SECTION.                                                 
       INI-CHK-PNT.                                                     
           MOVE FIO-CHK-PNT TO FIO-CMND.                                
           PERFORM SGC-FIO-DBC.                                         
       FIN-CHK-PNT.                                                     
           EXIT.                                                        
      *-------------------------------------------------------------
      *-------------------------------------------------------------
       BCK-OUT SECTION.                                                 
       INI-BCK-OUT.                                                     
           MOVE FIO-BCK-OUT TO FIO-CMND.                                
           PERFORM SGC-FIO-DBC.                                         
       FIN-BCK-OUT.                                                     
           EXIT.                                                        
      *-------------------------------------------------------------
      *-------------------------------------------------------------
      *AFRI-INI/29-ABR-2013 MOVILIDADES III
       GRB-REG-ITK SECTION.                                             
       INI-GRB-REG-ITK.                                                 

           MOVE SPACES                  TO WSS-GLS-PARA.
           MOVE WSS-COD-CAMB            TO WSS-GLS-PARA(1:3).
           MOVE FRM-COD-MOVI IN AUM-FLD TO WSS-GLS-PARA(4:3).
           MOVE DBC-COD-OFIC IN AUM-FLD TO WSS-GLS-PARA(7:3).
           MOVE FRM-COD-OFID IN AUM-FLD TO WSS-GLS-PARA(10:3).
           MOVE DBC-COD-EJEC IN AUM-FLD TO WSS-GLS-PARA(13:12).
           MOVE FRM-COD-EJED IN AUM-FLD TO WSS-GLS-PARA(25:12).
           MOVE FRM-COD-TBAN IN AUM-FLD TO WSS-GLS-PARA(37:3).
           MOVE FRM-COD-TBAD IN AUM-FLD TO WSS-GLS-PARA(40:3).
           MOVE FRM-COD-TPLN IN AUM-FLD TO WSS-GLS-PARA(43:1).
           MOVE FRM-COD-TPLD IN AUM-FLD TO WSS-GLS-PARA(44:1).

      *    BUSCA LLAVE REGISTRO
           PERFORM BUS-CIC-REG.
           IF WSS-IND-ERRO = 'S'
               GO TO FIN-GRB-REG-ITK.

           MOVE SPACES                    TO  ITK-GLS-FLAG IN ITK.      
           MOVE WCC-M                     TO  ITK-COD-TITK IN ITK.      
           MOVE WCC-CF3                   TO  ITK-COD-CITK IN ITK.      
           MOVE WSS-IIC-IREG              TO  ITK-IIC-IITK IN ITK.      
           MOVE HOY-FHOY                  TO  ITK-FEC-FTRN IN ITK.      
           MOVE HOY-HHOY                  TO  ITK-HRA-HRTR IN ITK.      
           MOVE WCC-I                     TO  ITK-MSC-TACC IN ITK.      
           MOVE WCC-I                     TO  ITK-MSC-STAT IN ITK.      
           MOVE SPACES                    TO  ITK-COD-OTRN IN ITK.      
           MOVE WCC-PGM                   TO  ITK-COD-ATRN IN ITK.      
           MOVE SPACES                    TO  ITK-COD-FILL IN ITK.      
           MOVE WCC-SIST                  TO  ITK-COD-SIST IN ITK.      
           MOVE WCC-ARCH                  TO  ITK-COD-TPRO IN ITK.      
           MOVE DBC-IDC-ICLI IN DBC       TO  ITK-COD-ENTI IN ITK.      
           MOVE HOY-FHOY                  TO  ITK-FEC-FPRO IN ITK.      
           MOVE HOY-HHOY                  TO  ITK-HRA-HRPR IN ITK.      
           MOVE WCC-1                     TO  ITK-NUM-UNIC IN ITK.      
           MOVE WCC-1                     TO  ITK-VAL-OITE IN ITK.      
           MOVE WCC-1                     TO  ITK-VAL-TITE IN ITK.      
           MOVE WCC-1                     TO  ITK-VAL-TPRO IN ITK.      
           MOVE WSS-COD-ETAPA             TO  ITK-COD-ETAP IN ITK.      
           MOVE WSS-UNO-CERO              TO  ITK-IND-RESP IN ITK.      
           MOVE WSS-DOS-CERO              TO  ITK-COD-RESP IN ITK.      
           MOVE WSS-GLS-TPOK              TO  ITK-GLS-RESP IN ITK.      
           MOVE HOY-FHOY                  TO  ITK-FEC-FGRA IN ITK.      
           MOVE HOY-HHOY                  TO  ITK-HRA-HRGR IN ITK.      
           MOVE ZEROES                    TO  ITK-FEC-FINI IN ITK.      
           MOVE ZEROES                    TO  ITK-HRA-HRIN IN ITK.      
           MOVE ZEROES                    TO  ITK-FEC-FTER IN ITK.      
           MOVE ZEROES                    TO  ITK-HRA-HRTE IN ITK.      
           MOVE SPACES                    TO  ITK-GLS-DISP IN ITK.      

                                                                        
           MOVE FIO-PUT      TO FIO-CMND.                               
           PERFORM GNS-FIO-ITK.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE WCC-S                 TO WSS-IND-ERRO               
               PERFORM BCK-OUT
               GO TO FIN-GRB-REG-ITK.                                   

      *--------------------------

           MOVE SPACES                    TO  PTK-GLS-FLAG IN PTK.      
           MOVE ITK-CIC-IITK IN ITK       TO  PTK-CIC-IITK IN PTK.      
           MOVE ZEROES                    TO  PTK-NUM-SECU IN PTK.      
           MOVE WCC-1                     TO  PTK-NUM-CORP IN PTK.      
           MOVE HOY-FHOY                  TO  PTK-FEC-FTRN IN PTK.      
           MOVE HOY-HHOY                  TO  PTK-HRA-HRTR IN PTK.      
           MOVE WCC-I                     TO  PTK-MSC-TACC IN PTK.      
           MOVE SPACES                    TO  PTK-MSC-STAT IN PTK.      
           MOVE SPACES                    TO  PTK-COD-OTRN IN PTK.      
           MOVE ITK-COD-ATRN IN ITK       TO  PTK-COD-ATRN IN PTK.      

           MOVE WSS-GLS-PARA              TO  PTK-GLS-PARA IN PTK.      
           MOVE SPACES                    TO  PTK-GLS-DISP IN PTK.      

           MOVE FIO-PUT      TO FIO-CMND.                               
           PERFORM GNS-FIO-PTK.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE WCC-S                 TO WSS-IND-ERRO               
               PERFORM BCK-OUT
               GO TO FIN-GRB-REG-ITK.                                   

      *--------------------------
           MOVE SPACES                    TO  RTK-GLS-FLAG IN RTK.      
           MOVE ITK-CIC-IITK IN ITK       TO  RTK-CIC-IITK IN RTK.      
           MOVE ZEROES                    TO  RTK-NUM-SECT IN RTK.      
           MOVE ITK-COD-ENTI IN ITK       TO  RTK-COD-ENTT IN RTK.      
           MOVE WCC-1                     TO  RTK-NUM-CORT IN RTK.      
           MOVE ITK-COD-SIST IN ITK       TO  RTK-COD-SIST IN RTK.      
           MOVE ITK-COD-TPRO IN ITK       TO  RTK-COD-TPRO IN RTK.      
           MOVE ZEROES                    TO  RTK-NUM-SECU IN RTK.      
           MOVE ITK-COD-ENTI IN ITK       TO  RTK-COD-ENTI IN RTK.      
           MOVE ITK-FEC-FPRO IN ITK       TO  RTK-FEC-FPRO IN RTK.      
           MOVE ITK-HRA-HRPR IN ITK       TO  RTK-HRA-HRPR IN RTK.      
           MOVE WCC-1                     TO  RTK-NUM-CORR IN RTK.      
           MOVE ITK-STP-ITRN IN ITK       TO  RTK-STP-ITRN IN RTK.      
           MOVE SPACES                    TO  RTK-MSC-TACC IN RTK.      
           MOVE SPACES                    TO  RTK-MSC-STAT IN RTK.      
           MOVE SPACES                    TO  RTK-COD-OTRN IN RTK.      
           MOVE WCC-PGM                   TO  RTK-COD-ATRN IN RTK.      
           MOVE SPACES                    TO  RTK-GLS-FRES IN RTK.      
           MOVE ITK-GLS-RESP IN ITK       TO  RTK-GLS-RESP IN RTK.      
           MOVE SPACES                    TO  RTK-IND-RESP IN RTK.      
           MOVE SPACES                    TO  RTK-COD-RESP IN RTK.      
           MOVE SPACES                    TO  RTK-GLS-MENJ IN RTK.      
           MOVE ZEROES                    TO  RTK-FEC-FINI IN RTK.      
           MOVE ZEROES                    TO  RTK-HRA-HRIN IN RTK.      
           MOVE ZEROES                    TO  RTK-FEC-FTER IN RTK.      
           MOVE ZEROES                    TO  RTK-HRA-HRTE IN RTK.      
           MOVE SPACES                    TO  RTK-GLS-DISP IN RTK.      

           MOVE FIO-PUT      TO FIO-CMND.                               
           PERFORM GNS-FIO-RTK.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE WCC-S                 TO WSS-IND-ERRO               
               PERFORM BCK-OUT
               GO TO FIN-GRB-REG-ITK.                                   

       FIN-GRB-REG-ITK.                                                 
           EXIT.                                                        
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       BUS-CIC-REG SECTION.                                             
       INI-BUS-CIC-REG.                                                 

           MOVE ZEROES                    TO WSS-IIC-IREG.
           MOVE SPACES                    TO WSS-IND-ERRO.
           MOVE WCC-M                     TO CIC-COD-TCIC IN CIC.       
           MOVE WCC-CF3                   TO CIC-COD-CCIC IN CIC.       
           MOVE CIC-GET                   TO CIC-CMND.                  
           PERFORM PRO-CIC.                                             
           IF CIC-STAT NOT = CIC-STAT-OKS                               
               MOVE 'S'    TO WSS-IND-ERRO
               PERFORM BCK-OUT
               GO TO FIN-BUS-CIC-REG                                    
           ELSE
               MOVE CIC-IIC-ICIC IN CIC TO WSS-IIC-IREG.



       FIN-BUS-CIC-REG.                                                 
           EXIT.                                                        
      *----------------------------------------------------------------
      *----------------------------------------------------------------
      *AFRI-FIN/29-ABR-2013 MOVILIDADES III

*% END
