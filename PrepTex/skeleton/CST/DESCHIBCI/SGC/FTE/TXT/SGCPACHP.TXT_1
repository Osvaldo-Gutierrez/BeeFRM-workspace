*% NO_TIENE_TIMESTAMP = TRUE
*% LARGO_MI_COMMAREA = 3250
*%! Codigo adicional para archivo
*% IF WSS_DTC
      *<<<<
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.
      *>>>>
*% END
*% IF WSS_IBM
      *<<<<
       COPY GNSWGSTR.
       COPY GNSWGCPT.
       COPY SGCBRDBC.
       COPY SGCBROPE.
       COPY SGCBRRCO.
       COPY SGCBRDCC.

       01  WSS-VARI.
           03 DOC-COD-DAT1                      PIC X(01).
           03 WSS-I                             PIC 9(03).
           03 WSS-FEC-FACL                      PIC X(08).
           03 WSS-CIC-ICLI.
              05 WSS-CAI-ICLI                   PIC X(04).
              05 WSS-IIC-ICLI                   PIC X(08).
           03 WSS-IND-BSGE         VALUE 0      PIC 9(01).
      *>>>>
*% END
*% IF INI_SCR_PGM AND PGM_PU
      *JSS-PRF TODAVIA NO SE COMO QUEDARIA EL SCR-PGM 
      *<<<< INI_SCR_PGM
            GO TO FIN-SCR-PGM.
      *>>>>
*% END 
*% IF FND_KEY
      *<<<< FND_KEY
      *DAD ini  5-JUN-1991 
           IF SCR-CMND = 'ING'
               MOVE SPACES TO FEC-FECH
               MOVE SPACES TO CHP-FEC-FCHP IN CHP
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM SGC-FIO-CHP
               MOVE CHP-NUM-DCHP IN CHP TO FEC-ITM1
               MOVE CHP-NUM-MCHP IN CHP TO FEC-ITM2
               MOVE CHP-NUM-SCHP IN CHP TO FEC-ITM3
               MOVE CHP-NUM-ACHP IN CHP TO FEC-ITM4
               IF FIO-STAT-OKS AND
                  CHP-CAI-ICCT IN CHP = CHP-CAI-ICCT IN CHP-FLD AND
                  CHP-IIC-ICCT IN CHP = CHP-IIC-ICCT IN CHP-FLD AND
                  CHP-NUM-ICHP IN CHP = CHP-NUM-ICHP IN CHP-FLD AND
                  FEC-FECH        NOT = CHP-FEC-FCHP IN CHP-FLD
                   MOVE 'SGC'        TO MSG-COD-SIST
                   MOVE 'CHPFCHPMAS' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC IN MSG TO FRM-MEN1
                   MOVE FEC-FECH            TO FRM-MEN2
                   MOVE FIO-STAT-NEX TO FIO-STAT
                   GO TO FIN-FND-KEY
               ELSE
                   PERFORM KEY-ALL-CHP.
      *DAD fin  5-JUN-1991 
           MOVE FIO-GET-KEY TO FIO-CMND.
           IF CHP-NUM-ICHP IN CHP NOT > ZEROES
               MOVE 9999999 TO CHP-NUM-ICHP IN CHP
               MOVE  1      TO WSS-IND-BSGE IN WSS-VARI
               MOVE FIO-GET-LEQ TO FIO-CMND
           ELSE
           IF CHP-FEC-FCHP IN CHP NOT > ZEROES
               MOVE '99999999' TO CHP-FEC-FCHP IN CHP
               MOVE  1         TO WSS-IND-BSGE IN WSS-VARI
               MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM SGC-FIO-CHP.
           IF FIO-STAT-OKS AND
              CHP-CAI-ICCT IN CHP = CHP-CAI-ICCT IN CHP-FLD AND
              CHP-IIC-ICCT IN CHP = CHP-IIC-ICCT IN CHP-FLD AND
              CHP-NUM-ICHP IN CHP = CHP-NUM-ICHP IN CHP-FLD
               MOVE 'CHPSI' TO MSG-COD-MENS
               MOVE '00'    TO PGM-STAT-CHP
           ELSE
      *DAD
               MOVE '23'    TO PGM-STAT-CHP
      *
               MOVE 'CHPNO' TO MSG-COD-MENS.

           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DCC.
           IF FIO-STAT-OKS
               MOVE DCC-NUM-TCHP IN DCC TO DCC-NUM-TCHP IN CHP-FLD
               MOVE DCC-NUM-TCHA IN DCC TO DCC-NUM-TCHA IN CHP-FLD
               IF MSG-COD-MENS = 'CHPNO'
                   IF SCR-CCPP = 'ACT' AND WSS-IND-BSGE IN WSS-VARI = 1
                       MOVE FIO-STAT-NEX TO FIO-STAT
                       GO TO FIN-FND-KEY
                   ELSE
                       MOVE '23' TO FIO-STAT
                       GO TO FIN-FND-KEY
               ELSE
                   MOVE '00' TO FIO-STAT
                   MOVE FIO-STAT TO PGM-STAT-DCC
                   GO TO FIN-FND-KEY.

           IF MSG-COD-MENS = 'CHPNO'
               PERFORM CLR-CHP.

           PERFORM CLR-DCC.
      *DAD
           MOVE PGM-STAT-CHP TO FIO-STAT.
      *
           GO TO FIN-FND-KEY.
      *>>>>
*% END
*% IF FIN_HBL_FLD
      *<<<< FIN_HBL_FLD
           IF SCR-CMND = 'ACL'
               MOVE FRM-CPIM-AEY TO CHP-COD-TDOC-ATR IN CHP-FLD
               MOVE FRM-CPIM-AEY TO CHP-VAL-CHEQ-ATR IN CHP-FLD
               MOVE FRM-CPIM-AEY TO CHP-COD-MOTP-ATR IN CHP-FLD
               MOVE FRM-CPIM-AEY TO CHP-IND-EBOL-ATR IN CHP-FLD
               MOVE  0           TO CHP-COD-TDOC-LEN IN CHP-FLD
               MOVE -1           TO CHP-FEC-FACL-LEN IN CHP-FLD
           ELSE
               MOVE FRM-CPIM-AEY TO CHP-FEC-FACL-ATR IN CHP-FLD
               MOVE FRM-CPIM-AEY TO CHP-NUM-BOLE-ATR IN CHP-FLD
               MOVE FRM-CPIM-AEY TO CHP-NUM-PAGE-ATR IN CHP-FLD
               MOVE FRM-CPIM-AEY TO CHP-NUM-NOMI-ATR IN CHP-FLD.
           IF SCR-CCPP = 'ING' OR SCR-ACTU = SCR-ACTU-ING
               IF OPE-COD-TOPR IN CHP-FLD > SPACES
                   MOVE 'TAB'                   TO TAB-COD-SIST
                   MOVE 'TIO'                   TO TAB-COD-TTAB IN TAB
                   MOVE OPE-COD-TOPR IN CHP-FLD TO TAB-COD-CTAB IN TAB
                   PERFORM BUS-TAB
                   IF TAB-COD-DAT3(1) > SPACES
                       MOVE TAB-COD-DAT3(1) TO CHP-COD-TDOC IN CHP-FLD
                       MOVE FRM-CPIM-AEY TO CHP-COD-TDOC-ATR IN CHP-FLD
                       MOVE  0           TO CHP-COD-TDOC-LEN IN CHP-FLD
                       MOVE -1           TO CHP-VAL-CHEQ-LEN IN CHP-FLD.
      *>>>>
*% END
*% IF  CMN_MOD
      *<<<< CMN_MOD
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO CHP-NUM-DTRN IN CHP.
           MOVE HOY-MHOY IN HOY-VARI TO CHP-NUM-MTRN IN CHP.
           MOVE HOY-AHOY IN HOY-VARI TO CHP-NUM-ATRN IN CHP.
           MOVE HOY-SHOY IN HOY-VARI TO CHP-NUM-STRN IN CHP.
           MOVE HOY-HHOY IN HOY-VARI TO CHP-HRA-HRTR IN CHP.
      *>>>>
*% END
*% IF CMN_ING 
      *<<<< CMN_ING
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO CHP-NUM-DTRN IN CHP.
           MOVE HOY-MHOY IN HOY-VARI TO CHP-NUM-MTRN IN CHP.
           MOVE HOY-AHOY IN HOY-VARI TO CHP-NUM-ATRN IN CHP.
           MOVE HOY-SHOY IN HOY-VARI TO CHP-NUM-STRN IN CHP.
           MOVE HOY-HHOY IN HOY-VARI TO CHP-HRA-HRTR IN CHP.
      *>>>>
*% END
*% IF CMN_MOD_RET
      *<<<<
           MOVE CHP-FEC-FACL IN CHP TO WSS-FEC-FACL IN WSS-VARI.
      *>>>>
*% END
*% IF CMN_MOD
      *<<<< CMN_MOD
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en la modificacion : informar               
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-MOD.

           IF NOT ( ( WSS-FEC-FACL IN WSS-VARI > ZEROES AND
                      CHP-FEC-FACL IN CHP-FLD NOT > ZEROES ) OR
                    ( WSS-FEC-FACL IN WSS-VARI NOT > ZEROES AND
                      CHP-FEC-FACL IN CHP-FLD > ZEROES ) )
               GO TO FIN-CMN-MOD.

           PERFORM RET-ALL-CHP.
           PERFORM UPD-DCC.
           IF NOT FIO-STAT-OKS                                                  
               GO TO FIN-CMN-MOD.

           PERFORM RET-ALL-CHP.
      *>>>>
*% END
*% IF CMN_ING
      *<<<< CMN_ING
      *>>>>
*% END          
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en el ingreso : informar                    
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ING.                                               

           PERFORM RET-ALL-CHP.
           PERFORM UPD-DCC.
           IF NOT FIO-STAT-OKS                                                  
               GO TO FIN-CMN-ING.

           PERFORM RET-ALL-CHP.
      *>>>>
*% END
*% IF CMN_ELI
      *<<<< CMN_ELI
      *>>>>
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en la eliminacion : informar                
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.                                              

           PERFORM RET-ALL-CHP.
           PERFORM UPD-DCC.
           IF NOT FIO-STAT-OKS                                                  
               GO TO FIN-CMN-ELI.

           PERFORM RET-ALL-CHP.
      *>>>>
*% END
*% IF INI_SCR_TRL
      *<<<< INI_SCR_TRL
           IF PGM-STAT-CHP-OKS AND 
              CHP-MSC-STAT IN CHP = 'V'
               MOVE 'SGC'      TO MSG-COD-SIST
               MOVE 'MSCSTATV' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO CON-SCR-TRL.

           IF PGM-STAT-CHP-OKS AND 
              CHP-FEC-FACL IN CHP NOT > ZEROES AND
              SCR-CMND = 'VRF'
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'CICICCTNOACL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE SCR-STAT-CON TO SCR-STAT.
       CON-SCR-TRL.
      *>>>>
*% END
*% IF ABT_CMN_ACC
      *<<<< ABT_CMN_ACC
               IF SCR-CMND = 'VRF'
                   MOVE 'SGC'          TO MSG-COD-SIST
                   MOVE 'CHP    NOVRF' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-CMN-ACC
               ELSE
      *>>>>
*% END
*% IF INI_CMN_ACC
      *<<<< INI_CMN_ACC
      *>>>>
*% END
*% IF CMN_ACC_RET
      *<<<< CMN_ACC_RET
           IF SCR-CMND = 'VRF' 
               PERFORM RET-CHP-CHP
               MOVE 'V' TO CHP-MSC-STAT IN CHP
               PERFORM GET-FHOY
               MOVE HOY-DHOY IN HOY-VARI TO CHP-NUM-DTRN IN CHP
               MOVE HOY-MHOY IN HOY-VARI TO CHP-NUM-MTRN IN CHP
               MOVE HOY-AHOY IN HOY-VARI TO CHP-NUM-ATRN IN CHP
               MOVE HOY-SHOY IN HOY-VARI TO CHP-NUM-STRN IN CHP
               MOVE HOY-HHOY IN HOY-VARI TO CHP-HRA-HRTR IN CHP
               MOVE FIO-MOD TO FIO-CMND
               PERFORM SGC-FIO-CHP
               IF NOT FIO-STAT-OKS
                   MOVE FIO-MENS TO FRM-MENS
                   GO TO FIN-CMN-ACC
              ELSE
                  MOVE 'GNS'        TO MSG-COD-SIST
                  MOVE 'VRFYES    ' TO MSG-COD-MENS
                  PERFORM GET-MSG
                  MOVE MSG-GLS-DESC TO FRM-MENS
                  GO TO FIN-CMN-ACC.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       UPD-DCC SECTION.
       INI-UPD-DCC.
           MOVE CHP-CIC-ICCT IN CHP TO RCO-CIC-IOPE IN RCO.
           MOVE 'RCO-KEY-IOPE' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
       LUP-UPD-DCC.
           PERFORM SGC-FIO-RCO.
           IF NOT FIO-STAT-OKS OR
              RCO-CIC-IOPE IN RCO NOT = CHP-CIC-ICCT IN CHP
               MOVE '00' TO FIO-STAT
               GO TO FIN-UPD-DCC.

           MOVE RCO-CIC-ICLI IN RCO TO DCC-CIC-ICLI IN DCC.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM SGC-FIO-DCC.
           IF NOT FIO-STAT-OKS                                                  
               MOVE RCO-CIC-ICLI IN RCO TO DCC-CIC-ICLI IN DCC
               MOVE 1                   TO DCC-NUM-TCHP IN DCC
               MOVE CHP-STP-ITRN IN CHP TO DCC-STP-ITRN IN DCC
               MOVE FIO-PUT TO FIO-CMND
               IF CHP-FEC-FACL IN CHP > ZEROES
                   MOVE 1 TO DCC-NUM-TCHA IN DCC
                   GO TO PUT-MOD-DCC
               ELSE
                   MOVE ZEROES TO DCC-NUM-TCHA IN DCC
                   GO TO PUT-MOD-DCC.

           IF SCR-CCPP = 'ELI'
               SUBTRACT 1 FROM DCC-NUM-TCHP IN DCC
               IF CHP-FEC-FACL IN CHP > ZEROES
                   SUBTRACT 1 FROM DCC-NUM-TCHA IN DCC.

           IF SCR-CCPP = 'ING' OR SCR-ACTU = SCR-ACTU-ING
               ADD 1 TO DCC-NUM-TCHP IN DCC
               IF CHP-FEC-FACL IN CHP > ZEROES
                   ADD 1 TO DCC-NUM-TCHA IN DCC.

           IF SCR-CCPP = 'MOD' OR SCR-ACTU = SCR-ACTU-MOD           
               IF CHP-FEC-FACL IN CHP > ZEROES
                   ADD 1 TO DCC-NUM-TCHA IN DCC
               ELSE
                   SUBTRACT 1 FROM DCC-NUM-TCHA IN DCC.

           MOVE FIO-MOD TO FIO-CMND.
       PUT-MOD-DCC.
           PERFORM SGC-FIO-DCC.
           IF NOT FIO-STAT-OKS                                                  
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-UPD-DCC.

           MOVE 'RCO-KEY-IOPE' TO FIO-AKEY.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           GO TO LUP-UPD-DCC.
       FIN-UPD-DCC.
           EXIT.

       BCK-OUT SECTION.
       INI-BCK-OUT.
           MOVE FIO-BCK-OUT TO FIO-CMND.
           PERFORM SGC-FIO-DCC.
           IF FIO-STAT-OKS
      *        Para informar que el backout se realizo con exito
               MOVE '49' TO FIO-STAT.                                       
       FIN-BCK-OUT.                                                             
           EXIT.                                                                

       PUT-DBC SECTION.
       INI-PUT-DBC.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO DBC-GLS-NOMC IN CHP-FLD.
           
           MOVE STR-GLS-GSTR        TO DBC-GLS-NOMC IN DBC.
           MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN CHP-FLD.
           MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN CHP-FLD.
           MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN CHP-FLD.
           MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN CHP-FLD.
           MOVE DBC-CAI-ICLI IN DBC TO DCC-CAI-ICLI IN CHP-FLD.
           MOVE DBC-IIC-ICLI IN DBC TO DCC-IIC-ICLI IN CHP-FLD.
           MOVE DBC-CAI-ICLI IN DBC TO DCC-CAI-ICLI IN DCC.
           MOVE DBC-IIC-ICLI IN DBC TO DCC-IIC-ICLI IN DCC.
       FIN-PUT-DBC.
           EXIT.

       CLR-CHP SECTION.
       INI-CLR-CHP.
           MOVE SPACES TO CHP-COD-TDOC IN CHP.
           MOVE SPACES TO FRM-GLS-TDOC IN CHP-FLD.
           MOVE SPACES TO CHP-FEC-FCHP IN CHP.
           MOVE SPACES TO CHP-NUM-ICHP IN CHP.
           MOVE SPACES TO FRM-GLS-MOTP IN CHP-FLD.
           MOVE SPACES TO FRM-GLS-VCOP IN CHP-FLD.
           MOVE SPACES TO OPE-COD-OFOP IN OPE.
           MOVE SPACES TO FRM-GLS-OFOP IN CHP-FLD.
           MOVE SPACES TO CHP-CIC-ICCT IN CHP.
           MOVE ZEROES TO CHP-VAL-CHEQ IN CHP.
           MOVE SPACES TO CHP-COD-MOTP IN CHP.
           MOVE SPACES TO CHP-FEC-FACL IN CHP.
           MOVE ZEROES TO CHP-NUM-BOLE IN CHP.
           MOVE ZEROES TO CHP-NUM-PAGE IN CHP.
           MOVE ZEROES TO CHP-NUM-NOMI IN CHP.
       FIN-CLR-CHP.
           EXIT.

       CLR-DCC SECTION.
       INI-CLR-DCC.
           MOVE ZEROES TO DCC-NUM-TCHP IN DCC.
           MOVE ZEROES TO DCC-NUM-TCHA IN DCC.
      *DAD
           MOVE ZEROES TO DCC-NUM-TCHP IN CHP-FLD.
           MOVE ZEROES TO DCC-NUM-TCHA IN CHP-FLD.
      *
       FIN-CLR-DCC.
           EXIT.

       COPY SGCBFDBC.
       COPY SGCBFRCO.
       COPY SGCBFOPE.
       COPY SGCBFDCC.
       COPY SGCBGCLI.
       COPY GNSBGSTR.
       COPY GNSBGCPT.
      *>>>>
*% END
