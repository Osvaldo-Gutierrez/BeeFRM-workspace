       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      DAPPLRD3.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    17-Jan-96 12:25 PM.

      * Programa Listador de Reporte RD3 sin Sort.

      *<<<< CMT_ID
      *>>>>


       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT RPTRD3       ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTRD3       ASSIGN TO        UT-S-RPTRD3.
           SELECT RPTRD3       ASSIGN TO        UT-S-RPTRD3.
      *<<<< IOS
           SELECT DAPDOPD    ASSIGN UT-S-DAPDOPD.
      *>>>>


       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       FD  RPTRD3 LABEL RECORDS OMITTED
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-RD3     PIC X(132).
      *<<<< FD_RPT
      *>>>>

      *<<<< FLS
       FD  DAPDOPD
           RECORDING MODE IS F
           LABEL RECORD STANDARD
           BLOCK CONTAINS    0 RECORDS.
       01  REG-DAPDOPD.
           03 REG-OPD PIC X(351).
           03 REG-VEN PIC X(119).
      *     COPYDD DAP-R-OPD.DAP-E-OPD00(PROD),02,D
      *     COPYDD DAP-R-VEN.DAP-E-VEN00(PROD),02,D
      *>>>>


       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY DAPBROPD.
       COPY DAPRRRD3.
      *<<<< RR
      *>>>>

       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSWGGRC.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY DAPRWRD3.
      *<<<< RW
      *>>>>

       COPY DAPRNRD3.
      *<<<< RN
      *>>>>

       COPY DAPRORD3.
      *<<<< RO
      *>>>>

       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS

        COPY GNSWGPES REPLACING ==ADR-REQA== BY ==ADR-PDB-REQA==.
        COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
        COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
        COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
        COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.

        COPY DAPBRVEN.
        COPY TABBROFI.
        COPY TABBRCAM.
        COPY TABBRCOM.
        COPY GNSWGFEC.
        COPY GNSWGHOY.

       01  F-FILE-STATUS.
           05 FS-DAPDOPD                 PIC 9(01) VALUE 0.
       01  WSS-VARI.
           03   CNT-DAPDOPD-L                PIC 9(08) VALUE 0.
           03   WSS-SGV-0998 VALUE ZEROES    PIC S9(11)V9999.
           03   WSS-SGV-1013 VALUE ZEROES    PIC S9(11)V9999.
           03   WSS-SGV-0013 VALUE ZEROES    PIC S9(11)V9999.
           03   WSS-COD-0999                 PIC X(06).
           03   WSS-COD-0998                 PIC X(06).
           03   WSS-COD-0013                 PIC X(06).                
           03   WSS-COD-1013.                
                05   WSS-COD-1013-CVAL       PIC X(04).
                05   WSS-COD-1013-TVAL       PIC X(02).
           03   WSS-NUM-PLZO                 PIC 9(05).
           03   WSS-RSI-CON   VALUE ZEROES   PIC 9(05).
           03   WSS-VAL-PESOS VALUE ZEROES   PIC 9(11).
           03   WSS-ACU       VALUE ZEROES   PIC 9(11).
           03   WSS-SEM-MIN   VALUE ZEROES   PIC 9(03).
           03   WSS-LINEA                    PIC 9(03).
           03   WSS-SEM-REG                  PIC X(02).
           03   WSS-SEM-FEC                  PIC X(02).
           03   RSI-INTB      VALUE ZEROES   PIC 9(05).
           03   RSI-DAUX      VALUE ZEROES   PIC 9(05).
           03   RSI-IAUX      VALUE ZEROES   PIC 9(05).
           03   RSI-IDX       VALUE ZEROES   PIC 9(02).
           03   WSS-VAL-PASO  VALUE ZEROES   PIC S9(11)V9(04).
           03   WSS-TAS-EFEC                 PIC S9(03)V9(04).
           03   WSS-VAL-OPER                 PIC 9(11)V9999.
           03   WSS-VAL-EXPO                 PIC 9(03)V9(11).
           03   WSS-VAL-HELP                 PIC 9(03)V9(11).
           03   WSS-30        VALUE 30       PIC 9(02).
           03 WSS-FEC-FSUP.
              05 WSS-NUM-SSUP                PIC 9(02).
              05 WSS-NUM-ASUP                PIC 9(02).
              05 WSS-NUM-MSUP                PIC 9(02).
              05 WSS-NUM-DSUP                PIC 9(02).
           03 WSS-FEC-DOWN.
              05 WSS-NUM-SDOW                PIC 9(02).
              05 WSS-NUM-ADOW                PIC 9(02).
              05 WSS-NUM-MDOW                PIC 9(02).
              05 WSS-NUM-DDOW                PIC 9(02).
           03 WSS-FEC-FINF.
              05 WSS-NUM-DINF                PIC 9(02).
              05 WSS-NUM-MINF                PIC 9(02).
              05 WSS-NUM-SINF                PIC 9(02).
              05 WSS-NUM-AINF                PIC 9(02).
           03 WSS-FEC-HOY.
              05 WSS-DHOY-INF                PIC 9(02).
              05 WSS-MHOY-INF                PIC 9(02).
              05 WSS-AHOY-INF                PIC 9(02).
              05 WSS-SHOY-INF                PIC 9(02).
           03 WSS-FEC-FIN1.
              05 WSS-NUM-SIN1                PIC 9(02).
              05 WSS-NUM-AIN1                PIC 9(02).
              05 WSS-NUM-MIN1                PIC 9(02).
              05 WSS-NUM-DIN1                PIC 9(02).

      * Estrucura contiene monto,tas max, tas min, tas prom,
      * acumulacion,  por tipo de operacion
      *     03  RSI-ARR-REP OCCURS 28 TIMES INDEXED BY RSI-INTB.
           03  RSI-ARR-REP OCCURS 28 TIMES.
               05  RSI-EST.
                   07  RSI-MTO                   PIC 9(11).
                   07  RSI-MAX                   PIC S9(03)V9(04).
                   07  RSI-MIN                   PIC S9(03)V9(04).
                   07  RSI-PRO                   PIC S9(03)V9(04).
                   07  RSI-ACM                   PIC 9(11).
                   07  RSI-NOM                   PIC X(32).
                   07  RSI-COR                   PIC 9(02).

      * Estructura contiene de acuerdo a la clase, moneda ,plazo
      * de una operacion la linea a la cual se debe incorporar
      * la informacion del DAP
           03  RSI-OPE-UBI OCCURS 100 TIMES INDEXED BY RSI-BUSC.
               05  RSI-OPE.
                   07  RSI-IDT.
                       09  RSI-MND                   PIC X(06).
                       09  RSI-TIO                   PIC X(03).
                       09  RSI-AUX                   PIC X(03).
                   07  RSI-FEC                       PIC 9(05).
               05  RSI-DAT.
                   07  RSI-UBI                       PIC 9(03).

           03  RSI-LIN-OPE.
               05  RSI-LIN OCCURS 12 TIMES INDEXED BY RSI-BUS.
                   07  RSI-PZO                   PIC 9(05).
                   07  RSI-PZO-X REDEFINES RSI-PZO  PIC X(05).
                   07  RSI-LNA                   PIC 9(03).
                   07  RSI-LNA-X REDEFINES RSI-LNA  PIC X(03).
               05  RSI-RSTO                      PIC X(04).

            03  RSI-AUX-OPE.
                05  RSI-AUX-MND                   PIC X(06).
                05  RSI-AUX-TIO                   PIC X(03).
                05  RSI-AUX-AUX                   PIC X(03).


      * Estructura que contendra las oficinas que pertenecen
      * a la region metropolitana
           03  RSI-ARR-OFI OCCURS 80 TIMES INDEXED BY RSI-SGTE.
               05  RSI-OFI.
                   07  RSI-COD-OFI               PIC X(03).

       01  WSS-TABB.
           03  WSS-TAB1                          PIC X(40).
           03  WSS-TAB2                          PIC X(60).

       01  WSS-VAL-EDIT                      PIC ZZ.ZZZ.ZZZ.ZZ9,9999.
       01  WSS-VAL-EDIT-MTO                  PIC    ZZZ.ZZZ.ZZ9.
       01  WSS-VAL-EDIT-MAX                  PIC            ZZ9,9999.
       01  WSS-VAL-EDIT-MIN                  PIC            ZZ9,9999.
       01  WSS-VAL-EDIT-PRO                  PIC            ZZ9,9999.
       01  WSS-VAL-EDIT-ACM                  PIC    ZZZ.ZZZ.ZZ9.
      *>>>>

      *<<<< WSS_DTC
      *>>>>


      * AQUI EXISTIA LABEL RF INI
      *<<<< RF
      *>>>>

      * AQUI EXISTIA LABEL RF FIN
       COPY DAPRTRD3.
      *<<<< RT
      *>>>>


       PROCEDURE DIVISION.
      *==================

      * AQUI EXISTIA LABEL FIN_DEC INI
      *<<<< FIN_DEC
      *>>>>

      * AQUI EXISTIA LABEL FIN_DEC FIN

       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'DAP' TO RPT-SIST.
           MOVE 'DAPPLRD3' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *<<<< INI
      *ISP
           GO TO INI-OUT-SRT.
      *>>>>

       INI-INP-SRT.
      *<<<< INI_INP
      *>>>>

      *     MOVE 'DAPPLRD3' TO RPT-NPGM.
           CALL 'GNSPLHDR' USING RPT-VARI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
       FST-INP-SRT.
      *<<<< INI_FST_INP
      *>>>>

           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
       COPY DAPRMRD3.
      *<<<< RM
      *>>>>
      *<<<< RM
      *>>>>

      *<<<< FIN_FST_INP
      *>>>>

       INI-OUT-SRT.
      *<<<< INI_OUT
       PERFORM DATOS-REPORTE.
      *>>>>

           OPEN OUTPUT RPTRD3.
           PERFORM INITIATE-RPTRD3.
           MOVE SRT TO SRT-OLD-RD3.
           MOVE SRT TO SRT-CUR-RD3.
      *<<<< FST_OUT
       MOVE 1 TO RSI-IDX.
      *>>>>

           PERFORM RD3-FST-PRO-CTL.
       LUP-MAIN.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
      *<<<< LUP_INP
      *>>>>

       MOV-INP-SRT.
       COPY DAPRMRD3.
      *<<<< RM
      *>>>>
      *<<<< RM
      *>>>>

       LUP-OUT-SRT.
      *<<<< LUP_OUT
       GO TO LEV-PRO-DL.
      *>>>>

           PERFORM RD3-CLR-VAR-CTL.
           PERFORM RD3-CHK-VAR-CTL.
           MOVE SRT TO SRT-CUR-RD3.
           MOVE SRT-OLD-RD3 TO SRT.
           PERFORM RD3-PRO-VAR-CTL-CF.
           MOVE SRT-CUR-RD3 TO SRT.
           PERFORM RD3-PRO-VAR-CTL-CH.
           PERFORM PRO-DL-RD3.
      *<<<< FIN_GEN_OUT
       LEV-PRO-DL.
           IF RSI-IDX = 29
           GO TO  FIN-MAIN
           ELSE
           PERFORM MUEVE-DATOS
           PERFORM PRO-DL-RD3.
           GO TO LUP-MAIN.
      *>>>>

       NXT-INP-SRT.
       NXT-OUT-SRT.
           MOVE SRT TO SRT-OLD-RD3.
      *<<<< INI_NXT_INP
      *>>>>

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
      *<<<< FIN_NXT_INP
      *>>>>

           GO TO LUP-MAIN.
       FIN-MAIN.
       FIN-INP-SRT.
      *<<<< FIN_INP
      *>>>>

           MOVE FIO-CLO TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
       FIN-OUT-SRT.
      *<<<< FIN_OUT
      *>>>>

           PERFORM TERMINATE-RPTRD3.
      *<<<< FIN_TMT
      *>>>>

           CLOSE RPTRD3.
      *<<<< FIN
      *>>>>

           IF PGM-STAT-SRT-MAL
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       COPY DAPBFOPD.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY DAPRERD3.
      *    17-NOV-95 10:49 AM     ,PAI= ,CLI= ,SOP=MVS
       D-PH-RD3 SECTION.
       INI-PH-RD3.
      *<<<< PH_RD3
      *>>>>

       FIN-PH-RD3.
           EXIT.
       D-DL-LIN SECTION.
       INI-DL-LIN.
      *<<<< DL_LIN
      *>>>>

       FIN-DL-LIN.
           EXIT.
       D-DL-RD3 SECTION.
       INI-DL-RD3.
      *<<<< DL_RD3
      *>>>>

       FIN-DL-RD3.
           EXIT.
       D-PF-RD3 SECTION.
       INI-PF-RD3.
      *<<<< PF_RD3
      *>>>>

       FIN-PF-RD3.
           EXIT.
       COPY GNSBGABT.

      *<<<< EOF
       DATOS-REPORTE SECTION.
       INI-DATOS-REPORTE.
           MOVE 1 TO RSI-INTB.
       CIC-INI-VAR.
      *    DISPLAY ' INICIALIZANDO VAR 1 ' RSI-INTB.
           MOVE ZEROES TO RSI-MTO(RSI-INTB).
           MOVE ZEROES TO RSI-MAX(RSI-INTB).
           MOVE ZEROES TO RSI-MIN(RSI-INTB).
           MOVE ZEROES TO RSI-PRO(RSI-INTB).
           MOVE ZEROES TO RSI-ACM(RSI-INTB).
           ADD 1 TO RSI-INTB.
           IF RSI-INTB < 29
              GO TO CIC-INI-VAR.
           PERFORM MUEVE-NOMBRES.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO WSS-DHOY-INF IN WSS-RD3.
           MOVE HOY-MHOY IN HOY-VARI TO WSS-MHOY-INF IN WSS-RD3.
           MOVE HOY-AHOY IN HOY-VARI TO WSS-AHOY-INF IN WSS-RD3.
           MOVE 1 TO RSI-INTB.
           SET RSI-BUSC TO RSI-INTB.
       CIC-INI-UBI.
      *    DISPLAY ' INICIALIZANDO VAR 2 '  RSI-INTB.
           MOVE ZEROES TO RSI-UBI(RSI-BUSC).
           ADD  1 TO RSI-INTB.
           SET RSI-BUSC TO RSI-INTB.
           IF RSI-INTB < 101
              GO TO CIC-INI-UBI.
           DISPLAY ' INICIO DE CAPTURA DE PARAMETROS '.
      * Captura de fecha de proceso
           DISPLAY 'INGRESE FECHA DE PROCESO DEL INFORME (DDMMSSAA) '.
           ACCEPT  WSS-FEC-FINF IN WSS-VARI.
           DISPLAY ' FECHA DE PROCESO  ' WSS-FEC-FINF IN WSS-VARI.
           DISPLAY ' TERMINO DE CAPTURA DE PARAMETROS '.
           MOVE WSS-NUM-DINF IN WSS-VARI TO WSS-NUM-DIN1 IN WSS-VARI.
           MOVE WSS-NUM-MINF IN WSS-VARI TO WSS-NUM-MIN1 IN WSS-VARI.
           MOVE WSS-NUM-SINF IN WSS-VARI TO WSS-NUM-SIN1 IN WSS-VARI.
           MOVE WSS-NUM-AINF IN WSS-VARI TO WSS-NUM-AIN1 IN WSS-VARI.

           MOVE WSS-NUM-DINF IN WSS-VARI TO WSS-NUM-DINF IN WSS-RD3.
           MOVE WSS-NUM-MINF IN WSS-VARI TO WSS-NUM-MINF IN WSS-RD3.
           MOVE WSS-NUM-AINF IN WSS-VARI TO WSS-NUM-AINF IN WSS-RD3.


      * Si la fecha de proceso es posterior a un feriado, se calcula
      * un rango de dias de proceso, de forma de incluir los feriados
      * anteriores al dia de proceso.

      * Validacion de fecha de proceso
           MOVE WSS-FEC-FINF TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-HBL
              DISPLAY 'FECHA DE PARAMETRO NO HABIL : FIN DE PROCESO'
              PERFORM GNS-PRO-ABT.

           MOVE WSS-FEC-FIN1 TO WSS-FEC-DOWN.
           MOVE WSS-FEC-FIN1 TO WSS-FEC-FSUP.
      * BUSCAR DIAS HABILES
           MOVE WSS-FEC-FINF TO FEC-FECH.
        BUS-PDH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-RST-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
           PERFORM CAL-FEC.
      * VAL-FEC Validar Fecha
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-HBL
               MOVE FEC-ITM1 TO WSS-NUM-DDOW
               MOVE FEC-ITM2 TO WSS-NUM-MDOW
               MOVE FEC-ITM3 TO WSS-NUM-SDOW
               MOVE FEC-ITM4 TO WSS-NUM-ADOW
               GO TO BUS-PDH.


      * Obtiene el codigo del valor de cambio de pesos mediante el CIC
           MOVE 'TAB'                TO FIO-SIST.
           MOVE 'VLR'                TO TAB-CIC-TTAB IN TAB
      *     MOVE '0999'              TO TAB-CIC-CTAB IN TAB
           MOVE PDB-CIC-0999         TO TAB-CIC-CTAB IN TAB
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              MOVE 'TAB'          TO MSG-COD-SIST
              MOVE 'CIC0999  NEX' TO MSG-COD-MENS
              PERFORM GET-MSG
      *        DISPLAY MSG-GLS-DESC  TAB-CIC-CTAB IN TAB
              PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-0999 IN WSS-VARI.
      *     DISPLAY ' CODIGO PESOS  ' WSS-COD-0999 IN WSS-VARI.

      * Obtiene el codigo del valor de la U.F. mediante el CIC
           MOVE 'TAB'                TO FIO-SIST.
           MOVE 'VLR'                TO TAB-CIC-TTAB IN TAB
           MOVE PDB-CIC-0998         TO TAB-CIC-CTAB IN TAB
      *     MOVE '0998'         TO TAB-CIC-CTAB IN TAB
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              MOVE 'TAB'          TO MSG-COD-SIST
              MOVE 'CIC0998  NEX' TO MSG-COD-MENS
              PERFORM GET-MSG
      *        DISPLAY MSG-GLS-DESC  TAB-CIC-CTAB IN TAB
              PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-0998 IN WSS-VARI.
      *     DISPLAY ' CODIGO U.F.  ' WSS-COD-0998 IN WSS-VARI.

      * Obtiene el codigo del valor US$ mediante el CIC
           MOVE 'TAB'                TO FIO-SIST.
           MOVE 'VLR'                TO TAB-CIC-TTAB IN TAB
           MOVE PDB-CIC-1013         TO TAB-CIC-CTAB IN TAB
      *     MOVE '101301'         TO TAB-CIC-CTAB IN TAB
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              MOVE 'TAB'          TO MSG-COD-SIST
              MOVE 'CIC1013  NEX' TO MSG-COD-MENS
              PERFORM GET-MSG
      *        DISPLAY MSG-GLS-DESC  TAB-CIC-CTAB IN TAB
              PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-1013-CVAL.
           MOVE PDB-COD-TVAL-DOLO   TO WSS-COD-1013-TVAL.
      *     DISPLAY ' CODIGO DOLAR  ' WSS-COD-1013 IN WSS-VARI.



      * Obtiene el codigo pesos segùn reajustabilidad
      * Valor US$ mediante el CIC
           MOVE 'TAB'                TO FIO-SIST.
           MOVE 'VLR'                TO TAB-CIC-TTAB IN TAB
           MOVE PDB-CIC-0013         TO TAB-CIC-CTAB IN TAB
      *     MOVE '101301'         TO TAB-CIC-CTAB IN TAB
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              MOVE 'TAB'          TO MSG-COD-SIST
              MOVE 'CIC0013  NEX' TO MSG-COD-MENS
              PERFORM GET-MSG
      *        DISPLAY MSG-GLS-DESC  TAB-CIC-CTAB IN TAB
              PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-0013 IN WSS-VARI.
      *     DISPLAY ' CODIGO DOLAR  ' WSS-COD-0013 IN WSS-VARI.



      * Obtiene valor de cambio en pesos para la UF a fecha del informe
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).
           MOVE WSS-COD-0998 IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-0999 IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               DISPLAY ' NO EXISTE VALOR DE CAMBIO A FECHA INFORME :'
                         CAM-KEY-CAMB       ' PARA LA U.F.'
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
                DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA INFORME :'
                          CAM-KEY-CAMB  ' PARA LA U.F.'
                PERFORM GNS-PRO-ABT
           ELSE
                MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-EDIT
      *          DISPLAY ' VALOR DE LA U.F.  ' WSS-VAL-EDIT
                MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-0998 IN WSS-VARI.

      * Obtiene valor de cambio en pesos para EL US$ a fecha del informe
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).
           MOVE WSS-COD-1013 IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-0999 IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               DISPLAY ' NO EXISTE VALOR DE CAMBIO A FECHA INFORME :'
                         CAM-KEY-CAMB       ' PARA US$ 1013 '
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
                DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA INFORME :'
                           CAM-KEY-CAMB  ' PARA EL US$ 1013 '
                PERFORM GNS-PRO-ABT
           ELSE
                MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-EDIT
      *          DISPLAY ' VALOR DEL DOLAR 1013 ' WSS-VAL-EDIT
                MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-1013 IN WSS-VARI.

      * Obtiene valor de cambio en pesos para EL US$ a fecha del informe
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).
           MOVE WSS-COD-0013 IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-0999 IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               DISPLAY ' NO EXISTE VALOR DE CAMBIO A FECHA INFORME :'
                         CAM-KEY-CAMB       ' PARA US$'
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
                DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA INFORME :'
                           CAM-KEY-CAMB  ' PARA EL US$ 0013  '
                PERFORM GNS-PRO-ABT
           ELSE
                MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-EDIT
      *          DISPLAY ' VALOR DEL DOLAR 0013 ' WSS-VAL-EDIT
                MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-0013 IN WSS-VARI.


      * Llenado de estructura en memoria, la cual contiene
      * todas las oficinas que pertnecen a la R.M

      *    DISPLAY ' INICIO CARGA OFICINA PERTENECIENTES A LA R.M. '.
           MOVE FIO-GET-FST TO FIO-CMND.
       SEC-LEC-OFI.
           PERFORM TAB-FIO-OFI.
           IF FIO-STAT-OKS
              MOVE 'TAB'               TO FIO-SIST
              MOVE 'COM'               TO TAB-COD-TTAB
              MOVE OFI-COD-COMU IN OFI TO TAB-COD-CTAB
              MOVE FIO-GET-KEY         TO FIO-CMND
              PERFORM GNS-FIO-TAB
              MOVE TAB TO COM
              IF ( FIO-STAT-OKS AND  COM-COD-REGI = '13')
      *             DISPLAY   ' OFICINA PERTENECE ' OFI-COD-OFIC
                    ADD 1 TO RSI-IDX
      *             DISPLAY  ' UBICACION CORRELATIVO OFICINA ' RSI-IDX
                    MOVE  OFI-COD-OFIC TO  RSI-COD-OFI(RSI-IDX)
                    MOVE FIO-GET-NXT TO FIO-CMND
                    GO TO SEC-LEC-OFI
              ELSE
      *             DISPLAY ' NO EXISTE COMUNA DEFINIDA '
                    MOVE FIO-GET-NXT TO FIO-CMND
                    GO TO SEC-LEC-OFI.
      * Llenado de estructura que contiene la informacion
      * necesaria  para identificar el tramo y linea al cual
      * corresponde la operacion leida

      *    DISPLAY  ' INICIO CARGA TABLA RD3 '.
           MOVE 'DAP'          TO FIO-SIST.
           MOVE 'RD3'          TO TAB-COD-TTAB.
           MOVE SPACES         TO TAB-COD-CTAB.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           MOVE ZEROES         TO WSS-RSI-CON.
       CIC-CRG-RD3.
           PERFORM GNS-FIO-TAB.
           IF TAB-COD-CTAB IN TAB = SPACES
              MOVE FIO-GET-NXT TO FIO-CMND
              PERFORM GNS-FIO-TAB.
           IF ( FIO-STAT-OKS AND TAB-COD-TTAB IN TAB = 'RD3' )
      *        DISPLAY 'TAB-RD3 ' TAB-COD-CTAB IN TAB
               MOVE TAB-GLS-DESC TO WSS-TAB1
               MOVE TAB-GLS-DATA TO WSS-TAB2
               MOVE  WSS-TABB    TO  RSI-LIN-OPE
               PERFORM LLENA
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO CIC-CRG-RD3.
      *     ELSE
      *         DISPLAY 'TAB-RD3 FIO-STAT TTAB ' FIO-STAT ' '
      *                 TAB-COD-TTAB.
           PERFORM ABRE-ARCHIVO.
       CICLO-INF.
           PERFORM LEE-ARCHIVO.
           IF FS-DAPDOPD = 1
               GO TO EXT-MAIN.
           PERFORM  BUSCA-OFI.
           PERFORM  VALIDACION-FEC.
           IF  WSS-SEM-REG = 1 AND WSS-SEM-FEC = 1 
               AND OPD-COD-STAT = 'G'
      *         DISPLAY 'OPERACION CON OFICINA EN RM'
                MOVE 0 TO WSS-SEM-REG
                PERFORM CALCULO-FEC
                MOVE OPD-COD-VCAM TO RSI-AUX-MND
                MOVE OPD-COD-TOPD TO RSI-AUX-TIO
                MOVE OPD-COD-AOPD TO RSI-AUX-AUX
                PERFORM BUSCA-LINEA
                IF WSS-LINEA NOT = ZEROES
                    PERFORM LLENA-MATR.
           GO TO CICLO-INF.
       EXT-MAIN.

           PERFORM CIERRA-ARCHIVO.
           PERFORM CALCULAR-PROM.
       FIN-DATOS-REPORTE.
           EXIT.

      * LLENA ESTRUCTURA CON DATOS QUE PERMITEN A TRAVES DE
      * EL TIPO DE OPERACION DEFINIR SU UBICACION EN EL D3

       LLENA SECTION.
       INI-LLENA.
           MOVE   1     TO RSI-IDX.
      *    DISPLAY 'LLENA MATRIZ RSI-LIN-OPE ' RSI-LIN-OPE.
       CIC-LUP.
           IF RSI-PZO-X(RSI-IDX) NOT = SPACES
               ADD  1  TO WSS-RSI-CON
               MOVE TAB-COD-CTAB     TO RSI-IDT(WSS-RSI-CON)
               MOVE RSI-PZO(RSI-IDX) TO RSI-FEC(WSS-RSI-CON)
               MOVE RSI-LNA(RSI-IDX) TO RSI-UBI(WSS-RSI-CON)
      *        DISPLAY  ' PARA PRODUCTO  ' TAB-COD-CTAB
      *        DISPLAY  ' PLAZO  =  '  RSI-PZO(RSI-IDX)
      *        DISPLAY  ' LINEA  =  '  RSI-LNA(RSI-IDX)
               ADD  1  TO RSI-IDX
               GO TO CIC-LUP.
       FIN-LLENA.
           EXIT.

      * Dada una oficina perteneciente a una operacion, se determina
      * si esta oficina pertenece o no a la R.M.

       BUSCA-OFI SECTION.
       INI-BUSCA-OFI.
           MOVE    1    TO   RSI-IAUX.
           SET RSI-SGTE TO 1.
           SEARCH  RSI-ARR-OFI VARYING RSI-IAUX
             AT END
      *        DISPLAY 'OFICINA NO PERTENECE A LA REGION METROPOLITANA'
               GO TO FIN-BUSCA-OFI
           WHEN  RSI-COD-OFI(RSI-SGTE) = OPD-COD-OFIC
      *    DISPLAY  ' OFICINA ENCONTRADA  ' OPD-COD-OFIC
           MOVE 1 TO WSS-SEM-REG.
       FIN-BUSCA-OFI.
           EXIT.


      * Dados la moneda, tio, aux , plazo, de una operacion
      * se identifica linea  y tramo del reporte a la que corresponde

       BUSCA-LINEA SECTION.
       INI-BUSCA-LINEA.
      *    DISPLAY ' BUSCANDO LINEA '.
           MOVE ZEROES  TO   WSS-LINEA.
           MOVE    1    TO   RSI-IAUX.
           SET RSI-BUSC TO 1.
           SEARCH  RSI-OPE-UBI VARYING RSI-IAUX
             AT END
      *        DISPLAY 'NO EXISTE LINEA ASOCIADA A LA OPERACION'
               GO TO FIN-BUSCA-LINEA
           WHEN  ( RSI-IDT(RSI-BUSC) = RSI-AUX-OPE IN WSS-VARI AND
                   WSS-NUM-PLZO < RSI-FEC(RSI-BUSC) )
           MOVE  RSI-UBI(RSI-BUSC) TO WSS-LINEA.
      *    DISPLAY  '  PARA CODIGO  ' RSI-AUX-OPE IN WSS-VARI
      *    DISPLAY  '  PLAZO        '  WSS-NUM-PLZO
      *    DISPLAY  ' LE CORRESPONDE LA UBICACION ' WSS-LINEA.
      *     GO TO FIN-BUSCA-LINEA.
       FIN-BUSCA-LINEA.
           EXIT.


      * Procesa informacion necesaria para generar reporte y
      * la ingresa a la estructura definida para este fin
      * (RSI-ARR-REP)

       LLENA-MATR SECTION.
       INI-LLENA-MATR.
      *     DISPLAY '  '.
      *     DISPLAY '  '.
      *     DISPLAY '    *********  LLENA MATRIZ'.
           MOVE WSS-LINEA IN WSS-VARI TO RSI-INTB.
           MOVE WSS-LINEA TO WSS-VAL-EDIT.
      *     DISPLAY  RSI-INTB.
      *      IF OPD-SGV-TINT > 0 AND RSI-AUX-MND = '0999'
      *          PERFORM TRAN-TAS
      *      ELSE
               MOVE OPD-SGV-TINT TO WSS-TAS-EFEC.
           IF  RSI-MIN(RSI-INTB) > WSS-TAS-EFEC  OR
               RSI-MIN(RSI-INTB) = ZEROES
                MOVE  WSS-TAS-EFEC IN WSS-VARI TO RSI-MIN(RSI-INTB).
      *          DISPLAY ' CORRESPONDE A MINIMO PARCIAL <<<<<< '.
           IF  RSI-MAX(RSI-INTB) <  WSS-TAS-EFEC  
      *          DISPLAY ' CORRESPONDE A MAXIMO PARCIAL >>>>>>>>  '
                MOVE WSS-TAS-EFEC  IN WSS-VARI TO RSI-MAX(RSI-INTB).
           IF OPD-COD-VCAM IN OPD = WSS-COD-0998
              PERFORM CAMBIO-UF-PES.
           IF OPD-COD-VCAM IN OPD = WSS-COD-1013-CVAL
               PERFORM CAMBIO-DOL-PES.
           IF OPD-COD-VCAM IN OPD = WSS-COD-0013
               PERFORM CAMBIO-DOL-REA-PES.
           IF OPD-COD-VCAM IN OPD = WSS-COD-0999
               MOVE OPD-VAL-CAPT IN OPD TO WSS-VAL-PESOS.
           ADD WSS-VAL-PESOS TO RSI-MTO(RSI-INTB).
           MULTIPLY  WSS-VAL-PESOS BY WSS-TAS-EFEC
           GIVING WSS-ACU IN WSS-VARI.
           ADD WSS-ACU IN WSS-VARI TO RSI-ACM(RSI-INTB).
      *     DISPLAY ' OPD  ' OPD-CIC-IOPD  '  ' RSI-AUX-OPE.
           MOVE OPD-SGV-TINT TO WSS-VAL-EDIT-MIN.
      *     DISPLAY  '         CON UNA TASA DE  'WSS-VAL-EDIT-MIN.
           MOVE OPD-VAL-CAPT TO WSS-VAL-EDIT-PRO.
      *     DISPLAY  '             MONTO =   ' WSS-VAL-EDIT-PRO.
           MOVE RSI-MTO(RSI-INTB) TO WSS-VAL-EDIT-MTO.
      *     DISPLAY  '              ACUMULADO LINEA ' WSS-VAL-EDIT-MTO.
           MOVE ZEROES TO WSS-LINEA IN WSS-VARI.
       FIN-LLENA-MATR.
           EXIT.

       CAMBIO-UF-PES SECTION.
       INI-CAMBIO-UF-PES.
           MOVE OPD-VAL-CAPT IN OPD TO WSS-VAL-PASO IN WSS-VARI.
           MULTIPLY WSS-SGV-0998 IN WSS-VARI BY WSS-VAL-PASO IN WSS-VARI
           GIVING WSS-VAL-PESOS IN WSS-VARI ROUNDED.
       FIN-CAMBIO-UF-PES.
           EXIT.

       CAMBIO-DOL-PES SECTION.
       INI-CAMBIO-DOL-PES.
           MOVE OPD-VAL-CAPT IN OPD TO WSS-VAL-PASO IN WSS-VARI.
           MULTIPLY WSS-SGV-1013 IN WSS-VARI BY WSS-VAL-PASO IN WSS-VARI
           GIVING WSS-VAL-PESOS IN WSS-VARI ROUNDED.
       FIN-CAMBIO-DOL-PES.
           EXIT.

       CAMBIO-DOL-REA-PES SECTION.
       INI-CAMBIO-DOL-REA-PES.
           MOVE OPD-VAL-CAPT IN OPD TO WSS-VAL-PASO IN WSS-VARI.
           MULTIPLY WSS-SGV-0013 IN WSS-VARI BY WSS-VAL-PASO IN WSS-VARI
           GIVING WSS-VAL-PESOS IN WSS-VARI ROUNDED.
       FIN-CAMBIO-DOL-REA-PES.
           EXIT.

       ABRE-ARCHIVO SECTION.
       INI-ABRE-ARCHIVO.
           OPEN INPUT DAPDOPD.
       FIN-ABRE-ARCHIVO.
           EXIT.

       CIERRA-ARCHIVO SECTION.
       INI-CIERRA-ARCHIVO.
           CLOSE  DAPDOPD.
       FIN-CIERRA-ARCHIVO.
           EXIT.

       LEE-ARCHIVO SECTION.
       INI-LEE-ARCHIVO.
           READ DAPDOPD AT END MOVE 1 TO FS-DAPDOPD.
           IF FS-DAPDOPD = 0
              MOVE REG-OPD TO OPD
      *       DISPLAY 'OPD : ' OPD-CIC-IOPD IN OPD
              MOVE REG-VEN TO VEN
              ADD 1 TO CNT-DAPDOPD-L.
       FIN-LEE-ARCHIVO.
           EXIT.

       CALCULAR-PROM SECTION.
       INI-CALCULAR-PROM.
           MOVE ZEROES TO WSS-CON-IMP IN WSS-RD3.
           MOVE ZEROES TO RSI-INTB.
      *    DISPLAY ' ENTRE A CALCULAR  '
       ETC-CAL-PRO.
           ADD 1 TO RSI-INTB.
      *    DISPLAY '  PARA LA LINEA  ' RSI-INTB
      *            'EL ACUMULADO '   RSI-ACM(RSI-INTB)
      *            'EL MONTO  '    RSI-MTO(RSI-INTB).
           DIVIDE RSI-MTO(RSI-INTB) BY 1000 GIVING WSS-VAL-OPER ROUNDED.
           ADD WSS-VAL-OPER TO WSS-CON-IMP IN WSS-RD3.
           IF RSI-MTO(RSI-INTB) > ZEROES
              DIVIDE RSI-ACM(RSI-INTB) BY RSI-MTO(RSI-INTB)
              GIVING RSI-PRO(RSI-INTB).
           IF RSI-INTB < 28
              GO TO ETC-CAL-PRO.
       FIN-CALCULAR-PROM.
           EXIT.

       MUEVE-DATOS SECTION.
       INI-MUEVE-DATOS.
           IF  RSI-IDX < 29
               DIVIDE RSI-MTO(RSI-IDX) BY 1000 GIVING
               WSS-MTO-IMP IN SRT ROUNDED
               MOVE RSI-MAX(RSI-IDX) TO WSS-MAX-IMP  IN SRT
               MOVE RSI-MIN(RSI-IDX) TO WSS-MIN-IMP  IN SRT
               MOVE RSI-PRO(RSI-IDX) TO WSS-PRO-IMP  IN SRT
               MOVE RSI-NOM(RSI-IDX) TO WSS-TIOP-IMP IN SRT
               MOVE RSI-COR(RSI-IDX) TO WSS-COR-IMP  IN SRT
      *         DISPLAY 'WSS-TIOP-IMP  ' WSS-TIOP-IMP IN SRT
      *         DISPLAY 'WSS-COR-IMP   ' WSS-COR-IMP  IN SRT
      *         DISPLAY 'LINEA  ' RSI-IDX
      *         DISPLAY 'WSS-MTO-IMP  '  WSS-MTO-IMP   IN SRT
      *         DISPLAY '   '
               ADD  1  TO RSI-IDX.
       FIN-MUEVE-DATOS.
           EXIT.

       MUEVE-NOMBRES SECTION.
       INI-MUEVE-NOMBRES.
           MOVE  1                                TO RSI-COR(1).
           MOVE 'INTERBANCARIA NO REAJ.'          TO RSI-NOM(1).
           MOVE  2                                TO RSI-COR(2).
           MOVE 'INTERBANCARIA REAJ. UF.'         TO RSI-NOM(2).
           MOVE  3                                TO RSI-COR(3).
           MOVE 'INTERBANCARIA REAJ. T. C.'       TO RSI-NOM(3).
           MOVE  4                                TO RSI-COR(4).
           MOVE 'INTERBANCARIA EN US$     '       TO RSI-NOM(4).
           MOVE  5                                TO RSI-COR(5).
           MOVE 'VTA. PAGARES CON PACTO NO REAJ.' TO RSI-NOM(5).
           MOVE  6                                TO RSI-COR(6).
           MOVE 'VTA. PAGARES CON PACTO U.F.'     TO RSI-NOM(6).
           MOVE  7                                TO RSI-COR(7).
           MOVE 'VTA. PAGARES CON PACTO T.C.'     TO RSI-NOM(7).
           MOVE  8                                TO RSI-COR(8).
           MOVE 'VTA. PAGARES CON PACTO US$.'     TO RSI-NOM(8).
           MOVE  12                               TO RSI-COR(9).
           MOVE 'INTERBANCARIA NO REAJ.'          TO RSI-NOM(9).
           MOVE  13                               TO RSI-COR(10).
           MOVE 'INTERBANCARIA REAJ. UF.'         TO RSI-NOM(10).
           MOVE  14                               TO RSI-COR(11).
           MOVE 'INTERBANCARIA REAJ. T.C.'        TO RSI-NOM(11).
           MOVE  15                               TO RSI-COR(12).
           MOVE 'INTERBANCARIA EN US$     '       TO RSI-NOM(12).
           MOVE  16                               TO RSI-COR(13).
           MOVE 'OPERACIONES NO REAJ.'            TO RSI-NOM(13).
           MOVE  17                               TO RSI-COR(14).
           MOVE 'OPERACIONES REAJ. U.F.'          TO RSI-NOM(14).
           MOVE  18                               TO RSI-COR(15).
           MOVE 'OPERACIONES REAJ. T.C.'          TO RSI-NOM(15).
           MOVE  19                               TO RSI-COR(16).
           MOVE 'OPERACIONES EN US$.'             TO RSI-NOM(16).
           MOVE  23                               TO RSI-COR(17).
           MOVE 'OPERACIONES NO REAJ.'            TO RSI-NOM(17).
           MOVE  24                               TO RSI-COR(18).
           MOVE 'OPERACIONES REAJ. U.F.'          TO RSI-NOM(18).
           MOVE  25                               TO RSI-COR(19).
           MOVE 'OPERACIONES REAJ. T.C.'          TO RSI-NOM(19).
           MOVE  26                               TO RSI-COR(20).
           MOVE 'OPERACIONES EN US$.'             TO RSI-NOM(20).
           MOVE  30                               TO RSI-COR(21).
           MOVE 'OPERACIONES NO REAJ.'            TO RSI-NOM(21).
           MOVE  31                               TO RSI-COR(22).
           MOVE 'OPERACIONES REAJ. U.F.'          TO RSI-NOM(22).
           MOVE  32                               TO RSI-COR(23).
           MOVE 'OPERACIONES REAJ. T.C.'          TO RSI-NOM(23).
           MOVE  33                               TO RSI-COR(24).
           MOVE 'OPERACIONES EN US$.'             TO RSI-NOM(24).
           MOVE  37                               TO RSI-COR(25).
           MOVE 'OPERACIONES NO REAJ.'            TO RSI-NOM(25).
           MOVE  38                               TO RSI-COR(26).
           MOVE 'OPERACIONES REAJ. U.F.'          TO RSI-NOM(26).
           MOVE  39                               TO RSI-COR(27).
           MOVE 'OPERACIONES REAJ. T.C.'          TO RSI-NOM(27).
           MOVE  40                               TO RSI-COR(28).
           MOVE 'OPERACIONES EN US$.'             TO RSI-NOM(28).
       FIN-MUEVE-NOMBRES.
           EXIT.


       CALCULO-FEC SECTION.
       INI-CALCULO-FEC.
           MOVE ZEROES TO WSS-NUM-PLZO IN WSS-VARI.
           MOVE OPD-NUM-DREA IN OPD TO FEC-DEC1.
           MOVE OPD-NUM-MREA IN OPD TO FEC-MEC1.
           MOVE OPD-NUM-SREA IN OPD TO FEC-SEC1.
           MOVE OPD-NUM-AREA IN OPD TO FEC-AEC1.
           MOVE VEN-NUM-DVEN IN VEN TO FEC-DEC2.
           MOVE VEN-NUM-MVEN IN VEN TO FEC-MEC2.
           MOVE VEN-NUM-SVEN IN VEN TO FEC-SEC2.
           MOVE VEN-NUM-AVEN IN VEN TO FEC-AEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
      *        DISPLAY 'ERROR EN CAL-FEC ' FEC-MENS
              MOVE ZEROES TO FEC-NDIA.
      *    Plazo en dias
           MOVE FEC-NDIA TO WSS-NUM-PLZO IN WSS-VARI.
      *    DISPLAY ' DIAS ENCONTRADOS  ' FEC-NDIA.
       FIN-CALCULO-FEC.
           EXIT.

       VALIDACION-FEC SECTION.
       INI-VALIDACION-FEC.
           IF WSS-FEC-DOWN NOT > OPD-FEC-FREA 
              AND OPD-FEC-FREA NOT > WSS-FEC-FSUP
              MOVE 1 TO WSS-SEM-FEC
           ELSE
              MOVE ZEROES TO WSS-SEM-FEC.
       FIN-VALIDACION-FEC.
           EXIT.


       TRAN-TAS SECTION.
       INI-TRAN-TAS.
                MOVE ZEROES TO WSS-TAS-EFEC.
                IF WSS-NUM-PLZO NOT > ZEROES
                   GO TO FIN-TRAN-TAS.
                DIVIDE WSS-30 BY WSS-NUM-PLZO GIVING WSS-VAL-EXPO.
                DIVIDE OPD-SGV-TINT BY 100 GIVING WSS-VAL-OPER.
                ADD 1 TO WSS-VAL-OPER.
                COMPUTE WSS-VAL-HELP ROUNDED = 
                WSS-VAL-OPER ** WSS-VAL-EXPO.
                SUBTRACT 1 FROM WSS-VAL-HELP.
                COMPUTE WSS-TAS-EFEC ROUNDED = WSS-VAL-HELP * 100.
      *          MOVE ZEROES TO WSS-TAS-EFEC.
      *          COMPUTE WSS-TAS-EFEC
      *          ROUNDED = (1 + (OPD-SGV-TINT / 100) ) ** 
      *                    (30 / WSS-NUM-PLZO ) 
       FIN-TRAN-TAS.
           EXIT.

       COPY TABBFOFI.
       COPY TABBFCAM.
       COPY TABBFCOM.
       COPY GNSBBMSG.
       COPY GNSBPFEC.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
      *>>>>

