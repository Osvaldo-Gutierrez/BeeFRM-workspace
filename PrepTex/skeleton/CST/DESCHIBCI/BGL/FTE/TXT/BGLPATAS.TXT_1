*%! Codigo adicional para archivo
*% PGM_PTC = TRUE
*% IF PGM_PQ
*% LARGO_TOTAL_COMMAREA = 274
*% ELSE
*% LARGO_TOTAL_COMMAREA = 275
*% END
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
           03 CMA-VARI.
              05 GAR-CAI-GTIA                 PIC X(04).
              05 GAR-IIC-GTIA                 PIC X(08).
      *MHM-INI 29-OCT-2003
              05 CMA-CIC-UING                 PIC X(12).
              05 CMA-IND-LGSO                 PIC X(01).
      *MHM-FIN 29-OCT-2003
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       COPY BGLBRGDG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY BGLBRGVT.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.
       COPY BGLBRTAG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
*% IF PGM_PU 
      *<<<<
       COPY BGLBRGSO.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSO-REQA==.
       COPY BGLBRGSL.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSL-REQA==.
      *>>>>
*% END
       01 WSS-VARI.
*% IF PGM_PU 
      *<<<<
          03 WSS-KEY-MGSO.
             05 WSS-NUM-MGSO                 PIC 9(12).
             05 WSS-CIC-MGSO                 PIC X(12).
          03 WSS-KEY-EGSO.
             05 WSS-NUM-EGSO                 PIC 9(12).
             05 WSS-CIC-EGSO                 PIC X(12).
          03 WSS-NUM-MAUX VALUE ZEROES       PIC 9(12).
          03 WSS-NUM-EAUX VALUE ZEROES       PIC 9(12).
      *>>>>
*% END
          03 WSS-COD-CGTA.
             05 WSS-COD-TOPE    PIC X(03).
             05 WSS-COD-SOPE    PIC X(03).
          03 WSS-IND-OBL1       PIC X(01).
          03 WSS-IND-OBL2       PIC X(01).
          03 WSS-GLS-CGTA.
              05 WSS-GLS-TOPE   PIC X(40).
              05 WSS-GLS-SOPE   PIC X(40).
          03 WSS-IND-EGVT       PIC X(01).
       COPY GNSWGCPT.
      *>>>>
*% END
*% IF PFS_SCR_ACC
      *<<<< PFS_SCR_ACC
           IF FRM-FFLD = FRM-FFLD-PF5
               PERFORM VAL-NUM-KEY-TAS
               PERFORM VAL-NUM-FLD-TAS
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM GNS-CLR-RQA
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-ACC.
           PERFORM GNS-CLR-RQA.
      *>>>>
*% END
*% IF PFS_SCR_ELI
      *<<<< PFS_SCR_ELI
           IF FRM-FFLD = FRM-FFLD-PF5
               PERFORM VAL-NUM-KEY-TAS
               PERFORM VAL-NUM-FLD-TAS
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM GNS-CLR-RQA
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-ELI.
           PERFORM GNS-CLR-RQA.
      *>>>>
*% END
*% IF PFS_SCR_ACT
      *<<<< PFS_SCR_ACT
           IF ( FRM-FFLD = FRM-FFLD-PF5 ) AND
              SCR-STAT = SCR-STAT-CON
               PERFORM VAL-NUM-KEY-TAS
               PERFORM VAL-NUM-FLD-TAS.
           IF FRM-FFLD = FRM-FFLD-PF5
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM GNS-CLR-RQA
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-ACT.
           PERFORM GNS-CLR-RQA.
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
       BUS-GDG.
           MOVE TAS-CAI-GTIA IN TAS-FLD TO GDG-CAI-GTIA IN GDG.
           MOVE TAS-IIC-GTIA IN TAS-FLD TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           MOVE FIO-STAT TO PGM-STAT-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG    NEX' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
       FIN-BUS-GDG.
           MOVE GDG-TIP-CGTA IN GDG TO GDG-TIP-CGTA IN TAS-FLD.
           MOVE GDG-STP-CGTA IN GDG TO GDG-STP-CGTA IN TAS-FLD.
           MOVE GDG-TIP-CGTA IN TAS-FLD TO TAG-TIP-AGTA IN TAG.
           MOVE GDG-STP-CGTA IN TAS-FLD TO TAG-STP-AGTA IN TAG.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM BGL-FIO-TAG.
           IF NOT FIO-STAT-OKS
                MOVE 'TAG    NEX' TO MSG-COD-MENS
                MOVE 'BGL' TO MSG-COD-SIST
                PERFORM GET-MSG
           ELSE
                MOVE SPACES TO MSG-COD-MENS
                MOVE 'BGL' TO TAB-COD-SIST
                MOVE 'RAL' TO TAB-COD-TTAB IN TAB
                MOVE TAG-IND-TREA IN TAG TO TAB-COD-CTAB IN TAB
                PERFORM BUS-TAB
                IF MSG-COD-MENS = SPACES
                    MOVE TAB-GLS-DESC IN TAB TO
                         FRM-GLS-TREA IN TAS-FLD
                ELSE
                    MOVE SPACES TO FRM-GLS-TREA IN TAS-FLD.
      
           MOVE GDG-CAI-GTIA IN GDG TO GAR-CAI-GTIA IN CMA-VARI.
           MOVE GDG-IIC-GTIA IN GDG TO GAR-IIC-GTIA IN CMA-VARI.
      
           PERFORM LEE-GVT.
           IF WSS-IND-EGVT IN WSS-VARI > SPACES
               MOVE 'GVT    NEX' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
      
           IF SCR-CMND = 'ING'
               PERFORM PUT-GDG-TAS.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      * Comando Consulta Error lo trata el GENESIS
           IF SCR-CMND NOT = 'ING'
              GO TO CNT-FND-GDG.
      
           IF SCR-CMND = 'ING' AND
              (TAS-IND-ESTA IN TAS = '11' OR
               TAS-IND-ESTA IN TAS = '12' OR
               TAS-IND-ESTA IN TAS = '14')
               MOVE '23' TO FIO-STAT.
      
      * Garantia Alzada
           IF GDG-IND-EST1 IN GDG > '19'
               MOVE 'GDGALZ' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
      
      * Garantia Completa
           IF GDG-IND-GTAC IN GDG NOT = 'S'
               MOVE 'GDG    NOAGA' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
      
      * Garantia no Activada
           IF GDG-IND-EST1 IN GDG < '10'
               MOVE 'GDGNOACT' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
      
       CNT-FND-GDG.
      
           GO TO FIN-FND-KEY.
      
      
       ERR-FND-KEY.
           MOVE 'BGL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE SCR-STAT-ABT TO SCR-STAT.
           IF SCR-CCPP = 'ING'
               MOVE '00' TO FIO-STAT
           ELSE
               MOVE FIO-STAT-NEX TO FIO-STAT.
      *>>>>
*% END
*% IF PFS_SCR_GKEY
      *<<<< PFS_SCR_GKEY
           IF NOT
              ( FRM-FFLD = FRM-FFLD-PF5 )
      *>>>>
*% END
*% IF PFS_GET_CON OR PFS_GET_ACC
      *<<<< PFS_GET_CON OR PFS_GET_ACC
           IF NOT
              ( FRM-FFLD = FRM-FFLD-PF5 )
      *>>>>
*% END
*% IF EOF AND PGM_PQ
      *<<<< EOF
       RST-STAT SECTION.
       INI-RST-STAT.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
       FIN-RST-STAT.
           EXIT.
      
       GNS-CLR-RQA SECTION.
       INI-GNS-CLR-RQA.
       FIN-GNS-CLR-RQA.
           EXIT.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       COPY BGLBFGDG.
       COPY BGLBFGVT.
       COPY BGLBFTAG.
       COPY GNSBGVSM.
       COPY GNSBGCPT.
       COPY GNSBBVCA.
       COPY BGLBFGSO.
       COPY BGLBFGSL.

      
       LEE-GVT SECTION.
       INI-LEE-GVT.
           MOVE SPACES TO WSS-IND-EGVT.
           MOVE GDG-CAI-GTIA IN GDG TO GVT-CAI-GTIA IN GVT.
           MOVE GDG-IIC-GTIA IN GDG TO GVT-IIC-GTIA IN GVT.
           MOVE 999                 TO GVT-COD-TASN IN GVT.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF NOT (FIO-STAT-OKS AND
              GDG-CAI-GTIA IN GDG = GVT-CAI-GTIA IN GVT AND
              GDG-IIC-GTIA IN GDG = GVT-IIC-GTIA IN GVT)
               MOVE 'N' TO WSS-IND-EGVT.
       FIN-LEE-GVT.
           EXIT.
      *>>>>
*% END
*% IF CMN_MOD
      *<<<< CMN_MOD
           PERFORM GET-FHOY.
           IF SCR-CCPP = 'ING'
              OR SCR-CMND = 'COP'
               MOVE 'I'      TO TAS-MSC-TACC IN TAS
               MOVE HOY-FHOY TO TAS-FEC-FTRN IN TAS
           ELSE
               MOVE 'M'      TO TAS-MSC-TACC    IN TAS.
      *>>>>
           IF TAS-IND-ESTA IN TAS-FLD = '09' AND
              SCR-OFRM-SRV
              MOVE 'MODAUTJAVA' TO TAS-COD-ATRN IN TAS
              MOVE HOY-FHOY     TO TAS-FEC-FTRN IN TAS
              MOVE HOY-HHOY     TO TAS-HRA-HRTR IN TAS.
      *FIN-AFRI/AGO2007    [RENOVACION TAS/SEG]
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en la modificacion : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-MOD.
      *>>>>
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
           MOVE SPACES TO TAS-GLS-FLAG IN TAS.
           MOVE SPACES TO TAS-MSC-TACC IN TAS.
           MOVE 'I'    TO TAS-MSC-STAT IN TAS.
           PERFORM RET-STT-TAS.
           PERFORM RET-ALL-TAS.
           PERFORM RET-HDR-TAS.
           PERFORM GET-FHOY.
           IF SCR-CCPP = 'ING'
              OR SCR-CMND = 'COP'
               MOVE 'I'      TO TAS-MSC-TACC IN TAS
               MOVE HOY-FHOY TO TAS-FEC-FTRN IN TAS
           ELSE
               MOVE 'M'      TO TAS-MSC-TACC    IN TAS.
      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
           IF FIO-STAT-OKS AND
              NOT (TAS-IND-ESTA IN TAS = '11' OR
                   TAS-IND-ESTA IN TAS = '12' OR
                   TAS-IND-ESTA IN TAS = '14')
                   GO TO FIN-CMN-ING
           ELSE
              MOVE FIO-GET-KEY-UPD TO FIO-CMND
              PERFORM BGL-FIO-TAS
              IF NOT FIO-STAT-OKS
                 GO TO FIN-CMN-ING
              ELSE
                 MOVE '11' TO TAS-IND-ESTA IN TAS
                 MOVE 'DEBEN SER RETASADAS' TO TAS-GLS-EXCE IN TAS
                 MOVE FIO-MOD TO FIO-CMND
                 PERFORM BGL-FIO-TAS.
      *>>>>
*% END
*% IF CMN_ELI
      *<<<< CMN_ELI
      * EVA/AFRI
           MOVE TAS-CAI-GTIA IN TAS-FLD TO TAS-CAI-GTIA IN TAS.
           MOVE TAS-IIC-GTIA IN TAS-FLD TO TAS-IIC-GTIA IN TAS.
           MOVE FIO-GET-KEY TO FIO-CMND.
           IF NOT FIO-STAT-OKS
              GO TO FIN-CMN-ELI.

           IF NOT (TAS-IND-ESTA IN TAS = '11' OR
                   TAS-IND-ESTA IN TAS = '12')
               MOVE 'BGL' TO MSG-COD-SIST
               MOVE 'NOELIMINAEST' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '23' TO FIO-STAT
               GO TO FIN-CMN-ELI.

           IF CMA-IND-LGSO IN CMA-VARI = 'S'
               MOVE 'BGL' TO MSG-COD-SIST
               MOVE 'ELINOPERMITI' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '23' TO FIO-STAT
               GO TO FIN-CMN-ELI.
       CON-CMN-ELI.
      *>>>>
*% END
