*%! Codigo adicional para archivo BGLPQGBN
*% IF SETTAG
*% FNCPQ = " "
*% VSNPQ = " "
*% FNCPU = " "
*% VSNPU = " "
*% END
*% PGM_PTC = TRUE
*% LARGO_MI_COMMAREA = 20
*% IF MI_COMMAREA
      *<<<< MI_COMMAREA                                                 
           03 CMA-VARI.                                                 
              05 SCR-IMAX      COMP                   PIC S9(04).       
              05 SCR-I         COMP                   PIC S9(04).       
      *>>>>              
*% END
*% IF WSS
      *<<<<
       COPY SGCBRDBC.                                                   
       COPY BGLBRGDD.                                                   
       COPY BGLBRGAP.                                                   
       COPY BGLBRGSE.                                                   
       COPY BGLBRGLE.                                                   
       COPY BGLBRGUB.                                                   
       COPY BGLBRGIM.                                                   
       COPY TABWGCNS.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GAP-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSE-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GLE-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GUB-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GIM-REQA==.        
       COPY GNSWGCPT.                                                   
                                                                        
       01 WSS-VARI.                                                     
           03 WSS-CIC-ICLI.                                             
              05 WSS-CAI-ICLI                   PIC X(04).              
              05 WSS-IIC-ICLI                   PIC X(08).              
           03 WSS-IDC-ICLI.                                             
              05 WSS-NUM-ICLI                   PIC X(08).              
              05 WSS-IND-ICLI                   PIC X(01).              
              05 WSS-GLS-ICLI                   PIC X(03).              
       01 VARIABLES.                                                    
           03 WSS-GLS-CGTA.                                             
              05 WSS-GLS-TOPE                   PIC X(10).              
              05 WSS-GLS-SOPE                   PIC X(15).              
           03 WSS-COD-CGTA.                                             
              05 WSS-TIP-CGTA                   PIC X(03).              
              05 WSS-STP-CGTA                   PIC X(03).              

      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD                                                 
           IF NOT FIO-STAT-OKS                                          
      *        Error inconsistencia en la modificacion : informar       
               MOVE FIO-MENS TO FRM-MENS                                
               GO TO FIN-CMN-MOD.                                       
      *>>>>                                                             
*% END
*% IF EOF_PQ
      *<<<<
      *AFRI-INI/JUN2008 (MAE)                                           
       BUS-RUT-GTIA SECTION.                                            
       INI-BUS-RUT-GTIA.                                                
                                                                        
            MOVE GDG-CIC-GTIA IN GDG TO GDD-CIC-GTIA IN GDD.            
            MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.                            
            MOVE FIO-GET-KEY TO FIO-CMND.                               
            PERFORM BGL-FIO-GDD.                                        
            IF NOT FIO-STAT-OKS                                         
               MOVE 'BGL' TO MSG-COD-SIST                               
               MOVE 'GDG    NOGDD' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE '00' TO FIO-STAT                                    
               MOVE SCR-STAT-CON TO SCR-STAT                            
               MOVE 'S' TO SCR-IERR                                     
               GO TO FIN-BUS-RUT-GTIA.                                  
                                                                        
             MOVE GDD-CIC-DCLI IN GDD TO DBC-CIC-ICLI IN DBC.           
             MOVE FIO-GET-KEY TO FIO-CMND                               
             PERFORM SGC-FIO-DBC                                        
             IF NOT FIO-STAT-OKS                                        
                MOVE 'BGL' TO MSG-COD-SIST                              
                MOVE 'DBCICLI INEX' TO MSG-COD-MENS                     
                PERFORM GET-MSG
                MOVE MSG-GLS-DESC TO FRM-MENS    
                MOVE '00' TO FIO-STAT                                   
                MOVE SCR-STAT-CON TO SCR-STAT                           
                MOVE 'S' TO SCR-IERR                                    
                GO TO FIN-BUS-RUT-GTIA                                  
             ELSE                                                       
                MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN GBN-FLD     
                MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN GBN-FLD     
                MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN GBN-FLD     
                MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN GBN-FLD     
                MOVE DBC-GLS-NOMC IN DBC TO FRM-GLS-NOMC IN GBN-FLD     
                MOVE '00' TO PGM-STAT-DBC                               
                GO TO FIN-BUS-RUT-GTIA.                                 
                                                                        
       FIN-BUS-RUT-GTIA.                                                
           EXIT.                                                        
      *AFRI-FIN/JUN2008 (MAE)      
      *>>>>                                     
*% END                                                                        
*% IF EOF
      *<<<<
       COPY BGLBFGDD.                                                   
       COPY BGLBFGAP.                                                   
       COPY BGLBFGSE.                                                   
       COPY BGLBFGLE.                                                   
       COPY BGLBFGUB.                                                   
       COPY BGLBFGIM.                                                   
       COPY TABBGCNS.                                                   
       COPY SGCBFDBC.                                                   
       COPY GNSBBTAB.                                                   
       COPY GNSBVTAB.                                                   
       COPY GNSBVCOD.                                                   
       COPY GNSBEGLS.                                                   
       COPY GNSBGCPT.                                                   
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<<
           PERFORM KEY-ALL-GBN.                                         
           IF GDG-COD-GORI IN GBN-FLD > SPACES  AND                     
              GDG-CAI-GTIA IN GBN-FLD NOT > SPACES AND                  
              GDG-IIC-GTIA IN GBN-FLD NOT > ZEROES                      
              MOVE GDG-COD-GORI IN GBN-FLD TO GDG-COD-GORI IN GDG       
              MOVE 'GDG-COD-GORI' TO FIO-AKEY                           
              MOVE FIO-GET-KEY TO FIO-CMND                              
              PERFORM BGL-FIO-GDG                                       
              IF NOT FIO-STAT-OKS                                       
                 MOVE 'BGL' TO MSG-COD-SIST                             
                 MOVE 'GGDGGORIINEX' TO MSG-COD-MENS                    
                 PERFORM GET-MSG                                        
                 MOVE MSG-GLS-DESC TO FRM-MENS                          
                 MOVE '00' TO FIO-STAT                                  
                 MOVE SCR-STAT-CON TO SCR-STAT                          
                 MOVE 'S' TO SCR-IERR                                   
                 GO TO FIN-FND-KEY                                      
              ELSE                                                      
                 GO TO VALIDA-DATOS.                                    
                                                                        
            IF GDG-COD-GORI IN GBN-FLD NOT > SPACES AND                 
               GDG-CAI-GTIA IN GBN-FLD > SPACES AND                     
               GDG-IIC-GTIA IN GBN-FLD > ZEROES                         
               MOVE GDG-CAI-GTIA IN GBN-FLD TO GDG-CAI-GTIA IN GDG      
               MOVE GDG-IIC-GTIA IN GBN-FLD TO GDG-IIC-GTIA IN GDG      
               MOVE FIO-GET-KEY TO FIO-CMND                             
               PERFORM BGL-FIO-GDG                                      
               IF NOT FIO-STAT-OKS                                      
                  MOVE 'BGL' TO MSG-COD-SIST                            
                  MOVE 'GDG INEX' TO MSG-COD-MENS                       
                  PERFORM GET-MSG                                       
                  MOVE MSG-GLS-DESC TO FRM-MENS                         
                  MOVE '00' TO FIO-STAT                                 
                  MOVE SCR-STAT-CON TO SCR-STAT                         
                  MOVE 'S' TO SCR-IERR                                  
                  GO TO FIN-FND-KEY                                     
              ELSE                                                      
                 GO TO VALIDA-DATOS.                                    
                                                                        
           IF GDG-COD-GORI IN GBN-FLD NOT > SPACES  AND                 
              GDG-CAI-GTIA  IN GBN-FLD NOT > SPACES AND                 
              GDG-IIC-GTIA  IN GBN-FLD NOT > ZEROES AND                 
              DBC-VRF-ICLI  IN GBN-FLD > SPACES                         
              MOVE 'DBC-IDC-ICLI' TO FIO-AKEY                           
              MOVE FIO-GET-KEY TO FIO-CMND                              
              PERFORM SGC-FIO-DBC                                       
              IF NOT FIO-STAT-OKS                                       
                 MOVE 'BGL' TO MSG-COD-SIST                             
                 MOVE 'DBCICLI INEX' TO MSG-COD-MENS                    
                 PERFORM GET-MSG                                        
                 MOVE MSG-GLS-DESC TO FRM-MENS                          
                 MOVE '00' TO FIO-STAT                                  
                 MOVE SCR-STAT-CON TO SCR-STAT                          
                 MOVE 'S' TO SCR-IERR                                   
                 GO TO FIN-FND-KEY                                      
              ELSE                                                      
                MOVE DBC-CIC-ICLI IN DBC TO GDD-CIC-DCLI IN GDD.        
                MOVE SPACES              TO GDD-CIC-GTIA IN GDD.        
                MOVE FIO-GET-NLS TO FIO-CMND.                           
                PERFORM BGL-FIO-GDD.                                    
                IF NOT (FIO-STAT-OKS AND                                
                        DBC-CIC-ICLI IN DBC = GDD-CIC-DCLI IN GDD)      
                   MOVE 'BGL' TO MSG-COD-SIST                           
                   MOVE 'GDG    NOGDD' TO MSG-COD-MENS                  
                   PERFORM GET-MSG                                      
                   MOVE MSG-GLS-DESC TO FRM-MENS                        
                   MOVE '00' TO FIO-STAT                                
                   MOVE SCR-STAT-CON TO SCR-STAT                        
                   MOVE 'S' TO SCR-IERR                                 
                   GO TO FIN-FND-KEY                                    
                 ELSE                                                   
                   MOVE GDD-CAI-GTIA IN GDD TO GDG-CAI-GTIA IN GDG      
                   MOVE GDD-IIC-GTIA IN GDD TO GDG-IIC-GTIA IN GDG      
                   MOVE FIO-GET-KEY TO FIO-CMND                         
                   PERFORM BGL-FIO-GDG                                  
                   IF NOT FIO-STAT-OKS                                  
                      MOVE 'BGL' TO MSG-COD-SIST                        
                      MOVE 'GDG INEX' TO MSG-COD-MENS                   
                      PERFORM GET-MSG                                   
                      MOVE MSG-GLS-DESC TO FRM-MENS                     
                      MOVE '00' TO FIO-STAT                             
                      MOVE SCR-STAT-CON TO SCR-STAT                     
                      MOVE 'S' TO SCR-IERR                              
                      GO TO FIN-FND-KEY.                                
       VALIDA-DATOS.                                                    
           MOVE FIO-STAT TO PGM-STAT-GDG.                               
      *BUSCA CIC BCO NOVA                                               
           IF SCR-HDR-MRCA = 'BCS'                                      
               MOVE 'IDCBCS'  TO TAB-COD-CTAB IN TAB                    
           ELSE                                                         
               MOVE 'IDCBCO'  TO TAB-COD-CTAB IN TAB.                   
                                                                        
           MOVE 'BGL'     TO TAB-COD-SIST FIO-SIST.                     
           MOVE 'IDC '    TO TAB-COD-TTAB IN TAB.                       
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM GNS-FIO-TAB.                                         
      *    PERFORM BUS-TAB                                              
           IF FIO-STAT-OKS                                              
              MOVE TAB-GLS-DCOR IN TAB TO WSS-NUM-ICLI.                 
                                                                        
           MOVE WSS-NUM-ICLI        TO DBC-NUM-ICLI IN DBC.             
           MOVE SPACES              TO DBC-IND-ICLI IN DBC.             
           MOVE SPACES              TO DBC-GLS-ICLI IN DBC.             
           MOVE 'DBC-IDC-ICLI'     TO FIO-AKEY.                         
           MOVE FIO-GET-KEY  TO FIO-CMND.                               
           PERFORM SGC-FIO-DBC.                                         
           IF (NOT FIO-STAT-OKS)                                        
                 MOVE SPACES              TO WSS-CIC-ICLI IN WSS-VARI   
                 MOVE ZEROES           TO GAP-COD-PACR IN GBN-FLD       
                 MOVE SPACES           TO FRM-COD-REGI IN GBN-FLD       
                 MOVE SPACES           TO FRM-GLS-REGI IN GBN-FLD       
                 MOVE 'BGL'          TO MSG-COD-SIST                    
                 MOVE 'DBC INEX    ' TO MSG-COD-MENS                    
                 PERFORM GET-MSG                                        
                 MOVE MSG-GLS-DESC   TO FRM-MENS                        
      *          MOVE FRM-SUAR-MAL   TO FRM-SUAR                        
                 MOVE '00' TO FIO-STAT                                  
                 MOVE SCR-STAT-CON TO SCR-STAT                          
                 GO TO VAL-CLIENTE.                                     
                                                                        
           MOVE DBC-CIC-ICLI IN DBC TO WSS-CIC-ICLI IN WSS-VARI.        
                                                                        
                                                                        
      *BUSCA GAP DE GTIA                                                
           MOVE GDG-CIC-GTIA IN GDG TO GAP-COD-CGTA IN GAP.             
           MOVE ZEROES              TO GAP-COD-PACR IN GAP.             
           MOVE FIO-GET-NLS        TO FIO-CMND.                         
       LUP-GAP.                                                         
           PERFORM BGL-FIO-GAP.                                         
                                                                        
           IF (NOT FIO-STAT-OKS  OR                                     
               GAP-COD-CGTA IN GAP NOT = GDG-CIC-GTIA IN GDG)           
                MOVE ZEROES           TO GAP-COD-PACR IN GBN-FLD        
                MOVE SPACES           TO FRM-COD-REGI IN GBN-FLD        
                MOVE SPACES           TO FRM-GLS-REGI IN GBN-FLD        
                MOVE 'BGL'          TO MSG-COD-SIST                     
                MOVE 'DBC INEX 2  ' TO MSG-COD-MENS                     
                PERFORM GET-MSG                                         
                MOVE MSG-GLS-DESC   TO FRM-MENS                         
      *         MOVE FRM-SUAR-MAL   TO FRM-SUAR                         
                MOVE '00' TO FIO-STAT                                   
                MOVE SCR-STAT-CON TO SCR-STAT                           
                GO TO VAL-CLIENTE.                                      
                                                                        
           IF (GAP-CIC-ICLI IN GAP NOT = WSS-CIC-ICLI IN WSS-VARI)      
                MOVE FIO-GET-NXT TO FIO-CMND                            
                GO TO LUP-GAP.                                          
                                                                        
           MOVE FIO-STAT TO PGM-STAT-GAP.                               
                                                                        
      *BUSCA GLE DE GTIA                                                
           MOVE GDG-CIC-GTIA IN GDG TO GLE-CIC-GTIA IN GLE.             
           MOVE GAP-COD-PACR IN GAP TO GLE-COD-PACR IN GLE.             
           MOVE FIO-GET-KEY        TO FIO-CMND.                         
           PERFORM BGL-FIO-GLE.                                         
                                                                        
           IF (NOT FIO-STAT-OKS )                                       
                MOVE SPACES           TO FRM-COD-REGI IN GBN-FLD        
                MOVE SPACES           TO FRM-GLS-REGI IN GBN-FLD        
                GO TO VAL-CLIENTE.                                      
                                                                        
      *VALIDA CODIGO DE REGISTRO NOVA                                   
           MOVE 'BGL'                  TO CNS-COD-SIST IN CNS-VARI.     
           MOVE 'REG'                  TO CNS-CIC-TTAB IN CNS-VARI.     
           MOVE GLE-COD-REGI IN GLE    TO CNS-COD-CBCI IN CNS-VARI.     
                                                                        
           PERFORM BUS-TAB-BVC.                                         
           IF (MSG-COD-MENS IN MSG > SPACES)                            
                MOVE SPACES              TO FRM-COD-REGI IN GBN-FLD     
                MOVE SPACES              TO FRM-GLS-REGI IN GBN-FLD     
           ELSE                                                         
                MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-REGI IN GBN-FLD     
                MOVE CNS-COD-CTAB        TO FRM-COD-REGI IN GBN-FLD.    
       VAL-CLIENTE.                                                     
           MOVE GDG-CAI-GTIA IN GDG TO GSE-CAI-GTIA IN GSE.             
           MOVE GDG-IIC-GTIA IN GDG TO GSE-IIC-GTIA IN GSE.             
           MOVE 999                 TO GSE-NUM-IGSE IN GSE.             
           MOVE FIO-GET-LEQ TO FIO-CMND.                                
           PERFORM BGL-FIO-GSE.                                         
           IF NOT ( FIO-STAT-OKS AND                                    
              GSE-CAI-GTIA IN GSE = GDG-CAI-GTIA IN GDG AND             
              GSE-IIC-GTIA IN GSE = GDG-IIC-GTIA IN GDG)                
      *AFRI-INI/JUN2008 (MAE)                                           
               PERFORM BUS-RUT-GTIA                                     
      *AFRI-FIN/JUN2008 (MAE)                                           
               MOVE 'BGL' TO MSG-COD-SIST                               
               MOVE 'GDG    NOGSE' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE '00' TO FIO-STAT                                    
               MOVE SCR-STAT-CON TO SCR-STAT                            
               GO TO FIN-FND-KEY.                                       
                                                                        
                                                                        
           MOVE FIO-STAT TO PGM-STAT-GSE.                               
                                                                        
           MOVE GDG-CAI-GTIA IN GDG TO GDD-CAI-GTIA IN GDD.             
           MOVE GDG-IIC-GTIA IN GDG TO GDD-IIC-GTIA IN GDD.             
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.                             
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM BGL-FIO-GDD.                                         
           IF NOT ( FIO-STAT-OKS AND                                    
              GDD-CAI-GTIA IN GDD = GDG-CAI-GTIA IN GDG AND             
              GDD-IIC-GTIA IN GDD = GDG-IIC-GTIA IN GDG)                
               MOVE 'BGL' TO MSG-COD-SIST                               
               MOVE 'GDG    NOGDD' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE '00' TO FIO-STAT                                    
               MOVE SCR-STAT-CON TO SCR-STAT                            
               GO TO FIN-FND-KEY.                                       
                                                                        
           MOVE GDD-CIC-DCLI IN GDD TO DBC-KEY-IDBC IN DBC.             
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM SGC-FIO-DBC.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'BGL' TO MSG-COD-SIST                               
               MOVE 'GDD    NODBC' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE '00' TO FIO-STAT                                    
               MOVE SCR-STAT-CON TO SCR-STAT                            
               GO TO FIN-FND-KEY.                                       
           MOVE FIO-STAT TO PGM-STAT-DBC.                               
                                                                        
      *    IF SCR-CMND = 'ING'                                          
      *       PERFORM PUT-ALL-GBN                                       
      *       MOVE '23' TO FIO-STAT.                                    
           GO TO FIN-FND-KEY.                                           
           PERFORM KEY-ALL-GBN.                                         
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-GDG.                                         
           IF FIO-STAT-OKS                                              
               MOVE GDG-STP-ITRN IN GDG TO SCR-UMOD.                    
      *     MOVE FIO-STAT TO PGM-STAT-GDG.  
           GO TO FIN-FND-KEY.
      *>>>>
*% END 
