*% PGM_GTP = TRUE
*% NOT_PRO_VCG = TRUE
*% FRM = 'GTP'
*% REG = 'GTP'
*% HIJ = 'GDG'
*% VSNPQ = "06.06.22"
*% FNCPQ = "OWFBGL"
*% VSNPU = "06.06.22"
*% FNCPU = "OWFBGL"
*% FMT_CHI = TRUE
*%! Codigo adicional para archivo
*%! IF NOT PGM_MCP
*% PGM_PTC = TRUE
*%! END
*% IF CMT_ID
      *-----------------------------------------------------------------
      * MODIFICACIONES:
      *-----------------------------------------------------------------
*% IF PGM_PU
      *  AUTOR      : BEE-MPS
      *  FECHA      : SEP-2016
      *  ETIQUETA   : *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
      *  PROYECTO   : ARCHIVO CON REVALORIZACIONES DE GARANTIAS
      *  OBJETIVO   : GRABAR LOG DE NEGOCIO EN ENTIDAD GNS-LGN
      *-----------------------------------------------------------------
      *  AUTOR      : BEE-MPS
      *  FECHA      : JUN-2017
      *  ETIQUETA   : *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
      *  PROYECTO   : ARCHIVO CON REVALORIZACIONES DE GARANTIAS FASE 2
      *  OBJETIVO   : GRABAR LOG DE COMANDO ING EN ENTIDAD GNS-LGN
      *-----------------------------------------------------------------
      *  Autor     : BEE-MPB
      *  Fecha     : ENE-2018
      *  NUB       : 53820
      *  Proyecto  : LIMPIEZA CAMPO COD-OTRN
      *  ID        : *MPB-INI 31-ENE-2018 LIMPIEZA CAMPO COD-OTRN
      *  Objetivo  : COMPLETAR CAMPO COD-OTRN CON CANAL
      *              PARA EVITAR INCONSISTENCIAS
      *----------------------------------------------------------------
      *  AUTOR      : BEE-RRM
      *  FECHA      : JUL-2018
      *  ETIQUETA   : *RRM-INI JUL-2018 REVALORIZACION DE FFMM
      *  PROYECTO   : AUDITORIA REVALORIZACION FFMM (LIDER: JRF)
      *  OBJETIVO   : AUTOMATIZAR LA VALORIZACION DE FFMM, VALOR SE
      *               OBTIENE DESDE ENTIDAD VDO.
      *-----------------------------------------------------------------
*% END
*% IF PGM_PQ
      *OBJETIVO: MOSTRAR VALOR UNITARIO DE BASE DE DATOS
      *PROYECTO: VALORIZACION ACCIONES
      *FECHA   : ENERO DE 2018
      *AUTOR   : SOP-AFRI
      *ETIQUETA: *AFRI-INI/VALORIZACION ACCIONES/01-2018
      *-----------------------------------------------------------------
      *  AUTOR      : BEE-RRM
      *  FECHA      : JUL-2018
      *  ETIQUETA   : *RRM-INI JUL-2018 REVALORIZACION DE FFMM
      *  PROYECTO   : AUDITORIA REVALORIZACION FFMM (LIDER: JRF)
      *  OBJETIVO   : AUTOMATIZAR LA VALORIZACION DE FFMM.
      *               ESPECIFICAMENTE EN ESTE PROGRAMA SE MODIFICO PARA
      *               DESPLEGAR UNIDAD DE MEDIDA PARA FFMM (CENTESIMAS)
      *-----------------------------------------------------------------
*% END
*% END
*% IF EOF AND PGM_DTC
      *<<<< EOF AND PGM_DTC
       COPY GNSBGVSM.
       COPY GNSBHVSM.
      *>>>>
*% END
*% IF FIN_SCR_VARI
           03 CMA-VARI.
              05 GAR-CAI-GTIA                     PIC X(04).
              05 GAR-IIC-GTIA                     PIC X(08).
              05 GAR-IND-GTAC                      PIC X(01).
              05 GAR-NUM-ITSN                     PIC 9(03).
              05 GAR-EST-ANT                      PIC X(02).
              05 GAR-ES1-1                        PIC X(02).
              05 GAR-ES1-2                        PIC X(02).
              05 GAR-ES1-3                        PIC X(02).
              05 GAR-ES1-4                        PIC X(02).
      *>>>>
*% END
*% IF WSS
       COPY BGLBRGDG.
       COPY BGLBRACC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ACC-REQA==. 
       COPY BGLBRTAG.
       COPY BGLBRGVT.
      *PVG INI 15-OCT-2003
       COPY BGLBRGSO.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSO-REQA==.
      *PVG FIN 15-OCT-2003
       COPY GNSWGPES.
*% IF PGM_PU
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
      *Rutina CAM
       COPY GNSWINVC.
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM
*% END
*% IF PGM_CHI AND PGM_PQ
      *<<<< PGM_CHI AND PGM_PQ
      *PTC-INI-MAN
       COPY BGLWXGVT.
       COPY BGLWXGTP.
      *PTC-FIN-MAN
       COPY USPC113.
      *>>>>
*% END
       01  WSS-VARI.
           03 GAR-VCB                         PIC X(06).
              88 MONEDA-SIN-DECIMALES VALUE '0999  '.
           03 GAR-COD-ITSN                  PIC 9(03).
           03 WSS-TIPO-AUX.           
              05 WSS-TIPO                   PIC X(03).
              05 WSS-AUX                    PIC X(03).
           03 WSS-CIC-TIAU                  PIC X(06).
           03 WSS-FECHA.     
              05 WSS-SIGLO                  PIC 9(02).
              05 WSS-ANO                    PIC 9(02).
           03 WSS-LISTA                     PIC X(01).
           03 WSS-COD-CGTA.
              05 WSS-TIP-CGTA                 PIC X(03).
              05 WSS-STP-CGTA                 PIC X(03).
      *MHM-INI 23-OCT-2003
           03 WSS-GLS-CGTA.
              05 WSS-GLS-TOPE                   PIC X(40).
              05 WSS-GLS-SOPE                   PIC X(40).
      *MHM-FIN 23-OCT-2003
*% IF PGM_PQ
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
           03 WSS-IND-FFMM        VALUE SPACES  PIC X(01).
           03 WSS-S               VALUE 'S'     PIC X(01).
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM
*% END
*% IF PGM_PU
      *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
           03 WSS-CTE-BGL      VALUE 'BGL'      PIC X(03).
           03 WSS-CTE-GSE      VALUE 'GSE'      PIC X(03).
      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
           03 WSS-CTE-ING      VALUE 'ING'      PIC X(03).
           03 WSS-CTE-I        VALUE 'I'        PIC X(01).
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
           03 WSS-CTE-ELI      VALUE 'ELI'      PIC X(03).
           03 WSS-CTE-MOD      VALUE 'MOD'      PIC X(03).
           03 WSS-CTE-ANT      VALUE 'ANT'      PIC X(03).
           03 WSS-CTE-DES      VALUE 'DES'      PIC X(03).
           03 WSS-CTE-M        VALUE 'M'        PIC X(01).
           03 WSS-CTE-E        VALUE 'E'        PIC X(01).
           03 WSS-CTE-V10      VALUE '1.0'      PIC X(03).
           03 WSS-CTE-1        VALUE  1         PIC 9(01).
           03 WSS-CTE-2        VALUE  2         PIC 9(01).
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
           03 WSS-IND-FFMM     VALUE SPACES      PIC X(01).
           03 WSS-S            VALUE 'S'         PIC X(01).
           03 WSS-C            VALUE 'C'         PIC X(01).
           03 WSS-FMT          VALUE 'FMT'       PIC X(03).
           03 WSS-1            VALUE 1           PIC 9(01).
           03 WSS-99999999     VALUE 99999999    PIC 9(08).
           03 WSS-COD-IVDO.
              05 WSS-COD-IVDO1 VALUE '000000000' PIC X(09).
              05 WSS-COD-IVDO2 VALUE SPACES      PIC X(03).
           03 WSS-SGV-VVDO     VALUE ZEROES      PIC S9(11)V9(04).
           03 WSS-INST-EMIS.
              05 WSS-COD-TIEM     VALUE SPACES    PIC X(03).
              05 WSS-COD-INEM     VALUE SPACES    PIC X(03).
              05 WSS-COD-SIEM     VALUE SPACES    PIC X(03).
              05 WSS-FIL-EMIS     VALUE SPACES    PIC X(11).
           03 WSS-COD-PESO.
              05 WSS-IND-TMON                  PIC X(01).
              05 WSS-COD-REST                  PIC X(05).
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM

           03 WSS-SGV-VTSN       PIC  ZZ.ZZZ.ZZZ.ZZZ,ZZZZ.
           03 WSS-SGV-ITSN         PIC  Z.ZZZ.ZZZ.ZZZ.ZZZ.

       77  WSS-LGM-ABSTIME                  PIC S9(15) COMP-3.

       COPY GNSBRLGN.
       COPY BGLBRGDD.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LGN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.
      *MPS-FIN 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
*% END
      *MHM-INI 23-OCT-2003
       COPY GNSWGCPT.
      *MHM-FIN 23-OCT-2003
*% IF PGM_PU
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
       COPY BGLBRGDO.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDO-REQA==.
       COPY BGLBRVDO.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VDO-REQA==.
       COPY TABBRCAM.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM
*% END
*% IF PGM_DTC
      *<<<< WSS AND PGM_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.
*% IF PGM_PQ
      *AFRI-INI/VALORIZACION ACCIONES/01-2018
       01  WCC-VARI.
           03 WCC-1            VALUE 1                  PIC 9(01).
           03 WCC-CON          VALUE 'CON'              PIC X(03).
           03 WCC-NEMONOVIG    VALUE 'NEMONOVIG   '     PIC X(12).
      *AFRI-FIN/VALORIZACION ACCIONES/01-2018
*% END
      *>>>>
*% END
*% END
*% CMA_USR = TRUE
*% IF CMA AND PGM_MVS
           02 FILLER                       PIC X(277).
*% END
*% IF INI_FIO AND PGM_MVS
      *<<<< INI_FIO
*% IF PGM_PU
      *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
           IF SCR-SISG NOT > SPACES
              MOVE SCR-SIST TO SCR-SISG.
      *MPS-FIN 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
*% END
           MOVE +277 TO SCR-TCMA.
      *>>>>
*% END
*% IF INI_FIO AND PGM_VAX
      *<<<< INI_FIO

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-OFI.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'BGL'        TO FIO-SIST.
           PERFORM BGL-FIO-GDG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'BGL'        TO FIO-SIST.
           PERFORM BGL-FIO-TAG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM BGL-FIO-TAG.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'BGL'        TO FIO-SIST.
           PERFORM BGL-FIO-GVT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GVT.

      *>>>>
*% END
*% IF FIN_PUT_SCR
      *<<<< FIN_PUT_SCR
      *PTC-INI-MAN
           IF SCR-OFRM-SRV
              PERFORM PUT-ALL-GTP-PTC.
      *PTC-FIN-MAN
      *>>>>
*% END
*% IF SCR_GIKY_VAL_IKY
      *<<<< SCR_GIKY_VAL_IKY
      *PTC-INI-MAN
           IF SCR-OFRM-SRV
              MOVE WSX-NOM-TSGVT  TO QUE-COLA
              MOVE WSX-LEN-TSGVT  TO QUE-LITM
              MOVE QUE-GET        TO QUE-CMND
              PERFORM GNS-PRO-QUE
              IF QUE-STAT = QUE-STAT-OKS
                 MOVE QUE-ITEM      TO WSX-TAB-GVT
                 MOVE WSX-CAI-NGAR TO GTP-CAI-GTIA IN GTP-FLD
                 MOVE WSX-IIC-NGAR TO GTP-IIC-GTIA IN GTP-FLD.
      *PTC-FIN-MAN
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
      *PTC-INI-MAN
           IF SCR-CMND = 'IYE'
               PERFORM ELI-GTP.
      *PTC-FIN-MAN
*% FIN_BUS_HIJ = TRUE
       BUS-GDG.
           MOVE GTP-CAI-GTIA IN GTP-FLD TO GDG-CAI-GTIA IN GDG.
           MOVE GTP-IIC-GTIA IN GTP-FLD TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           MOVE FIO-STAT TO PGM-STAT-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG    NEX' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
*% IF PGM_CHI
      *<<<< PGM_CHI
      *
           IF SCR-CCPP = 'ACC' AND 
              SCR-STAT = SCR-STAT-CON
              GO TO FIN-VAL-OFI-USP-GTP.
           IF SCR-OFRM-SRV                                              
              GO TO FIN-VAL-OFI-USP-GTP.                                

           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'OFIUSP'       TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S' )
               GO TO FIN-VAL-OFI-USP-GTP.
           COPY USPC143.
           MOVE 'BGLGTUCG/CEN' TO USP-PTA-STR.
           COPY USPC103.
           IF USP-PERMISO = 'P'
               GO TO FIN-VAL-OFI-USP-GTP.
           IF USP-COD-OFICINA NOT = GDG-COD-OFIC IN GDG 
               MOVE 'USRNODEOFI' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

       FIN-VAL-OFI-USP-GTP.
      *>>>>
*% END
*% IF PGM_PER AND PGM_GVT
      *<<<< PGM_PER AND PGM_GVT
       COPY BGLBVUOF.
           IF MSG-COD-MENS > SPACES
               GO TO ERR-FND-KEY.
      *>>>>
*% END

       FIN-BUS-GDG.
*% IF FMT_CHI
      *<<<<
           MOVE GDG-TIP-CGTA IN GDG TO GDG-TIP-CGTA IN GTP-FLD.
           MOVE GDG-STP-CGTA IN GDG TO GDG-STP-CGTA IN GTP-FLD.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GDG TO GDG-COD-CGTA IN GTP-FLD.
*% END
      *BUS-TAB Busca codigo de tabla
           MOVE 'TAB'  TO TAB-COD-SIST.
      *     MOVE 'GTA'  TO TAB-COD-TTAB IN TAB.
           MOVE 'AUX'  TO TAB-COD-TTAB IN TAB.
           MOVE SPACES TO TAB-COD-CTAB IN TAB.

*% IF FMT_CHI
      *<<<<
           MOVE GDG-TIP-CGTA IN GTP-FLD TO TAG-TIP-AGTA IN TAG.
           MOVE GDG-STP-CGTA IN GTP-FLD TO TAG-STP-AGTA IN TAG.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GTP-FLD TO TAG-COD-AGTA IN TAG.
*% END
      *MHM-INI 23-OCT-2003
      *     MOVE TAG-COD-AGTA IN TAG     TO TAB-COD-CTAB IN TAB.
      *     PERFORM BUS-TAB.
      *     IF MSG-COD-MENS = SPACES
      *         MOVE TAB-GLS-DESC IN TAB TO
      *              FRM-GLS-CGTA IN GTP-FLD
      *     ELSE
      *         MOVE SPACES TO FRM-GLS-CGTA IN GTP-FLD.
      *MHM-FIN 23-OCT-2003

      * Busca Glosa Tabla Real/no Real
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM BGL-FIO-TAG.
           IF NOT FIO-STAT-OKS
                MOVE 'TAG    NEX' TO MSG-COD-MENS
                MOVE 'BGL' TO MSG-COD-SIST
                PERFORM GET-MSG
           ELSE
                MOVE SPACES TO MSG-COD-MENS
                MOVE 'BGL' TO TAB-COD-SIST
                MOVE 'RAL' TO TAB-COD-TTAB IN TAB
                MOVE TAG-IND-TREA IN TAG TO 
                     TAB-COD-CTAB IN TAB
                PERFORM BUS-TAB
                IF MSG-COD-MENS = SPACES
                    MOVE TAB-GLS-DESC IN TAB TO 
                         FRM-GLS-TREA IN GTP-FLD
                ELSE
                    MOVE SPACES TO FRM-GLS-TREA IN GTP-FLD.


           MOVE GDG-CAI-GTIA IN GDG TO GAR-CAI-GTIA IN CMA-VARI.
           MOVE GDG-IIC-GTIA IN GDG TO GAR-IIC-GTIA IN CMA-VARI.
           MOVE GDG-IND-GTAC IN GDG TO GAR-IND-GTAC IN CMA-VARI.
           MOVE GDG-COD-TSCN IN GDG TO GAR-NUM-ITSN IN CMA-VARI.
           IF SCR-CMND = 'ING'
               PERFORM PUT-GDG-GTP.

      * Valida Este permitido esta Entidad para Tipo-Subtipo
           IF TAG-IND-EGTP IN TAG = 'N'
               MOVE 'TAG    NOPGM' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      * Busca ultima Tasacion
           IF GTP-NUM-ITSN IN GTP-FLD < 1
            MOVE GAR-NUM-ITSN IN CMA-VARI TO
                                 GTP-NUM-ITSN IN GTP-FLD.
                    

           MOVE GTP-CAI-GTIA IN GTP-FLD TO GVT-CAI-GTIA IN GVT.
           MOVE GTP-IIC-GTIA IN GTP-FLD TO GVT-IIC-GTIA IN GVT.
           MOVE GTP-NUM-ITSN IN GTP-FLD TO GVT-COD-TASN IN GVT.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF NOT FIO-STAT-OKS
              MOVE 'GVT    NEX' TO MSG-COD-MENS
              GO TO ERR-FND-KEY.
      *MHM-INI 27-NOV-2003
      *     ADD 1 TO GVT-COD-TASN IN GVT.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM BGL-FIO-GVT.
      *     IF FIO-STAT-OKS
      *        MOVE 'NXTGVTSIEX' TO MSG-COD-MENS
      *        GO TO ERR-FND-KEY.

      *     SUBTRACT 1 FROM GVT-COD-TASN IN GVT.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *  
      *     IF  SCR-CMND = 'ING' OR
      *         SCR-CMND = 'MOD' OR 
      *         SCR-CMND = 'ELI' 
      *         IF  GVT-MSC-STAT IN GVT = 'A' 
      *             MOVE 'ATAYA' TO MSG-COD-MENS
      *             GO TO ERR-FND-KEY.

      *     IF ( GDG-IND-GTAC IN GDG = 'S' AND
      *          GDG-IND-EGTP IN GDG NOT = 'S' )
      *          MOVE 'GDGAGANOGTP' TO MSG-COD-MENS
      *          GO TO ERR-FND-KEY.
      *MHM-INI 27-NOV-2003
      *PVG INI 15-OCT-2003
           IF SCR-CMND = 'MOD' AND
              ( GDG-IND-EST1 IN GDG < '10' AND
                GDG-IND-GTAC IN GDG NOT = 'S')
              MOVE GTP-CAI-GTIA IN GTP-FLD TO GSO-CAI-GTIA IN GSO
              MOVE GTP-IIC-GTIA IN GTP-FLD TO GSO-IIC-GTIA IN GSO
              MOVE 'GSO-KEY-IGDG'          TO FIO-AKEY
              MOVE FIO-GET-NLS             TO FIO-CMND
              PERFORM BGL-FIO-GSO
              IF FIO-STAT-OKS AND
                 GSO-CAI-GTIA IN GSO = GTP-CAI-GTIA IN GTP-FLD AND
                 GSO-IIC-GTIA IN GSO = GTP-IIC-GTIA IN GTP-FLD
                 MOVE 'GTPGSO   EXI' TO MSG-COD-MENS
                 GO TO ERR-FND-KEY.

           IF SCR-CMND = 'ELI' AND
              ( GDG-IND-EST1 IN GDG < '10' AND
                GDG-IND-GTAC IN GDG NOT = 'S')
              MOVE GTP-CAI-GTIA IN GTP-FLD TO GSO-CAI-GTIA IN GSO
              MOVE GTP-IIC-GTIA IN GTP-FLD TO GSO-IIC-GTIA IN GSO
              MOVE 'GSO-KEY-IGDG'          TO FIO-AKEY
              MOVE FIO-GET-NLS             TO FIO-CMND
              PERFORM BGL-FIO-GSO
              IF FIO-STAT-OKS AND
                 GSO-CAI-GTIA IN GSO = GTP-CAI-GTIA IN GTP-FLD AND
                 GSO-IIC-GTIA IN GSO = GTP-IIC-GTIA IN GTP-FLD
                 IF GSO-COD-ESGA IN GSO NOT < '06'
                    MOVE 'GTPGSOESTINV' TO MSG-COD-MENS
                    GO TO ERR-FND-KEY.
      *PVG FIN 15-OCT-2003

      * Busca ultimo Item
           IF GTP-COD-ITSN IN GTP-FLD < 1
               PERFORM BUS-ULT-GTP

               MOVE GTP-COD-ITSN IN GTP TO
                    GTP-COD-ITSN IN GTP-FLD
               IF SCR-CCPP = 'ING'
                   ADD 1 TO GTP-COD-ITSN IN GTP-FLD.

       BUS-ULT-ITEM.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      * EXAMINA RELACION COMANDO STATUS DE REGISTRO GTP

       EXA-COM-STAT.

      * Comando Consulta Error lo trata el GENESIS
           IF SCR-CCPP = 'ACC'
               GO TO FIN-FND-KEY.

      * Garantia Alzada
           IF GDG-IND-EST1 IN GDG > '19'
               MOVE 'GDGALZ' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      * Item alzado
           IF SCR-CCPP NOT = 'ING'
              IF GTP-COD-EITS IN GTP > '19'
                 MOVE 'ITEMALZ' TO MSG-COD-MENS
                 GO TO ERR-FND-KEY.

      * Comando Ingreso
           IF SCR-CCPP = 'ING'
              GO TO NXT-IND-GTP.

      *    Error lo trata el GENESIS
           IF FIO-STAT-OKS OR
              GTP-COD-ITSN IN GTP-FLD NOT > 1
              GO TO FIN-FND-KEY.

      * Ingresa Item siguientes al primero
           SUBTRACT 1 
               FROM GTP-COD-ITSN IN GTP-FLD
             GIVING GAR-COD-ITSN IN WSS-VARI.

           MOVE GAR-COD-ITSN IN WSS-VARI TO GTP-COD-ITSN IN GTP.
           MOVE 'GTP-KEY-IGTP' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GTP.
           IF NOT FIO-STAT-OKS
              MOVE 'IKYANTNEX' TO MSG-COD-MENS
              GO TO ERR-FND-KEY.

           MOVE PGM-STAT-GTP TO FIO-STAT.
           GO TO FIN-FND-KEY.

       NXT-IND-GTP.
      * Comandos no Ingreso, Registro debe existir
           IF NOT FIO-STAT-OKS
      *        Error lo trata el GENESIS
               GO TO FIN-FND-KEY.

           IF GTP-MSC-STAT IN GTP = 'E'
               MOVE 'GTP   EXTING' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           MOVE GTP-COD-EITS IN GTP TO GAR-EST-ANT IN CMA-VARI.

           IF GDG-IND-GTAC IN GDG NOT = 'S' AND
              SCR-CMND NOT = 'ALZ'
               GO TO FIN-FND-KEY.

           IF GDG-IND-GTAC IN GDG = 'S' AND
              GVT-MSC-STAT IN GVT = 'I' AND

              SCR-CMND NOT = 'ALZ' AND (
              SCR-CCPP NOT = 'ELI' OR
              SCR-CCPP = 'ELI' AND GTP-NUM-ITSN IN GTP-FLD >
                                   GDG-COD-TSCN IN GDG )
               GO TO FIN-FND-KEY.

           IF GDG-IND-GTAC IN GDG = 'S' AND
              GVT-MSC-STAT IN GVT = 'A' AND
              SCR-CCPP NOT = 'ELI'
               GO TO FIN-FND-KEY.

           IF GDG-IND-GTAC IN GDG NOT = 'S' AND
              SCR-CMND = 'ALZ'
               MOVE 'GTP    NOAGA' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           IF GDG-IND-GTAC IN GDG = 'S' AND
              GVT-MSC-STAT IN GVT = 'I' AND
              SCR-CMND = 'ALZ'
               MOVE 'GTP    NOAGA' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           IF GDG-IND-GTAC IN GDG = 'S' AND
              GVT-MSC-STAT IN GVT = 'I' AND (
              SCR-CCPP = 'ELI' AND 
              GTP-NUM-ITSN IN GTP-FLD NOT >
                             GDG-COD-TSCN IN GDG )

               MOVE 'GTP    AGAYA' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           IF GDG-IND-GTAC IN GDG = 'S' AND
              GVT-MSC-STAT IN GVT = 'A' AND
              SCR-CCPP = 'ELI'
               MOVE 'GTP    AGAYA' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           MOVE 'GTPCMNSTA' TO MSG-COD-MENS.
           GO TO ERR-FND-KEY.

       ERR-FND-KEY.
           MOVE 'BGL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE SCR-STAT-ABT TO SCR-STAT.
           IF SCR-CCPP = 'ING'
               MOVE '00' TO FIO-STAT
           ELSE
               MOVE FIO-STAT-NEX TO FIO-STAT.

      *>>>>
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
           MOVE SPACES TO GTP-GLS-FLAG IN GTP.
           MOVE SPACES TO GTP-MSC-TACC IN GTP.
           MOVE SPACES TO GTP-CIC-UNIG IN GTP.
           MOVE 'I'    TO GTP-MSC-STAT IN GTP.
           MOVE ZEROES TO GTP-NUM-ITSN IN GTP.
           MOVE ZEROES TO GTP-COD-ITSN IN GTP.
           MOVE ZEROES TO GTP-SGV-ITSN IN GTP.
           MOVE ZEROES TO GTP-SGV-VTSN IN GTP.
           MOVE ZEROES TO GTP-FEC-FCES IN GTP.
           MOVE ZEROES TO GTP-FEC-FING IN GTP.
           MOVE ZEROES TO GTP-FEC-FTRN IN GTP.
           MOVE ZEROES TO GTP-HRA-HRTR IN GTP.

      *>>>>
*% END
*% IF CMN_MOD
      *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
           PERFORM LEE-GDD.
           PERFORM LLENAR-ANTES.
           PERFORM GRABAR-LGN.
      *MPS-FIN 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
      *<<<< INI_CMN_ING OR INI_CMN_MOD
           PERFORM GET-FHOY.
           IF SCR-CCPP = 'ING'
              OR SCR-CMND = 'COP'
               MOVE 'I'      TO GTP-MSC-TACC    IN GTP

               MOVE HOY-FHOY TO GTP-FEC-FING IN GTP
*% IF PGM_MVS
               MOVE SCR-USER TO GTP-CIC-UNIG IN GTP
*% END
           ELSE
*% IF PGM_MVS
               MOVE SCR-USER TO GTP-CIC-UNIG IN GTP
*% END
               MOVE 'M'      TO GTP-MSC-TACC    IN GTP.
*% END
*% IF CMN_ING
      *<<<< INI_CMN_ING OR INI_CMN_MOD
           PERFORM GET-FHOY.

           IF SCR-CCPP = 'ING'
              OR SCR-CMND = 'COP'
               MOVE 'I'      TO GTP-MSC-TACC    IN GTP

               MOVE HOY-FHOY TO GTP-FEC-FING IN GTP
*% IF PGM_MVS
               MOVE SCR-USER TO GTP-CIC-UNIG IN GTP
*% END
           ELSE
*% IF PGM_MVS
               MOVE SCR-USER TO GTP-CIC-UNIG IN GTP
*% END
               MOVE 'M'      TO GTP-MSC-TACC    IN GTP.
*% IF PGM_MVS
*% END
      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en el comando : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ING. 

           PERFORM MOD-GVT.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-ING.

      *>>>>
      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
           PERFORM LEE-GDD.
           PERFORM LLENAR-DESPUES.
           PERFORM GRABAR-LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
*% END
*% IF CMN_MOD
      *<<<< CMN_MOD
      *AFRI-INI/SEP2006                                                 
           MOVE GTP-CAI-GTIA IN GTP-FLD   TO GDG-CAI-GTIA IN GDG.       
           MOVE GTP-IIC-GTIA IN GTP-FLD   TO GDG-IIC-GTIA IN GDG.       
           MOVE FIO-GET-KEY  TO FIO-CMND.                               
           PERFORM BGL-FIO-GDG.                                         
           IF NOT FIO-STAT-OKS                                          
               GO TO CON-CMND-MOD.                                      
                                                                        
           MOVE GTP-CAI-GTIA IN GTP-FLD   TO GVT-CAI-GTIA IN GVT.       
           MOVE GTP-IIC-GTIA IN GTP-FLD   TO GVT-IIC-GTIA IN GVT.       
           MOVE GTP-NUM-ITSN IN GTP-FLD   TO GVT-COD-TASN IN GVT.       
           MOVE FIO-GET-KEY  TO FIO-CMND.                               
           PERFORM BGL-FIO-GVT.                                         
           IF NOT FIO-STAT-OKS                                          
               GO TO CON-CMND-MOD.                                      
                                                                        
           IF (GDG-IND-GTAC IN GDG = 'S'    AND                         
               GDG-IND-EST1 IN GDG > '09'   AND                         
               GDG-IND-EST1 IN GDG < '19'   AND                         
               GVT-MSC-STAT IN GVT = 'A' )                              
               MOVE 'BGL' TO MSG-COD-SIST                               
               MOVE 'GTIA ACTIVAD' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               GO TO FIN-CMN-MOD.                                       
                                                                        
       CON-CMND-MOD.                                                    
      *AFRI-FIN/SEP2006                                                 
      *                                                                 
      *    En Tramite Alzamiento se considera alzado para fines
      *       operacionales
           IF GTP-COD-EITS IN GTP-FLD > '14'
               MOVE 'E' TO GTP-MSC-STAT IN GTP.
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en el comando : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-MOD. 

      *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
           PERFORM LLENAR-DESPUES.
           PERFORM GRABAR-LGN.
      *MPS-FIN 21-SEP-2016 REVALORIZACIONES DE GARANTIAS

           PERFORM MOD-GVT.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-MOD.
      *>>>>
*% END
*% IF CMN_ELI
      *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
           PERFORM LEE-GDD.
           PERFORM LLENAR-ANTES.
           PERFORM GRABAR-LGN.
      *MPS-FIN 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en la eliminacion : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.

      * Guarda Llave Padre

      * Para saber si queda o no un hijo y grabar el Indicador en GDG
           MOVE SPACES                   TO GTP-KEY-IGTP IN GTP.
           MOVE GAR-CAI-GTIA IN CMA-VARI TO GTP-CAI-GTIA IN GTP.
           MOVE GAR-IIC-GTIA IN CMA-VARI TO GTP-IIC-GTIA IN GTP.

           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'GTP-KEY-IGTP' TO FIO-AKEY.
           PERFORM BGL-FIO-GTP.
           IF FIO-STAT-OKS AND
              GTP-CAI-GTIA IN GTP = GAR-CAI-GTIA IN CMA-VARI AND
              GTP-IIC-GTIA IN GTP = GAR-IIC-GTIA IN CMA-VARI
              GO TO FIN-CMN-ELI.

      * No quedo ningun hijo
           MOVE GAR-CAI-GTIA IN CMA-VARI TO GDG-CAI-GTIA IN GDG.
           MOVE GAR-IIC-GTIA IN CMA-VARI TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
              MOVE FIO-MENS TO FRM-MENS
              GO TO GAR-FIN-GDG.
      *------------------------------------------*
           MOVE ' ' TO GDG-IND-EGTP IN GDG.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
              MOVE FIO-MENS TO FRM-MENS
              GO TO GAR-FIN-GDG.
      *-------------------------------------------*
           MOVE GAR-CAI-GTIA IN CMA-VARI TO GVT-CAI-GTIA IN GVT.
           MOVE GAR-IIC-GTIA IN CMA-VARI TO GVT-IIC-GTIA IN GVT.
           MOVE GAR-NUM-ITSN IN CMA-VARI TO GVT-COD-TASN IN GVT.

           MOVE 'GVT-KEY-IGVT' TO FIO-AKEY.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF NOT FIO-STAT-OKS
              MOVE FIO-MENS TO FRM-MENS
              GO TO GAR-FIN-GDG.

           MOVE 'A' TO GVT-MSC-STAT IN GVT .
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM BGL-FIO-GVT
           IF NOT FIO-STAT-OKS
              MOVE FIO-MENS TO FRM-MENS.

       GAR-FIN-GDG.
      *>>>>
*% END
*% IF FIN_HBL_FLD
      *<<<< FIN_HBL_FLD
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
           MOVE GTP-CAI-GTIA IN GTP-FLD TO GDG-CAI-GTIA IN GDG.
           MOVE GTP-IIC-GTIA IN GTP-FLD TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
      *VERIFICA SI PRODUCTO (TIPO-SUBTIPO) ES FFMM, DEBE PROTEGER:
      * - Identificacion (VALOR LO OBTIENE DESDE GDO)
      * - Valor Unitario (VALOR LO OBTIENE DESDE VDO)
           MOVE 'BGL'               TO TAB-COD-SIST FIO-SIST.
           MOVE 'PFM'               TO TAB-COD-TTAB IN TAB.
           MOVE GDG-COD-CGTA IN GDG TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = WSS-S
               MOVE WSS-S TO WSS-IND-FFMM
               MOVE FRM-CPIM-AEY TO GTP-COD-IITS-ATR IN GTP-FLD
               MOVE FRM-CPIM-AEY TO GTP-SGV-VTSN-ATR IN GTP-FLD.
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM
      *>>>> FIN_HBL_FLD
*% END
*% IF EOF_PU

      *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS

       LEE-GDD SECTION.
      *===================
       INI-LEE-GDD.

           MOVE GTP-CAI-GTIA IN GTP   TO GDD-CAI-GTIA IN GDD.
           MOVE GTP-IIC-GTIA IN GTP   TO GDD-IIC-GTIA IN GDD.
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM BGL-FIO-GDD.

       FIN-LEE-GDD.
           EXIT.


       LLENAR-ANTES SECTION.
       INI-LLENAR-ANTES.
      *------------------
           MOVE SPACES TO LGN.
           IF SCR-CMND = 'MOD'
              MOVE 'MOD'  TO LGN-COD-EVEN IN LGN
              MOVE 'M'    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
           IF SCR-CMND = 'ELI'
              MOVE 'ELI'  TO LGN-COD-EVEN IN LGN
              MOVE 'E'    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
           MOVE 'ANT'  TO LGN-COD-INST IN LGN.
           MOVE 1      TO LGN-NUM-CLGN IN LGN
                          LGN-NUM-COPE IN LGN
                          LGN-NUM-CCLI IN LGN
                          LGN-NUM-CEVE IN LGN
                          LGN-NUM-CAUT IN LGN.

           MOVE GTP-NUM-ITSN IN GTP        TO LGN-COD-LN01 IN LGN.
           MOVE GTP-COD-ITSN IN GTP        TO LGN-COD-LN02 IN LGN.
           MOVE GTP-FEC-FTRN IN GTP        TO LGN-COD-LN03 IN LGN.
           MOVE GTP-HRA-HRTR IN GTP        TO LGN-COD-LN03 IN LGN(11:6).
           MOVE GTP-MSC-TTRN IN GTP        TO LGN-COD-LN04 IN LGN.
           MOVE GTP-COD-TTRN IN GTP        TO LGN-COD-LN05 IN LGN.
           MOVE GTP-COD-ATRN IN GTP        TO LGN-COD-LN06 IN LGN.
           MOVE GTP-COD-IITS IN GTP        TO LGN-COD-LN07 IN LGN.

           MOVE GTP-SGV-ITSN IN GTP        TO WSS-SGV-ITSN IN WSS-VARI.
           MOVE WSS-SGV-ITSN IN WSS-VARI   TO LGN-COD-LN08 IN LGN.

           MOVE GTP-SGV-VTSN IN GTP        TO WSS-SGV-VTSN IN WSS-VARI.
           MOVE WSS-SGV-VTSN IN WSS-VARI   TO LGN-COD-LN09 IN LGN.

           MOVE GTP-COD-EITS IN GTP        TO LGN-COD-LN10 IN LGN.
           MOVE GTP-FEC-FCES IN GTP        TO LGN-COD-LN11 IN LGN.
           MOVE GTP-FEC-FING IN GTP        TO LGN-COD-LN12 IN LGN.
           MOVE GTP-CIC-UNIG IN GTP        TO LGN-COD-LN13 IN LGN.
           MOVE GTP-COD-MAND IN GTP        TO LGN-COD-LN14 IN LGN.
           MOVE GTP-COD-CUST IN GTP        TO LGN-COD-LN15 IN LGN.
           MOVE GTP-GLS-UBIC IN GTP(1:20)  TO LGN-COD-LN16 IN LGN.
           MOVE GTP-GLS-UBIC IN GTP(21:20) TO LGN-COD-LN17 IN LGN.
           MOVE GTP-GLS-UBIC IN GTP(41:10) TO LGN-COD-LN18 IN LGN.
           MOVE GTP-GLS-TIT1 IN GTP        TO LGN-COD-LN19 IN LGN.
           MOVE GTP-GLS-TIT2 IN GTP        TO LGN-COD-LN20 IN LGN.
           MOVE GTP-GLS-TIT3 IN GTP        TO LGN-COD-LN21 IN LGN.

       FIN-LLENAR-ANTES.
           EXIT.

       LLENAR-DESPUES SECTION.
       INI-LLENAR-DESPUES.
      *------------------
           MOVE SPACES               TO  LGN.

      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
           IF SCR-CMND = WSS-CTE-ING
              MOVE WSS-CTE-ING  TO LGN-COD-EVEN IN LGN
              MOVE WSS-CTE-I    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2

           IF SCR-CMND = 'MOD'
      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
      *       MOVE 'MOD'  TO  LGN-COD-EVEN IN LGN.
              MOVE WSS-CTE-MOD  TO  LGN-COD-EVEN IN LGN
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
              MOVE 'M'    TO  LGN-COD-TACC IN LGN
                              LGN-COD-STAT IN LGN.

           IF SCR-CMND = 'ELI'
      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
      *       MOVE 'ELI'  TO LGN-COD-EVEN IN LGN.
              MOVE WSS-CTE-ELI  TO LGN-COD-EVEN IN LGN
              MOVE WSS-CTE-E    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2


           MOVE 'DES'                TO  LGN-COD-INST IN LGN.
           MOVE 2                    TO  LGN-NUM-CLGN IN LGN
                                         LGN-NUM-COPE IN LGN
                                         LGN-NUM-CCLI IN LGN
                                         LGN-NUM-CEVE IN LGN
                                         LGN-NUM-CAUT IN LGN.

           MOVE GTP-NUM-ITSN IN GTP        TO LGN-COD-LN01 IN LGN.
           MOVE GTP-COD-ITSN IN GTP        TO LGN-COD-LN02 IN LGN.
           MOVE GTP-FEC-FTRN IN GTP        TO LGN-COD-LN03 IN LGN.
           MOVE GTP-HRA-HRTR IN GTP        TO LGN-COD-LN03 IN LGN(11:6).
           MOVE GTP-MSC-TTRN IN GTP        TO LGN-COD-LN04 IN LGN.
           MOVE GTP-COD-TTRN IN GTP        TO LGN-COD-LN05 IN LGN.
           MOVE GTP-COD-ATRN IN GTP        TO LGN-COD-LN06 IN LGN.
           MOVE GTP-COD-IITS IN GTP        TO LGN-COD-LN07 IN LGN.

           MOVE GTP-SGV-ITSN IN GTP        TO WSS-SGV-ITSN IN WSS-VARI.
           MOVE WSS-SGV-ITSN IN WSS-VARI   TO LGN-COD-LN08 IN LGN.

           MOVE GTP-SGV-VTSN IN GTP        TO WSS-SGV-VTSN IN WSS-VARI.
           MOVE WSS-SGV-VTSN IN WSS-VARI   TO LGN-COD-LN09 IN LGN.

           MOVE GTP-COD-EITS IN GTP        TO LGN-COD-LN10 IN LGN.
           MOVE GTP-FEC-FCES IN GTP        TO LGN-COD-LN11 IN LGN.
           MOVE GTP-FEC-FING IN GTP        TO LGN-COD-LN12 IN LGN.
           MOVE GTP-CIC-UNIG IN GTP        TO LGN-COD-LN13 IN LGN.
           MOVE GTP-COD-MAND IN GTP        TO LGN-COD-LN14 IN LGN.
           MOVE GTP-COD-CUST IN GTP        TO LGN-COD-LN15 IN LGN.
           MOVE GTP-GLS-UBIC IN GTP(1:20)  TO LGN-COD-LN16 IN LGN.
           MOVE GTP-GLS-UBIC IN GTP(21:20) TO LGN-COD-LN17 IN LGN.
           MOVE GTP-GLS-UBIC IN GTP(41:10) TO LGN-COD-LN18 IN LGN.
           MOVE GTP-GLS-TIT1 IN GTP        TO LGN-COD-LN19 IN LGN.
           MOVE GTP-GLS-TIT2 IN GTP        TO LGN-COD-LN20 IN LGN.
           MOVE GTP-GLS-TIT3 IN GTP        TO LGN-COD-LN21 IN LGN.

       FIN-LLENAR-DESPUES.
           EXIT.


       GRABAR-LGN SECTION.
      *===================
       INI-GRABAR-LGN.

           MOVE SCR-SISG TO FIO-SIST.

           EXEC CICS ASKTIME ABSTIME(WSS-LGM-ABSTIME)
           END-EXEC.

           PERFORM GET-FHOY.

           MOVE '1.0'               TO LGN-COD-VERS IN LGN.
           MOVE 'GTP'               TO LGN-COD-ENTF IN LGN
                                       LGN-COD-ENTO IN LGN
                                       LGN-COD-ENTE IN LGN
                                       LGN-COD-ENTC IN LGN
                                       LGN-COD-ENTA IN LGN.
           MOVE HOY-FHOY            TO LGN-FEC-FTRN IN LGN
                                       LGN-FEC-FLGN IN LGN
                                       LGN-FEC-FOPE IN LGN
                                       LGN-FEC-FEVE IN LGN
                                       LGN-FEC-FCLI IN LGN
                                       LGN-FEC-FAUT IN LGN.
           MOVE HOY-HHOY            TO LGN-HRA-HRTR IN LGN
                                       LGN-HRA-HLGN IN LGN
                                       LGN-HRA-HOPE IN LGN
                                       LGN-HRA-HEVE IN LGN
                                       LGN-HRA-HCLI IN LGN
                                       LGN-HRA-HAUT IN LGN.
           MOVE TSK-TERM-NUM        TO LGN-TSK-NUMF IN LGN
                                       LGN-TSK-NUMO IN LGN
                                       LGN-TSK-NUME IN LGN
                                       LGN-TSK-NUMC IN LGN
                                       LGN-TSK-NUMA IN LGN.
           MOVE WSS-LGM-ABSTIME     TO LGN-NUM-ABSF IN LGN
                                       LGN-NUM-ABSO IN LGN
                                       LGN-NUM-ABSE IN LGN
                                       LGN-NUM-ABSC IN LGN
                                       LGN-NUM-ABSA IN LGN.
           MOVE GTP-CIC-GTIA IN GTP TO LGN-CIC-IOPE IN LGN.
           MOVE GDD-CIC-DCLI IN GDD TO LGN-CIC-ICLI IN LGN.
      *MPB-INI 31-ENE-2018 LIMPIEZA CAMPO COD-OTRN
      *     MOVE EIBTRMID            TO LGN-COD-OTRN IN LGN.
           IF SCR-OFRM-SRV
               MOVE SCR-ORIG TO LGN-COD-OTRN IN LGN
           ELSE
               IF NOT SCR-OFRM-SRV
                   MOVE SPACES TO LGN-COD-OTRN IN LGN.
      *MPB-FIN
           MOVE SCR-USER            TO LGN-COD-ATRN IN LGN
                                       LGN-COD-AUTO IN LGN.
           MOVE EIBTRNID            TO LGN-COD-TCIC IN LGN.


      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
           IF SCR-CMND = WSS-CTE-ING
                         MOVE WSS-CTE-ING  TO LGN-COD-CMND IN LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
           IF SCR-CMND = 'MOD'
                         MOVE 'MOD'  TO LGN-COD-CMND IN LGN.
           IF SCR-CMND = 'ELI'
                         MOVE 'ELI'  TO LGN-COD-CMND IN LGN.

            MOVE FIO-PUT TO FIO-CMND.
            PERFORM GNS-FIO-LGN.
       FIN-GRABAR-LGN.
           EXIT.
      *MPS-FIN 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
*% END
*% IF EOF
      *<<<< EOF
       BUS-ULT-GTP SECTION.   
       INI-BUS-ULT-GTP.
           MOVE GTP-CAI-GTIA IN GTP-FLD TO GTP-CAI-GTIA IN GTP.
           MOVE GTP-IIC-GTIA IN GTP-FLD TO GTP-IIC-GTIA IN GTP.
           MOVE GTP-NUM-ITSN IN GTP-FLD TO GTP-NUM-ITSN IN GTP.
           MOVE 'GTP-KEY-IGTP' TO FIO-AKEY.
           MOVE '00' TO FIO-STAT.
*% IF PGM_DTC
           MOVE 9999 TO GTP-COD-ITSN IN GTP.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM BGL-FIO-GTP.
           IF FIO-STAT-OKS AND
              GTP-CAI-GTIA IN GTP-FLD = GTP-CAI-GTIA IN GTP AND
              GTP-IIC-GTIA IN GTP-FLD = GTP-IIC-GTIA IN GTP AND
              GTP-NUM-ITSN IN GTP-FLD = GTP-NUM-ITSN IN GTP
               NEXT SENTENCE
           ELSE
               MOVE ZEROES TO GTP-COD-ITSN IN GTP.
*% ELSE
           MOVE 0 TO GTP-COD-ITSN IN GTP.

       LUP-BUS-ULT-GTP.
           ADD 1 TO GTP-COD-ITSN IN GTP.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GTP.
           IF FIO-STAT-OKS
               GO TO LUP-BUS-ULT-GTP.
           SUBTRACT 1 FROM GTP-COD-ITSN IN GTP.
*% END
       FIN-BUS-ULT-GTP.
           EXIT.

       MOD-GVT SECTION.
       INI-MOD-GVT.
           MOVE GTP-CAI-GTIA IN GTP-FLD TO GVT-CAI-GTIA IN GVT
           MOVE GTP-IIC-GTIA IN GTP-FLD TO GVT-IIC-GTIA IN GVT
           MOVE GTP-NUM-ITSN IN GTP-FLD TO GVT-COD-TASN IN GVT
           MOVE 'GVT-KEY-IGVT' TO FIO-AKEY
           MOVE FIO-GET-KEY-UPD TO FIO-CMND
           PERFORM BGL-FIO-GVT
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-MOD-GVT.

           MOVE 'I' TO GVT-MSC-STAT IN GVT.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF NOT FIO-STAT-OKS
              MOVE FIO-MENS TO FRM-MENS.

       FIN-MOD-GVT.
           EXIT.
*% IF PGM_PU
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
       COPY BGLBFGDO.
       COPY BGLBFVDO.
       COPY TABBFCAM.
      *Rutina CAM
       COPY GNSBINVC.
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
*% END
       COPY BGLBFGDG.
       COPY BGLBFACC.
       COPY BGLBFTAG.
       COPY BGLBFGVT.
      *PVG INI 15-OCT-2003
       COPY BGLBFGSO.
      *PVG FIN 15-OCT-2003

*% IF PGM_PU
      *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
       COPY GNSBFLGN.
       COPY BGLBFGDD.
      *MPS-FIN 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
      
*% END
      *MHM-INI 23-OCT-2003

       COPY GNSBGCPT.
      *MHM-FIN 23-OCT-2003
       COPY GNSBGPES.
      *PTC-INI-MAN
       PUT-ALL-GTP-PTC SECTION.
       INI-PUT-ALL-GTP-PTC.
       FIN-PUT-ALL-GTP-PTC.
           EXIT.
       ELI-GTP SECTION.
       INI-ELI-GTP.
           MOVE GTP-CAI-GTIA IN GTP-FLD TO GTP-CAI-GTIA IN GTP.
           MOVE GTP-IIC-GTIA IN GTP-FLD TO GTP-IIC-GTIA IN GTP.
           MOVE GTP-NUM-ITSN IN GTP-FLD TO GTP-NUM-ITSN IN GTP.
           MOVE 1                       TO GTP-COD-ITSN IN GTP.
       LUP-ELI-GTP.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM BGL-FIO-GTP.
           IF FIO-STAT-OKS AND
              GTP-CAI-GTIA IN GTP-FLD = GTP-CAI-GTIA IN GTP AND
              GTP-IIC-GTIA IN GTP-FLD = GTP-IIC-GTIA IN GTP AND
              GTP-NUM-ITSN IN GTP-FLD = GTP-NUM-ITSN IN GTP
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM BGL-FIO-GTP
               MOVE FIO-DEL TO FIO-CMND
               PERFORM BGL-FIO-GTP
               GO TO LUP-ELI-GTP.
       FIN-ELI-GTP.
           EXIT.
      *PTC-FIN-MAN
*% IF ( PGM_MCP OR PGM_MVS)
      *<<<< PGM_MVS AND PGM_PU
      * COPY GNSBVCOD.
      * COPY GNSBVTAB.
      *>>>>
*% END
      *>>>>
*% END
