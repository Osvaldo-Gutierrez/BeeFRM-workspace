*%! PARA MANEJAT DATACOM DESDE AMBIENTE VSAM INTERACTIVO
*%! INCLUDE 'BGLSRC:GNSVSIDTC.SRC'
*% FRM = 'GSO'
*% REG = 'GSO'
*% VSNPQ = "06.06.29"
*% FNCPQ = "OWFBGL"
*% VSNPU = "06.06.29"
*% FNCPU = "OWFBGL"
*% PGM_PTC = TRUE
*% LARGO_TOTAL_COMMAREA = 255
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
      *PVG INI 15-OCT-2003
           02 SCR-COD-GSO-ANT                      PIC X(02).
           02 SCR-COD-JUD-ANT                      PIC X(02).
           02 SCR-COD-TPRO                         PIC X(01).
      *PVG FIN 15-OCT-2003
      *>>>>
*%END
*% IF CMT_ID AND PGM_PU
      *<<<<
      *=====================================================*           
      * MANTENCION [AFRI] 10/07                             *           
      * Comando AEJ                                         *           
      * Si el estado pasa de 04 a 05 validar que los        *           
      * campos obligatorios en GLE se encuentran ingresados *           
      *=====================================================*           
      *>>>>
*% END
*% IF PGM_INI
      *<<<<
      *SGS-INI  23/04/2004                                              
      *COPY GNSBGDTC.                                                   
      *SGS-FIN  23/04/2004                                              
      *RCI-INI 05-03-04                                                 
      *    DISPLAY 'BGLPUGSO INI 03-02-2004 P1'.                        
      *RCI-FIN 05-03-04                                                 
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
      *CGL-INI  11-SEP-2003 14:47:07
*% IF PGM_PQ
       COPY TABBRCAM.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.        
*% END
       COPY BGLWXGSL.                                                  
*% IF PGM_PU
       COPY BGLBRTAS.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAS-REQA==.        
*% END
       COPY BGLBRGSE.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSE-REQA==.
       COPY BGLBRGLE.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GLE-REQA==.
      *CGL-FIN  11-SEP-2003 14:47:13
      *PVG INI 15-OCT-2003
       COPY BGLBRGAP.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GAP-REQA==.
      *PVG FIN 15-OCT-2003
       COPY BGLBRTAG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       COPY SGCBRDBC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY TABBRUSR.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGCPT.
       COPY GNSWGSTR.
       COPY GNSWGPES.
       COPY BGLBRGDD.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.
       COPY BGLBRGDG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY BGLBRGSL.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSL-REQA==.
       COPY BGLBRGVT.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.
       COPY BGLBRGUB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GUB-REQA==.
       COPY BGLBRGIM.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GIM-REQA==.
       COPY BGLBRGIN.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GIN-REQA==.
       COPY BGLBREST.
*% IF PGM_PQ
           COPY USPC113.
*% END
*% IF PGM_PU
      *********************************************
      *           MODULO   USPC113                *
      *********************************************
      *       DEFINICION IDENTIFICACION TS        *
      *********************************************

       01  UIB.
           02  FILLER                  PIC X(32) VALUE 'USPR002'.
       01  USP-LARGO-TS                PIC S9(4) COMP VALUE +150.
       01  USP-IDENTIFICACION.
           05  USP-TERMINAL            PIC X(04).
           05  USP-OPID-USU            PIC X(03).
           05  FILLER                  PIC X(01)  VALUE ' '.
       01  USP-LLENA-VECTOR            PIC X(1)   VALUE ' '.
       01  USP-USA-VECTOR              PIC X(1)   VALUE ' '.

      *********************************************
      *       DEFINICION AREA DE TRASPASO         *
      *********************************************

       01  AREA-TRASPASO.
           05  USP-PERMISO             PIC X(01).
           05  USP-PTA-NUM             PIC 9(03)  VALUE 0.
           05  USP-PTA-STR             PIC X(12)  VALUE SPACES.
           05  USP-AREA-COMUN.
               10  USP-TIPO-USUARIO.
                   15  USP-IDENT-TU    PIC X(03).
      *                TIPO DE USUARIO

                   15  USP-MODO-OP     PIC X(01).
      *                MODO OPERACION (CONSULTA/ACTUALIZACION)

               10  USP-SISTEMA.
                   15  USP-IDENT-SIS   PIC X(03).
      *                IDENTIFICACION DEL SISTEMA QUE SE ESTA PROCE_
      *                SANDO SEGUN USUARIOS Y PRIVILEGIOS

                   15  USP-GRUPO       PIC X(03).
      *                IDENTIFICACION DEL GRUPO DE SISTEMA QUE SE ESTA
      *                PROCESANDO SEGUN USUARIOS Y PRIVILEGIOS
      *

               10  USP-INDIC-PROCESO   PIC X(01).
      *            INDICADOR DE SISTEMA USUARIO Y PRIVILEGIO  ACTIVO

               10  USP-COD-OFICINA     PIC X(03).
      *            CODIGO DE LA OFICINA DEL USUARIO

               10  USP-COD-DEPTO       PIC X(03).
      *            CODIGO DEL DEPTO DEL USUARIO

               10  USP-COD-USUARIO     PIC X(12).
      *            CODIGO USUARIO (TABLA USR)

               10  USP-COD-TERMINAL    PIC X(04).
      *            CODIGO DE TERMINAL

               10  USP-OPID            PIC X(03).
      *            OPID DE USUARIO

               10  USP-FECHA.
      *            FECHA
                   15  USP-ANO         PIC X(02).
                   15  USP-MES         PIC X(02).
                   15  USP-DIA         PIC X(02).

               10  USP-HORA            PIC X(06).
      *            HORA

               10  USP-PASSWORD        PIC X(08).
      *            PASSWORD DE USUARIO(SOLO PARA CONECCION VIA RUTINA)

               10  USP-INDICADORES.
                   15  USP-USU-CMN1    PIC X(01).
      *            1   */CON       CONSULTA
      *            2   */MAN       CONSULTA Y MANTENCION
      *            3   */*         TODO
      *
                   15  USP-USU-CMN2    PIC X(01).
      *            P   *           PERMISO AL MENU
      *
                   15  USP-USU-CMN3    PIC X(01).
      *            P   */OFI       OTRAS OFICINAS
      *
                   15  USP-USU-CMN4    PIC X(01).
                   15  USP-USU-CMN5    PIC X(01).
                   15  USP-USU-CMN6    PIC X(01).
                   15  USP-USU-CMN7    PIC X(01).
                   15  USP-USU-CMN8    PIC X(01).
                   15  USP-USU-CMN9    PIC X(01).
                   15  USP-USU-CMN10   PIC X(01).
                   15  USP-USU-CMN11   PIC X(01).
                   15  USP-USU-CMN12   PIC X(01).
                   15  USP-USU-CMN13   PIC X(01).
                   15  USP-USU-CMN14   PIC X(01).
                   15  USP-USU-CMN15   PIC X(01).
                   15  USP-USU-CMN16   PIC X(01).
               10  USP-INDICADORES-RED REDEFINES USP-INDICADORES.
                   15  USP-USU-CMN-ARR OCCURS 16 TIMES   PIC X(01).
      *
      *            INDICADORES QUE  INDICAN PRIVILEGIO DE USUARIOS
      *
               10  FILLER              PIC X(78).
      *            DISPONIBLE USO FUTURO
      *
      *********************************************
      *     AREAS PARA LECTURA DE TABLA "STR"     *
      *********************************************
      *
      *01  COPYDD USP-R-STR.USP-E-STR01(PROD).
       01  USP-E-STR01.
           02  USP-CLV-STR-1.
               03  USP-COD-GST     PICTURE X(3).
               03  USP-COD-STR     PICTURE X(12).
           02  USP-COD-PTA         PICTURE X(3).
      *
       01  REQ-AREA.
               05  COD-CMND            PIC X(005).
               05  NOM-TABL            PIC X(003).
               05  NOM-CLAV            PIC X(005).
               05  RET-CODI            PIC X(002).
               05  RET-INTE            PIC X(001).
               05  NUM-BASE            PIC S9(004) COMP VALUE +120.
               05  NOM-REGI            PIC X(007).
               05  FILLER              PIC X(025).
               05  MAX-CONT            PIC S9(004) COMP.
               05  NOM-CONT            PIC S9(004) COMP.
               05  FILLER              PIC X(022).
               05  VAL-CLAV.
                   10  FECHA           PIC 9(008).
                   10  HORA            PIC 9(006).
      *
       01  ELEM-LIST.
               05  NOM-ELEM            PIC X(011).
               05  SEC-CODI            PIC X(001).
               05  FILLER              PIC X(005) VALUE SPACES.
      *
       01  REQ-AREA-STR.
               05  COD-CMND-STR        PIC X(005).
               05  NOM-TABL-STR        PIC X(003).
               05  NOM-CLAV-STR        PIC X(005).
               05  RET-CODI-STR        PIC X(002).
               05  RET-INTE-STR        PIC X(001).
               05  NUM-BASE-STR        PIC S9(004) COMP VALUE +120.
               05  NOM-REGI-STR        PIC X(007).
               05  FILLER              PIC X(025).
               05  MAX-CONT-STR        PIC S9(004) COMP.
               05  NOM-CONT-STR        PIC S9(004) COMP.
               05  FILLER              PIC X(022).
               05  VAL-CLAV-STR.
                   10  USP-COD-GST     PIC X(003).
                   10  USP-COD-STR     PIC X(012).
      *
       01  ELEM-LIST-STR.
               05  NOM-ELEM-STR        PIC X(011).
               05  SEC-CODI-STR        PIC X(001).
               05  FILLER              PIC X(005) VALUE SPACES.
      *
      *********************************************
      *           FIN   MODULO   USPC113          *
      *********************************************
*% END
                                                                       
       01  WSS-TIPOS.                                                  
           03 WSS-IND-NGSL VALUE 'N'     PIC X(01).                    
           03 WSS-COD-TAS  VALUE 'N'     PIC X(01).                    
           03 WSS-COD-RET  VALUE 'N'     PIC X(01).                    
           03 WSS-IND-SOLO VALUE 'N'     PIC X(01).                    

       01  WSS-VARI.
             03 WSS-KEY-IGSO.                                          
                05 WSS-NUM-IGSO                          PIC 9(12).    
                05 WSS-CIC-IGSO                          PIC X(12).    
             03 WSS-NUM-GAUX VALUE ZEROES                PIC 9(12).    
*% IF PGM_PU
             03 WSS-KEY-MGSO.                                           
                05 WSS-NUM-MGSO                          PIC 9(12).     
                05 WSS-CIC-MGSO                          PIC X(12).     
             03 WSS-NUM-MAUX VALUE ZEROES                PIC 9(12).     
*% END
      **     03 WSS-NUM-TIPO-ALF                           PIC X(06).
      **     03 WSS-NUM-TIPO REDEFINES  WSS-NUM-TIPO-ALF   PIC 9(06).
           03 WSS-IND-OK                                 PIC X(01).
           03 WSS-IND-GVT                                PIC X(01).
           03 WSS-IND-EST1.
              05 WSS-NUM-EST1                            PIC 9(02).
           03 WSS-COD-EST2.
              05 WSS-NUM-EST2                            PIC 9(02).

      **     03 WSS-TIPO-DIV.
      **        05 WSS-TIPO                                PIC X(03).
      **        05 WSS-DIV                                 PIC X(03).
           03 WSS-TSG-OPE.
              05 WSS-COD-TOPE                            PIC X(03).
              05 WSS-COD-SOPE                            PIC X(03).
      *
*% IF PGM_PQ
           03 WSS-COD-VCAM                               PIC X(06).     
           03 WSS-COD-PESO.                                             
              05 WSS-TIP-VCB-PESO                        PIC X(01).     
              05 FILLER                                  PIC X(05).     
           03 WSS-COD-UEFE  VALUE SPACES                 PIC X(10).     
           03 WSS-VAL-PESO                               PIC S9(11).    
           03 WSS-IND-MNAC    VALUE 'N'                  PIC X(01).     
      ** EVA-INI 09/07                                                  
      ** Indicadores tipo de solicitud [AFRI] **                        
                                                                        
           03  WSS-IND-TDIR   VALUE ZEROES     PIC 9(02).               
           03  WSS-IND-TIND   VALUE ZEROES     PIC 9(02).               
           03  WSS-IND-ETSB   VALUE 'NO'       PIC X(02).               
           03  WSS-AUX-ETSB   VALUE SPACES     PIC X(06).               
           03  WSS-I     VALUE ZEROES          PIC 9(02).               
           03  WSS-GLS-DATA.                                            
                 05  WSS-VEC-ETSB OCCURS 10 TIMES.                      
                     07 WSS-COD-ETSB   VALUE SPACES  PIC X(06).         
                                                                        
      ** EVA-FIN 09/07                                                  
*% END
           03 PGM-STAT-ADI.
              05  PGM-STAT-GDG           VALUE '23'   PIC X(02).
                  88 PGM-STAT-GDG-OKS    VALUE '00'.
                  88 PGM-STAT-GDG-NUL    VALUE '  '.
              05  PGM-STAT-GSL           VALUE '23'   PIC X(02).
                  88 PGM-STAT-GSL-OKS    VALUE '00'.
                  88 PGM-STAT-GSL-NUL    VALUE '  '.
           03 WSS-FEC-EDIT.
              05  WSS-NUM-DEDIT                 PIC 9(02).
              05  WSS-NUM-MEDIT                 PIC 9(02).
              05  WSS-NUM-SEDIT                 PIC 9(02).
              05  WSS-NUM-AEDIT                 PIC 9(02).
      *CGL-INI  11-SEP-2003 12:50:01
           03 WSS-FEC-EDII.
              05  WSS-NUM-DEDII                 PIC 9(02).
              05  WSS-NUM-MEDII                 PIC 9(02).
              05  WSS-NUM-SEDII                 PIC 9(02).
              05  WSS-NUM-AEDII                 PIC 9(02).
      *CGL-FIN  11-SEP-2003 12:50:09
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           MOVE TSK-TERM-ALF TO WSX-COD-TERM IN WSX-TSGSL.
      *>>>>
*% END
*% IF SCR_GIKY_VAL_IKY
      *<<<< SCR_GIKY_VAL_IKY
      *PTC-INI-MAN
           IF SCR-OFRM-SRV
              MOVE WSX-NOM-TSGSL  TO QUE-COLA
              MOVE 1 TO QUE-NITM
              MOVE WSX-LEN-TSGSL  TO QUE-LITM
              MOVE QUE-GET        TO QUE-CMND
              PERFORM GNS-PRO-QUE
              IF QUE-STAT = QUE-STAT-OKS
                 MOVE QUE-ITEM      TO WSX-TAB-GSL
                 MOVE WSX-GSL-NUM-SBGL TO GSO-NUM-SBGL IN GSO-FLD.
      *PTC-FIN-MAN
      *>>>>
*% END
*% IF FIN_HBL_IKY
      *<<<< FIN_HBL_IKY
      *PVG INI 14-OCT-2003
*% IF PGM_PQ
      *    IF SCR-CMND = 'ING'                                          
           IF SCR-CMND = 'ING' OR                                       
              SCR-CMND = 'INE'                                          
              MOVE FRM-CPIM-UBY TO GSO-NUM-SBGL-ATR.
*% END
*% IF PGM_PU
           IF SCR-CMND = 'ING'
              MOVE FRM-CPIM-UBY TO GSO-NUM-SBGL-ATR.
*% END
      *PVG FIN 14-OCT-2003
      *>>>>
*% END
*% IF FIN_HBL_FLD
      *>>>> FIN_HBL_FLD
      *CGL-INI  11-SEP-2003 12:08:00 
      *      IF SCR-CMND = 'AEG' 
             IF SCR-CMND = 'AEG' OR SCR-CMND = 'AEJ'
      *CGL-FIN  11-SEP-2003 12:08:35 
                GO TO FIN-HBL-FLD.

            MOVE FRM-CPIM-AEY   TO GSO-COD-ESGA-ATR IN GSO-FLD.
            MOVE FRM-CPIM-AEY   TO GSO-COD-ESGA-STP.
            MOVE FRM-CPIM-AEY   TO GSO-COD-EST2-ATR IN GSO-FLD.
            MOVE FRM-CPIM-AEY   TO GSO-COD-EST2-STP.
      *EVA                                                             
            IF (( SCR-CMND = 'ING' OR                                  
                 SCR-CMND = 'AEG') OR                                  
                (SCR-CMND = 'AEJ')) AND                                
                GSL-COD-TSOL IN GSL = 'R'                              
              MOVE FRM-CPIM-AEY TO GSO-COD-RSEG-ATR IN GSO-FLD         
              MOVE FRM-CPIM-AEY TO GSO-IND-PCUO-ATR IN GSO-FLD         
              MOVE FRM-CPIM-AEY TO GSO-NUM-CUOT-ATR IN GSO-FLD         
              MOVE 0            TO GSO-COD-RSEG-LEN IN GSO-FLD         
              MOVE -1           TO GSO-GLS-MENS-LEN IN GSO-FLD.        
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
      *CGL-INI  12-SEP-2003 11:41:04 
                                                                       
                                                                       
      *RCI DISPLAY 'BGLPQGSO WI 1 :' GSO-FLD.                          
                                                                       
           MOVE GSO-CAI-GTIA IN GSO-FLD TO GDG-CAI-GTIA IN GDG.        
           MOVE GSO-IIC-GTIA IN GSO-FLD TO GDG-IIC-GTIA IN GDG.        
           MOVE FIO-GET-KEY TO FIO-CMND.                               
           MOVE FIO-STAT TO PGM-STAT-GDG.                               
           PERFORM BGL-FIO-GDG.                                        
           IF NOT FIO-STAT-OKS                                         
               MOVE 'GDG    NEX' TO MSG-COD-MENS                       
               GO TO ERR-FND-KEY.                                      
      *RCI DISPLAY 'BGLPQGSO GDG ' GDG.                                
           IF SCR-CCPP = 'ACC' AND SCR-STAT = SCR-STAT-CON             
              GO TO FIN-VAL-OFI-USP-GSO.                               
                                                                       
           IF SCR-OFRM-SRV                                             
              GO TO FIN-VAL-OFI-USP-GSO.                               
           MOVE 'TAB'     TO FIO-SIST.                                 
           MOVE 'VSN'     TO TAB-COD-TTAB IN TAB.                      
           MOVE 'OFIUSP'  TO TAB-COD-CTAB IN TAB.                      
           MOVE FIO-GET-KEY TO FIO-CMND.                               
           PERFORM GNS-FIO-TAB.                                        
           IF NOT (FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S')         
              GO TO FIN-VAL-OFI-USP-GSO.                               
                                                                       
           COPY USPC143.                                               
           MOVE 'BGLGTUCG/CEN' TO USP-PTA-STR.                         
           COPY USPC103.                                               
           IF USP-PERMISO = 'P'                                        
              GO TO FIN-VAL-OFI-USP-GSO.                               
                                                                       
           IF USP-COD-OFICINA NOT = GDG-COD-OFIC IN GDG                
              MOVE 'USRNODEOFI' TO MSG-COD-MENS                        
              GO TO ERR-FND-KEY.                                       
                                                                       
       FIN-VAL-OFI-USP-GSO.                                            
                                                                       
       FIN-BUS-GDG.                                                    
      *EVA-INI-AFRI/FEB2006                                            
                                                                        
      ** Politicas de renovacion seguros y tasaciones [AFRI] **         
           IF SCR-CMND = 'INE'                                          
              GO TO CNT-FND-KEY.                                        
                                                                        
           IF SCR-CMND = 'ING'                                          
              PERFORM VAL-TIP-SOL                                       
              IF MSG-COD-MENS > SPACES                                  
                  GO TO ERR-FND-KEY                                     
              ELSE                                                      
                 IF GSL-COD-TSOL IN GSL = 'T' AND WSS-COD-TAS = 'S'     
                    MOVE 'GSOYAEXITAS' TO MSG-COD-MENS                  
                    GO TO ERR-FND-KEY                                   
                 ELSE                                                   
                    IF GSL-COD-TSOL IN GSL = 'R' AND WSS-IND-SOLO = 'N' 
                       MOVE 'ESTGSONO>=03' TO MSG-COD-MENS              
                       GO TO ERR-FND-KEY                                
                    END-IF                                              
                 END-IF                                                 
              END-IF                                                    
           END-IF.                                                      
                                                                        
      ** EVA-INI 09/07                                                  
      ** Lee tabla tipo y subtipo **                                    
                                                                        
           IF ((SCR-CMND = 'ING' AND                                    
                GSL-COD-TSOL IN GSL = 'R') AND                          
               (GDG-IND-EST1 IN GDG > '19' OR                           
                GDG-IND-EST1 IN GDG < '10'))                            
                 MOVE 'GDG NO CONST' TO MSG-COD-MENS                    
                 GO TO ERR-FND-KEY.                                     
                                                                        
      ** Valida que solo existan dos solicitudes directas **            
           IF WSS-IND-TDIR = 02 AND                                     
              GSL-COD-TSOL IN GSL = 'D'                                 
              MOVE 'MAXSOL   DIR' TO MSG-COD-MENS                       
               GO TO ERR-FND-KEY.                                       
                                                                        
      ** Valida que solo existan dos solicitudes indirectas **          
           IF WSS-IND-TIND = 02 AND                                     
              GSL-COD-TSOL IN GSL = 'I'                                 
              MOVE 'MAXSOL   IND' TO MSG-COD-MENS                       
               GO TO ERR-FND-KEY.                                       
                                                                        
      ** Valida que solo exista una sol directa y una sol indirecta **  
           IF (WSS-IND-TDIR = 01 AND                                    
               WSS-IND-TIND = 01)                                       
               MOVE 'MAXSOL   PER' TO MSG-COD-MENS                      
               GO TO ERR-FND-KEY.                                       
                                                                        
           IF ((WSS-IND-TDIR > 01 AND                                   
               GSL-COD-TSOL IN GSL = 'I') OR                            
              (WSS-IND-TIND > 01 AND                                    
               GSL-COD-TSOL IN GSL = 'D'))                              
               MOVE 'MAXSOL   PER' TO MSG-COD-MENS                      
               GO TO ERR-FND-KEY.                                       
                                                                        
      ** EVA-FIN 09/07                                                  
      *EVA-FIN-AFRI/FEB2006                                            
       CNT-FND-KEY.                                                    
      * EVA                                                             
           IF SCR-CMND = 'CON' AND                                     
              GSO-NUM-SBGL IN GSO-FLD NOT > ZEROES                     
              PERFORM BUSCA-NSOL.

      *RCI DISPLAY 'BGLPQGSO 03-02-2004 PASO 1'.                       
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      *PVG INI 14-OCT-2003
      *RCI DISPLAY 'BGLPQGSO 03-02-2004 PASO 2'.                       
           IF NOT FIO-STAT-OKS AND SCR-CMND = 'ELI'
              MOVE 'GSO    NEX' TO MSG-COD-MENS
              GO TO ERR-FND-KEY.
      *PVG FIN 14-OCT-2003
           MOVE GSO-COD-ESGA IN GSO TO SCR-COD-GSO-ANT IN SCR-VARI.
           MOVE GSO-COD-EST2 IN GSO TO SCR-COD-JUD-ANT IN SCR-VARI.

           MOVE GSO-NUM-SBGL IN GSO-FLD TO GSL-KEY-IGSL IN GSL.        
                                                                       
      *RCI DISPLAY 'BGLPQGSO WI 2 :' GSO-FLD.                          
      *RCI DISPLAY 'BGLPQGSO LEE GSL ' GSL.                            
                                                                       
           MOVE FIO-GET-KEY TO FIO-CMND.                               
           PERFORM BGL-FIO-GSL.                                        
           MOVE FIO-STAT TO PGM-STAT-GDG.                              
           IF NOT FIO-STAT-OKS                                         
               MOVE 'GSL    NEX' TO MSG-COD-MENS                       
               GO TO ERR-FND-KEY.                                      
           MOVE GSL-COD-TPRO IN GSL TO SCR-COD-TPRO IN SCR-VARI.       
                                                                        
           PERFORM LEE-TABLA.                                           
           IF (SCR-CMND = 'ING' AND                                     
               WSS-IND-ETSB = 'NO' AND                                  
               GSL-COD-TSOL IN GSL = 'D')                               
               MOVE 'ERRING   TSB' TO MSG-COD-MENS                      
               GO TO ERR-FND-KEY.                                       
                                                                        
           IF SCR-CMND = 'ING' AND                                      
              WSS-IND-ETSB = 'SI' AND                                   
              GSL-COD-TSOL IN GSL = 'D'                                 
              PERFORM LEE-ULT-GVT                                       
              PERFORM BUS-MNDA                                          
              IF GDG-COD-VCAM IN GDG = WSS-COD-UEFE                     
                 IF GVT-SGV-VCTS IN GVT > 6000                          
                    MOVE 'VALTAS>  PER' TO MSG-COD-MENS                 
                    GO TO ERR-FND-KEY                                   
                 END-IF                                                 
              ELSE                                                      
                 PERFORM CONVIERTE-UF                                   
                 IF WSS-VAL-PESO > 6000                                 
                    MOVE 'VALTAS>  PER' TO MSG-COD-MENS                 
                    GO TO ERR-FND-KEY                                   
                 END-IF                                                 
              END-IF                                                    
           END-IF.                                                      

      * Se realiza Consulta 
           IF SCR-CMND = 'CON' 
               GO TO FIN-FND-KEY.

      * Se intenta Actualizacion
           IF SCR-CMND = 'AEG'
               IF GSO-COD-ESGA IN GSO = '12'
                   MOVE 'GSO    CAN' TO MSG-COD-MENS
                   GO TO ERR-FND-KEY
               ELSE
      *            Se permite activar garantia
                   GO TO MOV-FEC-USER.
      *RCI DISPLAY 'BGLPQGSO 03-02-2004 PASO 3'.                       

      *    Valida si estado es ejecutado. 
           MOVE GDG-IND-EST1 IN GDG TO WSS-IND-EST1 IN WSS-VARI.
           MOVE GDG-COD-EST2 IN GDG TO WSS-COD-EST2 IN WSS-VARI.
           IF WSS-NUM-EST1 IN WSS-VARI > 10 OR
              WSS-NUM-EST2 IN WSS-VARI > 0
               MOVE 'GSO    NOING' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      *RCI DISPLAY 'BGLPQGSO 03-02-2004 PASO 4'.                       

      *    Se permite ingresar garantia 
       INGRESO-VALIDO.
            MOVE '01'     TO GSO-COD-ESGA IN GSO-FLD.
      *PVG INI 14-OCT-2003
           MOVE SPACES                 TO FRM-GLS-CLAS IN GSO-FLD.
           MOVE SPACES                 TO FRM-GLS-TPOL IN GSO-FLD.

           MOVE GDG-COD-TOPE IN GDG    TO TAG-COD-TOPE IN TAG.
           MOVE GDG-COD-SOPE IN GDG    TO TAG-COD-SOPE IN TAG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-TAG.
           IF NOT FIO-STAT-OKS
              GO TO CON-FND-KEY.

           IF TAG-COD-CLAS IN TAG > SPACES
              MOVE 'BGL'               TO TAB-COD-SIST
              MOVE 'CLA'               TO TAB-COD-TTAB IN TAB
              MOVE TAG-COD-CLAS IN TAG TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              IF MSG-COD-MENS NOT > SPACES
                 MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-CLAS IN GSO-FLD.

      *RCI DISPLAY 'BGLPQGSO 03-02-2004 PASO 5'.                       

           IF TAG-COD-TPOL IN TAG > SPACES
              MOVE 'BGL'               TO TAB-COD-SIST
              MOVE 'POL'               TO TAB-COD-TTAB IN TAB
              MOVE TAG-COD-TPOL IN TAG TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              IF MSG-COD-MENS NOT > SPACES
                 MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-TPOL IN GSO-FLD.
       CON-FND-KEY.
      *PVG FIN 14-OCT-2003
           IF GDG-COD-TOPE IN GDG > SPACES
              MOVE 'TAB'  TO TAB-COD-SIST                 
              MOVE 'TIO ' TO TAB-COD-TTAB IN TAB         
              MOVE GDG-COD-TOPE IN GDG TO TAB-COD-CTAB IN TAB 
              PERFORM BUS-TAB                                    
              MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-TOPE IN GSO-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-TOPE IN GSO-FLD.

           IF GDG-COD-SOPE IN GDG > SPACES
      *BUS-TAB Busca codigo de tabla
              MOVE 'TAB' TO TAB-COD-SIST
              MOVE 'AUX' TO TAB-COD-TTAB IN TAB
              MOVE SPACES TO TAB-COD-CTAB IN TAB
              MOVE GDG-COD-TOPE IN GDG TO WSS-COD-TOPE IN WSS-VARI
              MOVE GDG-COD-SOPE IN GDG TO WSS-COD-SOPE IN WSS-VARI
              MOVE WSS-TSG-OPE IN WSS-VARI  TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-SOPE IN GSO-FLD
           ELSE
              MOVE SPACES TO FRM-GLS-SOPE IN GSO-FLD.             
      *CGL-FIN  7-SEP-2003 15:43:28 

      *Busca Nombre del Cliente.
           MOVE GSO-NUM-SBGL IN GSO-FLD TO GSL-NUM-SBGL IN GSL.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GSL.
           IF NOT FIO-STAT-OKS
              MOVE 'TAB'        TO MSG-COD-SIST
              MOVE 'SOL  NOEXI' TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO DBC-GLS-NOMC IN GSO-FLD
              GO TO CONTINUA-USR-PA.
      *RCI DISPLAY 'BGLPQGSO 03-02-2004 PASO 6'.                       

            MOVE GSL-CIC-DCLI IN GSL TO DBC-CIC-ICLI IN DBC.
            MOVE 'DBC-KEY-IDBC'  TO FIO-AKEY.
            MOVE FIO-GET-KEY     TO FIO-CMND.
            PERFORM SGC-FIO-DBC.
            IF FIO-STAT-OKS
               MOVE '00' TO PGM-STAT-DBC
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN            TO DBC-GLS-NOMC IN GSO-FLD
            ELSE
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE 'CLI    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO DBC-GLS-NOMC IN GSO-FLD
               GO TO CONTINUA-USR-PA.

       CONTINUA-USR-PA.
      *RCI DISPLAY 'BGLPQGSO 03-02-2004 PASO 7'.                       
                                                                       
      *BUS-TAB Glosa de estado GDG.
           IF GDG-IND-EST1 IN GDG > SPACES
             MOVE 'BGL' TO TAB-COD-SIST
             MOVE 'ES1'                TO TAB-COD-TTAB IN TAB
             MOVE GDG-IND-EST1 IN GDG  TO TAB-COD-CTAB IN TAB
             PERFORM BUS-TAB
             MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-EST1 IN GSO-FLD.
      *BUS-TAB Glosa de estado GSO.
           IF GSO-COD-ESGA IN GSO-FLD > SPACES
               MOVE 'BGL'  TO TAB-COD-SIST
               MOVE 'EGS ' TO TAB-COD-TTAB IN TAB
               MOVE GSO-COD-ESGA IN GSO-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-ESGA IN GSO-FLD.
       MOV-FEC-USER.
      *RCI DISPLAY 'BGLPQGSO 03-02-2004 EN MOV-FEC-USER'.              
                                                                       
           PERFORM GET-FHOY.
           MOVE HOY-DHOY TO WSS-NUM-DEDIT.
           MOVE HOY-MHOY TO WSS-NUM-MEDIT.
           MOVE HOY-SHOY TO WSS-NUM-SEDIT.
           MOVE HOY-AHOY TO WSS-NUM-AEDIT.
           MOVE WSS-FEC-EDIT TO FRM-FEC-ESGA IN GSO-FLD.
           IF SCR-USER NOT > SPACES
               MOVE SPACES TO SCR-USER.
           MOVE SCR-USER TO GSO-COD-USER IN GSO-FLD.
      *Nombre de ejecutivo.
           IF GSO-COD-USER IN GSO-FLD > SPACES                      
               MOVE GSO-COD-USER IN GSO-FLD TO USR-COD-USER IN USR
               PERFORM BUS-USR
               MOVE USR-GLS-DESC IN USR TO FRM-GLS-USER IN GSO-FLD  
           ELSE                                                     
               MOVE SPACES              TO FRM-GLS-USER IN GSO-FLD. 

           MOVE PGM-STAT-GSO TO FIO-STAT.
           GO TO FIN-FND-KEY.
      *RCI DISPLAY 'BGLPQGSO 03-02-2004 PASO 8'.                       


      * Se intenta eliminar
                MOVE PGM-STAT-GSO TO FIO-STAT.
               
           IF SCR-CMND = 'ELI'
               IF GSO-COD-ESGA IN GSO = '01'
      *            Se permite eliminar garantia
                   GO TO FIN-FND-KEY
               ELSE
                   MOVE 'GSOESGA NO01' TO MSG-COD-MENS
                   GO TO ERR-FND-KEY.

           GO TO FIN-FND-KEY.

       ERR-FND-KEY.
      *RCI DISPLAY 'BGLPQGSO 03-02-2004 EN ERR-FND-KEY'.               
           MOVE 'S' TO SCR-IERR.
           MOVE 'BGL' TO MSG-COD-SIST.

           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE SCR-STAT-CON TO SCR-STAT.
           MOVE '00' TO FIO-STAT.
           GO TO FIN-FND-KEY.
      *>>>>
*% END
*% IF INI_CMN_ACC
      *<<<< INI_CMN_ACC
      *>>>>
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
      *>>>>
*% END
*% IF CMN_ING
      *<<<< CMN_ING
           MOVE FRM-NUM-DSGA IN GSO-FLD TO GSO-NUM-DSOL IN GSO.         
           MOVE FRM-NUM-MSGA IN GSO-FLD TO GSO-NUM-MSOL IN GSO.
           MOVE FRM-NUM-SSGA IN GSO-FLD TO GSO-NUM-SSOL IN GSO.
           MOVE FRM-NUM-ASGA IN GSO-FLD TO GSO-NUM-ASOL IN GSO.
      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
            IF NOT FIO-STAT-OKS
      *         Error inconsistencia en el ingreso : informar
                MOVE FIO-MENS TO FRM-MENS
                GO TO FIN-CMN-ING. 
      *>>>>
*% END
*% IF INI_CMN_MOD
      *<<<<
           PERFORM KEY-ALL-GSO.                                         
      * EVA/AFRI                                                        
           IF (SCR-CMND = 'AEG' AND                                     
               GSO-COD-ESGA IN GSO-FLD = '03')                          
                PERFORM BUS-MAYOR-GSL                                   
                MOVE WSS-NUM-MGSO TO GSL-KEY-IGSL IN GSL                
                MOVE FIO-GET-KEY TO FIO-CMND                            
                PERFORM BGL-FIO-GSL                                     
                 IF NOT FIO-STAT-OKS                                    
                    GO TO FIN-CMN-MOD                                   
                 ELSE                                                   
                    IF GSL-COD-TSOL IN GSL = 'R'                        
                       MOVE GSO-CAI-GTIA IN GSO-FLD TO                  
                       TAS-CAI-GTIA IN TAS                              
                       MOVE GSO-IIC-GTIA IN GSO-FLD TO                  
                       TAS-IIC-GTIA IN TAS                              
                       MOVE FIO-GET-KEY TO FIO-CMND                     
                       PERFORM BGL-FIO-TAS                              
                       IF NOT FIO-STAT-OKS                              
                         GO TO FIN-CMN-MOD                              
                       ELSE                                             
                         MOVE FIO-GET-KEY-UPD TO FIO-CMND               
                         PERFORM BGL-FIO-TAS                            
                         IF NOT FIO-STAT-OKS                            
                            GO TO FIN-CMN-MOD                           
                         ELSE                                           
                            MOVE '14' TO TAS-IND-ESTA IN TAS            
                            MOVE 'RETASADA' TO TAS-GLS-EXCE IN TAS      
                            MOVE FIO-MOD TO FIO-CMND                    
                            PERFORM BGL-FIO-TAS.                        
      *>>>>
*% END
*% IF CMN_MOD
      *<<<< CMN_MOD

           IF SCR-CMND = 'AEG' 
              IF GSO-COD-ESGA IN GSO-FLD = '07'
                 MOVE GSO-CAI-GTIA IN GSO-FLD TO GSE-CAI-GTIA IN GSE
                 MOVE GSO-IIC-GTIA IN GSO-FLD TO GSE-IIC-GTIA IN GSE
                 MOVE 999                     TO GSE-NUM-IGSE IN GSE
                 MOVE FIO-GET-LEQ TO FIO-CMND
                 PERFORM BGL-FIO-GSE
                 IF NOT FIO-STAT-OKS
                    GO TO CONTINUAR-MOD
                 ELSE
                 IF GSE-CAI-GTIA IN GSE = GSO-CAI-GTIA IN GSO-FLD AND
                    GSE-IIC-GTIA IN GSE = GSO-IIC-GTIA IN GSO-FLD
                    MOVE FIO-GET-KEY-UPD TO FIO-CMND
                    PERFORM BGL-FIO-GSE
                    MOVE '02' TO GSE-COD-ESTA IN GSE
                    MOVE FIO-MOD TO FIO-CMND
                    PERFORM BGL-FIO-GSE.
      *CGL-INI  11-SEP-2003 14:47:23 
           IF SCR-CMND = 'AEJ' 
              IF GSO-COD-EST2 IN GSO-FLD = '05'
                 PERFORM ACTUALIZAR-GLE. 
      *CGL-FIN  11-SEP-2003 14:47:30  
       CONTINUAR-MOD.
      *CGL-FIN  11-SEP-2003 12:06:39 
           MOVE FRM-NUM-DSGA IN GSO-FLD TO GSO-NUM-DSOL IN GSO.         
           MOVE FRM-NUM-MSGA IN GSO-FLD TO GSO-NUM-MSOL IN GSO.
           MOVE FRM-NUM-SSGA IN GSO-FLD TO GSO-NUM-SSOL IN GSO.
           MOVE FRM-NUM-ASGA IN GSO-FLD TO GSO-NUM-ASOL IN GSO.
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
            IF NOT FIO-STAT-OKS
      *        Error inconsistencia en la modificacion : INFORMAR               
                MOVE FIO-MENS TO FRM-MENS
                GO TO FIN-CMN-MOD.
      *>>>>
*% END
*% IF CMN_ELI
      *<<<< CMN_ELI
      *>>>>
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI
            IF NOT FIO-STAT-OKS
      *        Error inconsistencia en la modificacion : INFORMAR               
                MOVE FIO-MENS TO FRM-MENS
                GO TO FIN-CMN-MOD.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       COPY GNSBGVSM.                                                   
       COPY BGLBFTAG.
      *CGL-INI  11-SEP-2003 14:47:38 
       COPY BGLBFGSE.
*% IF PGM_PU
       COPY BGLBFTAS.                                                   
*% END
       COPY BGLBFGLE.
      *CGL-FIN  11-SEP-2003 14:47:43 
      *PVG INI 15-OCT-2003
       COPY BGLBFGAP.
      *PVG FIN 15-OCT-2003
       COPY SGCBFDBC.
       COPY SGCBGCLI.
       COPY TABBBUSR.
       COPY TABBFUSR.
*% IF PGM_PQ
       COPY TABBFCAM.                                                   
*% END
       COPY BGLBFGDG.
       COPY BGLBFGDD.
       COPY BGLBFGSL.
       COPY BGLBFGVT.
       COPY BGLBFGUB.
       COPY BGLBFGIM.
       COPY BGLBFGIN.
      *CGL-INI  14-SEP-2003 17:52:10 
      * COPY BGLBFEST.
      *CGL-FIN  14-SEP-2003 17:52:20 
       COPY GNSBGPES.
       COPY GNSBBTAB.
       COPY GNSBGCPT.
       COPY GNSBGSTR.
       COPY GNSBPFEC.
       COPY GNSBVCOD.
       COPY GNSBVTAB.
      *CGL-INI  11-SEP-2003 14:47:51 
       ACTUALIZAR-GLE SECTION.
       INI-ACTUALIZAR-GLE.
           MOVE GSO-CAI-GTIA IN GSO-FLD TO GLE-CAI-GTIA IN GLE.
           MOVE GSO-IIC-GTIA IN GSO-FLD TO GLE-IIC-GTIA IN GLE.
           MOVE SPACES                  TO GLE-COD-PACR IN GLE.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM BGL-FIO-GLE.
       ACT-GLE.
           IF NOT FIO-STAT-OKS
              GO TO FIN-ACTUALIZAR-GLE
           ELSE
           IF GLE-CAI-GTIA IN GLE = GSO-CAI-GTIA IN GSO-FLD AND
              GLE-IIC-GTIA IN GLE = GSO-IIC-GTIA IN GSO-FLD
              MOVE FIO-GET-KEY-UPD TO FIO-CMND
              PERFORM BGL-FIO-GLE
      *PVG INI 15-OCT-2003
      *       MOVE '02' TO GLE-IND-ESTA IN GLE
              MOVE 'A'  TO GLE-IND-ESTA IN GLE
      *PVG FIN 15-OCT-2003
              MOVE FIO-MOD TO FIO-CMND
              PERFORM BGL-FIO-GLE
      *PVG INI 15-OCT-2003 Compatibilidad VSAM                          
              MOVE FIO-GET-NLS TO FIO-CMND                              
              PERFORM BGL-FIO-GLE                                       
      *PVG FIN 15-OCT-2003                                              
              MOVE FIO-GET-NXT TO FIO-CMND
              PERFORM BGL-FIO-GLE
              GO TO ACT-GLE.
       FIN-ACTUALIZAR-GLE.
           EXIT.
      *CGL-FIN  11-SEP-2003 14:47:59 
       LEE-GVA SECTION.
       INI-LEE-GVA.
           MOVE 'S' TO WSS-IND-GVT.
           MOVE 'S' TO WSS-IND-OK.
           MOVE GDG-CIC-GTIA IN GDG TO GVT-CIC-GTIA IN GVT.
           MOVE ZEROES              TO GVT-COD-TASN IN GVT.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF NOT FIO-STAT-OKS OR 
              GDG-CIC-GTIA IN GDG NOT = GVT-CIC-GTIA IN GVT OR
              GVT-MSC-STAT IN GVT NOT = 'A'
               MOVE 'N' TO WSS-IND-GVT
               MOVE 'N' TO WSS-IND-OK.
       FIN-LEE-GVA.
           EXIT.

       LEE-GIN SECTION.
       INI-LEE-GIN.
           IF WSS-IND-OK = 'N'
              GO TO FIN-LEE-GIN.
           MOVE GDG-CIC-GTIA IN GDG TO GIN-CIC-GTIA IN GIN.
           PERFORM BGL-FIO-GIN.
           IF NOT FIO-STAT-OKS 
               MOVE 'N' TO WSS-IND-OK.
       FIN-LEE-GIN.
           EXIT.

       LEE-GIM SECTION.
       INI-LEE-GIM.
           IF WSS-IND-OK = 'N'
              GO TO FIN-LEE-GIM.
           MOVE GDG-CIC-GTIA IN GDG TO GIM-CIC-GTIA IN GIM.
           PERFORM BGL-FIO-GIM.
           IF NOT FIO-STAT-OKS 
               MOVE 'N' TO WSS-IND-OK.
       FIN-LEE-GIM.
           EXIT.

       LEE-GUB SECTION.
       INI-LEE-GUB.
           IF WSS-IND-OK = 'N'
              GO TO FIN-LEE-GUB.
           MOVE GDG-CIC-GTIA IN GDG TO GUB-CIC-GTIA IN GUB.
           PERFORM BGL-FIO-GUB.
           IF NOT FIO-STAT-OKS 
               MOVE 'N' TO WSS-IND-OK.
       FIN-LEE-GUB.
           EXIT.

       LEE-OTRA-GSO SECTION.
       INI-LEE-OTRA-GSO.
           MOVE GDG-KEY-IGDG IN GDG TO GSO-KEY-IGDG IN GSO.
           MOVE 'GSO-KEY-IGDG' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM BGL-FIO-GSO.
       FIN-LEE-OTRA-GSO.
           EXIT.

      *EVA                                                             
       BUSCA-NSOL SECTION.                                             
       INI-BUSCA-NSOL.                                                 
           MOVE ZEROES  TO WSS-NUM-GAUX.                               
           MOVE ZEROES  TO WSS-NUM-IGSO.                               
           MOVE GSO-CAI-GTIA IN GSO-FLD TO GSO-CAI-GTIA IN GSO.        
           MOVE GSO-IIC-GTIA IN GSO-FLD TO GSO-IIC-GTIA IN GSO.        
           MOVE FIO-GET-NLS TO FIO-CMND.                               
       LUP-SIG-NSOL.                                                   
           MOVE 'GSO-KEY-IGDG' TO FIO-AKEY.                            
           PERFORM BGL-FIO-GSO.                                        
           IF (FIO-STAT-OKS AND                                        
               GSO-CAI-GTIA IN GSO-FLD = GSO-CAI-GTIA IN GSO AND       
               GSO-IIC-GTIA IN GSO-FLD = GSO-IIC-GTIA IN GSO)          
               MOVE GSO-KEY-IGSO IN GSO TO WSS-KEY-IGSO                
               IF WSS-NUM-IGSO > WSS-NUM-GAUX                          
                  MOVE WSS-NUM-IGSO TO WSS-NUM-GAUX                    
                  MOVE FIO-GET-NXT TO FIO-CMND                         
                  GO TO LUP-SIG-NSOL                                   
               ELSE                                                    
                   MOVE FIO-GET-NXT TO FIO-CMND                        
                   GO TO LUP-SIG-NSOL.                                 
           MOVE WSS-NUM-IGSO TO GSO-NUM-SBGL IN GSO-FLD.               
           MOVE WSS-CIC-IGSO TO GSO-CIC-GTIA IN GSO.                   
           MOVE GSO-CAI-GTIA IN GSO     TO GSO-CAI-GTIA IN GSO-FLD.    
           MOVE GSO-IIC-GTIA IN GSO     TO GSO-IIC-GTIA IN GSO-FLD.    
       FIN-BUSCA-NSOL.                                                 
           EXIT.                                                       
                                                                       
      *EVA-INI-AFRI/FEB2006                                            
       VAL-TIP-SOL SECTION.                                            
       INI-VAL-TIP-SOL.                                                
           MOVE 'S' TO WSS-IND-SOLO.                                   
           MOVE 'N' TO WSS-COD-TAS.                                    
           MOVE 'N' TO WSS-COD-RET.                                    
           MOVE SPACES TO MSG-COD-MENS.                                
           MOVE GSO-CAI-GTIA IN GSO-FLD TO GSO-CAI-GTIA IN GSO.        
           MOVE GSO-IIC-GTIA IN GSO-FLD TO GSO-IIC-GTIA IN GSO.        
                                                                       
           MOVE FIO-GET-NLS     TO FIO-CMND.                           
       LUP-VAL-TIP-SOL.                                                
           MOVE 'GSO-KEY-IGDG' TO FIO-AKEY.                            
           PERFORM BGL-FIO-GSO.                                        
           IF FIO-STAT-OKS  AND                                        
              GSO-CAI-GTIA IN GSO-FLD =  GSO-CAI-GTIA IN GSO AND       
              GSO-IIC-GTIA IN GSO-FLD =  GSO-IIC-GTIA IN GSO           
                IF GSO-NUM-SBGL IN GSO-FLD = GSO-NUM-SBGL IN GSO       
                     MOVE FIO-GET-NXT TO FIO-CMND                      
                     GO TO LUP-VAL-TIP-SOL                             
                ELSE                                                   
                    MOVE GSO-NUM-SBGL IN GSO TO GSL-KEY-IGSL IN GSL    
                    MOVE FIO-GET-KEY TO FIO-CMND                       
                    PERFORM BGL-FIO-GSL                                
                    IF NOT FIO-STAT-OKS                                
                        MOVE 'S' TO WSS-IND-NGSL                       
      *                 MOVE 'NUMSOL   NEX' TO MSG-COD-MENS            
                        GO TO FIN-VAL-TIP-SOL                          
                    ELSE                                               
*% IF PGM_PQ
                        PERFORM LEE-TSOL                                
*% END
                        IF GSL-COD-TSOL IN GSL = 'T'                   
                            MOVE 'S' TO WSS-COD-TAS                    
                            MOVE FIO-GET-NXT TO FIO-CMND               
                            GO TO LUP-VAL-TIP-SOL                      
                        ELSE                                           
                            MOVE 'S' TO WSS-COD-RET                    
                            IF ( GSO-COD-ESGA IN GSO = '03'  OR        
                                 GSO-COD-ESGA IN GSO > '03' )          
                                  MOVE FIO-GET-NXT TO FIO-CMND         
                                  GO TO LUP-VAL-TIP-SOL                
                            ELSE                                       
                                MOVE 'N' TO WSS-IND-SOLO               
                                MOVE FIO-GET-NXT TO FIO-CMND           
*% IF PGM_PU
                                GO TO LUP-VAL-TIP-SOL.
           MOVE GSO-NUM-SBGL IN GSO-FLD TO GSL-KEY-IGSL IN GSL.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GSL.
*% END
*% IF PGM_PQ
                                GO TO LUP-VAL-TIP-SOL                 
                            END-IF                                      
                        END-IF                                          
                    END-IF                                              
                END-IF                                                  
           END-IF.                                                      
*% END
       FIN-VAL-TIP-SOL.                                                 
           EXIT.                                                        
      * EVA-FIN-AFRI/FEB2006                                            
                                                                        
*% IF PGM_PQ
      *  EVA-INI    09/07                                               
      ** Busca tipo y subtipo en tabla politicas de renovacion **       
                                                                        
       LEE-TABLA SECTION.                                               
       INI-LEE-TABLA.                                                   
           MOVE 'NO'                TO WSS-IND-ETSB.                    
           MOVE GDG-COD-CGTA IN GDG TO WSS-AUX-ETSB.                    
           MOVE 'BGL'               TO TAB-COD-SIST FIO-SIST.           
           MOVE 'TSB'               TO TAB-COD-TTAB IN TAB.             
           MOVE 'TSB'               TO TAB-COD-CTAB IN TAB.             
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM GNS-FIO-TAB.                                         
           IF NOT (FIO-STAT-OKS AND                                     
               TAB-IND-VIGE IN TAB = 'S')                               
               GO TO FIN-LEE-TABLA.                                     
           MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-DATA.                    
           PERFORM BUSCA-TSB.                                           
       FIN-LEE-TABLA.                                                   
           EXIT.                                                        
                                                                        
       BUSCA-TSB SECTION.                                               
       INI-BUSCA-TSB.                                                   
           MOVE 1 TO WSS-I.                                             
       LUP-BUSCA-TSB.                                                   
           IF WSS-COD-ETSB(WSS-I) = WSS-AUX-ETSB                        
              MOVE 'SI' TO WSS-IND-ETSB                                 
              GO TO FIN-BUSCA-TSB.                                      
       NXT-BUSCA-TSB.                                                   
           ADD 1 TO WSS-I.                                              
           IF WSS-I > 10                                                
               GO TO FIN-BUSCA-TSB                                      
           ELSE                                                         
               GO TO LUP-BUSCA-TSB.                                     
       FIN-BUSCA-TSB.                                                   
           EXIT.                                                        
                                                                        
       LEE-TSOL SECTION.                                                
       INI-LEE-TSOL.                                                    
           IF GSL-COD-TSOL IN GSL = 'D'                                 
              ADD 1 TO WSS-IND-TDIR.                                    
                                                                        
           IF GSL-COD-TSOL IN GSL = 'I'                                 
              ADD 1 TO WSS-IND-TIND.                                    
       FIN-LEE-TSOL.                                                    
           EXIT.                                                        
                                                                        
       LEE-ULT-GVT SECTION.                                             
       INI-LEE-ULT-GVT.                                                 
           MOVE GSO-CAI-GTIA IN GSO-FLD TO GVT-CAI-GTIA IN GVT.         
           MOVE GSO-IIC-GTIA IN GSO-FLD TO GVT-IIC-GTIA IN GVT.         
           MOVE 999                     TO GVT-COD-TASN IN GVT.         
           MOVE FIO-GET-LEQ TO FIO-CMND.                                
           PERFORM BGL-FIO-GVT.                                         
           IF NOT (FIO-STAT-OKS AND                                     
              GSO-CAI-GTIA IN GSO-FLD = GVT-CAI-GTIA IN GVT AND         
              GSO-IIC-GTIA IN GSO-FLD = GVT-IIC-GTIA IN GVT)            
              GO TO FIN-LEE-ULT-GVT.                                    
       FIN-LEE-ULT-GVT.                                                 
           EXIT.                                                        
                                                                        
       CONVIERTE-UF SECTION.                                            
       INI-CONVIERTE-UF.                                                
           MOVE 'N' TO WSS-IND-MNAC.                                    
           MOVE GDG-COD-VCAM IN GDG  TO WSS-COD-VCAM.                   
           MOVE GVT-NUM-STSN IN GVT  TO CAM-NUM-SCAM IN CAM(1).         
           MOVE GVT-NUM-ATSN IN GVT  TO CAM-NUM-ACAM IN CAM(1).         
           MOVE GVT-NUM-MTSN IN GVT  TO CAM-NUM-MCAM IN CAM(1).         
           MOVE GVT-NUM-DTSN IN GVT  TO CAM-NUM-DCAM IN CAM(1).         
                                                                        
           IF GDG-COD-TVCM IN GDG = '0'                                 
              MOVE 'S' TO WSS-IND-MNAC                                  
              GO TO CONT-CONVIERTE-UF.                                  
                                                                        
           MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2).     
           MOVE WSS-COD-VCAM             TO CAM-COD-VCAM IN CAM(1).     
           MOVE WSS-COD-PESO             TO CAM-COD-VCAM IN CAM(2).     
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM TAB-FIO-CAM.                                         
           IF NOT (                                                     
              FIO-STAT-OKS AND CAM-IND-VIGE IN CAM = 'S'                
              )                                                         
               MOVE 'TAB'        TO MSG-COD-SIST                        
               MOVE 'CAM    NEX' TO MSG-COD-MENS                        
               GO TO FIN-CONVIERTE-UF.                                  
                                                                        
           MULTIPLY GVT-SGV-VCTS IN GVT                                 
                     BY CAM-SGV-VCAM    IN CAM                          
                 GIVING WSS-VAL-PESO ROUNDED.                           
                                                                        
           MOVE '0999  ' TO WSS-COD-VCAM.                               
       CONT-CONVIERTE-UF.                                               
           IF WSS-COD-VCAM  NOT = WSS-COD-PESO                          
              MOVE GDG-COD-VCAM IN GDG TO CAM-COD-VCAM IN CAM(1)        
           ELSE                                                         
              MOVE WSS-COD-UEFE TO CAM-COD-VCAM IN CAM(1).              
                                                                        
                                                                        
           MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2).     
           MOVE WSS-COD-PESO             TO CAM-COD-VCAM IN CAM(2).     
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM TAB-FIO-CAM.                                         
           IF NOT (                                                     
              FIO-STAT-OKS AND CAM-IND-VIGE IN CAM = 'S'                
              )                                                         
               MOVE 'TAB'        TO MSG-COD-SIST                        
               MOVE 'CAM    NEX' TO MSG-COD-MENS                        
               GO TO FIN-CONVIERTE-UF.                                  
                                                                        
           IF WSS-IND-MNAC = 'S'                                        
                 DIVIDE GVT-SGV-VCTS IN GVT                             
                     BY CAM-SGV-VCAM    IN CAM                          
                 GIVING WSS-VAL-PESO ROUNDED                            
           ELSE                                                         
                 DIVIDE WSS-VAL-PESO                                    
                     BY CAM-SGV-VCAM    IN CAM                          
                 GIVING WSS-VAL-PESO ROUNDED.                           
                                                                        
       FIN-CONVIERTE-UF.                                                
           EXIT.                                                        
                                                                        
       BUS-MNDA SECTION.                                                
       INI-BUS-MNDA.                                                    
           MOVE 'TAB'          TO FIO-SIST.                             
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.                  
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.                  
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.                             
           MOVE FIO-GET-KEY    TO FIO-CMND.                             
           PERFORM GNS-FIO-TAB.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'TAB'          TO MSG-COD-SIST                      
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS                      
               GO TO FIN-BUS-MNDA.                                      
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO.                    
                                                                        
           MOVE 'TAB'          TO FIO-SIST.                             
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.                  
           MOVE '0998  '       TO TAB-CIC-CTAB IN TAB.                  
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.                             
           MOVE FIO-GET-KEY    TO FIO-CMND.                             
           PERFORM GNS-FIO-TAB.                                         
           IF NOT FIO-STAT-OKS                                          
               GO TO FIN-BUS-MNDA.                                      
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-UEFE.                    
       FIN-BUS-MNDA.                                                    
           EXIT.                                                        
      ** EVA-FIN 09/07                                                  
                                                                        
      *>>>>
*% END
*% END
*% IF EOF_PU
      *<<<<
      * EVA-AFRI/SEP2006                                                
       BUS-MAYOR-GSL SECTION.                                           
       INI-BUS-MAYOR-GSL.                                               
           MOVE ZEROES TO WSS-NUM-MAUX.                                 
           MOVE ZEROES TO WSS-NUM-MGSO.                                 
           MOVE GSO-CAI-GTIA IN GSO-FLD TO GSO-CAI-GTIA IN GSO.         
           MOVE GSO-IIC-GTIA IN GSO-FLD TO GSO-IIC-GTIA IN GSO.         
           MOVE FIO-GET-NLS TO FIO-CMND.                                
       LUP-SIG-MOD.                                                     
           MOVE 'GSO-KEY-IGDG' TO FIO-AKEY.                             
           PERFORM BGL-FIO-GSO.                                         
           IF FIO-STAT-OKS AND                                          
              (GSO-CAI-GTIA IN GSO-FLD = GSO-CAI-GTIA IN GSO AND        
               GSO-IIC-GTIA IN GSO-FLD = GSO-IIC-GTIA IN GSO)           
               MOVE GSO-KEY-IGSO IN GSO TO WSS-KEY-MGSO                 
               IF WSS-NUM-MGSO > WSS-NUM-MAUX                           
                  MOVE WSS-NUM-MGSO TO WSS-NUM-MAUX                     
                  MOVE FIO-GET-NXT TO FIO-CMND                          
                  GO TO LUP-SIG-MOD                                     
               ELSE                                                     
                  MOVE FIO-GET-NXT TO FIO-CMND                          
                  GO TO LUP-SIG-MOD.                                    
       FIN-BUS-MAYOR-GSL.                                               
           EXIT.                                                        
      *>>>>
*% END
