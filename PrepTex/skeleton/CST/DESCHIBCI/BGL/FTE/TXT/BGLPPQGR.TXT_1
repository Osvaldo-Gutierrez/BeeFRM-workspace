       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID. BGLPPQGR.
       AUTHOR. ADA.
       DATE-WRITTEN. 26-NOV-1999 15:26:36
      *
      * PROGRAMA RECIBE MENSAJES DE UN PC CON REQUERIMIENTOS
      * RELACIONADOS CON LA 'CONSULTA DE GARANTIAS'
      *
       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGSYS.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGFRM.
       COPY GNSWGCPT.
       COPY GNSWVSCR.
       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGQUE.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY BGLWGQGR.
      *
       COPY BGLBRGAP.
       COPY BGLBRGDD.
       COPY BGLBRGDG.
       COPY BGLBRGDO.
       COPY BGLBRGDP.
       COPY BGLBRGES.
       COPY BGLBRGIN.
       COPY BGLBRGLE.
       COPY BGLBRGMO.
       COPY BGLBRGSE.
       COPY BGLBRGSI.
       COPY BGLBRGTP.
       COPY BGLBRGUB.
       COPY BGLBRGVT.
       COPY BGLBRGIM.
       COPY BGLBRGVE.
       COPY BGLBRTAG.
      *
       COPY SGCBRDBC.
       COPY TABBRUSR.
       COPY TABBROFI.
      *
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GAP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GES-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GIN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GLE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GMO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GTP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GUB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GIM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
      *
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.

      *RVM
       01  SND-SEND-CICS                              PIC X(3000).
       01  SND-SEND-LEN                        COMP   PIC S9(04).
      *
       01  SND-SEND VALUE SPACES.
           03 SND-HEAD-SEND.
      *
      *       Status Respuesta 0=OK ; 1=ERR
              05 SND-RES-STAT                         PIC X(0001).
      *
      *       Fecha Transaccion
              05 SND-FEC-FTRN                         PIC X(0008).
      *
      *       Hora Transaccion
              05 SND-HRS-HTRN                         PIC X(0006).
      *
      *       Indicador Mensajes Pendientes 0=NO ; 1=SI
              05 SND-IND-MSGP                         PIC X(0001).
      *
      *       Largo de la parte Variable del Mensaje
              05 SND-NUM-LENM                         PIC 9(0005).
      *
      *       Codigo Transaccion
              05 SND-COD-TRAN                         PIC X(0008).
      *
      *       Codigo Sistema
              05 SND-COD-SIST                         PIC X(0003).
      *
      *       Codigo Usuario
              05 SND-COD-USER                         PIC X(0012).
      *
      *       Password
              05 SND-COD-PASS                         PIC X(0008).
      *
      *       Filler Vacio y Fijo de 111 Caracteres
           03 SND-GLS-FILL                            PIC X(0111).
      *
      *    DATA a ser transmitida de OUTPUT
           03 SND-GLS-DOUT                            PIC X(1089).
      *
      *
       01  RCV-RECEIVE VALUE SPACES.
      *
      *    Header utilizado por el Driver de Comunicacion
           03 RCV-HEAD-DRIVE.
               05 RCV-HEAD-DRIVE-TRAN                 PIC X(008).
               05 RCV-HEAD-DRIVE-SIST                 PIC X(003).
               05 RCV-HEAD-DRIVE-USER                 PIC X(012).
               05 RCV-HEAD-DRIVE-PSSW                 PIC X(008).
      *
      *    Identificacion del TCP-IP
           03 RCV-IDEN-TCPIP                          PIC X(0006).
      *
      *    Indicador de Mensajes: I=Inicio, C=Continua,
      *                           F=Fin,    X=Msg.Unico
           03 RCV-IND-MENS                            PIC X(0001).
      *
      *    DATA a ser transmitida de INPUT
           03 RCV-GLS-DINP                            PIC X(1024).

      * Fin variables area de comunicacion BCI

       01  TSIDENT.
           03 TSKNO                    PIC S9(07) COMP-3.
           03 TERM                     PIC X(04).

       01  WSS-VARI.
      *LARGO RECEIVE = 31 + 6 + 1 + 1024 = 1062
           03 WSS-LEN-RCV    VALUE +1062     COMP    PIC S9(04).
      *LARGO SEND = 52 + 111 + 1089 = 1252
           03 WSS-LEN-SND      VALUE +1252     COMP  PIC S9(04).
           03 WSS-NUM-OCUR     VALUE 8               PIC 9(02).
           03 WSS-I                                  PIC 9(02).
           03 WSS-IACT                               PIC X(01).
           03 WSS-NOMC.
              05 WSS-NOMB                            PIC X(25).
              05 WSS-APAT                            PIC X(25).
              05 WSS-AMAT                            PIC X(25).
           03 WSS-FVEN.
              05 WSS-SVEN                            PIC 9(02).
              05 WSS-AVEN                            PIC 9(02).
              05 WSS-MVEN                            PIC 9(02).
              05 WSS-DVEN                            PIC 9(02).
           03 WSS-COLA.
              05 WSS-TERM     VALUE 'TR'             PIC X(02).
              05 WSS-TCPIP                           PIC X(06).
           03 WSS-DUE  VALUE SPACES.
              05 WSS-DUE-IDC                         PIC X(12).
              05 WSS-DUE-VRF                         PIC X(01).
           03 WSS-ANO.
              05 WSS-SANO                            PIC 9(02).
              05 WSS-AANO                            PIC 9(02).
           03 WSS-REG-GDD     VALUE SPACES           PIC X(108).
           03 WSS-ARR-DEUD.
              05 WSS-ARR-DEU OCCURS 5 TIMES.
                 07 WSS-ARR-IDC                      PIC X(12).
                 07 WSS-ARR-VRF                      PIC X(01).
                 07 WSS-ARR-MTO                      PIC S9(11)V9(04).
                 07 WSS-ARR-PCT                      PIC S9(03)V9(02).

           03 WSS-CIC-ICLI                           PIC X(12).
           03 WSS-MTO-X.
              05 WSS-MTO-NUME       VALUE ZEROES     PIC 9(11)V9(04).
           03 WSS-PCT-X.
              05 WSS-PCT-NUME       VALUE ZEROES     PIC 9(03)V9(02).
           03 WSS-OCMS              VALUE SPACES     PIC X(12).
           03 WSS-OMSJ              VALUE SPACES     PIC X(79).
           03 WSS-PVEZ-TS           VALUE 'S'        PIC X(01).
           03 WSS-PVEZ-SND          VALUE 'S'        PIC X(01).
           03 WSS-NUM-GARA          VALUE ZEROES     PIC 9(03).
      *

       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 FILLER                     PIC X(01).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.

      *RVM
           MOVE SPACES TO SND-SEND-CICS.
      *
           PERFORM GNS-ERR-QUE.
      *
           MOVE 'GNSPPMEN'  TO IDD-PROG FIO-PROG.
           MOVE IDD-VARI    TO SYS-CMMA.
           MOVE +507        TO SYS-TCMA.
           MOVE 'GNSPPIDD'  TO SYS-PROG.
           MOVE SYS-LINK    TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA TO IDD-VARI.

           PERFORM PROCESA-MSG.
       FIN-MAIN.
           MOVE RCV-IDEN-TCPIP TO  WSS-TCPIP.
           MOVE WSS-COLA TO QUE-COLA.
           MOVE QUE-DEL  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           EXEC CICS RETURN END-EXEC.
       EXT-MAIN.
           EXIT.

       PROCESA-MSG SECTION.
       INI-PROCESA-MSG.
      *
      *Inicializa variables
           MOVE '0'    TO SND-RES-STAT.
           MOVE SPACES TO QGR-OUTP.
           MOVE '0'    TO QGR-CRET.
      *Recibe Mensaje desde Cliente
           PERFORM RCV-MSG-INP-HST.
      *
           MOVE RCV-IDEN-TCPIP TO  WSS-TCPIP.
           MOVE WSS-COLA TO QUE-COLA.
           MOVE QUE-DEL  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
      *
           MOVE RCV-GLS-DINP TO QGR-INPU
           IF QGR-CMND = 'CON'
               IF QGR-TCMN = 'RES'
                   PERFORM PROCESA-CON-RES
               ELSE
               IF QGR-TCMN = 'DET'
                   PERFORM PROCESA-CON-DET
               ELSE
                   MOVE '1' TO QGR-CRET
                   MOVE 'COMANDO INEXISTENTE, REVISAR APLICACION'
                             TO QGR-MENS
                   MOVE QGR-LERR TO SND-NUM-LENM
           ELSE
               MOVE '1' TO QGR-CRET
               MOVE 'COMANDO INEXISTENTE, REVISAR APLICACION'
                         TO QGR-MENS
               MOVE QGR-LERR TO SND-NUM-LENM.
      *
            IF QGR-CRET = '1'
      *Envia Mensaje al Cliente Cuando hay error de aplicacion
                PERFORM ENV-MSG-OUT-HST-ULT.
       FIN-PROCESA-MSG.
           EXIT.

      *-------------------------------------------------------------

       RCV-MSG-INP-HST SECTION.
       INI-RCV-MSG-INP-HST.
           MOVE SPACES TO RCV-RECEIVE.
           EXEC CICS RECEIVE
                     INTO(RCV-RECEIVE)
                     LENGTH(WSS-LEN-RCV)
                     CONVID(EIBTRMID)
                     END-EXEC.
           MOVE EIBTRMID    TO TERM.
           MOVE EIBTASKN    TO TSKNO.
           IF EIBCONF = HIGH-VALUES
               EXEC CICS ISSUE CONFIRMATION
                         CONVID(TERM)
               END-EXEC.
       FIN-RCV-MSG-INP-HST.
           EXIT.

      *-------------------------------------------------------------

       PROCESA-CON-RES SECTION.
       INI-PROCESA-CON-RES.
           MOVE SPACES TO WSS-OCMS WSS-OMSJ.
           MOVE ALL '*' TO QGR-FILLER-RES.
           IF QGR-IDCC > SPACES
               PERFORM BUSCA-GAR-RES
           ELSE
               MOVE 'QGRIDC BLK'                 TO WSS-OCMS
               MOVE 'LLAVE DE ENTRADA EN BLANCO' TO WSS-OMSJ.
           IF WSS-OCMS > SPACES
               GO TO FIN-PROCESA-CON-RES.

      *LEE TS PARA ENVIAR MENSAJE
      *    MOVE         TO QUE-COLA.
           MOVE 1       TO QUE-NITM.
      *MHM MOVE +1024   TO QUE-LITM.
           MOVE +1043   TO QUE-LITM.
           MOVE QUE-GET TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               MOVE '1'                              TO QGR-CRET
               MOVE 'ERROR INTERNO:COLA INEXISTENTE' TO QGR-MENS
               GO TO FIN-PROCESA-CON-RES.

           MOVE QUE-ITEM TO QGR-OUTP.
       LUP-PROCESA-CON-RES.
           ADD 1         TO QUE-NITM.
           MOVE QUE-GET  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
      *Esto indica que existe otro registro en la TS para
      *enviar
           IF QUE-STAT = QUE-STAT-OKS
               PERFORM ENV-MSG-OUT-HST
               MOVE QUE-ITEM TO QGR-OUTP
               GO TO LUP-PROCESA-CON-RES
           ELSE
      *Esto indica que NO existe otro registro en la TS para
      *enviar
               PERFORM ENV-MSG-OUT-HST-ULT.
       FIN-PROCESA-CON-RES.
            IF WSS-OCMS > SPACES
                MOVE '1'         TO QGR-CRET
                MOVE WSS-OMSJ TO QGR-MENS.
       EXT-PROCESA-CON-RES.
           EXIT.

       BUSCA-GAR-RES SECTION.
       INI-BUSCA-GAR-RES.
           MOVE ZEROES TO WSS-I.
           MOVE SPACES TO QGR-DOUT-RD1.
           MOVE ALL '*' TO QGR-FILLER-RES.
           MOVE QGR-IDCC TO DBC-IDC-ICLI IN DBC.
           MOVE 'DBC-IDC-ICLI' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               MOVE 'CLI    NEX' TO WSS-OCMS
               GO TO FIN-BUSCA-GAR-RES.

           MOVE DBC-CIC-ICLI IN DBC TO GDD-CIC-DCLI IN GDD.
           MOVE SPACES              TO GDD-KEY-AGDD IN GDD.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-LEE-GDD.
           MOVE 'GDD-KEY-IGDD' TO FIO-AKEY.
           PERFORM BGL-FIO-GDD.
           IF FIO-STAT-OKS AND
              DBC-CIC-ICLI IN DBC = GDD-CIC-DCLI IN GDD
               NEXT SENTENCE
           ELSE
               IF FIO-CMND = FIO-GET-NLS
                   MOVE 'GDD    NEX' TO WSS-OCMS
                   GO TO FIN-BUSCA-GAR-RES
               ELSE
               IF WSS-I > 0
                   PERFORM GRABA-TS-CON-RES
                   MOVE SPACES TO QGR-DOUT-RD1
                   MOVE ALL '*' TO QGR-FILLER-RES
                   GO TO FIN-BUSCA-GAR-RES
               ELSE
                   GO TO FIN-BUSCA-GAR-RES.

           MOVE GDD-KEY-AGDD IN GDD TO GDG-KEY-IGDG IN GDG.
           PERFORM LEE-GDG.
           IF WSS-OCMS > SPACES
               MOVE SPACES TO WSS-OCMS WSS-OMSJ
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-LEE-GDD.
           PERFORM LEE-GVT.
           PERFORM LEE-GSE.

           ADD 1 TO WSS-NUM-GARA.

           PERFORM MOVER-DATOS-CON-RES.
           IF WSS-I = 6
               MOVE ZEROES TO WSS-I
               PERFORM GRABA-TS-CON-RES
               MOVE SPACES TO QGR-DOUT-RD1
               MOVE ALL '*' TO QGR-FILLER-RES
               IF QUE-STAT NOT = QUE-STAT-OKS
                   GO TO FIN-BUSCA-GAR-RES
               ELSE
                   MOVE FIO-GET-NXT TO FIO-CMND
                   GO TO LUP-LEE-GDD
           ELSE
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-LEE-GDD.

       FIN-BUSCA-GAR-RES.
           IF WSS-OCMS > SPACES
               MOVE 'BGL'        TO MSG-COD-SIST
               MOVE WSS-OCMS  TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO WSS-OMSJ.
       EXT-BUSCA-GAR-RES.
           EXIT.

       MOVER-DATOS-CON-RES SECTION.
       INI-MOVER-DATOS-CON-RES.
      *Llena los datos de GAR en mensaje de salida
           ADD 1 TO WSS-I.
           MOVE GDG-KEY-IGDG    IN GDG TO QGR-OR-GARA(WSS-I).
           MOVE GDG-COD-TOPE    IN GDG TO QGR-OR-TIGA(WSS-I).
           MOVE GDG-COD-SOPE    IN GDG TO QGR-OR-STGA(WSS-I).
           MOVE GDG-COD-LGTA    IN GDG TO QGR-OR-LMGA(WSS-I).
           MOVE GDG-GLS-DGTA    IN GDG TO QGR-OR-DEG1(WSS-I).
           MOVE GDG-GLS-DGT1    IN GDG TO QGR-OR-DEG2(WSS-I).
           MOVE GVT-SGV-VCTS    IN GVT TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OR-VCOM(WSS-I).
           MOVE GVT-SGV-LTSN    IN GVT TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OR-VLIQ(WSS-I).
           MOVE GDG-IND-EST1    IN GDG TO QGR-OR-EGAR(WSS-I).
           MOVE GSE-NUM-DVTS    IN GSE TO QGR-OR-DVSE(WSS-I).
           MOVE GSE-NUM-MVTS    IN GSE TO QGR-OR-MVSE(WSS-I).
           MOVE GSE-NUM-SVTS    IN GSE TO QGR-OR-SVSE(WSS-I).
           MOVE GSE-NUM-AVTS    IN GSE TO QGR-OR-AVSE(WSS-I).
      *    PERFORM CAL-VTO-TSN.
      *    MOVE FEC-ITM1               TO QGR-OR-DVTN(WSS-I).
      *    MOVE FEC-ITM2               TO QGR-OR-MVTN(WSS-I).
      *    MOVE FEC-ITM3               TO QGR-OR-SVTN(WSS-I).
      *    MOVE FEC-ITM4               TO QGR-OR-AVTN(WSS-I).
           MOVE GDG-COD-VCAM    IN GDG TO QGR-OR-VCGA(WSS-I).
       FIN-MOVER-DATOS-CON-RES.
           EXIT.

       CAL-VTO-TSN SECTION.
       INI-CAL-VTO-TSN.
           IF NOT GVT-FEC-FTSN IN GVT > ZEROES
               MOVE ZEROES TO FEC-ITM1
               MOVE ZEROES TO FEC-ITM2
               MOVE ZEROES TO FEC-ITM3
               MOVE ZEROES TO FEC-ITM4
               GO TO FIN-CAL-VTO-TSN.

           MOVE GDG-COD-CGTA IN GDG TO TAG-COD-AGTA IN TAG.
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM BGL-FIO-TAG.
           IF NOT FIO-STAT-OKS
               MOVE 'TAG    NEX' TO WSS-OCMS
               GO TO FIN-CAL-VTO-TSN.

           IF TAG-COD-TPVT IN TAG = 'D'
              MOVE FEC-SUM-DIA TO FEC-CMND
              MOVE TAG-NUM-PVTS IN TAG TO FEC-NDIA
           ELSE
           IF TAG-COD-TPVT IN TAG = 'M'
              MOVE FEC-SUM-MES TO FEC-CMND
              MOVE TAG-NUM-PVTS IN TAG TO FEC-NMES
           ELSE
           IF TAG-COD-TPVT IN TAG = 'A'
              MOVE FEC-SUM-ANO TO FEC-CMND
              MOVE TAG-NUM-PVTS IN TAG TO FEC-NANO.

           MOVE GVT-FEC-FTSN IN GVT TO FEC-FVLD.
           MOVE FEC-DVLD TO FEC-ITM1.
           MOVE FEC-MVLD TO FEC-ITM2.
           MOVE FEC-AVLD TO FEC-ITM4.
           MOVE FEC-SVLD TO FEC-ITM3.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           PERFORM CAL-FEC.
           IF MSG-COD-MENS = SPACES
               NEXT SENTENCE
           ELSE
               MOVE ZEROES TO FEC-ITM1
               MOVE ZEROES TO FEC-ITM2
               MOVE ZEROES TO FEC-ITM3
               MOVE ZEROES TO FEC-ITM4.
       FIN-CAL-VTO-TSN.
           EXIT.

       GRABA-TS-CON-RES SECTION.
       INI-GRABA-TS-CON-RES.
           MOVE RCV-IDEN-TCPIP TO  WSS-TCPIP.
           MOVE WSS-COLA TO QUE-COLA.
      *MHM MOVE +1024    TO QUE-LITM.
           MOVE +1043    TO QUE-LITM.
           ADD  1        TO QUE-NITM.
           IF WSS-PVEZ-TS = 'S'
               MOVE 'N'      TO WSS-PVEZ-TS
               MOVE QGR-OUTP TO QUE-ITEM
           ELSE
               MOVE QGR-DOUT TO QUE-ITEM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               MOVE 'QGRQPUTERROR' TO WSS-OCMS.
           MOVE SPACES TO QGR-DOUT-RD1.
           MOVE ALL '*' TO QGR-FILLER-RES.
       FIN-GRABA-TS-CON-RES.
           EXIT.
      *-------------------------------------------------------------
       PROCESA-CON-DET SECTION.
       INI-PROCESA-CON-DET.
           MOVE SPACES TO  WSS-OCMS WSS-OMSJ.
           IF QGR-IGAR > SPACES
              PERFORM BUSCA-GAR-DET
           ELSE
              MOVE 'QGRIDC BLK'                 TO WSS-OCMS
              MOVE 'LLAVE DE ENTRADA EN BLANCO' TO WSS-OMSJ.
       FIN-PROCESA-CON-DET.
            IF WSS-OCMS > SPACES
                MOVE '1'         TO QGR-CRET
                MOVE WSS-OMSJ TO QGR-MENS.
       EXT-PROCESA-CON-DET.
           EXIT.

       BUSCA-GAR-DET SECTION.
       INI-BUSCA-GAR-DET.
           MOVE QGR-IGAR TO GDG-KEY-IGDG IN GDG.
           PERFORM LEE-GDG.
           PERFORM LEE-GDD.
           PERFORM LEE-GLE.
           PERFORM LEE-GSE.
           PERFORM LEE-GVT.
           PERFORM LEE-GTP.
           PERFORM LEE-GUB.
           PERFORM LEE-GES.
           PERFORM LEE-GAP.
           PERFORM LEE-GDO.
           PERFORM LEE-GIM.
           PERFORM LEE-GVE.

           IF WSS-OCMS > SPACES
               GO TO FIN-BUSCA-GAR-DET.

           PERFORM MOVER-DATOS-CON-DET.
           MOVE QGR-LCON TO SND-NUM-LENM.
           PERFORM ENV-MSG-OUT-HST-ULT.

       FIN-BUSCA-GAR-DET.
           IF WSS-OCMS > SPACES
               MOVE 'BGL'        TO MSG-COD-SIST
               MOVE WSS-OCMS  TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO WSS-OMSJ.
       EXT-BUSCA-GAR-DET.
           EXIT.

       MOVER-DATOS-CON-DET SECTION.
       INI-MOVER-DATOS-CON-DET.
      *Llena los datos de GAR en mensaje de salida
           MOVE SPACES                 TO QGR-DOUT-RD2.
           MOVE GDG-KEY-IGDG    IN GDG TO QGR-OD-GARA.
           MOVE DBC-IDC-ICLI    IN DBC TO QGR-OD-ICLI.
           MOVE DBC-VRF-ICLI    IN DBC TO QGR-OD-VRFC.
           MOVE WSS-DUE-IDC            TO QGR-OD-IDUE.
           MOVE WSS-DUE-VRF            TO QGR-OD-VRFD.
           MOVE GDO-COD-DOCU    IN GDO TO QGR-OD-IDEP.
           MOVE GDG-COD-OFIC    IN GDG TO QGR-OD-OFGA.
           MOVE GDG-COD-TOPE    IN GDG TO QGR-OD-TIGA.
           MOVE GDG-COD-SOPE    IN GDG TO QGR-OD-STGA.
           MOVE GDG-COD-VCAM    IN GDG TO QGR-OD-VCGA.
           MOVE GDG-NUM-DSOL    IN GDG TO QGR-OD-DSOG.
           MOVE GDG-NUM-MSOL    IN GDG TO QGR-OD-MSOG.
           MOVE GDG-NUM-SSOL    IN GDG TO QGR-OD-SSOG.
           MOVE GDG-NUM-ASOL    IN GDG TO QGR-OD-ASOG.
           MOVE GDG-NUM-DEST    IN GDG TO QGR-OD-DESG.
           MOVE GDG-NUM-MEST    IN GDG TO QGR-OD-MESG.
           MOVE GDG-NUM-SEST    IN GDG TO QGR-OD-SESG.
           MOVE GDG-NUM-AEST    IN GDG TO QGR-OD-AESG.
           MOVE GDG-NUM-DVTO    IN GDG TO QGR-OD-DVTG.
           MOVE GDG-NUM-MVTO    IN GDG TO QGR-OD-MVTG.
           MOVE GDG-NUM-SVTO    IN GDG TO QGR-OD-SVTG.
           MOVE GDG-NUM-AVTO    IN GDG TO QGR-OD-AVTG.
           MOVE GDG-COD-GGTA    IN GDG TO QGR-OD-GRDG.
           MOVE GDG-COD-LGTA    IN GDG TO QGR-OD-LMGA.
           MOVE GDG-CIC-EJOR    IN GDG TO QGR-OD-EJCG.
           MOVE GDG-IND-INOB    IN GDG TO QGR-OD-IOIG.
           MOVE GDG-NUM-DING    IN GDG TO QGR-OD-DIGA.
           MOVE GDG-NUM-MING    IN GDG TO QGR-OD-MIGA.
           MOVE GDG-NUM-SING    IN GDG TO QGR-OD-SIGA.
           MOVE GDG-NUM-AING    IN GDG TO QGR-OD-AIGA.
           MOVE GDG-NUM-DTRN    IN GDG TO QGR-OD-DACT.
           MOVE GDG-NUM-MTRN    IN GDG TO QGR-OD-MACT.
           MOVE GDG-NUM-STRN    IN GDG TO QGR-OD-SACT.
           MOVE GDG-NUM-ATRN    IN GDG TO QGR-OD-AACT.
           MOVE GDG-HRA-HRTR    IN GDG TO QGR-OD-HORA.
           MOVE GDG-COD-OTRN    IN GDG TO QGR-OD-TERM.
           MOVE GDG-COD-ATRN    IN GDG TO QGR-OD-USUA.
           MOVE GDG-CIC-UING    IN GDG TO QGR-OD-USUD.
           MOVE GDG-GLS-DGTA    IN GDG TO QGR-OD-DESC.
           MOVE GDG-GLS-DGT1    IN GDG TO QGR-OD-DES2.
           MOVE GDG-IND-EST1    IN GDG TO QGR-OD-EGAR.
           MOVE GDG-COD-EST2    IN GDG TO QGR-OD-EEJE.
           MOVE WSS-ARR-IDC(1)         TO QGR-OD-IDC2.
           MOVE WSS-ARR-VRF(1)         TO QGR-OD-VRF2.
           MOVE WSS-ARR-MTO(1)         TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OD-MLIM2.
           MOVE WSS-ARR-PCT(1)         TO WSS-PCT-NUME.
           MOVE WSS-PCT-X              TO QGR-OD-PLIM2.
           MOVE WSS-ARR-IDC(2)         TO QGR-OD-IDC3.
           MOVE WSS-ARR-VRF(2)         TO QGR-OD-VRF3.
           MOVE WSS-ARR-MTO(2)         TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OD-MLIM3.
           MOVE WSS-ARR-PCT(2)         TO WSS-PCT-NUME.
           MOVE WSS-PCT-X              TO QGR-OD-PLIM3.
           MOVE WSS-ARR-IDC(3)         TO QGR-OD-IDC4.
           MOVE WSS-ARR-VRF(3)         TO QGR-OD-VRF4.
           MOVE WSS-ARR-MTO(3)         TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OD-MLIM4.
           MOVE WSS-ARR-PCT(3)         TO WSS-PCT-NUME.
           MOVE WSS-PCT-X              TO QGR-OD-PLIM4.
           MOVE WSS-ARR-IDC(4)         TO QGR-OD-IDC5.
           MOVE WSS-ARR-VRF(4)         TO QGR-OD-VRF5.
           MOVE WSS-ARR-MTO(4)         TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OD-MLIM5.
           MOVE WSS-ARR-PCT(4)         TO WSS-PCT-NUME.
           MOVE WSS-PCT-X              TO QGR-OD-PLIM5.
           MOVE WSS-ARR-IDC(5)         TO QGR-OD-IDC6.
           MOVE WSS-ARR-VRF(5)         TO QGR-OD-VRF6.
           MOVE WSS-ARR-MTO(5)         TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OD-MLIM6.
           MOVE WSS-ARR-PCT(5)         TO WSS-MTO-NUME.
           MOVE WSS-PCT-X              TO QGR-OD-PLIM6.
           MOVE GLE-COD-ABOG IN GLE    TO QGR-OD-ABOG.
           MOVE GLE-COD-NTRO IN GLE    TO QGR-OD-NOTA.
           MOVE GLE-COD-RSII IN GLE    TO QGR-OD-RSII.
           MOVE GLE-IND-ITIN IN GLE    TO QGR-OD-PUPR.
           MOVE GLE-NUM-DESC IN GLE    TO QGR-OD-DPER.
           MOVE GLE-NUM-MESC IN GLE    TO QGR-OD-MPER.
           MOVE GLE-NUM-SESC IN GLE    TO QGR-OD-SPER.
           MOVE GLE-NUM-AESC IN GLE    TO QGR-OD-APER.
           MOVE GLE-COD-FICR IN GLE    TO QGR-OD-FOJA.
           MOVE GLE-NUM-NICR IN GLE    TO QGR-OD-NINS.
           MOVE GLE-NUM-AICR IN GLE    TO QGR-OD-AINS.
           MOVE GLE-COD-FPHG IN GLE    TO QGR-OD-PROH.
           MOVE GLE-NUM-NPHG IN GLE    TO QGR-OD-NUME.
           MOVE GLE-NUM-APHG IN GLE    TO QGR-OD-APRO.
           MOVE GLE-COD-REGI IN GLE    TO QGR-OD-CREG.
           MOVE GLE-COD-LREG IN GLE    TO QGR-OD-LREG.
           MOVE GSE-COD-RTSE IN GSE    TO QGR-OD-RESP.
           MOVE GSE-COD-PLZA IN GSE    TO QGR-OD-NPOL.
           MOVE GSE-COD-ICCS IN GSE    TO QGR-OD-CIAS.
           MOVE GSE-COD-CORS IN GSE    TO QGR-OD-CORR.
           MOVE GSE-SGV-SEGU IN GSE    TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OD-VSEG.
           MOVE GSE-COD-VCMS IN GSE    TO QGR-OD-VCSE.
           MOVE GSE-IND-ENDS IN GSE    TO QGR-OD-ENDO.
           MOVE GSE-NUM-DVSG IN GSE    TO QGR-OD-DVGS.
           MOVE GSE-NUM-MVSG IN GSE    TO QGR-OD-MVGS.
           MOVE GSE-NUM-SVSG IN GSE    TO QGR-OD-SVGS.
           MOVE GSE-NUM-AVSG IN GSE    TO QGR-OD-AVGS.
           MOVE GSE-NUM-DVTS IN GSE    TO QGR-OD-DVSE.
           MOVE GSE-NUM-MVTS IN GSE    TO QGR-OD-MVSE.
           MOVE GSE-NUM-SVTS IN GSE    TO QGR-OD-SVSE.
           MOVE GSE-NUM-AVTS IN GSE    TO QGR-OD-AVSE.
           MOVE GSE-IND-PCUO IN GSE    TO QGR-OD-PAGO.
           MOVE GSE-COD-COB1 IN GSE    TO QGR-OD-COB1.
           MOVE GSE-COD-COB2 IN GSE    TO QGR-OD-COB2.
           MOVE GSE-COD-COB3 IN GSE    TO QGR-OD-COB3.
           MOVE GSE-COD-COB4 IN GSE    TO QGR-OD-COB4.
           MOVE GSE-COD-COB5 IN GSE    TO QGR-OD-COB5.
           MOVE GVT-NUM-DTSN IN GVT    TO QGR-OD-DTAS.
           MOVE GVT-NUM-MTSN IN GVT    TO QGR-OD-MTAS.
           MOVE GVT-NUM-STSN IN GVT    TO QGR-OD-STAS.
           MOVE GVT-NUM-ATSN IN GVT    TO QGR-OD-ATAS.
           MOVE GVT-SGV-VCTS IN GVT    TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OD-VCTA.
           MOVE GVT-SGV-LTSN IN GVT    TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OD-VLIQ.
           MOVE GVT-COD-ITSD IN GVT    TO QGR-OD-ITAS.
           MOVE GVT-COD-ISVS IN GVT    TO QGR-OD-ISUP.
           MOVE GIM-COD-TCNS IN GIM    TO QGR-OD-TCON.
           MOVE GIM-VAL-TEIM IN GIM    TO QGR-OD-MTRR.
           MOVE GIM-VAL-COIM IN GIM    TO QGR-OD-MCTR.
           MOVE GVE-COD-MQEQ IN GVE    TO QGR-OD-TMAQ.
           MOVE GIM-COD-UMDI IN GIM    TO QGR-OD-UMED.
           MOVE GUB-COD-IALM IN GUB    TO QGR-OD-IALM.
           MOVE GUB-COD-AADN IN GUB    TO QGR-OD-IAGE.
           MOVE GUB-COD-UDOC IN GUB    TO QGR-OD-CUDO.
           MOVE GUB-GLS-CLLE IN GUB    TO QGR-OD-CLLE.
           MOVE GUB-GLS-NUME IN GUB    TO QGR-OD-NUDI.
           MOVE GUB-GLS-OTRS IN GUB    TO QGR-OD-OTRS.
           MOVE GUB-COD-COMU IN GUB    TO QGR-OD-CCOM.
           MOVE GES-CIC-IOPC IN GES    TO QGR-OD-IOPC.
           MOVE GES-NUM-IDLC IN GES    TO QGR-OD-IDLC.
           MOVE GES-COD-SIST IN GES    TO QGR-OD-SIST.
           MOVE GES-SGV-PLCR IN GES    TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OD-PLIM.
           MOVE GES-COD-MVLC IN GES    TO QGR-OD-MLIM.
           MOVE GES-SGV-VLCR IN GES TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OD-MTOL.
           MOVE GAP-CIC-ICLI IN GAP TO DBC-CIC-ICLI IN DBC.
           PERFORM LEE-DBC.
           MOVE DBC-IDC-ICLI    IN DBC TO QGR-OD-APRE.
           MOVE DBC-VRF-ICLI    IN DBC TO QGR-OD-VAPR.
           MOVE GAR-FOJ-ICR-ACR IN GAP TO QGR-OD-PFOJ.
           MOVE GAR-ANO-ICR-ACR IN GAP TO QGR-OD-PANO.
           MOVE GAR-NUM-ICR-ACR IN GAP TO QGR-OD-PNUM.
           MOVE GAP-SGV-MACR    IN GAP TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OD-MPRE.
           MOVE GTP-NUM-DCES    IN GTP TO QGR-OD-DCTP.
           MOVE GTP-NUM-MCES    IN GTP TO QGR-OD-MCTP.
           MOVE GTP-NUM-SCES    IN GTP TO QGR-OD-SCTP.
           MOVE GTP-NUM-ACES    IN GTP TO QGR-OD-ACTP.
           MOVE GTP-COD-IITS    IN GTP TO QGR-OD-IMER.
           MOVE GTP-SGV-ITSN    IN GTP TO QGR-OD-CANT.
           MOVE GTP-SGV-VTSN    IN GTP TO WSS-MTO-NUME.
           MOVE WSS-MTO-X              TO QGR-OD-VUNL.
           MOVE GTP-COD-EITS    IN GTP TO QGR-OD-ESIT.
           MOVE GDO-COD-DOCU    IN GDO TO QGR-OD-NDOC.
           MOVE GDO-COD-TDOC    IN GDO TO QGR-OD-TDOC.
           MOVE GDO-NUM-DCAP    IN GDO TO QGR-OD-DCAP.
           MOVE GDO-NUM-MCAP    IN GDO TO QGR-OD-MCAP.
           MOVE GDO-NUM-SCAP    IN GDO TO QGR-OD-SCAP.
           MOVE GDO-NUM-ACAP    IN GDO TO QGR-OD-ACAP.
           MOVE GDO-COD-IEMI    IN GDO TO QGR-OD-IEMI.
       FIN-MOVER-DATOS-CON-DET.
           EXIT.
      *-------------------------------------------------------------
       LEE-GDG SECTION.
       INI-LEE-GDG.
      *LEE GDG
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG    NEX' TO WSS-OCMS WSS-OCMS
               GO TO FIN-LEE-GDG.

      *Guarda el CIC del cliente
           MOVE DBC-CIC-ICLI IN DBC TO WSS-CIC-ICLI.

      *OBTIENE DUENO DE LA GARANTIA
           MOVE GDG-CIC-ICLI IN GDG TO DBC-CIC-ICLI IN DBC
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF FIO-STAT-OKS
               MOVE DBC-IDC-ICLI IN DBC TO WSS-DUE-IDC
               MOVE DBC-VRF-ICLI IN DBC TO WSS-DUE-VRF
           ELSE
               MOVE SPACES TO WSS-DUE.

      *Restaura el CIC del cliente
           MOVE WSS-CIC-ICLI TO DBC-CIC-ICLI IN DBC.
       FIN-LEE-GDG.
           EXIT.

       LEE-GDD SECTION.
       INI-LEE-GDD.
      *RVM-ADA-INI
           PERFORM INI-ARR-DEU VARYING WSS-I FROM 1 BY 1
                               UNTIL WSS-I > 5.
           MOVE 1 TO WSS-I.
      *RVM-ADA-FIN
      *Busca Glosa del Deudor
           MOVE SPACES              TO GDD-CIC-DCLI IN GDD.
           MOVE GDG-CAI-GTIA IN GDG TO GDD-CAI-GTIA IN GDD.
           MOVE GDG-IIC-GTIA IN GDG TO GDD-IIC-GTIA IN GDD.
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM BGL-FIO-GDD.
            IF NOT FIO-STAT-OKS AND
               (GDD-CIC-GTIA IN GDD = GDG-CIC-GTIA IN GDG)
                MOVE SPACES TO GDD
                MOVE ZEROES TO GDD-SGV-VLIM IN GDD
                MOVE ZEROES TO GDD-SGV-PLIM IN GDD
                MOVE ZEROES TO GDD-NUM-SING IN GDD
                MOVE ZEROES TO GDD-NUM-AING IN GDD
                MOVE ZEROES TO GDD-NUM-MING IN GDD
                MOVE ZEROES TO GDD-NUM-DING IN GDD
                MOVE ZEROES TO GDD-NUM-STRN IN GDD
                MOVE ZEROES TO GDD-NUM-ATRN IN GDD
                MOVE ZEROES TO GDD-NUM-MTRN IN GDD
                MOVE ZEROES TO GDD-NUM-DTRN IN GDD
                MOVE ZEROES TO GDD-HRA-HRTR IN GDD
                MOVE SPACES TO DBC
                GO TO FIN-LEE-GDD
            ELSE
      *RVM-ADA-INI
                MOVE GDD-CIC-DCLI IN GDD TO DBC-CIC-ICLI IN DBC
                PERFORM LEE-DBC
                MOVE DBC-IDC-ICLI IN DBC TO WSS-ARR-IDC(WSS-I)
                MOVE DBC-VRF-ICLI IN DBC TO WSS-ARR-VRF(WSS-I)
                MOVE GDD-SGV-VLIM IN GDD TO WSS-ARR-MTO(WSS-I)
                MOVE GDD-SGV-PLIM IN GDD TO WSS-ARR-PCT(WSS-I)
                ADD 1 TO WSS-I
      *RVM-ADA-FIN
      *GUARDO PRIMER REGISTRO GDD
                MOVE GDD TO WSS-REG-GDD.

      *RVM-ADA-INI
      *    MOVE SPACES TO WSS-ARR-DEUD.
      *    MOVE 1 TO WSS-I.
      *RVM-ADA-FIN
       NXT-LEE-GDD.
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM BGL-FIO-GDD.
           IF FIO-STAT-OKS AND
               (GDD-CIC-GTIA IN GDD = GDG-CIC-GTIA IN GDG)
      *RVM-ADA-INI
               AND WSS-I NOT > 5
      *RVM-ADA-FIN
                MOVE GDD-CIC-DCLI IN GDD TO DBC-CIC-ICLI IN DBC
                PERFORM LEE-DBC
                MOVE DBC-IDC-ICLI IN DBC TO WSS-ARR-IDC(WSS-I)
                MOVE DBC-VRF-ICLI IN DBC TO WSS-ARR-VRF(WSS-I)
                MOVE GDD-SGV-VLIM IN GDD TO WSS-ARR-MTO(WSS-I)
                MOVE GDD-SGV-PLIM IN GDD TO WSS-ARR-PCT(WSS-I)
                ADD 1 TO WSS-I
                GO TO NXT-LEE-GDD.

      *RECUPERO PRIMER REGISTRO GDD
           MOVE WSS-REG-GDD TO GDD.
           MOVE GDD-CIC-DCLI IN GDD TO DBC-CIC-ICLI IN DBC.
           PERFORM LEE-DBC.
       FIN-LEE-GDD.
           EXIT.

      *RVM-ADA-INI
       INI-ARR-DEU SECTION.
       INI-INI-ARR-DEU.
           MOVE SPACES TO WSS-ARR-IDC(WSS-I).
           MOVE SPACES TO WSS-ARR-VRF(WSS-I).
           MOVE ZEROES TO WSS-ARR-MTO(WSS-I).
           MOVE ZEROES TO WSS-ARR-PCT(WSS-I).
       FIN-INI-ARR-DEU.
           EXIT.
      *RVM-ADA-FIN

       LEE-GLE SECTION.
       INI-LEE-GLE.
      *LEE GLE
           MOVE GDG-CAI-GTIA IN GDG TO GLE-CAI-GTIA IN GLE.
           MOVE GDG-IIC-GTIA IN GDG TO GLE-IIC-GTIA IN GLE.
           MOVE GDG-COD-GGTA IN GDG TO GLE-COD-PACR IN GLE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GLE.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO GLE
               MOVE ZEROES TO GLE-NUM-SESC IN GLE
               MOVE ZEROES TO GLE-NUM-AESC IN GLE
               MOVE ZEROES TO GLE-NUM-MESC IN GLE
               MOVE ZEROES TO GLE-NUM-DESC IN GLE
               MOVE ZEROES TO GLE-NUM-NICR IN GLE
               MOVE ZEROES TO GLE-NUM-AICR IN GLE
               MOVE ZEROES TO GLE-NUM-NPHG IN GLE
               MOVE ZEROES TO GLE-NUM-APHG IN GLE
               MOVE ZEROES TO GLE-NUM-SING IN GLE
               MOVE ZEROES TO GLE-NUM-AING IN GLE
               MOVE ZEROES TO GLE-NUM-MING IN GLE
               MOVE ZEROES TO GLE-NUM-DING IN GLE
               MOVE ZEROES TO GLE-NUM-STRN IN GLE
               MOVE ZEROES TO GLE-NUM-ATRN IN GLE
               MOVE ZEROES TO GLE-NUM-MTRN IN GLE
               MOVE ZEROES TO GLE-NUM-DTRN IN GLE
               MOVE ZEROES TO GLE-HRA-HRTR IN GLE.
       FIN-LEE-GLE.
           EXIT.

       LEE-GSE SECTION.
       INI-LEE-GSE.
      *LEE GSE
           MOVE GDG-CAI-GTIA IN GDG TO GSE-CAI-GTIA IN GSE.
           MOVE GDG-IIC-GTIA IN GDG TO GSE-IIC-GTIA IN GSE.
           MOVE 999                 TO GSE-NUM-IGSE IN GSE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GSE.
           IF NOT (FIO-STAT-OKS AND
              GDG-CAI-GTIA IN GDG = GSE-CAI-GTIA IN GSE AND
              GDG-IIC-GTIA IN GDG = GSE-IIC-GTIA IN GSE)
               MOVE SPACES TO GSE               
               MOVE ZEROES TO GSE-NUM-STRN IN GSE
               MOVE ZEROES TO GSE-NUM-ATRN IN GSE
               MOVE ZEROES TO GSE-NUM-MTRN IN GSE
               MOVE ZEROES TO GSE-NUM-DTRN IN GSE
               MOVE ZEROES TO GSE-HRA-HRTR IN GSE
               MOVE ZEROES TO GSE-SGV-SEGU IN GSE
               MOVE ZEROES TO GSE-NUM-SVSG IN GSE
               MOVE ZEROES TO GSE-NUM-AVSG IN GSE
               MOVE ZEROES TO GSE-NUM-MVSG IN GSE
               MOVE ZEROES TO GSE-NUM-DVSG IN GSE
               MOVE ZEROES TO GSE-NUM-SVTS IN GSE
               MOVE ZEROES TO GSE-NUM-AVTS IN GSE
               MOVE ZEROES TO GSE-NUM-MVTS IN GSE
               MOVE ZEROES TO GSE-NUM-DVTS IN GSE
               MOVE ZEROES TO GSE-NUM-SING IN GSE
               MOVE ZEROES TO GSE-NUM-AING IN GSE
               MOVE ZEROES TO GSE-NUM-MING IN GSE
               MOVE ZEROES TO GSE-NUM-DING IN GSE
               MOVE ZEROES TO GSE-VAL-MPRI IN GSE
               MOVE ZEROES TO GSE-NUM-CUOT IN GSE.
       FIN-LEE-GSE.
           EXIT.

       LEE-GVT SECTION.
       INI-LEE-GVT.
      *LEE GVT
           MOVE GDG-CAI-GTIA IN GDG TO GVT-CAI-GTIA IN GVT.
           MOVE GDG-IIC-GTIA IN GDG TO GVT-IIC-GTIA IN GVT.
           MOVE GDG-COD-TSCN IN GDG TO GVT-COD-TASN IN GVT.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO GVT
               MOVE ZEROES TO GVT-COD-TASN IN GVT
               MOVE ZEROES TO GVT-NUM-STRN IN GVT
               MOVE ZEROES TO GVT-NUM-ATRN IN GVT
               MOVE ZEROES TO GVT-NUM-MTRN IN GVT
               MOVE ZEROES TO GVT-NUM-DTRN IN GVT
               MOVE ZEROES TO GVT-HRA-HRTR IN GVT
               MOVE ZEROES TO GVT-NUM-STSN IN GVT
               MOVE ZEROES TO GVT-NUM-ATSN IN GVT
               MOVE ZEROES TO GVT-NUM-MTSN IN GVT
               MOVE ZEROES TO GVT-NUM-DTSN IN GVT
               MOVE ZEROES TO GVT-SGV-LTSN IN GVT
               MOVE ZEROES TO GVT-SGV-VCTS IN GVT
               MOVE ZEROES TO GVT-SGV-PPCT IN GVT
               MOVE ZEROES TO GVT-SGV-VPND IN GVT
               MOVE ZEROES TO GVT-SGV-PAJU IN GVT
               MOVE ZEROES TO GVT-SGV-VGAS IN GVT
               MOVE ZEROES TO GVT-SGV-VSIN IN GVT
               MOVE ZEROES TO GVT-VAL-TTM2 IN GVT
               MOVE ZEROES TO GVT-NUM-SRVL IN GVT
               MOVE ZEROES TO GVT-NUM-ARVL IN GVT
               MOVE ZEROES TO GVT-NUM-MRVL IN GVT
               MOVE ZEROES TO GVT-NUM-DRVL IN GVT
               MOVE ZEROES TO GVT-SGV-FISI IN GVT
               MOVE ZEROES TO GVT-NUM-SING IN GVT
               MOVE ZEROES TO GVT-NUM-AING IN GVT
               MOVE ZEROES TO GVT-NUM-MING IN GVT
               MOVE ZEROES TO GVT-NUM-DING IN GVT.
       FIN-LEE-GVT.
           EXIT.

       LEE-GUB SECTION.
       INI-LEE-GUB.
      *LEE GUB
           MOVE GDG-CAI-GTIA IN GDG TO GUB-CAI-GTIA IN GUB.
           MOVE GDG-IIC-GTIA IN GDG TO GUB-IIC-GTIA IN GUB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GUB.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO GUB
               MOVE ZEROES TO GUB-NUM-STRN IN GUB
               MOVE ZEROES TO GUB-NUM-ATRN IN GUB
               MOVE ZEROES TO GUB-NUM-MTRN IN GUB
               MOVE ZEROES TO GUB-NUM-DTRN IN GUB
               MOVE ZEROES TO GUB-HRA-HRTR IN GUB
               MOVE ZEROES TO GUB-NUM-SDEP IN GUB
               MOVE ZEROES TO GUB-NUM-ADEP IN GUB
               MOVE ZEROES TO GUB-NUM-MDEP IN GUB
               MOVE ZEROES TO GUB-NUM-DDEP IN GUB
               MOVE ZEROES TO GUB-NUM-SING IN GUB
               MOVE ZEROES TO GUB-NUM-AING IN GUB
               MOVE ZEROES TO GUB-NUM-MING IN GUB
               MOVE ZEROES TO GUB-NUM-DING IN GUB.
       FIN-LEE-GUB.
           EXIT.

       LEE-GES SECTION.
       INI-LEE-GES.
      *LEE GES
           MOVE GDG-CAI-GTIA IN GDG TO GES-CAI-GTIA IN GES.
           MOVE GDG-IIC-GTIA IN GDG TO GES-IIC-GTIA IN GES.
           MOVE ZEROES              TO GES-NUM-IGES IN GES.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM BGL-FIO-GES.
           IF NOT (FIO-STAT-OKS AND
              GDG-CAI-GTIA IN GDG = GES-CAI-GTIA IN GES AND
              GDG-IIC-GTIA IN GDG = GES-IIC-GTIA IN GES)
               MOVE SPACES TO GES
               MOVE ZEROES TO GES-NUM-IGES IN GES
               MOVE ZEROES TO GES-NUM-STRN IN GES
               MOVE ZEROES TO GES-NUM-ATRN IN GES
               MOVE ZEROES TO GES-NUM-MTRN IN GES
               MOVE ZEROES TO GES-NUM-DTRN IN GES
               MOVE ZEROES TO GES-HRA-HRTR IN GES
               MOVE ZEROES TO GES-NUM-IDLC IN GES
               MOVE ZEROES TO GES-NUM-SVCR IN GES
               MOVE ZEROES TO GES-NUM-AVCR IN GES
               MOVE ZEROES TO GES-NUM-MVCR IN GES
               MOVE ZEROES TO GES-NUM-DVCR IN GES
               MOVE ZEROES TO GES-SGV-VLCR IN GES
               MOVE ZEROES TO GES-SGV-PLCR IN GES
               MOVE ZEROES TO GES-NUM-SING IN GES
               MOVE ZEROES TO GES-NUM-AING IN GES
               MOVE ZEROES TO GES-NUM-MING IN GES
               MOVE ZEROES TO GES-NUM-DING IN GES.
       FIN-LEE-GES.
           EXIT.

       LEE-GAP SECTION.
       INI-LEE-GAP.
      *LEE GAP
           MOVE GDG-CAI-GTIA IN GDG TO GAP-CAI-GTIA IN GAP.
           MOVE GDG-IIC-GTIA IN GDG TO GAP-IIC-GTIA IN GAP.
           MOVE GDG-COD-GGTA IN GDG TO GAP-COD-PACR IN GAP.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GAP.
           IF NOT FIO-STAT-OKS
                MOVE SPACES TO GAP
                MOVE ZEROES TO GAP-COD-PACR IN GAP
                MOVE ZEROES TO GAP-NUM-STRN IN GAP
                MOVE ZEROES TO GAP-NUM-ATRN IN GAP
                MOVE ZEROES TO GAP-NUM-MTRN IN GAP
                MOVE ZEROES TO GAP-NUM-DTRN IN GAP
                MOVE ZEROES TO GAP-HRA-HRTR IN GAP
                MOVE ZEROES TO GAP-SGV-MACR IN GAP
                MOVE ZEROES TO GAR-NUM-ICR-ACR IN GAP
                MOVE ZEROES TO GAR-ANO-ICR-ACR IN GAP
                MOVE ZEROES TO GAP-NUM-SING IN GAP
                MOVE ZEROES TO GAP-NUM-AING IN GAP
                MOVE ZEROES TO GAP-NUM-MING IN GAP
                MOVE ZEROES TO GAP-NUM-DING IN GAP.
       FIN-LEE-GAP.
           EXIT.

       LEE-GTP SECTION.
       INI-LEE-GTP.
      *LEE GTP
           MOVE GDG-CAI-GTIA IN GDG TO GTP-CAI-GTIA IN GTP.
           MOVE GDG-IIC-GTIA IN GDG TO GTP-IIC-GTIA IN GTP.
           MOVE GDG-COD-TSCN IN GDG TO GTP-NUM-ITSN IN GTP.
           MOVE 99                  TO GTP-COD-ITSN IN GTP.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM BGL-FIO-GTP.
           IF NOT (FIO-STAT-OKS AND
               GDG-CAI-GTIA IN GDG = GTP-CAI-GTIA IN GTP AND
               GDG-IIC-GTIA IN GDG = GTP-IIC-GTIA IN GTP AND
               GDG-COD-TSCN IN GDG = GTP-COD-ITSN IN GTP)
                MOVE SPACES TO GTP
                MOVE ZEROES TO GTP-NUM-ITSN IN GTP
                MOVE ZEROES TO GTP-COD-ITSN IN GTP
                MOVE ZEROES TO GTP-NUM-STRN IN GTP
                MOVE ZEROES TO GTP-NUM-ATRN IN GTP
                MOVE ZEROES TO GTP-NUM-MTRN IN GTP
                MOVE ZEROES TO GTP-NUM-DTRN IN GTP
                MOVE ZEROES TO GTP-HRA-HRTR IN GTP
                MOVE ZEROES TO GTP-SGV-ITSN IN GTP
                MOVE ZEROES TO GTP-SGV-VTSN IN GTP
                MOVE ZEROES TO GTP-NUM-SCES IN GTP
                MOVE ZEROES TO GTP-NUM-ACES IN GTP
                MOVE ZEROES TO GTP-NUM-MCES IN GTP
                MOVE ZEROES TO GTP-NUM-DCES IN GTP
                MOVE ZEROES TO GTP-NUM-SING IN GTP
                MOVE ZEROES TO GTP-NUM-AING IN GTP
                MOVE ZEROES TO GTP-NUM-MING IN GTP
                MOVE ZEROES TO GTP-NUM-DING IN GTP.
       FIN-LEE-GTP.
           EXIT.

       LEE-GDO SECTION.
       INI-LEE-GDO.
      *LEE GDO
           MOVE GDG-CAI-GTIA IN GDG TO GDO-CAI-GTIA IN GDO.
           MOVE GDG-IIC-GTIA IN GDG TO GDO-IIC-GTIA IN GDO.
           MOVE 999                 TO GDO-NUM-IGDO IN GDO.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM BGL-FIO-GDO.
           IF NOT (FIO-STAT-OKS AND
              GDG-CAI-GTIA IN GDG = GDO-CAI-GTIA IN GDO AND
              GDG-IIC-GTIA IN GDG = GDO-IIC-GTIA IN GDO)
               MOVE SPACES TO GDO
               MOVE ZEROES TO GDO-NUM-IGDO IN GDO
               MOVE ZEROES TO GDO-NUM-STRN IN GDO
               MOVE ZEROES TO GDO-NUM-ATRN IN GDO
               MOVE ZEROES TO GDO-NUM-MTRN IN GDO
               MOVE ZEROES TO GDO-NUM-DTRN IN GDO
               MOVE ZEROES TO GDO-HRA-HRTR IN GDO
               MOVE ZEROES TO GDO-NUM-SCAP IN GDO
               MOVE ZEROES TO GDO-NUM-ACAP IN GDO
               MOVE ZEROES TO GDO-NUM-MCAP IN GDO
               MOVE ZEROES TO GDO-NUM-DCAP IN GDO
               MOVE ZEROES TO GDO-NUM-SING IN GDO
               MOVE ZEROES TO GDO-NUM-AING IN GDO
               MOVE ZEROES TO GDO-NUM-MING IN GDO
               MOVE ZEROES TO GDO-NUM-DING IN GDO.
       FIN-LEE-GDO.
           EXIT.

       LEE-GIM SECTION.
       INI-LEE-GIM.
      *LEE GIM
           MOVE GDG-CAI-GTIA IN GDG TO GIM-CAI-GTIA IN GIM.
           MOVE GDG-IIC-GTIA IN GDG TO GIM-IIC-GTIA IN GIM.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GIM.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO GIM
               MOVE ZEROES TO GIM-NUM-STRN IN GIM
               MOVE ZEROES TO GIM-NUM-ATRN IN GIM
               MOVE ZEROES TO GIM-NUM-MTRN IN GIM
               MOVE ZEROES TO GIM-NUM-DTRN IN GIM
               MOVE ZEROES TO GIM-HRA-HRTR IN GIM
               MOVE ZEROES TO GIM-NUM-EDIM IN GIM
               MOVE ZEROES TO GIM-VAL-TEIM IN GIM
               MOVE ZEROES TO GIM-VAL-COIM IN GIM
               MOVE ZEROES TO GIM-VAL-MOAR IN GIM
               MOVE ZEROES TO GIM-NUM-SVAR IN GIM
               MOVE ZEROES TO GIM-NUM-AVAR IN GIM
               MOVE ZEROES TO GIM-NUM-MVAR IN GIM
               MOVE ZEROES TO GIM-NUM-DVAR IN GIM
               MOVE ZEROES TO GIM-NUM-SING IN GIM
               MOVE ZEROES TO GIM-NUM-AING IN GIM
               MOVE ZEROES TO GIM-NUM-MING IN GIM
               MOVE ZEROES TO GIM-NUM-DING IN GIM.
       FIN-LEE-GIM.
           EXIT.

       LEE-GVE SECTION.
       INI-LEE-GVE.
      *LEE GVE
           MOVE GDG-CAI-GTIA IN GDG TO GVE-CAI-GTIA IN GVE.
           MOVE GDG-IIC-GTIA IN GDG TO GVE-IIC-GTIA IN GVE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GVE.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO GVE
               MOVE ZEROES TO GVE-NUM-STRN IN GVE
               MOVE ZEROES TO GVE-NUM-ATRN IN GVE
               MOVE ZEROES TO GVE-NUM-MTRN IN GVE
               MOVE ZEROES TO GVE-NUM-DTRN IN GVE
               MOVE ZEROES TO GVE-HRA-HRTR IN GVE
               MOVE ZEROES TO GVE-COD-ORVE IN GVE
               MOVE ZEROES TO GVE-COD-EQVE IN GVE
               MOVE ZEROES TO GVE-COD-CIVE IN GVE
               MOVE ZEROES TO GVE-COD-PUVE IN GVE
               MOVE ZEROES TO GVE-COD-TRVE IN GVE
               MOVE ZEROES TO GVE-COD-ADVE IN GVE
               MOVE ZEROES TO GVE-COD-AGVE IN GVE
               MOVE ZEROES TO GVE-NUM-SVEN IN GVE
               MOVE ZEROES TO GVE-NUM-AVEN IN GVE
               MOVE ZEROES TO GVE-NUM-MVEN IN GVE
               MOVE ZEROES TO GVE-NUM-DVEN IN GVE
               MOVE ZEROES TO GVE-NUM-AMOD IN GVE
               MOVE ZEROES TO GVE-NUM-SING IN GVE
               MOVE ZEROES TO GVE-NUM-AING IN GVE
               MOVE ZEROES TO GVE-NUM-MING IN GVE
               MOVE ZEROES TO GVE-NUM-DING IN GVE
               MOVE ZEROES TO GVE-SGV-ENGA IN GVE.
       FIN-LEE-GVE.
           EXIT.

       LEE-DBC SECTION.
       INI-LEE-DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO DBC.
       FIN-LEE-DBC.
           EXIT.
      *-------------------------------------------------------------

       ENV-MSG-OUT-HST SECTION.
       INI-ENV-MSG-OUT-HST.
           PERFORM GET-FHOY.
           MOVE HOY-FHOY TO SND-FEC-FTRN.
           MOVE HOY-HHOY TO SND-HRS-HTRN.
           MOVE '1'      TO SND-IND-MSGP
           MOVE RCV-HEAD-DRIVE-TRAN TO SND-COD-TRAN.
           MOVE RCV-HEAD-DRIVE-SIST TO SND-COD-SIST.
           MOVE RCV-HEAD-DRIVE-USER TO SND-COD-USER.
           MOVE RCV-HEAD-DRIVE-PSSW TO SND-COD-PASS.
           MOVE SPACES   TO SND-GLS-FILL.
           MOVE SPACES   TO SND-GLS-DOUT.
           MOVE WSS-NUM-GARA TO QGR-NUM-GARA.
      *Data es manejada en parrafo llamador
           MOVE QGR-OUTP TO SND-GLS-DOUT.
           IF WSS-PVEZ-SND = 'S'
      *QUITA LOS 111 CARACTERES PARA LA PRIMERA VEZ
               MOVE 'N'      TO WSS-PVEZ-SND
      * 31+80+(145*6)= 981
               MOVE +981     TO SND-NUM-LENM
               MOVE SND-SEND(1:52) TO SND-SEND-CICS(1:52)
      *        MOVE SND-SEND(164:1089) TO SND-SEND-CICS(53:1089)
               MOVE SND-SEND(164:950) TO SND-SEND-CICS(53:950)
               SUBTRACT 111 FROM WSS-LEN-SND GIVING SND-SEND-LEN
           ELSE
      * 31+111+(145*6)= 1012
               MOVE +1012       TO SND-NUM-LENM
               MOVE SND-SEND    TO SND-SEND-CICS
               MOVE WSS-LEN-SND TO SND-SEND-LEN
           END-IF.
           EXEC CICS SEND
                     LENGTH(SND-SEND-LEN)
                     FROM(SND-SEND-CICS)
                     CONVID(TERM)
           END-EXEC.
       FIN-ENV-MSG-OUT-HST.
           EXIT.

       ENV-MSG-OUT-HST-ULT SECTION.
       INI-ENV-MSG-OUT-HST-ULT.
           PERFORM GET-FHOY.
           MOVE HOY-FHOY TO SND-FEC-FTRN.
           MOVE HOY-HHOY TO SND-HRS-HTRN.
           MOVE '0'      TO SND-IND-MSGP
           MOVE RCV-HEAD-DRIVE-TRAN TO SND-COD-TRAN.
           MOVE RCV-HEAD-DRIVE-SIST TO SND-COD-SIST.
           MOVE RCV-HEAD-DRIVE-USER TO SND-COD-USER.
           MOVE RCV-HEAD-DRIVE-PSSW TO SND-COD-PASS.
           MOVE SPACES   TO SND-GLS-FILL.
           MOVE SPACES   TO SND-GLS-DOUT.
           MOVE WSS-NUM-GARA TO QGR-NUM-GARA.
      *Data es manejada en parrafo llamador
           MOVE QGR-OUTP TO SND-GLS-DOUT.
           IF WSS-PVEZ-SND = 'S'
      *QUITA LOS 111 CARACTERES PARA LA PRIMERA VEZ
               MOVE 'N'      TO WSS-PVEZ-SND
      * 31+80+(145*6)= 981
               MOVE +981     TO SND-NUM-LENM
               MOVE SND-SEND(1:52) TO SND-SEND-CICS(1:52)
      *        MOVE SND-SEND(164:1089) TO SND-SEND-CICS(53:1089)
               MOVE SND-SEND(164:950) TO SND-SEND-CICS(53:950)
               SUBTRACT 111 FROM WSS-LEN-SND GIVING SND-SEND-LEN
           ELSE
      * 31+111+(145*6)= 1012
               MOVE +1012       TO SND-NUM-LENM
               MOVE SND-SEND    TO SND-SEND-CICS
               MOVE WSS-LEN-SND TO SND-SEND-LEN
           END-IF.
           EXEC CICS SEND
                     LENGTH(SND-SEND-LEN)
                     FROM(SND-SEND-CICS)
                     CONVID(TERM)
                     LAST
           END-EXEC.
       FIN-ENV-MSG-OUT-HST-ULT.
           EXIT.

      *-------------------------------------------------------------

       COPY GNSBGEND.
       COPY GNSBPFEC.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBHSYS.
       COPY GNSBGSYS.
       COPY GNSBIABT.
       COPY GNSBGDTC.
       COPY GNSBGCPT.
       COPY GNSBGQUE.
       COPY GNSBBMSG.
       COPY GNSBFMSG.
       COPY GNSBFTAB.
       COPY SGCBFDBC.
      *
       COPY BGLBFGAP.
       COPY BGLBFGDD.
       COPY BGLBFGDG.
       COPY BGLBFGDO.
       COPY BGLBFGDP.
       COPY BGLBFGES.
       COPY BGLBFGIN.
       COPY BGLBFGLE.
       COPY BGLBFGMO.
       COPY BGLBFGSE.
       COPY BGLBFGSI.
       COPY BGLBFGTP.
       COPY BGLBFGUB.
       COPY BGLBFGVT.
       COPY BGLBFGIM.
       COPY BGLBFGVE.
       COPY BGLBFTAG.
      *
       COPY TABBBUSR.
       COPY TABBFUSR.
       COPY TABBBOFI.
       COPY TABBFOFI.
