*% NO_TIENE_TIMESTAMP = TRUE
*% NO_HDR_CST = TRUE
*% PGM_GSI = TRUE
*% FMT_CHI = TRUE
*% FRM = 'GSI'
*% VSNPQ = "06.06.29"
*% FNCPQ = "OWFBGL"
*% VSNPU = "06.06.29"
*% FNCPU = "OWFBGL"
*%! IF NOT PGM_MCP
*% PGM_PTC = TRUE
*%! END
*% IF NOT PGM_MCP AND PGM_PQ
*%! Codigo adicional para Funcion BGLPPVCG = PF5
*% INCLUDE 'BGLSRC:PFALL5.SRC'
*% ! Codigo adicional programa BGLPAGSI
*% END
*% REG = 'GSI'
*% HIJ = 'GDG'
*% IF EOF AND PGM_DTC
      *<<<< PGM_DTC
       COPY GNSBGVSM.
       COPY GNSBHVSM.
      *MHM-INI 23-OCT-2003
       COPY GNSBGCPT.
      *MHM-FIN 23-OCT-2003
      *>>>>
*% END
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
           03 CMA-VARI.
              05 GAR-CAI-GTIA                  PIC X(04).
              05 GAR-IIC-GTIA                  PIC X(08).
      *>>>>
*% END
*% IF WSS
      *MHM-INI 4-AUG-2003
       01  WSS-VARI.
           03 WSS-COD-CGTA.
              05 WSS-TIP-CGTA              PIC X(03).
              05 WSS-STP-CGTA              PIC X(03).
      *MHM-FIN 4-AUG-2003
      *MHM-INI 23-OCT-2003
           03 WSS-GLS-CGTA.
              05 WSS-GLS-TOPE                   PIC X(40).
              05 WSS-GLS-SOPE                   PIC X(40).
      *MHM-FIN 23-OCT-2003

      *MHM-INI 23-OCT-2003
       COPY GNSWGCPT.
      *MHM-FIN 23-OCT-2003

       COPY BGLBRGDG.
       COPY BGLBRTAG.
       COPY BGLWGVCG.
*% IF PGM_CLB OR PGM_MEX
       COPY BGLBRGAP.
       COPY BGLBRGDD.
       COPY BGLBRGDO.
       COPY BGLBRGDP.
       COPY BGLBRGES.
       COPY BGLBRGIN.
       COPY BGLBRGLE.
       COPY BGLBRGMO.
       COPY BGLBRGSE.
       COPY BGLBRGTP.
       COPY BGLBRGUB.
       COPY BGLBRGVT.
       COPY BGLBRGIM.
       COPY BGLBRGVE.
       COPY BGLWGVDO.
       COPY BGLWVVCG.

*% END
*% IF PGM_VAX
      *<<<< PGM_VAX
           03 WSS-REG                          PIC X(03).
      *>>>>
*% END
*% IF PGM_DTC
      *<<<< WSS AND PGM_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
      *>>>>
*% END
*% IF PGM_CHI AND PGM_PQ
      *<<<< PGM_CHI AND PGM_PQ
           COPY USPC113.
      *>>>>
*% END
      *>>>>
*% END
*% IF PGM_ARG
*% LARGO_MI_COMMAREA = 15
*% ELSE
*% LARGO_MI_COMMAREA = 12
*% END
*% IF INI_FIO AND PGM_VAX
      *<<<< INI_FIO AND PGM_VAX

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-OFI.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'BGL'        TO FIO-SIST.
           PERFORM BGL-FIO-TAG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM BGL-FIO-TAG.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'BGL'        TO FIO-SIST.
           PERFORM BGL-FIO-GDG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.

      *>>>> INI_FIO
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
*% FIN_BUS_HIJ = TRUE
       BUS-GDG.
           MOVE GSI-CAI-GTIA IN GSI-FLD TO GDG-CAI-GTIA IN GDG.
           MOVE GSI-IIC-GTIA IN GSI-FLD TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           MOVE FIO-STAT TO PGM-STAT-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG    NEX' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
*% IF PGM_CHI
      *<<<< PGM_CHI
      *
           IF SCR-CCPP = 'ACC' AND 
              SCR-STAT = SCR-STAT-CON
              GO TO FIN-VAL-OFI-USP-GSI.
           IF SCR-OFRM-SRV                                              
              GO TO FIN-VAL-OFI-USP-GSI.                                

           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'OFIUSP'       TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND 
                    TAB-MSC-STAT IN TAB = 'S' )
               GO TO FIN-VAL-OFI-USP-GSI.
           COPY USPC143.
           IF USP-COD-OFICINA NOT = GDG-COD-OFIC IN GDG 
               MOVE 'USRNODEOFI' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

       FIN-VAL-OFI-USP-GSI.
      *
      *>>>>
*% END
*% IF PGM_PER AND PGM_GVT
      *<<<< PGM_PER AND PGM_GVT
       COPY BGLBVUOF.
           IF MSG-COD-MENS > SPACES
               GO TO ERR-FND-KEY.
      *>>>>
*% END

       FIN-BUS-GDG.
*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GDG-TIP-CGTA IN GDG TO GDG-TIP-CGTA IN GSI-FLD.
           MOVE GDG-STP-CGTA IN GDG TO GDG-STP-CGTA IN GSI-FLD.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GDG TO GDG-COD-CGTA IN GSI-FLD.
*% END
      *BUS-TAB Busca codigo de tabla
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
           MOVE SPACES TO TAB-COD-CTAB IN TAB.

*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GDG-TIP-CGTA IN GSI-FLD TO TAG-TIP-AGTA IN TAG.
           MOVE GDG-STP-CGTA IN GSI-FLD TO TAG-STP-AGTA IN TAG.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GSI-FLD TO TAG-COD-AGTA IN TAG.
*% END
      *MHM-INI 24-OCT-2003
      *     MOVE TAG-COD-AGTA IN TAG     TO TAB-COD-CTAB IN TAB.
      *     PERFORM BUS-TAB.
      *     IF MSG-COD-MENS = SPACES
      *         MOVE TAB-GLS-DESC IN TAB TO
      *              FRM-GLS-CGTA IN GSI-FLD
      *     ELSE
      *         MOVE SPACES TO FRM-GLS-CGTA IN GSI-FLD.
      *MHM-FIN 24-OCT-2003
      * Busca Glosa Tabla Real/no Real
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM BGL-FIO-TAG.
           IF NOT FIO-STAT-OKS
                MOVE 'TAG    NEX' TO MSG-COD-MENS
                MOVE 'BGL' TO MSG-COD-SIST
                PERFORM GET-MSG
           ELSE
                MOVE SPACES TO MSG-COD-MENS
                MOVE 'BGL' TO TAB-COD-SIST
                MOVE 'RAL' TO TAB-COD-TTAB IN TAB
                MOVE TAG-IND-TREA IN TAG TO TAB-COD-CTAB IN TAB
                PERFORM BUS-TAB
                IF MSG-COD-MENS = SPACES
                    MOVE TAB-GLS-DESC IN TAB TO 
                         FRM-GLS-TREA IN GSI-FLD
                ELSE
                    MOVE SPACES TO FRM-GLS-TREA IN GSI-FLD.


           MOVE GDG-CAI-GTIA IN GDG TO GAR-CAI-GTIA IN CMA-VARI.
           MOVE GDG-IIC-GTIA IN GDG TO GAR-IIC-GTIA IN CMA-VARI.
           IF SCR-CMND = 'ING'
               PERFORM PUT-GDG-GSI.

      * Valida Este permitido esta Entidad para Tipo-Subtipo
           IF TAG-IND-EGSI IN TAG = 'N'
               MOVE 'TAG    NOPGM' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
           IF SCR-CCPP = 'ING'
               PERFORM BUS-COR-GSI
               GO TO CON-FND-KEY.

           IF GSI-NUM-IGSI IN GSI NOT > ZEROES
               PERFORM BUS-COR-GSI.
       CON-FND-KEY.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      * Comando Consulta Error lo trata el GENESIS
           IF SCR-CCPP = 'ACC' AND 
              SCR-STPP = SCR-STAT-CON
              GO TO FIN-FND-KEY.

      * Garantia Alzada
           IF GDG-IND-EST1 IN GDG > '19'
               MOVE 'GDGALZ' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      * Garantia Completa
           IF SCR-CCPP = 'ELI' AND
              GDG-IND-GTAC IN GDG = 'S'
               MOVE 'GAR    CPL' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           GO TO FIN-FND-KEY.
       ERR-FND-KEY.
           MOVE 'BGL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE SCR-STAT-ABT TO SCR-STAT.
           IF SCR-CCPP = 'ING'
               MOVE '00' TO FIO-STAT
           ELSE
               MOVE FIO-STAT-NEX TO FIO-STAT.

      *>>>>
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
           MOVE SPACES TO GSI-GLS-FLAG IN GSI.
           MOVE SPACES TO GSI-MSC-TACC IN GSI.
           MOVE SPACES TO GSI-CIC-UING IN GSI.
           MOVE 'I'    TO GSI-MSC-STAT IN GSI.

      *>>>>
*% END
*% IF CMN_ING OR CMN_MOD
      *<<<< INI_CMN_ING OR INI_CMN_MOD
           PERFORM GET-FHOY.
           IF SCR-CCPP = 'ING'
              OR SCR-CMND = 'COP'
               MOVE 'I'      TO GSI-MSC-TACC    IN GSI

               MOVE HOY-FHOY TO GSI-FEC-FING IN GSI
*% IF PGM_MVS
               MOVE SCR-USER TO GSI-CIC-UING IN GSI
*% END
           ELSE
*% IF PGM_MVS
*% END
               MOVE 'M'      TO GSI-MSC-TACC    IN GSI.
*% IF PGM_MVS
*% END
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en la modificacion : informar               
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-MOD.

      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en el ingreso : informar                    
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ING. 

           MOVE GSI-CAI-GTIA IN GSI TO GDG-CAI-GTIA IN GDG.
           MOVE GSI-IIC-GTIA IN GSI TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF FIO-STAT-OKS
               MOVE 'S' TO GDG-IND-EGSI IN GDG
               MOVE FIO-MOD TO FIO-CMND
               PERFORM BGL-FIO-GDG.

      *>>>>
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en la eliminacion : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.

           MOVE GSI-CAI-GTIA IN GSI TO GDG-CAI-GTIA IN GDG.
           MOVE GSI-IIC-GTIA IN GSI TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF FIO-STAT-OKS
               MOVE ' ' TO GDG-IND-EGSI IN GDG
               MOVE FIO-MOD TO FIO-CMND
               PERFORM BGL-FIO-GDG.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       BUS-COR-GSI SECTION.
       INI-BUS-COR-GSI.
           MOVE 999 TO GSI-NUM-IGSI IN GSI.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM BGL-FIO-GSI.
           IF NOT ( FIO-STAT-OKS AND
                    GSI-CAI-GTIA IN GSI-FLD = GSI-CAI-GTIA IN GSI AND
                    GSI-IIC-GTIA IN GSI-FLD = GSI-IIC-GTIA IN GSI )
               PERFORM KEY-ALL-GSI
               MOVE ZEROES TO GSI-NUM-IGSI IN GSI.
           IF SCR-CCPP = 'ING'
               ADD 1 TO GSI-NUM-IGSI IN GSI
               MOVE GSI-NUM-IGSI IN GSI TO GSI-NUM-IGSI IN GSI-FLD
           ELSE
               MOVE GSI-NUM-IGSI IN GSI TO GSI-NUM-IGSI IN GSI-FLD.
       FIN-BUS-COR-GSI.
           EXIT.


       COPY BGLBFGDG.
       COPY BGLBFTAG.
       COPY BGLBGVCG.
       COPY BGLBKVCG.
*% IF PGM_CLB OR PGM_MEX
       COPY BGLBFGAP.
       COPY BGLBFGDD.
       COPY BGLBFGDO.
       COPY BGLBFGDP.
       COPY BGLBFGES.
       COPY BGLBFGIN.
       COPY BGLBFGLE.
       COPY BGLBFGMO.
       COPY BGLBFGSE.
       COPY BGLBFGTP.
       COPY BGLBFGUB.
       COPY BGLBFGVT.
       COPY BGLBFGIM.
       COPY BGLBFGVE.
       COPY BGLBGVC2.
       COPY BGLBGVDO.
       COPY GNSBVTAB.
       COPY GNSBVCOD.
       COPY BGLBVVCG.
*% END
       COPY GNSBVCOD.
       COPY GNSBVTAB.
      *>>>>
*% END
