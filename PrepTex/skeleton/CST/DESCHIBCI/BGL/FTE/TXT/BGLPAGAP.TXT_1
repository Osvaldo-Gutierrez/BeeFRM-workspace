*% VSNPQ = "06.06.29"
*% FNCPQ = "OWFBGL"
*% VSNPU = "06.06.29"
*% FNCPU = "OWFBGL"
*% FMT_CHI = TRUE
*% GEN_BCI = TRUE
*% PGM_PTC = TRUE
*% LARGO_MI_COMMAREA = 076
*% IF WSS
      *<<<< WSS                                                         
       COPY BGLBRGDG.                                                   
       COPY BGLBRTAG.                                                   
       COPY BGLBRGMO.                                                   
       COPY GNSWGHOY.                                                   
       COPY BGLBRGDD.                                                   
       COPY BGLBRGES.                                                   
       COPY BGLBRGSO.                                                   
       COPY BGLBRGLE.                                                   
       COPY SGCBRDBC.                                                   
       COPY GNSWGCPT.                                                   
       COPY GNSWGSTR.                                                   
       COPY GNSWGPES.                                                   
                                                                        
*% IF PGM_PQ
       COPY BGLWGVCG.                                                   
      *<<<< PGM_CHI AND PGM_PQ                                          
                                                                        
      *********************************************                     
      *           MODULO   USPC113                *                     
      *********************************************                     
      *       DEFINICION IDENTIFICACION TS        *                     
      *********************************************                     
                                                                        
       01  UIB.                                                         
           02  FILLER                  PIC X(32) VALUE 'USPR002'.       
       01  USP-LARGO-TS                PIC S9(4) COMP VALUE +150.       
       01  USP-IDENTIFICACION.                                          
           05  USP-TERMINAL            PIC X(04).                       
           05  USP-OPID-USU            PIC X(03).                       
           05  FILLER                  PIC X(01)  VALUE ' '.            
       01  USP-LLENA-VECTOR            PIC X(1)   VALUE ' '.            
       01  USP-USA-VECTOR              PIC X(1)   VALUE ' '.            
                                                                        
      *********************************************                     
      *       DEFINICION AREA DE TRASPASO         *                     
      *********************************************                     
                                                                        
       01  AREA-TRASPASO.                                               
           05  USP-PERMISO             PIC X(01).                       
           05  USP-PTA-NUM             PIC 9(03)  VALUE 0.              
           05  USP-PTA-STR             PIC X(12)  VALUE SPACES.         
           05  USP-AREA-COMUN.                                          
               10  USP-TIPO-USUARIO.                                    
                   15  USP-IDENT-TU    PIC X(03).                       
      *                TIPO DE USUARIO                                  
                                                                        
                   15  USP-MODO-OP     PIC X(01).                       
      *                MODO OPERACION (CONSULTA/ACTUALIZACION)          
                                                                        
               10  USP-SISTEMA.                                         
                   15  USP-IDENT-SIS   PIC X(03).                       
      *                IDENTIFICACION DEL SISTEMA QUE SE ESTA PROCE_    
      *                SANDO SEGUN USUARIOS Y PRIVILEGIOS               
                                                                        
                   15  USP-GRUPO       PIC X(03).                       
      *                IDENTIFICACION DEL GRUPO DE SISTEMA QUE SE ESTA  
      *                PROCESANDO SEGUN USUARIOS Y PRIVILEGIOS          
      *                                                                 
                                                                        
               10  USP-INDIC-PROCESO   PIC X(01).                       
      *            INDICADOR DE SISTEMA USUARIO Y PRIVILEGIO  ACTIVO    
                                                                        
               10  USP-COD-OFICINA     PIC X(03).                       
      *            CODIGO DE LA OFICINA DEL USUARIO                     
                                                                        
               10  USP-COD-DEPTO       PIC X(03).                       
      *            CODIGO DEL DEPTO DEL USUARIO                         
                                                                        
               10  USP-COD-USUARIO     PIC X(12).                       
      *            CODIGO USUARIO (TABLA USR)                           
                                                                        
               10  USP-COD-TERMINAL    PIC X(04).                       
      *            CODIGO DE TERMINAL                                   
                                                                        
               10  USP-OPID            PIC X(03).                       
      *            OPID DE USUARIO                                      
                                                                        
               10  USP-FECHA.                                           
      *            FECHA                                                
                   15  USP-ANO         PIC X(02).                       
                   15  USP-MES         PIC X(02).                       
                   15  USP-DIA         PIC X(02).                       
                                                                        
               10  USP-HORA            PIC X(06).                       
      *            HORA                                                 
                                                                        
               10  USP-PASSWORD        PIC X(08).                       
      *            PASSWORD DE USUARIO(SOLO PARA CONECCION VIA RUTINA)  
                                                                        
               10  USP-INDICADORES.                                     
                   15  USP-USU-CMN1    PIC X(01).                       
      *            1   */CON       CONSULTA                             
      *            2   */MAN       CONSULTA Y MANTENCION                
      *            3   */*         TODO                                 
      *                                                                 
                   15  USP-USU-CMN2    PIC X(01).                       
      *            P   *           PERMISO AL MENU                      
      *                                                                 
                   15  USP-USU-CMN3    PIC X(01).                       
      *            P   */OFI       OTRAS OFICINAS                       
      *                                                                 
                   15  USP-USU-CMN4    PIC X(01).                       
                   15  USP-USU-CMN5    PIC X(01).                       
                   15  USP-USU-CMN6    PIC X(01).                       
                   15  USP-USU-CMN7    PIC X(01).                       
                   15  USP-USU-CMN8    PIC X(01).                       
                   15  USP-USU-CMN9    PIC X(01).                       
                   15  USP-USU-CMN10   PIC X(01).                       
                   15  USP-USU-CMN11   PIC X(01).                       
                   15  USP-USU-CMN12   PIC X(01).                       
                   15  USP-USU-CMN13   PIC X(01).                       
                   15  USP-USU-CMN14   PIC X(01).                       
                   15  USP-USU-CMN15   PIC X(01).                       
                   15  USP-USU-CMN16   PIC X(01).                       
               10  USP-INDICADORES-RED REDEFINES USP-INDICADORES.       
                   15  USP-USU-CMN-ARR OCCURS 16 TIMES   PIC X(01).     
      *                                                                 
      *            INDICADORES QUE  INDICAN PRIVILEGIO DE USUARIOS      
      *                                                                 
               10  FILLER              PIC X(78).                       
      *            DISPONIBLE USO FUTURO                                
      *                                                                 
      *********************************************                     
      *     AREAS PARA LECTURA DE TABLA "STR"     *                     
      *********************************************                     
      *                                                                 
      *01  COPYDD USP-R-STR.USP-E-STR01(PROD).                          
       01  USP-E-STR01.                                                 
           02  USP-CLV-STR-1.                                           
               03  USP-COD-GST     PICTURE X(3).                        
               03  USP-COD-STR     PICTURE X(12).                       
           02  USP-COD-PTA         PICTURE X(3).                        
      *                                                                 
       01  REQ-AREA.                                                    
               05  COD-CMND            PIC X(005).                      
               05  NOM-TABL            PIC X(003).                      
               05  NOM-CLAV            PIC X(005).                      
               05  RET-CODI            PIC X(002).                      
               05  RET-INTE            PIC X(001).                      
               05  NUM-BASE            PIC S9(004) COMP VALUE +120.     
               05  NOM-REGI            PIC X(007).                      
               05  FILLER              PIC X(025).                      
               05  MAX-CONT            PIC S9(004) COMP.                
               05  NOM-CONT            PIC S9(004) COMP.                
               05  FILLER              PIC X(022).                      
               05  VAL-CLAV.                                            
                   10  FECHA           PIC 9(008).                      
                   10  HORA            PIC 9(006).                      
      *                                                                 
       01  ELEM-LIST.                                                   
               05  NOM-ELEM            PIC X(011).                      
               05  SEC-CODI            PIC X(001).                      
               05  FILLER              PIC X(005) VALUE SPACES.         
      *                                                                 
       01  REQ-AREA-STR.                                                
               05  COD-CMND-STR        PIC X(005).                      
               05  NOM-TABL-STR        PIC X(003).                      
               05  NOM-CLAV-STR        PIC X(005).                      
               05  RET-CODI-STR        PIC X(002).                      
               05  RET-INTE-STR        PIC X(001).                      
               05  NUM-BASE-STR        PIC S9(004) COMP VALUE +120.     
               05  NOM-REGI-STR        PIC X(007).                      
               05  FILLER              PIC X(025).                      
               05  MAX-CONT-STR        PIC S9(004) COMP.                
               05  NOM-CONT-STR        PIC S9(004) COMP.                
               05  FILLER              PIC X(022).                      
               05  VAL-CLAV-STR.                                        
                   10  USP-COD-GST     PIC X(003).                      
                   10  USP-COD-STR     PIC X(012).                      
      *                                                                 
       01  ELEM-LIST-STR.                                               
               05  NOM-ELEM-STR        PIC X(011).                      
               05  SEC-CODI-STR        PIC X(001).                      
               05  FILLER              PIC X(005) VALUE SPACES.         
      *                                                                 
      *********************************************                     
      *           FIN   MODULO   USPC113          *                     
      *********************************************                     
                                                                        
      *>>>>                                                             
*% END
       01  WSS-VARI.                                                    
           03 WSS-CPO.                                                  
      *<<<< NOT PGM_ARG                                                 
              05 DBC-NUM-ICLI                  PIC 9(08).               
      *>>>>                                                             
              05 DBC-VRF-ICLI                  PIC X(01).               
              05 DBC-IND-ICLI                  PIC X(01).               
      *<<<< NOT PGM_ARG                                                 
              05 DBC-GLS-ICLI                  PIC X(03).               
      *>>>>                                                             
           03 WSS-COD-CGTA.                                             
              05 WSS-COD-TOPE                  PIC X(03).               
              05 WSS-COD-SOPE                  PIC X(03).               
                                                                        
           03 WSS-HOY-ANO.                                              
              05 WSS-SHOY                      PIC 9(02).               
              05 WSS-AHOY                      PIC 9(02).               
           03 GDG-COD-GGTA VALUE ZEROES        PIC 9(01).               
           03 WSS-FHOY.                                                 
              05 WSS-ANO                       PIC 9(04).               
              05 WSS-AUX                       PIC 9(04).               
           03  WSS-MAR-UTIL                    PIC 9(03).               
      *MHM-INI 23-OCT-2003                                              
           03 WSS-GLS-CGTA.                                             
              05 WSS-GLS-TOPE                   PIC X(40).              
              05 WSS-GLS-SOPE                   PIC X(40).              
      *MHM-FIN 23-OCT-2003                                              
      *<<<< FMT_CHI                                                     
*% IF PGM_PU
           03 WSS-COD-GPRE    VALUE ZEROES     PIC 9(02).               
*% END
           03 WSS-IDC-ICLI.                                             
              05 WSS-NUM-ICLI                  PIC 9(08).               
              05 WSS-IND-ICLI                  PIC X(01).               
              05 WSS-GLS-ICLI                  PIC X(03).               
      *>>>>                                                             
      *<<<< PGM_DTC                                                     
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GMO-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GES-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSO-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GLE-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.        
      *>>>>                                                             
      *>>>>                                                             
*% END
*% IF PGM_PQ AND PFS_SCR_MOD
      *<<<< PFS_SCR_MOD                                                 
           IF ( FRM-FFLD = FRM-FFLD-PF5 ) AND                           
              SCR-STAT = SCR-STAT-CON                                   
               PERFORM VAL-NUM-KEY-GAP                                  
               PERFORM VAL-NUM-FLD-GAP.                                 
           IF FRM-FFLD = FRM-FFLD-PF5                                   
               PERFORM RST-STAT                                         
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY                     
               IF SCR-STAT NOT = SCR-STAT-ABT                           
                   PERFORM SCR-TRL                                      
               ELSE                                                     
                   PERFORM GNS-CLR-RQA                                  
                   PERFORM DESSCRTRL                                    
                   GO TO FIN-SCR-MOD.                                   
           PERFORM GNS-CLR-RQA.                                         
      *>>>>                                                             
*% END
*% IF PFS_SCR_ACC
      *<<<< PFS_SCR_ACC                                                 
           IF FRM-FFLD = FRM-FFLD-PF5                                   
               PERFORM VAL-NUM-KEY-GAP                                  
               PERFORM VAL-NUM-FLD-GAP                                  
               PERFORM RST-STAT                                         
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY                     
               IF SCR-STAT NOT = SCR-STAT-ABT                           
                   PERFORM SCR-TRL                                      
               ELSE                                                     
                   PERFORM GNS-CLR-RQA                                  
                   PERFORM DESSCRTRL                                    
                   GO TO FIN-SCR-ACC.                                   
           PERFORM GNS-CLR-RQA.                                         
      *>>>>                                                             
*% END
*% IF PFS_SCR_ELI
      *<<<< PFS_SCR_ELI                                                 
           IF FRM-FFLD = FRM-FFLD-PF5                                   
               PERFORM VAL-NUM-KEY-GAP                                  
               PERFORM VAL-NUM-FLD-GAP                                  
               PERFORM RST-STAT                                         
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY                     
               IF SCR-STAT NOT = SCR-STAT-ABT                           
                   PERFORM SCR-TRL                                      
               ELSE                                                     
                   PERFORM GNS-CLR-RQA                                  
                   PERFORM DESSCRTRL                                    
                   GO TO FIN-SCR-ELI.                                   
           PERFORM GNS-CLR-RQA.                                         
      *>>>>                                                             
*% END
*% IF PFS_SCR_ACT
      *<<<< PFS_SCR_ACT                                                 
           IF ( FRM-FFLD = FRM-FFLD-PF5 ) AND                           
              SCR-STAT = SCR-STAT-CON                                   
               PERFORM VAL-NUM-KEY-GAP                                  
               PERFORM VAL-NUM-FLD-GAP.                                 
           IF FRM-FFLD = FRM-FFLD-PF5                                   
               PERFORM RST-STAT                                         
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY                     
               IF SCR-STAT NOT = SCR-STAT-ABT                           
                   PERFORM SCR-TRL                                      
               ELSE                                                     
                   PERFORM GNS-CLR-RQA                                  
                   PERFORM DESSCRTRL                                    
                   GO TO FIN-SCR-ACT.                                   
           PERFORM GNS-CLR-RQA.                                         
      *>>>>                                                             
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY                                                 
           IF SCR-CCPP = 'ELI'                                          
              IF NOT FIO-STAT-OKS                                       
                 GO TO FIN-FND-KEY.                                     
                                                                        
      * Comando Consulta Error lo trata el GENESIS                      
           IF SCR-CCPP = 'ACC' AND                                      
              SCR-STPP = SCR-STAT-CON                                   
              GO TO FIN-FND-KEY.                                        
                                                                        
      * Garantia Alzada                                                 
           IF GDG-IND-EST1 IN GDG > '19'                                
               MOVE 'GDGALZ' TO MSG-COD-MENS                            
               GO TO ERR-FND-KEY.                                       
                                                                        
      * Garantia Completa                                               
           IF SCR-CCPP = 'ELI' AND                                      
              GDG-IND-GTAC IN GDG = 'S'                                 
               MOVE 'GAR    CPL' TO MSG-COD-MENS                        
               GO TO ERR-FND-KEY.                                       
                                                                        
      * Acreedor tiene GES asociadas                                    
           IF SCR-CCPP = 'ELI'                                          
              PERFORM BUS-GES-GDG                                       
              MOVE '00' TO FIO-STAT                                     
              IF WSS-MAR-UTIL IN WSS-VARI > ZEROES                      
                 MOVE 'EXI    GES' TO MSG-COD-MENS                      
                 GO TO ERR-FND-KEY.                                     
                                                                        
           GO TO FIN-FND-KEY.                                           
       ERR-FND-KEY.                                                     
           MOVE 'BGL' TO MSG-COD-SIST.                                  
           PERFORM GET-MSG.                                             
           MOVE MSG-GLS-DESC TO FRM-MENS.                               
           MOVE SCR-STAT-ABT TO SCR-STAT.                               
           IF SCR-CCPP = 'ING'                                          
               MOVE '00' TO FIO-STAT                                    
           ELSE                                                         
               MOVE FIO-STAT-NEX TO FIO-STAT.                           
                                                                        
      *>>>>                                                             
*% END
*% IF FIN_HBL_FLD
      *<<<<
           MOVE GDG-TIP-CGTA IN GAP-FLD TO WSS-COD-TOPE IN WSS-VARI.    
           MOVE GDG-STP-CGTA IN GAP-FLD TO WSS-COD-SOPE IN WSS-VARI.    
           MOVE GAP-CAI-GTIA IN GAP-FLD TO GDG-CAI-GTIA IN GDG.         
           MOVE GAP-IIC-GTIA IN GAP-FLD TO GDG-IIC-GTIA IN GDG.         
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-GDG.                                         
           IF NOT FIO-STAT-OKS                                          
              GO TO FIN-HBL-FLD.                                        
           IF GDG-COD-LGTA IN GDG = 'A'                                 
              GO TO FIN-HBL-FLD.                                        
                                                                        
           IF GDG-COD-LGTA IN GDG = 'E'                                 
              MOVE 'E' TO GAP-COD-GPRE IN GAP-FLD                       
              MOVE FRM-CPIM-AEY TO GAP-COD-GPRE-ATR IN GAP-FLD.         
           IF GDG-COD-LGTA IN GDG = 'G'                                 
              MOVE 'G' TO GAP-COD-GPRE IN GAP-FLD                       
              MOVE FRM-CPIM-AEY TO GAP-COD-GPRE-ATR IN GAP-FLD.         
      *>>>>                                                           
*% END
*% IF PFS_SCR_GKEY
      *<<<< PFS_SCR_GKEY                                                
           IF NOT                                                       
              ( FRM-FFLD = FRM-FFLD-PF5 )                               
      *>>>>                                                             
*% END
*% IF (PFS_GET_CON OR PFS_GET_ACC) AND PGM_PQ
      *<<<< PFS_GET_CON OR PFS_GET_ACC                                  
           IF NOT                                                       
              ( FRM-FFLD = FRM-FFLD-PF5 )                               
      *>>>>                                                             
*% END
*% IF EOF_PU
      *<<<<
      *<<<< EOF AND ( PGM_PU OR PGM_VMS )                               
       ESC-GMO-GAP SECTION.                                             
       INI-ESC-GMO-GAP.                                                 
      *INI-AFRI/MAY-2005                                                
           IF GAP-CAI-GTIA IN GAP = '0800'                              
                MOVE SPACES  TO MSG-COD-MENS                            
                GO TO FIN-ESC-GMO-GAP.                                  
      *FIN-AFRI/MAY-2005                                                
           MOVE ZEROES   TO GMO-NUM-IMOV IN GMO.                        
           PERFORM INI-GMO.                                             
           MOVE 'GAP001' TO GMO-COD-CMPO IN GMO.                        
           MOVE 'N'      TO GMO-IND-VALO IN GMO.                        
           MOVE 'N'      TO GMO-IND-CLVE IN GMO.                        
           MOVE DBC-NUM-ICLI IN GAP-FLD TO                              
                DBC-NUM-ICLI IN WSS-CPO.                                
           MOVE DBC-VRF-ICLI IN GAP-FLD TO                              
                DBC-VRF-ICLI IN WSS-CPO.                                
           MOVE DBC-IND-ICLI IN GAP-FLD TO                              
                DBC-IND-ICLI IN WSS-CPO.                                
           MOVE DBC-GLS-ICLI IN GAP-FLD TO                              
                DBC-GLS-ICLI IN WSS-CPO.                                
           IF GMO-COD-MOVI IN GMO = '1'                                 
              MOVE WSS-CPO TO GMO-GLS-NCMP IN GMO                       
           ELSE                                                         
           IF GMO-COD-MOVI IN GMO = '3'                                 
              MOVE WSS-CPO TO GMO-GLS-CMPA IN GMO.                      
                                                                        
           MOVE FIO-PUT TO FIO-CMND.                                    
           PERFORM BGL-FIO-GMO.                                         
           IF NOT FIO-STAT-OKS                                          
               MOVE 'GMO    PUT' TO MSG-COD-MENS.                       
       FIN-ESC-GMO-GAP.                                                 
           EXIT.                                                        
                               
       INI-GMO SECTION.                                                 
       INI-INI-GMO.                                                     
               MOVE SPACES TO GMO-GLS-FLAG IN GMO.                      
               MOVE ZEROES TO GMO-NUM-TASN IN GMO.                      
               MOVE SPACES TO GMO-COD-CMPO IN GMO.                      
               MOVE SPACES TO GMO-COD-CLVA IN GMO.                      
               MOVE SPACES TO GMO-GLS-CMPA IN GMO.                      
               MOVE ZEROES TO GMO-SGV-CMPA IN GMO.                      
               MOVE SPACES TO GMO-COD-NCLV IN GMO.                      
               MOVE SPACES TO GMO-GLS-NCMP IN GMO.                      
               MOVE ZEROES TO GMO-SGV-NCMP IN GMO.                      
               MOVE SPACES TO GMO-COD-TMOV IN GMO.                      
               MOVE SPACES TO GMO-GLS-DISP IN GMO.                      
               MOVE ZEROES TO GMO-VAL-CCON IN GMO.                      
               MOVE ZEROES TO GMO-VAL-CCOM IN GMO.                      
               PERFORM GET-FHOY.                                        
               MOVE HOY-FHOY TO GMO-FEC-FMOV IN GMO.                    
               MOVE HOY-HHOY TO GMO-HRA-HMOV IN GMO.                    
      *<<<< PGM_MVS OR PGM_DOS                                          
               MOVE SCR-OTRN TO GMO-TML-TMOV IN GMO.                    
               MOVE SCR-USER TO GMO-CIC-UING IN GMO.                    
      *<<<<                                                             
               MOVE HOY-FHOY                TO GMO-FEC-FING IN GMO.     
               MOVE GAP-CAI-GTIA IN GAP     TO GMO-CAI-GTIA IN GMO.     
               MOVE GAP-IIC-GTIA IN GAP     TO GMO-IIC-GTIA IN GMO.     
               MOVE GDG-COD-OFIC IN GAP-FLD TO GMO-COD-OFMV IN GMO.     
               ADD 1                        TO GMO-NUM-IMOV IN GMO.     
               MOVE 'S'                     TO GMO-IND-VALO IN GMO.     
               MOVE 'N'                     TO GMO-IND-CLVE IN GMO.     
       FIN-INI-GMO.                                                     
           EXIT.                                                        

      *<<<< EOF                                                         
       COPY BGLBFGDD.                                                   
       COPY BGLBFGMO.                                                   
       COPY GNSBGPES.                                                   
       BUS-IND-TREA SECTION.                                            
       INI-BUS-IND-TREA.                                                
           MOVE SPACES TO MSG-COD-MENS.                                 
           MOVE 'BGL'  TO TAB-COD-SIST.                                 
           MOVE 'RAL'  TO TAB-COD-TTAB IN TAB.                          
           MOVE TAG-IND-TREA IN TAG TO TAB-COD-CTAB IN TAB.             
           PERFORM BUS-TAB.                                             
           IF MSG-COD-MENS = SPACES                                     
              MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-TREA IN GAP-FLD       
           ELSE                                                         
              MOVE SPACES TO FRM-GLS-TREA IN GAP-FLD.                   
       FIN-BUS-IND-TREA.                                                
           EXIT.                                                        
                                                                        
       COPY GNSBVCOD.                                                   
       COPY GNSBVTAB.                                                   
       COPY BGLBFGDG.                                                   
       COPY GNSBBMSC.                                                   
       COPY BGLBFTAG.                                                   
       COPY BGLBFGES.                                                   
       COPY BGLBFGSO.                                                   
       COPY BGLBFGLE.                                                   
       COPY SGCBFDBC.                                                   
       COPY GNSBGCPT.                                                   
       COPY GNSBGSTR.                                                   
      *>>>>                                                             
      *>>>>
*% END
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI                                                
           03 CMA-VARI.                                                 
              05 GAR-CAI-GTIA                   PIC X(04).              
              05 GAR-IIC-GTIA                   PIC X(08).              
              05 GAR-IND-GTAC                   PIC X(01).              
              05 GAR-COD-GGTA                   PIC 9(02).              
              05 CNE-GAP-CAI-ICLI               PIC X(04).              
              05 CNE-GAP-IIC-ICLI               PIC X(08).              
              05 CNE-GAP-GLS-NOMA               PIC X(50).              
      *>>>>                                                             
*% END
*% IF WSS_VARI
      *<<<< WSS                                                         
       COPY BGLBRGDG.                                                   
       COPY BGLBRTAG.                                                   
       COPY BGLBRGMO.                                                   
       COPY GNSWGHOY.                                                   
       COPY BGLBRGDD.                                                   
       COPY BGLBRGES.                                                   
       COPY BGLBRGSO.                                                   
       COPY BGLBRGLE.                                                   
       COPY SGCBRDBC.                                                   
      *<<<< NOT PGM_PU                                                  
       COPY BGLWGVCG.                                                   
      *>>>>                                                             
       COPY GNSWGCPT.                                                   
       COPY GNSWGSTR.                                                   
       COPY GNSWGPES.                                                   
                                                                        
      *<<<< PGM_CHI AND PGM_PQ                                          
                                                                        
      *********************************************                     
      *           MODULO   USPC113                *                     
      *********************************************                     
      *       DEFINICION IDENTIFICACION TS        *                     
      *********************************************                     
                                                                        
       01  UIB.                                                         
           02  FILLER                  PIC X(32) VALUE 'USPR002'.       
       01  USP-LARGO-TS                PIC S9(4) COMP VALUE +150.       
       01  USP-IDENTIFICACION.                                          
           05  USP-TERMINAL            PIC X(04).                       
           05  USP-OPID-USU            PIC X(03).                       
           05  FILLER                  PIC X(01)  VALUE ' '.            
       01  USP-LLENA-VECTOR            PIC X(1)   VALUE ' '.            
       01  USP-USA-VECTOR              PIC X(1)   VALUE ' '.            
                                                                        
      *********************************************                     
      *       DEFINICION AREA DE TRASPASO         *                     
      *********************************************                     
                                                                        
       01  AREA-TRASPASO.                                               
           05  USP-PERMISO             PIC X(01).                       
           05  USP-PTA-NUM             PIC 9(03)  VALUE 0.              
           05  USP-PTA-STR             PIC X(12)  VALUE SPACES.         
           05  USP-AREA-COMUN.                                          
               10  USP-TIPO-USUARIO.                                    
                   15  USP-IDENT-TU    PIC X(03).                       
      *                TIPO DE USUARIO                                  
                                                                        
                   15  USP-MODO-OP     PIC X(01).                       
      *                MODO OPERACION (CONSULTA/ACTUALIZACION)          
                                                                        
               10  USP-SISTEMA.                                         
                   15  USP-IDENT-SIS   PIC X(03).                       
      *                IDENTIFICACION DEL SISTEMA QUE SE ESTA PROCE_    
      *                SANDO SEGUN USUARIOS Y PRIVILEGIOS               
                                                                        
                   15  USP-GRUPO       PIC X(03).                       
      *                IDENTIFICACION DEL GRUPO DE SISTEMA QUE SE ESTA  
      *                PROCESANDO SEGUN USUARIOS Y PRIVILEGIOS          
      *                                                                 
                                                                        
               10  USP-INDIC-PROCESO   PIC X(01).                       
      *            INDICADOR DE SISTEMA USUARIO Y PRIVILEGIO  ACTIVO    
                                                                        
               10  USP-COD-OFICINA     PIC X(03).                       
      *            CODIGO DE LA OFICINA DEL USUARIO                     
                                                                        
               10  USP-COD-DEPTO       PIC X(03).                       
      *            CODIGO DEL DEPTO DEL USUARIO                         
                                                                        
               10  USP-COD-USUARIO     PIC X(12).                       
      *            CODIGO USUARIO (TABLA USR)                           
                                                                        
               10  USP-COD-TERMINAL    PIC X(04).                       
      *            CODIGO DE TERMINAL                                   
                                                                        
               10  USP-OPID            PIC X(03).                       
      *            OPID DE USUARIO                                      
                                                                        
               10  USP-FECHA.                                           
      *            FECHA                                                
                   15  USP-ANO         PIC X(02).                       
                   15  USP-MES         PIC X(02).                       
                   15  USP-DIA         PIC X(02).                       
                                                                        
               10  USP-HORA            PIC X(06).                       
      *            HORA                                                 
                                                                        
               10  USP-PASSWORD        PIC X(08).                       
      *            PASSWORD DE USUARIO(SOLO PARA CONECCION VIA RUTINA)  
                                                                        
               10  USP-INDICADORES.                                     
                   15  USP-USU-CMN1    PIC X(01).                       
      *            1   */CON       CONSULTA                             
      *            2   */MAN       CONSULTA Y MANTENCION                
      *            3   */*         TODO                                 
      *                                                                 
                   15  USP-USU-CMN2    PIC X(01).                       
      *            P   *           PERMISO AL MENU                      
      *                                                                 
                   15  USP-USU-CMN3    PIC X(01).                       
      *            P   */OFI       OTRAS OFICINAS                       
      *                                                                 
                   15  USP-USU-CMN4    PIC X(01).                       
                   15  USP-USU-CMN5    PIC X(01).                       
                   15  USP-USU-CMN6    PIC X(01).                       
                   15  USP-USU-CMN7    PIC X(01).                       
                   15  USP-USU-CMN8    PIC X(01).                       
                   15  USP-USU-CMN9    PIC X(01).                       
                   15  USP-USU-CMN10   PIC X(01).                       
                   15  USP-USU-CMN11   PIC X(01).                       
                   15  USP-USU-CMN12   PIC X(01).                       
                   15  USP-USU-CMN13   PIC X(01).                       
                   15  USP-USU-CMN14   PIC X(01).                       
                   15  USP-USU-CMN15   PIC X(01).                       
                   15  USP-USU-CMN16   PIC X(01).                       
               10  USP-INDICADORES-RED REDEFINES USP-INDICADORES.       
                   15  USP-USU-CMN-ARR OCCURS 16 TIMES   PIC X(01).     
      *                                                                 
      *            INDICADORES QUE  INDICAN PRIVILEGIO DE USUARIOS      
      *                                                                 
               10  FILLER              PIC X(78).                       
      *            DISPONIBLE USO FUTURO                                
      *                                                                 
      *********************************************                     
      *     AREAS PARA LECTURA DE TABLA "STR"     *                     
      *********************************************                     
      *                                                                 
      *01  COPYDD USP-R-STR.USP-E-STR01(PROD).                          
       01  USP-E-STR01.                                                 
           02  USP-CLV-STR-1.                                           
               03  USP-COD-GST     PICTURE X(3).                        
               03  USP-COD-STR     PICTURE X(12).                       
           02  USP-COD-PTA         PICTURE X(3).                        
      *                                                                 
       01  REQ-AREA.                                                    
               05  COD-CMND            PIC X(005).                      
               05  NOM-TABL            PIC X(003).                      
               05  NOM-CLAV            PIC X(005).                      
               05  RET-CODI            PIC X(002).                      
               05  RET-INTE            PIC X(001).                      
               05  NUM-BASE            PIC S9(004) COMP VALUE +120.     
               05  NOM-REGI            PIC X(007).                      
               05  FILLER              PIC X(025).                      
               05  MAX-CONT            PIC S9(004) COMP.                
               05  NOM-CONT            PIC S9(004) COMP.                
               05  FILLER              PIC X(022).                      
               05  VAL-CLAV.                                            
                   10  FECHA           PIC 9(008).                      
                   10  HORA            PIC 9(006).                      
      *                                                                 
       01  ELEM-LIST.                                                   
               05  NOM-ELEM            PIC X(011).                      
               05  SEC-CODI            PIC X(001).                      
               05  FILLER              PIC X(005) VALUE SPACES.         
      *                                                                 
       01  REQ-AREA-STR.                                                
               05  COD-CMND-STR        PIC X(005).                      
               05  NOM-TABL-STR        PIC X(003).                      
               05  NOM-CLAV-STR        PIC X(005).                      
               05  RET-CODI-STR        PIC X(002).                      
               05  RET-INTE-STR        PIC X(001).                      
               05  NUM-BASE-STR        PIC S9(004) COMP VALUE +120.     
               05  NOM-REGI-STR        PIC X(007).                      
               05  FILLER              PIC X(025).                      
               05  MAX-CONT-STR        PIC S9(004) COMP.                
               05  NOM-CONT-STR        PIC S9(004) COMP.                
               05  FILLER              PIC X(022).                      
               05  VAL-CLAV-STR.                                        
                   10  USP-COD-GST     PIC X(003).                      
                   10  USP-COD-STR     PIC X(012).                      
      *                                                                 
       01  ELEM-LIST-STR.                                               
               05  NOM-ELEM-STR        PIC X(011).                      
               05  SEC-CODI-STR        PIC X(001).                      
               05  FILLER              PIC X(005) VALUE SPACES.         
      *                                                                 
      *********************************************                     
      *           FIN   MODULO   USPC113          *                     
      *********************************************                     
                                                                        
      *>>>>                                                             
       01  WSS-VARI.                                                    
           03 WSS-CPO.                                                  
      *<<<< NOT PGM_ARG                                                 
              05 DBC-NUM-ICLI                  PIC 9(08).               
      *>>>>                                                             
              05 DBC-VRF-ICLI                  PIC X(01).               
              05 DBC-IND-ICLI                  PIC X(01).               
      *<<<< NOT PGM_ARG                                                 
              05 DBC-GLS-ICLI                  PIC X(03).               
      *>>>>                                                             
           03 WSS-COD-CGTA.                                             
              05 WSS-COD-TOPE                  PIC X(03).               
              05 WSS-COD-SOPE                  PIC X(03).               
                                                                        
           03 WSS-HOY-ANO.                                              
              05 WSS-SHOY                      PIC 9(02).               
              05 WSS-AHOY                      PIC 9(02).               
           03 GDG-COD-GGTA VALUE ZEROES        PIC 9(01).               
           03 WSS-FHOY.                                                 
              05 WSS-ANO                       PIC 9(04).               
              05 WSS-AUX                       PIC 9(04).               
           03  WSS-MAR-UTIL                    PIC 9(03).               
      *MHM-INI 23-OCT-2003                                              
           03 WSS-GLS-CGTA.                                             
              05 WSS-GLS-TOPE                   PIC X(40).              
              05 WSS-GLS-SOPE                   PIC X(40).              
      *MHM-FIN 23-OCT-2003                                              
      *<<<< FMT_CHI                                                     
           03 WSS-IDC-ICLI.                                             
              05 WSS-NUM-ICLI                  PIC 9(08).               
              05 WSS-IND-ICLI                  PIC X(01).               
              05 WSS-GLS-ICLI                  PIC X(03).               
      *>>>>                                                             
      *<<<< PGM_DTC                                                     
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GMO-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GES-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSO-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GLE-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.        
      *>>>>                                                             
      *>>>>                                                             
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY                                                 
      *MHM-INI 23-MAY-2006                                              
      **MHM-INI 5-AUG-2003                                              
      **CGL-INI 05-05-2003 PARA DEJAR GENERABLE VERSION BCI             
      * Llama a Subrutina Validacion Consistencia Garantia              
      *    IF FRM-FFLD = FRM-FFLD-PF5                                   
      *        PERFORM GAR-PRO-VCG                                      
      *        GO TO FIN-FND-KEY.                                       
      *                                                                 
      **MHM-FIN 5-AUG-2003                                              
      *MHM-FIN 23-MAY-2006                                              
       BUS-GDG.                                                         
           MOVE GAP-CAI-GTIA IN GAP-FLD TO GDG-CAI-GTIA IN GDG.         
           MOVE GAP-IIC-GTIA IN GAP-FLD TO GDG-IIC-GTIA IN GDG.         
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-GDG.                                         
           MOVE FIO-STAT TO PGM-STAT-GDG.                               
           IF NOT FIO-STAT-OKS                                          
               MOVE 'GDG    NEX' TO MSG-COD-MENS                        
               GO TO ERR-FND-KEY.                                       
      *<<<< PGM_CHI                                                     
                                                                        
           IF SCR-CCPP = 'ACC' AND SCR-STAT = SCR-STAT-CON              
               GO TO FIN-VAL-OFI-USP-GAP.                               
           IF SCR-OFRM-SRV                                              
              GO TO FIN-VAL-OFI-USP-GAP.                                
                                                                        
           MOVE 'TAB'          TO FIO-SIST.                             
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.                  
           MOVE 'OFIUSP'       TO TAB-COD-CTAB IN TAB.                  
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM GNS-FIO-TAB.                                         
           IF NOT ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S' )        
               GO TO FIN-VAL-OFI-USP-GAP.                               
                                                                        
      *ALD-BCI-INI/07032000                                             
                                                                        
      **********************************                                
      *            MODULO  USPC143     *                                
      **********************************                                
       USP-CHEQUEO-TS.                                                  
           EXEC CICS HANDLE CONDITION                                   
                              QIDERR(USP-IR-MENU-GENERAL)               
           END-EXEC.                                                    
           EXEC CICS ASSIGN OPID(USP-OPID-USU)                          
           END-EXEC.                                                    
           MOVE EIBTRMID   TO USP-TERMINAL.                             
           EXEC CICS READQ TS QUEUE(USP-IDENTIFICACION)                 
                              INTO(USP-AREA-COMUN)                      
                              LENGTH(USP-LARGO-TS)                      
                              ITEM(+1)                                  
           END-EXEC.                                                    
           GO TO USP-INICIO-PROGRAMA.                                   
       USP-IR-MENU-GENERAL.                                             
           EXEC CICS XCTL PROGRAM('USDP930')                            
           END-EXEC.                                                    
       USP-INICIO-PROGRAMA.                                             
      ***************************************                           
      *            FIN  MODULO  USPC143     *                           
      ***************************************                           
      *                                                                 
           MOVE 'BGLGTUCG/CEN' TO USP-PTA-STR.                          
           COPY USPC103.                                                
           IF USP-PERMISO = 'P'                                         
               GO TO FIN-VAL-OFI-USP-GAP.                               
      *    COPY USPC143.                                                
      *ALD-BCI-FIN/07032000                                             
           IF USP-COD-OFICINA NOT = GDG-COD-OFIC IN GDG                 
               MOVE 'USRNODEOFI' TO MSG-COD-MENS                        
               GO TO ERR-FND-KEY.                                       
                                                                        
       FIN-VAL-OFI-USP-GAP.                                             
      *>>>>                                                             
                                                                        
       FIN-BUS-GDG.                                                     
      *<<<<                                                             
           MOVE GDG-TIP-CGTA IN GDG TO GDG-TIP-CGTA IN GAP-FLD.         
           MOVE GDG-STP-CGTA IN GDG TO GDG-STP-CGTA IN GAP-FLD.         
      *>>>>                                                             
                                                                        
      *BUS-TAB Busca codigo de tabla                                    
           MOVE 'TAB' TO TAB-COD-SIST.                                  
      *<<<< GEN_BCI                                                     
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.                           
      *>>>>                                                             
           MOVE SPACES TO TAB-COD-CTAB IN TAB.                          
                                                                        
      *<<<<                                                             
           MOVE GDG-TIP-CGTA IN GAP-FLD TO TAG-TIP-AGTA IN TAG.         
           MOVE GDG-STP-CGTA IN GAP-FLD TO TAG-STP-AGTA IN TAG.         
      *>>>>                                                             
      *MHM-INI 24-OCT-2003                                              
      *     MOVE TAG-COD-AGTA IN TAG TO TAB-COD-CTAB IN TAB.            
      *     PERFORM BUS-TAB.                                            
      *     IF MSG-COD-MENS = SPACES                                    
      *         MOVE TAB-GLS-DESC IN TAB TO                             
      *              FRM-GLS-CGTA IN GAP-FLD                            
      *     ELSE                                                        
      *         MOVE SPACES TO FRM-GLS-CGTA IN GAP-FLD.                 
      *MHM-FIN 24-OCT-2003                                              
                                                                        
      * Busca Glosa Tabla Real/no Real                                  
           MOVE FIO-GET-KEY    TO FIO-CMND.                             
           PERFORM BGL-FIO-TAG.                                         
           IF NOT FIO-STAT-OKS                                          
                MOVE 'TAG    NEX' TO MSG-COD-MENS                       
                MOVE 'BGL' TO MSG-COD-SIST                              
                PERFORM GET-MSG                                         
           ELSE                                                         
                PERFORM BUS-IND-TREA.                                   
                                                                        
      * Valida Este permitido esta Entidad para Tipo-Subtipo            
           IF TAG-IND-EGAP IN TAG = 'N'                                 
               MOVE 'TAG    NOPGM' TO MSG-COD-MENS                      
               GO TO ERR-FND-KEY.                                       
                                                                        
           MOVE GDG-CAI-GTIA IN GDG TO GAR-CAI-GTIA IN CMA-VARI.        
           MOVE GDG-IIC-GTIA IN GDG TO GAR-IIC-GTIA IN CMA-VARI.        
           MOVE GDG-IND-GTAC IN GDG TO GAR-IND-GTAC IN CMA-VARI.        
                                                                        
           IF SCR-CMND = 'ING'                                          
               PERFORM PUT-GDG-GAP                                      
               IF GDG-IND-EST1 IN GDG > '09' AND                        
                  GDG-IND-EST1 IN GDG < '20' AND                        
                  GDG-IND-GTAC IN GDG = 'S'                             
                  MOVE 'GDG    AGAYA' TO MSG-COD-MENS                   
                  GO TO ERR-FND-KEY.                                    
      *>>>>                                                             
*% END
*% IF CMN_MOD
      *<<<< INI_CMN_ING OR INI_CMN_MOD
           PERFORM GET-FHOY.                                            
           IF SCR-CCPP = 'ING'                                          
              OR SCR-CMND = 'COP'                                       
               MOVE 'I'      TO GAP-MSC-TACC IN GAP                     
               MOVE HOY-FHOY TO GAP-FEC-FING IN GAP                     
               MOVE SCR-USER TO GAP-CIC-UING IN GAP                     
           ELSE                                                         
               MOVE 'M'      TO GAP-MSC-TACC IN GAP.                    
      *>>>>
      *<<<< CMN_MOD                                                     
      *MHM-INI 5-AUG-2003                                               
           IF GAR-IND-GTAC IN CMA-VARI NOT = 'S'                        
               MOVE GAP-CAI-GTIA IN GAP TO GSO-CAI-GTIA IN GSO          
               MOVE GAP-IIC-GTIA IN GAP TO GSO-IIC-GTIA IN GSO          
               MOVE 'GSO-KEY-IGDG' TO FIO-AKEY                          
               MOVE FIO-GET-KEY TO FIO-CMND                             
               PERFORM BGL-FIO-GSO                                      
               IF FIO-STAT-OKS AND GSO-COD-ESGA IN GSO NOT < '06'       
                   MOVE 'GSOESGA>06' TO MSG-COD-MENS                    
                   MOVE 'BGL' TO MSG-COD-SIST                           
                   PERFORM GET-MSG                                      
                   MOVE MSG-GLS-DESC TO FRM-MENS                        
                   MOVE SCR-STAT-CON TO SCR-STAT                        
                   GO TO FIN-CMN-MOD.                                   
                                                                        
      *MHM-FIN 5-AUG-2003                                               
      *>>>>                                                             
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD                                                 
           IF NOT FIO-STAT-OKS                                          
      *        Error inconsistencia en la modificacion : informar       
               MOVE FIO-MENS TO FRM-MENS                                
               GO TO FIN-CMN-MOD.                                       
      *>>>>                                                             
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING                                                 
           MOVE SPACES TO GAP-GLS-FLAG IN GAP.                          
           MOVE SPACES TO GAP-MSC-TACC IN GAP.                          
           MOVE SPACES TO GAP-CIC-UING IN GAP.                          
           MOVE 'I'    TO GAP-MSC-STAT IN GAP.                          
      *>>>>                                                             
*% END
*% IF CMN_ING
      *<<<< INI_CMN_ING OR INI_CMN_MOD                                
           PERFORM GET-FHOY.                                            
           IF SCR-CCPP = 'ING'                                          
              OR SCR-CMND = 'COP'                                       
               MOVE 'I'      TO GAP-MSC-TACC IN GAP                     
               MOVE HOY-FHOY TO GAP-FEC-FING IN GAP                     
               MOVE SCR-USER TO GAP-CIC-UING IN GAP                     
           ELSE                                                         
               MOVE 'M'      TO GAP-MSC-TACC IN GAP.                    
      *>>>>                                                             
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING                                                 
           IF NOT FIO-STAT-OKS                                          
      *        Error inconsistencia en el ingreso : informar            
               MOVE FIO-MENS TO FRM-MENS                                
               GO TO FIN-CMN-ING.                                       
                                                                        
           IF GAR-IND-GTAC IN CMA-VARI NOT = 'S'                        
               GO TO SIG-CMN-ING.                                       
                                                                        
           MOVE '1' TO GMO-COD-MOVI IN GMO.                             
           PERFORM ESC-GMO-GAP.                                         
           IF MSG-COD-MENS > SPACES                                     
               MOVE 'BGL' TO MSG-COD-SIST                               
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE SCR-STAT-CON TO SCR-STAT                            
               GO TO FIN-CMN-ING.                                       
       SIG-CMN-ING.                                                     
           IF NOT FIO-STAT-OKS                                          
      *        Error inconsistencia en el ingreso : informar            
               MOVE FIO-MENS TO FRM-MENS                                
               GO TO FIN-CMN-ING.                                       
                                                                        
      *<<<< GEN_BCI                                                     
      *MHM-INI 30-SEP-2003                                              
      **MHM-INI 5-AUG-2003                                              
      *     IF GAR-IND-GTAC IN CMA-VARI NOT = 'S'                       
      *         MOVE GAP-CAI-GTIA IN GAP TO GSO-CAI-GTIA IN GSO         
      *         MOVE GAP-IIC-GTIA IN GAP TO GSO-IIC-GTIA IN GSO         
      *         MOVE 'GSO-KEY-IGDG' TO FIO-AKEY                         
      *         MOVE FIO-GET-KEY TO FIO-CMND                            
      *         PERFORM GAR-FIO-GSO                                     
      *         IF FIO-STAT-OKS                                         
      *             PERFORM MOD-EST-GSO                                 
      *             IF MSG-COD-MENS > SPACES                            
      *                MOVE 'GAR' TO MSG-COD-SIST                       
      *                PERFORM GET-MSG                                  
      *                MOVE MSG-GLS-DESC TO FRM-MENS                    
      *                MOVE SCR-STAT-CON TO SCR-STAT                    
      *                GO TO FIN-CMN-ING.                               
      *                                                                 
      **MHM-FIN 5-AUG-2003                                              
      *MHM-FIN 30-SEP-2003                                              
      *>>>>                                                             
           MOVE GAP-CAI-GTIA IN GAP TO GDG-CAI-GTIA IN GDG.             
           MOVE GAP-IIC-GTIA IN GAP TO GDG-IIC-GTIA IN GDG.             
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.                            
           PERFORM BGL-FIO-GDG.                                         
           IF FIO-STAT-OKS                                              
      *MHM-INI 30-SEP-2003                                              
               PERFORM MOD-COD-PACR                                     
      *MHM-FIN 30-SEP-2003                                              
               MOVE 'S' TO GDG-IND-EGAP IN GDG                          
               MOVE FIO-MOD TO FIO-CMND                                 
               PERFORM BGL-FIO-GDG.                                     
      *>>>>                                                             
*% END
*% IF CMN_ELI
      *<<<< CMN_ELI                                                     
      *MHM-INI 5-AUG-2003  EVA/JUN2007   PRELACION                      
           MOVE GAP-CAI-GTIA IN GAP TO GLE-CAI-GTIA IN GLE.             
           MOVE GAP-IIC-GTIA IN GAP TO GLE-IIC-GTIA IN GLE.             
           MOVE GAP-COD-PACR IN GAP TO GLE-COD-PACR IN GLE.             
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-GLE.                                         
           IF FIO-STAT-OKS                                              
                MOVE 'GAP CONGLE' TO MSG-COD-MENS                       
                MOVE 'BGL' TO MSG-COD-SIST                              
                PERFORM GET-MSG                                         
                MOVE MSG-GLS-DESC TO FRM-MENS                           
                MOVE SCR-STAT-CON TO SCR-STAT                           
                MOVE 'S' TO SCR-IERR                                    
                GO TO FIN-CMN-ELI.                                      
                                                                        
           MOVE GAP-CAI-GTIA IN GAP TO GES-CAI-GTIA IN GES.             
           MOVE GAP-IIC-GTIA IN GAP TO GES-IIC-GTIA IN GES.             
           MOVE ZEROES              TO GES-NUM-IGES IN GES.             
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM BGL-FIO-GES.                                         
           IF FIO-STAT-OKS AND                                          
               GES-CAI-GTIA IN GES = GAP-CAI-GTIA IN GAP AND            
               GES-IIC-GTIA IN GES = GAP-IIC-GTIA IN GAP AND            
               GES-COD-PACR IN GES = GAP-COD-PACR IN GAP                
                MOVE 'GAP CONGES' TO MSG-COD-MENS                       
                MOVE 'BGL' TO MSG-COD-SIST                              
                PERFORM GET-MSG                                         
                MOVE MSG-GLS-DESC TO FRM-MENS                           
                MOVE SCR-STAT-CON TO SCR-STAT                           
                MOVE 'S' TO SCR-IERR                                    
                GO TO FIN-CMN-ELI.                                      
                                                                        
      *MHM-FIN 5-AUG-2003                                               
      *>>>>                                                             
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI                                                 
           IF NOT FIO-STAT-OKS                                          
      *        Error inconsistencia en la eliminacion : informar        
               MOVE FIO-MENS TO FRM-MENS                                
               GO TO FIN-CMN-ELI.                                       
                                                                        
           IF GAR-IND-GTAC IN CMA-VARI NOT = 'S'                        
               GO TO SIG-CMN-ELI.                                       
                                                                        
           MOVE '3' TO GMO-COD-MOVI IN GMO.                             
           PERFORM ESC-GMO-GAP.                                         
           IF MSG-COD-MENS > SPACES                                     
               MOVE 'BGL' TO MSG-COD-SIST                               
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE SCR-STAT-CON TO SCR-STAT                            
               MOVE 'S' TO SCR-IERR                                     
               GO TO FIN-CMN-ELI.                                       
       SIG-CMN-ELI.                                                     
                                                                        
           IF NOT FIO-STAT-OKS                                          
      *        Error inconsistencia en la eliminacion : informar        
               MOVE FIO-MENS TO FRM-MENS                                
               GO TO FIN-CMN-ELI.                                       
                                                                        
      * Guarda Llave Padre                                              
                                                                        
      * Para saber si queda o no un hijo y grabar el Indicador en GDG   
           MOVE SPACES                   TO GAP-KEY-IGAP IN GAP.        
           MOVE GAR-CAI-GTIA IN CMA-VARI TO GAP-CAI-GTIA IN GAP.        
           MOVE GAR-IIC-GTIA IN CMA-VARI TO GAP-IIC-GTIA IN GAP.        
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           MOVE 'GAP-KEY-IGAP' TO FIO-AKEY.                             
           PERFORM BGL-FIO-GAP.                                         
           IF FIO-STAT-OKS AND                                          
              GAP-CAI-GTIA IN GAP = GAR-CAI-GTIA IN CMA-VARI AND        
              GAP-IIC-GTIA IN GAP = GAR-IIC-GTIA IN CMA-VARI            
               GO TO FIN-CMN-ELI.                                       
                                                                        
      * No quedo ningun hijo                                            
           MOVE GAR-CAI-GTIA IN CMA-VARI TO GDG-CAI-GTIA IN GDG.        
           MOVE GAR-IIC-GTIA IN CMA-VARI TO GDG-IIC-GTIA IN GDG.        
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.                            
           PERFORM BGL-FIO-GDG.                                         
           IF FIO-STAT-OKS                                              
               MOVE ' ' TO GDG-IND-EGAP IN GDG                          
               MOVE FIO-MOD TO FIO-CMND                                 
               PERFORM BGL-FIO-GDG                                      
               IF NOT FIO-STAT-OKS                                      
                   MOVE FIO-MENS TO FRM-MENS                            
               ELSE                                                     
                   NEXT SENTENCE                                        
           ELSE                                                         
               MOVE FIO-MENS TO FRM-MENS.                               
      *>>>>                                                             
*% END
*% IF EOF AND PGM_DTC AND PGM_PU
      *<<<< EOF AND PGM_DTC                                             
       COPY GNSBGVSM.                                                   
       COPY GNSBHVSM.                                                   
       COPY GNSBGHOY.                                                   
      *>>>>                                                             
*% END
*% IF EOF_PQ
      *<<<< EOF                                                         
       RST-STAT SECTION.                                                
       INI-RST-STAT.                                                    
           MOVE SCR-STPP     TO SCR-STAT.                               
           MOVE SCR-MFLD-NOT TO SCR-MFLD.                               
       FIN-RST-STAT.                                                    
           EXIT.                                                        
                                                                        
       GNS-CLR-RQA SECTION.                                             
       INI-GNS-CLR-RQA.                                                 
       FIN-GNS-CLR-RQA.                                                 
           EXIT.                                                        
      *>>>>                                                             
      *<<<< EOF AND PGM_DTC                                             
       COPY GNSBGVSM.                                                   
       COPY GNSBHVSM.                                                   
       COPY GNSBGHOY.                                                   
      *>>>>                                                             
      *<<<< EOF                                                         
       COPY BGLBFGDD.                                                   
       COPY BGLBFGMO.                                                   
       COPY GNSBGPES.                                                   
                                                                        
       BUS-IND-TREA SECTION.                                            
       INI-BUS-IND-TREA.                                                
           MOVE SPACES TO MSG-COD-MENS.                                 
           MOVE 'BGL'  TO TAB-COD-SIST.                                 
           MOVE 'RAL'  TO TAB-COD-TTAB IN TAB.                          
           MOVE TAG-IND-TREA IN TAG TO TAB-COD-CTAB IN TAB.             
           PERFORM BUS-TAB.                                             
           IF MSG-COD-MENS = SPACES                                     
              MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-TREA IN GAP-FLD       
           ELSE                                                         
              MOVE SPACES TO FRM-GLS-TREA IN GAP-FLD.                   
       FIN-BUS-IND-TREA.                                                
           EXIT.                                                        
                                                                        
       COPY GNSBVCOD.                                                   
       COPY GNSBVTAB.                                                   
       COPY BGLBFGDG.                                                   
       COPY GNSBBMSC.                                                   
       COPY BGLBFTAG.                                                   
       COPY BGLBFGES.                                                   
       COPY BGLBFGSO.                                                   
       COPY BGLBFGLE.                                                   
      *<<<< NOT PGM_PU AND NOT PGM_CLB AND NOT PGM_MEX                  
       COPY BGLBGVCG.                                                   
       COPY BGLBKVCG.                                                   
      *>>>>                                                             
       COPY SGCBFDBC.                                                   
       COPY GNSBGCPT.                                                   
       COPY GNSBGSTR.                                                   
      *<<<< PGM_PQ                                                      
       BUS-COR-GAP SECTION.                                             
       INI-BUS-COR-GAP.                                                 
           MOVE GAP-CAI-GTIA IN GAP-FLD TO GAP-CAI-GTIA IN GAP.         
           MOVE GAP-IIC-GTIA IN GAP-FLD TO GAP-IIC-GTIA IN GAP.         
           MOVE 99                      TO GAP-COD-PACR IN GAP.         
           MOVE FIO-GET-LEQ TO FIO-CMND.                                
           PERFORM BGL-FIO-GAP.                                         
           IF NOT ( FIO-STAT-OKS AND                                    
                    GAP-CAI-GTIA IN GAP-FLD = GAP-CAI-GTIA  IN GAP AND  
                    GAP-IIC-GTIA IN GAP-FLD = GAP-IIC-GTIA  IN GAP )    
               PERFORM KEY-GAP-GAP                                      
               MOVE ZEROES TO GAP-COD-PACR IN GAP.                      
                                                                        
           IF FIO-STAT-OKS                                              
               MOVE FIO-END-BRW TO FIO-CMND                             
               PERFORM BGL-FIO-GAP.                                     
                                                                        
           IF SCR-CCPP = 'ING' OR 'ACT'                                 
               ADD 1 TO GAP-COD-PACR IN GAP                             
               MOVE GAP-COD-PACR IN GAP TO                              
                    GAP-COD-PACR IN GAP-FLD.                            
                                                                        
       FIN-BUS-COR-GAP.                                                 
           EXIT.                                                        
       BUS-GES-GDG SECTION.                                             
       INI-BUS-GES-GDG.                                                 
                                                                        
           MOVE ZEROES                  TO WSS-MAR-UTIL IN WSS-VARI.    
           MOVE GAP-CAI-GTIA IN GAP-FLD TO GES-CAI-GTIA IN GES.         
           MOVE GAP-IIC-GTIA IN GAP-FLD TO GES-IIC-GTIA IN GES.         
           MOVE ZEROES                  TO GES-NUM-IGES IN GES.         
           MOVE FIO-GET-NLS TO FIO-CMND.                                
           PERFORM BGL-FIO-GES.                                         
       LUP-BUS-GES-GDG.                                                 
           IF NOT ( FIO-STAT-OKS AND                                    
                GAP-CAI-GTIA  IN GAP-FLD = GES-CAI-GTIA  IN GES AND     
                GAP-IIC-GTIA  IN GAP-FLD = GES-IIC-GTIA  IN GES )       
                GO TO FIN-BUS-GES-GDG.                                  
                                                                        
           IF GES-COD-PACR IN GES = GAP-COD-PACR  IN GAP-FLD            
              ADD  1 TO  WSS-MAR-UTIL IN WSS-VARI                       
              GO TO FIN-BUS-GES-GDG.                                    
                                                                        
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           PERFORM BGL-FIO-GES.                                         
           GO TO LUP-BUS-GES-GDG.                                       
                                                                        
       FIN-BUS-GES-GDG.                                                 
           EXIT.                                                        
                                                                        
                                                                        
      *>>>>                                                             
      *>>>>                                                             
*% END
*% IF EOF_PU
      *<<<< GEN_BCI                                                     
       MOD-EST-GSO SECTION.                                             
       INI-MOD-EST-GSO.                                                 
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.                            
           PERFORM BGL-FIO-GSO.                                         
           IF FIO-STAT-OKS                                              
              MOVE '02' TO GSO-COD-EST2 IN GSO                          
              MOVE FIO-MOD TO FIO-CMND                                  
              PERFORM BGL-FIO-GSO                                       
              IF NOT FIO-STAT-OKS                                       
                 MOVE 'GSO  NOMOD' TO MSG-COD-MENS                      
              ELSE                                                      
                 NEXT SENTENCE                                          
           ELSE                                                         
                 MOVE 'GSO  NOUPD' TO MSG-COD-MENS.                     
       FIN-MOD-EST-GSO.                                                 
           EXIT.                                                        
      *MHM-INI 30-SEP-2003                                              
       MOD-COD-PACR SECTION.                                            
       INI-MOD-COD-PACR.                                                
           IF GAP-IND-ESBA IN GAP-FLD = 'S' AND                         
              ( GAP-COD-PACR IN GAP-FLD < GDG-COD-GGTA IN GDG OR        
                GDG-COD-GGTA IN GDG NOT > SPACES )                      
               MOVE GAP-COD-PACR IN GAP-FLD TO GDG-COD-GGTA IN GDG.     
       FIN-MOD-COD-PACR.                                                
           EXIT.                                                        
      *MHM-FIN 30-SEP-2003                                              
      *>>>>                                                             
      *>>>>                                                             
                                                                        
      * EVA-AFRI/MAY2007 PRELACION                                      
       LEE-GAP SECTION.                                                 
       INI-LEE-GAP.                                                     
           MOVE GAP-CAI-GTIA IN GAP-FLD TO GDG-CAI-GTIA IN GDG.         
           MOVE GAP-IIC-GTIA IN GAP-FLD TO GDG-IIC-GTIA IN GDG.         
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-GDG.                                         
       FIN-LEE-GAP.                                                     
           EXIT.                                                        
      *>>>>                                                             
*% END
