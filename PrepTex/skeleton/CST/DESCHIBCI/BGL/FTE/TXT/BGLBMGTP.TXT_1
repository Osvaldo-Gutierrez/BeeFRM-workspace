*% FRM = 'GTP'
*% REG = 'GTP'
*% VSNBQ = "06.06.22"
*% FNCBQ = "OWFBGL"
*% VSNBU = "06.06.22"
*% FNCBU = "OWFBGL"
*% GEN_BCI = TRUE
*% IF INI_VAL_FLD_GTP
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
            MOVE GTP-CAI-GTIA IN GTP-FLD TO GDG-CAI-GTIA IN GDG.
            MOVE GTP-IIC-GTIA IN GTP-FLD TO GDG-IIC-GTIA IN GDG.
            MOVE FIO-GET-KEY TO FIO-CMND.
            PERFORM BGL-FIO-GDG.
      *VERIFICA SI PRODUCTO (TIPO-SUBTIPO) ES FFMM
           MOVE SPACES              TO WSS-IND-FFMM.
           MOVE 'BGL'               TO TAB-COD-SIST FIO-SIST.
           MOVE 'PFM'               TO TAB-COD-TTAB IN TAB.
           MOVE GDG-COD-CGTA IN GDG TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = WSS-S
               MOVE WSS-S  TO WSS-IND-FFMM.
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM

*% END                            
*% IF INI_FRM_GLS_LIST
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
      *VERIFICA SI PRODUCTO (TIPO-SUBTIPO) ES FFMM
           IF WSS-IND-FFMM NOT = WSS-S
               GO TO FIN-VAL-FRM-GLS-LIST.
      *OBTIENE GLOSA DE UNIDAD DE MEDIDA PARA FFMM (CENTESIMAS)
           MOVE SPACES              TO FRM-GLS-LIST IN GTP-FLD.
           MOVE 'BGL'               TO TAB-COD-SIST FIO-SIST.
           MOVE 'UMC'               TO TAB-COD-TTAB IN TAB.
           MOVE 'FFMM'              TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'BGL'        TO MSG-COD-SIST
               MOVE 'UMCFM  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-FRM-GLS-LIST.

           MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-LIST IN GTP-FLD.
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM
*% END                            
*% IF FIN_UNP_GTP_GTP
      *<<<< FIN_UNP_GTP_GTP
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN GTP-FLD TO WSS-TIPO IN WSS-VARI
           MOVE GDG-STP-CGTA IN GTP-FLD TO WSS-AUX IN WSS-VARI.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TIAU IN WSS-VARI.
           IF WSS-CIC-TIAU IN WSS-VARI = '952082'
                 MOVE FRM-CPIM-AEY TO GTP-SGV-VTSN-ATR IN GTP-FLD
                 MOVE FRM-CPIM-AEY TO GTP-FEC-FCES-ATR IN GTP-FLD.
      *>>>>
*% END                            
*% IF INI_GTP_COD_IITS
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
      *VERIFICA SI PRODUCTO (TIPO-SUBTIPO) ES FFMM
           IF WSS-IND-FFMM NOT = WSS-S
               GO TO GTP-COD-IITS-NO-FFMM.
      *"Identificacion" SE OBTIENE DESDE GDO.
           MOVE GTP-CAI-GTIA IN GTP-FLD TO GDO-CAI-GTIA IN GDO.
           MOVE GTP-IIC-GTIA IN GTP-FLD TO GDO-IIC-GTIA IN GDO.
           MOVE WSS-1                   TO GDO-NUM-IGDO IN GDO.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDO.
           IF NOT FIO-STAT-OKS
               MOVE 'BGL'        TO MSG-COD-SIST
               MOVE 'GTPGDO NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GTP-COD-IITS.
           MOVE GDO-COD-TIEM IN GDO TO WSS-COD-TIEM.
           MOVE GDO-COD-INEM IN GDO TO WSS-COD-INEM.
           MOVE GDO-COD-SIEM IN GDO TO WSS-COD-SIEM.
           MOVE WSS-INST-EMIS       TO  GTP-COD-IITS IN GTP-FLD.
           GO TO FIN-VAL-GTP-COD-IITS.
       GTP-COD-IITS-NO-FFMM.
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM

*% END                            
*% IF GTP_COD_IITS
      *<<<< GTP_COD_IITS
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN GTP-FLD TO WSS-TIPO IN WSS-VARI
           MOVE GDG-STP-CGTA IN GTP-FLD TO WSS-AUX IN WSS-VARI.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TIAU IN WSS-VARI.
      *PVG INI 15-OCT-2003
      *    IF WSS-CIC-TIAU IN WSS-VARI = '952082'
      *CGA-INI 05-FEB-2013
      *    IF WSS-CIC-TIAU IN WSS-VARI = '952086'
           IF WSS-CIC-TIAU IN WSS-VARI = '952086'  OR
              WSS-CIC-TIAU IN WSS-VARI = '952886'
      *CGA-FIN 05-FEB-2013
      *PVG FIN 15-OCT-2003
              MOVE GTP-COD-IITS IN GTP-FLD TO ACC-COD-NEMO IN ACC
      *PVG INI 15-OCT-2003
      *       MOVE 99999999                TO ACC-FEC-FPRO IN ACC
              MOVE GTP-NUM-SCES IN GTP-FLD TO ACC-NUM-SPRO IN ACC
              MOVE GTP-NUM-ACES IN GTP-FLD TO ACC-NUM-APRO IN ACC
              MOVE GTP-NUM-MCES IN GTP-FLD TO ACC-NUM-MPRO IN ACC
              MOVE GTP-NUM-DCES IN GTP-FLD TO ACC-NUM-DPRO IN ACC
      *PVG FIN 15-OCT-2003
              MOVE FIO-GET-LEQ TO FIO-CMND
              PERFORM BGL-FIO-ACC
              IF NOT (FIO-STAT-OKS AND 
                      ACC-COD-NEMO IN ACC = GTP-COD-IITS IN GTP-FLD)
                  MOVE 'TAB'          TO MSG-COD-SIST
                  MOVE 'NEM    NEX' TO MSG-COD-MENS
                  PERFORM GET-MSG
                  MOVE MSG-GLS-DESC TO FRM-MENS
                  MOVE FRM-SUAR-MAL TO FRM-SUAR
                  GO TO FIN-VAL-GTP-COD-IITS.
      *>>>>
*% END
*% IF FRM_COD_LIST
      *<<<< FRM_COD_LIST
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
           IF WSS-IND-FFMM = WSS-S
               MOVE SPACES TO FRM-COD-LIST
               GO TO FIN-VAL-FRM-COD-LIST.
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM

           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN GTP-FLD TO WSS-TIPO IN WSS-VARI
           MOVE GDG-STP-CGTA IN GTP-FLD TO WSS-AUX IN WSS-VARI.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TIAU IN WSS-VARI.
      *PVG INI 15-OCT-2003
      *    IF WSS-CIC-TIAU IN WSS-VARI = '952082'
      *CGA-INI 05-FEB-2013
      *    IF WSS-CIC-TIAU IN WSS-VARI = '952086'
           IF WSS-CIC-TIAU IN WSS-VARI = '952086'  OR
              WSS-CIC-TIAU IN WSS-VARI = '952886'
      *CGA-FIN 05-FEB-2013
      *PVG FIN 15-OCT-2003
              MOVE GTP-COD-IITS IN GTP-FLD TO ACC-COD-NEMO IN ACC
      *PVG INI 15-OCT-2003
      *       MOVE 99999999                TO ACC-FEC-FPRO IN ACC
              MOVE GTP-NUM-SCES IN GTP-FLD TO ACC-NUM-SPRO IN ACC
              MOVE GTP-NUM-ACES IN GTP-FLD TO ACC-NUM-APRO IN ACC
              MOVE GTP-NUM-MCES IN GTP-FLD TO ACC-NUM-MPRO IN ACC
              MOVE GTP-NUM-DCES IN GTP-FLD TO ACC-NUM-DPRO IN ACC
      *PVG FIN 15-OCT-2003
              MOVE FIO-GET-LEQ TO FIO-CMND
              PERFORM BGL-FIO-ACC
              IF NOT (FIO-STAT-OKS AND 
                      ACC-COD-NEMO IN ACC = GTP-COD-IITS IN GTP-FLD)
                   MOVE SPACES TO FRM-COD-LIST IN GTP-FLD
                   MOVE SPACES TO FRM-GLS-LIST IN GTP-FLD
                   MOVE ZEROES TO GTP-SGV-VTSN IN GTP-FLD
                   GO TO FIN-VAL-FRM-COD-LIST
              ELSE
                 MOVE 'BGL' TO TAB-COD-SIST
                 MOVE 'LST' TO TAB-COD-TTAB IN TAB
                 MOVE ACC-COD-LIST IN ACC TO TAB-COD-CTAB IN TAB
                 PERFORM VAL-COD
                 IF MSG-COD-MENS = 'COD    NEX' OR
                 GTP-COD-IITS IN GTP-FLD NOT > SPACES 
                     MOVE SPACES TO FRM-COD-LIST IN GTP-FLD
                     MOVE SPACES TO FRM-GLS-LIST IN GTP-FLD
                     MOVE ZEROES TO GTP-SGV-VTSN IN GTP-FLD
                     GO TO FIN-VAL-FRM-COD-LIST
                 ELSE
                    MOVE TAB-CIC-CTAB IN TAB TO WSS-LISTA IN WSS-VARI                 
                    MOVE ACC-COD-LIST IN ACC TO FRM-COD-LIST IN GTP-FLD
                    MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-LIST IN GTP-FLD
                    GO TO CONTINUA-VALOR
           ELSE
              MOVE SPACES TO FRM-COD-LIST IN GTP-FLD
              MOVE SPACES TO FRM-GLS-LIST IN GTP-FLD
              GO TO FIN-VAL-FRM-COD-LIST.
       CONTINUA-VALOR.
           IF WSS-LISTA IN WSS-VARI NOT = 'A' AND
              WSS-LISTA IN WSS-VARI NOT = 'B' AND
              WSS-LISTA IN WSS-VARI NOT = 'C'
              MOVE 1 TO GTP-SGV-VTSN IN GTP-FLD
           ELSE
              IF ACC-SGV-VCOU IN ACC < ACC-SGV-VCOP IN ACC
                 MOVE ACC-SGV-VCOU IN ACC TO GTP-SGV-VTSN IN GTP-FLD
              ELSE
                 MOVE ACC-SGV-VCOP IN ACC TO GTP-SGV-VTSN IN GTP-FLD. 
      *>>>>
*% END
*% IF GTP_COD_EITS
      *<<<< GTP_COD_EITS
      *VAL-COD Valida codigo de tabla
           MOVE 'BGL' TO TAB-COD-SIST.
           MOVE 'ES1' TO TAB-COD-TTAB IN TAB.
           MOVE GTP-COD-EITS IN GTP-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX' OR
              GTP-COD-EITS IN GTP-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-EITS IN GTP-FLD
               GO TO FIN-VAL-GTP-COD-EITS
           ELSE
               MOVE TAB-GLS-DCOR IN TAB TO
                    FRM-GLS-EITS IN GTP-FLD.

           IF SCR-CCPP = 'ING'  
               IF GTP-COD-EITS IN GTP-FLD > '10'
                   MOVE 'EST-ITM>10' TO MSG-COD-MENS
                   GO TO ERR-VAL-GTP-COD-EITS
               ELSE
                   GO TO FIN-VAL-GTP-COD-EITS.

      * CAMBIOS DE ESTADO
            IF GTP-COD-EITS IN GTP-FLD NOT = GAR-EST-ANT
               IF NOT (GTP-COD-EITS IN GTP-FLD = GAR-ES1-1 OR
                       GTP-COD-EITS IN GTP-FLD = GAR-ES1-2 OR
                       GTP-COD-EITS IN GTP-FLD = GAR-ES1-3 OR
                       GTP-COD-EITS IN GTP-FLD = GAR-ES1-4)
                   MOVE 'ESTITMNVOANT' TO MSG-COD-MENS
                   GO TO ERR-VAL-GTP-COD-EITS.
           GO TO FIN-VAL-GTP-COD-EITS.

       ERR-VAL-GTP-COD-EITS.
           MOVE 'BGL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>>
*% END
*% IF INI_GTP_SGV_VTSN
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
           IF WSS-IND-FFMM = WSS-S
               MOVE WSS-COD-SIEM TO WSS-COD-IVDO2
               MOVE WSS-FMT      TO VDO-COD-TIPO IN VDO
               MOVE WSS-COD-IVDO TO VDO-COD-IVDO IN VDO
               MOVE WSS-99999999 TO VDO-FEC-FVDO IN VDO
               MOVE FIO-GET-LEQ TO FIO-CMND
               PERFORM BGL-FIO-VDO
               IF NOT (FIO-STAT-OKS AND
                     VDO-COD-TIPO IN VDO = WSS-FMT AND
                     VDO-COD-IVDO IN VDO = WSS-COD-IVDO)
                  MOVE 'BGL'          TO MSG-COD-SIST
                  MOVE 'VDO    NEX' TO MSG-COD-MENS
                  PERFORM GET-MSG
                  MOVE MSG-GLS-DESC TO FRM-MENS
                  MOVE FRM-SUAR-MAL TO FRM-SUAR
                  GO TO FIN-VAL-GTP-SGV-VTSN
               ELSE
                  PERFORM MOV-VLR-FFMM
                  GO TO FIN-VAL-GTP-SGV-VTSN.
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM

*% END
*% IF GTP_SGV_VTSN
      *<<<< GTP_SGV_VTSN
      * Obtiene Codigo Vlr Cambio de Pesos Med CIC de la Moneda '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
      *PVC-INI 14-OCT-2016 - NO REDONDEAR VALOR UNITARIO                
                     MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *              MOVE FRM-SUAR-MAL TO FRM-SUAR
      *          ELSE
      *          IF GDG-COD-VCAM IN GTP-FLD = TAB-COD-CTAB IN TAB   
      *              MOVE GTP-SGV-VTSN IN GTP-FLD TO 
      *                   PES-SGV-DECI IN PES-VARI
      *              PERFORM PES-SCTV
      *              MOVE PES-SGV-ENTE IN PES-VARI TO
      *                   GTP-SGV-VTSN IN GTP-FLD.
      *PVC-FIN 14-OCT-2016 - NO REDONDEAR VALOR UNITARIO                
      *>>>>
*% END
*% IF GTP_FEC_FCES
      *<<<< FIN_GTP_FEC_FCES
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN GTP-FLD TO WSS-TIPO IN WSS-VARI
           MOVE GDG-STP-CGTA IN GTP-FLD TO WSS-AUX IN WSS-VARI.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TIAU IN WSS-VARI.
           IF WSS-CIC-TIAU IN WSS-VARI = '952082'
              PERFORM GET-FHOY
              MOVE HOY-SHOY TO GTP-NUM-SCES IN GTP-FLD
              MOVE HOY-AHOY TO GTP-NUM-ACES IN GTP-FLD
              MOVE HOY-MHOY TO GTP-NUM-MCES IN GTP-FLD
              MOVE HOY-DHOY TO GTP-NUM-DCES IN GTP-FLD.

            MOVE GTP-CAI-GTIA IN GTP-FLD TO GVT-CAI-GTIA IN GVT.
            MOVE GTP-IIC-GTIA IN GTP-FLD TO GVT-IIC-GTIA IN GVT.
            MOVE GTP-NUM-ITSN IN GTP-FLD TO GVT-COD-TASN IN GVT.
            MOVE FIO-GET-KEY TO FIO-CMND.
            PERFORM BGL-FIO-GVT.
            IF FIO-STAT-OKS
                  MOVE GVT-NUM-DTSN IN GVT TO FEC-DEC1
                  MOVE GVT-NUM-MTSN IN GVT TO FEC-MEC1
                  MOVE GVT-NUM-STSN IN GVT TO WSS-SIGLO
                  MOVE GVT-NUM-ATSN IN GVT TO WSS-ANO
                  MOVE WSS-FECHA           TO FEC-FSA1
      *     
                  MOVE ZEROES TO WSS-FECHA
                  MOVE GTP-NUM-DCES IN GTP-FLD TO FEC-DEC2
                  MOVE GTP-NUM-MCES IN GTP-FLD TO FEC-MEC2
                  MOVE GTP-NUM-SCES IN GTP-FLD TO WSS-SIGLO
                  MOVE GTP-NUM-ACES IN GTP-FLD TO WSS-ANO
                  MOVE WSS-FECHA    IN WSS-VARI TO FEC-FSA2
                  MOVE FEC-FORM-FEC TO FEC-FORM
                  MOVE FEC-CMP-FEC  TO FEC-CMND
                  PERFORM PRO-FEC
                  IF FEC-STAT-GRT
                      MOVE 'BGL' TO MSG-COD-SIST
                      MOVE 'GTPCMB<TSN' TO MSG-COD-MENS
                      PERFORM GET-MSG
                      MOVE MSG-GLS-DESC TO FRM-MENS
                      MOVE FRM-SUAR-MAL TO FRM-SUAR
                      GO TO FIN-VAL-GTP-FEC-FCES
                  ELSE
                    NEXT SENTENCE
           ELSE
               MOVE 'GTPKEYMALGDG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GTP-FEC-FCES.
      *>>>>
*% END
*% IF FIN_PUT_GDG_GTP
      *<<<< FIN_PUT_GDG_GTP
            IF GDG-TIP-CGTA IN GTP-FLD > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'AUX ' TO TAB-COD-TTAB IN TAB
               MOVE GDG-TIP-CGTA IN GTP-FLD TO WSS-TIP-CGTA IN WSS-VARI
               MOVE GDG-STP-CGTA IN GTP-FLD TO WSS-STP-CGTA IN WSS-VARI
               MOVE WSS-COD-CGTA IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
      *MHM-INI 23-OCT-2003
      *         MOVE TAB-GLS-DESC IN TAB TO
      *              FRM-GLS-CGTA IN GTP-FLD
      *     ELSE
      *         MOVE SPACES TO FRM-GLS-CGTA IN GTP-FLD.
               MOVE TAB-GLS-DESC IN TAB     TO WSS-GLS-SOPE IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-SOPE IN WSS-VARI.

           IF GDG-TIP-CGTA IN GTP-FLD > SPACES
               MOVE 'TAB'                   TO TAB-COD-SIST
               MOVE 'TIO'                   TO TAB-COD-TTAB IN TAB
               MOVE SPACES                  TO TAB-COD-CTAB IN TAB
               MOVE GDG-TIP-CGTA IN GTP-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB             
               MOVE TAB-GLS-DESC IN TAB     TO WSS-GLS-TOPE IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-TOPE IN WSS-VARI.
               
           MOVE WSS-GLS-CGTA TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO FRM-GLS-CGTA IN GTP-FLD.
      *MHM-FIN 23-OCT-2003

*% IF NOT GEN_BCI
           MOVE SPACES              TO WSS-CIC-TOPE IN WSS-VARI.
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN GTP-FLD TO WSS-TIPO IN WSS-VARI
           MOVE GDG-STP-CGTA IN GTP-FLD TO WSS-AUX IN WSS-VARI.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TIAU IN WSS-VARI.
           IF WSS-CIC-TIAU IN WSS-VARI = '952082'
              MOVE 'BGL' TO TAB-COD-SIST
              MOVE 'NEM' TO TAB-COD-TTAB IN TAB
              MOVE GTP-COD-IITS IN GTP-FLD TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              MOVE TAB-GLS-DAT1 IN TAB TO WSS-LISTA IN WSS-VARI
              MOVE 'BGL' TO TAB-COD-SIST
              MOVE 'LST' TO TAB-COD-TTAB IN TAB
              MOVE WSS-LISTA IN WSS-VARI TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              MOVE WSS-LISTA IN WSS-VARI TO FRM-COD-LIST IN GTP-FLD
              MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-LIST IN GTP-FLD
           ELSE
              MOVE SPACES TO FRM-COD-LIST IN GTP-FLD
              MOVE SPACES TO FRM-GLS-LIST IN GTP-FLD.
*% END
      *>>>>
*% END
*% IF FIN_PUT_GTP_GTP
      *<<<< FIN_PUT_GTP_GTP
           MOVE GTP-COD-EITS IN GTP TO GAR-EST-ANT.

      *BUS-TAB busca glosa de codigo en tabla
           IF GTP-COD-EITS IN GTP-FLD > SPACES
               MOVE 'BGL' TO TAB-COD-SIST
               MOVE 'ES1' TO TAB-COD-TTAB IN TAB
               MOVE GTP-COD-EITS IN GTP-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-COD-DAT2 IN TAB(1) TO GAR-ES1-1
               MOVE TAB-COD-DAT2 IN TAB(2) TO GAR-ES1-2
               MOVE TAB-COD-DAT2 IN TAB(3) TO GAR-ES1-3
               MOVE TAB-COD-DAT2 IN TAB(4) TO GAR-ES1-4
               MOVE TAB-GLS-DCOR IN TAB TO
                    FRM-GLS-EITS IN GTP-FLD.

      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
           MOVE GDG-TIP-CGTA IN GTP-FLD  TO WSS-TIPO IN WSS-VARI
           MOVE GDG-STP-CGTA IN GTP-FLD  TO WSS-AUX  IN WSS-VARI.
           MOVE 'BGL'                    TO TAB-COD-SIST FIO-SIST.
           MOVE 'PFM'                    TO TAB-COD-TTAB IN TAB.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = WSS-S
      *       OBTIENE GLOSA DE UNIDAD DE MEDIDA PARA FFMM (CENTESIMAS)
               MOVE SPACES              TO FRM-GLS-LIST IN GTP-FLD
               MOVE 'BGL'               TO TAB-COD-SIST FIO-SIST
               MOVE 'UMC'               TO TAB-COD-TTAB IN TAB
               MOVE 'FFMM'              TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-TAB
               IF FIO-STAT-OKS
                   MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-LIST IN GTP-FLD
                   GO TO FIN-PUT-GTP-GTP
               ELSE
                   MOVE 'BGL'        TO MSG-COD-SIST
                   MOVE 'UMCFM  NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-GLS-LIST IN GTP-FLD
                   GO TO FIN-PUT-GTP-GTP.
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM

      *PVG INI 15-OCT-2003
           MOVE 'TAB'                    TO TAB-COD-SIST.
           MOVE 'AUX'                    TO TAB-COD-TTAB IN TAB.
           MOVE SPACES                   TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN GTP-FLD  TO WSS-TIPO IN WSS-VARI
           MOVE GDG-STP-CGTA IN GTP-FLD  TO WSS-AUX IN WSS-VARI.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TIAU IN WSS-VARI.
      *CGA-INI 05-FEB-2013
      *    IF WSS-CIC-TIAU IN WSS-VARI = '952086'
           IF WSS-CIC-TIAU IN WSS-VARI = '952086'  OR
              WSS-CIC-TIAU IN WSS-VARI = '952886'
      *CGA-FIN 05-FEB-2013
              MOVE GTP-COD-IITS IN GTP-FLD TO ACC-COD-NEMO IN ACC
              MOVE GTP-NUM-SCES IN GTP-FLD TO ACC-NUM-SPRO IN ACC
              MOVE GTP-NUM-ACES IN GTP-FLD TO ACC-NUM-APRO IN ACC
              MOVE GTP-NUM-MCES IN GTP-FLD TO ACC-NUM-MPRO IN ACC
              MOVE GTP-NUM-DCES IN GTP-FLD TO ACC-NUM-DPRO IN ACC
              MOVE FIO-GET-LEQ TO FIO-CMND
              PERFORM BGL-FIO-ACC
              IF NOT (FIO-STAT-OKS AND
                      ACC-COD-NEMO IN ACC = GTP-COD-IITS IN GTP-FLD)
                 MOVE SPACES                 TO FRM-COD-LIST IN GTP-FLD
                 MOVE SPACES                 TO FRM-GLS-LIST IN GTP-FLD
      *AFRI-INI/VALORIZACION ACCIONES/01-2018
      *          MOVE ZEROES                 TO GTP-SGV-VTSN IN GTP-FLD
      *AFRI-FIN/VALORIZACION ACCIONES/01-2018
              ELSE
                 MOVE 'BGL'                  TO TAB-COD-SIST
                 MOVE 'LST'                  TO TAB-COD-TTAB IN TAB
                 MOVE ACC-COD-LIST IN ACC    TO TAB-COD-CTAB IN TAB
                 PERFORM BUS-TAB
                 IF MSG-COD-MENS = 'COD    NEX' OR
                    GTP-COD-IITS IN GTP-FLD NOT > SPACES
                    MOVE SPACES              TO FRM-COD-LIST IN GTP-FLD
                    MOVE SPACES              TO FRM-GLS-LIST IN GTP-FLD
      *AFRI-INI/VALORIZACION ACCIONES/01-2018
      *             MOVE ZEROES              TO GTP-SGV-VTSN IN GTP-FLD
      *AFRI-FIN/VALORIZACION ACCIONES/01-2018
                 ELSE
                    MOVE TAB-CIC-CTAB IN TAB TO WSS-LISTA IN WSS-VARI
                    MOVE ACC-COD-LIST IN ACC TO FRM-COD-LIST IN GTP-FLD
                    MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-LIST IN GTP-FLD
           ELSE
              MOVE SPACES                    TO FRM-COD-LIST IN GTP-FLD
              MOVE SPACES                    TO FRM-GLS-LIST IN GTP-FLD.
      *PVG FIN 15-OCT-2003
      *AFRI-INI/VALORIZACION ACCIONES/01-2018
           IF SCR-CMND = WCC-CON AND
              GTP-SGV-VTSN IN GTP-FLD = WCC-1
              MOVE WCC-NEMONOVIG             TO MSG-COD-MENS
              MOVE 'BGL'                     TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC              TO FRM-MENS.
      *AFRI-FIN/VALORIZACION ACCIONES/01-2018
      *>>>>
*% END
*% IF GTP_FEC_CMB_EST
      *<<<< GTP_FEC_CMB_EST

      *VAL-FEC valida que fec. cambio sea mayor o igual a fec. tasacion 
           MOVE GTP-NUM-SIS IN GTP-FLD TO GAR-NUM-SIS IN GVT.
           MOVE GTP-COD-CRR IN GTP-FLD TO GAR-COD-CRR IN GVT.
           MOVE GTP-COD-TSN IN GTP-FLD TO GAR-COD-TSN IN GVT.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF FIO-STAT-OKS 
                  MOVE GAR-FD-TSN IN GVT TO FEC-DEC1
                  MOVE GAR-FM-TSN IN GVT TO FEC-MEC1
                  MOVE GAR-FA-TSN IN GVT TO FEC-FSA1
      *     
                  MOVE GTP-FD-CMB-EST IN GTP-FLD TO FEC-DEC2
                  MOVE GTP-FM-CMB-EST IN GTP-FLD TO FEC-MEC2
                  MOVE GTP-FA-CMB-EST IN GTP-FLD TO FEC-FSA2
                  MOVE FEC-FORM-FEC TO FEC-FORM
                  MOVE FEC-CMP-FEC  TO FEC-CMND
                  PERFORM PRO-FEC
                  IF FEC-STAT-GRT
                      MOVE 'BGL' TO MSG-COD-SIST
                      MOVE 'GTPCMB<TSN' TO MSG-COD-MENS
                      PERFORM GET-MSG
                      MOVE MSG-GLS-DESC TO FRM-MENS
                      MOVE FRM-SUAR-MAL TO FRM-SUAR
                      GO TO FIN-VAL-GTP-FEC-CMB-EST
                  ELSE
                      NEXT SENTENCE
           ELSE
               MOVE 'GTPKEYMALGDG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GTP-FEC-CMB-EST.

      *>>>>
*% END
*% IF GTP_COD_EST_ITM
      *<<<< GTP_COD_EST_ITM
      *VAL-COD Valida codigo de tabla
           MOVE 'BGL' TO TAB-COD-SIST.
           MOVE 'ES1' TO TAB-COD-TTAB IN TAB.
           MOVE GTP-COD-EST-ITM IN {FRM}-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX' OR
              GTP-COD-EST-ITM IN {FRM}-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-EITS IN {FRM}-FLD
               GO TO FIN-VAL-GTP-COD-EST-ITM
           ELSE
               MOVE TAB-GLS-DCOR IN TAB TO
                    FRM-GLS-EITS IN {FRM}-FLD.

           IF SCR-CCPP = 'ING'  

               IF GTP-COD-EST-ITM IN {FRM}-FLD > '10'
                   MOVE 'EST-ITM>10' TO MSG-COD-MENS
                   GO TO ERR-VAL-GTP-COD-EST-ITM
               ELSE
                   GO TO FIN-VAL-GTP-COD-EST-ITM.

      * CAMBIOS DE ESTADO
           IF GTP-COD-EST-ITM IN {FRM}-FLD NOT =GAR-EST-ANT
               IF NOT (GTP-COD-EST-ITM IN {FRM}-FLD = GAR-ES1-1 OR
                       GTP-COD-EST-ITM IN {FRM}-FLD = GAR-ES1-2 OR
                       GTP-COD-EST-ITM IN {FRM}-FLD = GAR-ES1-3 OR
                       GTP-COD-EST-ITM IN {FRM}-FLD = GAR-ES1-4)
                   MOVE 'ESTITMNVOANT' TO MSG-COD-MENS
                   GO TO ERR-VAL-GTP-COD-EST-ITM.
           GO TO FIN-VAL-GTP-COD-EST-ITM.

       ERR-VAL-GTP-COD-EST-ITM.
           MOVE 'BGL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>>
*% END
*% IF GTP_VAL_UNT_ITM
      *<<<< GTP_VAL_UNT_ITM

      * Obtiene Codigo Valor de Cambio de Pesos Mediante CIC de la Moneda '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
           ELSE
           IF GDG-VCB IN GTP-FLD = TAB-COD-CTAB IN TAB
               MOVE GTP-VAL-UNT-ITM IN GTP-FLD TO 
                    PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO
                    GTP-VAL-UNT-ITM IN GTP-FLD.
      *>>>>
*% END
*% IF EOF_BU
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
       MOV-VLR-FFMM SECTION.
       INI-MOV-VLR-FFMM.
      * Obtiene Codigo VLR Cambio de Pesos Med CIC de la Moneda '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-MOV-VLR-FFMM.

           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO.

           IF GDG-COD-VCAM IN GTP-FLD = WSS-COD-PESO
               MOVE VDO-SGV-VVDP IN VDO TO GTP-SGV-VTSN IN GTP-FLD
               GO TO FIN-MOV-VLR-FFMM.

           IF GDG-COD-VCAM IN GTP-FLD = VDO-COD-VCAM IN VDO
               MOVE VDO-SGV-VVDO IN VDO TO GTP-SGV-VTSN IN GTP-FLD
               GO TO FIN-MOV-VLR-FFMM.

           PERFORM CONV-MON-VVDO
           IF FRM-SUAR = FRM-SUAR-MAL
               GO TO FIN-MOV-VLR-FFMM
           ELSE
               MOVE WSS-SGV-VVDO IN WSS-VARI TO
                                        GTP-SGV-VTSN IN GTP-FLD.
       FIN-MOV-VLR-FFMM.
           EXIT.

       CONV-MON-VVDO SECTION.
       INI-CONV-MON-VVDO.
           MOVE ZEROES       TO WSS-SGV-VVDO IN WSS-VARI.

      *MONEDA VDO <> MONEDA GDG.
           PERFORM GET-FHOY.
           MOVE HOY-FHOY                TO NVC-FCAM.
           MOVE VDO-SGV-VVDO IN VDO     TO NVC-VALO.
           MOVE VDO-COD-VCAM IN VDO     TO NVC-MON1.
           MOVE GDG-COD-VCAM IN GDG     TO NVC-MON2.
           MOVE WSS-C                   TO NVC-IND-ACCI.
           PERFORM PRO-NVC-NCD.
      *OBTENGO VALOR
           MOVE NVC-RESU TO WSS-SGV-VVDO IN WSS-VARI.

       FIN-CONV-MON-VVDO.
           EXIT.
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM
*% END
