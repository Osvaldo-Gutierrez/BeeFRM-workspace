      *BEE-05-10-2004
       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   BGLPPVCG.
       AUTHOR.       CONSIST.
       DATE-WRITTEN.  25-JUL-1991 16:24:03

      * VALIDA CONSISTENCIA GENERAL DE UNA GARANTIA
      * Subrutina Pone Estado Garantia Completa
      * Este programa es invocado desde cualquier programa de actualizac
      *   de garantias, y su funcion es chequear que la gtia tenga ingre
      *   las entidades (obligatorias y opcionales) que corresponde segu
      *   la tabla TAG. Si tiene entidades que no corresponde, ellas se
      *   eliminan. Tambien graba registros GMO para cada entidad
      *   ingresada, que corresponde.

      * SI HAY UN ERROR DEVUELVE MSG-COD-MENS CON EL CODIGO DEL MENSAJE
      * EL ERROR SE MANEJA EN PROGRAMA LLAMADOR
      * MARCA GAR-IND-CPL EN GDG.

      *=============================================================*
      * Mantencion   25/06/2009
      * EVA-AFRI
      * Se elimina tabla de excepcion BGLGLEGAP por falta de espacio.
      * Se crea nueva tabla EDL que contiene los Tipo de Productos
      * que administran la norma de excepcion de ingreso de GLE,
      * funcion que cumplia la tabla eliminada.
      *=============================================================*
      * MANTENCION : - AL ACTIVAR LA GDG SE SOBREESCRIBE LA GVT CON EL
      *                SALDO INSOLUTO DE LA OPC.
      *              - SE VERIFICA EL PORCENTAJE DE COBERTURA
      *                ALMACENADO EN LA GES
      * FECHA      : SEPTIEMBRE-2010
      * RESPONSABLE:
      * ETIQUETA   : AFRI-INI 15-SEP-2010 GARANTIAS ESTATALES
      *=============================================================
      *=============================================================*
      * MANTENCION : - AL ACTIVAR LA GDG DEBE VALIDA PARA ESTATALES
      *                1. TIPO Y SUBTIPO
      *                2. PROPIETARIO
      *                3. AUTOR DE LA TRANSACCION
      * FECHA      : JULIO-2012
      * RESPONSABLE:
      * ETIQUETA   : AFRI-INI/JUL2012    GARANTIAS ESTATALES
      *=============================================================
      * MANTENCION : QUITAR OBLIGATORIEDAD DE INGRESO DE CAMPOS
      * FECHA      : JULIO-2012
      * RESPONSABLE: BEE-TEAM (PVC)
      * ETIQUETA   : PVC-INI 18-JUL-2012 BLOQUEAR OPCION DE PANT. GLE
      *=============================================================

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------

       COPY GNSWGCVT.
       77  WSS-TAG-BGLPPVCG-INI PIC X(125) VALUE
           '<IDNPGM NOM=$BGLPPVCG$ SKL=$06.06.22$ VSN=$06.06.22$
      -    'GEN=$15-NOV-05 06:29 PM$ FNC=$OWFBGL$/>'.

      *AFRI-INI 15-SEP-2010 GARANTIAS ESTATALES
       COPY COLBROPC.
       COPY COLBRROV.
       COPY COLBRVEN.
       COPY COLBRCAN.
       COPY COLBRCYA.
       COPY COLBRRCV.
       COPY TABBRCAM.
       COPY COLBRICG.
       COPY COLBRTOC.
       COPY COLBREVC.
       COPY GNSWGPES.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-BDO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PTT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==.
       COPY GNSBRMSC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
      *AFRI-FIN 15-SEP-2010 GARANTIAS ESTATALES

       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
      *AFRI-INI/JUN2007/CHC  PRELACION
       COPY COLBRDLC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
      *AFRI-FIN/JUN2007/CHC  PRELACION
       COPY GNSBRMSG.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGHOY.
       COPY GNSWGFEC.
       COPY GNSWGSYS.
       COPY GNSWGFRM.
       01  SCR-VARI.
           03 SCR-SIST             VALUE 'BGL' PIC X(03).
           03 SCR-QIDD                         PIC X(08).
           03 SCR-LIDD                    COMP PIC S9(04).

       COPY BGLBRGAP.
       COPY BGLBRGDD.
       COPY BGLBRGDG.
       COPY BGLBRGDO.
       COPY BGLBRGDP.
       COPY BGLBRGES.
       COPY BGLBRGIN.
       COPY BGLBRGLE.
       COPY BGLBRGMO.
       COPY BGLBRGSE.
       COPY BGLBRGSI.
       COPY BGLBRGTP.
       COPY BGLBRGUB.
       COPY BGLBRGVT.
      *MHM-INI 29-JUL-2003
       COPY BGLBRGVE.
       COPY BGLBRGIM.
      *MHM-FIN 29-JUL-2003
       COPY BGLBRTAG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GAP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GES-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GIN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GLE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GMO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GTP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GUB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
      *MHM-INI 29-JUL-2003
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GIM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVE-REQA==.
      *MHM-FIN 29-JUL-2003

      *AFRI
       COPY BGLWGPNT.
      *AFRI
       COPY BGLWGVCG.
      *EVA-AFRI/JUL2007     CBTL NOVA
       COPY GNSWCSCR.
      *FIN-AFRI/JUL2007     CBTL NOVA
      *AFRI-INI/JUL2012    GARANTIAS ESTATALES
      *VARIABLES PARA LA VALIDACION GARANTIA                            
       01  VAL-VARI.                                                    
           03 VAL-AFG-GLS-DATA.                                         
              05 VAL-GLS-FIL1                      PIC X(01).           
              05 VAL-NUM-ICLI                      PIC X(08).           
              05 VAL-VRF-ICLI                      PIC X(01).           
              05 VAL-IND-ICLI                      PIC X(01).           
              05 VAL-GLS-ICLI                      PIC X(03).           
           03 VAL-IND-VALI                         PIC X(01).
           03 VAL-COD-MENS                         PIC X(12).
           03 VAL-COD-CGTA.
              05 VAL-COD-TOPE                      PIC X(03).
              05 VAL-COD-SOPE                      PIC X(03).
      *AFRI-FIN/JUL2012    GARANTIAS ESTATALES

       01  WSS-VARI.
           03 WSS-IMAL                  VALUE 0           PIC 9(01).
      *FLB CST 22-SEP-1993
           03 WSS-COD-GRA                             PIC 9(01).
           03 WSS-COD-PRD-ACR                         PIC 9(02).
      *AFRI-INI/JUN2007/CHC  PRELACION
           03 WSS-CONT                                  PIC 9(08).
           03 WSS-FEC-FMAV.
               05  WSS-NUM-SMAV                         PIC 9(02).
               05  WSS-NUM-AMAV                         PIC 9(02).
               05  WSS-NUM-MMAV                         PIC 9(02).
               05  WSS-NUM-DMAV                         PIC 9(02).
      *AFRI-FIN/JUN2007/CHC  PRELACION
      * EVA-INI  25/06/2009   TIPOS DE GARANTIA SIN GLE
      *    03  AGA-COD-PTLL                            PIC X(06).
      *    03  AGA-EXT-PNTL   VALUE 'NO'               PIC X(02).
      *    03  AGA-I     VALUE ZEROES                  PIC 9(02).
      *    03  AGA-GLS-DATA.
      *        05  AGA-VEC-PNTL OCCURS 10 TIMES.
      *            07 AGA-COD-PNTL                     PIC X(06).
      * EVA-FIN  25/06/2009   TIPOS DE GARANTIA SIN GLE
      *AFRI-FIN/JUN2007/CHC  PRELACION

      *AFRI-INI 15-SEP-2010 GARANTIAS ESTATALES
           03 WSS-OPC-FOGA                              PIC X(01).
           03 WSS-COD-PESO                              PIC X(06).
           03 WSS-VAL-CAMB   VALUE ZEROES         PIC 9(08)V9(05).
           03 WSS-SGV-RDIF                       PIC S9(13)V9(04).
           03 WSS-IND-OKS                               PIC X(02).
           03 WSS-COD-TIPO                              PIC X(03).
           03 WSS-IND-PORG                              PIC X(01).
           03 WSS-POR-COBE                              PIC 9(03).
           03 WSS-COD-TPGC.
              05 WSS-TIP-PROD                           PIC X(03).
              05 WSS-COD-DES                            PIC X(03).
              05 WSS-COD-GARA                           PIC X(03).
       01  VECTOR-OPC.
           03  WSS-VEC-OPC  OCCURS 200 TIMES INDEXED BY WSS-NUM-VOPC.
               05 VOPC-CIC-IOPC.
                  07 VOPC-CAI-IOPC               PIC X(04).
                  07 VOPC-IIC-IOPC               PIC X(08).
               05 VOPC-NUM-ICAN                  PIC 9(03).
               05 VOPC-NUM-IVEN                  PIC 9(03).
               05 VOPC-SGV-CAPI                  PIC S9(11)V9(04).
       01  BDO-VARI.
           03 WSS-CIC-IOPE.
               05 WSS-CAI-IOPE                       PIC X(04).
               05 WSS-IIC-IOPE                       PIC X(08).

           03 WSS-CIC-IOPC.
               05 WSS-CAI-IOPC                       PIC X(04).
               05 WSS-IIC-IOPC                       PIC X(08).

           03 WSS-CIC-ORIG.
               05 WSS-CAI-ORIG                       PIC X(04).
               05 WSS-IIC-ORIG                       PIC X(08).

           03 WSS-CIC-ANTE.
               05 WSS-CAI-ANTE                       PIC X(04).
               05 WSS-IIC-ANTE                       PIC X(08).

           03 WSS-CIC-PROR.
               05 WSS-CAI-PROR                       PIC X(04).
               05 WSS-IIC-PROR                       PIC X(08).

           03 WSS-COD-OPCR                           PIC X(12).
           03 BDO-1                                  PIC X(01).

           03 WSS-VAL-SCRE            VALUE  ZEROES  PIC S9(13)V9(04).
           03 WSS-CAN-SCRE            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-CAM-SCRE            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-VAL-MORP            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-VAL-CCIE            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-ACU-CCIE            VALUE  ZEROES  PIC 9(13)V9(04).

           03 WSS-RES-CAPI            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-ACU-CAPI            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-VAL-CAPI            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-SGV-CAPI            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-RCV-CAPI            VALUE  ZEROES  PIC 9(11)V9(04).

           03 WSS-ACU-INTN            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-INI-INTN            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-CAM-INTN            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-RES-INTN            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-CAN-INTN            VALUE  ZEROES  PIC 9(13)V9(04).

           03 WSS-RES-INTM            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-VAL-CRED            VALUE  ZEROES  PIC 9(13)V9(04).
           03 WSS-VAL-SINT            VALUE  ZEROES PIC S9(13)V9(04).

           03 WSS-RES-IVCT            VALUE  ZEROES  PIC 9(03).
           03 WSS-CAN-IVCT            VALUE  ZEROES  PIC 9(03).
           03 WSS-NUM-IVCT            VALUE  ZEROES  PIC 9(03).
           03 WSS-NUM-ICAN            VALUE  ZEROES  PIC 9(03).

           03 WSS-IND-BUSQ            VALUE  SPACES  PIC X(01).
           03 WSS-IND-VSTR            VALUE  SPACES  PIC X(01).
           03 WSS-IND-CANC            VALUE  SPACES  PIC X(01).
           03 WSS-IND-ICTT            VALUE  SPACES  PIC X(01).
           03 WSS-IND-SCTB            VALUE  SPACES  PIC X(03).
           03 WSS-IND-UTSV            VALUE  SPACES  PIC X(01).
           03 WSS-IND-ERRO            VALUE  SPACES  PIC X(01).

           03 WSS-COD-PESO            VALUE  SPACES  PIC X(06).
           03 WSS-COD-VCOC            VALUE  SPACES  PIC X(06).
           03 WSS-COD-ERRO            VALUE  SPACES  PIC X(12).

           03 WSS-NUM-CPEN            VALUE  ZEROES  PIC 9(03).
           03 WSS-NUM-CTOT            VALUE  ZEROES  PIC 9(03).
           03 WSS-NUM-VPAG            VALUE  ZEROES  PIC 9(03).
           03 WSS-NUM-IVEN            VALUE  ZEROES  PIC 9(03).
           03 WSS-NUM-CTRS            VALUE  ZEROES  PIC 9(03).
           03 WSS-NUM-CMOR            VALUE  ZEROES  PIC 9(03).
           03 WSS-NUM-SEVE            VALUE  ZEROES  PIC 9(04).

           03 WSS-FEC-FMAV            VALUE  ZEROES  PIC 9(08).
           03 WSS-FEC-FCAM            VALUE  ZEROES  PIC 9(08).
           03 WSS-FEC-FPRO            VALUE  ZEROES  PIC 9(08).
           03 WSS-FEC-FVEN.
               05 WSS-NUM-SVEN        VALUE  ZEROES  PIC 9(02).
               05 WSS-NUM-AVEN        VALUE  ZEROES  PIC 9(02).
               05 WSS-NUM-MVEN        VALUE  ZEROES  PIC 9(02).
               05 WSS-NUM-DVEN        VALUE  ZEROES  PIC 9(02).
           03 WSS-FEC-FMOR.
               05 WSS-NUM-SMOR        VALUE  ZEROES  PIC 9(02).
               05 WSS-NUM-AMOR        VALUE  ZEROES  PIC 9(02).
               05 WSS-NUM-MMOR        VALUE  ZEROES  PIC 9(02).
               05 WSS-NUM-DMOR        VALUE  ZEROES  PIC 9(02).

           03 WSS-FEC-FCAL.
               05 WSS-NUM-DCAL        VALUE  ZEROES  PIC 9(02).
               05 WSS-NUM-MCAL        VALUE  ZEROES  PIC 9(02).
               05 WSS-NUM-SCAL        VALUE  ZEROES  PIC 9(02).
               05 WSS-NUM-ACAL        VALUE  ZEROES  PIC 9(02).

           03  WSS-COD-TCYA.
               05 WSS-GLS-TCYA        VALUE  SPACES  PIC X(02).
               05 WSS-IND-TCYA        VALUE  SPACES  PIC X(03).

           03 WSS-GLS-STAT            VALUE  SPACES  PIC X(03).


       01  OPC-RES.
           03  OPC-GLS-FLAG                             PIC X(01).
           03  OPC-KEY-IREG.
               05  OPC-KEY-IOPC.
                   07  OPC-CIC-IOPC.
                       09  OPC-CAI-IOPC                 PIC X(04).
                       09  OPC-IIC-IOPC                 PIC X(08).
               05  OPC-STP-ITRN.
                   07  OPC-FEC-FTRN                     PIC X(08).
                   07  OPC-HRA-HRTR                     PIC X(06).
           03  OPC-MSC-TACC                             PIC X(01).
           03  OPC-MSC-STAT                             PIC X(01).
           03  OPC-COD-OTRN.
               05  OPC-MSC-TTRN                         PIC X(01).
               05  OPC-COD-TTRN                         PIC X(03).
           03  OPC-COD-ATRN                             PIC X(12).
           03  OPC-COD-VCOC.
               05  OPC-MSC-TVOC                         PIC X(01).
               05  OPC-COD-CVOC                         PIC X(03).
               05  OPC-COD-TCOC                         PIC X(02).
           03  OPC-COD-COOC.
               05  OPC-COD-TOOC                         PIC X(03).
               05  OPC-COD-AOOC                         PIC X(03).
           03  OPC-COD-OFOC                             PIC X(03).
           03  OPC-COD-RMOC                             PIC X(12).
           03  OPC-COD-CDOC                             PIC X(03).
           03  OPC-CIC-ILDC.
               05  OPC-CAI-ILDC                         PIC X(04).
               05  OPC-IIC-ILDC                         PIC X(08).
           03  OPC-FEC-FCOL                             PIC X(08).
           03  OPC-FEC-FING                             PIC X(08).
           03  OPC-FEC-FINP                             PIC X(08).
           03  OPC-VAL-CRED             COMP-3          PIC 9(11)V9(04).
           03  OPC-VAL-SCRE             COMP-3          PIC 9(11)V9(04).
           03  OPC-IND-AFER                             PIC X(01).
           03  OPC-MSC-MCVF                             PIC X(01).
           03  OPC-MSC-TCVE.
               05  OPC-MSC-BCCR                         PIC X(01).
               05  OPC-MSC-VICR                         PIC X(01).
           03  OPC-IND-RENO                             PIC X(03).
           03  OPC-IND-GARA                             PIC X(03).
           03  OPC-SGV-VCOM             COMP-3          PIC S9(11)V9(4).
           03  OPC-VAL-GAST             COMP-3          PIC S9(11)V9(4).
           03  OPC-COD-SEGD.
               05  OPC-COD-ISEG                         PIC X(03).
               05  OPC-COD-CSEG                         PIC X(03).
               05  OPC-COD-SSEG                         PIC X(03).
           03  OPC-VAL-SEGD             COMP-3          PIC 9(11)V9(04).
           03  OPC-SGV-LIQU             COMP-3          PIC S9(11)V9(4).
           03  OPC-NUM-VCOR                             PIC 9(03).
           03  OPC-NUM-VCVG                             PIC 9(03).
           03  OPC-NUM-VCCO                             PIC 9(03).
           03  OPC-NUM-VCCM                             PIC 9(03).
           03  OPC-NUM-VCCV                             PIC 9(03).
           03  OPC-NUM-TVCC                             PIC 9(03).
           03  OPC-IND-VSTR                             PIC X(01).
           03  OPC-CIC-ICEN.
               05  OPC-CAI-ICEN                         PIC X(04).
               05  OPC-IIC-ICEN                         PIC X(08).
           03  OPC-COD-AGES                             PIC X(02).
           03  OPC-IND-CTBL                             PIC X(01).
           03  OPC-COD-INSI                             PIC X(01).
           03  OPC-COD-CVTA                             PIC X(01).
           03  OPC-VAL-SEGP             COMP-3          PIC 9(11)V9(04).
           03  OPC-VAL-SEGC             COMP-3          PIC 9(11)V9(04).
           03  OPC-NUM-PLCO                             PIC 9(06).
           03  OPC-GLS-DISP                             PIC X(06).
      *AFRI-FIN 15-SEP-2010 GARANTIAS ESTATALES

       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 FILLER                               PIC X(60).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
      *FLB CST  1-DEC-1993
           IF MSG-COD-MENS > SPACES
               GO TO EXT-MAIN.
      *AFRI-INI 15-SEP-2010 GARANTIAS ESTATALES
           PERFORM GET-FHOY.
           MOVE HOY-FHOY TO WSS-FEC-FPRO IN BDO-VARI.
           PERFORM VAL-OPC-CRF.
           IF WSS-IND-OKS IN WSS-VARI NOT = 'OK'
               GO TO EXT-MAIN.
      *AFRI-FIN 15-SEP-2010 GARANTIAS ESTATALES
      *AFRI
           PERFORM LEE-PNTL.
      *AFRI

           MOVE ZEROES TO GMO-NUM-IMOV IN GMO.

           IF GDG-IND-GTAC IN GDG = 'S'
               MOVE 'GDG    AGAYA' TO MSG-COD-MENS
               GO TO EXT-MAIN.

           IF GDG-IND-EST1 IN GDG < '05' OR
              GDG-IND-EST1 IN GDG NOT < '20'
      *INI-AFRI/MAY-2005
              OR GDG-IND-EST1 IN GDG = '07'
      *FIN-AFRI/MAY-2005
               MOVE 'GAR    NOVIG' TO MSG-COD-MENS
               GO TO EXT-MAIN.

           MOVE GDG-COD-TOPE IN GDG TO TAG-COD-TOPE IN TAG.
           MOVE GDG-COD-SOPE IN GDG TO TAG-COD-SOPE IN TAG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-TAG.
           IF NOT FIO-STAT-OKS
               MOVE 'TAG    NEX' TO MSG-COD-MENS
               GO TO EXT-MAIN.
      * EVA-AFRI/MAY2007 PRELACION
           IF GDG-COD-LGTA IN GDG = 'G'
               MOVE 'N' TO TAG-IND-EGES IN TAG
           ELSE
               MOVE 'S' TO TAG-IND-EGES IN TAG.
      * EVA-FIN/MAY2007 PRELACION

      *MHM-INI 13-OCT-2003
      *     IF GDG-COD-GGTA IN GDG > '1'
      *         MOVE 'S' TO TAG-IND-EGAP IN TAG
      *     ELSE
      *         MOVE 'N' TO TAG-IND-EGAP IN TAG.
      *MHM-FIN 13-OCT-2003

           IF GDG-IND-INOB IN GDG = 'S'
               MOVE 'S' TO TAG-IND-EGIN IN TAG
           ELSE
               MOVE 'N' TO TAG-IND-EGIN IN TAG.

           MOVE '1' TO GMO-COD-MOVI IN GMO.

           IF TAG-IND-EGAP IN TAG = 'S' AND
              GDG-IND-EGAP IN GDG NOT = 'S'
      *AFRI
               IF VCG-CMND = 'ACE'
                   MOVE 'GAP' TO PNT-COD-PTLL
                   PERFORM BUS-PNTL
                   IF PNT-EXT-PNTL = 'NO'
                       MOVE 'GAP    NEX' TO MSG-COD-MENS
                       GO TO EXT-MAIN
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'GAP    NEX' TO MSG-COD-MENS
                   GO TO EXT-MAIN.
      *AFRI
      *EVA-AFRI/MAYO2007 PRELACION
           IF TAG-IND-EGAP IN TAG = 'S' AND
              GDG-IND-EGAP IN GDG = 'S'
              MOVE ZEROES TO WSS-IND-GBCI
              MOVE SPACES TO MSG-COD-MENS
              PERFORM GAP-AGA
              IF MSG-COD-MENS > SPACES
                 GO TO EXT-MAIN.

      *FLB CST 22-SEP-1993
           IF GDG-COD-GGTA IN GDG > '1'
               PERFORM VAL-GAP
               IF MSG-COD-MENS > SPACES
                   GO TO EXT-MAIN.
      *FLB CST 22-SEP-1993

      *FLB CST  13-JUN-1994
      *     IF TAG-IND-EGDD IN TAG = 'S' AND
      *        GDG-IND-EGDD IN GDG NOT = 'S'
      *         MOVE 'GDD    NEX' TO MSG-COD-MENS
      *         GO TO EXT-MAIN.
           PERFORM VAL-GDD.
           IF MSG-COD-MENS > SPACES
               GO TO EXT-MAIN.
      *FLB CST  13-JUN-1994

           IF TAG-IND-EGDO IN TAG = 'S' AND
              GDG-IND-EGDO IN GDG NOT = 'S'
      *AFRI
               IF VCG-CMND = 'ACE'
                   MOVE 'GDO' TO PNT-COD-PTLL
                   PERFORM BUS-PNTL
                   IF PNT-EXT-PNTL = 'NO'
                       MOVE 'GDO    NEX' TO MSG-COD-MENS
                       GO TO EXT-MAIN
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'GDO    NEX' TO MSG-COD-MENS
                   GO TO EXT-MAIN.

           IF TAG-IND-EGDP IN TAG = 'S' AND
              GDG-IND-EGDP IN GDG NOT = 'S'
      *AFRI
               IF VCG-CMND = 'ACE'
                   MOVE 'GDP' TO PNT-COD-PTLL
                   PERFORM BUS-PNTL
                   IF PNT-EXT-PNTL = 'NO'
                       MOVE 'GDP    NEX' TO MSG-COD-MENS
                       GO TO EXT-MAIN
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'GDP    NEX' TO MSG-COD-MENS
                   GO TO EXT-MAIN.
      *AFRI

           IF TAG-IND-EGES IN TAG = 'S' AND
              GDG-IND-EGES IN GDG NOT = 'S'
      *AFRI
               IF VCG-CMND = 'ACE'
                   MOVE 'GES' TO PNT-COD-PTLL
                   PERFORM BUS-PNTL
                   IF PNT-EXT-PNTL = 'NO'
                       MOVE 'GES    NEX' TO MSG-COD-MENS
                       GO TO EXT-MAIN
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'GES    NEX' TO MSG-COD-MENS
                   GO TO EXT-MAIN.
      *AFRI

           IF TAG-IND-EGIN IN TAG = 'S' AND
              GDG-IND-EGIN IN GDG NOT = 'S'
      *AFRI
               IF VCG-CMND = 'ACE'
                   MOVE 'GIN' TO PNT-COD-PTLL
                   PERFORM BUS-PNTL
                   IF PNT-EXT-PNTL = 'NO'
                       MOVE 'GIN    NEX' TO MSG-COD-MENS
                       GO TO EXT-MAIN
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'GIN    NEX' TO MSG-COD-MENS
                   GO TO EXT-MAIN.
      *AFRI
      *AFRI-EVA/MAYO2007  PRELACION
           IF VCG-CMND = 'ACE' OR VCG-CMND = 'AGA'
              MOVE 'GLE' TO PNT-COD-PTLL
              PERFORM BUS-PNTL
              IF PNT-EXT-PNTL = 'NO'
                  MOVE 'GLE    NEX' TO MSG-COD-MENS
                  GO TO EXT-MAIN
              ELSE
                  PERFORM GDG-GLE
                  IF MSG-COD-MENS > SPACES
                     GO TO EXT-MAIN
                  ELSE
                     NEXT SENTENCE
           ELSE
                   MOVE 'GLE    NEX' TO MSG-COD-MENS
                   GO TO EXT-MAIN.


      *AFRI

           IF TAG-IND-EGSE IN TAG = 'S' AND
              GDG-IND-EGSE IN GDG NOT = 'S'
      *AFRI
               IF VCG-CMND = 'ACE'
                   MOVE 'GSE' TO PNT-COD-PTLL
                   PERFORM BUS-PNTL
                   IF PNT-EXT-PNTL = 'NO'
                       MOVE 'GSE    NEX' TO MSG-COD-MENS
                       GO TO EXT-MAIN
                   ELSE
                       GO TO FIN-EGSE
               ELSE
                   MOVE 'GSE    NEX' TO MSG-COD-MENS
                   GO TO EXT-MAIN.
      *AFRI

      *MHM-INI 29-JUL-2003
           IF TAG-IND-EGSE IN TAG NOT = 'S'
              GO TO FIN-EGSE.

           MOVE GDG-CAI-GTIA IN GDG TO GSE-CAI-GTIA IN GSE.
           MOVE GDG-IIC-GTIA IN GDG TO GSE-IIC-GTIA IN GSE.
           MOVE ZEROES              TO GSE-NUM-IGSE IN GSE.
           MOVE FIO-GET-NLS TO FIO-CMND
           PERFORM BGL-FIO-GSE
           IF NOT ( FIO-STAT-OKS AND
                    GDG-CAI-GTIA IN GDG = GSE-CAI-GTIA IN GSE AND
                    GDG-IIC-GTIA IN GDG = GSE-IIC-GTIA IN GSE    )
              MOVE 'GSE    NEX' TO MSG-COD-MENS
              GO TO EXT-MAIN.
       LUP-EGSE.
            IF NOT ( FIO-STAT-OKS AND
                     GDG-CAI-GTIA IN GDG = GSE-CAI-GTIA IN GSE AND
                     GDG-IIC-GTIA IN GDG = GSE-IIC-GTIA IN GSE    )
               MOVE '00' TO FIO-STAT
               GO TO FIN-EGSE.

            IF GSE-FEC-FVTS IN GSE < HOY-FHOY
               MOVE 'GSE    VEN' TO MSG-COD-MENS
               GO TO EXT-MAIN.

            MOVE FIO-GET-NXT TO FIO-CMND.
            PERFORM BGL-FIO-GSE.
            GO TO LUP-EGSE.

       FIN-EGSE.

      *MHM-FIN 29-JUL-2003
           IF TAG-IND-EGSI IN TAG = 'S' AND
              GDG-IND-EGSI IN GDG NOT = 'S'
      *AFRI
               IF VCG-CMND = 'ACE'
                   MOVE 'GSI' TO PNT-COD-PTLL
                   PERFORM BUS-PNTL
                   IF PNT-EXT-PNTL = 'NO'
                       MOVE 'GSI    NEX' TO MSG-COD-MENS
                       GO TO EXT-MAIN
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'GSI    NEX' TO MSG-COD-MENS
                   GO TO EXT-MAIN.
      *AFRI

           IF TAG-IND-EGTP IN TAG = 'S' AND
              GDG-IND-EGTP IN GDG NOT = 'S'
      *AFRI
               IF VCG-CMND = 'ACE'
                   MOVE 'GTP' TO PNT-COD-PTLL
                   PERFORM BUS-PNTL
                   IF PNT-EXT-PNTL = 'NO'
                       MOVE 'GTP    NEX' TO MSG-COD-MENS
                       GO TO EXT-MAIN
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'GTP    NEX' TO MSG-COD-MENS
                   GO TO EXT-MAIN.
      *AFRI

           IF TAG-IND-EGUB IN TAG = 'S' AND
              GDG-IND-EGUB IN GDG NOT = 'S'
      *AFRI
               IF VCG-CMND = 'ACE'
                   MOVE 'GUB' TO PNT-COD-PTLL
                   PERFORM BUS-PNTL
                   IF PNT-EXT-PNTL = 'NO'
                       MOVE 'GUB    NEX' TO MSG-COD-MENS
                       GO TO EXT-MAIN
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'GUB    NEX' TO MSG-COD-MENS
                   GO TO EXT-MAIN.
      *AFRI
      *MHM-INI 29-JUL-2003
           IF TAG-IND-EGIM IN TAG = 'S' AND
              GDG-IND-EGIM IN GDG NOT = 'S'
      *AFRI
               IF VCG-CMND = 'ACE'
                   MOVE 'GIM' TO PNT-COD-PTLL
                   PERFORM BUS-PNTL
                   IF PNT-EXT-PNTL = 'NO'
                       MOVE 'GIM    NEX' TO MSG-COD-MENS
                       GO TO EXT-MAIN
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'GIM    NEX' TO MSG-COD-MENS
                   GO TO EXT-MAIN.
      *AFRI

           IF TAG-IND-EGVE IN TAG = 'S' AND
              GDG-IND-EGVE IN GDG NOT = 'S'
      *AFRI
               IF VCG-CMND = 'ACE'
                   MOVE 'GVE' TO PNT-COD-PTLL
                   PERFORM BUS-PNTL
                   IF PNT-EXT-PNTL = 'NO'
                       MOVE 'GVE    NEX' TO MSG-COD-MENS
                       GO TO EXT-MAIN
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'GVE    NEX' TO MSG-COD-MENS
                   GO TO EXT-MAIN.
      *AFRI
      *MHM-FIN 29-JUL-2003
      *---------------------------------------------------*

      *FLB CST  19-OCT-1993 DISTINGUE GVT NO INGRESADA DE TASACION NO
      *   ACTIVADA EN TASACIONES PARCIALES
           MOVE GDG-CAI-GTIA IN GDG TO GVT-CAI-GTIA IN GVT.
           MOVE GDG-IIC-GTIA IN GDG TO GVT-IIC-GTIA IN GVT.
           MOVE GDG-COD-TSCN IN GDG TO GVT-COD-TASN IN GVT.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF NOT FIO-STAT-OKS
               MOVE 'GVT    NEX' TO MSG-COD-MENS
               GO TO EXT-MAIN.

      *MHM-INI 01-JUL-2004
      *     IF TAG-IND-EGVT IN TAG = 'S' AND
      *        GDG-IND-EGVT IN GDG NOT = 'S'
      *MHM-FIN 01-JUL-2004
               IF GVT-MSC-STAT IN GVT NOT = 'A'
                   MOVE 'ATANO' TO MSG-COD-MENS
      *MHM-INI 01-JUL-2004
                   GO TO EXT-MAIN.
      *             GO TO EXT-MAIN
      *         ELSE
      *             MOVE 'PGM    ERR' TO MSG-COD-MENS
      *             GO TO EXT-MAIN.
      *MHM-FIN 01-JUL-2004

      * GENERA GMO DE GDG
           PERFORM INI-GMO.
           MOVE 'GDG001' TO GMO-COD-CMPO IN GMO.
           MOVE '1' TO GMO-COD-MOVI IN GMO.
           MOVE 'N' TO GMO-IND-VALO IN GMO.
           MOVE 'S' TO GMO-IND-CLVE IN GMO.
           MOVE GDG-IND-EST1 IN GDG TO GMO-COD-NCLV IN GMO.
      *ALD-ADA-INI/08112001
      *INI-AFRI/MAY-2005
      *     IF TAG-IND-CTBL IN TAG = 'N'
           IF TAG-IND-CTBL IN TAG = 'N'
      *EVA-AFRI/JUL2007 CTBL NOVA
      *       GDG-CAI-GTIA IN GDG = '0800'
      *FIN-AFRI/JUL2007 CTBL NOVA
      *FIN-AFRI/MAY-2005.
                GO TO CON-SIN-GMO.
      *ALD-ADA-FIN/08112001
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GMO.
           IF NOT FIO-STAT-OKS
               MOVE 'GMO    PUT' TO MSG-COD-MENS
               GO TO EXT-MAIN.
      *ALD-ADA-INI/08112001
       CON-SIN-GMO.
      *ALD-ADA-FIN/08112001

      *    PERFORM GET-FHOY.
      *FLB CST  17-NOV-1993 SE TRASLADA EL CODIGO QUE HABIA AQUI
      *         A ANTES DEL FIO-MOD
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG   KEYUPD' TO MSG-COD-MENS
               GO TO EXT-MAIN.

           IF TAG-IND-EGVT IN TAG = 'N' AND
              GDG-IND-EGVT IN GDG = 'S'
      *FLB CST  17-NOV-1993 SE LIMPIA EL INDICADOR
               MOVE SPACES TO GDG-IND-EGVT IN GDG
               PERFORM ELI-GVT
           ELSE
           IF GDG-IND-EGVT IN GDG = 'S'
      *FLB CST  19-OCT-1993 SE TRASLADO EL BUS-GVT (NO SECTION)
               PERFORM ESC-GMO-GVT
               IF MSG-COD-MENS > SPACES
                   GO TO EXT-MAIN
               ELSE
                   NEXT SENTENCE
           ELSE
               GO TO EXT-MAIN.

           IF TAG-IND-EGDD IN TAG = 'N' AND
              GDG-IND-EGDD IN GDG = 'S'
      *FLB CST  17-NOV-1993 SE LIMPIA EL INDICADOR
               MOVE SPACES TO GDG-IND-EGDD IN GDG
               PERFORM ELI-GDD
           ELSE
           IF GDG-IND-EGDD IN GDG = 'S'
               PERFORM ESC-GMO-GDD
               IF MSG-COD-MENS > SPACES
                   GO TO EXT-MAIN.

           IF TAG-IND-EGES IN TAG = 'N' AND
              GDG-IND-EGES IN GDG = 'S'
      *FLB CST  17-NOV-1993 SE LIMPIA EL INDICADOR
               MOVE SPACES TO GDG-IND-EGES IN GDG
               PERFORM ELI-GES
           ELSE
           IF GDG-IND-EGES IN GDG = 'S'
               PERFORM ESC-GMO-GES
               IF MSG-COD-MENS > SPACES
                   GO TO EXT-MAIN.

           IF TAG-IND-EGLE IN TAG = 'N' AND
              GDG-IND-EGLE IN GDG = 'S'
      *FLB CST  17-NOV-1993 SE LIMPIA EL INDICADOR
               MOVE SPACES TO GDG-IND-EGLE IN GDG
               PERFORM ELI-GLE
           ELSE
           IF GDG-IND-EGLE IN GDG = 'S'
               PERFORM ESC-GMO-GLE
               IF MSG-COD-MENS > SPACES
                   GO TO EXT-MAIN.

           IF TAG-IND-EGDO IN TAG = 'N' AND
              GDG-IND-EGDO IN GDG = 'S'
      *FLB CST  17-NOV-1993 SE LIMPIA EL INDICADOR
               MOVE SPACES TO GDG-IND-EGDO IN GDG
               PERFORM ELI-GDO
           ELSE
           IF GDG-IND-EGDO IN GDG = 'S'
               PERFORM ESC-GMO-GDO
               IF MSG-COD-MENS > SPACES
                   GO TO EXT-MAIN.

           IF TAG-IND-EGSE IN TAG = 'N' AND
              GDG-IND-EGSE IN GDG = 'S'
      *FLB CST  17-NOV-1993 SE LIMPIA EL INDICADOR
               MOVE SPACES TO GDG-IND-EGSE IN GDG
               PERFORM ELI-GSE
           ELSE
           IF GDG-IND-EGSE IN GDG = 'S'
               PERFORM ESC-GMO-GSE
               IF MSG-COD-MENS > SPACES
                   GO TO EXT-MAIN.

           IF TAG-IND-EGTP IN TAG = 'N' AND
              GDG-IND-EGTP IN GDG = 'S'
      *FLB CST  17-NOV-1993 SE LIMPIA EL INDICADOR
               MOVE SPACES TO GDG-IND-EGTP IN GDG
               PERFORM ELI-GTP
           ELSE
           IF GDG-IND-EGTP IN GDG = 'S'
               PERFORM ESC-GMO-GTP
               IF MSG-COD-MENS > SPACES
                   GO TO EXT-MAIN.

           IF TAG-IND-EGUB IN TAG = 'N' AND
              GDG-IND-EGUB IN GDG = 'S'
      *FLB CST  17-NOV-1993 SE LIMPIA EL INDICADOR
               MOVE SPACES TO GDG-IND-EGUB IN GDG
               PERFORM ELI-GUB
           ELSE
           IF GDG-IND-EGUB IN GDG = 'S'
               PERFORM ESC-GMO-GUB
               IF MSG-COD-MENS > SPACES
                   GO TO EXT-MAIN.

           IF TAG-IND-EGAP IN TAG = 'N' AND
              GDG-IND-EGAP IN GDG = 'S'
      *FLB CST  17-NOV-1993 SE LIMPIA EL INDICADOR
               MOVE SPACES TO GDG-IND-EGAP IN GDG
               PERFORM ELI-GAP
           ELSE
           IF GDG-IND-EGAP IN GDG = 'S'
               PERFORM ESC-GMO-GAP
               IF MSG-COD-MENS > SPACES
                   GO TO EXT-MAIN.

           IF TAG-IND-EGIN IN TAG = 'N' AND
              GDG-IND-EGIN IN GDG = 'S'
      *FLB CST  17-NOV-1993 SE LIMPIA EL INDICADOR
               MOVE SPACES TO GDG-IND-EGIN IN GDG
               PERFORM ELI-GIN
           ELSE
           IF GDG-IND-EGIN IN GDG = 'S'
               PERFORM ESC-GMO-GIN
               IF MSG-COD-MENS > SPACES
                   GO TO EXT-MAIN.

           IF TAG-IND-EGSI IN TAG = 'N' AND
              GDG-IND-EGSI IN GDG = 'S'
      *FLB CST  17-NOV-1993 SE LIMPIA EL INDICADOR
               MOVE SPACES TO GDG-IND-EGSI IN GDG
               PERFORM ELI-GSI
           ELSE
           IF GDG-IND-EGSI IN GDG = 'S'
               PERFORM ESC-GMO-GSI
               IF MSG-COD-MENS > SPACES
                   GO TO EXT-MAIN.

           IF TAG-IND-EGDP IN TAG = 'N' AND
              GDG-IND-EGDP IN GDG = 'S'
      *FLB CST  17-NOV-1993 SE LIMPIA EL INDICADOR
               MOVE SPACES TO GDG-IND-EGDP IN GDG
               PERFORM ELI-GDP
           ELSE
           IF GDG-IND-EGDP IN GDG = 'S'
               PERFORM ESC-GMO-GDP
               IF MSG-COD-MENS > SPACES
                   GO TO EXT-MAIN.
      *MHM-INI 29-JUL-2003
           IF TAG-IND-EGIM IN TAG = 'N' AND
              GDG-IND-EGIM IN GDG = 'S'
               MOVE SPACES TO GDG-IND-EGIM IN GDG
               PERFORM ELI-GIM.

           IF TAG-IND-EGVE IN TAG = 'N' AND
              GDG-IND-EGVE IN GDG = 'S'
               MOVE SPACES TO GDG-IND-EGVE IN GDG
               PERFORM ELI-GVE.
      *MHM-FIN 29-JUL-2003
      *FLB CST  17-NOV-1993 TRASLADADO AQUI PARA EVITAR QUE IND-EXI-XXX
      *    QUEDE LLENO EN GDG CUANDO DEBE ESTAR VACIO
      *    EL PROBLEMA SE PRODUJO EN LA ENTIDAD GES PERO PODRIA OCURRIR
      *    PARA OTRAS

      *FLB CST  17-NOV-1993 TRASLADADO AQUI
           MOVE HOY-FHOY TO GDG-FEC-FTRN IN GDG.
           MOVE HOY-HHOY TO GDG-HRA-HRTR IN GDG.
      *FLB CST  17-NOV-1993 TRASLADADO AQUI
           MOVE HOY-FHOY TO GDG-FEC-FING IN GDG.
           MOVE 'I'      TO GDG-MSC-TACC IN GDG.
      *MHM-INI 29-JUL-2003
           MOVE '10'     TO GDG-IND-EST1 IN GDG.
      *MHM-FIN 29-JUL-2003
           MOVE 'S'      TO GDG-IND-GTAC  IN GDG.
           MOVE 'A'      TO GDG-MSC-STAT  IN GDG.
      *MHM-INI 29-JUL-2003
           MOVE HOY-FHOY TO GDG-FEC-FEST IN GDG.
      *MHM-FIN 29-JUL-2003
      *AFRI-INI/JUL2005
      *EVA-AFRI/JUL2007  CTBL NOVA
           IF GDG-CAI-GTIA IN GDG = '0800'
      *    IF SCR-HDR-MRCA = 'BCS'
      *FIN-AFRI/JUL2007  CTBL NOVA
      *VAL-FEC Validar Fecha
              MOVE GDG-NUM-DEST IN GDG TO FEC-ITM1
              MOVE GDG-NUM-MEST IN GDG TO FEC-ITM2
              MOVE GDG-NUM-SEST IN GDG TO FEC-ITM3
              MOVE GDG-NUM-AEST IN GDG TO FEC-ITM4
              MOVE FEC-FORM-FEC TO FEC-FORM
              MOVE FEC-FBLK-S  TO FEC-FBLK
              MOVE FEC-CHOY-N  TO FEC-CHOY
              MOVE FEC-VHBL-S  TO FEC-VHBL
              MOVE FEC-VAL-FEC TO FEC-CMND
              PERFORM PRO-FEC
              IF FEC-STAT-FER
                 MOVE FEC-FORM-FEC TO FEC-FORM
                 MOVE FEC-FBLK-N  TO FEC-FBLK
                 MOVE FEC-CHOY-N  TO FEC-CHOY
                 MOVE FEC-SIG-HBL TO FEC-CMND
                 PERFORM CAL-FEC
                 MOVE FEC-ITM1 TO GDG-NUM-DEST IN GDG
                 MOVE FEC-ITM2 TO GDG-NUM-MEST IN GDG
                 MOVE FEC-ITM3 TO GDG-NUM-SEST IN GDG
                 MOVE FEC-ITM4 TO GDG-NUM-AEST IN GDG.
      *AFRI-FIN/JUL2005
      *AFRI-INI/JUN2007/CARO
           IF GDG-COD-LGTA IN GDG = 'E'
               PERFORM VAL-FEC-FVTO.
      *AFRI-FIN/JUN2007/CARO
      *MHM-INI 21-OCT-2003
           IF VCG-FEC-FVTO IN VCG-VARI > SPACES
               MOVE  VCG-FEC-FVTO IN VCG-VARI TO GDG-FEC-FVTO IN GDG.
      *MHM-FIN 21-OCT-2003
      *JCT-INI 20-SEP-2007 BGL:AGA
           IF VCG-CMND = 'ACE' OR VCG-CMND = 'AGA'
              MOVE VCG-USER  TO GDG-COD-ATRN IN GDG.
      *JCT-FIN 20-SEP-2007
      *FLB CST  13-JUN-1994
           MOVE 'S'      TO GDG-IND-EGDD IN GDG.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG    MOD' TO MSG-COD-MENS
               GO TO EXT-MAIN.
      *FLB CST  17-NOV-1993 TRASLADADO AQUI

      * TERMINA NORMALMENTE EN EXT-MAIN.
       EXT-MAIN.
           PERFORM FIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
       COPY GNSBGEDB.
           MOVE DFHCOMMAREA(1:EIBCALEN) TO VCG-CMMA.
           MOVE VCG-PROG    TO FIO-PROG.
           MOVE SPACES TO MSG-COD-MENS.
      *Handler para manejar VSAM
      *     PERFORM GNS-HDL-VSM.
      *Buscar Independencia de Datos
           MOVE VCG-QIDD TO SCR-QIDD.
           MOVE VCG-LIDD TO SCR-LIDD.
           PERFORM GNS-BUS-IDD.
      *Carga
      *FLB CST  1-DEC-1993
      *     MOVE VCG-RGDG TO GDG.
           MOVE VCG-CAI-GTIA TO GDG-CAI-GTIA IN GDG.
           MOVE VCG-IIC-GTIA TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG    NEX' TO MSG-COD-MENS.
      *FLB CST  1-DEC-1993
       FIN-INI.
           EXIT.

       FIN SECTION.
       INI-FIN.
      *FLB CST  1-DEC-1993
      *     MOVE GDG TO VCG-RGDG.
      *     MOVE MSG TO VCG-RMSG.
      *MHM-INI 29-JUL-2003
      *     MOVE MSG-COD-MENS TO VCG-MENS.
           MOVE MSG-COD-MENS TO VCG-GLS-MENS.
      *MHM-FIN 29-JUL-2003
      *FLB CST  1-DEC-1993
           MOVE VCG-CMMA TO DFHCOMMAREA.
           MOVE +0 TO EIBRESP.
       COPY GNSBGGBK.
       FIN-FIN.
           EXIT.

       COPY GNSBGSYS.
       COPY GNSBBIDD.
       COPY GNSBHVSM.
       COPY GNSBGVSM.
       COPY GNSBGDTC.
       COPY GNSBIABT.

       COPY BGLBGVC2.

      *FLB CST 22-SEP-1993
       VAL-GAP SECTION.
       INI-VAL-GAP.
           MOVE GDG-COD-GGTA IN GDG TO WSS-COD-GRA.
           MOVE GDG-CAI-GTIA IN GDG TO GAP-CAI-GTIA IN GAP.
           MOVE GDG-IIC-GTIA IN GDG TO GAP-IIC-GTIA IN GAP.
           MOVE WSS-COD-GRA TO WSS-COD-PRD-ACR.
           MOVE WSS-COD-PRD-ACR TO GAP-COD-PACR IN GAP.

           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GAP.
           IF FIO-STAT-OKS
               MOVE 'GRAINV' TO MSG-COD-MENS
               GO TO FIN-VAL-GAP.

           SUBTRACT 1 FROM WSS-COD-PRD-ACR.
           MOVE WSS-COD-PRD-ACR TO GAP-COD-PACR IN GAP.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GAP.
           IF NOT FIO-STAT-OKS
               MOVE 'GRAINV' TO MSG-COD-MENS
               GO TO FIN-VAL-GAP.

       FIN-VAL-GAP.
           EXIT.

      *FLB CST 22-SEP-1993 FIN

       ESC-GMO-GDD SECTION.
       INI-ESC-GMO-GDD.
      *ALD-ADA-INI/08112001
      *INI-AFRI/MAY-2005
      *     IF TAG-IND-CTBL IN TAG = 'N'
           IF TAG-IND-CTBL IN TAG = 'N'
      *EVA-AFRI/JUL2007  CTBL NOVA
      *       GDG-CAI-GTIA IN GDG = '0800'
      *FIN-AFRI/JUL2007  CTBL NOVA
      *FIN-AFRI/MAY-2005.
               GO TO FIN-ESC-GMO-GDD.
      *ALD-ADA-FIN/08112001
           PERFORM INI-GMO.
           MOVE 'GDD001' TO GMO-COD-CMPO IN GMO.
           MOVE 'N' TO GMO-IND-VALO IN GMO.
           MOVE 'N' TO GMO-IND-CLVE IN GMO.
           MOVE GDG-CAI-GTIA IN GDG TO GDD-CAI-GTIA IN GDD.
           MOVE GDG-IIC-GTIA IN GDG TO GDD-IIC-GTIA IN GDD.
           MOVE 1 TO WSS-IMAL.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-ESC-GMO-GDD.
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           PERFORM BGL-FIO-GDD.
           IF FIO-STAT-OKS AND
              GDG-CAI-GTIA IN GDG = GDD-CAI-GTIA IN GDD AND
              GDG-IIC-GTIA IN GDG = GDD-IIC-GTIA IN GDD
               MOVE 0 TO WSS-IMAL
               MOVE GDD-KEY-IGDD IN GDD TO GMO-GLS-NCMP IN GMO
               MOVE FIO-PUT TO FIO-CMND
               PERFORM BGL-FIO-GMO
               IF FIO-STAT-OKS
                   MOVE FIO-GET-NXT TO FIO-CMND
                   ADD 1 TO GMO-NUM-IMOV IN GMO
                   GO TO LUP-ESC-GMO-GDD
               ELSE
                   MOVE 'GMO    PUT' TO MSG-COD-MENS
           ELSE
               IF WSS-IMAL > 0
                   MOVE 'GDD    NEX' TO MSG-COD-MENS.
       FIN-ESC-GMO-GDD.
           EXIT.

       ESC-GMO-GES SECTION.
       INI-ESC-GMO-GES.
      *ALD-ADA-INI/08112001
      *INI-AFRI/MAY-2005
      *     IF TAG-IND-CTBL IN TAG = 'N'
           IF TAG-IND-CTBL IN TAG = 'N'
      *EVA-AFRI/JUL2007  CTBL NOVA
      *       GDG-CAI-GTIA IN GDG = '0800'
      *FIN-AFRI/JUL2007  CTBL NOVA
      *FIN-AFRI/MAY-2005.
               GO TO FIN-ESC-GMO-GES.
      *ALD-ADA-FIN/08112001
           PERFORM INI-GMO.
           MOVE 'GES000' TO GMO-COD-CMPO IN GMO.
           MOVE 'N' TO GMO-IND-VALO IN GMO.
           MOVE 'N' TO GMO-IND-CLVE IN GMO.
           MOVE GDG-CAI-GTIA IN GDG TO GES-CAI-GTIA IN GES.
           MOVE GDG-IIC-GTIA IN GDG TO GES-IIC-GTIA IN GES.
           MOVE ZEROES TO GES-NUM-IGES IN GES.
           MOVE 'GES-KEY-IGES' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 1 TO WSS-IMAL.
       LUP-ESC-GMO-GES.
           PERFORM BGL-FIO-GES.
           IF FIO-STAT-OKS AND
              GDG-CAI-GTIA IN GDG = GES-CAI-GTIA IN GES AND
              GDG-IIC-GTIA IN GDG = GES-IIC-GTIA IN GES
               MOVE 0 TO WSS-IMAL
               MOVE GES-NUM-IGES IN GES TO GMO-GLS-NCMP IN GMO
               MOVE FIO-PUT TO FIO-CMND
               PERFORM BGL-FIO-GMO
               IF FIO-STAT-OKS
                   MOVE FIO-GET-NXT TO FIO-CMND
                   ADD 1 TO GMO-NUM-IMOV IN GMO
                   GO TO LUP-ESC-GMO-GES
               ELSE
                   MOVE 'GMO    PUT' TO MSG-COD-MENS
           ELSE
               IF WSS-IMAL > 0
                   MOVE 'GES    NEX' TO MSG-COD-MENS.
       FIN-ESC-GMO-GES.
           EXIT.

       ESC-GMO-GLE SECTION.
       INI-ESC-GMO-GLE.
      *ALD-ADA-INI/08112001
      *INI-AFRI/MAY-2005
      *     IF TAG-IND-CTBL IN TAG = 'N'
           IF TAG-IND-CTBL IN TAG = 'N'
      *EVA-AFRI/JUL2007  CTBL NOVA
      *       GDG-CAI-GTIA IN GDG = '0800'
      *FIN-AFRI/JUL2007  CTBL NOVA
      *FIN-AFRI/MAY-2005.
               GO TO FIN-ESC-GMO-GLE.
      *ALD-ADA-FIN/08112001
           PERFORM INI-GMO.
           MOVE 'GLE000' TO GMO-COD-CMPO IN GMO.
           MOVE 'N' TO GMO-IND-VALO IN GMO.
           MOVE 'N' TO GMO-IND-CLVE IN GMO.
           MOVE GDG-CAI-GTIA IN GDG TO GLE-CAI-GTIA IN GLE.
           MOVE GDG-IIC-GTIA IN GDG TO GLE-IIC-GTIA IN GLE.
      *MHM-INI 29-JUL-2003
           MOVE ZEROES              TO GLE-COD-PACR IN GLE.
      *MHM-FIN 29-JUL-2003
           MOVE 'GLE-KEY-IGLE' TO FIO-AKEY.
      *MHM-INI 29-JUL-2003
      *     MOVE FIO-GET-KEY TO FIO-CMND.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 1 TO WSS-IMAL.
      *MHM-FIN 29-JUL-2003
       LUP-VCG-ESC-GMO-GLE.
           PERFORM BGL-FIO-GLE.
      *MHM-INI 29-JUL-2003
      *     IF FIO-STAT-OKS
      *         MOVE 'DATOS LEGALES' TO GMO-GLS-NCMP IN GMO
           IF FIO-STAT-OKS AND
              GDG-CAI-GTIA IN GDG = GLE-CAI-GTIA IN GLE AND
              GDG-IIC-GTIA IN GDG = GLE-IIC-GTIA IN GLE
               MOVE 0 TO WSS-IMAL
               MOVE GLE-COD-PACR IN GLE TO GMO-GLS-NCMP IN GMO
               MOVE FIO-PUT TO FIO-CMND
      *MHM-FIN 29-JUL-2003
               PERFORM BGL-FIO-GMO
               IF FIO-STAT-OKS
      *MHM-INI 29-JUL-2003
      *             NEXT SENTENCE
                   MOVE FIO-GET-NXT TO FIO-CMND
                   ADD 1 TO GMO-NUM-IMOV IN GMO
                   GO TO LUP-VCG-ESC-GMO-GLE
      *MHM-FIN 29-JUL-2003
               ELSE
                   MOVE 'GMO    PUT' TO MSG-COD-MENS
           ELSE
      *MHM-INI 29-JUL-2003
               IF WSS-IMAL > 0
      *MHM-FIN 29-JUL-2003
                   MOVE 'GLE    NEX' TO MSG-COD-MENS.
       FIN-ESC-GMO-GLE.
           EXIT.

       ESC-GMO-GDO SECTION.
       INI-ESC-GMO-GDO.
       FIN-ESC-GMO-GDO.
           EXIT.

       ESC-GMO-GSE SECTION.
       INI-ESC-GMO-GSE.
      *ALD-ADA-INI/08112001
      *INI-AFRI/MAY-2005
      *     IF TAG-IND-CTBL IN TAG = 'N'
           IF TAG-IND-CTBL IN TAG = 'N'
      *EVA-AFRI/JUL2007  CTBL NOVA
      *       GDG-CAI-GTIA IN GDG = '0800'
      *FIN-AFRI/JUL2007  CTBL NOVA
      *FIN-AFRI/MAY-2005.
               GO TO FIN-ESC-GMO-GSE.
      *ALD-ADA-FIN/08112001
           PERFORM INI-GMO.
           MOVE 'GSE000' TO GMO-COD-CMPO IN GMO.
           MOVE 'N' TO GMO-IND-VALO IN GMO.
           MOVE 'N' TO GMO-IND-CLVE IN GMO.
           MOVE GDG-CAI-GTIA IN GDG TO GSE-CAI-GTIA IN GSE.
           MOVE GDG-IIC-GTIA IN GDG TO GSE-IIC-GTIA IN GSE.
      *MHM-INI 29-JUL-2003
           MOVE ZEROES              TO GSE-NUM-IGSE IN GSE.
      *MHM-FIN 29-JUL-2003
           MOVE 'GSE-KEY-IGSE' TO FIO-AKEY.
      *MHM-INI 29-JUL-2003
      *     MOVE FIO-GET-KEY TO FIO-CMND.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 1 TO WSS-IMAL.
       LUP-VCG-ESC-GMO-GSE.
      *MHM-FIN 29-JUL-2003
           PERFORM BGL-FIO-GSE.
      *MHM-INI 29-JUL-2003
      *     IF FIO-STAT-OKS
      *         MOVE 'DATOS DE SEGUROS' TO GMO-GLS-NCMP IN GMO
           IF FIO-STAT-OKS AND
              GDG-CAI-GTIA IN GDG = GSE-CAI-GTIA IN GSE AND
              GDG-IIC-GTIA IN GDG = GSE-IIC-GTIA IN GSE
               MOVE 0 TO WSS-IMAL
               MOVE GSE-NUM-IGSE IN GSE TO GMO-GLS-NCMP IN GMO
      *MHM-FIN 29-JUL-2003
               MOVE FIO-PUT TO FIO-CMND
               PERFORM BGL-FIO-GMO
               IF FIO-STAT-OKS
      *MHM-INI 29-JUL-2003
      *             NEXT SENTENCE
                   MOVE FIO-GET-NXT TO FIO-CMND
                   ADD 1 TO GMO-NUM-IMOV IN GMO
                   GO TO LUP-VCG-ESC-GMO-GSE
      *MHM-FIN 29-JUL-2003
               ELSE
                   MOVE 'GMO    PUT' TO MSG-COD-MENS
           ELSE
      *MHM-INI 29-JUL-2003
               IF WSS-IMAL > 0
      *MHM-FIN 29-JUL-2003
                  MOVE 'GSE    NEX' TO MSG-COD-MENS.
       FIN-ESC-GMO-GSE.
           EXIT.

       ESC-GMO-GVT SECTION.
       INI-ESC-GMO-GVT.
           MOVE SPACES TO MSG-COD-MENS.
      *ALD-ADA-INI/08112001
      *INI-AFRI/MAY-2005
      *     IF TAG-IND-CTBL IN TAG = 'N'
           IF TAG-IND-CTBL IN TAG = 'N'
      *EVA-AFRI/JUL2007  CTBL NOVA
      *       GDG-CAI-GTIA IN GDG = '0800'
      *FIN-AFRI/JUL2007  CTBL NOVA
      *FIN-AFRI/MAY-2005.
               GO TO FIN-ESC-GMO-GVT.
      *ALD-ADA-FIN/08112001
      * SI LA GARANTIA ESTA COMPLETA, SE ESCRIBE GMO
      * SI ESTA INCOMPLETA SE ESCRIBE EN RUTINA QUE MARCA GARANTIA COMPL
           PERFORM INI-GMO.
           MOVE GVT-COD-TASN IN GVT TO GMO-NUM-TASN IN GMO.
           MOVE 'GVT001' TO GMO-COD-CMPO IN GMO.
           MOVE GVT-SGV-LTSN IN GVT TO GMO-SGV-NCMP IN GMO.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GMO.
           IF NOT FIO-STAT-OKS
               GO TO ERR-ESC-GMO-GVT.

           MOVE 'GVT002' TO GMO-COD-CMPO IN GMO.
           MOVE GVT-SGV-VCTS IN GVT TO GMO-SGV-NCMP IN GMO.
           ADD 1 TO GMO-NUM-IMOV IN GMO.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GMO.
           IF NOT FIO-STAT-OKS
               GO TO ERR-ESC-GMO-GVT.

           MOVE 'GVT003' TO GMO-COD-CMPO IN GMO.
           MOVE GVT-SGV-VPND IN GVT TO GMO-SGV-NCMP IN GMO.
           ADD 1 TO GMO-NUM-IMOV IN GMO.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GMO.
           IF NOT FIO-STAT-OKS
               GO TO ERR-ESC-GMO-GVT.

           MOVE 'GVT005' TO GMO-COD-CMPO IN GMO.
           MOVE GVT-FEC-FTSN IN GVT TO GMO-GLS-NCMP IN GMO.
           MOVE GVT-SGV-VGAS IN GVT TO GMO-SGV-NCMP IN GMO.
           ADD 1 TO GMO-NUM-IMOV IN GMO.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GMO.
           IF NOT FIO-STAT-OKS
               GO TO ERR-ESC-GMO-GVT.

           MOVE 'GVT004' TO GMO-COD-CMPO IN GMO.
           MOVE 'N' TO GMO-IND-VALO IN GMO.
           MOVE ZEROES TO GMO-SGV-CMPA IN GMO.
           MOVE ZEROES TO GMO-SGV-NCMP IN GMO.
           MOVE GVT-FEC-FTSN IN GVT TO GMO-GLS-NCMP IN GMO.
           ADD 1 TO GMO-NUM-IMOV IN GMO.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GMO.
           IF NOT FIO-STAT-OKS
               GO TO ERR-ESC-GMO-GVT.
           GO TO FIN-ESC-GMO-GVT.
       ERR-ESC-GMO-GVT.
           MOVE 'GMO    PUT' TO MSG-COD-MENS.
       FIN-ESC-GMO-GVT.
           EXIT.

       ESC-GMO-GTP SECTION.
       INI-ESC-GMO-GTP.
      *ALD-ADA-INI/08112001
      *INI-AFRI/MAY-2005
      *     IF TAG-IND-CTBL IN TAG = 'N'
           IF TAG-IND-CTBL IN TAG = 'N'
      *EVA-AFRI/JUL2007  CTBL NOVA
      *       GDG-CAI-GTIA IN GDG = '0800'
      *FIN-AFRI/JUL2007  CTBL NOVA
      *FIN-AFRI/MAY-2005.
               GO TO FIN-ESC-GMO-GTP.
      *ALD-ADA-FIN/08112001
           PERFORM INI-GMO.
           MOVE 'N' TO GMO-IND-VALO IN GMO.
           MOVE 'N' TO GMO-IND-CLVE IN GMO.
           MOVE 'GTP001' TO GMO-COD-CMPO IN GMO.
           MOVE GDG-CAI-GTIA IN GDG TO GTP-CAI-GTIA IN GTP.
           MOVE GDG-IIC-GTIA IN GDG TO GTP-IIC-GTIA IN GTP.
           MOVE GDG-COD-TSCN IN GDG TO GTP-NUM-ITSN IN GTP.
           MOVE SPACES TO GTP-COD-IITS IN GTP.
           MOVE 'GTP-KEY-IGTP' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 1 TO WSS-IMAL.
       LUP-ESC-GMO-GTP.
           PERFORM BGL-FIO-GTP.
           IF FIO-STAT-OKS AND
              GDG-CAI-GTIA IN GDG = GTP-CAI-GTIA IN GTP AND
              GDG-IIC-GTIA IN GDG = GTP-IIC-GTIA IN GTP
               MOVE 0 TO WSS-IMAL
               MOVE GTP-COD-IITS IN GTP TO GMO-GLS-NCMP IN GMO
               MOVE FIO-PUT TO FIO-CMND
               PERFORM BGL-FIO-GMO
               IF FIO-STAT-OKS
                   MOVE FIO-GET-NXT TO FIO-CMND
                   ADD 1 TO GMO-NUM-IMOV IN GMO
                   GO TO LUP-ESC-GMO-GTP
               ELSE
                   MOVE 'GMO    PUT' TO MSG-COD-MENS
           ELSE
               IF WSS-IMAL > 0
                   MOVE 'GTP    NEX' TO MSG-COD-MENS.
       FIN-ESC-GMO-GTP.
           EXIT.

       ESC-GMO-GUB SECTION.
       INI-ESC-GMO-GUB.
      *ALD-ADA-INI/08112001
      *INI-AFRI/MAY-2005
      *     IF TAG-IND-CTBL IN TAG = 'N'
           IF TAG-IND-CTBL IN TAG = 'N'
      *EVA-AFRI/JUL2007  CTBL NOVA
      *       GDG-CAI-GTIA IN GDG = '0800'
      *FIN-AFRI/JUL2007  CTBL NOVA
      *FIN-AFRI/MAY-2005.
               GO TO FIN-ESC-GMO-GUB.
      *ALD-ADA-FIN/08112001
           PERFORM INI-GMO.
           MOVE 'GUB000' TO GMO-COD-CMPO IN GMO.
           MOVE 'N' TO GMO-IND-VALO IN GMO.
           MOVE 'N' TO GMO-IND-CLVE IN GMO.
           MOVE GDG-CAI-GTIA IN GDG TO GUB-CAI-GTIA IN GUB.
           MOVE GDG-IIC-GTIA IN GDG TO GUB-IIC-GTIA IN GUB.
           MOVE 'GUB-KEY-IGUB' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GUB.
           IF FIO-STAT-OKS
               MOVE 'DATOS DE UBICACION' TO GMO-GLS-NCMP IN GMO
               MOVE FIO-PUT TO FIO-CMND
               PERFORM BGL-FIO-GMO
               IF FIO-STAT-OKS
                   NEXT SENTENCE
               ELSE
                   MOVE 'GMO    PUT' TO MSG-COD-MENS
           ELSE
                   MOVE 'GUB    NEX' TO MSG-COD-MENS.
       FIN-ESC-GMO-GUB.
           EXIT.

       ESC-GMO-GAP SECTION.
       INI-ESC-GMO-GAP.
      *ALD-ADA-INI/08112001
      *INI-AFRI/MAY-2005
      *     IF TAG-IND-CTBL IN TAG = 'N'
           IF TAG-IND-CTBL IN TAG = 'N'
      *EVA-AFRI/JUL2007   CBTL NOVA
      *       GDG-CAI-GTIA IN GDG = '0800'
      *FIN-AFRI/MAY-2005.
               GO TO FIN-ESC-GMO-GAP.
      *ALD-ADA-FIN/08112001
      *MHM-INI 17-OCT-2003
           MOVE 'GAP-KEY-IGAP' TO FIO-AKEY
           MOVE FIO-END-BRW TO FIO-CMND
           PERFORM BGL-FIO-GAP.
      *MHM-FIN 17-OCT-2003
           PERFORM INI-GMO.
           MOVE 'N' TO GMO-IND-VALO IN GMO.
           MOVE 'N' TO GMO-IND-CLVE IN GMO.
           MOVE 'GAP001' TO GMO-COD-CMPO IN GMO.
           MOVE GDG-CAI-GTIA IN GDG TO GAP-CAI-GTIA IN GAP.
           MOVE GDG-IIC-GTIA IN GDG TO GAP-IIC-GTIA IN GAP.
      *MHM-INI 17-OCT-2003
           MOVE ZEROES              TO GAP-COD-PACR IN GAP.
      *MHM-FIN 17-OCT-2003
           MOVE SPACES TO GAP-CIC-ICLI IN GAP.
           MOVE 'GAP-KEY-IGAP' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 1 TO WSS-IMAL.
       LUP-ESC-GMO-GAP.
           PERFORM BGL-FIO-GAP.
           IF FIO-STAT-OKS AND
              GDG-CAI-GTIA IN GDG = GAP-CAI-GTIA IN GAP AND
              GDG-IIC-GTIA IN GDG = GAP-IIC-GTIA IN GAP
               MOVE 0 TO WSS-IMAL
               MOVE GAP-CIC-ICLI IN GAP TO GMO-GLS-NCMP IN GMO
               MOVE FIO-PUT TO FIO-CMND
               PERFORM BGL-FIO-GMO
               IF FIO-STAT-OKS
                   MOVE FIO-GET-NXT TO FIO-CMND
                   ADD 1 TO GMO-NUM-IMOV IN GMO
                   GO TO LUP-ESC-GMO-GAP
               ELSE
                   MOVE 'GMO    PUT' TO MSG-COD-MENS
           ELSE
               IF WSS-IMAL > 0
                   MOVE 'GAP    NEX' TO MSG-COD-MENS.
       FIN-ESC-GMO-GAP.
           EXIT.

       ESC-GMO-GIN SECTION.
       INI-ESC-GMO-GIN.
      *ALD-ADA-INI/08112001
      *INI-AFRI/MAY-2005
      *     IF TAG-IND-CTBL IN TAG = 'N'
           IF TAG-IND-CTBL IN TAG = 'N'
      *EVA-AFRI/JUL2007   CBTL NOVA
      *       GDG-CAI-GTIA IN GDG = '0800'
      *FIN-AFRI/JUL2007   CBTL NOVA
      *FIN-AFRI/MAY-2005.
               GO TO FIN-ESC-GMO-GIN.
      *ALD-ADA-FIN/08112001
           PERFORM INI-GMO.
           MOVE 'GIN000' TO GMO-COD-CMPO IN GMO.
           MOVE 'N' TO GMO-IND-VALO IN GMO.
           MOVE 'N' TO GMO-IND-CLVE IN GMO.
           MOVE GDG-CAI-GTIA IN GDG TO GIN-CAI-GTIA IN GIN.
           MOVE GDG-IIC-GTIA IN GDG TO GIN-IIC-GTIA IN GIN.
      *MHM-INI 29-JUL-2003
           MOVE ZEROES              TO GIN-NUM-IGIN IN GIN.
      *MHM-FIN 29-JUL-2003
           MOVE 'GIN-KEY-IGIN' TO FIO-AKEY.
      *MHM-INI 29-JUL-2003
      *     MOVE FIO-GET-KEY TO FIO-CMND.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 1 TO WSS-IMAL.
       LUP-VCG-ESC-GMO-GIN.
      *MHM-FIN 29-JUL-2003
           PERFORM BGL-FIO-GIN.
      *MHM-INI 29-JUL-2003
      *     IF FIO-STAT-OKS
      *         MOVE 'DATOS DE INSPECCIONES' TO GMO-GLS-NCMP IN GMO
           IF FIO-STAT-OKS AND
              GDG-CAI-GTIA IN GDG = GIN-CAI-GTIA IN GIN AND
              GDG-IIC-GTIA IN GDG = GIN-IIC-GTIA IN GIN
               MOVE 0 TO WSS-IMAL
               MOVE GIN-NUM-IGIN IN GIN TO GMO-GLS-NCMP IN GMO
      *MHM-FIN 29-JUL-2003
               MOVE FIO-PUT TO FIO-CMND
               PERFORM BGL-FIO-GMO
               IF FIO-STAT-OKS
      *MHM-INI 29-JUL-2003
      *             NEXT SENTENCE
                   MOVE FIO-GET-NXT TO FIO-CMND
                   ADD 1 TO GMO-NUM-IMOV IN GMO
                   GO TO LUP-VCG-ESC-GMO-GIN
      *MHM-FIN 29-JUL-2003
               ELSE
                   MOVE 'GMO    PUT' TO MSG-COD-MENS
           ELSE
      *MHM-INI 29-JUL-2003
               IF WSS-IMAL > 0
      *MHM-FIN 29-JUL-2003
                   MOVE 'GIN    NEX' TO MSG-COD-MENS.
       FIN-ESC-GMO-GIN.
           EXIT.

       ESC-GMO-GDP SECTION.
       INI-ESC-GMO-GDP.
      *ALD-ADA-INI/08112001
      *INI-AFRI/MAY-2005
      *     IF TAG-IND-CTBL IN TAG = 'N'
           IF TAG-IND-CTBL IN TAG = 'N'
      *EVA-AFRI/JUL2007   CBTL NOVA
      *       GDG-CAI-GTIA IN GDG = '0800'
      *FIN-AFRI/JUL2007   CBTL NOVA
      *FIN-AFRI/MAY-2005.
               GO TO FIN-ESC-GMO-GDP.
      *ALD-ADA-FIN/08112001
           PERFORM INI-GMO.
           MOVE 'GDP000' TO GMO-COD-CMPO IN GMO.
           MOVE 'N' TO GMO-IND-VALO IN GMO.
           MOVE 'N' TO GMO-IND-CLVE IN GMO.
           MOVE GDG-CAI-GTIA IN GDG TO GDP-CAI-GTIA IN GDP.
           MOVE GDG-IIC-GTIA IN GDG TO GDP-IIC-GTIA IN GDP.
           MOVE 'GDP-KEY-IGDP' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDP.
           IF FIO-STAT-OKS
               MOVE 'DATOS DE DEPRECIACION' TO GMO-GLS-NCMP IN GMO
               MOVE FIO-PUT TO FIO-CMND
               PERFORM BGL-FIO-GMO
               IF FIO-STAT-OKS
                   NEXT SENTENCE
               ELSE
                   MOVE 'GMO    PUT' TO MSG-COD-MENS
           ELSE
                   MOVE 'GDP    NEX' TO MSG-COD-MENS.
       FIN-ESC-GMO-GDP.
           EXIT.

       ESC-GMO-GSI SECTION.
       INI-ESC-GMO-GSI.
       FIN-ESC-GMO-GSI.
           EXIT.

       INI-GMO SECTION.
       INI-INI-GMO.
           MOVE SPACES TO GMO-GLS-FLAG IN GMO.
           MOVE SPACES TO GMO-FEC-FMOV IN GMO.
           MOVE SPACES TO GMO-HRA-HMOV IN GMO.
           MOVE SPACES TO GMO-CAI-GTIA IN GMO.
           MOVE SPACES TO GMO-IIC-GTIA IN GMO.
      *    MOVE ZEROES TO GMO-NUM-IMOV IN GMO.
           MOVE ZEROES TO GMO-NUM-TASN IN GMO.
           MOVE SPACES TO GMO-COD-CMPO IN GMO.
           MOVE SPACES TO GMO-IND-VALO IN GMO.
           MOVE SPACES TO GMO-IND-CLVE IN GMO.
           MOVE SPACES TO GMO-COD-CLVA IN GMO.
           MOVE SPACES TO GMO-GLS-CMPA IN GMO.
           MOVE ZEROES TO GMO-SGV-CMPA IN GMO.
           MOVE SPACES TO GMO-COD-NCLV IN GMO.
           MOVE SPACES TO GMO-GLS-NCMP IN GMO.
           MOVE ZEROES TO GMO-SGV-NCMP IN GMO.
           MOVE SPACES TO GMO-FEC-FING IN GMO.
           MOVE SPACES TO GMO-COD-TMOV IN GMO.
           MOVE SPACES TO GMO-GLS-DISP IN GMO.

           PERFORM GET-FHOY.
           MOVE HOY-FHOY TO GMO-FEC-FMOV IN GMO.
           MOVE HOY-HHOY TO GMO-HRA-HMOV IN GMO.
      *FLB CST  13-OCT-1993
           MOVE VCG-OTRN TO GMO-TML-TMOV IN GMO.
           MOVE VCG-USER TO GMO-CIC-UING IN GMO.
      *FLB CST  13-OCT-1993
           MOVE HOY-FHOY TO GMO-FEC-FING IN GMO.
           MOVE GDG-CAI-GTIA IN GDG TO GMO-CAI-GTIA IN GMO.
           MOVE GDG-IIC-GTIA IN GDG TO GMO-IIC-GTIA IN GMO.
           MOVE GDG-COD-OFIC IN GDG TO GMO-COD-OFMV IN GMO.
           ADD 1 TO GMO-NUM-IMOV IN GMO.
           MOVE 'S' TO GMO-IND-VALO IN GMO.
           MOVE 'N' TO GMO-IND-CLVE IN GMO.
           MOVE SPACES TO GMO-COD-CLVA IN GMO.
           MOVE SPACES TO GMO-COD-NCLV IN GMO.
           MOVE ZEROES TO GMO-SGV-CMPA IN GMO.
           MOVE ZEROES TO GMO-SGV-NCMP IN GMO.
           MOVE SPACES TO GMO-GLS-CMPA IN GMO.
           MOVE SPACES TO GMO-GLS-NCMP IN GMO.
           MOVE '1' TO GMO-COD-MOVI IN GMO.
       FIN-INI-GMO.
           EXIT.

      *AFRI-INI 15-SEP-2010 GARANTIAS ESTATALES
       VAL-OPC-CRF SECTION.
       INI-VAL-OPC-CRF.

      *UNA VEZ LEIDA LA GARANTIA QUE SE ESTA ACTIVANDO
      *SE REVISA SI ES CORFO

           IF GDG-IND-EST1 IN GDG NOT < '10' OR
              GDG-IND-GTAC IN GDG = 'S'
               MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI
               GO TO FIN-VAL-OPC-CRF.

           MOVE GDG-CAI-GTIA IN GDG TO GES-CAI-GTIA IN GES.
           MOVE GDG-IIC-GTIA IN GDG TO GES-IIC-GTIA IN GES.
           MOVE 1 TO GES-NUM-IGES IN GES.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GES.
           IF NOT FIO-STAT-OKS
      *GARANTIA SIN GES ERROR. ME SALGO PARA QUE EL MISMO PROGRAMA
      *LO INFORME
               MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI
               GO TO FIN-VAL-OPC-CRF.

           IF GES-CIC-IOPC IN GES NOT > SPACES
      *GARANTIA SIN OPC, NO CORFO ME SALGO PARA QUE EL PROGRAMA SIGA
               MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI
               GO TO FIN-VAL-OPC-CRF.

           MOVE GES-CIC-IOPC IN GES TO WSS-CIC-IOPC IN BDO-VARI.
      *SE VERIFICA QUE LA OPC SEA CORFO
           MOVE SPACES      TO OPC-KEY-IOPC IN OPC.
           MOVE WSS-CIC-IOPC IN BDO-VARI TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
      * ERROR ME SALGO Y DETENGO TODO PORQUE NO PUDE REVISAR LA OPC
      * Y PUEDE QUE SEA CORFO
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               MOVE 'BGLOPCERROR' TO MSG-COD-MENS
               GO TO FIN-VAL-OPC-CRF.

           MOVE SPACES TO WSS-COD-TIPO.
           MOVE SPACES TO WSS-IND-PORG.
           PERFORM DET-PRO-CORFO-COL.
           IF WSS-IND-OKS IN WSS-VARI NOT = 'OK'
      *NO ES UN PRODUCTO CORFO
               MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI
           ELSE
               GO TO NEXT-CORFO.

           PERFORM DET-PRO-FOGA-COL.
           IF WSS-IND-OKS IN WSS-VARI NOT = 'OK'
      *NO ES UN PRODUCTO FOGAPE, ME SALGO Y CONTINUA NORMAL
               MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI
               GO TO FIN-VAL-OPC-CRF.

       NEXT-CORFO.

      *SI ES FOGAPE ME SALTO ESTA VALIDACION
           IF WSS-OPC-FOGA IN WSS-VARI = 'S'
               MOVE GES-SGV-PLCR IN GES TO WSS-POR-COBE IN WSS-VARI
               GO TO NEXT-FOGAPE.

      *COMO ES CORFO BUSCO EL PORCENTAJE ASIGNADO
           PERFORM BUS-POR-COBE.
           IF WSS-IND-OKS IN WSS-VARI NOT = 'OK'
      *NO EXISTE EL PORCENTAJE ME SALGO CON ERROR
               GO TO FIN-VAL-OPC-CRF.

           IF GES-SGV-PLCR IN GES NOT = WSS-POR-COBE IN WSS-VARI
      *SE MODIFICO EL PORCENTAJE DE COBERTURA
               PERFORM ACT-GES-CRF
               IF WSS-IND-OKS IN WSS-VARI NOT = 'OK'
      *            ME SALGO PARA REFLEJAR EL ERROR
                   GO TO FIN-VAL-OPC-CRF.

       NEXT-FOGAPE.

      *BUSCO OPERACION ORIGINAL
           PERFORM OBT-OPE-ORI.
           MOVE WSS-CIC-ORIG TO WSS-CIC-IOPC IN BDO-VARI.
           IF (WSS-CIC-PROR > SPACES)
                MOVE WSS-CIC-PROR TO WSS-CIC-IOPC IN BDO-VARI.

      *AHORA ACTUALIZO GVT SEGUN EL SALDO DE LA OPC
           PERFORM OBT-SAL-OPC.
           IF WSS-COD-ERRO IN BDO-VARI > SPACES
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
      *AFRI-INI/JUL2012    GARANTIAS ESTATALES
      *        MOVE 'OPCERRORSAL' TO MSG-COD-MENS
               MOVE WSS-COD-ERRO IN BDO-VARI TO MSG-COD-MENS
      *AFRI-FIN/JUL2012    GARANTIAS ESTATALES
               GO TO FIN-VAL-OPC-CRF.

           IF WSS-VAL-SCRE IN BDO-VARI = ZEROES
      *LA OPERACION FUE PAGADA TOTALMENTE
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               MOVE 'OPCYASAL=0' TO MSG-COD-MENS
               GO TO FIN-VAL-OPC-CRF.

           IF WSS-OPC-FOGA IN WSS-VARI = 'S'
               PERFORM ACT-GVT-FGP
               IF WSS-IND-OKS IN WSS-VARI NOT = 'OK'
                   GO TO FIN-VAL-OPC-CRF
               ELSE
                   GO TO NEX-VAL-OPC-CRF.

           PERFORM ACT-GVT-CRF.
           IF WSS-IND-OKS IN WSS-VARI NOT = 'OK'
               GO TO FIN-VAL-OPC-CRF.

       NEX-VAL-OPC-CRF.

           MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI.
       FIN-VAL-OPC-CRF.
           EXIT.
      *------------------------------------------------------------
       ACT-GVT-FGP SECTION.
       INI-ACT-GVT-FGP.
           MOVE SPACES TO WSS-IND-OKS IN WSS-VARI.
           MOVE SPACES TO GVT.
           MOVE GDG-CAI-GTIA IN GDG TO GVT-CAI-GTIA IN GVT.
           MOVE GDG-IIC-GTIA IN GDG TO GVT-IIC-GTIA IN GVT.
           MOVE 999                 TO GVT-COD-TASN IN GVT.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF NOT FIO-STAT-OKS OR
            GDG-CIC-GTIA IN GDG NOT = GVT-CIC-GTIA IN GVT
      *ME SALGO CON ERROR
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               MOVE 'FGPERRORGVT' TO MSG-COD-MENS
               GO TO FIN-ACT-GVT-FGP.

      *    Valor Liquidacion Tasacion
           COMPUTE  GVT-SGV-LTSN IN GVT =
                 ( WSS-VAL-SCRE IN BDO-VARI *
                   WSS-POR-COBE IN WSS-VARI ) / 100.
      *
      *    Valor Comercial Tasacion
           COMPUTE GVT-SGV-VCTS IN GVT =
                 ( WSS-VAL-SCRE IN BDO-VARI *
                   WSS-POR-COBE IN WSS-VARI ) / 100.

           IF GDG-COD-VCAM IN GDG = '0999  '
               MOVE GVT-SGV-VCTS IN GVT TO PES-SGV-DECI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE TO GVT-SGV-VCTS IN GVT.
      *
           IF GDG-COD-VCAM IN GDG = '0999  '
               MOVE GVT-SGV-LTSN IN GVT TO PES-SGV-DECI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE TO GVT-SGV-LTSN IN GVT.

      *    Valor Ponderacion
           MOVE GDG-TIP-CGTA IN GDG TO TAG-COD-TOPE IN TAG.
           MOVE GDG-STP-CGTA IN GDG TO TAG-COD-SOPE IN TAG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-TAG.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               MOVE 'FGPERRORTAG' TO MSG-COD-MENS
               GO TO FIN-ACT-GVT-FGP.

           COMPUTE GVT-SGV-VPND IN GVT = ( GVT-SGV-VCTS IN GVT *
                    TAG-SGV-PPON IN TAG ) / 100.

      *    Valor Garantia Ajustado Sup
           MOVE GVT-SGV-VCTS IN GVT TO GVT-SGV-VGAS IN GVT.

           ADD 1 TO GVT-COD-TASN IN GVT.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               MOVE 'FGPERRORGVT' TO MSG-COD-MENS
               GO TO FIN-ACT-GVT-FGP.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               MOVE 'FGPERRORGDG' TO MSG-COD-MENS
               GO TO FIN-ACT-GVT-FGP.

           MOVE GVT-COD-TASN IN GVT TO GDG-COD-TSCN IN GDG.

           MOVE FIO-MOD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               MOVE 'FGPERRORGDG' TO MSG-COD-MENS
               GO TO FIN-ACT-GVT-FGP.

           MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI.
       FIN-ACT-GVT-FGP.
           EXIT.
      *------------------------------------------------------------
       ACT-GVT-CRF SECTION.
       INI-ACT-GVT-CRF.
           MOVE SPACES TO WSS-IND-OKS IN WSS-VARI.
           MOVE SPACES TO GVT.
           MOVE GDG-CAI-GTIA IN GDG TO GVT-CAI-GTIA IN GVT.
           MOVE GDG-IIC-GTIA IN GDG TO GVT-IIC-GTIA IN GVT.
           MOVE 1 TO GVT-COD-TASN IN GVT.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF NOT FIO-STAT-OKS
      *ME SALGO CON ERROR
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               MOVE 'CRFERRORGVT' TO MSG-COD-MENS
               GO TO FIN-ACT-GVT-CRF.

      *    Valor Liquidacion Tasacion
           COMPUTE  GVT-SGV-LTSN IN GVT =
                 ( WSS-VAL-SCRE IN BDO-VARI *
                   WSS-POR-COBE IN WSS-VARI ) / 100.
      *
      *    Valor Comercial Tasacion
           COMPUTE GVT-SGV-VCTS IN GVT =
                 ( WSS-VAL-SCRE IN BDO-VARI *
                   WSS-POR-COBE IN WSS-VARI ) / 100.

           IF GDG-COD-VCAM IN GDG = '0999  '
               MOVE GVT-SGV-VCTS IN GVT TO PES-SGV-DECI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE TO GVT-SGV-VCTS IN GVT.
      *
           IF GDG-COD-VCAM IN GDG = '0999  '
               MOVE GVT-SGV-LTSN IN GVT TO PES-SGV-DECI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE TO GVT-SGV-LTSN IN GVT.

      *    Valor Ponderacion
           MOVE GVT-SGV-LTSN IN GVT TO GVT-SGV-VPND IN GVT.

      *    Valor Garantia Ajustado Sup
           MOVE GVT-SGV-VCTS IN GVT TO GVT-SGV-VGAS IN GVT.

           MOVE FIO-MOD TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               MOVE 'CRFERRORGVT' TO MSG-COD-MENS
               GO TO FIN-ACT-GVT-CRF.
           MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI.
       FIN-ACT-GVT-CRF.
           EXIT.
      *------------------------------------------------------------
       OBT-CIC-MONE SECTION.
       INI-OBT-CIC-MONE.
           MOVE SPACES                TO TAB-COD-CTAB IN TAB.
           MOVE 'TAB'                 TO FIO-SIST.
           MOVE 'VLR'                 TO TAB-CIC-TTAB IN TAB.
           MOVE '0999'                TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL'        TO FIO-AKEY.
           MOVE FIO-GET-KEY           TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT  FIO-STAT-OKS
              MOVE SPACES  TO WSS-IND-OKS IN WSS-VARI
              MOVE 'CRFERRORKTT' TO MSG-COD-MENS
              GO TO FIN-OBT-CIC-MONE.
           MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI.
           MOVE TAB-COD-CTAB IN TAB   TO WSS-COD-PESO IN WSS-VARI.
       FIN-OBT-CIC-MONE.
           IF WSS-OPC-FOGA IN WSS-VARI = 'S'
               MOVE 'FGPERRORKTT' TO MSG-COD-MENS.
            EXIT.
      *-------------------------------------------------------------
       OBT-VAL-CAMB SECTION.
       INI-OBT-VAL-CAMB.

           IF GDG-COD-VCAM IN GDG = WSS-COD-PESO IN WSS-VARI
              MOVE 1                  TO WSS-VAL-CAMB IN WSS-VARI
           ELSE
              PERFORM OBT-VAL-CONV.

       FIN-OBT-VAL-CAMB.
           EXIT.
      *------------------------------------------------------------
       OBT-VAL-CONV SECTION.
       INI-OBT-VAL-CONV.

           MOVE ZEROES                   TO WSS-VAL-CAMB IN WSS-VARI.
           MOVE GDG-COD-VCAM IN GDG      TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE CAN-FEC-FCAN IN CAN      TO CAM-FEC-FCAM IN CAM(1)
                                            CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF ( NOT FIO-STAT-OKS              ) OR
              ( CAM-MSC-STAT IN CAM NOT = 'S' )
                MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
                MOVE 'CRFERRORKTT' TO MSG-COD-MENS
                GO TO FIN-OBT-VAL-CONV.
           MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI.
           MOVE CAM-SGV-VCAM IN CAM      TO WSS-VAL-CAMB IN WSS-VARI.

       FIN-OBT-VAL-CONV.
           IF WSS-OPC-FOGA IN WSS-VARI = 'S'
               MOVE 'FGPERRORKTT' TO MSG-COD-MENS.
           EXIT.
      *------------------------------------------------------------
       ACT-GES-CRF SECTION.
       INI-ACT-GES-CRF.
           MOVE SPACES TO WSS-IND-OKS IN WSS-VARI.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GES.
           IF NOT FIO-STAT-OKS
      *ME SALGO CON ERROR
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               MOVE 'CRFERRORGES' TO MSG-COD-MENS
               GO TO FIN-ACT-GES-CRF.
           MOVE WSS-POR-COBE IN WSS-VARI TO GES-SGV-PLCR IN GES.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM BGL-FIO-GES.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               MOVE 'CRFERRORGES' TO MSG-COD-MENS
               GO TO FIN-ACT-GES-CRF.
           MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI.
       FIN-ACT-GES-CRF.
           EXIT.
      *-------------------------------------------------------------
       BUS-POR-COBE SECTION.
       INI-BUS-POR-COBE.
           MOVE SPACES TO WSS-IND-OKS IN WSS-VARI.
           MOVE SPACES TO WSS-COD-TPGC IN WSS-VARI.
           IF  WSS-IND-PORG = 'D'
      *SEGUN CODIGO DE DESTINO
                MOVE WSS-COD-TIPO IN WSS-VARI TO
                                     WSS-TIP-PROD IN WSS-VARI
                MOVE OPC-COD-CDOC IN OPC TO WSS-COD-DES IN WSS-VARI
                GO TO BUS-GAR-POR.
           IF  WSS-IND-PORG = 'G'
      *SEGUN CONDICION DE GARANTIA
                MOVE WSS-COD-TIPO IN WSS-VARI TO
                                     WSS-TIP-PROD IN WSS-VARI
                MOVE OPC-IND-GARA IN OPC TO WSS-COD-GARA IN WSS-VARI
                GO TO BUS-GAR-POR.
           IF WSS-IND-PORG = 'A'
      *SEGUN CODIGO DESTINO + CONDICION DE GARANTIA
                MOVE WSS-COD-TIPO IN WSS-VARI TO
                                     WSS-TIP-PROD IN WSS-VARI
                MOVE OPC-COD-CDOC IN OPC TO WSS-COD-DES IN WSS-VARI
                MOVE OPC-IND-GARA IN OPC TO WSS-COD-GARA IN WSS-VARI
                GO TO BUS-GAR-POR
           ELSE
                MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
                MOVE 'INDCRFNOEXI' TO MSG-COD-MENS
                GO TO FIN-BUS-POR-COBE.
       BUS-GAR-POR.
           MOVE 'TAB' TO FIO-SIST.
           MOVE 'PGC' TO TAB-COD-TTAB.
           MOVE WSS-COD-TPGC IN WSS-VARI TO TAB-COD-CTAB.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
               MOVE SPACES  TO WSS-IND-OKS IN WSS-VARI
               MOVE 'PORCOBNOEXI' TO MSG-COD-MENS
               GO TO FIN-BUS-POR-COBE
           ELSE
               MOVE TAB-GLS-DATA IN TAB(1:3) TO
                                          WSS-POR-COBE IN WSS-VARI.
           IF WSS-POR-COBE IN WSS-VARI NOT NUMERIC
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               MOVE 'PGCNONUM' TO MSG-COD-MENS
               GO TO FIN-BUS-POR-COBE.
           IF WSS-POR-COBE IN WSS-VARI > 100
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               MOVE 'PGCMAYO100' TO MSG-COD-MENS
               GO TO FIN-BUS-POR-COBE.
           MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI.
       FIN-BUS-POR-COBE.
           EXIT.
      *------------------------------------------------------------
       DET-PRO-FOGA-COL SECTION.
       INI-DET-PRO-FOGA-COL.
           MOVE SPACES  TO WSS-IND-OKS IN WSS-VARI.
           MOVE 'N'     TO WSS-OPC-FOGA IN WSS-VARI.
           MOVE 'COL'               TO FIO-SIST.
           MOVE 'GARA'              TO MSC-COD-TMSC IN MSC.
           MOVE OPC-IND-GARA IN OPC TO MSC-COD-CMSC IN MSC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT (FIO-STAT-OKS AND MSC-IND-VIGE IN MSC = 'S')
               GO TO FIN-DET-PRO-FOGA-COL.
           IF MSC-GLS-DATA IN MSC(60:1) NOT = 'F'
               GO TO FIN-DET-PRO-FOGA-COL.
           MOVE 'COL'               TO TAB-COD-SIST FIO-SIST.
           MOVE 'DES'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-CDOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
               IF (TAB-GLS-DATA IN TAB(60:1) = 'K' OR
                TAB-GLS-DATA IN TAB(60:1) = 'I')
      *AFRI-INI/JUL2012    GARANTIAS ESTATALES
                 PERFORM DET-VAL-GTIA-FOG
                 IF VAL-IND-VALI IN VAL-VARI = 'N'
                     GO TO FIN-DET-PRO-FOGA-COL
                 ELSE
      *AFRI-FIN/JUL2012    GARANTIAS ESTATALES
                  MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI
                  MOVE 'S' TO WSS-OPC-FOGA IN WSS-VARI.
       FIN-DET-PRO-FOGA-COL.
           EXIT.
      *------------------------------------------------------------
       DET-PRO-CORFO-COL SECTION.
       INI-DET-PRO-CORFO-COL.
           MOVE SPACES  TO WSS-IND-OKS IN WSS-VARI.
           MOVE 'COL'  TO FIO-SIST.
           MOVE 'CRF' TO TAB-COD-TTAB.
           MOVE OPC-COD-COOC IN OPC TO TAB-COD-CTAB.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
               PERFORM DET-COG-CORFO-COL
               GO TO FIN-DET-PRO-CORFO-COL.
      *ES UN PRODUCTO CORFO
           MOVE TAB-GLS-DATA IN TAB(31:3) TO WSS-COD-TIPO IN WSS-VARI.
           MOVE TAB-GLS-DATA IN TAB(1:1) TO WSS-IND-PORG IN WSS-VARI.
      *AFRI-INI/JUL2012    GARANTIAS ESTATALES
           MOVE TAB-GLS-DATA IN TAB(34:3) TO VAL-COD-TOPE IN VAL-VARI.
           MOVE TAB-GLS-DATA IN TAB(37:3) TO VAL-COD-SOPE IN VAL-VARI.
           PERFORM DET-VAL-GTIA-CRF.
           IF VAL-IND-VALI IN VAL-VARI = 'N'
               GO TO FIN-DET-PRO-CORFO-COL.
      *AFRI-FIN/JUL2012    GARANTIAS ESTATALES
           MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI.
       FIN-DET-PRO-CORFO-COL.
           EXIT.
       DET-COG-CORFO-COL SECTION.
       INI-DET-COG-CORFO-COL.
           MOVE 'TAB'  TO FIO-SIST.
           MOVE 'CGC' TO TAB-COD-TTAB.
           MOVE OPC-IND-GARA IN OPC TO TAB-COD-CTAB.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
               MOVE SPACES TO WSS-IND-OKS IN WSS-VARI
               GO TO FIN-DET-COG-CORFO-COL.
      *ES UN PRODUCTO CORFO
           MOVE TAB-GLS-DATA IN TAB(31:3) TO WSS-COD-TIPO IN WSS-VARI.
           MOVE TAB-GLS-DATA IN TAB(1:1) TO WSS-IND-PORG IN WSS-VARI.
      *AFRI-INI/JUL2012    GARANTIAS ESTATALES
           MOVE TAB-GLS-DATA IN TAB(34:3) TO VAL-COD-TOPE IN VAL-VARI.
           MOVE TAB-GLS-DATA IN TAB(37:3) TO VAL-COD-SOPE IN VAL-VARI.
           PERFORM DET-VAL-GTIA-CRF.
           IF VAL-IND-VALI IN VAL-VARI = 'N'
               GO TO FIN-DET-PRO-CORFO-COL.
      *AFRI-FIN/JUL2012    GARANTIAS ESTATALES
           MOVE 'OK' TO WSS-IND-OKS IN WSS-VARI.
       FIN-DET-COG-CORFO-COL.
           EXIT.
      *------------------------------------------------------------
       OBT-OPE-ORI SECTION.
       INI-OBT-OPE-ORI.
      *OBTIENE OPC ORIGINAL

      *    LIMPIA VARIABLES
           MOVE SPACES TO WSS-CIC-ORIG IN BDO-VARI.
           MOVE SPACES TO WSS-CIC-PROR IN BDO-VARI.

      *    BUSCA OPC
           MOVE WSS-CIC-IOPC  IN BDO-VARI   TO OPC-CIC-IOPC IN OPC
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM COL-FIO-OPC
           IF NOT FIO-STAT-OKS
               GO TO FIN-OBT-OPE-ORI.

      *    OPC-IND-RENO = SPACES => OPC ORIG
           IF OPC-IND-RENO IN OPC NOT > SPACES
               MOVE WSS-CIC-IOPC IN BDO-VARI TO WSS-CIC-ORIG IN BDO-VARI
               GO TO FIN-OBT-OPE-ORI.

      *    OPC-IND-RENO = 'PRO' => PRORROGA
           IF OPC-IND-RENO IN OPC = 'PRO'
               MOVE SPACES TO ROV
               MOVE WSS-CIC-IOPC IN BDO-VARI  TO ROV-CIC-IOPC IN ROV
               MOVE SPACES TO ROV-CIC-IOPV IN ROV
               MOVE ZEROES TO ROV-NUM-IVCT IN ROV
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM COL-FIO-ROV
               IF NOT ( FIO-STAT-OKS AND
                   WSS-CIC-IOPC IN BDO-VARI = ROV-CIC-IOPC IN ROV )
                   MOVE SPACES TO ROV
                   GO TO FIN-OBT-OPE-ORI
               ELSE
                   MOVE ROV-CIC-IOPV IN ROV TO WSS-CIC-PROR IN BDO-VARI
                   MOVE OPC-CIC-IOPC IN OPC TO WSS-CIC-ORIG IN BDO-VARI
                   MOVE 'N' TO BDO-1 IN BDO-VARI
                   GO TO FIN-OBT-OPE-ORI.

           MOVE SPACES TO ROV.
           MOVE SPACES TO WSS-CIC-ORIG IN BDO-VARI.
           MOVE SPACES TO BDO-1        IN BDO-VARI.
       NXT-OBT-OPE-ORI.
           MOVE WSS-CIC-IOPC IN BDO-VARI  TO ROV-CIC-IOPC IN ROV.
           MOVE ROV-CIC-IOPC IN ROV       TO WSS-COD-OPCR IN BDO-VARI.
       LUP-OBT-OPE-ORI.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF NOT ( FIO-STAT-OKS AND
                    WSS-COD-OPCR  = ROV-CIC-IOPC IN ROV )
              MOVE SPACES TO ROV
              GO TO FIN-OBT-OPE-ORI.

           IF BDO-1 IN BDO-VARI = SPACES
              MOVE ROV-CIC-IOPV IN ROV TO  WSS-CIC-ORIG IN BDO-VARI
              MOVE  'N'                TO  BDO-1 IN BDO-VARI.
      *
           MOVE ROV-CIC-IOPC IN ROV TO DLC-CIC-IOPC IN DLC.
           MOVE 001                 TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
              GO TO FIN-OBT-OPE-ORI.

           IF ( DLC-IND-SCTB IN DLC = SPACES OR 'MUL' )
                 MOVE ROV-CIC-IOPC IN ROV TO  WSS-CIC-ORIG IN BDO-VARI
                 MOVE SPACES TO ROV
                 GO TO FIN-OBT-OPE-ORI.
      *
           MOVE ROV-CIC-IOPV IN ROV TO DLC-CIC-IOPC IN DLC.
           MOVE ROV-CIC-IOPV IN ROV TO WSS-COD-OPCR IN BDO-VARI.
           MOVE 001                 TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
              GO TO FIN-OBT-OPE-ORI.

           MOVE ROV-CIC-IOPV IN ROV TO  WSS-CIC-ORIG IN BDO-VARI.
           IF ( DLC-IND-SCTB IN DLC = SPACES OR 'MUL' )
                 MOVE ROV-CIC-IOPV IN ROV TO  WSS-CIC-ORIG IN BDO-VARI
                 MOVE SPACES TO ROV
                 GO TO FIN-OBT-OPE-ORI
           ELSE
              MOVE SPACES TO ROV
              MOVE WSS-COD-OPCR TO ROV-CIC-IOPC IN ROV
              GO TO LUP-OBT-OPE-ORI.

       FIN-OBT-OPE-ORI.
           EXIT.
      *-----------------------------------------------------
       OBT-SAL-OPC SECTION.
       INI-OBT-SAL-OPC.

      *    INICIALIZO VARIABLES:
           MOVE ZEROES TO WSS-VAL-SCRE IN BDO-VARI.
           MOVE SPACES TO WSS-COD-ERRO IN BDO-VARI.
           MOVE SPACES TO WSS-GLS-STAT IN BDO-VARI.
           MOVE SPACES TO WSS-IND-SCTB IN BDO-VARI.
           MOVE SPACES TO WSS-CIC-IOPE IN BDO-VARI.
           MOVE SPACES TO VECTOR-OPC.

      *    BUSCO VCAM PESO
           PERFORM BUS-PESO.
           IF (WSS-COD-PESO IN BDO-VARI NOT > SPACES)
                MOVE 'VCAM NOEX' TO WSS-COD-ERRO IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           MOVE WSS-CIC-IOPC IN BDO-VARI TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF (NOT FIO-STAT-OKS)
                MOVE 'OPC  INEX' TO WSS-COD-ERRO IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           MOVE OPC-VAL-CRED IN OPC TO WSS-VAL-CRED IN BDO-VARI.
           MOVE OPC-IND-VSTR IN OPC TO WSS-IND-VSTR IN BDO-VARI.
           MOVE OPC-VAL-SCRE IN OPC TO WSS-VAL-SCRE IN BDO-VARI.
           MOVE OPC-COD-VCOC IN OPC TO WSS-COD-VCOC IN BDO-VARI.
           MOVE OPC-NUM-VCOR IN OPC TO WSS-NUM-CTOT IN BDO-VARI.
           MOVE OPC-FEC-FCOL IN OPC TO WSS-FEC-FCAM IN BDO-VARI.

           IF (OPC-MSC-STAT IN OPC NOT = 'A')
                MOVE 'OPC NOACA' TO WSS-COD-ERRO IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           MOVE OPC TO OPC-RES.

           PERFORM OBT-EST-OPC.

           PERFORM BUS-SAL-OPC.


           COMPUTE WSS-VAL-SCRE IN BDO-VARI =
                   WSS-VAL-CRED IN BDO-VARI -
                   WSS-CAN-SCRE IN BDO-VARI.

           IF WSS-VAL-CRED IN BDO-VARI NOT > ZEROES
               MOVE ZEROES TO WSS-VAL-SCRE IN BDO-VARI
               GO TO FIN-OBT-SAL-OPC.

           IF (WSS-VAL-SCRE IN BDO-VARI NOT > ZEROES)
                MOVE ZEROES TO WSS-VAL-SCRE IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           IF (WSS-NUM-CTOT IN BDO-VARI NOT > WSS-CAN-IVCT)
                MOVE 'CTOT<IVCT' TO WSS-COD-ERRO IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           IF (WSS-IND-ICTT IN BDO-VARI = 'S')
                MOVE ZEROES  TO WSS-VAL-SCRE IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           COMPUTE WSS-NUM-IVEN IN BDO-VARI =
                   WSS-CAN-IVCT IN BDO-VARI + 1.

           COMPUTE WSS-NUM-CPEN IN BDO-VARI =
                   WSS-NUM-CTOT IN BDO-VARI - WSS-CAN-IVCT IN BDO-VARI.

           MOVE WSS-CAN-IVCT IN BDO-VARI TO WSS-NUM-VPAG IN BDO-VARI.
       FIN-OBT-SAL-OPC.
           EXIT.
      *-----------------------------------------------------
       BUS-PESO SECTION.
       INI-BUS-PESO.
      *OBTIENE CODIGO VALOR DE CAMBIO DE PESOS

           MOVE SPACES         TO WSS-COD-PESO IN BDO-VARI.
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN BDO-VARI.

       FIN-BUS-PESO.
           EXIT.
      *-----------------------------------------------------
       OBT-EST-OPC SECTION.
       INI-OBT-EST-OPC.

           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE 1                   TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF (NOT FIO-STAT-OKS)
                GO TO FIN-OBT-EST-OPC.

           IF (WSS-IND-SCTB IN BDO-VARI = 'CAS'  OR
               DLC-IND-SCTB IN DLC      = 'CAS')
                MOVE 'CAS' TO WSS-GLS-STAT IN BDO-VARI
                GO TO FIN-OBT-EST-OPC.

           IF (WSS-IND-SCTB IN BDO-VARI = 'VCD' OR
               DLC-IND-SCTB IN DLC      = 'VCD')
                MOVE 'VCD' TO WSS-GLS-STAT IN BDO-VARI
                GO TO FIN-OBT-EST-OPC.

           IF (WSS-IND-SCTB IN BDO-VARI = 'MOR' OR 'MUL')
                GO TO FIN-OBT-EST-OPC.

           IF (WSS-IND-SCTB IN BDO-VARI = 'VIG')
                GO TO FIN-OBT-EST-OPC.

       FIN-OBT-EST-OPC.
           EXIT.
      *-----------------------------------------------------
       BUS-SAL-OPC SECTION.
       INI-BUS-SAL-OPC.
      *BUSCA SALDO REAL DE OPC

           MOVE ZEROES       TO WSS-NUM-IVEN IN BDO-VARI.
           MOVE ZEROES       TO WSS-CAN-SCRE IN BDO-VARI.
           MOVE ZEROES       TO WSS-VAL-CAPI IN BDO-VARI.
           MOVE SPACES       TO WSS-IND-ICTT IN BDO-VARI.
           MOVE ZEROES       TO WSS-NUM-IVEN IN BDO-VARI.

      *COMIENZA EL PROCESO
           MOVE WSS-CIC-IOPC IN BDO-VARI TO CAN-CIC-IOPC IN CAN.
           MOVE ZEROES                   TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-NLS              TO FIO-CMND.
       LUP-SAL-OPC.
           PERFORM COL-FIO-CAN.
           IF (NOT FIO-STAT-OKS OR
               WSS-CIC-IOPC IN BDO-VARI NOT = CAN-CIC-IOPC IN CAN)
                GO TO FIN-BUS-SAL-OPC
           ELSE
                MOVE ADR-CAN-REQA TO ADR-BDO-REQA.

           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO NXT-SAL-OPC.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                GO TO NXT-SAL-OPC.

           IF CAN-FEC-FCAN IN CAN > WSS-FEC-FPRO IN BDO-VARI
                GO TO FIN-BUS-SAL-OPC.

      *    VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                PERFORM BUS-CAPI
                ADD WSS-VAL-CAPI IN BDO-VARI TO WSS-CAN-SCRE IN BDO-VARI
                MOVE 'S' TO WSS-IND-ICTT IN BDO-VARI
                GO TO FIN-BUS-SAL-OPC.

      *    VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                PERFORM BUS-CAPI
                ADD WSS-VAL-CAPI IN BDO-VARI TO WSS-CAN-SCRE IN BDO-VARI
                GO TO NXT-SAL-OPC.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                PERFORM BUS-CAPI
                ADD WSS-VAL-CAPI IN BDO-VARI TO WSS-CAN-SCRE IN BDO-VARI
                COMPUTE WSS-CAN-IVCT IN BDO-VARI =
                        WSS-CAN-IVCT IN BDO-VARI - 1
                GO TO NXT-SAL-OPC.

      *    VALIDO TIPO DE CANCELACION: PRORROGA
           IF (CAN-MSC-CANC IN CAN = 'PTT' OR 'KTT')
                PERFORM BUS-CAPI
                MOVE WSS-VAL-CAPI IN BDO-VARI TO
                     WSS-VAL-CRED IN BDO-VARI
                PERFORM BUS-SAL-PTT
                GO TO FIN-BUS-SAL-OPC.

      *    VALIDA SI CANCELACION ES PRODUCTO DE TRASPASO
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-CYA.

      *    SIN CYA => CAN NO TRASPASO
           IF NOT (FIO-STAT-OKS AND
               CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
               CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA)
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    MOVE ZEROES TO WSS-VAL-CRED IN BDO-VARI
                    GO TO FIN-BUS-SAL-OPC
                ELSE
                    PERFORM BUS-CAPI
                    ADD WSS-VAL-CAPI IN BDO-VARI TO
                        WSS-CAN-SCRE IN BDO-VARI
                    GO TO NXT-SAL-OPC.

      *--------- PRODUCTO TRASPASO ---------
           MOVE CYA-IND-TCYA IN CYA TO WSS-COD-TCYA IN BDO-VARI.

      *    CAN NO PRODUCTO TRASPASO
           IF (WSS-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND
               WSS-GLS-TCYA IN BDO-VARI  NOT = 'PB')
                ADD 1 TO WSS-NUM-VPAG IN BDO-VARI
                ADD 1 TO WSS-CAN-IVCT IN BDO-VARI
                IF (CAN-MSC-CANC IN CAN = 'RTT')
                     MOVE ZEROES TO WSS-VAL-CRED IN BDO-VARI
                     GO TO FIN-BUS-SAL-OPC
                ELSE
                    PERFORM BUS-CAPI
                    ADD WSS-VAL-CAPI IN BDO-VARI TO
                        WSS-CAN-SCRE IN BDO-VARI
                    GO TO NXT-SAL-OPC.

      *    CAN    PRODUCTO TRASPASO
           IF (WSS-GLS-TCYA IN BDO-VARI  = 'TR' OR
               WSS-GLS-TCYA IN BDO-VARI  = 'PB')
                ADD 1 TO WSS-NUM-CTRS IN BDO-VARI
                PERFORM BUS-NEW-CAN
      *         NUEVA OPERACION IMPAGA
                IF (WSS-IND-CANC IN BDO-VARI NOT = 'S')
                     ADD WSS-ACU-CAPI IN BDO-VARI TO
                         WSS-CAN-SCRE IN BDO-VARI
                     GO TO FIN-BUS-SAL-OPC
      *         NUEVA OPERACION CANCELADA
                ELSE
                     MOVE WSS-RES-IVCT TO WSS-CAN-IVCT IN BDO-VARI
                     ADD WSS-RES-CAPI IN BDO-VARI TO
                         WSS-CAN-SCRE IN BDO-VARI
                     GO TO NXT-SAL-OPC.

       NXT-SAL-OPC.
           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE ADR-BDO-REQA TO ADR-CAN-REQA.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           GO TO LUP-SAL-OPC.

       FIN-BUS-SAL-OPC.
           EXIT.
      *-----------------------------------------------------
       BUS-CAPI SECTION.
       INI-BUS-CAPI.

           MOVE ZEROES              TO WSS-VAL-CAPI IN BDO-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)
               ADD ZEROES           TO WSS-VAL-CAPI IN BDO-VARI
               GO TO FIN-BUS-CAPI.

           IF (CAN-MSC-CANC IN CAN = 'KTT')
               MOVE RCV-NUM-IVCT IN RCV TO WSS-CAN-IVCT IN BDO-VARI
               MOVE CAN-SGV-TREN IN CAN  TO
                     WSS-VAL-CAPI IN BDO-VARI
               IF GDG-COD-VCAM IN GDG NOT = '0999  '
                   PERFORM OBT-CIC-MONE
                   IF WSS-IND-OKS IN WSS-VARI NOT = 'OK'
                       GO TO FIN-BUS-CAPI
                   ELSE
                       PERFORM OBT-VAL-CAMB
                       IF WSS-IND-OKS IN WSS-VARI NOT = 'OK'
                          GO TO FIN-BUS-CAPI
                       ELSE
                           COMPUTE WSS-VAL-CAPI IN BDO-VARI =
                                  WSS-VAL-CAPI IN BDO-VARI /
                                  WSS-VAL-CAMB IN WSS-VARI
                           GO TO FIN-BUS-CAPI
               ELSE
                   GO TO FIN-BUS-CAPI.

           IF (CAN-MSC-CANC IN CAN = 'PTT')
                IF (CAN-SGV-TPAG IN CAN > ZEROES)
                       GO TO CAL-NEW-CAPI
                ELSE
                    ADD  RCV-SGV-CAPI IN RCV TO WSS-VAL-CAPI IN BDO-VARI
                    MOVE RCV-NUM-IVCT IN RCV TO WSS-CAN-IVCT IN BDO-VARI
                    GO TO FIN-BUS-CAPI
           ELSE
               ADD  RCV-SGV-CAPI IN RCV TO WSS-VAL-CAPI IN BDO-VARI
               MOVE RCV-NUM-IVCT IN RCV TO WSS-CAN-IVCT IN BDO-VARI
               GO TO FIN-BUS-CAPI.

       CAL-NEW-CAPI.

           IF ((RCV-SGV-INTM IN RCV > ZEROES OR
              CAN-SGV-IMOK IN CAN > ZEROES) AND
              CAN-SGV-TPAG IN CAN > ZEROES)
               COMPUTE CAN-SGV-TPAG IN CAN =
                CAN-SGV-TPAG IN CAN - RCV-SGV-INTM IN RCV -
                CAN-SGV-IMOK IN CAN.

           IF (RCV-SGV-INTN IN RCV > ZEROES AND
               CAN-SGV-TPAG IN CAN > ZEROES)
                COMPUTE CAN-SGV-TPAG IN CAN =
                     CAN-SGV-TPAG IN CAN - RCV-SGV-INTN IN RCV.

           IF (CAN-SGV-COMI IN CAN > ZEROES AND
               CAN-SGV-TPAG IN CAN > ZEROES)
                COMPUTE CAN-SGV-TPAG IN CAN =
                     CAN-SGV-TPAG IN CAN - CAN-SGV-COMI IN CAN.

           IF CAN-SGV-GAST IN CAN > ZEROES AND
              CAN-SGV-TPAG IN CAN > ZEROES
               COMPUTE CAN-SGV-TPAG IN CAN = CAN-SGV-TPAG IN CAN -
                                         CAN-SGV-GAST IN CAN.

           COMPUTE WSS-VAL-CAPI IN BDO-VARI =
                   RCV-SGV-CAPI IN RCV - CAN-SGV-TPAG IN CAN.
           MOVE RCV-NUM-IVCT IN RCV TO WSS-CAN-IVCT IN BDO-VARI.
           GO TO FIN-BUS-CAPI.

       FIN-BUS-CAPI.
           EXIT.
      *-----------------------------------------------------
       BUS-SAL-PTT SECTION.
       INI-BUS-SAL-PTT.
      *BUSCA SALDO REAL DE OPC (PTT)

           MOVE ZEROES       TO WSS-NUM-IVEN IN BDO-VARI.
           MOVE ZEROES       TO WSS-CAN-SCRE IN BDO-VARI.
           MOVE ZEROES       TO WSS-VAL-CAPI IN BDO-VARI.
           MOVE SPACES       TO WSS-IND-ICTT IN BDO-VARI.
           MOVE ZEROES       TO WSS-NUM-IVEN IN BDO-VARI.

      *    BUSCA NUEVA OPERACION
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF NOT (FIO-STAT-OKS AND
               GES-CIC-IOPC IN GES = ROV-CIC-IOPC IN ROV)
                MOVE GES-CIC-IOPC IN GES TO OPC-CIC-IOPC IN OPC
           ELSE
                MOVE ROV-CIC-IOPV IN ROV TO OPC-CIC-IOPC IN OPC.

      *    MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
      *    MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
      *    MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
      *    MOVE FIO-GET-KEY         TO FIO-CMND.
      *    PERFORM COL-FIO-ROV.
      *    IF (NOT FIO-STAT-OKS)
      *          GO TO FIN-BUS-SAL-PTT.

      *    MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF (NOT FIO-STAT-OKS)
                MOVE 'PTT  INEX' TO WSS-COD-ERRO IN BDO-VARI
                GO TO FIN-BUS-SAL-PTT.

           MOVE OPC-IND-VSTR IN OPC TO WSS-IND-VSTR IN BDO-VARI.
           MOVE OPC-COD-VCOC IN OPC TO WSS-COD-VCOC IN BDO-VARI.
           MOVE OPC-COD-VCOC IN OPC TO WSS-NUM-CTOT IN BDO-VARI.
           MOVE OPC-FEC-FCOL IN OPC TO WSS-FEC-FCAM IN BDO-VARI.

           IF (OPC-MSC-STAT IN OPC NOT = 'A')
                MOVE 'PTT NOACA' TO WSS-COD-ERRO IN BDO-VARI
                GO TO FIN-BUS-SAL-PTT.

           MOVE OPC TO OPC-RES.
           PERFORM OBT-EST-OPC.

      *COMIENZA EL PROCESO
           MOVE OPC-CIC-IOPC IN OPC      TO CAN-CIC-IOPC IN CAN.
           MOVE ZEROES                   TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-NLS              TO FIO-CMND.
       LUP-SAL-PTT.
           PERFORM COL-FIO-CAN.
           IF (NOT FIO-STAT-OKS OR
               OPC-CIC-IOPC IN OPC NOT = CAN-CIC-IOPC IN CAN)
                GO TO FIN-BUS-SAL-PTT
           ELSE
                MOVE ADR-CAN-REQA TO ADR-PTT-REQA.

           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO NXT-SAL-PTT.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                GO TO NXT-SAL-PTT.

           IF CAN-FEC-FCAN IN CAN > WSS-FEC-FPRO IN BDO-VARI
                GO TO FIN-BUS-SAL-PTT.

      *    VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                PERFORM BUS-CAPI
                ADD WSS-VAL-CAPI IN BDO-VARI TO WSS-CAN-SCRE IN BDO-VARI
                MOVE 'S' TO WSS-IND-ICTT IN BDO-VARI
                GO TO FIN-BUS-SAL-PTT.

      *    VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                PERFORM BUS-CAPI
                ADD WSS-VAL-CAPI IN BDO-VARI TO WSS-CAN-SCRE IN BDO-VARI
                GO TO NXT-SAL-PTT.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                PERFORM BUS-CAPI
                ADD WSS-VAL-CAPI IN BDO-VARI TO WSS-CAN-SCRE IN BDO-VARI
                COMPUTE WSS-CAN-IVCT IN BDO-VARI =
                        WSS-CAN-IVCT IN BDO-VARI - 1
                GO TO NXT-SAL-PTT.

      *    VALIDO TIPO DE CANCELACION: PRORROGA
           IF (CAN-MSC-CANC IN CAN = 'PTT' OR 'KTT')
                PERFORM BUS-CAPI
                MOVE WSS-VAL-CAPI IN BDO-VARI TO
                     WSS-VAL-CRED IN BDO-VARI
                GO TO INI-BUS-SAL-PTT.

      *    VALIDA SI CANCELACION ES PRODUCTO DE TRASPASO
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-CYA.

      *    SIN CYA => CAN NO TRASPASO
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = CYA-CIC-IOPC IN CYA OR
               CAN-NUM-ICAN IN CAN NOT = CYA-NUM-ICAN IN CYA)
                PERFORM BUS-CAPI
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    GO TO INI-BUS-SAL-PTT
               ELSE
                    ADD WSS-VAL-CAPI IN BDO-VARI TO
                        WSS-CAN-SCRE IN BDO-VARI
                GO TO NXT-SAL-PTT.


      *--------- PRODUCTO TRASPASO ---------
           MOVE CYA-IND-TCYA IN CYA TO WSS-COD-TCYA IN BDO-VARI.

      *    CAN NO PRODUCTO TRASPASO
           IF (WSS-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND
               WSS-GLS-TCYA IN BDO-VARI  NOT = 'PB')
                ADD 1 TO WSS-CAN-IVCT IN BDO-VARI
                PERFORM BUS-CAPI
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    GO TO INI-BUS-SAL-PTT
               ELSE
                    ADD WSS-VAL-CAPI IN BDO-VARI TO
                        WSS-CAN-SCRE IN BDO-VARI
                GO TO NXT-SAL-PTT.

      *    CAN    PRODUCTO TRASPASO
           IF (WSS-GLS-TCYA IN BDO-VARI  = 'TR' OR
               WSS-GLS-TCYA IN BDO-VARI  = 'PB')
                ADD 1 TO WSS-NUM-CTRS IN BDO-VARI
                PERFORM BUS-NEW-CAN
      *         NUEVA OPERACION IMPAGA
                IF (WSS-IND-CANC IN BDO-VARI NOT = 'S')
                     ADD WSS-ACU-CAPI IN BDO-VARI TO
                         WSS-CAN-SCRE IN BDO-VARI
                     GO TO FIN-BUS-SAL-PTT
      *         NUEVA OPERACION CANCELADA
                ELSE
                     MOVE WSS-RES-IVCT TO WSS-CAN-IVCT IN BDO-VARI
                     ADD WSS-RES-CAPI IN BDO-VARI TO
                         WSS-CAN-SCRE IN BDO-VARI
                     GO TO NXT-SAL-PTT.

       NXT-SAL-PTT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE ADR-PTT-REQA TO ADR-CAN-REQA.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           GO TO LUP-SAL-PTT.

       FIN-BUS-SAL-PTT.
           EXIT.
      *-----------------------------------------------------
       BUS-NEW-CAN SECTION.
       INI-BUS-NEW-CAN.

           MOVE 'N'    TO WSS-IND-CANC IN BDO-VARI.
           MOVE ZEROES TO WSS-ACU-INTN IN BDO-VARI.
           MOVE ZEROES TO WSS-ACU-CAPI IN BDO-VARI.

           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)
                 GO TO FIN-BUS-NEW-CAN.
           MOVE RCV-SGV-CAPI IN RCV TO WSS-RES-CAPI IN BDO-VARI.
           MOVE RCV-SGV-INTM IN RCV TO WSS-RES-INTM IN BDO-VARI.
           MOVE RCV-NUM-IVCT IN RCV TO WSS-RES-IVCT IN BDO-VARI.

           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                 GO TO FIN-BUS-NEW-CAN.

      *    CAMBIA INTERESES NORMALES A MONEDA OPERACION
           MOVE RCV-SGV-INTN IN RCV TO WSS-INI-INTN IN BDO-VARI.
           PERFORM  CAL-CAM-INTN.
           MOVE WSS-CAM-INTN  TO WSS-RES-INTN IN BDO-VARI.
           MOVE WSS-CAM-INTN  TO WSS-VAL-SINT IN BDO-VARI.

       LUP-NEW-CAN.
      *--------- BUSCA NUEVA OPERACION -----
           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPC IN ROV.

           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV
                MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV
                MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.

           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-ROV.

           IF (NOT FIO-STAT-OKS OR
               (CAN-MSC-TCAN IN CAN = 'P' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPC IN ROV) OR
               (CAN-MSC-TCAN IN CAN = 'R' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPV IN ROV))
                 GO TO FIN-BUS-NEW-CAN.

           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC-RES
                MOVE ROV-CIC-IOPC IN ROV TO RCV-CIC-IOPV IN RCV.

           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE ROV-CIC-IOPV IN ROV TO OPC-CIC-IOPC IN OPC-RES
                MOVE ROV-CIC-IOPV IN ROV TO RCV-CIC-IOPV IN RCV.

       LUP-OPC.
           MOVE OPC-CIC-IOPC IN OPC-RES TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.

           IF NOT FIO-STAT-OKS
               GO TO FIN-BUS-NEW-CAN.

           IF (OPC-MSC-STAT IN OPC NOT = 'A')
               GO TO FIN-BUS-NEW-CAN.

           PERFORM OBT-EST-OPC.


           MOVE OPC-CIC-IOPC IN OPC TO CAN-CIC-IOPC IN CAN.
           MOVE ZEROES              TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-CAN-TRV.
           PERFORM COL-FIO-CAN.
           IF (NOT FIO-STAT-OKS  OR
               OPC-CIC-IOPC IN OPC NOT = CAN-CIC-IOPC IN CAN)
                GO TO FIN-BUS-NEW-CAN.

           IF CAN-FEC-FCAN IN CAN > WSS-FEC-FPRO IN BDO-VARI
                GO TO FIN-BUS-NEW-CAN.

      *   VALIDO CANCELACION ACTIVA
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO LUP-CAN-TRV.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO LUP-CAN-TRV.

      *   VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                MOVE 'S' TO WSS-IND-CANC IN BDO-VARI
                GO TO FIN-BUS-NEW-CAN.

      *   VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                MOVE 'S' TO WSS-IND-CANC IN BDO-VARI
                GO TO FIN-BUS-NEW-CAN.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                PERFORM BUS-CAPI-TRV
                COMPUTE WSS-NUM-IVCT IN BDO-VARI =
                        WSS-RES-IVCT IN BDO-VARI - 1
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO LUP-CAN-TRV.

           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = CYA-CIC-IOPC IN CYA OR
               CAN-NUM-ICAN IN CAN NOT = CYA-NUM-ICAN IN CYA)
                GO TO INI-BUS-NEW-CAN.

           MOVE CYA-IND-TCYA IN CYA TO WSS-COD-TCYA IN BDO-VARI.

      *    CAN NO PRODUCTO TRASPASO
           IF (WSS-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND
               WSS-GLS-TCYA IN BDO-VARI  NOT = 'PB')
                GO TO LUP-NEW-CAN.

      *    CAN    PRODUCTO TRASPASO
           IF (WSS-GLS-TCYA IN BDO-VARI  = 'TR' OR
               WSS-GLS-TCYA IN BDO-VARI  = 'PB')
                GO TO LUP-NEW-CAN.

       FIN-BUS-NEW-CAN.
           EXIT.
      *-----------------------------------------------------
       CAL-CAM-INTN SECTION.
       INI-CAL-CAM-INTN.

           IF (WSS-COD-VCOC IN BDO-VARI = WSS-COD-PESO IN BDO-VARI)
                MOVE WSS-INI-INTN IN BDO-VARI TO WSS-CAM-INTN
                GO TO FIN-CAL-CAM-INTN.

           MOVE WSS-COD-VCOC IN BDO-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN BDO-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE WSS-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(2).

           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF (NOT FIO-STAT-OKS OR CAM-IND-VIGE IN CAM NOT = 'S' )
                MOVE ZEROES              TO WSS-CAM-INTN IN BDO-VARI
                GO TO FIN-CAL-CAM-INTN.

           COMPUTE  WSS-CAM-INTN IN BDO-VARI ROUNDED =
                    WSS-INI-INTN IN BDO-VARI /
                    CAM-SGV-VCAM IN CAM.

       FIN-CAL-CAM-INTN.
           EXIT.
      *-----------------------------------------------------
       BUS-CAPI-TRV SECTION.
       INI-BUS-BUS-CAPI-TRV.

           MOVE ZEROES              TO WSS-CAN-INTN IN BDO-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)
                GO TO FIN-BUS-CAPI-TRV.

           IF (RCV-SGV-CAPI IN RCV NOT > ZEROES)
                GO TO FIN-BUS-CAPI-TRV.

           IF WSS-COD-VCOC = OPC-COD-VCOC IN OPC
               MOVE RCV-SGV-CAPI IN RCV TO WSS-SGV-CAPI IN BDO-VARI
           ELSE
               PERFORM CAL-CAM-CAPI.

           IF (WSS-VAL-SINT IN BDO-VARI = WSS-SGV-CAPI IN BDO-VARI)
               MOVE WSS-SGV-CAPI IN BDO-VARI TO WSS-ACU-INTN IN BDO-VARI
               MOVE WSS-SGV-CAPI IN BDO-VARI TO WSS-CAN-INTN IN BDO-VARI
                GO TO VAL-SINT.

           IF (WSS-VAL-SINT IN BDO-VARI < WSS-SGV-CAPI IN BDO-VARI)
               MOVE WSS-RES-INTN IN BDO-VARI TO WSS-ACU-INTN IN BDO-VARI
               MOVE WSS-RES-INTN IN BDO-VARI TO WSS-CAN-INTN IN BDO-VARI
               GO TO VAL-SINT.

           IF (WSS-VAL-SINT IN BDO-VARI > WSS-SGV-CAPI IN BDO-VARI)
                ADD WSS-SGV-CAPI IN BDO-VARI TO WSS-ACU-INTN IN BDO-VARI
               MOVE WSS-SGV-CAPI IN BDO-VARI TO WSS-CAN-INTN IN BDO-VARI
                GO TO VAL-SINT.

       VAL-SINT.
           IF   WSS-VAL-SINT IN BDO-VARI NOT > ZEROES
                 MOVE ZEROES TO WSS-CAN-INTN IN BDO-VARI.

           COMPUTE WSS-VAL-SINT IN BDO-VARI =
                  (WSS-RES-INTN IN BDO-VARI -
                   WSS-ACU-INTN IN BDO-VARI).

           IF   WSS-VAL-SINT IN BDO-VARI NOT > ZEROES
                 MOVE ZEROES TO WSS-VAL-SINT IN BDO-VARI.

       VAL-CAPI.
           COMPUTE WSS-ACU-CAPI IN BDO-VARI =
                   WSS-ACU-CAPI IN BDO-VARI +
                  (WSS-SGV-CAPI IN BDO-VARI  -
                   WSS-CAN-INTN IN BDO-VARI).

       FIN-BUS-CAPI-TRV.
           EXIT.
      *-----------------------------------------------------
       CAL-CAM-CAPI SECTION.
       INI-CAL-CAM-CAPI.

           MOVE ZEROES TO  WSS-SGV-CAPI IN BDO-VARI.

           IF (WSS-COD-VCOC IN BDO-VARI = WSS-COD-PESO IN BDO-VARI)
               MOVE RCV-SGV-CAPI IN RCV TO WSS-SGV-CAPI IN BDO-VARI
                GO TO FIN-CAL-CAM-CAPI.

           MOVE WSS-COD-VCOC IN BDO-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN BDO-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE WSS-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(2).

           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF (NOT FIO-STAT-OKS OR CAM-IND-VIGE IN CAM NOT = 'S' )
                MOVE ZEROES              TO WSS-SGV-CAPI IN BDO-VARI
                GO TO FIN-CAL-CAM-CAPI.

           COMPUTE  WSS-SGV-CAPI IN BDO-VARI ROUNDED =
                    RCV-SGV-CAPI IN RCV /
                    CAM-SGV-VCAM IN CAM.

       FIN-CAL-CAM-CAPI.
           EXIT.
      *-----------------------------------------------------
      *AFRI-FIN 15-SEP-2010 GARANTIAS ESTATALES

       COPY BGLBFGAP.
      *AFRI-INI/JUN2007/CHC  PRELACION
       COPY COLBFDLC.
      *AFRI-FIN/JUN2007/CHC  PRELACION
       COPY BGLBFGDD.
       COPY BGLBFGDG.
       COPY BGLBFGDO.
       COPY BGLBFGDP.
       COPY BGLBFGES.
       COPY BGLBFGIN.
       COPY BGLBFGLE.
       COPY BGLBFGMO.
       COPY BGLBFGSE.
       COPY BGLBFGSI.
       COPY BGLBFGTP.
       COPY BGLBFGUB.
       COPY BGLBFGVT.
       COPY BGLBFTAG.
      *MHM-INI 29-JUL-2003
       COPY BGLBFGVE.
       COPY BGLBFGIM.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
      *MHM-FIN 29-JUL-2003

       COPY GNSBGHOY.
       COPY GNSBGMSG.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
      *AFRI
       COPY BGLBGPNT.
      *AFRI

      *AFRI-INI 15-SEP-2010 GARANTIAS ESTATALES
       COPY GNSBFMSC.
       COPY COLBFOPC.
       COPY COLBFROV.
       COPY COLBFVEN.
       COPY COLBFCAN.
       COPY COLBFCYA.
       COPY COLBFRCV.
       COPY TABBFCAM.
       COPY COLBFICG.
       COPY COLBFTOC.
       COPY COLBFEVC.
       COPY GNSBGPES.
      *AFRI-FIN 15-SEP-2010 GARANTIAS ESTATALES

       BCK-OUT SECTION.
       INI-BCK-OUT.
           MOVE FIO-BCK-OUT TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF FIO-STAT-OKS
               MOVE '49' TO FIO-STAT.
       FIN-BCK-OUT.
           EXIT.

      *FLB CST  13-JUN-1994
       VAL-GDD SECTION.
       INI-VAL-GDD.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE GDG-CAI-GTIA IN GDG TO GDD-CAI-GTIA IN GDD.
           MOVE GDG-IIC-GTIA IN GDG TO GDD-IIC-GTIA IN GDD.
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM BGL-FIO-GDD.
           IF NOT ( FIO-STAT-OKS AND
                    GDG-CAI-GTIA IN GDG = GDD-CAI-GTIA IN GDD AND
                    GDG-IIC-GTIA IN GDG = GDD-IIC-GTIA IN GDD )
               MOVE 'GDD    NEX' TO MSG-COD-MENS
               GO TO BRW-VAL-GDD.
       LUP-VAL-GDD.
           IF GDD-IIC-DCLI IN GDD NOT > ZEROES OR
              GDD-IIC-DCLI IN GDD > '99999999'
               MOVE 'IICICLI=0' TO MSG-COD-MENS
                GO TO BRW-VAL-GDD.

           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM BGL-FIO-GDD.
           IF NOT ( FIO-STAT-OKS AND
                    GDG-CAI-GTIA IN GDG = GDD-CAI-GTIA IN GDD AND
                    GDG-IIC-GTIA IN GDG = GDD-IIC-GTIA IN GDD )
               GO TO BRW-VAL-GDD.
           GO TO LUP-VAL-GDD.
       BRW-VAL-GDD.
           IF FIO-STAT-OKS
               MOVE 'GDD-KEY-AGDD' TO FIO-AKEY
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM BGL-FIO-GDD.
       FIN-VAL-GDD.
           EXIT.

      *AFRI-EVA/MAYO2007  PRELACION
       GDG-GLE SECTION.
       INI-GDG-GLE.
           MOVE GDG-CAI-GTIA IN GDG TO GLE-CAI-GTIA IN GLE.
           MOVE GDG-IIC-GTIA IN GDG TO GLE-IIC-GTIA IN GLE.
           MOVE ZEROES              TO GLE-COD-PACR IN GLE.
           MOVE 'GLE-KEY-IGLE' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-GDG-GLE.
           PERFORM BGL-FIO-GLE.
           IF NOT ((FIO-STAT-OKS) AND
                  GDG-CAI-GTIA IN GDG = GLE-CAI-GTIA IN GLE AND
                  GDG-IIC-GTIA IN GDG = GLE-IIC-GTIA IN GLE)
                  GO TO FIN-GDG-GLE.
      *PVC-INI 18-JUL-2012  BLOQUEAR OPCION DE PANTALLA GLE
           IF GDG-COD-TOPE IN GDG = '952'
               GO TO FIN-GDG-GLE.
      *PVC-FIN 18-JUL-2012
           IF NOT (GLE-COD-FICR IN GLE > SPACES AND
               GLE-COD-FPHG IN GLE > SPACES AND
               GLE-NUM-NICR IN GLE > ZEROES AND
               GLE-NUM-NPHG IN GLE > ZEROES AND
               GLE-NUM-AICR IN GLE > ZEROES AND
               GLE-NUM-APHG IN GLE > ZEROES)
               MOVE 'CAMPOSVACIOS' TO MSG-COD-MENS
               MOVE 'BGL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-GDG-GLE.
       NXT-GDG-GLE.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-GDG-GLE.
       FIN-GDG-GLE.
           EXIT.

       GAP-AGA SECTION.
       INI-GAP-AGA.
           MOVE GDG-CAI-GTIA IN GDG TO GAP-CAI-GTIA IN GAP.
           MOVE GDG-IIC-GTIA IN GDG TO GAP-IIC-GTIA IN GAP.
           MOVE ZEROES              TO GAP-COD-PACR IN GAP.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-GAP-AGA.
           PERFORM BGL-FIO-GAP.
           IF NOT (FIO-STAT-OKS AND
                   GDG-CAI-GTIA IN GDG = GAP-CAI-GTIA IN GAP AND
                   GDG-IIC-GTIA IN GDG = GAP-IIC-GTIA IN GAP)
                   PERFORM GTIA-ESP
                   GO TO FIN-GAP-AGA.

           PERFORM GAP-GLE.
           IF MSG-COD-MENS > SPACES
              GO TO EXT-MAIN.

           IF GDG-COD-LGTA IN GDG = 'A' AND
              GAP-COD-GPRE IN GAP = 'E'
              ADD 1 TO WSS-IND-NESP
              IF GAP-IND-ESBA IN GAP = 'N'
                 PERFORM GAP-ESPECIFICA
                 GO TO NXT-GAP-AGA
              ELSE
                 ADD 1 TO WSS-IND-ESBA
                 PERFORM GAP-ESPECIFICA
                 GO TO NXT-GAP-AGA.

           IF GDG-COD-LGTA IN GDG = 'A' AND
              GAP-COD-GPRE IN GAP = 'G'
              IF GAP-IND-ESBA IN GAP = 'S'
                 ADD 1 TO WSS-IND-GBCI
                 ADD 1 TO WSS-IND-EBCI
                 ADD 1 TO WSS-IND-ESBA
                 ADD 1 TO WSS-IND-SBCI
                 PERFORM GAP-GENERAL
                 GO TO NXT-GAP-AGA
              ELSE
                 GO TO NXT-GAP-AGA.

           IF GDG-COD-LGTA IN GDG = 'E' AND
              GAP-COD-GPRE IN GAP = 'E'
              IF GAP-IND-ESBA IN GAP = 'N'
                 ADD 1 TO WSS-IND-GBCI
                 GO TO NXT-GAP-AGA
              ELSE
                 ADD 1 TO WSS-IND-ESBA
                 ADD 1 TO WSS-IND-GBCI
                 PERFORM GAP-ESPECIFICA
                 GO TO NXT-GAP-AGA.

           IF GDG-COD-LGTA IN GDG = 'E' AND
              GAP-COD-GPRE IN GAP = 'G'
              MOVE 'NO   GAPGNRL' TO MSG-COD-MENS
              MOVE 'BGL' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              GO TO FIN-GAP-AGA.

           IF GDG-COD-LGTA IN GDG = 'G' AND
              GAP-COD-GPRE IN GAP = 'E'
              MOVE 'NO    GAPESP' TO MSG-COD-MENS
              MOVE 'BGL' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              GO TO FIN-GAP-AGA.

           IF GDG-COD-LGTA IN GDG = 'G' AND
              GAP-COD-GPRE IN GAP = 'G'
              IF GAP-IND-ESBA IN GAP = 'N'
                 PERFORM GAP-GENERAL
              ELSE
                 ADD 1 TO WSS-IND-ESBA
                 ADD 1 TO WSS-IND-GBCI
                 ADD 1 TO WSS-IND-SBCI
                 PERFORM GAP-GENERAL.
       NXT-GAP-AGA.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-GAP-AGA.
       FIN-GAP-AGA.
           EXIT.

       GTIA-ESP SECTION.
       INI-GTIA-ESP.
           IF WSS-IND-GBCI > ZEROES
              GO TO NXT-GTIA-ESP
           ELSE
              MOVE 'NO    GAPBCI' TO MSG-COD-MENS
              MOVE 'BGL' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              GO TO FIN-GTIA-ESP.

       NXT-GTIA-ESP.
           IF GDG-COD-LGTA IN GDG NOT = 'A'
              GO TO FIN-GTIA-ESP.
           MOVE GDG-COD-TOPE IN GDG TO TAG-COD-TOPE IN TAG.
           MOVE GDG-COD-SOPE IN GDG TO TAG-COD-SOPE IN TAG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-TAG.
           IF NOT FIO-STAT-OKS
              GO TO FIN-GTIA-ESP.

           IF TAG-NUM-PMAX IN TAG NOT > ZEROES
              GO TO FIN-GTIA-ESP.

           IF WSS-IND-ESBA < TAG-NUM-PMAX IN TAG
              MOVE 'ESBANO=PMAX' TO MSG-COD-MENS
              MOVE 'BGL' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              GO TO FIN-GTIA-ESP.

           IF WSS-IND-ESBA = TAG-NUM-PMAX IN TAG
               PERFORM FIN-GTIA-ESP.

           IF WSS-IND-ESBA > TAG-NUM-PMAX IN TAG
              MOVE 'GAPBCI>PMAX' TO MSG-COD-MENS
              MOVE 'BGL' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              GO TO FIN-GTIA-ESP.

       FIN-GTIA-ESP.
           EXIT.

       GAP-ESPECIFICA SECTION.
       INI-GAP-ESPECIFICA.
           IF GDG-COD-LGTA IN GDG = 'A' AND
              GAP-COD-GPRE IN GAP = 'E' AND
              GAP-IND-ESBA IN GAP = 'N'
              IF WSS-IND-GBCI NOT > ZEROES
                 GO TO FIN-GAP-ESPECIFICA
              ELSE
                 ADD 1 TO WSS-IND-EBCI.

           IF WSS-IND-EBCI NOT > ZEROES
              GO TO CON-GAP-ESPECIFICA
           ELSE
              MOVE 'GAPNOPERESP' TO MSG-COD-MENS
              MOVE 'BGL' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              GO TO FIN-GAP-ESPECIFICA.
       CON-GAP-ESPECIFICA.
           MOVE GAP-CAI-GTIA IN GAP TO GES-CAI-GTIA IN GES.
           MOVE GAP-IIC-GTIA IN GAP TO GES-IIC-GTIA IN GES.
           MOVE ZEROES              TO GES-NUM-IGES IN GES.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-GAP-ESPECIFICA.
           PERFORM BGL-FIO-GES.
           IF NOT (FIO-STAT-OKS AND
              GAP-CAI-GTIA IN GAP = GES-CAI-GTIA IN GES AND
              GAP-IIC-GTIA IN GAP = GES-IIC-GTIA IN GES)
              MOVE 'GAP SIN GES' TO MSG-COD-MENS
              MOVE 'BGL' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              GO TO FIN-GAP-ESPECIFICA.
           IF GAP-COD-PACR IN GAP NOT = GES-COD-PACR IN GES
              GO TO NXT-GAP-ESPECIFICA
           ELSE
              GO TO FIN-GAP-ESPECIFICA.
       NXT-GAP-ESPECIFICA.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-GAP-ESPECIFICA.
       FIN-GAP-ESPECIFICA.
           EXIT.

       GAP-GENERAL SECTION.
       INI-GAP-GENERAL.
           IF GDG-COD-LGTA IN GDG = 'A' AND
              WSS-IND-NESP NOT > ZEROES
              MOVE 'GTIASINGPREE' TO MSG-COD-MENS
              MOVE 'BGL' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              GO TO FIN-GAP-GENERAL.

           IF WSS-IND-SBCI > 1
              MOVE 'GAPBCIVARIOS' TO MSG-COD-MENS
              MOVE 'BGL' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              GO TO FIN-GAP-GENERAL.

       FIN-GAP-GENERAL.
           EXIT.

       GAP-GLE SECTION.
       INI-GAP-GLE.
           IF VCG-CMND = 'AGA'
      * EVA-INI  25/06/2009   TIPOS DE GARANTIA SIN GLE
      *       PERFORM LEE-GAP-GLE
      *       IF AGA-EXT-PNTL = 'NO'
      *          GO TO CNT-GAP-GLE
      *       ELSE
      *          GO TO FIN-GAP-GLE.

              MOVE 'BGL'               TO TAB-COD-SIST FIO-SIST
              MOVE 'EDL'               TO TAB-COD-TTAB IN TAB
              MOVE GDG-COD-CGTA IN GDG TO TAB-COD-CTAB IN TAB
              MOVE FIO-GET-KEY TO FIO-CMND
              PERFORM GNS-FIO-TAB
              IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
                 GO TO CNT-GAP-GLE
              ELSE
                 GO TO FIN-GAP-GLE.

      * EVA-FIN  25/06/2009   TIPOS DE GARANTIA SIN GLE

      *EVA-INI/FEB08
           IF VCG-CMND = 'ACE'
              MOVE 'GLE' TO PNT-COD-PTLL
              PERFORM BUS-PNTL
              IF PNT-EXT-PNTL = 'NO'
                 GO TO CNT-GAP-GLE
              ELSE
                 GO TO FIN-GAP-GLE.
      *EVA-FIN/FEB08

       CNT-GAP-GLE.
           MOVE GAP-CAI-GTIA IN GAP TO GLE-CAI-GTIA IN GLE.
           MOVE GAP-IIC-GTIA IN GAP TO GLE-IIC-GTIA IN GLE.
           MOVE GAP-COD-PACR IN GAP TO GLE-COD-PACR IN GLE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GLE.
           IF NOT FIO-STAT-OKS
               MOVE 'GAP SIN GLE' TO MSG-COD-MENS
               MOVE 'BGL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-GAP-GLE
           ELSE
               MOVE SPACES TO MSG-COD-MENS.
       FIN-GAP-GLE.
           EXIT.
      *AFRI-FIN/MAYO2007  PRELACION

      *AFRI-INI/JUN2007/CHC  PRELACION
       VAL-FEC-FVTO SECTION.
       INI-VAL-FEC-FVTO.
           MOVE 1 TO WSS-CONT IN WSS-VARI.
           MOVE GDG-FEC-FVTO IN GDG TO WSS-FEC-FMAV IN WSS-VARI.

           MOVE GDG-CAI-GTIA IN GDG TO GES-CAI-GTIA IN GES.
           MOVE GDG-IIC-GTIA IN GDG TO GES-IIC-GTIA IN GES.
           MOVE ZEROES              TO GES-NUM-IGES IN GES.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-LEE-GES.
           PERFORM BGL-FIO-GES.
           IF NOT (FIO-STAT-OKS AND
              GES-CAI-GTIA IN GES = GDG-CAI-GTIA IN GDG AND
              GES-IIC-GTIA IN GES = GDG-IIC-GTIA IN GDG)
               MOVE WSS-FEC-FMAV IN WSS-VARI TO GDG-FEC-FVTO IN GDG
               GO TO FIN-VAL-FEC-FVTO.

           MOVE GES-CAI-IOPC IN GES TO DLC-CAI-IOPC IN DLC.
           MOVE GES-IIC-IOPC IN GES TO DLC-IIC-IOPC IN DLC.
           MOVE GES-NUM-IDLC IN GES TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
               MOVE 'DLC    NEX' TO MSG-COD-MENS
               MOVE 'BGL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-FEC-FVTO.

           IF WSS-CONT = 1
               MOVE DLC-FEC-FMAV IN DLC TO WSS-FEC-FMAV IN WSS-VARI.

           IF DLC-FEC-FMAV IN DLC > WSS-FEC-FMAV IN WSS-VARI
               MOVE DLC-FEC-FMAV IN DLC TO WSS-FEC-FMAV IN WSS-VARI.

           ADD 1 TO WSS-CONT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-LEE-GES.
       FIN-VAL-FEC-FVTO.
           EXIT.
      *AFRI-FIN/JUN2007/CHC  PRELACION
       LEE-GAP-GLE SECTION.
       INI-LEE-GAP-GLE.
      * EVA-INI  25/06/2009   TIPOS DE GARANTIA SIN GLE
      *    MOVE 'NO' TO AGA-EXT-PNTL.
      *    MOVE GDG-COD-CGTA IN GDG TO AGA-COD-PTLL.
      *    MOVE 'BGL' TO TAB-COD-SIST FIO-SIST.
      *    MOVE 'VSN' TO TAB-COD-TTAB IN TAB.
      *    MOVE 'BGLGLEGAP' TO TAB-COD-CTAB IN TAB.
      *    MOVE FIO-GET-KEY TO FIO-CMND.
      *    PERFORM GNS-FIO-TAB.
      *    IF NOT (FIO-STAT-OKS AND
      *            TAB-IND-VIGE IN TAB = 'S')
      *            GO TO FIN-LEE-GAP-GLE.
      *    MOVE TAB-GLS-DATA IN TAB TO AGA-GLS-DATA.
      *    MOVE 'SI' TO AGA-EXT-PNTL.
      *    PERFORM BUS-AGA.
      *FIN-LEE-GAP-GLE.
      *    EXIT.

      *BUS-AGA SECTION.
      *INI-BUS-AGA.
      *    MOVE 'NO'       TO AGA-EXT-PNTL.
      *    MOVE 1 TO AGA-I.
      *LUP-SIG-AGA.
      *    IF AGA-COD-PNTL(AGA-I) = AGA-COD-PTLL
      *       MOVE 'SI' TO AGA-EXT-PNTL
      *       GO TO FIN-BUS-AGA.
      *NXT-SIG-AGA.
      *       ADD 1 TO AGA-I.
      *       IF AGA-I > 20
      *          GO TO FIN-BUS-AGA
      *       ELSE
      *          GO TO LUP-SIG-AGA.
      *FIN-BUS-AGA.
      *    EXIT.
      * EVA-FIN  25/06/2009   TIPOS DE GARANTIA SIN GLE
      *AFRI-INI/JUL2012    GARANTIAS ESTATALES
       DET-VAL-GTIA-CRF SECTION.
       INI-DET-VAL-GTIA-CRF.
           MOVE 'N' TO VAL-IND-VALI IN VAL-VARI
      *VALIDA PRODUCTO
           IF VAL-COD-TOPE IN VAL-VARI = GDG-COD-TOPE IN GDG AND
              VAL-COD-SOPE IN VAL-VARI = GDG-COD-SOPE IN GDG
               MOVE 'S' TO VAL-IND-VALI IN VAL-VARI
               GO TO FIN-DET-VAL-GTIA-CRF.
      *VALIDA PROPIETARIO
           PERFORM DET-AFG-CRF.
           IF VAL-COD-MENS IN VAL-VARI NOT > SPACES
               IF VAL-NUM-ICLI IN VAL-VARI = GDG-NUM-IPRO IN GDG AND
                  VAL-VRF-ICLI IN VAL-VARI = GDG-VRF-IPRO IN GDG AND
                  VAL-IND-ICLI IN VAL-VARI = GDG-IND-IPRO IN GDG AND
                  VAL-GLS-ICLI IN VAL-VARI = GDG-GLS-IPRO IN GDG
                   MOVE 'S' TO VAL-IND-VALI IN VAL-VARI
                   GO TO FIN-DET-VAL-GTIA-CRF.
      *VALIDA AUTOR DE LA TRANSACCION
           IF GDG-COD-ATRN IN GDG = 'COLPPLIC'
               MOVE 'S' TO VAL-IND-VALI IN VAL-VARI
               GO TO FIN-DET-VAL-GTIA-CRF.
       FIN-DET-VAL-GTIA-CRF.
           EXIT.
       DET-VAL-GTIA-FOG SECTION.
       INI-DET-VAL-GTIA-FOG.
           MOVE 'N' TO VAL-IND-VALI IN VAL-VARI
      *VALIDA PRODUCTO
           IF GDG-COD-TOPE IN GDG = '952' AND
              GDG-COD-SOPE IN GDG = '101'
               MOVE 'S' TO VAL-IND-VALI IN VAL-VARI
               GO TO FIN-DET-VAL-GTIA-FOG.
      *VALIDA PROPIETARIO
           PERFORM DET-AFG-FOG.
           IF VAL-COD-MENS IN VAL-VARI NOT > SPACES
               IF VAL-NUM-ICLI IN VAL-VARI = GDG-NUM-IPRO IN GDG AND
                  VAL-VRF-ICLI IN VAL-VARI = GDG-VRF-IPRO IN GDG AND
                  VAL-IND-ICLI IN VAL-VARI = GDG-IND-IPRO IN GDG AND
                  VAL-GLS-ICLI IN VAL-VARI = GDG-GLS-IPRO IN GDG
                   MOVE 'S' TO VAL-IND-VALI IN VAL-VARI
                   GO TO FIN-DET-VAL-GTIA-FOG.
      *VALIDA AUTOR DE LA TRANSACCION
           IF GDG-COD-ATRN IN GDG = 'COLPPLIC'
               MOVE 'S' TO VAL-IND-VALI IN VAL-VARI
               GO TO FIN-DET-VAL-GTIA-FOG.
       FIN-DET-VAL-GTIA-FOG.
           EXIT.
       DET-AFG-FOG SECTION.
       INI-DET-AFG-FOG.
           MOVE SPACES TO VAL-COD-MENS IN VAL-VARI.
           MOVE 'DEU'     TO TAB-COD-SIST FIO-SIST.
           MOVE 'AFG'     TO TAB-COD-TTAB IN TAB.
           MOVE SPACES    TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-NLS TO FIO-CMND.
       NXT-DET-AFG-FOG.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND
              TAB-COD-TTAB IN TAB = 'AFG' )
               MOVE 'NOEXIAFG'  TO VAL-COD-MENS IN VAL-VARI
               GO TO FIN-DET-AFG-FOG.

           IF NOT ( TAB-IND-VIGE IN TAB = 'S'   AND
              TAB-COD-CTAB IN TAB > SPACES )
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO NXT-DET-AFG-FOG.
           MOVE TAB-GLS-DATA IN TAB TO VAL-AFG-GLS-DATA.
       FIN-DET-AFG-FOG.
           EXIT.

       DET-AFG-CRF SECTION.
       INI-DET-AFG-CRF.
           MOVE SPACES TO VAL-COD-MENS IN VAL-VARI.
           MOVE 'DEU'     TO TAB-COD-SIST FIO-SIST.
           MOVE 'AFG'     TO TAB-COD-TTAB IN TAB.
           MOVE 'VGE01'   TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
               MOVE 'NOEXIAFG'  TO VAL-COD-MENS IN VAL-VARI
               GO TO FIN-DET-AFG-CRF.

           MOVE TAB-GLS-DATA IN TAB TO VAL-AFG-GLS-DATA.
       FIN-DET-AFG-CRF.
           EXIT.

      *AFRI-FIN/JUL2012    GARANTIAS ESTATALES
