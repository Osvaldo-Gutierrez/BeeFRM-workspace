*% VSNBQ = "06.06.29"
*% FNCBQ = "OWFBGL"
*% VSNBU = "06.06.29"
*% FNCBU = "OWFBGL"
*% FRM = 'GVT'
*% REG = 'GVT'
*% FMT_CHI = TRUE
*% GEN_BCI = TRUE
*% IF SETTAG
      *-----------------------------------------------------------------
      *  AUTOR      : AFRI
      *  FECHA      : NOV-2016
      *  ETIQUETA   : *AFRI-INI / NOV 2016 REDONDEAR VALOR TASACION
      *  OBJETIVO   : REDONDEAR VALOR TASACION
      *-----------------------------------------------------------------
      * MANTENCION
      * OBJETIVO   : MODIFICAR VALIDACION PARA INCLUIR LTSN Y VCTS = 1
      *              TASACIONES PARCIALES Y COMPLETAS
      * RESPONSABLE: MVG
      * ETIQUETA   : *MVG-INI 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
      *-----------------------------------------------------------------
*% END
*% IF INI_VAL_FLD_GVT
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
           MOVE GVT-CAI-GTIA IN GVT-FLD TO GDG-CAI-GTIA IN GDG.
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
      *VERIFICA SI PRODUCTO (TIPO-SUBTIPO) ES FFMM
           MOVE SPACES              TO WSS-IND-FFMM.
           MOVE 'BGL'               TO TAB-COD-SIST FIO-SIST.
           MOVE 'PFM'               TO TAB-COD-TTAB IN TAB.
           MOVE GDG-COD-CGTA IN GDG TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = WSS-S
               MOVE WSS-S TO WSS-IND-FFMM.
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM
*% END
*% IF INI_GVT_SGV_LTSN
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
           IF WSS-IND-FFMM = WSS-S AND SCR-CMND = 'ATA'
               MOVE GVT-SGV-VCTS IN GVT-FLD TO GVT-SGV-LTSN IN GVT-FLD
               GO TO FIN-VAL-GVT-SGV-LTSN.
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM
*% END
*% IF FIN_UNP_IKY_GVT 
      *<<<< FIN_UNP_IKY_GVT 
      *RRM-INI 16-APR-2002
           IF SCR-CCPP = 'ING'
           MOVE FRM-CPIM-AEY TO GVT-COD-TASN-ATR IN GVT-FLD
           MOVE FRM-CPIM-AEY TO GVT-COD-TASN-STP.
      *RRM-FIN 16-APR-2002
      *>>>>      
*% END
*% IF FIN_GVT_COD_EITS
      *<<<< FIN_GVT_COD_EITS
           IF GVT-COD-EITS IN GVT-FLD NOT > SPACES
              PERFORM ERR-GLS
              GO TO FIN-VAL-GVT-COD-EITS.
*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE 'TAB'  TO TAB-COD-SIST.
           MOVE 'TAS'  TO TAB-COD-TTAB IN TAB.
           MOVE GVT-COD-EITS IN GVT-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.                                             
           IF MSG-COD-MENS = 'COD    NEX'
              MOVE SPACES       TO FRM-GLS-EITS IN GVT-FLD
              MOVE 'TAB' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE FRM-SUAR-MAL TO FRM-SUAR
           ELSE
              MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-EITS IN GVT-FLD.
                                                                        
      * EVA-INI   10/07                                                 
                                                                        
           IF SCR-CMND = 'ING' AND                                      
              GVT-COD-EITS IN GVT-FLD = '900'                           
               MOVE 'TAB'          TO MSG-COD-SIST                      
               MOVE 'ING  NOFISCO' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE FRM-SUAR-MAL TO FRM-SUAR                            
               GO TO FIN-VAL-GVT-COD-EITS.                              
                                                                        
      * EVA-FIN   10/07                                                 
      *>>>>
*% ELSE
           IF GVT-COD-EITS IN GVT-FLD > SPACES
              MOVE 'TAS'                   TO IVB-EXT-TTAB IN IVB
              MOVE GVT-COD-EITS IN GVT-FLD TO IVB-EXT-CTAB IN IVB
              MOVE 'IVB-KY2-TABS'          TO FIO-AKEY
              MOVE FIO-GET-KEY             TO FIO-CMND
              PERFORM TAB-FIO-IVB
              IF NOT (FIO-STAT-OKS AND
                   IVB-EXT-TTAB IN IVB = 'TAS' AND
                   IVB-EXT-CTAB IN IVB = GVT-COD-EITS IN GVT-FLD AND
                   IVB-MSC-STAT IN IVB = 'S')
                   MOVE 'TAB'           TO MSG-COD-SIST
                   MOVE 'TIT    NVIG'   TO MSG-COD-MENS
                   MOVE SPACES          TO FRM-GLS-EITS IN GVT-FLD
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC    TO FRM-MEN1
                   MOVE FRM-SUAR-MAL    TO FRM-SUAR
                   GO TO FIN-VAL-GVT-COD-EITS
              ELSE
                 MOVE IVB-GLS-DESC IN IVB TO FRM-GLS-EITS IN GVT-FLD.
*% END 
      *>>>>
*% END 
*% IF FIN_GVT_COD_OAVA
      *<<<< FIN_GVT_COD_OAVA
      *CGL-INI  19-AUG-2003 18:08:56 
      *     MOVE 'BGL'  TO TAB-COD-SIST.
      *     MOVE 'ORA' TO TAB-COD-TTAB IN TAB.
      *     MOVE GVT-COD-OAVA IN GVT-FLD TO TAB-COD-CTAB IN TAB.
      *     PERFORM VAL-COD.
      *     IF MSG-COD-MENS = 'COD    NEX'
      *        MOVE SPACES       TO FRM-GLS-OAVA IN GVT-FLD
      *        MOVE 'TAB' TO MSG-COD-SIST
      *        PERFORM GET-MSG
      *        MOVE MSG-GLS-DESC TO FRM-MENS
      *        MOVE FRM-SUAR-MAL TO FRM-SUAR
      *     ELSE
      *        MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-OAVA IN GVT-FLD.
      *CGL-FIN  19-AUG-2003 18:09:21 
      *>>>>
*% END
*% IF FIN_GVT_COD_CRIT
      *<<<< FIN_GVT_COD_CRIT
      *CGL-INI  19-AUG-2003 18:06:44 
      *     MOVE 'BGL'                   TO TAB-COD-SIST.
      *     MOVE 'CRI'                   TO TAB-COD-TTAB IN TAB.
      *     MOVE GVT-COD-CRIT IN GVT-FLD TO TAB-COD-CTAB IN TAB.
      *     PERFORM VAL-COD.
      *     IF MSG-COD-MENS = 'COD    NEX'
      *        MOVE SPACES       TO FRM-GLS-CRIT IN GVT-FLD
      *        MOVE 'TAB' TO MSG-COD-SIST
      *        PERFORM GET-MSG
      *        MOVE MSG-GLS-DESC TO FRM-MENS
      *        MOVE FRM-SUAR-MAL TO FRM-SUAR
      *     ELSE
      *        MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-CRIT IN GVT-FLD.
      * CGL-FIN  19-AUG-2003 18:07:10 
      *>>>>
*% END             
*% IF GVT_COD_ISVS
      *<<<< GVT_COD_ISVS
      *MHM-INI 9-MAR-2004                                               
      *        MOVE SPACES TO GVT-COD-ISVS IN GVT-FLD.                  
              MOVE SPACES TO GVT-COD-ISVS IN GVT-FLD                    
              MOVE SPACES TO FRM-GLS-ISVS IN GVT-FLD                    
              GO TO FIN-VAL-GVT-COD-ISVS.                               
      *MHM-FIN 9-MAR-2004                                               
*% IF NOT FMT_CHI
      *<<<< NOT FMT_CHI
           MOVE SPACES TO WSS-TIPO-DIV IN WSS-VARI.
           MOVE GDG-COD-CGTA IN GVT-FLD TO WSS-TIPO-DIV IN WSS-VARI.
      
           IF GVT-COD-ISVS IN GVT-FLD NOT > ZEROES
           IF (SCR-CCPP = 'MOD' OR SCR-CCPP = 'ACT' OR SCR-CCPP = 'ING')
              IF ((GDG-COD-CGTA IN GVT-FLD NOT < '000101' AND
                   GDG-COD-CGTA IN GVT-FLD     < '000130') OR
                   WSS-TIPO IN WSS-VARI = 'HIP')
                   PERFORM ERR-GLS
                   GO TO FIN-VAL-GVT-COD-ISVS
              ELSE
                 GO TO FIN-VAL-GVT-COD-ISVS
           ELSE
              GO TO FIN-VAL-GVT-COD-ISVS.

           IF GVT-COD-ISVS IN GVT-FLD > ZEROES
              MOVE 'USR'                   TO USR-COD-TTAB IN USR
              MOVE GVT-COD-ISVS IN GVT-FLD TO USR-COD-USER IN USR
              MOVE FIO-GET-KEY TO FIO-CMND
              PERFORM TAB-FIO-USR
              IF NOT FIO-STAT-OKS
                 MOVE 'TAB'   TO MSG-COD-SIST
                 MOVE 'USR NOEXIST' TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO FRM-MENS
                 MOVE FRM-SUAR-MAL TO FRM-SUAR
                 GO TO FIN-VAL-GVT-COD-ISVS
              ELSE
                 MOVE USR-GLS-DESC IN USR TO FRM-GLS-ISVS IN GVT-FLD.
      *>>>>
*% ELSE
           MOVE 'TAB'  TO TAB-COD-SIST.
*% IF GEN_BCI
      *<<<< GEN_BCI
           MOVE 'TAS'  TO TAB-COD-TTAB IN TAB.
      *>>>>
*% ELSE
           MOVE 'INS'  TO TAB-COD-TTAB IN TAB.
*% END
           MOVE GVT-COD-ISVS IN GVT-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX'
              MOVE SPACES       TO FRM-GLS-ISVS IN GVT-FLD
              MOVE 'TAB' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE FRM-SUAR-MAL TO FRM-SUAR
           ELSE
              MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-ISVS IN GVT-FLD.
*% END
      *>>>>
*% END             
*% IF GVT_COD_CFCD
      *<<<< GVT_COD_CFCD
           IF GVT-COD-CFCD IN GVT-FLD NOT > SPACES
               GO TO  FIN-VAL-GVT-COD-CFCD.        

           MOVE GVT-COD-CFCD IN GVT-FLD TO FCD-KEY-CFCD IN FCD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-FCD.
           IF NOT FIO-STAT-OKS
               MOVE 'FCD    NEX' TO MSG-COD-MENS
               MOVE 'BGL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>>
*% END
*% IF GVT_COD_ADAG
      *<<<< GVT_COD_AGAG
*% IF NOT FMT_CHI
      *<<<< NOT FMT_CHI
           MOVE SPACES TO WSS-TIPO-DIV IN WSS-VARI.
           MOVE GDG-COD-CGTA IN GVT-FLD TO WSS-TIPO-DIV IN WSS-VARI.
      *CGL-INI  19-AUG-2003 18:11:01 
      *     IF GVT-COD-ADAG IN GVT-FLD NOT > SPACES
      *     IF (SCR-CCPP = 'MOD' OR SCR-CCPP = 'ACT' OR SCR-CCPP = 'ING')
      *          AND ((GDG-COD-CGTA IN GVT-FLD NOT < '000101' AND
      *                GDG-COD-CGTA IN GVT-FLD     < '000130') OR
      *               (WSS-TIPO IN WSS-VARI = 'HIP'))
      *                PERFORM ERR-GLS
      *                GO TO FIN-VAL-GVT-COD-ADAG.
      *CGL-FIN  19-AUG-2003 18:11:18 
      *>>>>
*% END
      *>>>>
*% END
*% IF GVT_COD_SDAG
      *<<<< GVT_COD_SGAG
*% IF NOT FMT_CHI
      *<<<< NOT FMT_CHI
           MOVE SPACES TO WSS-TIPO-DIV IN WSS-VARI.
           MOVE GDG-COD-CGTA IN GVT-FLD TO WSS-TIPO-DIV IN WSS-VARI.
      
           IF GVT-COD-SDAG IN GVT-FLD NOT > SPACES
           IF (SCR-CCPP = 'MOD' OR SCR-CCPP = 'ACT' OR SCR-CCPP = 'ING')
               IF  ((GDG-COD-CGTA IN GVT-FLD NOT < '000101' AND
                     GDG-COD-CGTA IN GVT-FLD     < '000130') OR
                    (WSS-TIPO IN WSS-VARI = 'HIP'))
                     PERFORM ERR-GLS
                     GO TO FIN-VAL-GVT-COD-SDAG.
      *>>>>
*% END
      *>>>>
*% END
*% IF FIN_UNP_FLD_GVT
      *<<<< FIN_UNP_FLD_GVT
           IF SCR-CMND = 'ING' OR                                       
              SCR-CMND = 'INE' OR                                       
              SCR-CMND = 'MOD'                                          
              MOVE FRM-CPIM-UBY TO GVT-COD-SDAG-ATR IN GVT-FLD.         
      *>>>>
*% END
*% IF FIN_PRO_FLD_GVT
      *<<<< FIN_PRO_FLD_GVT
           IF SCR-CMND = 'ING' OR                                       
              SCR-CMND = 'INE' OR                                       
              SCR-CMND = 'MOD' OR
              SCR-CMND = 'RTA'                                         
              MOVE FRM-CPIM-AEY TO GVT-COD-SDAG-ATR IN GVT-FLD.
      *>>>>
*% END
*% IF INI_GVT_SGV_FISI
      *<<<< INI_GVT_SGV_FISI
      *CGL-INI  19-AUG-2003 18:11:56 
      *     IF GVT-SGV-FISI IN GVT-FLD NOT > ZEROES
      *        MOVE ZEROES TO GVT-SGV-FISI IN GVT-FLD
      *        GO TO FIN-VAL-GVT-SGV-FISI.
      *CGL-FIN  19-AUG-2003 18:12:06 
      *>>>>
*% END
*% IF GVT_NUM_AMOD
      *<<<< GVT_NUM_AMOD
            IF GVT-COD-CFCD IN GVT-FLD = SPACES AND
               GVT-NUM-AMOD IN GVT-FLD > ZEROES
                MOVE 'FCD    SPC' TO MSG-COD-MENS
                MOVE 'BGL' TO MSG-COD-SIST
                PERFORM GET-MSG
                MOVE MSG-GLS-DESC TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                GO TO FIN-VAL-GVT-NUM-AMOD.
      *
           IF GVT-NUM-AMOD IN GVT-FLD > ZEROES
               MOVE GVT-COD-CFCD IN GVT-FLD TO VCV-COD-CFCD IN VCV
               MOVE GVT-NUM-AMOD IN GVT-FLD TO VCV-NUM-AMOD IN VCV
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM BGL-FIO-VCV
               IF NOT FIO-STAT-OKS
                   MOVE 'VCV    NEX' TO MSG-COD-MENS
                   MOVE 'BGL' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>>
*% END
*% IF GVT_SGV_VPND
      *<<<< GVT_VAL_CML_TSN
*% IF NOT GEN_BCI
      *<<<< NOT GEN_BCI
           IF ( GVT-SGV-VPND IN GVT-FLD > GVT-SGV-VCTS IN GVT-FLD )
               MOVE 'BGL'      TO MSG-COD-SIST
               MOVE 'VLCBL>AV' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
      *>>>>
*% END
      *>>>>
*% END
*% IF GVT_SGV_VSIN
      *<<<< GVT_SGV_VSIN
      *MHM-INI 17-OCT-2003
           IF SCR-CMND = 'ATA'
               MOVE GVT-SGV-VCTS IN GVT-FLD TO GVT-SGV-VSIN IN GVT-FLD.

      *MHM-FIN 17-OCT-2003
      *MHM-INI 29-OCT-2003
           IF CMA-CIC-UING IN CMA-VARI = 'MIGRACION' AND
              GVT-SGV-VSIN IN GVT-FLD NOT > ZEROES
               GO TO FIN-VAL-GVT-SGV-VSIN.
      *MHM-FIN 29-OCT-2003
      *    IF CMA-IND-TSWT IN CMA-VARI NOT = 'N' AND                    
      *       GVT-SGV-VSIN IN GVT-FLD NOT > ZEROES                      
      *        PERFORM ERR-GLS                                          
      *        GO TO FIN-VAL-GVT-SGV-VSIN.                              
      *    IF CMA-IND-TSWT IN CMA-VARI = 'N'                            
      *         MOVE GVT-SGV-VCTS IN GVT-FLD TO GVT-SGV-VSIN IN GVT-FLD. 
      *>>>>

      *AFRI-INI 07-JUNIO-2006                                           
           IF GVT-SGV-VSIN IN GVT-FLD = ZEROES                          
               MOVE GVT-SGV-VCTS IN GVT-FLD TO GVT-SGV-VSIN IN GVT-FLD  
               GO TO FIN-VAL-GVT-SGV-VSIN.                              
      *AFRI-FIN 07-JUNIO-2006                                           
      *>>>>
*% END
*% IF GVT_COD_ITSD
      *<<<<
           IF ( SCR-CMND = 'RVL' OR = 'RTA' ) AND 
              ( GVT-COD-ITSD IN GVT-FLD NOT > SPACES )
                  PERFORM ERR-GLS
                  MOVE FRM-SUAR-MAL TO FRM-SUAR
                  GO TO FIN-VAL-GVT-COD-ITSD.
      *>>>>
*% END
*% IF FIN_PUT_GVT_GVT
      *<<<< FIN_PUT_GVT_GVT
      *MHM-INI 29-OCT-2003
           MOVE GVT-CIC-UING IN GVT TO CMA-CIC-UING IN CMA-VARI.
      *MHM-FIN 29-OCT-2003
*% IF FMT_CHI
      *<<<< FMT_CHI
           IF GVT-COD-ISVS IN GVT-FLD > SPACES
              MOVE 'TAB'               TO TAB-COD-SIST
*% IF GEN_BCI
      *<<<< GEN_BCI
              MOVE 'TAS'               TO TAB-COD-TTAB IN TAB
      *>>>>
*% ELSE
              MOVE 'INS'               TO TAB-COD-TTAB IN TAB
*% END
              MOVE GVT-COD-ISVS IN GVT TO TAB-COD-CTAB IN TAB
      * EVA-INI  01/09                                                  
      *       PERFORM VAL-COD                                           
              PERFORM BUS-TAB                                           
      * EVA-FIN  01/09                                                  
              MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-ISVS IN GVT-FLD
           ELSE
              MOVE SPACES TO FRM-GLS-ISVS IN GVT-FLD.
      *>>>>
*% ELSE
           IF GVT-COD-ISVS IN GVT-FLD > ZEROES
              MOVE 'USR'                   TO USR-COD-TTAB IN USR
              MOVE GVT-COD-ISVS IN GVT     TO USR-COD-USER IN USR
              MOVE FIO-GET-KEY             TO FIO-CMND
              PERFORM TAB-FIO-USR
              MOVE USR-GLS-DESC IN USR TO FRM-GLS-ISVS IN GVT-FLD
           ELSE
              MOVE SPACES TO FRM-GLS-ISVS IN GVT-FLD.
*% END
      *CGL-INI  19-AUG-2003 18:07:25    
      *     IF GVT-COD-CRIT IN GVT-FLD > SPACES
      *        MOVE 'BGL'                   TO TAB-COD-SIST
      *        MOVE 'CRI'                   TO TAB-COD-TTAB IN TAB
      *        MOVE GVT-COD-CRIT IN GVT     TO TAB-COD-CTAB IN TAB
      *        PERFORM VAL-COD
      *        MOVE TAB-GLS-DESC IN TAB     TO FRM-GLS-CRIT IN GVT-FLD
      *     ELSE
      *        MOVE SPACES TO FRM-GLS-CRIT IN GVT-FLD.
      *CGL-FIN  19-AUG-2003 18:07:44 
      * CGL-INI  19-AUG-2003 18:09:33 
      *     IF GVT-COD-OAVA IN GVT-FLD > SPACES
      *        MOVE 'BGL'               TO TAB-COD-SIST
      *        MOVE 'ORA'               TO TAB-COD-TTAB IN TAB
      *        MOVE GVT-COD-OAVA IN GVT TO TAB-COD-CTAB IN TAB
      *        PERFORM VAL-COD
      *        MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-OAVA IN GVT-FLD
      *     ELSE
      *        MOVE SPACES TO FRM-GLS-OAVA IN GVT-FLD.
      *CGL-FIN  19-AUG-2003 18:09:51 
      
           IF GVT-MSC-STAT IN GVT-FLD = 'I'
              MOVE 'INGRESADO'       TO FRM-GLS-STAT IN GVT-FLD
           ELSE
           IF GVT-MSC-STAT IN GVT-FLD = 'M'
              MOVE 'MODIFICADO'      TO FRM-GLS-STAT IN GVT-FLD
           ELSE
           IF GVT-MSC-STAT IN GVT-FLD = 'A'
              MOVE 'ACTIVADO'        TO FRM-GLS-STAT IN GVT-FLD
           ELSE
              MOVE 'OTRO'            TO FRM-GLS-STAT IN GVT-FLD.
*% IF FMT_CHI
      *<<<< FMT_CHI
           IF GVT-COD-EITS IN GVT-FLD > SPACES
              MOVE 'TAB'               TO TAB-COD-SIST
              MOVE 'TAS'               TO TAB-COD-TTAB IN TAB
              MOVE GVT-COD-EITS IN GVT TO TAB-COD-CTAB IN TAB
      * EVA-INI  01/09                                                  
      *       PERFORM VAL-COD                                           
              PERFORM BUS-TAB                                           
      * EVA-FIN  01/09                                                  
              MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-EITS IN GVT-FLD
           ELSE
              MOVE SPACES TO FRM-GLS-EITS IN GVT-FLD.
      *>>>>
*% ELSE
           IF GVT-COD-EITS IN GVT-FLD > SPACES
              MOVE 'TAS'                   TO IVB-EXT-TTAB IN IVB
              MOVE GVT-COD-EITS IN GVT-FLD TO IVB-EXT-CTAB IN IVB
              MOVE 'IVB-KY2-TABS'          TO FIO-AKEY
              MOVE FIO-GET-KEY             TO FIO-CMND
              PERFORM TAB-FIO-IVB
              MOVE IVB-GLS-DESC IN IVB TO FRM-GLS-EITS IN GVT-FLD
           ELSE
              MOVE SPACES TO FRM-GLS-EITS IN GVT-FLD.
*% END
           MOVE GVT-SGV-LTSN IN GVT-FLD TO
                WSS-SGV-LTSN IN CMA-VARI.

           IF ( SCR-CCPP = 'ACC' AND
                SCR-STPP NOT = SCR-STAT-CON OR
                SCR-CMND = 'ATA' ) AND

               GVT-SGV-LTSN IN GVT-FLD > ZEROES AND
               GVT-SGV-VCTS IN GVT-FLD > ZEROES

                COMPUTE WSS-LIQ-CML IN CMA-VARI ROUNDED =
                               GVT-SGV-LTSN IN GVT-FLD /
                               GVT-SGV-VCTS IN GVT-FLD

           ELSE
               MOVE ZEROES TO WSS-LIQ-CML IN CMA-VARI.

       OBT-VEN-TSN.
           PERFORM EXA-VEN-TSN.
      *MHM-INI 16-SEP-2003
           IF SCR-CMND NOT = 'CON'
               GO TO CNT-PUT-GVT-GVT.
      ** EVA-INI  10/07                                                 
           PERFORM LEE-GDG.                                             
           IF WSS-IND-GTIA IN WSS-VARI = 'N'                            
              GO TO FIN-PUT-GVT-GVT.                                    
                                                                        
           PERFORM BUS-TNOV.                                            
                                                                        
      *PVC-INI 20-JUL-2012 - MENSAJE DE TASACION VENCIDA
      *    IF WSS-IND-GTAC IN WSS-VARI = 'N' OR                         
      *       WSS-IND-ARET IN WSS-VARI = 'N'                            

           IF (WSS-IND-GTAC IN WSS-VARI = 'N' OR
               WSS-IND-ARET IN WSS-VARI = 'N') AND
               WSS-IND-TASC IN WSS-VARI NOT = 'S'
      *PVC-FIN 20-JUL-2012

      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
      *        MOVE 'NO APLICA RETASAR' TO FRM-GLS-EXCE IN GVT-FLD      
               MOVE 'NORET' TO WSS-COD-CMSG IN WSS-VARI
               PERFORM PRO-LEE-MSG
               IF WSS-GLS-CMSG IN WSS-VARI NOT = SPACES
                MOVE WSS-GLS-CMSG IN WSS-VARI TO FRM-GLS-EXCE IN GVT-FLD
                GO TO CNT-PUT-GVT-GVT
               ELSE
                NEXT SENTENCE
           ELSE
               NEXT SENTENCE.
      *        GO TO CNT-PUT-GVT-GVT.                                   
      *AFRI-FIN/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012

           IF WSS-IND-GDIA IN WSS-VARI = 'S'
      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
      *        MOVE 'AL DIA' TO FRM-GLS-EXCE IN GVT-FLD                 
               MOVE 'ALDIA' TO WSS-COD-CMSG IN WSS-VARI
               PERFORM PRO-LEE-MSG
               IF WSS-GLS-CMSG IN WSS-VARI NOT = SPACES
                MOVE WSS-GLS-CMSG IN WSS-VARI TO FRM-GLS-EXCE IN GVT-FLD
                GO TO CNT-PUT-GVT-GVT
               ELSE
                NEXT SENTENCE
           ELSE
               NEXT SENTENCE.
      *        GO TO CNT-PUT-GVT-GVT.                                   
      *AFRI-FIN/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012

           IF WSS-IND-ECRT IN WSS-VARI = 'S'
      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
      *        MOVE 'VENCIDA CON EXCEPCION COMERCIAL'                   
      *                                     TO FRM-GLS-EXCE IN GVT-FLD  
               MOVE 'VENEXCCOM' TO WSS-COD-CMSG IN WSS-VARI
               PERFORM PRO-LEE-MSG
               IF WSS-GLS-CMSG IN WSS-VARI NOT = SPACES
                MOVE WSS-GLS-CMSG IN WSS-VARI TO FRM-GLS-EXCE IN GVT-FLD
                GO TO CNT-PUT-GVT-GVT
               ELSE
                NEXT SENTENCE
           ELSE
               NEXT SENTENCE.
      *        GO TO CNT-PUT-GVT-GVT.                                   
      *AFRI-FIN/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
      ** EVA-INI  10/07                                                 
      *    PERFORM EXC-NOR-TAS.                                         
      *    IF WSS-IND-ENT1 = 'S'                                        
      *       MOVE 'VENCIDA EXCP.NORMATIVA, NO PRESENTA DEUDAS VIGENTES'
      *                                     TO FRM-GLS-EXCE IN GVT-FLD  
      *    ELSE                                                         
      *    IF WSS-IND-ENT2 = 'S'                                        
      *       MOVE 'VENCIDA EXCP.NORMATIVA, UNICA DEUDA HIPOTECARIA'    
      *                                     TO FRM-GLS-EXCE IN GVT-FLD  
      *    ELSE                                                         
      *    IF WSS-IND-ENT3 = 'S'                                        
      *       MOVE 'VENCIDA EXCP.NORMATIVA, TASACION VIGENTE EN CURSE'  
      *                                     TO FRM-GLS-EXCE IN GVT-FLD  
      *    ELSE                                                         
      *       MOVE 'TASACION VENCIDA, DEBE RETASAR'                     
      *                                     TO FRM-GLS-EXCE IN GVT-FLD. 
      ** EVA-FIN  10/07                                                 
                                                                        
      ** EVA-INI  11/08                                                 
           IF WSS-IND-RTAS IN WSS-VARI = 'S'                            
      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
      *       MOVE 'TASACION VIGENTE EN CURSE' TO
      *             FRM-GLS-EXCE IN GVT-FLD
               MOVE 'VIGCUR' TO WSS-COD-CMSG IN WSS-VARI
               PERFORM PRO-LEE-MSG
               IF WSS-GLS-CMSG IN WSS-VARI NOT = SPACES
                MOVE WSS-GLS-CMSG IN WSS-VARI TO FRM-GLS-EXCE IN GVT-FLD
                GO TO CNT-PUT-GVT-GVT
               ELSE
                NEXT SENTENCE
           ELSE
               NEXT SENTENCE.
      *        GO TO CNT-PUT-GVT-GVT.                                   
                                                                        
           IF GVT-IND-IEXC IN GVT = 'S'
      * TASACION VENCIDA                                                
               MOVE 'VENNORET' TO WSS-COD-CMSG IN WSS-VARI
               PERFORM PRO-LEE-MSG
               IF WSS-GLS-CMSG IN WSS-VARI NOT = SPACES
                MOVE WSS-GLS-CMSG IN WSS-VARI TO FRM-GLS-EXCE IN GVT-FLD
                GO TO CNT-PUT-GVT-GVT
               ELSE
                NEXT SENTENCE
           ELSE
               NEXT SENTENCE.
      *AFRI-FIN/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
                                                                        
           IF WSS-IND-TNOV IN WSS-VARI = 'S'                            
      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
      *       MOVE 'TASACION VENCIDA, DEBE RETASAR' TO                  
      *             FRM-GLS-EXCE IN GVT-FLD.                            
               MOVE 'VENRET' TO WSS-COD-CMSG IN WSS-VARI
               PERFORM PRO-LEE-MSG
               IF WSS-GLS-CMSG IN WSS-VARI NOT = SPACES
                MOVE WSS-GLS-CMSG IN WSS-VARI TO FRM-GLS-EXCE IN GVT-FLD
                GO TO CNT-PUT-GVT-GVT
               ELSE
                NEXT SENTENCE
           ELSE
               NEXT SENTENCE.                                  
      *AFRI-FIN/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
                                                                        
      ** EVA-FIN  11/08                                                 

      *PVC-INI 20-JUL-2012 - Mensaje de Tasacion Vencida
           IF WSS-IND-TASC IN WSS-VARI = 'S'
               MOVE 'TADIA' TO WSS-COD-CMSG IN WSS-VARI
               PERFORM PRO-LEE-MSG
               IF WSS-GLS-CMSG IN WSS-VARI NOT = SPACES
                MOVE WSS-GLS-CMSG IN WSS-VARI TO FRM-GLS-EXCE IN GVT-FLD
                GO TO CNT-PUT-GVT-GVT
               ELSE
                NEXT SENTENCE
           ELSE
               NEXT SENTENCE.
      *PVC-FIN 20-JUL-2012

       CNT-PUT-GVT-GVT.
      *MHM-FIN 16-SEP-2003
      ** EVA-FIN  10/07                                                 

           MOVE GVT-CAI-GTIA IN GVT-FLD TO GTP-CAI-GTIA IN GTP.
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GTP-IIC-GTIA IN GTP.
           MOVE GVT-COD-TASN IN GVT-FLD TO GTP-NUM-ITSN IN GTP.
           MOVE ZEROES                  TO GTP-COD-ITSN IN GTP.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM BGL-FIO-GTP.
           IF FIO-STAT-OKS AND
              GTP-CAI-GTIA IN GTP = GVT-CAI-GTIA IN GVT-FLD AND
              GTP-IIC-GTIA IN GTP = GVT-IIC-GTIA IN GVT-FLD AND
              GTP-NUM-ITSN IN GTP = GVT-COD-TASN IN GVT-FLD
               MOVE 'S' TO FRM-IND-GTP IN GVT-FLD
           ELSE
               MOVE 'N' TO FRM-IND-GTP IN GVT-FLD.

           IF FIO-STAT-OKS 
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM BGL-FIO-GTP.

      *PVC-INI 19-NOV-2012 - DESVALORIZACION
           PERFORM CONT-AVALUOS.
           MOVE WSS-NUM-FISC IN WSS-VARI TO FRM-NUM-FISC IN GVT-FLD.
      *PVC-FIN 19-NOV-2012
      *>>>>
*% END
*% IF FIN_PUT_GDG_GVT
      *<<<< FIN_PUT_GDG_GVT
           IF GDG-COD-VCON IN GVT-FLD > SPACES
              MOVE 'TAB' TO TAB-COD-SIST
              MOVE 'VLR ' TO TAB-COD-TTAB IN TAB
              MOVE GDG-COD-VCON IN GVT-FLD TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-VCON IN GVT-FLD
           ELSE
              MOVE SPACES TO FRM-GLS-VCON IN GVT-FLD.
      *>>>>
*% END
*% IF INI_PRO_FLD_GVT
      *<<<< INI_PRO_FLD_GVT
           MOVE FRM-CPIM-AEY TO GVT-FEC-FTSN-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-FEC-FTSN-STP.

           MOVE FRM-CPIM-AEY TO GVT-SGV-VCTS-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-VCTS-STP.

           MOVE FRM-CPIM-AEY TO GVT-SGV-LTSN-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-LTSN-STP.

           MOVE FRM-CPIM-AEY TO GVT-SGV-PAJU-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-PAJU-STP.

           MOVE FRM-CPIM-AEY TO GVT-SGV-VPND-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-VPND-STP.

           MOVE FRM-CPIM-AEY TO GVT-FEC-FRVL-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-FEC-FRVL-STP.

           MOVE FRM-CPIM-AEY TO FRM-IND-GTP-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO FRM-IND-GTP-STP.
      *>>>>
*% END
*% IF FIN_PUT_ALL_GVT
      *<<<< FIN_PUT_ALL_GVT
           PERFORM OBT-COD-MNAC.

*% IF (PGM_PER OR PGM_CLB OR PGM_MEX)
      *<<<< (PGM_PER OR PGM_CLB OR PGM_MEX)
      *
           COMPUTE FRM-SGV-VGAS IN GVT-FLD ROUNDED =
                   GVT-SGV-VCTS IN GVT *
                   GVT-SGV-PAJU IN GVT / 100.

           MOVE GVT-SGV-VPND IN GVT-FLD TO FRM-VAL-ULT-CON IN GVT-FLD.
      *
           MOVE ZEROES TO GVT-SGV-LTSN IN GVT-FLD.
           MOVE ZEROES TO GVT-SGV-PAJU IN GVT-FLD.
      *
           MOVE ZEROES TO FRM-SGV-VGAS IN GVT-FLD.
      *  
      *>>>>
*% END
*% IF NOT (PGM_PER OR PGM_CLB OR PGM_MEX)
      *<<<< NOT (PGM_PER OR PGM_CLB OR PGM_MEX)
           PERFORM OBT-VAL-CON.
      *>>>>
*% END
      *>>>>
*% END
*% IF FIN_VAL_CON_IKY_GVT
      *<<<< FIN_VAL_CON_IKY_GVT
           IF GVT-COD-TASN IN GVT-FLD < 1
               MOVE 1 TO GVT-COD-TASN IN GVT-FLD
           ELSE
           IF GVT-COD-TASN IN GVT-FLD > 1
      *        Comando Ingreso
               MOVE 'BGL'      TO MSG-COD-SIST
               MOVE 'GVTIKY>1' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-CON-IKY-GVT.

      *>>>>
*% END
*% IF INI_VAL_CON_KEY_GVT AND NOT PGM_MCP
      *<<<< INI_VAL_CON_KEY_GVT
           IF FRM-FFLD = FRM-FFLD-PF5
               GO TO FIN-VAL-CON-KEY-GVT.

      *>>>>
*% END
*% IF INI_FST_FLD_GVT
      *<<<< INI_FST_FLD_GVT
*% IF GEN_BCI
      *<<<< GEN_BCI
           MOVE -1 TO FRM-IND-GTP-LEN IN GVT-FLD.

           IF SCR-CCPP = 'ING'
               MOVE FRM-CPIM-AEY TO GVT-FEC-FRVL-ATR IN GVT-FLD
               GO TO FIN-FST-FLD-GVT.

      *MHM-INI 14-OCT-2003
           IF SCR-CMND = 'MTA'
               PERFORM PRO-FLD-GVT
               MOVE FRM-CPIM-UBY TO GVT-COD-EITS-ATR IN GVT-FLD
               MOVE FRM-CPIM-UBY TO GVT-COD-ISVS-ATR IN GVT-FLD
               MOVE  0 TO FRM-IND-GTP-LEN  IN GVT-FLD
               MOVE -1 TO GVT-COD-EITS-LEN IN GVT-FLD
               GO TO FIN-FST-FLD-GVT.

      *MHM-FIN 14-OCT-2003

           IF SCR-CCPP = 'MOD'
               MOVE  0 TO FRM-IND-GTP-LEN  IN GVT-FLD
               MOVE -1 TO GVT-FEC-FTSN-LEN IN GVT-FLD
               MOVE FRM-CPIM-AEY TO FRM-IND-GTP-ATR IN GVT-FLD
      *MHM-INI 14-OCT-2003
               MOVE FRM-CPIM-AEY TO GVT-FEC-FRVL-ATR IN GVT-FLD
      *MHM-FIN 14-OCT-2003
               GO TO FIN-FST-FLD-GVT.

           MOVE  0 TO FRM-IND-GTP-LEN IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO FRM-IND-GTP-ATR IN GVT-FLD.

      *MHM-INI 11-SEP-2003
           IF SCR-CMND = 'RTF'
               PERFORM PRO-FLD-GVT
               MOVE FRM-CPIM-UBY TO GVT-FEC-FTSN-ATR IN GVT-FLD
               MOVE  0 TO FRM-IND-GTP-LEN  IN GVT-FLD
               MOVE -1 TO GVT-FEC-FTSN-LEN IN GVT-FLD
               GO TO FIN-FST-FLD-GVT.

      *MHM-FIN 11-SEP-2003
           IF SCR-CMND = 'RVL'
               MOVE FRM-CPIM-AEY TO GVT-FEC-FTSN-ATR IN GVT-FLD
      *MHM-INI 14-OCT-2003
      *         MOVE -1 TO GVT-FEC-FRVL-LEN IN GVT-FLD
                MOVE  0 TO FRM-IND-GTP-LEN IN GVT-FLD
                MOVE -1 TO GVT-SGV-VCTS-LEN IN GVT-FLD
      *MHM-FIN 14-OCT-2003
           ELSE
               MOVE FRM-CPIM-AEY TO GVT-FEC-FRVL-ATR IN GVT-FLD
               MOVE  0 TO FRM-IND-GTP-LEN IN GVT-FLD
               MOVE -1 TO GVT-FEC-FTSN-LEN IN GVT-FLD.
            
           IF FRM-IND-GTP IN GVT-FLD = 'S'
               MOVE FRM-CPIM-AEY TO GVT-SGV-VCTS-ATR IN GVT-FLD.

           MOVE GVT-CAI-GTIA IN GVT-FLD TO GDP-CAI-GTIA IN GDP.
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GDP-IIC-GTIA IN GDP.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDP.
           IF FIO-STAT-OKS
               MOVE FRM-CPIM-AEY TO GVT-SGV-LTSN-ATR IN GVT-FLD.

      *MHM-INI 15-OCT-2003
           GO TO FIN-FST-FLD-GVT.
      *MHM-FIN 15-OCT-2003
      *>>>>
*% ELSE
      *CAH-ISP INI 15-ENE-1998
           IF SCR-CMND = 'MTA'
              MOVE FRM-POS-CURS TO GVT-COD-EITS-LEN IN GVT-FLD
              GO TO FIN-FST-FLD-GVT.

           IF SCR-CMND = 'RVL'
              MOVE FRM-POS-CURS TO GVT-SGV-VCTS-LEN IN GVT-FLD
              GO TO FIN-FST-FLD-GVT.

           IF SCR-CMND = 'RTA'
               IF ( CMA-CIC-TGAR IN CMA-VARI = 'DOCCBR' OR
                    CMA-CIC-TGAR IN CMA-VARI = 'DOCCEX' OR
                    CMA-CIC-TGAR IN CMA-VARI = 'DOCFCC' OR
                    CMA-CIC-TGAR IN CMA-VARI = 'DOCDPN' )

                  MOVE FRM-RST-PCUR TO GVT-FEC-FTSN-LEN IN GVT-FLD
                  MOVE FRM-POS-CURS TO GVT-SGV-PAJU-LEN IN GVT-FLD
                  GO TO FIN-FST-FLD-GVT
               ELSE
                   IF CMA-CIC-TGAR IN CMA-VARI = 'DOCVAL' AND
                      CMA-IND-SMEC IN CMA-VARI NOT = 'S'
                       MOVE FRM-RST-PCUR TO GVT-FEC-FTSN-LEN IN GVT-FLD
                       MOVE FRM-POS-CURS TO GVT-SGV-PAJU-LEN IN GVT-FLD
                       GO TO FIN-FST-FLD-GVT
                   ELSE
                       MOVE FRM-POS-CURS TO GVT-FEC-FTSN-LEN IN GVT-FLD
                       GO TO FIN-FST-FLD-GVT.
      *
           IF SCR-CMND = 'MOD' OR 'ATA'
              MOVE FRM-POS-CURS TO GVT-FEC-FTSN-LEN IN GVT-FLD
              GO TO FIN-FST-FLD-GVT.
*% END
      *>>>> INI_FST_FLD_GVT
*% END
*% IF FRM_IND_GTP
      *<<<< FRM_IND_GTP
           IF FRM-IND-GTP IN GVT-FLD NOT > SPACES
               MOVE 'N' TO FRM-IND-GTP IN GVT-FLD.
      *>>>>
*% END
*% IF INI_GVT_FEC_FTSN
      *<<<< INI_GVT_FEC_TSN
      *AFRI-INI/JUL2005                                                 
           IF SCR-HDR-MRCA = 'BCS'                                      
              MOVE FEC-CHOY-N TO FEC-CHOY.                              
      *AFRI-FIN/JUL2005                                                 
           IF SCR-CMND = 'RVL'
               GO TO FIN-VAL-GVT-FEC-FTSN.
           MOVE GVT-FEC-FTSN IN GVT-FLD TO GVT-FEC-FRVL IN GVT-FLD.
      *    GO TO CON-FEC-FTSN.
      *>>>>
*% END
*% IF GVT_FEC_FTSN
      *<<<< GVT_FEC_TSN
      *
      *CON-FEC-FTSN.
      *AFRI-INI/JUL2005                                                 
           IF SCR-HDR-MRCA = 'BCS'                                      
               IF FEC-STAT-FER                                          
                   MOVE FEC-FORM-FEC TO FEC-FORM                        
                   MOVE FEC-FBLK-N  TO FEC-FBLK                         
                   MOVE FEC-CHOY-N  TO FEC-CHOY                         
                   MOVE FEC-SIG-HBL TO FEC-CMND                         
                   PERFORM CAL-FEC                                      
                   MOVE  '00' TO FEC-STAT.                              

      *AFRI-FIN/JUL2005                                                 
           IF FEC-STAT-OKS                                              
               MOVE FEC-FECH TO GVT-FEC-FTSN IN GVT-FLD                 
           ELSE                                                         
               MOVE FRM-SUAR-MAL TO FRM-SUAR                            
               MOVE FEC-MENS     TO FRM-MENS                            
               GO TO FIN-VAL-GVT-FEC-FTSN.                              
      *<<<< GVT_FEC_TSN                                                 
      *                                                                 

           MOVE FEC-FBLK-S TO FEC-FBLK.

           MOVE FEC-CHOY-N TO FEC-CHOY.
           IF WSS-FEC-FTSN IN CMA-VARI > ZEROES
               MOVE WSS-FEC-FTSN IN CMA-VARI TO FEC-FVLD IN FEC-VARI
           ELSE
               MOVE 1937 TO FEC-FANO IN FEC-VARI
               MOVE   01 TO FEC-FMES IN FEC-VARI
               MOVE   01 TO FEC-FDIA IN FEC-VARI.

           MOVE FEC-SVLD TO FEC-SEC1.
           MOVE FEC-AVLD TO FEC-AEC1.
           MOVE FEC-MVLD TO FEC-MEC1.
           MOVE FEC-DVLD TO FEC-DEC1.

           MOVE GVT-NUM-STSN IN GVT-FLD TO FEC-SEC2.
           MOVE GVT-NUM-ATSN IN GVT-FLD TO FEC-AEC2.
           MOVE GVT-NUM-MTSN IN GVT-FLD TO FEC-MEC2.
           MOVE GVT-NUM-DTSN IN GVT-FLD TO FEC-DEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-GRT
               MOVE 'BGL'          TO MSG-COD-SIST
               MOVE 'GVTTSNANTIGU' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GVT-FEC-FTSN.

      * EVA-AFRI/MAY2006                                                
                                                                        
           IF ((SCR-CMND = 'ING' OR SCR-CMND = 'MOD') AND               
               (GDG-TIP-CGTA IN GVT-FLD = '951' OR                      
                GDG-TIP-CGTA IN GVT-FLD = '952'))                       
                MOVE GDG-TIP-CGTA IN GVT-FLD TO TAG-COD-TOPE IN TAG     
                MOVE GDG-STP-CGTA IN GVT-FLD TO TAG-COD-SOPE IN TAG     
                MOVE FIO-GET-KEY TO FIO-CMND                            
                PERFORM BGL-FIO-TAG                                     
                IF NOT FIO-STAT-OKS                                     
                   GO TO FIN-VAL-GVT-FEC-FTSN                           
                ELSE                                                    
                  MOVE TAG-NUM-PVTS IN TAG TO WSS-NUM-PVTS              
                  MOVE TAG-COD-TPVT IN TAG TO WSS-COD-TPVT              
                  IF WSS-COD-TPVT = 'A'                                 
                     MOVE HOY-DHOY TO FEC-ITM1                          
                     MOVE HOY-MHOY TO FEC-ITM2                          
                     MOVE HOY-SHOY TO FEC-ITM3                          
                     MOVE HOY-AHOY TO FEC-ITM4                          
                     MOVE FEC-FORM-FEC TO FEC-FORM                      
                     MOVE WSS-NUM-PVTS TO FEC-NANO                      
                     MOVE FEC-RST-ANO  TO FEC-CMND                     
                     PERFORM CAL-FEC                                    
                     MOVE GVT-NUM-STSN IN GVT-FLD TO WSS-NUM-STSC       
                     MOVE GVT-NUM-ATSN IN GVT-FLD TO WSS-NUM-ATSC       
                     MOVE GVT-NUM-MTSN IN GVT-FLD TO WSS-NUM-MTSC       
                     MOVE GVT-NUM-DTSN IN GVT-FLD TO WSS-NUM-DTSC       
                     MOVE FEC-ITM3                TO WSS-NUM-STM3       
                     MOVE FEC-ITM4                TO WSS-NUM-ATM4       
                     MOVE FEC-ITM2                TO WSS-NUM-MTM2       
                     MOVE FEC-ITM1                TO WSS-NUM-DTM1       
                     IF WSS-FEC-FTSC < WSS-FEC-FECH                     
                         MOVE 'BGL'            TO MSG-COD-SIST          
                         MOVE 'FEC > LIMTAG'   TO MSG-COD-MENS          
                         PERFORM GET-MSG                                
                         MOVE MSG-GLS-DESC     TO FRM-MENS              
                         MOVE FRM-SUAR-MAL     TO FRM-SUAR              
                         GO TO FIN-VAL-GVT-FEC-FTSN                     
                ELSE                                                    
                IF WSS-COD-TPVT = 'M'                                   
                     MOVE HOY-DHOY TO FEC-ITM1                          
                     MOVE HOY-MHOY TO FEC-ITM2                          
                     MOVE HOY-SHOY TO FEC-ITM3                          
                     MOVE HOY-AHOY TO FEC-ITM4                          
                     MOVE FEC-FORM-FEC TO FEC-FORM                      
                     MOVE WSS-NUM-PVTS TO FEC-NMES                      
                     MOVE FEC-RST-MES  TO FEC-CMND                      
                     PERFORM CAL-FEC                                    
                     MOVE GVT-NUM-STSN IN GVT-FLD TO WSS-NUM-STSC       
                     MOVE GVT-NUM-ATSN IN GVT-FLD TO WSS-NUM-ATSC       
                     MOVE GVT-NUM-MTSN IN GVT-FLD TO WSS-NUM-MTSC       
                     MOVE GVT-NUM-DTSN IN GVT-FLD TO WSS-NUM-DTSC       
                     MOVE FEC-ITM3                TO WSS-NUM-STM3       
                     MOVE FEC-ITM4                TO WSS-NUM-ATM4       
                     MOVE FEC-ITM2                TO WSS-NUM-MTM2       
                     MOVE FEC-ITM1                TO WSS-NUM-DTM1       
                     IF WSS-FEC-FTSC < WSS-FEC-FECH                     
                         MOVE 'BGL'            TO MSG-COD-SIST          
                         MOVE 'FEC > LIMTAG'   TO MSG-COD-MENS          
                         PERFORM GET-MSG                                
                         MOVE MSG-GLS-DESC     TO FRM-MENS              
                         MOVE FRM-SUAR-MAL     TO FRM-SUAR              
                         GO TO FIN-VAL-GVT-FEC-FTSN                     
                ELSE                                                    
                IF WSS-COD-TPVT = 'D'                                   
                     MOVE HOY-DHOY TO FEC-ITM1                          
                     MOVE HOY-MHOY TO FEC-ITM2                          
                     MOVE HOY-SHOY TO FEC-ITM3                          
                     MOVE HOY-AHOY TO FEC-ITM4                          
                     MOVE FEC-FORM-FEC TO FEC-FORM                      
                     MOVE WSS-NUM-PVTS TO FEC-NDIA                      
                     MOVE FEC-RST-DIA  TO FEC-CMND                      
                     PERFORM CAL-FEC                                    
                     MOVE GVT-NUM-STSN IN GVT-FLD TO WSS-NUM-STSC       
                     MOVE GVT-NUM-ATSN IN GVT-FLD TO WSS-NUM-ATSC       
                     MOVE GVT-NUM-MTSN IN GVT-FLD TO WSS-NUM-MTSC       
                     MOVE GVT-NUM-DTSN IN GVT-FLD TO WSS-NUM-DTSC       
                     MOVE FEC-ITM3                TO WSS-NUM-STM3       
                     MOVE FEC-ITM4                TO WSS-NUM-ATM4       
                     MOVE FEC-ITM2                TO WSS-NUM-MTM2       
                     MOVE FEC-ITM1                TO WSS-NUM-DTM1       
                     IF WSS-FEC-FTSC < WSS-FEC-FECH                     
                         MOVE 'BGL'            TO MSG-COD-SIST          
                         MOVE 'FEC > LIMTAG'   TO MSG-COD-MENS          
                         PERFORM GET-MSG                                
                         MOVE MSG-GLS-DESC     TO FRM-MENS              
                         MOVE FRM-SUAR-MAL     TO FRM-SUAR              
                         GO TO FIN-VAL-GVT-FEC-FTSN.                    
      * FIN-AFRI/MAY2006                                                
      *>>>>
*% END
*% LBL = ''
*% IF INI_GVT_FEC_FRVL
      *<<<<                               
           MOVE FEC-VAL-FEC TO FEC-CMND.                                
      *AFRI-INI/JUL2005                                                 
           IF SCR-HDR-MRCA = 'BCS'                                      
              MOVE FEC-CHOY-N TO FEC-CHOY.                              
      *AFRI-FIN/JUL2005  
           PERFORM PRO-FEC.                                               
      *AFRI-INI/JUL2005                                                 
           IF SCR-HDR-MRCA = 'BCS'                                      
               IF FEC-STAT-FER                                          
                   MOVE FEC-FORM-FEC TO FEC-FORM                        
                   MOVE FEC-FBLK-N  TO FEC-FBLK                         
                   MOVE FEC-CHOY-N  TO FEC-CHOY                         
                   MOVE FEC-SIG-HBL TO FEC-CMND                         
                   PERFORM CAL-FEC                                      
                   MOVE  '00' TO FEC-STAT.                              
           GO TO CNT-FEC-FRVL.
      *AFRI-FIN/JUL2005                                                 
      *>>>>
*% END
*% IF GVT_FEC_FRVL
      *<<<< GVT_FEC_FRVL
       CNT-FEC-FRVL.
           IF FEC-STAT-OKS
               MOVE FEC-FECH TO GVT-FEC-FRVL IN GVT-FLD
           ELSE
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE FEC-MENS     TO FRM-MENS
               GO TO FIN-VAL-GVT-FEC-FRVL.

           MOVE FEC-CHOY-N TO FEC-CHOY.
           MOVE GVT-NUM-STSN IN GVT-FLD TO FEC-SEC1.
           MOVE GVT-NUM-ATSN IN GVT-FLD TO FEC-AEC1.
           MOVE GVT-NUM-MTSN IN GVT-FLD TO FEC-MEC1.
           MOVE GVT-NUM-DTSN IN GVT-FLD TO FEC-DEC1.

           MOVE GVT-NUM-SRVL IN GVT-FLD TO FEC-SEC2.
           MOVE GVT-NUM-ARVL IN GVT-FLD TO FEC-AEC2.
           MOVE GVT-NUM-MRVL IN GVT-FLD TO FEC-MEC2.
           MOVE GVT-NUM-DRVL IN GVT-FLD TO FEC-DEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-GRT
               MOVE 'BGL'          TO MSG-COD-SIST
               MOVE 'GVTRVLANTIGU' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GVT-FEC-FRVL.

           IF GAR-NUM-PVTS IN CMA-VARI NOT > ZEROES
               GO TO FIN-VAL-VIG-RVL.

      * Suma periodo de vigencia a Fecha Tasacion

           MOVE GVT-NUM-STSN IN GVT-FLD TO FEC-ITM3.
           MOVE GVT-NUM-ATSN IN GVT-FLD TO FEC-ITM4.
           MOVE GVT-NUM-MTSN IN GVT-FLD TO FEC-ITM2.
           MOVE GVT-NUM-DTSN IN GVT-FLD TO FEC-ITM1.

           IF GAR-COD-TPVT IN CMA-VARI = 'A'
               MOVE GAR-NUM-PVTS IN CMA-VARI TO FEC-NANO
               MOVE FEC-SUM-ANO              TO FEC-CMND
           ELSE
           IF GAR-COD-TPVT IN CMA-VARI = 'M'
               MOVE GAR-NUM-PVTS IN CMA-VARI TO FEC-NMES
               MOVE FEC-SUM-MES              TO FEC-CMND
           ELSE
           IF GAR-COD-TPVT IN CMA-VARI = 'D'
               MOVE GAR-NUM-PVTS IN CMA-VARI TO FEC-NDIA
               MOVE FEC-SUM-DIA              TO FEC-CMND.
           MOVE FEC-FORM-FEC TO FEC-FORM.
*% IF NOT PGM_VMS
      *<<<< NOT PGM_VMS
           PERFORM CAL-FEC.
      *>>>>
*% END
           
      * Usa fecha resultante como Fecha Maxima de Revalorizacion
           MOVE FEC-ITM1 TO FEC-DEC1.
           MOVE FEC-ITM2 TO FEC-MEC1.
           MOVE FEC-ITM3 TO FEC-SEC1.
           MOVE FEC-ITM4 TO FEC-AEC1.

           MOVE GVT-NUM-SRVL IN GVT-FLD TO FEC-SEC2.
           MOVE GVT-NUM-ARVL IN GVT-FLD TO FEC-AEC2.
           MOVE GVT-NUM-MRVL IN GVT-FLD TO FEC-MEC2.
           MOVE GVT-NUM-DRVL IN GVT-FLD TO FEC-DEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-LES
               MOVE 'BGL'          TO MSG-COD-SIST
               MOVE 'GVTRVL>VIG'   TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GVT-FEC-FRVL.
       FIN-VAL-VIG-RVL.
      *>>>>
*% END
*% LBL = ''
*% IF GVT_SGV_VCTS
      *<<<< GVT_VAL_CML_TSN
      * EVA-INI/MAY2006                                                 
           IF (SCR-CMND = 'ING' OR SCR-CMND = 'MOD')                    
      *MVG-INI 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
      *        IF (GVT-SGV-VCTS IN GVT-FLD NOT > 1)
              IF (GVT-SGV-VCTS IN GVT-FLD < 1)
      *MVG-FIN 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
                 MOVE 'BGL'          TO MSG-COD-SIST                    
                 MOVE 'VLRNOPERM'    TO MSG-COD-MENS                    
                 PERFORM GET-MSG                                        
                 MOVE MSG-GLS-DESC TO FRM-MENS                          
                 MOVE FRM-SUAR-MAL TO FRM-SUAR                          
                 GO TO FIN-VAL-GVT-SGV-VCTS.                            
      *FIN-AFRI/MAY2006                                                 

      *CGL-INI
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN GVT-FLD TO WSS-TIPO-1 IN WSS-VARI.
           MOVE GDG-STP-CGTA IN GVT-FLD TO WSS-AUX-1 IN WSS-VARI.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TIAU IN WSS-VARI.

           PERFORM OBT-COD-MNAC.
           IF SCR-CCPP = 'ING' AND
              FRM-IND-GTP IN GVT-FLD = 'S'
               GO TO FIN-VAL-GVT-SGV-VCTS.

           IF FRM-IND-GTP IN GVT-FLD = 'S'
               MOVE SPACES TO MSG-COD-MENS
               MOVE ZEROES TO WSS-SGV-VCTS-AUX
      *MHM-INI 07-ENE-2004
               MOVE ZEROES TO WSS-VALOR-LIQ IN CMA-VARI
      *MHM-FIN 07-ENE-2004

               MOVE GVT-CAI-GTIA IN GVT-FLD TO GTP-CAI-GTIA IN GTP
               MOVE GVT-IIC-GTIA IN GVT-FLD TO GTP-IIC-GTIA IN GTP
               MOVE GVT-COD-TASN IN GVT-FLD TO GTP-NUM-ITSN IN GTP
               MOVE '00' TO FIO-STAT

      *        Suma las tasaciones parciales para llenar valores CML y LIQ
               PERFORM TOT-GTP
               VARYING GAR-COD-ITSN IN WSS-VARI
                     FROM 1 
                     BY   1 
                     UNTIL ( NOT FIO-STAT-OKS) OR 
                           ( MSG-COD-MENS > SPACES)
      * 
      *MVG-INI 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
           IF WSS-VALOR-LIQ NOT > 1
                  MOVE 1 TO WSS-VALOR-LIQ
                  IF MSG-COD-MENS > SPACES
                      GO TO FIN-VAL-GVT-SGV-VCTS
                  ELSE
                      IF WSS-SGV-VCTS-AUX NOT > ZEROES
                          MOVE 1 TO GVT-SGV-VCTS IN GVT-FLD
                      ELSE
                      MOVE WSS-SGV-VCTS-AUX TO GVT-SGV-VCTS IN GVT-FLD
               ELSE
      *MVG-FIN 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1

               IF MSG-COD-MENS > SPACES
                  GO TO FIN-VAL-GVT-SGV-VCTS
               ELSE
      *MVG-INI 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
               IF WSS-SGV-VCTS-AUX NOT > ZEROES
                  MOVE 1 TO GVT-SGV-VCTS IN GVT-FLD
               ELSE
      *MVG-FIN 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
                  MOVE WSS-SGV-VCTS-AUX TO GVT-SGV-VCTS IN GVT-FLD.

      * Obtiene valor sin decimales
           IF FIO-STAT-OKS AND 
              GDG-COD-VCAM  IN GVT-FLD = WSS-COD-PESO IN WSS-VARI
               MOVE GVT-SGV-VCTS IN GVT-FLD TO 
                    PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO
                    GVT-SGV-VCTS IN GVT-FLD.
      *>>>>
*% END
*% IF GVT_VAL_LIQ_TSN
      *<<<< GVT_VAL_LIQ_TSN
      *>>>>
*% END
*% IF NOT (PGM_PER OR PGM_CLB OR PGM_MEX)
*% IF GVT_SGV_PPCT
      *
      *<<<< GVT_PCT_PON
           IF GVT-SGV-PPCT IN GVT-FLD = ZEROES
               MOVE GAR-SGV-PPON IN CMA-VARI TO GVT-SGV-PPCT IN GVT-FLD
           ELSE
           IF GVT-SGV-PPCT IN GVT-FLD > 100
               MOVE '% > 100' TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>>
*% END
*% END
*% IF GVT_SGV_LTSN
      *<<<< GVT_SGV_LTSN
*% IF GEN_BCI
      *<<<< GEN_BCI
      * EVA-INI   10/07                                                 
                                                                        
           IF NOT (SCR-CMND = 'RTA' OR SCR-CMND = 'RVL')                
              GO TO VAL-COD-FISCO.                                      
                                                                        
           MOVE ZEROES TO WSS-VAL-PCTJ.                                 
           MOVE ZEROES TO WSS-AUX-PCTJ.                                 
                                                                        
           IF GVT-COD-EITS IN GVT-FLD NOT = '900'                       
              GO TO VAL-COD-FISCO.                                      
                                                                        
           MOVE GVT-CAI-GTIA IN GVT-FLD TO GVT-CAI-GTIA IN GVT.         
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GVT-IIC-GTIA IN GVT.         
           MOVE 999                     TO GVT-COD-TASN IN GVT.         
           MOVE FIO-GET-LEQ TO FIO-CMND.                                
       LUP-COD-FISCO.                                                   
           PERFORM BGL-FIO-GVT.                                         
           IF NOT (FIO-STAT-OKS AND                                     
               GVT-CAI-GTIA IN GVT-FLD = GVT-CAI-GTIA IN GVT AND        
               GVT-IIC-GTIA IN GVT-FLD = GVT-IIC-GTIA IN GVT)           
               GO TO FIN-VAL-GVT-SGV-LTSN.                              
                                                                        
           IF GVT-COD-EITS IN GVT = '900'                               
              MOVE FIO-GET-PRV TO FIO-CMND                              
              GO TO LUP-COD-FISCO.                                      
                                                                        
           IF GVT-SGV-VCTS IN GVT = GVT-SGV-LTSN IN GVT AND             
              GVT-SGV-VCTS IN GVT-FLD NOT = GVT-SGV-LTSN IN GVT-FLD     
               MOVE 'TAB'     TO MSG-COD-SIST                           
               MOVE 'VAL LIQ<>TAS' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE FRM-SUAR-MAL TO FRM-SUAR                            
               GO TO FIN-VAL-GVT-SGV-LTSN.                              
                                                                        
           IF GVT-SGV-VCTS IN GVT > GVT-SGV-LTSN IN GVT                 
              COMPUTE WSS-VAL-PCTJ ROUNDED =                            
             (GVT-SGV-VCTS IN GVT * 100 / GVT-SGV-LTSN IN GVT)          
           ELSE                                                         
              COMPUTE WSS-VAL-PCTJ ROUNDED =                            
             (GVT-SGV-LTSN IN GVT * 100 / GVT-SGV-VCTS IN GVT).         
                                                                        
           IF GVT-SGV-VCTS IN GVT-FLD > GVT-SGV-LTSN IN GVT-FLD         
              COMPUTE WSS-AUX-PCTJ ROUNDED =                            
             (GVT-SGV-VCTS IN GVT-FLD * 100 / GVT-SGV-LTSN IN GVT-FLD)  
           ELSE                                                         
              COMPUTE WSS-AUX-PCTJ ROUNDED =                            
             (GVT-SGV-LTSN IN GVT-FLD * 100 / GVT-SGV-VCTS IN GVT-FLD). 
                                                                        
           IF NOT (WSS-VAL-PCTJ = WSS-AUX-PCTJ)                         
               MOVE 'TAB'     TO MSG-COD-SIST                           
               MOVE 'PCTJLIQ<>TAS' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE FRM-SUAR-MAL TO FRM-SUAR                            
               GO TO FIN-VAL-GVT-SGV-LTSN.                              
       VAL-COD-FISCO.                                                   
      * EVA-FIN   10/07                                                 
      *FLB CST  4-MAY-1994 ARREGLADO MEJOR QUE ARGENTINA
           IF FRM-IND-GTP IN GVT-FLD = 'S' AND
              WSS-LIQ-CML IN CMA-VARI > ZEROES AND
              WSS-SGV-LTSN IN CMA-VARI =
              GVT-SGV-LTSN IN GVT-FLD
      *CGL-INI
      *AFRI-INI / JUN2006                                               
      *       IF WSS-CIC-TIAU IN WSS-VARI NOT = '952086'                
              IF NOT(WSS-CIC-TIAU IN WSS-VARI  = '952086' OR            
                     WSS-CIC-TIAU IN WSS-VARI  = '952686')              
      *AFRI-FIN / JUN2006                                               
      *CGL-FIN
                 MULTIPLY WSS-LIQ-CML     IN CMA-VARI BY
                        GVT-SGV-VCTS IN GVT-FLD GIVING
                        GVT-SGV-LTSN IN GVT-FLD ROUNDED
      *CGL-INI
              ELSE    
                 COMPUTE WSS-VALOR-LIQ IN CMA-VARI ROUNDED =
                         WSS-VALOR-LIQ IN CMA-VARI * 1
                 MOVE WSS-VALOR-LIQ IN CMA-VARI TO 
                      GVT-SGV-LTSN IN GVT-FLD.
      *CGL-FIN

           IF GDG-COD-VCAM IN GVT-FLD = WSS-COD-PESO IN WSS-VARI
               MOVE GVT-SGV-LTSN IN GVT-FLD TO 
                    PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO
                    GVT-SGV-LTSN IN GVT-FLD.

            IF NOT (
                    SCR-CCPP = 'ING' AND
                    FRM-IND-GTP IN GVT-FLD = 'S'
                   ) AND
               GVT-SGV-LTSN IN GVT-FLD NOT > ZEROES
      *        Solo puede ser 0 al Ingresar GVT con Tasaciones Parciales

                MOVE 'BGL'      TO MSG-COD-SIST
                MOVE 'GVTLIQ=0' TO MSG-COD-MENS
                PERFORM GET-MSG
                MOVE MSG-GLS-DESC TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                GO TO FIN-VAL-GVT-SGV-LTSN.

      *EVA-AFRI/MAY2006                                                 
           IF (SCR-CMND = 'ING' OR SCR-CMND = 'MOD')                    
      *MVG-INI 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
      *        IF (GVT-SGV-LTSN IN GVT-FLD NOT > 1) AND
              IF (GVT-SGV-LTSN IN GVT-FLD < 1) AND
      *MVG-FIN 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
              FRM-IND-GTP IN GVT-FLD = 'N'                              
                 MOVE 'BGL'          TO MSG-COD-SIST                    
                 MOVE 'VLRNOPERM'    TO MSG-COD-MENS                    
                 PERFORM GET-MSG                                        
                 MOVE MSG-GLS-DESC TO FRM-MENS                          
                 MOVE FRM-SUAR-MAL TO FRM-SUAR                          
                 GO TO FIN-VAL-GVT-SGV-LTSN.                            
      *FIN-AFRI/MAY2006                                                 

           IF GVT-SGV-LTSN IN GVT-FLD >
              GVT-SGV-VCTS IN GVT-FLD AND
              NOT (
                  SCR-CCPP = 'ING' AND FRM-IND-GTP IN GVT-FLD = 'S'
                  )
      *MHM-INI 07-ENE-2004
      *AFRI-INI /JUN2006                                                
      *        AND NOT ( SCR-CMND = 'ATA' AND WSS-CIC-TIAU = '952086' ) 
               AND NOT ( SCR-CMND = 'ATA' AND                           
                             (WSS-CIC-TIAU = '952086' OR                
                              WSS-CIC-TIAU = '952686'))                 
      *AFRI-FIN /JUN2006                                                
      *MHM-FIN 07-ENE-2004
               MOVE 'BGL'     TO MSG-COD-SIST
               MOVE 'GVTLIQ>CML' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GVT-SGV-LTSN.
      *>>>>
      *>>>>
      *PVC-INI 19-OCT-2012  -  ADMINISTRACION DE PRENDAS WARRANTS
           MOVE 'BGL'               TO TAB-COD-SIST FIO-SIST
           MOVE 'MHW'               TO TAB-COD-TTAB IN TAB
           MOVE WSS-CIC-TIAU        TO TAB-COD-CTAB IN TAB
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM GNS-FIO-TAB
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
               COMPUTE  GVT-SGV-LTSN IN GVT-FLD ROUNDED =
                        GVT-SGV-VCTS IN GVT-FLD -
                       (GVT-SGV-VCTS IN GVT-FLD *
                        GAR-SGV-PAJU IN CMA-VARI / 100)
                   GO TO FIN-VAL-GVT-SGV-LTSN.
           MOVE '*' TO WSS-AUX-1
           MOVE WSS-TIPO-AUX     TO TAB-COD-CTAB IN TAB
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM GNS-FIO-TAB
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
               COMPUTE  GVT-SGV-LTSN IN GVT-FLD ROUNDED =
                        GVT-SGV-VCTS IN GVT-FLD -
                       (GVT-SGV-VCTS IN GVT-FLD *
                        GAR-SGV-PAJU IN CMA-VARI / 100).
      *PVC-FIN 19-OCT-2012
      *>>>>
*% END
      *>>>>
*% END
*% IF GVT_SGV_VPND
      *<<<< GVT_SGV_VPND
*% IF GEN_BCI
      *<<<< GEN_BCI
           COMPUTE GVT-SGV-VPND IN GVT-FLD ROUNDED =
                   GVT-SGV-LTSN IN GVT-FLD *
                   GVT-SGV-PPCT IN GVT-FLD / 100.

           IF GDG-COD-VCAM IN GVT-FLD = WSS-COD-PESO IN WSS-VARI
               MOVE GVT-SGV-VPND  IN GVT-FLD TO 
                    PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO
                    GVT-SGV-VPND  IN GVT-FLD.
      *>>>>
*% ELSE
*% IF NOT (PGM_PER OR PGM_CLB OR PGM_MEX)

           COMPUTE GVT-SGV-VPND IN GVT-FLD ROUNDED =
                   GVT-SGV-LTSN IN GVT-FLD *
                   GVT-SGV-PPCT IN GVT-FLD / 100.

*% END
           IF GVT-SGV-VPND IN GVT-FLD > GVT-SGV-VCTS IN GVT-FLD
               MOVE 'BGL'        TO MSG-COD-SIST
               MOVE 'VCNT>VCML'  TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GVT-SGV-VPND.

      *
           MOVE GAR-CAI-GTIA IN CMA-VARI TO GSE-CAI-GTIA IN GSE.    
           MOVE GAR-IIC-GTIA IN CMA-VARI TO GSE-IIC-GTIA IN GSE.    
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GSE.
      *
      *    IF FIO-STAT-OKS
           IF NOT FIO-STAT-OKS
              GO TO FIN-VAL-GVT-SGV-VPND.
*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GDG-TIP-CGTA IN GVT-FLD TO WSS-COD-TOPE.        
           MOVE GDG-STP-CGTA IN GVT-FLD TO WSS-COD-SOPE.        
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GVT-FLD TO WSS-TSG-OPE.        
*% END
           MOVE  'TAB'                 TO TAB-COD-SIST.       
           MOVE  'NVA'                 TO TAB-COD-TTAB IN TAB.
           MOVE  WSS-TSG-OPE           TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.                                   
           IF MSG-COD-MENS NOT > SPACES                       
              GO TO FIN-VAL-GVT-SGV-VPND.                        
      *
           IF GVT-SGV-VPND IN GVT-FLD > GSE-SGV-SEGU IN GSE
              MOVE 'BGL'        TO MSG-COD-SIST
              MOVE 'VCCTB>VCSEG'  TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE FRM-SUAR-MAL TO FRM-SUAR
              GO TO FIN-VAL-GVT-SGV-VPND.
      *
*% END
      *>>>>
*% END
*% IF GVT_PCT_AJT_SUP
      *>>>>
*% END
*% IF GVT_SGV_PAJU
      *<<<< GVT_SGV_PAJU
           MOVE GAR-SGV-PAJU IN CMA-VARI TO GVT-SGV-PAJU IN GVT-FLD.
      *>>>>
*% END
*% IF (PGM_PER OR PGM_CLB OR PGM_MEX)
*% IF FRM_VAL_AJT_SUP
      *<<<< FRM_VAL_AJT_SUP
      *>>>>
*% END
*% END
*% IF GVT_SGV_VGAS
      *<<<< GVT_VAL_AJT_SUP
*% IF GEN_BCI
      *<<<< GEN_BCI
      *AFRI-INI                                                         
           IF SCR-HDR-MRCA = 'BCS'                                      
               IF GVT-SGV-VCTS IN GVT-FLD NOT >                         
                  GVT-SGV-LTSN IN GVT-FLD                               
                   COMPUTE   GVT-SGV-VGAS IN GVT-FLD ROUNDED =          
                     GVT-SGV-VCTS IN GVT-FLD -                          
                     ( GVT-SGV-VCTS IN GVT-FLD *                        
                     GAR-SGV-PAJU     IN CMA-VARI / 100 )               
               ELSE                                                     
                   COMPUTE   GVT-SGV-VGAS IN GVT-FLD ROUNDED =          
                     GVT-SGV-LTSN IN GVT-FLD -                          
                     ( GVT-SGV-LTSN IN GVT-FLD *                        
                     GAR-SGV-PAJU     IN CMA-VARI / 100 )               
           ELSE                                                         
      *AFRI-INI/ JUN2006                                                
      *    IF WSS-CIC-TIAU IN WSS-VARI = '952086'                       
      *OGB-INI VALIDACIONES VALORES EN GVT 03-MAY-2017
      *    IF ( WSS-CIC-TIAU IN WSS-VARI = '952086'  OR
      *         WSS-CIC-TIAU IN WSS-VARI = '952686' )
           IF ( WSS-CIC-TIAU IN WSS-VARI = '952086'  OR
                WSS-CIC-TIAU IN WSS-VARI = '952686' ) OR
                FRM-IND-GTP IN GVT-FLD = 'S'
      *OGB-FIN VALIDACIONES VALORES EN GVT 03-MAY-2017
      *AFRI-FIN/ JUN2006                                                
              MOVE GVT-SGV-LTSN IN GVT-FLD TO GVT-SGV-VGAS IN GVT-FLD   
           ELSE                                                         
      *AFRI-FIN                                                         

           COMPUTE   GVT-SGV-VGAS IN GVT-FLD ROUNDED =
                     GVT-SGV-VCTS IN GVT-FLD -
                   ( GVT-SGV-VCTS IN GVT-FLD *
                     GAR-SGV-PAJU     IN CMA-VARI / 100 ).

           IF GDG-COD-VCAM IN GVT-FLD = WSS-COD-PESO IN WSS-VARI
               MOVE GVT-SGV-VGAS IN GVT-FLD TO 
                    PES-SGV-DECI    IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE    IN PES-VARI TO
                    GVT-SGV-VGAS IN GVT-FLD.
      * EVA-AFRI/MAY2006                                                
           IF ((SCR-CMND = 'ING' OR SCR-CMND = 'MOD') AND               
      *AFRI-INI/JUN2006                                                 
      *       (WSS-CIC-TIAU IN WSS-VARI NOT = '952086'))                
              (WSS-CIC-TIAU IN WSS-VARI NOT = '952086'  OR              
               WSS-CIC-TIAU IN WSS-VARI NOT = '952686'))                
      *AFRI-FIN/JUN2006                                                 
               IF NOT ((GVT-SGV-VGAS IN GVT-FLD <                       
                        GVT-SGV-VCTS IN GVT-FLD) OR                     
                       (GVT-SGV-VGAS IN GVT-FLD =                       
                        GVT-SGV-VCTS IN GVT-FLD))                       
                  MOVE 'BGL'       TO MSG-COD-SIST                      
                  MOVE 'M.LEG>V.TSC' TO MSG-COD-MENS                    
                  PERFORM GET-MSG                                       
                  MOVE MSG-GLS-DESC TO FRM-MENS                         
                  MOVE FRM-SUAR-MAL TO FRM-SUAR                         
                  GO TO FIN-VAL-GVT-SGV-VGAS.                           
      * FIN-AFRI/MAY2006                                                
      *>>>>
*% ELSE
           MOVE GVT-SGV-VCTS IN GVT-FLD TO GVT-SGV-VGAS IN GVT-FLD.
*% END

      * Se contabiliza por valor ajustado, luego debe ser > 0
      *    salvo en el ingreso con Tasaciones Parciales
           IF NOT (
                   SCR-CCPP = 'ING' AND 
                   FRM-IND-GTP IN GVT-FLD = 'S'
                  ) AND
                   GVT-SGV-VGAS IN GVT-FLD NOT > ZEROES

                MOVE 'BGL'     TO MSG-COD-SIST
                MOVE 'GVTAJT=0' TO MSG-COD-MENS
                PERFORM GET-MSG
                MOVE MSG-GLS-DESC TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR.

      *MVG-INI 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
           IF GVT-SGV-LTSN IN GVT-FLD = 1 AND
              GVT-SGV-VCTS IN GVT-FLD = 1
                GO TO FIN-VAL-GVT-SGV-VGAS.
      *MVG-FIN 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1

      *OGB-INI VALIDACIONES VALORES EN GVT 03-MAY-2017
           IF SCR-CMND NOT = 'MTA' AND FRM-IND-GTP IN GVT-FLD NOT = 'S'
           IF GVT-SGV-LTSN IN GVT-FLD > GVT-SGV-VGAS IN GVT-FLD
                MOVE WSS-CTE-BGL    TO MSG-COD-SIST
                MOVE WSS-CTE-MSG01  TO MSG-COD-MENS
                PERFORM GET-MSG
                MOVE MSG-GLS-DESC TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR.
                
      *OGB-FIN VALIDACIONES VALORES EN GVT 03-MAY-2017
           PERFORM OBT-VAL-CON.
      *>>>>
*% END
*% IF GVT_COD_TCNS
      *<<<< GVT_TIP_CTR
      *ALD-BNL
      * PARA GAR-IND-TPRE = 'E' NO OBLIGA CAMPO GVT-COD-TCNS
      *
           IF GAR-IND-TPRE IN CMA-VARI = 'N' OR
              GAR-IND-TPRE IN CMA-VARI = 'E'

               MOVE SPACES TO GVT-COD-TCNS IN GVT-FLD
               MOVE SPACES TO FRM-GLS-TCNS IN GVT-FLD
               GO TO FIN-VAL-GVT-COD-TCNS.

           IF GVT-COD-TCNS IN GVT-FLD = SPACES
               MOVE 'BGL'        TO MSG-COD-SIST
               MOVE 'TIPCTR BLK' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GVT-COD-TCNS.
      *>>>>
*% END
*% IF GVT_COD_MQEQ
      *<<<< GVT_TIP_MAQ_EQP
      *
           IF GAR-IND-TPRE IN CMA-VARI NOT = 'E'
               MOVE SPACES TO GVT-COD-MQEQ IN GVT-FLD
               MOVE SPACES TO FRM-GLS-MQEQ IN GVT-FLD
               GO TO FIN-VAL-GVT-COD-MQEQ.

           IF GVT-COD-MQEQ IN GVT-FLD = SPACES
               MOVE 'BGL'        TO MSG-COD-SIST
               MOVE 'TIPMEQ BLK' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GVT-COD-MQEQ.
      *>>>>
*% END
*% IF GVT_VAL_TTM2
      *<<<< GVT_VAL-TTM2
           IF NOT ( GAR-IND-OMCT IN CMA-VARI = 'T' OR 'A' )
               MOVE ZEROES TO GVT-VAL-TTM2 IN GVT-FLD
               GO TO FIN-VAL-GVT-VAL-TTM2.

           IF GVT-VAL-TTM2 IN GVT-FLD = ZEROES
               MOVE 'BGL'        TO MSG-COD-SIST
               MOVE 'M2TRR BLK'  TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GVT-VAL-TTM2.
      *>>>>
*% END
*% IF GVT_COD_M2CT
      *<<<< GVT_M2_CTR
           IF NOT ( GAR-IND-OMCT IN CMA-VARI = 'C' OR 'A' )
               MOVE ZEROES TO GVT-COD-M2CT IN GVT-FLD
               GO TO FIN-VAL-GVT-COD-M2CT.

           IF GVT-COD-M2CT IN GVT-FLD = ZEROES
               MOVE 'BGL'        TO MSG-COD-SIST
               MOVE 'M2CTR BLK'  TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GVT-COD-M2CT.
      *>>>>
*% END
*% IF GVT_COD_UMD
      *<<<< GVT_COD_UMD
           IF NOT ( GAR-IND-OMCT IN CMA-VARI = 'C' OR 'T' OR 'A' )
               MOVE SPACES TO GVT-COD-UMD IN GVT-FLD
               GO TO FIN-VAL-GVT-COD-UMD.

           IF GVT-COD-UMD IN GVT-FLD = SPACES
               MOVE 'BGL'        TO MSG-COD-SIST
               MOVE 'CODUMD BLK' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GVT-COD-UMD.
      *>>>>
*% END
*% IF EOF_VAX OR EOF_BU
      *<<<< EOF_VAX OR EOF_BU
       TOT-GTP SECTION.
       INI-TOT-GTP.
      *    Devuelve Sumatoria Tasaciones Parciales en WSS-SGV-VCTS-AUX

           MOVE GAR-COD-ITSN IN WSS-VARI TO
                GTP-COD-ITSN IN GTP.

           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GTP.
      *MVG-INI 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
           MOVE GTP-SGV-VTSN IN GTP TO WSS-VAR-LTSN.
           IF WSS-VAR-LTSN = 1
              MOVE ZEROES TO WSS-VAR-LTSN.
      *MVG-FIN 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1

      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
           IF WSS-IND-FFMM = WSS-S
              COMPUTE WSS-GTP-ITSN ROUNDED
                                    = GTP-SGV-ITSN IN GTP / WSS-100
           ELSE
              MOVE GTP-SGV-ITSN IN GTP TO WSS-GTP-ITSN.
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM

           IF FIO-STAT-OKS AND
              GTP-COD-EITS IN GTP > '09' AND < '15'
              COMPUTE
                 WSS-SGV-VCTS-AUX ROUNDED = WSS-SGV-VCTS-AUX +
      *MVG-INI 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
      *AFRI-INI / NOV 2016 REDONDEAR VALOR TASACION
      **          GTP-SGV-ITSN IN GTP * GTP-SGV-VTSN IN GTP.
      *           GTP-SGV-ITSN IN GTP * GTP-SGV-VTSN IN GTP
      *        IF GDG-COD-VCAM  IN GVT-FLD = WSS-COD-PESO IN WSS-VARI
      *              MOVE WSS-SGV-VCTS-AUX        TO
      *                   PES-SGV-DECI IN PES-VARI
      *              PERFORM PES-SCTV
      *              MOVE PES-SGV-ENTE IN PES-VARI TO
      *                   WSS-SGV-VCTS-AUX.
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
      *          GTP-SGV-ITSN IN GTP * WSS-VAR-LTSN
                 WSS-GTP-ITSN        * WSS-VAR-LTSN
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM

              IF GDG-COD-VCAM  IN GVT-FLD = WSS-COD-PESO IN WSS-VARI
                    MOVE WSS-SGV-VCTS-AUX        TO
                         PES-SGV-DECI IN PES-VARI
                    PERFORM PES-SCTV
                    MOVE PES-SGV-ENTE IN PES-VARI TO
                         WSS-SGV-VCTS-AUX.
      *AFRI-FIN / NOV 2016 REDONDEAR VALOR TASACION
      *MVG-FIN 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
      *CGL-INI
      *MHM-INI 07-ENE-2004
      *    IF WSS-CIC-TIAU IN WSS-VARI = '952086'
                   IF FIO-STAT-OKS AND
              GTP-COD-EITS IN GTP > '09' AND < '15' AND
      *AFRI-INI /JUN2006                                                
      *       WSS-CIC-TIAU IN WSS-VARI = '952086'                       
             (WSS-CIC-TIAU IN WSS-VARI = '952086'  OR  = '952686')      
      *       WSS-CIC-TIAU IN WSS-VARI = '952686')                      
      *AFRI-FIN /JUN2006                                                
      *MHM-FIN 07-ENE-2004
      *AFRI-INI /JUN2006                                                
      *       MOVE GTP-COD-IITS IN GTP     TO ACC-COD-NEMO IN ACC       
      *       MOVE 99                      TO ACC-NUM-SPRO IN ACC       
      *       MOVE 99                      TO ACC-NUM-APRO IN ACC       
      *       MOVE 99                      TO ACC-NUM-MPRO IN ACC       
      *       MOVE 99                      TO ACC-NUM-DPRO IN ACC       
      *       MOVE FIO-GET-LEQ TO FIO-CMND                              
      *       PERFORM BGL-FIO-ACC                                       
      *       IF NOT (FIO-STAT-OKS AND                                  
      *               ACC-COD-NEMO IN ACC = GTP-COD-IITS IN GTP)        
      *          NEXT SENTENCE                                          
      *           MOVE 'BGL'       TO MSG-COD-SIST                      
      *           MOVE 'ACC   NEX' TO MSG-COD-MENS                      
      *           PERFORM GET-MSG                                       
      *           MOVE MSG-GLS-DESC TO FRM-MENS                         
      *           MOVE FRM-SUAR-MAL TO FRM-SUAR                         
      *       ELSE                                                      
      *                                                                 
               MOVE 'BGL'                   TO TAB-COD-SIST FIO-SIST    
               MOVE 'NEM'                   TO TAB-COD-TTAB IN TAB      
               MOVE GTP-COD-IITS IN GTP     TO TAB-COD-CTAB IN TAB      
               MOVE FIO-GET-KEY TO FIO-CMND                             
               PERFORM GNS-FIO-TAB                                      
               IF NOT (FIO-STAT-OKS AND   TAB-IND-VIGE IN TAB ='S')     
                  GO TO FIN-TOT-GTP                                     
               ELSE                                                     
                 MOVE TAB-GLS-DATA IN TAB  TO WSS-NEM-GLOSA IN WSS-VARI 
                 MOVE 'BGL'                TO TAB-COD-SIST FIO-SIST     
                 MOVE 'LST'                TO TAB-COD-TTAB IN TAB       
                 MOVE WSS-NEM-ACCN IN WSS-VARI  TO TAB-COD-CTAB IN TAB  
                 MOVE FIO-GET-KEY TO FIO-CMND                           
                 PERFORM GNS-FIO-TAB                                    
                 IF NOT (FIO-STAT-OKS AND   TAB-IND-VIGE IN TAB ='S')   
                     GO TO FIN-TOT-GTP                                  
                 ELSE                                                   
                     MOVE TAB-GLS-DATA IN TAB  TO                       
                                          WSS-LST-GLOSA IN WSS-VARI     
      *MVG-INI 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
                     IF WSS-LST-PPON IN WSS-VARI NOT > SPACES
                         GO TO FIN-TOT-GTP
                     ELSE
      *MVG-FIN 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
                     MOVE WSS-LST-PPON IN WSS-VARI TO                   
                                          WSS-NUM-PPON IN WSS-VARI      
                     COMPUTE WSS-VAL-PPON IN WSS-VARI=                  
                            WSS-NUM-PPON / 10000                        
                                                                        
                     COMPUTE WSS-VALOR-LIQ IN CMA-VARI=                 
      *MHM-INI 07-ENE-2004
      *AFRI MAYO 2006                                                   
      *          ((GTP-SGV-ITSN IN GTP * GTP-SGV-VTSN IN GTP  *         
      *                 ACC-SGV-PPON IN ACC ) / 100) +                  
      *          ((GTP-SGV-ITSN IN GTP * GTP-SGV-VTSN IN GTP ) /        
      *                  (ACC-SGV-PPON IN ACC * 100 ) +                 
      *                                                                 
      *MVG-INI 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
      *          (((GTP-SGV-ITSN IN GTP * GTP-SGV-VTSN IN GTP ) /
      *RRM-INI JUL-2018 REVALORIZACION DE FFMM
      *         (((GTP-SGV-ITSN IN GTP * WSS-VAR-LTSN ) /
                (((WSS-GTP-ITSN        * WSS-VAR-LTSN ) /
      *RRM-FIN JUL-2018 REVALORIZACION DE FFMM
      *MVG-FIN 09-ENE-2018 MODIFICAR VALIDACION LTSN = 1
                          WSS-VAL-PPON IN WSS-VARI ) +                  
                                                                        
      *AFRI MAYO 2006                                                   
      *          ((WSS-SGV-VCTS-AUX * ACC-SGV-PPON IN ACC)/100) +
      *MHM-FIN 07-ENE-2004
                   WSS-VALOR-LIQ).
      *AFRI-FIN /JUN2006                                                
      *CGL-FIN
           IF  NOT GTP-COD-EITS IN GTP > '09'
               MOVE 'BGL'      TO MSG-COD-SIST
               MOVE 'ESAP NOV' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.

       FIN-TOT-GTP.
           EXIT.
      *>>>>
*% END
*% IF EOF_VAX OR EOF
      *<<<< EOF_VAX 
       OBT-COD-MNAC SECTION.
       INI-OBT-COD-MNAC.
      * Obtiene Codigo Valor de Cambio de Pesos Mediante CIC de la Moneda '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS-VARI.
       FIN-OBT-COD-MNAC.
           EXIT.

       PRO-RTA-RDO SECTION.
       INI-PRO-RTA-RDO.
      *GET-HOY Otiene Fecha actual
           PERFORM GET-FHOY.
           MOVE HOY-FHOY TO GVT-FEC-FTSN IN GVT-FLD.
      *PROTEJE CAMPOS
           MOVE FRM-CPIM-AEY TO GVT-FEC-FTSN-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-FEC-FTSN-STP.

           MOVE FRM-CPIM-AEY TO GVT-SGV-VCTS-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-VCTS-STP.

           MOVE FRM-CPIM-AEY TO GVT-SGV-LTSN-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-LTSN-STP.

           MOVE FRM-CPIM-AEY TO GVT-SGV-VPND-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-VPND-STP.

       FIN-PRO-RTA-RDO.
           EXIT.

*% IF NOT (PGM_PER OR PGM_CLB OR PGM_MEX)

       OBT-VAL-CON SECTION.
       INI-OBT-VAL-CON.
           MOVE GDG-COD-VCAM IN GVT-FLD TO GDG-COD-VCAM IN GDG.
           IF NOT (
              GDG-COD-TVCM IN GDG = '0' AND
              GDG-COD-VCAM IN GVT-FLD NOT = WSS-COD-PESO IN WSS-VARI
              )
               MOVE GVT-SGV-VGAS IN GVT-FLD TO
                    FRM-VAL-ULT-CON IN GVT-FLD

               GO TO FIN-OBT-VAL-CON.

                                                                        
      *      ** Correcciln Monetaria - Revalorizador **      *          
      *               SEPTIEMBRE 2007  -  AFRI *             *          
                                                                        
      ** EVA-INI  09/07                                                 
                                                                        
           MOVE ZEROES TO WSS-FEC-FULR.                                 
           MOVE GVT-CAI-GTIA IN GVT-FLD TO GVT-CAI-GTIA IN GVT.         
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GVT-IIC-GTIA IN GVT.         
           MOVE GVT-COD-TASN IN GVT-FLD TO GVT-COD-TASN IN GVT.         
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-GVT.                                         
           IF NOT FIO-STAT-OKS                                          
              GO TO FIN-OBT-VAL-CON.                                    
                                                                        
           IF NOT (GVT-FEC-FURV IN GVT > ZEROES)                        
              GO TO CON-OBT-VAL.                                        
                
           IF GVT-FEC-FTSN IN GVT > GVT-FEC-FRVL IN GVT                 
              MOVE GVT-FEC-FTSN IN GVT TO WSS-FEC-FULR                  
           ELSE                                                         
              MOVE GVT-FEC-FRVL IN GVT TO WSS-FEC-FULR.                 
                                                                        
           IF GVT-FEC-FURV IN GVT > WSS-FEC-FULR                        
              MOVE GVT-FEC-FURV IN GVT TO WSS-FEC-FULR.                 
                                                                        
           MOVE WSS-NUM-SULR TO CAM-NUM-SCAM IN CAM(1).                 
           MOVE WSS-NUM-AULR TO CAM-NUM-ACAM IN CAM(1).                 
           MOVE WSS-NUM-MULR TO CAM-NUM-MCAM IN CAM(1).                 
           MOVE WSS-NUM-DULR TO CAM-NUM-DCAM IN CAM(1).                 
           GO TO NXT-OBT-VAL.                                           
                                                                        
       CON-OBT-VAL.                                                     
           MOVE GVT-NUM-SRVL IN GVT TO CAM-NUM-SCAM IN CAM(1).          
           MOVE GVT-NUM-ARVL IN GVT TO CAM-NUM-ACAM IN CAM(1).          
           MOVE GVT-NUM-MRVL IN GVT TO CAM-NUM-MCAM IN CAM(1).          
           MOVE GVT-NUM-DRVL IN GVT TO CAM-NUM-DCAM IN CAM(1).          
       NXT-OBT-VAL.                                                     
                                                                        
      ** EVA-FIN  09/07                                                 

           MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2).
           MOVE GDG-COD-VCAM IN GVT-FLD  TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT (
              FIO-STAT-OKS AND CAM-IND-VIGE IN CAM = 'S'
              )
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE 'CAM    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
           ELSE
               MULTIPLY GVT-SGV-VGAS IN GVT-FLD
                     BY CAM-SGV-VCAM    IN CAM
                 GIVING WSS-VAL-PESO ROUNDED
               MOVE WSS-VAL-PESO TO FRM-VAL-ULT-CON IN GVT-FLD.
       FIN-OBT-VAL-CON.
           EXIT.

      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
       PRO-LEE-MSG SECTION.                                             
       INI-PRO-LEE-MSG.                                                 
           MOVE SPACES TO WSS-GLS-CMSG IN WSS-VARI.
           MOVE 'BGL'                    TO TAB-COD-SIST FIO-SIST.      
           MOVE 'MSG'                    TO TAB-CIC-TTAB IN TAB.        
           MOVE WSS-COD-CMSG IN WSS-VARI TO TAB-CIC-CTAB IN TAB.        
           MOVE 'TAB-CIC-TABL'           TO FIO-AKEY.                   
           MOVE FIO-GET-KEY              TO FIO-CMND.                   
           PERFORM GNS-FIO-TAB.                                         
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S') OR
            TAB-COD-CTAB IN TAB = SPACES
               MOVE 'BGL'          TO MSG-COD-SIST                      
               MOVE 'MSGEXCEP NEX' TO MSG-COD-MENS                      
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE FRM-SUAR-MAL TO FRM-SUAR                            
               GO TO FIN-PRO-LEE-MSG
           ELSE
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-CMSG IN WSS-VARI.    
       FIN-PRO-LEE-MSG.                                                 
           EXIT.                                                        
      *AFRI-FIN/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012 
      *>>>> 
*% END
*% END
*% IF EOF_BQ
      *<<<<
      ** EVA-INI  10/07                                                 

      *PVC-INI 20-JUL-2012 - Mensaje de Tasacion Vencida
       OBT-COD-UF SECTION.
       INI-OBT-COD-UF.
      * OBTIENE Codigo valor de cambio de UF mediante CIC de la moneda  
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0998  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0998  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-UF IN WSS-VARI.
       FIN-OBT-COD-UF.
           EXIT.
      *PVC-FIN 20-JUL-2012
                                                                        
       BUS-TNOV SECTION.                                                
       INI-BUS-TNOV.                                                    
                                                                        
      * EVA-INI  11/08                                                  
           MOVE 'S' TO WSS-IND-GTAC IN WSS-VARI.                        
           MOVE 'S' TO WSS-IND-ARET IN WSS-VARI.                        
           MOVE 'N' TO WSS-IND-GDIA IN WSS-VARI.                        
           MOVE 'N' TO WSS-IND-ECRT IN WSS-VARI.                        
           MOVE 'N' TO WSS-IND-RTAS IN WSS-VARI.                        
           MOVE 'N' TO WSS-IND-TNOV IN WSS-VARI.                        
      *PVC-INI 20-JUL-2012 - MENSAJE DE TASACION VENCIDA
           MOVE SPACES TO WSS-IND-TASC IN WSS-VARI.
      *PVC-INI 20-JUL-2012
                                                                        
           IF (GDG-IND-EST1 IN GDG < '10' OR                            
               GDG-IND-EST1 IN GDG > '19')                              
               MOVE 'N' TO WSS-IND-GTAC IN WSS-VARI                     
               GO TO FIN-BUS-TNOV.                                      
                                                                        
           IF CMA-IND-APLI IN CMA-VARI NOT = 'A'                        
               MOVE 'N' TO WSS-IND-ARET IN WSS-VARI                     
               GO TO FIN-BUS-TNOV.                                      
                                                                        
           PERFORM LEE-TSOL.                                            
           IF WSS-FEC-FGVT IN WSS-VARI > HOY-FHOY                       
              MOVE 'S' TO WSS-IND-GDIA IN WSS-VARI                      
              GO TO FIN-BUS-TNOV.                                       
                                                                        
           IF GDG-IND-ECRT IN GDG = 'S' AND                             
              GDG-FEC-FVET IN GDG > HOY-FHOY                            
               MOVE 'S' TO WSS-IND-ECRT IN WSS-VARI                     
              GO TO FIN-BUS-TNOV.                                       
                                                                        
           MOVE GVT-CAI-GTIA IN GVT-FLD TO TAS-CAI-GTIA IN TAS.         
           MOVE GVT-IIC-GTIA IN GVT-FLD TO TAS-IIC-GTIA IN TAS.         
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-TAS.                                         
           IF FIO-STAT-OKS AND                                          
              TAS-IND-ESTA IN TAS = '13' OR                             
              TAS-IND-ESTA IN TAS = '09'                                
              MOVE 'S' TO WSS-IND-RTAS IN WSS-VARI                      
              GO TO FIN-BUS-TNOV.                                       
                                                                        
           IF NOT (GVT-SGV-VCTS IN GVT-FLD > 1)                         
               MOVE 'N' TO WSS-IND-ARET IN WSS-VARI                     
               GO TO FIN-BUS-TNOV.                                      
                                                                        
           MOVE GVT-CAI-GTIA IN GVT-FLD TO GIM-CAI-GTIA IN GIM.         
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GIM-IIC-GTIA IN GIM.         
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-GIM.                                         
           IF NOT (FIO-STAT-OKS)                                        
              GO TO CNT-BUS-TNOV.                                       
                                                                        
           PERFORM LEE-GDD-DBC.                                         
                                                                        
           IF (DBC-NUM-ICLI IN DBC > '50000000')                        
              GO TO CNT-BUS-TNOV.                                       

      *PVC-INI 20-JUL-2012 - MENSAJE DE TASACION VENCIDA
           PERFORM OBT-VAL-VCT.
           IF WSS-VAL-UF IN WSS-VARI NOT < WSS-VAL-TASC IN WSS-VARI
               MOVE 'N' TO WSS-IND-TASC IN WSS-VARI
           ELSE
           IF WSS-IND-TASC IN WSS-VARI NOT = 'N'
               MOVE 'S' TO WSS-IND-TASC IN WSS-VARI.
      *PVC-FIN 20-JUL-2012
                                                                        
           IF (GIM-IND-GASC IN GIM = 'V' OR                             
               GIM-IND-GASC IN GIM = 'F' AND                            
               DBC-NUM-ICLI IN DBC < '50000000')                        
               MOVE 'N' TO WSS-IND-ARET IN WSS-VARI                     
               GO TO FIN-BUS-TNOV.                                      
                                                                        
       CNT-BUS-TNOV.                                                    
           MOVE 'S' TO WSS-IND-TNOV IN WSS-VARI.                        
                                                                        
      * EVA-FIN  11/08                                                  
       FIN-BUS-TNOV.                                                    
           EXIT.                                                        
                                                                        
       LEE-VCTO-TAS SECTION.                                            
       INI-LEE-VCTO-TAS.                                                
      *Lee Tabla de Fechas de Proceso                                   
           MOVE ZEROES TO WSS-NUM-FVCT.                                 
           MOVE 'BGL' TO TAB-COD-SIST FIO-SIST.                         
           MOVE 'TFP' TO TAB-COD-TTAB IN TAB.                           
           MOVE '11'  TO TAB-COD-CTAB IN TAB.                           
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM GNS-FIO-TAB.                                         
           IF NOT (FIO-STAT-OKS AND                                     
               TAB-IND-VIGE IN TAB = 'S')                               
               MOVE SPACES TO WSS-GLS-DATA                              
               GO TO FIN-LEE-VCTO-TAS                                   
           ELSE                                                         
               MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-DATA.                
       FIN-LEE-VCTO-TAS.                                                
           EXIT.                                                        
                                                                        
       LEE-GDD-DBC SECTION.                                             
       INI-LEE-GDD-DBC.                                                 
           MOVE GVT-CAI-GTIA IN GVT-FLD TO GDD-CAI-GTIA IN GDD.         
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GDD-IIC-GTIA IN GDD.         
           MOVE FIO-GET-NLS  TO FIO-CMND.                               
           MOVE 'GDD-KEY-AGDD'       TO  FIO-AKEY.                      
                                                                        
           PERFORM BGL-FIO-GDD.                                         
           IF NOT (FIO-STAT-OKS AND                                     
               GDG-CIC-GTIA IN GDG = GDD-CIC-GTIA IN GDD)               
               GO TO FIN-LEE-GDD-DBC.                                   
                                                                        
           MOVE GDD-CIC-DCLI IN GDD  TO  DBC-CIC-ICLI IN DBC.           
           MOVE FIO-GET-KEY          TO  FIO-CMND.                      
           PERFORM SGC-FIO-DBC.                                         
           IF NOT FIO-STAT-OKS                                          
                GO TO FIN-LEE-GDD-DBC.                                  
       FIN-LEE-GDD-DBC.                                                 
           EXIT.                                                        
                                                                        
       LEE-TSOL SECTION.                                                
       INI-LEE-TSOL.                                                    
                                                                        
           PERFORM LEE-GSO.                                             
           IF (WSS-IND-GSO = '0')                                       
               PERFORM PROC-VIGENCIA                                    
      * EVA-INI  11/08                                                  
               GO TO FIN-LEE-TSOL.                                      
      *        GO TO CNT-LEE-TSOL.                                      
      * EVA-FIN  11/08                                                  
                                                                        
           MOVE GSO-NUM-SBGL IN GSO TO GSL-NUM-SBGL IN GSL.             
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-GSL.                                         
           IF NOT (FIO-STAT-OKS)                                        
      * EVA-INI  11/08                                                  
              PERFORM PROC-VIGENCIA                                     
              GO TO FIN-LEE-TSOL.                                       
      *       GO TO CNT-LEE-TSOL.                                       
      * EVA-FIN  11/08                                                  
                                                                        
           IF NOT (GSL-COD-TSOL IN GSL = 'I' OR                         
                   GSL-COD-TSOL IN GSL = 'D')                           
              PERFORM PROC-VIGENCIA                                     
           ELSE                                                         
              PERFORM PROC-INDIR.                                       
                                                                        
      * EVA-INI  11/08                                                  
      *CNT-LEE-TSOL.                                                    
                                                                        
      *    PERFORM CALC-FVEN.                                           
                                                                        
      * EVA-FIN  11/08                                                  
       FIN-LEE-TSOL.                                                    
           EXIT.                                                        
                                                                        
       LEE-GSO SECTION.                                                 
       INI-LEE-GSO.                                                     
           MOVE 999999999999        TO GSO-NUM-SBGL IN GSO.             
           MOVE GVT-CAI-GTIA IN GVT TO GSO-CAI-GTIA IN GSO.             
           MOVE GVT-IIC-GTIA IN GVT TO GSO-IIC-GTIA IN GSO.             
           MOVE FIO-GET-LEQ TO FIO-CMND.                                
       LUP-LEE-GSO.                                                     
           MOVE 'GSO-KEY-IGDG' TO FIO-AKEY.                             
           PERFORM BGL-FIO-GSO.                                         
           IF NOT (FIO-STAT-OKS AND                                     
                GVT-CAI-GTIA IN GVT = GSO-CAI-GTIA IN GSO AND           
                GVT-IIC-GTIA IN GVT = GSO-IIC-GTIA IN GSO)              
                MOVE '0' TO WSS-IND-GSO IN WSS-VARI                     
                GO TO FIN-LEE-GSO.                                      
                                                                        
           IF (GSO-COD-ESGA IN GSO > '02')                              
               MOVE '1' TO WSS-IND-GSO IN WSS-VARI                      
               GO TO FIN-LEE-GSO                                        
           ELSE                                                         
              MOVE FIO-GET-PRV TO FIO-CMND.                             
              GO TO LUP-LEE-GSO.                                        
       FIN-LEE-GSO.                                                     
           EXIT.                                                        
                                                                        
       PROC-VIGENCIA SECTION.                                           
       INI-PROC-VIGENCIA.                                               
           MOVE ZEROES TO WSS-FEC-FGVT.                                 
           MOVE GDG-TIP-CGTA IN GVT-FLD TO TAG-COD-TOPE IN TAG.         
           MOVE GDG-STP-CGTA IN GVT-FLD TO TAG-COD-SOPE IN TAG.         
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-TAG.                                         
           IF NOT (FIO-STAT-OKS)                                        
              GO TO FIN-PROC-VIGENCIA.                                  
                                                                        
           MOVE TAG-NUM-PVTS IN TAG TO WSS-NUM-PVTS.                    
           MOVE TAG-COD-TPVT IN TAG TO WSS-COD-TPVT.                    
           IF WSS-COD-TPVT = 'A'                                        
              MOVE GVT-NUM-DTSN IN GVT TO FEC-ITM1                      
              MOVE GVT-NUM-MTSN IN GVT TO FEC-ITM2                      
              MOVE GVT-NUM-STSN IN GVT TO FEC-ITM3                      
              MOVE GVT-NUM-ATSN IN GVT TO FEC-ITM4                      
              MOVE FEC-FORM-FEC TO FEC-FORM                             
              MOVE WSS-NUM-PVTS TO FEC-NANO                             
              MOVE FEC-SUM-ANO  TO FEC-CMND                             
              PERFORM CAL-FEC                                           
              MOVE FEC-ITM3     TO WSS-NUM-SGVT                         
              MOVE FEC-ITM4     TO WSS-NUM-AGVT                         
              MOVE FEC-ITM2     TO WSS-NUM-MGVT                         
              MOVE FEC-ITM1     TO WSS-NUM-DGVT.                        
           IF WSS-COD-TPVT = 'M'                                        
              MOVE GVT-NUM-DTSN IN GVT TO FEC-ITM1                      
              MOVE GVT-NUM-MTSN IN GVT TO FEC-ITM2                      
              MOVE GVT-NUM-STSN IN GVT TO FEC-ITM3                      
              MOVE GVT-NUM-ATSN IN GVT TO FEC-ITM4                      
              MOVE FEC-FORM-FEC TO FEC-FORM                             
              MOVE WSS-NUM-PVTS TO FEC-NMES                             
              MOVE FEC-SUM-MES  TO FEC-CMND                             
              PERFORM CAL-FEC                                           
              MOVE FEC-ITM3     TO WSS-NUM-SGVT                         
              MOVE FEC-ITM4     TO WSS-NUM-AGVT                         
              MOVE FEC-ITM2     TO WSS-NUM-MGVT                         
              MOVE FEC-ITM1     TO WSS-NUM-DGVT.                        
           IF WSS-COD-TPVT = 'D'                                        
              MOVE GVT-NUM-DTSN IN GVT TO FEC-ITM1                      
              MOVE GVT-NUM-MTSN IN GVT TO FEC-ITM2                      
              MOVE GVT-NUM-STSN IN GVT TO FEC-ITM3                      
              MOVE GVT-NUM-ATSN IN GVT TO FEC-ITM4                      
              MOVE FEC-FORM-FEC TO FEC-FORM                             
              MOVE WSS-NUM-PVTS TO FEC-NDIA                             
              MOVE FEC-SUM-DIA  TO FEC-CMND                             
              PERFORM CAL-FEC                                           
              MOVE FEC-ITM3     TO WSS-NUM-SGVT                         
              MOVE FEC-ITM4     TO WSS-NUM-AGVT                         
              MOVE FEC-ITM2     TO WSS-NUM-MGVT                         
              MOVE FEC-ITM1     TO WSS-NUM-DGVT.                        
       FIN-PROC-VIGENCIA.                                               
           EXIT.                                                        
                                                                        
       PROC-INDIR SECTION.                                              
       INI-PROC-INDIR.                                                  
           MOVE ZEROES TO WSS-FEC-FGVT.                                 
           MOVE GVT-NUM-DTSN IN GVT TO FEC-ITM1.                        
           MOVE GVT-NUM-MTSN IN GVT TO FEC-ITM2.                        
           MOVE GVT-NUM-STSN IN GVT TO FEC-ITM3.                        
           MOVE GVT-NUM-ATSN IN GVT TO FEC-ITM4.                        
           MOVE FEC-FORM-FEC TO FEC-FORM.                               
           MOVE '24'         TO FEC-NMES.                               
           MOVE FEC-SUM-MES  TO FEC-CMND.                               
           PERFORM CAL-FEC.                                             
           MOVE FEC-ITM3            TO WSS-NUM-SGVT.                    
           MOVE FEC-ITM4            TO WSS-NUM-AGVT.                    
           MOVE FEC-ITM2            TO WSS-NUM-MGVT.                    
           MOVE FEC-ITM1            TO WSS-NUM-DGVT.                    
       FIN-PROC-INDIR.                                                  
           EXIT.                                                        
                                                                        
       CALC-FVEN SECTION.                                               
       INI-CALC-FVEN.                                                   
           MOVE HOY-DHOY     TO FEC-ITM1.                               
           MOVE HOY-MHOY     TO FEC-ITM2.                               
           MOVE HOY-SHOY     TO FEC-ITM3.                               
           MOVE HOY-AHOY     TO FEC-ITM4.                               
           MOVE FEC-FORM-FEC TO FEC-FORM.                               
           MOVE WSS-NUM-FVCT TO FEC-NDIA.                               
           MOVE FEC-SUM-DIA  TO FEC-CMND.                               
           PERFORM CAL-FEC.                                             
           MOVE FEC-ITM1            TO WSS-NUM-DVEN.                    
           MOVE FEC-ITM2            TO WSS-NUM-MVEN.                    
           MOVE FEC-ITM3            TO WSS-NUM-SVEN.                    
           MOVE FEC-ITM4            TO WSS-NUM-AVEN.                    
       FIN-CALC-FVEN.                                                   
           EXIT.                                                        
                                                                        
       LEE-GDG SECTION.                                                 
       INI-LEE-GDG.                                                     
           MOVE 'N' TO WSS-IND-GTIA IN WSS-VARI.                        
           MOVE GVT-CAI-GTIA IN GVT-FLD TO GDG-CAI-GTIA IN GDG.         
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GDG-IIC-GTIA IN GDG.         
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-GDG.                                         
           IF FIO-STAT-OKS                                              
              MOVE 'S' TO WSS-IND-GTIA IN WSS-VARI.                     
       FIN-LEE-GDG.                                                     
           EXIT.                                                        
      ** EVA-FIN  10/07                                                 

      *PVC-INI  Jul-2012  -  Mensaje de Tasacion Vencida
       OBT-VAL-VCT SECTION.                                             
       INI-OBT-VAL-VCT.                                                 
           MOVE ZEROES TO WSS-VAL-UF IN WSS-VARI.                       
           PERFORM OBT-VAL-TASC.
           IF WSS-IND-TASC IN WSS-VARI NOT = SPACES
               GO TO FIN-OBT-VAL-VCT.

           PERFORM OBT-COD-MNAC.
           PERFORM OBT-COD-UF.
           IF GDG-COD-VCAM IN GDG = WSS-COD-UF IN WSS-VARI
               MOVE GVT-SGV-VCTS IN GVT-FLD TO                          
                    WSS-VAL-UF IN WSS-VARI                              
               GO TO FIN-OBT-VAL-VCT.

           PERFORM GET-FHOY.
           MOVE HOY-FHOY                  TO CAM-FEC-FCAM IN CAM(1).    
           MOVE CAM-FEC-FCAM IN CAM(1)    TO CAM-FEC-FCAM IN CAM(2).    
           IF GDG-COD-VCAM IN GDG NOT = WSS-COD-PESO IN WSS-VARI
              MOVE GDG-COD-VCAM IN GDG    TO CAM-COD-VCAM IN CAM(1)     
           ELSE
              MOVE WSS-COD-UF IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).    
           MOVE WSS-COD-PESO IN WSS-VARI  TO CAM-COD-VCAM IN CAM(2).    
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM TAB-FIO-CAM.                                         
           IF NOT ( FIO-STAT-OKS AND                                    
              CAM-IND-VIGE IN CAM = 'S' )                               
               MOVE 'TAB'        TO MSG-COD-SIST                        
               MOVE 'CAM    NEX' TO MSG-COD-MENS                        
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE FRM-SUAR-MAL TO FRM-SUAR                            
               MOVE 'N' TO WSS-IND-TASC IN WSS-VARI
               GO TO FIN-OBT-VAL-VCT.                                   

           IF GDG-COD-VCAM IN GDG = WSS-COD-PESO IN WSS-VARI
               COMPUTE WSS-VAL-UF IN WSS-VARI ROUNDED =                 
                       GVT-SGV-VCTS IN GVT-FLD /                        
                       CAM-SGV-VCAM IN CAM                              
                                                                        
               GO TO FIN-OBT-VAL-VCT.

           COMPUTE WSS-VAL-UF IN WSS-VARI ROUNDED =                     
                   GVT-SGV-VCTS IN GVT-FLD *                            
                   CAM-SGV-VCAM IN CAM                                  

           MOVE HOY-FHOY                 TO CAM-FEC-FCAM IN CAM(1).     
           MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2).     
           MOVE WSS-COD-UF   IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).     
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).     
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM TAB-FIO-CAM.                                         
           IF NOT ( FIO-STAT-OKS AND                                    
              CAM-IND-VIGE IN CAM = 'S' )                               
               MOVE 'TAB'        TO MSG-COD-SIST                        
               MOVE 'CAM    NEX' TO MSG-COD-MENS                        
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE FRM-SUAR-MAL TO FRM-SUAR                            
               MOVE 'N' TO WSS-IND-TASC IN WSS-VARI
               GO TO FIN-OBT-VAL-VCT.                                   
                                                                        
           COMPUTE WSS-VAL-UF IN WSS-VARI ROUNDED =                     
                   WSS-VAL-UF IN WSS-VARI /                             
                   CAM-SGV-VCAM IN CAM.                                 

       FIN-OBT-VAL-VCT.                                                 
           EXIT.                                                        

       OBT-VAL-TASC SECTION.
       INI-OBT-VAL-TASC.
           MOVE ZEROES         TO WSS-VAL-TASC IN WSS-VARI.
           MOVE SPACES         TO TAB-COD-CTAB IN TAB.
           MOVE 'BGL'          TO FIO-SIST.
           MOVE 'MON'          TO TAB-CIC-TTAB IN TAB.
           MOVE 'MON'          TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT  FIO-STAT-OKS
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               MOVE FRM-SUAR-MAL TO FRM-SUAR                            
               MOVE 'N' TO WSS-IND-TASC IN WSS-VARI
               GO TO FIN-OBT-VAL-TASC.                                  
           IF TAB-IND-VIGE IN TAB NOT = 'S'
               MOVE 'N' TO WSS-IND-TASC IN WSS-VARI
               GO TO FIN-OBT-VAL-TASC.                                  
           MOVE TAB-GLS-DAT1 IN TAB TO WSS-GLS-DAT1 IN WSS-VARI.
           IF WSS-VAL-TASC IN WSS-VARI IS NOT NUMERIC
               MOVE 'N' TO WSS-IND-TASC IN WSS-VARI
               GO TO FIN-OBT-VAL-TASC.                                  
           IF WSS-VAL-TASC IN WSS-VARI NOT > ZEROES
               MOVE 'N' TO WSS-IND-TASC IN WSS-VARI.
       FIN-OBT-VAL-TASC.
           EXIT.
      *PVC-FIN Jul-2012

      *PVC-INI 19-NOV-2012  DESVALORIZACION
       CONT-AVALUOS SECTION.
       INI-CONT-AVALUOS.
           MOVE ZEROES       TO WSS-NUM-FISC IN WSS-VARI.
           MOVE SPACES       TO WSS-GLS-DANE IN WSS-VARI.
           MOVE 'BGL'        TO FIO-SIST.
           MOVE 'FIS'        TO TAB-COD-TTAB IN TAB.
           MOVE 'FIS'        TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CONT-AVALUOS.                                  

           IF TAB-IND-VIGE IN TAB NOT = 'S'
               GO TO FIN-CONT-AVALUOS.                                  

           IF TAB-GLS-DATA IN TAB NOT > SPACES
               GO TO FIN-CONT-AVALUOS.

           MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-DANE IN WSS-VARI.

           MOVE GVT-CAI-GTIA IN GVT-FLD TO GVT-CAI-GTIA IN GVT.         
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GVT-IIC-GTIA IN GVT.         
           MOVE ZEROES                  TO GVT-COD-TASN IN GVT.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-GVT.
           PERFORM BGL-FIO-GVT.
           IF NOT ( FIO-STAT-OKS AND
              GVT-CAI-GTIA IN GVT-FLD = GVT-CAI-GTIA IN GVT AND
              GVT-IIC-GTIA IN GVT-FLD = GVT-IIC-GTIA IN GVT )
               GO TO FIN-CONT-AVALUOS.

           IF GVT-COD-EITS IN GVT NOT > SPACES
               GO TO NXT-GVT.                                           

           MOVE 1 TO I.
       LUP-FIS.
           IF I > 20
               GO TO NXT-GVT.                                           

           IF WSS-COD-DATA(I) NOT > SPACES
               GO TO NXT-GVT.

           IF GVT-COD-EITS IN GVT = WSS-COD-DATA(I)
               ADD 1 TO WSS-NUM-FISC IN WSS-VARI
               GO TO NXT-GVT.                                           

           ADD 1 TO I.
           GO TO LUP-FIS.
       NXT-GVT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-GVT.
       FIN-CONT-AVALUOS.
           EXIT.
      *PVC-FIN 19-NOV-2012
*% END
*% IF INI_GVT_CAI_GTIA
      *<<<<
           IF GVT-CAI-GTIA IN GVT-FLD NOT > SPACES                      
              MOVE SPACES TO GVT-CAI-GTIA IN GVT-FLD.                   
      *MHM-INI 03-NOV-2004                                              
           IF ((SCR-CMND = 'ING' OR SCR-CMND = 'INE') AND               
               (GVT-CAI-GTIA IN GVT-FLD NOT > SPACES))                  
                PERFORM ERR-KEY                                         
                PERFORM FST-KEY-GVT.                                    
      *MHM-FIN 03-NOV-2004                                              
      *>>>>
*% END
*% IF EOF_BQ AND NOT PGM_BM
      *<<<< EOF_BQ AND NOT PGM_BM
       PRO-FLD-GVT SECTION.
       INI-PRO-FLD-GVT.
           MOVE FRM-CPIM-AEY TO GVT-FEC-FTSN-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-FEC-FTSN-STP.

           MOVE FRM-CPIM-AEY TO GVT-SGV-VCTS-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-VCTS-STP.

           MOVE FRM-CPIM-AEY TO GVT-SGV-LTSN-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-LTSN-STP.

           MOVE FRM-CPIM-AEY TO GVT-SGV-PAJU-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-PAJU-STP.

           MOVE FRM-CPIM-AEY TO GVT-SGV-VPND-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-VPND-STP.

           MOVE FRM-CPIM-AEY TO GVT-FEC-FRVL-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-FEC-FRVL-STP.

           MOVE FRM-CPIM-AEY TO FRM-IND-GTP-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO FRM-IND-GTP-STP.
           MOVE FRM-CPIM-AEY TO FRM-IND-GTP-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-VGAS-ATR IN GVT-FLD.
           PERFORM PRO-GVT-GVT.
           PERFORM PRO-GDG-GVT.
           IF SCR-CMND = 'ING' OR                                       
              SCR-CMND = 'INE' OR                                       
              SCR-CMND = 'MOD'                                          
               MOVE FRM-CPIM-AEY TO GVT-COD-SDAG-ATR IN GVT-FLD.
       FIN-PRO-FLD-GVT.
           EXIT.
       
       PRO-GVT-GVT SECTION.
       INI-PRO-GVT-GVT.
      * IDC-FIN --> BMMEXBNM005.SRCAIU PRO ( KEY Y FLD )
           MOVE FRM-CPIM-AEY TO GVT-FEC-FTSN-ATR IN GVT-FLD.
      *CGL-INI  19-AUG-2003 18:08:08 
      *     MOVE FRM-CPIM-AEY TO GVT-COD-CRIT-ATR IN GVT-FLD.
      *     MOVE FRM-CPIM-AEY TO GVT-COD-OAVA-ATR IN GVT-FLD.
      *     MOVE FRM-CPIM-AEY TO GVT-COD-ADAG-ATR IN GVT-FLD.
      *CGL-FIN  19-AUG-2003 18:11:33 
           MOVE FRM-CPIM-AEY TO GVT-COD-SDAG-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-VCTS-ATR IN GVT-FLD.
      *CGL-INI  19-AUG-2003 18:12:21 
      *     MOVE FRM-CPIM-AEY TO GVT-SGV-FISI-ATR IN GVT-FLD.
      *CGL-FIN  19-AUG-2003 18:12:29 
      *MHM-INI 15-OCT-2003
           MOVE FRM-CPIM-AEY TO GVT-SGV-PPCT-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-VSIN-ATR IN GVT-FLD.
      *MHM-FIN 15-OCT-2003
           MOVE FRM-CPIM-AEY TO GVT-SGV-VPND-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-PAJU-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-SGV-LTSN-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-COD-EITS-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-COD-ISVS-ATR IN GVT-FLD.
      * IDC-FIN --> BMMEXBNM005.SRCAIU PRO ( KEY Y FLD )
           MOVE FRM-CPIM-AEY TO GVT-FEC-FRVL-ATR IN GVT-FLD.
       FIN-PRO-GVT-GVT.
           EXIT.
       
       PRO-GDG-GVT SECTION.
       INI-PRO-GDG-GVT.
       FIN-PRO-GDG-GVT.
           EXIT.
      *>>>>
*% END
*% IF GVT_SGV_VTTL
      *<<<<
      * EVA-INI  06/08                                                  
           IF SCR-HDR-MRCA = 'BCS'                                      
              GO TO FIN-VAL-GVT-SGV-VTTL.                               
                                                                        
           MOVE GVT-CAI-GTIA IN GVT-FLD TO GDG-CAI-GTIA IN GDG.         
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GDG-IIC-GTIA IN GDG.         
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM BGL-FIO-GDG.                                         
                                                                        
           MOVE GDG-COD-CGTA IN GDG TO WSS-COD-CGTA IN WSS-VARI.        
                                                                        
           MOVE 'BGL'                    TO TAB-COD-SIST FIO-SIST.      
           MOVE 'MTM'                    TO TAB-COD-TTAB IN TAB.        
           MOVE WSS-COD-CGTA IN WSS-VARI TO TAB-COD-CTAB IN TAB.        
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM GNS-FIO-TAB.                                         
           IF NOT (FIO-STAT-OKS AND                                     
              TAB-IND-VIGE IN TAB = 'S')                                
              MOVE ZEROES TO GVT-SGV-VTTL IN GVT-FLD                    
           ELSE                                                         
              MOVE GVT-SGV-VCTS IN GVT-FLD TO                           
                   GVT-SGV-VTTL IN GVT-FLD.                             
      * EVA-FIN  06/08                                                  
      *>>>>
*% END
