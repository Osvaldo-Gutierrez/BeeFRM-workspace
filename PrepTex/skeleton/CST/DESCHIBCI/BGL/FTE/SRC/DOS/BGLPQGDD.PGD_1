       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   BGLPQGDD.
       AUTHOR.       BEE.
       DATE-WRITTEN. 13-Dec-18 06:00 PM.

      * NOMBRE PROGRAMA                   BGLPQGDD
      * VERSION PGM                       3.1
      * VERSION SKL                       07.08.21
      * OPCION                            CON
      * ARCHIVO BASE                      BGLGDD
      * PANTALLA                          BGLGDD
      * INP/OUT                           DATACOM
      * TAMANO COMMAREA                   250

      *=============================================================*
      * MODIFICACIONES
      *=============================================================*
      * ETIQUETA   : *OGB-INI 08-OCT-2015 LIMITE DE GARANTIAS
      * OBJETIVO   : AGREGAR CAMPOS MONTO LIMITE, MONEDA MONTO LIMITE
      *              Y FECHA DE CAMBIO
      * FECHA      : OCTUBRE-2015
      * RESPONSABLE: CIMA-OGB
      * MANTENCION : LIMITE DE GARANTIAS
      *=============================================================*   
      * ETIQUETA   : *OGB-INI 25-ABR-2017 VALIDACION MLIM - LTSN
      * OBJETIVO   : AGRANDAR VARIABLES DE VALIDACION DE MTO LIMITE
      *              VS MTO LIQUIDACION
      * FECHA      : ABRIL-2017
      * RESPONSABLE: CIMA-OGB
      * MANTENCION : CORRECCION PANTALLA GDD
      *=============================================================*

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.
       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
      * COPY GNSWGSCR.
       COPY GNSWGCVT.
       77  WSS-TAG-BGLPQGDD-INI PIC X(125) VALUE                        
           '<IDNPGM NOM=$BGLPQGDD$ SKL=$07.08.21$ VSN=$06.06.29$        
      -    'GEN=$13-Dec-18 06:00 PM$ FNC=$OWFBGL$/>'.    

       COPY GNSWCSCR.
      *PTC-INI
      *PTC-SUB
      * COPY GNSWVSCR.
       COPY GNSWV3CR.
      *PTC-FIN
      *<<<< FIN_SCR_VARI
      *<<<< CMAVARI
           03 CMA-VARI.
              05 GAR-KEY-IGDD.
                 07 GDD-CIC-DCLI.
                    09 GDD-CAI-ICLI           VALUE SPACES  PIC X(04).
                    09 GDD-IIC-ICLI           VALUE ZEROES  PIC 9(08).
                 07 GDD-KEY-AGDD              VALUE SPACES  PIC X(12).
  
      *>>>>
              05 WSS-COD-PESO                        PIC X(06).
              05 GAR-CAI-GTIA                        PIC X(04).
              05 GAR-IIC-GTIA                        PIC X(08).
              05 GAR-IND-GTAC                         PIC X(01). 
              05 CNE-GDD-CAI-DCLI                    PIC X(04).
              05 CNE-GDD-IIC-DCLI                    PIC X(08).
              05 FRM-NUM-QDEU                        PIC 9(03).
      *>>>>
       COPY BGLWIGDD.

       COPY BGLBRGDD.


       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSBRMSC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSWGFRM.
       COPY GNSWG3CF.
       COPY GNSWGTSK.
       COPY GNSWGQUE.
      *PTC-FIN
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       COPY GNSWGIDC.
       COPY GNSWGSYS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY TABBROFI.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY TABBRUSR.

      *<<<< WSS
      *OGB-INI 08-OCT-2015 LIMITE DE GARANTIAS
       COPY TABBRCAM.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *OGB-FIN 08-OCT-2015 LIMITE DE GARANTIAS
       COPY BGLBRGVT.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.        
      *PTC-INI-MAN
       COPY BGLWXGDG.
       COPY BGLWXGDD.
      *PTC-INI-MAN
       COPY SGCBRDBC.
       COPY BGLBRGDG.
       COPY GNSWGCPT.
       COPY GNSWGSTR.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>>
       COPY BGLBRTAG.
       COPY BGLBRGMO.
      *<<<< PGM_DTC AND WSS
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GMO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
      *>>>>
      *<<<< PGM_CHI AND PGM_PQ
       COPY USPC113.
      *>>>>

       01  WSS-VARI.
      *MHM-INI 23-OCT-2003
           03 WSS-GLS-CGTA.
              05 WSS-GLS-TOPE                   PIC X(40).
              05 WSS-GLS-SOPE                   PIC X(40).
      *MHM-FIN 23-OCT-2003
           03 WSS-CPO.
      *<<<< 
              05 DBC-NUM-ICLI                     PIC 9(08).
              05 DBC-VRF-ICLI                     PIC X(01).
              05 DBC-IND-ICLI                     PIC X(01).
              05 DBC-GLS-ICLI                     PIC X(03).
           03 WSS-CLA-OPE.
              05 WSS-COD-TOPE                     PIC X(03).
              05 WSS-COD-SOPE                     PIC X(03).
      * AFRI-EVA/MAYO2007 (PRELACION)                                   
           03 WSS-NUM-PLIM                        PIC 9(03).            
           03 WSS-AUX-PLIM                        PIC 9(03).            
           03 WSS-VAL-PLIM                        PIC 9(03).            
           03 WSS-CIC-GTIA                        PIC X(12).            
           03 WSS-CONT                            PIC 9(08).            
           03 WSS-VAR-VLIM                        PIC 9(08).
           03 WSS-NUM-VLIM                        PIC 9(08).
           03 WSS-AUX-VLIM                        PIC 9(08).
           03 WSS-VAL-VLIM                        PIC 9(08).
           03 WSS-NUM-LTSN                        PIC 9(08).
           03 WSS-AUX-LTSN                        PIC 9(08).
           03 WSS-CTE-BGL     VALUE 'BGL'         PIC X(03).
           03 WSS-CTE-GDGNEX  VALUE 'GDG    NEX'  PIC X(10).

           03 WSS-DATOS-ADICIONALES.
              05 WSS-CLASE-GARANTIA               PIC X(02).
              05 FILLER                           PIC X(58).

      *>>>>
       01  PGM-VARI.
           03 PGM-ICLR                  VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-TODO          VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-LLAVES        VALUE 'K'       PIC X(01).
           03 PGM-LIMPIAR-CAMPOS        VALUE 'F'       PIC X(01).
           03 PGM-NO-LIMPIAR-NADA       VALUE 'N'       PIC X(01).
           03 PGM-PROG                                  PIC X(08).
           03 PGM-NTRN                                  PIC X(04).
           03 PGM-STAT.
              05 PGM-STAT-GDD.
                 88 PGM-STAT-GDD-NUL    VALUE '  '.
                 07 PGM-STT1-GDD        VALUE '2' PIC X(01).
                    88 PGM-STAT-GDD-OKS VALUE '0'.
                 07 PGM-STT2-GDD        VALUE '3' PIC X(01).
              05 PGM-STAT-DBC.
                 88 PGM-STAT-DBC-NUL    VALUE '  '.
                 07 PGM-STT1-DBC        VALUE '2' PIC X(01).
                    88 PGM-STAT-DBC-OKS VALUE '0'.
                 07 PGM-STT2-DBC        VALUE '3' PIC X(01).
              05 PGM-STAT-GDG.
                 88 PGM-STAT-GDG-NUL    VALUE '  '.
                 07 PGM-STT1-GDG        VALUE '2' PIC X(01).
                    88 PGM-STAT-GDG-OKS VALUE '0'.
                 07 PGM-STT2-GDG        VALUE '3' PIC X(01).
      *<<<<
      * AFRI-EVA/MAYO2007 (PRELACION)                                   
              05 PGM-STAT-GVT.                                          
                 88 PGM-STAT-GVT-NUL    VALUE '  '.                     
                 07 PGM-STT1-GVT        VALUE '2' PIC X(01).            
                    88 PGM-STAT-GVT-OKS VALUE '0'.                      
                 07 PGM-STT2-GVT        VALUE '3' PIC X(01).            
      * AFRI-FIN/MAYO2007 (PRELACION)                                   
      *>>>>
           03 PGM-SRNF                  VALUE '23'      PIC X(02).
           03 PGM-SOKS                  VALUE '00'      PIC X(02).
           03 PGM-SNUL                  VALUE '  '      PIC X(02).
           03 PGM-SUAR                  VALUE SPACES    PIC X(15).

       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 FILLER                              PIC X(400).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
       LUP-MAIN.
           IF SCR-INST = SCR-INST-HCM
                 PERFORM SCR-COM.
           IF SCR-CCPP = 'MOD'
                 PERFORM SCR-MOD
           ELSE
           IF SCR-CCPP = 'ING'
                 PERFORM SCR-ING
           ELSE
           IF SCR-CCPP = 'ACC'
                 PERFORM SCR-ACC
           ELSE
           IF SCR-CCPP = 'ELI'
                 PERFORM SCR-ELI
           ELSE
           IF SCR-CCPP = 'ACT'
                 PERFORM SCR-ACT
           ELSE
           IF SCR-CCPP = 'PGM'
                 PERFORM SCR-PGM
           ELSE
                 MOVE SCR-INST-HCM TO SCR-INST.
           GO TO LUP-MAIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
       COPY GNSBGEIB.
       COPY GNSBGEDB.
           MOVE LOW-VALUES TO GDD-FLD.
           MOVE LOW-VALUES TO GDD-EDT.
           PERFORM GNS-PRO-RCK.
           PERFORM GNS-BUS-VCA.
           PERFORM GNS-HDL-SYS.
           PERFORM GNS-HDL-FRM.
           MOVE 'BGLPQGDD' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      *PTC-INI
           PERFORM GNS-ERR-QUE.
           PERFORM GET-TSK-TERM.
      *PTC-FIN
      *<<<< INI_FIO
      *PTC-INI-MAN                                         
           MOVE TSK-TERM-ALF TO WSX-COD-TERM IN WSX-TSGDD. 
           MOVE TSK-TERM-ALF TO WSX-COD-TERM IN WSX-TSGDG. 
      * ISP-INI 29-01-2004 11:30
           MOVE TSK-TERM-ALF TO WSY-COD-TERM IN WSY-TSGDD.
      * ISP-FIN 29-01-2004 11:30
      *PTC-FIN-MAN                                         
      *<<<< PGM_MVS OR PGM_DOS 
           MOVE +400 TO SCR-TCMA.
      *>>>>

      * OBTIENE CODIGO VALOR DE CAMBIO DE PESOS MEDIANTE CIC DE LA MONEDA '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               PERFORM PRG-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN CMA-VARI.
      *>>>> INI_FIO
       FIN-INI.
           EXIT.

       COPY GNSBHSYS.
       COPY GNSBHFRM.
       COPY GNSBPRCK.
       COPY GNSBBVCA.
       COPY GNSBBIDD.

       SCR-COM SECTION.
       INI-SCR-COM.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-GDD.
           PERFORM EDT-KEY-GDD.
           PERFORM EDT-FLD-GDD.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-HCM TO SCR-INST.
           MOVE SCR-CMNP     TO SYS-PROG.
           MOVE SCR-VARI     TO SYS-CMMA.
           MOVE SCR-TCMA     TO SYS-TCMA.
           MOVE SYS-XCTL     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       XCT-ERR.
           MOVE 'XCTERR    ' TO MSG-COD-MENS.
           MOVE 'GNS'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO SYS-MEN1.
           MOVE SYS-PROG     TO SYS-MEN2.
           MOVE SYS-ABOR     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       COPY GNSBGGBK.
       FIN-SCR-COM.
           EXIT.

       SCR-MOD SECTION.
       INI-SCR-MOD.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-MOD
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-MOD.
           PERFORM DESSCRTRL.
      *<<<< PFS_SCR_MOD
           IF ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR
                           FRM-FFLD-PF7 OR FRM-FFLD-PF8 ) AND
              SCR-STAT = SCR-STAT-CON
               PERFORM VAL-NUM-KEY-GDD
               PERFORM VAL-NUM-FLD-GDD.
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR
                         FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-MOD.
      *>>>>
       MSG-SCR-MOD.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-MOD.
           EXIT.

       BRW-SCR-MOD SECTION.
       INI-BRW-SCR-MOD.
       FIN-BRW-SCR-MOD.
           EXIT.

       SCR-ING SECTION.
       INI-SCR-ING.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-IKY
               MOVE SCR-INST-GKY TO SCR-INST
      *PTC-INI
               IF NOT SCR-OFRM-SRV
                   PERFORM SCR-DMSG
               ELSE
                   PERFORM SCR-PUTA
      *PTC-FIN
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-RST
                PERFORM GET-IKY
                IF NOT FRM-STAT-ABT
                        MOVE SPACES TO FRM-MENS
                        PERFORM FND-KEY
                        IF NOT FIO-STAT-OKS AND
                           FIO-STAT NOT = FIO-STAT-NEX
      *JSS                  PERFORM CLR-FLD-GDD
                            MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
                            PERFORM SCR-TRL
                        ELSE
      *PTC-INI
                        MOVE 'S' TO SCR-IERR
      *PTC-FIN
                        MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR
                        IF FRM-MENS NOT > SPACES
                            MOVE 'REGEXI    ' TO MSG-COD-MENS
                            MOVE 'GNS' TO MSG-COD-SIST
                            PERFORM GET-MSG
                            MOVE MSG-GLS-DESC TO FRM-MENS
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-ING
                        ELSE
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-ING
                ELSE
                        MOVE SPACES TO FRM-MENS
                        PERFORM SCR-MSSG
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ING
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON.
           PERFORM DESSCRTRL.
       MSG-SCR-ING.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ING.
           EXIT.

       SCR-ACC SECTION.
       INI-SCR-ACC.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ACC
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-ACC.
           PERFORM DESSCRTRL.
      *<<<< PFS_SCR_ACC
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR
                         FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM VAL-NUM-KEY-GDD
               PERFORM VAL-NUM-FLD-GDD
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-ACC.
      *>>>>
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ACC.
           EXIT.

       BRW-SCR-ACC SECTION.
       INI-BRW-SCR-ACC.
       FIN-BRW-SCR-ACC.
           EXIT.

       SCR-ELI SECTION.
       INI-SCR-ELI.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ELI
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-ELI.
           PERFORM DESSCRTRL.
      *<<<< PFS_SCR_ELI
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR
                         FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM VAL-NUM-KEY-GDD
               PERFORM VAL-NUM-FLD-GDD
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-ELI.
      *>>>>
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ELI.
           EXIT.

       BRW-SCR-ELI SECTION.
       INI-BRW-SCR-ELI.
       FIN-BRW-SCR-ELI.
           EXIT.

       SCR-ACT SECTION.
       INI-SCR-ACT.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-RST
                PERFORM GET-KEY
                IF NOT FRM-STAT-ABT
                        MOVE SPACES TO FRM-MENS
                        PERFORM FND-KEY
                        IF FIO-STAT-OKS
                            MOVE SCR-ACTU-MOD TO SCR-ACTU
                            PERFORM PUT-SCR
                            MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
                            PERFORM SCR-TRL
                        ELSE
                        MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR
                        IF FIO-STAT-EOF
                            IF FRM-MENS NOT > SPACES
                                MOVE 'REGEOF    ' TO MSG-COD-MENS
                                MOVE 'GNS' TO MSG-COD-SIST
                                PERFORM GET-MSG
                                MOVE MSG-GLS-DESC TO FRM-MENS
                                PERFORM SCR-MSSG
                                MOVE SCR-STAT-ABT TO SCR-STAT
                                PERFORM DESSCRTRL
                                GO TO FIN-SCR-ACT
                            ELSE
                                PERFORM SCR-MSSG
                                MOVE SCR-STAT-ABT TO SCR-STAT
                                PERFORM DESSCRTRL
                                GO TO FIN-SCR-ACT
                        ELSE
                        IF FIO-STAT = FIO-STAT-NEX
                            IF FRM-MENS NOT > SPACES
                                MOVE 'REGNEX    ' TO MSG-COD-MENS
                                MOVE 'GNS' TO MSG-COD-SIST
                                PERFORM GET-MSG
                                MOVE MSG-GLS-DESC TO FRM-MENS
                                PERFORM SCR-MSSG
                                MOVE SCR-STAT-ABT TO SCR-STAT
                                PERFORM DESSCRTRL
                                GO TO FIN-SCR-ACT
                            ELSE
                                PERFORM SCR-MSSG
                                MOVE SCR-STAT-ABT TO SCR-STAT
                                PERFORM DESSCRTRL
                                GO TO FIN-SCR-ACT
                        ELSE
                            MOVE SCR-ACTU-ING TO SCR-ACTU
      *JSS                  PERFORM CLR-FLD-GDD
                            MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
                            PERFORM SCR-TRL
                ELSE
                        MOVE SPACES TO FRM-MENS
                        PERFORM SCR-MSSG
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ACT
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-ACT.
           PERFORM DESSCRTRL.
      *<<<< PFS_SCR_ACT
           IF ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR
                           FRM-FFLD-PF7 OR FRM-FFLD-PF8 ) AND
              SCR-STAT = SCR-STAT-CON
               PERFORM VAL-NUM-KEY-GDD
               PERFORM VAL-NUM-FLD-GDD.
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR
                         FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-ACT.
      *>>>>
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ACT.
           EXIT.

       BRW-SCR-ACT SECTION.
       INI-BRW-SCR-ACT.
       FIN-BRW-SCR-ACT.
           EXIT.

       SCR-PGM SECTION.
       INI-SCR-PGM.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-RST
                PERFORM GET-KEY
                IF FRM-STAT-ABT
                    MOVE SPACES TO FRM-MENS
                    PERFORM SCR-MSSG
                    PERFORM DESSCRTRL
                    GO TO FIN-SCR-PGM
                ELSE
                    MOVE SPACES TO FRM-MENS
                    PERFORM FND-KEY
                    IF FIO-STAT = FIO-STAT-NEX
                        IF FRM-MENS NOT > SPACES
                            MOVE 'REGNEX    ' TO MSG-COD-MENS
                            MOVE 'GNS' TO MSG-COD-SIST
                            PERFORM GET-MSG
                            MOVE MSG-GLS-DESC TO FRM-MENS
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-PGM
                        ELSE
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-PGM
                    ELSE
                        MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
                        PERFORM SCR-TRL
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-PGM.
       TRL-SCR-PGM.
           PERFORM DESSCRTRL.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-PGM.
           EXIT.

       BRW-SCR-PGM SECTION.
       INI-BRW-SCR-PGM.
       FIN-BRW-SCR-PGM.
           EXIT.

       SCR-DMSG SECTION.
       INI-SCR-DMSG.
           IF PGM-ICLR = PGM-NO-LIMPIAR-NADA
               NEXT SENTENCE
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-TODO
               PERFORM SCR-CLRA-GDD
               PERFORM EDT-KEY-GDD
               PERFORM EDT-FLD-GDD
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-LLAVES
               PERFORM CLR-KEY-GDD
               PERFORM EDT-KEY-GDD
           ELSE
               PERFORM CLR-FLD-GDD
               PERFORM EDT-FLD-GDD.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-DMSG.
           EXIT.

       SCR-KEY SECTION.
       INI-SCR-KEY.
           PERFORM SCR-RST.
           PERFORM GET-KEY.
           IF FRM-STAT-ABT
                   MOVE SPACES TO FRM-MENS
                   PERFORM SCR-MSSG
                   GO TO FIN-SCR-KEY.
       FND-SCR-KEY.
           MOVE SPACES TO FRM-MENS.
           PERFORM FND-KEY.
           IF FIO-STAT-OKS
               PERFORM PUT-SCR
               MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
               GO TO FIN-SCR-KEY.
      *JSS ELSE
      *        PERFORM CLR-FLD-GDD.
       ERR-SCR-KEY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR.
           IF FRM-MENS NOT > SPACES
               IF FIO-STAT-EOF
                   MOVE 'REGEOF    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
               IF FIO-STAT = FIO-STAT-NEX
                   MOVE 'REGNEX    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
           MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-SCR-KEY.
           EXIT.

       SCR-RST SECTION.
       INI-SCR-RST.
           MOVE SPACES       TO PGM-ICLR.
           MOVE SPACES       TO SCR-ACTU.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
           MOVE LOW-VALUES   TO GDD-FLD.
           MOVE LOW-VALUES TO GDD-EDT.
       FIN-SCR-RST.
           EXIT.

       GET-KEY SECTION.
       INI-GET-KEY.
           PERFORM SCR-GKEY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-KEY.
           EXIT.

       GET-IKY SECTION.
       INI-GET-IKY.
           PERFORM SCR-GIKY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-IKY.
           EXIT.

       FND-KEY SECTION.
       INI-FND-KEY.
      *<<<< EVP-INI INIFNDKEY
      * CODIGO PARA M:N EN RELACION PADRE-HIJO

           IF SCR-CCPP = 'ING'
               GO TO FND-DIRECTO.

           MOVE SPACES TO MSG-COD-MENS.
           MOVE '23' TO PGM-STAT-GDD.

      *>>>>
           IF FRM-FFLD = FRM-FFLD-PF6
              OR FRM-FFLD-PF5
               PERFORM LEE-NXT-PRV-XDBC
               IF PGM-STAT-GDD-OKS
                   MOVE PGM-SNUL TO PGM-STAT-DBC
                   GO TO EXA-COM-STAT
               ELSE
                   MOVE PGM-SNUL TO PGM-STAT-DBC
                   MOVE PGM-SNUL TO PGM-STAT-GDD
                   MOVE PGM-SNUL TO PGM-STAT-GDG
                   IF FRM-FFLD = FRM-FFLD-PF5
                       MOVE 'GDD    NOPRV' TO MSG-COD-MENS
                       GO TO ERR-FND-KEY
                   ELSE
                       MOVE 'GDD    NONXT' TO MSG-COD-MENS
                       GO TO ERR-FND-KEY.

           IF FRM-FFLD = FRM-FFLD-PF8
              OR FRM-FFLD-PF7
               PERFORM LEE-NXT-PRV-XGDG
               IF PGM-STAT-GDD-OKS
                   MOVE PGM-SNUL TO PGM-STAT-GDG
                   GO TO EXA-COM-STAT
               ELSE
                   MOVE PGM-SNUL TO PGM-STAT-DBC
                   MOVE PGM-SNUL TO PGM-STAT-GDD
                   MOVE PGM-SNUL TO PGM-STAT-GDG
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE 'DBC    NOPRV' TO MSG-COD-MENS
                       GO TO ERR-FND-KEY
                   ELSE
                       MOVE 'DBC    NONXT' TO MSG-COD-MENS
                       GO TO ERR-FND-KEY.
      *<<<<
           MOVE SPACES TO GDD-CIC-DCLI IN CMA-VARI.
           MOVE SPACES TO GDD-KEY-AGDD IN CMA-VARI.

           IF DBC-NUM-ICLI IN GDD-FLD NOT = ZEROES
               MOVE DBC-NUM-ICLI IN GDD-FLD TO DBC-NUM-ICLI IN DBC
               MOVE DBC-IND-ICLI IN GDD-FLD TO DBC-IND-ICLI IN DBC
               MOVE DBC-GLS-ICLI IN GDD-FLD TO DBC-GLS-ICLI IN DBC
               MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GET-CLI
               MOVE FIO-STAT TO PGM-STAT-DBC
               IF MSG-COD-MENS NOT > SPACES
                   MOVE DBC-KEY-IDBC IN DBC TO GDD-CIC-DCLI IN CMA-VARI
                   GO TO CON-BUS-DBC.
           IF DBC-GLS-NOMC IN GDD-FLD > SPACES
               MOVE DBC-GLS-NOMC IN GDD-FLD TO STR-GLS-GSTR
               PERFORM STR-UNS
               MOVE STR-GLS-FUNS IN STR-VARI(1) TO 
                    DBC-GLS-APAT IN DBC
               MOVE STR-GLS-FUNS IN STR-VARI(2) TO 
                    DBC-GLS-AMAT IN DBC
              MOVE STR-GLS-FUNS IN STR-VARI(3) TO 
                    DBC-GLS-NOMB IN DBC
               MOVE 'DBC-GLS-NOMC'   TO FIO-AKEY
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM GET-CLI
               MOVE FIO-STAT TO PGM-STAT-DBC
               IF MSG-COD-MENS NOT > SPACES
                   MOVE DBC-KEY-IDBC IN DBC TO GDD-CIC-DCLI IN CMA-VARI
                   GO TO CON-BUS-DBC.
      * No se encontro el padre 
           IF DBC-NUM-ICLI IN GDD-FLD NOT = ZEROES OR
              DBC-GLS-NOMC IN GDD-FLD > SPACES 
               MOVE 'CLI    NEX' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
      * Busca por el hijo
           MOVE GDD-CAI-GTIA IN GDD-FLD TO GDD-CAI-GTIA IN GDD.
           MOVE GDD-IIC-GTIA IN GDD-FLD TO GDD-IIC-GTIA IN GDD.

           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDD.
      *MHM-INI 01-DIC-2003
      *     MOVE '00' TO PGM-STAT-GDD.
           MOVE FIO-STAT TO PGM-STAT-GDD.
      *MHM-FIN 01-DIC-2003
           IF NOT FIO-STAT-OKS OR
              GDD-CAI-GTIA IN GDD NOT = GDD-CAI-GTIA IN GDD-FLD OR
              GDD-IIC-GTIA IN GDD NOT = GDD-IIC-GTIA IN GDD-FLD 

               MOVE 'GDD    NEX' TO MSG-COD-MENS
               MOVE GDD-CAI-GTIA IN GDD-FLD TO GDG-CAI-GTIA IN GDG
               MOVE GDD-IIC-GTIA IN GDD-FLD TO GDG-IIC-GTIA IN GDG
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM BGL-FIO-GDG

               MOVE FIO-STAT TO PGM-STAT-GDG
               IF NOT FIO-STAT-OKS
                   MOVE 'GDG    NEX' TO MSG-COD-MENS
                   GO TO ERR-FND-KEY
               ELSE
                   GO TO ERR-FND-KEY.

           GO TO EXA-COM-STAT.

       CON-BUS-DBC.
      *    se encontro el padre y busca el GDG
           MOVE '00' TO PGM-STAT-DBC.

      *    se digito el hijo, se busca directamente GDD
           IF GDD-IIC-GTIA IN GDD-FLD > ZEROES
               MOVE DBC-CAI-ICLI IN DBC TO CNE-GDD-CAI-DCLI
               MOVE DBC-IIC-ICLI IN DBC TO CNE-GDD-IIC-DCLI
               MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN GDD-FLD
               MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN GDD-FLD
               MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN GDD-FLD
               MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN GDD-FLD
               MOVE DBC-GLS-NOMC IN DBC TO DBC-GLS-NOMC IN GDD-FLD
               GO TO FND-DIRECTO.
           PERFORM BUS-ULT-GDD.
           IF MSG-COD-MENS > SPACES 
               GO TO ERR-FND-KEY.

           GO TO EXA-COM-STAT.

       FND-DIRECTO.
      *>>>> EVP-FIN INIFNDKEY
           PERFORM KEY-ALL-GDD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDD.
           IF FIO-STAT-OKS
               MOVE GDD-STP-ITRN IN GDD TO SCR-UMOD.
           MOVE FIO-STAT TO PGM-STAT-GDD.
      *<<<< EVP-INI FINFNDKEY

      *RRM-INI 26-SEP-2002
      *    Cuenta numero de deudores de la garantia
           PERFORM CUENTA-GDD.
           PERFORM KEY-GDD-GDD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDD.
           MOVE FIO-STAT TO PGM-STAT-GDD.
      *RRM-FIN 26-SEP-2002

           IF SCR-CCPP = 'ING'     AND FIO-STAT-OKS OR
              SCR-CCPP NOT = 'ING' AND NOT FIO-STAT-OKS 
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN GDD-FLD
               GO TO FIN-FND-KEY.

       EXA-COM-STAT.
           MOVE GDD-CAI-GTIA IN GDD TO GDD-CAI-GTIA IN GDD-FLD.
           MOVE GDD-IIC-GTIA IN GDD TO GDD-IIC-GTIA IN GDD-FLD.

           MOVE GDD-CAI-DCLI IN GDD TO CNE-GDD-CAI-DCLI.
           MOVE GDD-IIC-DCLI IN GDD TO CNE-GDD-IIC-DCLI.

           IF GDD-CIC-DCLI IN GDD NOT = GDD-CIC-DCLI IN CMA-VARI
               MOVE GDD-CIC-DCLI IN GDD TO DBC-KEY-IDBC IN DBC
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM SGC-FIO-DBC
               MOVE FIO-STAT TO PGM-STAT-DBC
               IF NOT FIO-STAT-OKS
                   MOVE 'CLI    NEX' TO MSG-COD-MENS
                   GO TO ERR-FND-KEY
               ELSE
                   MOVE DBC-KEY-IDBC IN DBC TO GDD-CIC-DCLI IN CMA-VARI.

           IF SCR-CCPP NOT = 'ING' AND
              GDD-KEY-AGDD IN GDD = GDD-KEY-AGDD IN CMA-VARI
               GO TO FIN-ANL-GDD.

           MOVE GDD-CAI-GTIA IN GDD TO GDG-CAI-GTIA IN GDG.
           MOVE GDD-IIC-GTIA IN GDD TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDG.

           MOVE FIO-STAT TO PGM-STAT-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG    NEX' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           MOVE GDD-KEY-AGDD IN GDD TO GDD-KEY-AGDD IN CMA-VARI.

       ANL-GDD.
      *MHM-INI 27-DIC-2004                                              
           IF SCR-CCPP NOT = 'ING' AND SCR-CCPP NOT = 'MOD'             
      *MHM-FIN 27-DIC-2004                                              
           IF GDG-MSC-STAT IN GDG = 'A'
                MOVE 'GDG    AGAYA' TO MSG-COD-MENS
                GO TO ERR-FND-KEY.

           IF SCR-CCPP = 'ACC' AND
              SCR-STAT = SCR-STAT-CON
              GO TO FIN-VAL-OFI-USP-GDD.
           IF SCR-OFRM-SRV                                              
              GO TO FIN-VAL-OFI-USP-GDD.                                

           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'OFIUSP'       TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S' )
               GO TO FIN-VAL-OFI-USP-GDD.
      *MHM-INI 29-JUL-2003
      *ALD-BCI-INI/07032000
           COPY USPC143.
           MOVE 'BGLGTUCG/CEN' TO USP-PTA-STR.
           COPY USPC103.
           IF USP-PERMISO = 'P'
               GO TO FIN-VAL-OFI-USP-GDD.
      *    COPY USPC143.
      *ALD-BCI-FIN/07032000
           IF USP-COD-OFICINA NOT = GDG-COD-OFIC IN GDG
               MOVE 'USRNODEOFI' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
      *MHM-FIN 29-JUL-2003
      
       FIN-VAL-OFI-USP-GDD.
           MOVE PGM-STAT-GDD TO FIO-STAT.

      * Garantia Alzada
           IF SCR-CCPP NOT = 'ACC' AND
               GDG-IND-EST1 IN GDG > '19'
               MOVE 'GDGALZ' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
      *<<<< FMT_CHI
           MOVE GDG-TIP-CGTA IN GDG TO GDG-TIP-CGTA IN GDD-FLD.
           MOVE GDG-STP-CGTA IN GDG TO GDG-STP-CGTA IN GDD-FLD.

           MOVE GDG-TIP-CGTA IN GDD-FLD TO TAG-TIP-AGTA IN TAG.
           MOVE GDG-STP-CGTA IN GDD-FLD TO TAG-STP-AGTA IN TAG.
      *>>>>
      
      *BUS-TAB Busca codigo de tabla
      
           MOVE 'TAB' TO TAB-COD-SIST.
      *<<<< GEN_BCI
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
      *>>>>
           MOVE SPACES TO TAB-COD-CTAB IN TAB.

      *<<<< FMT_CHI
           MOVE GDG-COD-CGTA IN GDG TO TAB-COD-CTAB IN TAB.
      *>>>>
           PERFORM BUS-TAB.
           IF MSG-COD-MENS = SPACES
      *MHM-INI 23-OCT-2003
      *         MOVE TAB-GLS-DESC IN TAB TO
      *              FRM-GLS-CGTA IN GDD-FLD
      *     ELSE
      *         MOVE SPACES TO FRM-GLS-CGTA IN GDD-FLD.
               MOVE TAB-GLS-DESC IN TAB     TO WSS-GLS-SOPE IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-SOPE IN WSS-VARI.

           IF GDG-TIP-CGTA IN GDD-FLD > SPACES
               MOVE 'TAB'                   TO TAB-COD-SIST
               MOVE 'TIO'                   TO TAB-COD-TTAB IN TAB
               MOVE SPACES                  TO TAB-COD-CTAB IN TAB
               MOVE GDG-TIP-CGTA IN GDD-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB     TO WSS-GLS-TOPE IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-TOPE IN WSS-VARI.

           MOVE WSS-GLS-CGTA TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO FRM-GLS-CGTA IN GDD-FLD.
      *MHM-FIN 23-OCT-2003

      * Busca Glosa Tabla Real/no Real
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM BGL-FIO-TAG.
           IF NOT FIO-STAT-OKS
                MOVE 'TAG    NEX' TO MSG-COD-MENS
                MOVE 'BGL' TO MSG-COD-SIST
                PERFORM GET-MSG
           ELSE
                MOVE SPACES TO MSG-COD-MENS
                MOVE 'BGL' TO TAB-COD-SIST
                MOVE 'RAL' TO TAB-COD-TTAB IN TAB
      
                MOVE TAG-IND-TREA IN TAG TO 
                     TAB-COD-CTAB IN TAB
                PERFORM BUS-TAB
                IF MSG-COD-MENS = SPACES
                    MOVE TAB-GLS-DESC IN TAB TO 
                         FRM-GLS-TREA IN GDD-FLD
                ELSE
                    MOVE SPACES TO FRM-GLS-TREA IN GDD-FLD.

           MOVE GDG-CAI-GTIA IN GDG TO GAR-CAI-GTIA IN CMA-VARI.
           MOVE GDG-IIC-GTIA IN GDG TO GAR-IIC-GTIA IN CMA-VARI.
           MOVE GDG-IND-GTAC IN GDG TO GAR-IND-GTAC IN CMA-VARI.

      * Valida Este permitido esta Entidad para Tipo-Subtipo
           IF TAG-IND-EGDD IN TAG = 'N'
               MOVE 'TAG    NOPGM' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           IF SCR-CCPP = 'ING'
               PERFORM PUT-DBC-GDD
               PERFORM PUT-GDG-GDD
           ELSE
           IF SCR-CCPP = 'ELI' AND 
              GDG-IND-GTAC IN GDG = 'S'
      *       Se posiciona por la llave del hijo
               MOVE 'GDD-KEY-AGDD' TO FIO-AKEY
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM BGL-FIO-GDD

      *    Busca siguiente por la llave del hijo
               MOVE 'GDD-KEY-AGDD' TO FIO-AKEY
               MOVE FIO-GET-NXT TO FIO-CMND
               PERFORM BGL-FIO-GDD
               IF NOT ( FIO-STAT-OKS AND
                        GDG-KEY-IGDG  IN GDG = GDD-KEY-AGDD  IN GDD
                      )
                   MOVE 'GDDELIULTDEU' TO MSG-COD-MENS
                   IF FIO-STAT-OKS 
                       MOVE 'GDD-KEY-AGDD' TO FIO-AKEY
                       MOVE FIO-END-BRW TO FIO-CMND
                       PERFORM BGL-FIO-GDD
                       GO TO ERR-FND-KEY
                   ELSE
                       GO TO ERR-FND-KEY
               ELSE
                   MOVE 'GDD-KEY-AGDD' TO FIO-AKEY
                   MOVE FIO-END-BRW TO FIO-CMND
                   PERFORM BGL-FIO-GDD
                   GO TO ERR-FND-KEY.
       FIN-ANL-GDD.
           MOVE PGM-STAT-GDD TO FIO-STAT. 
           GO TO FIN-FND-KEY.

       ERR-FND-KEY.
           IF MSG-COD-MENS = 'CLI    NEX' 
      *        busco por padre y no encontro padre
               MOVE SPACES TO PGM-STAT
               MOVE 'TAB' TO MSG-COD-SIST
               MOVE FIO-STAT-NEX TO PGM-STAT-DBC
           ELSE
      *        todos otros casos: el error pertenece al sistema GAR
               MOVE 'BGL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.

      * Todo malo, GENESIS deja pantalla en status aborto
           IF NOT ( PGM-STAT-DBC-OKS OR PGM-STAT-GDG-OKS OR
                    PGM-STAT-DBC-NUL OR PGM-STAT-GDG-NUL )
               IF SCR-CCPP = 'ING'
                   MOVE '00' TO FIO-STAT
                   GO TO FIN-FND-KEY
               ELSE
                   MOVE '23' TO FIO-STAT
                   GO TO FIN-FND-KEY.

      * DESPLIEGA DATOS DE DBC O GDG

           MOVE SCR-STAT-CON TO SCR-STAT.
           IF SCR-CCPP = 'ING' AND 
              PGM-STAT-DBC-OKS 
              PERFORM PUT-DBC-GDD.

           IF SCR-CCPP = 'ING' AND 
              PGM-STAT-GDG-OKS
              PERFORM PUT-GDG-GDD.

           IF SCR-CCPP = 'ING' 
               GO TO FIN-FND-KEY.

      * Despliega lo bueno o mantiene lo que habia, luego de PF's
           MOVE '00' TO FIO-STAT.

           GO TO FIN-FND-KEY.
      *>>>> EVP-FIN FINFNDKEY
       FIN-FND-KEY.
           IF FIO-STAT = FIO-STAT-NEX
               MOVE 'S' TO SCR-IERR.
       EXT-FND-KEY.
           EXIT.
 
       PUT-SCR SECTION.
       INI-PUT-SCR.
           IF PGM-STAT-GDD-OKS
               MOVE GDD-STP-ITRN IN GDD TO SCR-UMOD.
           PERFORM PUT-ALL-GDD.
      *<<<< FIN_PUT_SCR
      *PTC-INI-MAN                      
           IF SCR-OFRM-SRV              
      *MHM-INI 27-ENE-2004
              PERFORM PUT-QUE-GDD
      *MHM-FIN 27-ENE-2004
              PERFORM PUT-ALL-GDD-PTC.  
      *PTC-FIN-MAN                      
      *>>>>
       FIN-PUT-SCR.
           EXIT.

       STP-EXIT SECTION.
       INI-STP-EXIT.
           MOVE SCR-PROG TO PGM-PROG.
           MOVE SCR-NTRN TO PGM-NTRN.

           MOVE SCR-PROV TO SCR-PROG.
           MOVE SCR-NTRV TO SCR-NTRN.

           MOVE PGM-PROG TO SCR-PROV
           MOVE PGM-NTRN TO SCR-NTRV.
       FIN-STP-EXIT.
           EXIT.

       SCR-EXIT SECTION.
       INI-SCR-EXIT.
           MOVE 'P'      TO SCR-ICMN.
           MOVE SCR-NTRN TO SYS-NTRN.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-RTRN TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       FIN-SCR-EXIT.
           EXIT.

       SCR-PUTA SECTION.
       INI-SCR-PUTA.
      *PTC-INI
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE GDD-FLD TO FRM-DFLD.
           MOVE FRM-PUT-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-PUTA.
           EXIT.

       SCR-MSSG SECTION.
       INI-SCR-MSSG.
           IF FRM-MEN1 NOT > SPACES
               MOVE SPACES TO FRM-MEN1.
           IF FRM-MEN2 NOT > SPACES
               MOVE SPACES TO FRM-MEN2.
           MOVE FRM-MENS TO GDD-GLS-MENS.
       FIN-SCR-MSSG.
           EXIT.

       SCR-GKEY SECTION.
       INI-SCR-GKEY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-GDD
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO GDD-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GKEY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-GDD.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-GDD
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-GDD.
           PERFORM VAL-IKY-GDD.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-MKY-GDD.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-AKY-GDD.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-CON-KEY-GDD.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GKEY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-GDD.
       ERR-SCR-GKEY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-GDD.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GKEY.
           PERFORM SCR-MSSG.

       SCR-GIKY SECTION.
       INI-SCR-GIKY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-GDD
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO GDD-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GIKY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-GDD.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-IKY-GDD
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-GDD.
      *<<<< SCR_GIKY_VAL_IKY
      *PTC-INI-MAN                                            
           IF SCR-OFRM-SRV                                    
              MOVE WSX-NOM-TSGDG  TO QUE-COLA                 
              MOVE WSX-LEN-TSGDG  TO QUE-LITM                 
              MOVE QUE-GET        TO QUE-CMND                 
              MOVE 1 TO QUE-NITM
              PERFORM GNS-PRO-QUE                             
              IF QUE-STAT = QUE-STAT-OKS                      
                 MOVE QUE-ITEM      TO WSX-TAB-GDG            
                 MOVE WSX-CAI-NGAR TO GDD-CAI-GTIA IN GDD-FLD  
                 MOVE WSX-IIC-NGAR TO GDD-IIC-GTIA IN GDD-FLD. 
      *PTC-FIN-MAN                                            
      *>>>>
           PERFORM VAL-IKY-GDD.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GIKY.
           PERFORM VAL-CON-IKY-GDD.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GIKY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-GDD.
       ERR-SCR-GIKY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-IKY-GDD.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GIKY.
           PERFORM SCR-MSSG.

       GET-CON SECTION.
       INI-GET-CON.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
      *<<<< PFS_GET_CON OR PFS_GET_ACC
           IF NOT
              ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD = FRM-FFLD-PF6 OR
                FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD = FRM-FFLD-PF8 )
      *>>>>
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO GDD-GLS-MEN2
               MOVE SCR-PRMT     TO GDD-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO GDD-FLD.
       FIN-GET-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.

       CLR-MSG SECTION.
       INI-CLR-MSG.
           MOVE SPACES TO GDD-GLS-MENS.
       FIN-CLR-MSG.
           EXIT.

       HBL-IKY SECTION.
       INI-HBL-IKY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE GDD-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO GDD-FLD
      * FLB  7-NOV-1994
               PERFORM CLR-KEY-GDD

               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO GDD-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO GDD-GLS-MENS.
           PERFORM PRO-MKY-GDD.
           PERFORM PRO-AKY-GDD.
           PERFORM UNP-IKY-GDD.
           PERFORM FST-KEY-GDD.
       FIN-HBL-IKY.
           EXIT.

       HBL-KEY SECTION.
       INI-HBL-KEY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE GDD-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO GDD-FLD
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO GDD-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO GDD-GLS-MENS.
           PERFORM UNP-KEY-GDD.
           PERFORM FST-KEY-GDD.
       FIN-HBL-KEY.
           EXIT.

       HBL-FLD SECTION.
       INI-HBL-FLD.
           PERFORM PRO-IKY-GDD.
           PERFORM PRO-AKY-GDD.
           PERFORM UNP-MKY-GDD.
           PERFORM UNP-FLD-GDD.
           PERFORM FST-FLD-GDD.
       FIN-HBL-FLD.
           EXIT.

       FST-MSG SECTION.
       INI-FST-MSG.
           MOVE -1 TO GDD-GLS-MENS-LEN.
       FIN-FST-MSG.
           EXIT.

       PRO-ALL SECTION.
       INI-PRO-ALL.
           PERFORM PRO-KEY-GDD.
           PERFORM FST-MSG.
       FIN-PRO-ALL.
           EXIT.

       SCR-TRL SECTION.
       INI-SCR-TRL.
      *PTC-INI
           IF SCR-STAT NOT = SCR-STPP
               MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           IF FRM-MEN1 NOT > SPACES
               MOVE SCR-PRMT TO FRM-MEN1.
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM HBL-FLD
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-GDD
               PERFORM EDT-FLD-GDD
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GFL TO SCR-INST
               PERFORM SCR-EXIT.
           IF SCR-STAT = SCR-STAT-SON
               PERFORM PRO-ALL
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-GDD
               PERFORM EDT-FLD-GDD
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GCS TO SCR-INST
               PERFORM SCR-EXIT.
      *ASUME SCR-STAT-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.
      *    MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-GDD.
           PERFORM EDT-FLD-GDD.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-GAB TO SCR-INST.
           PERFORM SCR-EXIT.
       FIN-SCR-TRL.
           EXIT.

       DESSCRTRL SECTION.
       INI-DESSCRTRL.
           MOVE SCR-VFLD-NOT TO SCR-VFLD.
           MOVE FRM-FFLD TO SCR-FFLD.
       FIN-DESSCRTRL.
           IF SCR-FFLD-PF10 OR SCR-FFLD-PF3
                 MOVE SCR-INST-HCM TO SCR-INST
           ELSE
                 MOVE SCR-INST-HKY TO SCR-INST.
       EXT-DESSCRTRL.
           EXIT.

      * PGM-EBR-ALL SECTION.
      * INI-PGM-EBR-ALL.
      *     MOVE 'GNS' TO FIO-SIST.
      *     MOVE FIO-EBR-ALL TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      * FIN-PGM-EBR-ALL.
      *     EXIT.

       COPY BGLBQGDD.
       COPY GNSBVNUM.
       COPY BGLBFGDD.
       COPY GNSBFMSG.
       COPY GNSBGSYS.
       COPY GNSBGDTC.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSBGFRM.
       COPY GNSBG3CF.
      *PTC-FIN
       COPY GNSBGMSG.
       COPY GNSBEKEY.
       COPY GNSBIABT.
       COPY GNSBBTAB.
       COPY GNSBFTAB.
       COPY GNSBVIND.
       COPY GNSBVMSC.
       COPY GNSBFMSC.
       COPY GNSBVIDC.
       COPY GNSBPVRF.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY TABBBOFI.
       COPY TABBFOFI.
       COPY TABBBUSR.
       COPY TABBFUSR.
      *PTC-INI
       COPY GNSBGQUE.
       COPY GNSBGTSK.
      *PTC-FIN

      *<<<< EOF
       COPY GNSBGVSM.
       COPY GNSBHVSM.
      *>>>> END EOF
      *<<<< EOF
       RST-STAT SECTION.
       INI-RST-STAT.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
       FIN-RST-STAT.
           EXIT.

      *>>>>
      *<<<< EOF AND PGM_PQ
      *PTC-INI-MAN                                             
       PUT-ALL-GDD-PTC SECTION.                                
       INI-PUT-ALL-GDD-PTC.                                    
           MOVE ZEROES TO WSX-IDX-GDD.                         
           MOVE SPACES                  TO GDD-CIC-DCLI IN GDD. 
           MOVE GDD-CAI-GTIA IN GDD-FLD TO GDD-CAI-GTIA IN GDD.  
           MOVE GDD-IIC-GTIA IN GDD-FLD TO GDD-IIC-GTIA IN GDD.  
           MOVE FIO-GET-NLS TO FIO-CMND.                       
       LUP-PUT-ALL-GDD-PTC.                                    
      *  Se posiciona por la llave del hijo                    
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY                    
           PERFORM BGL-FIO-GDD.                                
           IF NOT (FIO-STAT-OKS AND                            
                   GDD-CAI-GTIA IN GDD-FLD = GDD-CAI-GTIA IN GDD AND
                   GDD-IIC-GTIA IN GDD-FLD = GDD-IIC-GTIA IN GDD)
              GO TO END-PUT-ALL-GDD-PTC.                       
                                                               
           ADD 1 TO WSX-IDX-GDD.                               
                                                               
           MOVE GDD-CAI-DCLI IN GDD TO DBC-CAI-ICLI IN DBC.    
           MOVE GDD-IIC-DCLI IN GDD TO DBC-IIC-ICLI IN DBC.    
           MOVE FIO-GET-KEY TO FIO-CMND.                       
           PERFORM SGC-FIO-DBC.                                
           IF NOT FIO-STAT-OKS                                 
              GO TO END-PUT-ALL-GDD-PTC.                       
                                                               
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.               
           PERFORM CPT-BLKS.                                   
           MOVE CPT-STRN TO WSX-GLS-NOMC IN WSX-TAB-GDD(WSX-IDX-GDD)
                                                               
           MOVE DBC-NUM-ICLI IN DBC TO                         
                WSX-NUM-ICLI IN WSX-TAB-GDD(WSX-IDX-GDD).      
           MOVE DBC-VRF-ICLI IN DBC TO                         
                WSX-VRF-ICLI IN WSX-TAB-GDD(WSX-IDX-GDD).      
           MOVE DBC-IND-ICLI IN DBC TO                         
                WSX-IND-ICLI IN WSX-TAB-GDD(WSX-IDX-GDD).      
           MOVE DBC-GLS-ICLI IN DBC TO                         
                WSX-GLS-ICLI IN WSX-TAB-GDD(WSX-IDX-GDD).      


           MOVE DBC-COD-EJEC IN DBC TO
                    WSX-COD-EJEC IN WSX-TAB-GDD(WSX-IDX-GDD).
      *BUS-USR busca usuario en tablas
           IF DBC-COD-EJEC IN DBC > SPACES
               MOVE DBC-COD-EJEC IN DBC TO USR-COD-USER IN USR
               PERFORM BUS-USR
               MOVE USR-GLS-DESC IN USR TO
               WSX-GLS-EJEC IN WSX-TAB-GDD(WSX-IDX-GDD)
           ELSE
               MOVE SPACES TO
                 WSX-GLS-EJEC IN WSX-TAB-GDD(WSX-IDX-GDD).

                                                               
           MOVE GDD-SGV-VLIM IN GDD TO                      
                WSX-VAL-LIM-DDR-EDT IN WSX-TAB-GDD(WSX-IDX-GDD)
                                                               
           MOVE GDD-SGV-PLIM IN GDD TO                      
                WSX-PCT-LIM-DDR-EDT IN WSX-TAB-GDD(WSX-IDX-GDD)
                                                               
           MOVE FIO-GET-NXT TO FIO-CMND.                       
           GO TO LUP-PUT-ALL-GDD-PTC.                          
                                                               
       END-PUT-ALL-GDD-PTC.                                    
           MOVE WSX-NOM-TSGDD  TO QUE-COLA.                    
           MOVE QUE-DEL        TO QUE-CMND.                    
           PERFORM GNS-PRO-QUE.                                
                                                               
           MOVE WSX-NOM-TSGDD  TO QUE-COLA.                    
           MOVE WSX-LEN-TSGDD  TO QUE-LITM.                    
           MOVE WSX-TAB-GDD    TO QUE-ITEM.                    
           MOVE QUE-PUT        TO QUE-CMND.                    
           PERFORM GNS-PRO-QUE.                                
       FIN-PUT-ALL-GDD-PTC.                                    
           EXIT.                                               
      *PTC-FIN-MAN                                             

      *MHM-INI 27-ENE-2004
       PUT-QUE-GDD SECTION.
       INI-PUT-QUE-GDD.
           MOVE WSY-NOM-TSGDD  TO QUE-COLA.
           MOVE QUE-DEL        TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           MOVE WSY-NOM-TSGDD  TO QUE-COLA.
           MOVE WSY-LEN-TSGDD  TO QUE-LITM.
      * ISP-INI 29-01-2004 11:30
            PERFORM KEY-DBC-GDD.
            MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY.
            MOVE FIO-GET-KEY TO FIO-CMND.
            PERFORM SGC-FIO-DBC.
      * ISP-FIN 29-01-2004 11:30
           MOVE DBC-GLS-APAT IN DBC TO WSY-GLS-APAT IN WSY-TAB-GDD.
           MOVE DBC-GLS-AMAT IN DBC TO WSY-GLS-AMAT IN WSY-TAB-GDD.
           MOVE DBC-GLS-NOMB IN DBC TO WSY-GLS-NOMB IN WSY-TAB-GDD.
           MOVE WSY-TAB-GDD    TO QUE-ITEM.
           MOVE QUE-PUT        TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
       FIN-PUT-QUE-GDD.
           EXIT.
      *MHM-FIN 27-ENE-2004


      *>>>>
      *<<<< EOF
      *OGB-INI 08-OCT-2015 LIMITE DE GARANTIAS
       COPY TABBFCAM.
      *OGB-FIN 08-OCT-2015 LIMITE DE GARANTIAS
       COPY BGLBFTAG.
       COPY GNSBVCOD.
       COPY GNSBVTAB.
      *<<<< EOFPQPU
       COPY SGCBFDBC.
       COPY BGLBFGDG.
       COPY BGLBFGVT.                                                   
       COPY SGCBGCLI.
       COPY GNSBGCPT.
       COPY GNSBGSTR.
       COPY GNSBEGLS.                                                   
      *>>>>
      *<<<< EOF AND PGM_PQ
      *>>>> NOT PGM_MCP
       LEE-NXT-PRV-XGDG SECTION.
       INI-LEE-NXT-PRV-XGDG.
           PERFORM POS-CMA.
           IF MSG-COD-MENS = 'GDD    NEX'
               GO TO BRW-LEE-NXT-PRV-XGDG.

      *<<<< NOT PGM_VMS
           IF FRM-FFLD = FRM-FFLD-PF7
               MOVE FIO-GET-PRV TO FIO-CMND
           ELSE
               MOVE FIO-GET-NXT TO FIO-CMND.
      *>>>>
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           PERFORM BGL-FIO-GDD.
           IF FIO-STAT-OKS AND
              GDD-KEY-AGDD IN GDD = GDD-KEY-AGDD IN CMA-VARI
               MOVE '00' TO PGM-STAT-GDD
           ELSE
               MOVE '23' TO PGM-STAT-GDD.

       BRW-LEE-NXT-PRV-XGDG.
           IF FIO-STAT-OKS 
               MOVE 'GDD-KEY-AGDD' TO FIO-AKEY
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM BGL-FIO-GDD.
       FIN-LEE-NXT-PRV-XGDG.
           EXIT.
       POS-CMA SECTION.
       INI-POS-CMA.
           MOVE GDD-KEY-AGDD IN CMA-VARI TO GDD-KEY-AGDD IN GDD.
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM BGL-FIO-GDD.
           IF NOT FIO-STAT-OKS OR
              GDD-KEY-AGDD IN GDD NOT = GDD-KEY-AGDD IN CMA-VARI 
               MOVE 'GDD    NEX' TO MSG-COD-MENS
               GO TO FIN-POS-CMA.

       LUP-POS-CMA.
           IF GDD-KEY-IGDD IN GDD = GAR-KEY-IGDD IN CMA-VARI 
               GO TO FIN-POS-CMA.

           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           PERFORM BGL-FIO-GDD.
           IF FIO-STAT-OKS AND
              GDD-KEY-AGDD IN GDD = GDD-KEY-AGDD IN CMA-VARI 
               GO TO LUP-POS-CMA.

           MOVE 'GDD    NEX' TO MSG-COD-MENS.
       FIN-POS-CMA.
           EXIT.
      *>>>>
       LEE-NXT-PRV-XDBC SECTION.
       INI-LEE-NXT-PRV-XDBC.
           MOVE GAR-KEY-IGDD IN CMA-VARI TO GDD-KEY-IGDD IN GDD. 
      *<<<< NOT PGM_VMS
           IF FRM-FFLD = FRM-FFLD-PF5
               MOVE FIO-GET-LEQ TO FIO-CMND
           ELSE
               MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM BGL-FIO-GDD.
           IF FRM-FFLD = FRM-FFLD-PF5
               MOVE FIO-GET-PRV TO FIO-CMND
           ELSE
               MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM BGL-FIO-GDD.

           IF FIO-STAT-OKS AND
              GDD-CIC-DCLI IN GDD = GDD-CIC-DCLI IN CMA-VARI
               MOVE '00' TO PGM-STAT-GDD
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM BGL-FIO-GDD
           ELSE
               IF FIO-STAT-OKS
                   MOVE FIO-END-BRW TO FIO-CMND
                   PERFORM BGL-FIO-GDD
                   MOVE '23' TO PGM-STAT-GDD.
       FIN-LEE-NXT-PRV-XDBC.
           EXIT.

       BUS-ULT-GDD SECTION.
       INI-BUS-ULT-GDD.
      *    se busca el ultimo hijo, luego de encontrar el padre
           MOVE DBC-KEY-IDBC IN DBC  TO GDD-CIC-DCLI IN GDD.
           MOVE SPACES               TO GDD-KEY-AGDD IN GDD.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM BGL-FIO-GDD.
           IF NOT FIO-STAT-OKS OR
              GDD-CIC-DCLI IN GDD NOT = DBC-KEY-IDBC IN DBC 
               MOVE 'GDD    NEX' TO MSG-COD-MENS
               IF FIO-STAT-OKS
                   MOVE FIO-END-BRW TO FIO-CMND
                   PERFORM BGL-FIO-GDD
                   GO TO FIN-BUS-ULT-GDD
               ELSE
                   GO TO FIN-BUS-ULT-GDD
           ELSE
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM BGL-FIO-GDD.

           MOVE SPACES TO MSG-COD-MENS.
           MOVE '00' TO PGM-STAT-GDD.
       FIN-BUS-ULT-GDD.
           EXIT.
      *>>>>

       CUENTA-GDD SECTION.
       INI-CUENTA-GDD.
           MOVE ZEROES TO FRM-NUM-QDEU IN CMA-VARI.
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM BGL-FIO-GDD.
       LUP-CUENTA-GDD.
           IF NOT ( FIO-STAT-OKS AND
              GDD-CAI-GTIA IN GDD = GDD-CAI-GTIA IN GDD-FLD AND
              GDD-IIC-GTIA IN GDD = GDD-IIC-GTIA IN GDD-FLD )
               GO TO BRW-CUENTA-GDD.

           ADD 1 TO FRM-NUM-QDEU IN CMA-VARI.

       NXT-CUENTA-GDD.
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM BGL-FIO-GDD.
           GO TO LUP-CUENTA-GDD.
       BRW-CUENTA-GDD.
           IF FIO-STAT-OKS
               MOVE 'GDD-KEY-AGDD' TO FIO-AKEY
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM BGL-FIO-GDD.
           MOVE FRM-NUM-QDEU IN CMA-VARI TO FRM-NUM-QDEU IN GDD-FLD.
       FIN-CUENTA-GDD.
           EXIT.
      *>>>>
