       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   BGLPUGVT.
       AUTHOR.       BEE.
       DATE-WRITTEN. 22-Jan-19 02:28 AM.

      * NOMBRE PROGRAMA                   BGLPUGVT
      * VERSION PGM                       3.1
      * VERSION SKL                       08.07.21
      * OPCION                            UPD
      * ARCHIVO BASE                      BGLGVT
      * PANTALLA                          BGLGVT
      * INP/OUT                           DATACOM
      * TAMANO COMMAREA                   250

      *-----------------------------------------------------------------
      *MODIFICACIONES:
      *--------------
      *OBJETIVO: REGULARIZAR MENSAJE EXCEPCION DE LA GVT
      *PROYECTO: ACT. DE EXC.PARA PREPAGOS DE OPERACIONES HIPOT. PREP.
      *FECHA   : ENERO DE 2012
      *AUTOR   : CHC
      *ETIQUETA:
      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
      *-----------------------------------------------------------------
      *PROYECTO: MENSAJE TASACION VENCIDA
      *OBJETIVO: VALIDAR QUE MONTO TASACION NO SEA MAYOR A 10000 UF 
      *AUTOR   : BEE-TEAM (PVC)
      *ETIQUETA: PVC-INI 29-Julio-2012 

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
      * COPY GNSWGSCR.
       COPY GNSWGCVT.
       77  WSS-TAG-BGLPUGVT-INI PIC X(125) VALUE                        
           '<IDNPGM NOM=$BGLPUGVT$ SKL=$08.07.21$ VSN=$06.06.29$        
      -    'GEN=$22-Jan-19 02:28 AM$ FNC=$OWFBGL$/>'.    
       COPY GNSWCSCR.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSWVSCR.
       COPY GNSWV3CR.
      *PTC-FIN
           03 CMA-VARI.
              05 GAR-CAI-GTIA                     PIC X(04).
              05 GAR-IIC-GTIA                     PIC X(08).
              05 GAR-IND-TPRE                     PIC X(01).
              05 GAR-IND-OMCT                     PIC X(01).
              05 GAR-SGV-PPON     COMP-3          PIC 9(03)V9(2).
              05 GAR-SGV-PAJU     COMP-3          PIC 9(03)V9(2).
              05 GAR-NUM-PVTS                     PIC 9(03).
              05 GAR-COD-TPVT                     PIC X(01).
              05 GAR-IND-GTAC                     PIC X(01). 
              05 GAR-COD-TASN                     PIC 9(03). 
      *<<<< NOT PGM_ARG
              05 WSS-SGV-VCTS     COMP-3           PIC S9(11)V9(4).
              05 WSS-SGV-LTSN     COMP-3           PIC S9(11)V9(4).
              05 WSS-SGV-VPND     COMP-3           PIC S9(11)V9(4).
              05 WSS-SGV-VGAS     COMP-3           PIC S9(11)V9(4).
              05 WSS-VALOR-LIQ    COMP-3           PIC S9(11)V9(4).
      *>>>>
              05 WSS-FEC-FRVL                       PIC 9(08).
              05 WSS-FEC-FTSN                       PIC 9(08).
      ** EVA-INI  10/07
              05 WSS-FEC-FURV                       PIC 9(08).
              05 WSS-FEC-FANR                       PIC 9(08).
      ** EVA-FIN  10/07
              05 WSS-LIQ-CML      COMP-3           PIC S9(1)V9(14).
              05 CMA-CIC-TGAR                      PIC X(06).
              05 CMA-IND-SMEC                      PIC X(01).
      *<<<< GEN_BCI
              05 CMA-IND-APLI                      PIC X(01).
              05 CMA-IND-TSWT                      PIC X(01).
      *>>>>
      *MHM-INI 29-OCT-2003
              05 CMA-CIC-UING                      PIC X(12).
      *MHM-FIN 29-OCT-2003
      ** EVA-INI  10/07
              05 WSS-IND-TASV       VALUE 'N'      PIC X(01).
      ** EVA-FIN  10/07
      *>>>>                                                             
       COPY BGLWIGVT.
       COPY BGLBRGVT.


       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSWGFRM.
       COPY GNSWG3CF.
       COPY GNSWGTSK.
       COPY GNSWGQUE.
      *PTC-FIN
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGSYS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY TABBROFI.

      ** EVA-INI  10/07
       COPY BGLBRGIM.
       COPY BGLBRTAS.
       COPY BGLBRGSL.
       COPY SGCBRDBC.
      ** EVA-FIN  10/07 
       COPY BGLBRGDG.                                                   
       COPY BGLBRACC.                                                   
       COPY BGLBRGDP.                                                   
      *<<<< GEN_BCI                                                     
       COPY BGLBRGSO.                                                   
      *>>>>                                                             
       COPY TABBRIVB.                                                   
       COPY TABBRUSR. 
      *<<<< GEN_BCI                                                     
       COPY BGLWXGTP.                                                   
       COPY BGLWXGVT.                                                   
       COPY BGLBRGDD.                                                   
       COPY COLBROPC.                                                   
       COPY COLBRRDC.                                                   
      *>>>>                                                             
       COPY BGLBRGES.                                                   
       COPY BGLBRGSE.                                                   
       COPY BGLBRGTP.                                                   
       COPY BGLBRTAG.                                                   
       COPY TABBRCAM.                                                   
      *   
      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
       COPY BGLBRETP.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ETP-REQA==.
      *AFRI-FIN/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
      *<<<< PGM_PU
       COPY BGLBRGMO.
      *>>>>
       01  WSS-VARI.   


      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
           03 WSS-NUM-CONT                      PIC 9(08).
           03 WSS-IND-IEXC                      PIC X(01).
      *AFRI-FIN/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012

      *      ** Correccion Monetaria - Revalorizador **      *
      *               SEPTIEMBRE 2007  -  AFRI *             *


      ** EVA-INI  09/07

           03 WSS-FEC-FULR.
              05 WSS-NUM-SULR                   PIC 9(02).
              05 WSS-NUM-AULR                   PIC 9(02).
              05 WSS-NUM-MULR                   PIC 9(02).
              05 WSS-NUM-DULR                   PIC 9(02).

      *AFRI-INI/JUN2006  
           03 WSS-VAL-DIFE                      PIC 9(03).
           03 WSS-VAL-PCTJ                      PIC 9(03).
           03 WSS-AUX-DIFE                      PIC 9(03).
           03 WSS-AUX-PCTJ                      PIC 9(03).
      ** EVA-FIN  09/07
           03 WSS-LST-GLOSA.                                            
              05 WSS-LST-PPON                  PIC X(05).               
              05 WSS-LST-RSTO                  PIC X(55).               
           03 WSS-NUM-PPON                     PIC 9(05).               
           03 WSS-VAL-PPON                     PIC S9(03)V9(02).        
           03 WSS-NEM-GLOSA.                                            
              05 WSS-NEM-ACCN                  PIC X(01).               
              05 WSS-NEM-RSTO                  PIC X(59).               
      *AFRI-FIN/JUN2006                                                 
           03 WSS-CIC-TIAU                        PIC X(06).            
           03 WSS-TIPO-AUX.                                             
              05 WSS-TIPO-1                       PIC X(03).            
              05 WSS-AUX-1                        PIC X(03).            
           03 WSS-TIPO-DIV.                                             
              05 WSS-TIPO                          PIC X(03).           
              05 WSS-DIV                           PIC X(03).           
           03 WSS-TSG-OPE.                                              
              05 WSS-COD-TOPE                   PIC X(03).              
              05 WSS-COD-SOPE                   PIC X(03).              
      *                                                                 
           03 WSS-COD-PESO.                                             
              05 WSS-IND-TMON                  PIC X(01).               
              05 WSS-COD-REST                  PIC X(05).               
      *<<<< NOT PGM_ARG                                                 
           03 WSS-VAL-PESO                     PIC S9(11).              
           03 WSS-SGV-VCTS-AUX COMP-3          PIC S9(11)V9(04).        
      *>>>>                                                             
           03 GAR-COD-ITSN                     PIC 9(03).               
           03 WSS-AUX         COMP-3           PIC S9(03)V9(12).        
           03 WSS-IMAL                         PIC 9(01).               
      * EVA-AFRI/MAY2006                                                
           03 WSS-GLS-DATA.                                             
              05 WSS-NUM-FVCT                     PIC 9(03).            
              05 WSS-COD-FVCT                     PIC X(01).            
                                                                        
           03 WSS-NUM-PVTS                     PIC 9(03).               
           03 WSS-COD-TPVT                     PIC X(01).               
           03 WSS-FEC-FECH.                                             
              05 WSS-NUM-STM3                   PIC 9(02).              
              05 WSS-NUM-ATM4                   PIC 9(02).              
              05 WSS-NUM-MTM2                   PIC 9(02).              
              05 WSS-NUM-DTM1                   PIC 9(02).              
           03 WSS-FEC-FTSC.                                             
              05 WSS-NUM-STSC                   PIC 9(02).              
              05 WSS-NUM-ATSC                   PIC 9(02).              
              05 WSS-NUM-MTSC                   PIC 9(02).              
              05 WSS-NUM-DTSC                   PIC 9(02).              
           03 WSS-FEC-FTSN.
              05 WSS-NUM-STSN                   PIC 9(02).
              05 WSS-NUM-ATSN                   PIC 9(02).
              05 WSS-NUM-MTSN                   PIC 9(02).
              05 WSS-NUM-DTSN                   PIC 9(02).
      * FIN-AFRI/MAY2006                                                
      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
           03 WSS-COD-CMSG                      PIC X(12).
           03 WSS-GLS-CMSG                      PIC X(50).
      *AFRI-FIN/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012                                                                       
      *<<<< GEN_BCI                                                     
           03 WSS-CIC-TOPE    VALUE SPACES      PIC X(03).              
           03 WSS-IND-HIPT    VALUE SPACES      PIC X(01).              
           03 WSS-IND-ENFE    VALUE SPACES      PIC X(01).              
      *    INDICADOR DE EXCEPCION NORMATIVA DE TASACION UNO             
           03 WSS-IND-ENT1    VALUE SPACES      PIC X(01).              
      *    INDICADOR DE EXCEPCION NORMATIVA DE TASACION DOS             
           03 WSS-IND-ENT2    VALUE SPACES      PIC X(01).              
      *    INDICADOR DE EXCEPCION NORMATIVA DE TASACION TRES            
           03 WSS-IND-ENT3    VALUE SPACES      PIC X(01).              
           03 WSS-VAL-SCRE    VALUE ZEROES      PIC 9(13)V9(04).        
                                                                        
           03 WSS-FEC-FTRA.                                             
              05 WSS-NUM-STRA                   PIC 9(02).              
              05 WSS-NUM-ATRA                   PIC 9(02).              
              05 WSS-NUM-MTRA                   PIC 9(02).              
              05 WSS-NUM-DTRA                   PIC 9(02).              
      *    03 WSS-IND-TASV       VALUE 'N'      PIC X(01).
      *MHM-INI 23-OCT-2003                                              
           03 WSS-GLS-CGTA.                                             
              05 WSS-GLS-TOPE                   PIC X(40).              
              05 WSS-GLS-SOPE                   PIC X(40).              
      *MHM-FIN 23-OCT-2003                                              
      * EVA-INI  06/08
           03 WSS-COD-CGTA.
              05 WSS-STP-CGTA                   PIC X(03).
              05 WSS-TIP-CGTA                   PIC X(03).
      * EVA-FIN  06/08
      *>>>>                                                             
      * Variables para determinar vigencia de Tasacion                  
      * deben estar bajo WSS-VARI                                       
       COPY BGLWGEXV.                                                   
       COPY GNSWGPES.                                                   
      *MHM-INI 23-OCT-2003                                              
       COPY GNSWGCPT.                                                   
      *MHM-FIN 23-OCT-2003  
      *<<<< GEN_BCI                                                     
       COPY BGLWGVCG.                                                   
      *>>>>                                                             
      *<<<< PGM_DTC 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GMO-REQA==.
      ** EVA-INI  10/07
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSL-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAS-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GIM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      ** EVA-FIN  10/07
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-IVB-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ACC-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDP-REQA==.        
      *<<<< GEN_BCI                                                     
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSO-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.        
      *>>>>                                                             
      *<<<< PGM_PQ                                                      
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GES-REQA==.        
      *>>>>                                                             
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSE-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GTP-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.        
      *                                                                 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.        
      *>>>>                                                       
       01  PGM-VARI.
           03 PGM-ICLR                  VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-TODO          VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-LLAVES        VALUE 'K'       PIC X(01).
           03 PGM-LIMPIAR-CAMPOS        VALUE 'F'       PIC X(01).
           03 PGM-NO-LIMPIAR-NADA       VALUE 'N'       PIC X(01).
           03 PGM-PROG                                  PIC X(08).
           03 PGM-NTRN                                  PIC X(04).
           03 PGM-STAT.
              05 PGM-STAT-GVT.
                 88 PGM-STAT-GVT-NUL    VALUE '  '.
                 07 PGM-STT1-GVT        VALUE '2' PIC X(01).
                    88 PGM-STAT-GVT-OKS VALUE '0'.
                 07 PGM-STT2-GVT        VALUE '3' PIC X(01).
              05 PGM-STAT-GDG.
                 88 PGM-STAT-GDG-NUL    VALUE '  '.
                 07 PGM-STT1-GDG        VALUE '2' PIC X(01).
                    88 PGM-STAT-GDG-OKS VALUE '0'.
                 07 PGM-STT2-GDG        VALUE '3' PIC X(01).
           03 PGM-SRNF                  VALUE '23'      PIC X(02).
           03 PGM-SOKS                  VALUE '00'      PIC X(02).
           03 PGM-SNUL                  VALUE '  '      PIC X(02).
           03 PGM-SUAR                  VALUE SPACES    PIC X(15).

       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 FILLER                    PIC X(501).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
       LUP-MAIN.
           IF SCR-INST = SCR-INST-HCM
                 PERFORM SCR-COM.
           IF SCR-CCPP = 'MOD'
                 PERFORM SCR-MOD
           ELSE
           IF SCR-CCPP = 'ING'
                 PERFORM SCR-ING
           ELSE
           IF SCR-CCPP = 'ACC'
                 PERFORM SCR-ACC
           ELSE
           IF SCR-CCPP = 'ELI'
                 PERFORM SCR-ELI
           ELSE
           IF SCR-CCPP = 'ACT'
                 PERFORM SCR-ACT
           ELSE
           IF SCR-CCPP = 'PGM'
                 PERFORM SCR-PGM
           ELSE
                 MOVE SCR-INST-HCM TO SCR-INST.
           GO TO LUP-MAIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
       COPY GNSBGEIB.
       COPY GNSBGEDB.
           MOVE LOW-VALUES TO GVT-FLD.
           MOVE LOW-VALUES TO GVT-EDT.
           PERFORM GNS-PRO-RCK.
           PERFORM GNS-BUS-VCA.
           MOVE +501 TO SCR-TCMA.
           PERFORM GNS-HDL-SYS.
           PERFORM GNS-HDL-FRM.
           MOVE 'BGLPUGVT' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      *PTC-INI
           PERFORM GNS-ERR-QUE.
           PERFORM GET-TSK-TERM.
      *PTC-FIN
      *<<<< INI_FIO
           MOVE TSK-TERM-ALF TO WSX-COD-TERM IN WSX-TSGTP.
           MOVE TSK-TERM-ALF TO WSX-COD-TERM IN WSX-TSGVT.
           MOVE +372 TO SCR-TCMA.
           IF SCR-DESDE-CMN
               MOVE ZEROES TO WSS-FEC-FTSN IN CMA-VARI,
                              WSS-FEC-FRVL IN CMA-VARI,
      ** EVA-INI  10/07
                              WSS-FEC-FURV IN CMA-VARI,
                              WSS-FEC-FANR IN CMA-VARI,
      ** EVA-FIN  10/07
                              WSS-LIQ-CML  IN CMA-VARI.
      *>>>>
       FIN-INI.
           EXIT.

       COPY GNSBHSYS.
       COPY GNSBHFRM.
       COPY GNSBPRCK.
       COPY GNSBBVCA.
       COPY GNSBBIDD.

       SCR-COM SECTION.
       INI-SCR-COM.
           PERFORM STP-EXIT.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-GVT.
           PERFORM EDT-KEY-GVT.
           PERFORM EDT-FLD-GVT.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-HCM TO SCR-INST.
           MOVE SCR-CMNP     TO SYS-PROG.
           MOVE SCR-VARI     TO SYS-CMMA.
           MOVE SCR-TCMA     TO SYS-TCMA.
           MOVE SYS-XCTL     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       XCT-ERR.
           MOVE 'XCTERR    ' TO MSG-COD-MENS.
           MOVE 'GNS'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO SYS-MEN1.
           MOVE SYS-PROG     TO SYS-MEN2.
           MOVE SYS-ABOR     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       COPY GNSBGGBK.
       FIN-SCR-COM.
           EXIT.

       SCR-MOD SECTION.
       INI-SCR-MOD.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GFL
               PERFORM GET-FLD
           ELSE
           IF SCR-INST = SCR-INST-GCS
               PERFORM GET-ACC.
           PERFORM DESSCRTRL.
           IF FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM XCT-PRGP.
           IF NOT ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 )
               GO TO MSG-SCR-MOD.
       MSG-SCR-MOD.
           IF SCR-STAT = SCR-STAT-CON
               MOVE SPACES TO FRM-MENS
           ELSE
           IF SCR-STAT = SCR-STAT-ABT OR SCR-VFLD = SCR-VFLD-NOT
               MOVE 'MODNOT    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
           ELSE
               MOVE SPACES TO FRM-MENS
               PERFORM CMN-MOD
               IF FIO-STAT-OKS
                   IF FRM-MEN1 NOT > SPACES
                       MOVE 'MODYES    ' TO MSG-COD-MENS
                       MOVE 'GNS' TO MSG-COD-SIST
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MEN1
                   ELSE
                       NEXT SENTENCE
               ELSE
               IF FRM-MENS NOT > SPACES
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-MOD.
           EXIT.

       SCR-ING SECTION.
       INI-SCR-ING.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-IKY
               MOVE SCR-INST-GKY TO SCR-INST
      *PTC-INI
               IF NOT SCR-OFRM-SRV
                   PERFORM SCR-DMSG
               ELSE
                   PERFORM SCR-PUTA
      *PTC-FIN
           ELSE
           IF SCR-INST = SCR-INST-GFL
                PERFORM GET-FLD
           ELSE
           IF SCR-INST = SCR-INST-GCS
                PERFORM GET-ACC.
           PERFORM DESSCRTRL.
       MSG-SCR-ING.
           IF SCR-STAT = SCR-STAT-CON
               MOVE SPACES TO FRM-MENS
           ELSE
           IF SCR-STAT = SCR-STAT-ABT OR SCR-VFLD = SCR-VFLD-NOT
               MOVE 'INGNOT    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
           ELSE
               MOVE SPACES TO FRM-MENS
               PERFORM CMN-ING
               IF FIO-STAT-OKS
                   IF FRM-MEN1 NOT > SPACES
                       MOVE 'INGYES    ' TO MSG-COD-MENS
                       MOVE 'GNS' TO MSG-COD-SIST
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MEN1
                   ELSE
                       NEXT SENTENCE
               ELSE
               IF FRM-MENS NOT > SPACES
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ING.
           EXIT.

       SCR-ACC SECTION.
       INI-SCR-ACC.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GFL
                PERFORM GET-FLD
           ELSE
           IF SCR-INST = SCR-INST-GCS
                PERFORM GET-ACC.
           PERFORM DESSCRTRL.
           IF FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF8 OR
                         FRM-FFLD-PF5 OR FRM-FFLD-PF6
               PERFORM XCT-PRGP.
           MOVE SPACES TO FRM-MENS.
           IF SCR-STAT NOT = SCR-STAT-CON
               PERFORM CMN-ACC.
           PERFORM SCR-MSSG.
       FIN-SCR-ACC.
           EXIT.

       SCR-ELI SECTION.
       INI-SCR-ELI.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GCS
                PERFORM GET-ACC.
           PERFORM DESSCRTRL.
           IF FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF8 OR
                         FRM-FFLD-PF5 OR FRM-FFLD-PF6
               PERFORM XCT-PRGP.
           IF SCR-STAT = SCR-STAT-CON
               MOVE SPACES TO FRM-MENS
           ELSE
           IF SCR-STAT = SCR-STAT-ABT OR SCR-VFLD = SCR-VFLD-NOT
               MOVE 'ELINOT    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
           ELSE
               MOVE SPACES TO FRM-MENS
               PERFORM CMN-ELI
               IF FIO-STAT-OKS
                   IF FRM-MEN1 NOT > SPACES
                       MOVE 'ELIYES    ' TO MSG-COD-MENS
                       MOVE 'GNS' TO MSG-COD-SIST
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MEN1
                   ELSE
                       NEXT SENTENCE
               ELSE
               IF FRM-MENS NOT > SPACES
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ELI.
           EXIT.

       SCR-ACT SECTION.
       INI-SCR-ACT.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GFL
                PERFORM GET-FLD
           ELSE
           IF SCR-INST = SCR-INST-GCS
                PERFORM GET-ACC.
           PERFORM DESSCRTRL.
           IF ( FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF8  OR
                           FRM-FFLD-PF5 OR FRM-FFLD-PF6 ) AND
              SCR-ACTU = SCR-ACTU-MOD
               PERFORM XCT-PRGP.
           IF SCR-ACTU = SCR-ACTU-MOD
                  PERFORM MSG-SCR-MOD
           ELSE
                  PERFORM MSG-SCR-ING.
       FIN-SCR-ACT.
           EXIT.

       SCR-PGM SECTION.
       INI-SCR-PGM.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GFL
                PERFORM GET-FLD
           ELSE
           IF SCR-INST = SCR-INST-GCS
                PERFORM GET-ACC.
       TRL-SCR-PGM.
           PERFORM DESSCRTRL.
           IF FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF8 OR
                         FRM-FFLD-PF5 OR FRM-FFLD-PF6
               PERFORM XCT-PRGP.
           MOVE SPACES TO FRM-MENS.
           IF SCR-STAT NOT = SCR-STAT-CON
               PERFORM CMN-PGM.
           PERFORM SCR-MSSG.
       FIN-SCR-PGM.
           EXIT.

       SCR-DMSG SECTION.
       INI-SCR-DMSG.
           IF PGM-ICLR = PGM-NO-LIMPIAR-NADA
               NEXT SENTENCE
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-TODO
               PERFORM SCR-CLRA-GVT
               PERFORM EDT-KEY-GVT
               PERFORM EDT-FLD-GVT
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-LLAVES
               PERFORM CLR-KEY-GVT
               PERFORM EDT-KEY-GVT
           ELSE
               PERFORM CLR-FLD-GVT
               PERFORM EDT-FLD-GVT.
           PERFORM STP-EXIT.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-DMSG.
           EXIT.

       XCT-PRGP SECTION.
       INI-XCT-PRGP.
           MOVE SCR-INST-BRW TO SCR-INST.
           PERFORM STP-EXIT.
           MOVE FRM-FFLD   TO SCR-FFLD.
      *
           MOVE SCR-PROG     TO SYS-PROG.
           MOVE SCR-VARI     TO SYS-CMMA.
           MOVE SCR-TCMA     TO SYS-TCMA.
           MOVE SYS-XCTL     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
           PERFORM XCT-ERR.
       FIN-XCT-PRGP.
           EXIT.

       SCR-RST SECTION.
       INI-SCR-RST.
           MOVE SPACES       TO PGM-ICLR.
           MOVE SPACES       TO SCR-ACTU.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
           MOVE LOW-VALUES   TO GVT-FLD.
           MOVE LOW-VALUES TO GVT-EDT.
       FIN-SCR-RST.
           EXIT.

       GET-FLD SECTION.
       INI-GET-FLD.
           PERFORM SCR-GFLD.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-FLD.
           EXIT.

       CMN-MOD SECTION.
       INI-CMN-MOD.
      *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
           PERFORM LEE-GDD.
           PERFORM LLENAR-ANTES.
           PERFORM GRABAR-LGN.
      *MPS-FIN 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
           PERFORM KEY-ALL-GVT.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF FIO-STAT-OKS AND
              GVT-STP-ITRN IN GVT NOT = SCR-UMOD
               MOVE FIO-ULK-REC TO FIO-CMND
               PERFORM BGL-FIO-GVT
               MOVE FIO-BCK-OUT TO FIO-CMND
               PERFORM BGL-FIO-GVT
               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'GNSACCSSIMUL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               GO TO FIN-CMN-MOD.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-MOD.
           PERFORM RET-STT-GVT.
           PERFORM RET-ALL-GVT.
           PERFORM RET-HDR-GVT.
      *<<<< INI_CMN_ING OR INI_CMN_MOD
           PERFORM GET-FHOY.
           IF SCR-CCPP = 'ING'
              OR SCR-CMND = 'COP'
               MOVE 'I'      TO GVT-MSC-TACC IN GVT
               MOVE HOY-FHOY TO GVT-FEC-FING IN GVT
               MOVE SCR-USER TO GVT-CIC-UING IN GVT
           ELSE
               MOVE 'M'      TO GVT-MSC-TACC    IN GVT.
      *>>>>
      *<<<< CMN_MOD
           IF SCR-CMND = 'ATA'
               MOVE 'A' TO GVT-MSC-STAT IN GVT
               IF GAR-IND-GTAC IN CMA-VARI = 'S'
                   PERFORM ESC-MOD-GVT
                   IF MSG-COD-MENS > SPACES
                       GO TO FIN-CMN-MOD.
      *>>>>
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
      *<<<< FIN_CMN_MOD
           IF NOT FIO-STAT-OKS
      *        ERROR INCONSISTENCIA EN LA MODIFICACION : INFORMAR
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-MOD.

           IF SCR-CMND = 'ATA'
               MOVE GVT-CAI-GTIA IN GVT TO GDG-CAI-GTIA IN GDG
               MOVE GVT-IIC-GTIA IN GVT TO GDG-IIC-GTIA IN GDG
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM BGL-FIO-GDG
               IF FIO-STAT-OKS
                   MOVE 'S'                 TO GDG-IND-EGVT IN GDG
                   MOVE 'S'                 TO GDG-IND-EGTP IN GDG
                   MOVE GVT-COD-TASN IN GVT TO GDG-COD-TSCN IN GDG
                   MOVE FIO-MOD TO FIO-CMND
                   PERFORM BGL-FIO-GDG.
      *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
           PERFORM LLENAR-DESPUES.
           PERFORM GRABAR-LGN.
      *MPS-FIN 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
      *>>>>
      * PTC-INI-MAN
      *    IF SCR-OFRM-SRV AND SCR-CMND = 'MOD'
      *       PERFORM ELI-GTP.
      * PTC-FIN-MAN
       FIN-CMN-MOD.
           EXIT.

       CMN-ING SECTION.
       INI-CMN-ING.
           MOVE SPACES TO GVT.
      *<<<< INI_CMN_ING
      *<<<< GEN_BCI
           IF SCR-CMND = 'RTF'
               PERFORM OBT-VALOR-MONNAC
               PERFORM OBT-VAL-RTF.
      *>>>>
           MOVE SPACES TO GVT-GLS-FLAG IN GVT.
           MOVE SPACES TO GVT-MSC-TACC IN GVT.
      *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
      *     MOVE SPACES TO GVT-CIC-UING IN GVT.
           MOVE SCR-USER TO GVT-CIC-UING IN GVT.
      *MPS-FIN 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
           MOVE 'I'    TO GVT-MSC-STAT IN GVT.

      *>>>>
           PERFORM RET-STT-GVT.
           PERFORM RET-ALL-GVT.
           PERFORM RET-HDR-GVT.
       NO-CMN-ING.
      *<<<< INI_CMN_ING OR INI_CMN_MOD
           PERFORM GET-FHOY.
           IF SCR-CCPP = 'ING'
              OR SCR-CMND = 'COP'
               MOVE 'I'      TO GVT-MSC-TACC IN GVT
               MOVE HOY-FHOY TO GVT-FEC-FING IN GVT
               MOVE SCR-USER TO GVT-CIC-UING IN GVT
           ELSE
               MOVE 'M'      TO GVT-MSC-TACC    IN GVT.
      *>>>>
      *<<<< CMN_ING
           IF SCR-CCPP = 'ING'
               IF FRM-IND-GTP IN GVT-FLD = 'S'
                   MOVE 'I' TO GVT-MSC-STAT IN GVT
               ELSE
                   MOVE 'A' TO GVT-MSC-STAT IN GVT
           ELSE
               PERFORM REV-GDG-GTP
               ADD 1  TO GVT-COD-TASN  IN GVT-FLD
               MOVE GVT-COD-TASN IN GVT-FLD TO GVT-COD-TASN IN GVT
               PERFORM COP-GTP
               IF MSG-COD-MENS = SPACES
                   PERFORM ESC-MOD-GVT
                   IF MSG-COD-MENS > SPACES
                       GO TO FIN-CMN-ING
                   ELSE
      *MHM-INI 16-OCT-2003
      *                 NEXT SENTENCE
                      IF SCR-CMND = 'RTF'
                          PERFORM REST-VAL-GVT
                      ELSE
                          NEXT SENTENCE
      *MHM-FIN 16-OCT-2003
               ELSE
                   GO TO FIN-CMN-ING.
      *>>>>
      ** EVA-INI  10/07
           MOVE ZEROES TO GVT-SGV-FISI IN GVT.
      ** EVA-FIN  10/07
      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
           IF SCR-CMND = 'RTA' OR SCR-CMND = 'RTF' OR SCR-CMND = 'RVL'
              IF WSS-IND-IEXC IN WSS-VARI = 'N'
                 MOVE 'S' TO GVT-IND-IEXC IN GVT
                 PERFORM PRO-GRB-ETP.
      *AFRI-FIN/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
      *<<<< FIN_CMN_ING

           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en el ingreso : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ING.

      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
           PERFORM LEE-GDD.
           PERFORM LLENAR-DESPUES.
           PERFORM GRABAR-LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2

           MOVE GVT-CAI-GTIA IN GVT TO GDG-CAI-GTIA IN GDG.
           MOVE GVT-IIC-GTIA IN GVT TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF FIO-STAT-OKS
               MOVE GVT-COD-TASN IN GVT TO GDG-COD-TSCN IN GDG
               IF FRM-IND-GTP IN GVT-FLD = 'S' AND
                  GVT-SGV-VGAS IN GVT NOT > ZEROES
                   MOVE FIO-MOD TO FIO-CMND
                   PERFORM BGL-FIO-GDG
                   GO TO FIN-CMN-ING
               ELSE
                   MOVE 'S' TO GDG-IND-EGVT IN GDG
               MOVE FIO-MOD TO FIO-CMND
               PERFORM BGL-FIO-GDG.
      *>>>>
       FIN-CMN-ING.
           EXIT.

       CMN-ACC SECTION.
       INI-CMN-ACC.
           IF SCR-STAT = SCR-STAT-ABT OR SCR-VFLD = SCR-VFLD-NOT
               MOVE 'ACCION NO REALIZADA' TO FRM-MENS
      *<<<< ABT_CMN_ACC
      *MHM-INI 11-SEP-2003
               IF SCR-CMND = 'RTF'
                   MOVE 'BGL'        TO MSG-COD-SIST
                   MOVE 'RTF    NO'  TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-CMN-ACC
               ELSE
      *MHM-FIN 11-SEP-2003
               IF SCR-CCPP = 'ACC' AND SCR-STPP NOT = SCR-STAT-CON
                   MOVE 'BGL'        TO MSG-COD-SIST
                   MOVE 'RTARVL NO'  TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-CMN-ACC
               ELSE
      *>>>>
               GO TO FIN-CMN-ACC.
      *<<<< INI_CMN_ACC
      *MHM-INI 11-SEP-2003
           MOVE GVT-CAI-GTIA IN GVT-FLD TO GDG-CAI-GTIA IN GDG.
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'BGL'         TO MSG-COD-SIST
               MOVE 'GDG    NEX'  TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-ACC.

      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
           PERFORM KEY-ALL-GVT.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           MOVE GVT-IND-IEXC IN GVT TO WSS-IND-IEXC IN WSS-VARI.
      *AFRI-FIN/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
      *MHM-FIN 11-SEP-2003
      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
           PERFORM LEE-GDD.
           PERFORM LLENAR-DESPUES.
           PERFORM GRABAR-LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
           IF SCR-CCPP = 'ACC' AND SCR-STPP NOT = SCR-STAT-CON
               PERFORM CMN-ING
               IF FIO-STAT-OKS
      *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
      *        PERFORM LLENAR-DESPUES
      *        PERFORM GRABAR-LGN
      *MPS-FIN 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
      *MHM-INI 11-SEP-2003
               IF SCR-CMND = 'RTF'
                   MOVE 'BGL'        TO MSG-COD-SIST
                   MOVE 'RTF    SI'  TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-CMN-ACC
               ELSE
      *MHM-FIN 11-SEP-2003
                   MOVE 'BGL'        TO MSG-COD-SIST
                   MOVE 'RTARVL SI'  TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-CMN-ACC
               ELSE
                   MOVE 'GNS'          TO MSG-COD-SIST
                   MOVE 'REG    ERCOP' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC   TO FRM-MENS
                   GO TO FIN-CMN-ACC
           ELSE
               MOVE 'GNS'          TO MSG-COD-SIST
               MOVE 'REG    ERCOP' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC   TO FRM-MENS
               GO TO FIN-CMN-ACC.
      *>>>>
           PERFORM KEY-ALL-GVT.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF FIO-STAT-OKS AND
              GVT-STP-ITRN IN GVT NOT = SCR-UMOD
               MOVE FIO-ULK-REC TO FIO-CMND
               PERFORM BGL-FIO-GVT
               MOVE FIO-BCK-OUT TO FIO-CMND
               PERFORM BGL-FIO-GVT
               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'GNSACCSSIMUL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-ACC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-ACC.
           PERFORM RET-ALL-GVT.
       FIN-CMN-ACC.
           EXIT.

       CMN-ELI SECTION.
       INI-CMN-ELI.
           PERFORM KEY-ALL-GVT.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
           IF FIO-STAT-OKS AND
              GVT-STP-ITRN IN GVT NOT = SCR-UMOD
               MOVE FIO-ULK-REC TO FIO-CMND
               PERFORM BGL-FIO-GVT
               MOVE FIO-BCK-OUT TO FIO-CMND
               PERFORM BGL-FIO-GVT
               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'GNSACCSSIMUL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-ELI.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-ELI.
      *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
           PERFORM LEE-GDD.
           PERFORM LLENAR-ANTES.
           PERFORM GRABAR-LGN.
      *MPS-FIN 21-SEP-2016 REVALORIZACIONES DE GARANTIAS
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM BGL-FIO-GVT.
      *<<<< FIN_CMN_ELI
           IF NOT FIO-STAT-OKS
      *        ERROR INCONSISTENCIA EN LA ELIMINACION : INFORMAR
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.

           IF FRM-IND-GTP IN GVT-FLD = 'S'
               PERFORM ELI-GTP.

           MOVE GAR-CAI-GTIA IN CMA-VARI TO GDG-CAI-GTIA IN GDG.
           MOVE GAR-IIC-GTIA IN CMA-VARI TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.

      * Para saber si queda o no un hijo y grabar el Indicador en GDG
           MOVE SPACES                   TO GVT-KEY-IGVT IN GVT.
           MOVE GAR-CAI-GTIA IN CMA-VARI TO GVT-CAI-GTIA IN GVT.
           MOVE GAR-IIC-GTIA IN CMA-VARI TO GVT-IIC-GTIA IN GVT.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'GVT-KEY-IGVT' TO FIO-AKEY.
           PERFORM BGL-FIO-GVT.
           IF NOT (
                   FIO-STAT-OKS AND
                   GVT-CAI-GTIA IN GVT = GAR-CAI-GTIA IN CMA-VARI AND
                   GVT-IIC-GTIA IN GVT = GAR-IIC-GTIA IN CMA-VARI
                  )
      *        No quedo ningun hijo
               MOVE ' ' TO GDG-IND-EGVT IN GDG.

           SUBTRACT 1
               FROM GVT-COD-TASN IN GVT-FLD
             GIVING GDG-COD-TSCN IN GDG.

           MOVE FIO-MOD TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS.
      *>>>>
       FIN-CMN-ELI.
           EXIT.

       CMN-PGM SECTION.
       INI-CMN-PGM.
           PERFORM RET-ALL-GVT.
       FIN-CMN-PGM.
           EXIT.

       STP-EXIT SECTION.
       INI-STP-EXIT.
           MOVE SCR-PROG TO PGM-PROG.
           MOVE SCR-NTRN TO PGM-NTRN.

           MOVE SCR-PROV TO SCR-PROG.
           MOVE SCR-NTRV TO SCR-NTRN.

           MOVE PGM-PROG TO SCR-PROV
           MOVE PGM-NTRN TO SCR-NTRV.
       FIN-STP-EXIT.
           EXIT.

       SCR-EXIT SECTION.
       INI-SCR-EXIT.
           MOVE 'P'      TO SCR-ICMN.
           MOVE SCR-NTRN TO SYS-NTRN.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-RTRN TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       FIN-SCR-EXIT.
           EXIT.

       SCR-PUTA SECTION.
       INI-SCR-PUTA.
      *PTC-INI
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE GVT-FLD TO FRM-DFLD.
           MOVE FRM-PUT-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-PUTA.
           EXIT.

       SCR-MSSG SECTION.
       INI-SCR-MSSG.
           IF FRM-MEN1 NOT > SPACES
               MOVE SPACES TO FRM-MEN1.
           IF FRM-MEN2 NOT > SPACES
               MOVE SPACES TO FRM-MEN2.
           MOVE FRM-MENS TO GVT-GLS-MENS.
       FIN-SCR-MSSG.
           EXIT.

       SCR-GFLD SECTION.
       INI-SCR-GFLD.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-FLD-GVT
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO GVT-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GFLD.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-GVT.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-GVT
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           PERFORM VAL-NUM-FLD-GVT.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-GVT
               PERFORM EDT-FLD-GVT
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           PERFORM VAL-MKY-GVT.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               GO TO ERR-SCR-GFLD.
           PERFORM VAL-FLD-GVT.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GFLD.
           PERFORM VAL-CON-FLD-GVT.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GFLD.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-FLD-GVT.
       ERR-SCR-GFLD.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-GVT.
           PERFORM EDT-FLD-GVT.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GFLD.
           MOVE SCR-STAT-MOD TO SCR-STAT.

       GET-ACC SECTION.
       INI-GET-ACC.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO GVT-GLS-MEN2
               MOVE SCR-PRMT     TO GVT-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO GVT-FLD.
           IF NOT ( ( FRM-FFLD = FRM-FFLD-PF12 OR FRM-FFLD-PF3 ) OR
                      SCR-CONF > SPACES )
               PERFORM VAL-NUM-KEY-GVT
               PERFORM VAL-NUM-FLD-GVT.
       FIN-GET-ACC.
           MOVE SCR-STAT-SON TO SCR-STAT.

       GET-CON SECTION.
       INI-GET-CON.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO GVT-GLS-MEN2
               MOVE SCR-PRMT     TO GVT-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO GVT-FLD.
       FIN-GET-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.

       CLR-MSG SECTION.
       INI-CLR-MSG.
           MOVE SPACES TO GVT-GLS-MENS.
       FIN-CLR-MSG.
           EXIT.

       HBL-IKY SECTION.
       INI-HBL-IKY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE GVT-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO GVT-FLD
      * FLB  7-NOV-1994
               PERFORM CLR-KEY-GVT

               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO GVT-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO GVT-GLS-MENS.
           PERFORM PRO-FLD-GVT.
           PERFORM PRO-MKY-GVT.
           PERFORM UNP-IKY-GVT.
           PERFORM FST-KEY-GVT.
       FIN-HBL-IKY.
           EXIT.

       HBL-KEY SECTION.
       INI-HBL-KEY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE GVT-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO GVT-FLD
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO GVT-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO GVT-GLS-MENS.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-FLD-GVT.
           MOVE '1' TO FRM-CPIM-AEY.
           PERFORM UNP-KEY-GVT.
           PERFORM FST-KEY-GVT.
       FIN-HBL-KEY.
           EXIT.

       HBL-FLD SECTION.
       INI-HBL-FLD.
           PERFORM UNP-MKY-GVT.
           PERFORM UNP-FLD-GVT.
           PERFORM FST-FLD-GVT.
      *>>>> FIN_HBL_FLD                                                 
           IF SCR-CMND = 'RTA'                                          
           MOVE FRM-CPIM-UBY TO GVT-COD-SDAG-ATR.                       
       FIN-HBL-FLD.
           EXIT.

       FST-MSG SECTION.
       INI-FST-MSG.
           MOVE -1 TO GVT-GLS-MENS-LEN.
       FIN-FST-MSG.
           EXIT.

       PRO-ALL SECTION.
       INI-PRO-ALL.
           PERFORM PRO-KEY-GVT.
           PERFORM PRO-FLD-GVT.
           PERFORM FST-MSG.
       FIN-PRO-ALL.
           EXIT.

       SCR-TRL SECTION.
       INI-SCR-TRL.
      * PTC-INI
           IF SCR-STAT NOT = SCR-STPP
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
      * PTC-FIN
           IF FRM-MEN1 NOT > SPACES
               MOVE SCR-PRMT TO FRM-MEN1.
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM HBL-FLD
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-GVT
               PERFORM EDT-FLD-GVT
               PERFORM SCR-PUTA
               MOVE SCR-INST-GFL TO SCR-INST
               PERFORM SCR-EXIT.
           IF SCR-STAT = SCR-STAT-SON
               PERFORM PRO-ALL
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-GVT
               PERFORM EDT-FLD-GVT
               PERFORM SCR-PUTA
               MOVE SCR-INST-GCS TO SCR-INST
               PERFORM SCR-EXIT.
      *ASUME SCR-STAT-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.
      *    MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-GVT.
           PERFORM EDT-FLD-GVT.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-GAB TO SCR-INST.
           PERFORM SCR-EXIT.
       FIN-SCR-TRL.
           EXIT.

       DESSCRTRL SECTION.
       INI-DESSCRTRL.
           IF SCR-INST = SCR-INST-GCF
                  PERFORM SCR-GCNF
                  GO TO FIN-DESSCRTRL.
           MOVE SCR-VFLD-NOT TO SCR-VFLD.
           MOVE FRM-FFLD TO SCR-FFLD.
           IF SCR-STAT = SCR-STAT-ABT OR SCR-STAT-CON
                  GO TO FIN-DESSCRTRL.
           IF SCR-FFLD-RET OR SCR-FFLD-PF10
                  MOVE SCR-VFLD-YES TO SCR-VFLD
                  PERFORM PRO-CONF.
       FIN-DESSCRTRL.
           IF SCR-FFLD-PF10 OR SCR-FFLD-PF3
                 MOVE SCR-INST-HCM TO SCR-INST
           ELSE
                 MOVE SCR-INST-HKY TO SCR-INST.
       EXT-DESSCRTRL.
           EXIT.

       PRO-CONF SECTION.
       INI-PRO-CONF.
      *PTC-INI
           IF SCR-OFRM-SRV AND
              SCR-CONF NOT > SPACES
                MOVE SPACES TO FRM-MENS.
      *PTC-FIN
           IF FRM-MENS NOT > SPACES
               IF SCR-CONF NOT > SPACES
                   GO TO FIN-PRO-CONF
               ELSE
                   MOVE SCR-CONF TO FRM-MENS
           ELSE
               IF FRM-MEN1 NOT > SPACES
                   MOVE SCR-CONF TO FRM-MEN1.
           PERFORM PRO-KEY-GVT.
           PERFORM PRO-FLD-GVT.
           PERFORM FST-MSG.
           PERFORM SCR-MSSG.
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM EDT-KEY-GVT
               PERFORM EDT-FLD-GVT.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-GCF TO SCR-INST.
           PERFORM SCR-EXIT.
       FIN-PRO-CONF.
           EXIT.

       SCR-GCNF SECTION.
       INI-SCR-GCNF.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3  OR
                               FRM-FFLD-PF4 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO GVT-GLS-MEN2
               MOVE SCR-CONF     TO GVT-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO GVT-FLD.
           MOVE FRM-FFLD TO SCR-FFLD.
           IF FRM-FFLD = FRM-FFLD-PF3
               MOVE SCR-VFLD-NOT TO SCR-VFLD
           ELSE
           IF FRM-FFLD = FRM-FFLD-RET OR FRM-FFLD-PF10 OR FRM-FFLD-PF4
               MOVE SCR-VFLD-YES TO SCR-VFLD
               PERFORM VAL-NUM-KEY-GVT
               PERFORM VAL-NUM-FLD-GVT
           ELSE
           IF FRM-FFLD = FRM-FFLD-PF12
               MOVE SCR-STPP TO SCR-STAT
               IF SCR-STAT = SCR-STAT-MOD
                   PERFORM VAL-NUM-KEY-GVT
                   PERFORM VAL-NUM-FLD-GVT
                   PERFORM SCR-TRL
               ELSE
                   MOVE SCR-VFLD-NOT TO SCR-VFLD.
       FIN-SCR-GCNF.
           EXIT.

      * PGM-EBR-ALL SECTION.
      * INI-PGM-EBR-ALL.
      *     MOVE 'GNS' TO FIO-SIST.
      *     MOVE FIO-EBR-ALL TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      * FIN-PGM-EBR-ALL.
      *     EXIT.

       RET-STT-GVT SECTION.
       INI-RET-STT-GVT.
           IF SCR-CCPP = 'ING'
               MOVE 'I' TO GVT-MSC-TACC IN GVT
               MOVE 'I' TO GVT-MSC-STAT IN GVT
           ELSE
           IF SCR-CCPP = 'MOD'
               MOVE 'M' TO GVT-MSC-TACC IN GVT
               MOVE 'M' TO GVT-MSC-STAT IN GVT.
       FIN-RET-STT-GVT.
           EXIT.

       RET-HDR-GVT SECTION.
       INI-RET-HDR-GVT.
           PERFORM GET-FHOY.
      *    Fecha Transaccion
           MOVE HOY-FHOY TO GVT-FEC-FTRN IN GVT.
      *    Hora Transaccion
           MOVE HOY-HHOY TO GVT-HRA-HRTR IN GVT.
      *    Codigo Origen transaccion
      *<<<< NOT PGM_VMS
           MOVE SCR-OTRN TO GVT-COD-OTRN IN GVT.
      *    Autor Transaccion
           MOVE SCR-USER TO GVT-COD-ATRN IN GVT.
      *>>>>
       FIN-RET-HDR-GVT.
           EXIT.

       COPY BGLBUGVT.
       COPY GNSBVNUM.
       COPY BGLBFGVT.
       COPY GNSBFMSG.
       COPY GNSBGSYS.
       COPY GNSBGDTC.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSBGFRM.
       COPY GNSBG3CF.
      *PTC-FIN
       COPY GNSBGMSG.
       COPY GNSBEKEY.
       COPY GNSBIABT.
       COPY GNSBBTAB.
       COPY GNSBVCOD.
       COPY GNSBVTAB.
       COPY GNSBFTAB.
       COPY GNSBEGLS.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY TABBBOFI.
       COPY TABBFOFI.
      *PTC-INI
       COPY GNSBGQUE.
       COPY GNSBGTSK.
      *PTC-FIN

      *<<<< EOF AND PGM_DTC
       COPY GNSBGVSM.
       COPY GNSBHVSM.
      *>>>>
      *<<<< EOF
      *MHM-INI 11-SEP-2003
       OBT-VALOR-MONNAC SECTION.
       OBT-VALOR-MONNAC-INI.
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CICPESONEX'   TO MSG-COD-MENS IN MSG
               GO TO OBT-VALOR-MONNAC-FIN.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS-VARI.
       OBT-VALOR-MONNAC-FIN.
           EXIT.
      *MHM-FIN 11-SEP-2003
      *<<<< PGM_PU
       ESC-MOD-GVT SECTION.
       INI-ESC-MOD-GVT.
      *<<<< GEN_BCI
      *RRM-INI ACTUALIZACION   COD. ADIC. (PU)
      *ALD-ADA-INI/08112001
           MOVE GVT-CAI-GTIA IN GVT TO GDG-CAI-GTIA IN GDG.
           MOVE GVT-IIC-GTIA IN GVT TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY     TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF NOT (FIO-STAT-OKS)
               GO TO FIN-ESC-MOD-GVT.
           MOVE GDG-COD-TOPE IN GDG TO TAG-COD-TOPE IN TAG.
           MOVE GDG-COD-SOPE IN GDG TO TAG-COD-SOPE IN TAG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-TAG.
           IF NOT (FIO-STAT-OKS)
               GO TO FIN-ESC-MOD-GVT.
      *INI-AFRI/MAY-2005
      *             IF TAG-IND-CTBL IN TAG = 'N'
           IF TAG-IND-CTBL IN TAG = 'N'
               GO TO FIN-ESC-MOD-GVT.
      *EVA-AFRI/JUL2007   CTBL NOVA
      *               GDG-CAI-GTIA IN GDG = '0800'
      *FIN-AFRI/JUL2007   CTBL NOVA
      *FIN-AFRI/MAY-2005
      *                GO TO FIN-ESC-MOD-GVT.
      *ALD-ADA-FIN/08112001
      *RRM-FIN ACTUALIZACION   COD. ADIC.
      *>>>>
           MOVE ZEROES TO GMO-NUM-IMOV IN GMO.
           PERFORM INI-GMO.
           SUBTRACT 1 FROM GVT-COD-TASN IN GVT GIVING
                       GMO-NUM-TASN IN GMO.

           MOVE '2' TO GMO-COD-MOVI IN GMO.

      *MHM-INI 11-SEP-2003
      *     IF SCR-CMND = 'RTA'
           IF SCR-CMND = 'RTA' OR SCR-CMND = 'RTF'
      *MHM-FIN 11-SEP-2003
               MOVE 'R' TO GMO-COD-TMOV IN GMO
           ELSE
           IF SCR-CMND = 'RVL'
               MOVE 'V' TO GMO-COD-TMOV IN GMO
           ELSE
           IF SCR-CMND = 'ATA'
               MOVE 'A' TO GMO-COD-TMOV IN GMO
           ELSE
               MOVE SPACES TO GMO-COD-TMOV IN GMO.
      *
           MOVE FIO-PUT TO FIO-CMND.

           IF GVT-SGV-LTSN IN GVT NOT = WSS-SGV-LTSN
               MOVE 'GVT001'            TO GMO-COD-CMPO IN GMO
               MOVE WSS-SGV-LTSN        TO GMO-SGV-CMPA IN GMO
               MOVE GVT-SGV-LTSN IN GVT TO GMO-SGV-NCMP IN GMO
               PERFORM BGL-FIO-GMO
               IF NOT FIO-STAT-OKS
                   MOVE 'GMOMODGVT' TO MSG-COD-MENS
                   GO TO FIN-ESC-MOD-GVT.

           IF GVT-SGV-VCTS IN GVT NOT = WSS-SGV-VCTS
               MOVE 'GVT002'            TO GMO-COD-CMPO IN GMO
               MOVE WSS-SGV-VCTS        TO GMO-SGV-CMPA IN GMO
               MOVE GVT-SGV-VCTS IN GVT TO GMO-SGV-NCMP IN GMO
               ADD 1                    TO GMO-NUM-IMOV IN GMO
               PERFORM BGL-FIO-GMO
               IF NOT FIO-STAT-OKS
                   MOVE 'GMOMODGVT' TO MSG-COD-MENS
                   GO TO FIN-ESC-MOD-GVT.

           IF GVT-SGV-VPND IN GVT NOT = WSS-SGV-VPND
               MOVE 'GVT003'            TO GMO-COD-CMPO IN GMO
               MOVE WSS-SGV-VPND        TO GMO-SGV-CMPA IN GMO
               MOVE GVT-SGV-VPND IN GVT TO GMO-SGV-NCMP IN GMO
               ADD 1                    TO GMO-NUM-IMOV IN GMO
               PERFORM BGL-FIO-GMO
               IF NOT FIO-STAT-OKS
                   MOVE 'GMOMODGVT' TO MSG-COD-MENS
                   GO TO FIN-ESC-MOD-GVT.

           IF GVT-FEC-FTSN IN GVT NOT = WSS-FEC-FTSN IN WSS-VARI
               MOVE 'GVT004'           TO GMO-COD-CMPO IN GMO
               MOVE 'N'                TO GMO-IND-VALO IN GMO
               MOVE ZEROES             TO GMO-SGV-CMPA IN GMO
               MOVE ZEROES             TO GMO-SGV-NCMP IN GMO
               MOVE WSS-FEC-FRVL       TO GMO-GLS-CMPA IN GMO
               MOVE GVT-FEC-FRVL IN GVT TO GMO-GLS-NCMP IN GMO
               ADD 1                    TO GMO-NUM-IMOV IN GMO
               PERFORM BGL-FIO-GMO
               IF NOT FIO-STAT-OKS
                   MOVE 'GMOMODGVT' TO MSG-COD-MENS
                   GO TO FIN-ESC-MOD-GVT.

      *    Se escribe siempre para reflejar contablemente la accion
      ** EVA-INI  09/07

           PERFORM LEE-GVT-RVL.

           MOVE 'GVT005'            TO GMO-COD-CMPO IN GMO.
           MOVE 'S'                 TO GMO-IND-VALO IN GMO.
           MOVE WSS-FEC-FANR        TO GMO-GLS-CMPA IN GMO.
           MOVE WSS-FEC-FULR        TO GMO-GLS-NCMP IN GMO.

      ** EVA-FIN  09/07

           MOVE WSS-SGV-VGAS        TO GMO-SGV-CMPA IN GMO.
           MOVE GVT-SGV-VGAS IN GVT TO GMO-SGV-NCMP IN GMO.
           ADD 1                    TO GMO-NUM-IMOV IN GMO.

           IF (SCR-CMND = 'RVL' OR SCR-CMND = 'RTA')
              MOVE GVT-CAI-GTIA IN GVT-FLD TO GDG-CAI-GTIA IN GDG
              MOVE GVT-IIC-GTIA IN GVT-FLD TO GDG-IIC-GTIA IN GDG
              MOVE FIO-GET-KEY TO FIO-CMND
              PERFORM BGL-FIO-GDG
              MOVE FIO-PUT TO FIO-CMND.

           MOVE GDG-VAL-CCON IN GDG TO GMO-VAL-CCON IN GMO.
           MOVE GDG-VAL-CCOM IN GDG TO GMO-VAL-CCOM IN GMO.
           PERFORM BGL-FIO-GMO.
           IF NOT FIO-STAT-OKS
               MOVE 'GMOMODGVT' TO MSG-COD-MENS
               GO TO FIN-ESC-MOD-GVT.
       FIN-ESC-MOD-GVT.
           EXIT.

       INI-GMO SECTION.
       INI-INI-GMO.
               MOVE SPACES   TO GMO-GLS-FLAG IN GMO.
               MOVE ZEROES   TO GMO-NUM-TASN IN GMO.
               MOVE SPACES   TO GMO-COD-CMPO IN GMO.
               MOVE SPACES   TO GMO-COD-CLVA IN GMO.
               MOVE SPACES   TO GMO-GLS-CMPA IN GMO.
               MOVE ZEROES   TO GMO-SGV-CMPA IN GMO.
               MOVE SPACES   TO GMO-COD-NCLV IN GMO.
               MOVE SPACES   TO GMO-GLS-NCMP IN GMO.
               MOVE ZEROES   TO GMO-SGV-NCMP IN GMO.
               MOVE SPACES   TO GMO-COD-TMOV IN GMO.
               MOVE SPACES   TO GMO-GLS-DISP IN GMO.

               PERFORM GET-FHOY.
               MOVE HOY-FHOY TO GMO-FEC-FMOV IN GMO.
               MOVE HOY-HHOY TO GMO-HRA-HMOV IN GMO.
      *<<<< PGM_MVS OR PGM_DOS
               MOVE SCR-OTRN TO GMO-TML-TMOV IN GMO.
               MOVE SCR-USER TO GMO-CIC-UING IN GMO.
      *<<<<
               MOVE HOY-FHOY                TO GMO-FEC-FING IN GMO.
               MOVE GVT-CAI-GTIA IN GVT     TO GMO-CAI-GTIA IN GMO.
               MOVE GVT-IIC-GTIA IN GVT     TO GMO-IIC-GTIA IN GMO.
               MOVE GDG-COD-OFIC IN GVT-FLD TO GMO-COD-OFMV IN GMO.
               ADD 1                        TO GMO-NUM-IMOV IN GMO.
               MOVE 'S'                     TO GMO-IND-VALO IN GMO.
               MOVE 'N'                     TO GMO-IND-CLVE IN GMO.
       FIN-INI-GMO.
           EXIT.


       ELI-GTP SECTION.
       INI-ELI-GTP.
           MOVE GVT-CAI-GTIA IN GVT-FLD TO GTP-CAI-GTIA IN GTP.
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GTP-IIC-GTIA IN GTP.
           MOVE GVT-COD-TASN IN GVT-FLD TO GTP-NUM-ITSN IN GTP.
           MOVE 1                       TO GTP-COD-ITSN IN GTP.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM BGL-FIO-GTP.
           IF FIO-STAT-OKS AND
              GVT-CAI-GTIA IN GVT-FLD = GTP-CAI-GTIA IN GTP AND
              GVT-IIC-GTIA IN GVT-FLD = GTP-IIC-GTIA IN GTP AND
              GVT-COD-TASN IN GVT-FLD = GTP-NUM-ITSN IN GTP
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM BGL-FIO-GTP
               MOVE FIO-DEL TO FIO-CMND
               PERFORM BGL-FIO-GTP
               GO TO INI-ELI-GTP.
       FIN-ELI-GTP.
           EXIT.

       COP-GTP SECTION.
       INI-COP-GTP.
           MOVE SPACES TO MSG-COD-MENS.
           IF FRM-IND-GTP IN GVT-FLD NOT = 'S'
               GO TO FIN-COP-GTP.

           MOVE GVT-CAI-GTIA IN GVT-FLD TO GTP-CAI-GTIA IN GTP.
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GTP-IIC-GTIA IN GTP.

           SUBTRACT 1 FROM GVT-COD-TASN IN GVT-FLD GIVING
                          GTP-NUM-ITSN IN GTP.

           MOVE 1      TO GTP-COD-ITSN IN GTP.
           MOVE FIO-GET-KEY TO FIO-CMND.
       LUP-COP-GTP.
           PERFORM BGL-FIO-GTP.
           IF NOT (FIO-STAT-OKS AND
              GVT-CAI-GTIA IN GVT-FLD = GTP-CAI-GTIA IN GTP AND
              GVT-IIC-GTIA IN GVT-FLD = GTP-IIC-GTIA IN GTP AND
              (GVT-COD-TASN IN GVT-FLD - 1 ) = GTP-NUM-ITSN IN GTP)
               GO TO FIN-COP-GTP
           ELSE
               MOVE GVT-COD-TASN IN GVT-FLD TO GTP-NUM-ITSN IN GTP
               MOVE FIO-PUT TO FIO-CMND
               PERFORM BGL-FIO-GTP
               IF NOT FIO-STAT-OKS
                   MOVE 'GTP    PUTNO' TO MSG-COD-MENS
                   MOVE FIO-MENS       TO FRM-MENS
               ELSE
                   SUBTRACT 1 FROM GVT-COD-TASN IN GVT-FLD GIVING
                            GTP-NUM-ITSN IN GTP
                   ADD 1 TO GTP-COD-ITSN IN GTP
                   MOVE FIO-GET-KEY TO FIO-CMND
                   GO TO LUP-COP-GTP.
       FIN-COP-GTP.
           EXIT.

       REV-GDG-GTP SECTION.
       INI-REV-GDG-GTP.
           MOVE GVT-CAI-GTIA IN GVT-FLD TO GDG-CAI-GTIA IN GDG.
           MOVE GVT-IIC-GTIA IN GVT-FLD TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM BGL-FIO-GDG.
           IF GDG-IND-GTAC IN GDG NOT = 'S'
              MOVE 'A' TO GVT-MSC-STAT IN GVT
              GO TO FIN-REV-GDG-GTP.

           IF GDG-IND-EGTP IN GDG = 'S'
              MOVE 'I' TO GVT-MSC-STAT IN GVT
           ELSE
              MOVE 'A' TO GVT-MSC-STAT IN GVT.

       FIN-REV-GDG-GTP.
           EXIT.
      *>>>>
      *<<<< GEN_BCI
       OBT-VAL-RTF SECTION.
       INI-OBT-VAL-RTF.
           PERFORM LEE-GVT-RVL.
           MOVE WSS-NUM-SULR   TO CAM-NUM-SCAM IN CAM(1).
           MOVE WSS-NUM-AULR   TO CAM-NUM-ACAM IN CAM(1).
           MOVE WSS-NUM-MULR   TO CAM-NUM-MCAM IN CAM(1).
           MOVE WSS-NUM-DULR   TO CAM-NUM-DCAM IN CAM(1).

           MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2).
           MOVE GDG-COD-VCAM IN GVT-FLD  TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT (
              FIO-STAT-OKS AND CAM-IND-VIGE IN CAM = 'S'
              )
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE 'CAM    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-OBT-VAL-RTF.

           MULTIPLY GVT-SGV-LTSN IN GVT-FLD
                     BY CAM-SGV-VCAM    IN CAM
                 GIVING WSS-VAL-PESO ROUNDED.
           MOVE WSS-VAL-PESO TO GVT-SGV-LTSN IN GVT.

           MULTIPLY GVT-SGV-VCTS IN GVT-FLD
                     BY CAM-SGV-VCAM    IN CAM
                 GIVING WSS-VAL-PESO ROUNDED.
           MOVE WSS-VAL-PESO TO GVT-SGV-VCTS IN GVT.

           MULTIPLY GVT-SGV-VPND IN GVT-FLD
                     BY CAM-SGV-VCAM    IN CAM
                 GIVING WSS-VAL-PESO ROUNDED.
           MOVE WSS-VAL-PESO TO GVT-SGV-VPND IN GVT.

           MULTIPLY GVT-SGV-VGAS IN GVT-FLD
                     BY CAM-SGV-VCAM    IN CAM
                 GIVING WSS-VAL-PESO ROUNDED.
           MOVE WSS-VAL-PESO TO GVT-SGV-VGAS IN GVT.
       FIN-OBT-VAL-RTF.
           EXIT.

       EXC-NOR-TAS SECTION.
       INI-EXC-NOR-TAS.
           IF GDG-COD-LGTA IN GDG = 'E'
               PERFORM GAR-ESP
           ELSE
               PERFORM GAR-GRL.
       FIN-EXC-NOR-TAS.
           EXIT.

       GAR-ESP SECTION.
       INI-GAR-ESP.
           MOVE ZEROES TO WSS-VAL-SCRE IN WSS-VARI.
           MOVE 'S'    TO WSS-IND-HIPT IN WSS-VARI.
           MOVE 'N'    TO WSS-IND-ENFE IN WSS-VARI.
           MOVE 'N'    TO WSS-IND-ENT1 IN WSS-VARI.
           MOVE 'N'    TO WSS-IND-ENT2 IN WSS-VARI.
           MOVE 'N'    TO WSS-IND-ENT3 IN WSS-VARI.

           MOVE GDG-CAI-GTIA IN GDG TO GES-CAI-GTIA IN GES.
           MOVE GDG-IIC-GTIA IN GDG TO GES-IIC-GTIA IN GES.
           MOVE ZEROES TO GES-NUM-IGES IN GES.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-GAR-ESP.
           PERFORM BGL-FIO-GES.
           IF NOT ( FIO-STAT-OKS AND
              GES-CAI-GTIA IN GES = GDG-CAI-GTIA AND
              GES-IIC-GTIA IN GES = GDG-IIC-GTIA )
               GO TO CNT-GAR-ESP.

           MOVE GES-CAI-IOPC IN GES TO OPC-CAI-IOPC IN OPC.
           MOVE GES-IIC-IOPC IN GES TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-GAR-ESP.

      *MHM-INI 22-OCT-2003
           IF OPC-MSC-STAT IN OPC NOT = 'A' OR
              OPC-VAL-SCRE IN OPC NOT > ZEROES
               GO TO NXT-GAR-ESP.
      *MHM-FIN 22-OCT-2003

           IF OPC-MSC-STAT IN OPC = 'A'
               ADD OPC-VAL-SCRE IN OPC TO WSS-VAL-SCRE IN WSS-VARI.

           IF OPC-COD-TOPC IN OPC NOT = 'F'
               MOVE 'N' TO WSS-IND-HIPT IN WSS-VARI
               PERFORM CMP-FEC.

       NXT-GAR-ESP.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-GAR-ESP.

       CNT-GAR-ESP.
           IF WSS-VAL-SCRE IN WSS-VARI NOT > ZEROES
               MOVE 'S' TO WSS-IND-ENT1 IN WSS-VARI.

           IF WSS-IND-HIPT IN WSS-VARI = 'S'
               MOVE 'S' TO WSS-IND-ENT2 IN WSS-VARI.

           IF WSS-IND-ENFE IN WSS-VARI = 'S'
               MOVE 'S' TO WSS-IND-ENT3 IN WSS-VARI.

       FIN-GAR-ESP.
           EXIT.

       CMP-FEC SECTION.
       INI-CMP-FEC.
           PERFORM LEE-TIO.
           IF WSS-CIC-TOPE IN WSS-VARI = '951'
               MOVE 2 TO FEC-NANO
           ELSE
               MOVE 1 TO FEC-NANO.
           PERFORM LEE-GVT.
           IF WSS-FEC-FTSN IN WSS-VARI NOT > SPACES
               GO TO FIN-CMP-FEC.
           PERFORM RST-FECHA.
           IF WSS-FEC-FTRA IN WSS-VARI NOT < OPC-FEC-FINP IN OPC AND
              OPC-VAL-SCRE IN OPC > ZEROES
               MOVE 'S' TO WSS-IND-ENFE IN WSS-VARI.
       FIN-CMP-FEC.
           EXIT.

       LEE-TIO SECTION.
       INI-LEE-TIO.
           MOVE SPACES              TO WSS-CIC-TOPE IN WSS-VARI.
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'TIO'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE GDG-COD-TOPE IN GDG TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS = SPACES
               MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TOPE IN WSS-VARI.
       FIN-LEE-TIO.
           EXIT.

       LEE-GVT SECTION.
       INI-LEE-GVT.
           MOVE GVT-NUM-STSN IN GVT-FLD TO WSS-NUM-STSN IN WSS-VARI.
           MOVE GVT-NUM-ATSN IN GVT-FLD TO WSS-NUM-ATSN IN WSS-VARI.
           MOVE GVT-NUM-MTSN IN GVT-FLD TO WSS-NUM-MTSN IN WSS-VARI.
           MOVE GVT-NUM-DTSN IN GVT-FLD TO WSS-NUM-DTSN IN WSS-VARI.
       FIN-LEE-GVT.
           EXIT.


       RST-FECHA SECTION.
       INI-RST-FECHA.
           MOVE SPACES TO WSS-FEC-FTRA IN WSS-VARI.
           MOVE WSS-NUM-DTSN IN WSS-VARI TO FEC-ITM1.
           MOVE WSS-NUM-MTSN IN WSS-VARI TO FEC-ITM2.
           MOVE WSS-NUM-STSN IN WSS-VARI TO FEC-ITM3.
           MOVE WSS-NUM-ATSN IN WSS-VARI TO FEC-ITM4.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-SUM-ANO  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF FEC-STAT-OKS
               MOVE FEC-ITM1 TO WSS-NUM-DTRA IN WSS-VARI
               MOVE FEC-ITM2 TO WSS-NUM-MTRA IN WSS-VARI
               MOVE FEC-ITM3 TO WSS-NUM-STRA IN WSS-VARI
               MOVE FEC-ITM4 TO WSS-NUM-ATRA IN WSS-VARI.
       FIN-RST-FECHA.
           EXIT.

       GAR-GRL SECTION.
       INI-GAR-GRL.
           MOVE ZEROES TO WSS-VAL-SCRE IN WSS-VARI.
           MOVE 'S'    TO WSS-IND-HIPT IN WSS-VARI.
           MOVE 'N'    TO WSS-IND-ENFE IN WSS-VARI.
           MOVE 'N'    TO WSS-IND-ENT1 IN WSS-VARI.
           MOVE 'N'    TO WSS-IND-ENT2 IN WSS-VARI.
           MOVE 'N'    TO WSS-IND-ENT3 IN WSS-VARI.

           MOVE GDG-CAI-GTIA IN GDG TO GDD-CAI-GTIA IN GDD.
           MOVE GDG-IIC-GTIA IN GDG TO GDD-IIC-GTIA IN GDD.
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-GDD-GAR-GRL.
           PERFORM BGL-FIO-GDD.
           IF NOT ( FIO-STAT-OKS AND
              GDD-CAI-GTIA IN GDD = GDG-CAI-GTIA AND
              GDD-IIC-GTIA IN GDD = GDG-IIC-GTIA )
               GO TO CNT-GAR-GRL.

           MOVE GDD-CAI-DCLI IN GDD TO RDC-CAI-ICLI IN RDC.
           MOVE GDD-IIC-DCLI IN GDD TO RDC-IIC-ICLI IN RDC.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-RDC-GAR-GRL.
           PERFORM COL-FIO-RDC.
           IF NOT ( FIO-STAT-OKS AND
              RDC-CAI-ICLI IN RDC = GDD-CAI-DCLI IN GDD AND
              RDC-IIC-ICLI IN RDC = GDD-IIC-DCLI IN GDD )
               GO TO NXT-GDD-GRL.

           MOVE RDC-CAI-IOPC IN RDC TO OPC-CAI-IOPC IN OPC.
           MOVE RDC-IIC-IOPC IN RDC TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               GO TO NXT-RDC-GRL.

      *MHM-INI 22-OCT-2003
           IF OPC-MSC-STAT IN OPC NOT = 'A' OR
              OPC-VAL-SCRE IN OPC NOT > ZEROES
               GO TO NXT-RDC-GRL.
      *MHM-FIN 22-OCT-2003

           IF OPC-MSC-STAT IN OPC = 'A'
               ADD OPC-VAL-SCRE IN OPC TO WSS-VAL-SCRE IN WSS-VARI.

           IF OPC-COD-TOPC IN OPC NOT = 'F'
               MOVE 'N' TO WSS-IND-HIPT IN WSS-VARI
               PERFORM CMP-FEC.

       NXT-RDC-GRL.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-RDC-GAR-GRL.

       NXT-GDD-GRL.
           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           GO TO LUP-GDD-GAR-GRL.

       CNT-GAR-GRL.
           IF WSS-VAL-SCRE IN WSS-VARI NOT > ZEROES
               MOVE 'S' TO WSS-IND-ENT1 IN WSS-VARI.

           IF WSS-IND-HIPT IN WSS-VARI = 'S'
               MOVE 'S' TO WSS-IND-ENT2 IN WSS-VARI.

           IF WSS-IND-ENFE IN WSS-VARI = 'S'
               MOVE 'S' TO WSS-IND-ENT3 IN WSS-VARI.

       FIN-GAR-GRL.
           EXIT.


      *MPS-INI 21-SEP-2016 REVALORIZACIONES DE GARANTIAS

       LEE-GDD SECTION.
      *===================
       INI-LEE-GDD.

           MOVE GVT-CAI-GTIA IN GVT   TO GDD-CAI-GTIA IN GDD.
           MOVE GVT-IIC-GTIA IN GVT   TO GDD-IIC-GTIA IN GDD.
           MOVE 'GDD-KEY-AGDD' TO FIO-AKEY.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM BGL-FIO-GDD.

       FIN-LEE-GDD.
           EXIT.


       LLENAR-ANTES SECTION.
       INI-LLENAR-ANTES.
      *------------------
           MOVE SPACES TO LGN.
           IF SCR-CMND = 'MOD'
              MOVE 'MOD'  TO LGN-COD-EVEN IN LGN
              MOVE 'M'    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
           IF SCR-CMND = 'ATA'
              MOVE 'ATA'  TO LGN-COD-EVEN IN LGN
              MOVE 'M'    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
           IF SCR-CMND = 'MTA'
              MOVE 'MTA'  TO LGN-COD-EVEN IN LGN
              MOVE 'M'    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
           IF SCR-CMND = 'RTA'
              MOVE 'RTA'  TO LGN-COD-EVEN IN LGN
              MOVE 'A'    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
           IF SCR-CMND = 'RVL'
              MOVE 'RVL'  TO LGN-COD-EVEN IN LGN
              MOVE 'A'    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
           IF SCR-CMND = 'RTF'
              MOVE 'RTF'  TO LGN-COD-EVEN IN LGN
              MOVE 'A'    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
           IF SCR-CMND = 'ELI'
              MOVE 'ELI'  TO LGN-COD-EVEN IN LGN
              MOVE 'E'    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
           MOVE 'ANT'  TO LGN-COD-INST IN LGN.
           MOVE 1      TO LGN-NUM-CLGN IN LGN
                          LGN-NUM-COPE IN LGN
                          LGN-NUM-CCLI IN LGN
                          LGN-NUM-CEVE IN LGN
                          LGN-NUM-CAUT IN LGN.

           MOVE GVT-COD-TASN IN GVT      TO LGN-COD-LN01 IN LGN.
           MOVE GVT-FEC-FTRN IN GVT      TO LGN-COD-LN02 IN LGN.
           MOVE GVT-HRA-HRTR IN GVT      TO LGN-COD-LN02 IN LGN(11:6).
           MOVE GVT-MSC-TTRN IN GVT      TO LGN-COD-LN03 IN LGN.
           MOVE GVT-COD-TTRN IN GVT      TO LGN-COD-LN04 IN LGN.
           MOVE GVT-COD-ATRN IN GVT      TO LGN-COD-LN05 IN LGN.
           MOVE GVT-FEC-FTSN IN GVT      TO LGN-COD-LN06 IN LGN.

           MOVE GVT-SGV-LTSN IN GVT      TO WSG-SGV-LTSN IN WSS-VARI.
           MOVE WSG-SGV-LTSN IN WSS-VARI TO LGN-COD-LN07 IN LGN.

           MOVE GVT-SGV-VCTS IN GVT      TO WSG-SGV-VCTS IN WSS-VARI.
           MOVE WSG-SGV-VCTS IN WSS-VARI TO LGN-COD-LN08 IN LGN.

           MOVE GVT-SGV-PPCT IN GVT      TO WSG-SGV-PPCT IN WSS-VARI.
           MOVE WSG-SGV-PPCT IN WSS-VARI TO LGN-COD-LN09 IN LGN.

           MOVE GVT-SGV-VPND IN GVT      TO WSG-SGV-VPND IN WSS-VARI.
           MOVE WSG-SGV-VPND IN WSS-VARI TO LGN-COD-LN10 IN LGN.

           MOVE GVT-SGV-PAJU IN GVT      TO WSG-SGV-PAJU IN WSS-VARI.
           MOVE WSG-SGV-PAJU IN WSS-VARI TO LGN-COD-LN11 IN LGN.

           MOVE GVT-SGV-VGAS IN GVT      TO WSG-SGV-VGAS IN WSS-VARI.
           MOVE WSG-SGV-VGAS IN WSS-VARI TO LGN-COD-LN12 IN LGN.

           MOVE GVT-SGV-VSIN IN GVT      TO WSG-SGV-VSIN IN WSS-VARI.
           MOVE WSG-SGV-VSIN IN WSS-VARI TO LGN-COD-LN13 IN LGN.

           MOVE GVT-COD-ITSD IN GVT      TO LGN-COD-LN14 IN LGN.
           MOVE GVT-COD-ISVS IN GVT      TO LGN-COD-LN15 IN LGN.
           MOVE GVT-FEC-FRVL IN GVT      TO LGN-COD-LN16 IN LGN.
           MOVE GVT-COD-CRIT IN GVT      TO LGN-COD-LN17 IN LGN.
           MOVE GVT-COD-OAVA IN GVT      TO LGN-COD-LN18 IN LGN.

           MOVE GVT-SGV-FISI IN GVT      TO WSG-SGV-FISI IN WSS-VARI.
           MOVE WSG-SGV-FISI IN WSS-VARI TO LGN-COD-LN19 IN LGN.

           MOVE GVT-FEC-FING IN GVT      TO LGN-COD-LN20 IN LGN.
           MOVE GVT-CIC-UING IN GVT      TO LGN-COD-LN21 IN LGN.

           MOVE GVT-SGV-FISC IN GVT      TO WSG-SGV-FISC IN WSS-VARI.
           MOVE WSG-SGV-FISC IN WSS-VARI TO LGN-COD-LN22 IN LGN.

           MOVE GVT-FEC-FURV IN GVT      TO LGN-COD-LN23 IN LGN.

           MOVE GVT-SGV-VTTL IN GVT      TO WSG-SGV-VTTL IN WSS-VARI.
           MOVE WSG-SGV-VTTL IN WSS-VARI TO LGN-COD-LN24 IN LGN.

       FIN-LLENAR-ANTES.
           EXIT.

       LLENAR-DESPUES SECTION.
       INI-LLENAR-DESPUES.
      *------------------
           MOVE SPACES               TO  LGN.

      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
           IF SCR-CMND = WSS-CTE-ING
      *       MOVE WSS-CTE-ING  TO LGN-COD-CMND IN LGN
              MOVE WSS-CTE-ING  TO LGN-COD-EVEN IN LGN
              MOVE WSS-CTE-I    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2

           IF SCR-CMND = 'MOD'
      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
      *       MOVE 'MOD'  TO LGN-COD-EVEN IN LGN.
              MOVE  WSS-CTE-MOD TO LGN-COD-EVEN IN LGN
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
              MOVE 'M'    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.

           IF SCR-CMND = 'ATA'
      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
      *       MOVE 'ATA'  TO LGN-COD-EVEN IN LGN.
              MOVE WSS-CTE-ATA  TO LGN-COD-EVEN IN LGN
              MOVE WSS-CTE-M    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2

           IF SCR-CMND = 'MTA'
      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
      *       MOVE 'MTA'  TO LGN-COD-EVEN IN LGN.
              MOVE WSS-CTE-MTA  TO LGN-COD-EVEN IN LGN
              MOVE WSS-CTE-M    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2

           IF SCR-CMND = 'RTA'
      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
      *       MOVE 'RTA'  TO LGN-COD-EVEN IN LGN.
              MOVE WSS-CTE-RTA  TO LGN-COD-EVEN IN LGN
              MOVE WSS-CTE-M    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2

           IF SCR-CMND = 'RVL'
      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
      *       MOVE 'RVL'  TO LGN-COD-EVEN IN LGN.
              MOVE WSS-CTE-RVL  TO LGN-COD-EVEN IN LGN
              MOVE WSS-CTE-M    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2

           IF SCR-CMND = 'RTF'
      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
      *       MOVE 'RTF'  TO LGN-COD-EVEN IN LGN.
              MOVE WSS-CTE-RTF  TO LGN-COD-EVEN IN LGN
              MOVE WSS-CTE-M    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2

           IF SCR-CMND = 'ELI'
      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
      *       MOVE 'ELI'  TO LGN-COD-EVEN IN LGN.
              MOVE WSS-CTE-ELI  TO LGN-COD-EVEN IN LGN
              MOVE WSS-CTE-E    TO LGN-COD-TACC IN LGN
                             LGN-COD-STAT IN LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2


           MOVE 'DES'                TO  LGN-COD-INST IN LGN.
           MOVE 2                    TO  LGN-NUM-CLGN IN LGN
                                         LGN-NUM-COPE IN LGN
                                         LGN-NUM-CCLI IN LGN
                                         LGN-NUM-CEVE IN LGN
                                         LGN-NUM-CAUT IN LGN.

           MOVE GVT-COD-TASN IN GVT      TO LGN-COD-LN01 IN LGN.
           MOVE GVT-FEC-FTRN IN GVT      TO LGN-COD-LN02 IN LGN.
           MOVE GVT-HRA-HRTR IN GVT      TO LGN-COD-LN02 IN LGN(11:6).
           MOVE GVT-MSC-TTRN IN GVT      TO LGN-COD-LN03 IN LGN.
           MOVE GVT-COD-TTRN IN GVT      TO LGN-COD-LN04 IN LGN.
           MOVE GVT-COD-ATRN IN GVT      TO LGN-COD-LN05 IN LGN.
           MOVE GVT-FEC-FTSN IN GVT      TO LGN-COD-LN06 IN LGN.

           MOVE GVT-SGV-LTSN IN GVT      TO WSG-SGV-LTSN IN WSS-VARI.
           MOVE WSG-SGV-LTSN IN WSS-VARI TO LGN-COD-LN07 IN LGN.

           MOVE GVT-SGV-VCTS IN GVT      TO WSG-SGV-VCTS IN WSS-VARI.
           MOVE WSG-SGV-VCTS IN WSS-VARI TO LGN-COD-LN08 IN LGN.

           MOVE GVT-SGV-PPCT IN GVT      TO WSG-SGV-PPCT IN WSS-VARI.
           MOVE WSG-SGV-PPCT IN WSS-VARI TO LGN-COD-LN09 IN LGN.

           MOVE GVT-SGV-VPND IN GVT      TO WSG-SGV-VPND IN WSS-VARI.
           MOVE WSG-SGV-VPND IN WSS-VARI TO LGN-COD-LN10 IN LGN.

           MOVE GVT-SGV-PAJU IN GVT      TO WSG-SGV-PAJU IN WSS-VARI.
           MOVE WSG-SGV-PAJU IN WSS-VARI TO LGN-COD-LN11 IN LGN.

           MOVE GVT-SGV-VGAS IN GVT      TO WSG-SGV-VGAS IN WSS-VARI.
           MOVE WSG-SGV-VGAS IN WSS-VARI TO LGN-COD-LN12 IN LGN.

           MOVE GVT-SGV-VSIN IN GVT      TO WSG-SGV-VSIN IN WSS-VARI.
           MOVE WSG-SGV-VSIN IN WSS-VARI TO LGN-COD-LN13 IN LGN.

           MOVE GVT-COD-ITSD IN GVT      TO LGN-COD-LN14 IN LGN.
           MOVE GVT-COD-ISVS IN GVT      TO LGN-COD-LN15 IN LGN.
           MOVE GVT-FEC-FRVL IN GVT      TO LGN-COD-LN16 IN LGN.
           MOVE GVT-COD-CRIT IN GVT      TO LGN-COD-LN17 IN LGN.
           MOVE GVT-COD-OAVA IN GVT      TO LGN-COD-LN18 IN LGN.

           MOVE GVT-SGV-FISI IN GVT      TO WSG-SGV-FISI IN WSS-VARI.
           MOVE WSG-SGV-FISI IN WSS-VARI TO LGN-COD-LN19 IN LGN.

           MOVE GVT-FEC-FING IN GVT      TO LGN-COD-LN20 IN LGN.

           MOVE GVT-CIC-UING IN GVT      TO LGN-COD-LN21 IN LGN.

           MOVE GVT-SGV-FISC IN GVT      TO WSG-SGV-FISC IN WSS-VARI.
           MOVE WSG-SGV-FISC IN WSS-VARI TO LGN-COD-LN22 IN LGN.

           MOVE GVT-FEC-FURV IN GVT      TO LGN-COD-LN23 IN LGN.

           MOVE GVT-SGV-VTTL IN GVT      TO WSG-SGV-VTTL IN WSS-VARI.
           MOVE WSG-SGV-VTTL IN WSS-VARI TO LGN-COD-LN24 IN LGN.


       FIN-LLENAR-DESPUES.
           EXIT.


       GRABAR-LGN SECTION.
      *===================
       INI-GRABAR-LGN.

           MOVE SCR-SISG TO FIO-SIST.

           EXEC CICS ASKTIME ABSTIME(WSS-LGM-ABSTIME)
           END-EXEC.
           PERFORM GET-FHOY.
           MOVE '1.0'               TO LGN-COD-VERS IN LGN.
           MOVE 'GVT'               TO LGN-COD-ENTF IN LGN
                                       LGN-COD-ENTO IN LGN
                                       LGN-COD-ENTE IN LGN
                                       LGN-COD-ENTC IN LGN
                                       LGN-COD-ENTA IN LGN.
           MOVE HOY-FHOY            TO LGN-FEC-FTRN IN LGN
                                       LGN-FEC-FLGN IN LGN
                                       LGN-FEC-FOPE IN LGN
                                       LGN-FEC-FEVE IN LGN
                                       LGN-FEC-FCLI IN LGN
                                       LGN-FEC-FAUT IN LGN.
           MOVE HOY-HHOY            TO LGN-HRA-HRTR IN LGN
                                       LGN-HRA-HLGN IN LGN
                                       LGN-HRA-HOPE IN LGN
                                       LGN-HRA-HEVE IN LGN
                                       LGN-HRA-HCLI IN LGN
                                       LGN-HRA-HAUT IN LGN.
           MOVE TSK-TERM-NUM        TO LGN-TSK-NUMF IN LGN
                                       LGN-TSK-NUMO IN LGN
                                       LGN-TSK-NUME IN LGN
                                       LGN-TSK-NUMC IN LGN
                                       LGN-TSK-NUMA IN LGN.
           MOVE WSS-LGM-ABSTIME     TO LGN-NUM-ABSF IN LGN
                                       LGN-NUM-ABSO IN LGN
                                       LGN-NUM-ABSE IN LGN
                                       LGN-NUM-ABSC IN LGN
                                       LGN-NUM-ABSA IN LGN.
           MOVE GVT-CIC-GTIA IN GVT TO LGN-CIC-IOPE IN LGN.
           MOVE GDD-CIC-DCLI IN GDD TO LGN-CIC-ICLI IN LGN.
      *MPB-INI  31-ENE-2018 LIMPIEZA CAMPO COD-OTRN
      *    MOVE EIBTRMID            TO LGN-COD-OTRN IN LGN.
           IF SCR-OFRM-SRV
               MOVE SCR-ORIG TO LGN-COD-OTRN IN LGN
           ELSE
               IF NOT SCR-OFRM-SRV
           MOVE SPACES              TO LGN-COD-OTRN IN LGN.
      *MPB-FIN
           MOVE SCR-USER            TO LGN-COD-ATRN IN LGN
                                       LGN-COD-AUTO IN LGN.
           MOVE EIBTRNID            TO LGN-COD-TCIC IN LGN.

      *MPS-INI 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
           IF SCR-CMND = WSS-CTE-ING
              MOVE WSS-CTE-ING  TO LGN-COD-CMND IN LGN.
      *MPS-FIN 05-JUN-2017 REVALORIZACIONES GARANTIAS 2
           IF SCR-CMND = 'MOD'
              MOVE 'MOD'  TO LGN-COD-CMND IN LGN.
           IF SCR-CMND = 'ATA'
              MOVE 'ATA'  TO LGN-COD-CMND IN LGN.
           IF SCR-CMND = 'MTA'
              MOVE 'MTA'  TO LGN-COD-CMND IN LGN.
           IF SCR-CMND = 'RTA'
              MOVE 'RTA'  TO LGN-COD-CMND IN LGN.
           IF SCR-CMND = 'RVL'
              MOVE 'RVL'  TO LGN-COD-CMND IN LGN.
           IF SCR-CMND = 'RTF'
              MOVE 'RTF'  TO LGN-COD-CMND IN LGN.
           IF SCR-CMND = 'ELI'
              MOVE 'ELI'  TO LGN-COD-CMND IN LGN.
            MOVE FIO-PUT TO FIO-CMND.
            PERFORM GNS-FIO-LGN.
       FIN-GRABAR-LGN.
           EXIT.
      *MPS-FIN 21-SEP-2016 REVALORIZACIONES DE GARANTIAS

       COPY BGLBKVCG.
       COPY BGLBGVCG.
      *MHM-INI 16-OCT-2003
       REST-VAL-GVT SECTION.
       INI-REST-VAL-GVT.
           MOVE WSS-SGV-LTSN IN CMA-VARI TO GVT-SGV-LTSN IN GVT.
           MOVE WSS-SGV-VCTS IN CMA-VARI TO GVT-SGV-VCTS IN GVT.
           MOVE WSS-SGV-VPND IN CMA-VARI TO GVT-SGV-VPND IN GVT.
           MOVE WSS-SGV-VGAS IN CMA-VARI TO GVT-SGV-VGAS IN GVT.
       FIN-REST-VAL-GVT.
           EXIT.
      *MHM-FIN 16-OCT-2003
      *>>>>
       COPY BGLBFGDG.
       COPY BGLBFACC.
       COPY BGLBFGDP.
      *<<<< GEN_BCI
       COPY BGLBFGSO.
      *>>>>
       COPY TABBFIVB.
       COPY TABBFUSR.
      *<<<< GEN_BCI
       COPY BGLBFGDD.
       COPY COLBFRDC.
       COPY COLBFOPC.
      *>>>>
       COPY BGLBFGES.
      *<<<< PGM_PU
       COPY BGLBFGMO.
      *>>>>
      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
       COPY BGLBFETP.
      *AFRI-FIN/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
       COPY BGLBFGSE.
       COPY BGLBFGTP.
       COPY BGLBFTAG.
       COPY TABBFCAM.
       COPY GNSBGPES.
      *MHM-INI 23-OCT-2003
       COPY GNSBGCPT.
      *MHM-FIN 23-OCT-2003
       COPY GNSBPFEC.
      *>>>>

      ** EVA-INI  09/07

       LEE-GVT-RVL SECTION.
       INI-LEE-GVT-RVL.

           IF GVT-FEC-FTSN IN GVT > GVT-FEC-FRVL IN GVT
              MOVE GVT-NUM-STSN IN GVT TO WSS-NUM-SULR
              MOVE GVT-NUM-ATSN IN GVT TO WSS-NUM-AULR
              MOVE GVT-NUM-MTSN IN GVT TO WSS-NUM-MULR
              MOVE GVT-NUM-DTSN IN GVT TO WSS-NUM-DULR
           ELSE
              MOVE GVT-NUM-SRVL IN GVT TO WSS-NUM-SULR
              MOVE GVT-NUM-ARVL IN GVT TO WSS-NUM-AULR
              MOVE GVT-NUM-MRVL IN GVT TO WSS-NUM-MULR
              MOVE GVT-NUM-DRVL IN GVT TO WSS-NUM-DULR.

           IF GVT-FEC-FURV IN GVT > WSS-FEC-FULR
              MOVE GVT-NUM-SURV IN GVT TO WSS-NUM-SULR
              MOVE GVT-NUM-AURV IN GVT TO WSS-NUM-AULR
              MOVE GVT-NUM-MURV IN GVT TO WSS-NUM-MULR
              MOVE GVT-NUM-DURV IN GVT TO WSS-NUM-DULR.

       FIN-LEE-GVT-RVL.
           EXIT.

      ** EVA-FIN  09/07

      *AFRI-INI/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
       PRO-GRB-ETP SECTION.
       INI-PRO-GRB-ETP.
           PERFORM LEE-ULT-ETP.
           IF WSS-NUM-CONT IN WSS-VARI = ZEROES
               GO TO FIN-PRO-GRB-ETP.

           MOVE SPACES                   TO ETP.
           MOVE GVT-CIC-GTIA IN GVT      TO ETP-CIC-GTIA IN ETP.
           MOVE WSS-NUM-CONT IN WSS-VARI TO ETP-NUM-CONT IN ETP.
           MOVE HOY-FHOY                 TO ETP-FEC-FTRN IN ETP.
           MOVE HOY-HHOY                 TO ETP-HRA-HRTR IN ETP.
           MOVE SPACES                   TO ETP-MSC-TACC IN ETP.
           MOVE SPACES                   TO ETP-MSC-STAT IN ETP.
           MOVE SPACES                   TO ETP-COD-OTRN IN ETP.
           MOVE 'BGLPUGVT'               TO ETP-COD-ATRN IN ETP.
           MOVE GDG-COD-CGTA IN GDG      TO ETP-COD-CGTA IN ETP.
           MOVE GVT-FEC-FTSN IN GVT      TO ETP-FEC-FTAS IN ETP.
           MOVE GVT-COD-TASN IN GVT      TO ETP-COD-TASN IN ETP.
           MOVE GVT-COD-SDAG IN GVT      TO ETP-NUM-SOLI IN ETP.
           MOVE GVT-IND-IEXC IN GVT      TO ETP-IND-IEXC IN ETP.
           MOVE SPACES                   TO ETP-GLS-DISP IN ETP.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM BGL-FIO-ETP.
           IF NOT FIO-STAT-OKS
               MOVE 'BGL'        TO MSG-COD-SIST
               MOVE 'ETP NO UPD' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
       FIN-PRO-GRB-ETP.
           EXIT.

       LEE-ULT-ETP SECTION.
       INI-LEE-ULT-ETP.
           MOVE ZEROES TO WSS-NUM-CONT IN WSS-VARI.
           MOVE GVT-CAI-GTIA IN GVT-FLD TO ETP-CAI-GTIA IN ETP.
           MOVE GVT-IIC-GTIA IN GVT-FLD TO ETP-IIC-GTIA IN ETP.
           MOVE 999                 TO ETP-NUM-CONT IN ETP.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM BGL-FIO-ETP.
           IF NOT FIO-STAT-OKS OR
            (GVT-CAI-GTIA IN GVT-FLD NOT = ETP-CAI-GTIA IN ETP
             AND GVT-IIC-GTIA IN GVT-FLD NOT = ETP-IIC-GTIA IN ETP)
               MOVE 'BGL'          TO MSG-COD-SIST
               MOVE 'ETP      NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-LEE-ULT-ETP
           ELSE
               MOVE ETP-NUM-CONT IN ETP TO WSS-NUM-CONT IN WSS-VARI
               ADD 1 TO WSS-NUM-CONT IN WSS-VARI.

       FIN-LEE-ULT-ETP.
           EXIT.
      *AFRI-FIN/ACT. DE EXC. PARA PREP. DE OPC HIPOTECARIAS/CHC/01-2012
