*%! Codigo adicional para archivo COLPQCBN
*% IF SETTAG
*% FNCPQ = "BGE002"
*% VSNPQ = "06.04.03"
*% END
*% LARGO_MI_COMMAREA = 20
*% PGM_PTC = TRUE
*% IF MI_COMMAREA
      *<<<< MI_COMMAREA
           03 CMA-VARI.
              05 SCR-IMAX      COMP                   PIC S9(04).
              05 SCR-I         COMP                   PIC S9(04).
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       COPY COLWGCBN.
       COPY GNSWGCPT. 
       COPY GNSWGPES.
       COPY TABBRCAM.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY SGCBRDBC.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.   
       
       01  WSS-VARI.
           03  WSS-I                              PIC 9(02).
           03  WSS-TOT     VALUE ZEROES           PIC 9(04).            
           03  WSS-IND-EXIS                       PIC X(01).            
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           IF SCR-OFRM-SRV                                              
              MOVE TSK-TERM-ALF TO CBN-COD-TERM                         
              MOVE TSK-TERM-ALF TO CBN-COD-TERM-MAS                     
                                                                        
           ELSE                                                         
              MOVE EIBTRMID     TO CBN-COD-TERM                         
              MOVE EIBTRMID     TO CBN-COD-TERM-MAS.                    
      *>>>>
*% END
*% IF PFS_SCR_ACC                                                 
      *<<<< PFS_SCR_ACC                                                 
           IF FRM-FFLD = FRM-FFLD-PF6                                   
                    OR   FRM-FFLD-PF5                                   
               PERFORM VAL-NUM-KEY-CBN                                  
               PERFORM VAL-NUM-FLD-CBN                                  
               PERFORM RST-STAT                                         
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY                     
               IF SCR-STAT NOT = SCR-STAT-ABT                           
                   PERFORM SCR-TRL                                      
               ELSE                  
                   PERFORM DESSCRTRL                                    
                   GO TO FIN-SCR-ACC.                                   
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY                                            
           MOVE SPACES TO FRM-MEN1.                                
           IF FRM-FFLD = FRM-FFLD-PF5                              
              MOVE PGM-SNUL TO PGM-STAT-RCO                      
              SUBTRACT 1 FROM SCR-I GIVING CBN-I                  
              IF CBN-I NOT > ZEROES                               
                 MOVE 'BNF PRV' TO MSG-COD-MENS              
                 GO TO ERR-FND-KEY                               
              ELSE                                                
                 GO TO CARGA-CBN                                 
           ELSE                                                    
           IF FRM-FFLD = FRM-FFLD-PF6                              
              MOVE PGM-SNUL TO PGM-STAT-RCO                       
              ADD 1 SCR-I GIVING CBN-I                            
              IF CBN-I > SCR-IMAX                                 
                MOVE 'CBN  NXT' TO MSG-COD-MENS              
                GO TO ERR-FND-KEY                               
              ELSE 
                GO TO CARGA-CBN.                                
           GO TO CON-FND-KEY.                                      
      *>>>>         
*% END     
*% IF FIN_FND_KEY                                  
      *<<<< FIN_FND_KEY                                            
           IF NOT FIO-STAT-OKS                                     
               GO TO FIN-FND-KEY.                                  
       CON-FND-KEY.                                                
           MOVE ZEROES TO SCR-IMAX.                                
           MOVE 1 TO SCR-I.                                        
           MOVE '00' TO FIO-STAT.                                  
           PERFORM OBT-DAT-TS.
           IF MSG-COD-MENS > SPACES                                     
              GO TO ERR-FND-KEY.                                        
           MOVE 1 TO SCR-I.                                        
           MOVE SCR-I TO CBN-I.                                    
       CARGA-CBN.                                                  
           MOVE SPACES TO MSG-COD-MENS.                            
           IF NOT SCR-OFRM-SRV                                     
             PERFORM PUT-TAB-CBN.                                    
             MOVE '00' TO FIO-STAT.                                  
             GO TO FIN-FND-KEY.        
       ERR-FND-KEY.                                                
           MOVE SCR-STAT-CON TO SCR-STAT.                          
           MOVE 'COL'  TO MSG-COD-SIST.                            
           PERFORM GET-MSG.                                        
           MOVE MSG-GLS-DESC TO FRM-MEN1.                          
           MOVE '00' TO FIO-STAT.                                  
           GO TO FIN-FND-KEY.                                      
      *>>>>                                                        
*% END
*% IF PFS_GET_CON OR PFS_GET_ACC                                  
      *<<<< PFS_GET_CON OR PFS_GET_ACC                                  
           IF NOT (FRM-FFLD = FRM-FFLD-PF6                              
                         OR   FRM-FFLD-PF5)                             
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       COPY GNSBGCPT. 
       COPY GNSBVTAB.
       COPY GNSBBTAB.                                                   
       COPY GNSBGPES.                                                   
       COPY TABBFCAM.                                                   
       COPY SGCBFDBC.                                                   
       
       CAR-MOV-CBN SECTION.
       INI-CAR-MOV-CBN.

               
       VAL-CAR-MOV-CBN.    
           MOVE DPL-CIC-ICLI IN DPL TO DBC-CIC-ICLI IN DBC.             
           MOVE FIO-GET-KEY TO FIO-CMND.                                
           PERFORM SGC-FIO-DBC.                                         
           MOVE DBC-NUM-ICLI IN DBC TO CBN-NUM-ICLI(CBN-I).             
           MOVE DBC-VRF-ICLI IN DBC TO CBN-VRF-ICLI(CBN-I).             
           MOVE DBC-IND-ICLI IN DBC TO CBN-IND-ICLI(CBN-I).             
           MOVE DBC-GLS-ICLI IN DBC TO CBN-GLS-ICLI(CBN-I).             
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.                        
           PERFORM CPT-BLKS.                                            
           MOVE CPT-STRN TO CBN-GLS-NOMC(CBN-I).                        
       NXT-CAR-MOV-CBN.                                                 
           PERFORM INC-REG-TS.                                          
           ADD 1 TO WSS-TOT.
       SIG-CAR-MOV-CBN.                                                 
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           GO TO LUP-CAR-MOV-CBN.                                       
       FIN-CAR-MOV-CBN.
           EXIT.

   
       OBT-DAT-TS SECTION.
       INI-OBT-DAT-TS.
           EXEC CICS HANDLE CONDITION QIDERR(CON-OBT-DAT-TS)
                                     ITEMERR(CON-OBT-DAT-TS)
           END-EXEC.

           MOVE CBN-NOM-TSCBN     TO QUE-COLA.
           MOVE QUE-DEL           TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
       CON-OBT-DAT-TS.
           MOVE CBN-SI-IMP TO CBN-IMP.
           PERFORM CLR-VEC-TS VARYING CBN-I FROM 1 BY 1 UNTIL
                   CBN-I > CBN-IMAX-MTX.
           MOVE 1 TO CBN-I.
           PERFORM CAR-MOV-CBN.
        NXT-OBT-DAT-TS.
           IF CBN-IMP = CBN-SI-IMP
               PERFORM WRT-TS.
       FIN-OBT-DAT-TS.
           EXIT.

       PUT-TAB-CBN SECTION.
       INI-PUT-TAB-CBN.
           PERFORM RED-TS.
           PERFORM LLE-DAT-PNT VARYING CBN-I FROM 1 BY 1
                   UNTIL CBN-I > CBN-IMAX.
       FIN-PUT-TAB-CBN.
           EXIT.

       LLE-DAT-PNT SECTION.
       INI-LLE-DAT-PNT.
           MOVE CBN-GLS-NOMC(CBN-I) TO FRM-GLS-NOMC IN CBN-FLD(CBN-I).
           MOVE CBN-COD-TREL(CBN-I) TO FRM-COD-TREL IN CBN-FLD(CBN-I)
           MOVE CBN-VRF-ICLI(CBN-I) TO FRM-VRF-ICLI IN CBN-FLD(CBN-I). 
           MOVE CBN-NUM-ICLI(CBN-I) TO FRM-NUM-ICLI IN CBN-FLD(CBN-I). 
           MOVE CBN-GLS-ICLI(CBN-I) TO FRM-GLS-ICLI IN CBN-FLD(CBN-I). 
           MOVE CBN-IND-ICLI(CBN-I) TO FRM-IND-ICLI IN CBN-FLD(CBN-I). 
           MOVE CBN-COD-TEMP(CBN-I) TO FRM-COD-TEMP IN CBN-FLD(CBN-I). 
       FIN-LLE-DAT-PNT.
           EXIT.

       INC-REG-TS SECTION.
       INI-INC-REG-TS.
           MOVE CBN-SI-IMP TO CBN-IMP.
           ADD 1 TO CBN-I.
           IF CBN-I > CBN-IMAX
               PERFORM WRT-TS
               PERFORM CLR-VEC-TS VARYING CBN-I FROM 1 BY 1
                                     UNTIL CBN-I > CBN-IMAX
               MOVE 1 TO CBN-I
               MOVE CBN-NO-IMP TO CBN-IMP.
       FIN-INC-REG-TS.
           EXIT.

       WRT-TS SECTION.
       INI-WRT-TS.
           ADD 1 TO SCR-IMAX.
           MOVE CBN-NOM-TSCBN  TO QUE-COLA.
           MOVE CBN-TS         TO QUE-ITEM.
           MOVE CBN-LEN-TSCBN  TO QUE-LITM.
           MOVE QUE-PUT        TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
       FIN-WRT-TS.
           EXIT.

       RED-TS SECTION.
       INI-RED-TS.
           MOVE CBN-I TO SCR-I.
           EXEC CICS HANDLE CONDITION QIDERR(FIN-RED-TS)
                                     ITEMERR(FIN-RED-TS)
           END-EXEC.
           MOVE CBN-NOM-TSCBN      TO QUE-COLA.
           MOVE CBN-TS             TO QUE-ITEM.
           MOVE CBN-LEN-TSCBN      TO QUE-LITM.
           MOVE CBN-I              TO QUE-NITM.
           MOVE QUE-GET            TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           MOVE QUE-ITEM          TO CBN-TS.
       FIN-RED-TS.
           EXIT.

       CLR-VEC-TS SECTION.
       INI-CLR-VEC-TS.
           MOVE SPACES TO CBN-GLS-NOMC(CBN-I).
           MOVE SPACES TO CBN-COD-TREL(CBN-I).
           MOVE SPACES TO CBN-VRF-ICLI(CBN-I).
           MOVE SPACES TO CBN-NUM-ICLI(CBN-I).                          
           MOVE SPACES TO CBN-IND-ICLI(CBN-I).                          
           MOVE SPACES TO CBN-GLS-ICLI(CBN-I).                          
           MOVE SPACES TO CBN-COD-TEMP(CBN-I). 
        FIN-CLR-VEC-TS.
           EXIT.

       RST-STAT SECTION.
       INI-RST-STAT.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
       FIN-RST-STAT.
           EXIT.
      *>>>>
*% END
