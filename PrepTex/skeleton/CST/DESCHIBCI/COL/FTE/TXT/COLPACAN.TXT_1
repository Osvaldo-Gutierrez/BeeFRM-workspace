*%! Codigo adicional para archivo
*% PGM_PTC = TRUE
*% NO_TIENE_TIMESTAMP = TRUE
*% NO_HDR_CST = TRUE
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
       COPY COLWGENG.
       COPY COLW1CAN.
      *>>>>
*% END
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
       COPY GNSWGRQA REPLACING
                     ==01  ADR-REQA== BY ==02  SCR-CAN-REQA==.
           02 SCR-KEY-ICAN                     PIC X(03).
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       COPY COLWGPMP.
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
      *DAD ini PTC
       COPY GNSWGQUE.
      *DAD fin PTC
       COPY COLBRTMC.
       COPY COLBRCYA.
       COPY COLBRICG.
       COPY COLBRITR.
       COPY COLBROPC.
       COPY COLBRRCV.
       COPY COLBRROV.
       COPY COLBRVEN.
       COPY COLBRRDC.
      * RBG/INI/12-NOV-1996
       COPY SGCBRDCE.
       COPY SGCBRDCP.
       COPY SGCWGDCP.
       COPY COLBRCOM.
      * RBG/FIN/12-NOV-1996
       COPY SGCBRDBC.
       COPY SGCBRRCO.
       COPY SGCBROPE.
       COPY GNSWGCPT.
       COPY GNSWGCIC.
       COPY GNSBRCIC.
       COPY TABBRCAM.
       COPY TABWGCAM.
       COPY TABBRVLR.
      *ALD-BCI-INI/22.04.1999
       COPY TABWGTXC.
      *ALD-BCI-FIN/22.04.1999
       COPY COLWGVEN.
      *SMC-INI 09.09.1993
       COPY COLWGINT.
      *SMC-FIN 09.09.1993
       COPY GNSWGCVI.
       COPY COLBRDLC.
       COPY COLBREVC.
       COPY COLBRTOC.
       COPY GNSWGPES.
       COPY COLW2CAN.

      * RBG INI 3-APR-1996 **Restaurar para Compilar en Roscoe**
      * DAD ini  21-ABR-1993
      *    03  WSS-VAL-CMP2                COMP-2.
      * DAD fin  21-ABR-1993
           03  WSS-VAL-CMP2                      PIC S9(11)V9(5).
      * RBG FIN 3-APR-1996 **Restaurar para compilar en Roscoe**
           03  WSS-MSG-MENS.
               05  WSS-MSG-PREV                     PIC X(09).
               05  WSS-MSG-TENT                     PIC X(01).
               05  WSS-MSG-FENT                     PIC X(01).
               05  WSS-MSG-SENT                     PIC X(01).
           03  WSS-MSC-CACC                         PIC X(08).
      * RBG/INI/18-NOV-1996 Variable para el cobro de Comision.
           03  WSS-SGV-DELT  COMP-3  VALUE ZEROES   PIC S9(09)V9(04).
      * RBG/FIN/18-NOV-1996 Variable para el cobro de Comision.

      *DAD ini  11-AUG-1992   (Memo.24-07-92 Pto.2)
           COPY USPC113.
      *DAD fin  11-AUG-1992
       01  WSS-AUXI.
           05 WSS-MSJS.
              07 WSS-MSJ0                              PIC X(22).
              07 FILLER                                PIC X(01).
              07 WSS-MSJ1                              PIC X(16).
              07 FILLER                                PIC X(01).
              07 WSS-MSJ2                              PIC X(22).
              07 FILLER                                PIC X(01).
              07 WSS-MSJ3                              PIC X(16).
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VLR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==.
      * RBG/INI/12-NOV-1996
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
      * RBG/FIN/12-NOV-1996
      *>>>>
*% END
*% IF CMA
      *<<<< CMA
           02 FILLER                      PIC X(3000).
      *>>>>
*% END
*% IF ( INI_FIO ) AND ( NOT PGM_VSI )
      *<<<< ( INI_FIO ) AND ( NOT PGM_VSI )
           PERFORM GNS-HDL-VSM.
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           MOVE +3000 TO SCR-TCMA.
           IF SCR-DESDE-CMN
               PERFORM GNS-CLR-RQA.
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           IF SCR-DESDE-CMN
             IF NOT SCR-OFRM-SRV
               MOVE SPACES TO SCR-COD-TICG
                              SCR-COD-TITR
                              SCR-COD-VCOC
                              SCR-CYA-IND-MCYA
                              SCR-CYA-IND-PAUT
                              SCR-CYA-IND-CAJA
                              SCR-ROV-CAI-IOPC
               MOVE ZEROES TO SCR-ROV-IIC-IOPC
               MOVE 1      TO SCR-SGV-VCAM.
           IF SCR-DESDE-CMN
               MOVE 'C'    TO SCR-IND-OOD
               MOVE 1 TO SCR-IPRO
               GO TO FIN-INI-FIO.
           IF SCR-INST-EXT = WSS-INST-FTER-CIC
               MOVE WSS-INST-NULL TO SCR-INST-EXT
               PERFORM ING-FTER-CIC.
       FIN-INI-FIO.
      *>>>>
*% END
*% IF PFS_SCR_MOD
      *<<<< PFS_SCR_MOD
           IF ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR
                           FRM-FFLD-PF7 OR FRM-FFLD-PF8 ) AND
              SCR-STAT = SCR-STAT-CON
               PERFORM VAL-NUM-KEY-CAN
               PERFORM VAL-NUM-FLD-CAN.
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR
                         FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM GNS-CLR-RQA
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-MOD.
           PERFORM GNS-CLR-RQA.
      *>>>>
*% END
*% IF PFS_SCR_ACC
      *<<<< PFS_SCR_ACC
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR
                         FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM VAL-NUM-KEY-CAN
               PERFORM VAL-NUM-FLD-CAN
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM GNS-CLR-RQA
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-ACC.
           PERFORM GNS-CLR-RQA.
      *>>>>
*% END
*% IF PFS_SCR_ELI
      *<<<< PFS_SCR_ELI
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR
                         FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM VAL-NUM-KEY-CAN
               PERFORM VAL-NUM-FLD-CAN
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM GNS-CLR-RQA
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-ELI.
           PERFORM GNS-CLR-RQA.
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
       COPY COLB1CAN.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
       COPY COLB2CAN.
      *>>>>
*% END
*% IF CMN_MOD
      *<<<< CMN_MOD
      *ISP ES NECESARIO TENER LOS DATOS DE LA OPERACION
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO CAN-NUM-DTRN IN CAN.
           MOVE HOY-MHOY IN HOY-VARI TO CAN-NUM-MTRN IN CAN.
           MOVE HOY-AHOY IN HOY-VARI TO CAN-NUM-ATRN IN CAN.
           MOVE HOY-SHOY IN HOY-VARI TO CAN-NUM-STRN IN CAN.
           MOVE HOY-HHOY IN HOY-VARI TO CAN-HRA-HRTR IN CAN.
           PERFORM GET-OPC.

           IF SCR-MSC-FCAN = 'T' AND
              SCR-MSC-ECAN = 'E'
                MOVE 1 TO CAN-NUM-TVCC IN CAN
           ELSE
           IF SCR-MSC-FCAN = 'T' AND
              SCR-MSC-ECAN = 'T'
                MOVE OPC-NUM-VCVG IN OPC TO CAN-NUM-TVCC IN CAN
           ELSE
           IF SCR-MSC-FCAN = 'I' OR 'P'
                MOVE ZEROES TO CAN-NUM-TVCC IN CAN
           ELSE
                MOVE 1 TO CAN-NUM-TVCC IN CAN.

      *ISP ASUME CANCELACION NO VERIFICADA
           MOVE 'M' TO CAN-MSC-STAT IN CAN.
           MOVE 'M' TO WSS-MSG-FENT.
           PERFORM VRF-ACT-CYA.
           IF NOT PGM-STAT-CYA-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-MOD.
           PERFORM CHK-PNR-BGT.
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en la modificacion : informar
               MOVE FIO-MENS TO FRM-MENS
      *DAD ini  07-JUN-1993   (Memo.03-06-93)
               PERFORM BCK-OUT
      *DAD fin  07-JUN-1993
               GO TO FIN-CMN-MOD.

           PERFORM ACT-ICG.
           IF NOT PGM-STAT-ICG-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-MOD.

           PERFORM ACT-COM.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-MOD.

      *DPM ini  11-OCT-1996 Los perform siguientes fueron cambiados
      *de prioridad para calcular CAN-SGV-IMOK
           IF SCR-ROV-CAI-IOPC > SPACES        OR
              SCR-ROV-IIC-IOPC > ZEROES        OR
              ROV-CAI-IOPC IN CAN-FLD > SPACES OR
              ROV-IIC-IOPC IN CAN-FLD > ZEROES
                PERFORM ACT-ROV
                IF NOT FIO-STAT-OKS
                    MOVE FIO-MENS TO FRM-MENS
                    PERFORM BCK-OUT
                    GO TO FIN-CMN-MOD.

           PERFORM ACT-RCV.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-MOD.
      *DPM fin  11-OCT-1996
      *>>>>
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
           MOVE ZEROES TO CAN-NUM-TVCC IN CAN.
           MOVE ZEROES TO CAN-SGV-IMOK IN CAN.
           MOVE ZEROES TO CAN-FEC-FDVA IN CAN.
           MOVE ZEROES TO CAN-FEC-FTRN IN CAN.
           MOVE ZEROES TO CAN-HRA-HRTR IN CAN.

           MOVE SPACES TO ICG.
           MOVE ZEROES TO ICG-FEC-FTRN IN ICG.
           MOVE ZEROES TO ICG-HRA-HRTR IN ICG.
           MOVE ZEROES TO ICG-SGV-TINT IN ICG.
           MOVE ZEROES TO ICG-SGV-SPRD IN ICG.
           MOVE ZEROES TO ICG-SGV-MNTO IN ICG.
           MOVE ZEROES TO ICG-NUM-PREP IN ICG.
           MOVE ZEROES TO ICG-FEC-FTER IN ICG.

           MOVE SPACES TO COM.
           MOVE ZEROES TO COM-SGV-MIVA IN COM.
           MOVE ZEROES TO COM-FEC-FTRN IN COM.
           MOVE ZEROES TO COM-HRA-HRTR IN COM.
           MOVE ZEROES TO COM-SGV-TINT IN COM.
           MOVE ZEROES TO COM-SGV-SPRD IN COM.
           MOVE ZEROES TO COM-SGV-MNTO IN COM.
           MOVE ZEROES TO COM-NUM-PREP IN COM.
           MOVE ZEROES TO COM-FEC-FTER IN COM.

           MOVE SPACES TO RCV.
           MOVE ZEROES TO RCV-FEC-FCAN IN RCV.
           MOVE ZEROES TO RCV-FEC-FOUT IN RCV.
           MOVE ZEROES TO RCV-FEC-FTRN IN RCV.
           MOVE ZEROES TO RCV-NUM-HHTR IN RCV.
           MOVE ZEROES TO RCV-NUM-IDLC IN RCV.
           MOVE ZEROES TO RCV-NUM-IEVC IN RCV.
           MOVE ZEROES TO RCV-NUM-IVCT IN RCV.
           MOVE ZEROES TO RCV-NUM-MMTR IN RCV.
           MOVE ZEROES TO RCV-NUM-SSTR IN RCV.
           MOVE ZEROES TO RCV-SGV-CAPI IN RCV.
           MOVE ZEROES TO RCV-SGV-FINA IN RCV.
           MOVE ZEROES TO RCV-SGV-INTE IN RCV.
           MOVE ZEROES TO RCV-SGV-INTM IN RCV.
           MOVE ZEROES TO RCV-SGV-INTN IN RCV.
           MOVE ZEROES TO RCV-SGV-REAJ IN RCV.

           MOVE SPACES TO ROV.
           MOVE ZEROES TO ROV-FEC-FTRN IN ROV.
           MOVE ZEROES TO ROV-HRA-HRTR IN ROV.
           MOVE ZEROES TO ROV-SGV-RENO IN ROV.
           MOVE ZEROES TO ROV-NUM-IVCT IN ROV.
      *>>>>
*% END
*% IF CMN_ING
      *<<<< CMN_ING
      *RVM-CST-INI 15-MAY-1997
           IF SCR-CMND = 'SCA'
               MOVE 'COL'      TO MSG-COD-SIST
               MOVE 'SIMULNXT' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '23' TO FIO-STAT
               GO TO FIN-CMN-ING.
      *RVM-CST-FIN 15-MAY-1997

           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO CAN-NUM-DTRN IN CAN.
           MOVE HOY-MHOY IN HOY-VARI TO CAN-NUM-MTRN IN CAN.
           MOVE HOY-AHOY IN HOY-VARI TO CAN-NUM-ATRN IN CAN.
           MOVE HOY-SHOY IN HOY-VARI TO CAN-NUM-STRN IN CAN.
           MOVE HOY-HHOY IN HOY-VARI TO CAN-HRA-HRTR IN CAN.

      *ISP ES NECESARIO TENER LOS DATOS DE LA OPERACION
           PERFORM GET-OPC.

           IF SCR-MSC-FCAN = 'T' AND
              SCR-MSC-ECAN = 'E'
                MOVE 1 TO CAN-NUM-TVCC IN CAN
           ELSE
           IF SCR-MSC-FCAN = 'T' AND
              SCR-MSC-ECAN = 'T'
                MOVE OPC-NUM-VCVG IN OPC TO CAN-NUM-TVCC IN CAN
           ELSE
           IF SCR-MSC-FCAN = 'I' OR 'P'
                MOVE ZEROES TO CAN-NUM-TVCC IN CAN
           ELSE
                MOVE 1 TO CAN-NUM-TVCC IN CAN.

      *ISP ASUME CANCELACION NO VERIFICADA
           MOVE 'I' TO WSS-MSG-FENT.
           MOVE 'I' TO CAN-MSC-STAT IN CAN.
           PERFORM VRF-ACT-CYA.
           IF NOT PGM-STAT-CYA-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-ING.
           PERFORM CHK-PNR-BGT.
      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en el ingreso : informar
               MOVE FIO-MENS TO FRM-MENS
      *DAD ini  18-JUN-1993 / 07-JUN-1993   (Memo.03-06-93)
               IF FIO-STAT = '02' OR '22'
                   MOVE 'GNS'     TO MSG-COD-SIST
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC        TO FRM-MEN1
                   MOVE CAN-KEY-ICAN IN CAN TO FRM-MEN2
                   PERFORM BCK-OUT
                   GO TO FIN-CMN-ING
               ELSE
                   PERFORM BCK-OUT
      *DAD fin  18-JUN-1993 / 07-JUN-1993
                   GO TO FIN-CMN-ING.

           PERFORM ACT-ICG.
           IF NOT PGM-STAT-ICG-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-ING.

           PERFORM ACT-COM.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-ING.

      *DPM ini  11-OCT-1996 Los perform siguientes fueron cambiados
      *de prioridad para calcular CAN-SGV-IMOK
           IF SCR-MSC-TCAN = 'R' OR 'P'
               PERFORM ASS-OPC-ROV.

           PERFORM ACT-RCV.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-ING.
      *DPM fin  11-OCT-1996

       END-CMN-ING.
           IF CYA-IND-TCYA IN CAN-FLD = 'M'
               MOVE CAN-CAI-IOPC IN CAN-FLD TO SCR-CAI-IOPC
               MOVE CAN-IIC-IOPC IN CAN-FLD TO SCR-IIC-IOPC
               MOVE CAN-NUM-ICAN IN CAN-FLD TO SCR-NUM-IDOC
               MOVE 2 TO WSS-IDX-ICYA
               MOVE 'S'    TO SCR-IND-ENG IN SCR-VEC-ENG(WSS-IDX-ICYA)
               MOVE 'S'    TO SCR-IND-FST IN SCR-VEC-FST(WSS-IDX-ICYA)
               PERFORM EGR-FPEN-CIC.
      *>>>>
*% END
*% IF INI_CMN_ACC
      *<<<< INI_CMN_ACC
           IF SCR-CMND NOT = 'VRF'
               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'CMDINV' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-ACC.
      *>>>>
*% END
*% IF CMN_ACC_RET
      *<<<< CMN_ACC_RET
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           IF CAN-SGV-TPAG IN CAN > ZEROES
               PERFORM PRO-CYA.
           IF ROV-IIC-IOPC IN CAN-FLD > ZEROES
               PERFORM PRO-ROV-ACT.
           IF FRM-SUAR =  FRM-SUAR-MAL
               GO TO FIN-CMN-ACC.
      *>>>>
*% END
*% IF CMN_ACC
      *<<<< CMN_ACC
           MOVE 'V' TO CAN-MSC-STAT IN CAN.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           MOVE 'COL' TO MSG-COD-SIST.
           MOVE 'CAN    VRFOK' TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
      *>>>>
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en la modificacion : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.

       LUP-ELI-CYA.
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF ( FIO-STAT-OKS AND
                CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
                CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA )
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-CYA
               MOVE FIO-DEL TO FIO-CMND
               PERFORM COL-FIO-CYA
               GO TO LUP-ELI-CYA.

       LUP-ELI-RCV.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF FIO-STAT-OKS AND
              CAN-CIC-IOPC IN CAN = RCV-CIC-IOPC IN RCV AND
              CAN-NUM-ICAN IN CAN = RCV-NUM-ICAN IN RCV
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-RCV
               MOVE FIO-DEL TO FIO-CMND
               PERFORM COL-FIO-RCV
               GO TO LUP-ELI-RCV.

       LUP-ELI-ICG.
           MOVE CAN-CIC-IOPC IN CAN TO ICG-CIC-IOPC IN ICG.
           MOVE CAN-NUM-ICAN IN CAN TO ICG-NUM-ICAN IN ICG.
      * RBG/INI/25-NOV-1996
      *    MOVE CAN-CIC-IOPC IN CAN TO ICG-CIC-IOPV IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE SPACES              TO ICG-IND-TTAS IN ICG.
      *    MOVE 'INT'               TO ICG-IND-TTAS IN ICG.
      * RBG/FIN/25-NOV-1996
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF FIO-STAT-OKS AND
              CAN-CIC-IOPC IN CAN = ICG-CIC-IOPC IN ICG AND
              CAN-NUM-ICAN IN CAN = ICG-NUM-ICAN IN ICG
                MOVE FIO-GET-KEY-UPD TO FIO-CMND
                PERFORM COL-FIO-ICG
                MOVE FIO-DEL TO FIO-CMND
                PERFORM COL-FIO-ICG
                IF FIO-STAT-OKS
                    GO TO LUP-ELI-ICG.

           MOVE ROV-CAI-IOPC IN CAN-FLD TO ROV-CAI-IOPC IN ROV.
           MOVE ROV-IIC-IOPC IN CAN-FLD TO ROV-IIC-IOPC IN ROV.
           MOVE CAN-CAI-IOPC IN CAN-FLD TO ROV-CAI-IOPV IN ROV.
           MOVE CAN-IIC-IOPC IN CAN-FLD TO ROV-IIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN-FLD TO ROV-NUM-IVCT IN ROV.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF FIO-STAT-OKS
               MOVE FIO-DEL TO FIO-CMND
               PERFORM COL-FIO-ROV
           ELSE
               MOVE '00' TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-ROV.
      *>>>>
*% END
*% IF PFS_SCR_GKEY
      *<<<< PFS_SCR_GKEY
           IF NOT ( FRM-FFLD = FRM-FFLD-PF8 OR FRM-FFLD = FRM-FFLD-PF7 )
      *>>>>
*% END
*% IF PFS_SCR_GFLD
      *<<<< PFS_SCR_GFLD
           IF NOT ( ( SCR-CCPP = 'MOD' OR  SCR-CCPP = 'ACC' OR
                      SCR-CCPP = 'ELI'                      OR
                    ( SCR-CCPP = 'ACT' AND SCR-ACTU = SCR-ACTU-MOD ) )
                      AND ( FRM-FFLD = FRM-FFLD-PF8 OR
                            FRM-FFLD = FRM-FFLD-PF7 OR
                            FRM-FFLD = FRM-FFLD-PF5 OR
                            FRM-FFLD = FRM-FFLD-PF6 ) )
      *>>>>
*% END
*% IF SCR_GFLD_VAL_FLD
      *<<<< SCR_GFLD_VAL_FLD
      *ISP ES NECESARIO TENER LOS DATOS DE LA OPERACION
      *    PARA LA VALIDACION DE CAMPOS
           MOVE CAN-CAI-IOPC IN CAN-FLD TO OPC-CAI-IOPC IN OPC.
           MOVE CAN-IIC-IOPC IN CAN-FLD TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'OPC    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO ERR-SCR-GFLD.

      *ISP ES NECESARIO TENER LOS DATOS DEL VENCIMIENTO
      *    PARA LA VALIDACION DE CAMPOS
           MOVE CAN-CAI-IOPC IN CAN-FLD TO VEN-CAI-IOPC IN VEN.
           MOVE CAN-IIC-IOPC IN CAN-FLD TO VEN-IIC-IOPC IN VEN.
           MOVE SCR-VEN-NUM-IVEN        TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           IF OPC-IND-VSTR IN OPC = 'S'
               PERFORM COL-OBT-VEN
               IF VEN-STAT-OKS OR VEN-STAT-ENO
                   MOVE VEN-NUM-IVEN IN VEN TO
                        VEN-NUM-IVCT IN VEN
                   MOVE '00' TO FIO-STAT
               ELSE
                   MOVE '23' TO FIO-STAT
           ELSE
               PERFORM COL-FIO-VEN.

           IF NOT FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'VEN    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO ERR-SCR-GFLD.
      *ISP SI ES CREDITO REAJUSTABLE ==> VALOR PAGADO EN PESOS, CALCULOS
      *    EN LA MONEDA
      *     IF CAN-SGV-TPAG IN CAN-FLD = ZEROES
      *         GO TO NOT-VAL-CAN-SGV-TPAG.
      *
           PERFORM GET-MON.
      *>>>>
*% END
*% IF PFS_GET_CON OR PFS_GET_ACC
      *<<<< PFS_GET_CON OR PFS_GET_ACC
           IF NOT
              ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD = FRM-FFLD-PF6 OR
                FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD = FRM-FFLD-PF8 )
      *>>>>
*% END
*% IF FIN_HBL_FLD
      *<<<< FIN_HBL_FLD
      *ALD-BCI-INI
           MOVE FRM-CPIM-AEY TO CAN-SGV-GAST-ATR IN CAN-FLD.
      *ALD-BCI-FIN
           IF SCR-CYA-IND-MCYA = 'M'
               MOVE FRM-CPIM-AEY TO CYA-IND-TCYA-ATR IN CAN-FLD
               MOVE FRM-CPIM-AEY TO CYA-CAI-ICYA-ATR IN CAN-FLD
               MOVE FRM-CPIM-AEY TO CYA-IIC-ICYA-ATR IN CAN-FLD.
           IF ( SCR-CCPP = 'MOD' ) OR ( SCR-ACTU = SCR-ACTU-MOD )
               MOVE FRM-CPIM-AEY TO CAN-MSC-CANC-ATR IN CAN-FLD.

      *DAD ini  11-AUG-1992   (Memo.24-07-92 Pto.2)
      *DAD ini PTC
      *ISP PTC   EN PLATAFORMA NO ES NECESARIA ESTA VALIDACION
           IF NOT SCR-OFRM-SRV
               MOVE 'COL'          TO FIO-SIST
               MOVE 'VSN'          TO TAB-COD-TTAB IN TAB
               MOVE 'OFIUSPCANING' TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-TAB
               IF FIO-STAT-OKS AND
                  TAB-MSC-STAT IN TAB = 'S'
                  PERFORM VAL-OFI-USP.
      *DAD fin PTC
      *DAD fin  11-AUG-1992
      *DAD ini  12-NOV-1992
           IF FRM-GLS-IITR IN CAN-FLD NOT = FRM-GLS-TINT IN CAN-FLD
               PERFORM BASE-TASA-INI.
      *DAD fin  12-NOV-1992
      *>>>>
*% END
*% IF ( EOF ) AND ( NOT PGM_VSI )
      *<<<< ( EOF ) AND ( NOT PGM_VSI )
       COPY GNSBGVSM.
       COPY GNSBHVSM.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       RST-STAT SECTION.
       INI-RST-STAT.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
       FIN-RST-STAT.
           EXIT.

       GNS-CLR-RQA SECTION.
       INI-GNS-CLR-RQA.
           MOVE SPACES TO SCR-CAN-REQA.
           MOVE SPACES TO SCR-KEY-ICAN.
       FIN-GNS-CLR-RQA.
           EXIT.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      *DAD ini  11-AUG-1992   (Memo.24-07-92 Pto.2)
       VAL-OFI-USP SECTION.
       INI-VAL-OFI-USP.
           COPY USPC143.
           MOVE FRM-CPIM-AEY    TO CAN-COD-OFCA-ATR IN CAN-FLD.
           MOVE USP-COD-OFICINA TO CAN-COD-OFCA IN CAN-FLD.
       FIN-VAL-OFI-USP.
           EXIT.
      *DAD fin  11-AUG-1992

       CHK-PNR-BGT SECTION.
       INI-CHK-PNR-BGT.
           MOVE SPACES TO MSG-COD-MENS.
      *Busca dato 'como opera=wss-opec'
           MOVE OPC-COD-TOOC IN OPC TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM COL-FIO-TOC.
           IF NOT FIO-STAT-OKS
               MOVE 'CANTOOCNEX' TO MSG-COD-MENS
               GO TO FIN-CHK-PNR-BGT.
           MOVE TOC-MSC-OPEC IN TOC TO WSS-OPEC.
      *Si es una prorroga,novacion,renovacion de boleta de garantia
      *debe sumar el RCV-SGV-CAPI (en $ si corresponde) al CAN-SGV-TREN
           IF NOT ( ( CAN-MSC-TCAN = 'N' OR 'R' OR 'P' ) AND
              ( WSS-OPEC = 'B' ) )
               GO TO FIN-CHK-PNR-BGT.
      *Busca cic de moneda para saber si transforma a $
           MOVE 'TAB' TO TAB-COD-SIST FIO-SIST.
           MOVE 'VLR' TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'CODTVLRNEX' TO MSG-COD-MENS
               GO TO FIN-CHK-PNR-BGT.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-VCAM.
      *si es moneda reajustable ( chilena y no pesos ) entonces
      *convierte a pesos
           IF NOT ( WSS-CIC-TVAL     = '0' AND
                    WSS-CIC-VCAM NOT = '0999' )
               MOVE RCV-SGV-CAPI IN RCV TO WSS-VAL-SVEN
               GO TO SUM-CHK-PNR-BGT.

           MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE '0999  '            TO TAB-CIC-CTAB IN TAB.
           MOVE CAN-FEC-FCAN IN CAN TO TAB-FEC-FTRN IN TAB.
           PERFORM GET-VCAM.
           IF MSG-COD-MENS = SPACES
               MULTIPLY RCV-SGV-CAPI IN RCV BY CAM-SGV-VCAM IN CAM
                        GIVING WSS-VAL-SVEN ROUNDED
           ELSE
               GO TO FIN-CHK-PNR-BGT.
           MOVE WSS-VAL-SVEN TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-SVEN.
       SUM-CHK-PNR-BGT.
           ADD WSS-VAL-SVEN TO CAN-SGV-TREN IN CAN.
       FIN-CHK-PNR-BGT.
           EXIT.

       COPY GNSBGCAM.
       COPY COLBFTMC.
       COPY COLBFCYA.
       COPY COLBFICG.
       COPY COLBFITR.
       COPY SGCBFDBC.
      * RBG/INI/12-NOV-1996
       COPY SGCBFDCE.
       COPY SGCBFDCP.
       COPY COLBFCOM.
      * RBG/FIN/12-NOV-1996
       COPY COLBFOPC.
       COPY COLBFRCV.
       COPY COLBFROV.
       COPY COLBFVEN.
       COPY COLBFRDC.
       COPY SGCBFRCO.
       COPY SGCBFOPE.
       COPY GNSBGCPT.
       COPY COLBGCLI.
       COPY GNSBGCIC.
       COPY GNSBFCIC.
       COPY TABBFCAM.
       COPY TABBFVLR.
      *DPM ini  14-OCT-1996
       COPY COLBGMPC.
      *DPM fin  14-OCT-1996
       COPY COLBGVEN.
      *SMC-INI 09.09.1993
       COPY COLBGINT.
      *SMC-FIN 09.09.1993
       COPY GNSBGCVI.
       COPY COLBFDLC.
       COPY COLBFEVC.
       COPY COLBFTOC.
       COPY GNSBGPES.
       COPY GNSBPFEC.
      *DAD ini PTC
       COPY GNSBGQUE.
      *DAD fin PTC
      *DAD ini  04-AGO-1993   (Memo.28-06-93)
       COPY COLBGVDI.
      *DAD fin  04-AGO-1993

       COPY COLB3CAN.

       PRO-CYA SECTION.
       INI-PRO-CYA.
           MOVE SPACES TO WSS-MSC-CACC.
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS AND
                    CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
                    CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA )
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CAN    NOCYA' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE MSG-GLS-DATA TO FRM-MEN2
               GO TO FIN-PRO-CYA.
       LUP-PRO-CYA.
           IF NOT ( FIO-STAT-OKS AND
                    CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
                    CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA )
               GO TO SIG-PRO-CYA.
      *BUS-MSC busca glosa de miscelaneo en tabla
           IF CYA-IND-TCYA IN CYA > SPACES
               MOVE 'TCYA'              TO MSC-COD-TMSC IN MSC
               MOVE CYA-IND-TCYA IN CYA TO MSC-COD-CMSC IN MSC
               MOVE 'TAB'       TO FIO-SIST
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-MSC
               IF FIO-STAT-OKS
                   IF MSC-CIC-CMSC IN MSC = 'CC'
                       IF ( WSS-MSC-CACC > SPACES ) AND
                          ( WSS-MSC-CACC NOT = 'CC' )
                           MOVE 'CANTCYACC=<>' TO MSG-COD-MENS
                           GO TO MSG-PRO-CYA
                       ELSE
                           MOVE MSC-CIC-CMSC IN MSC TO WSS-MSC-CACC
                   ELSE
                       IF ( WSS-MSC-CACC > SPACES ) AND
                          ( WSS-MSC-CACC = 'CC' )
                           MOVE 'CANTCYACC=<>' TO MSG-COD-MENS
                           GO TO MSG-PRO-CYA
                       ELSE
                           MOVE MSC-CIC-CMSC IN MSC TO WSS-MSC-CACC
               ELSE
                   MOVE 'CYATCYANEX' TO MSG-COD-MENS
                   MOVE CYA-IND-TCYA IN CYA TO FRM-MEN2
                   GO TO MSG-PRO-CYA
           ELSE
               MOVE 'CYATCYABLK' TO MSG-COD-MENS
               MOVE CYA-KEY-ICYA IN CYA TO FRM-MEN2
               GO TO MSG-PRO-CYA.
      *
           ADD CYA-SGV-LIQU IN CYA TO WSS-SGV-TCYA.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           GO TO LUP-PRO-CYA.
       SIG-PRO-CYA.
           IF WSS-MSC-CACC = 'CC' AND
              ( SCR-MSC-TCAN = 'P' OR 'N' OR 'R' )
               MOVE 'OPCPRGACCTNO' TO MSG-COD-MENS
               GO TO MSG-PRO-CYA.
           IF WSS-SGV-TCYA NOT = CAN-SGV-TPAG IN CAN
               MOVE WSS-SGV-TCYA TO WSS-NUM-FEDT
               MOVE CAN-SGV-TPAG IN CAN TO WSS-NUM-FALF
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CAN    TCYA' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE SPACES TO WSS-MSJS
               MOVE MSG-GLS-DESC TO WSS-MSJ0
               MOVE WSS-NUM-FEDT TO WSS-MSJ1
               MOVE MSG-GLS-DATA TO WSS-MSJ2
               MOVE WSS-NUM-FALF TO WSS-MSJ3
               MOVE WSS-MSJS TO FRM-MENS.
           GO TO FIN-PRO-CYA.
       MSG-PRO-CYA.
           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MEN1.
           MOVE FRM-SUAR-MAL TO FRM-SUAR.
       FIN-PRO-CYA.
           EXIT.

       VRF-ACT-CYA SECTION.
       INI-VRF-ACT-CYA.
           MOVE '00' TO PGM-STAT-CYA.
           MOVE 'CAN      '  TO WSS-MSG-PREV.
           MOVE SCR-MSC-TCAN TO WSS-MSG-TENT.
           MOVE 'N'          TO WSS-MSG-SENT.
           IF CYA-IND-TCYA IN CAN-FLD = 'M'
               GO TO MSG-VRF-ACT-CYA.

           PERFORM ACT-CYA.
           IF NOT PGM-STAT-CYA-OKS
                MOVE FIO-STAT TO PGM-STAT-CYA
                GO TO FIN-VRF-ACT-CYA.

      *     IF CAN-SGV-TPAG IN CAN = CYA-SGV-LIQU IN CYA
           MOVE 'V' TO CAN-MSC-STAT IN CAN.
           MOVE 'V' TO WSS-MSG-SENT.

       MSG-VRF-ACT-CYA.
           MOVE 'COL' TO MSG-COD-SIST.
           MOVE WSS-MSG-MENS TO MSG-COD-MENS.
           PERFORM GET-MSG.
           IF WSS-MSG-SENT = 'N'
               MOVE WSS-SGV-TCYA TO WSS-NUM-FEDT
               MOVE CAN-SGV-TPAG IN CAN TO WSS-NUM-FALF
               MOVE SPACES TO WSS-MSJS
               MOVE MSG-GLS-DESC TO WSS-MSJ0
               MOVE WSS-NUM-FEDT TO WSS-MSJ1
               MOVE MSG-GLS-DATA TO WSS-MSJ2
               MOVE WSS-NUM-FALF TO WSS-MSJ3
               MOVE WSS-MSJS TO FRM-MENS
            ELSE
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE MSG-GLS-DATA TO FRM-MEN2.
       FIN-VRF-ACT-CYA.
           EXIT.

      *  CODIGO ADICIONAL PARA ENGANCHE PROGRAMAS
       ING-FTER-CIC SECTION.
       INI-ING-FTER-CIC.
           PERFORM ING-SETE.
           MOVE SCR-INST-GKY TO SCR-INST.
           PERFORM HBL-KEY.
           PERFORM SCR-CLRA-CAN.
           PERFORM EDT-KEY-CAN.
           PERFORM EDT-FLD-CAN.
      *     MOVE SCR-MENS-EXT TO CAN-GLS-MENS.
      *GET-MSG Busca mensaje en tabla
           MOVE 'GNS' TO MSG-COD-SIST.
           MOVE 'MSGKEY' TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO CAN-GLS-MENS.
           MOVE SPACES TO SCR-CIC-IOPC
                          SCR-VEC-ENG
                          SCR-VEC-FST
                          SCR-IND-EOV
                          SCR-INST-EXT
                          SCR-MENS-EXT.
           PERFORM SCR-INIT.
           PERFORM SCR-EXIT.
       FIN-ING-FTER-CIC.
           EXIT.

       ING-FTER-CMN SECTION.
       INI-ING-FTER-CMN.
           PERFORM ING-SETE.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-CAN.
           MOVE SCR-MENS-EXT TO CAN-GLS-MENS.
           PERFORM SCR-INIT.
       FIN-ING-FTER-CMN.
           EXIT.

       ING-SETE SECTION.
       INI-ING-SETE.
           PERFORM CRG-TBL-ENG.
           MOVE WSS-NTRN(SCR-IPRO) TO SCR-NTRN.
           MOVE WSS-PROG(SCR-IPRO) TO SCR-PROG.
           MOVE WSS-NMAP(SCR-IPRO) TO SCR-NMAP.
           MOVE WSS-NLIB(SCR-IPRO) TO SCR-NLIB.
       FIN-ING-SETE.
           EXIT.

       EGR-FPEN-CIC SECTION.
       INI-EGR-FPEN-CIC.
           PERFORM CRG-TBL-ENG.
           ADD 1 TO SCR-IPRO.
           IF SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) = SPACES
               GO TO INI-EGR-FPEN-CIC.
           MOVE WSS-INST-FPEN-CIC TO SCR-INST-EXT.
           MOVE WSS-PROG(SCR-IPRO) TO SYS-PROG.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-XCTL TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-EGR-FPEN-CIC.
           EXIT.

       EGR-FTER-CIC SECTION.
       INI-EGR-FTER-CIC.
           PERFORM CRG-TBL-ENG.
           MOVE 1 TO SCR-IPRO.
           MOVE WSS-INST-FTER-CIC TO SCR-INST-EXT.
           MOVE WSS-PROG(SCR-IPRO) TO SYS-PROG.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-XCTL TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-EGR-FTER-CIC.
           EXIT.

       EGR-FTER-CMN SECTION.
       INI-EGR-FTER-CMN.
           PERFORM CRG-TBL-ENG.
           MOVE 1 TO SCR-IPRO.
           MOVE WSS-INST-FTER-CMN TO SCR-INST-EXT.
           MOVE WSS-PROG(SCR-IPRO) TO SYS-PROG.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-XCTL TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-EGR-FTER-CMN.
           EXIT.

       SCR-INIT SECTION.
       INI-SCR-INIT.
           MOVE 3  TO FRM-PLIN.
           MOVE 19 TO FRM-NLIN.
           MOVE FRM-CLR-FRM TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE FRM-SINI-DBNF TO FRM-SINI.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE CAN-FLD TO FRM-DFLD.
           MOVE FRM-INI TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-INIT.
           EXIT.
       COPY COLBGMPT.

       PRO-ROV-ACT SECTION.
       INI-PRO-ROV-ACT.
           MOVE ROV-CAI-IOPC IN CAN-FLD TO OPC-CAI-IOPC IN OPC.
           MOVE ROV-IIC-IOPC IN CAN-FLD TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF FIO-STAT-OKS AND
              OPC-MSC-STAT IN OPC = 'A'
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'ROV    YAACA' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS.
       FIN-PRO-ROV-ACT.
           EXIT.
      *
      * PRO-CYA SECTION.
      * INI-PRO-CYA.
      *     MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
      *     MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
      *     MOVE ZEROES TO CYA-NUM-ICYA IN CYA.
      *     MOVE FIO-GET-NLS TO FIO-CMND.
      * LUP-PRO-CYA.
      *     PERFORM COL-FIO-CYA.
      *     IF FIO-STAT-OKS AND
      *        CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
      *        CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA
      *           ADD CYA-SGV-LIQU IN CYA TO WSS-SGV-TCYA
      *           MOVE FIO-GET-NXT TO FIO-CMND
      *           GO TO LUP-PRO-CYA.

      *     IF WSS-SGV-TCYA NOT = CAN-SGV-TPAG IN CAN
      * FIN-PRO-CYA.
      *     EXIT.

      ******************************************************************
       ACT-COM SECTION.
      ****************
       INI-ACT-COM.
           MOVE CAN-CAI-IOPC IN CAN TO ICG-CAI-IOPC IN ICG.
           MOVE CAN-IIC-IOPC IN CAN TO ICG-IIC-IOPC IN ICG.
           MOVE CAN-NUM-ICAN IN CAN TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE SPACES              TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-ACT-COM2.
           PERFORM COL-FIO-ICG.
           IF FIO-STAT-OKS AND
              CAN-CAI-IOPC IN CAN = ICG-CAI-IOPC IN ICG AND
              CAN-IIC-IOPC IN CAN = ICG-IIC-IOPC IN ICG AND
              CAN-NUM-ICAN IN CAN = ICG-NUM-ICAN IN ICG
                IF ICG-IND-TTAS IN ICG NOT = 'CMO'
                    MOVE FIO-GET-NXT TO FIO-CMND
                    GO TO LUP-ACT-COM2
                ELSE
                    MOVE FIO-GET-KEY-UPD TO FIO-CMND
                    PERFORM COL-FIO-ICG
                    MOVE FIO-DEL TO FIO-CMND
                    PERFORM COL-FIO-ICG.

           IF CAN-SGV-GAST IN CAN NOT > ZEROES
               MOVE '00' TO FIO-STAT
               GO TO FIN-ACT-COM.


           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS AND
                CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
                CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA )
                 MOVE '00' TO FIO-STAT
                 GO TO FIN-ACT-COM.

           MOVE 'TAB'               TO MSC-COD-SIST.
           MOVE 'TCYA'              TO MSC-COD-TMSC IN MSC.
           MOVE CYA-IND-TCYA IN CYA TO MSC-COD-CMSC IN MSC.
           PERFORM BUS-MSC.

           IF MSC-CIC-CMSC IN MSC NOT = 'CAJA'
               GO TO FIN-ACT-COM.
      *-------------------------------------------------*
      *INI-JGM 01-06-2000.
           MOVE CAN-CIC-IOPC IN CAN TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           PERFORM COL-FIO-RDC.
           IF NOT ( FIO-STAT-OKS AND
                    CAN-CIC-IOPC IN CAN = RDC-CIC-IOPC IN RDC )
                     GO TO FIN-ACT-COM.

           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-ACT-COM.

      *
            MOVE 'S' TO WSS-IND-SGAS IN WSS-VARI.
      *
           IF DBC-IND-TICL IN DBC = 'P'
              MOVE DBC-CIC-ICLI IN DBC TO DCP-CIC-ICLI IN DCP
              MOVE FIO-GET-KEY TO FIO-CMND
              PERFORM SGC-FIO-DCP
              IF NOT FIO-STAT-OKS
                   GO TO FIN-ACT-COM
               ELSE
                   MOVE DCP-COD-TBAN IN DCP TO WSS-COD-BANC IN WSS-VARI
                   PERFORM CHK-EXI-TBAN-CCM
                   IF WSS-IND-EBAN IN WSS-VARI = 'S'
                       GO TO SIG-CON-BANC-CCM
                   ELSE
                   GO TO FIN-ACT-COM
           ELSE
              IF DBC-IND-TICL IN DBC = 'E'
                 MOVE DBC-CIC-ICLI IN DBC TO DCE-CIC-ICLI IN DCE
                 MOVE FIO-GET-KEY TO FIO-CMND
                 PERFORM SGC-FIO-DCE
                 IF NOT FIO-STAT-OKS
                   GO TO FIN-ACT-COM
                 ELSE
                   MOVE DCE-COD-TBAN IN DCE TO WSS-COD-BANC
                                                    IN WSS-VARI
                      PERFORM CHK-EXI-TBAN-CCM
                      IF WSS-IND-EBAN IN WSS-VARI = 'S'
                          GO TO SIG-CON-BANC-CCM
                      ELSE
                          GO TO FIN-ACT-COM.
      *-----------------------------------------------------*
       SIG-CON-BANC-CCM.
      *    MOVE 'COL'       TO FIO-SIST.
      *    MOVE 'CMO'       TO TAB-COD-TTAB IN TAB.
      *    MOVE SPACES      TO TAB-COD-CTAB IN TAB.
      *    MOVE FIO-GET-KEY TO FIO-CMND.
      *    PERFORM GNS-FIO-TAB.
      *    MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-DATA IN WSS-VARI.

           IF WSS-COD-MONE IN WSS-VARI = '0999  '
               MOVE 1 TO WSS-SGV-VCAM IN WSS-VARI
               GO TO CONT-SIN-VCAM.

           MOVE WSS-COD-MONE IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE '0999  '                 TO CAM-COD-VCAM IN CAM(2).
           MOVE CAN-NUM-DCAN IN CAN      TO CAM-NUM-DCAM IN CAM(1).
           MOVE CAN-NUM-MCAN IN CAN      TO CAM-NUM-MCAM IN CAM(1).
           MOVE CAN-NUM-SCAN IN CAN      TO CAM-NUM-SCAM IN CAM(1).
           MOVE CAN-NUM-ACAN IN CAN      TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-VCAM.
       CONT-SIN-VCAM.
           MULTIPLY WSS-VAL-MOUF IN WSS-VARI BY WSS-SGV-VCAM IN
                              WSS-VARI GIVING WSS-SGV-NETO IN WSS-VARI.
      * Voy a buscar el Iva.
           MOVE 'TAB'       TO FIO-SIST.
           MOVE 'IVA'       TO TAB-COD-TTAB IN TAB.
           MOVE SPACES      TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-DAT2 IN WSS-VARI.

           DIVIDE WSS-NUM-PIVA IN WSS-VARI BY 100 GIVING WSS-VAL-IVA IN
                                                               WSS-VARI.
           MULTIPLY WSS-SGV-NETO IN WSS-VARI BY WSS-VAL-IVA IN WSS-VARI
                                        GIVING WSS-SGV-MIVA IN WSS-VARI.

           MOVE WSS-SGV-MIVA IN WSS-VARI TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-MIVA IN WSS-VARI.

           MOVE WSS-SGV-NETO IN WSS-VARI TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-NETO IN WSS-VARI.

           SUBTRACT WSS-SGV-MIVA IN WSS-VARI FROM CAN-SGV-GAST IN CAN
                                      GIVING WSS-SGV-DELT IN WSS-VARI.

           IF WSS-SGV-DELT IN WSS-VARI NOT = WSS-SGV-NETO IN WSS-VARI
               GO TO FIN-ACT-COM.

           MOVE 'COM-KEY-IICG' TO FIO-AKEY.
           MOVE CAN-CIC-IOPC IN CAN     TO COM-CIC-IOPC IN COM.
           MOVE ZEROES                  TO COM-NUM-ICAN IN COM.
           MOVE SPACES                  TO COM-CIC-IOPV IN COM.
           MOVE ZEROES                  TO COM-NUM-IVCT IN COM.
           MOVE SPACES                  TO COM-IND-TTAS IN COM.
           MOVE ZEROES                  TO COM-FEC-FINI IN COM.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-FEC-COM.
           PERFORM COL-FIO-COM.
           IF NOT ( FIO-STAT-OKS AND
               COM-CIC-IOPC IN COM = OPC-CIC-IOPC IN OPC )
                MOVE 'N' TO WSS-IND-HAYA IN WSS-VARI
           ELSE
               IF COM-IND-TTAS IN COM NOT = 'CMO'
                   MOVE FIO-GET-NXT TO FIO-CMND
                   GO TO LUP-FEC-COM
               ELSE
                   IF COM-NUM-ICAN IN COM = CAN-NUM-ICAN IN CAN
                       MOVE 'S' TO WSS-IND-HAYA IN WSS-VARI
                   ELSE
                       MOVE FIO-GET-NXT TO FIO-CMND
                       GO TO LUP-FEC-COM.


           IF WSS-IND-HAYA IN WSS-VARI = 'N'
               IF CAN-SGV-GAST IN CAN NOT > ZEROES
                   MOVE '00' TO FIO-STAT
                   GO TO FIN-ACT-COM
               ELSE
               MOVE WSS-SGV-MIVA IN WSS-VARI TO COM-SGV-MIVA IN COM
               MOVE WSS-SGV-NETO IN WSS-VARI TO COM-SGV-MNTO IN COM
               MOVE CAN-CAI-IOPC IN CAN      TO COM-CAI-IOPC IN COM
               MOVE CAN-IIC-IOPC IN CAN      TO COM-IIC-IOPC IN COM
               MOVE CAN-NUM-SOUT IN CAN      TO COM-NUM-SINI IN COM
               MOVE CAN-NUM-AOUT IN CAN      TO COM-NUM-AINI IN COM
               MOVE CAN-NUM-MOUT IN CAN      TO COM-NUM-MINI IN COM
               MOVE CAN-NUM-DOUT IN CAN      TO COM-NUM-DINI IN COM
               MOVE 'CMO'                    TO COM-IND-TTAS IN COM
               MOVE CAN-NUM-ICAN IN CAN      TO COM-NUM-ICAN IN COM
               MOVE CAN-CIC-IOPC IN CAN      TO COM-CIC-IOPV IN COM
               MOVE VEN-NUM-IVEN IN VEN      TO COM-NUM-IVCT IN COM
               MOVE ZEROES                   TO COM-FEC-FTRN IN COM
               MOVE ZEROES                   TO COM-HRA-HRTR IN COM
               MOVE SPACES                   TO COM-MSC-TACC IN COM
               MOVE SPACES                   TO COM-MSC-STAT IN COM
               MOVE SPACES                   TO COM-COD-OTRN IN COM
               MOVE SPACES                   TO COM-COD-ATRN IN COM
               MOVE SPACES                   TO COM-COD-TINT IN COM
               MOVE ZEROES                   TO COM-FEC-FTER IN COM
               MOVE ZEROES                   TO COM-SGV-SPRD IN COM
               MOVE ZEROES                   TO COM-SGV-TINT IN COM
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-COM
               GO TO FIN-ACT-COM.

           IF WSS-IND-HAYA IN WSS-VARI = 'S'
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-COM
               IF NOT FIO-STAT-OKS
                   GO TO FIN-ACT-COM
               ELSE
                   MOVE WSS-SGV-MIVA IN WSS-VARI TO COM-SGV-MIVA IN COM
                   MOVE WSS-SGV-NETO IN WSS-VARI TO COM-SGV-MNTO IN COM
                   MOVE FIO-MOD TO FIO-CMND
                   PERFORM COL-FIO-COM
                   GO TO FIN-ACT-COM.
       FIN-ACT-COM.
           EXIT.
      *ALD-BCI-INI/22.04.1999
       COPY TABBKTXC.
      *ALD-BCI-FIN/22.04.1999
      *>>>>
*% END
