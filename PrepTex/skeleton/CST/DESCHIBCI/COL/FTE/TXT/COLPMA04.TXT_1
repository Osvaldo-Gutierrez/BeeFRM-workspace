       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID. COLPMA04.
       AUTHOR. BEE (RRM).
       DATE-WRITTEN. 22-02-2019 15:05:08.
      * PROGRAMA TRADUCTOR
      *
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.
       DATA DIVISION.

       WORKING-STORAGE SECTION.
      *------------------------
       77 WSS-TAG-COLPMA04           PIC X(0125) VALUE
           '<IDNPGM NOM=$COLPMA04$ VSN=$01-00$ GEN=$16-01-2019$
      -    'TMS=$E01$ FNC=$1901_05$/>'.

       01  WSS-CTE.
           03 WNN-1                 VALUE  1             PIC 9(01).
           03 WCC-S                 VALUE 'S'            PIC X(01).
           03 WCC-X                 VALUE 'X'            PIC X(01).
           03 WCC-TR                VALUE 'TR'           PIC X(02).
           03 WCC-110               VALUE '110'          PIC X(03).
           03 WCC-729               VALUE '729'          PIC X(03).
           03 WCC-GNS               VALUE 'GNS'          PIC X(03).
           03 WCC-GIDD              VALUE 'GIDD'         PIC X(04).
           03 WCC-PT-A04            VALUE 'PT-A04'       PIC X(06).
           03 WCC-PO-A04            VALUE 'PO-A04'       PIC X(06).
           03 WCC-A04INP            VALUE 'A04INP'       PIC X(06).
           03 WCC-COLPPTPG          VALUE 'COLPPTPG'     PIC X(08).
           03 WCC-COLPMA04          VALUE 'COLPMA04'     PIC X(08).
           03 WCC-GNSPPIDD          VALUE 'GNSPPIDD'     PIC X(08).
           03 WNN-MAS3000           VALUE +3000    COMP PIC S9(04).
           03 WNN-MAS490            VALUE +490     COMP PIC S9(04).
           03 WNN-MAS1025           VALUE +1025    COMP PIC S9(04).
           03 WNN-MAS507            VALUE +507     COMP PIC S9(04).

       77  WSS-LOGPMA04        VALUE 'N'                 PIC X(01).

       01  WSS-QUE-TR-COLA VALUE SPACES.
           03 WSS-QUE-TR-COLA-02                         PIC X(02).
           03 WSS-QUE-TR-COLA-06                         PIC X(06).

       77  WSS-ITEM-SEGM      VALUE ZEROES            PIC 9(03).

       01  WSS-TR.
           03  WSS-TR-COD-SGMT                             PIC X(00001).
           03  WSS-TR-COD-DATA                             PIC X(01024).

       01  WTS-PO.
           03  WTS-PO-COD-SGMT                             PIC X(00001).
           03  WTS-PO-COD-DATA.
               05 WTS-PO-COD-DATA-03                       PIC X(00003).
               05 WTS-QUE-TR-COLA VALUE SPACES.
                  07 WTS-QUE-TR-COLA-02                    PIC X(00002).
                  07 WTS-QUE-TR-COLA-06                    PIC X(00006).
               05 WTS-PO-COD-DATA-DISP                     PIC X(00478).

       COPY GNSWGMCS.

       COPY GNSWGSEG.
       COPY GNSWGHOY.
       COPY GNSWGTSK.
       COPY GNSWGPFG.
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGSYS.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGQUE.
       COPY GNSWGFRM.
       COPY GNSWVSCR.
       COPY GNSWGMX1.
       COPY GNSWGRQA.
       COPY GNSBRTAB.
       COPY GNSWVIDD.
       COPY GNSBRMSG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGELS.
       COPY GNSWGUIB.

       COPY GNSWGAMB.
       COPY GNSWGCVT.
       COPY GNSWCSXI.
       COPY GNSWGMXX.
       COPY GNSWGFEC.
       COPY GNSWINVC.
       COPY TABWGRCC.

      *Formato Microservicio.
       COPY COLMWA04.

      *CMB,CON
       COPY COLMW110.

      *OPC,CON
       COPY COLMW729.


       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 FILLER                                  PIC X(3000).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================
       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.

           MOVE SPACES TO WSS-SND.

      * RECIBO IDENTIFICACION DEL PC QUE ENVIO EL MSG.

           MOVE DFHCOMMAREA(1:EIBCALEN) TO MCS-CMA-COD-SREQ.

           MOVE MCS-CMA-COD-PT-MCS      TO PT-A04.

           PERFORM GNS-ERR-QUE.

           PERFORM GET-FHOY.

           MOVE WCC-A04INP       TO QUE-COLA.
           MOVE QUE-DEL          TO QUE-CMND.
           PERFORM GNX-PRO-QUE.

           MOVE WCC-A04INP       TO QUE-COLA.
           MOVE QUE-PUT          TO QUE-CMND.
           MOVE WNN-MAS3000      TO QUE-LITM.
           MOVE MCS-CMA-COD-SREQ TO QUE-ITEM.
           PERFORM GNX-PRO-QUE.


           MOVE WCC-PT-A04       TO QUE-COLA.
           MOVE QUE-DEL          TO QUE-CMND.
           PERFORM GNX-PRO-QUE.

           MOVE WCC-PT-A04       TO QUE-COLA.
           MOVE QUE-PUT          TO QUE-CMND.
           MOVE WNN-MAS3000      TO QUE-LITM.
           MOVE PT-A04           TO QUE-ITEM.
           PERFORM GNX-PRO-QUE.

           PERFORM GET-TSK-TERM.

           PERFORM CRG-IDD.

           MOVE MCS-CMA-COD-COLA TO WSS-QUE-TR-COLA.
           MOVE WCC-TR           TO WSS-QUE-TR-COLA-02.

           MOVE WCC-GIDD       TO RCC-QUEU.
           MOVE TSK-TERM-ALF TO RCC-TERM.

           MOVE RCC-QIDD TO QUE-COLA.
           MOVE RCC-QIDD TO SCR-QIDD.
           MOVE WNN-MAS490     TO QUE-LITM.
           MOVE WNN-MAS490     TO SCR-LIDD.
           MOVE WNN-1    TO QUE-NITM.
           MOVE QUE-GET TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
                 MOVE RCC-QIDD   TO QUE-COLA
                 MOVE WNN-MAS490 TO QUE-LITM
                 MOVE IDD-REGI   TO QUE-ITEM
                 MOVE QUE-PUT    TO QUE-CMND
                 PERFORM GNS-PRO-QUE.

           PERFORM GNS-ERR-QUE.

           MOVE WSS-QUE-TR-COLA TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           MOVE SCR-NOM-TCPIP TO  WSS-PTR-GLS-COLA.

           MOVE SCR-NOM-TCPIP TO WSS-PTR-COD-TYPE.


           MOVE 'COL' TO TAB-COD-SIST.
           MOVE 'COL' TO FIO-SIST.
           MOVE 'VSN'      TO TAB-COD-TTAB IN TAB.
           MOVE 'LOGPMA04' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-MSC-STAT IN TAB TO WSS-LOGPMA04.

       FIN-CRG-SGS.

           PERFORM FORM-REQS.

       FIN-MAIN.

           EXEC CICS RETURN END-EXEC.
       EXT-MAIN.
           EXIT.


       FORM-REQS SECTION.
       INI-FORM-REQS.
           MOVE ZEROES TO WSS-ITEM-SEGM.

       CIC-FORM-REQS.

           ADD WNN-1 TO WSS-ITEM-SEGM.

      *Identifica consulta OPC
           IF PT-A04-01-OPC-CAI-IOPC > SPACES OR
              PT-A04-01-OPC-IIC-IOPC > ZEROES
                   GO TO TS-OPC-CON.


      * PUT-TR PARA TRADUCTOR

      *>>>>>>>>>>>>>>>>>>    110  CMB.CON INI  >>>>>>>>>>>>>>>>>>>>>>>>
           MOVE WCC-X TO WSS-TR-COD-SGMT.

           MOVE PT-A04-AHDR            TO PT-110-AHDR.

           MOVE WCC-110                TO PT-110-CREQ.

           MOVE PT-A04-01-FRM-COD-TIPO TO PT-110-01-FRM-COD-TIPO.
           MOVE PT-A04-01-FRM-NUM-EMIS TO PT-110-01-FRM-NUM-EMIS.
           MOVE PT-A04-01-FRM-VRF-EMIS TO PT-110-01-FRM-VRF-EMIS.
           MOVE PT-A04-01-FRM-IND-EMIS TO PT-110-01-FRM-IND-EMIS.
           MOVE PT-A04-01-FRM-GLS-EMIS TO PT-110-01-FRM-GLS-EMIS.
           MOVE PT-A04-01-FRM-NUM-BENF TO PT-110-01-FRM-NUM-BENF.
           MOVE PT-A04-01-FRM-VRF-BENF TO PT-110-01-FRM-VRF-BENF.
           MOVE PT-A04-01-FRM-IND-BENF TO PT-110-01-FRM-IND-BENF.
           MOVE PT-A04-01-FRM-GLS-BENF TO PT-110-01-FRM-GLS-BENF.
           MOVE PT-A04-01-FRM-COD-STAT TO PT-110-01-FRM-COD-STAT.
           MOVE PT-A04-01-CMB-COD-TOOC TO PT-110-01-OPC-COD-TOOC.
           MOVE PT-A04-01-CMB-COD-AOOC TO PT-110-01-OPC-COD-AOOC.
           MOVE PT-A04-01-DLC-IND-ESTA TO PT-110-01-DLC-IND-ESTA.
           MOVE PT-A04-01-DLC-IND-ETAP TO PT-110-01-DLC-IND-ETAP.
           MOVE PT-A04-01-FRM-COD-TFEC TO PT-110-01-FRM-COD-TFEC.
           MOVE PT-A04-01-FRM-FEC-FINI TO PT-110-01-FRM-FEC-FINI.
           MOVE PT-A04-01-FRM-FEC-FFIN TO PT-110-01-FRM-FEC-FFIN.
           MOVE PT-A04-01-FRM-COD-MONE TO PT-110-01-FRM-COD-MONE.
           MOVE PT-A04-01-FRM-COD-CNAL TO PT-110-01-FRM-COD-CNAL.
           MOVE PT-A04-01-FRM-IND-SGTE TO PT-110-01-FRM-IND-SGTE.
           MOVE PT-A04-01-FRM-CAI-IOPE TO PT-110-01-FRM-CAI-IOPE.
           MOVE PT-A04-01-FRM-IIC-IOPE TO PT-110-01-FRM-IIC-IOPE.

      *Graba TS: PT-110 (Consulta CMB)
           MOVE WSS-QUE-TR-COLA TO QUE-COLA.
           MOVE PT-110          TO WSS-TR-COD-DATA.
           MOVE WSS-TR          TO QUE-ITEM.
           MOVE WNN-MAS1025     TO QUE-LITM.
           MOVE QUE-PUT         TO QUE-CMND.
           PERFORM GNS-PRO-QUE.


      *Graba TS: Contexto para COLPOA04
           MOVE WCC-PO-A04      TO QUE-COLA.
           MOVE QUE-DEL         TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           MOVE SPACES          TO WTS-PO.
           MOVE WCC-PO-A04      TO QUE-COLA.
           MOVE WCC-X           TO WTS-PO-COD-SGMT.
           MOVE WCC-110         TO WTS-PO-COD-DATA-03.
           MOVE WSS-QUE-TR-COLA TO WTS-QUE-TR-COLA.
           MOVE WTS-PO          TO QUE-ITEM.
           MOVE WNN-MAS490      TO QUE-LITM.
           MOVE QUE-PUT         TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           GO TO FIN-FORM-REQS.

      *>>>>>>>>>>>>>>>>>>    729  OPC.CON INI  >>>>>>>>>>>>>>>>>>>>>>>>

       TS-OPC-CON.

           MOVE WCC-X TO WSS-TR-COD-SGMT.

           MOVE PT-A04-AHDR            TO PT-729-AHDR.

           MOVE WCC-729                TO PT-729-CREQ.

           MOVE PT-A04-01-OPC-CAI-IOPC TO PT-729-01-OPC-CAI-IOPC.
           MOVE PT-A04-01-OPC-IIC-IOPC TO PT-729-01-OPC-IIC-IOPC.

      *Graba TS: PT-729 (Consulta OPC)
           MOVE WSS-QUE-TR-COLA TO QUE-COLA.
           MOVE PT-729          TO WSS-TR-COD-DATA.
           MOVE WSS-TR          TO QUE-ITEM.
           MOVE WNN-MAS1025     TO QUE-LITM.
           MOVE QUE-PUT         TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

      *Graba TS: Contexto para COLPOA04
           MOVE WCC-PO-A04      TO QUE-COLA.
           MOVE QUE-DEL         TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           MOVE SPACES          TO WTS-PO.
           MOVE WCC-PO-A04      TO QUE-COLA.
           MOVE WCC-X           TO WTS-PO-COD-SGMT.
           MOVE WCC-729         TO WTS-PO-COD-DATA-03.
           MOVE WSS-QUE-TR-COLA TO WTS-QUE-TR-COLA.
           MOVE WTS-PO          TO QUE-ITEM.
           MOVE WNN-MAS490      TO QUE-LITM.
           MOVE QUE-PUT         TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

       CON-FORM-REQS-OPC.

       EXT-FORM-REQS-OPC.

      *>>>>>>>>>>>>>>>>>>    729  OPC.CON FIN  >>>>>>>>>>>>>>>>>>>>>>>>

       FIN-FORM-REQS.
           EXIT.


       COPY GNSBVNUM.
       COPY GNSBGHOY.
       COPY GNSBHSYS.
       COPY GNSBGSYS.
       COPY GNSBIABT.
       COPY GNSBGTSK.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY GNSBFMSG.
       COPY GNSBFTAB.
       COPY GNSBGDTC.
       COPY GNSBGMSG.
       COPY GNSBVTAB.
       COPY GNSBBTAB.
       COPY GNSBGEND.

      *Modulo Generico Manejo de TSs
       COPY GNSBGQUE.

       CRG-IDD SECTION.
       INI-CRG-IDD.

           MOVE WCC-GNS      TO SCR-SIST.
           MOVE WCC-COLPMA04 TO IDD-PROG FIO-PROG.
           MOVE IDD-VARI     TO SYS-CMMA.
           MOVE WNN-MAS507   TO SYS-TCMA.
           MOVE WCC-GNSPPIDD TO SYS-PROG.
           MOVE SYS-LINK     TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA     TO IDD-VARI.

       FIN-IDD-CRG.
           EXIT.

       GNX-PRO-QUE SECTION.
       INI-GNX-PRO-QUE.

           IF WSS-LOGPMA04 = WCC-S
                PERFORM GNS-PRO-QUE.

       FIN-GNX-PRO-QUE.
           EXIT.
