*%! Codigo Adicional
*% IF FIN_PUT_OIA_ABV
      *<<<< FIN_PUT_OIA_ABV
           MOVE WSS-CT-COL   TO TAB-COD-SIST.
           MOVE WSS-CT-ABV   TO TAB-COD-TTAB IN TAB.
           MOVE OIA-COD-OLIQ IN ABV-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = SPACES
              MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-TAUT IN ABV-FLD. 
      *>>>>
*% END 
*% IF INI_KEY_OIA_ABV
      *<<<< INI_KEY_OIA_ABV
           MOVE WSS-CT-ABV              TO OIA-COD-CPTO IN OIA.
      *>>>>
*% END 
*% IF INI_FST_FLD_ABV
      *<<<< INI_FST_FLD_ABV
           MOVE FRM-POS-CURS TO OIA-COD-OLIQ-LEN IN ABV-FLD.
           GO TO FIN-FST-FLD-ABV.
      *>>>>
*% END 
*% IF FIN_UNP_OIA_ABV
      *<<<< FIN_UNP_OIA_ABV
           MOVE FRM-CPIM-AEY TO OIA-FEC-FLIQ-ATR IN ABV-FLD.
           MOVE FRM-CPIM-AEY TO OIA-COD-UAPR-ATR IN ABV-FLD.
           MOVE FRM-CPIM-AEY TO OIA-FEC-FAPR-ATR IN ABV-FLD.
           MOVE FRM-CPIM-AEY TO OIA-HRA-HAPR-ATR IN ABV-FLD.
      *>>>>
*% END 
*% IF EOF_BQ
      *<<<< EOF_BQ
      *====================
       PUT-OPC-ALM SECTION.
       INI-PUT-OPC-ALM.
           MOVE OPC-COD-VCOC IN OPC TO FRM-COD-VCOC IN ABV-FLD.
           MOVE OPC-COD-TOOC IN OPC TO FRM-COD-TOOC IN ABV-FLD.
           MOVE OPC-COD-AOOC IN OPC TO FRM-COD-AOOC IN ABV-FLD.
           MOVE OPC-VAL-CRED IN OPC TO FRM-VAL-CRED IN ABV-FLD.
           MOVE OPC-NUM-DINP IN OPC TO OIA-NUM-DLIQ IN ABV-FLD.
           MOVE OPC-NUM-MINP IN OPC TO OIA-NUM-MLIQ IN ABV-FLD.
           MOVE OPC-NUM-SINP IN OPC TO OIA-NUM-SLIQ IN ABV-FLD.
           MOVE OPC-NUM-AINP IN OPC TO OIA-NUM-ALIQ IN ABV-FLD.
           
       FIN-PUT-OPC-ALM.
           EXIT.
      *====================
       SET-GLS-MONEDA SECTION.
       INI-SET-GLS-MONEDA.
           MOVE WSS-CT-TAB          TO TAB-COD-SIST.           
           MOVE WSS-CT-VLR          TO TAB-COD-TTAB IN TAB.    
           MOVE FRM-COD-VCOC IN ABV-FLD TO TAB-COD-CTAB IN TAB.    
           PERFORM VAL-COD.                                        
           IF MSG-COD-MENS = WSS-CT-CODNEX OR WSS-CT-CODNVG          
               MOVE MSG-GLS-DESC TO FRM-MENS                       
               MOVE FRM-SUAR-MAL TO FRM-SUAR                       
           ELSE                                                    
               MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-VCOC IN ABV-FLD
               MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-VCO2 IN ABV-FLD.
       FIN-SET-GLS-MONEDA.
           EXIT.
      *====================
       SET-GLS-TIO SECTION.
       INI-SET-GLS-TIO.
           MOVE WSS-CT-TAB              TO TAB-COD-SIST.           
           MOVE WSS-CT-TIO              TO TAB-COD-TTAB IN TAB.    
           MOVE FRM-COD-TOOC IN ABV-FLD TO TAB-COD-CTAB IN TAB.    
           PERFORM VAL-COD.                                        
           IF (MSG-COD-MENS = WSS-CT-CODNEX OR WSS-CT-CODNVG )  AND  
               FRM-COD-TOOC IN ABV-FLD > SPACES
               MOVE MSG-GLS-DESC TO FRM-MENS                       
               MOVE FRM-SUAR-MAL TO FRM-SUAR                       
           ELSE                                                    
               MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-TOOC IN ABV-FLD.
       FIN-SET-GLS-TIO.
           EXIT.
      *====================
       SET-GLS-AUX SECTION.
       INI-SET-GLS-AUX.
           MOVE WSS-CT-COL TO TAB-COD-SIST.                              
           MOVE WSS-CT-AUX TO TAB-COD-TTAB IN TAB.                       
           MOVE FRM-COD-TOOC IN ABV-FLD TO WSS-COD-TOOC IN WSS-VARI.
           MOVE FRM-COD-AOOC IN ABV-FLD TO WSS-COD-AOOC IN WSS-VARI.
           MOVE WSS-COD-CAUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.    
           PERFORM VAL-COD.                                         
           IF (MSG-COD-MENS = WSS-CT-CODNEX OR WSS-CT-CODNVG) AND  
               FRM-COD-AOOC IN ABV-FLD > SPACES                
               MOVE MSG-GLS-DESC TO FRM-MENS                       
               MOVE FRM-SUAR-MAL TO FRM-SUAR                       
           ELSE                                                    
               MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-AOOC IN ABV-FLD.

       FIN-SET-GLS-AUX.
           EXIT.
      *====================
       PUT-DBC-ALM SECTION.
       INI-PUT-DBC-ALM.
           MOVE SPACES TO RDC.
           MOVE SPACES TO DBC.
           
           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE WSS-CT-RDCKEY       TO FIO-AKEY.                
           MOVE FIO-GET-NLS         TO FIO-CMND.               
           PERFORM COL-FIO-RDC.                            
           IF NOT FIO-STAT-OKS AND 
              OPC-CIC-IOPC IN OPC = RDC-CIC-IOPC IN RDC
              GO TO FIN-PUT-DBC-ALM. 

           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
              GO TO FIN-PUT-DBC-ALM. 
           
           MOVE DBC-NUM-ICLI IN DBC TO FRM-NUM-ICLI IN ABV-FLD.
           MOVE DBC-VRF-ICLI IN DBC TO FRM-VRF-ICLI IN ABV-FLD.
           MOVE DBC-IND-ICLI IN DBC TO FRM-IND-ICLI IN ABV-FLD.
           MOVE DBC-GLS-ICLI IN DBC TO FRM-GLS-ICLI IN ABV-FLD.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
           PERFORM CPT-BLKS
           MOVE CPT-STRN            TO FRM-GLS-NOMC IN ABV-FLD.
           
       FIN-PUT-DBC-ALM.
           EXIT.
      *===================== 
       VAL-BACKVALUE SECTION.
       INI-VAL-BACKVALUE.
           MOVE WSS-CT-N    TO WSS-IND-DESC-INT.
           PERFORM OBT-CIC-MONE.
           IF MSG-COD-MENS > SPACES
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

           PERFORM VAL-PLAZO.
           
           IF FRM-VAL-PLZO IN ABV-FLD NOT > ZEROES
               MOVE WSS-CT-NODIFF  TO MSG-COD-MENS
               MOVE WSS-CT-COL     TO MSG-COD-SIST
               MOVE WSS-CT-N       TO WSS-IND-DESC-INT
               GO TO FIN-VAL-BACKVALUE.

           IF NOT (SCR-CMND = WSS-CT-ING OR 
                   SCR-CMND = WSS-CT-MOD OR
                   SCR-CMND = WSS-CT-ELI)
              MOVE WSS-CT-S   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
       
      *DESCARTA TIO-AUX QUE NO ESTEN EN TABLA CBV
           MOVE WSS-CT-COL          TO TAB-COD-SIST.
           MOVE WSS-CT-COL          TO FIO-SIST.
           MOVE 'CBV'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-COOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND
                    TAB-IND-VIGE  = WSS-CT-S )
               MOVE WSS-CT-NOCBV   TO MSG-COD-MENS
               MOVE WSS-CT-COL     TO MSG-COD-SIST
               MOVE WSS-CT-N       TO WSS-IND-DESC-INT
               GO TO FIN-VAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           MOVE TAB-GLS-DATA IN TAB TO WSS-BCK-AUX-CBV.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

      *VALIDA QUE NO SEAN PRORROGAS NI RENOVACIONES, ESTADO = LIQ
      *PRIMER VENCIMIENTO Y MONEDA PESO
           IF OPC-IND-RENO IN OPC = WSS-CT-PRO OR WSS-CT-REN
              MOVE WSS-CT-TRAREN  TO MSG-COD-MENS
              MOVE WSS-CT-COL     TO MSG-COD-SIST
              MOVE WSS-CT-N       TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
              
           IF OPC-MSC-STAT IN OPC  = WSS-CT-A
              MOVE WSS-CT-YAACA   TO MSG-COD-MENS
              MOVE WSS-CT-COL     TO MSG-COD-SIST
              MOVE WSS-CT-N       TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
              
           IF OPC-MSC-STAT IN OPC  NOT = WSS-CT-L AND
              OPC-MSC-STAT IN OPC  NOT = WSS-CT-J
              MOVE WSS-CT-LIQNO   TO MSG-COD-MENS
              MOVE WSS-CT-COL     TO MSG-COD-SIST
              MOVE WSS-CT-N       TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
              
           IF OPC-NUM-IVEN IN OPC  NOT = WSS-CT-1
              MOVE WSS-CT-OP1VEN  TO MSG-COD-MENS
              MOVE WSS-CT-COL     TO MSG-COD-SIST
              MOVE WSS-CT-N       TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *    IF OPC-COD-VCOC IN OPC  NOT = WSS-COD-PESO
      *       MOVE WSS-CT-OPNOPE  TO MSG-COD-MENS
      *       MOVE WSS-CT-COL     TO MSG-COD-SIST
      *       MOVE WSS-CT-N       TO WSS-IND-DESC-INT
      *       GO TO FIN-VAL-BACKVALUE.

      *VALIDA CREDITOS RENEGOCIADOS - BUSCA EN DESTINO
       VAL-RENEGOCIADO-DES.

           MOVE 'COL'             TO TAB-COD-SIST FIO-SIST.
           MOVE 'DES'             TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-CDOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              GO TO FIN-VAL-BACKVALUE.

           IF TAB-GLS-DATA IN TAB(17:1) = WSS-CT-S
               MOVE WSS-CT-N TO WSS-IND-DESC-INT
               GO TO FIN-VAL-BACKVALUE.

      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
              
              
      *DESCARTA OPERACIONES TASA VARIABLE 
           MOVE OPC-CAI-IOPC IN OPC TO ICG-CAI-IOPC IN ICG.
           MOVE OPC-IIC-IOPC IN OPC TO ICG-IIC-IOPC IN ICG.
           MOVE ZEROES              TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE WSS-CT-INT          TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF NOT ( FIO-STAT-OKS AND
                    ICG-CAI-IOPC IN ICG = OPC-CAI-IOPC IN OPC AND
                    ICG-IIC-IOPC IN ICG = OPC-IIC-IOPC IN OPC AND
                    ICG-NUM-ICAN IN ICG = ZEROES AND
                    ICG-CIC-IOPV IN ICG = SPACES AND
                    ICG-NUM-IVCT IN ICG = ZEROES AND
                    ICG-IND-TTAS IN ICG = WSS-CT-INT )
                    MOVE WSS-CT-N  TO WSS-IND-DESC-INT
                    GO TO FIN-VAL-BACKVALUE.
                    
      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *    IF ICG-COD-CVTI IN ICG > SPACES
      *       MOVE WSS-CT-OPTVAR  TO MSG-COD-MENS
      *       MOVE WSS-CT-COL     TO MSG-COD-SIST
      *       MOVE WSS-CT-N       TO WSS-IND-DESC-INT
      *       GO TO FIN-VAL-BACKVALUE.
           IF ICG-COD-CVTI IN ICG NOT > SPACES
              GO TO NO-TASA-VAR.

      * TASA VARIABLE (RESPECTO AL CURSE)
      *  -VALIDA QUE PERIORO DE RESPECTO TASA VARIABLE NO SEA MENOS AL
      *   PERIODO DEL PRIMER VENCIMIENTO
      *
      * DIFRENCIA DE DIAS ENTRE PRIMER VENCIMIENTO Y CURSE
      * LEE VEN PARA OBTENER PLAZO
           MOVE OPC-CAI-IOPC IN OPC   TO VEN-CAI-IOPC IN VEN.
           MOVE OPC-IIC-IOPC IN OPC   TO VEN-IIC-IOPC IN VEN.
           MOVE OPC-NUM-IVEN IN OPC   TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY           TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE VEN-NUM-DVEN IN VEN TO FEC-DEC2.
           MOVE VEN-NUM-MVEN IN VEN TO FEC-MEC2.
           MOVE VEN-NUM-SVEN IN VEN TO FEC-SEC2.
           MOVE VEN-NUM-AVEN IN VEN TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

           MOVE FEC-NDIA TO WSS-DIF-DVEN IN WSS-VARI.
      * DETERMINA EL PERIODO DE REPACTO EN DIAS PARA TASA
      * RESPECTO AL CURSE
           IF ICG-MSC-TFPR IN ICG = WSS-CT-C
              PERFORM ICG-PER-REPACTO-DIAS
              IF NOT FEC-STAT-OKS
                 MOVE WSS-CT-N   TO WSS-IND-DESC-INT
                 GO TO FIN-VAL-BACKVALUE
              ELSE
                 MOVE FEC-NDIA TO WSS-DIF-DICG IN WSS-VARI
                 IF WSS-DIF-DICG IN WSS-VARI < WSS-DIF-DVEN IN WSS-VARI
                    MOVE WSS-CT-N  TO WSS-IND-DESC-INT
                    GO TO FIN-VAL-BACKVALUE.

       NO-TASA-VAR.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
                             
      *VALIDA PLAZO
           PERFORM VAL-PLAZO.              
             
           MOVE WSS-CT-S TO WSS-IND-DESC-INT.

       FIN-VAL-BACKVALUE.
           EXIT.
      *-----------------------------------------------
      *-----------------------------------------------
       CAL-BACKVALUE SECTION.
       INI-CAL-BACKVALUE.
           IF WSS-IND-DESC-INT NOT = WSS-CT-S
              GO TO FIN-CAL-BACKVALUE.
       
           PERFORM GET-FHOY.
      *OBTENEMOS TASA PERIODO
           MOVE OPC-CIC-IOPC IN OPC         TO INT-IOPC
           MOVE OPC-COD-VCOC IN OPC         TO INT-VCAM.
           MOVE OPC-NUM-DCOL IN OPC         TO INT-DCOL.
           MOVE OPC-NUM-MCOL IN OPC         TO INT-MCOL.
           MOVE OPC-NUM-SCOL IN OPC         TO INT-SCOL.
           MOVE OPC-NUM-ACOL IN OPC         TO INT-ACOL.
           MOVE WSS-CT-1                    TO INT-IDLC.
           MOVE OPC-NUM-DCOL IN OPC         TO INT-DUNO
           MOVE OPC-NUM-MCOL IN OPC         TO INT-MUNO
           MOVE OPC-NUM-SCOL IN OPC         TO INT-SUNO
           MOVE OPC-NUM-ACOL IN OPC         TO INT-AUNO
           MOVE HOY-DHOY                    TO INT-DDOS
           MOVE HOY-MHOY                    TO INT-MDOS
           MOVE HOY-SHOY                    TO INT-SDOS
           MOVE HOY-AHOY                    TO INT-ADOS.
           MOVE HOY-DHOY                    TO INT-DBTV.
           MOVE HOY-MHOY                    TO INT-MBTV.
           MOVE HOY-SHOY                    TO INT-SBTV.
           MOVE HOY-AHOY                    TO INT-ABTV.
           
           IF OPC-MSC-STAT = WSS-CT-A
              MOVE OPC-NUM-DINP IN OPC TO INT-DDOS INT-DBTV
              MOVE OPC-NUM-MINP IN OPC TO INT-MDOS INT-MBTV
              MOVE OPC-NUM-SINP IN OPC TO INT-SDOS INT-SBTV
              MOVE OPC-NUM-AINP IN OPC TO INT-ADOS INT-ABTV.

           IF OPC-MSC-STAT NOT = WSS-CT-A AND
               WSS-IND-ABV-ING = WSS-CT-S
              MOVE OIA-NUM-DAPR IN OIA TO INT-DDOS INT-DBTV
              MOVE OIA-NUM-MAPR IN OIA TO INT-MDOS INT-MBTV
              MOVE OIA-NUM-SAPR IN OIA TO INT-SDOS INT-SBTV
              MOVE OIA-NUM-AAPR IN OIA TO INT-ADOS INT-ABTV.

           PERFORM COL-CAL-INT.
           IF INT-CMSG > SPACES
              MOVE INT-CMSG    TO MSG-COD-MENS
              MOVE WSS-CT-COL  TO MSG-COD-SIST
              MOVE WSS-CT-N    TO WSS-IND-DESC-INT 
              GO TO FIN-CAL-BACKVALUE.
           

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *    MULTIPLY INT-TIPE BY OPC-VAL-CRED IN OPC
      *             GIVING WSS-SGV-VINT.
      *    MOVE WSS-SGV-VINT TO PES-SGV-DECI IN PES-VARI.
      *    PERFORM PES-SCTV.
      *    MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-VINT.
           MULTIPLY INT-TIPE BY OPC-VAL-CRED IN OPC
                    GIVING WSS-SGV-VINT.

           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO
              MOVE WSS-SGV-VINT TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-VINT.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           
      *VALIDA QUE DIFERENCIA DE INTERESES NO SEA MAYOR A INT 1ER VEN
           MOVE OPC-CAI-IOPC IN OPC       TO VEN-CAI-IOPC IN VEN.
           MOVE OPC-IIC-IOPC IN OPC       TO VEN-IIC-IOPC IN VEN.
           MOVE WSS-CT-1                  TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY               TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
              MOVE WSS-CT-N      TO WSS-IND-DESC-INT 
              MOVE WSS-CT-NO1VEN TO MSG-COD-MENS
              MOVE WSS-CT-COL    TO MSG-COD-SIST
              GO TO FIN-CAL-BACKVALUE.
           
           COMPUTE WSS-VAL-INT1 =   VEN-VAL-FINA IN VEN
                                  - VEN-VAL-CAPI IN VEN.
                                  
           IF WSS-SGV-VINT > WSS-VAL-INT1
              MOVE WSS-CT-DIN1VN  TO MSG-COD-MENS
              MOVE WSS-CT-COL     TO MSG-COD-SIST
              MOVE WSS-CT-N       TO WSS-IND-DESC-INT 
              GO TO FIN-CAL-BACKVALUE.

           
           MOVE WSS-SGV-VINT TO FRM-VAL-DINT IN ABV-FLD.
       FIN-CAL-BACKVALUE.
           EXIT.
      *--------------------------------------------------------------
      *--------------------------------------------------------------
       OBT-CIC-MONE SECTION.
       INI-OBT-CIC-MONE.
           MOVE SPACES                TO TAB-COD-CTAB IN TAB.
           MOVE WSS-CT-TAB            TO FIO-SIST.
           MOVE WSS-CT-VLR            TO TAB-CIC-TTAB IN TAB.
           MOVE WSS-CT-0999           TO TAB-CIC-CTAB IN TAB.
           MOVE WSS-CT-TABAKEY        TO FIO-AKEY.
           MOVE FIO-GET-KEY           TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT  FIO-STAT-OKS
              MOVE WSS-CT-CICPESO TO MSG-COD-MENS
              MOVE WSS-CT-COL     TO MSG-COD-SIST
              GO TO FIN-OBT-CIC-MONE.
              
           MOVE TAB-COD-CTAB IN TAB   TO WSS-COD-PESO IN WSS-VARI.
       FIN-OBT-CIC-MONE.
           EXIT.
      *--------------------------------------------------------------
      *--------------------------------------------------------------
       VAL-PLAZO SECTION.
       INI-VAL-PLAZO.
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           PERFORM GET-FHOY.
           MOVE HOY-DHOY TO FEC-DEC2.
           MOVE HOY-MHOY TO FEC-MEC2.
           MOVE HOY-SHOY TO FEC-SEC2.
           MOVE HOY-AHOY TO FEC-AEC2.
           
           IF NOT (SCR-CMND = WSS-CT-ING OR 
                   SCR-CMND = WSS-CT-MOD OR
                   SCR-CMND = WSS-CT-ELI) AND
                   OPC-MSC-STAT = WSS-CT-A
              
              MOVE OPC-NUM-DINP IN OPC TO FEC-DEC2
              MOVE OPC-NUM-MINP IN OPC TO FEC-MEC2
              MOVE OPC-NUM-SINP IN OPC TO FEC-SEC2
              MOVE OPC-NUM-AINP IN OPC TO FEC-AEC2.
              
           IF NOT (SCR-CMND = WSS-CT-ING OR
                   SCR-CMND = WSS-CT-MOD OR
                   SCR-CMND = WSS-CT-ELI) AND
                   OPC-MSC-STAT NOT = WSS-CT-A AND
                   WSS-IND-ABV-ING = WSS-CT-S
              MOVE OIA-NUM-DAPR IN OIA TO FEC-DEC2
              MOVE OIA-NUM-MAPR IN OIA TO FEC-MEC2
              MOVE OIA-NUM-SAPR IN OIA TO FEC-SEC2
              MOVE OIA-NUM-AAPR IN OIA TO FEC-AEC2.

           
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS        
              MOVE WSS-CT-DIFDIA  TO MSG-COD-MENS
              MOVE WSS-CT-COL     TO MSG-COD-SIST
              MOVE WSS-CT-N       TO WSS-IND-DESC-INT
              GO TO FIN-VAL-PLAZO.
              
      *PONE PLAZO EN PANTALLA
            MOVE FEC-NDIA TO FRM-VAL-PLZO IN ABV-FLD.
       FIN-VAL-PLAZO.
           EXIT.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       ICG-PER-REPACTO-DIAS SECTION.
       INI-ICG-PER-REPACTO-DIAS.
           MOVE OPC-NUM-DCOL IN OPC TO FEC-ITM1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-ITM2.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-ITM3.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-ITM4.

           IF ICG-MSC-UTPR IN ICG = WSS-CT-D
               MOVE FEC-SUM-DIA  TO FEC-CMND
               MOVE ICG-NUM-PREP IN ICG TO FEC-NDIA
           ELSE
           IF ICG-MSC-UTPR IN ICG = WSS-CT-M
               MOVE FEC-SUM-MES TO FEC-CMND
               MOVE ICG-NUM-PREP IN ICG TO FEC-NMES
           ELSE
           IF ICG-MSC-UTPR IN ICG = WSS-CT-A
               MOVE FEC-SUM-ANO TO FEC-CMND
               MOVE ICG-NUM-PREP IN ICG TO FEC-NANO.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           PERFORM CAL-FEC.

      *OBTENEMOS LA DIFERENCIA EN DIAS
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE FEC-ITM1 TO FEC-DEC2.
           MOVE FEC-ITM2 TO FEC-MEC2.
           MOVE FEC-ITM3 TO FEC-SEC2.
           MOVE FEC-ITM4 TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.

       FIN-ICG-PER-REPACTO-DIAS.
           EXIT.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

      *>>>>
*% END 
*% IF INI_FRM_GLS_ICLI
      *<<<< INI_FRM_GLS_ICLI
           GO TO FIN-VAL-FRM-GLS-ICLI.
      *>>>>
*% END 
*% IF FIN_OIA_FEC_FLIQ
      *<<<< FIN_OIA_FEC_FLIQ
           IF SCR-CMND = WSS-CT-MOD AND
              OIA-FEC-FLIQ IN ABV-FLD > ZEROES
              PERFORM GET-FHOY
              MOVE HOY-DHOY TO OIA-NUM-DLIQ IN ABV-FLD
              MOVE HOY-MHOY TO OIA-NUM-MLIQ IN ABV-FLD
              MOVE HOY-SHOY TO OIA-NUM-SLIQ IN ABV-FLD
              MOVE HOY-AHOY TO OIA-NUM-ALIQ IN ABV-FLD
              PERFORM CAL-BACKVALUE
              IF MSG-COD-MENS > SPACES
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO FRM-MENS
                 MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>>
*% END 
*% IF OIA_COD_OLIQ
      *<<<< OIA_COD_OLIQ
           MOVE WSS-CT-COL   TO TAB-COD-SIST.
           MOVE WSS-CT-ABV   TO TAB-COD-TTAB IN TAB.
           MOVE OIA-COD-OLIQ IN ABV-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS NOT = SPACES
              GO TO FIN-VAL-OIA-COD-OLIQ.
              
           MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-TAUT IN ABV-FLD. 
      *>>>>
*% END 
*% IF OIA_COD_UAPR
      *<<<< OIA_COD_UAPR
           IF OIA-COD-UAPR IN ABV-FLD NOT > SPACES
              MOVE SCR-USER TO OIA-COD-UAPR IN ABV-FLD.
      *>>>>
*% END 
*% IF FIN_OIA_FEC_FAPR
      *<<<< FIN_OIA_FEC_FAPR
           IF SCR-CMND = WSS-CT-ING OR WSS-CT-MOD
              PERFORM GET-FHOY
              MOVE HOY-DHOY IN HOY-VARI TO OIA-NUM-DAPR IN ABV-FLD
              MOVE HOY-MHOY IN HOY-VARI TO OIA-NUM-MAPR IN ABV-FLD
              MOVE HOY-SHOY IN HOY-VARI TO OIA-NUM-SAPR IN ABV-FLD
              MOVE HOY-AHOY IN HOY-VARI TO OIA-NUM-AAPR IN ABV-FLD
              MOVE HOY-HHOY IN HOY-VARI TO OIA-HRA-HAPR IN ABV-FLD.
      *>>>>
*% END 
*% IF EOF_BU
      *<<<< EOF_BU
      *-----------------------------------------------
      *-----------------------------------------------
       CAL-BACKVALUE SECTION.
       INI-CAL-BACKVALUE.
           MOVE OIA-CAI-IOPC IN ABV-FLD TO OPC-CAI-IOPC IN OPC
           MOVE OIA-IIC-IOPC IN ABV-FLD TO OPC-IIC-IOPC IN OPC
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
              MOVE WSS-CT-COL      TO MSG-COD-SIST
              MOVE WSS-CT-OPCNEX   TO MSG-COD-MENS
              GO TO FIN-CAL-BACKVALUE.
              
      *OBTENEMOS TASA PERIODO
           PERFORM GET-FHOY.
           MOVE OPC-CIC-IOPC IN OPC         TO INT-IOPC
           MOVE OPC-COD-VCOC IN OPC         TO INT-VCAM.
           MOVE OPC-NUM-DCOL IN OPC         TO INT-DCOL.
           MOVE OPC-NUM-MCOL IN OPC         TO INT-MCOL.
           MOVE OPC-NUM-SCOL IN OPC         TO INT-SCOL.
           MOVE OPC-NUM-ACOL IN OPC         TO INT-ACOL.
           MOVE WSS-CT-1                    TO INT-IDLC.
           MOVE OPC-NUM-DCOL IN OPC         TO INT-DUNO
           MOVE OPC-NUM-MCOL IN OPC         TO INT-MUNO
           MOVE OPC-NUM-SCOL IN OPC         TO INT-SUNO
           MOVE OPC-NUM-ACOL IN OPC         TO INT-AUNO
           MOVE HOY-DHOY                    TO INT-DDOS
           MOVE HOY-MHOY                    TO INT-MDOS
           MOVE HOY-SHOY                    TO INT-SDOS
           MOVE HOY-AHOY                    TO INT-ADOS.
           MOVE HOY-DHOY                    TO INT-DBTV.
           MOVE HOY-MHOY                    TO INT-MBTV.
           MOVE HOY-SHOY                    TO INT-SBTV.
           MOVE HOY-AHOY                    TO INT-ABTV.

           PERFORM COL-CAL-INT.
           IF INT-CMSG > SPACES
              MOVE INT-CMSG    TO MSG-COD-MENS
              MOVE WSS-CT-COL  TO MSG-COD-SIST
              GO TO FIN-CAL-BACKVALUE.
           
           MULTIPLY INT-TIPE BY OPC-VAL-CRED IN OPC
                    GIVING WSS-SGV-VINT.
           MOVE WSS-SGV-VINT TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-VINT.
           
      *VALIDA QUE DIFERENCIA DE INTERESES NO SEA MAYOR A INT 1ER VEN
           MOVE OPC-CAI-IOPC IN OPC       TO VEN-CAI-IOPC IN VEN.
           MOVE OPC-IIC-IOPC IN OPC       TO VEN-IIC-IOPC IN VEN.
           MOVE WSS-CT-1                  TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY               TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
              MOVE WSS-CT-NO1VEN  TO MSG-COD-MENS
              MOVE WSS-CT-COL     TO MSG-COD-SIST
              GO TO FIN-CAL-BACKVALUE.
              
           COMPUTE WSS-VAL-INT1 =   VEN-VAL-FINA IN VEN
                                  - VEN-VAL-CAPI IN VEN.
                                  
           IF WSS-SGV-VINT > WSS-VAL-INT1
              MOVE WSS-CT-DIN1VN  TO MSG-COD-MENS
              MOVE WSS-CT-COL     TO MSG-COD-SIST
              GO TO FIN-CAL-BACKVALUE.
           
           MOVE WSS-SGV-VINT TO FRM-VAL-DINT IN ABV-FLD.
       FIN-CAL-BACKVALUE.
           EXIT.
      *>>>>
*% END 
