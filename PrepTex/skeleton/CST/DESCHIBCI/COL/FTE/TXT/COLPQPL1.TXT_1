*%! Codigo adicional para archivo
*% PGM_PTC = TRUE
*% LARGO_TOTAL_COMMAREA = 1869  
*% IF CMT_ID
      *-----------------------------------------------------------------
      *MODIFICACIONES:
      *--------------
      * PROYECTO : BACKVALUE - CURSES RETROACTIVOS
      * OBJETIVO : DESCUENTA INTERESES PARA DIFERENCIA FECHAS(LIQ - ACT)
      *            EN PRIMER VENCIMIENTO
      * RESPONSABLE : CIMA-OGB
      * ETIQUETA : OGB-INI 01-JUL-2016 BACKVALUE 
      *----------------------------------------------------------------*
      * PROYECTO : BACKVALUE - UF Y TASA VARIABLE
      * NUB      : 53614
      * OBJETIVO : PERMITIR CORRECCION DE BACKVALUE PARA UF Y TASA VAR
      * RESPONSABLE : CIMA-OGB
      * ETIQUETA : OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *----------------------------------------------------------------*
*% END
*% IF MI_COMMAREA
      *<<<< MI_COMMAREA
           03 SCR-FRM-OPE                   PIC X(01).
           03 SCR-NUM-PANT                  PIC 9(02).
           03 CNE-ITR-COD-TINT              PIC X(12).
           03 SCR-PL1-FLD                   PIC X(1761).
           03 SCR-GLS-VEXP                  PIC X(10).
           03 SCR-VAL-CRED-ALF              PIC X(15).
           03 SCR-VAL-INTE-ALF              PIC X(14).
           03 SCR-VAL-VCOM-ALF              PIC X(15).
           03 SCR-VAL-GAST-ALF              PIC X(15).
           03 SCR-VAL-IMPU-ALF              PIC X(14).
           03 SCR-GLS-TINT                  PIC X(25).
      *PVG INI 18-JUN-2003
           03 SCR-MSC-FCAN                  PIC X(01).
           03 SCR-MSC-ECAN                  PIC X(01).
           03 SCR-SGV-INTN                  PIC S9(11)V9(04).
      *PVG FIN 18-JUN-2003

      *PVG INI 18-JUN-2003
       01  CAN-FLD.
           03  CAN-CAI-IOPC                            PIC X(04).
           03  CAN-IIC-IOPC                            PIC X(08).
           03  CAN-NUM-ICAN                            PIC 9(03).
           03  CAN-COD-OFCA                            PIC X(03).
           03  CAN-FEC-FCAN                            PIC X(08).
           03  CAN-SGV-TPAG                            PIC 9(11)V9(04).
           03  CAN-SGV-TREN                            PIC 9(11)V9(04).
           03  CAN-SGV-COMI                            PIC S9(11)V9(04).
           03  COM-SGV-TINT                            PIC S9(03)V9(04).
           03  DBC-NUM-ICLI                            PIC X(08).
      *PVG FIN 18-JUN-2003
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       01 WSS-DEBUG.
          03 WSS-DEBUG-1   VALUE ZEROES  PIC 9(11)V9(04).
          03 WSS-DEBUG-2   VALUE SPACES  PIC X(40).

      ***************************************************************
       01  DATOS-PVG.
           03 PVG-VALOR     PIC S9(11)V9(04).
           03 PVG-VALOR-ALF PIC X(20).
           03 PVG-VALOR-EDT REDEFINES
              PVG-VALOR-ALF PIC ---.---.---.---,----.
           03 PVG-NUM      PIC 9(03).
           03 PVG-COLA.
              05 PVG-GLOSA  PIC X(20).
              05 PVG-SEGURO PIC X(06).
              05 PVG-VAL-Q  PIC X(20).
              05 PVG-FILLER VALUE SPACES PIC X(01).
              05 PVG-CUOTA  PIC 9(03).
      ***************************************************************
      *******
       01  WSS-INI-DSP    VALUE 'INI-DSP' PIC X(07).
       01  WSS-MSG-DSP    VALUE SPACES    PIC X(20).
       01  WSS-FIN-DSP    VALUE 'FIN-DSP' PIC X(07).
      *MHM-INI 29-ENE-2004
      * 77  FRM-POS-CURS                COMP PIC S9(04) VALUE -1.
      *77  FRM-IND-ERRO                COMP PIC S9(04) VALUE -1.
      *77  FRM-ERR-NUME                COMP PIC S9(04) VALUE -9.
      * 77  FRM-RST-PCUR                COMP PIC S9(04) VALUE ZEROES.
      *MHM-INI 29-ENE-2004
       COPY GNSWGTSK.
       COPY COLMXW05.
       COPY GNSBRMSC.
       COPY GNSWGPES.
       COPY COLWGINT.
       COPY COLWGVEN.
      *isp-ini  11-MAR-2003
      *COPY COLWGVCD.
      * COPY COLWGVIN.
      *isp-fin  11-MAR-2003
DSP   *COPY COLWGSDP.
      *isp-ini  11-MAR-2003
      * COPY COLWVRDC.
      * COPY COLWVRCV.
      *isp-fin  11-MAR-2003
      *<<<< WSS_IBM
      *    EXEC SQL INCLUDE COLBRCOM END-EXEC.
       COPY COLBRCOM.
      *    EXEC SQL INCLUDE SGCBRDBC END-EXEC.
       COPY SGCBRDBC.
      *    EXEC SQL INCLUDE COLBRVEN END-EXEC.
       COPY COLBRVEN.
      *    EXEC SQL INCLUDE COLBRVEN END-EXEC.
       COPY COLBRCCT.
      *    EXEC SQL INCLUDE COLBRCCT END-EXEC.
      *isp-ini  11-MAR-2003
      *COPY COLBRPIP.
      *isp-fin  11-MAR-2003
      *    EXEC SQL INCLUDE COLBRDLC END-EXEC.
       COPY COLBRDLC.
      *    EXEC SQL INCLUDE COLBRRDC END-EXEC.
       COPY COLBRRDC.
      *    EXEC SQL INCLUDE COLBREVC END-EXEC.
       COPY COLBREVC.
      *    EXEC SQL INCLUDE COLBRICG END-EXEC.
       COPY COLBRICG.
      *    EXEC SQL INCLUDE COLBRITR END-EXEC.
       COPY COLBRITR.
      *    EXEC SQL INCLUDE COLBRRCV END-EXEC.
       COPY COLBRRCV.

       COPY TABBRCAM.
       COPY TABBROFI.
       COPY COLBRTOC.
      *PVG INI 18-JUN-2003
       COPY COLBRPCP.
       COPY COLWGPCP.
      *PVG FIN 18-JUN-2003
       COPY COLBRCXA.
       COPY COLBRRCC.
       COPY TABWGRCC.
       COPY GNSWGCVT.

      *LOP-INI 20-01-2004 CREDITO SIN MORA
       COPY COLWGCXE.
      *LOP-FIN 20-01-2004 CREDITO SIN MORA
      *MHM-INI 06-AGO-2004
       COPY COLWGUVD.
       COPY TABWGSGS.
       COPY TABBRROC.
       COPY TABBRSGS.
       COPY COLBRCXE.
       COPY SGCBRDCP.
       COPY COLBRPVC.
      *MHM-FIN 06-AGO-2004
      *JSS-IBM
       COPY GNSWGCPT.
       COPY GNSWGSTR.
      *COPY GNSWGPDB.
       01   WSS-VARI.
            03  WSS-CAM-SGV-VCAM                   PIC S9(06)V9(09).
            03  WSS-GLS-COCR.
                05 WSS-GLS-TOCR                          PIC X(05).
                05 WSS-GLS-FILL             VALUE SPACES PIC X(01).
                05 WSS-GLS-AOCR                          PIC X(05).
            03  WSS-VAL-TPES                             PIC 9(11).
            03  WSS-CON-VEN                              PIC 9(04).
            03  WSS-GLS-NULL                             PIC X(30).
            03  WSS-IND-VCCR                VALUE SPACES PIC X(02).
                 88  MONEDA-NO-VIGENTE      VALUE 'N '.
                 88  MONEDA-NO-EXISTENTE    VALUE ' X'.
                 88  MONEDA-NEX-NVG         VALUE 'NX'.
            03  WSS-IND-VCCR-RED REDEFINES WSS-IND-VCCR.
                 05  WSS-IND-NVIG                        PIC X(01).
                 05  WSS-IND-NEXI                        PIC X(01).
            03  WSS-I                                    PIC 9(04).
            03  WSS-IMAX                    VALUE 9      PIC 9(04).
            03  WSS-IVEN-MAS1               VALUE 0      PIC 9(03).
            03  WSS-NITM                    VALUE 0      PIC 9(03).
      *MHM-INI 06-AGO-2004
            03  WSS-FEC-FVNA.
                05 WSS-NUM-SVNA                          PIC 9(02).
                05 WSS-NUM-AVNA                          PIC 9(02).
                05 WSS-NUM-MVNA                          PIC 9(02).
                05 WSS-NUM-DVNA                          PIC 9(02).
            03  WSS-FEC-FVEN.
                05 WSS-NUM-SVEN                          PIC 9(02).
                05 WSS-NUM-AVEN                          PIC 9(02).
                05 WSS-NUM-MVEN                          PIC 9(02).
                05 WSS-NUM-DVEN                          PIC 9(02).
            03  WSS-NUM-IVCT       VALUE ZEROES          PIC 9(03).
            03  WSS-VAL-CAPI       VALUE ZEROES    PIC 9(11)V9(04).
            03  WSS-CIC-SEGD       VALUE SPACES          PIC X(12).
      *MHM-FIN 06-AGO-2004
      *HZF INI-13101993
            03  WSS-CIC-LET                              PIC X(12).
                88  ES-LETRA                VALUE 'LTR'.
      *PVG INI 18-JUN-2003
           03  WSS-VAL-COMI                            PIC S9(11)V9(4).
           03  WSS-SGV-CACU     VALUE ZEROES           PIC S9(11)V9(4).
           03  WSS-VAL-SMO7                            PIC S9(11)V9(4).
           03  WSS-VAL-SMO8                            PIC S9(11)V9(4).
           03  WSS-VAL-SMO9                            PIC S9(11)V9(4).
           03  WSS-VAL-SM10                            PIC S9(11)V9(4).
           03  WSS-VAL-SVEN                            PIC S9(11)V9(4).
           03  WSS-OPEC         VALUE SPACES           PIC X(01).
      *PVG FIN 18-JUN-2003
      *OGB-INI 01-JUL-2016 BACKVALUE
           03  WSS-COD-PESO                       PIC X(06).
           03  WSS-IND-DESC-INT    VALUE SPACES   PIC X(01).
           03  WSS-IND-TAUT        VALUE SPACES   PIC X(03).
           03  WSS-SGV-VINT        VALUE ZEROES   PIC S9(11)V9(4).
           03  WSS-VAL-INT1        VALUE ZEROES   PIC S9(11)V9(4).
           03  WSS-GLS-PLZBV.
               05 WSS-NUM-PMIN                    PIC 9(03).
               05 FILLER                          PIC X(02).
               05 WSS-NUM-PMAX                    PIC 9(03).
           03  WSS-GLS-MTOBV.
               05 WSS-NUM-MMNM                    PIC 9(11).
               05 FILLER                          PIC X(09).
               05 WSS-NUM-MMAX                    PIC 9(11).

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           03  WSS-NUM-NDIA           VALUE ZEROES    PIC 9(05).
           03  WSS-IND-NPER           VALUE SPACES    PIC X(01).
           03  WSS-NUM-NPER           VALUE ZEROES    PIC 9(05).
           
           03  WSS-DIF-DVEN           VALUE ZEROES    PIC 9(04).
           03  WSS-DIF-DICG           VALUE ZEROES    PIC 9(04).
           03  WSS-BCK-AUX-CBV.
               05 WSS-BCK-IND-MTO                     PIC X(01).
               05 WSS-BCK-IND-PZO                     PIC X(01).
               05 FILLER                              PIC X(01).
               05 WSS-BCK-COD-VCMT                    PIC X(06).
               05 WSS-BCK-SGV-MMIN                    PIC 9(11)V9(4).
               05 FILLER                              PIC X(01).
               05 WSS-BCK-SGV-MMAX                    PIC 9(11)V9(4).
               05 FILLER                              PIC X(04).
               05 WSS-BCK-NUM-PMIN                    PIC 9(05).
               05 FILLER                              PIC X(01).
               05 WSS-BCK-IND-PMIN                    PIC X(01).
               05 FILLER                              PIC X(02).
               05 WSS-BCK-NUM-PMAX                    PIC 9(05).
               05 FILLER                              PIC X(01).
               05 WSS-BCK-IND-PMAX                    PIC X(01).

           03  WSS-COD-MTBV.
               05 WSS-COD-MTOBV   VALUE 'MTOBV'       PIC X(05).
               05 WSS-COD-MNDBV                       PIC X(06).
               05 FILLER          VALUE SPACES        PIC X(01).

           03  WSS-GLS-LMMT.
               05 WSS-SGV-LMMT-MMIN                   PIC 9(11)V9(4).
               05 FILLER                              PIC X(05).
               05 WSS-SGV-LMMT-MMAX                   PIC 9(11)V9(4).

           03  WSS-GLS-VAL-AUX              PIC  ZZ.ZZZ.ZZZ.ZZ9,9999.
              
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

               
           03  WSS-CT-1       VALUE 1             PIC 9(01).
           03  WSS-CT-N       VALUE 'N'           PIC X(01).
           03  WSS-CT-S       VALUE 'S'           PIC X(01).
           03  WSS-CT-A       VALUE 'A'           PIC X(01).
           03  WSS-CT-L       VALUE 'L'           PIC X(01).
           03  WSS-CT-COL     VALUE 'COL'         PIC X(03).
           03  WSS-CT-TAB     VALUE 'TAB'         PIC X(03).
           03  WSS-CT-VSN     VALUE 'VSN'         PIC X(03).
           03  WSS-CT-VLR     VALUE 'VLR'         PIC X(03).
           03  WSS-CT-ABV     VALUE 'ABV'         PIC X(03).
           03  WSS-CT-CBV     VALUE 'CBV'         PIC X(03).
           03  WSS-CT-DIN     VALUE 'DIN'         PIC X(03).
           03  WSS-CT-CIN     VALUE 'CIN'         PIC X(03).
           03  WSS-CT-PRO     VALUE 'PRO'         PIC X(03).
           03  WSS-CT-REN     VALUE 'REN'         PIC X(03).
           03  WSS-CT-INT     VALUE 'INT'         PIC X(03).
           03  WSS-CT-0999    VALUE '0999'        PIC X(04).
           03  WSS-CT-TABAKEY VALUE 'TAB-CIC-TABL' PIC X(12).
           03  WSS-CT-CICPESO VALUE 'CICPESONEX  ' PIC X(12).
           03  WSS-CT-NDIABV  VALUE 'NDIA > PMAX ' PIC X(12).
           03  WSS-CT-NODLC   VALUE 'OPC  NODLC  ' PIC X(12).
           03  WSS-CT-PVINX   VALUE 'VEN    PVINX' PIC X(12).
           03  WSS-CT-DESINT  VALUE 'DESCINT>MMAX' PIC X(12).
           03  WSS-CT-DIN1VN  VALUE 'DINT>INT1VEN' PIC X(12).
      *OGB-FIN 01-JUL-2016 BACKVALUE 
      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           03  WSS-CT-CAMNEX  VALUE 'CAM    NEX'   PIC X(10).
           03  WSS-CT-2       VALUE 2             PIC 9(01).
           03  WSS-CT-D       VALUE 'D'           PIC X(01).
           03  WSS-CT-M       VALUE 'M'           PIC X(01).
           03  WSS-CT-C       VALUE 'C'           PIC X(01).
           03  WSS-CT-1PT0    VALUE '1.0'         PIC X(03).
           03  WSS-CT-VEN     VALUE 'VEN'         PIC X(03).
           03  WSS-CT-BCK     VALUE 'BCK'         PIC X(03).
           03  WSS-CT-ANT     VALUE 'ANT'         PIC X(03).
           03  WSS-CT-DES     VALUE 'DES'         PIC X(03).
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

       COPY COLWGPL1.
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CCT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PIP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VLR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
      *PVG INI 18-JUN-2003
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PCP-REQA==.
      *PVG FIN 18-JUN-2003
      *MHM-INI 06-AGO-2004
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-SGS-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CXE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CXA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCC-REQA==.
      *MHM-FIN 06-AGO-2004
      *OGB-INI 01-JUL-2016 BACKVALUE
       COPY COLBROIA.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OIA-REQA==.
      *OGB-FIN 01-JUL-2016 BACKVALUE
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
      *     MOVE 'PASO-00' TO WSS-MSG-DSP.
      *     PERFORM GNS-ERR-QUE.
           MOVE +1900 TO SCR-TCMA.
           PERFORM GNS-ERR-QUE.
           PERFORM GET-TSK-TERM.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE SPACES TO FRM-MENS.
           MOVE SPACES TO PL1-GLS-MENS IN PL1-FLD.
           IF SCR-OFRM-SRV
               MOVE TSK-TERM-ALF TO WSS-PL1-TERM-ALF
           ELSE
               MOVE EIBTRMID     TO WSS-PL1-TERM-ALF.
      *PTC ini
           PERFORM GNS-ERR-QUE.
      *PTC fin
      *>>>>
*% END
*% IF INI_SCR_COM
      *<<<< INI_SCR_COM
           MOVE WSS-PL1-TERM-ALF TO QUE-TERM
           MOVE 'GPLA'   TO QUE-TYPE.
           MOVE QUE-DEL  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
      *>>>>
*% END
*% IF PFS_SCR_ACC
      *<<<< PFS_SCR_ACC
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6
               PERFORM VAL-NUM-KEY-PL1
               PERFORM VAL-NUM-FLD-PL1
               PERFORM SCRL-TAB-PLA
               PERFORM SCR-TRL.
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
       LUP-OPC.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
           IF NOT FIO-STAT-OKS
               MOVE 'OPCIDLCNORDC' TO MSG-COD-MENS IN MSG
               GO TO MSG-FND-KEY.
           IF OPC-LIQUIDADA OR OPC-ACTIVADA
              NEXT SENTENCE
           ELSE
               MOVE 'S' TO SCR-IERR
               MOVE 'OPCSTATINVAL' TO MSG-COD-MENS IN MSG
               GO TO MSG-FND-KEY.
      *--------------  TASA DE OPERACION  ---------------------------*
           MOVE OPC-CIC-IOPC IN OPC TO ITR-CIC-IOPC IN ITR.
           MOVE ZEROES              TO ITR-NUM-ICAN IN ITR.
           MOVE SPACES              TO ITR-CIC-IOPV IN ITR.
           MOVE ZEROES              TO ITR-NUM-IVCT IN ITR.
           MOVE 'INT'               TO ITR-IND-TTAS IN ITR.
           MOVE ZEROES              TO ITR-FEC-FINI IN ITR.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ITR.
           IF FIO-STAT-OKS AND
              ITR-CIC-IOPC IN ITR = OPC-CIC-IOPC IN OPC AND
              ITR-NUM-ICAN IN ITR = ZEROES              AND
              ITR-CIC-IOPV IN ITR = SPACES              AND
              ITR-NUM-IVCT IN ITR = ZEROES              AND
              ITR-IND-TTAS IN ITR = 'INT'
               IF ITR-COD-CVTI IN ITR > SPACES
                   MOVE ITR-SGV-SPRD IN ITR TO ITR-SGV-TINT IN ITR
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE '23' TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-ITR.
           IF FIO-STAT-OKS AND ITR-COD-CVTI IN ITR > SPACES
               MOVE 'I'                 TO CAM-MSC-TVAL IN CAM(1)
               MOVE ITR-COD-CVTI IN ITR TO CAM-COD-CVAL IN CAM(1)
               MOVE ITR-MSC-PBTI IN ITR TO CAM-COD-TCAM IN CAM(1)
               MOVE OPC-FEC-FCOL IN OPC  TO CAM-FEC-FCAM IN CAM(1)
               MOVE OPC-FEC-FCOL IN OPC  TO CAM-FEC-FCAM IN CAM(2)
               MOVE OPC-COD-VCOC IN OPC  TO CAM-COD-VCAM IN CAM(2)
               MOVE FIO-GET-KEY          TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF FIO-STAT-OKS
                   ADD CAM-SGV-VCAM IN CAM TO ITR-SGV-TINT IN ITR.
      *--------------  EJECUTO FIO-RDC  -----------------------------*
           MOVE OPC-CAI-IOPC IN OPC     TO RDC-CAI-IOPC IN RDC.
           MOVE OPC-IIC-IOPC IN OPC     TO RDC-IIC-IOPC IN RDC.
           MOVE ZEROES                  TO RDC-NUM-IDLC IN RDC.
      *-------------- INICIO INCORPORADO 08-06-1993 ------------
      * DSP COMPATIBILIDAD VSAM-DTC PERFORM COL-SEQ-RDC-IDLC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RDC.
      * DSP COMPATIBILIDAD VSAM-DTC
           IF FIO-STAT-OKS AND
              (OPC-CAI-IOPC IN OPC = RDC-CAI-IOPC IN RDC) AND
              (OPC-IIC-IOPC IN OPC = RDC-IIC-IOPC IN RDC) AND
              (RDC-NUM-IDLC IN RDC = ZEROES)
               NEXT SENTENCE
           ELSE
               MOVE '23' TO FIO-STAT.
      *-------------- FIN INCORPORADO 08-06-1993 ------------
           IF FIO-STAT-OKS AND
              (OPC-CAI-IOPC IN OPC = RDC-CAI-IOPC IN RDC) AND
              (OPC-IIC-IOPC IN OPC = RDC-IIC-IOPC IN RDC) AND
              (RDC-NUM-IDLC IN RDC = ZEROES)
      * ISP
      *       MOVE RDC-IIC-ICLI IN RDC  TO DBC-IIC-ICLI IN DBC
              MOVE RDC-CIC-ICLI IN RDC  TO DBC-CIC-ICLI IN DBC
              MOVE FIO-GET-KEY          TO FIO-CMND
              PERFORM SGC-FIO-DBC
              IF FIO-STAT-OKS
                  NEXT SENTENCE
              ELSE
                  MOVE 'CLI    NEX' TO MSG-COD-MENS
                  GO TO MSG-FND-KEY
           ELSE
               MOVE 'CLI    NODIR' TO MSG-COD-MENS
               GO TO MSG-FND-KEY.
           PERFORM BUS-CIC-OPEC.
      *MHM-INI 19-AGO-2004
           PERFORM BUS-CIC-SEGD.
      *MHM-FIN 19-AGO-2004
      *--------------  EJECUTO FIO-DLC  -----------------------------*
           PERFORM LEE-DLC.
           IF MSG-COD-MENS > SPACES
                GO TO MSG-FND-KEY.

      *LOP-INI 20-01-2004 CREDITO SIN MORA
           IF SCR-CMND = 'CSM'
              PERFORM BUS-EVC-VA
              IF MSG-COD-MENS > SPACES
                 GO TO MSG-FND-KEY
              ELSE
                 PERFORM CRE-SIN-MORA
                 IF MSG-COD-MENS > SPACES
                    GO TO MSG-FND-KEY.
      *LOP-FIN 20-01-2004 CREDITO SIN MORA

           PERFORM PUT-PLA.

      *LOP-INI 20-01-2004 CREDITO SIN MORA
      *    PERFORM PUT-TAB.
           IF SCR-CMND NOT = 'CSM'
              PERFORM PUT-TAB
           ELSE
              PERFORM PUT-SIN-MORA.
      *LOP-FIN 20-01-2004 CREDITO SIN MORA

           MOVE '00' TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-OPC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
           MOVE SCR-STAT-CON TO SCR-STAT.
           GO TO FIN-FND-KEY.
      *----------------------------------------------------------
       MSG-FND-KEY.
           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE '00' TO FIO-STAT.
           MOVE SCR-STAT-CON TO SCR-STAT.
           GO TO FIN-FND-KEY.
      *>>>>
*% END
*% IF SCR_GKEY_VAL_IKY
      *<<<< SCR_GKEY_VAL_IKY
      *PTC-INI:   12-NOV-1996 08:50:01
           IF SCR-OFRM-SRV

              MOVE PTC-OPC-TYPE TO QUE-TYPE
              MOVE WSS-PL1-TERM-ALF TO QUE-TERM
              MOVE PTC-OPC-LENG TO QUE-LITM
              MOVE 1            TO  QUE-NITM
              MOVE QUE-GET      TO QUE-CMND
              PERFORM GNS-PRO-QUE
              IF QUE-STAT = QUE-STAT-OKS
                  MOVE QUE-ITEM TO PTC-OPC-ITEM
                  MOVE PTC-OPC-OPC-CAI-IOPC TO OPC-CAI-IOPC IN PL1-FLD
                  MOVE PTC-OPC-OPC-IIC-IOPC TO OPC-IIC-IOPC IN PL1-FLD.
      *PTC-FIN:   12-NOV-1996 08:50:01
      *>>>>
*% END
*% IF PFS_GET_CON
      *<<<< PFS_GET_CON
           IF NOT ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 )
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      *MHM-INI 06-AGO-2004
       COPY COLBGSGS.
       COPY COLBGUVD.
       COPY TABBGSGS.
       COPY COLBFCXE.
       COPY TABBFROC.
       COPY TABBFSGS.
       COPY SGCBFDCP.
       COPY GNSBBMSC.
       COPY COLBFPVC.
      *MHM-FIN 06-AGO-2004
      *<<<< EOF
       LEE-DLC SECTION.
       INI-LEE-DLC.
           MOVE OPC-CAI-IOPC IN OPC     TO DLC-CAI-IOPC IN DLC.
           MOVE OPC-IIC-IOPC IN OPC     TO DLC-IIC-IOPC IN DLC.
           MOVE ZEROES                  TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT ( FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = DLC-CIC-IOPC IN DLC )
                MOVE 'DLCIDLCNEX' TO MSG-COD-MENS
                GO TO FIN-LEE-DLC.
           MOVE 'TAB' TO FIO-SIST.
           MOVE 'DOC' TO TAB-COD-TTAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           MOVE DLC-COD-TDOC IN DLC TO TAB-COD-CTAB
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE SPACES      TO  TAB-CIC-CTAB
                                    WSS-CIC-LET
           ELSE
               MOVE TAB-CIC-CTAB TO WSS-CIC-LET.
       FIN-LEE-DLC.
           EXIT.
      *ALD-BNL
      *COPY GNSBVMSC.
       COPY GNSBFMSC.
      *COPY GNSBVIDC.
      *COPY GNSBPVRF.
      *COPY GNSBPNUM.
       PUT-TAB SECTION.
       INI-PUT-TAB.
      *JSS
           MOVE WSS-PL1-TERM-ALF TO QUE-TERM
           MOVE 'GPLA'   TO QUE-TYPE.
           MOVE QUE-DEL  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           ADD 1 OPC-NUM-IVEN IN OPC GIVING WSS-IVEN-MAS1.
      *isp-ini  11-MAR-2003
      *     MOVE 1 TO FRM-NUM-PANT.
           MOVE 1 TO SCR-NUM-PANT.
      *isp-FIN  11-MAR-2003
           MOVE LOW-VALUES TO PL1-WSS-NUM-IVCT-IDX.
           MOVE ZEROES TO
                 PL1-WSS-NUM-IVCT
                 PL1-WSS-VAL-INTC
                 PL1-WSS-VAL-SCAP
                 PL1-WSS-VAL-TOTA.

           PERFORM GET-FHOY.
      *
           MOVE 1 TO FRM-IFLD.
      *HZF INI-11101993
           MOVE ZEROES  TO VEN-NUM-IVEN IN VEN.
           MOVE 1 TO WSS-CON-VEN.
      *HZF FIN-11101993
           MOVE OPC-CIC-IOPC TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-NLS  TO FIO-CMND.
       LUP-PUT-TAB.
           IF OPC-IND-VSTR IN OPC = 'N'
              PERFORM COL-FIO-VEN
              IF FIO-STAT-OKS AND
                 OPC-CIC-IOPC = VEN-CIC-IOPC IN VEN
      *HZF INI-11101993
      *          PERFORM PUT-TAB-PLA
                 PERFORM VAL-DLC-LET
                 IF (DLC-MSC-STAT IN DLC = 'R' OR 'C')
                    NEXT SENTENCE
                 ELSE
                    PERFORM PUT-TAB-PLA
                    PERFORM PUT-PLA-QUE
                    ADD 1 TO WSS-CON-VEN
                    ADD 1 TO FRM-IFLD
      *HZF FIN-11101993
              ELSE
                    MOVE '00' TO FIO-STAT
                    GO TO FIN-PUT-TAB
           ELSE
              MOVE HOY-DHOY TO VEN-DTBS
              MOVE HOY-MHOY TO VEN-MTBS
              MOVE HOY-SHOY TO VEN-STBS
              MOVE HOY-AHOY TO VEN-ATBS
              MOVE 'S'      TO VEN-KEST
              PERFORM COL-OBT-VEN
              MOVE VEN-STAT TO WSS-DEBUG-2
              PERFORM GNS-ERR-QUE
              IF VEN-STAT-OKS AND
                 OPC-CIC-IOPC = VEN-CIC-IOPC IN VEN
      *HZF INI-11101993
      *          PERFORM PUT-TAB-PLA
                 PERFORM VAL-DLC-LET
                 IF (DLC-MSC-STAT IN DLC = 'R' OR 'C')
                    NEXT SENTENCE
                 ELSE
                    PERFORM PUT-TAB-PLA
                    PERFORM PUT-PLA-QUE
                    ADD 1 TO WSS-CON-VEN
                    ADD 1 TO FRM-IFLD
      *HZF FIN-11101993
              ELSE
                    MOVE '00' TO FIO-STAT
                    GO TO FIN-PUT-TAB.
           MOVE FIO-GET-NXT  TO FIO-CMND.
           IF WSS-CON-VEN NOT < WSS-IVEN-MAS1
                MOVE 'N' TO VEN-INIT
                GO TO LUP-PUT-TAB
           ELSE
              GO TO LUP-PUT-TAB.
       FIN-PUT-TAB.
           IF WSS-NITM > WSS-IMAX
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'PLAVENDMAS' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.
       EXT-PUT-TAB.
           EXIT.
      *HZF INI-11101993
       VAL-DLC-LET SECTION.
       INI-VAL-DLC-LET.
           IF NOT ES-LETRA
                GO TO FIN-VAL-DLC-LET.
           MOVE VEN-CIC-IOPC IN VEN TO DLC-CIC-IOPC IN DLC.
           MOVE VEN-NUM-IDLC IN VEN TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
                  MOVE 'PLADLCNOEXI' TO MSG-COD-MENS
                  GO TO FIN-VAL-DLC-LET.
       FIN-VAL-DLC-LET.
           EXIT.
      *HZF FIN-11101993
      *--------------------------------------------
       SCRL-TAB-PLA SECTION.
       INI-SCRL-TAB-PLA.
           MOVE SPACES TO MSG-COD-MENS.
           IF FRM-FFLD = FRM-FFLD-PF6
               PERFORM PUT-TAB-ASC
           ELSE
               PERFORM PUT-TAB-DSC.
           IF MSG-COD-MENS > SPACES
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.
       FIN-SCRL-TAB-PLA.
           EXIT.

       PUT-TAB-ASC SECTION.
       INI-PUT-TAB-ASC.
           MOVE SPACES TO MSG-COD-MENS.
      *isp-ini  11-MAR-2003
      *     MULTIPLY FRM-NUM-PANT BY WSS-IMAX GIVING QUE-NITM.
           MULTIPLY SCR-NUM-PANT BY WSS-IMAX GIVING QUE-NITM.
      *isp-fin  11-MAR-2003
           MOVE 0 TO FRM-IFLD.
       LUP-PUT-TAB-ASC.
           ADD 1                 TO QUE-NITM.
           MOVE WSS-PL1-TERM-ALF TO QUE-TERM.
           MOVE 'GPLA'           TO QUE-TYPE.
           MOVE PL1-WSS-LENG     TO QUE-LITM.
           MOVE QUE-GET          TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               IF FRM-IFLD = 0
                   MOVE 'PLAVENNONXT' TO MSG-COD-MENS
                   GO TO FIN-PUT-TAB-ASC
               ELSE
                   GO TO FIN-PUT-TAB-ASC.
           ADD 1 TO FRM-IFLD.
           MOVE QUE-ITEM TO FRM-NUM-IVCT-IDX(FRM-IFLD).
           IF FRM-IFLD < WSS-IMAX
               GO TO LUP-PUT-TAB-ASC.
       FIN-PUT-TAB-ASC.
           IF FRM-IFLD > 0 AND FRM-IFLD < WSS-IMAX
               ADD 1 FRM-IFLD GIVING WSS-I
               PERFORM CLR-FRM VARYING WSS-I FROM WSS-I BY 1
                                 UNTIL WSS-I > WSS-IMAX.
           IF FRM-IFLD > 0
      *isp-ini  11-MAR-2003
      *         ADD 1 TO FRM-NUM-PANT.
               ADD 1 TO SCR-NUM-PANT.
      *isp-fin  11-MAR-2003
           IF FRM-IFLD = WSS-IMAX
               ADD 1         TO QUE-NITM

               MOVE WSS-PL1-TERM-ALF TO QUE-TERM
               MOVE 'GPLA'   TO QUE-TYPE
               MOVE PL1-WSS-LENG TO QUE-LITM
               MOVE QUE-GET  TO QUE-CMND
               PERFORM GNS-PRO-QUE
               IF QUE-STAT = QUE-STAT-OKS
                   MOVE 'PLAVENDMAS' TO MSG-COD-MENS.
       EXT-PUT-TAB-ASC.
           EXIT.

       PUT-TAB-DSC SECTION.
       INI-PUT-TAB-DSC.
           MOVE SPACES TO MSG-COD-MENS.
      *isp-ini  11-MAR-2003
      *     IF FRM-NUM-PANT = 1
           IF SCR-NUM-PANT = 1
      *isp-fin  11-MAR-2003
               MOVE 'PLAVENNOPRV' TO MSG-COD-MENS
               GO TO EXT-PUT-TAB-DSC.
      *isp-ini  11-MAR-2003
      *     SUBTRACT 1 FROM FRM-NUM-PANT GIVING QUE-NITM.
           SUBTRACT 1 FROM SCR-NUM-PANT GIVING QUE-NITM.
      *isp-fin  11-MAR-2003
           MULTIPLY QUE-NITM BY WSS-IMAX GIVING QUE-NITM.
           ADD 1 TO QUE-NITM.
           ADD 1 WSS-IMAX GIVING FRM-IFLD.
       LUP-PUT-TAB-DSC.
           SUBTRACT  1 FROM QUE-NITM.

           MOVE WSS-PL1-TERM-ALF TO QUE-TERM.
           MOVE 'GPLA'   TO QUE-TYPE.
           MOVE PL1-WSS-LENG TO QUE-LITM.
           MOVE QUE-GET  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               IF FRM-IFLD > WSS-IMAX
                   MOVE 'PLAVENNOPRV' TO MSG-COD-MENS
                   GO TO FIN-PUT-TAB-DSC
               ELSE
                   GO TO FIN-PUT-TAB-DSC.
           SUBTRACT 1 FROM FRM-IFLD.
           MOVE QUE-ITEM TO FRM-NUM-IVCT-IDX(FRM-IFLD).
           IF FRM-IFLD > 1
               GO TO LUP-PUT-TAB-DSC.
       FIN-PUT-TAB-DSC.
           IF FRM-IFLD NOT > WSS-IMAX AND FRM-IFLD > 1
               SUBTRACT 1 FROM FRM-IFLD GIVING WSS-I
               PERFORM CLR-FRM VARYING WSS-I FROM WSS-I BY -1
                                 UNTIL WSS-I < 1.
           IF FRM-IFLD NOT > WSS-IMAX
      *isp-ini  11-MAR-2003
      *         SUBTRACT 1 FROM FRM-NUM-PANT
               SUBTRACT 1 FROM SCR-NUM-PANT
      *isp-fin  11-MAR-2003
               MOVE 'PLAVENDMAS' TO MSG-COD-MENS.
       EXT-PUT-TAB-DSC.
           EXIT.
      *--------------------------------------------
       PUT-TAB-PLA SECTION.
       INI-PUT-TAB-PLA.

           MOVE VEN-NUM-IVCT IN VEN TO PL1-WSS-NUM-IVCT.
           MOVE VEN-NUM-DVEN IN VEN TO PL1-WSS-NUM-DVEN.
           MOVE VEN-NUM-MVEN IN VEN TO PL1-WSS-NUM-MVEN.
           MOVE VEN-NUM-SVEN IN VEN TO PL1-WSS-NUM-SVEN.
           MOVE VEN-NUM-AVEN IN VEN TO PL1-WSS-NUM-AVEN.
           MOVE VEN-VAL-CAPI IN VEN TO PL1-WSS-VAL-SCAP.
           MOVE VEN-VAL-FINA IN VEN TO PL1-WSS-VAL-TOTA.
           COMPUTE PL1-WSS-VAL-INTC =
              PL1-WSS-VAL-TOTA -
              PL1-WSS-VAL-SCAP.

      *OGB-INI 01-JUL-2016 BACKVALUE 
           PERFORM VAL-BACKVALUE.
           IF WSS-IND-DESC-INT = WSS-CT-S AND
              OPC-NUM-IVEN IN OPC NOT > 1
              PERFORM CAL-BACKVALUE
              SUBTRACT WSS-SGV-VINT FROM PL1-WSS-VAL-INTC
              SUBTRACT WSS-SGV-VINT FROM PL1-WSS-VAL-TOTA.
      *OGB-FIN 01-JUL-2016 BACKVALUE  

           MOVE ZEROES              TO WSS-VAL-COMI IN WSS-VARI.
           IF VEN-NUM-IVCT IN VEN = 1 AND OPC-NUM-VCOR IN OPC = 1
              PERFORM OBT-COM-DUMMY
              PERFORM OBT-IMP-DUMMY.
      *MHM-INI 06-AGO-2004
           IF WSS-CIC-SEGD IN WSS-VARI NOT = 'SGSSISPRECIO'
               GO TO CNT-SGS-PRC.
      *PVG INI 11-NOV-2004
           IF VEN-NUM-IVCT IN VEN = 1 AND OPC-NUM-VCOR IN OPC = 1
              MOVE VEN-FEC-FVEN IN VEN TO WSS-FEC-FVEN IN WSS-VARI
              MOVE VEN-NUM-IVCT IN VEN TO WSS-NUM-IVCT IN WSS-VARI
              MOVE OPC-VAL-CRED IN OPC TO OSG-OPC-VAL-SCRE
              MOVE ZEROES              TO WSS-VAL-CAPI IN WSS-VARI
              PERFORM OBT-SEG
              GO TO CNT-SGS-PRC.
      *PVG FIN 11-NOV-2004
           IF VEN-NUM-IVCT IN VEN = 1
              MOVE VEN-FEC-FVEN IN VEN TO WSS-FEC-FVEN IN WSS-VARI
              MOVE VEN-NUM-IVCT IN VEN TO WSS-NUM-IVCT IN WSS-VARI
              MOVE VEN-VAL-CAPI IN VEN TO WSS-VAL-CAPI IN WSS-VARI
           ELSE
      *PVG INI 04-MAY-2005
      *        MOVE VEN-VAL-CAPI IN VEN TO OSG-VAL-CAPI
      *PVG FIN 04-MAY-2005
              PERFORM OBT-SEG
              MOVE VEN-FEC-FVEN IN VEN TO WSS-FEC-FVEN IN WSS-VARI
              MOVE VEN-NUM-IVCT IN VEN TO WSS-NUM-IVCT IN WSS-VARI.
       CNT-SGS-PRC.
      *MHM-FIN 06-AGO-2004
           IF FRM-IFLD NOT > WSS-IMAX
               MOVE PL1-WSS-NUM-IVCT-IDX TO FRM-NUM-IVCT-IDX(FRM-IFLD).
       FIN-PUT-TAB-PLA.
           EXIT.
      *----------------------------------------------------
       PUT-PLA-QUE SECTION.
       INI-PUT-PLA-QUE.
           ADD 1 TO WSS-NITM.
           MOVE WSS-PL1-TERM-ALF TO QUE-TERM
           MOVE 'GPLA'   TO QUE-TYPE.
           MOVE WSS-NITM TO QUE-NITM.
           MOVE PL1-WSS-NUM-IVCT-IDX TO QUE-ITEM.
           MOVE PL1-WSS-LENG TO QUE-LITM.
           MOVE QUE-PUT  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
      *Esta cola se graba solo una vez al principio al recorrer todas
      *las cuotas del credito. Entonces aprovecho para calcular el
      *interes directamente desde el VEN
      *isp-ini  11-MAR-2003
            ADD PL1-WSS-VAL-INTC TO FRM-VAL-INTE IN PL1-FLD.
      *isp-FIN  11-MAR-2003
       FIN-PUT-PLA-QUE.
           EXIT.
      *----------------------------------------------------
       PUT-PLA SECTION.
       INI-PUT-PLA.
      *isp-ini  11-MAR-2003
      *     IF OPC-COD-OFOC IN OPC > SPACES
      *         MOVE OPC-COD-OFOC IN OPC TO OFI-COD-OFIC IN OFI
      *         PERFORM BUS-OFI
      *         MOVE OFI-GLS-DESC IN OFI TO FRM-GLS-OFIC IN PL1-FLD
      *     ELSE
      *         MOVE SPACES              TO FRM-GLS-OFIC IN PL1-FLD.
      *isp-FIN  11-MAR-2003
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO DBC-GLS-NOMC IN PL1-FLD.
           IF OPC-COD-VCOC IN OPC > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'VLR' TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-VEXP IN PL1-FLD
           ELSE
               MOVE SPACES              TO FRM-GLS-VEXP IN PL1-FLD.
           MOVE 'TVAL' TO MSC-CIC-TMSC IN MSC.
           MOVE '0'    TO MSC-CIC-CMSC IN MSC.
           MOVE 'TAB' TO FIO-SIST.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO MSC-COD-CMSC IN MSC.
           MOVE 1 TO CAM-SGV-VCAM IN CAM.
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB.
           MOVE '0999  '       TO TAB-CIC-CTAB.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO TAB-COD-CTAB IN TAB.
           IF TAB-COD-CTAB  NOT   = OPC-COD-VCOC IN OPC AND
              MSC-COD-CMSC IN MSC = OPC-MSC-TVOC IN OPC
               MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-VEXP IN PL1-FLD
               MOVE OPC-NUM-DCOL IN OPC TO CAM-NUM-DCAM IN CAM(1)
               MOVE OPC-NUM-MCOL IN OPC TO CAM-NUM-MCAM IN CAM(1)
               MOVE OPC-NUM-SCOL IN OPC TO CAM-NUM-SCAM IN CAM(1)
               MOVE OPC-NUM-ACOL IN OPC TO CAM-NUM-ACAM IN CAM(1)
               MOVE OPC-NUM-DCOL IN OPC TO CAM-NUM-DCAM IN CAM(2)
               MOVE OPC-NUM-MCOL IN OPC TO CAM-NUM-MCAM IN CAM(2)
               MOVE OPC-NUM-SCOL IN OPC TO CAM-NUM-SCAM IN CAM(2)
               MOVE OPC-NUM-ACOL IN OPC TO CAM-NUM-ACAM IN CAM(2)
               MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
               MOVE TAB-COD-CTAB IN TAB TO CAM-COD-VCAM IN CAM(2)
               MOVE FIO-GET-KEY  TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT FIO-STAT-OKS
                   MOVE 1 TO CAM-SGV-VCAM IN CAM.
           MOVE CAM-SGV-VCAM IN CAM TO WSS-CAM-SGV-VCAM IN WSS-VARI.
           MOVE OPC-NUM-DCOL IN OPC TO OPC-NUM-DCOL IN PL1-FLD.
           MOVE OPC-NUM-MCOL IN OPC TO OPC-NUM-MCOL IN PL1-FLD.
           MOVE OPC-NUM-SCOL IN OPC TO OPC-NUM-SCOL IN PL1-FLD.
           MOVE OPC-NUM-ACOL IN OPC TO OPC-NUM-ACOL IN PL1-FLD.
           MULTIPLY OPC-VAL-CRED IN OPC BY WSS-CAM-SGV-VCAM IN
                       WSS-VARI GIVING FRM-VAL-CRED IN PL1-FLD.
           MOVE OPC-COD-VCOC IN OPC     TO PES-COD-VCAM IN PES-VARI.
           MOVE FRM-VAL-CRED IN PL1-FLD TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV
           MOVE PES-SGV-ENTE IN PES-VARI TO FRM-VAL-CRED IN PL1-FLD.
           MOVE ZEROES              TO FRM-VAL-INTE IN PL1-FLD.
           PERFORM OBT-IMP-GNOT.
           PERFORM OBT-PORTES.
      *isp-ini  11-MAR-2003
      *     MOVE OPC-VAL-GAST IN OPC TO OPC-VAL-GAST IN PL1-FLD.
           MOVE OPC-VAL-GAST IN OPC TO FRM-VAL-GAST IN PL1-FLD.
      *     MOVE OPC-SGV-VCOM IN OPC TO OPC-SGV-VCOM IN PL1-FLD.
           MOVE OPC-SGV-VCOM IN OPC TO FRM-VAL-VCOM IN PL1-FLD.
      *isp-fin  11-MAR-2003
           MOVE OPC-VAL-SEGD IN OPC TO OPC-VAL-SEGD IN PL1-FLD.
      *MHM-INI 27-SEP-2004
           ADD OPC-VAL-SEGC IN OPC TO OPC-VAL-SEGD IN PL1-FLD.
      *MHM-FIN 27-SEP-2004
           MOVE OPC-SGV-LIQU IN OPC TO OPC-SGV-LIQU IN PL1-FLD.
      *    MOVE OPC-CIC-IOPC IN OPC TO OPC-CIC-IOPC IN PL1-FLD.
      * ISP
      *    MOVE ZEROES TO OPC-VAL-SEGD IN PL1-FLD.
      *    MOVE 'COL' TO TAB-COD-SIST FIO-SIST.
      *    MOVE 'SDP' TO TAB-COD-TTAB IN TAB.
      *    MOVE OPC-COD-SEGP IN OPC TO TAB-COD-CTAB IN TAB.
      *    MOVE FIO-GET-KEY TO FIO-CMND.
      *    PERFORM GNS-FIO-TAB.
      *    IF FIO-STAT-OKS
      *        MOVE TAB-CIC-CTAB IN TAB TO VCD-CIC-CTAB IN VCD-VARI
      *        IF VCD-CIC-FLVC IN VCD-VARI NOT = 'VCD'
      *            PERFORM PRO-CAL-SEGP
      *            IF SDP-COD-MENS IN SDP-VARI NOT > SPACES
      *                MOVE SDP-VAL-SEGP IN SDP-VARI TO
      *                     FRM-VAL-SEGP IN PL1-FLD.
      *    MULTIPLY FRM-VAL-SEGP IN PL1-FLD BY WSS-CAM-SGV-VCAM
      *               IN WSS-VARI GIVING FRM-VAL-SEGP IN PL1-FLD.
      *    MOVE FRM-VAL-SEGP IN PL1-FLD TO PES-SGV-DECI IN PES-VARI.
      *    PERFORM PES-SCTV
      *    MOVE PES-SGV-ENTE IN PES-VARI TO FRM-VAL-SEGP IN PL1-FLD.
      *PVG INI 18-JUN-2003
      *    PERFORM CAL-COM-VEN.
      *PVG FIN 18-JUN-2003
       FIN-PUT-PLA.
           EXIT.
      *----------------------------------------------------
       OBT-IMP-GNOT SECTION.
       INI-OBT-IMP-GNOT.
           MOVE ZEROES TO FRM-VAL-GAST IN PL1-FLD.
           MOVE ZEROES TO FRM-VAL-IMPU IN PL1-FLD.
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = DLC-CIC-IOPC IN DLC )
               GO TO FIN-OBT-IMP-GNOT.
       LUP-OBT-IMP-GNOT.
           ADD DLC-VAL-GNOT IN DLC TO FRM-VAL-GAST IN PL1-FLD.
           ADD DLC-VAL-IMPU IN DLC TO FRM-VAL-IMPU IN PL1-FLD.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = DLC-CIC-IOPC IN DLC
               GO TO LUP-OBT-IMP-GNOT.
       FIN-OBT-IMP-GNOT.
           EXIT.
       OBT-PORTES SECTION.
       INI-OBT-PORTES.
           MOVE OPC-CIC-IOPC IN OPC      TO ICG-CIC-IOPC IN ICG.
           MOVE ZEROES                   TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES                   TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES                   TO ICG-NUM-IVCT IN ICG.
           MOVE 'GASPCU'                 TO ICG-IND-TTAS IN ICG.
           MOVE OPC-FEC-FCOL IN OPC      TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF  FIO-STAT-OKS
               ADD ICG-SGV-MNTO IN ICG   TO FRM-VAL-GAST IN PL1-FLD.
       FIN-OBT-PORTES.
           EXIT.
      *HZF-INI 14-05-97
       OBT-COM-DUMMY SECTION.
       INI-OBT-COM-DUMMY.
           MOVE OPC-CIC-IOPC IN OPC      TO ICG-CIC-IOPC IN ICG.
           MOVE ZEROES                   TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES                   TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES                   TO ICG-NUM-IVCT IN ICG.
           MOVE 'COMDUM'                 TO ICG-IND-TTAS IN ICG.
           MOVE OPC-FEC-FCOL IN OPC      TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF  FIO-STAT-OKS
               ADD ICG-SGV-MNTO IN ICG   TO PL1-WSS-VAL-TOTA.
       FIN-OBT-COM-DUMMY.
           EXIT.
       OBT-IMP-DUMMY SECTION.
       INI-OBT-IMP-DUMMY.
           MOVE OPC-CIC-IOPC IN OPC      TO ICG-CIC-IOPC IN ICG.
           MOVE ZEROES                   TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES                   TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES                   TO ICG-NUM-IVCT IN ICG.
           MOVE 'IMPDUM'                 TO ICG-IND-TTAS IN ICG.
           MOVE OPC-FEC-FCOL IN OPC      TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ICG.
      *isp-ini  11-MAR-2003
      *     IF  FIO-STAT-OKS
      *         ADD ICG-SGV-MNTO IN ICG   TO PL1-WSS-VAL-IMPC
      *                                      VEN-VAL-IMPU IN VEN
      *         ADD ICG-SGV-MCAL IN ICG   TO PL1-WSS-VAL-TOTA.
      *isp-fin  11-MAR-2003
       FIN-OBT-IMP-DUMMY.
           EXIT.
      *HZF-FIN 14-05-97
      *MHM-INI 06-AGO-2004
       OBT-SEG SECTION.
       INI-OBT-SEG.
      *PVG INI 11-NOV-2004
           IF VEN-NUM-IVCT IN VEN = 1 AND OPC-NUM-VCOR IN OPC = 1
               GO TO CNT-OBT-SEG-ULT.
      *PVG FIN 11-NOV-2004

           MOVE SPACES TO MSG-COD-MENS.
           MOVE 'CRE'  TO OSG-SGS-COD-SYST IN OSG-VARI.
           MOVE 'CUR'  TO OSG-SGS-COD-EVNT IN OSG-VARI.
           MOVE 'CON'  TO OSG-CXE-COD-EVEN IN OSG-VARI.
           MOVE SPACES TO OSG-IND-OCOB     IN OSG-VARI.
           IF WSS-NUM-IVCT IN WSS-VARI = 1
              MOVE OPC-NUM-SCOL IN OPC   TO OSG-NUM-SUNO
              MOVE OPC-NUM-ACOL IN OPC   TO OSG-NUM-AUNO
              MOVE OPC-NUM-MCOL IN OPC   TO OSG-NUM-MUNO
              MOVE OPC-NUM-DCOL IN OPC   TO OSG-NUM-DUNO
           ELSE
              MOVE WSS-NUM-SVNA      TO OSG-NUM-SUNO
              MOVE WSS-NUM-AVNA      TO OSG-NUM-AUNO
              MOVE WSS-NUM-MVNA      TO OSG-NUM-MUNO
              MOVE WSS-NUM-DVNA      TO OSG-NUM-DUNO.

           MOVE WSS-NUM-DVEN IN WSS-VARI TO OSG-NUM-DDOS.
           MOVE WSS-NUM-MVEN IN WSS-VARI TO OSG-NUM-MDOS.
           MOVE WSS-NUM-SVEN IN WSS-VARI TO OSG-NUM-SDOS.
           MOVE WSS-NUM-AVEN IN WSS-VARI TO OSG-NUM-ADOS.
           MOVE VEN-NUM-DVEN IN VEN      TO OSG-NUM-DFVC.
           MOVE VEN-NUM-MVEN IN VEN      TO OSG-NUM-MFVC.
           MOVE VEN-NUM-SVEN IN VEN      TO OSG-NUM-SFVC.
           MOVE VEN-NUM-AVEN IN VEN      TO OSG-NUM-AFVC.
           MOVE OPC-NUM-DCOL IN OPC      TO OSG-NUM-DCAM.
           MOVE OPC-NUM-MCOL IN OPC      TO OSG-NUM-MCAM.
           MOVE OPC-NUM-SCOL IN OPC      TO OSG-NUM-SCAM.
           MOVE OPC-NUM-ACOL IN OPC      TO OSG-NUM-ACAM.
           MOVE WSS-NUM-DVEN IN WSS-VARI TO WSS-NUM-DVNA.
           MOVE WSS-NUM-MVEN IN WSS-VARI TO WSS-NUM-MVNA.
           MOVE WSS-NUM-SVEN IN WSS-VARI TO WSS-NUM-SVNA.
           MOVE WSS-NUM-AVEN IN WSS-VARI TO WSS-NUM-AVNA.

           MOVE SPACES TO OSG-COD-MENS.
           MOVE 'COL' TO MSG-COD-SIST.
      *
      *
           IF VEN-NUM-IVCT IN VEN = 2
              MOVE OPC-VAL-CRED IN OPC TO OSG-OPC-VAL-SCRE.

           PERFORM CALC-SEG-PRECIO.
           IF OSG-COD-MENS  > SPACES
             GO TO FIN-OBT-SEG.

           SUBTRACT WSS-VAL-CAPI IN WSS-VARI FROM OSG-OPC-VAL-SCRE.
           MOVE VEN-VAL-CAPI IN VEN TO WSS-VAL-CAPI IN WSS-VARI.

           MOVE WSS-NITM    TO QUE-NITM.
           MOVE WSS-PL1-TERM-ALF TO QUE-TERM.
           MOVE 'GPLA'   TO QUE-TYPE.
           MOVE PL1-WSS-LENG TO QUE-LITM.
           MOVE QUE-GET  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               MOVE 'PLAVENNEX' TO MSG-COD-MENS
               GO TO FIN-OBT-SEG.

           MOVE QUE-ITEM TO PLB-WSS-NUM-IVCT-IDX.
           ADD  OSG-VAL-SEGC  TO PLB-WSS-VAL-TOTA.
           MOVE ZEROES        TO OSG-VAL-SEGC.
           IF WSS-NITM NOT > WSS-IMAX
               MOVE PLB-WSS-NUM-IVCT-IDX TO FRM-NUM-IVCT-IDX(WSS-NITM).

           MOVE WSS-NITM    TO QUE-NITM.
           MOVE WSS-PL1-TERM-ALF TO QUE-TERM.
           MOVE 'GPLA'   TO QUE-TYPE.
           MOVE PL1-WSS-LENG TO QUE-LITM.
           MOVE PLB-WSS-NUM-IVCT-IDX TO QUE-ITEM.
           MOVE QUE-MOD  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               MOVE 'PLAQUEMODNO' TO MSG-COD-MENS
               GO TO FIN-OBT-SEG.

           IF NOT (VEN-NUM-IVCT IN VEN = OPC-NUM-VCOR IN OPC)
               GO TO FIN-OBT-SEG.

      *CALULA ULTIMA CUOTA PARA CREDITOS CON +1 VCTO
       CNT-OBT-SEG-ULT.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE 'CRE'  TO OSG-SGS-COD-SYST IN OSG-VARI.
           MOVE 'CUR'  TO OSG-SGS-COD-EVNT IN OSG-VARI.
           MOVE 'CON'  TO OSG-CXE-COD-EVEN IN OSG-VARI.
           MOVE SPACES TO OSG-IND-OCOB     IN OSG-VARI.

      *PVG INI 11-NOV-2004
           IF VEN-NUM-IVCT IN VEN = 1 AND OPC-NUM-VCOR IN OPC = 1
              MOVE OPC-NUM-SCOL IN OPC TO OSG-NUM-SUNO
              MOVE OPC-NUM-ACOL IN OPC TO OSG-NUM-AUNO
              MOVE OPC-NUM-MCOL IN OPC TO OSG-NUM-MUNO
              MOVE OPC-NUM-DCOL IN OPC TO OSG-NUM-DUNO
           ELSE
              MOVE WSS-NUM-SVEN        TO OSG-NUM-SUNO
              MOVE WSS-NUM-AVEN        TO OSG-NUM-AUNO
              MOVE WSS-NUM-MVEN        TO OSG-NUM-MUNO
              MOVE WSS-NUM-DVEN        TO OSG-NUM-DUNO.
      *PVG FIN 11-NOV-2004

           MOVE VEN-NUM-DVEN IN VEN TO OSG-NUM-DDOS.
           MOVE VEN-NUM-MVEN IN VEN TO OSG-NUM-MDOS.
           MOVE VEN-NUM-SVEN IN VEN TO OSG-NUM-SDOS.
           MOVE VEN-NUM-AVEN IN VEN TO OSG-NUM-ADOS.
           MOVE VEN-NUM-DVEN IN VEN TO OSG-NUM-DFVC.
           MOVE VEN-NUM-MVEN IN VEN TO OSG-NUM-MFVC.
           MOVE VEN-NUM-SVEN IN VEN TO OSG-NUM-SFVC.
           MOVE VEN-NUM-AVEN IN VEN TO OSG-NUM-AFVC.
           MOVE OPC-NUM-DCOL IN OPC TO OSG-NUM-DCAM.
           MOVE OPC-NUM-MCOL IN OPC TO OSG-NUM-MCAM.
           MOVE OPC-NUM-SCOL IN OPC TO OSG-NUM-SCAM.
           MOVE OPC-NUM-ACOL IN OPC TO OSG-NUM-ACAM.
           MOVE VEN-NUM-DVEN IN VEN TO WSS-NUM-DVNA.
           MOVE VEN-NUM-MVEN IN VEN TO WSS-NUM-MVNA.
           MOVE VEN-NUM-SVEN IN VEN TO WSS-NUM-SVNA.
           MOVE VEN-NUM-AVEN IN VEN TO WSS-NUM-AVNA.

           MOVE SPACES TO OSG-COD-MENS.
           MOVE 'COL' TO MSG-COD-SIST.

           PERFORM CALC-SEG-PRECIO.
           IF OSG-COD-MENS  > SPACES
             GO TO FIN-OBT-SEG.

           ADD OSG-VAL-SEGC   TO PL1-WSS-VAL-TOTA.
           MOVE ZEROES        TO OSG-VAL-SEGC.
       FIN-OBT-SEG.
           EXIT.
      *MHM-FIN 06-AGO-2004
      *----------------------------------------------------
       CAL-DPES SECTION.
       INI-CAL-DPES.
       FIN-CAL-DPES.
           EXIT.
      *------------------------------------------------------
       GET-RDE SECTION.
       INI-GET-RDE.
       FIN-GET-RDE.
           EXIT.
      *---------------------------------------------------
       CLR-FRM SECTION.
       INI-CLR-FRM.
           MOVE ZEROES              TO FRM-NUM-IVCT IN PL1-FLD(WSS-I).
           MOVE ZEROES              TO FRM-NUM-DVEN IN PL1-FLD(WSS-I).
           MOVE ZEROES              TO FRM-NUM-MVEN IN PL1-FLD(WSS-I).
           MOVE ZEROES              TO FRM-NUM-SVEN IN PL1-FLD(WSS-I).
           MOVE ZEROES              TO FRM-NUM-AVEN IN PL1-FLD(WSS-I).
           MOVE ZEROES              TO FRM-VAL-SCAP IN PL1-FLD(WSS-I).
           MOVE ZEROES              TO FRM-VAL-TOTA IN PL1-FLD(WSS-I).
           MOVE ZEROES              TO FRM-VAL-INTC IN PL1-FLD(WSS-I).

       FIN-CLR-FRM.
           EXIT.
      *------------------------------------------------------
       CLR-SCR-RDE SECTION.
       INI-CLR-SCR-RDE.
       FIN-CLR-SCR-RDE.
           EXIT.
      *-----------------------------------------------------------
       PUT-TOT-PLA SECTION.
       INI-PUT-TOT-PLA.
       FIN-PUT-TOT-PLA.
           EXIT.
      *-------------------------------------------------------
       CAL-TPES SECTION.
       INI-CAL-TPES.
       FIN-CAL-TPES.
           EXIT.
      *MHM-INI 19-AGO-2004
       BUS-CIC-SEGD SECTION.
       INI-BUS-CIC-SEGD.
           MOVE 'COL' TO TAB-COD-SIST FIO-SIST.
           MOVE 'SDG' TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-SEGD IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS OR
                  TAB-IND-VIGE NOT = 'S'
               MOVE SPACES TO WSS-CIC-SEGD IN WSS-VARI
               GO TO FIN-BUS-CIC-SEGD.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-SEGD IN WSS-VARI.
       FIN-BUS-CIC-SEGD.
           EXIT.
      *MHM-FIN 19-AGO-2004
       BUS-CIC-OPEC SECTION.
       INI-BUS-CIC-OPEC.
           MOVE OPC-COD-TOOC IN OPC TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-TOC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'               TO MSG-COD-SIST
               MOVE 'OPCTOOCNEX  '      TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC        TO FRM-MEN1
               MOVE OPC-COD-TOOC IN OPC TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-BUS-CIC-OPEC.
           MOVE 'COL'               TO FIO-SIST.
           MOVE 'OPEC'              TO MSC-COD-TMSC IN MSC.
           MOVE TOC-MSC-OPEC IN TOC TO MSC-COD-CMSC IN MSC.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'               TO MSG-COD-SIST
               MOVE 'OPCOPECNEX  '      TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC        TO FRM-MEN1
               MOVE TOC-MSC-OPEC IN TOC TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-BUS-CIC-OPEC.
      *isp-ini  11-MAR-2003
      *     MOVE MSC-CIC-CMSC IN MSC TO FRM-OPE.
           MOVE MSC-CIC-CMSC IN MSC TO SCR-FRM-OPE.
      *isp-ini  11-MAR-2003
       FIN-BUS-CIC-OPEC.
           EXIT.
      *----------------------------------------------------
       COPY TABBFCAM.
       COPY TABBFOFI.
      *isp-ini  11-MAR-2003
      *COPY TABBBCVG.
      *isp-fin  11-MAR-2003
       COPY COLBFTOC.
      *COPY SGCBFDBC.
      *ALD  COPY GNSBFPRM.
      *JSS-IBM
       COPY GNSBPFEC.
DSP   *COPY COLBGSDC.
DSP   *COPY COLBGSCV.
      *isp-ini  11-MAR-2003
      *COPY COLBGVCD.
      *COPY COLBGCOM.
      *isp-fin  11-MAR-2003
DSP   *COPY COLBGSDP.
       COPY SGCBGCLI.
       COPY GNSBGCPT.
       COPY GNSBGSTR.
      *ALD
      *COPY SGCBFREC.
       COPY TABBGCAM.
       COPY GNSBGPES.
       COPY COLBGINT.
       COPY COLBGVEN.
      *COPY DEUBCDEU.
       COPY SGCBFDBC.
       COPY COLBFDLC.
       COPY COLBFCOM.

       COPY COLBFRDC.
      *isp-fin  11-MAR-2003
      *COPY COLBFPIP.
      *isp-fin  11-MAR-2003
       COPY COLBFVEN.
       COPY COLBFCCT.
       COPY COLBFEVC.
       COPY COLBFICG.
       COPY COLBFITR.
       COPY COLBFCXA.
       COPY COLBFRCC.
       COPY COLBFRCV.
       COPY GNSBBTAB.
      *OGB-INI 01-JUL-2016 BACKVALUE
       COPY COLBFOIA.
      *OGB-FIN 01-JUL-2016 BACKVALUE
      *PVG INI 18-JUN-2003
      *COPY COLBFPCP.
      *COPY COLBGCMS.
      *PVG FIN 18-JUN-2003

      *LOP-INI 20-01-2004 CREDITO SIN MORA
       COPY COLBGCXE.
      *LOP-FIN 20-01-2004 CREDITO SIN MORA

      *LOP-INI 20-01-2004 CREDITO SIN MORA
       PUT-SIN-MORA SECTION.
       INI-PUT-SIN-MORA.

           MOVE ZEROES TO FRM-VAL-GAST IN PL1-FLD.
           MOVE ZEROES TO FRM-VAL-IMPU IN PL1-FLD.

           MOVE WSS-PL1-TERM-ALF TO QUE-TERM
           MOVE 'GPLA'           TO QUE-TYPE.
           MOVE QUE-DEL          TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           MOVE 1                TO SCR-NUM-PANT.
           MOVE LOW-VALUES       TO PL1-WSS-NUM-IVCT-IDX.
           MOVE ZEROES           TO PL1-WSS-NUM-IVCT
                                    PL1-WSS-NUM-IVCT
                                    PL1-WSS-VAL-INTC
                                    PL1-WSS-VAL-SCAP
                                    PL1-WSS-VAL-TOTA.

           PERFORM GET-FHOY.

           MOVE 1                TO FRM-IFLD.
           MOVE ZEROES           TO VEN-NUM-IVEN IN VEN.
           MOVE 1                TO WSS-CON-VEN.
           MOVE SPACES           TO INT-CMSG.


       LUP-PUT-SIN-MORA.

           ADD 1 TO VEN-NUM-IVEN IN VEN.

           IF VEN-NUM-IVEN IN VEN > OPC-NUM-VCOR IN OPC
              MOVE '00' TO FIO-STAT
              GO TO FIN-PUT-SIN-MORA.

           PERFORM CUO-SIN-MORA.
           IF NOT INT-CMSG > SPACES
               PERFORM PUT-TAB-PLA
               PERFORM PUT-PLA-QUE
               ADD 1 TO WSS-CON-VEN
               ADD 1 TO FRM-IFLD
           ELSE
               MOVE '00' TO FIO-STAT
               GO TO FIN-PUT-SIN-MORA.

           IF WSS-CXE-VCUR = ZEROES
               MOVE '00' TO FIO-STAT
               GO TO FIN-PUT-SIN-MORA.

           IF VEN-NUM-IVEN IN VEN = OPC-NUM-VCOR IN OPC
              MOVE '00' TO FIO-STAT
              GO TO FIN-PUT-SIN-MORA.

           GO TO LUP-PUT-SIN-MORA.

       FIN-PUT-SIN-MORA.

           IF WSS-NITM > WSS-IMAX
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'PLAVENDMAS' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.

       EXT-PUT-SIN-MORA.
           EXIT.

       BUS-EVC-VA SECTION.
       INI-BUS-EVC-VA.

           MOVE OPC-CIC-IOPC IN OPC TO EVC-CIC-IOPC IN EVC.
           MOVE ZEROES              TO EVC-NUM-IEVC IN EVC.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-EVC.
       LUP-BUS-EVC-VA.
           IF NOT ( FIO-STAT-OKS AND
               EVC-CIC-IOPC IN EVC = OPC-CIC-IOPC IN OPC )
               MOVE 'EVCVA  NEX' TO MSG-COD-MENS
               GO TO FIN-BUS-EVC-VA.

           MOVE 'COL'               TO FIO-SIST.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           MOVE 'CVC'               TO TAB-COD-TTAB IN TAB.
           MOVE EVC-MSC-TCVE IN EVC TO TAB-COD-CTAB IN TAB.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              MOVE 'EVCVA  NEX' TO MSG-COD-MENS
              GO TO FIN-BUS-EVC-VA.

           IF TAB-CIC-CTAB IN TAB = 'VA'
              GO TO FIN-BUS-EVC-VA.

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-EVC.
           GO TO LUP-BUS-EVC-VA.

       FIN-BUS-EVC-VA.
           EXIT.
      *LOP-FIN 20-01-2004 CREDITO SIN MORA
      *OGB-INI 01-JUL-2016 BACKVALUE 
       VAL-BACKVALUE SECTION.
       INI-VAL-BACKVALUE.
           MOVE WSS-CT-N  TO WSS-IND-DESC-INT.
           MOVE SPACES    TO WSS-GLS-PLZBV.
           MOVE SPACES    TO WSS-GLS-MTOBV.
           MOVE SPACES    TO WSS-IND-TAUT.
           
           PERFORM OBT-CIC-MONE.
           IF MSG-COD-MENS > SPACES
              GO TO FIN-VAL-BACKVALUE.
              
      *VALIDA TIOAUX
           MOVE WSS-CT-COL          TO TAB-COD-SIST.
           MOVE WSS-CT-COL          TO FIO-SIST.
           MOVE WSS-CT-CBV          TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-COOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND
                    TAB-IND-VIGE  = WSS-CT-S )
               MOVE WSS-CT-N TO WSS-IND-DESC-INT
               GO TO FIN-VAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           MOVE TAB-GLS-DATA IN TAB TO WSS-BCK-AUX-CBV.
           PERFORM VAL-BCK-MONTO.
           IF MSG-COD-MENS > SPACES
              MOVE WSS-CT-N TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
           PERFORM VAL-BCK-PLAZO.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
               
      *VALIDA DIFERENCIA DE FECHAS > 1
           IF OPC-FEC-FCOL IN OPC = OPC-FEC-FINP IN OPC
               MOVE WSS-CT-N TO WSS-IND-DESC-INT
               GO TO FIN-VAL-BACKVALUE.

      *VALIDA QUE NO SEAN PRORROGAS NI RENOVACIONES, ESTADO = LIQ
      * Y PRIMER VENCIMIENTO
           IF OPC-IND-RENO IN OPC     = WSS-CT-PRO OR WSS-CT-REN
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
              
           IF OPC-MSC-STAT IN OPC  NOT = WSS-CT-A
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
              
           IF VEN-NUM-IVEN IN VEN  NOT = WSS-CT-1
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *    IF OPC-COD-VCOC IN OPC  NOT = WSS-COD-PESO
      *       MOVE WSS-CT-N   TO WSS-IND-DESC-INT
      *       GO TO FIN-VAL-BACKVALUE.
       
      *VALIDA CREDITOS RENEGOCIADOS - BUSCA EN DESTINO
       VAL-RENEGOCIADO-DES.

           MOVE 'COL'             TO TAB-COD-SIST FIO-SIST.
           MOVE 'DES'             TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-CDOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              GO TO FIN-VAL-BACKVALUE.

           IF TAB-GLS-DATA IN TAB(17:1) = WSS-CT-S
               MOVE WSS-CT-N TO WSS-IND-DESC-INT
               GO TO FIN-VAL-BACKVALUE.
               
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

      *DESCARTA OPERACIONES TASA VARIABLE 
           MOVE OPC-CAI-IOPC IN OPC TO ICG-CAI-IOPC IN ICG.
           MOVE OPC-IIC-IOPC IN OPC TO ICG-IIC-IOPC IN ICG.
           MOVE ZEROES              TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE WSS-CT-INT          TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF NOT ( FIO-STAT-OKS AND
                    ICG-CAI-IOPC IN ICG = OPC-CAI-IOPC IN OPC AND
                    ICG-IIC-IOPC IN ICG = OPC-IIC-IOPC IN OPC AND
                    ICG-NUM-ICAN IN ICG = ZEROES AND
                    ICG-CIC-IOPV IN ICG = SPACES AND
                    ICG-NUM-IVCT IN ICG = ZEROES AND
                    ICG-IND-TTAS IN ICG = WSS-CT-INT )
                    MOVE WSS-CT-N  TO WSS-IND-DESC-INT
                    GO TO FIN-VAL-BACKVALUE.
                    
      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *    IF ICG-COD-CVTI IN ICG > SPACES
      *       MOVE WSS-CT-N  TO WSS-IND-DESC-INT
      *       GO TO FIN-VAL-BACKVALUE.
           IF ICG-COD-CVTI IN ICG NOT > SPACES
              GO TO NO-TASA-VAR.
           
      * TASA VARIABLE (RESPECTO AL CURSE)
      *  -VALIDA QUE PERIORO DE RESPACTO TASA VARIABLE NO SEA MENOR AL
      *   PERIODO DEL PRIMER VENCIMIENTO
      *
      * DIFRENCIA DE DIAS ENTRE PRIMER VENCIMIENTO Y CURSE
      * LEE VEN PARA OBTENER PLAZO
           MOVE OPC-CAI-IOPC IN OPC   TO VEN-CAI-IOPC IN VEN.
           MOVE OPC-IIC-IOPC IN OPC   TO VEN-IIC-IOPC IN VEN.
           MOVE OPC-NUM-IVEN IN OPC   TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY           TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
              
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE VEN-NUM-DVEN IN VEN TO FEC-DEC2.
           MOVE VEN-NUM-MVEN IN VEN TO FEC-MEC2.
           MOVE VEN-NUM-SVEN IN VEN TO FEC-SEC2.
           MOVE VEN-NUM-AVEN IN VEN TO FEC-AEC2.
              
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
              
           MOVE FEC-NDIA TO WSS-DIF-DVEN IN WSS-VARI.
      * DETERMINA EL PERIODO DE REPACTO EN DIAS PARA TASA
      * RESPECTO AL CURSE
           IF ICG-MSC-TFPR IN ICG = WSS-CT-C
              PERFORM ICG-PER-REPACTO-DIAS
              IF NOT FEC-STAT-OKS
                 MOVE WSS-CT-N   TO WSS-IND-DESC-INT
                 GO TO FIN-VAL-BACKVALUE
              ELSE
                 MOVE FEC-NDIA TO WSS-DIF-DICG IN WSS-VARI
                 IF WSS-DIF-DICG IN WSS-VARI < WSS-DIF-DVEN IN WSS-VARI
                    MOVE WSS-CT-N  TO WSS-IND-DESC-INT
                    GO TO FIN-VAL-BACKVALUE.
                    
       NO-TASA-VAR.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
              
      *PLAZO (DIFERENCIA DIAS ENTRE ACTIVACION Y LIQUIDACION)
           MOVE WSS-CT-COL    TO FIO-SIST.
           MOVE WSS-CT-VSN    TO TAB-COD-TTAB IN TAB.
           MOVE 'PLZBCKVALUE' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
              MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-PLZBV.
              
           IF WSS-NUM-PMIN IS NOT NUMERIC OR
              WSS-NUM-PMAX IS NOT NUMERIC
              MOVE WSS-CT-N  TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           IF WSS-BCK-IND-PZO = WSS-CT-S
              MOVE WSS-BCK-NUM-PMIN TO WSS-NUM-PMIN
              MOVE WSS-BCK-NUM-PMAX TO WSS-NUM-PMAX.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE           

      *MONTO INTERESES MINIMO, MAXIMO Y TOPE
      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO
              GO TO MTOBCK-PESOS.

           MOVE WSS-CT-COL    TO FIO-SIST.
           MOVE WSS-CT-VSN    TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-VCOC IN OPC TO WSS-COD-MNDBV.
           MOVE WSS-COD-MTBV  TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
              MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-LMMT
              IF WSS-SGV-LMMT-MMIN IS NOT NUMERIC OR
                 WSS-SGV-LMMT-MMAX IS NOT NUMERIC
                 MOVE WSS-CT-N  TO WSS-IND-DESC-INT
                 GO TO FIN-VAL-BACKVALUE
              ELSE
                 GO TO CON-VAL-BACKVALUE
           ELSE
              MOVE WSS-CT-N  TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
              
       MTOBCK-PESOS.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

           MOVE WSS-CT-COL    TO FIO-SIST.
           MOVE WSS-CT-VSN    TO TAB-COD-TTAB IN TAB.
           MOVE 'MTOBCKVALUE' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
              MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-MTOBV.
              
           IF WSS-NUM-MMNM IS NOT NUMERIC OR
              WSS-NUM-MMAX IS NOT NUMERIC
              MOVE WSS-CT-N  TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
 
      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           MOVE WSS-NUM-MMNM TO WSS-SGV-LMMT-MMIN.
           MOVE WSS-NUM-MMAX TO WSS-SGV-LMMT-MMAX.

       CON-VAL-BACKVALUE.
       
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE             

      *REVISA SI HAY AUTORIZACION Y EL TIPO
      *SI HAY, ENTONCES SE SALTAN LAS SGTES VALIDACIONES
           MOVE SPACES TO OIA.
           MOVE OPC-CAI-IOPC IN OPC    TO OIA-CAI-IOPC IN OIA.
           MOVE OPC-IIC-IOPC IN OPC    TO OIA-IIC-IOPC IN OIA.
           MOVE WSS-CT-ABV             TO OIA-COD-CPTO IN OIA.
           MOVE FIO-GET-KEY            TO FIO-CMND.
           PERFORM COL-FIO-OIA.
           IF FIO-STAT-OKS
              MOVE OIA-COD-OLIQ IN OIA TO WSS-IND-TAUT
              IF OIA-COD-OLIQ IN OIA = WSS-CT-DIN
                 MOVE WSS-CT-S    TO WSS-IND-DESC-INT
                 GO TO FIN-VAL-BACKVALUE
              ELSE 
              IF OIA-COD-OLIQ IN OIA = WSS-CT-CIN
                 MOVE WSS-CT-N    TO WSS-IND-DESC-INT
                 GO TO FIN-VAL-BACKVALUE.
              
      *VALIDA PLAZO
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE OPC-NUM-DINP IN OPC TO FEC-DEC2.
           MOVE OPC-NUM-MINP IN OPC TO FEC-MEC2.
           MOVE OPC-NUM-SINP IN OPC TO FEC-SEC2.
           MOVE OPC-NUM-AINP IN OPC TO FEC-AEC2.
           
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS  
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

           IF FEC-NDIA <  WSS-NUM-PMIN
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
              
           IF FEC-NDIA >  WSS-NUM-PMAX 
              MOVE WSS-CT-N TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
              
           MOVE WSS-CT-S TO WSS-IND-DESC-INT.
                                     
       FIN-VAL-BACKVALUE.
           EXIT.
      *-----------------------------------------------
      *-----------------------------------------------
       CAL-BACKVALUE SECTION.
       INI-CAL-BACKVALUE.

      *OBTENEMOS TASA PERIODO
           MOVE OPC-CIC-IOPC IN OPC         TO INT-IOPC
           MOVE OPC-COD-VCOC IN OPC         TO INT-VCAM.
           MOVE OPC-NUM-DCOL IN OPC         TO INT-DCOL.
           MOVE OPC-NUM-MCOL IN OPC         TO INT-MCOL.
           MOVE OPC-NUM-SCOL IN OPC         TO INT-SCOL.
           MOVE OPC-NUM-ACOL IN OPC         TO INT-ACOL.
           MOVE WSS-CT-1                    TO INT-IDLC.
           MOVE OPC-NUM-DCOL IN OPC         TO INT-DUNO.
           MOVE OPC-NUM-MCOL IN OPC         TO INT-MUNO.
           MOVE OPC-NUM-SCOL IN OPC         TO INT-SUNO.
           MOVE OPC-NUM-ACOL IN OPC         TO INT-AUNO.
           MOVE OPC-NUM-DINP IN OPC         TO INT-DDOS.
           MOVE OPC-NUM-MINP IN OPC         TO INT-MDOS.
           MOVE OPC-NUM-SINP IN OPC         TO INT-SDOS.
           MOVE OPC-NUM-AINP IN OPC         TO INT-ADOS.
           MOVE OPC-NUM-DINP IN OPC         TO INT-DBTV.
           MOVE OPC-NUM-MINP IN OPC         TO INT-MBTV.
           MOVE OPC-NUM-SINP IN OPC         TO INT-SBTV.
           MOVE OPC-NUM-AINP IN OPC         TO INT-ABTV.

           PERFORM COL-CAL-INT.
           IF INT-CMSG > SPACES
              MOVE WSS-CT-N TO WSS-IND-DESC-INT
              GO TO FIN-CAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE   
      *    MULTIPLY INT-TIPE BY OPC-VAL-CRED IN OPC
      *             GIVING WSS-SGV-VINT.
      *    MOVE WSS-SGV-VINT TO PES-SGV-DECI IN PES-VARI.
      *    PERFORM PES-SCTV.
      *    MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-VINT.
           MULTIPLY INT-TIPE BY OPC-VAL-CRED IN OPC
                    GIVING WSS-SGV-VINT.
                    
           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO
              MOVE WSS-SGV-VINT TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-VINT.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

      *VALIDA QUE DIFERENCIA DE INTERESES NO SEA MAYOR A INT 1ER VEN
           COMPUTE WSS-VAL-INT1 =   VEN-VAL-FINA IN VEN
                                  - VEN-VAL-CAPI IN VEN.

           IF WSS-SGV-VINT > WSS-VAL-INT1
              MOVE WSS-CT-N     TO WSS-IND-DESC-INT
              GO TO FIN-CAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *SI TIO-AUX TIENE LIMITE ESPECIFICO SE SOBRESCRIBE
           IF  WSS-BCK-IND-MTO = WSS-CT-S
               MOVE WSS-BCK-SGV-MMIN TO WSS-SGV-LMMT-MMIN
               MOVE WSS-BCK-SGV-MMAX TO WSS-SGV-LMMT-MMAX.
               
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *
      *VALIDA MTO INTERESES (MIN, MAX Y TOPE)
      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *    IF WSS-SGV-VINT < WSS-NUM-MMNM
           IF WSS-SGV-VINT < WSS-SGV-LMMT-MMIN
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
              IF WSS-IND-TAUT = WSS-CT-DIN
                 MOVE WSS-CT-S  TO WSS-IND-DESC-INT
                 GO TO FIN-CAL-BACKVALUE
              ELSE
                 MOVE WSS-CT-N  TO WSS-IND-DESC-INT
                 GO TO FIN-CAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *    IF WSS-SGV-VINT > WSS-NUM-MMAX
           IF WSS-SGV-VINT > WSS-SGV-LMMT-MMAX
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
              IF WSS-IND-TAUT = WSS-CT-DIN
                 MOVE WSS-CT-S  TO WSS-IND-DESC-INT
                 GO TO FIN-CAL-BACKVALUE
              ELSE
              IF WSS-IND-TAUT = WSS-CT-CIN
                 MOVE WSS-CT-N  TO WSS-IND-DESC-INT
                 GO TO FIN-CAL-BACKVALUE
              ELSE
                 MOVE WSS-CT-N     TO WSS-IND-DESC-INT
                 GO TO FIN-CAL-BACKVALUE.

       FIN-CAL-BACKVALUE.
           EXIT. 
      *--------------------------------------------------------------
      *--------------------------------------------------------------
       OBT-CIC-MONE SECTION.
       INI-OBT-CIC-MONE.
           MOVE SPACES                TO TAB-COD-CTAB IN TAB.
           MOVE WSS-CT-TAB            TO FIO-SIST.
           MOVE WSS-CT-VLR            TO TAB-CIC-TTAB IN TAB.
           MOVE WSS-CT-0999           TO TAB-CIC-CTAB IN TAB.
           MOVE WSS-CT-TABAKEY        TO FIO-AKEY.
           MOVE FIO-GET-KEY           TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT  FIO-STAT-OKS
              MOVE WSS-CT-CICPESO TO MSG-COD-MENS
              MOVE WSS-CT-COL     TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC   TO FRM-MENS
              MOVE WSS-CT-S       TO SCR-IERR
              GO TO FIN-OBT-CIC-MONE.
              
           MOVE TAB-COD-CTAB IN TAB   TO WSS-COD-PESO IN WSS-VARI.
       FIN-OBT-CIC-MONE.
           EXIT.
      *OGB-FIN 01-JUL-2016 BACKVALUE 
      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       ICG-PER-REPACTO-DIAS SECTION.
       INI-ICG-PER-REPACTO-DIAS.
           MOVE OPC-NUM-DCOL IN OPC TO FEC-ITM1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-ITM2.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-ITM3.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-ITM4.
           

           IF ICG-MSC-UTPR IN ICG = WSS-CT-D
               MOVE FEC-SUM-DIA  TO FEC-CMND
               MOVE ICG-NUM-PREP IN ICG TO FEC-NDIA
           ELSE
           IF ICG-MSC-UTPR IN ICG = WSS-CT-M
               MOVE FEC-SUM-MES TO FEC-CMND
               MOVE ICG-NUM-PREP IN ICG TO FEC-NMES
           ELSE
           IF ICG-MSC-UTPR IN ICG = WSS-CT-A
               MOVE FEC-SUM-ANO TO FEC-CMND
               MOVE ICG-NUM-PREP IN ICG TO FEC-NANO.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           PERFORM CAL-FEC.

      *OBTENEMOS LA DIFERENCIA EN DIAS
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE FEC-ITM1 TO FEC-DEC2.
           MOVE FEC-ITM2 TO FEC-MEC2.
           MOVE FEC-ITM3 TO FEC-SEC2.
           MOVE FEC-ITM4 TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.

       FIN-ICG-PER-REPACTO-DIAS.
           EXIT.
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       VAL-BCK-MONTO SECTION.
       INI-VAL-BCK-MONTO.
                   
           IF WSS-BCK-IND-MTO NOT = WSS-CT-S
              GO TO FIN-VAL-BCK-MONTO.

           IF WSS-BCK-SGV-MMIN < ZEROES OR
              WSS-BCK-SGV-MMAX NOT > ZEROES OR
              WSS-BCK-COD-VCMT NOT > SPACES
              MOVE WSS-CT-N TO WSS-BCK-IND-MTO
              GO TO FIN-VAL-BCK-MONTO.

           IF WSS-BCK-SGV-MMIN IS NOT NUMERIC OR
              WSS-BCK-SGV-MMAX IS NOT NUMERIC
              MOVE WSS-CT-N TO WSS-BCK-IND-MTO
              GO TO FIN-VAL-BCK-MONTO.

           IF WSS-BCK-SGV-MMIN > WSS-BCK-SGV-MMAX
              MOVE WSS-CT-N TO WSS-BCK-IND-MTO
              GO TO FIN-VAL-BCK-MONTO.
           
           MOVE SPACES           TO TAB.
           MOVE 'TAB'            TO TAB-COD-SIST.
           MOVE 'VLR'            TO TAB-COD-TTAB IN TAB.
           MOVE WSS-BCK-COD-VCMT TO TAB-COD-CTAB IN TAB.
           MOVE TAB-COD-SIST     TO FIO-SIST.
           MOVE FIO-GET-KEY      TO FIO-CMND.
           MOVE WSS-CT-TABAKEY   TO FIO-AKEY.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              MOVE WSS-CT-N TO WSS-BCK-IND-MTO
              GO TO FIN-VAL-BCK-MONTO.

      *CONVERSION DE MONTOS A LA MONEDA DE LA OPERACION
           
      *SI ES MISMA MONEDA NO SE HACE NADA
           IF OPC-COD-VCOC IN OPC = WSS-BCK-COD-VCMT
              GO TO FIN-VAL-BCK-MONTO.

           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO
              MOVE WSS-BCK-COD-VCMT TO CAM-COD-VCAM IN CAM(1)
           ELSE
           IF WSS-BCK-COD-VCMT = WSS-COD-PESO
              MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
           ELSE
              MOVE WSS-CT-TAB           TO MSG-COD-SIST
              MOVE WSS-CT-CAMNEX        TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC         TO FRM-MEN1
              GO TO FIN-VAL-BCK-MONTO.
              
           MOVE WSS-COD-PESO           TO CAM-COD-VCAM IN CAM(2).
           MOVE OPC-FEC-FINP IN OPC    TO CAM-FEC-FCAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT ( FIO-STAT-OKS AND CAM-IND-VIGE = WSS-CT-S)
              MOVE WSS-CT-TAB           TO MSG-COD-SIST
              MOVE WSS-CT-CAMNEX        TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC         TO FRM-MEN1
              GO TO FIN-VAL-BCK-MONTO.

           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS-VARI
              COMPUTE WSS-BCK-SGV-MMIN ROUNDED = WSS-BCK-SGV-MMIN *
                                         CAM-SGV-VCAM IN CAM
              COMPUTE WSS-BCK-SGV-MMAX ROUNDED = WSS-BCK-SGV-MMAX *
                                         CAM-SGV-VCAM IN CAM
              MOVE WSS-BCK-SGV-MMIN TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO WSS-BCK-SGV-MMIN

              MOVE WSS-BCK-SGV-MMAX TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO WSS-BCK-SGV-MMAX
           ELSE
           IF WSS-BCK-COD-VCMT    = WSS-COD-PESO IN WSS-VARI
              COMPUTE WSS-BCK-SGV-MMIN ROUNDED = WSS-BCK-SGV-MMIN /
                                         CAM-SGV-VCAM IN CAM
              COMPUTE WSS-BCK-SGV-MMAX ROUNDED = WSS-BCK-SGV-MMAX /
                                         CAM-SGV-VCAM IN CAM.
                                         
       FIN-VAL-BCK-MONTO.
           EXIT.
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       VAL-BCK-PLAZO SECTION.
       INI-VAL-BCK-PLAZO.
       
           IF WSS-BCK-IND-PZO NOT = WSS-CT-S
              GO TO FIN-VAL-BCK-PLAZO.

           IF WSS-BCK-NUM-PMIN < ZEROES OR
              WSS-BCK-IND-PMIN NOT > SPACES OR
              WSS-BCK-NUM-PMAX NOT > ZEROES OR
              WSS-BCK-IND-PMAX NOT > SPACES
              MOVE WSS-CT-N TO WSS-BCK-IND-PZO
              GO TO FIN-VAL-BCK-PLAZO.

           IF WSS-BCK-NUM-PMIN IS NOT NUMERIC OR
              WSS-BCK-NUM-PMAX IS NOT NUMERIC
              MOVE WSS-CT-N TO WSS-BCK-IND-PZO
              GO TO FIN-VAL-BCK-PLAZO.

           IF WSS-BCK-IND-PMIN NOT = WSS-CT-D AND WSS-CT-M AND WSS-CT-A 
              OR
              WSS-BCK-IND-PMAX NOT = WSS-CT-D AND WSS-CT-M AND WSS-CT-A
              MOVE WSS-CT-N TO WSS-BCK-IND-PZO
              GO TO FIN-VAL-BCK-PLAZO.
      *
      *SE CONVIERTE PLAZO EN DIAS (PARA LOS POSTERIORES COMPARACIONES)
           IF WSS-BCK-IND-PMIN = WSS-CT-D AND
              WSS-BCK-IND-PMAX = WSS-CT-D
              GO TO FIN-VAL-BCK-PLAZO.

           IF WSS-BCK-IND-PMIN NOT = WSS-CT-D
              MOVE WSS-BCK-NUM-PMIN  TO WSS-NUM-NPER
              MOVE WSS-BCK-IND-PMIN  TO WSS-IND-NPER
              PERFORM CAL-PLAZO-DIAS
              MOVE WSS-NUM-NDIA TO WSS-BCK-NUM-PMIN
              MOVE WSS-CT-D     TO WSS-BCK-IND-PMIN.

           IF WSS-BCK-IND-PMAX NOT = WSS-CT-D
              MOVE WSS-BCK-NUM-PMAX  TO WSS-NUM-NPER
              MOVE WSS-BCK-IND-PMAX  TO WSS-IND-NPER
              PERFORM CAL-PLAZO-DIAS
              MOVE WSS-NUM-NDIA TO WSS-BCK-NUM-PMAX
              MOVE WSS-CT-D     TO WSS-BCK-IND-PMAX.
              
       FIN-VAL-BCK-PLAZO.
           EXIT.
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       CAL-PLAZO-DIAS SECTION.
       INI-CAL-PLAZO-DIAS.
           MOVE ZEROES  TO WSS-NUM-NDIA.
           MOVE OPC-NUM-DCOL IN OPC TO FEC-ITM1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-ITM2.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-ITM3.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-ITM4.

           IF WSS-IND-NPER = WSS-CT-D
               MOVE FEC-SUM-DIA  TO FEC-CMND
               MOVE WSS-NUM-NPER TO FEC-NDIA
           ELSE
           IF WSS-IND-NPER = WSS-CT-M
               MOVE FEC-SUM-MES TO FEC-CMND
               MOVE WSS-NUM-NPER TO FEC-NMES
           ELSE
           IF WSS-IND-NPER = WSS-CT-A
               MOVE FEC-SUM-ANO TO FEC-CMND
               MOVE WSS-NUM-NPER TO FEC-NANO.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           PERFORM CAL-FEC.

      *OBTENEMOS LA DIFERENCIA EN DIAS
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE FEC-ITM1 TO FEC-DEC2.
           MOVE FEC-ITM2 TO FEC-MEC2.
           MOVE FEC-ITM3 TO FEC-SEC2.
           MOVE FEC-ITM4 TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
              GO TO FIN-CAL-PLAZO-DIAS.

           MOVE FEC-NDIA TO WSS-NUM-NDIA.

       FIN-CAL-PLAZO-DIAS.
           EXIT.
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       BCKVL-CONVIERTE-MOPE SECTION.
       INI-BCKVL-CONVIERTE-MOPE.
      *POR DEFECTO LA TABLA MTOBCKVALUE ESTA EN PESOS, EN CASO QUE LA
      *OPERACION NO ESTE EN PESOS, SE DEBE PASAR A LA MONEDA DE LA OPE

           MOVE OPC-COD-VCOC IN OPC    TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO           TO CAM-COD-VCAM IN CAM(2).
           MOVE OPC-FEC-FINP IN OPC    TO CAM-FEC-FCAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT ( FIO-STAT-OKS AND CAM-IND-VIGE = WSS-CT-S)
              MOVE WSS-CT-TAB           TO MSG-COD-SIST
              MOVE WSS-CT-CAMNEX        TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE WSS-CT-S             TO SCR-IERR
              MOVE WSS-CT-N             TO WSS-IND-DESC-INT
              MOVE MSG-GLS-DESC         TO FRM-MEN1
              GO TO FIN-BCKVL-CONVIERTE-MOPE.
           
           COMPUTE WSS-SGV-LMMT-MMIN ROUNDED = WSS-SGV-LMMT-MMIN /
                                       CAM-SGV-VCAM IN CAM
           COMPUTE WSS-SGV-LMMT-MMAX ROUNDED = WSS-SGV-LMMT-MMAX /
                                       CAM-SGV-VCAM IN CAM.
       FIN-BCKVL-CONVIERTE-MOPE.
           EXIT.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

      *>>>>
*% END
