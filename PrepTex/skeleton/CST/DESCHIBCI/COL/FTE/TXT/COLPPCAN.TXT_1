*%! Codigo adicional para archivo
*% HDR_CST = FALSE
*% PGM_PTC = TRUE
*% NO_TIENE_TIMESTAMP = TRUE
*% INCLUDE 'GNSSRC:MANEJO_VSI.SRC'
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
       COPY COLWGENG.
       COPY COLW1CAN.
       COPY GNSWGRQA REPLACING ==01  ADR-REQA== BY
                               ==02  SCR-CAN-REQA==.
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
      *DAD ini PTC
       COPY GNSWGQUE.
      *DAD fin PTC
      * RBG/INI/23-JUL-1997
       COPY COLBRCOM.
      * RBG/FIN/23-JUL-1997
       COPY COLBRTMC.
       COPY COLBRCYA.
       COPY COLBRICG.
       COPY COLBRITR.
       COPY COLBROPC.
       COPY COLBRDLC.
       COPY COLBRRCV.
       COPY COLBRROV.
       COPY COLBRRDT.
       COPY COLBRVEN.
       COPY COLBRVEN REPLACING ==VEN== BY ==VEN-BKP==.
       COPY COLBRCAN REPLACING ==CAN== BY ==CAN-BKP==.
       COPY COLBRRDC.
       COPY COLBRTOC.
       COPY SGCBRDBC.
       COPY SGCBRRCO.
       COPY SGCBROPE.
       COPY GNSWGCPT.
       COPY GNSWGCIC.
       COPY GNSBRCIC.
       COPY TABBRCAM.
       COPY TABWGCAM.
       COPY TABBRVLR.
       COPY COLBRICC.
       COPY COLBRRCE.
      * ARCHIVO SAFE
       COPY COLBRCRS.
       COPY GNSWGBCD.
       COPY COLWGVEN.
      *SMC-INI 09.09.1993
       COPY COLWGINT.
      *SMC-FIN 09.09.1993
       COPY GNSWGCVI.
       COPY COLBREVC.
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Para Proceso Genera y Activa con registro MVO (Pro. Linea y Batch)
      *DAD ini  20-ABR-1993   (Memo.19-04-93)
      *DAD ini  18-MAR-1993   (Memo.07-09-92)
       COPY COLBRMVO.
       COPY COLWGMVO.
      *DAD fin  17-MAY-1993 / 20-ABR-1993 / 18-MAR-1993
      *DAD ini  01-DIC-1993
       COPY COLWGEVM.
      *DAD fin  01-DIC-1993
       COPY GNSBRERR.
       COPY GNSWGPES.
       COPY COLWGADO.
       COPY COLW2CAN.
      *ALDI
           03 WSS-GLS-DATI.
               05  FILLER                           PIC X(06).
               05  WSS-IND-CSAF                     PIC X(01).
               05  FILLER                           PIC X(03).
           03  WSS-SDLC.
               05 WSS-VAL-SDLC OCCURS 500          PIC S9(11)V9(04).
           03  WSS-VAL-OCRE                        PIC S9(11)V9(04).
           03  WSS-IND-RNOV                        PIC X(01).
           03  WSS-IND-SAFE                        PIC X(01).
           03  WSS-IND-CTCT                        PIC X(01).
           03  WSS-SGV-LIQU     COMP-3             PIC S9(11)V9(4).
           03  WSS-CAN-MSC-STAT                    PIC X(01).
      *     03  WSS-IND-CAJA                        PIC X(01).
           03  WSS-MAXV                            PIC 9(03).
           03  WSS-MINV                            PIC 9(03).
           03  WSS-MAXD                            PIC 9(03).
           03  WSS-MIND                            PIC 9(03).
           03  WSS-NUM-IDLC                        PIC 9(04).
           03  WSS-IDLC.
               05  WSS-VEC-IDLC OCCURS 500.
                   07  WSS-SGV-CAPD   COMP-3       PIC S9(11)V9(04).
                   07  WSS-SGV-FINA   COMP-3       PIC S9(11)V9(04).
           03  WSS-SGV-CAPT           COMP-3       PIC S9(11)V9(04).
           03  WSS-SGV-FINL           COMP-3       PIC S9(11)V9(04).
      *DAD ini  22-OCT-1991
           03  WSS-NUM-VCVG                        PIC S9(03).
           03  WSS-NUM-VCCM                        PIC S9(03).
           03  WSS-NUM-VCCO                        PIC S9(03).
           03  WSS-NUM-VCCV                        PIC S9(03).
      *DAD fin  22-OCT-1991
           03  WSS-I            VALUE ZEROES       PIC 9(03).
           03  WSS-IMAX         VALUE 50           PIC 9(03).
           03  WSS-IND-ALG      VALUE SPACES       PIC X(01).
      *REV
           03 REV-MSG.
              05 REV-MSG-MSG                       PIC X(40).
              05 REV-MSG-CAN                       PIC X(15).
           03 WSS-NUM-IEVC                         PIC 9(03).
      *    Valor Vencimientos ( Capital o Final )
           03  WSS-VAL-VENC             COMP-3     PIC 9(11)V9(04).
      *    Fecha Amortizacion
           03  WSS-FEC-FAMT.
               05  WSS-NUM-SAMT                    PIC 9(02).
               05  WSS-NUM-AAMT                    PIC 9(02).
               05  WSS-NUM-MAMT                    PIC 9(02).
               05  WSS-NUM-DAMT                    PIC 9(02).
      *
           03  WSS-IND-ADO      VALUE 'N'          PIC X(01).
           03  WSS-AUX-IVEN                        PIC 9(03).
      *DAD ini  20-OCT-1992   (Memo.08-10-92)
           03  WSS-IND-SCTB                        PIC X(03).
           03  WSS-IND-SCBZ                        PIC X(05).
      *DAD fin  20-OCT-1992
      *DAD ini  31-MAY-1993
           03  WSS-IND-EXIS            VALUE 'N'   PIC X(01).
           03  WSS-VAL-CAPI-GENE       COMP-3      PIC 9(11)V9(04).
      *DAD fin  31-MAY-1993
      *DAD ini  18-JUL-1994   (Memo.23-06-94)
           03  WSS-COD-OFOC                        PIC X(03).
      *DAD fin  18-JUL-1994
      *JSS-INI PARA INIT-SAFE 7-OCT-1991 19:24:23
           03 WSS-AUX                COMP         PIC 9(02).
           03 WSS-AUX-DLIM.
              05  WSS-AUX-DLI1                    PIC X(01).
              05  WSS-AUX-DLI2                    PIC X(01).
           03 WSS-COD-PESO                        PIC X(06).
           03 WSS-COD-UFES                        PIC X(06).
           03  WSS-GLS-DAT3.
               05 FILLER                          PIC X(12).
               05 WSS-IND-TCRE                    PIC X(02).
               05 FILLER                          PIC X(16).
           03  WSS-IND-FUTU          VALUE SPACES PIC X(01).
           03 WSS-NUM-IVAC                        PIC 9(03).
           03 WSS-KEY-IICG                        PIC X(41).
      * RBG/INI/24-JUL-1997
           03 WSS-IND-ECMO           VALUE 'N'    PIC X(01).
      * RBG/FIN/24-JUL-1997
       COPY COLWGMUF.
      *JSS-FIN
      *DAD ini  02-ENE-1992   (Memo.09-12-91)
           COPY USPC113.
      *DAD fin  02-ENE-1992
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VLR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
      * RBG/INI/23-JUL-1997
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
      * RBG/FIN/23-JUL-1997
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Para Proceso Genera y Activa con registro MVO (Pro. Linea y Batch)
      *DAD ini  20-ABR-1993   (Memo.19-04-93)
      *DAD ini  18-MAR-1993   (Memo.07-09-92)
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MVO-REQA==.
      *DAD fin  17-MAY-1993 / 20-ABR-1993 / 18-MAR-1993
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ERR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==.
      *>>>>
*% END
*% CMA_USR = TRUE
*% IF CMA
      *<<<< CMA
           02 FILLER                      PIC X(3000).
      *>>>>
*% END
*% BLLCELLS_USR = TRUE
*% IF BLLCELLS
      *<<<< BLLCELLS
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Para Proceso Genera y Activa con registro MVO (Pro. Linea)
       COPY COLLGCCT.
      *DAD fin  17-MAY-1993
      *>>>>
*% END
*% IF PGM_POS_EDB
      *<<<< PGM_POS_EDB
      *DAD ini  17-MAR-1994
           IF EIBCALEN = ADO-TCMA
               GO TO CON-INI.
      *DAD fin  17-MAR-1994
      *>>>>
*% END
*% IF INI_FIO_IBM
      *<<<< INI_FIO_IBM
      *DAD ini  17-MAR-1994
       CON-INI.
      *DAD fin  17-MAR-1994
           IF EIBCALEN = ADO-TCMA
      *MHM-INI 7-DEC-2000
      *         MOVE DFHCOMMAREA(1:EIBCALEN) TO ADO-CMMA
               MOVE DFHCOMMAREA TO ADO-CMMA
      *MHM-INI 7-DEC-2000
               PERFORM GET-STAT-ADO
      *OJO
               PERFORM ADO-CAN
      * RBG/INI/10-JUL-1997 Estas dos instrucciones las puse para poder
      * aplicar cicsdebug en Realia,  ya que no me cerraba los archivos
      * cuando este programa le devuelve el control al programa COLPOOPC
               MOVE FIO-EBR-ALL TO FIO-CMND
               PERFORM COL-FIO-CAN
      * RBG/FIN/10-JUL-1997
               MOVE ADO-CMMA TO DFHCOMMAREA
       COPY GNSBGGBK.
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           MOVE +3000 TO SCR-TCMA.
           IF SCR-DESDE-CMN
               MOVE SPACES TO SCR-COD-TICG
                              SCR-COD-TITR
                              SCR-COD-VCOC
                              SCR-CYA-IND-MCYA
                              SCR-CYA-IND-PAUT
                              SCR-CYA-IND-CAJA
                              SCR-CYA-IND-CCTE.
      *>>>>
*% END
*% IF PUT_SCR
      *<<<< PUT_SCR
      *ALD-BCI-INI/08.04.1999
           IF PGM-STAT-CAN-OKS
               MOVE CAN-STP-ITRN IN CAN TO SCR-UMOD.
      *ALD-BCI-FIN/08.04.1999
      *DAD ini  02-ENE-1992   (Memo.09-12-91)
           MOVE 'COL'          TO FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
      *DAD ini  08-ABR-1992   (Memo.09-03-92 Pto.1)
           MOVE 'OFIUSPCANACA' TO TAB-COD-CTAB IN TAB.
      *DAD fin  08-ABR-1992
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND
              TAB-MSC-STAT IN TAB = 'S'
               PERFORM VAL-OFI-USP.
      *DAD fin  02-ENE-1992

      *DAD ini  04-AGO-1993   (Memo.28-06-93)
      *Valida existencia de informacion en campos informados con perdida
           PERFORM VAL-DAT-PREV-ACA.
           IF MSG-COD-MENS > SPACES
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE SCR-STAT-CON TO SCR-STAT.
      *DAD fin  04-AGO-1993
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
       COPY COLB1CAN.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      *ALD-BCI-INI/08.04.1999
           IF FIO-STAT-OKS
               MOVE CAN-STP-ITRN IN CAN TO SCR-UMOD.
      *ALD-BCI-FIN/08.04.1999
       COPY COLB2CAN.

      *DPM ini  19-APR-1996
           IF ((SCR-CMND = 'CAN' OR 'CVC') AND
              CAN-MSC-TCAN IN CAN = 'C' AND
              CYA-IND-TCYA IN CAN-FLD = 'CTBL') OR
              (SCR-CMND = 'CAB' AND
              CYA-IND-TCYA IN CAN-FLD NOT = 'CTBL')
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CTBL  NOCMN' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO CPT-STR1
               MOVE MSG-GLS-DATA TO CPT-STR2
               PERFORM CPT-BLKS
               MOVE CPT-STRN     TO FRM-MENS
               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
      * PTC INI REL
               MOVE 'S' TO SCR-IERR
      * PTC FIN REL
               GO TO FIN-FND-KEY.
      *DPM fin  19-APR-1996
           IF SCR-CMND = 'REV'
               GO TO FND-KEY-REV.
           PERFORM GET-FEC-FCVC.
           IF PGM-STAT-CAN-OKS
               IF SCR-CMND = 'CAN' AND
                  CAN-FEC-FOUT IN CAN NOT = CAN-FEC-FCAN IN CAN
                   MOVE 'COL'          TO MSG-COD-SIST
                   MOVE 'FECFCANNFOUT' TO MSG-COD-MENS
                   PERFORM GET-MSG

      *             STRING MSG-GLS-DESC
      *                MSG-GLS-DATA DELIMITED BY SIZE
      *             INTO FRM-MENS

                   MOVE MSG-GLS-DESC TO CPT-STR1
                   MOVE MSG-GLS-DATA TO CPT-STR2
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN     TO FRM-MENS

                   MOVE '00'         TO FIO-STAT
                   MOVE SCR-STAT-CON TO SCR-STAT
      * PTC INI REL
                   MOVE 'S' TO SCR-IERR
      * PTC FIN REL
      *DPM ini  17-JUL-1996 Se modifico para permitir cancelaciones
      * retroactivas para ctas ctes
      *             GO TO FIN-FND-KEY
                   GO TO FIN-FND-KEY.
      *         ELSE
      *         IF SCR-CMND = 'CVC'
      *             IF SCR-CYA-IND-PAUT = 'S'
      *                 MOVE 'COL'          TO MSG-COD-SIST
      *                 MOVE 'TCYAAUTNOCVC' TO MSG-COD-MENS
      *                 PERFORM GET-MSG

      *                 STRING MSG-GLS-DESC
      *                 MSG-GLS-DATA DELIMITED BY SIZE
      *                   INTO FRM-MENS

      *                 MOVE MSG-GLS-DESC TO CPT-STR1
      *                 MOVE MSG-GLS-DATA TO CPT-STR2
      *                 PERFORM CPT-BLKS
      *                 MOVE CPT-STRN     TO FRM-MENS

      *                 MOVE '00'         TO FIO-STAT
      *                 MOVE SCR-STAT-CON TO SCR-STAT
      *                 GO TO FIN-FND-KEY.
      *DPM fin  17-JUL-1996

      *     PERFORM VRF-CAJA.
      *     IF WSS-IND-CAJA = 'S'
           PERFORM REL-COL-SAF.
      *Si la cuota a pagar no esta en el SAFE y ademas es una cuota esti
      *entonces debe grabarla en el SAFE
           IF ( MSG-COD-MENS = 'CRSIOPCNEX' ) AND
              ( RCV-MSC-STAT IN RCV = 'C' OR 'F' )
               PERFORM INIT-SAFE.
           IF MSG-COD-MENS > SPACES
*% IF PGM_PTC
      *DAD ini PTC
               MOVE 'S'          TO SCR-IERR
      *DAD fin PTC
*% END
               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
       FND-KEY-REV.
           MOVE PGM-STAT-CAN TO FIO-STAT.
      *>>>>
*% END
*% IF FIN_HBL_IKY OR FIN_HBL_KEY
      *<<<< FIN_HBL_IKY OR FIN_HBL_KEY
           MOVE SPACES TO SCR-COD-TICG
                          SCR-COD-TITR
                          SCR-COD-VCOC
                          SCR-CYA-IND-MCYA
                          SCR-CYA-IND-PAUT
                          SCR-CYA-IND-CAJA
                          SCR-CYA-IND-CCTE.
      *>>>>
*% END
*% IF FIN_HBL_KEY
      *<<<< FIN_HBL_KEY
           IF SCR-CMND = 'REV'
               MOVE FRM-CPIM-AEY TO VEN-NUM-IVCT-ATR IN CAN-FLD
               MOVE FRM-CPIM-AEY TO CAN-NUM-ICAN-ATR IN CAN-FLD.
      *>>>>
*% END
*% IF INI_CMN_ACC
      *<<<< INI_CMN_ACC
           IF SCR-CMND NOT = 'CAN' AND
              SCR-CMND NOT = 'CVC' AND
      *DPM ini  19-APR-1996
              SCR-CMND NOT = 'CAB' AND
      *DPM fin  19-APR-1996      
              SCR-CMND NOT = 'REV'
               MOVE 'GNS'    TO MSG-COD-SIST
               MOVE 'CMDINV' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-ACC.
           MOVE SPACES TO REV-MSG.
      *>>>>
*% END
*% IF CMN_ACC_RET
      *<<<< CMN_ACC_RET
      *ALD-BCI-INI/08.04.1999
           IF FIO-STAT-OKS AND
              CAN-STP-ITRN IN CAN NOT = SCR-UMOD
               MOVE FIO-ULK-REC TO FIO-CMND
               PERFORM COL-FIO-CAN
               MOVE FIO-BCK-OUT TO FIO-CMND
               PERFORM COL-FIO-CAN
               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'GNSACCSSIMUL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-ACC.
      *ALD-BCI-FIN/08.04.1999
           PERFORM GET-FHOY.
           MOVE 'N' TO WSS-IND-RNOA.
           IF SCR-CMND = 'REV'
               MOVE 'S' TO WSS-IND-RNOA
               PERFORM BUS-IND-SFCR
               IF MSG-COD-MENS > SPACES
      *JSS
                   IF MSG-COD-MENS = 'CAN    REVOK'
                       PERFORM SET-STTR-RCV
      *DAD ini  20-OCT-1992   (Memo.08-10-92)
                       IF OPC-IND-VSTR IN OPC = 'S'
                           PERFORM ACT-VEN-SHFT-REV-TT
                           GO TO FIN-CMN-ACC
                       ELSE
      *DAD fin  20-OCT-1992
                       GO TO FIN-CMN-ACC
                   ELSE
      *
                   GO TO FIN-CMN-ACC.
      *ISP ACCESA OPC, PARA QUE GET-CUR-CYA Y GET-NXT-CYA SIGAN
      *    OPERANDO CON CAMPOS DE OPC, AL IGUAL QUE COLPOOPC
           PERFORM GET-OPC.
           IF WSS-IND-ADO = 'S'
               PERFORM FND-KEY-CYA.
           IF SCR-MSC-TCAN = 'C'
      *ISP VERIFICA SI HAY AL MENOS UN CODIGO DE CARGO 'CAJA'
      *         PERFORM VRF-CAJA
      *JSS 15-MAY-1991 14:24:59 ( manejo cargo cuenta corriente )
               IF SCR-CYA-IND-CCTE = 'S'
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Para Proceso Genera y Activa con registro MVO (Pro. Linea y Batch)
      *DAD ini  20-ABR-1993   (Memo.19-04-93)
      *DAD ini  18-MAR-1993   (Memo.07-09-92)
      * Manejo cargo cuenta corriente en Linea
      *El Cargo con Cta.Cte. en Linea se activa con 'A' y activa MVO de cta cte
                   IF SCR-CYA-IND-PAUT = 'S'
                       MOVE 'S' TO MVO-LINE IN MVO-VARI
                       PERFORM GEN-REG-MVO
                       IF MVO-CMSG NOT > SPACES
                          MOVE SPACES TO MSG-COD-MENS
                          MOVE 'A'    TO WSS-CAN-MSC-STAT
                       ELSE
                           MOVE MVO-CMSG TO MSG-COD-MENS
                           GO TO BCK-CMN-ACC
                   ELSE
      *DAD fin  20-ABR-1993 / 18-MAR-1993
      *El Cargo con Cta.Cte. en Batch se activa con 'A' y genera MVO de cta cte
      *                 MOVE 'G' TO WSS-CAN-MSC-STAT
                       PERFORM GEN-REG-MVO
                       IF MVO-CMSG NOT > SPACES
                          MOVE SPACES TO MSG-COD-MENS
                          MOVE 'H'    TO WSS-CAN-MSC-STAT
                       ELSE
                           MOVE MVO-CMSG TO MSG-COD-MENS
                           GO TO BCK-CMN-ACC
      *DAD fin  17-MAY-1993
               ELSE
      *
               IF SCR-CYA-IND-CAJA = 'S' AND
                  ADO-IND-ORIG NOT = 'S'
                   MOVE 'S' TO WSS-CAN-MSC-STAT
               ELSE
                   MOVE 'A' TO WSS-CAN-MSC-STAT
           ELSE
               IF WSS-IND-ADO = 'S'
                   IF CAN-MSC-STAT IN CAN = 'W'
                       IF ADO-IND-ORIG = 'S'
                            MOVE 'C' TO WSS-CAN-MSC-STAT
                       ELSE
                            MOVE 'S' TO WSS-CAN-MSC-STAT
                   ELSE
      *JSS 15-MAY-1991 14:24:59 ( manejo cargo cuenta corriente )
      *Maneja solo situacion de 'P' a 'G', paso de 'P' A 'C' en BATCH (GACA)
                   IF CAN-MSC-STAT IN CAN = 'P'
                       MOVE 'G' TO WSS-CAN-MSC-STAT
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Por ahora no se procesan con Cargo en Cta.Cte., por lo que NO
      *se Incorporo manejo del Abono/Cargo en Cta.Cte. ( Linea / Batch )
      *y de la MVO de Cta.Cte. ( Activar / Generar ).
      *DAD fin  17-MAY-1993
                   ELSE
      *
                       MOVE 'A' TO WSS-CAN-MSC-STAT
               ELSE
                   MOVE 'C' TO WSS-CAN-MSC-STAT
      *             PERFORM VRF-CAJA
      *JSS 15-MAY-1991 14:24:59 ( manejo cargo cuenta corriente )
                   IF SCR-CYA-IND-CCTE = 'S'
                       MOVE 'P' TO WSS-CAN-MSC-STAT
                   ELSE
      *
                   IF SCR-CYA-IND-CAJA = 'S'
                       MOVE 'W' TO WSS-CAN-MSC-STAT.
           IF ADO-IND-ORIG = 'S'
                PERFORM CRG-AUTO
           ELSE
           IF ADO-IND-ORIG = SPACES AND
              ( WSS-CAN-MSC-STAT = 'C' OR 'A' )
                PERFORM CRG-AUTO.
      *
      *          IF MSG-COD-MENS > SPACES
      *              GO TO FIN-CMN-ACC
      *          ELSE
      *              NEXT SENTENCE
      *     ELSE
      *ISP SI HAY CODIGOS CARGO 'CAJA' HACE CARGOS AUTOMATICOS
      *    BUSCA LA RELACION ENTRE CLAVES DE 'COL' Y CLAVES 'SAFE'.
      *    EN CASO DE RESULTAR EXITOSO, MODIFICA ARCHIVO SAFE.
      *    ESTO LO HACE SOLO PARA ACTIVACIONES INTERNAS DE ESTE PROGRAMA
      *    NO POR INGRESO DE OPERACIONES NI RESPUESTAS DEL SAFE
      *     IF WSS-CAN-MSC-STAT = 'S' OR 'W' AND
            IF WSS-IND-ADO NOT = 'S' AND
               ADO-IND-ORIG NOT = 'O'
                PERFORM REL-COL-SAF
                IF MSG-COD-MENS > SPACES
      *DAD ini  20-ENE-1992   (Memo.18-12-91)
                    GO TO BCK-CMN-ACC
      *DAD fin  20-ENE-1992
                ELSE
                    PERFORM FIJ-SAFE
                    IF MSG-COD-MENS > SPACES
      *DAD ini  20-ENE-1992   (Memo.18-12-91)
                        GO TO BCK-CMN-ACC.
      *DAD fin  20-ENE-1992
      *      IF WSS-IND-ADO = 'S' AND
      *         ADO-IND-ORIG = 'O'
      *          PERFORM REL-COL-SAF
      *          IF MSG-COD-MENS > SPACES
      *              GO TO FIN-CMN-ACC
      *          ELSE
      *              MOVE FIO-GET-KEY-UPD TO FIO-CMND
      *              PERFORM COL-FIO-CRS
      *              PERFORM MOVE-SAFE-1
      *              MOVE FIO-MOD TO FIO-CMND
      *              PERFORM COL-FIO-CRS.
      *ISP NO HACE EL RET-ALL DEL ESQUELETO, PUES EN REVERSAS SE PISA
      *    LOS CAMPOS DE CAN YA SETEADOS CON SIGNOS INVERTIDOS CON LOS
      *    VALORES DE LA PANTALLA
           MOVE CAN-NUM-SOUT IN CAN-FLD TO CAN-NUM-SOUT IN CAN.
           MOVE CAN-NUM-AOUT IN CAN-FLD TO CAN-NUM-AOUT IN CAN.
           MOVE CAN-NUM-MOUT IN CAN-FLD TO CAN-NUM-MOUT IN CAN.
           MOVE CAN-NUM-DOUT IN CAN-FLD TO CAN-NUM-DOUT IN CAN.
           GO TO NOT-RET-ALL.
      *>>>>
*% END
*% IF CMN_ACC
      *<<<< CMN_ACC
       NOT-RET-ALL.
           IF NOT ( SCR-MSC-TCAN = 'C' OR
                    WSS-IND-ADO  = 'S' )
               GO TO CON-ACA.
           PERFORM INI-CAN.
           IF WSS-CAN-MSC-STAT = 'A'
      *DAD ini  11-JUN-1993   (Memo.26-02-93)
      *         IF CAN-MSC-FCAN IN CAN = 'T' AND
      *            CAN-MSC-ECAN IN CAN = 'T'
               IF ( CAN-MSC-FCAN IN CAN = 'T' AND
                    CAN-MSC-ECAN IN CAN = 'T' ) OR
                  ( CAN-MSC-FCAN IN CAN = 'T' AND
                    CAN-MSC-ECAN IN CAN = 'E' AND
                    OPC-NUM-VCOR IN OPC = 1 )
      *DAD fin  11-JUN-1993
                  PERFORM TOT-CUO
               ELSE
                  PERFORM PRO-RCV.
      *DAD ini  20-ENE-1992   (Memo.18-12-91)
       BCK-CMN-ACC.
      *DAD fin  20-ENE-1992
           IF MSG-COD-MENS > SPACES
*% IF PGM_PTC
      *DAD ini PTC
               MOVE 'S'   TO SCR-IERR
      *DAD fin PTC
*% END
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               PERFORM BCK-OUT
               GO TO FIN-CMN-ACC.
       CON-ACA.
      *JSS
           PERFORM SET-STTR-RCV.
      *
           MOVE WSS-CAN-MSC-STAT TO CAN-MSC-STAT IN CAN.
           IF WSS-IND-RNOA = 'S'
               MOVE 'A' TO CAN-MSC-STAT IN CAN.
           PERFORM PUT-FHOY.
      *DAD ini  09-AGO-1994   (Memo.15-07-94)
      *ALD-BCI-INI/29.02.1996
      *    PERFORM CHQ-USP.
      *    MOVE USP-COD-USUARIO TO CAN-COD-ATRN IN CAN.
           MOVE SCR-USER        TO CAN-COD-ATRN IN CAN.
      *ALD-BCI-FIN/29.02.1996
      *DAD fin  09-AGO-1994
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF REV-MSG > SPACES
               MOVE REV-MSG TO FRM-MENS
           ELSE
               IF FIO-STAT-OKS
                   IF CAN-MSC-STAT IN CAN = 'S'
                      MOVE 'COL'          TO MSG-COD-SIST
                      MOVE 'CAN    SAFOK' TO MSG-COD-MENS
                      PERFORM GET-MSG
                      MOVE MSG-GLS-DESC TO FRM-MENS
                   ELSE
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Para Proceso Genera y Activa con registro MVO (Pro. Linea y Batch) 'H'
                   IF CAN-MSC-STAT IN CAN = 'G' OR 'H'
      *DAD fin  17-MAY-1993
                      MOVE 'COL'          TO MSG-COD-SIST
                      MOVE 'CAN    CCTOK' TO MSG-COD-MENS
                      PERFORM GET-MSG
                      MOVE MSG-GLS-DESC TO FRM-MENS
                   ELSE
                   IF CAN-MSC-STAT IN CAN = 'C'
                       IF CAN-MSC-TCAN IN CAN = 'N'
                           MOVE 'COL'          TO MSG-COD-SIST
                           MOVE 'CAN    NOVYA' TO MSG-COD-MENS
                           PERFORM GET-MSG
                           MOVE MSG-GLS-DESC TO FRM-MENS
                       ELSE
                           IF CAN-MSC-TCAN IN CAN = 'R'
                               MOVE 'COL'          TO MSG-COD-SIST
                               MOVE 'CAN    RENYA' TO MSG-COD-MENS
                               PERFORM GET-MSG
                               MOVE MSG-GLS-DESC TO FRM-MENS
                           ELSE
                               MOVE 'COL'          TO MSG-COD-SIST
                               MOVE 'CAN    PROYA' TO MSG-COD-MENS
                               PERFORM GET-MSG
                               MOVE MSG-GLS-DESC TO FRM-MENS
                   ELSE
                   IF CAN-MSC-STAT IN CAN = 'W' OR 'P'
                      MOVE 'COL'          TO MSG-COD-SIST
                      MOVE 'CAN    ALLYA' TO MSG-COD-MENS
                      PERFORM GET-MSG
                      MOVE MSG-GLS-DESC TO FRM-MENS
                   ELSE
                      MOVE 'COL'          TO MSG-COD-SIST
                      MOVE 'CAN    ACAOK' TO MSG-COD-MENS
                      PERFORM GET-MSG
                      MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
                   MOVE 'COL'          TO MSG-COD-SIST
                   MOVE 'CAN    ACANO' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.

      *DAD ini  01-DIC-1993
      * Chequea condiciones para permitir el enganche con Rutina que
      * Revisa y Elimina Vencimientos Morosos
           IF NOT ( CAN-MSC-CANC IN CAN = 'CTE' AND
                    CAN-MSC-STAT IN CAN = 'A'   AND
      *DPM ini  19-APR-1996
      *              SCR-CMND = 'CAN' OR 'CVC' )
                    SCR-CMND = 'CAN' OR 'CVC' OR 'CAB' )
      *DPM fin  19-APR-1996
               GO TO CON-CMN-ACC-EVM-FIN.

      * Discrimina el efectuar enganche a programa que
      *  Elimina Vencimientos Morosos
           MOVE 'COL'          TO FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'BCI    EVMOR' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND
                    TAB-MSC-STAT IN TAB = 'S' )
               GO TO CON-CMN-ACC-EVM-FIN.

      * Carga Codigo de la Cancelacion activada, RUT del Deudor Directo
      * y Fecha del Vencimiento para rutina EVM
           MOVE CAN-CAI-IOPC IN CAN-FLD TO EVM-CAIO IN EVM-VARI.
           MOVE CAN-IIC-IOPC IN CAN-FLD TO EVM-IICO IN EVM-VARI.
           MOVE DBC-NUM-ICLI IN CAN-FLD TO EVM-NCLI IN EVM-VARI.
           MOVE DBC-VRF-ICLI IN CAN-FLD TO EVM-VCLI IN EVM-VARI.
           MOVE VEN-NUM-DVEN IN CAN-FLD TO EVM-DVEN IN EVM-VARI.
           MOVE VEN-NUM-MVEN IN CAN-FLD TO EVM-MVEN IN EVM-VARI.
           MOVE VEN-NUM-SVEN IN CAN-FLD TO EVM-SVEN IN EVM-VARI.
           MOVE VEN-NUM-AVEN IN CAN-FLD TO EVM-AVEN IN EVM-VARI.
           MOVE IDD-FSIS IN IDD-VARI    TO EVM-VIDD IN EVM-VARI.
           MOVE EVM-CMMA IN EVM-VARI    TO SYS-CMMA.
           MOVE EVM-TCMA IN EVM-VARI    TO SYS-TCMA.
           MOVE 'COLPPEVM'              TO SYS-PROG.
           MOVE SYS-LINK                TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA TO EVM-CMMA IN EVM-VARI.
           IF EVM-CMSG IN EVM-VARI > SPACES
      *         MOVE 'COL'                TO MSG-COD-SIST
      *         MOVE EVM-CMSG IN EVM-VARI TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         MOVE MSG-GLS-DESC         TO FRM-MEN1
      *         MOVE EVM-MENS IN EVM-VARI TO FRM-MEN2
      *         MOVE FIO-BCK-OUT          TO FIO-CMND
      *         PERFORM COL-FIO-CAN
      *         GO TO FIN-CMN-ACC.
               GO TO CON-CMN-ACC-EVM-FIN.
       CON-CMN-ACC-EVM-FIN.
      *DAD fin  01-DIC-1993
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      *DAD ini  09-AGO-1994   (Memo.15-07-94)
       CHQ-USP SECTION.
       INI-CHQ-USP.
           COPY USPC143.
       FIN-CHQ-USP.
           EXIT.
      *DAD fin  09-AGO-1994
      *DAD ini  02-ENE-1992   (Memo.09-12-91)
       VAL-OFI-USP SECTION.
       INI-VAL-OFI-USP.
      *DAD ini  09-AGO-1994   (Memo.15-07-94)
           PERFORM CHQ-USP.
      *DAD fin  09-AGO-1994
      *DAD ini  18-JUL-1994   (Memo.23-06-94)
           MOVE TAB-GLS-ABRV IN TAB TO WSS-COD-OFOC IN WSS-VARI.
           IF USP-COD-OFICINA = WSS-COD-OFOC IN WSS-VARI
               GO TO FIN-VAL-OFI-USP.
      *DAD fin  18-JUL-1994
           IF USP-COD-OFICINA NOT = OPC-COD-OFOC IN OPC
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'OFIUSP NOACA' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC    TO FRM-MEN1
               MOVE USP-COD-OFICINA TO FRM-MEN2
               MOVE SCR-STAT-CON    TO SCR-STAT.
       FIN-VAL-OFI-USP.
           EXIT.
      *DAD fin  02-ENE-1992
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Para Proceso Genera y Activa con registro MVO (Pro. Linea y Batch)
      *DAD ini  20-ABR-1993   (Memo.19-04-93)
      *DAD ini  18-MAR-1993   (Memo.07-09-92)
       GEN-REG-MVO SECTION.
       INI-GEN-REG-MVO.
           MOVE SPACES TO MVO-CMSG.
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE 1                   TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-GEN-REG-MVO.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS AND
                    CYA-CIC-IOPC IN CYA = CAN-CIC-IOPC IN CAN AND
                    CYA-NUM-ICAN IN CYA = CAN-NUM-ICAN IN CAN )
               GO TO FIN-GEN-REG-MVO.
           IF CYA-SGV-LIQU IN CYA = ZEROES
               GO TO NXT-GEN-REG-MVO.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY TO MVO-DPRO.
           MOVE HOY-MHOY TO MVO-MPRO.
           MOVE HOY-SHOY TO MVO-SPRO.
           MOVE HOY-AHOY TO MVO-APRO.
           MOVE 'C'      TO MVO-ORIG.
           EXEC CICS ADDRESS
                     TWA(TWA-PNT0)
           END-EXEC.
           PERFORM COL-GEN-MVO.
           IF MVO-CMSG > SPACES
               MOVE MVO-MEN2 TO FRM-MEN2
               GO TO FIN-GEN-REG-MVO.
       NXT-GEN-REG-MVO.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-GEN-REG-MVO.
       FIN-GEN-REG-MVO.
           EXIT.
      *DAD fin  17-MAY-1993 / 20-ABR-1993 / 18-MAR-1993

       INIT-SAFE SECTION.
       INI-INIT-SAFE.
           MOVE SPACES TO MSG-COD-MENS FRM-MENS.
           MOVE 'TAB'    TO FIO-SIST.
           MOVE 'VLR'    TO TAB-CIC-TTAB.
           MOVE '0999  ' TO TAB-CIC-CTAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'CIC0999NEX' TO MSG-COD-MENS
               GO TO FIN-INIT-SAFE.
           MOVE TAB-COD-CTAB TO WSS-COD-PESO IN WSS-VARI.
           MOVE 'TAB'    TO FIO-SIST.
           MOVE 'VLR'    TO TAB-CIC-TTAB.
           MOVE '0998  ' TO TAB-CIC-CTAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'CIC0998NEX' TO MSG-COD-MENS
               GO TO FIN-INIT-SAFE.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-UFES IN WSS-VARI.
      *
           MOVE LOW-VALUES TO CRS-COD-ISAF IN CRS.
           MOVE ZEROES TO WSS-AUX IN WSS-VARI.
           ADD 11 TO WSS-AUX IN WSS-VARI.
           MULTIPLY WSS-AUX IN WSS-VARI BY 16 GIVING
                                 WSS-AUX IN WSS-VARI.
           ADD 4 TO WSS-AUX IN WSS-VARI.
           MOVE WSS-AUX IN WSS-VARI TO WSS-AUX-DLIM IN WSS-VARI.
           MOVE WSS-AUX-DLI2 TO CRS-GLS-LREG IN CRS.
           MOVE ZEROES TO WSS-AUX IN WSS-VARI.
           ADD 4 TO WSS-AUX IN WSS-VARI.
           MULTIPLY WSS-AUX IN WSS-VARI BY 16 GIVING
                                 WSS-AUX IN WSS-VARI.
           MOVE WSS-AUX IN WSS-VARI TO WSS-AUX-DLIM IN WSS-VARI.
           MOVE WSS-AUX-DLI2 TO CRS-COD-ARCH IN CRS.
           MOVE LOW-VALUES TO CRS-GLS-UDJN IN CRS.
           MOVE LOW-VALUES TO CRS-GLS-TERM IN CRS.
           MOVE LOW-VALUES TO CRS-COD-EST1 IN CRS.
           MOVE LOW-VALUES TO CRS-COD-EST2 IN CRS.
           MOVE LOW-VALUES TO CRS-COD-MCSL IN CRS.
           MOVE ZEROES     TO CRS-VAL-VCCP IN CRS.
           MOVE ZEROES     TO CRS-VAL-PAGO IN CRS.
           MOVE ZEROES     TO CRS-VAL-PNEG IN CRS.
           MOVE LOW-VALUES TO CRS-COD-MICR IN CRS.
           MOVE SPACES     TO CRS-COD-OFRC IN CRS.
           MOVE LOW-VALUES TO CRS-FEC-FCAN IN CRS.
           MOVE ZEROES     TO CRS-NUM-VNEG IN CRS.
           MOVE ZEROES     TO CRS-VAL-VCNC IN CRS.
           MOVE ZEROES     TO CRS-VAL-MNEG IN CRS.
           MOVE ZEROES     TO CRS-VAL-GNEG IN CRS.
           MOVE ZEROES     TO CRS-VAL-MORA IN CRS.
           MOVE SPACES     TO CRS-MSC-CANC IN CRS.
           MOVE '00'       TO CRS-IND-ACTU IN CRS.
           MOVE '00'       TO CRS-IND-PNEG IN CRS.
           MOVE ZEROES     TO BCD-DAT3-INT IN BCD-VARI.
           MOVE BCD-DAT3 IN BCD-VARI TO CRS-DMA-FUTS IN CRS.
           MOVE ZEROES     TO CRS-DMA-FVCN IN CRS.
      *********
           MOVE ICG-KEY-IICG IN ICG TO WSS-KEY-IICG.
           MOVE OPC-CIC-IOPC IN OPC TO ICG-CIC-IOPC IN ICG.
           MOVE ZEROES              TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE 'INT'               TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG
           IF NOT ( FIO-STAT-OKS AND
                    ICG-CIC-IOPC IN ICG = OPC-CIC-IOPC IN OPC AND
                    ICG-NUM-ICAN IN ICG = ZEROES              AND
                    ICG-CIC-IOPV IN ICG = SPACES              AND
                    ICG-NUM-IVCT IN ICG = ZEROES              AND
                    ICG-IND-TTAS IN ICG = 'INT' )
                   MOVE 'ICG    NEX' TO MSG-COD-MENS
                   GO TO FIN-INIT-SAFE.
           IF ICG-COD-CVTI IN ICG > SPACES
               MOVE ICG-SGV-SPRD IN ICG TO CRS-VAL-TASA IN CRS
           ELSE
               MOVE ICG-SGV-TINT IN ICG TO CRS-VAL-TASA IN CRS.
           MOVE WSS-KEY-IICG TO ICG-KEY-IICG IN ICG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ICG
      *
           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS-VARI
               MOVE VEN-VAL-SFIN IN VEN TO CRS-VAL-VENP IN CRS
           ELSE
               MOVE VEN-VAL-SFIN IN VEN TO CRS-VAL-VENO IN CRS.
           MOVE VEN-VAL-SCAP IN VEN TO CRS-VAL-SCAP IN CRS.
           MOVE VEN-NUM-IVEN IN VEN TO CRS-NUM-IVEN IN CRS.
           MOVE VEN-NUM-AVEN IN VEN TO CRS-NUM-AVEN IN CRS.
           MOVE VEN-NUM-MVEN IN VEN TO CRS-NUM-MVEN IN CRS.
           MOVE VEN-NUM-DVEN IN VEN TO CRS-NUM-DVEN IN CRS.
           MOVE VEN-NUM-AIMV IN VEN TO CRS-NUM-AIMV IN CRS.
           MOVE VEN-NUM-MIMV IN VEN TO CRS-NUM-MIMV IN CRS.
           MOVE VEN-NUM-DIMV IN VEN TO CRS-NUM-DIMV IN CRS.
           MOVE OPC-COD-OFOC IN OPC TO CRS-COD-OFOC IN CRS.
           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS-VARI
               MOVE '01' TO CRS-COD-MONS IN CRS
           ELSE
               MOVE '98' TO CRS-COD-MONS IN CRS.

           MOVE OPC-COD-COOC IN OPC TO CRS-COD-AUXI IN CRS.
           IF OPC-COD-COOC IN OPC > SPACES
               MOVE 'COL'               TO TAB-COD-SIST FIO-SIST
               MOVE 'AUX'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-COOC IN OPC TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-TAB
               IF FIO-STAT-OKS
                   MOVE TAB-GLS-DAT3 TO WSS-GLS-DAT3 IN WSS-VARI
                   MOVE WSS-IND-TCRE IN WSS-VARI TO CRS-IND-TCRE IN CRS
               ELSE
                   MOVE 'OPCCOOCNEX' TO MSG-COD-MENS
                   MOVE OPC-COD-COOC IN OPC TO FRM-MEN2
                   GO TO FIN-INIT-SAFE
           ELSE
               MOVE SPACES TO CRS-IND-TCRE IN CRS.
           MOVE OPC-NUM-ACOL IN OPC TO CRS-NUM-ACOL IN CRS.
           MOVE OPC-NUM-MCOL IN OPC TO CRS-NUM-MCOL IN CRS.
           MOVE OPC-NUM-DCOL IN OPC TO CRS-NUM-DCOL IN CRS.
           MOVE DBC-IDC-ICLI IN DBC TO CRS-IDC-IDEU IN CRS.
           MOVE DBC-VRF-ICLI IN DBC TO CRS-VRF-IDEU IN CRS.
           MOVE OPC-CIC-IOPC IN OPC TO CRS-KEY-IOPC IN CRS.
           MOVE '2' TO CRS-IND-TSIS IN CRS.
           IF OPC-COD-TOPC IN OPC > SPACES
               IF OPC-COD-TOPC NOT NUMERIC
                   MOVE '1' TO CRS-IND-TSIS IN CRS.
      * Busca Plazo de Documento Legal de Operacion de Credito con VEN-NUM-IDLC
      *BUS-TAB busca glosa de codigo en tabla
           IF DLC-COD-PLZO IN DLC > SPACES
               MOVE 'TAB' TO TAB-COD-SIST FIO-SIST
               MOVE 'PZO' TO TAB-COD-TTAB IN TAB
               MOVE DLC-COD-PLZO IN DLC TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-TAB
               IF FIO-STAT-OKS
                   MOVE TAB-COD-DAT1(1) TO CRS-IND-PLZO IN CRS
               ELSE
                   MOVE 'DLCPLZONEX' TO MSG-COD-MENS
                   MOVE DLC-COD-PLZO IN DLC TO FRM-MEN2
                   GO TO FIN-INIT-SAFE
           ELSE
               MOVE SPACES TO CRS-IND-PLZO IN CRS.

      *    IF WSS-IND-FUTU IN WSS-VARI = 'F'
               MOVE '01' TO CRS-IND-ACTU IN CRS.
               MOVE '04' TO CRS-IND-PNEG IN CRS.
      *        MOVE WSS-NUM-IVAC IN WSS-VARI TO CRS-NUM-IVEN IN CRS.

           MOVE DLC-VAL-SDLC IN DLC TO CRS-VAL-SDLC IN CRS.
           IF OPC-COD-VCOC IN OPC = WSS-COD-UFES IN WSS-VARI
               MOVE CRS-VAL-VENO IN CRS TO MUF-SGV-VAUF IN MUF-VARI
               PERFORM MUL-VAUF
               MOVE MUF-SGV-VAUF IN MUF-VARI TO CRS-VAL-VENO IN CRS
               MOVE CRS-VAL-SCAP IN CRS TO MUF-SGV-VAUF IN MUF-VARI
               PERFORM MUL-VAUF
               MOVE MUF-SGV-VAUF IN MUF-VARI TO CRS-VAL-SCAP IN CRS
               MOVE CRS-VAL-SDLC IN CRS TO MUF-SGV-VAUF IN MUF-VARI
               PERFORM MUL-VAUF
               MOVE MUF-SGV-VAUF IN MUF-VARI TO CRS-VAL-SDLC IN CRS.
      *RVM-CST-INI 28-NOV-1996
           IF CAN-SGV-GAST IN CAN > ZEROES
               MOVE 'S' TO CRS-IND-CCOM IN CRS.
      *RVM-CST-FIN 28-NOV-1996
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-CRS.
       FIN-INIT-SAFE.
           EXIT.
       COPY COLBGMUF.

       SET-STTR-RCV SECTION.
       INI-SET-STTR-RCV.
           MOVE SPACES TO MSG-COD-MENS.
           IF SCR-CMND = 'REV'
               MOVE CAN-CAI-IOPC IN CAN-BKP TO RCV-CAI-IOPC IN RCV
               MOVE CAN-IIC-IOPC IN CAN-BKP TO RCV-IIC-IOPC IN RCV
               MOVE CAN-NUM-ICAN IN CAN-BKP TO RCV-NUM-ICAN IN RCV
               MOVE CAN-CAI-IOPC IN CAN-BKP TO RCV-CAI-IOPV IN RCV
               MOVE CAN-IIC-IOPC IN CAN-BKP TO RCV-IIC-IOPV IN RCV
               MOVE VEN-NUM-IVCT IN CAN-FLD TO RCV-NUM-IVCT IN RCV
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-RCV
               IF FIO-STAT-OKS
                   MOVE 'R' TO RCV-MSC-STAT IN RCV
                   MOVE FIO-MOD TO FIO-CMND
                   PERFORM COL-FIO-RCV.
      *             IF FIO-STAT-OKS
      *                 NEXT SENTENCE
      *             ELSE
      *                 MOVE 'RCV    NOMOD' TO MSG-COD-MENS
      *         ELSE
      *             MOVE 'RCV    NOGKU' TO MSG-COD-MENS.
       FIN-SET-STTR-RCV.
           EXIT.
      **************************************************************************
      *DAD ini  20-OCT-1992   (Memo.08-10-92)
       ACT-VEN-SHFT-REV-TT SECTION.
       INI-ACT-VEN-SHFT-REV-TT.
      * Lee Fisicamente el Segundo VEN
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
           MOVE 2                   TO VEN-NUM-IVEN IN VEN.
      *LRH ini 9-ABR-1994
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM COL-FIO-VEN.
      *     IF NOT FIO-STAT-OKS
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = VEN-CIC-IOPC IN VEN AND
                    VEN-NUM-IVEN IN VEN = 2 )
      *LRH fin 9-ABR-1994
               GO TO FIN-ACT-VEN-SHFT-REV-TT.
       LUP-ACT-VEN-SHFT-REV-TT.
           IF NOT ( ( VEN-VAL-CAPI IN VEN     > ZEROES AND
                      VEN-VAL-SCAP IN VEN NOT > ZEROES ) OR
                    ( VEN-VAL-FINA IN VEN     > ZEROES AND
                      VEN-VAL-SFIN IN VEN NOT > ZEROES ) )
               GO TO NXT-ACT-VEN-SHFT-REV-TT.

      * Modifica el VEN tomado de UPD
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
               MOVE 'VENSHFTNOUPD' TO MSG-COD-MENS
               GO TO FIN-ACT-VEN-SHFT-REV-TT.

           IF ( VEN-VAL-CAPI IN VEN     > ZEROES AND
                VEN-VAL-SCAP IN VEN NOT > ZEROES )
               MOVE VEN-VAL-CAPI IN VEN TO VEN-VAL-SCAP IN VEN.
           IF ( VEN-VAL-FINA IN VEN     > ZEROES AND
                VEN-VAL-SFIN IN VEN NOT > ZEROES )
               MOVE VEN-VAL-FINA IN VEN TO VEN-VAL-SFIN IN VEN.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
               MOVE 'VENSHFTNOMOD' TO MSG-COD-MENS
               GO TO FIN-ACT-VEN-SHFT-REV-TT.
       NXT-ACT-VEN-SHFT-REV-TT.
      * Lee fisicamente el Siguiente VEN
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = VEN-CIC-IOPC IN VEN )
               GO TO FIN-ACT-VEN-SHFT-REV-TT.
           GO TO LUP-ACT-VEN-SHFT-REV-TT.
       FIN-ACT-VEN-SHFT-REV-TT.
           EXIT.
      *DAD fin  20-OCT-1992
      **************************************************************************

       ADO-CAN SECTION.
       INI-ADO-CAN.
      *DAD ini  13-SEP-1991
           MOVE SPACES TO ADO-GLS-MENS.
      *DAD fin  13-SEP-1991
           IF ADO-IND-ORIG = 'S'
               PERFORM ADO-SAFE
               IF ADO-GLS-MENS > SPACES
                   MOVE ADO-KEY-IOPC        TO CAN-CIC-IOPC IN CAN
                   MOVE RCV-NUM-ICAN IN RCV TO CAN-NUM-ICAN IN CAN
                   MOVE FIO-GET-KEY TO FIO-CMND
                   PERFORM COL-FIO-CAN
                   PERFORM GET-FHOY
                   MOVE HOY-DHOY IN HOY-VARI TO SYS-DHOY IN SYS-VARI
                   MOVE HOY-MHOY IN HOY-VARI TO SYS-MHOY IN SYS-VARI
                   MOVE HOY-AHOY IN HOY-VARI TO SYS-AHOY IN SYS-VARI
                   MOVE HOY-SHOY IN HOY-VARI TO SYS-SHOY IN SYS-VARI
                   MOVE HOY-HHOY IN HOY-VARI TO SYS-HHOY IN SYS-VARI
                   PERFORM BUS-COR-ERR
                   MOVE MSG-COD-MENS TO ERR-COD-MENS IN ERR
                   MOVE 'COLPPCAN'   TO ERR-COD-ATRN IN ERR
                   MOVE ERR-SVRT-FAT TO ERR-IND-SVRT IN ERR
                   MOVE ERR-TERR-VLD TO ERR-COD-TERR IN ERR
                   MOVE ADR-CAN-REQA TO ADR-REQA
      *DAD ini  03-OCT-1991
                   MOVE FRM-MEN2     TO ERR-GLS-ANEX IN ERR
      *DAD fin  03-OCT-1991
                   PERFORM PRO-IER
               ELSE
                   NEXT SENTENCE
           ELSE
      * UNA CANCELACION RELACIONADA CON MULTIPLES OPC ( NOVACION )
           IF ADO-MSC-TCAN = ADO-MSC-MOPC
               MOVE ADO-KEY-ICAN TO CAN-KEY-ICAN IN CAN
               PERFORM CAN-ROV-CAN
           ELSE
           IF ADO-MSC-TCAN = ADO-MSC-MCAN
               PERFORM ADO-CAN-MCAN.
       FIN-ADO-CAN.
           EXIT.

       PUT-STAT-CAN SECTION.
       INI-PUT-STAT-CAN.
           MOVE FIO-STAT TO PGM-STAT-CAN.
      *BUS-TAB busca glosa de codigo en tabla.
           MOVE 'COL'               TO TAB-COD-SIST.
           MOVE 'CNC'               TO TAB-COD-TTAB IN TAB.
           MOVE CAN-MSC-CANC IN CAN TO TAB-COD-CTAB IN TAB.
      *ALD-BCI-INI/08.04.1999
           MOVE CAN-STP-ITRN IN CAN TO SCR-UMOD.
      *ALD-BCI-FIN/08.04.1999       
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO SCR-MSC-CCNC.
           MOVE TAB-CIC-CTAB IN TAB TO SCR-MSC-CANC.
           PERFORM CMN-ACC.
           IF CAN-MSC-STAT IN CAN = 'A' OR
              ( CAN-MSC-STAT IN CAN = 'S' AND ADO-IND-ORIG = 'O' ) OR
              ( CAN-MSC-STAT IN CAN = 'C' AND ADO-IND-ORIG = 'S' ) OR
      *JSS 15-MAY-1991 14:24:59 ( manejo cargo cuenta corriente )
      *Maneja solo situacion de 'P' a 'G', paso de 'P' A 'C' en BATCH (GACA)
              ( CAN-MSC-STAT IN CAN = 'G' AND ADO-IND-ORIG = 'O' )
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Por ahora no se procesan con Cargo en Cta.Cte., por lo que NO
      *se Incorporo manejo del Abono/Cargo en Cta.Cte. ( Linea / Batch )
      *y de la MVO de Cta.Cte. ( Activar / Generar ).
      *DAD fin  17-MAY-1993
      *
               MOVE SPACES TO ADO-GLS-MENS
           ELSE
               MOVE MSG-GLS-DESC TO ADO-GLS-MENS.
       FIN-PUT-STAT-CAN.
           EXIT.
       CAN-ROV-CAN SECTION.
       INI-CAN-ROV-CAN.
           MOVE ZEROES TO VEN-NUM-IVEN IN VEN VEN-NUM-IVCT IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           MOVE FIO-STAT TO PGM-STAT-CAN.
           PERFORM PUT-CAN-CAN.
           PERFORM BUS-VEN-ADO.
           PERFORM PUT-STAT-CAN.
       FIN-CAN-ROV-CAN.
           EXIT.
       ADO-CAN-MCAN SECTION.
       INI-ADO-CAN-MCAN.
           MOVE ADO-KEY-IOPC TO ROV-CIC-IOPC IN ROV.
           MOVE LOW-VALUES TO ROV-KEY-IVCT IN ROV.
           MOVE FIO-GET-NLS TO FIO-CMND.
       CIC-ADO-CAN-MCAN.
           PERFORM COL-FIO-ROV.
           IF FIO-STAT-OKS AND
              ADO-KEY-IOPC = ROV-CIC-IOPC IN ROV
                MOVE ROV-KEY-IVCT IN ROV TO CAN-KEY-ICAN IN CAN
                PERFORM CAN-ROV-CAN
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO CIC-ADO-CAN-MCAN.
       FIN-ADO-CAN-MCAN.
           EXIT.
       BUS-VEN-ADO SECTION.
       INI-BUS-VEN-ADO.
           MOVE CAN-CIC-IOPC IN CAN TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF OPC-IND-VSTR IN OPC = 'S'
                MOVE CAN-CIC-IOPC IN CAN TO VEN-CIC-IOPC IN VEN
                MOVE 1 TO VEN-NUM-IVEN IN VEN
                MOVE FIO-GET-KEY TO FIO-CMND
                PERFORM COL-FIO-VEN
                IF FIO-STAT-OKS
                     MOVE VEN-NUM-IVCT IN VEN TO VEN-NUM-IVEN IN VEN
                     MOVE VEN-NUM-IVCT IN VEN TO VEN-NUM-IVEN
                                                         IN CAN-FLD
                ELSE
                     MOVE 1 TO VEN-NUM-IVEN IN CAN-FLD
           ELSE
                MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
                MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN CAN-FLD.

      *ALD-BCI-INI/09.10.1996
           MOVE VEN-NUM-IVEN IN CAN-FLD TO VEN-NUM-IVCT IN CAN-FLD.
      *ALD-BCI-FIN/09.10.1996

           MOVE VEN-NUM-IVEN IN VEN TO SCR-VEN-NUM-IVEN.
       FIN-BUS-VEN-ADO.
           EXIT.

       BUS-VEN-ADO-SAFE SECTION.
       INI-BUS-VEN-ADO-SAFE.
           MOVE WSS-ADO-NUM-IVCT TO VEN-NUM-IVEN IN VEN.
           MOVE WSS-ADO-NUM-IVCT TO VEN-NUM-IVEN IN CAN-FLD.
           MOVE VEN-NUM-IVEN IN VEN TO SCR-VEN-NUM-IVEN.
       FIN-BUS-VEN-ADO-SAFE.
           EXIT.

       ADO-SAFE SECTION.
       INI-ADO-SAFE.
           IF SCR-CMND = 'REV'
               PERFORM ADO-SAFE-REV
           ELSE
               PERFORM ADO-SAFE-CAN.
       FIN-ADO-SAFE.
           EXIT.

       ADO-SAFE-CAN SECTION.
       INI-ADO-SAFE-CAN.
           PERFORM OBT-MON-CAN.
           IF ADO-GLS-MENS > SPACES
               GO TO FIN-ADO-SAFE-CAN.
           IF WSS-ADO-NUM-IVCT = ZEROES
               MOVE 1 TO WSS-ADO-NUM-IVCT.
       LUP-ADO-SAFE-CAN.
           MOVE ADO-KEY-IOPC TO RCV-CIC-IOPV IN RCV.
           MOVE WSS-ADO-NUM-IVCT TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-KEY TO FIO-CMND.
       ADO-SAFE-NXT-RCV.
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           PERFORM COL-FIO-RCV.
           IF FIO-STAT-OKS AND
              ADO-KEY-IOPC = RCV-CIC-IOPV IN RCV AND
              WSS-ADO-NUM-IVCT = RCV-NUM-IVCT IN RCV
               MOVE ADO-KEY-IOPC        TO CAN-CIC-IOPC IN CAN
               MOVE RCV-NUM-ICAN IN RCV TO CAN-NUM-ICAN IN CAN
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM COL-FIO-CAN
               IF FIO-STAT-OKS
      *DAD ini  14-ABR-1992   (Memo.13-03-92 pto.1)
                   IF CAN-MSC-STAT IN CAN = 'S' OR 'W'
      *DAD fin  14-ABR-1992
                       MOVE FIO-STAT TO PGM-STAT-CAN
                       PERFORM PUT-CAN-CAN
                       PERFORM BUS-VEN-ADO-SAFE
                       PERFORM PUT-CYA-SAF
                       PERFORM PUT-STAT-CAN
                   ELSE
                       MOVE FIO-GET-NXT TO FIO-CMND
                       GO TO ADO-SAFE-NXT-RCV
               ELSE
                   MOVE 'COL'          TO MSG-COD-SIST
                   MOVE 'CANSAFECANNF' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO ADO-GLS-MENS
                   GO TO FIN-ADO-SAFE-CAN
           ELSE
               MOVE ADO-KEY-IOPC TO RCV-CIC-IOPV IN RCV
               MOVE ZEROES       TO RCV-NUM-IVCT IN RCV
               MOVE 'RCV-KEY-IVCT' TO FIO-AKEY
               MOVE FIO-GET-KEY    TO FIO-CMND
               PERFORM COL-FIO-RCV
               IF FIO-STAT-OKS
                   MOVE ADO-KEY-IOPC        TO CAN-CIC-IOPC IN CAN
                   MOVE RCV-NUM-ICAN IN RCV TO CAN-NUM-ICAN IN CAN
                   MOVE FIO-GET-KEY TO FIO-CMND
                   PERFORM COL-FIO-CAN
                   IF FIO-STAT-OKS AND
      *DAD ini  14-ABR-1992   (Memo.13-03-92 pto.1)
                      CAN-MSC-STAT IN CAN = 'S' OR 'W'
      *DAD fin  14-ABR-1992
                       MOVE FIO-STAT TO PGM-STAT-CAN
                       PERFORM PUT-CAN-CAN
                       PERFORM BUS-VEN-ADO
                       IF WSS-ADO-NUM-IVCT NOT = VEN-NUM-IVEN IN VEN
                           MOVE 'COL'          TO MSG-COD-SIST
                           MOVE 'CANSAFERCVNF' TO MSG-COD-MENS
                           PERFORM GET-MSG
                           MOVE MSG-GLS-DESC TO ADO-GLS-MENS
                           GO TO FIN-ADO-SAFE-CAN
                       ELSE
                           PERFORM PUT-CYA-SAF
                           PERFORM PUT-STAT-CAN
                           GO TO FIN-ADO-SAFE-CAN
                   ELSE
                       MOVE 'COL'          TO MSG-COD-SIST
                       MOVE 'CANSAFECANNF' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO ADO-GLS-MENS
                       GO TO FIN-ADO-SAFE-CAN
               ELSE
                   MOVE 'COL'          TO MSG-COD-SIST
                   MOVE 'CANSAFERCVNF' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO ADO-GLS-MENS
                   GO TO FIN-ADO-SAFE-CAN.
           IF WSS-ADO-NUM-ICAN > 1
               ADD 1 TO WSS-ADO-NUM-IVCT
               IF WSS-ADO-NUM-IVCT NOT > ADO-NUM-IVCT
                   GO TO LUP-ADO-SAFE-CAN.
       FIN-ADO-SAFE-CAN.
           EXIT.

       OBT-MON-CAN SECTION.
       INI-OBT-MON-CAN.
           MOVE ZEROES       TO WSS-ADO-MAX-IVCT IN WSS-VARI.
           MOVE ZEROES       TO WSS-ADO-NUM-ICAN IN WSS-VARI.
           MOVE ZEROES       TO WSS-ADO-SGV-TPAG IN WSS-VARI.
           IF ADO-NUM-IVCT = ZEROES
               MOVE 1 TO ADO-NUM-IVCT.
           MOVE ADO-NUM-IVCT TO WSS-ADO-NUM-IVCT IN WSS-VARI.
       LUP-OBT-MON-CAN.
           MOVE ADO-KEY-IOPC                 TO RCV-CIC-IOPV IN RCV.
           MOVE WSS-ADO-NUM-IVCT IN WSS-VARI TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-KEY TO FIO-CMND.
       NXT-OBT-RCV-CAN.
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           PERFORM COL-FIO-RCV.
           IF FIO-STAT-OKS AND
              ADO-KEY-IOPC = RCV-CIC-IOPV IN RCV AND
              WSS-ADO-NUM-IVCT IN WSS-VARI = RCV-NUM-IVCT IN RCV
               MOVE ADO-KEY-IOPC        TO CAN-CIC-IOPC IN CAN
               MOVE RCV-NUM-ICAN IN RCV TO CAN-NUM-ICAN IN CAN
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM COL-FIO-CAN
               IF FIO-STAT-OKS 
      *DAD ini  14-ABR-1992   (Memo.13-03-92 pto.1)
                   IF CAN-MSC-STAT IN CAN = 'S' OR 'W'
      *DAD fin  14-ABR-1992
                     ADD CAN-SGV-TPAG IN CAN TO WSS-ADO-SGV-TPAG
                                                   IN WSS-VARI
                     ADD 1 TO WSS-ADO-NUM-ICAN IN WSS-VARI
                     MOVE WSS-ADO-NUM-IVCT TO WSS-ADO-MAX-IVCT
                   ELSE
                       MOVE FIO-GET-NXT TO FIO-CMND
                       GO TO NXT-OBT-RCV-CAN
               ELSE
                   MOVE FIO-GET-NXT TO FIO-CMND
                   GO TO NXT-OBT-RCV-CAN
           ELSE
               MOVE ADO-KEY-IOPC TO RCV-CIC-IOPV IN RCV
               MOVE ZEROES       TO RCV-NUM-IVCT IN RCV
               MOVE 'RCV-KEY-IVCT' TO FIO-AKEY
               MOVE FIO-GET-KEY    TO FIO-CMND
               PERFORM COL-FIO-RCV
               IF FIO-STAT-OKS
                   MOVE ADO-KEY-IOPC        TO CAN-CIC-IOPC IN CAN
                   MOVE RCV-NUM-ICAN IN RCV TO CAN-NUM-ICAN IN CAN
                   MOVE FIO-GET-KEY TO FIO-CMND
                   PERFORM COL-FIO-CAN
                   IF FIO-STAT-OKS AND
      *DAD ini  14-ABR-1992   (Memo.13-03-92 pto.1)
                      CAN-MSC-STAT IN CAN = 'S' OR 'W'
      *DAD fin  14-ABR-1992
                       ADD CAN-SGV-TPAG IN CAN TO WSS-ADO-SGV-TPAG
                                                       IN WSS-VARI
                       ADD 1 TO WSS-ADO-NUM-ICAN IN WSS-VARI
                       MOVE WSS-ADO-NUM-IVCT TO WSS-ADO-MAX-IVCT
                       GO TO NXT-OBT-MON-CAN
                   ELSE
                       GO TO NXT-OBT-MON-CAN
               ELSE
                   GO TO NXT-OBT-MON-CAN.
           SUBTRACT 1 FROM WSS-ADO-NUM-IVCT IN WSS-VARI.
           GO TO LUP-OBT-MON-CAN.
       NXT-OBT-MON-CAN.
           IF ADO-VAL-TPAG NOT = WSS-ADO-SGV-TPAG IN WSS-VARI AND
              WSS-ADO-NUM-ICAN IN WSS-VARI > 1
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CANMONSAF>CN' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO ADO-GLS-MENS.
           IF WSS-ADO-NUM-ICAN IN WSS-VARI NOT > ZEROES
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CANNEXSAFCAN' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO ADO-GLS-MENS.
           MOVE WSS-ADO-MAX-IVCT TO WSS-ADO-NUM-IVCT .
       FIN-OBT-MON-CAN.
           EXIT.

       ADO-SAFE-REV SECTION.
       INI-ADO-SAFE-REV.
           PERFORM OBT-MON-REV.
           IF ADO-GLS-MENS > SPACES
               GO TO FIN-ADO-SAFE-REV.
           MOVE ZEROES       TO WSS-ADO-SGV-TPAG IN WSS-VARI.
           MOVE ADO-KEY-IOPC        TO CAN-CIC-IOPC IN CAN.
           MOVE 999 TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-LEQ TO FIO-CMND.
       LUP-ADO-SAFE-REV.
           PERFORM COL-FIO-CAN.
           IF NOT ( FIO-STAT-OKS AND
                    ADO-KEY-IOPC  = CAN-CIC-IOPC IN CAN )
               GO TO FIN-ADO-SAFE-REV.
           MOVE ADR-CAN-REQA TO ADR-AUX-REQA.
           IF CAN-MSC-STAT IN CAN NOT = 'R' AND
              CAN-SGV-TPAG IN CAN NOT < ZEROES AND
              CAN-SGV-TREN IN CAN NOT < ZEROES
               IF CAN-MSC-STAT IN CAN NOT = 'A'
                   GO TO FIN-ADO-SAFE-REV
               ELSE
                   PERFORM OBT-CIC-CAJA
                   IF FIO-STAT-OKS
                       ADD CAN-SGV-TPAG IN CAN TO WSS-ADO-SGV-TPAG
                                                       IN WSS-VARI
                       IF ADO-VAL-TPAG NOT < WSS-ADO-SGV-TPAG
                                                       IN WSS-VARI
                           PERFORM OBT-RCV-VEN
                           MOVE '00' TO PGM-STAT-CAN
                           PERFORM PUT-CAN-CAN
                           PERFORM BUS-VEN-ADO-SAFE
                           PERFORM PUT-STAT-CAN
                       ELSE
                           GO TO FIN-ADO-SAFE-REV.     
           MOVE ADR-AUX-REQA TO ADR-CAN-REQA.
           MOVE FIO-KDEF-S  TO FIO-KDEF.
           MOVE FIO-GET-PRV TO FIO-CMND.
           GO TO LUP-ADO-SAFE-REV.
       FIN-ADO-SAFE-REV.
           EXIT.

       OBT-MON-REV SECTION.
       INI-OBT-MON-REV.
           MOVE ZEROES       TO WSS-ADO-NUM-ICAN IN WSS-VARI.
           MOVE ZEROES       TO WSS-ADO-SGV-TPAG IN WSS-VARI.
           MOVE ADO-KEY-IOPC        TO CAN-CIC-IOPC IN CAN.
           MOVE 999 TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-LEQ TO FIO-CMND.
       LUP-OBT-MON-REV.
           PERFORM COL-FIO-CAN.
           IF NOT ( FIO-STAT-OKS AND
                    ADO-KEY-IOPC  = CAN-CIC-IOPC IN CAN )
               GO TO NXT-OBT-MON-REV.
           IF CAN-MSC-STAT IN CAN NOT = 'R' AND
              CAN-SGV-TPAG IN CAN NOT < ZEROES AND
              CAN-SGV-TREN IN CAN NOT < ZEROES
               IF CAN-MSC-STAT IN CAN NOT = 'A'
                   GO TO NXT-OBT-MON-REV
               ELSE
                   PERFORM OBT-CIC-CAJA
                   IF FIO-STAT-OKS
                       ADD CAN-SGV-TPAG IN CAN TO WSS-ADO-SGV-TPAG
                                                       IN WSS-VARI
                       ADD 1 TO WSS-ADO-NUM-ICAN IN WSS-VARI
                       IF ADO-VAL-TPAG = WSS-ADO-SGV-TPAG IN WSS-VARI
                           GO TO FIN-OBT-MON-REV
                       ELSE
                       IF ADO-VAL-TPAG < WSS-ADO-SGV-TPAG IN WSS-VARI
                           GO TO NXT-OBT-MON-REV.
           MOVE FIO-GET-PRV TO FIO-CMND.
           GO TO LUP-OBT-MON-REV.
       NXT-OBT-MON-REV.
      *DAD ini  26-SEP-1991
           IF ADO-VAL-TPAG NOT = WSS-ADO-SGV-TPAG IN WSS-VARI AND
              WSS-ADO-NUM-ICAN IN WSS-VARI > 1
      *DAD fin  26-SEP-1991
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CANMONSAF>RV' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO ADO-GLS-MENS.
           IF WSS-ADO-NUM-ICAN IN WSS-VARI NOT > ZEROES
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CANNEXSAFREV' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO ADO-GLS-MENS.
       FIN-OBT-MON-REV.
           EXIT.

       OBT-CIC-CAJA SECTION.
       INI-OBT-CIC-CAJA.
           MOVE CAN-CIC-IOPC IN CAN TO OPC-CIC-IOPC IN OPC.
           PERFORM FST-CYA-CAN.
       LUP-OBT-CYA-CAJA.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS                               AND
                    CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA  AND
                    CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA )
               MOVE FIO-STAT-NEX TO FIO-STAT
               GO TO FIN-OBT-CIC-CAJA.
           MOVE 'TCYA'    TO MSC-CIC-TMSC IN MSC.
           MOVE 'CAJA'    TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
       LUP-OBT-CIC-CAJA.
           MOVE 'TAB' TO FIO-SIST.
           PERFORM GNS-FIO-MSC.
           IF NOT (FIO-STAT-OKS AND
              MSC-CIC-CMSC IN MSC = 'CAJA' AND
              MSC-CIC-TMSC IN MSC = 'TCYA' )
               MOVE FIO-STAT-NEX TO FIO-STAT
               GO TO FIN-OBT-CIC-CAJA
           ELSE
               IF MSC-COD-CMSC IN MSC = CYA-IND-TCYA IN CYA 
                   GO TO FIN-OBT-CIC-CAJA
               ELSE
                   MOVE 'MSC-CIC-TABL' TO FIO-AKEY
                   MOVE FIO-GET-NXT    TO FIO-CMND
                   GO TO LUP-OBT-CIC-CAJA.
           MOVE FIO-GET-NXT TO FIO-CMND.          
           GO TO LUP-OBT-CYA-CAJA.
       FIN-OBT-CIC-CAJA.
           EXIT.

       OBT-RCV-VEN SECTION.
       INI-OBT-RCV-VEN.
           MOVE SPACES TO RCV-KEY-IRCV IN RCV.
           MOVE CAN-KEY-ICAN IN CAN TO RCV-KEY-ICAN IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF NOT ( FIO-STAT-OKS AND
                    CAN-KEY-ICAN IN CAN = RCV-KEY-ICAN IN RCV )
               GO TO FIN-OBT-RCV-VEN.
      *DAD ini  20-ENE-1992
      *   Se carga campo en pantalla para emular llenado pantalla prog interac.
           MOVE RCV-NUM-IVCT IN RCV TO VEN-NUM-IVCT IN CAN-FLD.
      *DAD fin  20-ENE-1992
           IF RCV-NUM-IVCT IN RCV > ZEROES
               MOVE RCV-NUM-IVCT IN RCV TO WSS-ADO-NUM-IVCT IN WSS-VARI
               GO TO FIN-OBT-RCV-VEN.
           PERFORM BUS-VEN-ADO.
           MOVE VEN-NUM-IVEN IN VEN TO WSS-ADO-NUM-IVCT IN WSS-VARI.
       FIN-OBT-RCV-VEN.
           EXIT.

       GET-STAT-ADO SECTION.
       INI-GET-STAT-ADO.
               MOVE 'S' TO WSS-IND-ADO
               IF ADO-CMND = 'REV'
                   MOVE ADO-CMND TO SCR-CMND
               ELSE
                   MOVE 'CAN' TO SCR-CMND.
               MOVE 'COL'        TO SCR-SIST
               MOVE 'COLPMCAN'   TO SCR-PROG
               MOVE FRM-FFLD-RET TO FRM-FFLD
               MOVE FRM-FFLD-RET TO SCR-FFLD
               MOVE ADO-FIDD TO IDD-FSIS IN IDD-VARI
               MOVE SCR-STAT-SON TO SCR-STAT
               MOVE SCR-VFLD-YES TO SCR-VFLD.
      *ALD-BCI-INI
               MOVE 'N' TO SCR-OFRM.
      *ALD-BCI-FIN
       FIN-GET-STAT-ADO.
           EXIT.
       FIJ-SAFE SECTION.
       INI-FIJ-SAFE.
           MOVE ZEROES TO WSS-I.
           MOVE SPACES TO MSG-COD-MENS.
           PERFORM FST-CYA-CAN.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS                              AND
                    OPC-CIC-IOPC IN OPC = CYA-CIC-IOPC IN CYA AND
                    CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA )
                      MOVE FIO-GET-KEY-UPD TO FIO-CMND
                      PERFORM COL-FIO-CRS
                      PERFORM MOVE-SAFE-2
                      MOVE FIO-MOD TO FIO-CMND
                      PERFORM COL-FIO-CRS
                      GO TO FIN-FIJ-SAFE.
       CIC-FIJ-SAFE.
           IF NOT ( FIO-STAT-OKS                              AND
                    OPC-CIC-IOPC IN OPC = CYA-CIC-IOPC IN CYA AND
                    CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA )
                      GO TO FIN-FIJ-SAFE.
           MOVE 'TAB'               TO MSC-COD-SIST.
           MOVE 'TCYA'              TO MSC-COD-TMSC IN MSC.
           MOVE CYA-IND-TCYA IN CYA TO MSC-COD-CMSC IN MSC.
           MOVE SPACES TO MSC-CIC-CMSC IN MSC.
           PERFORM BUS-MSC.
           IF MSC-CIC-CMSC IN MSC = 'CAJA'
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-CRS
               PERFORM MOVE-SAFE
               MOVE FIO-MOD TO FIO-CMND
               PERFORM COL-FIO-CRS
           ELSE
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-CRS
               PERFORM MOVE-SAFE-1
               MOVE FIO-MOD TO FIO-CMND
               PERFORM COL-FIO-CRS.
           IF FIO-STAT-OKS
               MOVE FIO-GET-NXT TO FIO-CMND
               PERFORM COL-FIO-CYA
               GO TO CIC-FIJ-SAFE
           ELSE
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'SAFECRGERR' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS.
       FIN-FIJ-SAFE.
           EXIT.
       CRG-AUTO SECTION.
       INI-CRG-AUTO.
           MOVE SPACES TO MSG-COD-MENS.
           PERFORM FST-CYA-CAN.
       CIC-CRG-AUTO.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS                                  AND
                    OPC-CIC-IOPC IN OPC = CYA-CIC-IOPC IN CYA AND
                    CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA )
                      GO TO FIN-CRG-AUTO.
           IF CYA-IND-MAUT IN CYA NOT = 'S'
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO CIC-CRG-AUTO.
           IF CYA-SGV-LIQU IN CYA > ZEROES
               MOVE '0670'          TO ICC-COD-TRAN IN ICC
           ELSE
               MOVE '0770'          TO ICC-COD-TRAN IN ICC.
           MOVE '01'                TO ICC-IND-INDI IN ICC.
           MOVE CYA-CIC-ICYA IN CYA TO ICC-COD-CCTE IN ICC.
           IF CYA-SGV-LIQU IN CYA > ZEROES
               MOVE  '000000000072' TO ICC-COD-SERI IN ICC
           ELSE
               MOVE  '000000000052' TO ICC-COD-SERI IN ICC.
           MOVE ZEROES              TO ICC-SGV-VPE2 IN ICC.
           MOVE CYA-SGV-LIQU IN CYA TO ICC-SGV-VPE2 IN ICC.
           MOVE '0'                 TO ICC-IND-TCAM IN ICC.
           MOVE 1                   TO ICC-SGV-VCON IN ICC.
           MOVE OPC-COD-OFOC IN OPC TO ICC-COD-OFOC IN ICC.
           MOVE SPACES              TO ICC-COD-UBIC IN ICC.
           MOVE SPACES              TO ICC-COD-ITRE IN ICC.
           MOVE SPACES              TO ICC-GLS-DISP IN ICC.
      *ISP PONE VALORES EN VARIABLES 'FIO' PARA QUE EN CASO DE FALLAR
      *    EL WRITE, LAS DECLARATIVAS ENTREGEN INFORMACION CORRECTA.
      *    NO SE USA FIO, PUES ARCHIVO SAM ==> CLAUSULA 'RBA'
           MOVE FIO-PUT TO FIO-CMND.
           MOVE 'COLVSAF' TO FIO-VOID.
           MOVE ICC TO FIO-DFLD.
           MOVE 100 TO FIO-RLEN.
      *DAD ini  01-ABR-1993   (Memo.29-03-93 pto.4/Memo.04-06-91)
      *     EXEC CICS WRITE
      *                 DATASET('COLVSAF')
      *                 FROM(ICC)
      *                 LENGTH(100)
      *                 RIDFLD(SAF-COD-TRN)
      *                 RBA
      *     END-EXEC.
           MOVE '00' TO FIO-STAT.
      *DAD fin  01-ABR-1993   (Memo.15-11-91 pto.2/Memo.19-11-91)

           IF FIO-STAT-OKS
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO CIC-CRG-AUTO
           ELSE
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'SAFECRGERR' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS.
        FIN-CRG-AUTO.
           EXIT.
       VRF-CAJA SECTION.
       INI-VRF-CAJA.
      *ISP SUPONE QUE ACTIVARA LA CANCELACION PORQUE NO HAY CARGOS CON
      *    CODIGO INTERNO = 'CAJA'
      *     MOVE 'N' TO WSS-IND-CAJA.
           PERFORM FST-CYA-CAN.
       CIC-VRF-CAJA.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS                                  AND
                    OPC-CIC-IOPC IN OPC = CYA-CIC-IOPC IN CYA AND
                    CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA )
                      GO TO FIN-VRF-CAJA.
           MOVE 'TAB'               TO MSC-COD-SIST.
           MOVE 'TCYA'              TO MSC-COD-TMSC IN MSC.
           MOVE CYA-IND-TCYA IN CYA TO MSC-COD-CMSC IN MSC.
           PERFORM BUS-MSC.
           IF MSG-COD-MENS = SPACES
               IF MSC-CIC-CMSC IN MSC = 'CAJA'
      *             MOVE 'S' TO WSS-IND-CAJA
      *             MOVE 'COL' TO MSG-COD-SIST
      *             MOVE 'INDTCYACAJA' TO MSG-COD-MENS
      *             PERFORM GET-MSG
      *             MOVE MSG-GLS-DESC TO FRM-MEN2
                   GO TO FIN-VRF-CAJA.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO CIC-VRF-CAJA.
       FIN-VRF-CAJA.
           EXIT.
       REL-COL-SAF SECTION.
       INI-REL-COL-SAF.
           MOVE SPACES TO MSG-COD-MENS.
      *ISP INICIO CODIGO TEMPORAL
      *ISP NO RESCATA CLAVE SAFE DESDE ARCHIVO RCE SINO QUE
      *    LA OBTIENE DESDE DLC-KEY-IDLO
           MOVE CAN-CIC-IOPC IN CAN TO DLC-CIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT ( FIO-STAT-OKS AND
                    CAN-CIC-IOPC IN CAN = DLC-CIC-IOPC IN DLC )
                      MOVE 'DLC    OPCNX' TO MSG-COD-MENS
                      GO TO MSG-REL-COL-SAF.
           MOVE DLC-CIC-IOPC IN DLC TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           MOVE OPC-COD-TOOC IN OPC TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-TOC.
           IF OPC-MSC-TTRN IN OPC NOT = 'C'
               MOVE DLC-KEY-IDLC IN DLC TO BCD-DAT6-EBCD IN BCD-VARI
               GO TO LEE-REG-SAFE.
      *ISP INICIO CODIGO ANTIGUO QUE DEBE RESTAURARSE
           MOVE CAN-CAI-IOPC IN CAN TO RCE-CAI-IOPC IN RCE.
           MOVE CAN-IIC-IOPC IN CAN TO RCE-IIC-IOPC IN RCE.
           MOVE DLC-NUM-IDLC IN DLC TO RCE-NUM-IDLC IN RCE.
      *    MOVE ZEROES TO              RCE-NUM-IDLC IN RCE.
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM COL-FIO-RCE.
           IF NOT FIO-STAT-OKS
               MOVE 'RCEIOPCNEX' TO MSG-COD-MENS
               GO TO MSG-REL-COL-SAF
           ELSE
               MOVE RCE-KEY-SAFE IN RCE TO BCD-DAT6-EBCD IN BCD-VARI.
      *ISP FINAL CODIGO ANTIGUO QUE DEBE RESTAURARSE
      *     MOVE DLC-KEY-IDLO IN DLC TO BCD-DAT6-EBCD IN BCD-VARI.
      *ISP FINAL TEMPORAL
       LEE-REG-SAFE.
*% IF PGM_CST
       COPY COLBGBCD.
*% END
           MOVE BCD-DAT6-EBCD IN BCD-VARI TO BCD-DAT6-INT IN BCD-VARI.
           MOVE BCD-DAT6 IN BCD-VARI TO CRS-KEY-ICRS IN CRS.
           EXEC CICS HANDLE CONDITION
                     NOTOPEN  (INI-FUNC-CRS)
                     DSIDERR  (INI-FUNC-CRS)
                     SYSIDERR (INI-FUNC-CRS)
           END-EXEC.
      *ISP BUSCA OPERACION EN ARCHIVO SAFE
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CRS.
           IF NOT FIO-STAT-OKS
                    MOVE 'CRSIOPCNEX' TO MSG-COD-MENS
                    GO TO MSG-REL-COL-SAF.
           IF ( CRS-IND-ACTU IN CRS = '01'   AND
                CRS-IND-PNEG IN CRS = '02' ) OR
              ( CRS-IND-ACTU IN CRS = '01'   AND
                CRS-IND-PNEG IN CRS = '09' ) OR
              ( CRS-IND-ACTU IN CRS = '02'   AND
                CRS-IND-PNEG IN CRS = '00' ) OR
              ( CRS-IND-ACTU IN CRS = '09'   AND
                CRS-IND-PNEG IN CRS = '00' )
                 MOVE 'SAFIOPCNFIJ' TO MSG-COD-MENS
                 GO TO MSG-REL-COL-SAF.
      *ALD-BCI-INI/17.11.1998
      *RESTAURAR UNA VEZ QUE SE PASEN REVERSAS ERRONEAS DEL 17.11.1998
           IF SCR-CMND NOT = 'REV'
      *ALD-BCI-FIN/17.11.1998
           IF CRS-NUM-IVEN IN CRS NOT = VEN-NUM-IVEN IN CAN-FLD AND
             ( CRS-IND-ACTU IN CRS NOT = '01'   AND
               CRS-IND-PNEG IN CRS NOT = '01' )
                MOVE 'SAFIOPCNVEN' TO MSG-COD-MENS.
       MSG-REL-COL-SAF.
           IF MSG-COD-MENS > SPACES
*% IF PGM_PTC
      *DAD ini PTC
      *ISP-PTC  27-OCT-1993 13:31:05 
               MOVE 'S'   TO SCR-IERR
      *DAD fin PTC
*% END
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS.
           GO TO FIN-REL-COL-SAF.
       INI-FUNC-CRS.
*% IF PGM_PTC
      *DAD ini PTC
      *ISP-PTC  27-OCT-1993 13:31:05 
           MOVE 'S'           TO SCR-IERR.
      *DAD fin PTC
*% END
           MOVE 'COL'         TO MSG-COD-SIST.
           MOVE 'SAFIOPCNDIS' TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
       FIN-REL-COL-SAF.
           EXIT.
       INI-CAN SECTION.
       INI-INI-CAN.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE ZEROES TO WSS-SGV-CAPT IN WSS-VARI.
           MOVE ZEROES TO WSS-SGV-FINL IN WSS-VARI.
           MOVE ZEROES TO WSS-NUM-VCVG IN WSS-VARI.
           MOVE ZEROES TO WSS-NUM-VCCM IN WSS-VARI.
           MOVE ZEROES TO WSS-NUM-VCCO IN WSS-VARI.
           MOVE ZEROES TO WSS-NUM-VCCV IN WSS-VARI.
           PERFORM RST-DLC VARYING WSS-NUM-IDLC FROM 1 BY 1
                             UNTIL WSS-NUM-IDLC > 500.
       FIN-INI-CAN.
           EXIT.
       RST-DLC SECTION.
       INI-RST-DLC.
           MOVE ZEROES TO WSS-SGV-CAPD(WSS-NUM-IDLC)
                          WSS-SGV-FINA(WSS-NUM-IDLC).
       FIN-RST-DLC.
           EXIT.
       PRO-REV SECTION.
       INI-PRO-REV.
      * RBG/INI/24-JUL-1997
           MOVE 'N' TO WSS-IND-ECMO IN WSS-VARI.
      * RBG/FIN/24-JUL-1997
           MOVE SPACES TO MSG-COD-MENS.
      *ISP RESPALDA CANCELACION ANTIGUA
           MOVE CAN TO CAN-BKP.
      *ISP CAMBIA STATUS A CANCELACION ANTIGUA
           MOVE 'R' TO CAN-MSC-STAT IN CAN.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CAN    REVKO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-PRO-REV.
      * RBG/INI/23-JUL-1997
      * ACTUALIZA TABLA COM PARA TIPO DE TASA 'CMO', CAMBIANDO EL STATUS
      * DE LA COM A 'R'.
           MOVE 'COM-KEY-IICG'      TO FIO-AKEY.
           MOVE CAN-CIC-IOPC IN CAN TO COM-CIC-IOPC IN COM.
           MOVE CAN-NUM-ICAN IN CAN TO COM-NUM-ICAN IN COM.
           MOVE SPACES              TO COM-CIC-IOPV IN COM.
           MOVE ZEROES              TO COM-NUM-IVCT IN COM.
           MOVE SPACES              TO COM-IND-TTAS IN COM.
           MOVE ZEROES              TO COM-FEC-FINI IN COM.
           MOVE FIO-GET-NLS         TO FIO-CMND.
       LUP-LEO-COM.
           PERFORM COL-FIO-COM.
           IF NOT ( FIO-STAT-OKS AND
               COM-CIC-IOPC IN COM = CAN-CIC-IOPC IN CAN AND
               COM-NUM-ICAN IN COM = CAN-NUM-ICAN IN CAN )
                NEXT SENTENCE
           ELSE
               IF COM-IND-TTAS IN COM NOT = 'CMO'
                   MOVE FIO-GET-NXT TO FIO-CMND
                   GO TO LUP-LEO-COM
               ELSE
                   MOVE 'S' TO WSS-IND-ECMO IN WSS-VARI
                   MOVE FIO-GET-KEY-UPD TO FIO-CMND
                   PERFORM COL-FIO-COM
                   MOVE 'R' TO COM-MSC-STAT IN COM
                   MOVE FIO-MOD TO FIO-CMND
                   PERFORM COL-FIO-COM
                   IF NOT FIO-STAT-OKS
                       MOVE 'COL'          TO MSG-COD-SIST
                       MOVE 'COM    REVKO' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       GO TO FIN-PRO-REV.
      * RBG/FIN/23-JUL-1997
           PERFORM PRO-REV-DLC.
      *ISP RESPALDA NUMERO DE CANCELACION ANTIGUA
           MOVE CAN-NUM-ICAN IN CAN TO WSS-NUM-ICAN-OLD.
      *ISP BUSCA NUEVA CANCELACION A GENERAR
           PERFORM BUS-NEW-CAN.
      *ISP RESPALDA NUMERO DE CANCELACION NUEVA
           MOVE CAN-NUM-ICAN IN CAN TO WSS-NUM-ICAN-NEW.
      *ISP RESTAURA CANCELACION ANTIGUA
           MOVE CAN-BKP TO CAN.
      *ISP INVIERTE SIGNO DE CAMPOS
           SUBTRACT CAN-SGV-GAST IN CAN FROM 0 GIVING
                    CAN-SGV-GAST IN CAN.
           SUBTRACT CAN-SGV-TPAG IN CAN FROM 0 GIVING
                    CAN-SGV-TPAG IN CAN.
           SUBTRACT CAN-SGV-TREN IN CAN FROM 0 GIVING
                    CAN-SGV-TREN IN CAN.
           SUBTRACT CAN-NUM-TVCC IN CAN FROM 0 GIVING
                    CAN-NUM-TVCC IN CAN.
           SUBTRACT CAN-SGV-DIFE IN CAN FROM 0 GIVING
                    CAN-SGV-DIFE IN CAN.
      *ALDI
      * RBG/INI/23-JUL-1997
      * Esta variable nos indica que existe una CMO.
           IF WSS-IND-ECMO IN WSS-VARI NOT = 'S'
               GO TO CON-PRO-NORMAL.

           PERFORM PRO-REV-COM.
           IF MSG-COD-MENS > SPACES
               GO TO FIN-PRO-REV.
       CON-PRO-NORMAL.
      * RBG/FIN/23-JUL-1997
      *ISP REVERSA CYA
           PERFORM PRO-REV-CYA.
           IF MSG-COD-MENS > SPACES
               GO TO FIN-PRO-REV.
      *ISP REVERSA RCV
      *     IF NOT (CAN-MSC-FCAN IN CAN = 'T' AND
      *        CAN-MSC-ECAN IN CAN = 'T' )
               PERFORM PRO-REV-RCV.
               IF MSG-COD-MENS > SPACES
                   GO TO FIN-PRO-REV.
      *ISP REVERSA ITR
           PERFORM PRO-REV-ITR.
           IF MSG-COD-MENS > SPACES
               GO TO FIN-PRO-REV.
      *ISP GRABA NUEVA CANELACION
           MOVE 'V' TO CAN-MSC-STAT IN CAN.
           MOVE WSS-NUM-ICAN-NEW TO CAN-NUM-ICAN IN CAN.
           PERFORM PUT-FHOY.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CANNEW REVKO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO REV-MSG
               GO TO FIN-PRO-REV.
      *ISP LEE ( UPD ) CANCELACION RECIEN GENERADA PARA SEGUIR
      *    PROCESO NORMAL DE COMANDO CAN
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CAN    REVOK' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO REV-MSG-MSG
               MOVE CAN-KEY-ICAN IN CAN TO REV-MSG-CAN
      *ISP RESETEA STATUS DE REVERSA A OK
               MOVE SPACES TO MSG-COD-MENS
           ELSE
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CANNEW REVNO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO REV-MSG.
       FIN-PRO-REV.
           EXIT.
       PRO-REV-DLC SECTION.
       INI-PRO-REV-DLC.
           MOVE CAN-CIC-IOPC IN CAN TO DLC-CIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT (FIO-STAT-OKS AND
              CAN-CIC-IOPC IN CAN = DLC-CIC-IOPC IN DLC)
               GO TO FIN-PRO-REV-DLC.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-DLC.
      *DAD ini  20-NOV-1991   (Memo.15-11-91 pto.2/Memo.19-11-91)
           IF CAN-FEC-FDVA IN CAN > ZEROES
      *DAD fin  20-NOV-1991
               MOVE CAN-FEC-FDVA IN CAN TO DLC-FEC-FDEV IN DLC.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-DLC.
       FIN-PRO-REV-DLC.
           EXIT.
      ******************************************************************
      * RBG/INI/23-JUL-1997
       PRO-REV-COM SECTION.
      *********************
       INI-PRO-REV-COM.
           MOVE 'COM-KEY-IICG'      TO FIO-AKEY.
           MOVE CAN-CIC-IOPC IN CAN TO COM-CIC-IOPC IN COM.
           MOVE WSS-NUM-ICAN-OLD    TO COM-NUM-ICAN IN COM.
           MOVE SPACES              TO COM-CIC-IOPV IN COM.
           MOVE ZEROES              TO COM-NUM-IVCT IN COM.
           MOVE SPACES              TO COM-IND-TTAS IN COM.
           MOVE ZEROES              TO COM-FEC-FINI IN COM.
           MOVE FIO-GET-NLS         TO FIO-CMND.
       LUP-LEO-COM.
           PERFORM COL-FIO-COM.
           IF NOT ( FIO-STAT-OKS AND
                    COM-CIC-IOPC IN COM = CAN-CIC-IOPC IN CAN AND
                    COM-NUM-ICAN IN COM = WSS-NUM-ICAN-OLD )
                     NEXT SENTENCE
           ELSE
               IF COM-IND-TTAS IN COM NOT = 'CMO'
                  MOVE FIO-GET-NXT TO FIO-CMND
                  GO TO LUP-LEO-COM
               ELSE
                   MOVE WSS-NUM-ICAN-NEW TO COM-NUM-ICAN IN COM
                   SUBTRACT COM-SGV-MNTO IN COM FROM 0 GIVING
                            COM-SGV-MNTO IN COM.
                   MOVE FIO-PUT TO FIO-CMND
                   PERFORM COL-FIO-COM
                   IF NOT FIO-STAT-OKS
                       MOVE 'COL' TO MSG-COD-SIST
                       MOVE 'COM    REVKO' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS.
       FIN-PRO-REV-COM.
           EXIT.
      * RBG/FIN/23-JUL-1997

      ******************************************************************
       PRO-REV-CYA SECTION.
       INI-PRO-REV-CYA.
      *ISP TOMA EL PRIMER CYA
      *ISP ANTES PRO-REV-CYA USABA VARIABLE WSS-NUM-ICYA, ELIMINAR
      *    UNA VEZ VERIFICADO QUE PRO-REV-CYA FUNCIONA OK SIN ELLA
           MOVE 1                   TO CYA-NUM-ICYA IN CYA.
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
       CIC-PRO-REV-CYA.
           MOVE WSS-NUM-ICAN-OLD    TO CYA-NUM-ICAN IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF FIO-STAT-OKS AND
              CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
              WSS-NUM-ICAN-OLD    = CYA-NUM-ICAN IN CYA
                 SUBTRACT CYA-SGV-LIQU IN CYA FROM 0 GIVING
                          CYA-SGV-LIQU IN CYA
                 MOVE WSS-NUM-ICAN-NEW TO CYA-NUM-ICAN IN CYA
                 MOVE FIO-PUT TO FIO-CMND
                 PERFORM COL-FIO-CYA
                 IF FIO-STAT-OKS
                     ADD 1 TO CYA-NUM-ICYA IN CYA
                     GO TO CIC-PRO-REV-CYA
                 ELSE
                     MOVE 'COL' TO MSG-COD-SIST
                     MOVE 'CYA    REVKO' TO MSG-COD-MENS
                     PERFORM GET-MSG
                     MOVE MSG-GLS-DESC TO FRM-MENS.
       FIN-PRO-REV-CYA.
           EXIT.
       PRO-REV-RCV SECTION.
       INI-PRO-REV-RCV.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPV IN RCV.
           IF CAN-MSC-FCAN IN CAN = 'T' AND
              CAN-MSC-ECAN IN CAN = 'T'
               MOVE ZEROES TO RCV-NUM-IVCT IN RCV
           ELSE
               MOVE VEN-NUM-IVEN IN CAN-FLD TO RCV-NUM-IVCT IN RCV.
           MOVE WSS-NUM-ICAN-OLD TO RCV-NUM-ICAN IN RCV.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF NOT FIO-STAT-OKS
               GO TO FIN-PRO-REV-RCV.
           MOVE WSS-NUM-ICAN-NEW TO RCV-NUM-ICAN IN RCV.
      *JSS 23-AUG-1991 12:51:05 IF NOT (CAN-MSC-FCAN IN CAN = 'T' AND
      *        CAN-MSC-ECAN IN CAN = 'T' )
               SUBTRACT RCV-SGV-CAPI IN RCV FROM 0 GIVING
                        RCV-SGV-CAPI IN RCV.
               SUBTRACT RCV-SGV-FINA IN RCV FROM 0 GIVING
                        RCV-SGV-FINA IN RCV.
               SUBTRACT RCV-SGV-REAJ IN RCV FROM 0 GIVING
                        RCV-SGV-REAJ IN RCV.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF NOT FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'RCV    REVKO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS.
       FIN-PRO-REV-RCV.
           EXIT.
       PRO-REV-ITR SECTION.
       INI-PRO-REV-ITR.
           MOVE 'ITR-KEY-IICG' TO FIO-AKEY.
           MOVE CAN-CIC-IOPC IN CAN     TO ITR-CIC-IOPC IN ITR.
           MOVE WSS-NUM-ICAN-OLD        TO ITR-NUM-ICAN IN ITR.
           MOVE CAN-CIC-IOPC IN CAN     TO ITR-CIC-IOPV IN ITR.
           MOVE ZEROES                  TO ITR-NUM-IVCT IN ITR.
           MOVE 'INT'                   TO ITR-IND-TTAS IN ITR.
           MOVE ZEROES                  TO ITR-FEC-FINI IN ITR.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ITR.
           IF FIO-STAT-OKS
                MOVE WSS-NUM-ICAN-NEW TO
                     ITR-NUM-ICAN IN ITR
                MOVE FIO-PUT TO FIO-CMND
                PERFORM COL-FIO-ITR
                IF NOT FIO-STAT-OKS
                     MOVE 'COL' TO MSG-COD-SIST
                     MOVE 'ITR    REVKO' TO MSG-COD-MENS
                     PERFORM GET-MSG
                     MOVE MSG-GLS-DESC TO FRM-MENS.
       FIN-PRO-REV-ITR.
           EXIT.
       BUS-NEW-CAN SECTION.
       INI-BUS-NEW-CAN.
           MOVE 999 TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           ADD 1 TO CAN-NUM-ICAN IN CAN.
           MOVE CAN-NUM-ICAN IN CAN TO CAN-NUM-ICAN IN CAN-FLD.
       FIN-BUS-NEW-CAN.
           EXIT.
       PUT-FHOY SECTION.
       INI-PUT-FHOY.
           MOVE HOY-DHOY TO CAN-NUM-DOUT IN CAN.
           MOVE HOY-MHOY TO CAN-NUM-MOUT IN CAN.
           MOVE HOY-SHOY TO CAN-NUM-SOUT IN CAN.
           MOVE HOY-AHOY TO CAN-NUM-AOUT IN CAN.
           MOVE HOY-STP-ITRN TO CAN-STP-ITRN IN CAN.
       FIN-PUT-FHOY.
           EXIT.
       MOVE-SAFE SECTION.
       INI-MOVE-SAFE.
           IF WSS-IND-ALG NOT = 'A' AND
              SCR-CMND = 'REV'
               SUBTRACT CAN-SGV-GAST IN CAN FROM 0 GIVING
                        CAN-SGV-GAST IN CAN
               SUBTRACT CYA-SGV-LIQU IN CYA FROM 0 GIVING
                         CYA-SGV-LIQU IN CYA.
           SUBTRACT CAN-SGV-GAST IN CAN FROM CYA-SGV-LIQU IN CYA
                    GIVING WSS-SGV-LIQU IN WSS-VARI.
           MOVE HOY-DHOY TO CAN-NUM-DOUT IN CAN.
           MOVE HOY-MHOY TO CAN-NUM-MOUT IN CAN.
           MOVE HOY-AHOY TO CAN-NUM-AOUT IN CAN.
           IF ( WSS-CAN-MSC-STAT = 'S' OR
                WSS-CAN-MSC-STAT = 'W' ) AND
              CRS-IND-ACTU IN CRS = '03' AND
              CRS-IND-PNEG IN CRS = '00'
               MOVE '03' TO CRS-IND-ACTU IN CRS
               MOVE '01' TO CRS-IND-PNEG IN CRS
           ELSE
               MOVE '01' TO CRS-IND-ACTU IN CRS
               MOVE '01' TO CRS-IND-PNEG IN CRS.
           IF SCR-CMND = 'REV'
               SUBTRACT WSS-SGV-LIQU IN WSS-VARI FROM
                                  CRS-VAL-VCNC IN CRS
      * RBG/INI/01-OCT-1997
      *        SUBTRACT CAN-SGV-GAST IN CAN      FROM
      *                           CRS-VAL-GNEG IN CRS
               MOVE ZEROES TO CRS-VAL-GNEG IN CRS
           ELSE
               ADD WSS-SGV-LIQU IN WSS-VARI        TO
                                  CRS-VAL-VCNC IN CRS
      *        ADD CAN-SGV-GAST IN CAN             TO
      *                           CRS-VAL-GNEG IN CRS.
               MOVE CAN-SGV-GAST IN CAN            TO
                                  CRS-VAL-GNEG IN CRS.
      * RBG/FIN/01-OCT-1997
      *RVM-CST-INI 28-NOV-1996
           IF CAN-SGV-GAST IN CAN > ZEROES
               MOVE 'S' TO CRS-IND-CCOM IN CRS.
      *RVM-CST-FIN 28-NOV-1996
           MOVE CAN-MSC-CANC IN CAN-FLD TO CRS-MSC-CANC IN CRS.
           MOVE CAN-MSC-CANC IN CAN-FLD TO CAN-MSC-CANC IN CAN.
           MOVE CAN-COD-OFCA IN CAN-FLD TO CRS-COD-OFRC IN CRS.
           MOVE CAN-NUM-ACAN IN CAN-FLD TO CRS-NUM-ACAN IN CRS.
           MOVE CAN-NUM-MCAN IN CAN-FLD TO CRS-NUM-MCAN IN CRS.
           MOVE CAN-NUM-DCAN IN CAN-FLD TO CRS-NUM-DCAN IN CRS.
           PERFORM ACT-VEN-SAFE.
           IF WSS-IND-ALG NOT = 'A' AND
              SCR-CMND = 'REV'
               SUBTRACT CAN-SGV-GAST IN CAN FROM 0 GIVING
                        CAN-SGV-GAST IN CAN
               SUBTRACT CYA-SGV-LIQU IN CYA FROM 0 GIVING
                         CYA-SGV-LIQU IN CYA.
       FIN-MOVE-SAFE.
           EXIT.
       MOVE-SAFE-1 SECTION.
       INI-MOVE-SAFE-1.
           IF WSS-IND-ALG NOT = 'A' AND
              SCR-CMND = 'REV'
               SUBTRACT CAN-SGV-GAST IN CAN FROM 0 GIVING
                        CAN-SGV-GAST IN CAN
               SUBTRACT CYA-SGV-LIQU IN CYA FROM 0 GIVING
                         CYA-SGV-LIQU IN CYA.
           IF CRS-IND-ACTU IN CRS = '00' AND
              CRS-IND-PNEG IN CRS = '00'
               MOVE '01' TO CRS-IND-ACTU IN CRS
               MOVE '04' TO CRS-IND-PNEG IN CRS
           ELSE
           IF CRS-IND-ACTU IN CRS = '03' AND
              CRS-IND-PNEG IN CRS = '00'
               MOVE '03' TO CRS-IND-ACTU IN CRS
               MOVE '04' TO CRS-IND-PNEG IN CRS.
           SUBTRACT CAN-SGV-GAST IN CAN FROM CYA-SGV-LIQU IN CYA
                    GIVING WSS-SGV-LIQU IN WSS-VARI.
           IF SCR-CMND = 'REV'
               SUBTRACT WSS-SGV-LIQU IN WSS-VARI FROM
                                  CRS-VAL-PNEG IN CRS
           ELSE
               ADD WSS-SGV-LIQU IN WSS-VARI        TO
                                  CRS-VAL-PNEG IN CRS.
      *RVM-CST-INI 28-NOV-1996
           IF CAN-SGV-GAST IN CAN > ZEROES
               MOVE 'S' TO CRS-IND-CCOM IN CRS.
      *RVM-CST-FIN 28-NOV-1996
           MOVE CAN-MSC-CANC IN CAN-FLD TO CRS-MSC-CANC IN CRS.
           MOVE CAN-MSC-CANC IN CAN-FLD TO CAN-MSC-CANC IN CAN.
           MOVE CAN-COD-OFCA IN CAN-FLD TO CRS-COD-OFRC IN CRS.
           MOVE CAN-NUM-ACAN IN CAN-FLD TO CRS-NUM-ACAN IN CRS.
           MOVE CAN-NUM-MCAN IN CAN-FLD TO CRS-NUM-MCAN IN CRS.
           MOVE CAN-NUM-DCAN IN CAN-FLD TO CRS-NUM-DCAN IN CRS.
           PERFORM ACT-VEN-SAFE.
           IF WSS-IND-ALG NOT = 'A' AND
              SCR-CMND = 'REV'
               SUBTRACT CAN-SGV-GAST IN CAN FROM 0 GIVING
                        CAN-SGV-GAST IN CAN
               SUBTRACT CYA-SGV-LIQU IN CYA FROM 0 GIVING
                         CYA-SGV-LIQU IN CYA.
       FIN-MOVE-SAFE-1.
           EXIT.
       MOVE-SAFE-2 SECTION.
       INI-MOVE-SAFE-2.
           IF CRS-IND-ACTU IN CRS = '00' AND
              CRS-IND-PNEG IN CRS = '00'
               MOVE '01' TO CRS-IND-ACTU IN CRS
               MOVE '04' TO CRS-IND-PNEG IN CRS
           ELSE
           IF CRS-IND-ACTU IN CRS = '03' AND
              CRS-IND-PNEG IN CRS = '00'
               MOVE '03' TO CRS-IND-ACTU IN CRS
               MOVE '04' TO CRS-IND-PNEG IN CRS.
      *RVM-CST-INI 28-NOV-1996
           IF CAN-SGV-GAST IN CAN > ZEROES
               MOVE 'S' TO CRS-IND-CCOM IN CRS.
      *RVM-CST-FIN 28-NOV-1996
           MOVE CAN-MSC-CANC IN CAN-FLD TO CRS-MSC-CANC IN CRS.
           MOVE CAN-MSC-CANC IN CAN-FLD TO CAN-MSC-CANC IN CAN.
           MOVE CAN-COD-OFCA IN CAN-FLD TO CRS-COD-OFRC IN CRS.
           MOVE CAN-NUM-ACAN IN CAN-FLD TO CRS-NUM-ACAN IN CRS.
           MOVE CAN-NUM-MCAN IN CAN-FLD TO CRS-NUM-MCAN IN CRS.
           MOVE CAN-NUM-DCAN IN CAN-FLD TO CRS-NUM-DCAN IN CRS.
           PERFORM ACT-VEN-SAFE.
       FIN-MOVE-SAFE-2.
           EXIT.
       ACT-VEN-SAFE SECTION.
       INI-ACT-VEN-SAFE.
           IF CAN-MSC-FCAN IN CAN = 'T' AND
              WSS-I IN WSS-VARI   = ZEROES
               MOVE 1 TO WSS-I IN WSS-VARI
               IF SCR-CMND = 'REV'
                   SUBTRACT 1 FROM CRS-NUM-IVEN IN CRS
                   IF CRS-NUM-IVEN IN CRS NOT > ZEROES
                       MOVE 1 TO CRS-NUM-IVEN IN CRS
                   ELSE
                       NEXT SENTENCE
               ELSE
                   ADD 1 TO CRS-NUM-VNEG IN CRS
                   ADD 1 TO CRS-NUM-IVEN IN CRS.
       FIN-ACT-VEN-SAFE.
           EXIT.
      * RBG/INI/23-JUL-1997
       COPY COLBFCOM.
      * RBG/FIN/23-JUL-1997
       COPY GNSBGCAM.
       COPY COLBFTMC.
       COPY COLBFCYA.
       COPY COLBFICG.
       COPY COLBFITR.
       COPY COLBFOPC.
       COPY COLBFDLC.
       COPY COLBFRCV.
       COPY COLBFROV.
       COPY COLBFRDT.
       COPY COLBFVEN.
       COPY COLBFRDC.
       COPY COLBFTOC.
       COPY SGCBFDBC.
       COPY SGCBFRCO.
       COPY SGCBFOPE.
       COPY GNSBGCPT.
       COPY TABBVUSR.
       COPY COLBGCLI.
       COPY GNSBGCIC.
       COPY GNSBFCIC.
       COPY TABBFVLR.
       COPY TABBFCAM.
       COPY COLBFRCE.
       COPY COLBFCRS.
       COPY COLBGVEN.
      *SMC-INI 09.09.1993
       COPY COLBGINT.
      *SMC-FIN 09.09.1993
       COPY GNSBGCVI.
       COPY COLBFEVC.
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Para Proceso Genera y Activa con registro MVO (Pro. Linea y Batch)
      *DAD ini  20-ABR-1993   (Memo.19-04-93)
      *DAD ini  18-MAR-1993   (Memo.07-09-92)
       COPY COLBFMVO.
       COPY COLBGMVO.
      *COPY COLBGTCT.
      *DAD fin  17-MAY-1993 / 20-ABR-1993 / 18-MAR-1993
      *DAD ini  04-AGO-1993   (Memo.28-06-93)
       COPY COLBGVDA.
      *DAD fin  04-AGO-1993
       COPY GNSBGPES.
       COPY COLB3CAN.
      *DPM INI  7-NOV-1996
       COPY COLBGMPC.
      *DPM FIN  7-NOV-1996
       COPY COLB4CAN.
       COPY COLB5CAN.
       COPY GNSBGIER.
       COPY GNSBFERR.
       COPY GNSBPFEC.
      *DAD ini PTC
       COPY GNSBGQUE.
      *DAD fin PTC
       ANL-KEY-ROV SECTION.
       INI-ANL-KEY-ROV.
           IF NOT ( SCR-MSC-TCAN = 'N' OR 'P' OR 'R' )
               GO TO FIN-ANL-KEY-ROV.
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF NOT FIO-STAT-OKS
               GO TO FIN-ANL-KEY-ROV.
           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'ROVIOPCELI' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-ANL-KEY-ROV.
       FIN-ANL-KEY-ROV.
           EXIT.
       ALG-C1 SECTION.
       INI-ALG-C1.
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-REV
               GO TO FIN-ALG-C1.
           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'ROVIOPCELI' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-ALG-C1.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           PERFORM PRO-REV.
       FIN-ALG-C1.
           EXIT.
       ALG-A1 SECTION.
       INI-ALG-A1.
           MOVE CAN-CIC-IOPC IN CAN TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           MOVE 'A' TO WSS-IND-ALG IN WSS-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO DLC-CIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF OPC-MSC-TTRN IN OPC NOT = 'C'
               MOVE DLC-KEY-IDLC IN DLC TO BCD-DAT6-EBCD IN BCD-VARI
               GO TO LEE-REG-SAFE-A1.
      *ISP INICIO CODIGO ANTIGUO QUE DEBE RESTAURARSE
           MOVE CAN-CAI-IOPC IN CAN TO RCE-CAI-IOPC IN RCE.
           MOVE CAN-IIC-IOPC IN CAN TO RCE-IIC-IOPC IN RCE.
           MOVE DLC-NUM-IDLC IN DLC TO RCE-NUM-IDLC IN RCE.
      *    MOVE ZEROES TO              RCE-NUM-IDLC IN RCE.
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM COL-FIO-RCE.
           IF NOT FIO-STAT-OKS
               MOVE 'RCEIOPCNEX' TO MSG-COD-MENS
               MOVE 'CAN    REVKO' TO MSG-COD-MENS
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-ALG-A1
           ELSE
               MOVE RCE-KEY-SAFE IN RCE TO BCD-DAT6-EBCD IN BCD-VARI.
      *ISP FINAL TEMPORAL
       LEE-REG-SAFE-A1.
           MOVE BCD-DAT6-EBCD IN BCD-VARI TO BCD-DAT6-INT IN BCD-VARI.
           MOVE BCD-DAT6 IN BCD-VARI TO CRS-KEY-ICRS IN CRS.
      *ISP BUSCA OPERACION EN ARCHIVO SAFE
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CRS.
           IF NOT FIO-STAT-OKS
               MOVE 'CAN    REVKO' TO MSG-COD-MENS
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-ALG-A1.
           PERFORM FIJ-SAFE.
           IF MSG-COD-MENS > SPACES
               MOVE 'CAN    REVKO' TO MSG-COD-MENS
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS.
       FIN-ALG-A1.
           EXIT.
       ALG-M1 SECTION.
       INI-ALG-M1.
           IF ADO-IND-ORIG = 'S' AND
              ADO-CMND = 'REV'
               PERFORM PRO-REV
           ELSE
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'REVSOLODSAFE' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS.
       FIN-ALG-M1.
           EXIT.
       ALG-M2 SECTION.
       INI-ALG-M2.
           MOVE 'COL' TO MSG-COD-SIST.
           MOVE 'ANUOPCCREOPC' TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
       FIN-ALG-M2.
           EXIT.
       ALG-C2 SECTION.
       INI-ALG-C2.
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF NOT FIO-STAT-OKS
      *         PERFORM PRO-REV-1
               PERFORM PRO-REV
               GO TO FIN-ALG-C2.
           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'ROVIOPCELI' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-ALG-C2.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM COL-FIO-ROV.
      *     PERFORM PRO-REV-1.
           PERFORM PRO-REV.
       FIN-ALG-C2.
           EXIT.
       ALG-A1-C1 SECTION.
       INI-ALG-A1-C1.
           PERFORM ALG-A1.
           IF MSG-COD-MENS > SPACES
               GO TO FIN-ALG-A1-C1.
           PERFORM ALG-C1.
       FIN-ALG-A1-C1.
           EXIT.
       PRO-REV-1 SECTION.
       INI-PRO-REV-1.
           MOVE SPACES TO MSG-COD-MENS.
      *ISP RESPALDA CANCELACION ANTIGUA
           MOVE CAN TO CAN-BKP.
      *ISP CAMBIA STATUS A CANCELACION ANTIGUA
           MOVE 'R' TO CAN-MSC-STAT IN CAN.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CAN    REVKO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-PRO-REV-1.
      *ISP RESPALDA NUMERO DE CANCELACION ANTIGUA
           MOVE CAN-NUM-ICAN IN CAN TO WSS-NUM-ICAN-OLD.
      *ISP BUSCA NUEVA CANCELACION A GENERAR
           PERFORM BUS-NEW-CAN.
      *ISP RESPALDA NUMERO DE CANCELACION NUEVA
           MOVE CAN-NUM-ICAN IN CAN TO WSS-NUM-ICAN-NEW.
      *ISP RESTAURA CANCELACION ANTIGUA
           MOVE CAN-BKP TO CAN.
      *ISP GRABA NUEVA CANELACION
           MOVE 'V' TO CAN-MSC-STAT IN CAN.
           MOVE 'CIE' TO CAN-MSC-CANC IN CAN.
           MOVE WSS-NUM-ICAN-NEW TO CAN-NUM-ICAN IN CAN.
           PERFORM PUT-FHOY.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CANNEW REVKO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO REV-MSG
               GO TO FIN-PRO-REV-1.
      *ISP LEE ( UPD ) CANCELACION RECIEN GENERADA PARA SEGUIR
      *    PROCESO NORMAL DE COMANDO CAN
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CAN    REVOK' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO REV-MSG-MSG
               MOVE CAN-KEY-ICAN IN CAN TO REV-MSG-CAN
      *ISP RESETEA STATUS DE REVERSA A OK
               MOVE SPACES TO MSG-COD-MENS
           ELSE
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CANNEW REVNO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO REV-MSG.
       FIN-PRO-REV-1.
           EXIT.
       BUS-IND-SFCR SECTION.
       INI-BUS-IND-SFCR.
           IF CAN-FEC-FOUT IN CAN NOT = HOY-FHOY
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CANFOUTRVINV' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-BUS-IND-SFCR.
           PERFORM GET-OPC.
           MOVE 'N' TO WSS-IND-RNOV IN WSS-VARI.
           MOVE 'N' TO WSS-IND-SAFE IN WSS-VARI.
           MOVE 'N' TO WSS-IND-CTCT IN WSS-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF FIO-STAT-OKS
               MOVE 'S' TO WSS-IND-RNOV IN WSS-VARI.
           PERFORM VRF-CAJA-CC.
           PERFORM PRO-REV-CAN.
       FIN-BUS-IND-SFCR.
            EXIT.
       VRF-CAJA-CC SECTION.
       INI-VRF-CAJA-CC.
           MOVE CAN-CIC-IOPC IN CAN TO OPC-CIC-IOPC IN OPC.
           PERFORM FST-CYA-CAN.
       CIC-VRF-CAJA-CC.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS                                  AND
                     OPC-CIC-IOPC IN OPC = CYA-CIC-IOPC IN CYA AND
                     CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA )
                      GO TO FIN-VRF-CAJA-CC.
           MOVE 'TAB' TO MSC-COD-SIST.
           MOVE 'TCYA' TO MSC-COD-TMSC IN MSC.
           MOVE CYA-IND-TCYA IN CYA TO MSC-COD-CMSC IN MSC.
           PERFORM BUS-MSC.
           IF MSG-COD-MENS = SPACES
               IF MSC-CIC-CMSC IN MSC = 'CAJA' AND
                  WSS-IND-SAFE IN WSS-VARI = 'N'
                   MOVE 'S' TO WSS-IND-SAFE
               ELSE
                   IF MSC-CIC-CMSC IN MSC = 'CC' AND
                      WSS-IND-CTCT IN WSS-VARI = 'N'
                       MOVE 'S' TO WSS-IND-CTCT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO CIC-VRF-CAJA-CC.
       FIN-VRF-CAJA-CC.
           EXIT.
       PRO-REV-CAN SECTION.
       INI-PRO-REV-CAN.
      *DAD ini  11-JUN-1993   (Memo.26-02-93)
      *     IF CAN-MSC-FCAN IN CAN = 'T' AND
      *        CAN-MSC-ECAN IN CAN = 'T' AND
      *        CAN-MSC-STAT IN CAN = 'A'
           IF CAN-MSC-STAT IN CAN = 'A' AND
              (( CAN-MSC-FCAN IN CAN = 'T' AND
                 CAN-MSC-ECAN IN CAN = 'T' ) OR
               ( CAN-MSC-FCAN IN CAN = 'T' AND
                 CAN-MSC-ECAN IN CAN = 'E' AND
                 OPC-NUM-VCOR IN OPC = 1 ))
      *DAD fin  11-JUN-1993
               PERFORM ANL-KEY-ROV
               IF MSG-COD-MENS > SPACES
                   GO TO FIN-PRO-REV-CAN
               ELSE
                   PERFORM REV-RCV-REG
                   GO TO FIN-PRO-REV-CAN.
           IF WSS-IND-SAFE = 'S' AND
              WSS-IND-RNOV = 'N' AND
              WSS-IND-CTCT = 'N'
               IF CAN-MSC-STAT IN CAN = 'S'
                   PERFORM ALG-A1
                   IF MSG-COD-MENS NOT > SPACES
                       PERFORM PRO-REV
                   ELSE
                       NEXT SENTENCE
               ELSE
                   PERFORM ALG-M1
           ELSE
           IF WSS-IND-SAFE = 'N' AND
              WSS-IND-RNOV = 'N' AND
              WSS-IND-CTCT = 'S'
               PERFORM PRO-REV
           ELSE
           IF WSS-IND-SAFE = 'N' AND
              WSS-IND-RNOV = 'S' AND
              WSS-IND-CTCT = 'N'
               IF CAN-MSC-STAT IN CAN = 'C'
                   PERFORM ALG-C1
               ELSE
                   PERFORM ALG-M2
           ELSE
           IF WSS-IND-SAFE = 'S' AND
              WSS-IND-RNOV = 'N' AND
              WSS-IND-CTCT = 'S'
               IF CAN-MSC-STAT IN CAN = 'S'
                   PERFORM ALG-A1
                   IF MSG-COD-MENS NOT > SPACES
                       PERFORM PRO-REV
                   ELSE
                       NEXT SENTENCE
               ELSE
               IF CAN-MSC-STAT IN CAN = 'A'
                   PERFORM ALG-M1
               ELSE
                   NEXT SENTENCE
           ELSE
           IF WSS-IND-SAFE = 'S' AND
              WSS-IND-RNOV = 'S' AND
              WSS-IND-CTCT = 'N'
               IF CAN-MSC-STAT IN CAN = 'W'
                   PERFORM ALG-A1-C1
               ELSE
               IF CAN-MSC-STAT IN CAN = 'A' OR
                  CAN-MSC-STAT IN CAN = 'S'
                   PERFORM ALG-M2
               ELSE
               IF CAN-MSC-STAT IN CAN = 'C'
                   PERFORM ALG-M1
               ELSE
                   NEXT SENTENCE
           ELSE
           IF WSS-IND-SAFE = 'S' AND
              WSS-IND-RNOV = 'S' AND
              WSS-IND-CTCT = 'S'
               IF CAN-MSC-STAT IN CAN = 'W'
                   PERFORM ALG-A1-C1
               ELSE
               IF CAN-MSC-STAT IN CAN = 'A' OR
                  CAN-MSC-STAT IN CAN = 'S'
                   PERFORM ALG-M2
               ELSE
               IF CAN-MSC-STAT IN CAN = 'C'
                   PERFORM ALG-C2
               ELSE
                   NEXT SENTENCE
           ELSE
           IF WSS-IND-SAFE = 'N' AND
              WSS-IND-RNOV = 'S' AND
              WSS-IND-CTCT = 'S'
               IF CAN-MSC-STAT IN CAN = 'C'
                   PERFORM ALG-C1
               ELSE
               IF CAN-MSC-STAT IN CAN = 'A'
                   PERFORM ALG-M2
               ELSE
                   NEXT SENTENCE
           ELSE
               PERFORM PRO-REV.
       FIN-PRO-REV-CAN.
           EXIT.
       REV-RCV-REG SECTION.
       INI-REV-RCV-REG.
           MOVE CAN-CIC-IOPC IN CAN TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           MOVE OPC-COD-TOOC IN OPC TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-TOC.
           MOVE OPC-VAL-SCRE IN OPC TO WSS-VAL-OCRE IN WSS-VARI.
           MOVE OPC-NUM-VCVG IN OPC TO WSS-NUM-VCVG IN WSS-VARI.
           PERFORM INI-DLC-TT VARYING WSS-NUM-IDLC FROM 1 BY 1
                             UNTIL WSS-NUM-IDLC > 499.
           PERFORM ANL-KEY-RCV.
           MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN.
           MOVE CAN-CIC-IOPC IN CAN TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
       LUP-REV-RCV-REG.
           IF OPC-IND-VSTR IN OPC NOT = 'S'
               PERFORM COL-FIO-VEN
           ELSE
               PERFORM COL-OBT-VEN
               IF VEN-STAT-OKS
                   MOVE '00' TO FIO-STAT
               ELSE
                   MOVE '23' TO FIO-STAT.
           IF NOT ( FIO-STAT-OKS AND
               CAN-CIC-IOPC IN CAN = VEN-CIC-IOPC IN VEN)
               GO TO OUT-REV-RCV-REG.
           IF OPC-NUM-IVEN IN OPC NOT = VEN-NUM-IVEN IN VEN
               MOVE ZEROES TO WSS-SGV-CAPT IN WSS-VARI
               MOVE ZEROES TO WSS-SGV-FINL IN WSS-VARI.
           ADD 1 TO WSS-NUM-VCVG IN WSS-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE VEN-CIC-IOPC IN VEN TO RCV-CIC-IOPV IN RCV.
           MOVE VEN-NUM-IVEN IN VEN TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           MOVE FIO-STAT TO PGM-STAT-RCV.
           IF OPC-IND-VSTR IN OPC NOT = 'S'
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-VEN
           ELSE
      *    IF VEN-NUM-IVCT IN VEN = OPC-NUM-IVEN IN OPC
               MOVE 1 TO VEN-NUM-IVEN IN VEN
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-VEN.
           IF PGM-STAT-RCV-OKS
               MOVE RCV-SGV-CAPI IN RCV TO VEN-VAL-SCAP IN VEN
               MOVE RCV-SGV-FINA IN RCV TO VEN-VAL-SFIN IN VEN
           ELSE
               MOVE VEN-VAL-CAPI IN VEN TO VEN-VAL-SCAP IN VEN
               MOVE VEN-VAL-FINA IN VEN TO VEN-VAL-SFIN IN VEN
               SUBTRACT WSS-SGV-CAPT IN WSS-VARI FROM
                                           VEN-VAL-SCAP IN VEN
               SUBTRACT WSS-SGV-FINL IN WSS-VARI FROM
                                           VEN-VAL-SFIN IN VEN.
           IF TOC-MSC-OPEC = 'D'
               ADD VEN-VAL-SFIN IN VEN TO WSS-VAL-SDLC IN
                                       WSS-VARI(VEN-NUM-IDLC IN VEN)
               ADD VEN-VAL-SFIN IN VEN TO WSS-VAL-OCRE
           ELSE
               PERFORM OBT-RCV-ZNRE
               IF FIO-STAT-OKS
                   MOVE RCV-SGV-CAPI IN RCV TO WSS-VAL-SDLC IN
                                        WSS-VARI(VEN-NUM-IDLC IN VEN)
                   MOVE RCV-SGV-CAPI IN RCV TO WSS-VAL-OCRE
               ELSE
                   ADD VEN-VAL-SCAP IN VEN TO WSS-VAL-SDLC IN
                                       WSS-VARI(VEN-NUM-IDLC IN VEN)
                   ADD VEN-VAL-SCAP IN VEN TO WSS-VAL-OCRE.
           IF OPC-IND-VSTR IN OPC NOT = 'S'
               MOVE FIO-MOD TO FIO-CMND
               PERFORM COL-FIO-VEN
           ELSE
      *    IF VEN-NUM-IVCT IN VEN = OPC-NUM-IVEN IN OPC
               MOVE 1 TO VEN-NUM-IVEN IN VEN
               MOVE FIO-MOD TO FIO-CMND
               PERFORM COL-FIO-VEN
               MOVE VEN-NUM-IVCT IN VEN TO VEN-NUM-IVEN IN VEN.
           IF OPC-IND-VSTR IN OPC NOT = 'S'
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-REV-RCV-REG
           ELSE
               MOVE CAN-NUM-TVCC IN CAN TO WSS-NUM-VCVG IN WSS-VARI.
       OUT-REV-RCV-REG.
           PERFORM REV-OPC-TT.
           PERFORM REV-DLC-TT VARYING WSS-NUM-IDLC FROM 1 BY 1 UNTIL
                             WSS-NUM-IDLC > 499.
           PERFORM PRO-REV.
           MOVE 'A' TO CAN-MSC-STAT IN CAN.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CAN    REVOK' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO REV-MSG-MSG
               MOVE CAN-KEY-ICAN IN CAN TO REV-MSG-CAN
               MOVE REV-MSG TO FRM-MENS
           ELSE
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CANNEW REVNO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO REV-MSG
               MOVE REV-MSG TO FRM-MENS.
       FIN-REV-RCV-REG.
           EXIT.

       OBT-RCV-ZNRE SECTION.
       INI-OBT-RCV-ZNRE.
      *ALD-BCI-INI/21-08-1998
           MOVE VEN-CIC-IOPC IN VEN     TO RCV-CIC-IOPC IN RCV.
           MOVE VEN-CIC-IOPC IN VEN     TO RCV-CIC-IOPV IN RCV.
           MOVE CAN-NUM-ICAN IN CAN-FLD TO RCV-NUM-ICAN IN RCV.
           MOVE ZEROES                  TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-RCV.

      *DAD ini  11-JUN-1993   (Memo.26-02-93)
      *     MOVE CAN TO CAN-BKP.
      *DAD fin  11-JUN-1993
      *     MOVE VEN-CIC-IOPC IN VEN TO RCV-CIC-IOPV IN RCV.
      *     MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *LUP-OBT-RCV-ZNRE.
      *     MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
      *     PERFORM COL-FIO-RCV.
      *     IF NOT FIO-STAT-OKS
      *DAD ini  11-JUN-1993   (Memo.26-02-93)
      *         MOVE CAN-BKP TO CAN
      *DAD fin  11-JUN-1993
      *         GO TO FIN-OBT-RCV-ZNRE.
      *     IF NOT (VEN-CIC-IOPC IN VEN = RCV-CIC-IOPV IN RCV AND
      *        RCV-NUM-IVCT IN RCV = ZEROES )
      *DAD ini  11-JUN-1993   (Memo.26-02-93)
      *         MOVE CAN-BKP TO CAN
      *DAD fin  11-JUN-1993
      *         MOVE FIO-STAT-NEX TO FIO-STAT
      *         GO TO FIN-OBT-RCV-ZNRE.
      *     MOVE RCV-KEY-ICAN TO CAN-KEY-ICAN IN CAN.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM COL-FIO-CAN.
      *     IF CAN-MSC-STAT IN CAN NOT = 'R' AND
      *        CAN-SGV-TPAG IN CAN NOT < ZEROES AND
      *        CAN-SGV-TREN IN CAN NOT < ZEROES
      *         MOVE CAN-CAI-IOPC IN CAN-FLD TO CAN-CAI-IOPC IN CAN
      *         MOVE CAN-IIC-IOPC IN CAN-FLD TO CAN-IIC-IOPC IN CAN
      *         MOVE CAN-NUM-ICAN IN CAN-FLD TO CAN-NUM-ICAN IN CAN
      *         MOVE FIO-GET-KEY TO FIO-CMND
      *         PERFORM COL-FIO-CAN
      *         GO TO FIN-OBT-RCV-ZNRE.
      *     MOVE FIO-GET-NXT TO FIO-CMND
      *     GO TO LUP-OBT-RCV-ZNRE.
      *ALD-BCI-FIN/21-08-1998
       FIN-OBT-RCV-ZNRE.
           EXIT.

       INI-DLC-TT SECTION.
       INI-INI-DLC-TT.
           MOVE ZEROES TO WSS-VAL-SDLC(WSS-NUM-IDLC).
       FIN-INI-DLC-TT.
           EXIT.
       REV-OPC-TT SECTION.
       INI-REV-OPC-TT.
           MOVE CAN-CIC-IOPC IN CAN TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           MOVE WSS-NUM-VCVG IN WSS-VARI TO OPC-NUM-VCVG IN OPC.
           MOVE WSS-VAL-OCRE TO OPC-VAL-SCRE IN OPC.
      *DAD ini  28-ABR-1992   (Memo.13-03-92 pto.5)
           IF OPC-NUM-TVCC IN OPC > ZEROES
               SUBTRACT CAN-NUM-TVCC IN CAN FROM OPC-NUM-TVCC IN OPC
           ELSE
               SUBTRACT CAN-NUM-TVCC IN CAN FROM OPC-NUM-VCCO IN OPC.
      *DAD fin  28-ABR-1992
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FIN-REV-OPC-TT.
           EXIT.
       REV-DLC-TT SECTION.
       INI-REV-DLC-TT.
           MOVE CAN-CIC-IOPC IN CAN TO DLC-CIC-IOPC IN DLC.
           MOVE WSS-NUM-IDLC        TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
               MOVE 500 TO WSS-NUM-IDLC
               GO TO FIN-REV-DLC-TT.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           MOVE WSS-VAL-SDLC(WSS-NUM-IDLC) TO DLC-VAL-SDLC IN DLC.
      *DAD ini  20-NOV-1991   (Memo.15-11-91 pto.2/Memo.19-11-91)
           IF CAN-FEC-FDVA IN CAN > ZEROES
      *DAD fin  20-NOV-1991
               MOVE CAN-FEC-FDVA IN CAN TO DLC-FEC-FDEV IN DLC.
      *     MOVE VEN-NUM-DVEN IN CAN-FLD TO DLC-NUM-DDEV IN DLC.
      *     MOVE VEN-NUM-MVEN IN CAN-FLD TO DLC-NUM-MDEV IN DLC.
      *     MOVE VEN-NUM-SVEN IN CAN-FLD TO DLC-NUM-SDEV IN DLC.
      *     MOVE VEN-NUM-AVEN IN CAN-FLD TO DLC-NUM-ADEV IN DLC.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-DLC.
       FIN-REV-DLC-TT.
           EXIT.

       BUS-COR-ERR SECTION.
       INI-BUS-COR-ERR.
           MOVE 'COLPPCAN'           TO ERR-COD-PRGM IN ERR.
           MOVE SYS-SHOY IN SYS-VARI TO ERR-NUM-SEJE IN ERR.
           MOVE SYS-AHOY IN SYS-VARI TO ERR-NUM-AEJE IN ERR.
           MOVE SYS-MHOY IN SYS-VARI TO ERR-NUM-MEJE IN ERR.
           MOVE SYS-DHOY IN SYS-VARI TO ERR-NUM-DEJE IN ERR.
           MOVE 99                   TO ERR-NUM-CEJE IN ERR.
           MOVE 9999                 TO ERR-NUM-CERR IN ERR.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM GNS-FIO-ERR.
           IF NOT ( FIO-STAT-OKS                                AND
                    ERR-COD-PRGM IN ERR  = 'COLPPCAN'           AND
                    SYS-SHOY IN SYS-VARI =  ERR-NUM-SEJE IN ERR AND
                    SYS-AHOY IN SYS-VARI =  ERR-NUM-AEJE IN ERR AND
                    SYS-MHOY IN SYS-VARI =  ERR-NUM-MEJE IN ERR AND
                    SYS-DHOY IN SYS-VARI =  ERR-NUM-DEJE IN ERR )
               MOVE SYS-SHOY IN SYS-VARI TO ERR-NUM-SEJE IN ERR
               MOVE SYS-AHOY IN SYS-VARI TO ERR-NUM-AEJE IN ERR
               MOVE SYS-MHOY IN SYS-VARI TO ERR-NUM-MEJE IN ERR
               MOVE SYS-DHOY IN SYS-VARI TO ERR-NUM-DEJE IN ERR
               MOVE 1                    TO ERR-NUM-CEJE IN ERR
               MOVE 1                    TO ERR-NUM-CERR IN ERR
               MOVE 'COLPPCAN'           TO ERR-COD-PRGM IN ERR
               GO TO FIN-BUS-COR-ERR.
           ADD 1 TO ERR-NUM-CERR IN ERR.
       FIN-BUS-COR-ERR.
           EXIT.

      * PARAMETROS PARA VERSION 2.0
      * SET-PRM-VSN SECTION.
      * INI-SET-PRM-VSN.
      *     MOVE ADO-FSIS     TO IFD-FSIS.
      * FIN-SET-PRM-VSN.
      *     EXIT.

      * PARAMETROS PARA VERSION 3.1
       SET-PRM-VSN SECTION.
       INI-SET-PRM-VSN.
           MOVE ADO-FIDD TO IDD-FSIS IN IDD-VARI.
       FIN-SET-PRM-VSN.
           EXIT.

       ANL-KEY-RCV SECTION.
       INI-ANL-KEY-RCV.
           MOVE ZEROES TO WSS-SGV-CAPT IN WSS-VARI.
           MOVE ZEROES TO WSS-SGV-FINL IN WSS-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPV IN RCV.
           MOVE OPC-NUM-IVEN IN OPC TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-ANL-KEY-RCV.
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           PERFORM COL-FIO-RCV.
           IF NOT (FIO-STAT-OKS AND
              CAN-CIC-IOPC IN CAN = RCV-CIC-IOPV IN RCV AND
              RCV-NUM-IVCT IN RCV = OPC-NUM-IVEN IN OPC )
               GO TO FIN-ANL-KEY-RCV.
           IF CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV
               ADD RCV-SGV-CAPI IN RCV TO WSS-SGV-CAPT IN WSS-VARI
               ADD RCV-SGV-FINA IN RCV TO WSS-SGV-FINL IN WSS-VARI.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-ANL-KEY-RCV.
       FIN-ANL-KEY-RCV.
           EXIT.

       PUT-CYA-SAF SECTION.
       INI-PUT-CYA-SAF.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE CAN-CIC-IOPC IN CAN TO OPC-CIC-IOPC IN OPC.
           PERFORM FST-CYA-CAN.
       LUP-PUT-CYA-SAF.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS                              AND
                    CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
                    CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA )
                      GO TO FIN-PUT-CYA-SAF.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           MOVE 'TCYA'    TO MSC-CIC-TMSC IN MSC.
           MOVE 'CAJA'    TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
       LUP-BUS-CAJA.
           MOVE 'TAB' TO FIO-SIST.
           PERFORM GNS-FIO-MSC.
           IF NOT ( FIO-STAT-OKS AND
                    MSC-CIC-CMSC IN MSC = 'CAJA' AND
                    MSC-CIC-TMSC IN MSC = 'TCYA' )
               GO TO FIN-PUT-CYA-SAF
           ELSE
               MOVE MSC-GLS-DAT1 IN MSC TO WSS-GLS-DATI IN WSS-VARI
               IF WSS-IND-CSAF IN WSS-VARI = ADO-ET21 AND
                  ADO-ET21 > SPACES
                   MOVE MSC-COD-CMSC IN MSC TO CYA-IND-TCYA IN CYA 
               ELSE
                   MOVE 'MSC-CIC-TABL' TO FIO-AKEY
                   MOVE FIO-GET-NXT    TO FIO-CMND
                   GO TO LUP-BUS-CAJA.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           MOVE FIO-GET-NXT TO FIO-CMND.          
           GO TO LUP-PUT-CYA-SAF.
       FIN-PUT-CYA-SAF.
           EXIT.
      *>>>>
*% END
*% IF EOF_PU
      *<<<< EOF_PU
      *>>>> EOF_PU
*% END
