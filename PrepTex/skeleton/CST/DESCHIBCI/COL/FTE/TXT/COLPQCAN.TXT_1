*% NO_TIENE_TIMESTAMP = TRUE
*% PGM_PTC = TRUE
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
           03  SCR-VARI-PFS.
               05  SCR-KEY-ICAN-ACTU      PIC X(15).
      *PVG INI 24-09-2001
               05  SCR-KEY-ICAN.
                   07  SCR-CIC-IOPC       PIC X(12).
                   07  SCR-NUM-ICAN       PIC X(03).
      *PVG FIN 24-09-2001
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       COPY COLBRRCV.
       COPY COLBRVEN.
       COPY COLBROPC.
       COPY COLBRICG.
       COPY COLBRDLC.
       COPY COLBREVC.
       COPY COLBRCYA.
       COPY COLBRRDC.
       COPY COLBRROV.
       COPY COLBRTOC.
       COPY SGCBRDBC.
       COPY TABBRCAM.
       COPY TABWGCAM.

       COPY COLWGVIN.
       COPY COLWGVEN.

      *SMC-INI 09.09.1993
       COPY COLWGINT.
      *SMC-FIN 09.09.1993
       COPY GNSWGPES.
       COPY GNSWGCPT.

       01  WSS-VARI.
           03  WSS-COD-CAUX.
               05  WSS-COD-TOOC                   PIC X(03).
               05  WSS-COD-AOOC                   PIC X(03).
      *DAD ini  27-FEB-1992   (Memo.05-09-91 Pto.2)
           03  WSS-MSC-CANC.
               05  WSS-MSC-TCAN                   PIC X(01).
               05  WSS-MSC-FCAN                   PIC X(01).
               05  WSS-MSC-ECAN                   PIC X(01).
           03  WSS-COD-TINT                       PIC X(12).
           03  WSS-COD-CVTI                       PIC X(03).
      *DAD fin  27-FEB-1992
      *DAD ini  10-SEP-1992   (Memo.26-05-92 Pto.3)
           03  WSS-IBLK-TINT       VALUE SPACES   PIC X(01).
      *DAD fin  10-SEP-1992
           03  WSS-IBLK-TPAG       VALUE SPACES   PIC X(01).
      *>>>>
*% END
*% IF WSS AND PGM_DTC
      *<<<< WSS AND PGM_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *>>>>
*% END
*% IF PFS_SCR_ACC
      *<<<< PFS_SCR_ACC
           IF FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM VAL-NUM-KEY-CAN
               PERFORM VAL-NUM-FLD-CAN
               PERFORM SCRL-TAB-CAN
               PERFORM SCR-TRL.
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
           IF CAN-NUM-ICAN IN CAN = 0
               MOVE 999 TO CAN-NUM-ICAN IN CAN
               MOVE FIO-GET-LEQ TO FIO-CMND
               PERFORM COL-FIO-CAN
               IF FIO-STAT-OKS AND
                  CAN-CAI-IOPC IN CAN = CAN-CAI-IOPC IN CAN-FLD AND
                  CAN-IIC-IOPC IN CAN = CAN-IIC-IOPC IN CAN-FLD

                   MOVE FIO-STAT TO PGM-STAT-CAN
                   GO TO FIN-FND-KEY
               ELSE
                   MOVE FIO-STAT-NEX TO FIO-STAT
                   GO TO FIN-FND-KEY.
      *>>>>
*% END
*% IF PUT_SCR
      *<<<< PUT_SCR
           IF PGM-STAT-CAN-OKS
               MOVE CAN-KEY-ICAN IN CAN TO SCR-KEY-ICAN-ACTU.

           IF PGM-STAT-CAN-OKS
               PERFORM BUS-ENT-ANEX.
      *>>>>
*% END
*% IF FIN_PUT_SCR
      *<<<< FIN_PUT_SCR
      *DAD ini  27-OCT-1993   (Memo.12-07-92 Pto.2)
           IF CAN-FEC-FOUT IN CAN-FLD NOT > ZEROES
               MOVE SPACES TO CAN-FEC-FOUT IN CAN-FLD.
           IF CAN-FEC-FCAN IN CAN-FLD NOT > ZEROES
               MOVE SPACES TO CAN-FEC-FCAN IN CAN-FLD.
           IF CAN-FEC-FEGR IN CAN-FLD NOT > ZEROES
               MOVE SPACES TO CAN-FEC-FEGR IN CAN-FLD.
      *DAD fin  27-OCT-1993
      *>>>>
*% END
*% IF PFS_GET_CON
      *<<<< PFS_GET_CON
           IF NOT ( FRM-FFLD = FRM-FFLD-PF7 )
           IF NOT ( FRM-FFLD = FRM-FFLD-PF8 )
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       SCRL-TAB-CAN SECTION.
       INI-SCRL-TAB-CAN.
           IF FRM-FFLD = FRM-FFLD-PF7
               PERFORM SCRL-TAB-CAN-PF7
               GO TO FIN-SCRL-TAB-CAN.
           IF FRM-FFLD = FRM-FFLD-PF8
               PERFORM SCRL-TAB-CAN-PF8
               GO TO FIN-SCRL-TAB-CAN.
       FIN-SCRL-TAB-CAN.
           EXIT.

       SCRL-TAB-CAN-PF7 SECTION.
       INI-SCRL-TAB-CAN-PF7.
           MOVE SCR-KEY-ICAN-ACTU TO CAN-KEY-ICAN IN CAN.
      *PVG INI 24-09-2001
           MOVE SCR-KEY-ICAN-ACTU TO SCR-KEY-ICAN.
      *PVG FIN 24-09-2001
           MOVE 'CAN-KEY-ICAN' TO FIO-AKEY.
      *PVG INI 24-09-2001
      *    MOVE FIO-GET-KEY TO FIO-CMND.
           MOVE FIO-GET-LEQ TO FIO-CMND.
      *PVG FIN 24-09-2001
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
               MOVE 'CANCURRNEX' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-CAN-PF7.
           MOVE 'CAN-KEY-ICAN' TO FIO-AKEY.
           MOVE FIO-GET-PRV TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
               MOVE 'CAN    NOPRV' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-CAN-PF7.
      *PVG INI 24-09-2001
           IF NOT CAN-CIC-IOPC IN CAN = SCR-CIC-IOPC
               MOVE '23' TO FIO-STAT
               MOVE 'CAN    NOPRV' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-CAN-PF7.
      *PVG FIN 24-09-2001
           MOVE FIO-STAT TO PGM-STAT-CAN.
           PERFORM SCR-CLRA-CAN.
           PERFORM PUT-SCR.
           GO TO FIN-SCRL-TAB-CAN-PF7.
       MSG-SCRL-TAB-CAN-PF7.
           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MEN2.
       FIN-SCRL-TAB-CAN-PF7.
           EXIT.

       SCRL-TAB-CAN-PF8 SECTION.
       INI-SCRL-TAB-CAN-PF8.
           MOVE SCR-KEY-ICAN-ACTU TO CAN-KEY-ICAN IN CAN.
      *PVG INI 24-09-2001
           MOVE SCR-KEY-ICAN-ACTU TO SCR-KEY-ICAN.
      *PVG FIN 24-09-2001
           MOVE 'CAN-KEY-ICAN' TO FIO-AKEY.
      *PVG INI 24-09-2001 (Compatibilidad VSAM)
      *    MOVE FIO-GET-KEY TO FIO-CMND.
           MOVE FIO-GET-NLS TO FIO-CMND.
      *PVG FIN 24-09-2001
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
               MOVE 'CANCURRNEX' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-CAN-PF8.
           MOVE 'CAN-KEY-ICAN' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
               MOVE 'CAN    NONXT' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-CAN-PF8.
      *PVG INI 24-09-2001
           IF NOT CAN-CIC-IOPC IN CAN = SCR-CIC-IOPC
               MOVE '23' TO FIO-STAT
               MOVE 'CAN    NONXT' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-CAN-PF8.
      *PVG FIN 24-09-2001
           MOVE FIO-STAT TO PGM-STAT-CAN.
           PERFORM SCR-CLRA-CAN.
           PERFORM PUT-SCR.
           GO TO FIN-SCRL-TAB-CAN-PF8.
       MSG-SCRL-TAB-CAN-PF8.
           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MEN2.
       FIN-SCRL-TAB-CAN-PF8.
           EXIT.
      *>>>>
      *<<<< EOF
      ******************************************************************
       BUS-ENT-ANEX SECTION.
       INI-BUS-ENT-ANEX.
      *DAD ini  27-FEB-1992   (Memo.05-09-91 Pto.2)
      *Busqueda de ROV
           MOVE 'COL'               TO TAB-COD-SIST.
           MOVE 'CNC'               TO TAB-COD-TTAB IN TAB.
           MOVE CAN-MSC-CANC IN CAN TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-MSC-CANC IN WSS-VARI.
           IF WSS-MSC-TCAN IN WSS-VARI = 'C'
               GO TO RCV-BUS-ENT-ANEX.
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           MOVE FIO-STAT TO PGM-STAT-ROV.
           IF NOT FIO-STAT-OKS
               GO TO RCV-BUS-ENT-ANEX.
      *MHM-INI
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           PERFORM COL-FIO-ROV.
      *MHM-FIN
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF FIO-STAT-OKS AND
              CAN-CIC-IOPC IN CAN = ROV-CIC-IOPV IN ROV AND
              CAN-NUM-ICAN IN CAN = ROV-NUM-IVCT IN ROV
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'EXMULOPCXCAN' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           MOVE FIO-STAT TO PGM-STAT-ROV.
       RCV-BUS-ENT-ANEX.
      *DAD fin  27-FEB-1992
      *Busqueda de RCV
           MOVE SPACES              TO RCV-KEY-IRCV IN RCV.
           MOVE CAN-KEY-ICAN IN CAN TO RCV-KEY-ICAN IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF FIO-STAT-OKS AND
              RCV-KEY-ICAN IN RCV = CAN-KEY-ICAN IN CAN
               MOVE FIO-STAT TO PGM-STAT-RCV.
      *Busqueda de Operacion
       OPC-BUS-ENT-ANEX.
           MOVE CAN-CIC-IOPC IN CAN TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           MOVE FIO-STAT TO PGM-STAT-OPC.
      *Busqueda de cliente
           IF NOT PGM-STAT-OPC-OKS
               GO TO VEN-BUS-ENT-ANEX.
           MOVE CAN-CIC-IOPC IN CAN TO RDC-CIC-IOPC IN RDC.
           MOVE 0                   TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT FIO-STAT-OKS
               GO TO VEN-BUS-ENT-ANEX.
           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
           IF PGM-STAT-DBC-OKS
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC.
      *Busqueda de VEN
       VEN-BUS-ENT-ANEX.
           IF NOT ( PGM-STAT-OPC-OKS AND PGM-STAT-RCV-OKS )
               GO TO CYA-BUS-ENT-ANEX.
           IF RCV-NUM-IVCT IN RCV NOT > ZEROES
      *DAD ini  27-FEB-1992   (Memo.05-09-91 Pto.2)
      *         GO TO CYA-BUS-ENT-ANEX.
               MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
           ELSE
               MOVE RCV-NUM-IVCT IN RCV TO VEN-NUM-IVEN IN VEN.
      *DAD fin  27-FEB-1992
           MOVE CAN-CIC-IOPC IN CAN TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND
           IF OPC-IND-VSTR IN OPC NOT = 'S'
               PERFORM COL-FIO-VEN
               MOVE FIO-STAT TO PGM-STAT-VEN
           ELSE
               PERFORM COL-OBT-VEN
               IF VEN-STAT-OKS
                   MOVE PGM-SOKS TO PGM-STAT-VEN.
      *     MOVE VEN-NUM-IVCT IN CAN-FLD TO VEN-NUM-IVEN IN CAN-FLD.
      *Busqueda de CYA
       CYA-BUS-ENT-ANEX.
           MOVE CAN-KEY-ICAN IN CAN TO CYA-KEY-ICAN IN CYA.
           MOVE 0                   TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
      *DAD ini  27-FEB-1992   (Memo.05-09-91 Pto.2)
           IF NOT ( FIO-STAT-OKS AND
                    CYA-KEY-ICAN IN CYA = CAN-KEY-ICAN IN CAN )
               GO TO IOP-BUS-ENT-ANEX.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF FIO-STAT-OKS AND
              CYA-KEY-ICAN IN CYA = CAN-KEY-ICAN IN CAN
               MOVE 'M'         TO CYA-IND-TCYA IN CAN-FLD
               MOVE SPACES      TO CYA-CAI-ICYA IN CAN-FLD
               MOVE ZEROES      TO CYA-IIC-ICYA IN CAN-FLD
               MOVE 'MULTIPLES' TO FRM-GLS-TCYA IN CAN-FLD
               MOVE PGM-SNUL    TO PGM-STAT-CYA
               GO TO IOP-BUS-ENT-ANEX.
           MOVE CAN-KEY-ICAN IN CAN TO CYA-KEY-ICAN IN CYA.
           MOVE 0                   TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           MOVE FIO-STAT TO PGM-STAT-CYA.
      *DAD fin  27-FEB-1992
      *Busqueda de ICG asociado a la OPC
       IOP-BUS-ENT-ANEX.
      *DAD ini  27-FEB-1992   (Memo.05-09-91 Pto.2)
           MOVE SPACES TO WSS-COD-TINT IN WSS-VARI
                          WSS-COD-CVTI IN WSS-VARI.
      *DAD fin  27-FEB-1992
           MOVE CAN-CIC-IOPC IN CAN TO VIN-CIC-IOPC.
           MOVE 0                   TO VIN-NUM-IDLC.
           PERFORM BUS-VIN.
           IF FIO-STAT-OKS
      *DAD ini  27-FEB-1992   (Memo.05-09-91 Pto.2)
               MOVE ICG-COD-TINT IN ICG TO WSS-COD-TINT IN WSS-VARI
               MOVE ICG-COD-CVTI IN ICG TO WSS-COD-CVTI IN WSS-VARI
      *DAD fin  27-FEB-1992
               IF ICG-COD-CVTI IN ICG > SPACES
                   MOVE ICG-SGV-SPRD IN ICG TO FRM-SGV-TINT IN CAN-FLD
               ELSE
                   MOVE ICG-SGV-TINT IN ICG TO FRM-SGV-TINT IN CAN-FLD.
      *DAD ini  27-FEB-1992   (Memo.05-09-91 Pto.2)
           IF FIO-STAT-OKS
               IF ICG-COD-TINT IN ICG > SPACES
                   MOVE 'COL'               TO TAB-COD-SIST
                   MOVE 'INT'               TO TAB-COD-TTAB IN TAB
                   MOVE ICG-COD-TINT IN ICG TO TAB-COD-CTAB IN TAB
                   PERFORM BUS-TAB
                   MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-IITR IN CAN-FLD
               ELSE
                   MOVE SPACES TO FRM-GLS-IITR IN CAN-FLD.
      *DAD fin  27-FEB-1992
      *Busqueda de ICG asociado a la CAN
       ICG-BUS-ENT-ANEX.
           IF NOT PGM-STAT-RCV-OKS
               GO TO FIN-BUS-ENT-ANEX.
           MOVE CAN-KEY-ICAN IN CAN TO ICG-KEY-ICAN IN ICG.
      *DAD ini  27-FEB-1992   (Memo.05-09-91 Pto.2)
      *     MOVE RCV-KEY-IVCT IN RCV TO ICG-KEY-IVCT IN ICG.
           MOVE CAN-CIC-IOPC IN CAN TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
      *DAD fin  27-FEB-1992
           MOVE 'INT'               TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF FIO-STAT-OKS AND
              ICG-KEY-ICAN IN ICG = CAN-KEY-ICAN IN CAN AND
      *DAD ini  27-FEB-1992   (Memo.05-09-91 Pto.2)
      *        ICG-KEY-IVCT IN ICG = RCV-KEY-IVCT IN RCV AND
              ICG-CIC-IOPV IN ICG = CAN-CIC-IOPC IN CAN AND
              ICG-NUM-IVCT IN ICG = ZEROES              AND
      *DAD fin  27-FEB-1992
              ICG-IND-TTAS IN ICG = 'INT'
               MOVE FIO-STAT TO PGM-STAT-ICG.
      *DAD ini  27-FEB-1992   (Memo.05-09-91 Pto.2)
           IF PGM-STAT-ICG-OKS
               MOVE 'COL'               TO TAB-COD-SIST
               MOVE 'INT'               TO TAB-COD-TTAB IN TAB
               MOVE ICG-COD-TINT IN ICG TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-TINT IN CAN-FLD
           ELSE
      * Si la Tasa del credito es Variable busca la Tasa con el CIC = 'C
      * si no asume la Tasa del credito
           IF WSS-COD-CVTI IN WSS-VARI > SPACES
                MOVE 'COL' TO TAB-COD-SIST
                MOVE 'INT' TO TAB-CIC-TTAB IN TAB
                MOVE 'CAN' TO TAB-CIC-CTAB IN TAB
                MOVE 'TAB-CIC-TABL' TO FIO-AKEY
                PERFORM BUS-TAB
                MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-TINT IN CAN-FLD
           ELSE
                MOVE 'COL'                    TO TAB-COD-SIST
                MOVE 'INT'                    TO TAB-COD-TTAB IN TAB
                MOVE WSS-COD-TINT IN WSS-VARI TO TAB-COD-CTAB IN TAB
                PERFORM BUS-TAB
                MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-TINT IN CAN-FLD.
      *DAD fin  27-FEB-1992
       FIN-BUS-ENT-ANEX.
           EXIT.
      ******************************************************************

       COPY COLBFRCV.
       COPY COLBFVEN.
       COPY COLBFOPC.
       COPY COLBFICG.
       COPY COLBFDLC.
       COPY COLBFEVC.
       COPY COLBFCYA.
       COPY COLBFRDC.
       COPY COLBFROV.
       COPY COLBFTOC.
       COPY SGCBFDBC.
       COPY TABBFCAM.

       COPY COLBGVIN.
       COPY COLBGVEN.

      *SMC-INI 09.09.1993
       COPY COLBGINT.
      *SMC-FIN 09.09.1993
       COPY GNSBGPES.
       COPY GNSBGCPT.
       COPY GNSBPFEC.

*% END
