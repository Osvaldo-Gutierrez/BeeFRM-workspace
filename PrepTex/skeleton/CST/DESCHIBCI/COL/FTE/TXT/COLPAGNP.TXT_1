*%! Codigo adicional
*% NO_TIENE_TIMESTAMP = TRUE
*% NO_HDR_CST = TRUE
*% LARGO_TOTAL_COMMAREA = 3000
*% FMT_CHI = TRUE
*% GEN_BCI = TRUE
*% PGM_PTC = TRUE
*% PGM_STAT_EVC = TRUE
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
           03 SCR-NUM-PANT               PIC 9(0002).
           03 SCR-GNP-FLD                PIC X(1250).
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       COPY COLBREVC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.

       01  WSS-VARI.
           03 WSS-IND-CORP           VALUE 'N'          PIC X(01).
       COPY COLWXGNP.
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           IF SCR-OFRM-SRV
               MOVE TSK-TERM-ALF TO GNP-COD-TERM
               MOVE TSK-TERM-ALF TO GNP-COD-TERM-MAS
           ELSE
               MOVE EIBTRMID     TO GNP-COD-TERM
               MOVE EIBTRMID     TO GNP-COD-TERM-MAS.

           MOVE +3859 TO SCR-TCMA.
           PERFORM GNS-ERR-QUE.
           IF ( FRM-FFLD = FRM-FFLD-PF5 ) AND ( SCR-NUM-PANT = 1 )
               MOVE SCR-GNP-FLD TO GNP-FLD
               GO TO FIN-INI.
           IF ( FRM-FFLD = FRM-FFLD-PF6 )
               MULTIPLY SCR-NUM-PANT BY WSS-IMAX GIVING QUE-NITM
               ADD 1           TO QUE-NITM
               MOVE GNP-NOM-TS TO QUE-COLA
               MOVE GNP-LEN-TS TO QUE-LITM
               MOVE QUE-GET    TO QUE-CMND
               PERFORM GNS-PRO-QUE
               IF QUE-STAT NOT = QUE-STAT-OKS
                  MOVE SCR-GNP-FLD TO GNP-FLD
                  GO TO FIN-INI.
      *>>>>
*% END
*% IF PFS_SCR_ACC
      *<<<< PFS_SCR_ACC
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6
               PERFORM VAL-NUM-KEY-GNP
               PERFORM VAL-NUM-FLD-GNP
               PERFORM SCRL-TAB-GNP
               PERFORM SCR-TRL.
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
           GO TO CON-FND-KEY.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
       CON-FND-KEY.
      *>>>>
*% END
*% IF PFS_GET_CON
      *<<<< PFS_GET_CON
           IF NOT ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 )
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       PUT-TAB SECTION.
       INI-PUT-TAB.
           MOVE GNP-NOM-TS     TO QUE-COLA.
           MOVE QUE-DEL        TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           MOVE GNP-NOM-TS-MAS TO QUE-COLA.
           MOVE QUE-DEL        TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           MOVE 1          TO SCR-NUM-PANT.
           MOVE LOW-VALUES TO FRM-CIC-IPVC-R-IDX.
      *
           MOVE 1          TO FRM-IFLD.
           MOVE ZEROES     TO WSS-NITM.

           MOVE 1 TO WSS-F.
       LUP-PUT-TAB.
           IF WSS-F > WSS-FMAX
              GO TO FIN-PUT-TAB.
           IF FRM-NUM-VIGU-V(WSS-F) > ZEROES
              PERFORM PUT-TAB-GNP
              PERFORM PUT-GNP-QUE
              PERFORM SET-FRM-IFLD
           ELSE
           IF FRM-IFLD = 1 AND WSS-F = 1
              GO TO MSG-PUT-TAB
           ELSE
              MOVE '00' TO FIO-STAT
              GO TO FIN-PUT-TAB.

           ADD 1 TO WSS-F.
           GO TO LUP-PUT-TAB.
       MSG-PUT-TAB.
           MOVE 'COL'          TO MSG-COD-SIST.
           MOVE 'EVCNP    NEX' TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE '00' TO FIO-STAT.
      *    MOVE 'S' TO SCR-IERR.
       FIN-PUT-TAB.
           MOVE 1               TO QUE-NITM.
           MOVE GNP-LEN-TS-MAS  TO QUE-LITM.
           MOVE GNP-NOM-TS-MAS  TO QUE-COLA.

           IF WSS-NITM > WSS-NITMMAX
              MOVE 'S'           TO SPR-MAS-IND-HMAS
           ELSE
              MOVE 'N'           TO SPR-MAS-IND-HMAS.

           MOVE WSS-NITM         TO WSS-NUM-ICUR.
           MOVE WSS-NUM-ICUR     TO WSS-NUM-ICUR-EDT.
           MOVE WSS-NUM-ICUR-EDT TO WSS-NUM-ICUR-ALF.
           MOVE WSS-NUM-ICUR-ALF TO SPR-MAS-NUM-TOCC.
           MOVE SPR-MAS-ITEM     TO QUE-ITEM.
           MOVE QUE-PUT          TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF WSS-NITM > WSS-NITMMAX
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'GNP   DMAS' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.
       EXT-PUT-TAB.
           EXIT.

       PUT-TAB-GNP SECTION.
       INI-PUT-TAB-GNP.
           PERFORM CLR-WSS.
           MOVE OSG-SGS-COD-SIST(WSS-F) TO SPR-COD-SIST-C.
           MOVE OSG-SGS-COD-EVEN(WSS-F) TO SPR-COD-EVEN-C.

           IF FRM-IFLD > WSS-NITMMAX
              GO TO FIN-PUT-TAB-GNP.

           MOVE SPR-SGV-TINF-V TO FRM-SGV-TINF-V IN GNP-FLD(FRM-IFLD).
           MOVE SPR-SGV-TMIN-V TO FRM-SGV-TMIN-V IN GNP-FLD(FRM-IFLD).
           MOVE SPR-SGV-TCAL-V TO FRM-SGV-TCAL-V IN GNP-FLD(FRM-IFLD).
       FIN-PUT-TAB-GNP.
           EXIT.
      *----------------------------------------------------
       PUT-GNP-QUE SECTION.
       INI-PUT-GNP-QUE.
           ADD 1                   TO WSS-NITM.
           MOVE GNP-NOM-TS         TO QUE-COLA.
           MOVE GNP-LEN-TS         TO QUE-LITM.
           MOVE WSS-NITM           TO QUE-NITM.
           MOVE SPACES             TO QUE-ITEM.
           MOVE SPR-IND-OPCL-R-IDX TO QUE-ITEM.
           MOVE QUE-PUT            TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
       FIN-PUT-GNP-QUE.
           EXIT.

       CLR-WSS SECTION.
       INI-CLR-WSS.
           MOVE 'P'    TO SPR-IIC-IOPE-R-ATR.
           MOVE ZEROES TO SPR-IIC-IOPE-R.
           IF SCR-OFRM-SRV
               PERFORM CLR-FRM-MTX.
       FIN-CLR-WSS.
           EXIT.

       CLR-FRM-MTX SECTION.
       INI-CLR-FRM-MTX.
           MOVE 'P'    TO FRM-CAI-IOPE-R-ATR IN GNP-FLD(1).
           MOVE SPACES TO FRM-CAI-IOPE-R IN GNP-FLD(1).
       FIN-CLR-FRM-MTX.
           EXIT.

       SET-FRM-IFLD SECTION.
       INI-SET-FRM-IFLD.
           IF SCR-OFRM-SRV
                MOVE 1 TO FRM-IFLD
           ELSE
                ADD 1 TO FRM-IFLD.
       FIN-SET-FRM-IFLD.
           EXIT.

       PUT-TAB-ASC SECTION.
       INI-PUT-TAB-ASC.
           MOVE SPACES TO MSG-COD-MENS.
           MULTIPLY SCR-NUM-PANT BY WSS-IMAX GIVING QUE-NITM.
           MOVE 0 TO FRM-IFLD.
       LUP-PUT-TAB-ASC.
           ADD 1           TO QUE-NITM.
           MOVE GNP-NOM-TS TO QUE-COLA.
           MOVE GNP-LEN-TS TO QUE-LITM.
           MOVE QUE-GET    TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               IF FRM-IFLD = 0
                   MOVE 'GNP   NONXT' TO MSG-COD-MENS
                   GO TO FIN-PUT-TAB-ASC
               ELSE
                   GO TO FIN-PUT-TAB-ASC.
           ADD 1 TO FRM-IFLD.
           MOVE QUE-ITEM TO FRM-CIC-IPVC-R-IDX(FRM-IFLD).
           IF FRM-IFLD < WSS-IMAX
               GO TO LUP-PUT-TAB-ASC.
       FIN-PUT-TAB-ASC.
           IF FRM-IFLD > 0 AND FRM-IFLD < WSS-IMAX
               ADD 1 FRM-IFLD GIVING WSS-I
               PERFORM CLR-FRM VARYING WSS-I FROM WSS-I BY 1
                                 UNTIL WSS-I > WSS-IMAX.
           IF FRM-IFLD > 0
               ADD 1 TO SCR-NUM-PANT.
           IF FRM-IFLD = WSS-IMAX
               ADD 1           TO QUE-NITM
               MOVE GNP-NOM-TS TO QUE-COLA
               MOVE GNP-LEN-TS TO QUE-LITM
               MOVE QUE-GET    TO QUE-CMND
               PERFORM GNS-PRO-QUE
               IF QUE-STAT = QUE-STAT-OKS
                   MOVE 'COL'        TO MSG-COD-SIST
                   MOVE 'GNP   DMAS' TO MSG-COD-MENS.
       EXT-PUT-TAB-ASC.
           EXIT.

       PUT-TAB-DSC SECTION.
       INI-PUT-TAB-DSC.
           MOVE SPACES TO MSG-COD-MENS.
           IF SCR-NUM-PANT = 1
               MOVE 'GNP   NOPRV' TO MSG-COD-MENS
               GO TO EXT-PUT-TAB-DSC.

           SUBTRACT 1 FROM SCR-NUM-PANT GIVING QUE-NITM.
           MULTIPLY QUE-NITM BY WSS-IMAX GIVING QUE-NITM.
           ADD 1 TO QUE-NITM.
           ADD 1 WSS-IMAX GIVING FRM-IFLD.
       LUP-PUT-TAB-DSC.
           SUBTRACT  1 FROM QUE-NITM.
           MOVE GNP-NOM-TS TO QUE-COLA
           MOVE GNP-LEN-TS TO QUE-LITM
           MOVE QUE-GET    TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               IF FRM-IFLD > WSS-IMAX
                   MOVE 'GNP   NOPRV' TO MSG-COD-MENS
                   GO TO FIN-PUT-TAB-DSC
               ELSE
                   GO TO FIN-PUT-TAB-DSC.
           SUBTRACT 1 FROM FRM-IFLD.
           MOVE QUE-ITEM TO FRM-CIC-IPVC-R-IDX(FRM-IFLD).
           IF FRM-IFLD > 1
               GO TO LUP-PUT-TAB-DSC.
       FIN-PUT-TAB-DSC.
           IF FRM-IFLD NOT > WSS-IMAX AND FRM-IFLD > 1
               SUBTRACT 1 FROM FRM-IFLD GIVING WSS-I
               PERFORM CLR-FRM VARYING WSS-I FROM WSS-I BY -1
                                 UNTIL WSS-I < 1.
           IF FRM-IFLD NOT > WSS-IMAX
               SUBTRACT 1 FROM SCR-NUM-PANT
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'GNP   DMAS' TO MSG-COD-MENS.
       EXT-PUT-TAB-DSC.
           EXIT.

       CLR-FRM SECTION.
       INI-CLR-FRM.
           MOVE SPACES TO FRM-CAI-IOPE-R IN GNP-FLD(WSS-I).
       FIN-CLR-FRM.
           EXIT.

       SCRL-TAB-SPR SECTION.
       INI-SCRL-TAB-SPR.
           MOVE SPACES TO MSG-COD-MENS.
           IF FRM-FFLD = FRM-FFLD-PF6
               PERFORM PUT-TAB-ASC
           ELSE
               PERFORM PUT-TAB-DSC.
           IF MSG-COD-MENS > SPACES
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.
       FIN-SCRL-TAB-SPR.
           EXIT.

       COPY COLBFEVC.
       COPY COLBKGNP.
      *>>>>
*% END
