*%! Codigo adicional para archivo
*% IF CMT_ID
      *<<<< CMT_ID
      *>>>>
*% END
*% IF IOS
      *<<<< IOS
      *>>>>
*% END
*% IF RR
      *<<<< RR
      *>>>>
*% END
*% IF FD_RPT
      *<<<< FD_RPT
      *>>>>
*% END
*% IF FLS
      *<<<< FLS
      *>>>>
*% END
*% IF RW
      *<<<< RW
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY COLBRRDC.
       COPY SGCBRDBC.
       COPY TABBROFI.
       COPY TABBRTIO.
       COPY COLBRSEA.
       COPY GNSWGFEC.
       COPY GNSWGCPT.
       COPY GNSWGHOY.
       COPY GNSWGMES.
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       01  WSS-VARI.
           03  WSS-FEC-FPRO.
               05  WSS-NUM-DPRO       PIC 9(02).
               05  WSS-NUM-MPRO       PIC 9(02).
               05  WSS-NUM-SPRO       PIC 9(02).
               05  WSS-NUM-APRO       PIC 9(02).
           03  WSS-FEC-FAUX.
               05  WSS-NUM-SAUX       PIC 9(02).
               05  WSS-NUM-AAUX       PIC 9(02).
               05  WSS-NUM-MAUX       PIC 9(02).
               05  WSS-NUM-DAUX       PIC 9(02).
           03  WSS-COD-CAUX.
               05  WSS-COD-TOOC       PIC X(03).
               05  WSS-COD-AOOC       PIC X(03).
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
      *>>>>
*% END
*% IF RF
      *<<<< RF
      *>>>>
*% END
*% IF RT
      *<<<< RT
      *>>>>
*% END
*% IF CF_SEA_WSS_VAL_TRMO
      *<<<< CF_SEA_WSS_VAL_TRMO
      *>>>>
*% END
*% IF PH_SEA
      *<<<< PH_SEA
      *>>>>
*% END
*% IF FF_SEA
      *<<<< FF_SEA
      *>>>>
*% END
*% IF FIN_DEC
      *<<<< FIN_DEC
      *>>>>
*% END
*% IF INI
      *<<<< INI
      *>>>>
*% END
*% IF RS
      *<<<< RS
      *>>>>
*% END
*% IF FIN
      *<<<< FIN
      *>>>>
*% END
*% IF INI_INP
      *<<<< INI_INP
      * Apertura archivo adicional
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM COL-FIO-SEA.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR AL ABRIR ARCHIVO SEA'
               GO TO FIN-INP-SRT.

      * Captura fecha de proceso
           ACCEPT WSS-FEC-FPRO IN WSS-VARI.
           DISPLAY 'FECHA DE PROCESO: ' WSS-FEC-FPRO IN WSS-VARI.
      * Validacion de parametro
      *VAL-FEC Valida fecha proceso
           MOVE WSS-FEC-FPRO IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC             TO FEC-FORM.
           MOVE FEC-FBLK-N               TO FEC-FBLK.
      *ALD-BCI-INI/27.10.1995
           MOVE FEC-CHOY-N               TO FEC-CHOY.
      *     MOVE FEC-CHOY-LE              TO FEC-CHOY.
      *ALD-BCI-FIN/27.10.1995
      *
           MOVE FEC-VHBL-N               TO FEC-VHBL.
           MOVE FEC-VAL-FEC              TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO '
              DISPLAY ' ERROR EN VALIDACION F. DE PROCESO : '
                        WSS-FEC-FPRO IN WSS-VARI '  ' FEC-MENS
              PERFORM GNS-PRO-END.

           MOVE WSS-NUM-DPRO IN WSS-VARI TO FEC-ITM1.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO FEC-ITM2.
           MOVE WSS-NUM-SPRO IN WSS-VARI TO FEC-ITM3.
           MOVE WSS-NUM-APRO IN WSS-VARI TO FEC-ITM4.
           MOVE 01                       TO FEC-NMES.
           MOVE FEC-RST-MES              TO FEC-CMND.
           MOVE FEC-FORM-FEC             TO FEC-FORM.
           PERFORM CAL-FEC.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR AL RESTAR 1 A FECHA PROCESO'
               GO TO FIN-INP-SRT.

           MOVE 01                       TO WSS-NUM-DAUX IN WSS-VARI.
           MOVE FEC-ITM2                 TO WSS-NUM-MAUX IN WSS-VARI.
           MOVE FEC-ITM3                 TO WSS-NUM-SAUX IN WSS-VARI.
           MOVE FEC-ITM4                 TO WSS-NUM-AAUX IN WSS-VARI.
      *>>>>
*% END
*% IF INI_FST_INP
      *<<<< INI_FST_INP
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR EN APERTURA DE OPC'.
           MOVE WSS-FEC-FAUX IN WSS-VARI TO OPC-FEC-FINP IN OPC.
           MOVE 'OPC-FEC-FINP' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           GO TO LUP-INP-SRT.
      *>>>>
*% END
*% IF FIN_FST_INP
      *<<<< FIN_FST_INP
      *>>>>
*% END
*% IF LUP_INP
      *<<<< LUP_INP
           IF OPC-VAL-SEGP IN OPC IS NOT NUMERIC
               MOVE ZEROES TO OPC-VAL-SEGP IN OPC.
           IF OPC-NUM-MINP IN OPC = WSS-NUM-MAUX IN WSS-VARI AND
              OPC-NUM-SINP IN OPC = WSS-NUM-SAUX IN WSS-VARI AND
              OPC-NUM-AINP IN OPC = WSS-NUM-AAUX IN WSS-VARI AND
              OPC-VAL-SEGP IN OPC > ZEROES AND
              OPC-MSC-STAT IN OPC = 'A'
      *Verifica que credito sea Automotriz y no de casantia
               MOVE 'COL'               TO TAB-COD-SIST FIO-SIST
               MOVE 'VSC'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-TOOC IN OPC TO WSS-COD-TOOC IN WSS-VARI
               MOVE OPC-COD-AOOC IN OPC TO WSS-COD-AOOC IN WSS-VARI
               MOVE WSS-COD-CAUX IN WSS-VARI TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-TAB
               IF NOT FIO-STAT-OKS OR TAB-IND-VIGE IN TAB NOT = 'S'
                  PERFORM BUS-SIST-OPERA
                  IF TIO-GLS-SIST IN TIO = 'COL'
                     MOVE OPC-IIC-IOPC IN OPC TO OPC-IIC-IOPC IN SRT
                     MOVE OPC-CAI-IOPC IN OPC TO OPC-CAI-IOPC IN SRT
                     MOVE OPC-COD-OFOC IN OPC TO OPC-COD-OFOC IN SRT
                     MOVE OPC-VAL-CRED IN OPC TO OPC-VAL-CRED IN SRT
                     MOVE OPC-VAL-SEGP IN OPC TO WSS-VAL-SEGA IN SRT
                     MOVE MES-DMES(WSS-NUM-MAUX) TO WSS-GLS-MES IN SRT

      *Graba cic opc, valor credito y valor seguro en archivo
                     MOVE OPC-IIC-IOPC IN OPC TO SEA-IIC-IOPC IN SEA
                     MOVE OPC-CAI-IOPC IN OPC TO SEA-CAI-IOPC IN SEA
                     MOVE OPC-VAL-CRED IN OPC TO SEA-VAL-CRED IN SEA
                     MOVE OPC-VAL-SEGP IN OPC TO SEA-VAL-SEGP IN SEA

                     PERFORM OBT-GLS-MONE

                     PERFORM BUSCA-RUT-NOMBRE

                     PERFORM LLENA-RESTO-SEA

                     MOVE FIO-PUT TO FIO-CMND
                     PERFORM COL-FIO-SEA
                     RELEASE SRT.

           GO TO NXT-INP-SRT.
      *>>>>
*% END
*% IF RM
      *<<<< RM
      *>>>>
*% END
*% IF INI_NXT_INP
      *<<<< INI_NXT_INP
           MOVE 'OPC-FEC-FINP' TO FIO-AKEY.
      *>>>>
*% END
*% IF FIN_NXT_INP
      *<<<< FIN_NXT_INP
      *>>>>
*% END
*% IF FIN_INP
      *<<<< FIN_INP
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-SEA.
      *>>>>
*% END
*% IF INI_OUT
      *<<<< INI_OUT
      *>>>>
*% END
*% IF FST_OUT
      *<<<< FST_OUT
           MOVE 'COLPLSEA' TO WSS-GLS-PRGM IN WSS-SEA.
      *>>>>
*% END
*% IF LUP_OUT
      *<<<< LUP_OUT
           IF OPC-COD-OFOC IN SRT > SPACES
               PERFORM BUSCA-OFI
           ELSE
               MOVE SPACES TO WSS-GLS-OFIC IN WSS-SEA.
      *>>>>
*% END
*% IF FIN_GEN_OUT
      *<<<< FIN_GEN_OUT
      *>>>>
*% END
*% IF FIN_OUT
      *<<<< FIN_OUT
      *>>>>
*% END
*% IF FIN_TMT
      *<<<< FIN_TMT
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       COPY GNSBGHOY.
       COPY GNSBBTAB.
       COPY GNSBBMSG.
       COPY GNSBGCPT.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY COLBFRDC.
       COPY SGCBFDBC.
       COPY COLBFSEA.
       COPY TABBFOFI.
       COPY TABBBOFI.


       OBT-GLS-MONE SECTION.
       INI-OBT-GLS-MONE.
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'VLR'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS NOT = SPACES
              MOVE MSG-GLS-DCOR TO WSS-GLS-MONE IN SRT
              MOVE MSG-GLS-DCOR TO SEA-GLS-MONE IN SEA
           ELSE
              MOVE TAB-GLS-ABRV TO WSS-GLS-MONE IN SRT
              MOVE TAB-GLS-ABRV TO SEA-GLS-MONE IN SEA.
       FIN-OBT-GLS-MONE.
           EXIT.


       BUSCA-RUT-NOMBRE SECTION.
       INI-BUSCA-RUT-NOMBRE.

           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM COL-FIO-RDC.

           IF NOT ( FIO-STAT-OKS AND
                    RDC-CIC-IOPC IN RDC = OPC-CIC-IOPC IN OPC AND
                    RDC-NUM-IDLC IN RDC = ZEROES )
               GO TO FIN-BUSCA-RUT-NOMBRE.

           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.

           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR EN LECTURA DE DBC'
               GO TO FIN-BUSCA-RUT-NOMBRE.

           MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN SRT.
           MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN SRT.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO DBC-GLS-NOMC IN SRT.

      *Graba rut y nombre cliente en archivo
           MOVE SPACES              TO SEA-FIL-ICLI IN SEA.
           MOVE DBC-NUM-ICLI IN SRT TO SEA-NUM-ICLI IN SEA.
           MOVE DBC-VRF-ICLI IN SRT TO SEA-VRF-ICLI IN SEA.
           MOVE DBC-GLS-NOMC IN SRT TO SEA-GLS-NOMC IN SEA.
       FIN-BUSCA-RUT-NOMBRE.
           EXIT.


       LLENA-RESTO-SEA SECTION.
       INI-LLENA-RESTO-SEA.
           MOVE ZEROES TO SEA-FEC-FCOL IN SEA
                          SEA-FEC-FTER IN SEA
                          SEA-FEC-FNAC IN SEA
                          SEA-NUM-TRMO IN SEA.
       FIN-LLENA-RESTO-SEA.
           EXIT.

       BUSCA-OFI SECTION.
       INI-BUSCA-OFI.
           MOVE OPC-COD-OFOC IN SRT TO OFI-COD-OFIC IN OFI.
           PERFORM BUS-OFI.
           MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFIC IN WSS-SEA.
       FIN-BUSCA-OFI.
           EXIT.

       BUS-SIST-OPERA SECTION.
       INI-BUS-SIST-OPERA.
      * BUSCA SISTEMA EN DONDE OPERA
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'TIO'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-TOOC IN OPC TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS = 'COD    NEX'
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'TIO    NEX'   TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC ' ' OPC-KEY-IOPC IN OPC
                       ' ' TAB-COD-CTAB IN TAB
               MOVE SPACES TO TIO
               GO TO FIN-BUS-SIST-OPERA.

           MOVE TAB TO TIO.
       FIN-BUS-SIST-OPERA.
           EXIT.
      *>>>>
*% END
