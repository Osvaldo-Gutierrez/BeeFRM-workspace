*%! Codigo adicional para archivo COLPQCMP
*% IF SETTAG
*% FNCPQ = "CNCMSV"
*% VSNPQ = "06.07.25"
*% END
*% LARGO_MI_COMMAREA = 20
*% PGM_PTC = TRUE
*% IF MI_COMMAREA
      *<<<< MI_COMMAREA                                                 
           03 CMA-VARI.                                                 
              05 SCR-IMAX      COMP                   PIC S9(04).       
              05 SCR-I         COMP                   PIC S9(04).       
      *>>>>      
*% END             
*% IF WSS                                                         
      *<<<< WSS   
       COPY COLWGCMP.
       COPY COLBRDTT.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DTT-REQA==.  
       01  WSS-VARI.                                                    
           03  WSS-TOT     VALUE ZEROES           PIC 9(04).            
           03  WSS-IND-EXIS                       PIC X(01).            
           03  WSS-IND-ECVN                       PIC X(01).
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO 
           IF SCR-OFRM-SRV                                              
              MOVE TSK-TERM-ALF TO CMP-COD-TERM                         
              MOVE TSK-TERM-ALF TO CMP-COD-TERM-MAS                     
                                                                        
           ELSE                                                         
              MOVE EIBTRMID     TO CMP-COD-TERM                         
              MOVE EIBTRMID     TO CMP-COD-TERM-MAS.                    
      *>>>>
*% END
*% IF PFS_SCR_ACC                                                 
      *<<<< PFS_SCR_ACC                                                 
           IF FRM-FFLD = FRM-FFLD-PF6                                   
                    OR   FRM-FFLD-PF5                                   
               PERFORM VAL-NUM-KEY-CMP                                  
               PERFORM VAL-NUM-FLD-CMP                                  
               PERFORM RST-STAT                                         
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY                     
               IF SCR-STAT NOT = SCR-STAT-ABT                           
                   PERFORM SCR-TRL                                      
               ELSE                  
                   PERFORM DESSCRTRL                                    
                   GO TO FIN-SCR-ACC.                                   
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY                                            
           MOVE SPACES TO FRM-MEN1.                                
           IF FRM-FFLD = FRM-FFLD-PF5                              
              MOVE PGM-SNUL TO PGM-STAT-PTT                      
              SUBTRACT 1 FROM SCR-I GIVING CMP-I                  
              IF CMP-I NOT > ZEROES                               
                 MOVE 'CMP GTIAPRV' TO MSG-COD-MENS              
                 GO TO ERR-FND-KEY                               
              ELSE                                                
                 GO TO CARGA-CMP                                 
           ELSE                                                    
           IF FRM-FFLD = FRM-FFLD-PF6                              
              MOVE PGM-SNUL TO PGM-STAT-PTT                       
              ADD 1 SCR-I GIVING CMP-I                            
              IF CMP-I > SCR-IMAX                                 
                MOVE 'CMP GTIANXT' TO MSG-COD-MENS              
                GO TO ERR-FND-KEY                               
              ELSE 
                GO TO CARGA-CMP.                                
           GO TO CON-FND-KEY.                                      
      *>>>>                 
*% END     
*% IF FIN_FND_KEY                                  
      *<<<< FIN_FND_KEY                                            
           IF NOT FIO-STAT-OKS                                     
               GO TO FIN-FND-KEY.                                  
       CON-FND-KEY.                                                
           MOVE ZEROES TO SCR-IMAX.                                
           MOVE 1 TO SCR-I.                                        
           MOVE '00' TO FIO-STAT.                                  
           PERFORM OBT-DAT-TS.                                     
           IF MSG-COD-MENS > SPACES                                     
               GO TO ERR-FND-KEY.                                       
           MOVE 1 TO SCR-I.                                        
           MOVE SCR-I TO CMP-I.                                    
       CARGA-CMP.                                                  
           MOVE SPACES TO MSG-COD-MENS.                            
           IF NOT SCR-OFRM-SRV                                     
             PERFORM PUT-TAB-CMP.                                    
             MOVE '00' TO FIO-STAT.                                  
             GO TO FIN-FND-KEY.                                      
       ERR-FND-KEY.                                                
           MOVE SCR-STAT-CON TO SCR-STAT.                          
           MOVE 'COL'  TO MSG-COD-SIST.                            
           PERFORM GET-MSG.                                        
           MOVE MSG-GLS-DESC TO FRM-MEN1.                          
           MOVE '00' TO FIO-STAT.                                  
           GO TO FIN-FND-KEY.                                      
      *>>>>                                                        
*% END
*% IF PFS_GET_CON OR PFS_GET_ACC                                  
      *<<<< PFS_GET_CON OR PFS_GET_ACC                                  
           IF NOT (FRM-FFLD = FRM-FFLD-PF6                              
                         OR   FRM-FFLD-PF5)                             
      *>>>>
*% END
*% IF EOF
      *<<<<
       COPY COLBFDTT.                                                   
       COPY GNSBVCOD.                                                   
       COPY GNSBVTAB.                                                   
       COPY GNSBBTAB.       
      *>>>>
*% END
*% IF EOF_PQ
      *<<<<
       CAR-MOV-CMP-CVN SECTION.                                         
       INI-CAR-MOV-CMP-CVN.                                             
      *MHM-INI 28-NOV-2008
      *    MOVE 'N' TO WSS-IND-EXIS.                                    
      *MHM-FIN 28-NOV-2008
           MOVE 'N' TO WSS-IND-ECVN IN WSS-VARI.                        
           MOVE PTT-CAI-ICVN IN CMP-FLD TO PTT-CAI-ICVN IN PTT.         
           MOVE PTT-IIC-ICVN IN CMP-FLD TO PTT-IIC-ICVN IN PTT.         
           MOVE FIO-GET-KEY             TO FIO-CMND.                    
       LUP-CAR-MOV-CVN.                                                 
           MOVE 'PTT-CIC-ICVN' TO FIO-AKEY.                             
           PERFORM COL-FIO-PTT.                                         
           IF NOT ( FIO-STAT-OKS AND                                    
                    PTT-CAI-ICVN IN CMP-FLD = PTT-CAI-ICVN IN PTT AND   
                    PTT-IIC-ICVN IN CMP-FLD = PTT-IIC-ICVN IN PTT )     
               IF WSS-IND-ECVN IN WSS-VARI = 'N'                        
                    MOVE 'PTTCVN NEX' TO MSG-COD-MENS                   
                    GO TO FIN-CAR-MOV-CMP-CVN                           
               ELSE                                                     
                    GO TO FIN-CAR-MOV-CMP-CVN                           
           ELSE                                                         
               MOVE 'S' TO WSS-IND-ECVN IN WSS-VARI.                    
           IF PTT-COD-TIPO IN CMP-FLD > SPACES                          
              IF PTT-COD-TIPO IN CMP-FLD NOT = PTT-COD-TIPO IN PTT      
                 MOVE FIO-GET-NXT TO FIO-CMND                           
                 GO TO LUP-CAR-MOV-CVN.                                 
           IF PTT-IND-SEPA IN CMP-FLD > SPACES                          
              IF PTT-IND-SEPA IN CMP-FLD NOT = PTT-IND-SEPA IN PTT      
                 MOVE FIO-GET-NXT TO FIO-CMND                           
                 GO TO LUP-CAR-MOV-CVN.                                 
      *MHM-INI 28-NOV-2008
      *    MOVE PTT-CAI-IPTT IN PTT TO DTT-CAI-IDTT IN DTT.             
      *    MOVE PTT-IIC-IPTT IN PTT TO DTT-IIC-IDTT IN DTT.             
      *    MOVE ZEROES              TO DTT-NUM-IDTT IN DTT.             
      *    MOVE FIO-GET-NLS TO FIO-CMND.                                
      *LUP-CAR-MOV-CMP-CVN.                                             
      *    PERFORM COL-FIO-DTT.                                         
      *    IF NOT ( FIO-STAT-OKS  AND                                   
      *             PTT-CIC-IPTT IN PTT = DTT-CIC-IDTT IN DTT )         
      *              MOVE FIO-GET-NXT TO FIO-CMND                       
      *              GO TO LUP-CAR-MOV-CVN.                             
      *    IF WSS-IND-EXIS = 'N'                                        
      *    IF FRM-NUM-CPTT IN CMP-FLD > SPACES OR                       
      *       FRM-NUM-IPTT IN CMP-FLD > ZEROES                          
      *       IF NOT (FRM-NUM-CPTT IN CMP-FLD = PTT-CAI-IPTT IN PTT AND 
      *          FRM-NUM-IPTT IN CMP-FLD = PTT-IIC-IPTT IN PTT )        
      *          MOVE FIO-GET-NXT TO FIO-CMND                           
      *          GO TO LUP-CAR-MOV-CMP-CVN                              
      *       ELSE                                                      
      *          MOVE 'S' TO WSS-IND-EXIS.                              
           IF FRM-NUM-CPTT IN CMP-FLD > SPACES AND
              FRM-NUM-CPTT IN CMP-FLD NOT = PTT-CAI-IPTT IN PTT
                 MOVE FIO-GET-NXT TO FIO-CMND                           
                 GO TO LUP-CAR-MOV-CVN.                                 

           IF FRM-NUM-IPTT IN CMP-FLD > ZEROES AND
              FRM-NUM-IPTT IN CMP-FLD NOT = PTT-IIC-IPTT IN PTT
                 MOVE FIO-GET-NXT TO FIO-CMND                           
                 GO TO LUP-CAR-MOV-CVN.                                 
      *MHM-FIN 28-NOV-2008
           MOVE PTT-CAI-IPTT IN PTT TO CMP-CAI-IPTT(CMP-I).             
           MOVE PTT-IIC-IPTT IN PTT TO CMP-IIC-IPTT(CMP-I).             
           MOVE PTT-GLS-NOMP IN PTT TO CMP-GLS-NOMP(CMP-I).             
           MOVE PTT-COD-TIPO IN PTT TO CMP-COD-TIPO(CMP-I).             
           MOVE PTT-IND-SEPA IN PTT TO CMP-IND-SEPA(CMP-I).             
      *MHM-INI 28-NOV-2008
      *    IF DTT-NUM-CODI IN DTT > ZEROES                              
      *        MOVE 'COL' TO TAB-COD-SIST                               
      *        MOVE 'CDF' TO TAB-COD-TTAB IN TAB                        
      *        MOVE DTT-NUM-CODI IN DTT TO TAB-COD-CTAB IN TAB          
      *        PERFORM VAL-COD.                                         
      *MHM-FIN 28-NOV-2008
       NXT-ACT-DATOS-CVN.                                               
           PERFORM INC-REG-TS.                                          
           ADD 1 TO WSS-TOT.                                            
       SIG-CAR-MOV-CMP-CVN.                                             
           MOVE FIO-GET-NXT TO FIO-CMND.                                
           GO TO LUP-CAR-MOV-CVN.                                       
       FIN-CAR-MOV-CMP-CVN.                                             
           IF WSS-TOT = ZEROES AND MSG-COD-MENS NOT > SPACES            
              MOVE 'PLLDTT NEX' TO MSG-COD-MENS.                        
           IF SCR-OFRM-SRV                                              
              PERFORM PUT-CMP-MAS.                                      
           EXIT.                                                        

       PUT-CMP-MAS SECTION.                                             
       INI-PUT-CMP-MAS.                                                 
           MOVE 1                  TO QUE-NITM.                         
           MOVE CMP-LEN-TSCMP-MAS  TO QUE-LITM.                         
           MOVE CMP-NOM-TSCMP-MAS  TO QUE-COLA.                         
           IF WSS-TOT > CMP-IMAX-MTX                                    
              MOVE 'S'             TO CMP-MAS-IND-HMAS                  
           ELSE                                                         
              MOVE 'N'             TO CMP-MAS-IND-HMAS.                 
           MOVE WSS-TOT            TO CMP-MAS-NUM-TOCC.                 
           MOVE CMP-MAS-ITEM       TO QUE-ITEM.                         
           MOVE QUE-PUT            TO QUE-CMND.                         
           PERFORM GNS-PRO-QUE.                                         
       FIN-PUT-CMP-MAS.                                                 
           EXIT.                                                        
   
       OBT-PARAM SECTION.                                               
       INI-OBT-PARAM.                                                   
       FIN-OBT-PARAM.                                                   
           EXIT.                                                        
                                                                        
       OBT-DAT-TS SECTION.                                              
       INI-OBT-DAT-TS.                                                  
           EXEC CICS HANDLE CONDITION QIDERR(CON-OBT-DAT-TS)            
                                     ITEMERR(CON-OBT-DAT-TS)            
           END-EXEC.                                                    
                                                                        
           MOVE CMP-NOM-TSCMP     TO QUE-COLA.                          
           MOVE QUE-DEL           TO QUE-CMND.                          
           PERFORM GNS-PRO-QUE.                                         
       CON-OBT-DAT-TS.                                                  
           MOVE CMP-SI-IMP TO CMP-IMP.                                  
           PERFORM CLR-VEC-TS VARYING CMP-I FROM 1 BY 1 UNTIL           
                   CMP-I > CMP-IMAX.                                    
           MOVE 1 TO CMP-I.  
           PERFORM CAR-MOV-CMP-CVN.            
       NXT-OBT-DAT-TS.             
           IF CMP-IMP = CMP-SI-IMP                                      
               PERFORM WRT-TS.                                          
       FIN-OBT-DAT-TS.                                                  
           EXIT.                                                        
                                                                        
       PUT-TAB-CMP SECTION.                                             
       INI-PUT-TAB-CMP.                                                 
           PERFORM RED-TS.                                              
           PERFORM LLE-DAT-PNT VARYING CMP-I FROM 1 BY 1                
                   UNTIL CMP-I > CMP-IMAX.                              
       FIN-PUT-TAB-CMP.                                                 
           EXIT.      

       LLE-DAT-PNT SECTION.                                             
       INI-LLE-DAT-PNT.                                                 
           MOVE CMP-CAI-IPTT(CMP-I) TO FRM-CAI-IPTT IN CMP-FLD(CMP-I).
           MOVE CMP-IIC-IPTT(CMP-I) TO FRM-IIC-IPTT IN CMP-FLD(CMP-I).
           MOVE CMP-GLS-NOMP(CMP-I) TO FRM-GLS-NOMP IN CMP-FLD(CMP-I).
           MOVE CMP-COD-TIPO(CMP-I) TO FRM-COD-TIPO IN CMP-FLD(CMP-I).
           MOVE CMP-IND-SEPA(CMP-I) TO FRM-IND-SEPA IN CMP-FLD(CMP-I).
       FIN-LLE-DAT-PNT.                                                 
           EXIT.   

       WRT-TS SECTION.                                                  
       INI-WRT-TS.                                                      
           ADD 1 TO SCR-IMAX.                                           
           MOVE CMP-NOM-TSCMP     TO QUE-COLA.                             
           MOVE CMP-TS            TO QUE-ITEM.                             
           MOVE CMP-LEN-TSCMP     TO QUE-LITM.                             
           MOVE CMP-I             TO QUE-NITM.                             
           MOVE QUE-PUT           TO QUE-CMND.                             
           PERFORM GNS-PRO-QUE.                                         
       FIN-WRT-TS.                                                      
           EXIT.   

       RED-TS SECTION.                                                  
       INI-RED-TS.                                                      
           MOVE CMP-I TO SCR-I.                                         
           EXEC CICS HANDLE CONDITION QIDERR(FIN-RED-TS)                
                                     ITEMERR(FIN-RED-TS)                
           END-EXEC.                                                    
           MOVE CMP-NOM-TSCMP     TO QUE-COLA.                            
           MOVE CMP-TS            TO QUE-ITEM.                            
           MOVE CMP-LEN-TSCMP     TO QUE-LITM.                            
           MOVE CMP-I             TO QUE-NITM.                            
           MOVE QUE-GET           TO QUE-CMND.                            
           PERFORM GNS-PRO-QUE.                                         
           MOVE QUE-ITEM          TO CMP-TS.                               
       FIN-RED-TS.                                                      
           EXIT.  

       CLR-VEC-TS SECTION.                                              
       INI-CLR-VEC-TS.                                                
           MOVE SPACES   TO   CMP-CAI-IPTT(CMP-I).
           MOVE ZEROES   TO   CMP-IIC-IPTT(CMP-I).
           MOVE SPACES   TO   CMP-GLS-NOMP(CMP-I).
           MOVE SPACES   TO   CMP-COD-TIPO(CMP-I).
           MOVE SPACES   TO   CMP-IND-SEPA(CMP-I).
       FIN-CLR-VEC-TS.

       INC-REG-TS SECTION.                                              
       INI-INC-REG-TS.                                                  
           MOVE CMP-SI-IMP TO CMP-IMP.                                  
           ADD 1 TO CMP-I.                                              
           IF CMP-I > CMP-IMAX                                          
               PERFORM WRT-TS                                           
               PERFORM CLR-VEC-TS VARYING CMP-I FROM 1 BY 1             
                                     UNTIL CMP-I > CMP-IMAX             
               MOVE 1 TO CMP-I                                          
               MOVE CMP-NO-IMP TO CMP-IMP.                              
       FIN-INC-REG-TS.                                                  
           EXIT.                                                        
                         
       RST-STAT SECTION.                                                
       INI-RST-STAT.                                                    
           MOVE SCR-STPP     TO SCR-STAT.                               
           MOVE SCR-MFLD-NOT TO SCR-MFLD.                               
       FIN-RST-STAT.                                                    
           EXIT.                                                        
      *>>>>
*% END                                                     
