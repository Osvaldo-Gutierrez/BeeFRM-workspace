*%! Codigo adicional para archivo
*% IF CMT_ID
      *<<<< CMT_ID
      *>>>>
*% END
*% IF IOS
      *<<<< IOS
      *>>>>
*% END
*% IF RR
      *<<<< RR
      *>>>>
*% END
*% IF FD_RPT
      *<<<< FD_RPT
      *>>>>
*% END
*% IF FLS
      *<<<< FLS
      *>>>>
*% END
*% IF RW
      *<<<< RW
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCP-REQA==.
       COPY COLBRRDC.
       COPY COLBRDLC.
       COPY SGCBRDBC.
       COPY SGCBRDCP.
       COPY GNSWGFEC.
       COPY GNSWGCPT.
       COPY GNSWGHOY.
       COPY COLBRSEG.
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       01  WSS-VARI.
           03  WSS-GLS-MES1           PIC X(03).
           03  WSS-NUM-MES1  REDEFINES WSS-GLS-MES1 PIC 9(03).
           03  WSS-GLS-MES2           PIC X(03).
           03  WSS-NUM-MES2  REDEFINES WSS-GLS-MES2 PIC 9(03).
           03  WSS-FEC-FPRO.
               05  WSS-NUM-DPRO       PIC 9(02).
               05  WSS-NUM-MPRO       PIC 9(02).
               05  WSS-NUM-SPRO       PIC 9(02).
               05  WSS-NUM-APRO       PIC 9(02).
           03  WSS-FEC-FAUX.
               05  WSS-NUM-SAUX       PIC 9(02).
               05  WSS-NUM-AAUX       PIC 9(02).
               05  WSS-NUM-MAUX       PIC 9(02).
               05  WSS-NUM-DAUX       PIC 9(02).
           03  WSS-FEC-FEC2.
               05  WSS-NUM-SEC2       PIC 9(02).
               05  WSS-NUM-AEC2       PIC 9(02).
               05  WSS-NUM-MEC2       PIC 9(02).
               05  WSS-NUM-DEC2       PIC 9(02).
           03  WSS-VEC-TRMO.
               05  WSS-GLS-TRMO  OCCURS 10  PIC X(03).
           03  WSS-VEC-TRM02 REDEFINES WSS-VEC-TRMO.
               05  WSS-NUM-TRMO  OCCURS 10  PIC 9(03).
           03  WSS-CNTD          VALUE 0    PIC 9(02).
           03  WSS-CMAX          VALUE 0    PIC 9(02).
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
      *>>>>
*% END
*% IF RF
      *<<<< RF
      *>>>>
*% END
*% IF RT
      *<<<< RT
      *>>>>
*% END
*% IF PH_SEG
      *<<<< PH_SEG
      *>>>>
*% END
*% IF CF_SEG_WSS_VAL_TRMO
      *<<<< CF_SEG_WSS_VAL_TRMO
      *>>>>
*% END
*% IF FIN_DEC
      *<<<< FIN_DEC
      *>>>>
*% END
*% IF INI
      *<<<< INI
      *>>>>
*% END
*% IF RS
      *<<<< RS
      *>>>>
*% END
*% IF FIN
      *<<<< FIN
      *>>>>
*% END
*% IF INI_INP
      *<<<< INI_INP
      * Abrir archivo SEG de salida
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM COL-FIO-SEG.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR EN APERTURA DE ARCHIVO COLSEG'
               GO TO FIN-INP-SRT.

      * Limpiar vector de tramos
           PERFORM LIMPIA-VECTOR.
      * Guardar tramos del Seguro en vector para posterior uso
           MOVE 'COL' TO TAB-COD-SIST FIO-SIST.
           MOVE 'SDV' TO TAB-COD-TTAB IN TAB.
           MOVE SPACES TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND
                   TAB-COD-TTAB IN TAB = 'SDV')
               DISPLAY 'ERROR EN LECTURA DE TRAMOS DE TABLA SDV'
               GO TO FIN-INP-SRT.

       LUP-TRMO.
           IF TAB-IND-VIGE IN TAB NOT = 'S' OR
              TAB-COD-CTAB IN TAB = SPACES
               GO TO SIG-TRMO.
           ADD 1                    TO WSS-CNTD IN WSS-VARI.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-GLS-TRMO(WSS-CNTD).
       SIG-TRMO.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND
              TAB-COD-TTAB IN TAB = 'SDV'
               GO TO LUP-TRMO.

       NXT-TRMO.
      * Captura fecha de Proceso
           ACCEPT WSS-FEC-FPRO IN WSS-VARI.
           DISPLAY 'FECHA DE PROCESO: ' WSS-FEC-FPRO IN WSS-VARI.
      * Validacion de parametro
      *VAL-FEC Valida fecha proceso
           MOVE WSS-FEC-FPRO IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC             TO FEC-FORM.
           MOVE FEC-FBLK-N               TO FEC-FBLK.
           MOVE FEC-CHOY-N               TO FEC-CHOY.
           MOVE FEC-VHBL-N               TO FEC-VHBL.
           MOVE FEC-VAL-FEC              TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO '
              DISPLAY ' ERROR EN VALIDACION F. DE PROCESO : '
                        WSS-FEC-FPRO IN WSS-VARI '  ' FEC-MENS
              GO TO FIN-INP-SRT.


           MOVE WSS-NUM-DPRO IN WSS-VARI TO FEC-ITM1.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO FEC-ITM2.
           MOVE WSS-NUM-SPRO IN WSS-VARI TO FEC-ITM3.
           MOVE WSS-NUM-APRO IN WSS-VARI TO FEC-ITM4.
           MOVE 01                       TO FEC-NMES.
           MOVE FEC-RST-MES              TO FEC-CMND.
           MOVE FEC-FORM-FEC             TO FEC-FORM.
           PERFORM CAL-FEC.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR AL RESTAR 1 A FECHA PROCESO'
               GO TO FIN-INP-SRT.

           MOVE 01                       TO WSS-NUM-DAUX IN WSS-VARI.
           MOVE FEC-ITM2                 TO WSS-NUM-MAUX IN WSS-VARI.
           MOVE FEC-ITM3                 TO WSS-NUM-SAUX IN WSS-VARI.
           MOVE FEC-ITM4                 TO WSS-NUM-AAUX IN WSS-VARI.
      *>>>>
*% END
*% IF INI_FST_INP
      *<<<< INI_FST_INP
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR EN APERTURA DE OPC'.
           MOVE WSS-FEC-FAUX IN WSS-VARI TO OPC-FEC-FINP IN OPC.
           MOVE 'OPC-FEC-FINP' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           GO TO LUP-INP-SRT.
      *>>>>
*% END
*% IF FIN_FST_INP
      *<<<< FIN_FST_INP
      *>>>>
*% END
*% IF LUP_INP
      *<<<< LUP_INP
           IF OPC-NUM-MINP IN OPC = WSS-NUM-MAUX IN WSS-VARI AND
              OPC-NUM-SINP IN OPC = WSS-NUM-SAUX IN WSS-VARI AND
              OPC-NUM-AINP IN OPC = WSS-NUM-AAUX IN WSS-VARI AND
              OPC-COD-SEGD IN OPC = 'SEGDES' AND
              OPC-VAL-SEGD IN OPC > ZEROES AND
              OPC-MSC-STAT IN OPC = 'A'
               MOVE OPC-CIC-IOPC IN OPC TO OPC-CIC-IOPC IN SRT
               MOVE OPC-VAL-CRED IN OPC TO OPC-VAL-CRED IN SRT
               MOVE OPC-VAL-SEGD IN OPC TO WSS-SGV-SEGD IN SRT

      * Llena archivo SEG con CIC operacion, valor credito,
      * monto prima cancelada
               MOVE OPC-CIC-IOPC IN SRT TO SEG-CIC-IOPC IN SEG
               MOVE OPC-VAL-CRED IN SRT TO SEG-VAL-CRED IN SEG
               MOVE WSS-SGV-SEGD IN SRT TO SEG-VAL-SEGD IN SEG

      * Obtiene glosa de moneda para archivo SEG
               PERFORM OBT-GLS-MONE

               PERFORM BUSCA-RUT-NOMBRE-FECHA

      * Determina tramo de dif. de meses
               PERFORM CALCULA-TRAMO
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-SEG

               RELEASE SRT.

           GO TO NXT-INP-SRT.
      *>>>>
*% END
*% IF RM
      *<<<< RM
      *>>>>
*% END
*% IF INI_NXT_INP
      *<<<< INI_NXT_INP
           MOVE 'OPC-FEC-FINP' TO FIO-AKEY.
      *>>>>
*% END
*% IF FIN_NXT_INP
      *<<<< FIN_NXT_INP
      *>>>>
*% END
*% IF FIN_INP
      *<<<< FIN_INP
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-SEG.
      *>>>>
*% END
*% IF INI_OUT
      *<<<< INI_OUT
      *>>>>
*% END
*% IF FST_OUT
      *<<<< FST_OUT
      *>>>>
*% END
*% IF LUP_OUT
      *<<<< LUP_OUT
      *>>>>
*% END
*% IF FIN_GEN_OUT
      *<<<< FIN_GEN_OUT
      *>>>>
*% END
*% IF FIN_OUT
      *<<<< FIN_OUT
      *>>>>
*% END
*% IF FIN_TMT
      *<<<< FIN_TMT
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       COPY GNSBGHOY.
       COPY GNSBBTAB.
       COPY GNSBBMSG.
       COPY GNSBGCPT.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY COLBFRDC.
       COPY COLBFDLC.
       COPY SGCBFDBC.
       COPY SGCBFDCP.
       COPY COLBFSEG.


       OBT-GLS-MONE SECTION.
       INI-OBT-GLS-MONE.
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'VLR'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS NOT = SPACES
              MOVE MSG-GLS-DCOR TO WSS-GLS-MONE IN SRT
                                   SEG-GLS-MONE IN SEG
           ELSE
              MOVE TAB-GLS-ABRV TO WSS-GLS-MONE IN SRT
                                   SEG-GLS-MONE IN SEG.
       FIN-OBT-GLS-MONE.
           EXIT.


       LIMPIA-VECTOR SECTION.
       INI-LIMPIA-VECTOR.
           MOVE 1 TO WSS-CNTD IN WSS-VARI.
       LUP-NXT.
           IF WSS-CNTD IN WSS-VARI NOT > 10
               MOVE ZEROES TO WSS-NUM-TRMO(WSS-CNTD)
               ADD 1 TO WSS-CNTD IN WSS-VARI
               GO TO LUP-NXT.
           MOVE ZEROES TO WSS-CNTD IN WSS-VARI.
       FIN-LIMPIA-VECTOR.
           EXIT.


       BUSCA-RUT-NOMBRE-FECHA SECTION.
       INI-BUSCA-RUT-NOMBRE-FECHA.

           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM COL-FIO-RDC.

           IF NOT ( FIO-STAT-OKS AND
                    RDC-CIC-IOPC IN RDC = OPC-CIC-IOPC IN OPC AND
                    RDC-NUM-IDLC IN RDC = ZEROES )
               GO TO FIN-BUSCA-RUT-NOMBRE-FECHA.

           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.

           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR EN LECTURA DE DBC'
               GO TO FIN-BUSCA-RUT-NOMBRE-FECHA.

           MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN SRT.
           MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN SRT.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO DBC-GLS-NOMC IN SRT.
      * Llena rut y nombre de cliente para archivo
      *MFG INI 06-10-95
           MOVE ZEROES              TO SEG-FIL-ICLI IN SEG.
      *MFG FIN 06-10-95
           MOVE DBC-NUM-ICLI IN SRT TO SEG-NUM-ICLI IN SEG.
           MOVE DBC-VRF-ICLI IN SRT TO SEG-VRF-ICLI IN SEG.
           MOVE DBC-GLS-NOMC IN SRT TO SEG-GLS-NOMC IN SEG.

           PERFORM CALCULA-FECHA-NAC.
           PERFORM CALCULA-FECHA-CREDITO.

           IF WSS-NUM-MES1 IN WSS-VARI = ZEROES
               MOVE WSS-NUM-MES2 IN WSS-VARI TO WSS-NUM-PLCO IN SRT

      * Llena fecha de termino de cobertura en archivo SEG
               MOVE DLC-NUM-DMAV IN DLC TO SEG-NUM-DTER IN SEG
               MOVE DLC-NUM-MMAV IN DLC TO SEG-NUM-MTER IN SEG
               MOVE DLC-NUM-SMAV IN DLC TO SEG-NUM-STER IN SEG
               MOVE DLC-NUM-AMAV IN DLC TO SEG-NUM-ATER IN SEG
           ELSE
           IF WSS-NUM-MES2 IN WSS-VARI = ZEROES
               MOVE WSS-NUM-MES1 IN WSS-VARI TO WSS-NUM-PLCO IN SRT

      * Llena fecha de termino de cobertura en archivo SEG
               MOVE WSS-NUM-DEC2 IN WSS-VARI TO SEG-NUM-DTER IN SEG
               MOVE WSS-NUM-MEC2 IN WSS-VARI TO SEG-NUM-MTER IN SEG
               MOVE WSS-NUM-SEC2 IN WSS-VARI TO SEG-NUM-STER IN SEG
               MOVE WSS-NUM-AEC2 IN WSS-VARI TO SEG-NUM-ATER IN SEG

           ELSE
           IF WSS-NUM-MES1 IN WSS-VARI < WSS-NUM-MES2 IN WSS-VARI
               MOVE WSS-NUM-MES1 IN WSS-VARI TO WSS-NUM-PLCO IN SRT

      * Llena fecha de termino de cobertura en archivo SEG
               MOVE WSS-NUM-DEC2 IN WSS-VARI TO SEG-NUM-DTER IN SEG
               MOVE WSS-NUM-MEC2 IN WSS-VARI TO SEG-NUM-MTER IN SEG
               MOVE WSS-NUM-SEC2 IN WSS-VARI TO SEG-NUM-STER IN SEG
               MOVE WSS-NUM-AEC2 IN WSS-VARI TO SEG-NUM-ATER IN SEG

           ELSE
               MOVE WSS-NUM-MES2 IN WSS-VARI TO WSS-NUM-PLCO IN SRT

      * Llena fecha de termino de cobertura en archivo SEG
               MOVE DLC-NUM-DMAV IN DLC TO SEG-NUM-DTER IN SEG
               MOVE DLC-NUM-MMAV IN DLC TO SEG-NUM-MTER IN SEG
               MOVE DLC-NUM-SMAV IN DLC TO SEG-NUM-STER IN SEG
               MOVE DLC-NUM-AMAV IN DLC TO SEG-NUM-ATER IN SEG.

       FIN-BUSCA-RUT-NOMBRE-FECHA.
           EXIT.


       CALCULA-FECHA-NAC SECTION.
       INI-CALCULA-FECHA-NAC.
           MOVE DBC-CIC-ICLI IN DBC TO DCP-CIC-ICLI IN DCP.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DCP.

           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR EN LECTURA DE DCP'
               GO TO FIN-BUSCA-RUT-NOMBRE-FECHA.

           IF DCP-FEC-FNAC IN DCP > ZEROES
               MOVE DCP-NUM-DNAC IN DCP TO FEC-ITM1
               MOVE DCP-NUM-MNAC IN DCP TO FEC-ITM2
               MOVE DCP-NUM-SNAC IN DCP TO FEC-ITM3
               MOVE DCP-NUM-ANAC IN DCP TO FEC-ITM4
               MOVE FEC-SUM-ANO  TO FEC-CMND
               MOVE 75           TO FEC-NANO
               PERFORM CAL-FEC

               IF FEC-STAT-OKS
                   MOVE FEC-ITM1 TO WSS-NUM-DEC2 IN WSS-VARI
                   MOVE FEC-ITM2 TO WSS-NUM-MEC2 IN WSS-VARI
                   MOVE FEC-ITM3 TO WSS-NUM-SEC2 IN WSS-VARI
                   MOVE FEC-ITM4 TO WSS-NUM-AEC2 IN WSS-VARI

                   IF WSS-FEC-FEC2 IN WSS-VARI >
                     OPC-FEC-FCOL IN OPC
                       MOVE OPC-NUM-DCOL IN OPC      TO FEC-DEC1
                       MOVE OPC-NUM-MCOL IN OPC      TO FEC-MEC1
                       MOVE OPC-NUM-SCOL IN OPC      TO FEC-SEC1
                       MOVE OPC-NUM-ACOL IN OPC      TO FEC-AEC1

                       MOVE WSS-NUM-DEC2 IN WSS-VARI TO FEC-DEC2
                       MOVE WSS-NUM-MEC2 IN WSS-VARI TO FEC-MEC2
                       MOVE WSS-NUM-SEC2 IN WSS-VARI TO FEC-SEC2
                       MOVE WSS-NUM-AEC2 IN WSS-VARI TO FEC-AEC2

                       MOVE FEC-FORM-FEC             TO FEC-FORM
                       MOVE FEC-DIF-MES              TO FEC-CMND
                       PERFORM CAL-FEC
                       IF FEC-NDIA > 0
                           ADD 1 TO FEC-NMES
                           MOVE FEC-NMES TO WSS-NUM-MES1 IN WSS-VARI
                       ELSE
                           MOVE FEC-NMES TO WSS-NUM-MES1 IN WSS-VARI.

      * Llena fecha de nacimiento en archivo SEG
           MOVE DCP-NUM-DNAC IN DCP TO SEG-NUM-DNAC IN SEG.
           MOVE DCP-NUM-MNAC IN DCP TO SEG-NUM-MNAC IN SEG.
           MOVE DCP-NUM-SNAC IN DCP TO SEG-NUM-SNAC IN SEG.
           MOVE DCP-NUM-ANAC IN DCP TO SEG-NUM-ANAC IN SEG.

       FIN-CALCULA-FECHA-NAC.
           EXIT.


       CALCULA-FECHA-CREDITO SECTION.
       INI-CALCULA-FECHA-CREDITO.
      *Calculo de meses del credito
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE ZEROES TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT (FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = DLC-CIC-IOPC IN DLC)
               GO TO FIN-CALCULA-FECHA-CREDITO.

      * Llena fecha de curse real en archivo SEG
           MOVE OPC-NUM-DCOL IN OPC TO SEG-NUM-DCOL IN SEG.
           MOVE OPC-NUM-MCOL IN OPC TO SEG-NUM-MCOL IN SEG.
           MOVE OPC-NUM-SCOL IN OPC TO SEG-NUM-SCOL IN SEG.
           MOVE OPC-NUM-ACOL IN OPC TO SEG-NUM-ACOL IN SEG.

           MOVE OPC-NUM-DCOL IN OPC      TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC      TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC      TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC      TO FEC-AEC1.

           MOVE DLC-NUM-DMAV IN DLC TO FEC-DEC2.
           MOVE DLC-NUM-MMAV IN DLC TO FEC-MEC2.
           MOVE DLC-NUM-SMAV IN DLC TO FEC-SEC2.
           MOVE DLC-NUM-AMAV IN DLC TO FEC-AEC2.

           MOVE FEC-FORM-FEC             TO FEC-FORM.
           MOVE FEC-DIF-MES              TO FEC-CMND.
           PERFORM CAL-FEC.
           IF FEC-NDIA > 0
               ADD 1 TO FEC-NMES.
           MOVE FEC-NMES TO WSS-NUM-MES2 IN WSS-VARI.
       FIN-CALCULA-FECHA-CREDITO.
           EXIT.


       CALCULA-TRAMO SECTION.
       INI-CALCULA-TRAMO.
           MOVE 1 TO WSS-CNTD IN WSS-VARI.
       LUP-CALC-TRMO.
           IF WSS-CNTD IN WSS-VARI NOT > 10 AND
             WSS-NUM-PLCO IN SRT NOT > WSS-NUM-TRMO(WSS-CNTD)
               MOVE WSS-NUM-TRMO(WSS-CNTD) TO WSS-VAL-TRMO IN SRT
           ELSE
           IF WSS-CNTD IN WSS-VARI NOT > 10
               ADD 1 TO WSS-CNTD IN WSS-VARI
               GO TO LUP-CALC-TRMO.

           IF WSS-CNTD IN WSS-VARI > 10
               DISPLAY 'NO EXISTE TRAMO QUE CONTENGA A DIF. '
                       'DE MESES ' WSS-NUM-PLCO IN SRT.

      * Llena tramo de cobertura en archivo SEG
           MOVE WSS-VAL-TRMO IN SRT TO SEG-NUM-TRMO IN SEG.
       FIN-CALCULA-TRAMO.
           EXIT.

      *>>>>
*% END
