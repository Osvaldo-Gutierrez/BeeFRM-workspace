       BUS-UVD SECTION.
       INI-BUS-UVD.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE ZEROES TO UVD-SIND IN UVD.
           MOVE ZEROES TO DLC-TAB-IVEN IN UVD.
           MOVE ZEROES TO UVD-FEC-FVEN IN UVD.
           MOVE UVD-CAI-IOPC IN UVD TO OPC-CAI-IOPC IN OPC.
           MOVE UVD-IIC-IOPC IN UVD TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE 'UVD    NOOPC' TO MSG-COD-MENS
               GO TO FIN-BUS-UVD.
           PERFORM GET-DLC.
           IF NOT FIO-STAT-OKS
               MOVE 'UVD    NODLC' TO MSG-COD-MENS
               GO TO FIN-BUS-UVD.
           IF DLC-NUM-IDLC IN DLC > 100
               MOVE 'NUMIDLCIMAX>' TO MSG-COD-MENS
               GO TO FIN-BUS-UVD.
           MOVE DLC-NUM-IDLC IN DLC TO UVD-IMAX IN UVD.
           IF OPC-IND-VSTR IN OPC NOT = 'S'
               PERFORM BUS-VEN-FEVD
           ELSE
               PERFORM BUS-EVC-FEVD.
       FIN-BUS-UVD.
           EXIT.

       BUS-VEN-FEVD SECTION.
       INI-BUS-VEN-FEVD.
           PERFORM GET-VEN.
           IF NOT FIO-STAT-OKS
               MOVE 'UVD    NOVEN' TO MSG-COD-MENS
               GO TO FIN-BUS-VEN-FEVD.
           MOVE VEN-NUM-IVEN IN VEN TO UVD-JMAX IN UVD.
           IF UVD-IMAX IN UVD = 1 AND UVD-JMAX IN UVD NOT < 1
               MOVE VEN-FEC-FVEN IN VEN TO DLC-FEC-FVEN IN UVD(1)
               GO TO FIN-BUS-VEN-FEVD.
           IF UVD-IMAX IN UVD > 1 AND UVD-JMAX IN UVD = 1
               PERFORM MOV-VEN-FEVD VARYING UVD-I FROM 1 BY 1 UNTIL
                       UVD-I IN UVD > UVD-IMAX
               GO TO FIN-BUS-VEN-FEVD.
           IF VEN-NUM-IDLC IN VEN = ZEROES
               MOVE VEN-NUM-IVCT IN VEN TO VEN-NUM-IDLC IN VEN.
       NXT-BUS-VEN-FEVD.
           MOVE VEN-FEC-FVEN IN VEN TO DLC-FEC-FVEN IN
                               UVD(VEN-NUM-IDLC IN VEN).
           ADD 1 TO UVD-K IN UVD.
           IF UVD-K IN UVD = UVD-IMAX IN UVD
               GO TO FIN-BUS-VEN-FEVD.
       LUP-BUS-VEN-FEVD.
           MOVE FIO-GET-PRV TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT ( FIO-STAT-OKS AND
                    UVD-CAI-IOPC IN UVD = VEN-CAI-IOPC IN VEN AND
                    UVD-IIC-IOPC IN UVD = VEN-IIC-IOPC IN VEN )
               GO TO FIN-BUS-VEN-FEVD.
           IF VEN-NUM-IDLC IN VEN = ZEROES
               MOVE VEN-NUM-IVCT IN VEN TO VEN-NUM-IDLC IN VEN.
           IF DLC-FEC-FVEN IN UVD(VEN-NUM-IDLC) > ZEROES
               GO TO LUP-BUS-VEN-FEVD
           ELSE
               GO TO NXT-BUS-VEN-FEVD.
       FIN-BUS-VEN-FEVD.
           EXIT.

       BUS-EVC-FEVD SECTION.
       INI-BUS-EVC-FEVD.
           MOVE OPC-COD-TOOC IN OPC TO TOC-COD-TOCR IN TOC.
           PERFORM COL-FIO-TOC.
           IF NOT FIO-STAT-OKS
               MOVE 'CODTOC NEX' TO MSG-COD-MENS
               GO TO FIN-BUS-EVC-FEVD.
           MOVE 'COL'               TO MSC-COD-SIST FIO-SIST.
           MOVE 'OPEC'              TO MSC-COD-TMSC IN MSC.
           MOVE TOC-MSC-OPEC IN TOC TO MSC-COD-CMSC IN MSC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
               MOVE 'INDOPECNEX' TO MSG-COD-MENS
               GO TO FIN-BUS-EVC-FEVD.
           IF MSC-CIC-CMSC IN MSC = 'D'
               PERFORM GET-ULT-EVC
               IF NOT FIO-STAT-OKS
                   MOVE 'UVD    NOEVC' TO MSG-COD-MENS
                   GO TO FIN-BUS-EVC-FEVD
               ELSE
                   MOVE EVC-NUM-IEVC IN EVC TO UVD-LMAX IN UVD
                   MOVE ZEROES TO UVD-IMAX IN UVD
                   PERFORM BUS-DLC-ZERO
                   IF NOT FIO-STAT-OKS
                       GO TO FIN-BUS-EVC-FEVD
                   ELSE
                       IF UVD-IMAX IN UVD NOT > ZEROES
                           MOVE DLC-NUM-IDLC IN DLC TO UVD-IMAX IN UVD.
           PERFORM GET-EVC.
           IF NOT FIO-STAT-OKS
               MOVE 'UVD    NOEVC' TO MSG-COD-MENS
               GO TO FIN-BUS-EVC-FEVD.
       LUP-BUS-EVC-FEVD.
           IF EVC-NUM-IDLC IN EVC = ZEROES
               GO TO NXT-BUS-EVC-FEVD.
           IF EVC-NUM-IDLC IN EVC > UVD-IMAX AND UVD-L > ZEROES
               ADD 1 TO UVD-IMAX IN UVD
               IF UVD-IMAX IN UVD > 100
                   MOVE 'NUMIDLCIMAX>' TO MSG-COD-MENS
                   GO TO FIN-BUS-EVC-FEVD.
           IF EVC-NUM-VIGU IN EVC = 1
               MOVE EVC-NUM-DPVC IN EVC TO UVD-NUM-DVEN IN UVD
               MOVE EVC-NUM-MPVC IN EVC TO UVD-NUM-MVEN IN UVD
               MOVE EVC-NUM-SPVC IN EVC TO UVD-NUM-SVEN IN UVD
               MOVE EVC-NUM-APVC IN EVC TO UVD-NUM-AVEN IN UVD
           ELSE
               MOVE EVC-IND-UTSV IN EVC TO MSC-COD-CMSC IN MSC
               SUBTRACT 1 FROM EVC-NUM-VIGU IN EVC
               MULTIPLY EVC-NUM-VIGU IN EVC BY EVC-NUM-SEVE IN
                                 EVC GIVING UVD-NUM-SEVE IN UVD
               PERFORM SUM-FEC-NFEC
               MOVE FEC-FECH TO UVD-FEC-FVEN.
           PERFORM CMP-FEC-NFEC.
       NXT-BUS-EVC-FEVD.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-EVC.
           IF FIO-STAT-OKS AND
              UVD-CAI-IOPC IN UVD = EVC-CAI-IOPC IN EVC AND
              UVD-IIC-IOPC IN UVD = EVC-IIC-IOPC IN EVC
               GO TO LUP-BUS-EVC-FEVD.
       FIN-BUS-EVC-FEVD.
           EXIT.

       SUM-FEC-NFEC SECTION.
       INI-SUM-FEC-NFEC.
           MOVE 'TAB' TO MSC-COD-SIST.
           MOVE 'IPER' TO MSC-COD-TMSC IN MSC.
           PERFORM BUS-MSC.
           MOVE FEC-FORM-FEC    TO FEC-FORM.
           PERFORM SUM-FEC-FVEN.
      *    PERFORM PRO-FEC.
           PERFORM CAL-FEC.
       FIN-SUM-FEC-NFEC.
           EXIT.

       SUM-FEC-FVEN SECTION.
       INI-SUM-FEC-FVEN.
           MOVE EVC-NUM-DPVC IN EVC TO FEC-ITM1.
           MOVE EVC-NUM-MPVC IN EVC TO FEC-ITM2.
           MOVE EVC-NUM-SPVC IN EVC TO FEC-ITM3.
           MOVE EVC-NUM-APVC IN EVC TO FEC-ITM4.
           IF MSC-CIC-CMSC = 'D'
               MOVE FEC-SUM-DIA              TO FEC-CMND
               MOVE UVD-NUM-SEVE IN UVD TO FEC-NDIA
           ELSE
               IF MSC-CIC-CMSC = 'M'
                   MOVE FEC-SUM-MES              TO FEC-CMND
                   MOVE UVD-NUM-SEVE IN UVD TO FEC-NMES
               ELSE
                   IF MSC-CIC-CMSC = 'A'
                       MOVE FEC-SUM-ANO             TO FEC-CMND
                       MOVE UVD-NUM-SEVE IN UVD TO FEC-NANO.
       FIN-SUM-FEC-FVEN.
           EXIT.

       CMP-FEC-NFEC SECTION.
       INI-CMP-FEC-NFEC.
           MOVE UVD-FEC-FVEN IN UVD TO FEC-FEC1.
           MOVE DLC-NUM-DVEN IN UVD(EVC-NUM-IDLC IN EVC) TO FEC-DEC2.
           MOVE DLC-NUM-MVEN IN UVD(EVC-NUM-IDLC IN EVC) TO FEC-MEC2.
           MOVE DLC-NUM-SVEN IN UVD(EVC-NUM-IDLC IN EVC) TO FEC-SEC2.
           MOVE DLC-NUM-AVEN IN UVD(EVC-NUM-IDLC IN EVC) TO FEC-AEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-LES
               GO TO FIN-CMP-FEC-NFEC.
           MOVE UVD-NUM-DVEN IN UVD TO DLC-NUM-DVEN IN
                                      UVD(EVC-NUM-IDLC IN EVC).
           MOVE UVD-NUM-MVEN IN UVD TO DLC-NUM-MVEN IN
                                      UVD(EVC-NUM-IDLC IN EVC).
           MOVE UVD-NUM-SVEN IN UVD TO DLC-NUM-SVEN IN
                                      UVD(EVC-NUM-IDLC IN EVC).
           MOVE UVD-NUM-AVEN IN UVD TO DLC-NUM-AVEN IN
                                      UVD(EVC-NUM-IDLC IN EVC).
       FIN-CMP-FEC-NFEC.
           EXIT.

       MOV-VEN-FEVD SECTION.
       INI-MOV-VEN-FEVD.
           MOVE VEN-FEC-FVEN IN VEN TO DLC-FEC-FVEN IN UVD(UVD-I).
       FIN-MOV-VEN-FEVD.
           EXIT.

       BUS-DLC-ZERO SECTION.
       INI-BUS-DLC-ZERO.
           PERFORM GET-EVC.
           IF NOT FIO-STAT-OKS
               MOVE 'UVD    NOEVC' TO MSG-COD-MENS
               GO TO FIN-BUS-DLC-ZERO.
       LUP-BUS-DLC-ZERO.
           IF EVC-NUM-IDLC IN EVC = ZEROES
               ADD 1 TO UVD-L
               PERFORM DLC-NUM-ZERO
               IF NOT FIO-STAT-OKS
                   GO TO FIN-BUS-DLC-ZERO.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-EVC.
           IF FIO-STAT-OKS AND
              UVD-CAI-IOPC IN UVD = EVC-CAI-IOPC IN EVC AND
              UVD-IIC-IOPC IN UVD = EVC-IIC-IOPC IN EVC
               GO TO LUP-BUS-DLC-ZERO.
           MOVE '00' TO FIO-STAT.
           IF UVD-L IN UVD > 1
               PERFORM SRT-DLC-FVEN.
           IF UVD-L IN UVD = UVD-LMAX IN UVD AND
              UVD-L IN UVD > ZEROES
               MOVE '23' TO FIO-STAT.
       FIN-BUS-DLC-ZERO.
           EXIT.

       DLC-NUM-ZERO SECTION.
       INI-DLC-NUM-ZERO.
           ADD 1 TO UVD-IMAX IN UVD.
           IF UVD-IMAX IN UVD > 100
               MOVE 'NUMIDLCIMAX>' TO MSG-COD-MENS
               MOVE '23' TO FIO-STAT
               GO TO FIN-DLC-NUM-ZERO.
           MOVE 1 TO EVC-NUM-IDLC IN EVC.
           MOVE EVC-NUM-DPVC IN EVC TO DLC-NUM-DVEN IN UVD(UVD-IMAX).
           MOVE EVC-NUM-MPVC IN EVC TO DLC-NUM-MVEN IN UVD(UVD-IMAX).
           MOVE EVC-NUM-SPVC IN EVC TO DLC-NUM-SVEN IN UVD(UVD-IMAX).
           MOVE EVC-NUM-APVC IN EVC TO DLC-NUM-AVEN IN UVD(UVD-IMAX).
       LUP-DLC-NUM-ZERO.
           IF EVC-NUM-VIGU IN EVC = EVC-NUM-IDLC IN EVC
               GO TO FIN-DLC-NUM-ZERO.
           ADD 1 TO UVD-IMAX IN UVD.
           MOVE EVC-IND-UTSV IN EVC TO MSC-COD-CMSC IN MSC.
           MULTIPLY EVC-NUM-IDLC IN EVC  BY EVC-NUM-SEVE IN EVC GIVING
                    UVD-NUM-SEVE IN UVD.
           PERFORM SUM-FEC-NFEC.
           MOVE FEC-FECH TO UVD-FEC-FVEN.
           MOVE UVD-NUM-DVEN IN UVD TO DLC-NUM-DVEN IN UVD(UVD-IMAX).
           MOVE UVD-NUM-MVEN IN UVD TO DLC-NUM-MVEN IN UVD(UVD-IMAX).
           MOVE UVD-NUM-SVEN IN UVD TO DLC-NUM-SVEN IN UVD(UVD-IMAX).
           MOVE UVD-NUM-AVEN IN UVD TO DLC-NUM-AVEN IN UVD(UVD-IMAX).
           ADD 1 TO EVC-NUM-IDLC IN EVC.
           GO TO LUP-DLC-NUM-ZERO.
       FIN-DLC-NUM-ZERO.
           EXIT.

       SRT-DLC-FVEN SECTION.
       INI-SRT-DLC-FVEN.
           SUBTRACT 1 FROM UVD-IMAX GIVING UVD-SMAX.
           PERFORM INC-DLC-FVEN VARYING UVD-S FROM 1 BY 1
               UNTIL UVD-S > UVD-SMAX.
       FIN-SRT-DLC-FVEN.
           EXIT.

       INC-DLC-FVEN SECTION.
       INI-INC-DLC-FVEN.
           ADD 1 UVD-S GIVING UVD-SMIN.
           PERFORM SWT-DLC-FVEN VARYING UVD-SAUX FROM UVD-SMIN BY 1
               UNTIL UVD-SAUX > UVD-IMAX.
       FIN-INC-DLC-FVEN.
           EXIT.

       SWT-DLC-FVEN SECTION.
       INI-SWT-DLC-FVEN.
           IF DLC-FEC-FVEN IN UVD(UVD-S) > DLC-FEC-FVEN IN UVD(UVD-SAUX)
               MOVE DLC-FEC-FVEN IN UVD(UVD-S)    TO UVD-AUXI
               MOVE DLC-FEC-FVEN IN UVD(UVD-SAUX) TO DLC-FEC-FVEN IN
                                                           UVD(UVD-S)
               MOVE UVD-AUXI   TO DLC-FEC-FVEN IN UVD(UVD-SAUX).
       FIN-SWT-DLC-FVEN.
           EXIT.

       GET-DLC SECTION.
       INI-GET-DLC.
           MOVE UVD-CAI-IOPC IN UVD TO DLC-CAI-IOPC IN DLC.
           MOVE UVD-IIC-IOPC IN UVD TO DLC-IIC-IOPC IN DLC.
           MOVE 999            TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT ( FIO-STAT-OKS AND
                    UVD-CAI-IOPC IN UVD = DLC-CAI-IOPC IN DLC AND
                    UVD-IIC-IOPC IN UVD = DLC-IIC-IOPC IN DLC )
               MOVE '23' TO FIO-STAT.
       FIN-GET-DLC.
           EXIT.

       GET-VEN SECTION.
       INI-GET-VEN.
           MOVE UVD-CAI-IOPC IN UVD TO VEN-CAI-IOPC IN VEN.
           MOVE UVD-IIC-IOPC IN UVD TO VEN-IIC-IOPC IN VEN.
           MOVE 999                 TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT ( FIO-STAT-OKS AND
                    UVD-CAI-IOPC IN UVD = VEN-CAI-IOPC IN VEN AND
                    UVD-IIC-IOPC IN UVD = VEN-IIC-IOPC IN VEN )
               MOVE '23' TO FIO-STAT.
       FIN-GET-VEN.
           EXIT.

       GET-EVC SECTION.
       INI-GET-EVC.
           MOVE UVD-CAI-IOPC IN UVD TO EVC-CAI-IOPC IN EVC.
           MOVE UVD-IIC-IOPC IN UVD TO EVC-IIC-IOPC IN EVC.
           MOVE ZEROES         TO EVC-NUM-IEVC IN EVC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-EVC.
           IF NOT ( FIO-STAT-OKS AND
                    UVD-CAI-IOPC IN UVD = EVC-CAI-IOPC IN EVC AND
                    UVD-IIC-IOPC IN UVD = EVC-IIC-IOPC IN EVC )
               MOVE '23' TO FIO-STAT.
       FIN-GET-EVC.
           EXIT.


       GET-ULT-EVC SECTION.
       INI-GET-ULT-EVC.
           MOVE UVD-CAI-IOPC IN UVD TO EVC-CAI-IOPC IN EVC.
           MOVE UVD-IIC-IOPC IN UVD TO EVC-IIC-IOPC IN EVC.
           MOVE 999                 TO EVC-NUM-IEVC IN EVC.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM COL-FIO-EVC.
           IF NOT ( FIO-STAT-OKS AND
                    UVD-CAI-IOPC IN UVD = EVC-CAI-IOPC IN EVC AND
                    UVD-IIC-IOPC IN UVD = EVC-IIC-IOPC IN EVC )
               MOVE '23' TO FIO-STAT.
       FIN-GET-ULT-EVC.
           EXIT.
