
       COL-VAL-PSM SECTION.
       INI-COL-VAL-PSM.
           MOVE SPACES TO PSM-COD-MENS IN PSM-VARI.
           IF PSM-SGV-TINT IN PSM-VARI = ZEROES AND
              PSM-IND-TICE IN PSM-VARI = 'S'
               GO TO FIN-COL-VAL-PSM.

           MOVE PSM-NUM-DTRN IN PSM-VARI TO FEC-DEC1.
           MOVE PSM-NUM-MTRN IN PSM-VARI TO FEC-MEC1.
           MOVE PSM-NUM-STRN IN PSM-VARI TO FEC-SEC1.
           MOVE PSM-NUM-ATRN IN PSM-VARI TO FEC-AEC1.
           MOVE PSM-NUM-DTOC IN PSM-VARI TO FEC-DEC2.
           MOVE PSM-NUM-MTOC IN PSM-VARI TO FEC-MEC2.
           MOVE PSM-NUM-STOC IN PSM-VARI TO FEC-SEC2.
           MOVE PSM-NUM-ATOC IN PSM-VARI TO FEC-AEC2.
           MOVE FEC-FORM-FEC             TO FEC-FORM.
           MOVE FEC-DIF-DIA              TO FEC-CMND.
           PERFORM CAL-FEC.
           MOVE FEC-NDIA                 TO PSM-NUM-NDIA IN PSM-VARI.

           MOVE PSM-VAL-MCRE IN PSM-VARI TO PSM-SGV-MNTO IN PSM-VARI.
           PERFORM GET-FHOY.
           IF PSM-FEC-FTRN IN PSM-VARI = HOY-FHOY IN HOY-VARI
              MOVE HOY-HHHY IN HOY-VARI  TO PSM-NUM-HHTR IN PSM-VARI
              MOVE HOY-MMHY IN HOY-VARI  TO PSM-NUM-MMTR IN PSM-VARI
           ELSE
              MOVE '2400'                TO PSM-HRA-HRTR IN PSM-VARI.
      *BUSCAR CON OFICINA, AUXILIAR, TBANCA Y CLASIF. COMERC.
           PERFORM BUS-PSM.
           IF PSM-COD-MENS IN PSM-VARI NOT > SPACES
              OR PSM-COD-MENS IN PSM-VARI = 'PSMMTO NEX' 
               GO TO NXT-COL-VAL-PSM.
           MOVE PSM-COD-OFOC IN PSM-VARI TO PSM-COD-OFIX IN PSM-VARI.
      *BUSCAR CON OFICINA=*, AUXILIAR, TBANCA Y CLASIF. COMERC.
           MOVE '*  '                    TO PSM-COD-OFOC IN PSM-VARI.
           PERFORM BUS-PSM.
           IF PSM-COD-MENS IN PSM-VARI NOT > SPACES
              OR PSM-COD-MENS IN PSM-VARI = 'PSMMTO NEX' 
               GO TO NXT-COL-VAL-PSM.
      *BUSCAR CON OFICINA=*, AUXILIAR=*, TBANCA Y CLASIF. COMERC.
           MOVE '*  '                    TO PSM-COD-OFOC IN PSM-VARI.
           MOVE '*  '                    TO PSM-COD-AOOC IN PSM-VARI.
           PERFORM BUS-PSM.
           IF PSM-COD-MENS IN PSM-VARI NOT > SPACES
              OR PSM-COD-MENS IN PSM-VARI = 'PSMMTO NEX' 
               GO TO NXT-COL-VAL-PSM.
      *BUSCAR CON OFICINA=*, AUXILIAR=*, TBANCA Y CLASIF. COMERC.=*
           MOVE '*  '                    TO PSM-COD-OFOC IN PSM-VARI.
           MOVE '*  '                    TO PSM-COD-AOOC IN PSM-VARI.
           MOVE '*  '                    TO PSM-COD-CLCM IN PSM-VARI.
           PERFORM BUS-PSM.
           IF PSM-COD-MENS IN PSM-VARI NOT > SPACES
              OR PSM-COD-MENS IN PSM-VARI = 'PSMMTO NEX' 
               GO TO NXT-COL-VAL-PSM.
      *BUSCAR CON OFICINA=*, AUXILIAR=*, TBANCA=* Y CLASIF. COMERC=*
           MOVE '*  '               TO PSM-COD-OFOC IN PSM-VARI.
           MOVE '*  '               TO PSM-COD-AOOC IN PSM-VARI.
           MOVE '*  '               TO PSM-COD-TBAN IN PSM-VARI.
           MOVE '*  '               TO PSM-COD-CLCM IN PSM-VARI.
           PERFORM BUS-PSM.
           IF PSM-COD-MENS IN PSM-VARI > SPACES
               GO TO FIN-COL-VAL-PSM.
       NXT-COL-VAL-PSM.
           SUBTRACT PSM-VAL-TMAX IN PSM-VARI FROM PSM-VAL-TASA IN
                    PSM-VARI GIVING PSM-VAL-MITC IN PSM-VARI.
      * RBG/INI/11-SEP-1996 
      *     IF PSM-COD-CVTI IN PSM-VARI > SPACES
      *         GO TO VAL-TAS-VAR-PSM.
      *     IF PSM-SGV-TINT IN PSM-VARI = ZEROES
      *         MOVE PSM-VAL-TASA IN PSM-VARI TO PSM-SGV-TINT IN PSM-VARI
      *         GO TO FIN-COL-VAL-PSM.
      *     IF PSM-SGV-TINT IN PSM-VARI > PSM-VAL-TASA IN PSM-VARI
      *         MOVE 'TASC>TASP   ' TO PSM-COD-MENS IN PSM-VARI
      *     ELSE
      *         IF PSM-SGV-TINT IN PSM-VARI < PSM-VAL-MITC IN PSM-VARI
      *             MOVE 'TASC<TASP   ' TO PSM-COD-MENS IN PSM-VARI.
      *     GO TO FIN-COL-VAL-PSM.
           IF PSM-SGV-TINT IN PSM-VARI < PSM-VAL-MITC IN PSM-VARI
               MOVE 'TASC<TASP   ' TO PSM-COD-MENS IN PSM-VARI.
           GO TO FIN-COL-VAL-PSM.
      * VAL-TAS-VAR-PSM.
      *    MOVE PSM-NUM-DTRN IN PSM-VARI TO CAM-NUM-DCAM IN CAM(1).
      *    MOVE PSM-NUM-MTRN IN PSM-VARI TO CAM-NUM-MCAM IN CAM(1).
      *    MOVE PSM-NUM-STRN IN PSM-VARI TO CAM-NUM-SCAM IN CAM(1).
      *    MOVE PSM-NUM-ATRN IN PSM-VARI TO CAM-NUM-ACAM IN CAM(1).
      *    MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2)
      *                                     CAM-FEC-FVCA IN CAM.
      *    MOVE 'I'                      TO CAM-MSC-TVAL IN CAM(1).
      *    MOVE PSM-COD-CVTI IN PSM-VARI TO CAM-COD-CVAL IN CAM(1).
      *    MOVE PSM-MSC-PBTI IN PSM-VARI TO CAM-COD-TCAM IN CAM(1).
      *    MOVE PSM-COD-VCOC IN PSM-VARI TO CAM-COD-VCAM IN CAM(2).
      *    MOVE CAM-COD-CAMB IN CAM      TO CAM-CAMB IN CAM-VARI.
      *    MOVE FIO-GET-LEQ    TO FIO-CMND.
      * LUP-COL-VAL-PSM.
      *    MOVE 'CAM-KEY-CVIG' TO FIO-AKEY.
      *    PERFORM TAB-FIO-CAM.
      *    IF NOT ( FIO-STAT-OKS AND CAM-COD-CAMB IN CAM = CAM-CAMB )
      *        MOVE 'CAMBTSAPSMNX' TO PSM-COD-MENS IN PSM-VARI
      *        GO TO FIN-COL-VAL-PSM.
      *    IF CAM-MSC-STAT IN CAM = 'N'
      *        MOVE FIO-GET-PRV TO FIO-CMND
      *        GO TO LUP-COL-VAL-PSM.
      *    IF PSM-SGV-TINT IN PSM-VARI = ZEROES
      *        IF CAM-SGV-VCAM IN CAM < PSM-VAL-TASA IN PSM-VARI
      *            SUBTRACT CAM-SGV-VCAM IN CAM FROM
      *                     PSM-VAL-TASA IN PSM-VARI
      *                              GIVING PSM-SGV-TINT IN PSM-VARI
      *            GO TO FIN-COL-VAL-PSM
      *        ELSE
      *            MOVE 'TASB=>TASP  ' TO PSM-COD-MENS IN PSM-VARI
      *            GO TO FIN-COL-VAL-PSM.
      *    ADD PSM-SGV-TINT IN PSM-VARI  TO CAM-SGV-VCAM IN CAM.
      *    IF CAM-SGV-VCAM IN CAM > PSM-VAL-TASA IN PSM-VARI
      *        MOVE 'TASC>TASP   ' TO PSM-COD-MENS IN PSM-VARI
      *        GO TO FIN-COL-VAL-PSM.
      *    IF CAM-SGV-VCAM IN CAM < PSM-VAL-MITC IN PSM-VARI
      *        MOVE 'TASC<TASP   ' TO PSM-COD-MENS IN PSM-VARI.
      * RBG/FIN/11-SEP-1996  
       FIN-COL-VAL-PSM.
           EXIT.
