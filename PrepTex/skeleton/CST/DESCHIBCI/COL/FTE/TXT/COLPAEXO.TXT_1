*%NO_TIENE_TIMESTAMP = TRUE
*%NO_HDR_CST = TRUE
*% INCLUDE 'GNSSRC:MANEJO_VSI.SRC'
*% IF WSS 
      *>>> INI CODIGO ADICIONAL
       COPY COLWGEXO.
       COPY COLBROPC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       
       01 WSS-CT.
         03 WSS-CT-ELI  VALUE 'ELI'    PIC X(03).
         03 WSS-CT-MOD  VALUE 'MOD'    PIC X(03).
         03 WSS-CT-ACC  VALUE 'ACC'    PIC X(03).
         03 WSS-CT-ING  VALUE 'ING'    PIC X(03).
         03 WSS-CT-1    VALUE 1        PIC 9(01).
         03 WSS-CT-S    VALUE 'S'      PIC X(01).
         03 WSS-CT-A    VALUE 'A'      PIC X(01).
         03 WSS-CT-M    VALUE 'M'      PIC X(01).
         03 WSS-CT-V    VALUE 'V'      PIC X(01).
         03 WSS-CT-E    VALUE 'E'      PIC X(01).
         03 WSS-CT-I    VALUE 'I'      PIC X(01).
         03 WSS-CT-S99  VALUE '99'     PIC X(02).
         03 WSS-CT-S23  VALUE '23'     PIC X(02).
         03 WSS-CT-COL  VALUE 'COL'    PIC X(03).
         03 WSS-CT-999  VALUE 999      PIC 9(03).
      *<<< FIN CODIGO ADICIONAL
*% END
*% IF PGM_PU
*% IF INI_CMN_MOD
      *>>> INI CODIGO ADICIONAL
           PERFORM RET-ALL-EXO.
           MOVE EXO      TO EXO-INPUT IN EXO-COMU.
           MOVE WSS-CT-M TO EXO-FLG-MODO IN EXO-COMU.
           PERFORM COL-LNK-EXO.
           
           IF EXO-COD-CMSG1 > SPACES
              MOVE WSS-CT-S99    TO FIO-STAT
              MOVE EXO-COD-CMSG1 TO MSG-COD-MENS
              MOVE EXO-COD-TMSG1 TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC  TO FRM-MENS.
           GO TO FIN-CMN-MOD.
      *<<< FIN CODIGO ADICIONAL
*% END
*% IF CMN_ING
      *>>> INI CODIGO ADICIONAL
           MOVE EXO      TO EXO-INPUT    IN EXO-COMU.
           MOVE WSS-CT-I TO EXO-FLG-MODO IN EXO-COMU.
           PERFORM COL-LNK-EXO.
           IF EXO-COD-CMSG1 > SPACES
              MOVE EXO-COD-CMSG1 TO MSG-COD-MENS
              MOVE EXO-COD-TMSG1 TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE WSS-CT-S99    TO FIO-STAT
              MOVE MSG-GLS-DESC TO FRM-MENS.
              
           GO TO FIN-CMN-ING.
      *<<< FIN CODIGO ADICIONAL
*% END
*% IF INI_CMN_ELI
      *>>> INI CODIGO ADICIONAL
           PERFORM KEY-ALL-EXO.
           PERFORM RET-ALL-EXO.
           MOVE EXO      TO EXO-INPUT    IN EXO-COMU.
           MOVE WSS-CT-E TO EXO-FLG-MODO IN EXO-COMU.
           PERFORM COL-LNK-EXO.
           
           IF EXO-COD-CMSG1 > SPACES
              MOVE WSS-CT-S99    TO FIO-STAT
              MOVE EXO-COD-CMSG1 TO MSG-COD-MENS
              MOVE EXO-COD-TMSG1 TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC  TO FRM-MENS.
           GO TO FIN-CMN-ELI.   
      *<<< FIN CODIGO ADICIONAL
*% END
*% END
*% INC_FIO = TRUE
*% IF FIO
      *<<<< FIO
       COPY COLBFEXO.      
      *>>>> FIO
*% END
*% IF EOF
      *>>> INI CODIGO ADICIONAL
       COPY COLBFOPC.
       COPY COLBKEXO.
      *<<< FIN CODIGO ADICIONAL
*% END
*% IF PGM_PQ
*% IF INI_FND_KEY 
      *<<<< INI_FND_KEY 
      * PARA EL COMANDO INGRESO SE BUSCA EL ULTIMO CORRELATIVO
           IF SCR-CCPP NOT = WSS-CT-ING
               GO TO BUS-INF-EXO.

           MOVE EXO-COD-SIST IN EXO-FLD TO EXO-COD-SIST IN EXO.
           MOVE EXO-COD-PROC IN EXO-FLD TO EXO-COD-PROC IN EXO.
           MOVE EXO-CAI-IEXO IN EXO-FLD TO EXO-CAI-IEXO IN EXO.
           MOVE EXO-IIC-IEXO IN EXO-FLD TO EXO-IIC-IEXO IN EXO.
           MOVE WSS-CT-999 TO EXO-NUM-IEXO IN EXO.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM COL-FIO-EXO.
           IF NOT FIO-STAT-OKS OR
              EXO-COD-SIST IN EXO NOT = EXO-COD-SIST IN EXO-FLD OR
              EXO-COD-PROC IN EXO NOT = EXO-COD-PROC IN EXO-FLD OR
              EXO-CAI-IEXO IN EXO NOT = EXO-CAI-IEXO IN EXO-FLD OR
              EXO-IIC-IEXO IN EXO NOT = EXO-IIC-IEXO IN EXO-FLD
               MOVE WSS-CT-1 IN WSS-CT TO EXO-NUM-IEXO IN EXO
               MOVE WSS-CT-1 IN WSS-CT TO EXO-NUM-IEXO IN EXO-FLD
           ELSE
               IF EXO-MSC-STAT IN EXO NOT = WSS-CT-S IN WSS-CT
                   COMPUTE EXO-NUM-IEXO IN EXO-FLD =
                              EXO-NUM-IEXO IN EXO + WSS-CT-1 IN WSS-CT
               ELSE
                   MOVE EXO-NUM-IEXO IN EXO TO EXO-NUM-IEXO IN EXO-FLD.

       BUS-INF-EXO.
           PERFORM KEY-ALL-EXO.

           IF SCR-CCPP = WSS-CT-ACC AND
              EXO-NUM-IEXO IN EXO-FLD NOT > ZEROES
               MOVE EXO-COD-SIST IN EXO-FLD TO EXO-COD-SIST IN EXO
               MOVE EXO-COD-PROC IN EXO-FLD TO EXO-COD-PROC IN EXO
               MOVE EXO-CAI-IEXO IN EXO-FLD TO EXO-CAI-IEXO IN EXO
               MOVE EXO-IIC-IEXO IN EXO-FLD TO EXO-IIC-IEXO IN EXO
               MOVE WSS-CT-999 TO EXO-NUM-IEXO IN EXO
               MOVE FIO-GET-LEQ TO FIO-CMND
               PERFORM COL-FIO-EXO
               IF FIO-STAT-OKS AND
                  EXO-COD-SIST IN EXO = EXO-COD-SIST IN EXO-FLD AND
                  EXO-COD-PROC IN EXO = EXO-COD-PROC IN EXO-FLD AND
                  EXO-CAI-IEXO IN EXO = EXO-CAI-IEXO IN EXO-FLD AND
                  EXO-IIC-IEXO IN EXO = EXO-IIC-IEXO IN EXO-FLD
                   MOVE EXO-NUM-IEXO IN EXO TO EXO-NUM-IEXO IN EXO-FLD
                   MOVE FIO-STAT TO PGM-STAT-EXO
                   GO TO FIN-FND-KEY
               ELSE
                   NEXT SENTENCE
           ELSE
               NEXT SENTENCE.

           IF SCR-CCPP = WSS-CT-MOD OR WSS-CT-ELI
               MOVE EXO-COD-SIST IN EXO-FLD TO EXO-COD-SIST IN EXO
               MOVE EXO-COD-PROC IN EXO-FLD TO EXO-COD-PROC IN EXO
               MOVE EXO-CAI-IEXO IN EXO-FLD TO EXO-CAI-IEXO IN EXO
               MOVE EXO-IIC-IEXO IN EXO-FLD TO EXO-IIC-IEXO IN EXO
               MOVE WSS-CT-999 TO EXO-NUM-IEXO IN EXO
               MOVE FIO-GET-LEQ TO FIO-CMND
               PERFORM COL-FIO-EXO
               IF FIO-STAT-OKS AND
                  EXO-COD-SIST IN EXO = EXO-COD-SIST IN EXO-FLD AND
                  EXO-COD-PROC IN EXO = EXO-COD-PROC IN EXO-FLD AND
                  EXO-CAI-IEXO IN EXO = EXO-CAI-IEXO IN EXO-FLD AND
                  EXO-IIC-IEXO IN EXO = EXO-IIC-IEXO IN EXO-FLD
                  MOVE EXO-NUM-IEXO IN EXO TO EXO-NUM-IEXO IN EXO-FLD
               ELSE
                  NEXT SENTENCE
           ELSE
              NEXT SENTENCE.

           MOVE EXO-COD-SIST IN EXO-FLD TO EXO-COD-SIST IN EXO.
           MOVE EXO-NUM-IEXO IN EXO-FLD TO EXO-NUM-IEXO IN EXO.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-EXO.
           MOVE FIO-STAT TO PGM-STAT-EXO.
           IF NOT FIO-STAT-OKS
               GO TO FIN-FND-KEY.

           GO TO FIN-FND-KEY.
      *>>>> INI_FND_KEY 
*% END
*% END
