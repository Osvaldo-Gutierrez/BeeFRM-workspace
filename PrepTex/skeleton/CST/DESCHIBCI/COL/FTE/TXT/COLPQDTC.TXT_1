*%! Codigo adicional
*% PGM_PTC = TRUE
*% IF WSS     
      *<<<< WSS
       01  WSS-VARI.
           03  WSS-COD-CAUX.
               05 WSS-COD-TOOC          PIC X(03).
               05 WSS-COD-AOOC          PIC X(03).

           03  WSS-NUM-TFOS             PIC 9(02).
 
           03  WSS-GLS-DATA.
               05 WSS-GLS-FI01         PIC X(20).
               05 WSS-FEC-FMOR         PIC X(08).
               05 WSS-GLS-FI02         PIC X(02).
               05 WSS-IND-NPAG         PIC X(01).
               05 WSS-GLS-FI03         PIC X(19).
               05 WSS-NUM-PLZO         PIC 9(03).
               05 WSS-IND-IPER         PIC X(01).
               05 WSS-GLS-FIO4         PIC X(06).

       COPY COLWGTCA.
       COPY GNSWGCPT.
       COPY SGCBRDBC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY COLBRPOC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-POC-REQA==.
       COPY COLBRRDC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY COLBRDLC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY COLBRVEN.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY COLBREVC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF FIO-STAT-OKS
               MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM SGC-FIO-DBC
               MOVE FIO-STAT TO PGM-STAT-DBC.

           IF FIO-STAT-OKS
               PERFORM PUT-TAB-DTC
               PERFORM PUT-CXE-DTC   
               MOVE '00' TO FIO-STAT.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       PUT-TAB-DTC SECTION.
       INI-PUT-TAB-DTC.
           PERFORM BUS-COD-TCAN.
           IF TCA-COD-MENS > SPACES
               GO TO FIN-PUT-TAB-DTC.
           MOVE 1 TO TCA-I.
       LUP-PUT-TAB-DTC.
           MOVE TCA-COD-TCAN IN TCA-VARI(TCA-I) TO
                FRM-COD-TCAN IN DTC-FLD(TCA-I).
           MOVE TCA-COD-GRPO IN TCA-VARI(TCA-I) TO
                FRM-COD-GRPO IN DTC-FLD(TCA-I).
           IF FRM-COD-TCAN IN DTC-FLD(TCA-I) > SPACES
               MOVE 'COL' TO TAB-COD-SIST
               MOVE 'CNC ' TO TAB-COD-TTAB IN TAB
               MOVE FRM-COD-TCAN IN DTC-FLD(TCA-I)
                           TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-TCAN IN DTC-FLD(TCA-I)
           ELSE
               MOVE SPACES TO FRM-GLS-TCAN IN DTC-FLD(TCA-I).

           IF FRM-COD-GRPO IN DTC-FLD(TCA-I) > SPACES
                MOVE FRM-COD-GRPO IN DTC-FLD(TCA-I)
                                TO MSC-COD-TMSC IN MSC
                MOVE SPACES     TO MSC-COD-CMSC IN MSC
                MOVE 'COL'      TO  FIO-SIST
                MOVE FIO-GET-KEY TO FIO-CMND
                PERFORM GNS-FIO-MSC
                IF FIO-STAT-OKS
                    MOVE MSC-GLS-DESC IN MSC TO
                         FRM-GLS-GRPO IN DTC-FLD(TCA-I)
                ELSE
                    MOVE SPACES TO FRM-GLS-GRPO IN DTC-FLD(TCA-I)
           ELSE
               MOVE SPACES TO FRM-GLS-GRPO IN DTC-FLD(TCA-I).
           ADD 1 TO TCA-I.
           IF TCA-I NOT > 10
               GO TO LUP-PUT-TAB-DTC.
       FIN-PUT-TAB-DTC.
           EXIT.       
       PUT-CXE-DTC SECTION.
       INI-PUT-CXE-DTC.
           PERFORM GET-FHOY.
           IF POC-IND-CMOR IN POC NOT = 'S'
               GO TO FIN-PUT-CXE-DTC.
           MOVE 1 TO TCA-I.
       LUP-PUT-TAB-DTC.
           IF FRM-COD-TCAN IN DTC-FLD(TCA-I) > SPACES
               GO TO NXT-PUT-CXE-DTC.
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
           MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
               GO TO FIN-PUT-CXE-DTC.

           IF VEN-FEC-FVEN IN VEN < HOY-FHOY
               GO TO FIN-PUT-CXE-DTC.

           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT (FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = DLC-CIC-IOPC IN DLC )
               GO TO FIN-PUT-CXE-DTC.

            MOVE 'VSN'             TO TAB-COD-TTAB IN TAB.
            MOVE 'CREDSINMORA'     TO TAB-COD-CTAB IN TAB.
            MOVE 'COL'             TO  FIO-SIST.
            MOVE FIO-GET-KEY TO FIO-CMND.
            PERFORM GNS-FIO-TAB.
            IF NOT ( FIO-STAT-OKS AND
               TAB-IND-VIGE IN TAB = 'S' )
                GO TO FIN-PUT-CXE-DTC.


           MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-DATA.

           IF WSS-FEC-FMOR > HOY-FHOY
               GO TO FIN-PUT-CXE-DTC.


           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE DLC-NUM-DMAV TO FEC-DEC2.
           MOVE DLC-NUM-MMAV TO FEC-MEC2.
           MOVE DLC-NUM-SMAV TO FEC-SEC2.
           MOVE DLC-NUM-AMAV TO FEC-AEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-MES  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
                GO TO FIN-PUT-CXE-DTC.
 


           IF FEC-NMES > WSS-NUM-PLZO
               GO TO FIN-PUT-CXE-DTC.

           MOVE ZEROES              TO WSS-NUM-TFOS.


           MOVE OPC-CIC-IOPC IN OPC TO EVC-CIC-IOPC IN EVC.
           MOVE ZEROES              TO EVC-NUM-IEVC IN EVC.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-LEE-EVC.
           PERFORM COL-FIO-EVC.
           IF NOT(  FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = EVC-CIC-IOPC IN EVC )
               GO TO VAL-PUT-CXE-DTC.
           IF EVC-MSC-TCVE IN EVC = 'FO'
               ADD 1 TO WSS-NUM-TFOS
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-LEE-EVC
           ELSE
               MOVE ZEROES TO WSS-NUM-TFOS.

           
       VAL-PUT-CXE-DTC.

           IF WSS-NUM-TFOS > 1
               IF WSS-IND-NPAG = 'N'
                   GO TO FIN-PUT-CXE-DTC.
               
           MOVE 'CXE' TO FRM-COD-TCAN IN DTC-FLD(TCA-I).
           IF FRM-COD-TCAN IN DTC-FLD(TCA-I) > SPACES
              MOVE 'COL' TO TAB-COD-SIST
               MOVE 'CNC ' TO TAB-COD-TTAB IN TAB
               MOVE FRM-COD-TCAN IN DTC-FLD(TCA-I)
                           TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO 
                    FRM-GLS-TCAN IN DTC-FLD(TCA-I)
           ELSE          
               MOVE SPACES TO FRM-GLS-TCAN IN DTC-FLD(TCA-I).

            MOVE 'MSG'             TO TAB-COD-TTAB IN TAB.
            MOVE 'CANCXEWAR'     TO TAB-COD-CTAB IN TAB.
            MOVE 'COL'             TO  FIO-SIST.
            MOVE FIO-GET-KEY TO FIO-CMND.
            PERFORM GNS-FIO-TAB.
            IF FIO-STAT-OKS AND
               TAB-IND-VIGE IN TAB = 'S'
                    MOVE TAB-GLS-DESC IN TAB TO
                         FRM-GLS-GRPO IN DTC-FLD(TCA-I)
            ELSE
                MOVE 'CANCELACION A VERIFICAR '
                     TO FRM-GLS-GRPO IN DTC-FLD(TCA-I).

           GO TO FIN-PUT-CXE-DTC.


       NXT-PUT-CXE-DTC.

           ADD 1 TO TCA-I.
           IF TCA-I NOT > 10
               GO TO LUP-PUT-TAB-DTC.
       FIN-PUT-CXE-DTC.
           EXIT.

       COPY SGCBFDBC.
       COPY COLBFPOC.
       COPY COLBFRDC.
       COPY GNSBGCPT.
       COPY GNSBBTAB.
       COPY COLBGTCA.
       COPY COLBFDLC.
       COPY COLBFVEN.
       COPY COLBFEVC.
       COPY GNSBPFEC.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
      *>>>>
*% END
