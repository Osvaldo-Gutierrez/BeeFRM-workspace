*%! Codigo Adicional
*% IF PGP_COD_VCOC
      *<<<< PCP_COD_VCOC
           IF PGP-COD-VCOC IN PGP-FLD(FRM-IFLD) NOT > SPACES
              MOVE SPACES TO FRM-GLS-VCOC IN PGP-FLD(FRM-IFLD)
              GO TO FIN-VAL-PGP-COD-VCOC.

      *VAL-COD Valida codigo de tabla
           MOVE 'TAB'                         TO TAB-COD-SIST.
           MOVE 'VLR '                        TO TAB-COD-TTAB IN TAB.
           MOVE PGP-COD-VCOC IN PGP-FLD(FRM-IFLD) TO 
                                                 TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX' OR
              PGP-COD-VCOC IN PGP-FLD(FRM-IFLD) NOT > SPACES
               MOVE SPACES TO FRM-GLS-VCOC IN PGP-FLD(FRM-IFLD)
           ELSE
               MOVE TAB-GLS-DESC IN TAB TO
                              FRM-GLS-VCOC IN PGP-FLD(FRM-IFLD).
*% END
*% IF INI_PGP_COD_OFIC
      *<<<< INI_PGP_COD_OFIC
           IF PGP-COD-OFIC IN PGP-FLD = '*  '
              GO TO FIN-VAL-PGP-COD-OFIC.
           IF PGP-COD-OFIC IN PGP-FLD = '   '
           AND SCR-CMND = 'CON'
              GO TO FIN-VAL-PGP-COD-OFIC.
      *>>>>
*% END
*% IF INI_PGP_FEC_FPLA
      *<<<< INI_PGP_FEC_FPLA
           IF PGP-FEC-FPLA IN PGP-FLD = ZEROES
           AND SCR-CMND = 'CON'
              GO TO FIN-VAL-PGP-FEC-FPLA.
           IF PGP-FEC-FPLA IN PGP-FLD = 99999999
           AND SCR-CMND = 'CON'
              GO TO FIN-VAL-PGP-FEC-FPLA.
      *>>>>
*% END
*% IF INI_PGP_COD_GSTO
      *<<<< INI_PGP_COD_GSTO
           IF PGP-COD-GSTO IN PGP-FLD(1) NOT > SPACES
              PERFORM ERR-GLS
              GO TO FIN-VAL-PGP-COD-GSTO.

           IF PGP-COD-GSTO IN PGP-FLD(FRM-IFLD) NOT > SPACES
              GO TO FIN-VAL-PGP-COD-GSTO.
      *>>>>
*% END
*% IF INI_PGP_IND_SCTB
      *<<<< INI_PGP_IND_SCTB
           IF PGP-IND-SCTB IN PGP-FLD(FRM-IFLD) NOT > SPACES
              GO TO FIN-VAL-PGP-IND-SCTB.
      *>>>>
*% END
*% IF INI_PGP_IND_MTOP
      *<<<< INI_PGP_IND_MTOP
           IF PGP-IND-MTOP IN PGP-FLD(FRM-IFLD) NOT > SPACES AND
              PGP-COD-GSTO IN PGP-FLD(FRM-IFLD) > SPACES
              PERFORM ERR-GLS
              GO TO FIN-VAL-PGP-IND-MTOP.

           IF PGP-IND-MTOP IN PGP-FLD(FRM-IFLD) NOT > SPACES
              GO TO FIN-VAL-PGP-IND-MTOP.
      *>>>>
*% END
*% IF INI_PGP_COD_CONC
      *<<<< INI_PGP_COD_CONC
           IF PGP-COD-CONC IN PGP-FLD(FRM-IFLD) NOT > SPACES
              MOVE SPACES TO PGP-COD-CONC IN PGP-FLD(FRM-IFLD)
              GO TO FIN-VAL-PGP-COD-CONC.
      *>>>>
*% END
*% IF VAL_CON_FLD_PGP
      *<<<< VAL_CON_FLD_PGP
      *
           MOVE SPACES         TO WSS-VCOC-ANT IN WSS-VARI.
           MOVE SPACES         TO WSS-GTO-ANT  IN WSS-VARI.
      * Carga variables WSS-GTO-PORC y WSS-GTO-MTO
           MOVE FIO-GET-KEY    TO FIO-CMND.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE 'COL'          TO FIO-SIST.
           MOVE 'MTOP'         TO MSC-CIC-TMSC IN MSC.
           MOVE 'P'            TO MSC-CIC-CMSC IN MSC.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
              MOVE 'COD    NEX' TO MSG-COD-MENS
              MOVE 'COL'        TO MSG-COD-SIST
              PERFORM GET-MSG
           ELSE
              IF MSC-IND-VIGE IN MSC = 'N'
                 MOVE 'COD    NVG' TO MSG-COD-MENS
                 MOVE 'COL'        TO MSG-COD-SIST
                 PERFORM GET-MSG
              ELSE
                 MOVE SPACES       TO MSG-COD-MENS
                 MOVE MSC-COD-CMSC IN MSC 
                                   TO WSS-GTO-PORC IN WSS-VARI.
           IF MSG-COD-MENS NOT = SPACES
                MOVE MSG-GLS-DESC TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                GO TO FIN-VAL-CON-FLD-PGP.
      *
           MOVE FIO-GET-KEY    TO FIO-CMND.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE 'COL'          TO FIO-SIST.
           MOVE 'MTOP'         TO MSC-CIC-TMSC IN MSC.
           MOVE 'M'            TO MSC-CIC-CMSC IN MSC.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
              MOVE 'COD    NEX' TO MSG-COD-MENS
              MOVE 'COL'        TO MSG-COD-SIST
              PERFORM GET-MSG
           ELSE
              IF MSC-IND-VIGE IN MSC = 'N'
                 MOVE 'COD    NVG' TO MSG-COD-MENS
                 MOVE 'COL'        TO MSG-COD-SIST
                 PERFORM GET-MSG
              ELSE
                 MOVE SPACES       TO MSG-COD-MENS
                 MOVE MSC-COD-CMSC IN MSC
                                   TO WSS-GTO-MTO  IN WSS-VARI.
           IF MSG-COD-MENS NOT = SPACES
                MOVE MSG-GLS-DESC TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                GO TO FIN-VAL-CON-FLD-PGP.
      *
           MOVE SPACES TO FRM-UCUR.
           PERFORM VAL-CON-PGP-COD-GSTO
           VARYING FRM-IFLD FROM 1 BY 1 UNTIL FRM-IFLD > WSS-FRM-TOP OR
                    FRM-SUAR = FRM-SUAR-MAL.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE '1'   TO FRM-UCUR
*% IF PGM_MCP
                MOVE FRM-POS-CURS TO 
                              PGP-COD-GSTO-LEN IN PGP-FLD(FRM-IFLD)
*% END
                GO TO FIN-VAL-CON-FLD-PGP.
      *>>>>
*% END
*% IF DBC_VRF_ICLI
      *<<< DBC_VRF_ICLI
           IF DBC-IND-ICLI IN PGP-FLD = 'M'
      *ISP NO ACEPTA MULTIPLES DEUDORES INDIRECTOS PARA VERSION BCI
               MOVE 'COL'          TO TAB-COD-SIST
               MOVE 'VSN'          TO TAB-COD-TTAB IN TAB
               MOVE 'BCI    MDIND' TO TAB-COD-CTAB IN TAB
               PERFORM VAL-COD
               IF MSG-COD-MENS NOT > SPACES
                   MOVE ZEROES TO DBC-NUM-ICLI IN PGP-FLD
                   MOVE SPACES TO DBC-VRF-ICLI IN PGP-FLD
                   MOVE SPACES TO DBC-GLS-ICLI IN PGP-FLD
                   MOVE 'COL'          TO MSG-COD-SIST
                   MOVE 'DLC    MDIND' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO DBC-GLS-NOMC IN PGP-FLD
                   GO TO FIN-VAL-DBC-VRF-ICLI
               ELSE
                   MOVE 'COL'          TO MSG-COD-SIST
                   MOVE 'BCI    MDIND' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-DBC-VRF-ICLI.

      *VAL-RUT Valida Rut
           IF DBC-NUM-ICLI IN PGP-FLD NOT > ZEROES
               MOVE SPACES TO DBC-VRF-ICLI IN PGP-FLD
                              DBC-IND-ICLI IN PGP-FLD
                              DBC-GLS-ICLI IN PGP-FLD
                              PGP-CAI-ICLI IN PGP-FLD
                              PGP-IIC-ICLI IN PGP-FLD
                              GO TO FIN-VAL-DBC-VRF-ICLI.
           MOVE DBC-NUM-ICLI IN PGP-FLD TO IDC-NUM-RUTV.
           MOVE DBC-VRF-ICLI IN PGP-FLD TO IDC-VRF-RUTV.
           PERFORM VAL-RUT.
           IF MSG-COD-MENS = SPACES AND
              DBC-NUM-ICLI IN PGP-FLD > ZEROES
               MOVE DBC-NUM-ICLI IN PGP-FLD TO DBC-NUM-ICLI IN DBC
               MOVE DBC-IND-ICLI IN PGP-FLD TO DBC-IND-ICLI IN DBC
               MOVE DBC-GLS-ICLI IN PGP-FLD TO DBC-GLS-ICLI IN DBC
               MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY
               MOVE FIO-GET-KEY-ALT TO FIO-CMND
               PERFORM SGC-FIO-DBC
               IF NOT FIO-STAT-OKS
                   MOVE 'SGC'        TO MSG-COD-SIST
                   MOVE 'CLI    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC IN MSG TO DBC-GLS-NOMC IN PGP-FLD
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
               ELSE
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN            TO DBC-GLS-NOMC IN PGP-FLD
                   MOVE DBC-CAI-ICLI IN DBC TO PGP-CAI-ICLI IN PGP-FLD
                   MOVE DBC-IIC-ICLI IN DBC TO PGP-IIC-ICLI IN PGP-FLD

                   MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN PGP-FLD
                   MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN PGP-FLD
                   MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN PGP-FLD
                   MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN PGP-FLD.
      *>>>>               
*% END      
*% IF EOF
      *<<<< EOF
       VAL-CON-PGP-COD-GSTO SECTION.
       INI-VAL-CON-PGP-COD-GSTO.
      ***
      * Valida que no se dejen codigos de gasto en blanco
      * y que la primera fila de la matriz no este en blanco
      ***
           IF PGP-COD-GSTO IN PGP-FLD(FRM-IFLD) = SPACES
                IF PGP-COD-VCOC IN PGP-FLD(FRM-IFLD) > SPACES OR
                   PGP-IND-SCTB IN PGP-FLD(FRM-IFLD) > SPACES OR
                   PGP-IND-MTOP IN PGP-FLD(FRM-IFLD) > SPACES OR
                   PGP-COD-CONC IN PGP-FLD(FRM-IFLD) > SPACES OR
                   PGP-VAL-GSTO IN PGP-FLD(FRM-IFLD) > ZEROS  OR
                   PGP-VAL-GMIN IN PGP-FLD(FRM-IFLD) > ZEROS  OR
                   PGP-VAL-GMAX IN PGP-FLD(FRM-IFLD) > ZEROS
                     MOVE 'CODGTO=SPA' TO MSG-COD-MENS
                     MOVE -1           TO PGP-COD-GSTO-LEN
                                       IN PGP-FLD(FRM-IFLD)
                     PERFORM ERR-VAL-CON-PGP-GSTO
                     GO TO FIN-VAL-CON-PGP-COD-GSTO
                ELSE
                     IF FRM-IFLD = 1
                          MOVE 'COD    SPA' TO MSG-COD-MENS
                          MOVE -1           TO PGP-COD-GSTO-LEN
                                            IN PGP-FLD(FRM-IFLD)
                          PERFORM ERR-VAL-CON-PGP-GSTO
                          GO TO FIN-VAL-CON-PGP-COD-GSTO
                     ELSE
                          GO TO ANT-VAL-CON-PGP-COD-GSTO.
      ***
      * Valida que un codigo de gasto lleve indicador de 'MTO/PORC'
      ***
           IF PGP-COD-GSTO IN PGP-FLD(FRM-IFLD) > SPACES
              IF PGP-IND-MTOP IN PGP-FLD(FRM-IFLD) = SPACES
                   MOVE 'INDMTOPSPA' TO MSG-COD-MENS
                   MOVE -1           TO PGP-IND-MTOP-LEN
                                     IN PGP-FLD(FRM-IFLD)
                   PERFORM ERR-VAL-CON-PGP-GSTO
                   GO TO FIN-VAL-CON-PGP-COD-GSTO.
           IF FRM-IFLD = 1
                GO TO DOS-VAL-CON-PGP-COD-GSTO.
      ***
      * Valida que no se dejen lineas en blanco en la pantalla
      ***
           IF WSS-GTO-ANT IN WSS-VARI = SPACES
                 MOVE 'COD    SPA'  TO MSG-COD-MENS
                 SUBTRACT 1       FROM FRM-IFLD  GIVING WSS-I
                 MOVE -1            TO PGP-COD-GSTO-LEN
                                    IN PGP-FLD(WSS-I)
                 PERFORM ERR-VAL-CON-PGP-GSTO
                 GO TO FIN-VAL-CON-PGP-COD-GSTO.
      ***
      * Valida que no se ingresen codigos de gasto repetidos
      ***
           MOVE ZEROES  TO WSS-COD-DUP.
           PERFORM VAL-COD-GSTO-ANT VARYING WSS-I FROM 1
                BY 1 UNTIL WSS-I = FRM-IFLD OR WSS-COD-DUP = 1.
           IF WSS-COD-DUP = 1
                MOVE 'COD    DUP' TO MSG-COD-MENS
                MOVE -1           TO PGP-COD-GSTO-LEN
                                  IN PGP-FLD(FRM-IFLD)
                PERFORM ERR-VAL-CON-PGP-GSTO
                GO TO FIN-VAL-CON-PGP-COD-GSTO.
      *
       DOS-VAL-CON-PGP-COD-GSTO.
      ***
      * Valida que un codigo de gasto INF sea monto y no tenga
      * informacion en el campo PGP-VAL-GAST
      ***
           IF PGP-COD-GSTO IN PGP-FLD(FRM-IFLD) = 'INF'
              IF PGP-IND-MTOP IN PGP-FLD(FRM-IFLD) =
               WSS-GTO-MTO  IN WSS-VARI
                 IF PGP-VAL-GSTO IN PGP-FLD(FRM-IFLD) > ZEROS
                   MOVE 'PGPVGTOZER' TO MSG-COD-MENS
                   MOVE -1           TO PGP-VAL-GSTO-LEN
                                     IN PGP-FLD(FRM-IFLD)
                   PERFORM ERR-VAL-CON-PGP-GSTO
                   GO TO FIN-VAL-CON-PGP-COD-GSTO
                 ELSE
                   NEXT SENTENCE
               ELSE
                   MOVE 'PGPMTOPMTO' TO MSG-COD-MENS
                   MOVE -1           TO PGP-IND-MTOP-LEN
                                     IN PGP-FLD(FRM-IFLD)
                   PERFORM ERR-VAL-CON-PGP-GSTO
                   GO TO FIN-VAL-CON-PGP-COD-GSTO.

      ***
      * Valida que no se digite un concepto en campo PGP-COD-CONC
      * ('Aplica Sobre') si codigo en campo PGP-IND-MTOP ('MTO/PORC')
      * es igual a 'M' (Monto).
      ***
           IF PGP-IND-MTOP IN PGP-FLD(FRM-IFLD) = 
              WSS-GTO-MTO  IN WSS-VARI
               IF PGP-COD-CONC IN PGP-FLD(FRM-IFLD) > SPACES
                   MOVE 'CPT    >SPA' TO MSG-COD-MENS
                   MOVE -1            TO PGP-COD-CONC-LEN
                                      IN PGP-FLD(FRM-IFLD)
                   PERFORM ERR-VAL-CON-PGP-GSTO
                   GO TO FIN-VAL-CON-PGP-COD-GSTO.

      ***
      * Valida que se digite un concepto en campo PGP-COD-CONC
      * ('Aplica Sobre') si codigo en campo PGP-IND-MTOP ('MTO/PORC')
      * es igual a 'P' (Porcentaje).
      ***
           IF PGP-IND-MTOP IN PGP-FLD(FRM-IFLD) = 
              WSS-GTO-PORC IN WSS-VARI
               IF PGP-COD-CONC IN PGP-FLD(FRM-IFLD) NOT > SPACES
                   MOVE 'CPT     SPA' TO MSG-COD-MENS
                   MOVE -1            TO PGP-COD-CONC-LEN
                                      IN PGP-FLD(FRM-IFLD)
                   PERFORM ERR-VAL-CON-PGP-GSTO
                   GO TO FIN-VAL-CON-PGP-COD-GSTO.
      ***
      * Valida que valor digitado en campo PGP-VAL-GSTO ('MONTO/TASA')
      * sea > 0 y no > 100, si campo PGP-IND-MTOP es 'P' (porcentaje)
      ***
           IF PGP-IND-MTOP IN PGP-FLD(FRM-IFLD) =
              WSS-GTO-PORC IN WSS-VARI
              IF PGP-VAL-GSTO IN PGP-FLD(FRM-IFLD) > 100 OR NOT > ZEROES
                   MOVE 'PORCNOVAL '  TO MSG-COD-MENS
                   MOVE -1            TO PGP-VAL-GSTO-LEN
                                      IN PGP-FLD(FRM-IFLD)
                   PERFORM ERR-VAL-CON-PGP-GSTO
                   GO TO FIN-VAL-CON-PGP-COD-GSTO.
      ***
      * Valida que monto minimo del gasto sea menor a monto maximo,
      * si el gasto es del tipo % y se indica un minimo y un maximo
      ***
           IF PGP-IND-MTOP IN PGP-FLD(FRM-IFLD) =
              WSS-GTO-PORC IN WSS-VARI
                IF PGP-VAL-GMIN IN PGP-FLD(FRM-IFLD) > ZEROS AND
                   PGP-VAL-GMAX IN PGP-FLD(FRM-IFLD) > ZEROS 
                     IF PGP-VAL-GMAX IN PGP-FLD(FRM-IFLD) <
                        PGP-VAL-GMIN IN PGP-FLD(FRM-IFLD)
                          MOVE 'GTOMIN>MAX'  TO MSG-COD-MENS
                          MOVE -1            TO PGP-VAL-GSTO-LEN
                                             IN PGP-FLD(FRM-IFLD)
                          PERFORM ERR-VAL-CON-PGP-GSTO
                          GO TO FIN-VAL-CON-PGP-COD-GSTO.
      ***
      * Si gasto es del tipo MONTO, limpia campos Monto Minimo y Maximo
      ***
           IF PGP-IND-MTOP IN PGP-FLD(FRM-IFLD) =
              WSS-GTO-MTO  IN WSS-VARI
                MOVE ZEROES TO PGP-VAL-GMIN IN PGP-FLD(FRM-IFLD)
                               PGP-VAL-GMAX IN PGP-FLD(FRM-IFLD).
      *
       ANT-VAL-CON-PGP-COD-GSTO.
           MOVE PGP-COD-GSTO IN PGP-FLD(FRM-IFLD) TO
                                WSS-GTO-ANT  IN WSS-VARI.
           MOVE PGP-COD-VCOC IN PGP-FLD(FRM-IFLD) TO
                                WSS-VCOC-ANT  IN WSS-VARI.
      *
       FIN-VAL-CON-PGP-COD-GSTO.
           EXIT.
      *
       ERR-VAL-CON-PGP-GSTO SECTION.
       INI-ERR-VAL-CON-PGP-GSTO.
           MOVE 'COL'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE FRM-SUAR-MAL TO FRM-SUAR.
       FIN-ERR-VAL-CON-PGP-GSTO.
           EXIT.
      *
       VAL-COD-GSTO-ANT SECTION.
       INI-VAL-COD-GSTO-ANT.
           IF PGP-COD-GSTO IN PGP-FLD(FRM-IFLD) =
              PGP-COD-GSTO IN PGP-FLD(WSS-I)
              IF PGP-COD-VCOC IN PGP-FLD(FRM-IFLD) =
                 PGP-COD-VCOC IN PGP-FLD(WSS-I)
                    MOVE 1  TO WSS-COD-DUP.
       FIN-VAL-COD-GSTO-ANT.
           EXIT.
      *>>>>
*% END
