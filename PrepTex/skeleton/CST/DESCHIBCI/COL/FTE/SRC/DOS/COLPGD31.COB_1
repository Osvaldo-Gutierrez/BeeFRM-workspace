       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPGD31.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    22-MAY-2000.

      * Programa Generador Interfaz D31 Super-Bancos de COL.
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            C01 IS SALTO
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
           SELECT RPTD31         ASSIGN TO        UT-S-RPTD31.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       FD  RPTD31 LABEL RECORDS OMITTED
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-D31     PIC X(132).

       WORKING-STORAGE SECTION.
      *-----------------------
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
      *>>>>

       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.

      *<<<< WSS

       COPY COLRWD31.
       COPY COLRTD31.
       COPY COLRND31.
       COPY COLROD31.
       COPY COLRRD31.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSBRMSC.
       COPY COLBRVEN.
       COPY COLBROPC.
       COPY COLBRDLC.
       COPY COLBRICG.
       COPY COLBRTOC.
       COPY COLBRDCC.
       COPY COLBRRD3.
       COPY COLBRRH3.
       COPY SUPBRD31.
       COPY SUPBRC31.
       COPY TABBROFI.
       COPY TABBRCAM.
       COPY TABBRCOM.
       COPY TABBRTIO.
       COPY TABBRVLR.
       COPY GNSWGPES.
       COPY COLWGCTO.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY COLWGINT.
       COPY GNSWGCVI.
       COPY TABWGTXC.
       01  WSS-VARI.
           03 WSS-COD-CTAB.
              05  WSS-COD-CTAB-TOPE              PIC X(04).
              05  WSS-COD-CTAB-TOPE-F            PIC X(08).
           03 WSS-COD-TRAMO                      PIC X(02).
           03 WSS-DIG-TRES                       PIC 9(01).
           03 WSS-FEC-NDIA                       PIC 9(06).
           03 WSS-FEC-NMES                       PIC 9(06).
           03 WSS-FEC-NANO                       PIC 9(06).
           03 WSS-D31-CAB.
              05  WSS-FINA                       PIC X(03).
              05  WSS-FILE                       PIC X(03).
              05  WSS-REFE                       PIC X(08).
              05  WSS-SPAC                       PIC X(42).
           03 WSS-COD-PLZO                       PIC 9(02).
           03 WSS-KEY-D31.
               05 WSS-TOPE-D31                   PIC 9(04).
               05 WSS-PLZO-D31                   PIC 9(02).
               05 WSS-TTAS-D31.
                  07 WSS-TTAS-1D31               PIC 9(01).
                  07 WSS-TTAS-2D31               PIC 9(01).
                  07 WSS-TTAS-3D31               PIC 9(01).
               05 WSS-VCOC-D31                   PIC 9(03).
           03  WSS-GLS-CCSB.
               05 WSS-CAI-CCSB                   PIC X(04).
               05 WSS-IIC-CCSB                   PIC X(08).
           03  WSS-CRED-ORIG     COMP-3          PIC S9(11)V9(04).
           03  WSS-IND-TXC  VALUE 'N'            PIC X(01).
           03  WSS-IND-VTMC                       PIC X(01).
           03  WSS-COD-RMTP                       PIC X(01).
           03  AUX-CIC-IOPC                       PIC X(12).
           03  WSS-FEC-FORI.
               05  WSS-NUM-SORI                   PIC 9(02).
               05  WSS-NUM-AORI                   PIC 9(02).
               05  WSS-NUM-MORI                   PIC 9(02).
               05  WSS-NUM-DORI                   PIC 9(02).
           03 WSS-VAL-NDLC   VALUE ZEROES   PIC ZZZZZZZZZZZZZ9,9999.
           03 WSS-VAL-UF05        VALUE ZEROES         PIC 9(14).
           03 WSS-VAL-UF10        VALUE ZEROES         PIC 9(14).
           03 WSS-COD-GCAB        VALUE SPACES         PIC X(01).
           03 WSS-FEC-REFE.
              05 WSS-NUM-SREF                          PIC X(02).
              05 WSS-NUM-AREF                          PIC X(02).
              05 WSS-NUM-MREF                          PIC X(02).
              05 WSS-NUM-DREF                          PIC X(02).
           03 WSS-FEC-FP02.
              05 WSS-NUM-DP02                          PIC X(02).
              05 WSS-NUM-MP02                          PIC X(02).
              05 WSS-NUM-SP02                          PIC X(02).
              05 WSS-NUM-AP02                          PIC X(02).
           03 WSS-GLS-PARA.
              05 WSS-FEC-FINF.
                 07 WSS-NUM-DINF                       PIC 9(02).
                 07 WSS-NUM-MINF                       PIC 9(02).
                 07 WSS-NUM-SINF                       PIC 9(02).
                 07 WSS-NUM-AINF                       PIC 9(02).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP1                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP2                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP3                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP4                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP5                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP6                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP7                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP8                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP9                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP10                         PIC X(06).
           03 WSS-GLS-PARA1.
              05 WSS-COD-COP11                         PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP12                         PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP13                         PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP14                         PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP15                         PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP16                         PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP17                         PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP18                         PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP19                         PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP20                         PIC X(06).
           03 WSS-FEC-FIN1.
              05 WSS-NUM-SIN1                          PIC 9(02).
              05 WSS-NUM-AIN1                          PIC 9(02).
              05 WSS-NUM-MIN1                          PIC 9(02).
              05 WSS-NUM-DIN1                          PIC 9(02).
           03 WSS-FEC-FHBL.
              05 WSS-NUM-SHBL                          PIC 9(02).
              05 WSS-NUM-AHBL                          PIC 9(02).
              05 WSS-NUM-MHBL                          PIC 9(02).
              05 WSS-NUM-DHBL                          PIC 9(02).
           03 WSS-IND-STAT         VALUE 0             PIC 9(01).
           03 WSS-IND-TEQV         VALUE 0             PIC 9(01).
           03 WSS-COD-OFOC                             PIC X(03).
           03 WSS-COD-PESO                             PIC X(06).
           03 WSS-COD-UEFE                             PIC X(06).
           03 WSS-COD-DOLA                             PIC X(06).
           03 WSS-SGV-UEFE                             PIC S9(11)V9999.
           03 WSS-SGV-DOLA                             PIC S9(11)V9999.
           03 WSS-SGV-FINF                             PIC S9(11)V9999.
           03 WSS-VAL-PPON                             PIC S9(14)V9999.
           03 WSS-VAL-SPON                             PIC S9(14)V9999.
           03 WSS-VAL-SPRD                             PIC S9(03)V9999.
           03 WSS-VAL-TASA                             PIC S9(03)V9999.
           03 WSS-VAL-TEQV                             PIC S9(03)V99.
           03 WSS-VAL-TB90                             PIC 9(03)V9(04).
           03 WSS-VAL-TS90                             PIC 9(03)V9(04).
           03 WSS-VAL-TREA                             PIC 9(03)V9(04).
           03 WSS-VAL-TMEX                             PIC 9(03)V9(04).
           03 WSS-VAL-TMXC                             PIC 9(03)V9(04).
           03 WSS-VAL-TRAM                             PIC 9(11)V9(04).
           03 WSS-VAL-TMCC                             PIC 9(03)V9(04).
           03 WSS-NUM-IOFI                             PIC 9(03).
           03 WSS-HBL-DIAS                             PIC 9(02).
           03 WSS-OFIC                                 PIC 9(04).
           03 WSS-OPEC                                 PIC X(01).
           03 WSS-IND              VALUE 0             PIC 9(03).
           03 WSS-SUB              VALUE 0             PIC 9(03).
           03 WSS-NUM-RRH3         VALUE 0             PIC 9(07).
           03 WSS-NUM-OPCL         VALUE 0             PIC 9(07).
           03 WSS-NUM-OPCS         VALUE 0             PIC 9(07).
           03 WSS-NUM-OPCP         VALUE 0             PIC 9(07).
           03 WSS-NUM-OPCR         VALUE 0             PIC 9(07).
           03 WSS-NUM-DLCL         VALUE 0             PIC 9(07).
           03 WSS-NUM-DLCS         VALUE 0             PIC 9(07).
           03 WSS-NUM-DLCP         VALUE 0             PIC 9(07).
           03 WSS-NUM-D31G         VALUE 0             PIC 9(07).
           03 WSS-NUM-RD3G         VALUE 0             PIC 9(07).
           03 WSS-NUM-C31L         VALUE 0             PIC 9(07).
           03 WSS-NUM-C31P         VALUE 0             PIC 9(07).

       01  WSS-VEC.
           03 WSS-ELE-OFIC   OCCURS 200   INDEXED BY   WSS-NUM-OFIC.
              05 WSS-COD-OFIC                          PIC X(03).

       01  WSS-MAT.
           03 WSS-ELE OCCURS 200.
              05 WSS-CONT                           PIC 9(06).
              05 WSS-KEYS.
                 07 WSS-TOPE                        PIC 9(04).
                 07 WSS-PLZO                        PIC 9(02).
                 07 WSS-TTAS.
                    09  WSS-TTD1                    PIC 9(01).
                    09  WSS-TTD2                    PIC 9(01).
                    09  WSS-TTD3                    PIC 9(01).
                 07 WSS-VCOC                        PIC 9(03).
              05 WSS-MONT                           PIC 9(14).
              05 WSS-PPON                           PIC 9(14)V9(04).
              05 WSS-SPON                           PIC 9(14)V9(04).
              05 WSS-TMAX                           PIC 9(03)V9(02).
              05 WSS-SMAX                           PIC 9(03)V9(02).
              05 WSS-TMIN                           PIC 9(03)V9(02).
              05 WSS-SMIN                           PIC 9(03)V9(02).
              05 WSS-TPPO                           PIC 9(03)V9(02).
              05 WSS-SPPO                           PIC 9(03)V9(02).
       COPY GNSWGRPT.
       COPY GNSWGGRC.

       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'COLPGD31' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.

      * Captura Fecha de Proceso
           DISPLAY 'INGRESE FECHA DEL INFORME (DDMMSSAA) / CLASES'.
           ACCEPT  WSS-GLS-PARA IN WSS-VARI.
           DISPLAY WSS-GLS-PARA IN WSS-VARI.
      * CAPTURA CLASES
           DISPLAY 'CLASES'.
           ACCEPT  WSS-GLS-PARA1 IN WSS-VARI.
           DISPLAY WSS-GLS-PARA1 IN WSS-VARI.
      * Captura Codigo de Oficina
           DISPLAY 'OFICINA (RM=REGION METROPOLITANA/*=BANCO): '.
           ACCEPT  WSS-COD-OFOC IN WSS-VARI.
           DISPLAY WSS-COD-OFOC IN WSS-VARI.
      * Captura Codigo de Oficina
      *     DISPLAY 'GRABA REGISTRO CABECERA (S/*) : '.
      *     ACCEPT  WSS-COD-GCAB IN WSS-VARI.
      *     DISPLAY WSS-COD-GCAB IN WSS-VARI.
      * CAPTURA INDICADOR DE VALIDACION TMC
           DISPLAY 'INDICADOR VALIDA TMC A F INGRESO  S/N  : '.
           ACCEPT  WSS-IND-VTMC IN WSS-VARI.
           DISPLAY WSS-IND-VTMC IN WSS-VARI.
           DISPLAY 'FIN    CAPTURA DE PARAMETROS'.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.
           IF NOT ( WSS-IND-VTMC IN WSS-VARI = 'S' OR
                    WSS-IND-VTMC IN WSS-VARI = 'N' )
               DISPLAY 'INDICADOR DE VALIDACION TMC DEBE SER S / N  :'
               PERFORM GNS-PRO-ABT.
      *VAL-FEC Valida Fecha de Informe
           DISPLAY 'FECHA DEL INFORME : ' WSS-FEC-FINF IN WSS-VARI.
           MOVE WSS-FEC-FINF IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-ABT.

           MOVE WSS-NUM-DINF IN WSS-VARI TO WSS-NUM-DIN1 IN WSS-VARI.
           MOVE WSS-NUM-MINF IN WSS-VARI TO WSS-NUM-MIN1 IN WSS-VARI.
           MOVE WSS-NUM-SINF IN WSS-VARI TO WSS-NUM-SIN1 IN WSS-VARI.
           MOVE WSS-NUM-AINF IN WSS-VARI TO WSS-NUM-AIN1 IN WSS-VARI.


           MOVE WSS-NUM-DIN1 IN WSS-VARI TO WSS-NUM-DREF IN WSS-VARI.
           MOVE WSS-NUM-MIN1 IN WSS-VARI TO WSS-NUM-MREF IN WSS-VARI.
           MOVE WSS-NUM-SIN1 IN WSS-VARI TO WSS-NUM-SREF IN WSS-VARI.
           MOVE WSS-NUM-AIN1 IN WSS-VARI TO WSS-NUM-AREF IN WSS-VARI.
      *VAL-OFI Valida codigo de Oficina en TABLAS
           IF WSS-COD-OFOC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-OFOC IN WSS-VARI.
           IF WSS-COD-OFOC IN WSS-VARI = 'RM'
               NEXT SENTENCE
           ELSE
           IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
               DISPLAY 'OFICINA : ' WSS-COD-OFOC IN WSS-VARI
               MOVE WSS-COD-OFOC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   PERFORM GNS-PRO-ABT.

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.

      * Obtiene el Codigo Valor de Cambio de Pesos mediante el CIC de la
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB IN TAB
               PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS-VARI.

      * Obtiene el Codigo Valor de Cambio de la UF mediante el CIC de la
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0998  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0998  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB IN TAB
               PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-UEFE IN WSS-VARI.

           MOVE 'COL'          TO TAB-COD-SIST FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'BCICUR DPTMC' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB
           IF FIO-STAT-OKS AND
              TAB-IND-VIGE IN TAB = 'S'
               MOVE 'S' TO WSS-IND-TXC
           ELSE
               MOVE 'N' TO WSS-IND-TXC.
           IF WSS-IND-TXC = 'S'
               GO TO CON-OBT-TMC.
      * Obtiene Tasa Maxima Convencional para Pesos a Menos de 90 Dias
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE 'TB90'                   TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTE TASA MAXIMA CONV. A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI        ' PARA LA TB90'
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
               DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI    ' PARA LA TB90'
               PERFORM GNS-PRO-ABT
           ELSE
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TB90 IN WSS-VARI.

      * Obtiene Tasa Maxima Convencional para Pesos a Mas de 90 Dias
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE 'TS90'                   TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTE TASA MAXIMA CONV. A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI        ' PARA LA TS90'
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
               DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI    ' PARA LA TS90'
               PERFORM GNS-PRO-ABT
           ELSE
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TS90 IN WSS-VARI.

      * Obtiene Tasa Maxima Convencional para Moneda Reajustable
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).
           MOVE WSS-COD-UEFE IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE 'TMXC'                   TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTE TASA MAXIMA CONV. A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI        ' PARA LA TREA'
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
               DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI    ' PARA LA TREA'
               PERFORM GNS-PRO-ABT
           ELSE
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TREA IN WSS-VARI.

       CON-OBT-TMC.
       INI-GET-OFI.
           IF WSS-COD-OFOC IN WSS-VARI NOT = 'RM'
                GO TO FIN-GET-OFI.
           MOVE ZEROES      TO WSS-OFIC.
           MOVE FIO-GET-FST TO FIO-CMND.
       LUP-GET-OFI.
           PERFORM TAB-FIO-OFI.
           IF NOT FIO-STAT-OKS
               GO TO FIN-GET-OFI.
           MOVE OFI-COD-COMU IN OFI TO COM-COD-COMU IN COM.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM TAB-FIO-COM.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE 'CODCOMUNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC
               GO TO NXT-GET-OFI.
           IF COM-COD-REGI IN COM = '13'
               ADD 1 TO WSS-OFIC
               MOVE OFI-COD-OFIC TO WSS-COD-OFIC(WSS-OFIC).
       NXT-GET-OFI.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-GET-OFI.
       FIN-GET-OFI.

      * Proceso para Cargar las tablas  TAB/TIO  y  COL/TOC  en Memoria
           PERFORM COL-CRG-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
               PERFORM GNS-PRO-ABT.
      * Apertura de Registros
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           PERFORM COL-FIO-DLC.
           PERFORM COL-FIO-ICG.

      *COMENTARIO DEBE HABER UNA MANERA MAS INTELIGENTE PARA ESTO
           OPEN OUTPUT RPTD31.

            MOVE FIO-OUT TO FIO-CMND.
            PERFORM SUP-FIO-D31.
            IF NOT FIO-STAT-OKS
                DISPLAY 'ERROR FIO-OUT D31, FIO-STAT : ' FIO-STAT
                PERFORM GNS-PRO-ABT.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM SUP-FIO-C31.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR FIO-INP C31, FIO-STAT : ' FIO-STAT
               PERFORM GNS-PRO-ABT.

           MOVE FIO-OUT TO FIO-CMND.
           PERFORM COL-FIO-RD3.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR FIO-OUT RD3, FIO-STAT : ' FIO-STAT
               PERFORM GNS-PRO-ABT.

           MOVE FIO-OUT TO FIO-CMND.
           PERFORM COL-FIO-RH3.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR FIO-OUT RH3, FIO-STAT : ' FIO-STAT
               PERFORM GNS-PRO-ABT.

      * Primera Lectura de Operacion de Credito por Llave Alternativa
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO OPC-FEC-FINP IN OPC.
           MOVE 'OPC-FEC-FINP' TO FIO-AKEY.
           MOVE FIO-GET-FST    TO FIO-CMND.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS OR
              OPC-FEC-FINP IN OPC NOT = WSS-FEC-FIN1 IN WSS-VARI
               DISPLAY 'NO HAY REGISTROS PARA FECHA DE INFORME : '
                       WSS-FEC-FINF IN WSS-VARI
               GO TO FIN-MAIN.

      * Inicializa Tabla de Totales acumulados para grabar D31
           MOVE ZEROES TO WSS-MAT.
       LUP-MAIN.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
      ******************************************************************
      * Proceso de Seleccion y Clasificacion a Partir del Registro OPC
           ADD   1  TO WSS-NUM-OPCL IN WSS-VARI.

      * Seleccion de los Registros OPC Leidos para ser Procesados
           PERFORM SEL-REG-PRO.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO NXT-MAIN.
           ADD 1 TO WSS-NUM-OPCS IN WSS-VARI.

      * Lectura de la DLC para obtener el PLAZO del Credito
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF ( FIO-STAT-OKS AND
                    DLC-CIC-IOPC IN DLC = OPC-CIC-IOPC IN OPC AND
                  ( DLC-IND-SCTB IN DLC = SPACES OR
      * A PETICION DE BCI
                    DLC-IND-SCTB IN DLC = 'MUL' ) AND
                    DLC-IND-SCRT IN DLC = SPACES AND
                    DLC-IND-SCBZ IN DLC = SPACES )
                 GO TO LUP-DLC
           ELSE
               DISPLAY 'OPC RECHAZADA : ' OPC-CIC-IOPC IN OPC
               DISPLAY 'DLC-CIC-IOPC  : ' DLC-CIC-IOPC IN DLC
               DISPLAY 'FS            : ' FIO-STAT
               DISPLAY 'TIPO DE OPER  : ' OPC-COD-TOOC IN OPC
               DISPLAY 'MONEDA        : ' OPC-COD-VCOC IN OPC
               IF FIO-STAT-OKS
                   DISPLAY 'DLC-IND-SCTB : ' DLC-IND-SCTB IN DLC
                   DISPLAY 'DLC-IND-SCRT : ' DLC-IND-SCRT IN DLC
                   DISPLAY 'DLC-IND-SCBZ : ' DLC-IND-SCBZ IN DLC
                   DISPLAY ' '
                   ADD 1 TO WSS-NUM-OPCR IN WSS-VARI
                   GO TO NXT-MAIN
               ELSE
                   DISPLAY 'DLC NO EXISTE : ' OPC-CIC-IOPC IN OPC
                   DISPLAY 'FS : ' FIO-STAT
                   DISPLAY ' '
                   ADD 1 TO WSS-NUM-OPCR IN WSS-VARI
                   GO TO NXT-MAIN.
       LUP-DLC.
           ADD  1  TO WSS-NUM-DLCL IN WSS-VARI.

      * Lectura de DCC para Obtener el Indicador Exclusion del Credito
           PERFORM BUS-DCC.
           IF DCC-GLS-DISP IN DCC = 'X'
               GO TO NXT-GET-DLC.

      * Determina tipo de operacion
           MOVE DCC-GLS-CCSB IN DCC      TO WSS-GLS-CCSB IN WSS-VARI.
           MOVE WSS-CAI-CCSB IN WSS-VARI TO WSS-TOPE-D31 IN WSS-VARI.

           MOVE 'COL'                    TO TAB-COD-SIST FIO-SIST.
           MOVE 'D31'                    TO TAB-COD-TTAB IN TAB.
           MOVE WSS-TOPE-D31 IN WSS-VARI TO WSS-COD-CTAB-TOPE.
           MOVE SPACES                   TO WSS-COD-CTAB-TOPE-F.
           MOVE WSS-COD-CTAB             TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB
           IF NOT ( FIO-STAT-OKS AND
              TAB-IND-VIGE IN TAB = 'S' )
               GO TO NXT-GET-DLC.


      *Determina plazo
           PERFORM CAL-PLZO-D31.
           MOVE WSS-COD-TRAMO IN WSS-VARI TO WSS-PLZO-D31 IN WSS-VARI.


      *Determina Tipo de Tasa
      * Lectura de la ICG para obtener la Tasa de Interes del Credito
           IF WSS-OPEC NOT = 'D'
               PERFORM GET-ICG-OPC
           ELSE
               PERFORM GET-ICG-DLC
               IF NOT FIO-STAT-OKS
                   PERFORM GET-ICG-OPC.

           IF FIO-STAT-OKS
               MOVE ICG-COD-TINT IN ICG TO INT-TIPT
               MOVE ICG-SGV-SPRD IN ICG TO WSS-VAL-SPRD
               MOVE ICG-SGV-TINT IN ICG TO WSS-VAL-TASA
           ELSE
               MOVE SPACES       TO INT-TIPT
               MOVE ZEROES       TO WSS-VAL-SPRD
               MOVE ZEROES       TO WSS-VAL-TASA
               DISPLAY 'REGISTRO OPC NO TIENE INTERESES ' OPC-KEY-IOPC.

           IF ICG-COD-CVTI IN ICG > SPACES
               MOVE 2 TO WSS-TTAS-1D31 IN WSS-VARI
               PERFORM DET-DIG-TRES-V
               MOVE WSS-DIG-TRES TO WSS-TTAS-3D31
               IF ICG-COD-CVTI IN ICG = 'TAB' OR
                  ICG-COD-CVTI IN ICG = 'TBA' OR
                  ICG-COD-CVTI IN ICG = 'TBS' OR
                  ICG-COD-CVTI IN ICG = 'TBT'
                   MOVE 1 TO WSS-TTAS-2D31 IN WSS-VARI
               ELSE
               IF ICG-COD-CVTI IN ICG = 'TIP'
                   MOVE 2 TO WSS-TTAS-2D31 IN WSS-VARI
               ELSE
               IF ICG-COD-CVTI IN ICG = 'LIB'
                   MOVE 3 TO WSS-TTAS-2D31 IN WSS-VARI
               ELSE
               IF ICG-COD-CVTI IN ICG = 'PRI' OR
                  ICG-COD-CVTI IN ICG = 'PRA' OR
                  ICG-COD-CVTI IN ICG = 'PRB' OR
                  ICG-COD-CVTI IN ICG = 'PRC' OR
                  ICG-COD-CVTI IN ICG = 'PRD'
                   MOVE 4 TO WSS-TTAS-2D31 IN WSS-VARI
               ELSE
                   MOVE 9 TO WSS-TTAS-2D31 IN WSS-VARI
           ELSE
               PERFORM DET-DIG-TRES-F
               MOVE WSS-DIG-TRES TO WSS-TTAS-3D31
               MOVE 0 TO WSS-TTAS-2D31 IN WSS-VARI
               MOVE 1 TO WSS-TTAS-1D31 IN WSS-VARI.

      * Determina moneda
           MOVE 'TAB'               TO FIO-SIST.
           MOVE 'VLR'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB IN TAB
               PERFORM GNS-PRO-ABT.

           MOVE TAB TO VLR.

           MOVE VLR-GLS-SBCC IN VLR TO WSS-VCOC-D31 IN WSS-VARI.
      *

      * Determinacion del Tramo para Distribuir Registro Seleccionado
           PERFORM DET-TRA-REG-PROC.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO NXT-GET-DLC.

           MOVE WSS-KEY-D31  TO WSS-KEYS IN WSS-ELE(WSS-IND).

      * Proceso para obtener la Tasa de Interes del Credito
           PERFORM DET-TASA-CRED.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO NXT-GET-DLC.

           IF RD3-IND-ERRO IN RD3 = '*'
               MOVE SPACES TO RH3
               ADD 1 TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'TEQV<4OR0,5'            TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-GET-DLC.

           IF RD3-IND-ERRO IN RD3 = '+'
               MOVE SPACES TO RH3
               ADD 1 TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'TEQV>TMCFINP'           TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-GET-DLC.


           ADD  1  TO WSS-NUM-DLCS IN WSS-VARI.

      * Seleccion de Oficina de Operacion SOLO de Region Metropolitana
           IF WSS-COD-OFOC IN WSS-VARI = '*'
               MOVE 'S' TO WSS-COD-RMTP
           ELSE
               IF WSS-COD-OFOC IN WSS-VARI NOT = 'RM'
                   IF WSS-COD-OFOC NOT = OPC-COD-OFOC IN OPC
                       MOVE 'N' TO WSS-COD-RMTP
                   ELSE
                       MOVE 'S' TO WSS-COD-RMTP.
           IF WSS-COD-OFOC IN WSS-VARI = 'RM'
               MOVE  1  TO WSS-NUM-IOFI
               SET WSS-NUM-OFIC TO 1
               SEARCH WSS-ELE-OFIC VARYING WSS-NUM-IOFI
                      AT END MOVE 'N' TO WSS-COD-RMTP
                  WHEN WSS-COD-OFIC(WSS-NUM-OFIC) = OPC-COD-OFOC IN OPC
                             MOVE 'S' TO WSS-COD-RMTP.
           IF WSS-COD-RMTP IN WSS-VARI = 'N'
               GO TO NXT-GET-DLC.
      * Determinacion de las TASAS EXTREMAS Minima y Maxima
           ADD 1  TO WSS-CONT(WSS-IND).
           IF WSS-CONT(WSS-IND) = 1
               MOVE WSS-VAL-TEQV IN WSS-VARI TO
                    WSS-TMIN IN WSS-ELE(WSS-IND)
           ELSE
           IF WSS-VAL-TEQV IN WSS-VARI < WSS-TMIN IN WSS-ELE(WSS-IND)
               MOVE WSS-VAL-TEQV IN WSS-VARI TO
                    WSS-TMIN IN WSS-ELE(WSS-IND).

           IF WSS-VAL-TEQV IN WSS-VARI > WSS-TMAX IN WSS-ELE(WSS-IND)
               MOVE WSS-VAL-TEQV IN WSS-VARI TO
                    WSS-TMAX IN WSS-ELE(WSS-IND).

           IF WSS-TTAS-1D31 IN WSS-VARI = 1
              GO TO SOLO-RM-1.

           IF WSS-CONT(WSS-IND) = 1
               MOVE WSS-VAL-SPRD IN WSS-VARI TO
                    WSS-SMIN IN WSS-ELE(WSS-IND)
           ELSE
           IF WSS-VAL-SPRD IN WSS-VARI < WSS-SMIN IN WSS-ELE(WSS-IND)
               MOVE WSS-VAL-SPRD IN WSS-VARI TO
                    WSS-SMIN IN WSS-ELE(WSS-IND).

           IF WSS-VAL-SPRD IN WSS-VARI > WSS-SMAX IN WSS-ELE(WSS-IND)
               MOVE WSS-VAL-SPRD IN WSS-VARI TO
                    WSS-SMAX IN WSS-ELE(WSS-IND).


       SOLO-RM-1.

      * Obtiene Monto del Credito en Pesos a Fecha Informe
           IF OPC-COD-VCOC IN OPC NOT = WSS-COD-PESO IN WSS-VARI
               PERFORM DET-VAL-CAMB-FINF
               IF WSS-IND-STAT IN WSS-VARI = 1
                   ADD 1 TO WSS-NUM-OPCR IN WSS-VARI
                   GO TO NXT-GET-DLC
               ELSE
                   MULTIPLY DLC-VAL-NDLC IN DLC      BY
                            WSS-SGV-FINF IN WSS-VARI GIVING
                            DLC-VAL-NDLC IN DLC.

           IF WSS-COD-RMTP IN WSS-VARI = 'N'
               GO TO SOLO-RM-2.

      * Acumulacion del Monto en $ de los Creditos Seleccionados
           ADD DLC-VAL-NDLC IN DLC TO WSS-MONT IN WSS-ELE(WSS-IND).

      * Determinacion y Calculo para el Promedio Ponderado
           MULTIPLY WSS-VAL-TEQV IN WSS-VARI BY
                    DLC-VAL-NDLC IN DLC      GIVING
                    WSS-VAL-PPON IN WSS-VARI.

           ADD WSS-VAL-PPON IN WSS-VARI TO
               WSS-PPON IN WSS-ELE(WSS-IND).

           IF WSS-TTAS-1D31 IN WSS-VARI = 2
               MULTIPLY WSS-VAL-SPRD IN WSS-VARI BY
                        DLC-VAL-NDLC IN DLC      GIVING
                        WSS-VAL-SPON IN WSS-VARI
               ADD WSS-VAL-SPON IN WSS-VARI TO
                     WSS-SPON IN WSS-ELE(WSS-IND).

       SOLO-RM-2.
           ADD  1  TO WSS-NUM-OPCP IN WSS-VARI.
           ADD  1  TO WSS-NUM-DLCP IN WSS-VARI.

      * Graba montos para Control de Proceso segun Codigos de Oficina,
      * Plazo, Clase y Moneda del Credito por DLC en registro RD3
           IF WSS-COD-RMTP IN WSS-VARI = 'S'
               MOVE DLC-VAL-NDLC IN DLC TO WSS-VAL-TRAM IN WSS-VARI
               PERFORM PUT-CTR-OPC-RD3.
       NXT-GET-DLC.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF ( FIO-STAT-OKS AND
                    DLC-CIC-IOPC IN DLC = OPC-CIC-IOPC IN OPC AND
                  ( DLC-IND-SCTB IN DLC = SPACES OR
      * A PETICION DE BCI
                    DLC-IND-SCTB IN DLC = 'MUL' ) AND
                    DLC-IND-SCRT IN DLC = SPACES AND
                    DLC-IND-SCBZ IN DLC = SPACES )
                 GO TO LUP-DLC
           ELSE
               GO TO NXT-MAIN.
      ******************************************************************
       NXT-MAIN.
      * Siguiente lectura de Operacion de Credito por Llave Alternativa
           MOVE 'OPC-FEC-FINP' TO FIO-AKEY.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF OPC-FEC-FINP IN OPC NOT = WSS-FEC-FIN1 IN WSS-VARI
               GO TO FIN-MAIN.
           GO TO LUP-MAIN.
       FIN-MAIN.
      * SE PROCESAN LOS REGISTROS ENVIADOS DESDE CUENTAS CORRIENTES
      * PARA COMPLETAR LA INFORMACION DEL SUPD03
           PERFORM PRO-C31.
      * Calculo Final por tramo del Promedio Ponderado
           PERFORM CAL-TAS-PPON VARYING WSS-SUB FROM 1 BY 1 UNTIL
                                        WSS-SUB > 199.

      * Graba registro de interfaz D31 con informacion generada
           PERFORM GEN-REG-CAB-D31.

           PERFORM GEN-REG-D31 VARYING WSS-SUB FROM 1 BY 1 UNTIL
                                       WSS-SUB > 199.

       EXT-MAIN.
      * Cierre de Registros
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           PERFORM COL-FIO-DLC.
           PERFORM COL-FIO-ICG.
           PERFORM COL-FIO-RD3.
           PERFORM COL-FIO-RH3.
           PERFORM SUP-FIO-D31.
           PERFORM SUP-FIO-C31.

      * Despliega Totales de Control Proceso
           DISPLAY 'TOTAL OPC LEIDOS             : '
                               WSS-NUM-OPCL IN WSS-VARI.
           DISPLAY 'TOTAL OPC SELECCIONADOS      : '
                               WSS-NUM-OPCS IN WSS-VARI.
           DISPLAY 'TOTAL OPC PARA PROCESO       : '
                               WSS-NUM-OPCP IN WSS-VARI.
           DISPLAY 'TOTAL OPC RECHAZADOS         : '
                               WSS-NUM-OPCR IN WSS-VARI.
           DISPLAY 'TOTAL DLC LEIDOS             : '
                               WSS-NUM-DLCL IN WSS-VARI.
           DISPLAY 'TOTAL DLC SELECCIONADOS      : '
                               WSS-NUM-DLCS IN WSS-VARI.
           DISPLAY 'TOTAL DLC PARA PROCESO       : '
                               WSS-NUM-DLCP IN WSS-VARI.
           DISPLAY 'TOTAL C31 LEIDOS             : '
                               WSS-NUM-C31L IN WSS-VARI.
           DISPLAY 'TOTAL C31 PROCESADOS         : '
                               WSS-NUM-C31P IN WSS-VARI.
           DISPLAY 'TOTAL D31 GRABADOS           : '
                               WSS-NUM-D31G IN WSS-VARI.
           DISPLAY 'TOTAL RD3 GRABADOS           : '
                               WSS-NUM-RD3G IN WSS-VARI.
           DISPLAY 'TOTAL RH3 GRABADOS           : '
                               WSS-NUM-RRH3 IN WSS-VARI.
      * Termino del Proceso
           MOVE ZEROES TO WSS-VAL-MACT.
           MOVE ZEROES TO WSS-VAL-MPAS.

           PERFORM DIS-TOT-POR-TIPO VARYING WSS-SUB FROM 1 BY 1 UNTIL
                                       WSS-SUB > 199.
           MOVE '016'                            TO WSS-COD-BNCO
                                                     IN WSS-D31.
           MOVE 'BANCO DE CREDITO E INVERSIONES' TO WSS-GLS-BNCO.
           MOVE  WSS-NUM-D31G TO WSS-VAL-NUOP.
           IF WSS-NUM-MINF = 01
               MOVE 'ENERO' TO WSS-GLS-MESE
           ELSE
           IF WSS-NUM-MINF = 02
               MOVE 'FEBRERO' TO WSS-GLS-MESE
           ELSE
           IF WSS-NUM-MINF = 03
               MOVE 'MARZO' TO WSS-GLS-MESE
           ELSE
           IF WSS-NUM-MINF = 04
               MOVE 'ABRIL' TO WSS-GLS-MESE
           ELSE
           IF WSS-NUM-MINF = 05
               MOVE 'MAYO' TO WSS-GLS-MESE
           ELSE
           IF WSS-NUM-MINF = 06
               MOVE 'JUNIO' TO WSS-GLS-MESE
           ELSE
           IF WSS-NUM-MINF = 07
               MOVE 'JULIO' TO WSS-GLS-MESE
           ELSE
           IF WSS-NUM-MINF = 08
               MOVE 'AGOSTO' TO WSS-GLS-MESE
           ELSE
           IF WSS-NUM-MINF = 09
               MOVE 'SEPTIEMBRE' TO WSS-GLS-MESE
           ELSE
           IF WSS-NUM-MINF = 10
               MOVE 'OCTUBRE' TO WSS-GLS-MESE
           ELSE
           IF WSS-NUM-MINF = 11
               MOVE 'NOVIEMBRE' TO WSS-GLS-MESE
           ELSE
           IF WSS-NUM-MINF = 12
               MOVE 'DICIEMBRE' TO WSS-GLS-MESE.

           PERFORM PRO-DL-D31.

           CLOSE RPTD31.

           PERFORM GNS-PRO-END.

      *<<<< EOF
      ******************************************************************
      * Seleccion del Registro OPC Leido para ser Procesado
       SEL-REG-PRO SECTION.
       INI-SEL-REG-PRO.
           MOVE  1  TO WSS-IND-STAT IN WSS-VARI.

      * Seleccion de Operacion de Credito con Estado 'ACA'
           IF OPC-MSC-STAT IN OPC NOT = 'A'
               GO TO FIN-SEL-REG-PRO.

      * Se omite la Operacion de Credito en Moneda Extranjera
           IF OPC-MSC-TVOC IN OPC = '1'
               GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP1 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP1 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP2 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP2 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP3 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP3 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP4 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP4 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP5 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP5 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP6 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP6 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP7 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP7 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP8 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP8 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP9 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP9 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP10 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP10 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP11 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP11 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP12 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP12 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP13 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP13 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP14 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP14 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP15 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP15 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP16 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP16 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP17 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP17 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP18 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP18 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP19 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP19 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP20 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP20 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

      * Busca con el Codigo Tipo Operacion en la Tabla cargada en Memori
      * 'Sistema que lo Maneja' y 'Opera Como'
           MOVE OPC-COD-TOOC IN OPC TO CTO-TOOC IN CTO-VARI.
           PERFORM COL-BUS-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
                       'CON CODIGO : '     CTO-TOOC IN CTO-VARI
                       ' EN CREDITO : '    OPC-CIC-IOPC IN OPC
               GO TO FIN-SEL-REG-PRO.

      * Valida el 'Sistema que lo Maneja' de la Operacion de Credito sea
      * COL - CES - TCR - SCC - SGE
           IF NOT ( CTO-SIST IN CTO-VARI = 'COL' )
               GO TO FIN-SEL-REG-PRO.

      * Valida el 'Opera Como' de la Operacion de Credito omite Hipoteca
      * Tarjeta Visa y Boleta Garantia
           IF CTO-OPEC IN CTO-VARI = 'H' OR
              CTO-OPEC IN CTO-VARI = 'B'
               GO TO FIN-SEL-REG-PRO.

      * Obtiene 'Opera Como'
           MOVE SPACES               TO TOC.
           MOVE CTO-OPEC IN CTO-VARI TO WSS-OPEC IN WSS-VARI.

           MOVE  0  TO WSS-IND-STAT IN WSS-VARI.
       FIN-SEL-REG-PRO.
           EXIT.
      *-----------------------------------------------------------------
      * Busca hasta el 5 dia Habil
       BUS-DIA5-HBL SECTION.
       INI-BUS-DIA5-HBL.
           MOVE  0  TO WSS-HBL-DIAS IN WSS-VARI.
           MOVE OPC-NUM-DCOL IN OPC TO FEC-ITM1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-ITM2.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-ITM3.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-ITM4.
       LUP-BUS-DIA5-HBL.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-SIG-HBL  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF FEC-STAT-FER
               GO TO LUP-BUS-DIA5-HBL
           ELSE
           IF FEC-STAT-OKS
               ADD 1 TO WSS-HBL-DIAS IN WSS-VARI
      *A PETICION DEL BCI
      *        IF WSS-HBL-DIAS IN WSS-VARI > 5
               IF WSS-HBL-DIAS IN WSS-VARI > 22
                   MOVE FEC-ITM1 TO WSS-NUM-DHBL IN WSS-VARI
                   MOVE FEC-ITM2 TO WSS-NUM-MHBL IN WSS-VARI
                   MOVE FEC-ITM3 TO WSS-NUM-SHBL IN WSS-VARI
                   MOVE FEC-ITM4 TO WSS-NUM-AHBL IN WSS-VARI
               ELSE
               GO TO LUP-BUS-DIA5-HBL.
       FIN-BUS-DIA5-HBL.
           EXIT.
      ******************************************************************
      * Lectura de DCC para Obtener el Indicador Exclusion del Credito
      * con Llave COD-CCTB Formada
       BUS-DCC SECTION.
       INI-BUS-DCC.
      * Forma Llave COD-CCTB para Leer DCC
      * Con BUS-TAB Busca Estado de IND-PCTB de Tabla AUX para Completar
           MOVE 'CAP'               TO DCC-MSC-TCCT IN DCC.
           MOVE OPC-COD-VCOC IN OPC TO DCC-COD-VCAM IN DCC.
           MOVE OPC-COD-COOC IN OPC TO DCC-COD-COCR IN DCC.
           MOVE DLC-COD-PLZO IN DLC TO DCC-COD-PLZO IN DCC.
           MOVE SPACES              TO DCC-IND-SCRT IN DCC.
           MOVE SPACES              TO DCC-IND-SCTB IN DCC.
           MOVE SPACES              TO DCC-IND-SCBZ IN DCC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM COL-FIO-DCC.
           IF NOT FIO-STAT-OKS
               MOVE 'X'          TO DCC-GLS-DISP IN DCC
               MOVE 'GNS'        TO MSG-COD-SIST
               MOVE 'COD    NEX' TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC ' : ' DCC-COD-TABL IN DCC
               GO TO FIN-BUS-DCC.
           MOVE SPACES TO DCC-GLS-DISP IN DCC.
       FIN-BUS-DCC.
           EXIT.
      ******************************************************************
      * Determinacion del Tramo para Distribuir Registro Seleccionado
       DET-TRA-REG-PROC SECTION.
       INI-DET-TRA-REG-PROC.
           MOVE 1 TO WSS-IND      IN WSS-VARI.
           MOVE 0 TO WSS-IND-STAT IN WSS-VARI.

       LUP-DET-TRA-REG-PROC.

           IF WSS-TOPE IN WSS-ELE(WSS-IND) = ZEROES
               GO TO FIN-DET-TRA-REG-PROC.

           IF WSS-KEY-D31 IN WSS-VARI = WSS-KEYS IN WSS-ELE(WSS-IND)
               GO TO FIN-DET-TRA-REG-PROC.

           ADD 1 TO WSS-IND IN WSS-VARI.

           IF WSS-IND IN WSS-VARI > 200
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'MATRIZ OVERFLOW ( 200 ) '
               PERFORM GNS-PRO-ABT
               GO TO FIN-DET-TRA-REG-PROC.

           GO TO LUP-DET-TRA-REG-PROC.

       FIN-DET-TRA-REG-PROC.
           EXIT.
      ******************************************************************
      * Proceso para obtener la Tasa de Interes del Credito
       DET-TASA-CRED SECTION.
       INI-DET-TASA-CRED.
           MOVE  0  TO WSS-IND-STAT IN WSS-VARI.
      * Proceso para obtener la Tasa de Interes a Fecha de Colocacion
           IF WSS-IND-TEQV IN WSS-VARI = 0
               IF INT-CVTI NOT > SPACES
                    MOVE ICG-SGV-TINT IN ICG TO WSS-VAL-TEQV IN WSS-VARI
               ELSE
                   MOVE ICG-SGV-SPRD IN ICG TO INT-TINT
                   PERFORM OBT-TASA-VAR
                   IF WSS-IND-STAT IN WSS-VARI = 1
                       GO TO FIN-DET-TASA-CRED
                   ELSE
                       MOVE INT-TIPE TO WSS-VAL-TEQV IN WSS-VARI.

      * Obtiene Tasa Maxima Convencional del Credito a Fecha de Colocaci
           IF WSS-IND-TXC = 'S'
               PERFORM OBT-TASA-TXC
               IF WSS-IND-STAT IN WSS-VARI = 1
                   GO TO FIN-DET-TASA-CRED
               ELSE
                   NEXT SENTENCE
           ELSE
           PERFORM OBT-TASA-TMC.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO FIN-DET-TASA-CRED
           ELSE
               IF WSS-IND-VTMC IN WSS-VARI = 'S'
                   IF WSS-VAL-TEQV IN WSS-VARI >
                      WSS-VAL-TMCC IN WSS-VARI
                       MOVE '+'    TO RD3-IND-ERRO IN RD3
                       GO TO FIN-DET-TASA-CRED
                   ELSE
                       IF WSS-VAL-TEQV IN WSS-VARI >
                          WSS-VAL-TMXC IN WSS-VARI
                           MOVE WSS-VAL-TMXC IN WSS-VARI TO
                           WSS-VAL-TEQV IN WSS-VARI
                       ELSE
                           NEXT SENTENCE
               ELSE
               IF WSS-VAL-TEQV IN WSS-VARI > WSS-VAL-TMXC IN WSS-VARI
                   MOVE WSS-VAL-TMXC IN WSS-VARI TO
                        WSS-VAL-TEQV IN WSS-VARI.
      *A PETICION DE BCI
           IF OPC-COD-VCOC IN OPC = '0998'
               IF (ICG-MSC-PBTI IN ICG = 'X' OR
                   ICG-MSC-PBTI IN ICG = 'A' )
                    NEXT SENTENCE
               ELSE
                  MULTIPLY WSS-VAL-TEQV IN WSS-VARI BY 12
                      GIVING WSS-VAL-TEQV IN WSS-VARI.

           IF OPC-COD-VCOC IN OPC = '0999'
               IF ICG-MSC-PBTI IN ICG = 'X' OR 'A'
                  DIVIDE WSS-VAL-TEQV IN WSS-VARI BY 12
                      GIVING WSS-VAL-TEQV IN WSS-VARI.

      *
           IF OPC-COD-VCOC IN OPC = '0998'
               IF WSS-VAL-TEQV IN WSS-VARI < 4
                   MOVE '*'    TO RD3-IND-ERRO IN RD3
               ELSE
                   MOVE SPACES TO RD3-IND-ERRO IN RD3.

           IF OPC-COD-VCOC IN OPC = '0999'
              IF WSS-VAL-TEQV IN WSS-VARI < 0,5
                  MOVE '*'    TO RD3-IND-ERRO IN RD3
              ELSE
                  MOVE SPACES TO RD3-IND-ERRO IN RD3.

       FIN-DET-TASA-CRED.
           EXIT.
      ******************************************************************
      * Lectura de la ICG para obtener la Tasa de Interes del Credito
       GET-ICG-OPC SECTION.
       INI-GET-ICG-OPC.
           MOVE OPC-CIC-IOPC IN OPC TO ICG-CIC-IOPC IN ICG.
           MOVE ZEROES              TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE 'INT'               TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF NOT ( FIO-STAT-OKS AND
                    ICG-CIC-IOPC IN ICG = OPC-CIC-IOPC IN OPC AND
                    ICG-NUM-ICAN IN ICG = ZEROES              AND
                    ICG-CIC-IOPV IN ICG = SPACES              AND
                    ICG-NUM-IVCT IN ICG = ZEROES              AND
                    ICG-IND-TTAS IN ICG = 'INT' )
                     MOVE '23' TO FIO-STAT.
       FIN-GET-ICG-OPC.
           EXIT.
      *-----------------------------------------------------------------
      * Lectura de la ICG para obtener la Tasa de Interes del Documento
       GET-ICG-DLC SECTION.
       INI-GET-ICG-DLC.
           MOVE DLC-CIC-IOPC IN DLC TO ICG-CIC-IOPC IN ICG.
           MOVE DLC-NUM-IDLC IN DLC TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE 'INT'               TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF NOT ( FIO-STAT-OKS AND
                    ICG-CIC-IOPC IN ICG = DLC-CIC-IOPC IN DLC AND
                    ICG-NUM-ICAN IN ICG = DLC-NUM-IDLC IN DLC AND
                    ICG-CIC-IOPV IN ICG = SPACES              AND
                    ICG-NUM-IVCT IN ICG = ZEROES              AND
                    ICG-IND-TTAS IN ICG = 'INT' )
                     PERFORM GET-ICG-OPC.
       FIN-GET-ICG-DLC.
           EXIT.

      *-----------------------------------------------------------------
      * Obtiene la Tasa Base a Fecha de Colocacion del Credito y luego
      * se compone la Tasa del Credito Variable
       OBT-TASA-VAR SECTION.
       INI-OBT-TASA-VAR.
           MOVE INT-TINT TO INT-TIPE.
           MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(1).
           MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(2).
           MOVE 'I'                 TO CAM-MSC-TVAL IN CAM(1).
           MOVE INT-CVTI            TO CAM-COD-CVAL IN CAM(1).
           MOVE INT-PBTI            TO CAM-COD-TCAM IN CAM(1).
           MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CAMBTSANXABT' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC ' : ' CAM-KEY-CAMB IN CAM
           ELSE
           IF CAM-MSC-STAT IN CAM NOT = 'S'
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CAMBTSANVABT' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC ' : ' CAM-KEY-CAMB IN CAM
           ELSE
               ADD CAM-SGV-VCAM IN CAM TO INT-TIPE.
       FIN-OBT-TASA-VAR.
           EXIT.
      *-----------------------------------------------------------------
      * Obtiene Tasa Maxima Convencional del Credito a Fecha de Colocaci
       OBT-TASA-TMC SECTION.
       INI-OBT-TASA-TMC.
           IF WSS-FEC-FIN1 IN WSS-VARI = OPC-FEC-FCOL IN OPC
               IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS-VARI
                   IF DLC-COD-PLZO IN DLC = 'C1' OR 'C2'
                       MOVE WSS-VAL-TB90 IN WSS-VARI TO
                            WSS-VAL-TMXC IN WSS-VARI
                   ELSE
                       MOVE WSS-VAL-TS90 IN WSS-VARI TO
                            WSS-VAL-TMXC IN WSS-VARI
               ELSE
               IF OPC-COD-VCOC IN OPC = WSS-COD-UEFE IN WSS-VARI
                   MOVE WSS-VAL-TREA IN WSS-VARI TO
                        WSS-VAL-TMXC IN WSS-VARI
               ELSE
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'MONEDA NO CLASIFICADA FP: ' OPC-COD-VCOC IN OPC
               GO TO FIN-OBT-TASA-TMC
           ELSE
               IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS-VARI
                   MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
                   IF DLC-COD-PLZO IN DLC = 'C1' OR 'C2'
                       MOVE 'TB90' TO CAM-COD-VCAM IN CAM(2)
                   ELSE
                       MOVE 'TS90' TO CAM-COD-VCAM IN CAM(2)
               ELSE
               IF OPC-COD-VCOC IN OPC = WSS-COD-UEFE IN WSS-VARI
                   MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
                   MOVE 'TMXC'              TO CAM-COD-VCAM IN CAM(2)
               ELSE
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'MONEDA NO CLASIFICADA FC: ' OPC-COD-VCOC IN OPC
               GO TO FIN-OBT-TASA-TMC.

           IF WSS-FEC-FIN1 IN WSS-VARI = OPC-FEC-FCOL IN OPC
               GO TO EXT-OBT-TASA-TMC.

           MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(1).
           MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'NO EXISTE TASA MAXIMA CONV. A FECHA CURSE : '
                        OPC-FEC-FCOL IN OPC               ' PARA LA '
                        CAM-COD-VCAM IN CAM(2)
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA CURSE : '
                        OPC-FEC-FCOL IN OPC               ' PARA LA '
                        CAM-COD-VCAM IN CAM(2)
               PERFORM GNS-PRO-ABT
           ELSE
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMXC IN WSS-VARI.
       EXT-OBT-TASA-TMC.
           IF WSS-IND-VTMC IN WSS-VARI NOT = 'S'
               GO TO FIN-OBT-TASA-TMC.
           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS-VARI
               MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
               IF DLC-COD-PLZO IN DLC = 'C1' OR 'C2'
                   MOVE 'TB90' TO CAM-COD-VCAM IN CAM(2)
               ELSE
                   MOVE 'TS90' TO CAM-COD-VCAM IN CAM(2)
           ELSE
               IF OPC-COD-VCOC IN OPC = WSS-COD-UEFE IN WSS-VARI
                   MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
                   MOVE 'TMXC'              TO CAM-COD-VCAM IN CAM(2)
               ELSE
                   MOVE  1  TO WSS-IND-STAT IN WSS-VARI
                   DISPLAY 'NO CLASIFICADA FC: ' OPC-COD-VCOC IN OPC
                   GO TO FIN-OBT-TASA-TMC.
           MOVE OPC-FEC-FINP IN OPC TO CAM-FEC-FCAM IN CAM(1).
           MOVE OPC-FEC-FINP IN OPC TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'NO EXISTE TASA MAXIMA CONV. A F CUR (CMP) : '
                        OPC-FEC-FINP IN OPC               ' PARA LA '
                        CAM-COD-VCAM IN CAM(2)
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA CUR (CMP) : '
                        OPC-FEC-FINP IN OPC               ' PARA LA '
                        CAM-COD-VCAM IN CAM(2)
               PERFORM GNS-PRO-ABT
           ELSE
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC IN WSS-VARI.
           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO
               IF INT-PBTI = 'D'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 30
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
               IF INT-PBTI = 'M' OR 'T'
                   MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC
               ELSE
                   MULTIPLY CAM-SGV-VCAM IN CAM BY 12 GIVING
                            WSS-VAL-TMCC  ROUNDED
           ELSE
               IF INT-PBTI  = 'D'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 360
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
               IF INT-PBTI = 'M' OR 'T'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 12
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
                   MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC.
       FIN-OBT-TASA-TMC.
           EXIT.
      ******************************************************************
      * Obtiene Valor de Cambio de Credito en Pesos a Fecha Informe
       DET-VAL-CAMB-FINF SECTION.
       INI-DET-VAL-CAMB-FINF.
           MOVE  1  TO WSS-IND-STAT IN WSS-VARI.

           IF OPC-IND-RENO IN OPC = 'PRO'
               PERFORM PRO-PRO
               IF MSG-COD-MENS IN MSG > SPACES
                   GO TO FIN-DET-VAL-CAMB-FINF.

           IF OPC-IND-RENO IN OPC = 'PRO'
               MOVE WSS-FEC-FORI IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1)
               MOVE WSS-FEC-FORI IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2)
           ELSE
               MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(1)
               MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(2).
               MOVE OPC-COD-VCOC IN OPC      TO CAM-COD-VCAM IN CAM(1).
               MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
               MOVE FIO-GET-KEY TO FIO-CMND.
               PERFORM TAB-FIO-CAM.
               IF NOT FIO-STAT-OKS
                   DISPLAY 'NO EXISTE VALOR DE CAMBIO A FECHA'
                           ' FCOL    : '      OPC-FEC-FCOL IN OPC
                           ' PARA : '         OPC-COD-VCOC IN OPC
                           ' EN OPERACION : ' OPC-CIC-IOPC IN OPC
                   GO TO FIN-DET-VAL-CAMB-FINF
               ELSE
               IF CAM-IND-VIGE NOT = 'S'
                   DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA'
                           ' FCOL    : '      OPC-FEC-FCOL IN OPC
                           ' PARA : '         OPC-COD-VCOC IN OPC
                           ' EN OPERACION : ' OPC-CIC-IOPC IN OPC
                   GO TO FIN-DET-VAL-CAMB-FINF
               ELSE
                   MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-FINF IN WSS-VARI.

           MOVE  0  TO WSS-IND-STAT IN WSS-VARI.
       FIN-DET-VAL-CAMB-FINF.
           EXIT.
      ******************************************************************
      * Graba montos para Control de Proceso segun Codigos de Oficina,
      * Plazo, Clase y Moneda del Credito por DLC en registro RD3
       PUT-CTR-OPC-RD3 SECTION.
       INI-PUT-CTR-OPC-RD3.
           MOVE DLC-VAL-NDLC IN DLC TO WSS-VAL-NDLC IN WSS-VARI.
      *     DISPLAY 'OPC : ' OPC-CIC-IOPC IN OPC ' CL : '
      *       OPC-COD-COOC IN OPC 'MO : ' OPC-COD-VCOC IN OPC
      *       ' FC : ' OPC-FEC-FCOL IN OPC ' FI : ' OPC-FEC-FINP IN OPC
      *       ' PZ : ' DLC-COD-PLZO IN DLC
      *      ' MT : ' WSS-VAL-NDLC IN WSS-VARI.
           MOVE OPC-CAI-IOPC IN OPC      TO RD3-CAI-IOPC IN RD3.
           MOVE OPC-IIC-IOPC IN OPC      TO RD3-IIC-IOPC IN RD3.
           MOVE WSS-IND IN WSS-VARI      TO RD3-NUM-LINE IN RD3.
           MOVE ZEROES                   TO RD3-GLS-DISP IN RD3.
           MOVE OPC-COD-OFOC IN OPC      TO RD3-COD-OFOC IN RD3.
           MOVE DLC-COD-PLZO IN DLC      TO RD3-COD-PLZO IN RD3.
           MOVE OPC-COD-COOC IN OPC      TO RD3-COD-COOC IN RD3.
           MOVE OPC-COD-VCOC IN OPC      TO RD3-COD-VCOC IN RD3.
           MOVE DLC-VAL-NDLC IN DLC      TO RD3-VAL-CAPI IN RD3.
           MOVE WSS-VAL-TRAM IN WSS-VARI TO RD3-VAL-TRAM IN RD3.
           MOVE WSS-VAL-TEQV IN WSS-VARI TO RD3-VAL-INTE IN RD3.
           MOVE WSS-NUM-DINF IN WSS-VARI TO RD3-NUM-DPRO IN RD3.
           MOVE WSS-NUM-MINF IN WSS-VARI TO RD3-NUM-MPRO IN RD3.
           MOVE WSS-NUM-SINF IN WSS-VARI TO RD3-NUM-SPRO IN RD3.
           MOVE WSS-NUM-AINF IN WSS-VARI TO RD3-NUM-APRO IN RD3.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-RD3.
           IF NOT FIO-STAT-OKS
               DISPLAY ' ERROR AL GRABAR RD3, FIO-STAT : ' FIO-STAT
               DISPLAY ' EN DLC : ' DLC-KEY-IDLC IN DLC
               PERFORM GNS-PRO-ABT
           ELSE
               ADD 1 TO WSS-NUM-RD3G.
       FIN-PUT-CTR-OPC-RD3.
           EXIT.
      ******************************************************************
       CAL-TAS-PPON SECTION.
       INI-CAL-TAS-PPON.
           IF WSS-CONT(WSS-SUB) = ZEROES
               MOVE ZEROES TO WSS-TPPO IN WSS-ELE(WSS-SUB)
               MOVE ZEROES TO WSS-SPPO IN WSS-ELE(WSS-SUB)
           ELSE
               DIVIDE WSS-PPON IN WSS-ELE(WSS-SUB) BY
                      WSS-MONT IN WSS-ELE(WSS-SUB) GIVING
                      WSS-TPPO IN WSS-ELE(WSS-SUB) ROUNDED
               IF WSS-TTD1 IN WSS-ELE(WSS-SUB) = 2
                   DIVIDE WSS-SPON IN WSS-ELE(WSS-SUB) BY
                          WSS-MONT IN WSS-ELE(WSS-SUB) GIVING
                          WSS-SPPO IN WSS-ELE(WSS-SUB) ROUNDED.

       FIN-CAL-TAS-PPON.
           EXIT.

      ******************************************************************
      * Forma y Graba el Registro Interfaz D31 Super-Bancos - DAP- COL
       GEN-REG-D31 SECTION.
       INI-GEN-REG-D31.
           IF WSS-MONT IN WSS-ELE(WSS-SUB) NOT > ZEROES
               GO TO FIN-GEN-REG-D31.
           MOVE WSS-TOPE IN WSS-ELE(WSS-SUB) TO D31-NUM-TOPE IN D31.
           MOVE WSS-PLZO IN WSS-ELE(WSS-SUB) TO D31-NUM-TRMO IN D31.
           MOVE WSS-TTAS IN WSS-ELE(WSS-SUB) TO D31-NUM-TTAS IN D31.
           MOVE WSS-VCOC IN WSS-ELE(WSS-SUB) TO D31-NUM-VCOC IN D31.
           MOVE WSS-MONT IN WSS-ELE(WSS-SUB) TO D31-NUM-MNTO IN D31.
           MOVE WSS-TMAX IN WSS-ELE(WSS-SUB) TO D31-NUM-TMAX IN D31.
           MOVE WSS-SMAX IN WSS-ELE(WSS-SUB) TO D31-NUM-SMAX IN D31.
           MOVE WSS-TMIN IN WSS-ELE(WSS-SUB) TO D31-NUM-TMIN IN D31.
           MOVE WSS-SMIN IN WSS-ELE(WSS-SUB) TO D31-NUM-SMIN IN D31.
           MOVE WSS-TPPO IN WSS-ELE(WSS-SUB) TO D31-NUM-TPOP IN D31.
           MOVE WSS-SPPO IN WSS-ELE(WSS-SUB) TO D31-NUM-SPOP IN D31.

           IF D31-NUM-TMAX IN D31 = D31-NUM-TMIN IN D31
               MOVE D31-NUM-TMAX IN D31 TO D31-NUM-TPOP IN D31.

           IF D31-NUM-SMAX IN D31 = D31-NUM-SMIN IN D31
               MOVE D31-NUM-SMAX IN D31 TO D31-NUM-SPOP IN D31.

           IF D31-NUM-TPOP IN D31 < D31-NUM-TMIN IN D31
               MOVE D31-NUM-TMIN IN D31 TO D31-NUM-TPOP IN D31.
           IF D31-NUM-TPOP IN D31 > D31-NUM-TMAX IN D31
               MOVE D31-NUM-TMAX IN D31 TO D31-NUM-TPOP IN D31.

           IF D31-NUM-SPOP IN D31 < D31-NUM-SMIN IN D31
               MOVE D31-NUM-SMIN IN D31 TO D31-NUM-SPOP IN D31.
           IF D31-NUM-SPOP IN D31 > D31-NUM-SMAX IN D31
               MOVE D31-NUM-SMAX IN D31 TO D31-NUM-SPOP IN D31.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM SUP-FIO-D31.
           ADD 1 TO WSS-NUM-D31G.
       FIN-GEN-REG-D31.
           EXIT.

      *GRABA REGISTRO CABECERA
       GEN-REG-CAB-D31 SECTION.
       INI-GEN-REG-CAB-D31.
           MOVE SPACES TO WSS-D31-CAB.
           MOVE '016'                    TO WSS-FINA IN WSS-VARI.
           MOVE 'D31'                    TO WSS-FILE IN WSS-VARI.
           MOVE WSS-FEC-REFE IN WSS-VARI TO WSS-REFE IN WSS-VARI.
           MOVE WSS-D31-CAB TO D31.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM SUP-FIO-D31.
           ADD 1 TO WSS-NUM-D31G.
       FIN-GEN-REG-CAB-D31.
           EXIT.

       PRO-PRO SECTION.
       INI-PRO-PRO.
           MOVE SPACES TO MSG-COD-MENS IN MSG.
      * Obtiene valor renovado si opc es ingreso de prorroga.
      * Conversion a pesos se efectua a la fcol original.
           IF OPC-IND-RENO IN OPC NOT = 'PRO'
              GO TO FIN-PRO-PRO.
      * Guarda el CIC de la OPC de la prorroga.
           MOVE OPC-CIC-IOPC IN OPC TO AUX-CIC-IOPC IN WSS-VARI.
      * Lee OPC original para rescatar la fecha de origen.
           MOVE DLC-CIC-IOCO IN DLC TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
              MOVE 'COL'        TO MSG-COD-SIST
              MOVE 'OPCORIGNEX' TO MSG-COD-MENS
              PERFORM GET-MSG
              DISPLAY MSG-GLS-DESC   OPC-CIC-IOPC IN OPC
           ELSE
               MOVE OPC-VAL-CRED IN OPC TO WSS-CRED-ORIG
      * Mueve fecha de OPC original para la conversion a valor origen
              MOVE OPC-FEC-FCOL IN OPC TO WSS-FEC-FORI IN WSS-VARI.
      * Vuelve a leer la OPC de la prorroga
           MOVE AUX-CIC-IOPC IN WSS-VARI TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FIN-PRO-PRO.
           EXIT.

       PRO-C31 SECTION.
       INI-PRO-C31.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SUP-FIO-C31.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR: SUPC31 NO CONTIENE REGISTROS '
               GO TO FIN-PRO-C31.

      *ESTOS MOVIMIENTOS NO SON PRORROGAS
           MOVE SPACES              TO OPC-IND-RENO IN OPC.
           MOVE SPACES              TO WSS-OPEC IN WSS-VARI.
       LUP-PRO-C31.
           IF NOT FIO-STAT-OKS
               GO TO FIN-PRO-C31.

           ADD 1 TO WSS-NUM-C31L IN WSS-VARI.

           IF C31-FEC-FPRO IN C31 NOT = WSS-FEC-FIN1 IN WSS-VARI
               DISPLAY 'FECHA C31 NO CORRESPONDE A PROCESO '
               DISPLAY 'FECHA PROCESO  : ' WSS-FEC-FIN1
               DISPLAY 'FECHA C31      : ' C31-FEC-FPRO IN C31
               PERFORM GNS-PRO-ABT
               GO TO NXT-PRO-C31.


           MOVE C31-FEC-FPRO IN C31 TO OPC-FEC-FCOL IN OPC.
           MOVE C31-VAL-MNTO IN C31 TO DLC-VAL-NDLC IN DLC.
           MOVE C31-VAL-INTE IN C31 TO WSS-VAL-TEQV IN WSS-VARI.
           MOVE C31-VAL-SPRD IN C31 TO WSS-VAL-SPRD IN WSS-VARI.

           MOVE C31-COD-TOPE IN C31 TO WSS-TOPE-D31 IN WSS-VARI.
           MOVE C31-COD-PLZO IN C31 TO WSS-PLZO-D31 IN WSS-VARI.
           MOVE C31-COD-TTAS IN C31 TO WSS-TTAS-D31 IN WSS-VARI.
           MOVE C31-COD-VCOC IN C31 TO WSS-VCOC-D31 IN WSS-VARI.
           MOVE DLC-VAL-NDLC IN DLC TO WSS-VAL-TRAM IN WSS-VARI.
           MOVE WSS-KEY-D31         TO   OPC-CIC-IOPC IN OPC.

           MOVE 'TAB'                 TO FIO-SIST.
           MOVE 'VLR'                 TO TAB-EXT-TTAB IN TAB.
           MOVE C31-COD-VCOC  IN C31  TO TAB-EXT-CTAB IN TAB.
           MOVE 'TAB-EXT-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               ADD 1 TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'CODVCOCNOVAL'           TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-PRO-C31.
           IF NOT ( WSS-TTAS-1D31 = 1  OR
                    WSS-TTAS-1D31 = 2  )
               ADD 1 TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'DI1TTASNOVAL'           TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-PRO-C31.

           IF NOT ( WSS-TTAS-2D31 = 0 OR
                    WSS-TTAS-2D31 = 1 OR
                    WSS-TTAS-2D31 = 2 OR
                    WSS-TTAS-2D31 = 3 OR
                    WSS-TTAS-2D31 = 4 OR
                    WSS-TTAS-2D31 = 9 )
               ADD 1 TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'DI2TTASNOVAL'           TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-PRO-C31.
           IF NOT ( WSS-TTAS-3D31 = 1 OR
                    WSS-TTAS-3D31 = 2 OR
                    WSS-TTAS-3D31 = 3 OR
                    WSS-TTAS-3D31 = 4 OR
                    WSS-TTAS-3D31 = 5 OR
                    WSS-TTAS-3D31 = 6 )
               ADD 1 TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'DI3TTASNOVAL'           TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-PRO-C31.
           IF WSS-TTAS-1D31 = 1  AND
              C31-VAL-SPRD IN C31 > ZEROES
               ADD 1 TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'VALSPRDNOVAL'           TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-PRO-C31.
           IF C31-VAL-MNTO IN C31 NOT > ZEROES
               ADD 1 TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'VALMNTOCERO '           TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-PRO-C31.
           IF C31-COD-TOPE IN C31 IS NOT NUMERIC OR
              C31-COD-PLZO IN C31 IS NOT NUMERIC OR
              C31-COD-TTAS IN C31 IS NOT NUMERIC OR
              C31-COD-VCOC IN C31 IS NOT NUMERIC OR
              C31-VAL-INTE IN C31 IS NOT NUMERIC OR
              C31-VAL-SPRD IN C31 IS NOT NUMERIC OR
              C31-VAL-MNTO IN C31 IS NOT NUMERIC
               ADD 1 TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'VALNONUMEC31'           TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-PRO-C31.

           IF NOT ( C31-COD-PLZO IN C31 = 5  OR
                C31-COD-PLZO IN C31 = 10 OR
                C31-COD-PLZO IN C31 = 15 OR
                C31-COD-PLZO IN C31 = 20 OR
                C31-COD-PLZO IN C31 = 25 OR
                C31-COD-PLZO IN C31 = 30 OR
                C31-COD-PLZO IN C31 = 35 OR
                C31-COD-PLZO IN C31 = 40 OR
                C31-COD-PLZO IN C31 = 45 OR
                C31-COD-PLZO IN C31 = 50 OR
                C31-COD-PLZO IN C31 = 55 OR
                C31-COD-PLZO IN C31 = 60 OR
                C31-COD-PLZO IN C31 = 65 OR
                C31-COD-PLZO IN C31 = 70 OR
                C31-COD-PLZO IN C31 = 75 OR
                C31-COD-PLZO IN C31 = 80   )
               ADD 1 TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'CODPLZONOVAL'           TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-PRO-C31.

           MOVE WSS-IND IN WSS-VARI      TO RD3-NUM-LINE IN RD3.

           MOVE ZEROES                   TO RD3-GLS-DISP IN RD3.
           MOVE SPACES                   TO OPC-COD-OFOC IN OPC.
           MOVE C31-COD-PLZO IN C31      TO DLC-COD-PLZO IN DLC.
           MOVE SPACES                   TO OPC-COD-COOC IN OPC.
           MOVE C31-COD-VCOC IN C31      TO RD3-COD-VCOC IN RD3.

      * Determinacion del Tramo para Distribuir Registro Seleccionado
           PERFORM DET-TRA-REG-PROC.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO NXT-PRO-C31.

           MOVE WSS-KEY-D31  TO WSS-KEYS IN WSS-ELE(WSS-IND).


      * Seleccion de Oficina de Operacion SOLO de Region Metropolitana
      *    IF WSS-COD-OFOC IN WSS-VARI = '*'
           MOVE 'S' TO WSS-COD-RMTP.


      *     ELSE
      *         IF WSS-COD-OFOC IN WSS-VARI NOT = 'RM'
      *             IF WSS-COD-OFOC NOT = C31-COD-OFOC IN C31
      *                 MOVE 'N' TO WSS-COD-RMTP.

      *     IF WSS-COD-OFOC IN WSS-VARI = 'RM'
      *         MOVE  1  TO WSS-NUM-IOFI
      *         SET WSS-NUM-OFIC TO 1
      *         SEARCH WSS-ELE-OFIC VARYING WSS-NUM-IOFI
      *                AT END MOVE 'N' TO WSS-COD-RMTP
      *            WHEN WSS-COD-OFIC(WSS-NUM-OFIC) = C31-COD-OFOC IN C31
      *                       MOVE 'S' TO WSS-COD-RMTP.
           IF WSS-COD-RMTP IN WSS-VARI = 'N'
               GO TO SOLO-RM-3.

      * Determinacion de las TASAS EXTREMAS Minima y Maxima
           ADD 1  TO WSS-CONT(WSS-IND).
           IF WSS-CONT(WSS-IND) = 1
               MOVE WSS-VAL-TEQV IN WSS-VARI TO
                    WSS-TMIN IN WSS-ELE(WSS-IND)
           ELSE
           IF WSS-VAL-TEQV IN WSS-VARI < WSS-TMIN IN WSS-ELE(WSS-IND)
               MOVE WSS-VAL-TEQV IN WSS-VARI TO
                    WSS-TMIN IN WSS-ELE(WSS-IND).

           IF WSS-VAL-TEQV IN WSS-VARI > WSS-TMAX IN WSS-ELE(WSS-IND)
               MOVE WSS-VAL-TEQV IN WSS-VARI TO
                    WSS-TMAX IN WSS-ELE(WSS-IND).


           IF WSS-TTAS-1D31 IN WSS-VARI = 1
              GO TO SOLO-RM-3.

           IF WSS-CONT(WSS-IND) = 1
               MOVE WSS-VAL-SPRD IN WSS-VARI TO
                    WSS-SMIN IN WSS-ELE(WSS-IND)
           ELSE
           IF WSS-VAL-SPRD IN WSS-VARI < WSS-SMIN IN WSS-ELE(WSS-IND)
               MOVE WSS-VAL-SPRD IN WSS-VARI TO
                    WSS-SMIN IN WSS-ELE(WSS-IND).

           IF WSS-VAL-SPRD IN WSS-VARI > WSS-SMAX IN WSS-ELE(WSS-IND)
               MOVE WSS-VAL-SPRD IN WSS-VARI TO
                    WSS-SMAX IN WSS-ELE(WSS-IND).

       SOLO-RM-3.

           IF WSS-COD-RMTP IN WSS-VARI = 'N'
               GO TO SOLO-RM-4.

      * Acumulacion del Monto en $ de los Creditos Seleccionados
           ADD DLC-VAL-NDLC IN DLC TO WSS-MONT IN WSS-ELE(WSS-IND).

      * Determinacion y Calculo para el Promedio Ponderado
           MULTIPLY WSS-VAL-TEQV IN WSS-VARI BY
                    DLC-VAL-NDLC IN DLC      GIVING
                    WSS-VAL-PPON IN WSS-VARI.

           ADD WSS-VAL-PPON IN WSS-VARI TO
               WSS-PPON IN WSS-ELE(WSS-IND).

           IF WSS-TTAS-1D31 IN WSS-VARI = 2
               MULTIPLY WSS-VAL-SPRD IN WSS-VARI BY
                        DLC-VAL-NDLC IN DLC      GIVING
                        WSS-VAL-SPON IN WSS-VARI
               ADD WSS-VAL-SPON IN WSS-VARI TO
                   WSS-SPON IN WSS-ELE(WSS-IND).

      * Graba montos para Control de Proceso segun Codigos de Oficina,
      * Plazo, Clase y Moneda del Credito por DLC en registro RD3
      * Seleccion de Oficina de Operacion SOLO de Region Metropolitana
       SOLO-RM-4.
           IF WSS-COD-RMTP IN WSS-VARI = 'S'
               MOVE ZEROES TO WSS-IND
               PERFORM PUT-CTR-OPC-RD3
               ADD 1 TO WSS-NUM-C31P IN WSS-VARI.
       NXT-PRO-C31.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SUP-FIO-C31.
           GO TO LUP-PRO-C31.
       FIN-PRO-C31.
           EXIT.
      ******************************************************************

       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBGEND.
       COPY GNSBGABT.

       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBFMSC.
       COPY TABBFOFI.
       COPY TABBFCAM.
       COPY TABBFCOM.
       COPY COLBFVEN.
       COPY COLBFOPC.
       COPY COLBFDLC.
       COPY COLBFICG.
       COPY COLBFTOC.
       COPY COLBFDCC.

       COPY COLBFRD3.
       COPY COLBFRH3.
       COPY SUPBFD31.
       COPY SUPBFC31.
       COPY GNSBBMSC.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY GNSBGHOY.
       COPY COLBGINT.
       COPY GNSBGCVI.
       COPY GNSBGPES.
       COPY COLBGCTO.
       COPY TABBBTXC.
      * Obtiene Tasa Maxima Convencional del Credito a Fecha de Colocaci
       OBT-TASA-TXC SECTION.
       INI-OBT-TASA-TXC.
           PERFORM DET-MNTO-ORIG.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO FIN-OBT-TASA-TXC.
           MOVE 1                            TO CAM-SGV-VCAM IN CAM.
           IF OPC-COD-VCOC NOT = '0998'
               MOVE '0998  '                 TO CAM-COD-VCAM IN CAM(1)
               MOVE OPC-COD-VCOC IN OPC      TO CAM-COD-VCAM IN CAM(2)
               MOVE WSS-NUM-DORI             TO CAM-NUM-DCAM IN CAM(1)
               MOVE WSS-NUM-MORI             TO CAM-NUM-MCAM IN CAM(1)
               MOVE WSS-NUM-SORI             TO CAM-NUM-SCAM IN CAM(1)
               MOVE WSS-NUM-AORI             TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT ( FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
                   MOVE 'TAB'        TO MSG-COD-SIST
                   MOVE 'CAM    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   DISPLAY 'NO EXISTE VALOR DE CAMBIO '
                   DISPLAY CAM-KEY-CAMB IN CAM
                   PERFORM GNS-PRO-ABT.

           DIVIDE WSS-CRED-ORIG       BY CAM-SGV-VCAM IN CAM
                  GIVING                   TXC-MNTO ROUNDED.

           MOVE DLC-COD-PLZO            TO TXC-PLZO.
           MOVE OPC-COD-VCOC IN OPC     TO TXC-VCOC.

           MOVE OPC-NUM-DCOL IN OPC     TO TXC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC     TO TXC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC     TO TXC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC     TO TXC-AEC1.

           MOVE ZEROES                  TO TXC-FEC2.

           PERFORM TAB-BUS-TXC.

           IF TXC-CMSG > SPACES
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE TXC-CMSG     TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY 'ERROR RUTINA TMC A FCOL : ' TXC-CMSG
               DISPLAY 'GLOSA ERROR : '      MSG-GLS-DESC
               PERFORM GNS-PRO-ABT.

           MOVE TXC-VTXC         TO WSS-VAL-TMXC IN WSS-VARI.

       EXT-OBT-TASA-TXC.
           IF WSS-IND-VTMC IN WSS-VARI NOT = 'S'
               GO TO FIN-OBT-TASA-TXC.

           PERFORM DET-MNTO-ORIG.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO FIN-OBT-TASA-TXC.
           MOVE 1                            TO CAM-SGV-VCAM IN CAM.
           IF OPC-COD-VCOC NOT = '0998'
               MOVE '0998  '                 TO CAM-COD-VCAM IN CAM(1)
               MOVE OPC-COD-VCOC IN OPC      TO CAM-COD-VCAM IN CAM(2)
               MOVE WSS-NUM-DORI             TO CAM-NUM-DCAM IN CAM(1)
               MOVE WSS-NUM-MORI             TO CAM-NUM-MCAM IN CAM(1)
               MOVE WSS-NUM-SORI             TO CAM-NUM-SCAM IN CAM(1)
               MOVE WSS-NUM-AORI             TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT ( FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
                   MOVE 'TAB'        TO MSG-COD-SIST
                   MOVE 'CAM    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   DISPLAY 'NO EXISTE VALOR DE CAMBIO '
                   DISPLAY CAM-KEY-CAMB IN CAM
                   PERFORM GNS-PRO-ABT.

           DIVIDE WSS-CRED-ORIG       BY CAM-SGV-VCAM IN CAM
                  GIVING                TXC-MNTO ROUNDED.
           MOVE DLC-COD-PLZO            TO TXC-PLZO.
           MOVE OPC-COD-VCOC IN OPC     TO TXC-VCOC.

           MOVE OPC-NUM-DINP IN OPC     TO TXC-DEC1.
           MOVE OPC-NUM-MINP IN OPC     TO TXC-MEC1.
           MOVE OPC-NUM-SINP IN OPC     TO TXC-SEC1.
           MOVE OPC-NUM-AINP IN OPC     TO TXC-AEC1.

           MOVE ZEROES                  TO TXC-FEC2.

           PERFORM TAB-BUS-TXC.

           IF TXC-CMSG > SPACES
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE TXC-CMSG     TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY 'ERROR RUTINA TMC A FINP : ' TXC-CMSG
               DISPLAY 'GLOSA ERROR  '              MSG-GLS-DESC
               PERFORM GNS-PRO-ABT.

           MOVE TXC-VTXC         TO CAM-SGV-VCAM IN CAM.

           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO
               IF INT-PBTI = 'D'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 30
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
               IF INT-PBTI = 'M' OR 'T'
                   MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC
               ELSE
                   MULTIPLY CAM-SGV-VCAM IN CAM BY 12 GIVING
                            WSS-VAL-TMCC  ROUNDED
           ELSE
               IF INT-PBTI  = 'D'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 360
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
               IF INT-PBTI = 'M' OR 'T'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 12
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
                   MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC.
       FIN-OBT-TASA-TXC.
           EXIT.
       DET-MNTO-ORIG SECTION.
       INI-DET-MNTO-ORIG.
           MOVE  1  TO WSS-IND-STAT IN WSS-VARI.


           MOVE OPC-VAL-CRED IN OPC TO WSS-CRED-ORIG.
           MOVE OPC-FEC-FCOL IN OPC TO WSS-FEC-FORI.

           IF OPC-IND-RENO IN OPC = 'PRO'
               PERFORM PRO-PRO
               IF MSG-COD-MENS IN MSG > SPACES
                   GO TO FIN-DET-MNTO-ORIG.

           MOVE  0  TO WSS-IND-STAT IN WSS-VARI.
       FIN-DET-MNTO-ORIG.
           EXIT.

       CAL-PLZO-D31 SECTION.
       INI-CAL-PLZO-D31.
           MOVE SPACES TO WSS-COD-TRAMO.
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE DLC-NUM-DMAV IN DLC TO FEC-DEC2.
           MOVE DLC-NUM-MMAV IN DLC TO FEC-MEC2.
           MOVE DLC-NUM-SMAV IN DLC TO FEC-SEC2.
           MOVE DLC-NUM-AMAV IN DLC TO FEC-AEC2.

            MOVE FEC-FORM-FEC TO FEC-FORM.
            MOVE FEC-DIF-DIA  TO FEC-CMND.
            PERFORM CAL-FEC.
            IF NOT FEC-STAT-OKS
               MOVE 'ERRDIFDIA'  TO MSG-COD-MENS IN MSG
               GO TO FIN-CAL-PLZO-D31.

            IF FEC-NDIA < 15
                MOVE '05' TO WSS-COD-TRAMO
            ELSE
            IF FEC-NDIA NOT > 29
                MOVE '10' TO WSS-COD-TRAMO
            ELSE
            IF FEC-NDIA NOT > 59
                MOVE '15' TO WSS-COD-TRAMO
            ELSE
            IF FEC-NDIA NOT > 89
                MOVE '20' TO WSS-COD-TRAMO
            ELSE
            IF FEC-NDIA NOT > 119
                MOVE '25' TO WSS-COD-TRAMO
            ELSE
            IF FEC-NDIA NOT > 149
                MOVE '30' TO WSS-COD-TRAMO
            ELSE
            IF FEC-NDIA NOT > 179
                MOVE '35' TO WSS-COD-TRAMO
            ELSE
            IF FEC-NDIA NOT > 209
                MOVE '40' TO WSS-COD-TRAMO
            ELSE
            IF FEC-NDIA NOT > 239
                MOVE '45' TO WSS-COD-TRAMO
            ELSE
            IF FEC-NDIA NOT > 269
                MOVE '50' TO WSS-COD-TRAMO
            ELSE
            IF FEC-NDIA NOT > 299
                MOVE '55' TO WSS-COD-TRAMO
            ELSE
            IF FEC-NDIA NOT > 329
                MOVE '60' TO WSS-COD-TRAMO.

            IF WSS-COD-TRAMO > SPACES
                GO TO FIN-CAL-PLZO-D31.

           MOVE ZEROES TO FEC-NDIA.

           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE DLC-NUM-DMAV IN DLC TO FEC-DEC2.
           MOVE DLC-NUM-MMAV IN DLC TO FEC-MEC2.
           MOVE DLC-NUM-SMAV IN DLC TO FEC-SEC2.
           MOVE DLC-NUM-AMAV IN DLC TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-MES  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
              MOVE 'ERRDIFANO'  TO MSG-COD-MENS IN MSG
              GO TO FIN-CAL-PLZO-D31.

            DIVIDE FEC-NMES BY 12 GIVING FEC-NANO REMAINDER FEC-REST

            IF ( FEC-NANO < 1 ) OR
               ( FEC-NANO = 1 AND FEC-REST = ZEROES AND
                 FEC-NDIA = ZEROES )
                MOVE '65' TO WSS-COD-TRAMO
            ELSE
            IF  ( FEC-NANO < 2 ) OR
               ( FEC-NANO = 2 AND FEC-REST = ZEROES AND
                 FEC-NDIA = ZEROES )
                MOVE '70' TO WSS-COD-TRAMO
            ELSE
            IF  ( FEC-NANO < 3 ) OR
               ( FEC-NANO = 3 AND FEC-REST = ZEROES AND
                 FEC-NDIA = ZEROES )
                MOVE '75' TO WSS-COD-TRAMO
            ELSE
                MOVE '80' TO WSS-COD-TRAMO.
       FIN-CAL-PLZO-D31.
           EXIT.



       DET-DIG-TRES-F SECTION.
       INI-DET-DIG-TRES-F.
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE DLC-NUM-DMAV IN DLC TO FEC-DEC2.
           MOVE DLC-NUM-MMAV IN DLC TO FEC-MEC2.
           MOVE DLC-NUM-SMAV IN DLC TO FEC-SEC2.
           MOVE DLC-NUM-AMAV IN DLC TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE 'ERRDIFDIA'  TO MSG-COD-MENS IN MSG
               GO TO FIN-DET-DIG-TRES-F.

           MOVE FEC-NDIA TO WSS-FEC-NDIA.

           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE DLC-NUM-DMAV IN DLC TO FEC-DEC2.
           MOVE DLC-NUM-MMAV IN DLC TO FEC-MEC2.
           MOVE DLC-NUM-SMAV IN DLC TO FEC-SEC2.
           MOVE DLC-NUM-AMAV IN DLC TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-MES  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE 'ERRDIFMES'  TO MSG-COD-MENS IN MSG
               GO TO FIN-DET-DIG-TRES-F.

           MOVE FEC-NMES TO WSS-FEC-NMES.

           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE DLC-NUM-DMAV IN DLC TO FEC-DEC2.
           MOVE DLC-NUM-MMAV IN DLC TO FEC-MEC2.
           MOVE DLC-NUM-SMAV IN DLC TO FEC-SEC2.
           MOVE DLC-NUM-AMAV IN DLC TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-ANO  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE 'ERRDIFANO'  TO MSG-COD-MENS IN MSG
               GO TO FIN-DET-DIG-TRES-F.

           MOVE FEC-NANO TO WSS-FEC-NANO.

           IF WSS-FEC-NDIA < 30
                MOVE 1 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
           IF WSS-FEC-NDIA < 90
                MOVE 2 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
           IF WSS-FEC-NDIA NOT < 90 AND
               WSS-FEC-NMES < 6
                MOVE 3 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
           IF WSS-FEC-NMES NOT < 6 AND
               WSS-FEC-NANO < 1
                MOVE 4 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
           IF WSS-FEC-NANO NOT < 1 AND
               WSS-FEC-NANO < 3
                MOVE 5 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
                MOVE 6 TO WSS-DIG-TRES IN WSS-VARI.
       FIN-DET-DIG-TRES-F.
           EXIT.

       DET-DIG-TRES-V SECTION.
       INI-DET-DIG-TRES-V.
           IF ICG-MSC-TFPR IN ICG = 'F'
               PERFORM DET-DIG-TRES-V-F
           ELSE
               PERFORM DET-DIG-TRES-V-C.
       FIN-DET-DIG-TRES-V.
           EXIT.

       DET-DIG-TRES-V-F SECTION.
       INI-DET-DIG-TRES-F.
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
           MOVE 1                   TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-VEN.

           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE VEN-NUM-DVEN IN VEN TO FEC-DEC2.
           MOVE VEN-NUM-MVEN IN VEN TO FEC-MEC2.
           MOVE VEN-NUM-SVEN IN VEN TO FEC-SEC2.
           MOVE VEN-NUM-AVEN IN VEN TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE 'ERRDIFDIA'  TO MSG-COD-MENS IN MSG
               GO TO FIN-DET-DIG-TRES-V-F.

           MOVE FEC-NDIA TO WSS-FEC-NDIA.

           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE VEN-NUM-DVEN IN VEN TO FEC-DEC2.
           MOVE VEN-NUM-MVEN IN VEN TO FEC-MEC2.
           MOVE VEN-NUM-SVEN IN VEN TO FEC-SEC2.
           MOVE VEN-NUM-AVEN IN VEN TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-MES  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE 'ERRDIFMES'  TO MSG-COD-MENS IN MSG
               GO TO FIN-DET-DIG-TRES-V-F.

           MOVE FEC-NMES TO WSS-FEC-NMES.

           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE VEN-NUM-DVEN IN VEN TO FEC-DEC2.
           MOVE VEN-NUM-MVEN IN VEN TO FEC-MEC2.
           MOVE VEN-NUM-SVEN IN VEN TO FEC-SEC2.
           MOVE VEN-NUM-AVEN IN VEN TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-ANO  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE 'ERRDIFANO'  TO MSG-COD-MENS IN MSG
               GO TO FIN-DET-DIG-TRES-V-F.

           MOVE FEC-NANO TO WSS-FEC-NANO.

           IF WSS-FEC-NDIA < 30
               MOVE 1 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
           IF WSS-FEC-NDIA < 90
                MOVE 2 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
           IF WSS-FEC-NDIA NOT < 90 AND
               WSS-FEC-NMES < 6
                MOVE 3 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
           IF WSS-FEC-NMES NOT < 6 AND
               WSS-FEC-NANO < 1
                MOVE 4 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
           IF WSS-FEC-NANO NOT < 1 AND
               WSS-FEC-NANO < 3
                MOVE 5 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
                MOVE 6 TO WSS-DIG-TRES IN WSS-VARI.
       FIN-DET-DIG-TRES-V-F.
           EXIT.

       DET-DIG-TRES-V-C SECTION.
       INI-DET-DIG-TRES-V-C.
           MOVE OPC-NUM-DCOL IN OPC TO FEC-ITM1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-ITM2.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-ITM3.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-ITM4.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           IF ICG-MSC-UTPR IN ICG =  'D'
               MOVE FEC-SUM-DIA  TO FEC-CMND
               MOVE ICG-NUM-PREP IN ICG TO FEC-NDIA
           ELSE
           IF ICG-MSC-UTPR IN ICG =  'M'
               MOVE FEC-SUM-MES TO FEC-CMND
               MOVE ICG-NUM-PREP IN ICG TO FEC-NMES
           ELSE
               MOVE ICG-NUM-PREP IN ICG TO FEC-NANO
               MOVE FEC-SUM-ANO TO FEC-CMND.
           PERFORM CAL-FEC.
           MOVE FEC-ITM1 TO WSS-NUM-DP02.
           MOVE FEC-ITM2 TO WSS-NUM-MP02.
           MOVE FEC-ITM3 TO WSS-NUM-SP02.
           MOVE FEC-ITM4 TO WSS-NUM-AP02.


           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE WSS-NUM-DP02 TO FEC-DEC2.
           MOVE WSS-NUM-MP02 TO FEC-MEC2.
           MOVE WSS-NUM-SP02 TO FEC-SEC2.
           MOVE WSS-NUM-AP02 TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE 'ERRDIFDIA'  TO MSG-COD-MENS IN MSG
               GO TO FIN-DET-DIG-TRES-V-F.

           MOVE FEC-NDIA TO WSS-FEC-NDIA.

           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE WSS-NUM-DP02 TO FEC-DEC2.
           MOVE WSS-NUM-MP02 TO FEC-MEC2.
           MOVE WSS-NUM-SP02 TO FEC-SEC2.
           MOVE WSS-NUM-AP02 TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-MES  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE 'ERRDIFMES'  TO MSG-COD-MENS IN MSG
               GO TO FIN-DET-DIG-TRES-V-F.

           MOVE FEC-NMES TO WSS-FEC-NMES.

           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE WSS-NUM-DP02 TO FEC-DEC2.
           MOVE WSS-NUM-MP02 TO FEC-MEC2.
           MOVE WSS-NUM-SP02 TO FEC-SEC2.
           MOVE WSS-NUM-AP02 TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-ANO  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE 'ERRDIFANO'  TO MSG-COD-MENS IN MSG
               GO TO FIN-DET-DIG-TRES-V-F.

           MOVE FEC-NANO TO WSS-FEC-NANO.
           IF WSS-FEC-NDIA < 30
                MOVE 1 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
           IF WSS-FEC-NDIA < 90
                MOVE 2 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
           IF WSS-FEC-NDIA NOT < 90 AND
               WSS-FEC-NMES < 6
                MOVE 3 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
           IF WSS-FEC-NMES NOT < 6 AND
               WSS-FEC-NANO < 1
                MOVE 4 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
           IF WSS-FEC-NANO NOT < 1 AND
               WSS-FEC-NANO < 3
                MOVE 5 TO WSS-DIG-TRES IN WSS-VARI
           ELSE
                MOVE 6 TO WSS-DIG-TRES IN WSS-VARI.
       FIN-DET-DIG-TRES-V-C.
           EXIT.
       COPY COLRED31.
       D-PH-D31 SECTION.
       INI-PH-D31.
       FIN-PH-D31.
           EXIT.
       D-DL-D31 SECTION.
       INI-DL-D31.
       FIN-DL-D31.
           EXIT.

       DIS-TOT-POR-TIPO SECTION.
       INI-DIS-TOT-POR-TIPO.

           ADD WSS-CONT(WSS-SUB) TO WSS-VAL-NUOP.
           IF WSS-TOPE(WSS-SUB) < 3000
               ADD WSS-MONT(WSS-SUB) TO WSS-VAL-MACT
           ELSE
               ADD WSS-MONT(WSS-SUB) TO WSS-VAL-MPAS.

       FIN-DIS-TOT-POR-TIPO.
           EXIT.


      *>>>>
