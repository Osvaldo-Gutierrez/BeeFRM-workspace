       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPGCVM.
       AUTHOR.          BEE TEAM (JGM).
       DATE-WRITTEN.    27-JUL-1999
      *
      *Generar informacion para cartera vencida
      *creditos comerciales.
      * Archivo de entrada :
      *        colcvm : creditos comerciales   (ordenado cic opc )
      *        colrop : relaciones operaciones (ordenado cic opc )
      * Archivo de Salida  :
      *        colcvo : creditos comerciales   (refundido opc    )
      *
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *-----------------------
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *<<<< WSS
       COPY COLBROPC.
       COPY COLBRDLC.
      ***************
       COPY COLBRROV.
       COPY COLBRROP.
      ***************
       COPY COLBRCVM.
       COPY COLBRCVO.
      ***************
       COPY SUPBRD01.

       COPY GNSBRMSG.
       COPY GNSBRMSC.
       COPY GNSBRTAB.
       COPY TABBRCAM.

       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       COPY GNSWGFRM.
      *
       01  WSS-VARI.
           03 WSS-IND-PROC   VALUE SPACES        PIC X(01).
           03 WSS-LEE-ROP    VALUE SPACES        PIC X(01).
           03 WSS-FEC-FPRO.
              05 WSS-NUM-DPRO                     PIC 9(02).
              05 WSS-NUM-MPRO                     PIC 9(02).
              05 WSS-NUM-SPRO    VALUE  19        PIC 9(02).
              05 WSS-NUM-APRO                     PIC 9(02).
      *
           03 WSS-FEC-FAUX.
              05 WSS-NUM-SAUX                     PIC 9(02).
              05 WSS-NUM-AAUX                     PIC 9(02).
              05 WSS-NUM-MAUX    VALUE  19        PIC 9(02).
              05 WSS-NUM-DAUX                     PIC 9(02).
      *
           03 WSS-FEC-FPAS.
              05 WSS-NUM-APAS                     PIC 9(02).
              05 WSS-NUM-MPAS                     PIC 9(02).
              05 WSS-NUM-DPAS                     PIC 9(02).
      *
           03 WSS-CIC-IOPC       VALUE SPACES     PIC X(12).
           03 WSS-CIC-IROV       VALUE SPACES     PIC X(12).
           03 WSS-CIC-ICVO       VALUE SPACES     PIC X(12).
      *
           03 WSS-FEC-FCOL.
              05 WSS-NUM-ACOL                     PIC 9(02).
              05 WSS-NUM-MCOL                     PIC 9(02).
              05 WSS-NUM-DCOL                     PIC 9(02).
      *
           03 WSS-FEC-FMAV.
              05 WSS-NUM-AMAV                     PIC 9(02).
              05 WSS-NUM-MMAV                     PIC 9(02).
              05 WSS-NUM-DMAV                     PIC 9(02).
           03 WSS-FEC-FINP.
              05 WSS-NUM-SINP                     PIC 9(02).
              05 WSS-NUM-AINP                     PIC 9(02).
              05 WSS-NUM-MINP                     PIC 9(02).
              05 WSS-NUM-DINP                     PIC 9(02).
           03 WSS-FEC-FIN2.
              05 WSS-NUM-SIN2                     PIC 9(02).
              05 WSS-NUM-AIN2                     PIC 9(02).
              05 WSS-NUM-MIN2                     PIC 9(02).
              05 WSS-NUM-DIN2                     PIC 9(02).
      *
           03 WSS-FEC-FVD1.
              05 WSS-NUM-SVD1                     PIC 9(02).
              05 WSS-NUM-AVD1                     PIC 9(02).
              05 WSS-NUM-MVD1                     PIC 9(02).
              05 WSS-NUM-DVD1                     PIC 9(02).
      *
           03 WSS-FEC-FVD2.
              05 WSS-NUM-SVD2                     PIC 9(02).
              05 WSS-NUM-AVD2                     PIC 9(02).
              05 WSS-NUM-MVD2                     PIC 9(02).
              05 WSS-NUM-DVD2                     PIC 9(02).
      *
           03 WSS-VAL-GARA       VALUE ZEROES     PIC 9(11)V9(02).
           03 WSS-VAL-ORIG       VALUE ZEROES     PIC 9(14).
           03 WSS-VAL-RELA       VALUE ZEROES     PIC 9(14).
      *
           03 WSS-NUM-LCVM       VALUE ZEROES     PIC 9(08).
      *
           03 WSS-NUM-ECVO       VALUE ZEROES     PIC 9(08).
           03 WSS-NUM-GCVO       VALUE ZEROES     PIC 9(08).
           03 WSS-NUM-GNRE       VALUE ZEROES     PIC 9(08).
      *
           03 WSS-NUM-NOCOL      VALUE ZEROES     PIC 9(08).
           03 WSS-NUM-LOPC       VALUE ZEROES     PIC 9(08).
           03 WSS-NUM-EOP1       VALUE ZEROES     PIC 9(08).
           03 WSS-NUM-EOP2       VALUE ZEROES     PIC 9(08).
           03 WSS-NUM-EOP3       VALUE ZEROES     PIC 9(08).
           03 WSS-NUM-ROPC       VALUE ZEROES     PIC 9(08).
      *
           03 WSS-NUM-LDLC       VALUE ZEROES     PIC 9(08).
           03 WSS-NUM-EDLC       VALUE ZEROES     PIC 9(08).
      *
           03 WSS-NUM-PCVO       VALUE ZEROES     PIC 9(08).
           03 WSS-NUM-ACVO       VALUE ZEROES     PIC 9(08).
           03 WSS-NUM-PCV2       VALUE ZEROES     PIC 9(08).
           03 WSS-NUM-ACV2       VALUE ZEROES     PIC 9(08).
      *
           03 WSS-NUM-LROV       VALUE ZEROES     PIC 9(08).
           03 WSS-NUM-EROV       VALUE ZEROES     PIC 9(08).

           03 WSS-NUM-OPC1       VALUE ZEROES     PIC 9(01).
           03 WSS-NUM-OPC2       VALUE ZEROES     PIC 9(01).
           03 WSS-COD-MENS       VALUE SPACES     PIC X(15).
           03 WSS-IND-EXISTE     VALUE SPACE      PIC X(01).


       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
      *------------
       INI-MAIN.
           COPY GNSBGEDB.
           MOVE 'COLPGCVM' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           PERFORM OPEN-FILE.
           PERFORM LEE-PARAM.
           PERFORM BUS-MONEDA-CABIO.
           PERFORM PRO-REG-CVENCIDO.
           PERFORM CLOSE-FILE.
           PERFORM  BUS-VAL-GARANTIA.
           PERFORM MUESTRA-ESTADISTICAS.
       FIN-MAIN.
           PERFORM GNS-PRO-END.

      ******************************************************************

       OPEN-FILE SECTION.
      *-----------------
       INI-OPEN-FILE.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-CVM.
      *
           MOVE 'S'     TO WSS-LEE-ROP IN WSS-VARI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-ROP.
           IF NOT FIO-STAT-OKS
              MOVE 'N'     TO WSS-LEE-ROP IN WSS-VARI
              DISPLAY 'ERROR ABRIENDO COLROP ' FIO-STAT.
      *
      *
           MOVE SPACES TO ROP-CIC-IOPC IN ROP.
           MOVE SPACES TO ROP-CIC-IOPV IN ROP.
           MOVE ZEROES TO ROP-NUM-IVCT IN ROP.
      *
      *
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM COL-FIO-CVO.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ERROR ABRIENDO COLCVO ' FIO-STAT
              PERFORM GNS-PRO-ABT.
      *
       FIN-OPEN-FILE.
           EXIT.

       CLOSE-FILE SECTION.
      *-----------------
       INI-CLOSE-FILE.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-CVM.
      *
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-CVO.
           DISPLAY 'CERRAR ARCHIVOS: CVM, CVO'.
      *
       FIN-CLOSE-FILE.
           EXIT.


      ******************************************************************
       PRO-REG-CVENCIDO SECTION.
       INI-PRO-REG-CVENCIDO.
           MOVE LOW-VALUES  TO CVM.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-CVM.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTEN REGISTROS EN CVM'
               GO TO FIN-PRO-REG-CVENCIDO.

       LUP-PRO-REG-CVENCIDO.
           MOVE SPACES   TO WSS-COD-MENS.
           IF NOT FIO-STAT-OKS
               GO TO FIN-PRO-REG-CVENCIDO.
      **
           ADD  1        TO WSS-NUM-LCVM IN WSS-VARI.
           PERFORM BUS-REG-ROV.
           IF WSS-COD-MENS > SPACES
               ADD 1 TO WSS-NUM-EROV  IN WSS-VARI
               PERFORM BUS-REG-SEQ
               IF WSS-COD-MENS > SPACES
                  PERFORM GRA-REG-CVO
                  GO TO NXT-GRABA-CVENCIDO.
      **
           PERFORM BUS-REG-OPC.
           IF WSS-COD-MENS > SPACES
              ADD 1 TO WSS-NUM-EOP1 IN WSS-VARI
              GO TO NXT-GRABA-CVENCIDO.
      **

      **Bus.reg.si Existe, para acumular.
           PERFORM BUS-REG-CVO-REL.

       NXT-GRABA-CVENCIDO.
           IF WSS-COD-MENS > SPACES
               DISPLAY 'MENSAJE ' WSS-COD-MENS IN WSS-VARI
               ' ' CVM-CIC-IOPC IN CVM.
      *
           DISPLAY ' REGISTROS LEIDOS   : ' WSS-NUM-LCVM ' CVM-IOPC '
                   ' CVM-IOPC ' CVM-CIC-IOPC IN CVM.
      *
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-CVM.
           GO TO LUP-PRO-REG-CVENCIDO.
       FIN-PRO-REG-CVENCIDO.
           EXIT.
      ******************************************************
       BUS-REG-SEQ SECTION.
       INI-BUS-REG-SEQ.
           MOVE  SPACES              TO WSS-COD-MENS.
           MOVE  SPACES              TO OPC-CIC-IOPC IN OPC.
      *
           IF  WSS-LEE-ROP IN WSS-VARI = 'N'
               MOVE 'FIN ARCHIVO ROP' TO WSS-COD-MENS
               GO TO FIN-BUS-REG-SEQ.
      *
           IF ROP-CIC-IOPC IN ROP = SPACES
              MOVE FIO-GET-FST TO FIO-CMND
              PERFORM COL-FIO-ROP.
      *
           IF ROP-CIC-IOPC IN ROP = CVM-CIC-IOPC IN CVM
              DISPLAY 'ROP-CIC-IOPV ' ROP-CIC-IOPV IN ROP
              MOVE ROP-CIC-IOPV IN ROP TO OPC-CIC-IOPC IN OPC
              GO TO FIN-BUS-REG-SEQ.
      *
           IF ROP-CIC-IOPC IN ROP  > CVM-CIC-IOPC IN CVM
              MOVE 'NO EXISTE REG ROP' TO WSS-COD-MENS
              DISPLAY 'ROP-CIC-IOPC ' CVM-CIC-IOPC IN CVM
              GO TO FIN-BUS-REG-SEQ.

       NXT-BUS-REG-SEQ.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-ROP.
           IF FIO-STAT-OKS
               MOVE 'N' TO  WSS-LEE-ROP IN WSS-VARI
              MOVE 'FIN ARCHIVO ROP' TO WSS-COD-MENS
              GO TO FIN-BUS-REG-SEQ.
      *
       FIN-BUS-REG-SEQ.
           EXIT.
      *
       BUS-REG-ROV SECTION.
       INI-BUS-REG-ROV.
      *Busca credito madre del relacionado.
           MOVE  SPACES              TO WSS-COD-MENS.
           MOVE  CVM-CIC-IOPC IN CVM TO WSS-CIC-IROV IN WSS-VARI.
           MOVE  CVM-CIC-IOPC IN CVM TO ROV-CIC-IOPC IN ROV.

       LEE-REG-ROV.
           MOVE SPACES               TO ROV-CIC-IOPV IN ROV.
           MOVE ZEROES               TO ROV-NUM-IVCT IN ROV.
           MOVE FIO-GET-NLS          TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF NOT (FIO-STAT-OKS AND
                   WSS-CIC-IROV IN WSS-VARI = ROV-CIC-IOPC IN ROV)
              MOVE 'NO EXISTE ROV' TO WSS-COD-MENS
              GO TO FIN-BUS-REG-ROV.
      *
       BUS-REG-ROV-DLC.
           MOVE  ROV-CIC-IOPV IN ROV TO DLC-CIC-IOPC IN DLC.
           MOVE 1                    TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY          TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
              MOVE 'NO EXISTE ROV-DLC' TO WSS-COD-MENS
              GO TO FIN-BUS-REG-ROV.
      *
           IF DLC-IND-SCTB IN DLC = 'CAS'  OR
              DLC-IND-SCTB IN DLC = 'VCD'
      *
              MOVE ROV-CIC-IOPV IN ROV TO ROV-CIC-IOPC IN ROV
              MOVE ROV-CIC-IOPV IN ROV TO WSS-CIC-IROV IN WSS-VARI
              GO TO LEE-REG-ROV.
      *
           MOVE  ROV-CIC-IOPV IN ROV TO OPC-CIC-IOPC IN OPC.
           ADD 1 TO WSS-NUM-LROV IN WSS-VARI.
      *
       FIN-BUS-REG-ROV.
           EXIT.
      *
      *
       BUS-REG-OPC SECTION.
       INI-BUS-REG-OPC.
      *Busca informacion del credito madre del relacionado.
           MOVE  SPACES              TO WSS-COD-MENS.
           MOVE FIO-GET-KEY          TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
              MOVE 'NO EXISTE OPC' TO WSS-COD-MENS
              GO TO FIN-BUS-REG-OPC.
           ADD 1 TO WSS-NUM-LOPC IN WSS-VARI.
       FIN-BUS-REG-OPC.
           EXIT.
      *
       BUS-REG-DLC  SECTION.
       INI-BUS-REG-DLC.
           MOVE  SPACES              TO WSS-COD-MENS.
           MOVE  OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE 1                    TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY          TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
              MOVE 'NO EXISTE DLC' TO WSS-COD-MENS
              ADD 1 TO WSS-NUM-EDLC IN WSS-VARI
              GO TO FIN-BUS-REG-DLC.
           ADD 1 TO WSS-NUM-LDLC IN WSS-VARI.
       FIN-BUS-REG-DLC.
           EXIT.

      *
       BUS-REG-OPC-PRO SECTION.
       INI-BUS-REG-OPC-PRO.
      *Busca informacion del credito madre del relacionado.
           MOVE  SPACES              TO WSS-COD-MENS.
           MOVE  DLC-CIC-IOCO IN DLC TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY          TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
              MOVE 'ERROR-OPC-PRO' TO WSS-COD-MENS
              GO TO FIN-BUS-REG-OPC.
       FIN-BUS-REG-OPC-PRO.
           EXIT.
      *
      *
      *
       BUS-REG-CVO-REL SECTION.
      *---------------------
       INI-BUS-REG-CVO-REL.
      * SI REGISTRO EXISTE EN CVO, ACUMULA  I REGRABA
      *
           MOVE OPC-CIC-IOPC IN OPC TO WSS-CIC-IOPC IN WSS-VARI.
           MOVE 'N'                 TO WSS-IND-EXISTE IN WSS-VARI.
      *
      *
           MOVE WSS-CIC-IOPC IN WSS-VARI TO CVO-CIC-IOPC IN CVO.
           MOVE FIO-GET-KEY              TO FIO-CMND.
           PERFORM COL-FIO-CVO.
           IF NOT FIO-STAT-OKS
               MOVE 'N'     TO WSS-IND-EXISTE IN WSS-VARI
               ADD   1      TO WSS-NUM-PCVO   IN WSS-VARI
               MOVE FIO-PUT TO FIO-CMND
           ELSE
               ADD   1      TO WSS-NUM-ACVO  IN WSS-VARI
               MOVE 'S'     TO WSS-IND-EXISTE IN WSS-VARI
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-CVO
               MOVE FIO-MOD TO FIO-CMND.

       GRABA-REG-CVO.
      *Datas de credito principal.
      *Fec.curse.
           MOVE OPC-NUM-DCOL IN OPC TO WSS-NUM-DCOL IN WSS-VARI.
           MOVE OPC-NUM-MCOL IN OPC TO WSS-NUM-MCOL IN WSS-VARI.
           MOVE OPC-NUM-ACOL IN OPC TO WSS-NUM-ACOL IN WSS-VARI.
      *
           PERFORM OBT-VCAM-FCOL.
      *-------------------------------------*
      *Buaca datos para el credito relacionado.
           PERFORM BUS-REG-OPC-REL.
           IF NOT FIO-STAT-OKS
              ADD 1 TO WSS-NUM-EOP2 IN WSS-VARI
              GO TO FIN-BUS-REG-CVO-REL.
      *
      *Vencimiento c.relacionado
           MOVE OPC-NUM-DCOL IN OPC TO WSS-NUM-DVD1 IN WSS-VARI.
           MOVE OPC-NUM-MCOL IN OPC TO WSS-NUM-MVD1 IN WSS-VARI.
           MOVE OPC-NUM-SCOL IN OPC TO WSS-NUM-SVD1 IN WSS-VARI.
           MOVE OPC-NUM-ACOL IN OPC TO WSS-NUM-AVD1 IN WSS-VARI.
      *
      *traspaso a cartera vencida.
           MOVE OPC-NUM-DINP IN OPC TO WSS-NUM-DINP IN WSS-VARI.
           MOVE OPC-NUM-MINP IN OPC TO WSS-NUM-MINP IN WSS-VARI.
           MOVE OPC-NUM-AINP IN OPC TO WSS-NUM-AINP IN WSS-VARI.
           MOVE OPC-NUM-SINP IN OPC TO WSS-NUM-SINP IN WSS-VARI.
      *
           IF  WSS-IND-EXISTE  IN WSS-VARI = 'S'
               GO TO ACT-VALORES-REL.
      *
           PERFORM MOVER-REG-CVM-CVO.
      *
      *Numero  credito original.
           MOVE WSS-CIC-IOPC IN WSS-VARI TO CVO-CIC-IOPC IN CVO.
      *
      *Fecha curse credito oroginal.
           MOVE WSS-FEC-FCOL IN WSS-VARI TO CVO-FEC-FCOL IN CVO.
      *
      *Fecha venciminto de la cuota (c.relacionado)
           MOVE WSS-NUM-DVD1 IN WSS-VARI TO CVO-NUM-DMAV IN CVO.
           MOVE WSS-NUM-MVD1 IN WSS-VARI TO CVO-NUM-MMAV IN CVO.
           MOVE WSS-NUM-AVD1 IN WSS-VARI TO CVO-NUM-AMAV IN CVO.
      *
      *traspaso a cartera vencida.
           MOVE WSS-NUM-DINP IN WSS-VARI TO CVO-NUM-DCVD IN CVO.
           MOVE WSS-NUM-MINP IN WSS-VARI TO CVO-NUM-MCVD IN CVO.
           MOVE WSS-NUM-AINP IN WSS-VARI TO CVO-NUM-ACVD IN CVO.
           COMPUTE
           CVO-VAL-SCRE IN CVO = ( CVM-VAL-SCRE IN CVM +
                                   WSS-VAL-ORIG IN WSS-VARI ).
           GO TO PUT-REG-CVO-REL.
      *---------------------------------------------------------*
       ACT-VALORES-REL.
      *Compara c.relacionados:fec.ingreso a cartera vencida.
           MOVE CVO-NUM-DMAV IN CVO TO WSS-NUM-DVD2 IN WSS-VARI.
           MOVE CVO-NUM-MMAV IN CVO TO WSS-NUM-MVD2 IN WSS-VARI.
           MOVE CVO-NUM-AMAV IN CVO TO WSS-NUM-AVD2 IN WSS-VARI.
           MOVE  20                 TO WSS-NUM-SVD2 IN WSS-VARI.
           IF CVO-NUM-AMAV IN CVO > 80
               MOVE  19  TO WSS-NUM-SVD2 IN WSS-VARI.
      *
           IF WSS-FEC-FVD1 IN WSS-VARI > WSS-FEC-FVD2 IN WSS-VARI
              MOVE WSS-NUM-DVD2 IN WSS-VARI TO
                                   WSS-NUM-DVD1 IN WSS-VARI
              MOVE WSS-NUM-MVD2 IN WSS-VARI TO
                                   WSS-NUM-MVD1 IN WSS-VARI
              MOVE WSS-NUM-SVD2 IN WSS-VARI TO
                                   WSS-NUM-SVD1 IN WSS-VARI
              MOVE WSS-NUM-AVD2 IN WSS-VARI TO
                                   WSS-NUM-AVD1 IN WSS-VARI.
      *
      *Compara c.relacionados:fec.Vencimiento.
           MOVE CVO-NUM-DCVD IN CVO TO WSS-NUM-DIN2 IN WSS-VARI.
           MOVE CVO-NUM-MCVD IN CVO TO WSS-NUM-MIN2 IN WSS-VARI.
           MOVE CVO-NUM-ACVD IN CVO TO WSS-NUM-AIN2 IN WSS-VARI.
           MOVE  20                 TO WSS-NUM-SIN2 IN WSS-VARI.
           IF CVO-NUM-ACVD IN CVO > 80
               MOVE  19  TO WSS-NUM-SIN2 IN WSS-VARI.
      *
           IF WSS-FEC-FINP IN WSS-VARI > WSS-FEC-FIN2 IN WSS-VARI
              MOVE WSS-NUM-DIN2 IN WSS-VARI TO
                                   WSS-NUM-DINP IN WSS-VARI
              MOVE WSS-NUM-MIN2 IN WSS-VARI TO
                                   WSS-NUM-MINP IN WSS-VARI
              MOVE WSS-NUM-SIN2 IN WSS-VARI TO
                                   WSS-NUM-SINP IN WSS-VARI
              MOVE WSS-NUM-AIN2 IN WSS-VARI TO
                                   WSS-NUM-AINP IN WSS-VARI.
      *-----------------------------------------------------*
      *Saldo del credito
           COMPUTE CVO-VAL-SCVD IN CVO =
                   CVO-VAL-SCVD IN CVO + CVM-VAL-SCVD IN CVM.
      *
      *Saldo del credito c.vencida.
           COMPUTE CVO-VAL-SCRE IN CVO =
                   CVO-VAL-SCRE IN CVO + CVM-VAL-SCRE IN CVM.
      *
      *-------------------------------------------------------
      * Rango en meses.
           MOVE 0 TO WSS-NUM-OPC1 IN WSS-VARI.
           IF CVM-GLS-RANG IN CVM = 'HASTA 24'
              MOVE 1 TO    WSS-NUM-OPC1 IN WSS-VARI
           ELSE
           IF CVM-GLS-RANG IN CVM = 'HASTA 36'
              MOVE 2 TO    WSS-NUM-OPC1 IN WSS-VARI
           ELSE
           IF CVM-GLS-RANG IN CVM = 'MAS DE 36'
              MOVE 3 TO    WSS-NUM-OPC1 IN WSS-VARI.
      *
      * Rango en meses.
           MOVE    0 TO    WSS-NUM-OPC2 IN WSS-VARI.
           IF CVO-GLS-RANG IN CVO = 'HASTA 24'
              MOVE 1 TO    WSS-NUM-OPC2 IN WSS-VARI
           ELSE
           IF CVO-GLS-RANG IN CVO = 'HASTA 36'
              MOVE 2 TO    WSS-NUM-OPC2 IN WSS-VARI
           ELSE
           IF CVO-GLS-RANG IN CVO = 'MAS DE 36'
              MOVE 3 TO    WSS-NUM-OPC2 IN WSS-VARI.
      *
           IF WSS-NUM-OPC2 IN WSS-VARI < WSS-NUM-OPC1 IN WSS-VARI
              MOVE CVM-GLS-RANG IN CVM  TO CVO-GLS-RANG IN CVO.
      *---------------------------------------------------------
      *
       PUT-REG-CVO-REL.
           MOVE ZERO                     TO CVO-VAL-GARA IN CVO.
           MOVE WSS-NUM-DVD1 IN WSS-VARI TO CVO-NUM-DMAV IN CVO.
           MOVE WSS-NUM-MVD1 IN WSS-VARI TO CVO-NUM-MMAV IN CVO.
           MOVE WSS-NUM-AVD1 IN WSS-VARI TO CVO-NUM-AMAV IN CVO.
      *
           MOVE WSS-NUM-DINP IN WSS-VARI TO CVO-NUM-DCVD IN CVO.
           MOVE WSS-NUM-MINP IN WSS-VARI TO CVO-NUM-MCVD IN CVO.
           MOVE WSS-NUM-AINP IN WSS-VARI TO CVO-NUM-ACVD IN CVO.
      *
           IF  WSS-IND-EXISTE  IN WSS-VARI = 'N'
               MOVE FIO-PUT TO FIO-CMND
           ELSE
               MOVE FIO-MOD TO FIO-CMND.
      *
           PERFORM COL-FIO-CVO.
           IF  NOT FIO-STAT-OKS
               DISPLAY 'ERROR GRABAR REG  = '
                        WSS-CIC-IOPC IN WSS-VARI
               GO TO FIN-BUS-REG-CVO-REL.
      *
           ADD  1      TO WSS-NUM-GCVO IN WSS-VARI.
      *
       FIN-BUS-REG-CVO-REL.
           EXIT.
      *
       BUS-REG-OPC-REL SECTION.
       INI-BUS-REG-OPC-REL.
      *Busca informacion del credito madre del relacionado.
           MOVE  SPACES              TO WSS-COD-MENS.
           MOVE  CVM-CIC-IOPC IN CVM TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY          TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
              MOVE 'NO-OPC RELACI' TO WSS-COD-MENS.
       FIN-BUS-REG-OPC-REL.
           EXIT.
      *
       BUS-REG-DLC-REL  SECTION.
       INI-BUS-REG-DLC-REL.
           MOVE  SPACES              TO WSS-COD-MENS.
           MOVE  CVM-CIC-IOPC IN CVM TO DLC-CIC-IOPC IN DLC.
           MOVE 1                    TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY          TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
              MOVE 'NO EXISTE DLC' TO WSS-COD-MENS
              GO TO FIN-BUS-REG-DLC-REL.
           ADD 1 TO WSS-NUM-LDLC IN WSS-VARI.
       FIN-BUS-REG-DLC-REL.
           EXIT.
      *
       GRA-REG-CVO  SECTION.
      *---------------------
       INI-GRA-REG-CVO.
      * Registro de graba Idem , como se lee.
           MOVE SPACES TO WSS-COD-MENS.
      *
           PERFORM BUS-REG-OPC-REL.
           IF WSS-COD-MENS > SPACES
              ADD 1 TO WSS-NUM-EOP1 IN WSS-VARI
              PERFORM GRA-REG-NO-COL
              GO TO FIN-GRA-REG-CVO.
      **
           PERFORM BUS-REG-DLC-REL.
           IF WSS-COD-MENS > SPACES
              ADD 1 TO WSS-NUM-EDLC IN WSS-VARI
              GO TO FIN-GRA-REG-CVO.

           MOVE OPC-CIC-IOPC IN OPC TO WSS-CIC-IOPC IN WSS-VARI.
           MOVE 'N'                 TO WSS-IND-EXISTE IN WSS-VARI.
      *
           MOVE OPC-CIC-IOPC IN OPC TO CVO-CIC-IOPC IN CVO.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-CVO.
           IF NOT FIO-STAT-OKS
               MOVE FIO-PUT TO FIO-CMND
           ELSE
               MOVE 'S' TO WSS-IND-EXISTE IN WSS-VARI
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-CVO
               MOVE FIO-MOD TO FIO-CMND.

      *Datas de credito principal.
      *Fec.curse.
           MOVE OPC-NUM-DCOL IN OPC TO WSS-NUM-DCOL IN WSS-VARI.
           MOVE OPC-NUM-MCOL IN OPC TO WSS-NUM-MCOL IN WSS-VARI.
           MOVE OPC-NUM-ACOL IN OPC TO WSS-NUM-ACOL IN WSS-VARI.
      *
      *Fec.maximo vencimiento.
           MOVE DLC-NUM-DMAV IN DLC TO WSS-NUM-DMAV IN WSS-VARI.
           MOVE DLC-NUM-MMAV IN DLC TO WSS-NUM-MMAV IN WSS-VARI.
           MOVE DLC-NUM-AMAV IN DLC TO WSS-NUM-AMAV IN WSS-VARI.
      *
           PERFORM OBT-VCAM-FCOL.
      *
      *Buaca datos para el credito relacionado.
           MOVE CVM-NUM-DCVD IN CVM TO WSS-NUM-DVD1 IN WSS-VARI.
           MOVE CVM-NUM-MCVD IN CVM TO WSS-NUM-MVD1 IN WSS-VARI.
           MOVE CVM-NUM-ACVD IN CVM TO WSS-NUM-AVD1 IN WSS-VARI.
           MOVE  20                 TO WSS-NUM-SVD1 IN WSS-VARI.
           IF CVM-NUM-ACVD IN CVM > 80
              MOVE  19  TO WSS-NUM-SVD1 IN WSS-VARI.
      *
      *
           IF  WSS-IND-EXISTE  IN WSS-VARI = 'S'
               GO TO ACT-VALORES-CVO.
      *
           PERFORM MOVER-REG-CVM-CVO.
      *
           MOVE WSS-CIC-IOPC IN WSS-VARI TO CVO-CIC-IOPC IN CVO.
           MOVE WSS-FEC-FCOL IN WSS-VARI TO CVO-FEC-FCOL IN CVO.
           MOVE WSS-FEC-FMAV IN WSS-VARI TO CVO-FEC-FMAV IN CVO.
      *
      * Saldo del credito
           MOVE CVM-VAL-SCRE IN CVM      TO CVO-VAL-SCRE IN CVO.
      *
           GO TO PUT-REG-CVO.

       ACT-VALORES-CVO.
           MOVE CVO-NUM-DCVD IN CVO TO WSS-NUM-DVD2 IN WSS-VARI.
           MOVE CVO-NUM-MCVD IN CVO TO WSS-NUM-MVD2 IN WSS-VARI.
           MOVE CVO-NUM-ACVD IN CVO TO WSS-NUM-AVD2 IN WSS-VARI.
           MOVE  20                 TO WSS-NUM-SVD2 IN WSS-VARI.
           IF CVO-NUM-ACVD IN CVO > 80
               MOVE  19  TO WSS-NUM-SVD2 IN WSS-VARI.
      *
      *Saldo del credito
           COMPUTE CVO-VAL-SCRE IN CVO =
                   CVO-VAL-SCRE IN CVO + CVM-VAL-SCRE IN CVM.
      *
      *Saldo del credito c.Vencida.
           COMPUTE CVO-VAL-SCVD IN CVO =
                   CVO-VAL-SCVD IN CVO + CVM-VAL-SCVD IN CVM.
      *
      *
           IF WSS-FEC-FVD1 IN WSS-VARI > WSS-FEC-FVD2 IN WSS-VARI
              MOVE WSS-NUM-DVD2 IN WSS-VARI TO
                                   WSS-NUM-DVD1 IN WSS-VARI
              MOVE WSS-NUM-MVD2 IN WSS-VARI TO
                                   WSS-NUM-MVD1 IN WSS-VARI
              MOVE WSS-NUM-SVD2 IN WSS-VARI TO
                                   WSS-NUM-SVD1 IN WSS-VARI
              MOVE WSS-NUM-AVD2 IN WSS-VARI TO
                                   WSS-NUM-AVD1 IN WSS-VARI.
      *Rango
      *-------------------------------------------------------
      * Rango en meses.
           MOVE 0 TO WSS-NUM-OPC1 IN WSS-VARI.
           IF CVM-GLS-RANG IN CVM = 'HASTA 24'
              MOVE 1 TO    WSS-NUM-OPC1 IN WSS-VARI
           ELSE
           IF CVM-GLS-RANG IN CVM = 'HASTA 36'
              MOVE 2 TO    WSS-NUM-OPC1 IN WSS-VARI
           ELSE
           IF CVM-GLS-RANG IN CVM = 'MAS DE 36'
              MOVE 3 TO    WSS-NUM-OPC1 IN WSS-VARI.
      *
      * Rango en meses.
           MOVE    0 TO    WSS-NUM-OPC2 IN WSS-VARI.
           IF CVO-GLS-RANG IN CVO = 'HASTA 24'
              MOVE 1 TO    WSS-NUM-OPC2 IN WSS-VARI
           ELSE
           IF CVO-GLS-RANG IN CVO = 'HASTA 36'
              MOVE 2 TO    WSS-NUM-OPC2 IN WSS-VARI
           ELSE
           IF CVO-GLS-RANG IN CVO = 'MAS DE 36'
              MOVE 3 TO    WSS-NUM-OPC2 IN WSS-VARI.
      *
           IF WSS-NUM-OPC2 IN WSS-VARI < WSS-NUM-OPC1 IN WSS-VARI
              MOVE CVM-GLS-RANG IN CVM  TO CVO-GLS-RANG IN CVO.
      *---------------------------------------------------------
       PUT-REG-CVO.
           MOVE ZERO                     TO CVO-VAL-GARA IN CVO.
           MOVE WSS-NUM-DVD1 IN WSS-VARI TO CVO-NUM-DCVD IN CVO.
           MOVE WSS-NUM-MVD1 IN WSS-VARI TO CVO-NUM-MCVD IN CVO.
           MOVE WSS-NUM-AVD1 IN WSS-VARI TO CVO-NUM-ACVD IN CVO.
      *
           IF  WSS-IND-EXISTE  IN WSS-VARI = 'N'
               ADD 1 TO WSS-NUM-PCV2 IN WSS-VARI
               MOVE FIO-PUT TO FIO-CMND
           ELSE
               ADD 1 TO WSS-NUM-ACV2 IN WSS-VARI
               MOVE FIO-MOD TO FIO-CMND.
      *
           PERFORM COL-FIO-CVO.
           IF  NOT FIO-STAT-OKS
               DISPLAY 'ERROR GRABAR REG  '
               WSS-CIC-IOPC IN WSS-VARI
               GO TO FIN-GRA-REG-CVO.
      *
           ADD  1      TO WSS-NUM-GCVO IN WSS-VARI.
           ADD  1      TO WSS-NUM-GNRE IN WSS-VARI.
      *
       FIN-GRA-REG-CVO.
           EXIT.
       GRA-REG-NO-COL SECTION.
       INI-GRA-REG-NO-OPC.
           MOVE SPACES TO WSS-COD-MENS.
      *
           MOVE CVM TO CVO.
           DISPLAY 'CREDITOS NO COL ' CVM-CIC-IOPC IN CVM.
      *
           ADD 1 TO WSS-NUM-NOCOL IN  WSS-VARI.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-CVO.
           IF  NOT FIO-STAT-OKS
               DISPLAY 'ERROR GRABAR REG  '
               CVM-CIC-IOPC IN CVM
               GO TO FIN-GRA-REG-NO-COL.
      *
           ADD  1      TO WSS-NUM-GCVO IN WSS-VARI.
           ADD  1      TO WSS-NUM-GNRE IN WSS-VARI.
      *
       FIN-GRA-REG-NO-COL.
           EXIT.
      *
       BUS-VAL-GARANTIA SECTION.
       INI-VAL-GARANTIA.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SUP-FIO-D01.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ERROR ABRIR ARCHIVO D01 ()' FIO-STAT
              PERFORM GNS-PRO-ABT.
      *
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM COL-FIO-CVO.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ERROR ABRIR ARCHIVO CVO (GARA)' FIO-STAT
              PERFORM GNS-PRO-ABT.
      *
           MOVE SPACES                   TO CVO-CIC-IOPC IN CVO.
           MOVE FIO-GET-NLS              TO FIO-CMND.
           PERFORM COL-FIO-CVO.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ERROR AL LEER PRIMER REG.CVO: ' FIO-STAT
              GO TO FIN-VAL-GARANTIA.
      *
       LUP-BUS-GARANTIA-REAL.
      *
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-CVO
      *
           MOVE CVO-NUM-ICLI IN CVO TO D01-NUM-RUTD  IN D01.
           MOVE CVO-VRF-ICLI IN CVO TO D01-VRF-RUTD  IN D01.
           MOVE '2'                 TO D01-IND-TREG  IN D01.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM SUP-FIO-D01.
           IF NOT ( FIO-STAT-OKS  AND
              CVO-NUM-ICLI IN CVO =  D01-NUM-RUTD  IN D01 AND
              CVO-VRF-ICLI IN CVO =  D01-VRF-RUTD  IN D01 )
              DISPLAY 'NO EXISTE RUT: D01 '
              CVO-NUM-ICLI  IN CVO ' - ' CVO-VRF-ICLI IN CVO
              GO TO NXT-GARANTIA-REAL.
      *
           MULTIPLY  D01-VAL-GLGB IN D01   BY 1000
           GIVING CVO-VAL-GARA IN CVO  ROUNDED.
      *
           IF CVO-VAL-GARA IN CVO > CVO-VAL-SCVD IN CVO
              MOVE CVO-VAL-SCVD IN CVO TO CVO-VAL-GARA IN CVO.
      *
      *
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-CVO.
           IF  NOT FIO-STAT-OKS
               DISPLAY 'ERROR MODIFICAR VALOR GARANTIA '.
      *
       NXT-GARANTIA-REAL.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-CVO.
           IF NOT FIO-STAT-OKS
              DISPLAY 'FIN DE ARCHIVO CVO: '
              GO TO FIN-VAL-GARANTIA.
      *
           GO TO LUP-BUS-GARANTIA-REAL.
       FIN-VAL-GARANTIA.
           MOVE FIO-CLO TO FIO-CMND
           PERFORM SUP-FIO-D01.
      *
           MOVE FIO-CLO TO FIO-CMND
           PERFORM COL-FIO-CVO.
       CLO-VAL-GARATIA.
           EXIT.
      *
       OBT-VCAM-FCOL SECTION.
       INI-OBT-VCAM-FCOL.
           IF OPC-COD-VCOC IN OPC   = '0998  '   AND
              OPC-IND-RENO IN OPC   = 'PRO'
              PERFORM BUS-REG-OPC-PRO .
      *
           IF OPC-MSC-TVOC IN OPC   = MSC-COD-CMSC IN MSC
               MOVE OPC-COD-VCOC IN OPC     TO TAB-COD-CTAB IN TAB
               MOVE '0999  '                TO TAB-CIC-CTAB IN TAB
               MOVE OPC-NUM-DCOL IN OPC     TO TAB-NUM-DTRN IN TAB
               MOVE OPC-NUM-MCOL IN OPC     TO TAB-NUM-MTRN IN TAB
               MOVE OPC-NUM-SCOL IN OPC     TO TAB-NUM-STRN IN TAB
               MOVE OPC-NUM-ACOL IN OPC     TO TAB-NUM-ATRN IN TAB
               PERFORM GET-VCAM
               IF MSG-COD-MENS IN MSG NOT > SPACES
                   MULTIPLY CAM-SGV-VCAM IN CAM BY
                            OPC-VAL-SCRE IN OPC  GIVING
                            WSS-VAL-ORIG IN WSS-VARI
               ELSE
                   IF MSG-COD-MENS IN MSG = 'CODVCAMEQL'
                       MOVE 1 TO CAM-SGV-VCAM IN CAM
                       MOVE SPACES TO MSG-COD-MENS IN MSG
                       MOVE OPC-VAL-SCRE IN OPC   TO WSS-VAL-ORIG
                                                      IN WSS-VARI
                   ELSE
                       GO TO FIN-OBT-VCAM-FCOL
           ELSE
               MOVE OPC-VAL-SCRE IN OPC TO WSS-VAL-ORIG IN WSS-VARI.
        FIN-OBT-VCAM-FCOL.
            EXIT.
      *******************************************
        BUS-MONEDA-CABIO SECTION.
        INI-BUS-MONEDA-CABIO.
      * Si es moneda Nacional transformar a Pesos.
           MOVE 'TVAL' TO MSC-CIC-TMSC IN MSC.
           MOVE '0'    TO MSC-CIC-CMSC IN MSC.
           MOVE 'TAB' TO FIO-SIST.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO MSC-COD-CMSC IN MSC.
        FIN-BUS-MONEDA-CABIO.
            EXIT.
      *******************************************
       MOVER-REG-CVM-CVO  SECTION.
       INI-MOVER-REG-CVM-CVO.
      * Rut
            MOVE CVM-RUT-ICLI IN CVM TO CVO-RUT-ICLI IN CVO.
      *
      * Nombre
            MOVE CVM-GLS-NOMB IN CVM TO CVO-GLS-NOMB IN CVO.
      *
      * Tipo de credito
            MOVE CVM-COD-TCRE IN CVM TO CVO-COD-TCRE IN CVO.
      *
      * CIC- del Credito
            MOVE CVM-CIC-IOPC IN CVM TO CVO-CIC-IOPC IN CVO.
      *
      * P.contable.
            MOVE CVM-COD-PCTB IN CVM TO CVO-COD-PCTB IN CVO.
      *
      * Clasifica
            MOVE CVM-COD-CLAS IN CVM TO CVO-COD-CLAS IN CVO.
      *
      *Saldo Credito
            MOVE CVM-VAL-SCRE IN CVM TO CVO-VAL-SCRE IN CVO.
      *
      *Saldo Credito C.Vencida
            MOVE CVM-VAL-SCVD IN CVM TO CVO-VAL-SCVD IN CVO.
            MOVE CVM-VAL-GARA IN CVM TO CVO-VAL-GARA IN CVO.
            MOVE CVM-GLS-FIL1 IN CVM TO CVO-GLS-FIL1 IN CVO.
            MOVE CVM-FEC-FCOL IN CVM TO CVO-FEC-FCOL IN CVO.
            MOVE CVM-FEC-FMAV IN CVM TO CVO-FEC-FMAV IN CVO.
            MOVE CVM-FEC-FCVD IN CVM TO CVO-FEC-FCVD IN CVO.
            MOVE CVM-GLS-FIL2 IN CVM TO CVO-GLS-FIL2 IN CVO.
            MOVE CVM-GLS-RANG IN CVM TO CVO-GLS-RANG IN CVO.
            MOVE CVM-GLS-DISP IN CVM TO CVO-GLS-DISP IN CVO.

       FIN-MOVER-REG-CVM-CVO.
           EXIT.
       MUESTRA-ESTADISTICAS SECTION.
       INI-MUESTRA-ESTADISTICAS.
           DISPLAY 'ESTADISTICAS PROCESO: COLPGCVM '.
           DISPLAY '==============================='.
           DISPLAY ' REGISTROS LEIDOS         : ' WSS-NUM-LCVM.
           DISPLAY ' REGISTROS GRABADOS       : ' WSS-NUM-GCVO.
           DISPLAY '==============================='.
           DISPLAY ' REGISTROS GRABADOS NO COL: ' WSS-NUM-NOCOL.
           DISPLAY ' CVO  PUT                 : ' WSS-NUM-PCVO.
           DISPLAY ' CVO  ACT                 : ' WSS-NUM-ACVO.
           DISPLAY ' CVO  PUT      (SIN ROV)  : ' WSS-NUM-PCV2.
           DISPLAY ' CVO  ACT      (SIN ROV)  : ' WSS-NUM-ACV2.
           DISPLAY '==============================='.
           DISPLAY ' ROV             (ERROR)  : ' WSS-NUM-EROV.
           DISPLAY ' OPC-ORIGINAL    (ERROR)  : ' WSS-NUM-EOP1.
           DISPLAY ' OPC-RELACIONADA (ERROR)  : ' WSS-NUM-EOP2.
           DISPLAY '==============================='.
       FIN-MUESTRA-ESTADISTICAS.
           EXIT.
      *******************************************
       LEE-PARAM SECTION.
      *-----------------
       INI-LEE-PARAM.
           DISPLAY 'CAPTURA PARAMETROS'.
           DISPLAY ' '.

      * Captura Fecha de Proceso
           DISPLAY 'FECHA DE PROCESO (DDMMSSAA): '.
           ACCEPT WSS-FEC-FPRO IN WSS-VARI.
           DISPLAY WSS-FEC-FPRO IN WSS-VARI.

      * Validacion de parametros
           MOVE WSS-FEC-FPRO IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY 'ERROR VALIDACION FECHA DE PROCESO: '
                                                    FEC-MENS
               PERFORM GNS-PRO-ABT.
      *
           ACCEPT WSS-IND-PROC IN WSS-VARI.
           DISPLAY 'INDICADOR DE PROCESO/REPROCESO: '
                                 WSS-IND-PROC IN WSS-VARI.
      *
           IF WSS-IND-PROC IN WSS-VARI NOT = 'P' AND 'R'
               MOVE 'P' TO WSS-IND-PROC IN WSS-VARI.
       FIN-LEE-PARAM.
           EXIT.
      ******************
       COPY COLBFCVM.
       COPY COLBFCVO.
       COPY SUPIOD01.
      ******************
       COPY COLBFROV.
       COPY COLBFROP.

       COPY GNSBFMSG.
       COPY GNSBFMSC.
       COPY GNSBFTAB.

       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY GNSBGHOY.
       COPY GNSBGEND.
       COPY GNSBGABT.

       COPY GNSBBMSG.

       COPY TABBFCAM.
       COPY GNSBGCAM.

      *COPY COLBFOPC.
      * Modulo FIO para registro OPC en DATACOM, 25-MAR-1993 10:00:37.98
       COL-FIO-OPC SECTION.
       INI-COL-FIO-OPC.
           MOVE ADR-OPC-REQA TO ADR-REQA.
           MOVE 'OPC' TO ADR-TABL IN ADR-REQA.
      *
           IF WSS-IND-PROC IN WSS-VARI = 'R'
               MOVE +162 TO ADR-DBID IN ADR-REQA
               GO TO FSR-COL-FIO-OPC.

           MOVE 'COL'  TO IDD-SAUX.
           MOVE 'M'    TO IDD-GAUX.
           MOVE SPACES TO IDD-RAUX.
           MOVE 1 TO IDD-IAUX.
           SET IDD-ITBL TO 1.
           SEARCH IDD-VSIS VARYING IDD-IAUX
             AT END
               GO TO GRP-COL-FIO-OPC
             WHEN IDD-DENT( IDD-ITBL ) = IDD-DAUX
               MOVE IDD-IENT( IDD-ITBL) TO ADR-DBID IN ADR-REQA
               GO TO FSR-COL-FIO-OPC.
       GRP-COL-FIO-OPC.
           MOVE SPACES TO IDD-GAUX.
           MOVE 1      TO IDD-IAUX.
           SET IDD-ITBL TO 1.
           SEARCH IDD-VSIS VARYING IDD-IAUX
             AT END
               MOVE 'En COL-FIO-OPC, NO existe en IDD:' TO FIO-MEN1
               MOVE IDD-DAUX                            TO FIO-MEN2
               PERFORM PRG-ABT
             WHEN IDD-DENT( IDD-ITBL ) = IDD-DAUX
               MOVE IDD-IENT( IDD-ITBL) TO ADR-DBID IN ADR-REQA.
       FSR-COL-FIO-OPC.
      *
           MOVE 'OPC00' TO ADR-ELM1.
           MOVE FIO-PROG TO ADR-PROG.
           IF FIO-KDEF = FIO-KDEF-S
               GO TO CON-COL-FIO-OPC.
           MOVE FIO-CMND TO FIO-IAKY.
           IF NOT FIO-IAKY-CON AND
              ( FIO-AKEY = 'OPC-KEY-IOPC' OR FIO-AKEY NOT > SPACES )
               MOVE OPC-KEY-IOPC IN OPC TO ADR-VKEY IN ADR-REQA
               MOVE 'OPC00' TO ADR-DKEY IN ADR-REQA
           ELSE
           IF FIO-AKEY = 'OPC-FEC-FCOL'
               MOVE OPC-FEC-FCOL IN OPC TO ADR-VKEY IN ADR-REQA
               MOVE 'OPC01' TO ADR-DKEY IN ADR-REQA
           ELSE
           IF FIO-AKEY = 'OPC-FEC-FING'
               MOVE OPC-FEC-FING IN OPC TO ADR-VKEY IN ADR-REQA
               MOVE 'OPC02' TO ADR-DKEY IN ADR-REQA
           ELSE
           IF FIO-AKEY = 'OPC-FEC-FINP'
               MOVE OPC-FEC-FINP IN OPC TO ADR-VKEY IN ADR-REQA
               MOVE 'OPC03' TO ADR-DKEY IN ADR-REQA
           ELSE
               MOVE 'En COL-FIO-OPC, key' TO FIO-MENS
               MOVE FIO-AKEY   TO FIO-MENS-KEY
               MOVE 'Invalida' TO FIO-MENS-FIL
               PERFORM PRG-ABT.
       CON-COL-FIO-OPC.
           MOVE OPC TO FIO-DFLD.
           PERFORM GNS-FIO-DTC.
           IF FIO-STAT-OKS
               MOVE FIO-DFLD TO OPC
           ELSE
               MOVE 'COLOPC' TO FIO-MEN2
               IF FIO-STAT-FTL
                   PERFORM PRG-ABT.
           MOVE SPACES   TO FIO-AKEY.
           MOVE FIO-KDEF-N TO FIO-KDEF.
           MOVE ADR-REQA TO ADR-OPC-REQA.
       FIN-COL-FIO-OPC.
           EXIT.
      *COPY COLBFDLC.
      * Modulo FIO para registro DLC en DATACOM, 25-MAR-1993 09:59:30.49
       COL-FIO-DLC SECTION.
       INI-COL-FIO-DLC.
           MOVE ADR-DLC-REQA TO ADR-REQA.
           MOVE 'DLC' TO ADR-TABL IN ADR-REQA.
      *
           IF WSS-IND-PROC IN WSS-VARI = 'R'
               MOVE +162 TO ADR-DBID IN ADR-REQA
               GO TO FSR-COL-FIO-DLC.

           MOVE 'COL'  TO IDD-SAUX.
           MOVE 'M'    TO IDD-GAUX.
           MOVE SPACES TO IDD-RAUX.
           MOVE 1 TO IDD-IAUX.
           SET IDD-ITBL TO 1.
           SEARCH IDD-VSIS VARYING IDD-IAUX
             AT END
               GO TO GRP-COL-FIO-DLC
             WHEN IDD-DENT( IDD-ITBL ) = IDD-DAUX
               MOVE IDD-IENT( IDD-ITBL) TO ADR-DBID IN ADR-REQA
               GO TO FSR-COL-FIO-DLC.
       GRP-COL-FIO-DLC.
           MOVE SPACES TO IDD-GAUX.
           MOVE 1      TO IDD-IAUX.
           SET IDD-ITBL TO 1.
           SEARCH IDD-VSIS VARYING IDD-IAUX
             AT END
               MOVE 'En COL-FIO-DLC, NO existe en IDD:' TO FIO-MEN1
               MOVE IDD-DAUX                            TO FIO-MEN2
               PERFORM PRG-ABT
             WHEN IDD-DENT( IDD-ITBL ) = IDD-DAUX
               MOVE IDD-IENT( IDD-ITBL) TO ADR-DBID IN ADR-REQA.
       FSR-COL-FIO-DLC.
      *
           MOVE 'DLC00' TO ADR-ELM1.
           MOVE FIO-PROG TO ADR-PROG.
           IF FIO-KDEF = FIO-KDEF-S
               GO TO CON-COL-FIO-DLC.
           MOVE FIO-CMND TO FIO-IAKY.
           IF NOT FIO-IAKY-CON AND
              ( FIO-AKEY = 'DLC-KEY-IDLC' OR FIO-AKEY NOT > SPACES )
               MOVE DLC-KEY-IDLC IN DLC TO ADR-VKEY IN ADR-REQA
               MOVE 'DLC00' TO ADR-DKEY IN ADR-REQA
           ELSE
           IF FIO-AKEY = 'DLC-IND-SCTB'
               MOVE DLC-IND-SCTB IN DLC TO ADR-VKEY IN ADR-REQA
               MOVE 'DLC01' TO ADR-DKEY IN ADR-REQA
           ELSE
               MOVE 'En COL-FIO-DLC, key' TO FIO-MENS
               MOVE FIO-AKEY   TO FIO-MENS-KEY
               MOVE 'Invalida' TO FIO-MENS-FIL
               PERFORM PRG-ABT.
       CON-COL-FIO-DLC.
           MOVE DLC TO FIO-DFLD.
           PERFORM GNS-FIO-DTC.
           IF FIO-STAT-OKS
               MOVE FIO-DFLD TO DLC
           ELSE
               MOVE 'COLDLC' TO FIO-MEN2
               IF FIO-STAT-FTL
                   PERFORM PRG-ABT.
           MOVE SPACES   TO FIO-AKEY.
           MOVE FIO-KDEF-N TO FIO-KDEF.
           MOVE ADR-REQA TO ADR-DLC-REQA.
       FIN-COL-FIO-DLC.
           EXIT.
