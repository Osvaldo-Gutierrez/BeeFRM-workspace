       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPGFD3.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    18-APR-96    (ULTIMA MODIFICACION).

      * Programa Generador Interfaz D3 Super-Bancos de COL.

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------

       WORKING-STORAGE SECTION.
      *-----------------------
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
      *>>>>

       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.

      *<<<< WSS
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSBRMSC.
       COPY COLBROPC.
       COPY COLBRDLC.
       COPY COLBRICG.
       COPY COLBRTOC.
       COPY COLBRDCC.
       COPY COLBRRD3.
      *ALD-BCI-INI/05.04.1999
       COPY COLBRRH3.
      *ALD-BCI-FIN/05.04.1999
       COPY SUPBRFD3.
      *RVM-CST-INI 18-JAN-1996
       COPY SUPBRZ04.
       COPY SUPBRCC3.
      *RVM-CST-FIN 18-JAN-1996
       COPY TABBROFI.
       COPY TABBRCAM.
       COPY TABBRCOM.
       COPY TABBRTIO.
       COPY GNSWGPES.
       COPY COLWGCTO.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY COLWGINT.
       COPY GNSWGCVI.
      *ALD-BCI-INI/03.05.1999
       COPY TABWGTXC.
      *ALD-BCI-FIN/03.05.1999

       01  WSS-VARI.
      *ALD-BCI-INI/05051999
           03  WSS-CRED-ORIG     COMP-3          PIC S9(11)V9(04).
           03  WSS-IND-TXC  VALUE 'N'            PIC X(01).
      *ALD-BCI-FIN/05051999
      *ALD-BCI-INI/15.04.1999
           03  WSS-IND-VTMC                       PIC X(01).
      *ALD-BCI-FIN/15.04.1999
      *RVM-CST-INI 18-JAN-1996
           03  WSS-COD-RMTP                       PIC X(01).
           03  AUX-CIC-IOPC                       PIC X(12).
           03  WSS-FEC-FORI.
               05  WSS-NUM-SORI                   PIC 9(02).
               05  WSS-NUM-AORI                   PIC 9(02).
               05  WSS-NUM-MORI                   PIC 9(02).
               05  WSS-NUM-DORI                   PIC 9(02).
           03 WSS-VAL-NDLC   VALUE ZEROES   PIC ZZZZZZZZZZZZZ9,9999.
           03 WSS-VAL-UF05        VALUE ZEROES         PIC 9(14).
           03 WSS-VAL-UF10        VALUE ZEROES         PIC 9(14).
           03 WSS-COD-GCAB        VALUE SPACES         PIC X(01).
           03 WSS-FEC-REFE.
              05 WSS-NUM-AREF                          PIC X(02).
              05 WSS-NUM-MREF                          PIC X(02).
           03 WSS-GLS-PARA.
              05 WSS-FEC-FINF.
                 07 WSS-NUM-DINF                       PIC 9(02).
                 07 WSS-NUM-MINF                       PIC 9(02).
                 07 WSS-NUM-SINF                       PIC 9(02).
                 07 WSS-NUM-AINF                       PIC 9(02).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP1                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP2                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP3                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP4                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP5                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP6                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP7                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP8                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP9                          PIC X(06).
              05 FILLER                                PIC X(01).
              05 WSS-COD-COP10                         PIC X(06).
      *RVM-CST-FIN 18-JAN-1996
           03 WSS-FEC-FIN1.
              05 WSS-NUM-SIN1                          PIC 9(02).
              05 WSS-NUM-AIN1                          PIC 9(02).
              05 WSS-NUM-MIN1                          PIC 9(02).
              05 WSS-NUM-DIN1                          PIC 9(02).
           03 WSS-FEC-FHBL.
              05 WSS-NUM-SHBL                          PIC 9(02).
              05 WSS-NUM-AHBL                          PIC 9(02).
              05 WSS-NUM-MHBL                          PIC 9(02).
              05 WSS-NUM-DHBL                          PIC 9(02).
           03 WSS-IND-STAT         VALUE 0             PIC 9(01).
           03 WSS-IND-TEQV         VALUE 0             PIC 9(01).
           03 WSS-COD-OFOC                             PIC X(03).
           03 WSS-COD-PESO                             PIC X(06).
           03 WSS-COD-UEFE                             PIC X(06).
           03 WSS-COD-DOLA                             PIC X(06).
           03 WSS-SGV-UEFE                             PIC S9(11)V9999.
           03 WSS-SGV-DOLA                             PIC S9(11)V9999.
           03 WSS-SGV-FINF                             PIC S9(11)V9999.
           03 WSS-VAL-PPON                             PIC S9(14)V9999.
           03 WSS-VAL-SPRD                             PIC S9(03)V9999.
           03 WSS-VAL-TASA                             PIC S9(03)V9999.
           03 WSS-VAL-TEQV                             PIC S9(03)V9999.
           03 WSS-VAL-TB90                             PIC 9(03)V9(04).
           03 WSS-VAL-TS90                             PIC 9(03)V9(04).
           03 WSS-VAL-TREA                             PIC 9(03)V9(04).
           03 WSS-VAL-TMEX                             PIC 9(03)V9(04).
           03 WSS-VAL-TMXC                             PIC 9(03)V9(04).
      *ALD-BCI-INI/14.05.1999
           03 WSS-VAL-TRAM                             PIC 9(11)V9(04).
      *ALD-BCI-FIN/14.05.1999
      *ALD-BCI-FIN/05.04.1999
           03 WSS-VAL-TMCC                             PIC 9(03)V9(04).
      *ALD-BCI-FIN/05.04.1999
      *RVM-CST-INI 16-JAN-1996
      *     03 WSS-NUM-IOFI                             PIC 9(02).
           03 WSS-NUM-IOFI                             PIC 9(03).
      *RVM-CST-FIN 16-JAN-1996
           03 WSS-HBL-DIAS                             PIC 9(02).
           03 WSS-OFIC                                 PIC 9(04).
           03 WSS-OPEC                                 PIC X(01).
           03 WSS-IND              VALUE 0             PIC 9(03).
           03 WSS-SUB              VALUE 0             PIC 9(03).
      *ALD-BCI-INI/05.04.1999
           03 WSS-NUM-RRH3         VALUE 0             PIC 9(07).
      *ALD-BCI-FIN/05.04.1999
           03 WSS-NUM-OPCL         VALUE 0             PIC 9(07).
           03 WSS-NUM-OPCS         VALUE 0             PIC 9(07).
           03 WSS-NUM-OPCP         VALUE 0             PIC 9(07).
           03 WSS-NUM-OPCR         VALUE 0             PIC 9(07).
           03 WSS-NUM-DLCL         VALUE 0             PIC 9(07).
           03 WSS-NUM-DLCS         VALUE 0             PIC 9(07).
           03 WSS-NUM-DLCP         VALUE 0             PIC 9(07).
           03 WSS-NUM-FD3G         VALUE 0             PIC 9(07).
           03 WSS-NUM-RD3G         VALUE 0             PIC 9(07).
      *RVM-CST-INI 18-JAN-1996
           03 WSS-NUM-Z04G         VALUE 0             PIC 9(07).
           03 WSS-NUM-CC3L         VALUE 0             PIC 9(07).
           03 WSS-NUM-CC3P         VALUE 0             PIC 9(07).
      *RVM-CST-FIN 18-JAN-1996

       01  WSS-VEC.
      *RVM-CST-INI 16-JAN-1996
      *     03 WSS-ELE-OFIC   OCCURS 99   INDEXED BY   WSS-NUM-OFIC.
      *        05 WSS-COD-OFIC                          PIC X(03).
           03 WSS-ELE-OFIC   OCCURS 200   INDEXED BY   WSS-NUM-OFIC.
              05 WSS-COD-OFIC                          PIC X(03).

       01  WSS-MAT-Z04.
           03 WSS-ELE-Z04 OCCURS 44.
      *RVM-CST-INI 18-APR-1996
      *       05 WSS-CONT-Z04                       PIC 9(03).
              05 WSS-CONT-Z04                       PIC 9(06).
      *RVM-CST-FIN 18-APR-1996

              05 WSS-MT05-Z04                       PIC 9(14).
              05 WSS-PP05-Z04                       PIC 9(14).
              05 WSS-TP05-Z04                       PIC 9(03)V9(02).

              05 WSS-MT10-Z04                       PIC 9(14).
              05 WSS-PP10-Z04                       PIC 9(14).
              05 WSS-TP10-Z04                       PIC 9(03)V9(02).
      *RVM-CST-FIN 16-JAN-1996

       01  WSS-MAT.
           03 WSS-ELE OCCURS 44.
      *RVM-CST-INI 18-APR-1996
      *       05 WSS-CONT                           PIC 9(03).
              05 WSS-CONT                           PIC 9(06).
      *RVM-CST-FIN 18-APR-1996
              05 WSS-TMIN                           PIC 9(03)V9(02).
              05 WSS-TMAX                           PIC 9(03)V9(02).
              05 WSS-MONT                           PIC 9(14)V9(04).
              05 WSS-PPON                           PIC 9(14)V9(04).
              05 WSS-TPPO                           PIC 9(03)V9(02).
           03 WSS-MTVA                              PIC 9(14)V9(04).


       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'COLPGFD3' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.

      * Captura Fecha de Proceso
           DISPLAY 'INGRESE FECHA DEL INFORME (DDMMSSAA) / CLASES'.
           ACCEPT  WSS-GLS-PARA IN WSS-VARI.
           DISPLAY WSS-GLS-PARA IN WSS-VARI.
      * Captura Codigo de Oficina
           DISPLAY 'OFICINA (RM=REGION METROPOLITANA/*=BANCO): '.
           ACCEPT  WSS-COD-OFOC IN WSS-VARI.
           DISPLAY WSS-COD-OFOC IN WSS-VARI.
      *RVM-CST-INI 18-JAN-1996
      * Captura Codigo de Oficina
           DISPLAY 'GRABA REGISTRO CABECERA (S/*) : '.
           ACCEPT  WSS-COD-GCAB IN WSS-VARI.
           DISPLAY WSS-COD-GCAB IN WSS-VARI.
      *ALD-BCI-INI/29.01.1996
      * REGION METROPOLITANA
      *     DISPLAY 'SUPFD3 REGION METROPOLITANA ?  (S/*) : '.
      *     ACCEPT  WSS-COD-RMTP IN WSS-VARI.
      *     DISPLAY WSS-COD-RMTP IN WSS-VARI.
      *ALD-BCI-FIN/29.01.1996
      *RVM-CST-FIN 18-JAN-1996
      *ALD-BCI-INI/15.04.1999
      * CAPTURA INDICADOR DE VALIDACION TMC
           DISPLAY 'INDICADOR VALIDA TMC A F INGRESO  S/N  : '.
           ACCEPT  WSS-IND-VTMC IN WSS-VARI.
           DISPLAY WSS-IND-VTMC IN WSS-VARI.
      *ALD-BCI-FIN/15.04.1999

           DISPLAY 'FIN    CAPTURA DE PARAMETROS'.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.
      *ALD-BCI-INI/15.04.1999
           IF NOT ( WSS-IND-VTMC IN WSS-VARI = 'S' OR
                    WSS-IND-VTMC IN WSS-VARI = 'N' )
               DISPLAY 'INDICADOR DE VALIDACION TMC DEBE SER S / N  :'
               PERFORM GNS-PRO-ABT.
      *ALD-BCI-FIN/15.04.1999
      *VAL-FEC Valida Fecha de Informe
           DISPLAY 'FECHA DEL INFORME : ' WSS-FEC-FINF IN WSS-VARI.
           MOVE WSS-FEC-FINF IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-ABT.

           MOVE WSS-NUM-DINF IN WSS-VARI TO WSS-NUM-DIN1 IN WSS-VARI.
           MOVE WSS-NUM-MINF IN WSS-VARI TO WSS-NUM-MIN1 IN WSS-VARI.
           MOVE WSS-NUM-SINF IN WSS-VARI TO WSS-NUM-SIN1 IN WSS-VARI.
           MOVE WSS-NUM-AINF IN WSS-VARI TO WSS-NUM-AIN1 IN WSS-VARI.

      *RVM-CST-INI 18-JAN-1996
           MOVE WSS-NUM-AIN1 IN WSS-VARI TO WSS-NUM-AREF IN WSS-VARI.
           MOVE WSS-NUM-MIN1 IN WSS-VARI TO WSS-NUM-MREF IN WSS-VARI.
      *RVM-CST-FIN 18-JAN-1996

      *VAL-OFI Valida codigo de Oficina en TABLAS
           IF WSS-COD-OFOC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-OFOC IN WSS-VARI.
      *ALD-BCI-INI/29.01.1996
           IF WSS-COD-OFOC IN WSS-VARI = 'RM'
               NEXT SENTENCE
           ELSE
      *ALD-BCI-FIN/29.01.1996
           IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
               DISPLAY 'OFICINA : ' WSS-COD-OFOC IN WSS-VARI
               MOVE WSS-COD-OFOC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   PERFORM GNS-PRO-ABT.

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.

      * Obtiene el Codigo Valor de Cambio de Pesos mediante el CIC de la
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB IN TAB
               PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS-VARI.

      * Obtiene el Codigo Valor de Cambio de la UF mediante el CIC de la
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0998  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0998  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB IN TAB
               PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-UEFE IN WSS-VARI.

      * Obtiene el Codigo Valor de Cambio de US$ mediante el CIC de la m
      *     MOVE 'TAB'          TO FIO-SIST.
      *     MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
      *     MOVE '101301'       TO TAB-CIC-CTAB IN TAB.
      *     MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
      *     MOVE FIO-GET-KEY    TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      *     IF NOT FIO-STAT-OKS
      *         MOVE 'TAB'          TO MSG-COD-SIST
      *         MOVE 'CIC1013  NEX' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB IN TAB
      *         PERFORM GNS-PRO-ABT.
      *     MOVE TAB-COD-CTAB IN TAB TO WSS-COD-DOLA IN WSS-VARI.

      * Obtiene Valor de Cambio en Pesos para la UF a Fecha del Informe
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).
           MOVE WSS-COD-UEFE IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTE VALOR DE CAMBIO A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI      ' PARA LA U.F.'
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
               DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI    ' PARA LA U.F.'
               PERFORM GNS-PRO-ABT
           ELSE
           MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-UEFE IN WSS-VARI.

      *RVM-CST-INI 18-JAN-1996
           MULTIPLY 5000 BY WSS-SGV-UEFE IN WSS-VARI GIVING
                        WSS-VAL-UF05 IN WSS-VARI ROUNDED.

           MULTIPLY 10000 BY WSS-SGV-UEFE IN WSS-VARI GIVING
                        WSS-VAL-UF10 IN WSS-VARI ROUNDED.

      *RVM-CST-FIN 18-JAN-1996

      * Obtiene Valor de Cambio en Pesos para el US$ a Fecha del Informe
      *     MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1).
      *     MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).
      *     MOVE WSS-COD-DOLA IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
      *     MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM TAB-FIO-CAM.
      *     IF NOT FIO-STAT-OKS
      *         DISPLAY 'NO EXISTE VALOR DE CAMBIO A FECHA INFORME : '
      *                  WSS-FEC-FINF IN WSS-VARI       ' PARA EL US$'
      *         PERFORM GNS-PRO-ABT
      *     ELSE
      *     IF CAM-IND-VIGE NOT = 'S'
      *         DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA INFORME : '
      *                  WSS-FEC-FINF IN WSS-VARI     ' PARA EL US$'
      *         PERFORM GNS-PRO-ABT
      *     ELSE
      *     MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-DOLA IN WSS-VARI.
      *ALD-BCI-INI/10.05.1999
      *ALD-BCI-INI/05051999
           MOVE 'COL'          TO TAB-COD-SIST FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'BCICUR DPTMC' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB
           IF FIO-STAT-OKS AND
              TAB-IND-VIGE IN TAB = 'S'
               MOVE 'S' TO WSS-IND-TXC
           ELSE
               MOVE 'N' TO WSS-IND-TXC.
           IF WSS-IND-TXC = 'S'
               GO TO CON-OBT-TMC.
      *ALD-BCI-FIN/10.05.1999
      * Obtiene Tasa Maxima Convencional para Pesos a Menos de 90 Dias
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE 'TB90'                   TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTE TASA MAXIMA CONV. A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI        ' PARA LA TB90'
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
               DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI    ' PARA LA TB90'
               PERFORM GNS-PRO-ABT
           ELSE
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TB90 IN WSS-VARI.

      * Obtiene Tasa Maxima Convencional para Pesos a Mas de 90 Dias
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE 'TS90'                   TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTE TASA MAXIMA CONV. A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI        ' PARA LA TS90'
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
               DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI    ' PARA LA TS90'
               PERFORM GNS-PRO-ABT
           ELSE
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TS90 IN WSS-VARI.

      * Obtiene Tasa Maxima Convencional para Moneda Reajustable
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).
           MOVE WSS-COD-UEFE IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
      *     MOVE OPC-COD-VCOC IN OPC-FLD  TO CAM-COD-VCAM IN CAM(1).
           MOVE 'TMXC'                   TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTE TASA MAXIMA CONV. A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI        ' PARA LA TREA'
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
               DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA INFORME : '
                        WSS-FEC-FINF IN WSS-VARI    ' PARA LA TREA'
               PERFORM GNS-PRO-ABT
           ELSE
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TREA IN WSS-VARI.

      *ALD-BCI-INI/10.05.1999
       CON-OBT-TMC.
      *ALD-BCI-FIN/10.05.1999
      * Obtiene Tasa Maxima Convencional para Moneda Extranjera
      *     MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1).
      *     MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).
      *     MOVE 'TMEX'                   TO CAM-COD-VCAM IN CAM(1).
      *     MOVE 'TMXC'                   TO CAM-COD-VCAM IN CAM(2).
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM TAB-FIO-CAM.
      *     IF NOT FIO-STAT-OKS
      *         DISPLAY 'NO EXISTE TASA MAXIMA CONV. A FECHA INFORME : '
      *                  WSS-FEC-FINF IN WSS-VARI        ' PARA LA TMEX'
      *         PERFORM GNS-PRO-ABT
      *     ELSE
      *     IF CAM-IND-VIGE NOT = 'S'
      *         DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA INFORME : '
      *                  WSS-FEC-FINF IN WSS-VARI    ' PARA LA TMEX'
      *         PERFORM GNS-PRO-ABT
      *     ELSE
      *     MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMEX IN WSS-VARI.

       INI-GET-OFI.
      *ALD-BCI-INI/29.01.1996
           IF WSS-COD-OFOC IN WSS-VARI NOT = 'RM'
                GO TO FIN-GET-OFI.
      *ALD-BCI-FIN/29.01.1996
           MOVE ZEROES      TO WSS-OFIC.
           MOVE FIO-GET-FST TO FIO-CMND.
       LUP-GET-OFI.
           PERFORM TAB-FIO-OFI.
           IF NOT FIO-STAT-OKS
               GO TO FIN-GET-OFI.
           MOVE OFI-COD-COMU IN OFI TO COM-COD-COMU IN COM.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM TAB-FIO-COM.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE 'CODCOMUNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC
               GO TO NXT-GET-OFI.
      *ALD-BCI-INI/29.01.1994
           IF COM-COD-REGI IN COM = '13'
               ADD 1 TO WSS-OFIC
               MOVE OFI-COD-OFIC TO WSS-COD-OFIC(WSS-OFIC).
      *RVM-CST-INI 16-JAN-1996
      *INHABILITADO PARA QUE GUARDE TODAS LAS OFICINAS
      *     IF COM-COD-REGI IN COM = '13'
      *         ADD 1 TO WSS-OFIC
      *          ADD 1 TO WSS-OFIC.
      *RVM-CST-FIN 16-JAN-1996
      *         MOVE OFI-COD-OFIC TO WSS-COD-OFIC(WSS-OFIC).
      *ALD-BCI-FIN/29.01.1994
       NXT-GET-OFI.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-GET-OFI.
       FIN-GET-OFI.

      * Proceso para Cargar las tablas  TAB/TIO  y  COL/TOC  en Memoria
           PERFORM COL-CRG-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
               PERFORM GNS-PRO-ABT.
      *ALD-BCI-FIN/05051999
      * Apertura de Registros
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           PERFORM COL-FIO-DLC.
           PERFORM COL-FIO-ICG.

      *ald-bci-ini/09.04.1999 Programa aborta archivo vacio para os390
      *COMENTARIO DEBE HABER UNA MANERA MAS INTELIGENTE PARA ESTO
      *     MOVE FIO-UPD TO FIO-CMND.
      *     PERFORM SUP-FIO-FD3.
      *     IF NOT FIO-STAT-OKS
      *         DISPLAY 'ERROR FIO-UPD FD3, FIO-STAT : ' FIO-STAT
      *         PERFORM GNS-PRO-ABT.
            MOVE FIO-OUT TO FIO-CMND.
            PERFORM SUP-FIO-FD3.
            IF NOT FIO-STAT-OKS
                DISPLAY 'ERROR FIO-OUT FD3, FIO-STAT : ' FIO-STAT
                PERFORM GNS-PRO-ABT.
           MOVE ZEROES TO FD3.
           MOVE '*'                 TO FD3-COD-TIPO IN FD3.
           MOVE 1                   TO FD3-NUM-LINE IN FD3.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM SUP-FIO-FD3.
           IF NOT FIO-STAT-OKS
                DISPLAY 'ERROR FIO-PUT-DUMMY FD3, FIO-STAT : ' FIO-STAT
                PERFORM GNS-PRO-ABT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM SUP-FIO-FD3.
           IF NOT FIO-STAT-OKS
                DISPLAY 'ERROR FIO-CLO FD3, FIO-STAT : ' FIO-STAT
                PERFORM GNS-PRO-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM SUP-FIO-FD3.
           IF NOT FIO-STAT-OKS
                DISPLAY 'ERROR FIO-UPD FD3, FIO-STAT : ' FIO-STAT
                PERFORM GNS-PRO-ABT.
           MOVE '*'                 TO FD3-COD-TIPO IN FD3.
           MOVE 1                   TO FD3-NUM-LINE IN FD3.
           MOVE FIO-GET-KEY-UPD  TO FIO-CMND.
           PERFORM SUP-FIO-FD3.
           IF NOT FIO-STAT-OKS
                DISPLAY 'ERROR FIO-KEY-DUMMY FD3, FIO-STAT : ' FIO-STAT
                PERFORM GNS-PRO-ABT.
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM SUP-FIO-FD3.
           IF NOT FIO-STAT-OKS
                DISPLAY 'ERROR FIO-DEL-DUMMY FD3, FIO-STAT : ' FIO-STAT
                PERFORM GNS-PRO-ABT.
           DISPLAY 'OK FIO-DEL-DUMMY FD3, FIO-STAT : ' FIO-STAT
      *ald-bci-fin/09.04.1999


      *RVM-CST-INI 18-JAN-1996
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM SUP-FIO-Z04.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR FIO-OUT Z04, FIO-STAT : ' FIO-STAT
               PERFORM GNS-PRO-ABT.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM SUP-FIO-CC3.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR FIO-INP CC3, FIO-STAT : ' FIO-STAT
               PERFORM GNS-PRO-ABT.
      *RVM-CST-FIN 18-JAN-1996

           MOVE FIO-OUT TO FIO-CMND.
           PERFORM COL-FIO-RD3.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR FIO-OUT RD3, FIO-STAT : ' FIO-STAT
               PERFORM GNS-PRO-ABT.

      *ALD-BCI-INI/05.04.1999
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM COL-FIO-RH3.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR FIO-OUT RH3, FIO-STAT : ' FIO-STAT
               PERFORM GNS-PRO-ABT.
      *ALD-BCI-FIN/05.04.1999

      * Primera Lectura de Operacion de Credito por Llave Alternativa
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO OPC-FEC-FINP IN OPC.
           MOVE 'OPC-FEC-FINP' TO FIO-AKEY.
           MOVE FIO-GET-FST    TO FIO-CMND.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS OR
              OPC-FEC-FINP IN OPC NOT = WSS-FEC-FIN1 IN WSS-VARI
               DISPLAY 'NO HAY REGISTROS PARA FECHA DE INFORME : '
                       WSS-FEC-FINF IN WSS-VARI
      *RVM-CST-INI 16-JAN-1996
      *         GO TO FIN-MAIN.
               GO TO EXT-MAIN.
      *RVM-CST-FIN 16-JAN-1996

      * Inicializa Tabla de Totales acumulados para grabar FD3
           MOVE ZEROES TO WSS-MAT.
      *RVM-CST-INI 18-JAN-1996
           MOVE ZEROES TO WSS-MAT-Z04.
      *RVM-CST-FIN 18-JAN-1996
       LUP-MAIN.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
      ******************************************************************
      * Proceso de Seleccion y Clasificacion a Partir del Registro OPC
           ADD   1  TO WSS-NUM-OPCL IN WSS-VARI.

      * Seleccion de los Registros OPC Leidos para ser Procesados
           PERFORM SEL-REG-PRO.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO NXT-MAIN.
           ADD 1 TO WSS-NUM-OPCS IN WSS-VARI.

      * Lectura de la DLC para obtener el PLAZO del Credito
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF ( FIO-STAT-OKS AND
                    DLC-CIC-IOPC IN DLC = OPC-CIC-IOPC IN OPC AND
                  ( DLC-IND-SCTB IN DLC = SPACES OR
      *RVM-CST-INI 19.01.1996
      * A PETICION DE BCI
                    DLC-IND-SCTB IN DLC = 'MUL' ) AND
      *RVM-CST-FIN 19.01.1996
                    DLC-IND-SCRT IN DLC = SPACES AND
                    DLC-IND-SCBZ IN DLC = SPACES )
                 GO TO LUP-DLC
           ELSE
               DISPLAY 'OPC RECHAZADA : ' OPC-CIC-IOPC IN OPC
               DISPLAY 'DLC-CIC-IOPC  : ' DLC-CIC-IOPC IN DLC
               DISPLAY 'FS            : ' FIO-STAT
               DISPLAY 'TIPO DE OPER  : ' OPC-COD-TOOC IN OPC
               DISPLAY 'MONEDA        : ' OPC-COD-VCOC IN OPC
               IF FIO-STAT-OKS
                   DISPLAY 'DLC-IND-SCTB : ' DLC-IND-SCTB IN DLC
                   DISPLAY 'DLC-IND-SCRT : ' DLC-IND-SCRT IN DLC
                   DISPLAY 'DLC-IND-SCBZ : ' DLC-IND-SCBZ IN DLC
                   DISPLAY ' '
                   ADD 1 TO WSS-NUM-OPCR IN WSS-VARI
                   GO TO NXT-MAIN
               ELSE
                   DISPLAY 'DLC NO EXISTE : ' OPC-CIC-IOPC IN OPC
                   DISPLAY 'FS : ' FIO-STAT
                   DISPLAY ' '
                   ADD 1 TO WSS-NUM-OPCR IN WSS-VARI
                   GO TO NXT-MAIN.
       LUP-DLC.
           ADD  1  TO WSS-NUM-DLCL IN WSS-VARI.

      * Lectura de DCC para Obtener el Indicador Exclusion del Credito
           PERFORM BUS-DCC.
           IF DCC-GLS-DISP IN DCC = 'X'
               GO TO NXT-GET-DLC.

      * Determinacion del Tramo para Distribuir Registro Seleccionado
           PERFORM DET-TRA-REG-PROC.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO NXT-GET-DLC.

      * Proceso para obtener la Tasa de Interes del Credito
           PERFORM DET-TASA-CRED.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO NXT-GET-DLC.

      *ALD-BCI-INI/21.07.1999
           IF RD3-IND-ERRO IN RD3 = '='
               MOVE SPACES TO RH3
               ADD 1 TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'TEQV=ZEROES'            TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-GET-DLC.
      *ALD-BCI-FIN/21.07.1999
      *ALD-BCI-INI/05.04.1999
           IF RD3-IND-ERRO IN RD3 = '*'
               MOVE SPACES TO RH3
               ADD 1 TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'TEQV<4OR0,5'            TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-GET-DLC.

           IF RD3-IND-ERRO IN RD3 = '+'
               MOVE SPACES TO RH3
               ADD 1 TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'TEQV>TMCFINP'           TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-GET-DLC.
      *ALD-BCI-FIN/05.04.1999


           ADD  1  TO WSS-NUM-DLCS IN WSS-VARI.

      *RVM-CST-INI 26-JAN-1996
      * Seleccion de Oficina de Operacion SOLO de Region Metropolitana
           IF WSS-COD-OFOC IN WSS-VARI = '*'
               MOVE 'S' TO WSS-COD-RMTP
           ELSE
               IF WSS-COD-OFOC IN WSS-VARI NOT = 'RM'
                   IF WSS-COD-OFOC NOT = OPC-COD-OFOC IN OPC
                       MOVE 'N' TO WSS-COD-RMTP
      *RVM-CST-INI 21.02.1996
                   ELSE
                       MOVE 'S' TO WSS-COD-RMTP.
      *RVM-CST-FIN 21.02.1996
           IF WSS-COD-OFOC IN WSS-VARI = 'RM'
               MOVE  1  TO WSS-NUM-IOFI
               SET WSS-NUM-OFIC TO 1
               SEARCH WSS-ELE-OFIC VARYING WSS-NUM-IOFI
                      AT END MOVE 'N' TO WSS-COD-RMTP
                  WHEN WSS-COD-OFIC(WSS-NUM-OFIC) = OPC-COD-OFOC IN OPC
                             MOVE 'S' TO WSS-COD-RMTP.
      *RVM-CST-INI 20-FEB-1996
      *ESTE CAMBIO ES PORQUE ANTES EL REGISTRO Z04 ERA POR PAIS, Y AHORA
      *TAMBIEN SE CONTROLA PARA REGION METROPOLITANA
      *     IF WSS-COD-RMTP IN WSS-VARI = 'N'
      *         GO TO SOLO-RM-1.
           IF WSS-COD-RMTP IN WSS-VARI = 'N'
               GO TO NXT-GET-DLC.
      *RVM-CST-FIN 20-FEB-1996
      *RVM-CST-FIN 26-JAN-1996

      * Determinacion de las TASAS EXTREMAS Minima y Maxima
      *    DISPLAY 'OPC 1: ' OPC-CIC-IOPC IN OPC ' '
      *            'TMIN : ' WSS-TMIN IN WSS-ELE(WSS-IND) ' TMAX : '
      *        WSS-TMAX IN WSS-ELE(WSS-IND) ' TEQV : ' WSS-VAL-TEQV
      *              IN WSS-VARI.
           ADD 1  TO WSS-CONT(WSS-IND).
           IF WSS-CONT(WSS-IND) = 1
               MOVE WSS-VAL-TEQV IN WSS-VARI TO
                    WSS-TMIN IN WSS-ELE(WSS-IND)
           ELSE
           IF WSS-VAL-TEQV IN WSS-VARI < WSS-TMIN IN WSS-ELE(WSS-IND)
               MOVE WSS-VAL-TEQV IN WSS-VARI TO
                    WSS-TMIN IN WSS-ELE(WSS-IND).

           IF WSS-VAL-TEQV IN WSS-VARI > WSS-TMAX IN WSS-ELE(WSS-IND)
               MOVE WSS-VAL-TEQV IN WSS-VARI TO
                    WSS-TMAX IN WSS-ELE(WSS-IND).

       SOLO-RM-1.

      * Obtiene Monto del Credito en Pesos a Fecha Informe
           IF OPC-COD-VCOC IN OPC NOT = WSS-COD-PESO IN WSS-VARI
               PERFORM DET-VAL-CAMB-FINF
               IF WSS-IND-STAT IN WSS-VARI = 1
                   ADD 1 TO WSS-NUM-OPCR IN WSS-VARI
                   GO TO NXT-GET-DLC
               ELSE
                   MULTIPLY DLC-VAL-NDLC IN DLC      BY
                            WSS-SGV-FINF IN WSS-VARI GIVING
                            DLC-VAL-NDLC IN DLC.

      *RVM-CST-INI 18-JAN-1996
           IF DLC-VAL-NDLC IN DLC < WSS-VAL-UF10 IN WSS-VARI
      *CREDITOS BAJO 10000 UF
               ADD DLC-VAL-NDLC IN DLC TO
                  WSS-MT10-Z04 IN WSS-ELE-Z04(WSS-IND)
               MULTIPLY WSS-VAL-TEQV IN WSS-VARI BY
                        DLC-VAL-NDLC IN DLC      GIVING
                        WSS-VAL-PPON IN WSS-VARI
                   ADD WSS-VAL-PPON IN WSS-VARI TO
                        WSS-PP10-Z04 IN WSS-ELE-Z04(WSS-IND)
      *CREDITOS BAJO 5000 UF
               IF DLC-VAL-NDLC IN DLC < WSS-VAL-UF05 IN WSS-VARI
                   ADD DLC-VAL-NDLC IN DLC TO
                      WSS-MT05-Z04 IN WSS-ELE-Z04(WSS-IND)
                   MULTIPLY WSS-VAL-TEQV IN WSS-VARI BY
                            DLC-VAL-NDLC IN DLC      GIVING
                        WSS-VAL-PPON IN WSS-VARI
                   ADD WSS-VAL-PPON IN WSS-VARI TO
                            WSS-PP05-Z04 IN WSS-ELE-Z04(WSS-IND).

      *RVM-CST-FIN 18-JAN-1996

      *RVM-CST-INI 26-JAN-1996
           IF WSS-COD-RMTP IN WSS-VARI = 'N'
               GO TO SOLO-RM-2.
      *RVM-CST-FIN 26-JAN-1996

      * Acumulacion del Monto en $ de los Creditos Seleccionados
           ADD DLC-VAL-NDLC IN DLC TO WSS-MONT IN WSS-ELE(WSS-IND).

      * Acumular Monto de Creditos Tasa Variable
           IF INT-CVTI > SPACES
               ADD DLC-VAL-NDLC IN DLC TO WSS-MTVA IN WSS-MAT.

      * Determinacion y Calculo para el Promedio Ponderado
           MULTIPLY WSS-VAL-TEQV IN WSS-VARI BY
                    DLC-VAL-NDLC IN DLC      GIVING
                    WSS-VAL-PPON IN WSS-VARI.
           ADD WSS-VAL-PPON IN WSS-VARI TO
               WSS-PPON IN WSS-ELE(WSS-IND).

       SOLO-RM-2.
           ADD  1  TO WSS-NUM-OPCP IN WSS-VARI.
           ADD  1  TO WSS-NUM-DLCP IN WSS-VARI.

      * Graba montos para Control de Proceso segun Codigos de Oficina,
      * Plazo, Clase y Moneda del Credito por DLC en registro RD3
      *ALD-BCI-INI/29.01.1996
           IF WSS-COD-RMTP IN WSS-VARI = 'S'
      *ALD-BCI-INI/14.05.1999
              MOVE DLC-VAL-NDLC IN DLC TO WSS-VAL-TRAM IN WSS-VARI
      *ALD-BCI-FIN/14.05.1999
      *ALD-BCI-FIN/29.01.1996
               PERFORM PUT-CTR-OPC-RD3.
       NXT-GET-DLC.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-DLC.
      *RVM-CST-INI 19.01.1996
           IF ( FIO-STAT-OKS AND
                    DLC-CIC-IOPC IN DLC = OPC-CIC-IOPC IN OPC AND
                  ( DLC-IND-SCTB IN DLC = SPACES OR
      *RVM-CST-INI 19.01.1996
      * A PETICION DE BCI
                    DLC-IND-SCTB IN DLC = 'MUL' ) AND
      *RVM-CST-FIN 19.01.1996
                    DLC-IND-SCRT IN DLC = SPACES AND
                    DLC-IND-SCBZ IN DLC = SPACES )
                 GO TO LUP-DLC
           ELSE
               GO TO NXT-MAIN.
      *RVM-CST-FIN 19.01.1996
      ******************************************************************
       NXT-MAIN.
      * Siguiente lectura de Operacion de Credito por Llave Alternativa
           MOVE 'OPC-FEC-FINP' TO FIO-AKEY.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF OPC-FEC-FINP IN OPC NOT = WSS-FEC-FIN1 IN WSS-VARI
               GO TO FIN-MAIN.
           GO TO LUP-MAIN.
       FIN-MAIN.
      *RVM-CST-INI 25-JAN-1996
      * SE PROCESAN LOS REGISTROS ENVIADOS DESDE CUENTAS CORRIENTES
      * PARA COMPLETAR LA INFORMACION DEL SUPD03
           PERFORM PRO-CC3.
      *RVM-CST-FIN 25-JAN-1996
      * Calculo Final por tramo del Promedio Ponderado
           PERFORM CAL-TAS-PPON VARYING WSS-SUB FROM 1 BY 1 UNTIL
                                        WSS-SUB > 43.

      * Graba registro de interfaz FD3 con informacion generada
           MOVE WSS-MTVA IN WSS-MAT TO WSS-MONT IN WSS-ELE(44).
           PERFORM GEN-REG-FD3 VARYING WSS-SUB FROM 1 BY 1 UNTIL
                                       WSS-SUB > 44.

      *RVM-CST-INI 18-JAN-1996
      * Calculo Final por tramo del Promedio Ponderado
           PERFORM CAL-TAS-PPON-Z04 VARYING WSS-SUB FROM 1 BY 1 UNTIL
                                        WSS-SUB > 43.

      *RVM-CST-INI 18-JAN-1996
      *GRABA REGISTRO CABECERA
           IF WSS-COD-GCAB IN WSS-VARI = 'S'
               PERFORM GEN-REG-CAB-Z04.
      *RVM-CST-FIN 18-JAN-1996

      * Graba registro de interfaz FD3 con informacion generada
           PERFORM GEN-REG-Z04 VARYING WSS-SUB FROM 1 BY 1 UNTIL
                                       WSS-SUB > 44.

      *RVM-CST-FIN 18-JAN-1996

      *RVM-CST-INI 16-JAN-1996
       EXT-MAIN.
      *RVM-CST-FIN 16-JAN-1996
      * Cierre de Registros
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           PERFORM COL-FIO-DLC.
           PERFORM COL-FIO-ICG.
           PERFORM COL-FIO-RD3.
      *ALD-BCI-INI/05.04.1999
           PERFORM COL-FIO-RH3.
      *ALD-BCI-FIN/05.04.1999
           PERFORM SUP-FIO-FD3.
      *RVM-CST-INI 18-JAN-1996
           PERFORM SUP-FIO-Z04.
           PERFORM SUP-FIO-CC3.
      *RVM-CST-FIN 18-JAN-1996

      * Despliega Totales de Control Proceso
           DISPLAY 'TOTAL OPC LEIDOS             : '
                               WSS-NUM-OPCL IN WSS-VARI.
           DISPLAY 'TOTAL OPC SELECCIONADOS      : '
                               WSS-NUM-OPCS IN WSS-VARI.
           DISPLAY 'TOTAL OPC PARA PROCESO       : '
                               WSS-NUM-OPCP IN WSS-VARI.
           DISPLAY 'TOTAL OPC RECHAZADOS         : '
                               WSS-NUM-OPCR IN WSS-VARI.
           DISPLAY 'TOTAL DLC LEIDOS             : '
                               WSS-NUM-DLCL IN WSS-VARI.
           DISPLAY 'TOTAL DLC SELECCIONADOS      : '
                               WSS-NUM-DLCS IN WSS-VARI.
           DISPLAY 'TOTAL DLC PARA PROCESO       : '
                               WSS-NUM-DLCP IN WSS-VARI.
      *RVM-CST-INI 25-JAN-1996
           DISPLAY 'TOTAL CC3 LEIDOS             : '
                               WSS-NUM-CC3L IN WSS-VARI.
           DISPLAY 'TOTAL CC3 PROCESADOS         : '
                               WSS-NUM-CC3P IN WSS-VARI.
      *RVM-CST-FIN 25-JAN-1996
           DISPLAY 'TOTAL FD3 GRABADOS           : '
                               WSS-NUM-FD3G IN WSS-VARI.
           DISPLAY 'TOTAL RD3 GRABADOS           : '
                               WSS-NUM-RD3G IN WSS-VARI.
      *RVM-CST-INI 18-JAN-1996
           DISPLAY 'TOTAL Z04 GRABADOS           : '
                               WSS-NUM-Z04G IN WSS-VARI.
      *RVM-CST-FIN 18-JAN-1996
      *ALD-BCI-INI/05.04.1999
           DISPLAY 'TOTAL RH3 GRABADOS           : '
                               WSS-NUM-RRH3 IN WSS-VARI.
      *ALD-BCI-FIN/05.04.1999
      * Termino del Proceso
           PERFORM GNS-PRO-END.

      *<<<< EOF
      ******************************************************************
      * Seleccion del Registro OPC Leido para ser Procesado
       SEL-REG-PRO SECTION.
       INI-SEL-REG-PRO.
           MOVE  1  TO WSS-IND-STAT IN WSS-VARI.

      * Seleccion de Operacion de Credito con Estado 'ACA'
           IF OPC-MSC-STAT IN OPC NOT = 'A'
               GO TO FIN-SEL-REG-PRO.

      * Se omite la Operacion de Credito en Moneda Extranjera >< de US$
      *     IF OPC-MSC-TVOC IN OPC = '1' AND
      *        OPC-COD-VCOC IN OPC NOT = WSS-COD-DOLA IN WSS-VARI
      * Se omite la Operacion de Credito en Moneda Extranjera
           IF OPC-MSC-TVOC IN OPC = '1'
               GO TO FIN-SEL-REG-PRO.

      *RVM-CST-INI 19.01.1996
      * A PETICION DE BCI (PR)
      * Seleccion de Operacion de Credito que tenga Saldo a fecha Inform
      *    IF OPC-VAL-SCRE IN OPC NOT > ZEROES
      *        GO TO FIN-SEL-REG-PRO.
      *RVM-CST-FIN 19.01.1996

      * Seleccion de Oficina de Operacion de Credito
      *     IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
      *         IF WSS-COD-OFOC IN WSS-VARI NOT = OPC-COD-OFOC IN OPC
      *             GO TO FIN-SEL-REG-PRO.

      *RVM-CST-INI 22.01.1996
           IF WSS-COD-COP1 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP1 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP2 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP2 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP3 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP3 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP4 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP4 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

      *RVM-CST-INI 07.03.1996
           IF WSS-COD-COP5 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP5 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP6 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP6 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP7 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP7 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP8 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP8 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP9 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP9 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COP10 IN WSS-VARI > SPACES
               IF OPC-COD-COOC IN OPC = WSS-COD-COP10 IN WSS-VARI
                   GO TO FIN-SEL-REG-PRO.
      *RVM-CST-FIN 07.03.1996

      *RVM-CST-FIN 22.01.1996
      *RVM-CST-INI 26-JAN-1996
      * Seleccion de Oficina de Operacion SOLO de Region Metropolitana
      *     MOVE  1  TO WSS-NUM-IOFI.
      *     SET WSS-NUM-OFIC TO 1.
      *     SEARCH WSS-ELE-OFIC VARYING WSS-NUM-IOFI
      *                          AT END GO TO FIN-SEL-REG-PRO
      *            WHEN WSS-COD-OFIC(WSS-NUM-OFIC) = OPC-COD-OFOC
      *                 NEXT SENTENCE.
      *RVM-CST-FIN 26-JAN-1996

      *RVM-CST-INI 22.01.1996
      * Calcula Diferencia en Dias entre Fecha Colocacion y Fecha Inform
      *    IF OPC-FEC-FCOL IN OPC NOT = OPC-FEC-FINP IN OPC
      *        PERFORM BUS-DIA5-HBL
      *        IF WSS-FEC-FHBL IN WSS-VARI < OPC-FEC-FINP IN OPC
      *            GO TO FIN-SEL-REG-PRO.
      *RVM-CST-FIN 22.01.1996

      * Busca con el Codigo Tipo Operacion en la Tabla cargada en Memori
      * 'Sistema que lo Maneja' y 'Opera Como'
           MOVE OPC-COD-TOOC IN OPC TO CTO-TOOC IN CTO-VARI.
           PERFORM COL-BUS-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
                       'CON CODIGO : '     CTO-TOOC IN CTO-VARI
                       ' EN CREDITO : '    OPC-CIC-IOPC IN OPC
               GO TO FIN-SEL-REG-PRO.

      * Valida el 'Sistema que lo Maneja' de la Operacion de Credito sea
      * COL - CES - TCR - SCC - SGE
           IF NOT ( CTO-SIST IN CTO-VARI = 'COL' )
               GO TO FIN-SEL-REG-PRO.

      * Valida el 'Opera Como' de la Operacion de Credito omite Hipoteca
      * Tarjeta Visa y Boleta Garantia
           IF CTO-OPEC IN CTO-VARI = 'H' OR
              CTO-OPEC IN CTO-VARI = 'B'
               GO TO FIN-SEL-REG-PRO.

      * Obtiene 'Opera Como'
           MOVE SPACES               TO TOC.
           MOVE CTO-OPEC IN CTO-VARI TO WSS-OPEC IN WSS-VARI.

           MOVE  0  TO WSS-IND-STAT IN WSS-VARI.
       FIN-SEL-REG-PRO.
           EXIT.
      *-----------------------------------------------------------------
      * Busca hasta el 5 dia Habil
       BUS-DIA5-HBL SECTION.
       INI-BUS-DIA5-HBL.
           MOVE  0  TO WSS-HBL-DIAS IN WSS-VARI.
           MOVE OPC-NUM-DCOL IN OPC TO FEC-ITM1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-ITM2.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-ITM3.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-ITM4.
       LUP-BUS-DIA5-HBL.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-SIG-HBL  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF FEC-STAT-FER
               GO TO LUP-BUS-DIA5-HBL
           ELSE
           IF FEC-STAT-OKS
               ADD 1 TO WSS-HBL-DIAS IN WSS-VARI
      *RVM-CST-INI 19.01.1996
      *A PETICION DEL BCI
      *        IF WSS-HBL-DIAS IN WSS-VARI > 5
               IF WSS-HBL-DIAS IN WSS-VARI > 22
      *RVM-CST-FIN 19.01.1996
                   MOVE FEC-ITM1 TO WSS-NUM-DHBL IN WSS-VARI
                   MOVE FEC-ITM2 TO WSS-NUM-MHBL IN WSS-VARI
                   MOVE FEC-ITM3 TO WSS-NUM-SHBL IN WSS-VARI
                   MOVE FEC-ITM4 TO WSS-NUM-AHBL IN WSS-VARI
               ELSE
               GO TO LUP-BUS-DIA5-HBL.
       FIN-BUS-DIA5-HBL.
           EXIT.
      ******************************************************************
      * Lectura de DCC para Obtener el Indicador Exclusion del Credito
      * con Llave COD-CCTB Formada
       BUS-DCC SECTION.
       INI-BUS-DCC.
      * Forma Llave COD-CCTB para Leer DCC
      * Con BUS-TAB Busca Estado de IND-PCTB de Tabla AUX para Completar
           MOVE 'CAP'               TO DCC-MSC-TCCT IN DCC.
           MOVE OPC-COD-VCOC IN OPC TO DCC-COD-VCAM IN DCC.
           MOVE OPC-COD-COOC IN OPC TO DCC-COD-COCR IN DCC.
           MOVE DLC-COD-PLZO IN DLC TO DCC-COD-PLZO IN DCC.
           MOVE SPACES              TO DCC-IND-SCRT IN DCC.
           MOVE SPACES              TO DCC-IND-SCTB IN DCC.
           MOVE SPACES              TO DCC-IND-SCBZ IN DCC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM COL-FIO-DCC.
           IF NOT FIO-STAT-OKS
               MOVE 'X'          TO DCC-GLS-DISP IN DCC
               MOVE 'GNS'        TO MSG-COD-SIST
               MOVE 'COD    NEX' TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC ' : ' DCC-COD-TABL IN DCC
               GO TO FIN-BUS-DCC.
      *RVM-CST-INI 19.01.1996
      *A PETICION DEL BANCO (PR), SI LA DCC EXISTE LIMPIAR INDICADOR
      *DE EXCLUSION
           MOVE SPACES TO DCC-GLS-DISP IN DCC.
      *RVM-CST-FIN 19.01.1996
       FIN-BUS-DCC.
           EXIT.
      ******************************************************************
      * Determinacion del Tramo para Distribuir Registro Seleccionado
       DET-TRA-REG-PROC SECTION.
       INI-DET-TRA-REG-PROC.
           MOVE 0 TO WSS-IND      IN WSS-VARI
                     WSS-IND-STAT IN WSS-VARI.

           IF DLC-COD-PLZO IN DLC = 'C1'
               IF WSS-OPEC IN WSS-VARI = 'I'
                   IF OPC-COD-VCOC IN OPC = '0999'
      *                interbancaria no reaj.
                       MOVE  1 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0998' OR
                      OPC-COD-VCOC IN OPC = '0997'
      *                interbancaria reaj. uf.
                       MOVE  2 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0013'
      *                interbancaria reaj. tc.
                       MOVE  3 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '1013'
      *                interbancaria US$
                       MOVE  4 TO WSS-IND IN WSS-VARI
                   ELSE
                       NEXT SENTENCE
               ELSE
                   IF OPC-COD-VCOC IN OPC = '0999'
      *                op. no reajustable
                       MOVE  5 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0998' OR
                      OPC-COD-VCOC IN OPC = '0997'
      *                op. reajustable uf.
                       MOVE  6 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0013'
      *                op. reajustable tc.
                       MOVE  7 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '1013'
      *                op. US$
                       MOVE  8 TO WSS-IND IN WSS-VARI
                   ELSE
                       NEXT SENTENCE
           ELSE
           IF DLC-COD-PLZO IN DLC = 'C2'
               IF WSS-OPEC = 'I'
                   IF OPC-COD-VCOC IN OPC = '0999'
      *                interbancaria no reaj.
                       MOVE 12 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0998' OR
                      OPC-COD-VCOC IN OPC = '0997'
      *                interbancaria reaj. uf.
                       MOVE 13 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0013'
      *                interbancaria reaj. tc.
                       MOVE 14 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '1013'
      *                interbancaria US$
                       MOVE 15 TO WSS-IND IN WSS-VARI
                   ELSE
                       NEXT SENTENCE
               ELSE
                   IF OPC-COD-VCOC IN OPC = '0999'
      *                op. no reajustable
                       MOVE 16 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0998' OR
                      OPC-COD-VCOC IN OPC = '0997'
      *                op. reajustable uf.
                       MOVE 17 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0013'
      *                op. reajustable tc.
                       MOVE 18 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '1013'
      *                op. US$
                       MOVE 19 TO WSS-IND IN WSS-VARI
                   ELSE
                       NEXT SENTENCE
           ELSE
           IF DLC-COD-PLZO IN DLC = 'C3' OR
              DLC-COD-PLZO IN DLC = 'C4'
               IF WSS-OPEC NOT = 'I'
                   IF OPC-COD-VCOC IN OPC = '0999'
      *                op. no reajustable
                       MOVE 23 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0998' OR
                      OPC-COD-VCOC IN OPC = '0997'
      *                op. reajustable uf.
                       MOVE 24 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0013'
      *                op. reajustable tc.
                       MOVE 25 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '1013'
      *                op. US$
                       MOVE 26 TO WSS-IND IN WSS-VARI
                   ELSE
                       NEXT SENTENCE
               ELSE
                   NEXT SENTENCE
           ELSE
           IF DLC-COD-PLZO IN DLC = 'M1' OR
              DLC-COD-PLZO IN DLC = 'M2'
               IF WSS-OPEC NOT = 'I'
                   IF OPC-COD-VCOC IN OPC = '0999'
      *                op. no reajustable
                       MOVE 30 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0998' OR
                      OPC-COD-VCOC IN OPC = '0997'
      *                op. reajustable uf.
                       MOVE 31 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0013'
      *                op. reajustable tc.
                       MOVE 32 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '1013'
      *                op. US$
                       MOVE 33 TO WSS-IND IN WSS-VARI
                   ELSE
                       NEXT SENTENCE
               ELSE
                   NEXT SENTENCE
           ELSE
           IF DLC-COD-PLZO IN DLC = 'L0' OR
              DLC-COD-PLZO IN DLC = 'L3' OR
              DLC-COD-PLZO IN DLC = 'L5'
               IF WSS-OPEC NOT = 'I'
                   IF OPC-COD-VCOC IN OPC = '0999'
      *                op. no reajustable
                       MOVE 37 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0998' OR
                      OPC-COD-VCOC IN OPC = '0997'
      *                op. reajustable uf.
                       MOVE 38 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '0013'
      *                op. reajustable tc.
                       MOVE 39 TO WSS-IND IN WSS-VARI
                   ELSE
                   IF OPC-COD-VCOC IN OPC = '1013'
      *                op. US$
                       MOVE 40 TO WSS-IND IN WSS-VARI.

           IF WSS-IND IN WSS-VARI = ZEROS
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'REGISTRO DLC NO PROCESADO ' DLC-KEY-IDLC IN DLC.
       FIN-DET-TRA-REG-PROC.
           EXIT.
      ******************************************************************
      * Proceso para obtener la Tasa de Interes del Credito
       DET-TASA-CRED SECTION.
       INI-DET-TASA-CRED.
           MOVE  0  TO WSS-IND-STAT IN WSS-VARI.

      * Lectura de la ICG para obtener la Tasa de Interes del Credito
           IF WSS-OPEC NOT = 'D'
               PERFORM GET-ICG-OPC
           ELSE
               PERFORM GET-ICG-DLC
               IF NOT FIO-STAT-OKS
                   PERFORM GET-ICG-OPC.

           IF FIO-STAT-OKS
               MOVE ICG-COD-TINT IN ICG TO INT-TIPT
               MOVE ICG-SGV-SPRD IN ICG TO WSS-VAL-SPRD
               MOVE ICG-SGV-TINT IN ICG TO WSS-VAL-TASA
           ELSE
               MOVE SPACES       TO INT-TIPT
               MOVE ZEROES       TO WSS-VAL-SPRD
               MOVE ZEROES       TO WSS-VAL-TASA
               DISPLAY 'REGISTRO OPC NO TIENE INTERESES ' OPC-KEY-IOPC.

      * No se ejecuta, Tasas estan en expresadas en terminos correctos
      * Vencidas, Anual o Mensual
      *     PERFORM CAL-TAS-EQV.
      *     IF INT-CMSG > SPACES
      *         MOVE  1  TO WSS-IND-STAT IN WSS-VARI
      *         DISPLAY 'DOCUMENTO : ' DLC-KEY-IDLC IN DLC
      *         IF INT-CMSG = 'CAM    NEX'
      *             DISPLAY 'TASA INT./V. CAMBIO/FECHA : ' INT-TIPT '/'
      *                     INT-VCAM '/' INT-FINT
      *             GO TO FIN-DET-TASA-CRED
      *         ELSE
      *             GO TO FIN-DET-TASA-CRED.

      * Proceso para obtener la Tasa de Interes a Fecha de Colocacion
           IF WSS-IND-TEQV IN WSS-VARI = 0
               IF INT-CVTI NOT > SPACES
                    MOVE ICG-SGV-TINT IN ICG TO WSS-VAL-TEQV IN WSS-VARI
               ELSE
                   MOVE ICG-SGV-SPRD IN ICG TO INT-TINT
                   PERFORM OBT-TASA-VAR
                   IF WSS-IND-STAT IN WSS-VARI = 1
                       GO TO FIN-DET-TASA-CRED
                   ELSE
                       MOVE INT-TIPE TO WSS-VAL-TEQV IN WSS-VARI.

      *ALD-BCI-INI/21.07.1999
           IF WSS-VAL-TEQV IN WSS-VARI = ZEROES
               MOVE '='    TO RD3-IND-ERRO IN RD3
               GO TO FIN-DET-TASA-CRED.
      *ALD-BCI-FIN/21.07.1999
      * Obtiene Tasa Maxima Convencional del Credito a Fecha de Colocaci
      *ALD-BCI-INI/15.04.1999
      *    IF INT-CVTI > SPACES
      *ALD-BCI-FIN/15.04.1999
      *ALD-BCI-INI/05.05.1999
           IF WSS-IND-TXC = 'S'
               PERFORM OBT-TASA-TXC
               IF WSS-IND-STAT IN WSS-VARI = 1
                   GO TO FIN-DET-TASA-CRED
               ELSE
                   NEXT SENTENCE
           ELSE
      *ALD-BCI-FIN/05.05.1999
           PERFORM OBT-TASA-TMC.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO FIN-DET-TASA-CRED
           ELSE
      *ALD-BCI-INI/05.04.1999
               IF WSS-IND-VTMC IN WSS-VARI = 'S'
                   IF WSS-VAL-TEQV IN WSS-VARI >
                      WSS-VAL-TMCC IN WSS-VARI
                       MOVE '+'    TO RD3-IND-ERRO IN RD3
                       GO TO FIN-DET-TASA-CRED
                   ELSE
                       IF WSS-VAL-TEQV IN WSS-VARI >
                          WSS-VAL-TMXC IN WSS-VARI
                           MOVE WSS-VAL-TMXC IN WSS-VARI TO
                           WSS-VAL-TEQV IN WSS-VARI
                       ELSE
                           NEXT SENTENCE
               ELSE
      *ALD-BCI-FIN/05.04.1999
               IF WSS-VAL-TEQV IN WSS-VARI > WSS-VAL-TMXC IN WSS-VARI
                   MOVE WSS-VAL-TMXC IN WSS-VARI TO
                        WSS-VAL-TEQV IN WSS-VARI.
      *RVM-CST-INI 19.01.1996
      *A PETICION DE BCI
           IF OPC-COD-VCOC IN OPC = '0998'
               IF (ICG-MSC-PBTI IN ICG = 'X' OR
                   ICG-MSC-PBTI IN ICG = 'A' )
                    NEXT SENTENCE
               ELSE
                  MULTIPLY WSS-VAL-TEQV IN WSS-VARI BY 12
                      GIVING WSS-VAL-TEQV IN WSS-VARI.

           IF OPC-COD-VCOC IN OPC = '0999'
               IF ICG-MSC-PBTI IN ICG = 'X' OR 'A'
                  DIVIDE WSS-VAL-TEQV IN WSS-VARI BY 12
                      GIVING WSS-VAL-TEQV IN WSS-VARI.

      *RVM-CST-FIN 19.01.1996
      *RVM-CST-INI 26.JAN.1996
      *
           IF OPC-COD-VCOC IN OPC = '0998'
               IF WSS-VAL-TEQV IN WSS-VARI < 4
                   MOVE '*'    TO RD3-IND-ERRO IN RD3
               ELSE
                   MOVE SPACES TO RD3-IND-ERRO IN RD3.

           IF OPC-COD-VCOC IN OPC = '0999'
              IF WSS-VAL-TEQV IN WSS-VARI < 0,5
                  MOVE '*'    TO RD3-IND-ERRO IN RD3
              ELSE
                  MOVE SPACES TO RD3-IND-ERRO IN RD3.

      *RVM-CST-FIN 26.JAN.1996
       FIN-DET-TASA-CRED.
           EXIT.
      ******************************************************************
      * Lectura de la ICG para obtener la Tasa de Interes del Credito
       GET-ICG-OPC SECTION.
       INI-GET-ICG-OPC.
           MOVE OPC-CIC-IOPC IN OPC TO ICG-CIC-IOPC IN ICG.
           MOVE ZEROES              TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE 'INT'               TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF NOT ( FIO-STAT-OKS AND
                    ICG-CIC-IOPC IN ICG = OPC-CIC-IOPC IN OPC AND
                    ICG-NUM-ICAN IN ICG = ZEROES              AND
                    ICG-CIC-IOPV IN ICG = SPACES              AND
                    ICG-NUM-IVCT IN ICG = ZEROES              AND
                    ICG-IND-TTAS IN ICG = 'INT' )
                     MOVE '23' TO FIO-STAT.
       FIN-GET-ICG-OPC.
           EXIT.
      *-----------------------------------------------------------------
      * Lectura de la ICG para obtener la Tasa de Interes del Documento
       GET-ICG-DLC SECTION.
       INI-GET-ICG-DLC.
           MOVE DLC-CIC-IOPC IN DLC TO ICG-CIC-IOPC IN ICG.
           MOVE DLC-NUM-IDLC IN DLC TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE 'INT'               TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF NOT ( FIO-STAT-OKS AND
                    ICG-CIC-IOPC IN ICG = DLC-CIC-IOPC IN DLC AND
                    ICG-NUM-ICAN IN ICG = DLC-NUM-IDLC IN DLC AND
                    ICG-CIC-IOPV IN ICG = SPACES              AND
                    ICG-NUM-IVCT IN ICG = ZEROES              AND
                    ICG-IND-TTAS IN ICG = 'INT' )
                     PERFORM GET-ICG-OPC.
       FIN-GET-ICG-DLC.
           EXIT.
      *-----------------------------------------------------------------
      * Calculo de tasa de interes EQUIVALENTE
       CAL-TAS-EQV SECTION.
       INI-CAL-TAS-EQV.
      * Calculo tasa de interes a partir de una tasa y periodo dado
      * Tasa Interes.                    * INT-TIPT.
      * Valor Tasa Informada.            * INT-TINT.
      * Fecha Inicial Periodo.           * INT-FINI.
      * Separacion entre Vencimientos.   * INT-SEPA.
      * Unidad de separacion.            * INT-IPER.
      * Analiza Feriado ?                * INT-AFER.
      * IF INT-CVTI > SPACES
      * Fecha Interes.                   * INT-FINT.
      * Moneda.                          * INT-VCAM.
           MOVE ZEROES TO WSS-IND-TEQV IN WSS-VARI
                          WSS-VAL-TEQV IN WSS-VARI.
      *5     MOVE WSS-FEC-FINF TO INT-FINI.
      *5     MOVE 1            TO INT-SEPA.
           IF OPC-COD-VCOC IN OPC = WSS-COD-UEFE IN WSS-VARI
               MOVE  360  TO INT-SEPA INT-SEPD
           ELSE
               MOVE  30   TO INT-SEPA INT-SEPD.
      *5     MOVE 'M'          TO INT-IPER.
      *5     MOVE 'N'          TO INT-AFER.
           MOVE WSS-VAL-TASA TO INT-TINT.
           IF INT-CVTI > SPACES
               MOVE INT-IBTV-UNA-VEZ    TO INT-IBTV
               MOVE ICG-FEC-FINI IN ICG TO INT-FINT
               MOVE OPC-COD-VCOC IN OPC TO INT-VCAM
               MOVE WSS-VAL-SPRD        TO INT-TINT
      *        En el Ingreso ICG-FEC-FINI = ZEROES
               IF INT-FINT NOT > ZEROES
                   MOVE OPC-FEC-FCOL IN OPC TO INT-FINT.
      *5     PERFORM PRO-IPER.
      *5     IF INT-CMSG > SPACES
      *5         GO TO MSG-MAIN.
      *5     MOVE INT-FINI TO FEC-FECH.
      *5     PERFORM PRO-AFER.
      *5     IF INT-CMSG > SPACES
      *5         GO TO MSG-MAIN.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               GO TO MSG-MAIN.
           MULTIPLY INT-TIPE BY 100 GIVING WSS-VAL-TEQV IN WSS-VARI
                                                           ROUNDED.
           MOVE  1  TO WSS-IND-TEQV IN WSS-VARI.
           GO TO FIN-CAL-TAS-EQV.
       MSG-MAIN.
           MOVE 'GNS'    TO MSG-COD-SIST.
           MOVE INT-CMSG TO MSG-COD-MENS.
           PERFORM GET-MSG.
           DISPLAY MSG-GLS-DESC.
       FIN-CAL-TAS-EQV.
           EXIT.
      *-----------------------------------------------------------------
      * Obtiene la Tasa Base a Fecha de Colocacion del Credito y luego
      * se compone la Tasa del Credito Variable
       OBT-TASA-VAR SECTION.
       INI-OBT-TASA-VAR.
           MOVE INT-TINT TO INT-TIPE.
           MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(1).
           MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(2).
           MOVE 'I'                 TO CAM-MSC-TVAL IN CAM(1).
           MOVE INT-CVTI            TO CAM-COD-CVAL IN CAM(1).
           MOVE INT-PBTI            TO CAM-COD-TCAM IN CAM(1).
           MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CAMBTSANXABT' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC ' : ' CAM-KEY-CAMB IN CAM
           ELSE
           IF CAM-MSC-STAT IN CAM NOT = 'S'
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CAMBTSANVABT' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC ' : ' CAM-KEY-CAMB IN CAM
           ELSE
               ADD CAM-SGV-VCAM IN CAM TO INT-TIPE.
       FIN-OBT-TASA-VAR.
           EXIT.
      *-----------------------------------------------------------------
      * Obtiene Tasa Maxima Convencional del Credito a Fecha de Colocaci
       OBT-TASA-TMC SECTION.
       INI-OBT-TASA-TMC.
           IF WSS-FEC-FIN1 IN WSS-VARI = OPC-FEC-FCOL IN OPC
               IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS-VARI
                   IF DLC-COD-PLZO IN DLC = 'C1' OR 'C2'
                       MOVE WSS-VAL-TB90 IN WSS-VARI TO
                            WSS-VAL-TMXC IN WSS-VARI
                   ELSE
                       MOVE WSS-VAL-TS90 IN WSS-VARI TO
                            WSS-VAL-TMXC IN WSS-VARI
               ELSE
               IF OPC-COD-VCOC IN OPC = WSS-COD-UEFE IN WSS-VARI
      *         IF OPC-COD-VCOC IN OPC = WSS-COD-UEFE IN WSS-VARI OR
      *            OPC-COD-VCOC IN OPC = WSS-COD-DOLA IN WSS-VARI
                   MOVE WSS-VAL-TREA IN WSS-VARI TO
                        WSS-VAL-TMXC IN WSS-VARI
      *         ELSE
      *         IF OPC-COD-VCOC IN OPC = WSS-COD-DOLA IN WSS-VARI
      *             MOVE WSS-VAL-TMEX IN WSS-VARI TO
      *                  WSS-VAL-TMXC IN WSS-VARI
               ELSE
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'MONEDA NO CLASIFICADA FP: ' OPC-COD-VCOC IN OPC
               GO TO FIN-OBT-TASA-TMC
           ELSE
               IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS-VARI
                   MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
                   IF DLC-COD-PLZO IN DLC = 'C1' OR 'C2'
                       MOVE 'TB90' TO CAM-COD-VCAM IN CAM(2)
                   ELSE
                       MOVE 'TS90' TO CAM-COD-VCAM IN CAM(2)
               ELSE
               IF OPC-COD-VCOC IN OPC = WSS-COD-UEFE IN WSS-VARI
      *         IF OPC-COD-VCOC IN OPC = WSS-COD-UEFE IN WSS-VARI OR
      *            OPC-COD-VCOC IN OPC = WSS-COD-DOLA IN WSS-VARI
                   MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
                   MOVE 'TMXC'              TO CAM-COD-VCAM IN CAM(2)
      *         ELSE
      *         IF OPC-COD-VCOC IN OPC = WSS-COD-DOLA IN WSS-VARI
      *             MOVE 'TMEX' TO CAM-COD-VCAM IN CAM(1)
      *             MOVE 'TMXC' TO CAM-COD-VCAM IN CAM(2)
               ELSE
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'MONEDA NO CLASIFICADA FC: ' OPC-COD-VCOC IN OPC
               GO TO FIN-OBT-TASA-TMC.

           IF WSS-FEC-FIN1 IN WSS-VARI = OPC-FEC-FCOL IN OPC
      *ALD-BCI-INI/05.04.1999
      *         GO TO FIN-OBT-TASA-TMC.
               GO TO EXT-OBT-TASA-TMC.
      *ALD-BCI-FIN/05.04.1999

           MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(1).
           MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'NO EXISTE TASA MAXIMA CONV. A FECHA CURSE : '
                        OPC-FEC-FCOL IN OPC               ' PARA LA '
                        CAM-COD-VCAM IN CAM(2)
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA CURSE : '
                        OPC-FEC-FCOL IN OPC               ' PARA LA '
                        CAM-COD-VCAM IN CAM(2)
               PERFORM GNS-PRO-ABT
           ELSE
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMXC IN WSS-VARI.
      *ALD-BCI-INI/05.04.1999
       EXT-OBT-TASA-TMC.
           IF WSS-IND-VTMC IN WSS-VARI NOT = 'S'
               GO TO FIN-OBT-TASA-TMC.
           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS-VARI
               MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
               IF DLC-COD-PLZO IN DLC = 'C1' OR 'C2'
                   MOVE 'TB90' TO CAM-COD-VCAM IN CAM(2)
               ELSE
                   MOVE 'TS90' TO CAM-COD-VCAM IN CAM(2)
           ELSE
               IF OPC-COD-VCOC IN OPC = WSS-COD-UEFE IN WSS-VARI
                   MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
                   MOVE 'TMXC'              TO CAM-COD-VCAM IN CAM(2)
               ELSE
                   MOVE  1  TO WSS-IND-STAT IN WSS-VARI
                   DISPLAY 'NO CLASIFICADA FC: ' OPC-COD-VCOC IN OPC
                   GO TO FIN-OBT-TASA-TMC.
           MOVE OPC-FEC-FINP IN OPC TO CAM-FEC-FCAM IN CAM(1).
           MOVE OPC-FEC-FINP IN OPC TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'NO EXISTE TASA MAXIMA CONV. A F CUR (CMP) : '
                        OPC-FEC-FINP IN OPC               ' PARA LA '
                        CAM-COD-VCAM IN CAM(2)
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA CUR (CMP) : '
                        OPC-FEC-FINP IN OPC               ' PARA LA '
                        CAM-COD-VCAM IN CAM(2)
               PERFORM GNS-PRO-ABT
           ELSE
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC IN WSS-VARI.
           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO
               IF INT-PBTI = 'D'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 30
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
               IF INT-PBTI = 'M' OR 'T'
                   MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC
               ELSE
                   MULTIPLY CAM-SGV-VCAM IN CAM BY 12 GIVING
                            WSS-VAL-TMCC  ROUNDED
           ELSE
               IF INT-PBTI  = 'D'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 360
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
               IF INT-PBTI = 'M' OR 'T'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 12
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
                   MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC.
      *ALD-BCI-FIN/05.04.1999
       FIN-OBT-TASA-TMC.
           EXIT.
      ******************************************************************
      * Obtiene Valor de Cambio de Credito en Pesos a Fecha Informe
       DET-VAL-CAMB-FINF SECTION.
       INI-DET-VAL-CAMB-FINF.
           MOVE  1  TO WSS-IND-STAT IN WSS-VARI.

      *RVM-CST-INI 22-JAN-1996
      *     IF OPC-COD-VCOC IN OPC = WSS-COD-UEFE IN WSS-VARI
      *         MOVE WSS-SGV-UEFE IN WSS-VARI TO WSS-SGV-FINF IN WSS-VAR
      *RVM-CST-FIN 22-JAN-1996
      *     ELSE
      *     IF OPC-COD-VCOC IN OPC = WSS-COD-DOLA IN WSS-VARI
      *         MOVE WSS-SGV-DOLA IN WSS-VARI TO WSS-SGV-FINF IN WSS-VAR
      *RVM-CST-INI 22-JAN-1996
      *     ELSE
      *         MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1)
      *         MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2)
      *RVM-CST-FIN 22-JAN-1996


           IF OPC-IND-RENO IN OPC = 'PRO'
               PERFORM PRO-PRO
               IF MSG-COD-MENS IN MSG > SPACES
                   GO TO FIN-DET-VAL-CAMB-FINF.

           IF OPC-IND-RENO IN OPC = 'PRO'
               MOVE WSS-FEC-FORI IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1)
               MOVE WSS-FEC-FORI IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2)
           ELSE
               MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(1)
               MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(2).
               MOVE OPC-COD-VCOC IN OPC      TO CAM-COD-VCAM IN CAM(1).
               MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
               MOVE FIO-GET-KEY TO FIO-CMND.
               PERFORM TAB-FIO-CAM.
               IF NOT FIO-STAT-OKS
                   DISPLAY 'NO EXISTE VALOR DE CAMBIO A FECHA'
      *RVM-CST-INI 22-JAN-1996
      *                     ' INFORME : '      WSS-FEC-FINF IN WSS-VARI
                           ' FCOL    : '      OPC-FEC-FCOL IN OPC
      *RVM-CST-FIN 22-JAN-1996
                           ' PARA : '         OPC-COD-VCOC IN OPC
                           ' EN OPERACION : ' OPC-CIC-IOPC IN OPC
                   GO TO FIN-DET-VAL-CAMB-FINF
               ELSE
               IF CAM-IND-VIGE NOT = 'S'
                   DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA'
      *RVM-CST-INI 22-JAN-1996
      *                     ' INFORME : '      WSS-FEC-FINF IN WSS-VARI
                           ' FCOL    : '      OPC-FEC-FCOL IN OPC
      *RVM-CST-FIN 22-JAN-1996
                           ' PARA : '         OPC-COD-VCOC IN OPC
                           ' EN OPERACION : ' OPC-CIC-IOPC IN OPC
                   GO TO FIN-DET-VAL-CAMB-FINF
               ELSE
                   MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-FINF IN WSS-VARI.

           MOVE  0  TO WSS-IND-STAT IN WSS-VARI.
       FIN-DET-VAL-CAMB-FINF.
           EXIT.
      ******************************************************************
      * Graba montos para Control de Proceso segun Codigos de Oficina,
      * Plazo, Clase y Moneda del Credito por DLC en registro RD3
       PUT-CTR-OPC-RD3 SECTION.
       INI-PUT-CTR-OPC-RD3.
      *RVM-CST-INI 22.01.1996
           MOVE DLC-VAL-NDLC IN DLC TO WSS-VAL-NDLC IN WSS-VARI.
           DISPLAY 'OPC : ' OPC-CIC-IOPC IN OPC ' CL : '
             OPC-COD-COOC IN OPC 'MO : ' OPC-COD-VCOC IN OPC
             ' FC : ' OPC-FEC-FCOL IN OPC ' FI : ' OPC-FEC-FINP IN OPC
             ' PZ : ' DLC-COD-PLZO IN DLC
             ' MT : ' WSS-VAL-NDLC IN WSS-VARI.
      *RVM-CST-FIN 22.01.1996
      *RVM-CST-INI 26-JAN-1996
           MOVE OPC-CAI-IOPC IN OPC      TO RD3-CAI-IOPC IN RD3.
           MOVE OPC-IIC-IOPC IN OPC      TO RD3-IIC-IOPC IN RD3.
           MOVE WSS-IND IN WSS-VARI      TO RD3-NUM-LINE IN RD3.
           MOVE ZEROES                   TO RD3-GLS-DISP IN RD3.
      *RVM-CST-FIN 26-JAN-1996
           MOVE OPC-COD-OFOC IN OPC      TO RD3-COD-OFOC IN RD3.
           MOVE DLC-COD-PLZO IN DLC      TO RD3-COD-PLZO IN RD3.
           MOVE OPC-COD-COOC IN OPC      TO RD3-COD-COOC IN RD3.
           MOVE OPC-COD-VCOC IN OPC      TO RD3-COD-VCOC IN RD3.
           MOVE DLC-VAL-NDLC IN DLC      TO RD3-VAL-CAPI IN RD3.
      *ALD-BCI-INI/14.05.1999
           MOVE WSS-VAL-TRAM IN WSS-VARI TO RD3-VAL-TRAM IN RD3.
      *ALD-BCI-FIN/14.05.1999
           MOVE WSS-VAL-TEQV IN WSS-VARI TO RD3-VAL-INTE IN RD3.
      *RVM-CST-INI 17.01.96
           MOVE WSS-NUM-DINF IN WSS-VARI TO RD3-NUM-DPRO IN RD3.
           MOVE WSS-NUM-MINF IN WSS-VARI TO RD3-NUM-MPRO IN RD3.
           MOVE WSS-NUM-SINF IN WSS-VARI TO RD3-NUM-SPRO IN RD3.
           MOVE WSS-NUM-AINF IN WSS-VARI TO RD3-NUM-APRO IN RD3.
      *RVM-CST-FIN 17.01.96
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-RD3.
           IF NOT FIO-STAT-OKS
               DISPLAY ' ERROR AL GRABAR RD3, FIO-STAT : ' FIO-STAT
               DISPLAY ' EN DLC : ' DLC-KEY-IDLC IN DLC
               PERFORM GNS-PRO-ABT
           ELSE
               ADD 1 TO WSS-NUM-RD3G.
       FIN-PUT-CTR-OPC-RD3.
           EXIT.
      ******************************************************************
       CAL-TAS-PPON SECTION.
       INI-CAL-TAS-PPON.
           IF WSS-CONT(WSS-SUB) = ZEROES
               MOVE ZEROES TO WSS-TPPO IN WSS-ELE(WSS-SUB)
           ELSE
               DIVIDE WSS-PPON IN WSS-ELE(WSS-SUB) BY
                      WSS-MONT IN WSS-ELE(WSS-SUB) GIVING
                      WSS-TPPO IN WSS-ELE(WSS-SUB) ROUNDED.
       FIN-CAL-TAS-PPON.
           EXIT.

      *RVM-CST-INI 18-JAN-1996
       CAL-TAS-PPON-Z04 SECTION.
       INI-CAL-TAS-PPON-Z04.

           IF WSS-MT10-Z04(WSS-SUB) = ZEROES
               MOVE ZEROES TO WSS-TP10-Z04 IN WSS-ELE-Z04(WSS-SUB)
               MOVE ZEROES TO WSS-TP05-Z04 IN WSS-ELE-Z04(WSS-SUB)
           ELSE
               DIVIDE WSS-PP10-Z04 IN WSS-ELE-Z04(WSS-SUB) BY
                      WSS-MT10-Z04 IN WSS-ELE-Z04(WSS-SUB) GIVING
                      WSS-TP10-Z04 IN WSS-ELE-Z04(WSS-SUB)ROUNDED
               IF WSS-MT05-Z04 IN WSS-ELE-Z04(WSS-SUB) > ZEROES
                   DIVIDE WSS-PP05-Z04 IN WSS-ELE-Z04(WSS-SUB) BY
                          WSS-MT05-Z04 IN WSS-ELE-Z04(WSS-SUB) GIVING
                          WSS-TP05-Z04 IN WSS-ELE-Z04(WSS-SUB) ROUNDED
               ELSE
                   MOVE ZEROES TO WSS-TP05-Z04 IN WSS-ELE-Z04(WSS-SUB).
       FIN-CAL-TAS-PPON-Z04.
           EXIT.

      *RVM-CST-FIN 18-JAN-1996
      ******************************************************************
      * Forma y Graba el Registro Interfaz FD3 Super-Bancos - DAP- COL
       GEN-REG-FD3 SECTION.
       INI-GEN-REG-FD3.
           IF WSS-MONT IN WSS-ELE(WSS-SUB) NOT > ZEROES
               GO TO FIN-GEN-REG-FD3.

      * Forma el Registro Interfaz FD3 Super-Bancos - COL - DAP
           MOVE 'A'                 TO FD3-COD-TIPO IN FD3.
           MOVE WSS-SUB IN WSS-VARI TO FD3-NUM-LINE IN FD3.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM SUP-FIO-FD3.
           IF NOT FIO-STAT-OKS
               MOVE SPACES                       TO FD3-GLS-FLAG IN FD3
               MOVE 'COL'                        TO FD3-COD-SIST IN FD3
               MOVE SPACES                       TO FD3-GLS-DISP IN FD3
               MOVE WSS-MONT IN WSS-ELE(WSS-SUB) TO FD3-VAL-MONT IN FD3
               MOVE WSS-TMIN IN WSS-ELE(WSS-SUB) TO FD3-VAL-TMIN IN FD3
               MOVE WSS-TMAX IN WSS-ELE(WSS-SUB) TO FD3-VAL-TMAX IN FD3
               MOVE WSS-TPPO IN WSS-ELE(WSS-SUB) TO FD3-VAL-PPON IN FD3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM SUP-FIO-FD3
               IF NOT FIO-STAT-OKS
                   DISPLAY ' ERROR EN INGRESO FD3, FIO-STAT : ' FIO-STAT
                   DISPLAY ' LLAVE : ' FD3-KEY-IFD3
                   PERFORM GNS-PRO-ABT
               ELSE
                   ADD 1 TO WSS-NUM-FD3G
           ELSE
               ADD WSS-MONT IN WSS-ELE(WSS-SUB) TO FD3-VAL-MONT IN FD3
               ADD WSS-TMIN IN WSS-ELE(WSS-SUB) TO FD3-VAL-TMIN IN FD3
               ADD WSS-TMAX IN WSS-ELE(WSS-SUB) TO FD3-VAL-TMAX IN FD3
               ADD WSS-TPPO IN WSS-ELE(WSS-SUB) TO FD3-VAL-PPON IN FD3
               MOVE FIO-MOD TO FIO-CMND
               PERFORM SUP-FIO-FD3
               IF NOT FIO-STAT-OKS
                   DISPLAY 'ERROR EN MODIFICACION FD3, FIO-STAT : '
                            FIO-STAT
                   DISPLAY ' LLAVE : ' FD3-KEY-IFD3
                   PERFORM GNS-PRO-ABT.
       FIN-GEN-REG-FD3.
           EXIT.

      *RVM-CST-INI 18-JAN-1996
      *GRABA REGISTRO CABECERA
       GEN-REG-CAB-Z04 SECTION.
       INI-GEN-REG-CAB-Z04.
           MOVE '016'                    TO Z04-COD-BNCO IN Z04.
           MOVE 'Z04'                    TO Z04-COD-FILE IN Z04.
           MOVE WSS-FEC-REFE IN WSS-VARI TO Z04-FEC-REFE IN Z04.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM SUP-FIO-Z04.
           IF NOT FIO-STAT-OKS
               DISPLAY ' ERROR EN INGRESO Z04, FIO-STAT : ' FIO-STAT
               DISPLAY ' LLAVE : ' Z04
               PERFORM GNS-PRO-ABT
           ELSE
               ADD 1 TO WSS-NUM-Z04G.
       FIN-GEN-REG-CAB-Z04.
           EXIT.

      * Forma y Graba el Registro Interfaz Z04 Super-Bancos - DAP- COL
       GEN-REG-Z04 SECTION.
       INI-GEN-REG-Z04.
           IF WSS-MT10-Z04 IN WSS-ELE-Z04(WSS-SUB) NOT > ZEROES
               GO TO FIN-GEN-REG-Z04.

      * Forma el Registro Interfaz Z04 Super-Bancos - COL - DAP
           MOVE WSS-SUB      IN WSS-VARI TO Z04-NUM-LINE IN Z04.
           MOVE WSS-NUM-DINF IN WSS-VARI TO Z04-NUM-DZ04 IN Z04.
           MOVE WSS-NUM-MINF IN WSS-VARI TO Z04-NUM-MZ04 IN Z04.
           MOVE WSS-NUM-AINF IN WSS-VARI TO Z04-NUM-AZ04 IN Z04.
           MOVE WSS-TP05-Z04 IN WSS-ELE-Z04(WSS-SUB) TO
                Z04-VAL-TP05 IN Z04.
           MOVE WSS-MT05-Z04 IN WSS-ELE-Z04(WSS-SUB) TO
                Z04-VAL-MT05 IN Z04.
           MOVE WSS-TP10-Z04 IN WSS-ELE-Z04(WSS-SUB) TO
                Z04-VAL-TP10 IN Z04.
           MOVE WSS-MT10-Z04 IN WSS-ELE-Z04(WSS-SUB) TO
                Z04-VAL-MT10 IN Z04.
           MOVE FIO-PUT TO FIO-CMND
           PERFORM SUP-FIO-Z04
           IF NOT FIO-STAT-OKS
               DISPLAY ' ERROR EN INGRESO Z04, FIO-STAT : ' FIO-STAT
               DISPLAY ' LLAVE : ' Z04
               PERFORM GNS-PRO-ABT
           ELSE
               ADD 1 TO WSS-NUM-Z04G.
       FIN-GEN-REG-Z04.
           EXIT.

       PRO-PRO SECTION.
       INI-PRO-PRO.
           MOVE SPACES TO MSG-COD-MENS IN MSG.
      * Obtiene valor renovado si opc es ingreso de prorroga.
      * Conversion a pesos se efectua a la fcol original.
           IF OPC-IND-RENO IN OPC NOT = 'PRO'
              GO TO FIN-PRO-PRO.
      * Guarda el CIC de la OPC de la prorroga.
           MOVE OPC-CIC-IOPC IN OPC TO AUX-CIC-IOPC IN WSS-VARI.
      * Lee OPC original para rescatar la fecha de origen.
           MOVE DLC-CIC-IOCO IN DLC TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
              MOVE 'COL'        TO MSG-COD-SIST
              MOVE 'OPCORIGNEX' TO MSG-COD-MENS
              PERFORM GET-MSG
              DISPLAY MSG-GLS-DESC   OPC-CIC-IOPC IN OPC
           ELSE
      *ALD-BCI-INI/05051999
               MOVE OPC-VAL-CRED IN OPC TO WSS-CRED-ORIG
      *ALD-BCI-FIN/05051999
      * Mueve fecha de OPC original para la conversion a valor origen
              MOVE OPC-FEC-FCOL IN OPC TO WSS-FEC-FORI IN WSS-VARI.
      * Vuelve a leer la OPC de la prorroga
           MOVE AUX-CIC-IOPC IN WSS-VARI TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FIN-PRO-PRO.
           EXIT.
      *RVM-CST-FIN 18-JAN-1996

      *RVM-CST-INI 25-JAN-1996
       PRO-CC3 SECTION.
       INI-PRO-CC3.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SUP-FIO-CC3.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR: SUPCC3 NO CONTIENE REGISTROS '
               GO TO FIN-PRO-CC3.

      *ESTOS MOVIMIENTOS NO SON PRORROGAS
           MOVE SPACES              TO OPC-IND-RENO IN OPC.
           MOVE SPACES              TO WSS-OPEC IN WSS-VARI.
       LUP-PRO-CC3.
           IF NOT FIO-STAT-OKS
               GO TO FIN-PRO-CC3.

           ADD 1 TO WSS-NUM-CC3L IN WSS-VARI.
      *ALD-BCI-INI/29.01.1996
      *     IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
      *         IF WSS-COD-OFOC IN WSS-VARI NOT = CC3-COD-OFOC IN CC3
      *             GO TO NXT-PRO-CC3.
      *ALD-BCI-FIN
      *RVM-CST-INI 16-APR-1996
           MOVE CC3-CAI-ICTE IN CC3 TO OPC-CAI-IOPC IN OPC.
           MOVE CC3-IIC-ICTE IN CC3 TO OPC-IIC-IOPC IN OPC.
      *RVM-CST-FIN 16-APR-1996

           MOVE CC3-COD-OFOC IN CC3 TO OPC-COD-OFOC IN OPC.
           MOVE CC3-COD-PLZO IN CC3 TO DLC-COD-PLZO IN DLC.
           MOVE CC3-COD-COOC IN CC3 TO OPC-COD-COOC IN OPC.
           MOVE CC3-COD-VCOC IN CC3 TO OPC-COD-VCOC IN OPC.
           MOVE CC3-VAL-CAPI IN CC3 TO DLC-VAL-NDLC IN DLC.
      *ALD-BCI-INI/14.05.1999
           MOVE CC3-VAL-TRAM IN CC3 TO WSS-VAL-TRAM IN WSS-VARI.
      *ALD-BCI-FIN/14.05.1999
           MOVE CC3-VAL-INTE IN CC3 TO WSS-VAL-TEQV IN WSS-VARI.
           MOVE CC3-FEC-FPRO IN CC3 TO OPC-FEC-FCOL IN OPC.
      *
      *INI-JGM 19-01-2000
      *
           IF CC3-COD-VCOC IN CC3  = '0998  ' OR
              CC3-COD-VCOC IN CC3  = '0999  '
               IF WSS-IND-TXC = 'S'
                  PERFORM OBT-TASA-TXC-CC3
                  IF WSS-IND-STAT IN WSS-VARI = 1
                     GO TO NXT-PRO-CC3
                  ELSE
                     NEXT SENTENCE
               ELSE
                 PERFORM OBT-TASA-TMC-CC3
           ELSE
              GO TO SEG-PRO-CC3.
      *
           IF WSS-IND-STAT IN WSS-VARI = 1
              GO TO NXT-PRO-CC3.

           IF WSS-IND-VTMC IN WSS-VARI = 'S'
             IF WSS-VAL-TEQV IN WSS-VARI > WSS-VAL-TMCC IN WSS-VARI
               MOVE SPACES              TO RH3
               ADD 1                    TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC TO RH3-CIC-IOPC IN RH3
               MOVE 'TEQV>TMC  '       TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT             TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-PRO-CC3.
      *FIN-JGM 19-01-2000.
      *
      *ALD-BCI-INI/21.09.1999
       SEG-PRO-CC3.
           IF WSS-VAL-TEQV IN WSS-VARI = ZEROES
               MOVE SPACES              TO RH3
               ADD 1                    TO WSS-NUM-RRH3 IN WSS-VARI
               MOVE OPC-CIC-IOPC IN OPC      TO RH3-CIC-IOPC IN RH3
               MOVE 'TEQV=ZEROES'            TO RH3-COD-MENS IN RH3
               MOVE WSS-NUM-DINF IN WSS-VARI TO RH3-NUM-DPRO IN RH3
               MOVE WSS-NUM-MINF IN WSS-VARI TO RH3-NUM-MPRO IN RH3
               MOVE WSS-NUM-SINF IN WSS-VARI TO RH3-NUM-SPRO IN RH3
               MOVE WSS-NUM-AINF IN WSS-VARI TO RH3-NUM-APRO IN RH3
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-RH3
               GO TO NXT-PRO-CC3.
      *ALD-BCI-FIN/21.09.1999

      * Determinacion del Tramo para Distribuir Registro Seleccionado
           PERFORM DET-TRA-REG-PROC.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO NXT-PRO-CC3.

      *RVM-CST-INI 26-JAN-1996
      * Seleccion de Oficina de Operacion SOLO de Region Metropolitana
           IF WSS-COD-OFOC IN WSS-VARI = '*'
               MOVE 'S' TO WSS-COD-RMTP
           ELSE
               IF WSS-COD-OFOC IN WSS-VARI NOT = 'RM'
                   IF WSS-COD-OFOC NOT = CC3-COD-OFOC IN CC3
                       MOVE 'N' TO WSS-COD-RMTP.
           IF WSS-COD-OFOC IN WSS-VARI = 'RM'
               MOVE  1  TO WSS-NUM-IOFI
               SET WSS-NUM-OFIC TO 1
               SEARCH WSS-ELE-OFIC VARYING WSS-NUM-IOFI
                      AT END MOVE 'N' TO WSS-COD-RMTP
                  WHEN WSS-COD-OFIC(WSS-NUM-OFIC) = CC3-COD-OFOC IN CC3
                             MOVE 'S' TO WSS-COD-RMTP.
           IF WSS-COD-RMTP IN WSS-VARI = 'N'
               GO TO SOLO-RM-3.
      *RVM-CST-FIN 26-JAN-1996

      * Determinacion de las TASAS EXTREMAS Minima y Maxima
      *    DISPLAY 'OPC 2: ' OPC-CIC-IOPC IN OPC ' '
      *            'TMIN : ' WSS-TMIN IN WSS-ELE(WSS-IND) ' TMAX : '
      *        WSS-TMAX IN WSS-ELE(WSS-IND) ' TEQV : ' WSS-VAL-TEQV
      *              IN WSS-VARI.
           ADD 1  TO WSS-CONT(WSS-IND).
           IF WSS-CONT(WSS-IND) = 1
               MOVE WSS-VAL-TEQV IN WSS-VARI TO
                    WSS-TMIN IN WSS-ELE(WSS-IND)
           ELSE
           IF WSS-VAL-TEQV IN WSS-VARI < WSS-TMIN IN WSS-ELE(WSS-IND)
               MOVE WSS-VAL-TEQV IN WSS-VARI TO
                    WSS-TMIN IN WSS-ELE(WSS-IND).

           IF WSS-VAL-TEQV IN WSS-VARI > WSS-TMAX IN WSS-ELE(WSS-IND)
               MOVE WSS-VAL-TEQV IN WSS-VARI TO
                    WSS-TMAX IN WSS-ELE(WSS-IND).

       SOLO-RM-3.

      *ALD-BCI-INI/07.04.1999
      *LO INFORMADO EN ARCHIVO CC3 CORRESPONDE A MONEDA Y EL MONTO
      *EN $ POR LO QUE NO EXISTE CONVERSIN.
      * Obtiene Monto del Credito en Pesos a Fecha Informe
      *     IF OPC-COD-VCOC IN OPC NOT = WSS-COD-PESO IN WSS-VARI
      *         PERFORM DET-VAL-CAMB-FINF
      *         IF WSS-IND-STAT IN WSS-VARI = 1
      *             ADD 1 TO WSS-NUM-OPCR IN WSS-VARI
      *             GO TO NXT-PRO-CC3
      *         ELSE
      *             MULTIPLY DLC-VAL-NDLC IN DLC      BY
      *                      WSS-SGV-FINF IN WSS-VARI GIVING
      *                      DLC-VAL-NDLC IN DLC.

      *RVM-CST-INI 18-JAN-1996
           IF DLC-VAL-NDLC IN DLC < WSS-VAL-UF10 IN WSS-VARI
      *CREDITOS BAJO 10000 UF
               ADD DLC-VAL-NDLC IN DLC TO
                  WSS-MT10-Z04 IN WSS-ELE-Z04(WSS-IND)
               MULTIPLY WSS-VAL-TEQV IN WSS-VARI BY
                        DLC-VAL-NDLC IN DLC      GIVING
                        WSS-VAL-PPON IN WSS-VARI
                   ADD WSS-VAL-PPON IN WSS-VARI TO
                        WSS-PP10-Z04 IN WSS-ELE-Z04(WSS-IND)
      *CREDITOS BAJO 5000 UF
               IF DLC-VAL-NDLC IN DLC < WSS-VAL-UF05 IN WSS-VARI
                   ADD DLC-VAL-NDLC IN DLC TO
                      WSS-MT05-Z04 IN WSS-ELE-Z04(WSS-IND)
                   MULTIPLY WSS-VAL-TEQV IN WSS-VARI BY
                            DLC-VAL-NDLC IN DLC      GIVING
                        WSS-VAL-PPON IN WSS-VARI
                   ADD WSS-VAL-PPON IN WSS-VARI TO
                            WSS-PP05-Z04 IN WSS-ELE-Z04(WSS-IND).

      *RVM-CST-FIN 18-JAN-1996
           IF WSS-COD-RMTP IN WSS-VARI = 'N'
               GO TO SOLO-RM-4.

      * Acumulacion del Monto en $ de los Creditos Seleccionados
           ADD DLC-VAL-NDLC IN DLC TO WSS-MONT IN WSS-ELE(WSS-IND).

      * Determinacion y Calculo para el Promedio Ponderado
           MULTIPLY WSS-VAL-TEQV IN WSS-VARI BY
                    DLC-VAL-NDLC IN DLC      GIVING
                    WSS-VAL-PPON IN WSS-VARI.
           ADD WSS-VAL-PPON IN WSS-VARI TO
               WSS-PPON IN WSS-ELE(WSS-IND).

      * Graba montos para Control de Proceso segun Codigos de Oficina,
      * Plazo, Clase y Moneda del Credito por DLC en registro RD3
      * Seleccion de Oficina de Operacion SOLO de Region Metropolitana
       SOLO-RM-4.
           IF WSS-COD-RMTP IN WSS-VARI = 'S'
               PERFORM PUT-CTR-OPC-RD3
               ADD 1 TO WSS-NUM-CC3P IN WSS-VARI.
       NXT-PRO-CC3.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SUP-FIO-CC3.
           GO TO LUP-PRO-CC3.
       FIN-PRO-CC3.
           EXIT.
      *RVM-CST-FIN 25-JAN-1996
      ******************************************************************

       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBGEND.
       COPY GNSBGABT.

       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBFMSC.
       COPY TABBFOFI.
       COPY TABBFCAM.
       COPY TABBFCOM.
       COPY COLBFOPC.
       COPY COLBFDLC.
       COPY COLBFICG.
       COPY COLBFTOC.
       COPY COLBFDCC.

       COPY COLBFRD3.
      *ALD-BCI-INI/05.04.1999
       COPY COLBFRH3.
      *ALD-BCI-FIN/05.04.1999
       COPY SUPBFFD3.
      *RVM-CST-INI 18-JAN-1996
       COPY SUPBFZ04.
       COPY SUPBFCC3.
      *RVM-CST-FIN 18-JAN-1996
       COPY GNSBBMSC.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY GNSBGHOY.
      *SMC-INI 09.09.1993
       COPY COLBGINT.
      *SMC-FIN 09.09.1993
       COPY GNSBGCVI.
       COPY GNSBGPES.
       COPY COLBGCTO.
      *ALD-BCI-INI/03.05.1999
       COPY TABBBTXC.
      * Obtiene Tasa Maxima Convencional del Credito a Fecha de Colocaci
       OBT-TASA-TXC SECTION.
       INI-OBT-TASA-TXC.
           PERFORM DET-MNTO-ORIG.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO FIN-OBT-TASA-TXC.
           MOVE 1                            TO CAM-SGV-VCAM IN CAM.
           IF OPC-COD-VCOC NOT = '0998'
               MOVE '0998  '                 TO CAM-COD-VCAM IN CAM(1)
               MOVE OPC-COD-VCOC IN OPC      TO CAM-COD-VCAM IN CAM(2)
               MOVE WSS-NUM-DORI             TO CAM-NUM-DCAM IN CAM(1)
               MOVE WSS-NUM-MORI             TO CAM-NUM-MCAM IN CAM(1)
               MOVE WSS-NUM-SORI             TO CAM-NUM-SCAM IN CAM(1)
               MOVE WSS-NUM-AORI             TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT ( FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
                   MOVE 'TAB'        TO MSG-COD-SIST
                   MOVE 'CAM    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   DISPLAY 'NO EXISTE VALOR DE CAMBIO '
                   DISPLAY CAM-KEY-CAMB IN CAM
                   PERFORM GNS-PRO-ABT.

           DIVIDE WSS-CRED-ORIG       BY CAM-SGV-VCAM IN CAM
                  GIVING                   TXC-MNTO ROUNDED.

           MOVE DLC-COD-PLZO            TO TXC-PLZO.
           MOVE OPC-COD-VCOC IN OPC     TO TXC-VCOC.

           MOVE OPC-NUM-DCOL IN OPC     TO TXC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC     TO TXC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC     TO TXC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC     TO TXC-AEC1.

           MOVE ZEROES                  TO TXC-FEC2.

           PERFORM TAB-BUS-TXC.

           IF TXC-CMSG > SPACES
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE TXC-CMSG     TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY 'ERROR RUTINA TMC A FCOL : ' TXC-CMSG
               DISPLAY 'GLOSA ERROR : '      MSG-GLS-DESC
               PERFORM GNS-PRO-ABT.

           MOVE TXC-VTXC         TO WSS-VAL-TMXC IN WSS-VARI.

       EXT-OBT-TASA-TXC.
           IF WSS-IND-VTMC IN WSS-VARI NOT = 'S'
               GO TO FIN-OBT-TASA-TXC.

           PERFORM DET-MNTO-ORIG.
           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO FIN-OBT-TASA-TXC.
           MOVE 1                            TO CAM-SGV-VCAM IN CAM.
           IF OPC-COD-VCOC NOT = '0998'
               MOVE '0998  '                 TO CAM-COD-VCAM IN CAM(1)
               MOVE OPC-COD-VCOC IN OPC      TO CAM-COD-VCAM IN CAM(2)
               MOVE WSS-NUM-DORI             TO CAM-NUM-DCAM IN CAM(1)
               MOVE WSS-NUM-MORI             TO CAM-NUM-MCAM IN CAM(1)
               MOVE WSS-NUM-SORI             TO CAM-NUM-SCAM IN CAM(1)
               MOVE WSS-NUM-AORI             TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT ( FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
                   MOVE 'TAB'        TO MSG-COD-SIST
                   MOVE 'CAM    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   DISPLAY 'NO EXISTE VALOR DE CAMBIO '
                   DISPLAY CAM-KEY-CAMB IN CAM
                   PERFORM GNS-PRO-ABT.

           DIVIDE WSS-CRED-ORIG       BY CAM-SGV-VCAM IN CAM
                  GIVING                TXC-MNTO ROUNDED.
           MOVE DLC-COD-PLZO            TO TXC-PLZO.
           MOVE OPC-COD-VCOC IN OPC     TO TXC-VCOC.

           MOVE OPC-NUM-DINP IN OPC     TO TXC-DEC1.
           MOVE OPC-NUM-MINP IN OPC     TO TXC-MEC1.
           MOVE OPC-NUM-SINP IN OPC     TO TXC-SEC1.
           MOVE OPC-NUM-AINP IN OPC     TO TXC-AEC1.

           MOVE ZEROES                  TO TXC-FEC2.

           PERFORM TAB-BUS-TXC.

           IF TXC-CMSG > SPACES
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE TXC-CMSG     TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY 'ERROR RUTINA TMC A FINP : ' TXC-CMSG
               DISPLAY 'GLOSA ERROR  '              MSG-GLS-DESC
               PERFORM GNS-PRO-ABT.

           MOVE TXC-VTXC         TO CAM-SGV-VCAM IN CAM.

           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO
               IF INT-PBTI = 'D'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 30
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
               IF INT-PBTI = 'M' OR 'T'
                   MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC
               ELSE
                   MULTIPLY CAM-SGV-VCAM IN CAM BY 12 GIVING
                            WSS-VAL-TMCC  ROUNDED
           ELSE
               IF INT-PBTI  = 'D'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 360
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
               IF INT-PBTI = 'M' OR 'T'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 12
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
                   MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC.
      *ALD-BCI-FIN/05.04.1999
       FIN-OBT-TASA-TXC.
           EXIT.
       DET-MNTO-ORIG SECTION.
       INI-DET-MNTO-ORIG.
           MOVE  1  TO WSS-IND-STAT IN WSS-VARI.


           MOVE OPC-VAL-CRED IN OPC TO WSS-CRED-ORIG.
           MOVE OPC-FEC-FCOL IN OPC TO WSS-FEC-FORI.

           IF OPC-IND-RENO IN OPC = 'PRO'
               PERFORM PRO-PRO
               IF MSG-COD-MENS IN MSG > SPACES
                   GO TO FIN-DET-MNTO-ORIG.

           MOVE  0  TO WSS-IND-STAT IN WSS-VARI.
       FIN-DET-MNTO-ORIG.
           EXIT.
      *ALD-BCI-FIN/03.05.1999
      *>>>>

      *INI-JGM 19-01-2000.
       OBT-TASA-TXC-CC3 SECTION.
       INI-OBT-TASA-TXC-CC3.


       EXT-OBT-TASA-TXC-CC3.
           IF WSS-IND-VTMC IN WSS-VARI NOT = 'S'
               GO TO FIN-OBT-TASA-TXC-CC3.

      *    PERFORM DET-MNTO-ORIG.
           MOVE  ZERO               TO WSS-IND-STAT IN WSS-VARI.
           MOVE CC3-VAL-TRAM IN CC3 TO WSS-CRED-ORIG.
           MOVE OPC-FEC-FCOL IN OPC TO WSS-FEC-FORI.


           IF WSS-IND-STAT IN WSS-VARI = 1
               GO TO FIN-OBT-TASA-TXC-CC3.

           MOVE 1                     TO CAM-SGV-VCAM IN CAM.
           MOVE '0998  '              TO CAM-COD-VCAM IN CAM(1).
           MOVE '0999  '              TO CAM-COD-VCAM IN CAM(2).
           MOVE WSS-NUM-DORI          TO CAM-NUM-DCAM IN CAM(1).
           MOVE WSS-NUM-MORI          TO CAM-NUM-MCAM IN CAM(1).
           MOVE WSS-NUM-SORI          TO CAM-NUM-SCAM IN CAM(1).
           MOVE WSS-NUM-AORI          TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1)  TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT ( FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
                   MOVE 'TAB'        TO MSG-COD-SIST
                   MOVE 'CAM    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   DISPLAY 'NO EXISTE VALOR DE CAMBIO '
                   DISPLAY CAM-KEY-CAMB IN CAM
                   PERFORM GNS-PRO-ABT.

           DIVIDE WSS-CRED-ORIG       BY CAM-SGV-VCAM IN CAM
                  GIVING                TXC-MNTO ROUNDED.

           MOVE DLC-COD-PLZO            TO TXC-PLZO.
           MOVE OPC-COD-VCOC IN OPC     TO TXC-VCOC.

      *Fecha de proceso colpgfd3.
           MOVE WSS-NUM-DIN1 IN WSS-VARI TO TXC-DEC1.
           MOVE WSS-NUM-MIN1 IN WSS-VARI TO TXC-MEC1.
           MOVE WSS-NUM-SIN1 IN WSS-VARI TO TXC-SEC1.
           MOVE WSS-NUM-AIN1 IN WSS-VARI TO TXC-AEC1.

           MOVE ZEROES                  TO TXC-FEC2.

           PERFORM TAB-BUS-TXC.

           IF TXC-CMSG > SPACES
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE TXC-CMSG     TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY 'ERROR RUTINA TMC A FINP : ' TXC-CMSG
               DISPLAY 'GLOSA ERROR  '              MSG-GLS-DESC
               PERFORM GNS-PRO-ABT.

           MOVE TXC-VTXC         TO CAM-SGV-VCAM IN CAM.
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC.

       FIN-OBT-TASA-TXC-CC3.
           EXIT.
      *-----------------------------------------------------------------
      * Obtiene Tasa Maxima Convencional del Credito a Fecha de Colocaci
       OBT-TASA-TMC-CC3 SECTION.
       INI-OBT-TASA-TMC-CC3.

           IF WSS-FEC-FIN1 IN WSS-VARI = OPC-FEC-FCOL IN OPC
               IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS-VARI
                   IF DLC-COD-PLZO IN DLC = 'C1' OR 'C2'
                       MOVE WSS-VAL-TB90 IN WSS-VARI TO
                            WSS-VAL-TMXC IN WSS-VARI
                   ELSE
                       MOVE WSS-VAL-TS90 IN WSS-VARI TO
                            WSS-VAL-TMXC IN WSS-VARI
               ELSE
               IF OPC-COD-VCOC IN OPC = WSS-COD-UEFE IN WSS-VARI
                   MOVE WSS-VAL-TREA IN WSS-VARI TO
                        WSS-VAL-TMXC IN WSS-VARI
               ELSE
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'MONEDA NO CLASIFICADA FP: ' OPC-COD-VCOC IN OPC
               GO TO FIN-OBT-TASA-TMC-CC3

           ELSE
               IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS-VARI
                   MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
                   IF DLC-COD-PLZO IN DLC = 'C1' OR 'C2'
                       MOVE 'TB90' TO CAM-COD-VCAM IN CAM(2)
                   ELSE
                       MOVE 'TS90' TO CAM-COD-VCAM IN CAM(2)
               ELSE
               IF OPC-COD-VCOC IN OPC = WSS-COD-UEFE IN WSS-VARI
                   MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
                   MOVE 'TMXC'              TO CAM-COD-VCAM IN CAM(2)

               ELSE
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'MONEDA NO CLASIFICADA FC: ' OPC-COD-VCOC IN OPC
               GO TO FIN-OBT-TASA-TMC-CC3.

           IF WSS-FEC-FIN1 IN WSS-VARI = OPC-FEC-FCOL IN OPC
               GO TO EXT-OBT-TASA-TMC-CC3.

           MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(1).
           MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'NO EXISTE TASA MAXIMA CONV. A FECHA CURSE : '
                        OPC-FEC-FCOL IN OPC               ' PARA LA '
                        CAM-COD-VCAM IN CAM(2)
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA CURSE : '
                        OPC-FEC-FCOL IN OPC               ' PARA LA '
                        CAM-COD-VCAM IN CAM(2)
               PERFORM GNS-PRO-ABT
           ELSE
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMXC IN WSS-VARI.

       EXT-OBT-TASA-TMC-CC3.
           IF WSS-IND-VTMC IN WSS-VARI NOT = 'S'
               GO TO FIN-OBT-TASA-TMC-CC3.

           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS-VARI
               MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
               IF DLC-COD-PLZO IN DLC = 'C1' OR 'C2'
                   MOVE 'TB90' TO CAM-COD-VCAM IN CAM(2)
               ELSE
                   MOVE 'TS90' TO CAM-COD-VCAM IN CAM(2)
           ELSE
               IF OPC-COD-VCOC IN OPC = WSS-COD-UEFE IN WSS-VARI
                   MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
                   MOVE 'TMXC'              TO CAM-COD-VCAM IN CAM(2)
               ELSE
                   MOVE  1  TO WSS-IND-STAT IN WSS-VARI
                   DISPLAY 'NO CLASIFICADA FC: ' OPC-COD-VCOC IN OPC
                   GO TO FIN-OBT-TASA-TMC.

      *Fecha de proceso colpgfd3.
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-FIN1 IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'NO EXISTE TASA MAXIMA CONV. A F CUR (CMP) : '
                        OPC-FEC-FINP IN OPC               ' PARA LA '
                        CAM-COD-VCAM IN CAM(2)
               PERFORM GNS-PRO-ABT
           ELSE
           IF CAM-IND-VIGE NOT = 'S'
               MOVE  1  TO WSS-IND-STAT IN WSS-VARI
               DISPLAY 'IND. VIGENCIA NO VALIDO A FECHA CUR (CMP) : '
                        OPC-FEC-FINP IN OPC               ' PARA LA '
                        CAM-COD-VCAM IN CAM(2)
               PERFORM GNS-PRO-ABT
           ELSE
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC IN WSS-VARI.
           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO
               IF INT-PBTI = 'D'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 30
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
               IF INT-PBTI = 'M' OR 'T'
                   MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC
               ELSE
                   MULTIPLY CAM-SGV-VCAM IN CAM BY 12 GIVING
                            WSS-VAL-TMCC  ROUNDED
           ELSE
               IF INT-PBTI  = 'D'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 360
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
               IF INT-PBTI = 'M' OR 'T'
                   DIVIDE CAM-SGV-VCAM IN CAM BY 12
                          GIVING WSS-VAL-TMCC ROUNDED
               ELSE
                   MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-TMCC.
       FIN-OBT-TASA-TMC-CC3.
           EXIT.
      *INI-JGM 19-01-2000.


