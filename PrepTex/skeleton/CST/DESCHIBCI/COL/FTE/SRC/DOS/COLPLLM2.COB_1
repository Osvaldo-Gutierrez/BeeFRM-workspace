       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPLLM2.
       AUTHOR.          BEE-TEAM.
       DATE-WRITTEN.    10-Jun-98 03:01 PM.

      * Programa Listador de Reporte LM2 con Sort.
      *
      * V 1.1.2
      *
      *<<<< CMT_ID
      *>>>>


       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            C01 IS SALTO
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
      *DOS SELECT RPTLM2         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTLM2         ASSIGN TO        UT-S-RPTLM2.
           SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT RPTLM2         ASSIGN TO        UT-S-RPTLM2.
      *<<<< IOS
      *>>>>


       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY COLRRLM2.
      *<<<< RR
      *>>>>

       FD  RPTLM2 LABEL RECORDS OMITTED
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-LM2     PIC X(132).
      *<<<< FD_RPT
      *>>>>

      *<<<< FLS
      *>>>>


       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LMC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY COLBRLMC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSWGGRC.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY COLRWLM2.
      *<<<< RW
      *>>>>

       COPY COLRNLM2.
      *<<<< RN
      *>>>>

       COPY COLROLM2.
      *<<<< RO
      *>>>>

       COPY GNSWGSYS.
       01  PGM-HRSR-LM2   VALUE 'N'       PIC X(01).
           88 HAY-REGISTROS-EN-SORT-LM2  VALUE 'S'.

       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       COPY TABBROFI.
       COPY SGCBRDBC.
       COPY COLBRDPC.

       COPY GNSBRCIC.
       COPY GNSWGCIC.
       COPY GNSWGHOY.
       COPY GNSWGFEC.
       COPY GNSWGCPT.
       COPY GNSWCVRF.
       COPY GNSWVVRF.

       01  WSS-VARI.
           03 WSS-VARI-PRM.
              05 PRM-FEC-FINI.
                 07 PRM-NUM-DINI                     PIC 9(02).
                 07 PRM-NUM-MINI                     PIC 9(02).
                 07 PRM-NUM-SINI                     PIC 9(02).
                 07 PRM-NUM-AINI                     PIC 9(02).
              05 PRM-FEC-FTER.
                 07 PRM-NUM-DTER                     PIC 9(02).
                 07 PRM-NUM-MTER                     PIC 9(02).
                 07 PRM-NUM-STER                     PIC 9(02).
                 07 PRM-NUM-ATER                     PIC 9(02).
              05 PRM-FEC-FAUX.
                 07 PRM-NUM-SAUX                     PIC 9(02).
                 07 PRM-NUM-AAUX                     PIC 9(02).
                 07 PRM-NUM-MAUX                     PIC 9(02).
                 07 PRM-NUM-DAUX                     PIC 9(02).

              05 PRM-COD-OFIC                        PIC X(03).

              05 PRM-TIP-EMIS                        PIC X(01).
                 88 OK-TIP-EMIS       VALUE 'B' 'L' 'R'.
                 88 EMIS-BORRADOR     VALUE 'B'.
                 88 EMIS-LEGAL        VALUE 'L'.
                 88 EMIS-RESUMEN      VALUE 'R'.

           03 WSS-FEC-FINI.
              05 WSS-NUM-SINI                     PIC 9(02).
              05 WSS-NUM-AINI                     PIC 9(02).
              05 WSS-NUM-MINI                     PIC 9(02).
              05 WSS-NUM-DINI                     PIC 9(02).


           03 WSS-FEC-FTER.
              05 WSS-NUM-STER                     PIC 9(02).
              05 WSS-NUM-ATER                     PIC 9(02).
              05 WSS-NUM-MTER                     PIC 9(02).
              05 WSS-NUM-DTER                     PIC 9(02).

           03 WSS-FEC-FEJE.
              05 WSS-NUM-SEJE                     PIC 9(02).
              05 WSS-NUM-AEJE                     PIC 9(02).
              05 WSS-NUM-MEJE                     PIC 9(02).
              05 WSS-NUM-DEJE                     PIC 9(02).

           03 WSS-FEC-FDP2.
              05 WSS-NUM-SDP2                     PIC 9(02).
              05 WSS-NUM-ADP2                     PIC 9(02).
              05 WSS-NUM-MDP2                     PIC 9(02).
              05 WSS-NUM-DDP2                     PIC 9(02).
           03 WSS-FEC-FDP1.
              05 WSS-NUM-SDP1                     PIC 9(02).
              05 WSS-NUM-ADP1                     PIC 9(02).
              05 WSS-NUM-MDP1                     PIC 9(02).
              05 WSS-NUM-DDP1                     PIC 9(02).
           03 WSS-FEC-FCO1.
              05 WSS-NUM-SCO1                     PIC 9(02).
              05 WSS-NUM-ACO1                     PIC 9(02).
              05 WSS-NUM-MCO1                     PIC 9(02).
              05 WSS-NUM-DCO1                     PIC 9(02).

           03 WSS-FEC-FCO2.
              05 WSS-NUM-SCO2                     PIC 9(02).
              05 WSS-NUM-ACO2                     PIC 9(02).
              05 WSS-NUM-MCO2                     PIC 9(02).
              05 WSS-NUM-DCO2                     PIC 9(02).
           03 WSS-FEC-FREG.
              05 WSS-NUM-SREG                     PIC 9(02).
              05 WSS-NUM-AREG                     PIC 9(02).
              05 WSS-NUM-MREG                     PIC 9(02).
              05 WSS-NUM-DREG                     PIC 9(02).
           03 WSS-FEC-FFIN.
              05 WSS-NUM-SFIN                     PIC 9(02).
              05 WSS-NUM-AFIN                     PIC 9(02).
              05 WSS-NUM-MFIN                     PIC 9(02).
              05 WSS-NUM-DFIN                     PIC 9(02).
           03 WSS-FEC-FPRX.
              05 WSS-NUM-SPRX                     PIC 9(02).
              05 WSS-NUM-APRX                     PIC 9(02).
              05 WSS-NUM-MPRX                     PIC 9(02).
              05 WSS-NUM-DPRX                     PIC 9(02).
           03 WSS-FEC-FAUX.
              05 WSS-NUM-DAUX                     PIC 9(02).
              05 WSS-NUM-MAUX                     PIC 9(02).
              05 WSS-NUM-SAUX                     PIC 9(02).
              05 WSS-NUM-AAUX                     PIC 9(02).
           03 WSS-COD-OFIC                        PIC X(03).
           03 WSS-HAY-REG          VALUE 'NO'     PIC X(02).
              88 HAY-REG           VALUE 'SI'.
           03 WSS-COD-OFOC                        PIC X(03).
           03 WSS-IND-DIAHABIL                    PIC X(01).
                 88 FECE-NOHABIL      VALUE 'N'.
                 88 FECE-SIHABIL      VALUE 'S'.
           03 WSS-IND-FECH    VALUE 'N'           PIC X(01).
           03 WSS-IND-RESE    VALUE 'N'           PIC X(01).
           03 WSS-NUM-TDIA                        PIC 9(03).
      *
           03 WSS-CIC-CCSB                        PIC X(12).
           03 WSS-FEC-FCTB                        PIC X(08).
      *RRM-INI 8-MAY-1998
           03 WSS-FEC-FPRO                        PIC X(08).
      *RRM-FIN 8-MAY-1998
           03 WSS-TOT-SADB     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-TOT-SAHB     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-TOT-MVDB     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-TOT-MVHB     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-TOT-NSDB     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-TOT-NSHB     VALUE ZEROES  PIC 9(13)V9999.

           03 WSS-VAL-TDEB     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-VAL-THAB     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-SLD-DBAN     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-SLD-HBAN     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-MVO-DEBE     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-MVO-HABE     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-DEB-ANTI     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-HAB-ANTI     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-DEB-MVTO     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-HAB-MVTO     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-DEB-NUEV     VALUE ZEROES  PIC 9(13)V9999.
           03 WSS-HAB-NUEV     VALUE ZEROES  PIC 9(13)V9999.

           03 WSS-FOL-FINA     VALUE ZEROES       PIC 9(06).
           03 WSS-FOL-TERM     VALUE ZEROES       PIC 9(06).
           03 WSS-TAB-DAT3.
              05 POS-58                  PIC X(01).
              05 POS-59                  PIC X(01).
              05 POS-60                  PIC X(01).
           03 WSS-RESET-SALDOS                    PIC X(01).
              88 RESET-SALDOS            VALUE 'S'.
      *RRM-INI 10-JUN-1998. Modif para identificar "cuentas puentes" en
      *        la posicion 60.
           03 WSS-TAB-DANX.
              05 WSS-GLS-DANX    VALUE SPACES      PIC X(59).
              05 WSS-IND-PO60    VALUE SPACES      PIC X(01).
      *RRM-FIN 10-JUN-1998.
      *>>>>

      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DPC-REQA==.
      *>>>>


      * AQUI EXISTIA LABEL RF INI
      *<<<< RF
      *>>>>

      * AQUI EXISTIA LABEL RF FIN
       COPY COLRTLM2.
      *<<<< RT
      *>>>>


       PROCEDURE DIVISION.
      *==================

      * AQUI EXISTIA LABEL FIN_DEC INI
      *<<<< FIN_DEC
      *>>>>

      * AQUI EXISTIA LABEL FIN_DEC FIN

       MAIN SECTION.
      *------------
       INI-MAIN.
      *<<<< MAX_FILE
      *>>>>

      *    MOVE SYS-MXFL TO SYS-CMND.
      *    PERFORM GNS-PRO-SYS.
       COPY GNSBGEDB.
      *     MOVE 'COL' TO RPT-SIST.
           MOVE 'COLPLLM2' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *<<<< INI
      *>>>>

           SORT GNSSRT
       COPY COLRSLM2.
      *<<<< RS
      *>>>>

           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
      *<<<< FIN
      *>>>>

           IF PGM-STAT-SRT-MAL OR SORT-RETURN > 0
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<< INI_INP
           DISPLAY '****************************'.
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.
           DISPLAY '****************************'.

      *Captura Fecha de Inicio
           ACCEPT  PRM-FEC-FINI IN WSS-VARI.
           DISPLAY 'FECHA DE INICIO ( DDMMSSAA ) : '
                    PRM-FEC-FINI IN WSS-VARI.
      *Captura Fecha de Termino
           ACCEPT  PRM-FEC-FTER IN WSS-VARI.
           DISPLAY 'FECHA DE TERMINO( DDMMSSAA ) : '
                    PRM-FEC-FTER IN WSS-VARI.

      *Captura Codigo de Oficina
           ACCEPT  PRM-COD-OFIC IN WSS-VARI.
           DISPLAY 'OFICINA : '
                    PRM-COD-OFIC IN WSS-VARI.
      *------------------------------------------------------------*
           MOVE PRM-COD-OFIC IN WSS-VARI TO WSS-COD-OFIC IN WSS-VARI.
      *Captura Tipo de Emision
      *    DISPLAY 'TIPO EMISION : '.
           MOVE 'B' TO  PRM-TIP-EMIS IN WSS-VARI.
      *INI-JGM 6-04-1999.
            MOVE PRM-NUM-DINI TO FEC-ITM1.
            MOVE PRM-NUM-MINI TO FEC-ITM2.
            MOVE PRM-NUM-SINI TO FEC-ITM3.
            MOVE PRM-NUM-AINI TO FEC-ITM4.
            MOVE FEC-FORM-FEC TO FEC-FORM.
            MOVE FEC-FBLK-N   TO FEC-FBLK.
            MOVE FEC-CHOY-N   TO FEC-CHOY.
            MOVE FEC-VHBL-N   TO FEC-VHBL.
            MOVE FEC-VAL-FEC  TO FEC-CMND.
            PERFORM PRO-FEC.
            IF NOT FEC-STAT-OKS
                DISPLAY 'FECHA INICIO : '
                DISPLAY FEC-MENS
                MOVE PGM-SMAL TO PGM-STAT-SRT
                GO TO FIN-INP-SRT.

           MOVE PRM-NUM-DTER TO FEC-ITM1.
           MOVE PRM-NUM-MTER TO FEC-ITM2.
           MOVE PRM-NUM-STER TO FEC-ITM3.
           MOVE PRM-NUM-ATER TO FEC-ITM4.
            MOVE FEC-FORM-FEC TO FEC-FORM.
            MOVE FEC-FBLK-N   TO FEC-FBLK.
            MOVE FEC-CHOY-N  TO FEC-CHOY.
            MOVE FEC-VHBL-N   TO FEC-VHBL.
            MOVE FEC-VAL-FEC  TO FEC-CMND.
            PERFORM PRO-FEC.
            IF NOT FEC-STAT-OKS
                DISPLAY 'FECHA TERMINO: '
                DISPLAY FEC-MENS
                MOVE PGM-SMAL TO PGM-STAT-SRT
                GO TO FIN-INP-SRT.
      *VAL-FEC Valida Fecha de Termino
      *     DISPLAY WSS-FEC-FTER IN WSS-VARI.
      *     MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FECH.
      *     MOVE FEC-FORM-FEC TO FEC-FORM.
      *     MOVE FEC-FBLK-N   TO FEC-FBLK.
      *     MOVE FEC-CHOY-LE  TO FEC-CHOY.
      *     MOVE FEC-VHBL-N   TO FEC-VHBL.
      *     MOVE FEC-VAL-FEC  TO FEC-CMND.
      *     PERFORM PRO-FEC.
      *     IF NOT FEC-STAT-OKS
      *         DISPLAY FEC-MENS
      *         MOVE PGM-SMAL TO PGM-STAT-SRT
      *         GO TO FIN-INP-SRT.

      *CMP-FEC Compara Fecha de Inicio con Fecha de Termino
      *     MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FEC1.
      *     MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FEC2.
      *     MOVE FEC-FORM-FEC TO FEC-FORM.
      *     MOVE FEC-CMP-FEC  TO FEC-CMND.
      *     PERFORM PRO-FEC.
      *     IF FEC-STAT-GRT
      *         MOVE 'TAB'         TO MSG-COD-SIST
      *         MOVE 'FECFINIFTER' TO MSG-COD-MENS IN MSG
      *         PERFORM GET-MSG
      *         DISPLAY MSG-GLS-DESC IN MSG
      *         MOVE PGM-SMAL TO PGM-STAT-SRT
      *         GO TO FIN-INP-SRT.

           PERFORM VALIDA-FECHAS.
           IF PGM-STAT-SRT-MAL
               GO TO FIN-INP-SRT.
      *VAL-OFI Valida codigo de Oficina en TABLAS
           DISPLAY PRM-COD-OFIC.
           IF PRM-COD-OFIC IN WSS-VARI NOT > SPACES
               MOVE '*' TO PRM-COD-OFIC IN WSS-VARI.

           IF PRM-COD-OFIC IN WSS-VARI NOT = '*'
               DISPLAY PRM-COD-OFIC IN WSS-VARI
               MOVE PRM-COD-OFIC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   MOVE PGM-SMAL TO PGM-STAT-SRT
                   GO TO FIN-INP-SRT.

      *VAL-EMIS Valida tipo de emision
           DISPLAY PRM-TIP-EMIS.
           IF NOT OK-TIP-EMIS
              DISPLAY 'ERROR PARAMETRO TIPO EMISION NO VALIDO'
              DISPLAY 'LOS PARAMETROS VALIDOS SON:'
              DISPLAY 'B - BORRADOR     (NO ACTUALIZA SALDOS Y FOLIOS)'
              DISPLAY 'L - LEGAL        (ACTUALIZA SALDOS Y FOLIOS)'
              DISPLAY 'R - SOLO RESUMEN (NO ACTUALIZA SALDOS Y FOLIOS)'
              MOVE PGM-SMAL TO PGM-STAT-SRT
              GO TO FIN-INP-SRT.

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.
      *
           DISPLAY '**********************************'.
           DISPLAY 'CAPTURA DATOS DEL PROCESO ANTERIOR'.
           DISPLAY '**********************************'.
      *  PERFORM DATOS-PROCE-CONTAB.
      *    IF PGM-STAT-SRT-MAL
      *        GO TO FIN-INP-SRT.
      *>>>>

           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-LMC.
       FST-INP-SRT.
      *<<<< INI_FST_INP
      *>>>>

           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-LMC.
      *<<<< FIN_FST_INP
      *RRM-INI 11-DICIEMBRE-1998
       LUP-OFIC-LMC.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *
           IF WSS-COD-OFIC IN WSS-VARI = '*'
              NEXT SENTENCE
           ELSE
              IF LMC-COD-OFOC IN LMC NOT = WSS-COD-OFIC IN WSS-VARI
                 MOVE FIO-GET-NXT TO FIO-CMND
                 PERFORM COL-FIO-LMC
                 GO TO LUP-OFIC-LMC.
      *RRM-FIN 11-DICIEMBRE-1998
           MOVE LMC-COD-OFOC IN LMC TO WSS-COD-OFOC IN WSS-VARI.
           MOVE LMC-CIC-CCSB IN LMC TO WSS-CIC-CCSB IN WSS-VARI.
      *RRM-INI 8-MAY-1998
      *    MOVE LMC-FEC-FCTB IN LMC TO WSS-FEC-FCTB IN WSS-VARI.
           MOVE LMC-FEC-FPRO IN LMC TO WSS-FEC-FPRO IN WSS-VARI.
      *RRM-FIN 8-MAY-1998
      *>>>>

       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
           IF EMIS-LEGAL AND ( LMC-IND-LIQU IN LMC = 'L ' OR
                               LMC-IND-LIQU IN LMC = 'P ')
              GO TO NXT-INP-SRT.
      * Procesa segun Oficina ( * = Todas )
           IF WSS-COD-OFIC IN WSS-VARI = '*'
              NEXT SENTENCE
           ELSE
              IF LMC-COD-OFOC IN LMC NOT = WSS-COD-OFIC IN WSS-VARI
                 GO TO NXT-INP-SRT
              ELSE
                 NEXT SENTENCE.

      * Selecciona Registros dentro del rango de Fechas Ingresadas
      * RRM-INI 8-MAY-1998
      *    IF WSS-FEC-FREG IN WSS-VARI > LMC-FEC-FCTB IN LMC OR
      *       WSS-FEC-FFIN IN WSS-VARI < LMC-FEC-FCTB IN LMC
      *
           IF WSS-FEC-FREG IN WSS-VARI > LMC-FEC-FPRO IN LMC OR
              WSS-FEC-FFIN IN WSS-VARI < LMC-FEC-FPRO IN LMC
               GO TO NXT-INP-SRT.
      * RRM-FIN 8-MAY-1998

      * RRM-INI 10-JUN-1998. Identificacion de "cuentas puentes".
      * Buscando en Tabla PCC: Datos Anexos.
           IF LMC-CIC-CCSB IN LMC > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'PCC'               TO TAB-COD-TTAB IN TAB
               MOVE LMC-CIC-CCSB IN LMC TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF NOT FIO-STAT-OKS
                  GO TO NXT-INP-SRT
               ELSE
                  MOVE TAB-GLS-DATA IN TAB TO WSS-TAB-DANX IN WSS-VARI
            ELSE
               GO TO NXT-INP-SRT.
      * Se verifica si es "cuenta puente".
           IF WSS-IND-PO60 = 'P'
               GO TO NXT-INP-SRT
           ELSE
               NEXT SENTENCE.
      * RRM-FIN 10-JUN-1998.

      * Llena campo Tipo de Movimiento del sort
           IF LMC-COD-MVTO IN LMC = 'CUR'
              MOVE '1'  TO SRT-COD-MVTO IN SRT
           ELSE
              MOVE '2'  TO SRT-COD-MVTO IN SRT.

      * Asigna moneda nacional si moneda del credito es reajustable
           IF LMC-MSC-TVOC IN LMC = '0'
              MOVE '0999  ' TO LMC-COD-VCOC IN SRT.

      * Empiezo acumular antes de grabar en el SORT.
      *    DISPLAY 'EMPIEZO ACUMULAR ANTES DE GRABAR EN EL SORT'
           IF LMC-COD-OFOC IN LMC NOT = WSS-COD-OFOC IN WSS-VARI
               MOVE WSS-VAL-TDEB IN WSS-VARI TO SRT-VAL-TDEB IN SRT
               MOVE WSS-VAL-THAB IN WSS-VARI TO SRT-VAL-THAB IN SRT
               MOVE WSS-COD-OFOC IN WSS-VARI TO LMC-COD-OFOC IN SRT
               MOVE WSS-CIC-CCSB IN WSS-VARI TO LMC-CIC-CCSB IN SRT
               MOVE LMC-COD-OFOC IN LMC TO WSS-COD-OFOC IN WSS-VARI
               MOVE LMC-CIC-CCSB IN LMC TO WSS-CIC-CCSB IN WSS-VARI
      * RRM-INI 8-MAY-1998
      *        MOVE LMC-FEC-FCTB IN LMC TO WSS-FEC-FCTB IN WSS-VARI
               MOVE LMC-FEC-FPRO IN LMC TO WSS-FEC-FPRO IN WSS-VARI
      * RRM-FIN 8-MAY-1998
               MOVE ZEROES TO WSS-VAL-TDEB IN WSS-VARI
               MOVE ZEROES TO WSS-VAL-THAB IN WSS-VARI
      *         DISPLAY 'ESTO ESTOY MANDANDO AL SORT'
      *         DISPLAY 'TOTAL DEBE' SRT-VAL-TDEB IN SRT
      *         DISPLAY 'TOTAL HABE' SRT-VAL-THAB IN SRT
      *         DISPLAY 'OFICINA   ' LMC-COD-OFOC IN SRT
      *         DISPLAY 'CUENTA    ' LMC-CIC-CCSB IN SRT
      *         DISPLAY 'TERMINE DE GRABAR EN EL SORT'
               RELEASE SRT
               IF LMC-IND-DBHB IN LMC = 'D'
                   COMPUTE WSS-VAL-TDEB IN WSS-VARI =
                       WSS-VAL-TDEB IN WSS-VARI + LMC-SGV-ICTB IN LMC
      *                 DISPLAY 'WSS-VAL-TDEB: 'WSS-VAL-TDEB IN WSS-VARI
      *                 DISPLAY 'LMC-SGV-ICTB: 'LMC-SGV-ICTB IN LMC
                        GO TO NXT-INP-SRT
               ELSE
                   COMPUTE WSS-VAL-THAB IN WSS-VARI =
                   WSS-VAL-THAB IN WSS-VARI + LMC-SGV-ICTB IN LMC
      *             DISPLAY 'WSS-VAL-THAB: ' WSS-VAL-THAB IN WSS-VARI
      *             DISPLAY 'LMC-SGV-ICTB: ' LMC-SGV-ICTB IN LMC
                   GO TO NXT-INP-SRT
           ELSE
               IF LMC-CIC-CCSB IN LMC NOT = WSS-CIC-CCSB IN WSS-VARI
                   MOVE WSS-VAL-TDEB IN WSS-VARI TO SRT-VAL-TDEB IN SRT
                   MOVE WSS-VAL-THAB IN WSS-VARI TO SRT-VAL-THAB IN SRT
                   MOVE WSS-COD-OFOC IN WSS-VARI TO LMC-COD-OFOC IN SRT
                   MOVE WSS-CIC-CCSB IN WSS-VARI TO LMC-CIC-CCSB IN SRT
                   MOVE LMC-CIC-CCSB IN LMC TO WSS-CIC-CCSB IN WSS-VARI
                   MOVE LMC-COD-OFOC IN LMC TO WSS-COD-OFOC IN WSS-VARI
      * RRM-INI 8-MAY-1998
      *            MOVE LMC-FEC-FCTB IN LMC TO WSS-FEC-FCTB IN WSS-VARI
                   MOVE LMC-FEC-FPRO IN LMC TO WSS-FEC-FPRO IN WSS-VARI
      * RRM-FIN 8-MAY-1998
                   MOVE ZEROES TO WSS-VAL-TDEB IN WSS-VARI
                   MOVE ZEROES TO WSS-VAL-THAB IN WSS-VARI
      *             DISPLAY 'ESTO ESTOY MANDANDO AL SORT'
      *             DISPLAY 'TOTAL DEBE' SRT-VAL-TDEB IN SRT
      *             DISPLAY 'TOTAL HABE' SRT-VAL-THAB IN SRT
      *             DISPLAY 'OFICINA   ' LMC-COD-OFOC IN SRT
      *             DISPLAY 'CUENTA    ' LMC-CIC-CCSB IN SRT
      *             DISPLAY 'TERMINE DE GRABAR EN EL SORT'
                   RELEASE SRT
                   IF LMC-IND-DBHB IN LMC = 'D'
                       COMPUTE WSS-VAL-TDEB IN WSS-VARI =
                       WSS-VAL-TDEB IN WSS-VARI + LMC-SGV-ICTB IN LMC
      *                 DISPLAY 'WSS-VAL-TDEB: 'WSS-VAL-TDEB IN WSS-VARI
      *                 DISPLAY 'LMC-SGV-ICTB: 'LMC-SGV-ICTB IN LMC
                       GO TO NXT-INP-SRT
                   ELSE
                      COMPUTE WSS-VAL-THAB IN WSS-VARI =
                      WSS-VAL-THAB IN WSS-VARI + LMC-SGV-ICTB IN LMC
      *                DISPLAY 'WSS-VAL-THAB: ' WSS-VAL-THAB IN WSS-VARI
      *                DISPLAY 'LMC-SGV-ICTB: ' LMC-SGV-ICTB IN LMC
                       GO TO NXT-INP-SRT.

      * Acumula Movimientos del Periodo.
      *    DISPLAY 'Se acumula porque las cuenta actual igual a ant.'.
      *    DISPLAY 'ESTOY ACUMULANDO LOS MOVIMIENTOS DEL PERIODO'.
      *    DISPLAY '********************************************'.
      *    DISPLAY ' '.
           IF LMC-IND-DBHB IN LMC = 'D'
               COMPUTE WSS-VAL-TDEB IN WSS-VARI =
                       WSS-VAL-TDEB IN WSS-VARI + LMC-SGV-ICTB IN LMC
      *                 DISPLAY 'WSS-VAL-TDEB: 'WSS-VAL-TDEB IN WSS-VARI
      *                 DISPLAY 'LMC-SGV-ICTB: 'LMC-SGV-ICTB IN LMC
                       GO TO NXT-INP-SRT
           ELSE
               COMPUTE WSS-VAL-THAB IN WSS-VARI =
                       WSS-VAL-THAB IN WSS-VARI + LMC-SGV-ICTB IN LMC
      *                 DISPLAY 'WSS-VAL-THAB: ' WSS-VAL-THAB IN WSS-VAR
      *                 DISPLAY 'LMC-SGV-ICTB: ' LMC-SGV-ICTB IN LMC
                       GO TO NXT-INP-SRT.

      * RRM-INI  21-APR-1998
      * Empiezo acumular antes de grabar en el SORT.
      *     IF LMC-COD-OFOC IN LMC NOT = WSS-COD-OFOC IN WSS-VARI OR
      *        LMC-CIC-CCSB IN LMC NOT = WSS-CIC-CCSB IN WSS-VARI
      *         MOVE WSS-VAL-TDEB IN WSS-VARI TO SRT-VAL-TDEB IN SRT
      *         MOVE WSS-VAL-THAB IN WSS-VARI TO SRT-VAL-THAB IN SRT
      *         MOVE WSS-COD-OFOC IN WSS-VARI TO LMC-COD-OFOC IN SRT
      *         MOVE WSS-CIC-CCSB IN WSS-VARI TO LMC-CIC-CCSB IN SRT
      *         MOVE LMC-COD-OFOC IN LMC TO WSS-COD-OFOC IN WSS-VARI
      *         MOVE LMC-CIC-CCSB IN LMC TO WSS-CIC-CCSB IN WSS-VARI
      *         MOVE LMC-FEC-FCTB IN LMC TO WSS-FEC-FCTB IN WSS-VARI
      *         MOVE ZEROES TO WSS-VAL-TDEB IN WSS-VARI
      *         MOVE ZEROES TO WSS-VAL-THAB IN WSS-VARI
      *         DISPLAY 'ESTO ESTOY MANDANDO AL SORT'
      *         DISPLAY 'TOTAL DEBE' SRT-VAL-TDEB IN SRT
      *         DISPLAY 'TOTAL HABE' SRT-VAL-THAB IN SRT
      *         DISPLAY 'OFICINA   ' LMC-COD-OFOC IN SRT
      *         DISPLAY 'CUENTA    ' LMC-CIC-CCSB IN SRT
      *         DISPLAY 'TERMINE DE GRABAR EN EL SORT'
      *         RELEASE SRT
      *         GO TO NXT-INP-SRT
      *     ELSE
      *         IF LMC-CIC-CCSB IN LMC = WSS-CIC-CCSB IN WSS-VARI OR
      *            LMC-COD-OFOC IN LMC = WSS-COD-OFOC IN WSS-VARI
      *             ADD WSS-VAL-TDEB IN WSS-VARI TO SRT-VAL-TDEB IN SRT
      *             ADD WSS-VAL-THAB IN WSS-VARI TO SRT-VAL-THAB IN SRT
      *             MOVE WSS-COD-OFOC IN WSS-VARI TO LMC-COD-OFOC IN SRT
      *             MOVE WSS-CIC-CCSB IN WSS-VARI TO LMC-CIC-CCSB IN SRT
      *             MOVE LMC-CIC-CCSB IN LMC TO WSS-CIC-CCSB IN WSS-VARI
      *             MOVE LMC-COD-OFOC IN LMC TO WSS-COD-OFOC IN WSS-VARI
      *             MOVE LMC-FEC-FCTB IN LMC TO WSS-FEC-FCTB IN WSS-VARI
      *             MOVE ZEROES TO WSS-VAL-TDEB IN WSS-VARI
      *             MOVE ZEROES TO WSS-VAL-THAB IN WSS-VARI
      *              DISPLAY 'ESTO ESTOY MANDANDO AL SORT'
      *              DISPLAY 'TOTAL DEBE' SRT-VAL-TDEB IN SRT
      *              DISPLAY 'TOTAL HABE' SRT-VAL-THAB IN SRT
      *              DISPLAY 'OFICINA   ' LMC-COD-OFOC IN SRT
      *              DISPLAY 'CUENTA    ' LMC-CIC-CCSB IN SRT
      *              DISPLAY 'TERMINE DE GRABAR EN EL SORT'
      *              RELEASE SRT
      *              GO TO NXT-INP-SRT.
      *RRM-FIN  21-APR-1998
      *>>>>

       MOV-INP-SRT.
       COPY COLRMLM2.
      *<<<< RM
      *>>>>

           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
      *>>>>

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-LMC.
      *<<<< FIN_NXT_INP
      *>>>>

           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
      *<<<< FIN_INP
           MOVE WSS-VAL-TDEB IN WSS-VARI TO SRT-VAL-TDEB IN SRT.
           MOVE WSS-VAL-THAB IN WSS-VARI TO SRT-VAL-THAB IN SRT.
           MOVE WSS-COD-OFOC IN WSS-VARI TO LMC-COD-OFOC IN SRT.
           MOVE WSS-CIC-CCSB IN WSS-VARI TO LMC-CIC-CCSB IN SRT.
           RELEASE SRT.
      *>>>>

           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-LMC.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
      *<<<< INI_OUT
      *>>>>

           OPEN OUTPUT RPTLM2.
      *     MOVE 'COLPLLM2' TO RPT-NPGM.
           PERFORM CAL-HDR.
           PERFORM INITIATE-RPTLM2.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           MOVE SRT TO SRT-OLD-LM2.
           MOVE SRT TO SRT-CUR-LM2.
      *<<<< FST_OUT
      *>>>>

      *    PERFORM LM2-FST-PRO-CTL.
       LUP-OUT-SRT.
      *<<<< LUP_OUT
      *>>>>

       GEN-OUT-SRT.
           PERFORM GENERATE-DL-LM2.
      *<<<< FIN_GEN_OUT
      *>>>>

       NXT-OUT-SRT.
           MOVE SRT TO SRT-OLD-LM2.
       RET-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
      *<<<< FIN_OUT
      *>>>>

           IF HAY-REGISTROS-EN-SORT-LM2
                PERFORM TERMINATE-RPTLM2.
      *<<<< FIN_TMT
      *>>>>

           CLOSE RPTLM2.
       EXT-OUT-SRT.
           EXIT.
       COPY COLBFLMC.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGIRH.
       COPY COLRELM2.
      *    08-MAY-98 12:41 PM     ,PAI= ,CLI= ,SOP=MVS  V 1.1.3
       D-CF-LM2-LMC-COD-OFOC SECTION.
       INI-CF-LM2-LMC-COD-OFOC.
      *<<<<CF_LM2_LMC_COD_OFOC
      *RRM-INI  23-APR-1998
           MOVE ZEROES TO RPT-LM2-PAGE-COUNTER IN RPT-VARI-LM2.
      *RRM-FIN  23-APR-1998
      *>>>>

       FIN-CF-LM2-LMC-COD-OFOC.
           EXIT.
       D-CF-LM2-LMC-COD-VCOC SECTION.
       INI-CF-LM2-LMC-COD-VCOC.

       FIN-CF-LM2-LMC-COD-VCOC.
           EXIT.
       D-PH-LM2 SECTION.
       INI-PH-LM2.
      *<<<< PH_LM2
      *RRM-INI 22/04/1998
      * Mediante BUS-OFI Obtiene Nombre Oficina de Tabla OFI
           IF LMC-COD-OFOC IN SRT > SPACES
               MOVE LMC-COD-OFOC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI.

      * Mediante BUS-TAB Busca Tipo de Moneda de Tabla VLR
           IF LMC-COD-VCOC IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE LMC-COD-VCOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-VCOC IN WSS-LM2
           ELSE
               MOVE SPACES TO WSS-GLS-VCOC IN WSS-LM2.
      *RRM-FIN 22/04/1998
      *>>>>

       FIN-PH-LM2.
           EXIT.
       D-DL-LM2 SECTION.
       INI-DL-LM2.

       FIN-DL-LM2.
           EXIT.
       COPY GNSBGABT.


      *<<<< EOF
      *DATOS-PROCE-CONTAB SECTION.
      ****************************
      *INI-DATOS-PROCE-CONTAB.
      *    MOVE FIO-INP TO FIO-CMND.
      *    PERFORM COL-FIO-DPC.
      *    IF NOT FIO-STAT-OKS
      *       DISPLAY 'NO EXISTE ARCHIVO CON DATOS PROC.CONTAB ANTERIOR'
      *       MOVE PGM-SMAL TO PGM-STAT-SRT
      *       GO TO FIN-DATOS-PROCE-CONTAB.
      *
      *    MOVE '1'         TO DPC-TIP-REGI IN DPC.
      *    MOVE 'DATPRO'    TO DPC-COD-PRO1 IN DPC.
      *    MOVE SPACES      TO DPC-FIL-FIL1 IN DPC.
      *    IF EMIS-LEGAL
      *       MOVE FIO-GET-KEY-UPD TO FIO-CMND
      *    ELSE
      *       MOVE FIO-GET-KEY TO FIO-CMND.
      *
      *    PERFORM COL-FIO-DPC.
      *    IF NOT FIO-STAT-OKS
      *       DISPLAY 'ERROR AL LEER TABLA DPC'
      *       DISPLAY 'NO EXISTE REGISTRO CON DATOS DEL PROC.ANTERIOR'
      *       MOVE PGM-SMAL TO PGM-STAT-SRT
      *       GO TO FIN-DATOS-PROCE-CONTAB.
*
      *    DISPLAY 'FECHA PROCESO ANTERIOR    : ' DPC-FEC-FPRO.
      *    DISPLAY 'FECHA INICIO  PERIODO     : ' DPC-FEC-FINI.
      *    DISPLAY 'FECHA TERMINO PERIODO     : ' DPC-FEC-FTER.
      *    DISPLAY '--------------------------------------------'.
      *    MOVE DPC-NUM-DTER TO FEC-ITM1.
      *    MOVE DPC-NUM-MTER TO FEC-ITM2.
      *    MOVE DPC-NUM-STER TO FEC-ITM3.
      *    MOVE DPC-NUM-ATER TO FEC-ITM4.
      *    MOVE FEC-FORM-FEC TO FEC-FORM.
      *    MOVE FEC-SUM-DIA  TO FEC-CMND.
      *    MOVE 1            TO FEC-NDIA.
      *    PERFORM CAL-FEC.
      *    MOVE FEC-FECH     TO WSS-FEC-FAUX.
      *    MOVE WSS-NUM-DAUX TO WSS-NUM-DPRX.
      *    MOVE WSS-NUM-MAUX TO WSS-NUM-MPRX.
      *    MOVE WSS-NUM-SAUX TO WSS-NUM-SPRX.
      *    MOVE WSS-NUM-AAUX TO WSS-NUM-APRX.
      *    DISPLAY 'FECHA INICIO ESPERADA     : '
      *                                        WSS-FEC-FPRX IN WSS-VARI.
      *    IF WSS-FEC-FREG IN WSS-VARI NOT = WSS-FEC-FPRX IN WSS-VARI
      *       DISPLAY 'FEC.INICIO <> FEC.TERMINO ANTERIOR + 1 DIA'
      *       DISPLAY 'FEC.INICIO PARAMETRO : ' WSS-FEC-FREG IN WSS-VARI
      *       DISPLAY 'FEC.INICIO ESPERADA  : ' WSS-FEC-FPRX IN WSS-VARI
      *       IF EMIS-LEGAL OR EMIS-RESUMEN
      *           MOVE PGM-SMAL TO PGM-STAT-SRT
      *           GO TO FIN-DATOS-PROCE-CONTAB.
*
      *    MOVE ZEROES                   TO DPC-FEC-FPRO IN DPC.
      *    MOVE WSS-FEC-FREG IN WSS-VARI TO DPC-FEC-FINI IN DPC.
      *    MOVE WSS-FEC-FFIN IN WSS-VARI TO DPC-FEC-FTER IN DPC.
      *    MOVE SPACES                   TO DPC-GLS-DISP IN DPC.
      *    IF EMIS-LEGAL
      *       MOVE FIO-MOD TO FIO-CMND
      *       PERFORM COL-FIO-DPC.
*
      *    MOVE FIO-CLO TO FIO-CMND.
      *    PERFORM COL-FIO-DPC.
      *FIN-DATOS-PROCE-CONTAB.
      *M   EXIT.

      ******************************************************************
       BUS-REG-CLI SECTION.
      *********************
       INI-BUS-REG-CLI.
      *CIC-CLI Busca Datos del Cliente Mediante su CIC
           MOVE LMC-IDC-ICLI IN LMC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM GET-CLI.
           IF MSG-COD-MENS > SPACES
               MOVE ZEROES TO DBC-NUM-ICLI IN DBC
               MOVE SPACES TO DBC-VRF-ICLI IN DBC
                              DBC-IND-ICLI IN DBC
                              DBC-GLS-ICLI IN DBC
                              DBC-GLS-NOMC IN DBC
           ELSE
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC.
       FIN-BUS-REG-CLI.
           EXIT.

      ******************************************************************
       VE-RESETEO-CUENTA SECTION.
      ***************************
       INI-RESET-CTA.
           MOVE 'N' TO WSS-RESET-SALDOS.
           IF POS-59 = 'A' AND WSS-NUM-DREG = 01 AND WSS-NUM-MREG = 01
                MOVE 'S' TO WSS-RESET-SALDOS.
           IF POS-59 = 'M' AND WSS-NUM-DREG = 01
                MOVE 'S' TO WSS-RESET-SALDOS.
       FIN-RESET-CTA.
           EXIT.
      *
       VALIDA-FECHAS SECTION.
       INI-VALIDAD-FECHAS.
      *Captura Fecha de de hoy(Fecha de Ejecucion).
      *
           MOVE 'S' TO WSS-IND-DIAHABIL IN WSS-VARI.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY  TO WSS-NUM-DEJE IN WSS-VARI
                             FEC-ITM1 IN FEC-FECH.
           MOVE HOY-MHOY  TO WSS-NUM-MEJE IN WSS-VARI
                             FEC-ITM2 IN FEC-FECH.
           MOVE HOY-SHOY  TO WSS-NUM-SEJE IN WSS-VARI
                             FEC-ITM3 IN FEC-FECH.
           MOVE HOY-AHOY  TO WSS-NUM-AEJE IN WSS-VARI
                             FEC-ITM4 IN FEC-FECH.
       VAL-FEJE-HABIL.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-FER OR NOT FEC-STAT-HBL
              MOVE 'N' TO WSS-IND-DIAHABIL IN WSS-VARI
              DISPLAY 'FECHA EJE. NO ES HABIL ..'.

      **************************************************************
      *mover fechas de formato DDMMSSAA a SSAAMMDD
      *Fecha de parametro inicio ( WSS-FEC-FINI )
           MOVE PRM-NUM-DINI IN WSS-VARI TO WSS-NUM-DINI IN WSS-VARI.
           MOVE PRM-NUM-MINI IN WSS-VARI TO WSS-NUM-MINI IN WSS-VARI.
           MOVE PRM-NUM-SINI IN WSS-VARI TO WSS-NUM-SINI IN WSS-VARI.
           MOVE PRM-NUM-AINI IN WSS-VARI TO WSS-NUM-AINI IN WSS-VARI.

      *Fecha de parametro termino ( WSS-FEC-FTER )
           MOVE PRM-NUM-DTER IN WSS-VARI TO WSS-NUM-DTER IN WSS-VARI.
           MOVE PRM-NUM-MTER IN WSS-VARI TO WSS-NUM-MTER IN WSS-VARI.
           MOVE PRM-NUM-STER IN WSS-VARI TO WSS-NUM-STER IN WSS-VARI.
           MOVE PRM-NUM-ATER IN WSS-VARI TO WSS-NUM-ATER IN WSS-VARI.
      *
           IF PRM-NUM-SINI IN WSS-VARI NOT = PRM-NUM-STER
                                              IN WSS-VARI  OR
              PRM-NUM-AINI IN WSS-VARI NOT = PRM-NUM-ATER IN WSS-VARI
               MOVE PGM-SMAL TO PGM-STAT-SRT
               DISPLAY 'ERROR PARAMETROS DISTINTOS ANOS'
               GO TO FIN-VALIDA-FECHAS.
      *
      *    PERFORM BUS-FECHA-INICIO.
           PERFORM BUS-FECHA-TERMINO.
           PERFORM BUS-DATOS-DPC.
      *
      * 1) VALIDACION: FEC.termino No sea  <  a la fecha de ejecucion.
           MOVE PRM-NUM-DTER IN WSS-VARI TO PRM-NUM-DAUX IN WSS-VARI.
           MOVE PRM-NUM-MTER IN WSS-VARI TO PRM-NUM-MAUX IN WSS-VARI.
           MOVE PRM-NUM-STER IN WSS-VARI TO PRM-NUM-SAUX IN WSS-VARI.
           MOVE PRM-NUM-ATER IN WSS-VARI TO PRM-NUM-AAUX IN WSS-VARI.

           IF FECE-SIHABIL
      *INI-JGM 11-01-2000
      *     IF WSS-FEC-FTER IN WSS-VARI NOT < WSS-FEC-FEJE IN WSS-VARI
            IF WSS-FEC-FTER IN WSS-VARI > WSS-FEC-FEJE IN WSS-VARI
      *FIN-JGM 11-01-2000
               DISPLAY 'FEC. TERMINO MAYOR QUE EJECUCION :'
                           PRM-FEC-FTER IN WSS-VARI
                           MOVE PGM-SMAL TO PGM-STAT-SRT
                           GO TO FIN-VALIDA-FECHAS.

            IF WSS-FEC-FINI IN WSS-VARI >   WSS-FEC-FTER IN WSS-VARI
               DISPLAY 'FEC. INICIO  MAYOR QUE TERMINO   :'
                           MOVE PGM-SMAL TO PGM-STAT-SRT
                           GO TO FIN-VALIDA-FECHAS.
      *
            IF WSS-FEC-FINI IN WSS-VARI >  WSS-FEC-FEJE IN WSS-VARI
               DISPLAY 'FEC. INICIO  MAYOR QUE EJECUCION :'
                           MOVE PGM-SMAL TO PGM-STAT-SRT
                           GO TO FIN-VALIDA-FECHAS.
           IF FECE-NOHABIL
              IF PRM-FEC-FAUX IN WSS-VARI >
                                 WSS-FEC-FTER IN WSS-VARI
               MOVE PGM-SMAL TO PGM-STAT-SRT
               DISPLAY 'Error en Fecha termino '
               GO TO FIN-VALIDA-FECHAS.
      *
      * Fecha Inicio.
           MOVE 'N' TO WSS-IND-FECH  IN WSS-VARI.
           MOVE PRM-NUM-DINI IN WSS-VARI TO PRM-NUM-DAUX IN WSS-VARI.
           MOVE PRM-NUM-MINI IN WSS-VARI TO PRM-NUM-MAUX IN WSS-VARI.
           MOVE PRM-NUM-SINI IN WSS-VARI TO PRM-NUM-SAUX IN WSS-VARI.
           MOVE PRM-NUM-AINI IN WSS-VARI TO PRM-NUM-AAUX IN WSS-VARI.
           DISPLAY '-----------------------------------------'.
           DISPLAY 'FECHAS  COLPLLM2 :SSAAMMDD '.
           DISPLAY '-----------------------------------------'.
           DISPLAY ' '.
           DISPLAY ' Ini.programa : ' WSS-FEC-FINI IN WSS-VARI.
           DISPLAY ' ini.Tabla DPC: ' WSS-FEC-FDP1 IN WSS-VARI.
           DISPLAY '-----------------------------------------'.
           DISPLAY ' ter.programa : ' WSS-FEC-FTER IN WSS-VARI.
           DISPLAY ' ter.tabla DPC: ' WSS-FEC-FDP2 IN WSS-VARI.
           DISPLAY 'Fec. ejecucion: ' WSS-FEC-FEJE IN WSS-VARI.

      *
           IF WSS-FEC-FINI IN WSS-VARI < WSS-FEC-FDP1 IN WSS-VARI
               DISPLAY 'FEC.INI, < FEC.INI, ULTIMO SUBSIDIARIO (L) '.
      *
           IF WSS-FEC-FTER IN WSS-VARI > WSS-FEC-FDP2 IN WSS-VARI
               DISPLAY 'FEC.TER, > FEC-TER, ULTIMO SUBSIDIARIO (L) '.
      *
      *
      *FECHAS DE INICIO
           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DINI IN WSS-LM2.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MINI IN WSS-LM2.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SINI IN WSS-LM2.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AINI IN WSS-LM2.
      *
           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DREG IN WSS-VARI.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MREG IN WSS-VARI.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SREG IN WSS-VARI.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AREG IN WSS-VARI.
      *
      *FECHAS DE TERMINO.
           MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DFIN IN WSS-VARI.
           MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MFIN IN WSS-VARI.
           MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-SFIN IN WSS-VARI.
           MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-AFIN IN WSS-VARI.
      *
           MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DTER IN WSS-LM2.
           MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MTER IN WSS-LM2.
           MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-STER IN WSS-LM2.
           MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-ATER IN WSS-LM2.
      *
       FIN-VALIDA-FECHAS.
           EXIT.
      *
       BUS-DATOS-DPC SECTION.
      *---------------------*
       INI-BUS-DATOS-DPC.
           MOVE 'N' TO WSS-IND-RESE IN WSS-VARI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-DPC.
           IF NOT FIO-STAT-OKS
              DISPLAY 'NO EXISTE ARCHIVO CON DATOS PROC.CONTAB ANT'
              MOVE PGM-SMAL TO PGM-STAT-SRT
              GO TO FIN-BUS-DATOS-DPC.

           MOVE '1'         TO DPC-TIP-REGI IN DPC.
           MOVE 'DATPRO'    TO DPC-COD-PRO1 IN DPC.
           MOVE SPACES      TO DPC-FIL-FIL1 IN DPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DPC.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ERROR AL LEER TABLA DPC'
              DISPLAY 'NO EXISTE REGISTRO CON DATOS DEL PROC.ANT'
              MOVE PGM-SMAL TO PGM-STAT-SRT
              GO TO FIN-BUS-DATOS-DPC.
      *
      *INI-JGM 08-SEP-1999
      *    MOVE DPC-NUM-DTER TO WSS-NUM1.
      *    MOVE DPC-NUM-MTER TO FEC-ITM2.
      *    MOVE DPC-NUM-STER TO FEC-ITM3.
      *    MOVE DPC-NUM-ATER TO FEC-ITM4.
      *    MOVE FEC-FORM-FEC TO FEC-FORM.
      *    MOVE FEC-SUM-DIA  TO FEC-CMND.
      *    MOVE 1            TO FEC-NDIA.
      *    PERFORM CAL-FEC.
      *    IF NOT  FEC-STAT-OKS
      *       MOVE PGM-SMAL TO PGM-STAT-SRT
      *       GO TO FIN-BUS-DATOS-DPC.
      *FIN-JGM 08-SEP-1999

           MOVE DPC-NUM-DINI IN DPC  TO WSS-NUM-DDP1 IN WSS-VARI.
           MOVE DPC-NUM-MINI IN DPC  TO WSS-NUM-MDP1 IN WSS-VARI.
           MOVE DPC-NUM-SINI IN DPC  TO WSS-NUM-SDP1 IN WSS-VARI.
           MOVE DPC-NUM-AINI IN DPC  TO WSS-NUM-ADP1 IN WSS-VARI.
      *
           MOVE DPC-NUM-DTER IN DPC  TO WSS-NUM-DDP2 IN WSS-VARI.
           MOVE DPC-NUM-MTER IN DPC  TO WSS-NUM-MDP2 IN WSS-VARI.
           MOVE DPC-NUM-STER IN DPC  TO WSS-NUM-SDP2 IN WSS-VARI.
           MOVE DPC-NUM-ATER IN DPC  TO WSS-NUM-ADP2 IN WSS-VARI.
      *
       FIN-BUS-DATOS-DPC.
           EXIT.

       BUS-FECHA-TERMINO  SECTION.
      *-------------------------*
       INI-BUS-FECHA-TERMINO.
           MOVE WSS-NUM-DTER IN WSS-VARI TO FEC-ITM1 IN FEC-FECH.
           MOVE WSS-NUM-MTER IN WSS-VARI TO FEC-ITM2 IN FEC-FECH.
           MOVE WSS-NUM-STER IN WSS-VARI TO FEC-ITM3 IN FEC-FECH.
           MOVE WSS-NUM-ATER IN WSS-VARI TO FEC-ITM4 IN FEC-FECH.
           MOVE SPACES       TO MSG-COD-MENS.
        BUSCA-FECHA.
           IF  WSS-IND-DIAHABIL IN WSS-VARI = 'N' AND
               WSS-FEC-FTER IN WSS-VARI NOT < WSS-FEC-FEJE IN WSS-VARI
               MOVE FEC-FORM-FEC TO FEC-FORM
               MOVE FEC-FBLK-N   TO FEC-FBLK
               MOVE FEC-CHOY-N   TO FEC-CHOY
               MOVE FEC-VHBL-S   TO FEC-VHBL
               MOVE FEC-VAL-FEC  TO FEC-CMND
               PERFORM PRO-FEC
               IF FEC-STAT-HBL
                  DISPLAY 'FECHA TERMINO ES HABIL..'
                  GO TO RESTA-DIA.
      *
           MOVE WSS-NUM-DTER IN WSS-VARI TO FEC-ITM1 IN FEC-FECH.
           MOVE WSS-NUM-MTER IN WSS-VARI TO FEC-ITM2 IN FEC-FECH.
           MOVE WSS-NUM-STER IN WSS-VARI TO FEC-ITM3 IN FEC-FECH.
           MOVE WSS-NUM-ATER IN WSS-VARI TO FEC-ITM4 IN FEC-FECH.
           MOVE SPACES       TO MSG-COD-MENS.
      *
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-SIG-HBL  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
              DISPLAY 'Error en calculo de fecha'
                 WSS-FEC-FTER IN WSS-VARI
                 MOVE 'FECDHANNEX'   TO MSG-COD-MENS
                 MOVE PGM-SMAL       TO PGM-STAT-SRT
                 GO TO FIN-BUS-FECHA-TERMINO.
      *
       RESTA-DIA.
      *Si mismo Mes Y Ano Y Siglo.
           IF WSS-NUM-MTER IN WSS-VARI = FEC-ITM2 IN FEC-FECH AND
              WSS-NUM-STER IN WSS-VARI = FEC-ITM3 IN FEC-FECH AND
              WSS-NUM-ATER IN WSS-VARI = FEC-ITM4 IN FEC-FECH

               MOVE FEC-FORM-FEC TO FEC-FORM
               MOVE FEC-FBLK-N   TO FEC-FBLK
               MOVE FEC-CHOY-N   TO FEC-CHOY
               MOVE FEC-RST-DIA  TO FEC-CMND
               MOVE 1            TO FEC-NDIA
               PERFORM CAL-FEC
               IF NOT  FEC-STAT-OKS
                  MOVE 'FECDHANNEX'   TO MSG-COD-MENS
                  GO TO  FIN-BUS-FECHA-TERMINO
               ELSE
                  GO TO MOVER-FECHA
           ELSE
              MOVE  1     TO  FEC-ITM1 IN FEC-FECH
              MOVE FEC-FORM-FEC TO FEC-FORM
              MOVE FEC-FBLK-N   TO FEC-FBLK
              MOVE FEC-CHOY-N   TO FEC-CHOY
              MOVE FEC-VHBL-N   TO FEC-VHBL
              MOVE FEC-RST-DIA  TO FEC-CMND
              MOVE 1            TO FEC-NDIA
              PERFORM CAL-FEC
              IF NOT  FEC-STAT-OKS
                 MOVE 'FECDHANNEX'   TO MSG-COD-MENS
                 GO TO  FIN-BUS-FECHA-TERMINO.

       MOVER-FECHA.
            MOVE FEC-ITM1 IN FEC-FECH TO WSS-NUM-DTER IN WSS-VARI.
            MOVE FEC-ITM2 IN FEC-FECH TO WSS-NUM-MTER IN WSS-VARI.
            MOVE FEC-ITM3 IN FEC-FECH TO WSS-NUM-STER IN WSS-VARI.
            MOVE FEC-ITM4 IN FEC-FECH TO WSS-NUM-ATER IN WSS-VARI.
            DISPLAY ' TER ' WSS-FEC-FTER IN WSS-VARI.
       FIN-BUS-FECHA-TERMINO.
           EXIT.

       BUS-FECHA-INICIO SECTION.
      *--------------------------*
       INI-BUS-FECHA-INICIO.
           MOVE WSS-NUM-DINI IN WSS-VARI TO FEC-ITM1 IN FEC-FECH.
           MOVE WSS-NUM-MINI IN WSS-VARI TO FEC-ITM2 IN FEC-FECH.
           MOVE WSS-NUM-SINI IN WSS-VARI TO FEC-ITM3 IN FEC-FECH.
           MOVE WSS-NUM-AINI IN WSS-VARI TO FEC-ITM4 IN FEC-FECH.
           MOVE SPACES       TO MSG-COD-MENS.
           MOVE ZEROES       TO WSS-NUM-TDIA IN WSS-VARI.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-RST-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
           PERFORM CAL-FEC.
       VAL-DIA-DHBL.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC
           IF FEC-STAT-FER OR NOT FEC-STAT-HBL
              IF FEC-ITM1 IN FEC-FECH > 1
                     ADD 1 TO WSS-NUM-TDIA IN WSS-VARI
                     MOVE FEC-FORM-FEC TO FEC-FORM
                     MOVE FEC-RST-DIA  TO FEC-CMND
                     MOVE 1            TO FEC-NDIA
                     PERFORM CAL-FEC
                     IF NOT FEC-STAT-OKS
                        MOVE 'FECDHANNEX'   TO MSG-COD-MENS
                        GO TO FIN-BUS-FECHA-INICIO
                     ELSE
                       GO TO VAL-DIA-DHBL
              ELSE
                  NEXT SENTENCE
           ELSE
             IF WSS-NUM-TDIA IN WSS-VARI = ZEROES
                GO TO FIN-BUS-FECHA-INICIO.
      *
           MOVE FEC-ITM1 IN FEC-FECH TO WSS-NUM-DINI IN WSS-VARI.
           MOVE FEC-ITM2 IN FEC-FECH TO WSS-NUM-MINI IN WSS-VARI.
           MOVE FEC-ITM3 IN FEC-FECH TO WSS-NUM-SINI IN WSS-VARI.
           MOVE FEC-ITM4 IN FEC-FECH TO WSS-NUM-AINI IN WSS-VARI.
       FIN-BUS-FECHA-INICIO.
           EXIT.
      ******************************************************************
       COPY COLBFDPC.
       COPY TABBFOFI.
       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY SGCBFDBC.
       COPY SGCBGCLI.
       COPY GNSBFCIC.
       COPY GNSBBCIC.
       COPY GNSBPFEC.
       COPY GNSBBTAB.
       COPY GNSBGCPT.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBBMSG.
      *>>>>
