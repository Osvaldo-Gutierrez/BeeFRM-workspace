       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPLMVD.
       AUTHOR.          BEE TEAM.
       DATE-WRITTEN.    16-Oct-98 11:12 AM.

      * Programa Listador de Reporte MVD con Sort.
      *
      * V 1.1.2
      *

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            C01 IS SALTO
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
      *DOS SELECT RPTMVD         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTMVD         ASSIGN TO        UT-S-RPTMVD.
           SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT RPTMVD         ASSIGN TO        UT-S-RPTMVD.
      *<<<< IOS
      *DOS SELECT RPTMVR         ASSIGN TO SYS012-UR-1403-S.
      *MVS SELECT RPTMVR         ASSIGN TO        UT-S-RPTMVR.
           SELECT RPTMVR         ASSIGN TO        UT-S-RPTMVR.
      *>>>>

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY COLRRMVD.
       FD  RPTMVD LABEL RECORDS OMITTED
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-MVD     PIC X(132).
      *<<<< FLS
       FD  RPTMVR LABEL RECORDS OMITTED
              RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-MVR PIC X(132).

       01  PASO.
           03 FILLER                              PIC X(01).
      *>>>>

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY COLBRVEN.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSWGGRC.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY COLRWMVD.
      *<<<< RW
       COPY COLRWMVR.
      *>>>>
       COPY COLRNMVD.
      *<<<< RN
       COPY COLRNMVR.
      *>>>>
       COPY COLROMVD.
      *<<<< RO
       COPY COLROMVR.
      *>>>>
       COPY GNSWGSYS.
       01  PGM-HRSR-MVD   VALUE 'N'       PIC X(01).
           88 HAY-REGISTROS-EN-SORT-MVD  VALUE 'S'.

       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       COPY GNSBRMSC.
       COPY TABBRUSR.
       COPY TABBROFI.
       COPY TABBRVLR.
       COPY TABBRCAM.
       COPY COLBROPC.
       COPY COLBRDLC.
       COPY COLBRTOC.
       COPY COLBRICG.
      *DAD ini  15-DEC-1993
       COPY COLBRCYA.
      *DAD fin  15-DEC-1993
       COPY COLBRRDC.
       COPY SGCBRDBC.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGCPT.
       COPY COLWGVEN.
       COPY GNSWGCVI.
       COPY GNSWGPES.
      *SMC-INI 09.09.1993
       COPY COLWGINT.
      *SMC-FIN 09.09.1993
       COPY COLBREVC.
       COPY COLBRRCV.
       COPY COLBRRDT.
      *DAD ini  22-JUL-1991
       COPY COLWGCAU.
       COPY COLWGCTO.
       COPY TABBRTIO.
      *DAD fin  22-JUL-1991

       01  PGM-HRSR-MVR   VALUE 'N'       PIC X(01).
           88 HAY-REGISTROS-EN-SORT-MVR   VALUE 'S'.

       01  WSS-VARI.
            03  WSS-FEC-FUCT.
               05  WSS-NUM-SUCT               PIC 9(02).
               05  WSS-NUM-AUCT               PIC 9(02).
               05  WSS-NUM-MUCT               PIC 9(02).
               05  WSS-NUM-DUCT               PIC 9(02).
           03  WSS-FEC-FXXX.
               05  WSS-NUM-SXXX               PIC 9(02).
               05  WSS-NUM-AXXX               PIC 9(02).
               05  WSS-NUM-MXXX               PIC 9(02).
               05  WSS-NUM-DXXX               PIC 9(02).
           03  WSS-PVEZ        VALUE SPACES   PIC X(01).
      *       RESPALDA VEN(1) PARA OPERACIONES ESTRUCTURADAS, PARA
      *       EXPANDIR PROXIMOS VENCIMIENTOS DE ESA ESTRUCTURA DENTRO
      *       DEL RANGO DE FECHAS Y LUEGO RESTAURARLO Y SEGUIR RECORRIEN
      *       LA BASE DE DATOS
           03 SCR-VEN-KEY-IVEN                       PIC X(15).
           03 WSS-VEN-KEY-IVEN                       PIC X(15).
           03 PGM-STAT-RDT VALUE SPACES              PIC X(02).
              88 PGM-STAT-RDT-OKS VALUE  '00'.

      *       INDICADOR PARA OBTENER VENCIMIENTOS DENTRO DEL RANGO
      *       ASOCIADOS A UNA ESTRUCTURA
           03 WSS-IND-RECO   VALUE 0              PIC 9(01).
              88 RECORRE-ESTRUCTURA               VALUE 1.

      *       INDICADOR PARA DETERMINAR EOF DE RDT
           03 WSS-IND-LAST   VALUE ' '             PIC X(01).
              88 LAST-RDT VALUE 'S'.

      *       NRO OPERACION PARA RDT'S DE UN MISMO DOCUMENTO
           03 WSS-RDT-CIC-IOPC                    PIC X(12).

      *       NRO DOCUMENTO PARA RDT'S DE UN MISMO DOCUMENTO
           03 WSS-RDT-NUM-IDLC                    PIC 9(03).

      *       STATUS VALIDACION PRO-DLC-VEN
           03 WSS-IND-DLC                         PIC X(01).
      *
      *    Saldo Documento
           03  WSS-RDT-VAL-SRDT   COMP-3          PIC 9(11)V9(04).
      *
           03 WSS-FEC-FINI.
              05 WSS-NUM-DINI                     PIC 9(02).
              05 WSS-NUM-MINI                     PIC 9(02).
              05 WSS-NUM-SINI                     PIC 9(02).
              05 WSS-NUM-AINI                     PIC 9(02).
           03 WSS-FEC-FTER.
              05 WSS-NUM-DTER                     PIC 9(02).
              05 WSS-NUM-MTER                     PIC 9(02).
              05 WSS-NUM-STER                     PIC 9(02).
              05 WSS-NUM-ATER                     PIC 9(02).
           03 WSS-FEC-FFEC.
              05 WSS-NUM-SFEC                     PIC 9(02).
              05 WSS-NUM-AFEC                     PIC 9(02).
              05 WSS-NUM-MFEC                     PIC 9(02).
              05 WSS-NUM-DFEC                     PIC 9(02).
           03 WSS-FEC-FFET.
              05 WSS-NUM-SFET                     PIC 9(02).
              05 WSS-NUM-AFET                     PIC 9(02).
              05 WSS-NUM-MFET                     PIC 9(02).
              05 WSS-NUM-DFET                     PIC 9(02).
           03 WSS-FEC-FREG.
              05 WSS-NUM-SREG                     PIC 9(02).
              05 WSS-NUM-AREG                     PIC 9(02).
              05 WSS-NUM-MREG                     PIC 9(02).
              05 WSS-NUM-DREG                     PIC 9(02).
           03 WSS-COD-OFOC                        PIC X(03).
           03 WSS-COD-RMOC                        PIC X(12).
           03 WSS-IND-NEXT                        PIC 9(01).
           03 WSS-CIC-IOPC                        PIC X(12).
           03 WSS-CIC-IAUX                        PIC X(12).
           03 WSS-GLS-NOMM                        PIC X(25).
           03 WSS-GLS-NOMF                        PIC X(25).
           03 WSS-SW                              PIC 9(01).
      * CODIGOS PARA SITUACIONES MOROSA.
           03 WSS-COD-SMOR      VALUE LOW-VALUES  PIC X(08).

      *VERIFCAR CIC MONEDA CHILENA Y NO PESOS
           03  WSS-VLR.
               05  WSS-CIC-VCAM.
      *            Tipo Valor
                   07  WSS-CIC-TVAL                     PIC X(01).
      *            Codigo Valor
                   07  WSS-CIC-CVAL                     PIC X(03).
      *            Tipo Cambio
                   07  WSS-CIC-TCAM                     PIC X(08).

      * NUMERO SIN DECIMALES ( PARA TRUNCAR )
           03 WSS-NUM-NDEC                              PIC 9(12).
           03  WSS-COD-CAUX.
               05  WSS-COD-TOOC                      PIC X(03).
               05  WSS-COD-AOOC                      PIC X(03).
      * GLOSAS TIO + AUX
           03  WSS-GLS-TIAU.
               05 WSS-GLS-TIO                        PIC X(40).
               05 WSS-GLS-AUX                        PIC X(40).
      *
      *DAD ini  07-DEC-1990
           03  WSS-GLS-DAT3.
               05 FILLER                               PIC X(17).
               05 WSS-IND-OMIT                         PIC X(01).
               05 FILLER                               PIC X(12).
           03  WSS-IND                                 PIC 9(02).
           03  TAB-FLU-MOR-FUT.
               05 WSS-TAB-MOR      OCCURS 25.
                  07 WSS-COD-MORN                      PIC X(06).
                  07 WSS-VAL-MORN                      PIC 9(12)V9(04).
                  07 WSS-COD-MORE                      PIC X(06).
                  07 WSS-VAL-MORE                      PIC 9(12)V9(04).
               05 WSS-TAB-FUT      OCCURS 25.
                  07 WSS-COD-FUTN                      PIC X(06).
                  07 WSS-VAL-FUTN                      PIC 9(12)V9(04).
                  07 WSS-COD-FUTE                      PIC X(06).
                  07 WSS-VAL-FUTE                      PIC 9(12)V9(04).
      *DAD fin  07-DEC-1990
      *DAD ini  31-JUL-1991
           03 WSS-COD-COOC.
              05 WSS-IND-COOC      OCCURS 10           PIC X(06).
      *DAD fin  31-JUL-1991
      *DAD ini  29-MAY-1992   (Memo.29-05-92)
           03 WSS-IND-HAYR                             PIC 9(01).
      *DAD fin  29-MAY-1992

            03  WSS-FEC-FINT.
               05  WSS-NUM-SINT               PIC 9(02).
               05  WSS-NUM-AINT               PIC 9(02).
               05  WSS-NUM-MINT               PIC 9(02).
               05  WSS-NUM-DINT               PIC 9(02).
      *>>>>
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VLR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
      *DAD ini  15-DEC-1993
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
      *DAD fin  15-DEC-1993
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDT-REQA==.
      *>>>>

      * AQUI EXISTIA LABEL RF INI
      * AQUI EXISTIA LABEL RF FIN
       COPY COLRTMVD.
      *<<<< RT
       COPY COLRTMVR.
      *>>>>

       PROCEDURE DIVISION.
      *==================

      * AQUI EXISTIA LABEL FIN_DEC INI
      * AQUI EXISTIA LABEL FIN_DEC FIN

       MAIN SECTION.
      *------------
       INI-MAIN.
      *    MOVE SYS-MXFL TO SYS-CMND.
      *    PERFORM GNS-PRO-SYS.
       COPY GNSBGEDB.
      *    MOVE 'COL' TO RPT-SIST.
           MOVE 'COLPLMVD' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *<<<< INI
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.

      *Captura Fecha de Inicio
      *     DISPLAY 'FECHA DE INICIO ( DDMMSSAA ) : '.
      *     ACCEPT  WSS-FEC-FINI IN WSS-VARI.
      *     IF WSS-FEC-FINI NOT > SPACES
      *         MOVE WSS-FEC-FPRO TO WSS-FEC-FINI.
      *     DISPLAY WSS-FEC-FINI IN WSS-VARI.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY TO WSS-NUM-DINI IN WSS-FEC-FINI.
           MOVE HOY-MHOY TO WSS-NUM-MINI IN WSS-FEC-FINI.
           MOVE HOY-SHOY TO WSS-NUM-SINI IN WSS-FEC-FINI.
           MOVE HOY-AHOY TO WSS-NUM-AINI IN WSS-FEC-FINI.
      *Captura Fecha de Termino
           DISPLAY 'FECHA DE TERMINO ( DDMMSSAA ) : '.
           ACCEPT  WSS-FEC-FTER IN WSS-VARI.
           IF WSS-FEC-FTER NOT > SPACES
      *DAD ini  23-SEP-1991
               MOVE WSS-FEC-FINI TO WSS-FEC-FTER.
      *DAD fin  23-SEP-1991
           DISPLAY WSS-FEC-FTER IN WSS-VARI.
      *Captura Codigo de Oficina
           DISPLAY 'OFICINA : '.
           ACCEPT  WSS-COD-OFOC IN WSS-VARI.
      *Captura Ejecutivo Operacion Credito
           DISPLAY 'EJECUTIVO : '.
           ACCEPT  WSS-COD-RMOC IN WSS-VARI.
      *DAD ini  31-JUL-1991
      * Captura Codigo Clase Operacion
           DISPLAY 'CLASE OPERACION (*=TODAS) : '.
           MOVE SPACES TO WSS-COD-COOC IN WSS-VARI.
           ACCEPT  WSS-COD-COOC IN WSS-VARI.
           DISPLAY WSS-COD-COOC IN WSS-VARI.
      *DAD fin  31-JUL-1991

           DISPLAY 'FIN    CAPTURA DE PARAMETROS'.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

      *VAL-FEC Valida Fecha de Inicio
      *     MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FECH.
      *     MOVE FEC-FORM-FEC TO FEC-FORM.
      *     MOVE FEC-FBLK-N   TO FEC-FBLK.
      *     MOVE FEC-CHOY-GE  TO FEC-CHOY.
      *     MOVE FEC-VHBL-N   TO FEC-VHBL.
      *     MOVE FEC-VAL-FEC  TO FEC-CMND.
      *     PERFORM PRO-FEC.
      *     IF NOT FEC-STAT-OKS
      *         DISPLAY 'ABORTO: FECHA DE INICIO'
      *         DISPLAY WSS-FEC-FINI ' ' FEC-MENS
      *         PERFORM GNS-PRO-END.

      *VAL-FEC Valida Fecha de Termino
           DISPLAY WSS-FEC-FTER IN WSS-VARI.
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY 'ABORTO: FECHA DE TERMINO ERRONEA'
               DISPLAY WSS-FEC-FTER ' ' FEC-MENS
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
               PERFORM GNS-PRO-ABT.
      *DAD fin  29-MAY-1992

      *CMP-FEC Compara Fecha de Inicio con Fecha de Termino
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FEC1.
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-GRT
               MOVE 'TAB'         TO MSG-COD-SIST
               MOVE 'FECFINIFTER' TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY 'ABORTO:'
               DISPLAY MSG-GLS-DESC IN MSG
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
               PERFORM GNS-PRO-ABT.
      *DAD fin  29-MAY-1992

      *DAD ini  23-SEP-1991
           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DPRO IN WSS-MVD
                                            WSS-NUM-DPRO IN WSS-MVR.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MPRO IN WSS-MVD
                                            WSS-NUM-MPRO IN WSS-MVR.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SPRO IN WSS-MVD
                                            WSS-NUM-SPRO IN WSS-MVR.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-APRO IN WSS-MVD
                                            WSS-NUM-APRO IN WSS-MVR.
      *DAD fin  23-SEP-1991
           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DINI IN WSS-MVD
                                            WSS-NUM-DINI IN WSS-MVR
                                            WSS-NUM-DFEC IN WSS-VARI.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MINI IN WSS-MVD
                                            WSS-NUM-MINI IN WSS-MVR
                                            WSS-NUM-MFEC IN WSS-VARI.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SINI IN WSS-MVD
                                            WSS-NUM-SINI IN WSS-MVR
                                            WSS-NUM-SFEC IN WSS-VARI.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AINI IN WSS-MVD
                                            WSS-NUM-AINI IN WSS-MVR
                                            WSS-NUM-AFEC IN WSS-VARI.
           MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DTER IN WSS-MVD
                                            WSS-NUM-DTER IN WSS-MVR
                                            WSS-NUM-DFET IN WSS-VARI.
           MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MTER IN WSS-MVD
                                            WSS-NUM-MTER IN WSS-MVR
                                            WSS-NUM-MFET IN WSS-VARI.
           MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-STER IN WSS-MVD
                                            WSS-NUM-STER IN WSS-MVR
                                            WSS-NUM-SFET IN WSS-VARI.
           MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-ATER IN WSS-MVD
                                            WSS-NUM-ATER IN WSS-MVR
                                            WSS-NUM-AFET IN WSS-VARI.

      *Compara Fechas en Dias entregando Nro. de Dias de Futuros Vencimi
      *DAD ini  23-SEP-1991
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FEC1.
      *DAD fin  23-SEP-1991
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
      *    PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           IF FEC-STAT-OKS
               MOVE FEC-NDIA TO WSS-NUM-FFVA IN WSS-MVR.

      *VAL-OFI Valida Codigo de Oficina en TABLAS
           IF WSS-COD-OFOC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-OFOC IN WSS-VARI.
           IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
               MOVE WSS-COD-OFOC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY 'ABORTO : OFICINA INEXISTENTE ' WSS-COD-OFOC
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
                   PERFORM GNS-PRO-ABT.
      *DAD fin  29-MAY-1992

           IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
               DISPLAY 'OFICINA : ' OFI-COD-OFIC IN OFI '  '
                                    OFI-GLS-DESC IN OFI
           ELSE
               DISPLAY 'OFICINA : ' 'TODAS'.

      *VAL-USR Valida Codigo de Usuario en TABLAS
           IF WSS-COD-RMOC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-RMOC IN WSS-VARI.
           IF WSS-COD-RMOC IN WSS-VARI NOT = '*'
               MOVE WSS-COD-RMOC IN WSS-VARI TO USR-COD-USER IN USR
               PERFORM VAL-USR
               IF MSG-COD-MENS > SPACES
                   DISPLAY 'ABORTO : USUARIO INEXISTENTE '
                           WSS-COD-RMOC
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
                   PERFORM GNS-PRO-ABT.
      *DAD fin  29-MAY-1992

           IF WSS-COD-RMOC IN WSS-VARI NOT = '*'
               DISPLAY 'EJECUTIVO : ' USR-COD-USER '  '
                                      USR-GLS-DESC
           ELSE
               DISPLAY 'EJECUTIVO : ' 'TODOS'.

      *DAD ini  31-JUL-1991
      *VAL-TAB Valida Clase de Operacion en TABLAS
           IF WSS-COD-COOC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-COOC IN WSS-VARI.
           IF WSS-COD-COOC IN WSS-VARI NOT = '*'
               MOVE 1 TO WSS-IND IN WSS-VARI
               PERFORM VAL-PAR-COOC UNTIL WSS-IND IN WSS-VARI > 10
               DISPLAY WSS-COD-COOC IN WSS-VARI
               IF WSS-COD-COOC IN WSS-VARI NOT > SPACES
                   DISPLAY 'NO EXISTE NINGUNA CLASE INGRESADA VALIDA'
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
                   PERFORM GNS-PRO-ABT.
      *DAD fin  29-MAY-1992
      *DAD fin  31-JUL-1991

      *DAD ini  31-JAN-1992
      * BUSCA CODIGO DE SITUACION CONTABLE "MOROSO"
      *     MOVE 'COL'  TO MSC-COD-SIST.
      *     MOVE 'SCTB' TO MSC-CIC-TMSC IN MSC.
      *     MOVE 'MOR'  TO MSC-CIC-CMSC IN MSC.
      *     MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
      *     PERFORM BUS-MSC.
      *     IF MSG-COD-MENS = SPACES
      *         MOVE MSC-COD-CMSC IN MSC TO WSS-COD-SMOR
      *     ELSE
      *         DISPLAY 'ABORTO : SIS = COL, MSC = SCTB, '
      *                 'MSC-CIC-CMSC = MOR'
      *         DISPLAY ' ' MSG-GLS-DESC
      *         PERFORM GNS-PRO-END.
      *DAD fin  31-JAN-1992

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.

      ******************************************************************
      *DAD ini  22-JUL-1991
      * Proceso para Cargar la tabla  COL/AUX  en Memoria
           PERFORM COL-CRG-CAU.
           IF CAU-CMSG IN CAU-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CAU-CMSG IN CAU-VARI TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CAU-MEN2 IN CAU-VARI
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
               PERFORM GNS-PRO-ABT.
      *DAD fin  29-MAY-1992

      * Proceso para Cargar las tablas  TAB/TIO  y  COL/TOC  en Memoria
           PERFORM COL-CRG-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
               PERFORM GNS-PRO-ABT.
      *DAD fin  29-MAY-1992
      *DAD fin  22-JUL-1991
      *>>>>
           SORT GNSSRT
       COPY COLRSMVD.
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
           IF PGM-STAT-SRT-MAL OR SORT-RETURN > 0
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-VEN.
       FST-INP-SRT.
      *<<<< INI_FST_INP
      *DAD ini  22-JUL-1991 / 12-JUL-1991
      *    Se Optimizo Bloqueando los Mensajes para Seguir DBUG del Proc
      *    Eliminando los Mensajes Intracendentes de Rechazos (NO Error)
      *    Ademas se Cargaron en Memoria las tablas AUX y TOC para Valid
      *DAD fin  22-JUL-1991 / 12-JUL-1991

           MOVE SPACES TO OPC-CIC-IOPC IN OPC.

      * Lee primer registro VEN con situacion contable <> "   "
           MOVE '  A' TO VEN-IND-SCTB IN VEN.
           MOVE 'VEN-IND-SCTB' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO HAY REGISTROS PARA SITUACION CONTABLE'
               GO TO FIN-VEN-SCTB.

      *DAD ini  12-JUL-1991
           DISPLAY ' INICIO DE SELECCION POR SCTB'.
      *DAD fin  12-JUL-1991
       CIC-VEN-SCTB.
           IF NOT FIO-STAT-OKS
               GO TO FIN-VEN-SCTB.

      *DAD ini  12-JUL-1991
      *     DISPLAY VEN-KEY-IVEN ' VCTO CON SCTB <> SPACES'.
      *DAD fin  12-JUL-1991
      *DAD ini  07-DEC-1990
           IF VEN-FEC-FVEN IN VEN > WSS-FEC-FFEC IN WSS-VARI OR
              VEN-VAL-SFIN IN VEN NOT > ZEROES
      *DAD fin  07-DEC-1990
                MOVE 'VEN-IND-SCTB' TO FIO-AKEY
                MOVE FIO-GET-NXT    TO FIO-CMND
                PERFORM COL-FIO-VEN
                GO TO CIC-VEN-SCTB.

           IF VEN-CIC-IOPC IN VEN NOT = OPC-CIC-IOPC IN OPC
               PERFORM GET-OPC-VEN
               IF NOT FIO-STAT-OKS
                   MOVE SPACES TO OPC-CIC-IOPC IN OPC
                   DISPLAY VEN-KEY-IVEN '    VCTO RECHAZADO NO '
                                        'EXISTE OPERACION ASOCIADA'
                   MOVE 'VEN-IND-SCTB' TO FIO-AKEY
                   MOVE FIO-GET-NXT    TO FIO-CMND
                   PERFORM COL-FIO-VEN
                   GO TO CIC-VEN-SCTB.

           PERFORM VRF-OPC.
           IF MSG-COD-MENS > SPACES
      *DAD 22-JUL-1991
               MOVE 'VEN-IND-SCTB' TO FIO-AKEY
               MOVE FIO-GET-NXT    TO FIO-CMND
               PERFORM COL-FIO-VEN
               GO TO CIC-VEN-SCTB.

      *DAD ini  31-JUL-1991
      * Valida que pertenezca a Clase del parametro
           IF WSS-COD-COOC IN WSS-VARI NOT = '*'
               MOVE 1 TO WSS-IND IN WSS-VARI
               PERFORM VAL-SEL-COOC UNTIL WSS-IND IN WSS-VARI > 10 OR
                                     WSS-IND-COOC IN WSS-VARI(WSS-IND) =
                                                  OPC-COD-COOC IN OPC
               IF WSS-IND IN WSS-VARI > 10
                   MOVE 'VEN-IND-SCTB' TO FIO-AKEY
                   MOVE FIO-GET-NXT    TO FIO-CMND
                   PERFORM COL-FIO-VEN
                   GO TO CIC-VEN-SCTB.
      *DAD fin  31-JUL-1991

      *DAD ini  22-JUL-1991 / 07-DEC-1990
      * Busca con el Codigo Clase Operacion en la Tabla cargada en Memor
      * el Indicador de Exclusion o Inclusion segun programa
           MOVE OPC-COD-COOC IN OPC TO CAU-COOC IN CAU-VARI.
           PERFORM COL-BUS-CAU.
           IF CAU-CMSG IN CAU-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CAU-CMSG IN CAU-VARI TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CAU-MEN2 IN CAU-VARI
                       'OPERACION SIN COD-COOC : ' OPC-KEY-IOPC IN OPC
               MOVE 'VEN-IND-SCTB' TO FIO-AKEY
               MOVE FIO-GET-NXT    TO FIO-CMND
               PERFORM COL-FIO-VEN
               GO TO CIC-VEN-SCTB.

      * Excluye Tipos de Operaciones segun Indicador en Pos. 48 Datos An
           MOVE CAU-DAT3 IN CAU-VARI TO WSS-GLS-DAT3 IN WSS-VARI.
           IF WSS-IND-OMIT IN WSS-VARI = 'X'
               MOVE 'VEN-IND-SCTB' TO FIO-AKEY
               MOVE FIO-GET-NXT    TO FIO-CMND
               PERFORM COL-FIO-VEN
               GO TO CIC-VEN-SCTB.
      *DAD fin  22-JUL-1991 / 07-DEC-1990

           PERFORM GET-TOC.
           IF MSG-COD-MENS > SPACES
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               DISPLAY VEN-KEY-IVEN '    VCTO RECHAZADO'
                                    ' CAUSA ( TOC ) : ' MSG-GLS-DESC
               MOVE 'VEN-IND-SCTB' TO FIO-AKEY
               MOVE FIO-GET-NXT    TO FIO-CMND
               PERFORM COL-FIO-VEN
               GO TO CIC-VEN-SCTB.

           MOVE 'M' TO SRT-IND-MORA.
           MOVE 'M' TO SRT-IND-TIPO.
      *DAD ini  12-JUL-1991
      *     DISPLAY VEN-KEY-IVEN ' VCTO SELECCIONADO EN SCTB'.
      *DAD fin  12-JUL-1991

      * OBTIENE VALOR DE CAMBIO PARA MONEDA DEL CREDITO
           PERFORM CNV-VCAM.

      *DAD ini  17-DEC-1993   (Memo.28-10-93)
      * OBTIENE CUENTA CORRIENTE DE CARGO DEL CREDITO
           PERFORM OBT-CCTE.
      *DAD fin  17-DEC-1993

           PERFORM MOV-INP-SRT.
           MOVE 'VEN-IND-SCTB' TO FIO-AKEY.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           GO TO CIC-VEN-SCTB.
       FIN-VEN-SCTB.
           DISPLAY ' FIN SELECCION SCTB'.

      * Lee primer registro VEN con Fecha Inicial del rango de fechas
           MOVE WSS-FEC-FFEC IN WSS-VARI TO VEN-FEC-FVEN IN VEN.
           MOVE 'VEN-FEC-FVEN' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS OR
              VEN-FEC-FVEN IN VEN > WSS-FEC-FFET IN WSS-VARI
               DISPLAY 'NO HAY REGISTROS PARA RANGO DE FECHAS : DESDE '
                       WSS-FEC-FINI IN WSS-VARI ' A '
                       WSS-FEC-FTER IN WSS-VARI
               GO TO FIN-INP-SRT.
      *DAD ini  12-JUL-1991
           DISPLAY ' INICIO DE SELECCION POR RANGO DE FECHAS'.
      *DAD fin  12-JUL-1991

           MOVE 'S' TO WSS-PVEZ.
           MOVE VEN-CIC-IOPC IN VEN TO WSS-CIC-IAUX

           GO TO LUP-INP-SRT.
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-VEN.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
      *ALD.BCI-INI/18.01.1999 ...PARA DETECTAR LOOP EN PRODUCCIN
      *    IF VEN-FEC-FVEN IN VEN > WSS-FEC-FFET IN WSS-VARI
               DISPLAY 'VENCIMIENTO  ' VEN-KEY-IVEN IN VEN.
               DISPLAY 'FECHA VENCTO ' VEN-FEC-FVEN IN VEN.
      *ALD.BCI-FIN/18.01.1999 ...PARA DETECTAR LOOP EN PRODUCCIN

           MOVE VEN-KEY-IVEN IN VEN TO WSS-VEN-KEY-IVEN.


      * VERIFICA ULTIMO VENCIMIENTO DE UNA ESTRUCTURA
           IF RECORRE-ESTRUCTURA
               IF VEN-STAT-EOF
                   PERFORM GET-NXT-VEN-FVEN
                   GO TO LUP-INP-SRT
               ELSE
               IF NOT VEN-STAT-OKS
                   DISPLAY VEN-KEY-IVEN
                              '    ERROR EN EXPANSION DE VCTO '
                   MOVE 'COL'    TO MSG-COD-SIST
                   MOVE VEN-STAT TO MSG-COD-MENS
                   PERFORM GET-MSG
                   DISPLAY MSG-GLS-DESC
                   PERFORM GET-NXT-VEN-FVEN
                   GO TO LUP-INP-SRT.

      * Verifica que Fecha Vencimiento no sobrepase Fecha Superior del r
      * de fechas
      *    VERIFICA QUE FECHA DE VENCIMIENTO NO SOBREPASE LIMITE MAXIMO
      *    ESTE CODIGO SE PUEDE OPTIMIZAR NO LLAMANDO A RUTINA DE FECHAS
      *    BASTARIA DEFINIRSE LAS VARIABLES ADECUADAS PARA COMPARAR
           MOVE WSS-FEC-FTER        TO FEC-FEC1.
           MOVE VEN-NUM-DVEN IN VEN TO FEC-DEC2.
           MOVE VEN-NUM-MVEN IN VEN TO FEC-MEC2.
           MOVE VEN-NUM-SVEN IN VEN TO FEC-SEC2.
           MOVE VEN-NUM-AVEN IN VEN TO FEC-AEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-LES
               IF RECORRE-ESTRUCTURA
      *DAD ini  12-JUL-1991
      *             DISPLAY VEN-KEY-IVEN ' VCTO '
      *                     'ESTRUCTURADO RECHAZADO FUERA DE RANGO'
      *DAD fin  12-JUL-1991
                   PERFORM GET-NXT-VEN-FVEN
      *ALD.BCI-INI/18.01.1999 ...PARA DETECTAR LOOP EN PRODUCCIN
                   IF VEN-FEC-FVEN IN VEN > WSS-FEC-FFET IN WSS-VARI
                       GO TO FIN-INP-SRT
                   ELSE
      *ALD.BCI-FIN/18.01.1999 ...PARA DETECTAR LOOP EN PRODUCCIN
                   GO TO LUP-INP-SRT
               ELSE
      *DAD ini  12-JUL-1991
      *             DISPLAY VEN-KEY-IVEN ' VCTO '
      *                     'NO ESTRUCTURADO RECHAZADO FUERA '
      *                     'DE RANGO'
      *DAD fin  12-JUL-1991
                   GO TO FIN-INP-SRT.


      * SI CODIGO DE SITUACION CONTABLE DE VENCIMIENTO ES
      *    "MOROSA" ==> NO CONSIDERAR VENCIMIENTO
      *     MOVE 'COL'               TO MSC-COD-SIST.
      *     MOVE 'SCTB'              TO MSC-CIC-TMSC IN MSC.
      *     MOVE VEN-IND-SCTB IN VEN TO MSC-COD-CMSC IN MSC.
      *     PERFORM BUS-MSC.
      *     IF MSG-COD-MENS NOT = SPACES
      *         GO TO NXT-INP-SRT.
      *     IF MSC-CIC-CMSC IN MSC = WSS-COD-SMOR IN WSS-VARI
      *         GO TO NXT-INP-SRT.

      *    LEE UNA SOLA VEZ OPERACION ASOCIADA A 'N' VENCIMIENTOS.
           IF VEN-CIC-IOPC IN VEN NOT = OPC-CIC-IOPC IN OPC
               PERFORM GET-OPC-VEN
               IF NOT FIO-STAT-OKS
                   MOVE SPACES TO OPC-CIC-IOPC IN OPC
                   DISPLAY VEN-KEY-IVEN ' VCTO RECHAZADO NO '
                                        'EXISTE OPERACION ASOCIADA'
                   GO TO NXT-INP-SRT.

           PERFORM VRF-OPC.
           IF MSG-COD-MENS > SPACES
      *DAD 22-JUL-1991
               GO TO NXT-INP-SRT.
           IF VEN-NUM-IVCT IN VEN < OPC-NUM-IVEN IN OPC
               GO TO NXT-INP-SRT.

      *     IF VEN-VAL-SFIN IN VEN NOT > ZEROES
      *         GO TO NXT-INP-SRT.
      *DAD ini  31-JUL-1991
      * Valida que pertenezca a Clase del parametro
           IF WSS-COD-COOC IN WSS-VARI NOT = '*'
               MOVE 1 TO WSS-IND IN WSS-VARI
               PERFORM VAL-SEL-COOC UNTIL WSS-IND IN WSS-VARI > 10 OR
                                     WSS-IND-COOC IN WSS-VARI(WSS-IND) =
                                                  OPC-COD-COOC IN OPC
               IF WSS-IND IN WSS-VARI > 10
                   GO TO NXT-INP-SRT.
      *DAD fin  31-JUL-1991

      *DAD ini  22-JUL-1991 / 07-DEC-1990
      * Busca con el Codigo Clase Operacion en la Tabla cargada en Memor
      * el Indicador de Exclusion o Inclusion segun programa
           MOVE OPC-COD-COOC IN OPC TO CAU-COOC IN CAU-VARI.
           PERFORM COL-BUS-CAU.
           IF CAU-CMSG IN CAU-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CAU-CMSG IN CAU-VARI TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CAU-MEN2 IN CAU-VARI
                       'OPERACION SIN COD-COOC : ' OPC-KEY-IOPC IN OPC
               GO TO NXT-INP-SRT.

      * Excluye Tipos de Operaciones segun Indicador en Pos. 48 Datos An
           MOVE CAU-DAT3 IN CAU-VARI TO WSS-GLS-DAT3 IN WSS-VARI.
           IF WSS-IND-OMIT IN WSS-VARI = 'X'
               GO TO NXT-INP-SRT.
      *DAD fin  22-JUL-1991 / 07-DEC-1990

           IF OPC-IND-VSTR IN OPC = 'S'
               MOVE VEN-NUM-IVCT IN VEN TO VEN-NUM-IVEN IN VEN.
      *DAD ini  12-JUL-1991
      *     DISPLAY VEN-KEY-IVEN ' VCTO CANDIDATO'.
      *DAD fin  12-JUL-1991

           IF NOT RECORRE-ESTRUCTURA
               IF OPC-IND-VSTR IN OPC = 'S'
      *DAD ini  12-JUL-1991
      *              DISPLAY VEN-KEY-IVEN ' VCTO RESPALDADO'
      *DAD fin  12-JUL-1991
                    MOVE WSS-VEN-KEY-IVEN TO SCR-VEN-KEY-IVEN
                    MOVE 1 TO WSS-IND-RECO
               ELSE
                    MOVE 0 TO WSS-IND-RECO.

           PERFORM GET-TOC.
           IF MSG-COD-MENS > SPACES
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               DISPLAY VEN-KEY-IVEN ' VCTO RECHAZADO'
                                    ' CAUSA ( TOC ) : ' MSG-GLS-DESC
               GO TO NXT-INP-SRT.


            MOVE SPACES TO SRT-IND-TAPO.
            IF VEN-IND-CALC IN VEN = 'N'
                MOVE '*' TO SRT-IND-TAPO
                IF VEN-VAL-SFIN IN VEN = ZEROES
                    IF OPC-IND-VSTR IN OPC = 'S'
                        MOVE VEN-NUM-IVCT IN VEN TO
                             VEN-NUM-IVEN IN VEN
                        MOVE OPC-FEC-FCOL IN OPC TO
                             WSS-FEC-FINT IN WSS-VARI
                        PERFORM CAL-ULT-CAMBIO-TASA
                        MOVE WSS-FEC-FUCT IN WSS-VARI TO
                             VEN-FTBS
                        MOVE 'S' TO VEN-KEST
                        MOVE FIO-GET-KEY TO FIO-CMND
                        PERFORM COL-OBT-VEN
                        IF NOT VEN-STAT-OKS
               DISPLAY 'VENC-KEST    ' VEN-KEY-IVEN IN VEN
               DISPLAY 'FECHA VENCTO ' VEN-FEC-FVEN IN VEN
               DISPLAY 'VEN-STAT     ' VEN-STAT
                            MOVE 0 TO WSS-IND-RECO
                            GO TO NXT-INP-SRT.
           MOVE 'V' TO SRT-IND-MORA.
           MOVE 'V' TO SRT-IND-TIPO.
      *DAD ini  12-JUL-1991
      *     DISPLAY VEN-KEY-IVEN ' VCTO SELECCIONADO'
      *DAD fin  12-JUL-1991

      * OBTIENE VALOR DE CAMBIO PARA MONEDA DEL CREDITO
           PERFORM CNV-VCAM.

      *DAD ini  17-DEC-1993   (Memo.28-10-93)
      * OBTIENE CUENTA CORRIENTE DE CARGO DEL CREDITO
           PERFORM OBT-CCTE.
      *DAD fin  17-DEC-1993
      *>>>>
       MOV-INP-SRT.
       COPY COLRMMVD.
           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< IF INI_NXT_INP
      * Mueve la Llave Alternativa por la cual se leera VEN
           MOVE FIO-GET-NXT TO FIO-CMND.
           IF RECORRE-ESTRUCTURA
      *          MOVE OPC-FEC-FCOL IN OPC TO WSS-FEC-FINT IN WSS-VARI
      *          PERFORM CAL-ULT-CAMBIO-TASA
      *          MOVE WSS-FEC-FUCT IN WSS-VARI TO VEN-FTBS
      *          MOVE 'S' TO VEN-KEST
                PERFORM COL-OBT-VEN
               DISPLAY 'VENC-NO-KEST    ' VEN-KEY-IVEN IN VEN
               DISPLAY 'FECHA VENCTO ' VEN-FEC-FVEN IN VEN
               DISPLAY 'VEN-STAT     ' VEN-STAT
                MOVE '00' TO FIO-STAT
                IF VEN-CIC-IOPC IN VEN = WSS-CIC-IAUX
                    MOVE 'N' TO WSS-PVEZ
                ELSE
                    MOVE 'S' TO WSS-PVEZ
                    MOVE VEN-CIC-IOPC IN VEN TO WSS-CIC-IAUX
           ELSE
                MOVE 'VEN-FEC-FVEN' TO FIO-AKEY
      *ALD.BCI-INI/18.01.1999 ...PARA DETECTAR LOOP EN PRODUCCIN
      *         PERFORM COL-FIO-VEN.
                PERFORM COL-FIO-VEN
                IF VEN-FEC-FVEN IN VEN > WSS-FEC-FFET IN WSS-VARI
               DISPLAY 'VENC-FINP-INP' VEN-KEY-IVEN IN VEN
               DISPLAY 'FECH-FINP-INP' VEN-FEC-FVEN IN VEN
                    GO TO FIN-INP-SRT.
      *ALD.BCI-FIN/18.01.1999 ...PARA DETECTAR LOOP EN PRODUCCIN
               DISPLAY 'VENC-LUP-INP' VEN-KEY-IVEN IN VEN.
               DISPLAY 'FECH-LUP-INP' VEN-FEC-FVEN IN VEN.

           GO TO LUP-INP-SRT.
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
      *<<<< FIN_INP
      *DAD ini  12-JUL-1991
           DISPLAY ' FIN DE SELECCION POR RANGO DE FECHAS'.
      *DAD fin  12-JUL-1991
      *     PERFORM MOR-DLC.
      *     PERFORM MOR-RDT.
      *>>>>
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-VEN.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
      *<<<< INI_OUT
           PERFORM INITIATE-RPTMVR.
      *DAD ini  29-MAY-1992   (Memo.29-05-92)
           MOVE 0 TO WSS-IND-HAYR IN WSS-VARI.
      *DAD fin  29-MAY-1992
      *>>>>
           OPEN OUTPUT RPTMVD.
      *     MOVE 'COLPLMVD' TO RPT-NPGM.
           PERFORM CAL-HDR.
           PERFORM INITIATE-RPTMVD.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           MOVE SRT TO SRT-OLD-MVD.
           MOVE SRT TO SRT-CUR-MVD.
      *<<<< FST_OUT

      *DAD ini  29-MAY-1992   (Memo.29-05-92)
           MOVE 1 TO WSS-IND-HAYR IN WSS-VARI.
      *DAD fin  29-MAY-1992
           OPEN OUTPUT RPTMVR.
           PERFORM INITIATE-RPTMVR.
           MOVE  0  TO WSS-SW IN WSS-VARI.
           MOVE OPC-COD-OFOC IN SRT TO WSS-COD-OFOC IN WSS-VARI.
           MOVE OPC-COD-RMOC IN SRT TO WSS-COD-RMOC IN WSS-VARI.
           MOVE SPACES              TO WSS-GLS-NOMM IN WSS-VARI
                                       WSS-GLS-NOMF IN WSS-VARI.
           PERFORM MVR-FST-PRO-CTL.
           PERFORM MVD-FST-PRO-CTL.

      *DAD ini  07-DEC-1990
           PERFORM INI-TAB-FLU-MOR-FUT.
      *DAD fin  07-DEC-1990
      *>>>>
      *    PERFORM MVD-FST-PRO-CTL.
       LUP-OUT-SRT.
      *<<<< LUP_OUT
      * Mediante BUS-TAB Busca Clase de Operacion de Tabla AUX
           MOVE OPC-COD-COOC IN SRT TO OPC-COD-COOC IN OPC.
           IF OPC-COD-COOC IN OPC > SPACES
               MOVE 'COL'               TO TAB-COD-SIST
               MOVE 'AUX'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-TOOC IN OPC TO WSS-COD-TOOC IN WSS-VARI
               MOVE OPC-COD-AOOC IN OPC TO WSS-COD-AOOC IN WSS-VARI
               MOVE WSS-COD-CAUX IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-AUX IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-AUX IN WSS-VARI.
           IF OPC-COD-TOOC IN OPC > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'TIO'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-TOOC IN OPC TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TIO IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-TIO IN WSS-VARI.
           MOVE WSS-GLS-TIAU IN WSS-VARI TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO WSS-GLS-COOC IN WSS-MVD.

      * ANTIGUO
      *     IF OPC-COD-COOC IN SRT > SPACES
      *         MOVE 'COL'               TO TAB-COD-SIST
      *         MOVE 'AUX'               TO TAB-COD-TTAB IN TAB
      *         MOVE OPC-COD-COOC IN SRT TO TAB-COD-CTAB IN TAB
      *         PERFORM BUS-TAB
      *         MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-COOC IN WSS-MVD
      *     ELSE
      *         MOVE SPACES TO WSS-GLS-COOC IN WSS-MVD.

      * Mediante BUS-TAB Busca Tipo de Moneda de Tabla VLR
           IF OPC-COD-VCOC IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-VCOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-ABRV IN TAB TO WSS-GLS-VCOC IN WSS-MVD
           ELSE
               MOVE SPACES TO WSS-GLS-VCOC IN WSS-MVD.

           IF DBC-GLS-ICLI IN SRT > SPACES
               MOVE '-'    TO WSS-GLS-AUXI IN WSS-MVD
           ELSE
               MOVE SPACES TO WSS-GLS-AUXI IN WSS-MVD.
      *>>>>
       GEN-OUT-SRT.
           PERFORM GENERATE-DL-MVD.
      *<<<< FIN_GEN_OUT
           IF WSS-SW = 1
               PERFORM BUS-GLS-MVR
               PERFORM PRO-DL-MVR
      *DAD ini  07-DEC-1990
               PERFORM GEN-LIN-MOR
               PERFORM GEN-LIN-FUT
               PERFORM PRO-DL-RAY
               PERFORM INI-TAB-FLU-MOR-FUT
               MOVE SPACES TO WSS-GLS-MNAM IN WSS-MVR
                              WSS-GLS-MNAF IN WSS-MVR
                              WSS-GLS-MEXM IN WSS-MVR
                              WSS-GLS-MEXF IN WSS-MVR
      *DAD fin  07-DEC-1990
               MOVE ZEROES TO WSS-VAL-FVMC IN WSS-MVR
                              WSS-VAL-FVME IN WSS-MVR
                              WSS-NUM-NCVM IN WSS-MVR
                              WSS-VAL-FFVC IN WSS-MVR
                              WSS-VAL-FFVE IN WSS-MVR
                              WSS-NUM-NCFV IN WSS-MVR
                              WSS-SW       IN WSS-VARI.

           IF SRT-IND-MORA IN SRT = 'M'
               PERFORM FLU-VEN-MOR
           ELSE
               PERFORM FLU-FUT-VEN.
           MOVE OPC-COD-OFOC IN SRT TO WSS-COD-OFOC IN WSS-VARI.
           MOVE OPC-COD-RMOC IN SRT TO WSS-COD-RMOC IN WSS-VARI.
      *>>>>
       NXT-OUT-SRT.
           MOVE SRT TO SRT-OLD-MVD.
       RET-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
      *<<<< FIN_OUT
           PERFORM TERMINATE-RPTMVR.
      *DAD ini  29-MAY-1992   (Memo.29-05-92)
           IF WSS-IND-HAYR IN WSS-VARI = 0
               MOVE 'NO EXISTE INFORMACION QUE LISTAR, DE ACUERDO A LOS
      -             'PARAMETROS INGRESADOS' TO WSS-GLS-MENS IN WSS-MVD
               PERFORM PRO-DL-MSG
               PERFORM TERMINATE-RPTMVD
               CLOSE RPTMVD
               GO TO EXT-OUT-SRT.
      *DAD fin  29-MAY-1992
      *>>>>
           IF HAY-REGISTROS-EN-SORT-MVD
                PERFORM TERMINATE-RPTMVD.
      *<<<< FIN_TMT
           PERFORM BUS-GLS-MVR.
           PERFORM PRO-DL-MVR.
      *DAD ini  07-DEC-1990
           PERFORM GEN-LIN-MOR.
           PERFORM GEN-LIN-FUT.
           PERFORM PRO-DL-RAY.
      *DAD fin  07-DEC-1990
           PERFORM TERMINATE-RPTMVR.
           CLOSE RPTMVR.
      *>>>>
           CLOSE RPTMVD.
       EXT-OUT-SRT.
           EXIT.
       COPY COLBFVEN.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGIRH.
       COPY COLREMVD.
      *    15-OCT-98 04:41 PM     ,PAI= ,CLI= ,SOP=MVS  V 1.1.3
       D-CF-MVD-OPC-COD-OFOC SECTION.
       INI-CF-MVD-OPC-COD-OFOC.
       FIN-CF-MVD-OPC-COD-OFOC.
           EXIT.
       D-CH-MVD-OPC-COD-OFOC SECTION.
       INI-CH-MVD-OPC-COD-OFOC.
       FIN-CH-MVD-OPC-COD-OFOC.
           EXIT.
       D-CF-MVD-OPC-COD-RMOC SECTION.
       INI-CF-MVD-OPC-COD-RMOC.
      *<<<< CF_MVD_OPC_COD_RMOC
           MOVE  1  TO WSS-SW IN WSS-VARI.
      *>>>>
       FIN-CF-MVD-OPC-COD-RMOC.
           EXIT.
       D-CF-MVD-VEN-FEC-FVEN SECTION.
       INI-CF-MVD-VEN-FEC-FVEN.
       FIN-CF-MVD-VEN-FEC-FVEN.
           EXIT.
       D-PH-MVD SECTION.
       INI-PH-MVD.
      *<<<< PH_MVD
      * Mediante BUS-OFI se Obtiene Nombre de la Oficina de Tabla OFI
           IF OPC-COD-OFOC IN SRT > SPACES
               MOVE OPC-COD-OFOC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFOC IN WSS-MVD
           ELSE
               MOVE SPACES TO WSS-GLS-OFOC IN WSS-MVD.

      * Mediante BUS-USR Busca Usuario de Tabla USR
           IF OPC-COD-RMOC IN SRT > SPACES
               MOVE OPC-COD-RMOC IN SRT TO USR-COD-USER IN USR
               PERFORM BUS-USR
               MOVE USR-GLS-DESC IN USR TO WSS-GLS-RMOC IN WSS-MVD
           ELSE
               MOVE SPACES TO WSS-GLS-RMOC IN WSS-MVD.
      *>>>> END
       FIN-PH-MVD.
           EXIT.
       D-DL-MVD SECTION.
       INI-DL-MVD.
       FIN-DL-MVD.
           EXIT.
       D-DL-NUL SECTION.
       INI-DL-NUL.
       FIN-DL-NUL.
           EXIT.
       D-DL-MSG SECTION.
       INI-DL-MSG.
       FIN-DL-MSG.
           EXIT.
       COPY GNSBGABT.

      *<<<< EOF
      ******************************************************************
      *DAD ini  31-JUL-1991
      * Valida que la Clase del parametro Exista
       VAL-PAR-COOC SECTION.
       INI-VAL-PAR-COOC.
           IF WSS-IND-COOC IN WSS-VARI(WSS-IND) > SPACES
               MOVE 'COL'           TO TAB-COD-SIST
               MOVE 'AUX'           TO TAB-COD-TTAB IN TAB
               MOVE WSS-IND-COOC IN WSS-VARI(WSS-IND)
                                    TO TAB-COD-CTAB IN TAB
               PERFORM VAL-TAB
               IF MSG-COD-MENS IN MSG > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                           ' CLASE : ' WSS-IND-COOC IN WSS-VARI(WSS-IND)
                   MOVE SPACES TO WSS-IND-COOC IN WSS-VARI(WSS-IND).
           ADD 1 TO WSS-IND IN WSS-VARI.
       FIN-VAL-PAR-COOC.
           EXIT.
      *DAD fin  31-JUL-1991
      ******************************************************************
       GET-OPC-VEN SECTION.
       INI-GET-OPC-VEN.
           MOVE VEN-CIC-IOPC IN VEN TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FIN-GET-OPC-VEN.
           EXIT.
      ******************************************************************
       VRF-OPC SECTION.
       INI-VRF-OPC.
           MOVE SPACES TO MSG-COD-MENS.

           IF OPC-MSC-STAT IN OPC NOT = 'A'
               MOVE 'OPC    NOACA' TO MSG-COD-MENS
               GO TO FIN-VRF-OPC.

      *ALD-BCI-INI/23-11-1998
           IF OPC-VAL-SCRE IN OPC = ZEROES
               MOVE 'OPC    YACAN' TO MSG-COD-MENS
               GO TO FIN-VRF-OPC.
      *ALD-BCI-FIN/23-11-1998

           IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
               IF WSS-COD-OFOC IN WSS-VARI NOT = OPC-COD-OFOC IN OPC
                   MOVE 'OPC    NOOFI' TO MSG-COD-MENS
                   GO TO FIN-VRF-OPC.

           IF WSS-COD-RMOC IN WSS-VARI NOT = '*'
               IF WSS-COD-RMOC IN WSS-VARI NOT = OPC-COD-RMOC IN OPC
                   MOVE 'OPC    NOMON' TO MSG-COD-MENS
                   GO TO FIN-VRF-OPC.
       FIN-VRF-OPC.
           EXIT.
      ******************************************************************
      *DAD ini  31-JUL-1991
      * Valida que pertenezca a Clase del parametro
       VAL-SEL-COOC SECTION.
       INI-VAL-SEL-COOC.
           ADD 1 TO WSS-IND IN WSS-VARI.
       FIN-VAL-SEL-COOC.
           EXIT.
      *DAD fin  31-JUL-1991
      ******************************************************************
       CNV-VCAM SECTION.
       INI-CNV-VCAM.
      * ASUME ERROR
           MOVE ZEROES TO SRT-VAL-VTRA IN SRT.

      *DAD ini  07-DEC-1990
           MOVE VEN-VAL-SFIN IN VEN TO SRT-VAL-VTRA IN SRT.
           GO TO FIN-CNV-VCAM.
      *DAD fin  07-DEC-1990

           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'VLR'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC
               DISPLAY 'OPERACION : ' OPC-CIC-IOPC IN OPC
               DISPLAY ' '
               GO TO FIN-CNV-VCAM.

      *ISP SI ES MONEDA REAJUSTABLE ( CHILENA Y NO PESOS ) ENTONCES
      *    CONVIERTE A PESOS
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-VCAM.
           IF NOT ( WSS-CIC-TVAL = '0' AND
                    WSS-CIC-VCAM NOT = '0999' )
               MOVE VEN-VAL-SFIN IN VEN TO SRT-VAL-VTRA IN SRT
               GO TO END-CNV-VCAM.

           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB.
           MOVE '0999  '       TO TAB-CIC-CTAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               DISPLAY 'CODIGO DE PESOS INEXISTENTE'
               DISPLAY 'OPERACION ' OPC-CIC-IOPC IN OPC
               DISPLAY ' '
               GO TO FIN-CNV-VCAM.

           MOVE VEN-FEC-FVEN IN VEN TO CAM-FEC-FCAM IN CAM(1).
           MOVE VEN-FEC-FVEN IN VEN TO CAM-FEC-FCAM IN CAM(2).
           MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1).
      *ISP CODIGO DE PESOS
           MOVE TAB-COD-CTAB IN TAB TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'CODVCAMNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY VEN-KEY-IVEN '    ' MSG-GLS-DESC
               DISPLAY ' PARA VCTO '
               DISPLAY 'PARA FECHA : '      VEN-FEC-FVEN IN VEN
               MOVE ZEROES TO SRT-VAL-VTRA IN SRT
           ELSE
               IF CAM-IND-VIGE NOT = 'S'
                   MOVE 'COL'       TO MSG-COD-SIST
                   MOVE 'VALCAMNVG' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   DISPLAY VEN-KEY-IVEN '    ' MSG-GLS-DESC
                   DISPLAY ' PARA VCTO '
                   DISPLAY 'PARA FECHA : '      VEN-FEC-FVEN IN VEN
                   MOVE ZEROES TO SRT-VAL-VTRA IN SRT
               ELSE
                   MULTIPLY CAM-SGV-VCAM IN CAM
                         BY VEN-VAL-SFIN IN VEN
                     GIVING SRT-VAL-VTRA IN SRT.
       END-CNV-VCAM.
           IF WSS-CIC-TVAL = '0'
                MOVE SRT-VAL-VTRA IN SRT TO WSS-NUM-NDEC
                MOVE WSS-NUM-NDEC TO SRT-VAL-VTRA IN SRT.
       FIN-CNV-VCAM.
           EXIT.
      ******************************************************************
      *DAD ini  17-DEC-1993   (Memo.28-10-93)
      * OBTIENE CUENTA CORRIENTE DE CARGO DEL CREDITO
       OBT-CCTE SECTION.
       INI-OBT-CCTE.
           MOVE OPC-CAI-IOPC IN OPC TO CYA-CAI-IOPC IN CYA.
           MOVE OPC-IIC-IOPC IN OPC TO CYA-IIC-IOPC IN CYA.
           MOVE 'AUT'               TO CYA-NUM-ICAN IN CYA.
           MOVE 1                   TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO CYA-IIC-ICYA IN CYA.
       FIN-OBT-CCTE.
           EXIT.
      *DAD fin  17-DEC-1993
      ******************************************************************
       GET-TOC SECTION.
       INI-GET-TOC.
           MOVE SPACES TO MSG-COD-MENS.

      *DAD ini  22-JUL-1991
      * Busca con el Codigo Tipo Operacion en la Tabla cargada en Memori
      * 'Opera Como'
           MOVE OPC-COD-TOOC IN OPC TO CTO-TOOC IN CTO-VARI.
           PERFORM COL-BUS-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
                       'CON CODIGO : ' CTO-TOOC IN CTO-VARI
               GO TO FIN-GET-TOC.

      * Obtiene 'Opera Como'
           MOVE SPACES               TO TOC.
           MOVE CTO-OPEC IN CTO-VARI TO TOC-MSC-OPEC IN TOC.
      *DAD fin  22-JUL-1991

      * Complementa Formacion del Registro SRT
           IF TOC-MSC-OPEC IN TOC = 'D'
               PERFORM BUS-DLC-ICG
           ELSE
               MOVE ZEROES TO ICG-NUM-ICAN IN ICG
               PERFORM BUS-OPC-ICG.

      *DAD ini  31-JAN-1992   (Memo.11-12-91 pto.2)
           IF ICG-COD-CVTI IN ICG > SPACES
               MOVE ICG-SGV-SPRD IN ICG TO ICG-SGV-TINT IN ICG.
      *DAD fin  31-JAN-1992

           IF NOT FIO-STAT-OKS
               MOVE ZEROES TO ICG-SGV-TINT IN ICG
               MOVE 'OPC    NOINT' TO MSG-COD-MENS
               GO TO FIN-GET-TOC.

      * Busca Datos Cliente por Medio del CIC de Operaciones en Registro
      * Busca CIC del Cliente con el CIC de Operaciones de Creditos en R
      * RDC-NUM-IDLC > 0 ====> DEU.IND.
      * RDC-NUM-IDLC = 0 ====> DEU.DIR.
           MOVE OPC-CAI-IOPC IN OPC TO RDC-CAI-IOPC IN RDC.
           MOVE OPC-IIC-IOPC IN OPC TO RDC-IIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT FIO-STAT-OKS
               MOVE 'OPC    RDCNX' TO MSG-COD-MENS
               GO TO FIN-GET-TOC.

      *CIC-CLI Busca Datos del Cliente Mediante su CIC
           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM GET-CLI.
           IF MSG-COD-MENS > SPACES
               MOVE SPACES TO DBC-NUM-ICLI IN DBC
                              DBC-VRF-ICLI IN DBC
                              DBC-IND-ICLI IN DBC
                              DBC-GLS-ICLI IN DBC
           ELSE
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC.
       FIN-GET-TOC.
           EXIT.
      ******************************************************************
      * Busca Documento Legal de Operacion de Credito segun Vencimiento
      * Obtiene Tasa de Interes al Leer ICG por Llave KEY-IICG Formada
       BUS-DLC-ICG SECTION.
       INI-BUS-DLC-ICG.
           IF VEN-NUM-IDLC IN VEN NOT = 0
               MOVE VEN-NUM-IDLC IN VEN TO DLC-NUM-IDLC IN DLC
           ELSE
               MOVE VEN-NUM-IVCT IN VEN TO DLC-NUM-IDLC IN DLC.
           MOVE OPC-CIC-IOPC IN OPC     TO DLC-CIC-IOPC IN DLC.
           MOVE FIO-GET-KEY             TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'OPC    DLCNX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   DLC-KEY-IDLC
               GO TO FIN-BUS-DLC-ICG.
       GET-ICG-DLC.
           MOVE DLC-NUM-IDLC IN DLC TO ICG-NUM-ICAN IN ICG.
           PERFORM GET-KEY-IICG.
           IF NOT ( FIO-STAT-OKS AND
                    ICG-NUM-ICAN IN ICG = DLC-NUM-IDLC IN DLC AND
                    ICG-CIC-IOPC IN ICG = OPC-CIC-IOPC IN OPC AND
                    ICG-CIC-IOPV IN ICG = SPACES              AND
                    ICG-NUM-IVCT IN ICG = ZEROES              AND
                    ICG-IND-TTAS IN ICG = 'INT' )
               PERFORM BUS-OPC-ICG.
       FIN-BUS-DLC-ICG.
           EXIT.
      *-----------------------------------------------------------------
      * Obtiene Tasa de Interes al Leer ICG por Llave KEY-IICG Formada
       BUS-OPC-ICG SECTION.
       INI-BUS-OPC-ICG.
           MOVE ZEROES TO ICG-NUM-ICAN IN ICG.
           PERFORM GET-KEY-IICG.
           IF NOT ( FIO-STAT-OKS AND
                    ICG-NUM-ICAN IN ICG = ZEROES              AND
                    ICG-CIC-IOPC IN ICG = OPC-CIC-IOPC IN OPC AND
                    ICG-CIC-IOPV IN ICG = SPACES              AND
                    ICG-NUM-IVCT IN ICG = ZEROES              AND
                    ICG-IND-TTAS IN ICG = 'INT' )
                     MOVE '23' TO FIO-STAT.
       FIN-BUS-OPC-ICG.
           EXIT.
      *-----------------------------------------------------------------
       GET-KEY-IICG SECTION.
       INI-GET-KEY-IICG.
      * Forma Llave KEY-IICG y Lee ICG para Obtener Tasa de Interes
           MOVE OPC-CIC-IOPC IN OPC TO ICG-CIC-IOPC IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE 'INT'               TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-ICG.
       FIN-GET-KEY-IICG.
           EXIT.
      ******************************************************************
       GET-NXT-VEN-FVEN SECTION.
       INI-GET-NXT-VEN-FVEN.
           MOVE SCR-VEN-KEY-IVEN TO VEN-KEY-IVEN IN VEN.
      *     MOVE FIO-KDEF-S TO FIO-KDEF.
           MOVE 0 TO WSS-IND-RECO.

           MOVE SPACES TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-VEN.

           MOVE 'VEN-FEC-FVEN' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-VEN.
      *RRM-INI 20-OCT-1998
           IF VEN-CIC-IOPC IN VEN = WSS-CIC-IAUX
              MOVE 'N' TO WSS-PVEZ
           ELSE
              MOVE 'S' TO WSS-PVEZ
              MOVE VEN-CIC-IOPC IN VEN TO WSS-CIC-IAUX.
               DISPLAY 'VENC-NXT-FVEN' VEN-KEY-IVEN IN VEN.
               DISPLAY 'FECH-NXT-FVEN' VEN-FEC-FVEN IN VEN.
      *RRM-FIN 20-OCT-1998
       FIN-GET-NXT-VEN-FVEN.
           EXIT.
      ******************************************************************
      ******************************************************************
       MOR-DLC SECTION.
       INI-MOR-DLC.
      *    SON MOROSOS TODOS AQUELLOS DOCUMENTOS CON DLC-IND-SCTB <> ' '
      *    Y <> 'MUL'

      *    SE SALTA DLC CON DLC-IND-SCTB = '   '
           MOVE 'A  ' TO DLC-IND-SCTB IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
       NXT-MOR-DLC.
           MOVE 'DLC-IND-SCTB' TO FIO-AKEY.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-MOR-DLC.
      *    SE SALTA DLC CON DLC-IND-SCTB = 'MUL'
           IF DLC-IND-SCTB IN DLC = 'MUL'
               MOVE 'MUN' TO DLC-IND-SCTB IN DLC
               MOVE FIO-GET-NLS TO FIO-CMND
               GO TO NXT-MOR-DLC.

           PERFORM PRO-DLC-VEN.
           IF WSS-IND-DLC = SPACES
               MOVE DLC-VAL-SDLC IN DLC TO VEN-VAL-SFIN IN VEN
               PERFORM GET-TOC
               MOVE 'M' TO SRT-IND-MORA
               MOVE 'D' TO SRT-IND-TIPO
               PERFORM MOV-INP-SRT
               DISPLAY DLC-KEY-IDLC '    DLC SELECCIONADO'.

           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO NXT-MOR-DLC.
       FIN-MOR-DLC.
           EXIT.
      *-----------------------------------------------------------------
       MOR-RDT SECTION.
       INI-MOR-RDT.
      *    SON MOROSOS TODOS LOS RDT
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-RDT.
           IF NOT FIO-STAT-OKS
               DISPLAY '    NO EXISTEN RDT '
               GO TO FIN-MOR-RDT.

           MOVE RDT-CIC-IOPC IN RDT TO WSS-RDT-CIC-IOPC.
           MOVE RDT-NUM-IDLC IN RDT TO WSS-RDT-NUM-IDLC.
           MOVE ZEROES              TO WSS-RDT-VAL-SRDT.
       NXT-MOR-RDT.
           IF NOT FIO-STAT-OKS
               MOVE '10' TO PGM-STAT-RDT
               GO TO CIC-MOR-RDT.

           IF RDT-CIC-IOPC IN RDT = WSS-RDT-CIC-IOPC AND
              RDT-NUM-IDLC IN RDT = WSS-RDT-NUM-IDLC
                ADD RDT-VAL-SRDT IN RDT TO WSS-RDT-VAL-SRDT
                MOVE FIO-GET-NXT TO FIO-CMND
                PERFORM COL-FIO-RDT
                GO TO NXT-MOR-RDT
           ELSE
                MOVE RDT-CIC-IOPC IN RDT TO WSS-RDT-CIC-IOPC
                MOVE RDT-NUM-IDLC IN RDT TO WSS-RDT-NUM-IDLC
                MOVE FIO-GET-PRV TO FIO-CMND
                PERFORM COL-FIO-RDT
                MOVE WSS-RDT-VAL-SRDT TO RDT-VAL-SRDT IN RDT
                MOVE ZEROES TO WSS-RDT-VAL-SRDT.
       CIC-MOR-RDT.
           MOVE RDT-CIC-IOPC IN RDT TO DLC-CIC-IOPC IN DLC.
           MOVE RDT-NUM-IDLC IN RDT TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
                DISPLAY RDT-KEY-IRDT ' RDT RECHAZADO SIN DLC'
                MOVE FIO-GET-NXT TO FIO-CMND
                PERFORM COL-FIO-RDT
                GO TO NXT-MOR-RDT.

           PERFORM PRO-DLC-VEN.
           IF WSS-IND-DLC = SPACES
                MOVE RDT-VAL-SRDT IN RDT TO VEN-VAL-SFIN IN VEN
                MOVE 'M' TO SRT-IND-MORA
                MOVE 'R' TO SRT-IND-TIPO
                PERFORM MOV-INP-SRT
                DISPLAY DLC-KEY-IDLC '    DLC SELECCIONADO'.

           IF PGM-STAT-RDT-OKS
                MOVE FIO-GET-NXT TO FIO-CMND
                PERFORM COL-FIO-RDT
                GO TO NXT-MOR-RDT.
       FIN-MOR-RDT.
           EXIT.
      *-----------------------------------------------------------------
       PRO-DLC-VEN SECTION.
       INI-PRO-DLC-VEN.
           MOVE SPACES TO WSS-IND-DLC.
           MOVE ' '    TO WSS-IND-DLC.

           DISPLAY DLC-KEY-IDLC '    DLC CANDIDATO'.
      *    LEE UNA SOLA VEZ OPERACION ASOCIADA A 'N' DOCUMENTOS.
           IF DLC-CIC-IOPC IN DLC NOT = OPC-CIC-IOPC IN OPC
               MOVE DLC-CIC-IOPC IN DLC TO OPC-CIC-IOPC IN OPC
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM COL-FIO-OPC
               IF NOT FIO-STAT-OKS
                   MOVE 'E' TO WSS-IND-DLC
                   MOVE SPACES TO OPC-CIC-IOPC IN OPC
                   DISPLAY DLC-KEY-IDLC '    DLC RECHAZADO '
                   DISPLAY ' SIN OPERACION'
                   MOVE FIO-GET-NXT TO FIO-CMND
                   GO TO FIN-PRO-DLC-VEN.

           PERFORM VRF-OPC.
           IF MSG-COD-MENS > SPACES
               MOVE 'E' TO WSS-IND-DLC
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               DISPLAY DLC-KEY-IDLC '    DLC RECHAZADO '
                                    'CAUSA ( OPC ) : '
               DISPLAY MSG-GLS-DESC
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO FIN-PRO-DLC-VEN.

           MOVE DLC-CIC-IOPC IN DLC TO VEN-CIC-IOPC IN VEN.
           MOVE ZEROES TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-NLS TO FIO-CMND.
       CIC-DLC-VEN.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
               MOVE 'E' TO WSS-IND-DLC
               DISPLAY DLC-KEY-IDLC ' DLC RECHAZADO '
                                    'FIO-STAT-VEN '
                       FIO-STAT
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO FIN-PRO-DLC-VEN.

           IF DLC-CIC-IOPC IN DLC NOT = VEN-CIC-IOPC IN VEN
               MOVE 'E' TO WSS-IND-DLC
               DISPLAY DLC-KEY-IDLC ' DLC RECHAZADO '
                                    'NO EXISTE PRIMER '
                                    'VCTO MOROSO'
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO FIN-PRO-DLC-VEN.

           IF NOT ( DLC-NUM-IDLC IN DLC = VEN-NUM-IDLC AND
                    VEN-VAL-SFIN IN VEN > ZEROES )
                      MOVE FIO-GET-NXT TO FIO-CMND
                      GO TO CIC-DLC-VEN.

           PERFORM GET-TOC.
           IF MSG-COD-MENS > SPACES
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               DISPLAY VEN-KEY-IVEN '    VCTO RECHAZADO '
                                    ' CAUSA ( TOC ) : ' MSG-GLS-DESC
               GO TO FIN-PRO-DLC-VEN.
       FIN-PRO-DLC-VEN.
           EXIT.
      ******************************************************************
      ******************************************************************
      *DAD ini  07-DEC-1990
       INI-TAB-FLU-MOR-FUT SECTION.
       INI-INI-TAB-FLU-MOR-FUT.
           MOVE 1 TO WSS-IND IN WSS-VARI.
       LUP-INI-TAB-FLU-MOR-FUT.
           MOVE ZEROES TO WSS-VAL-MORN IN WSS-VARI(WSS-IND)
                          WSS-VAL-MORE IN WSS-VARI(WSS-IND)
                          WSS-VAL-FUTN IN WSS-VARI(WSS-IND)
                          WSS-VAL-FUTE IN WSS-VARI(WSS-IND).
           MOVE SPACES TO WSS-COD-MORN IN WSS-VARI(WSS-IND)
                          WSS-COD-MORE IN WSS-VARI(WSS-IND)
                          WSS-COD-FUTN IN WSS-VARI(WSS-IND)
                          WSS-COD-FUTE IN WSS-VARI(WSS-IND).
           ADD 1 TO WSS-IND IN WSS-VARI.
           IF WSS-IND IN WSS-VARI > 25
               GO TO FIN-INI-TAB-FLU-MOR-FUT.
           GO TO LUP-INI-TAB-FLU-MOR-FUT.
       FIN-INI-TAB-FLU-MOR-FUT.
           EXIT.
      *DAD fin  07-DEC-1990
      ******************************************************************
       BUS-GLS-MVR SECTION.
       INI-BUS-GLS-MVR.
      * Mediante BUS-OFI se Obtiene Nombre de la Oficina de Tabla OFI
           IF WSS-COD-OFOC IN WSS-VARI > SPACES
               MOVE WSS-COD-OFOC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFOC IN WSS-MVR
           ELSE
               MOVE SPACES TO WSS-GLS-OFOC IN WSS-MVR.

      * Mediante BUS-USR Busca Usuario de Tabla USR
           IF WSS-COD-RMOC IN WSS-VARI > SPACES
               MOVE WSS-COD-RMOC IN WSS-VARI TO USR-COD-USER IN USR
               PERFORM BUS-USR
               MOVE USR-GLS-DESC IN USR TO WSS-GLS-RMOC IN WSS-MVR
           ELSE
               MOVE SPACES TO WSS-GLS-RMOC IN WSS-MVR.
       FIN-BUS-GLS-MVR.
           EXIT.
      ******************************************************************
       FLU-VEN-MOR SECTION.
       INI-FLU-VEN-MOR.
      *DAD ini  07-DEC-1990
           IF OPC-MSC-TVOC IN SRT = '0'
               PERFORM MOR-VAL-NAC
           ELSE
               PERFORM MOR-VAL-EXT.
      *DAD fin  07-DEC-1990
           IF DBC-GLS-NOMC IN SRT NOT = WSS-GLS-NOMM IN WSS-VARI OR
              ( DBC-GLS-NOMC IN SRT = WSS-GLS-NOMM IN WSS-VARI AND
                OPC-COD-RMOC IN SRT NOT = WSS-COD-RMOC IN WSS-VARI )
               ADD  1  TO WSS-NUM-NCVM IN WSS-MVR
               MOVE DBC-GLS-NOMC IN SRT TO WSS-GLS-NOMM IN WSS-VARI.
       FIN-FLU-VEN-MOR.
           EXIT.
      *-----------------------------------------------------------------
       FLU-FUT-VEN SECTION.
       INI-FLU-FUT-VEN.
      *DAD ini  07-DEC-1990
           IF OPC-MSC-TVOC IN SRT = '0'
               PERFORM FUT-VAL-NAC
           ELSE
               PERFORM FUT-VAL-EXT.
      *DAD fin  07-DEC-1990
           IF DBC-GLS-NOMC IN SRT NOT = WSS-GLS-NOMF IN WSS-VARI OR
              ( DBC-GLS-NOMC IN SRT = WSS-GLS-NOMF IN WSS-VARI AND
                OPC-COD-RMOC IN SRT NOT = WSS-COD-RMOC IN WSS-VARI )
               ADD  1  TO WSS-NUM-NCFV IN WSS-MVR
               MOVE DBC-GLS-NOMC IN SRT TO WSS-GLS-NOMF IN WSS-VARI.
       FIN-FLU-FUT-VEN.
           EXIT.
      ******************************************************************
      *DAD ini  07-DEC-1990
       GEN-LIN-MOR SECTION.
       INI-GEN-LIN-MOR.
           MOVE 1 TO WSS-IND IN WSS-VARI.
           IF WSS-COD-MORN IN WSS-VARI(WSS-IND) = SPACES AND
              WSS-COD-MORE IN WSS-VARI(WSS-IND) = SPACES
               PERFORM PRO-DL-FMO
               GO TO FIN-GEN-LIN-MOR.
       LUP-GEN-LIN-MOR.
           IF WSS-COD-MORN IN WSS-VARI(WSS-IND) > SPACES
                MOVE WSS-COD-MORN IN WSS-VARI(WSS-IND)
                                         TO OPC-COD-VCOC IN OPC
                PERFORM BUS-GLS-MONE
                MOVE TAB-GLS-ABRV IN TAB TO WSS-GLS-MNAM IN WSS-MVR
                MOVE WSS-VAL-MORN IN WSS-VARI(WSS-IND)
                                         TO WSS-VAL-FVMC IN WSS-MVR
           ELSE
                MOVE SPACES TO WSS-GLS-MNAM IN WSS-MVR
                MOVE ZEROES TO WSS-VAL-FVMC IN WSS-MVR.

           IF WSS-COD-MORE IN WSS-VARI(WSS-IND) > SPACES
                MOVE WSS-COD-MORE IN WSS-VARI(WSS-IND)
                                         TO OPC-COD-VCOC IN OPC
                PERFORM BUS-GLS-MONE
                MOVE TAB-GLS-ABRV IN TAB TO WSS-GLS-MEXM IN WSS-MVR
                MOVE WSS-VAL-MORE IN WSS-VARI(WSS-IND)
                                         TO WSS-VAL-FVME IN WSS-MVR
           ELSE
                MOVE SPACES TO WSS-GLS-MEXM IN WSS-MVR
                MOVE ZEROES TO WSS-VAL-FVME IN WSS-MVR.

           PERFORM PRO-DL-FMO.
           ADD 1 TO WSS-IND IN WSS-VARI.
           IF ( WSS-COD-MORN IN WSS-VARI(WSS-IND) = SPACES AND
                WSS-COD-MORE IN WSS-VARI(WSS-IND) = SPACES ) OR
              WSS-IND IN WSS-VARI > 25
               GO TO FIN-GEN-LIN-MOR.
           GO TO LUP-GEN-LIN-MOR.
       FIN-GEN-LIN-MOR.
           EXIT.
      *-----------------------------------------------------------------
       GEN-LIN-FUT SECTION.
       INI-GEN-LIN-FUT.
           PERFORM PRO-DL-TFU.
           MOVE 1 TO WSS-IND IN WSS-VARI.
           IF WSS-COD-FUTN IN WSS-VARI(WSS-IND) = SPACES AND
              WSS-COD-FUTE IN WSS-VARI(WSS-IND) = SPACES
               PERFORM PRO-DL-FFU
               GO TO FIN-GEN-LIN-FUT.
       LUP-GEN-LIN-FUT.
           IF WSS-COD-FUTN IN WSS-VARI(WSS-IND) > SPACES
                MOVE WSS-COD-FUTN IN WSS-VARI(WSS-IND)
                                         TO OPC-COD-VCOC IN OPC
                PERFORM BUS-GLS-MONE
                MOVE TAB-GLS-ABRV IN TAB TO WSS-GLS-MNAF IN WSS-MVR
                MOVE WSS-VAL-FUTN IN WSS-VARI(WSS-IND)
                                         TO WSS-VAL-FFVC IN WSS-MVR
           ELSE
                MOVE SPACES TO WSS-GLS-MNAF IN WSS-MVR
                MOVE ZEROES TO WSS-VAL-FFVC IN WSS-MVR.

           IF WSS-COD-FUTE IN WSS-VARI(WSS-IND) > SPACES
                MOVE WSS-COD-FUTE IN WSS-VARI(WSS-IND)
                                         TO OPC-COD-VCOC IN OPC
                PERFORM BUS-GLS-MONE
                MOVE TAB-GLS-ABRV IN TAB TO WSS-GLS-MEXF IN WSS-MVR
                MOVE WSS-VAL-FUTE IN WSS-VARI(WSS-IND)
                                         TO WSS-VAL-FFVE IN WSS-MVR
           ELSE
                MOVE SPACES TO WSS-GLS-MEXF IN WSS-MVR
                MOVE ZEROES TO WSS-VAL-FFVE IN WSS-MVR.

           PERFORM PRO-DL-FFU.
           ADD 1 TO WSS-IND IN WSS-VARI.
           IF ( WSS-COD-FUTN IN WSS-VARI(WSS-IND) = SPACES AND
                WSS-COD-FUTE IN WSS-VARI(WSS-IND) = SPACES ) OR
              WSS-IND IN WSS-VARI > 25
               GO TO FIN-GEN-LIN-FUT.
           GO TO LUP-GEN-LIN-FUT.
       FIN-GEN-LIN-FUT.
           EXIT.
      *-----------------------------------------------------------------
       BUS-GLS-MONE SECTION.
       INI-BUS-GLS-MONE.
      * Mediante BUS-TAB Busca Tipo de Moneda de Tabla VLR
           IF OPC-COD-VCOC IN OPC > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
           ELSE
               MOVE SPACES TO TAB-GLS-ABRV IN TAB.
       FIN-BUS-GLS-MONE.
           EXIT.
      *DAD fin  07-DEC-1990
      ******************************************************************
      *DAD ini  07-DEC-1990
       MOR-VAL-NAC SECTION.
       INI-MOR-VAL-NAC.
           MOVE 1 TO WSS-IND IN WSS-VARI.
       LUP-MOR-VAL-NAC.
           IF WSS-COD-MORN IN WSS-VARI(WSS-IND) = SPACES
               MOVE OPC-COD-VCOC IN SRT TO WSS-COD-MORN
                                           IN WSS-VARI(WSS-IND)
               ADD  SRT-VAL-VTRA IN SRT TO WSS-VAL-MORN
                                           IN WSS-VARI(WSS-IND)
               GO TO FIN-MOR-VAL-NAC
           ELSE
           IF WSS-COD-MORN IN WSS-VARI(WSS-IND) = OPC-COD-VCOC IN SRT
               ADD  SRT-VAL-VTRA IN SRT TO WSS-VAL-MORN
                                           IN WSS-VARI(WSS-IND)
               GO TO FIN-MOR-VAL-NAC.

           ADD 1 TO WSS-IND IN WSS-VARI.
           IF WSS-IND IN WSS-VARI > 25
               DISPLAY 'TABLA DE MONEDA CHILENA MOROSOS QUEDO CHICA'
               GO TO FIN-MOR-VAL-NAC.
           GO TO LUP-MOR-VAL-NAC.
       FIN-MOR-VAL-NAC.
           EXIT.
      *-----------------------------------------------------------------
       MOR-VAL-EXT SECTION.
       INI-MOR-VAL-EXT.
           MOVE 1 TO WSS-IND IN WSS-VARI.
       LUP-MOR-VAL-EXT.
           IF WSS-COD-MORE IN WSS-VARI(WSS-IND) = SPACES
               MOVE OPC-COD-VCOC IN SRT TO WSS-COD-MORE
                                           IN WSS-VARI(WSS-IND)
               ADD  SRT-VAL-VTRA IN SRT TO WSS-VAL-MORE
                                           IN WSS-VARI(WSS-IND)
               GO TO FIN-MOR-VAL-EXT
           ELSE
           IF WSS-COD-MORE IN WSS-VARI(WSS-IND) = OPC-COD-VCOC IN SRT
               ADD  SRT-VAL-VTRA IN SRT TO WSS-VAL-MORE
                                           IN WSS-VARI(WSS-IND)
               GO TO FIN-MOR-VAL-EXT.

           ADD 1 TO WSS-IND IN WSS-VARI.
           IF WSS-IND IN WSS-VARI > 25
               DISPLAY 'TABLA DE MONEDA EXTRANJERA MOROSOS QUEDO CHICA'
               GO TO FIN-MOR-VAL-EXT.
           GO TO LUP-MOR-VAL-EXT.
       FIN-MOR-VAL-EXT.
           EXIT.
      *-----------------------------------------------------------------
       FUT-VAL-NAC SECTION.
       INI-FUT-VAL-NAC.
           MOVE 1 TO WSS-IND IN WSS-VARI.
       LUP-FUT-VAL-NAC.
           IF WSS-COD-FUTN IN WSS-VARI(WSS-IND) = SPACES
               MOVE OPC-COD-VCOC IN SRT TO WSS-COD-FUTN
                                           IN WSS-VARI(WSS-IND)
               ADD  SRT-VAL-VTRA IN SRT TO WSS-VAL-FUTN
                                           IN WSS-VARI(WSS-IND)
               GO TO FIN-FUT-VAL-NAC
           ELSE
           IF WSS-COD-FUTN IN WSS-VARI(WSS-IND) = OPC-COD-VCOC IN SRT
               ADD  SRT-VAL-VTRA IN SRT TO WSS-VAL-FUTN
                                           IN WSS-VARI(WSS-IND)
               GO TO FIN-FUT-VAL-NAC.

           ADD 1 TO WSS-IND IN WSS-VARI.
           IF WSS-IND IN WSS-VARI > 25
               DISPLAY 'TABLA DE MONEDA CHILENA FUTUROS QUEDO CHICA'
               GO TO FIN-FUT-VAL-NAC.
           GO TO LUP-FUT-VAL-NAC.
       FIN-FUT-VAL-NAC.
           EXIT.
      *-----------------------------------------------------------------
       FUT-VAL-EXT SECTION.
       INI-FUT-VAL-EXT.
           MOVE 1 TO WSS-IND IN WSS-VARI.
       LUP-FUT-VAL-EXT.
           IF WSS-COD-FUTE IN WSS-VARI(WSS-IND) = SPACES
               MOVE OPC-COD-VCOC IN SRT TO WSS-COD-FUTE
                                           IN WSS-VARI(WSS-IND)
               ADD  SRT-VAL-VTRA IN SRT TO WSS-VAL-FUTE
                                           IN WSS-VARI(WSS-IND)
               GO TO FIN-FUT-VAL-EXT
           ELSE
           IF WSS-COD-FUTE IN WSS-VARI(WSS-IND) = OPC-COD-VCOC IN SRT
               ADD  SRT-VAL-VTRA IN SRT TO WSS-VAL-FUTE
                                           IN WSS-VARI(WSS-IND)
               GO TO FIN-FUT-VAL-EXT.

           ADD 1 TO WSS-IND IN WSS-VARI.
           IF WSS-IND IN WSS-VARI > 25
               DISPLAY 'TABLA DE MONEDA EXTRANJERA FUTUROS QUEDO CHICA'
               GO TO FIN-FUT-VAL-EXT.
           GO TO LUP-FUT-VAL-EXT.
       FIN-FUT-VAL-EXT.
           EXIT.
      *DAD fin  07-DEC-1990
      ******************************************************************


       COPY COLREMVR.

       COPY GNSBFMSC.
       COPY TABBFUSR.
       COPY TABBFOFI.
       COPY TABBFVLR.
       COPY TABBFCAM.
       COPY COLBFOPC.
       COPY COLBFDLC.
       COPY COLBFTOC.
       COPY COLBFICG.
      *DAD ini  15-DEC-1993
       COPY COLBFCYA.
      *DAD fin  15-DEC-1993
       COPY COLBFRDC.
       COPY SGCBFDBC.
       COPY GNSBBMSG.
       COPY GNSBBMSC.
       COPY GNSBBTAB.
       COPY TABBBUSR.
       COPY TABBBOFI.
       COPY GNSBVMSC.
       COPY GNSBVTAB.
       COPY TABBVUSR.
       COPY TABBVOFI.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY GNSBGHOY.
       COPY GNSBGCPT.
       COPY SGCBGCLI.
      * COPY COLBGVEN.

      ******************************************************************
      * COPY COLBGVEN REPLACING ==IN OPC== BY ==IN OPC==.
      *Rutina de expansion de vencimientos
      *Se modifico para que expandiera todas las cuotas,
      *incluyendo la ultima que no conoce
      *JSS LAST MOD. 16-JUN-1997
       COL-OBT-VEN SECTION.
       INI-COL-OBT-VEN.
      *DAD ini  07-JAN-1993
      * Carga variable necesaria para procesar con la variable VEN-INIT
           ADD  1  OPC-NUM-IVEN IN OPC GIVING VEN-OIM1.
      *DAD fin  07-JAN-1993

      *Calcula la cantidad de VENCIMIENTOS TOTAL de la operacion
           IF OPC-NUM-TVCC IN OPC NOT > ZEROES
               ADD OPC-NUM-VCVG IN OPC
                   OPC-NUM-VCCO IN OPC
                   OPC-NUM-VCCM IN OPC
                   OPC-NUM-VCCV IN OPC GIVING VEN-VCTO
           ELSE
               ADD OPC-NUM-VCVG IN OPC
                   OPC-NUM-TVCC IN OPC GIVING VEN-VCTO.
      *
      *Analiza comando ( cual vencimiento desea obtener )
           IF FIO-CMND = FIO-GET-FST
               MOVE 1 TO VEN-NUM-IVEN IN VEN
           ELSE
           IF FIO-CMND = FIO-GET-NLS
               IF VEN-NUM-IVEN IN VEN = ZEROES
                   MOVE 1 TO VEN-NUM-IVEN IN VEN
               ELSE
                   NEXT SENTENCE
           ELSE
           IF FIO-CMND = FIO-GET-NXT
               ADD 1 TO VEN-NUM-IVEN IN VEN
               IF VEN-NUM-IVEN IN VEN > VEN-VCTO
                   MOVE VEN-SEOF TO VEN-STAT
                   GO TO FIN-COL-OBT-VEN.
      *
      *Parrafo que lee vencimiento, estructuras y carga variables de tra
           PERFORM INI-VEN.
           IF VEN-STAT-CUR
      *JSS-INI  13-JUN-1997
               MOVE RCV-IRCV IN RCV-VRBL TO RCV-KEY-IRCV IN RCV
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM COL-FIO-RCV
               MOVE ICG-IICG IN ICG-VRBL TO ICG-KEY-IICG IN ICG
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM COL-FIO-ICG
      *JSS-FIN  13-JUN-1997
               GO TO FIN-COL-OBT-VEN.
      *
      *Si pidio un vencimiento siguiente o un vencimiento anterior
      *el VEN-IEVC parte con la estructura que genero el vencimiento act
      *el VEN-IVCT es el vencimiento pedido
           IF VEN-IVAS-SIG
               PERFORM INC-VEN UNTIL ( NOT VEN-STAT-OKS ) OR
                       VEN-IVCT = EVC-IVCT(VEN-IEVC)
           ELSE
               PERFORM DEC-VEN UNTIL ( NOT VEN-STAT-OKS ) OR
                       VEN-IVCT = EVC-IVCT(VEN-IEVC).
      *
      *Calcula Inicio Mora para el VEN encontrado, y lee su DLC y EVC as
           PERFORM FIN-VEN.
           IF VEN-STAT-OKS
      *carga valores de VEN-VARI para conformar el registro VEN a retorn
               PERFORM LOD-RVEN.
       FIN-COL-OBT-VEN.
           MOVE ZEROES TO VEN-FTBS.
           MOVE 'S'    TO VEN-INIT.
           MOVE 'N'    TO VEN-KEST.
      *DAD ini  07-JAN-1993
      * Carga variables necesarias para procesar con la variable VEN-INI
           MOVE OPC-CIC-IOPC IN OPC TO VEN-OANT.
           MOVE VEN-IVCT            TO VEN-VANT.
      *DAD fin  07-JAN-1993
       EXT-COL-OBT-VEN.
           EXIT.

       LOD-RVEN SECTION.
       INI-LOD-RVEN.
      *carga valores de VEN-VARI para conformar el registro VEN a retorn
      *    MOVE EVC-FPVC(VEN-IEVC) TO VEN-FEC-FVEN IN VEN.
           MOVE EVC-FFVC(VEN-IEVC) TO VEN-FEC-FVEN IN VEN.
           MOVE VEN-FIMV           TO VEN-FEC-FIMV IN VEN.
           MOVE VEN-CAPI           TO VEN-VAL-CAPI IN VEN.
           MOVE VEN-SCAP           TO VEN-VAL-SCAP IN VEN.
           MOVE VEN-IDNI           TO VEN-VAL-IDNI IN VEN.
           MOVE VEN-FINA           TO VEN-VAL-FINA IN VEN.
           MOVE VEN-SFIN           TO VEN-VAL-SFIN IN VEN.
           MOVE VEN-SCTB           TO VEN-IND-SCTB IN VEN
                                      VEN-IND-CTBA IN VEN.
           MOVE VEN-IVCT           TO VEN-NUM-IVCT IN VEN.
           MOVE EVC-IEVC(VEN-IEVC) TO VEN-NUM-IEVC IN VEN.
           MOVE VEN-IDLC           TO VEN-NUM-IDLC IN VEN.
           MOVE EVC-CAUT(VEN-IEVC) TO VEN-IND-CAUT IN VEN.
           MOVE VEN-SCBZ           TO VEN-IND-SCBZ IN VEN.
           MOVE ZEROES             TO VEN-VAL-MTSC IN VEN.
           MOVE ZEROES             TO VEN-IND-MTSC IN VEN.
           MOVE VEN-CALC           TO VEN-IND-CALC IN VEN.
       FIN-LOD-RVEN.
           EXIT.

       INI-VEN SECTION.
       INI-INI-VEN.
      *DAD ini  07-JAN-1993
      * Discrimina la validez de procesar con la variable VEN-INIT
           IF VEN-NUM-IVEN IN VEN > VEN-OIM1 AND
              OPC-CIC-IOPC IN OPC = VEN-OANT AND
              VEN-VANT > OPC-NUM-IVEN IN OPC AND
              VEN-VANT < VEN-NUM-IVEN IN VEN
               MOVE SPACES              TO VEN-SCTB
               MOVE SPACES              TO VEN-SCBZ
               MOVE 'N'                 TO VEN-INIT
               MOVE VEN-NUM-IVEN IN VEN TO VEN-IVCT
               GO TO FIN-INI-VEN
           ELSE
               MOVE 'S' TO VEN-INIT.
      *DAD fin  07-JAN-1993
      *Inicializacion de variables
           MOVE SPACES     TO VEN-VARI EVC-VARI DLC-VARI AYF-VARI.
           MOVE LOW-VALUES TO VEN-VARC                   AYF-VARC.
           MOVE 10         TO VEN-LVCC.
           MOVE RCV-KEY-IRCV IN RCV TO RCV-IRCV IN RCV-VRBL.
           MOVE ICG-KEY-IICG IN ICG TO ICG-IICG IN ICG-VRBL.
      *
      *Lee el vencimiento en la base de datos ( variable VEN-NUM-IVCT co
      *el numero del vencimiento )
           MOVE VEN-SOKS TO VEN-STAT.
           MOVE VEN-NUM-IVEN IN VEN TO VEN-IVCT.
           MOVE 1 TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
               MOVE VEN-SFAL TO VEN-STAT
               GO TO FIN-INI-VEN.
      *    MOVE VEN-IND-SCTB IN VEN TO VEN-SCTB.
           MOVE SPACES              TO VEN-SCTB.
      *    MOVE VEN-IND-SCBZ IN VEN TO VEN-SCBZ.
           MOVE SPACES              TO VEN-SCBZ.
           MOVE VEN-FEC-FVEN IN VEN TO VEN-FVEN.
           MOVE VEN-FEC-FIMV IN VEN TO VEN-FIMV.
           MOVE VEN-NUM-IDLC IN VEN TO VEN-IDLC.
           MOVE VEN-VAL-CAPI IN VEN TO VEN-CAPI.
           MOVE VEN-VAL-SCAP IN VEN TO VEN-SCAP.
           MOVE VEN-VAL-IDNI IN VEN TO VEN-IDNI.
           MOVE VEN-VAL-FINA IN VEN TO VEN-FINA.
           MOVE VEN-VAL-SFIN IN VEN TO VEN-SFIN.
           MOVE VEN-NUM-IVCT IN VEN TO VEN-NVEN.
           MOVE VEN-IVCT TO VEN-NUM-IVEN IN VEN.
      *Realiza analisis de feriado a la fecha de vencimiento
      *en el caso de que esta sea feriado
           IF OPC-IND-AFER IN OPC = 'N'
               GO TO CON-INI-VEN.
           MOVE VEN-DVEN TO FEC-ITM1.
           MOVE VEN-MVEN TO FEC-ITM2.
           MOVE VEN-SVEN TO FEC-ITM3.
           MOVE VEN-AVEN TO FEC-ITM4.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-FER
               MOVE FEC-SIG-HBL  TO FEC-CMND
               MOVE FEC-FORM-FEC TO FEC-FORM
      *        PERFORM PRO-FEC
               PERFORM CAL-FEC
               MOVE FEC-ITM1 TO VEN-DVEN
               MOVE FEC-ITM2 TO VEN-MVEN
               MOVE FEC-ITM3 TO VEN-SVEN
               MOVE FEC-ITM4 TO VEN-AVEN.
       CON-INI-VEN.
      *
      *JSS-INI 28-FEB-1994
           IF VEN-IND-CALC IN VEN = 'N' AND VEN-KEST = 'S' AND
              VEN-INIT = 'S' AND VEN-NUM-IVCT IN VEN NOT > VEN-IVCT
               PERFORM COM-REG-VEN
               MOVE VEN-NUM-IVCT IN VEN TO VEN-NVEN
               IF NOT VEN-STAT-OKS
                   GO TO FIN-INI-VEN.
      *JSS-FIN 28-FEB-1994

      *Pregunta para ver si el vencimiento pedido ( VEN-IVCT ) correspon
      *a un vencimiento siguiente, a uno anterior, o al actual
           IF VEN-NUM-IVCT IN VEN < VEN-IVCT
               MOVE 'S' TO VEN-IVAS
           ELSE
           IF VEN-NUM-IVCT IN VEN > VEN-IVCT
               MOVE 'A' TO VEN-IVAS
           ELSE
      *Pidio el 'current'
               MOVE VEN-SCUR TO VEN-STAT
      *        Si el saldo del credito es cero ==> que ya se pago el ult
      *        vencimiento y este no puede ser otro que el 'current', po
      *        tanto :
      *        si el VEN 'current' esta incompleto suma su CAPITAL al SC
      *        porque al estar incompleto no debe rebajarse el SCPA con
      *        CAPITAL
               IF ( OPC-VAL-SCRE IN OPC NOT > ZEROES ) AND
                  ( ( VEN-IND-CALC IN VEN = 'N'    ) AND
                    ( VEN-VAL-FINA IN VEN > ZEROES ) )
                   MOVE VEN-NUM-IDLC IN VEN TO VEN-IDLC
                   PERFORM LOD-RDLC
                   IF VEN-STAT-OKS
                       ADD VEN-VAL-CAPI IN VEN TO DLC-SCPA(VEN-IDLC)
                       GO TO FIN-INI-VEN
                   ELSE
                       GO TO FIN-INI-VEN
               ELSE
                   GO TO FIN-INI-VEN.
      *
      *Calcula numero de vencimientos cancelados
           IF OPC-NUM-TVCC IN OPC NOT > ZEROES
               ADD OPC-NUM-VCCO IN OPC
                   OPC-NUM-VCCM IN OPC
                   OPC-NUM-VCCV IN OPC GIVING VEN-VCAN
           ELSE
               MOVE OPC-NUM-TVCC IN OPC TO VEN-VCAN.
      *
      *Si estan todos los vencimientos cancelados resta 1 al numero de
      *vencimientos cancelados como un 'truco' para no considerarlos
      *posteriormente
           IF OPC-NUM-VCVG IN OPC NOT > ZEROES
               SUBTRACT 1 FROM VEN-VCAN.
      *
      *Parrafo para obtener las estructuras de vencimiento, en VEN-EAUX
      *retorna el numero de la estructura que genero el vencimiento actu
           PERFORM OBT-EVC.
           IF NOT VEN-STAT-OKS
               GO TO FIN-INI-VEN.
           IF VEN-EAUX = 0
               MOVE VEN-SEFL TO VEN-STAT
               GO TO FIN-INI-VEN.
      *
      *Si desea un vencimiento anterior al actual
           IF VEN-IVAS-ANT
      *        llama a parrafo ANT-EVC para
      *        decrementar todas las estructuras salvo aquellas que dan
      *        origen al vencimiento o las que estan totalmente cancelad
               PERFORM ANT-EVC
      *        Si el VEN original esta completo suma su CAPITAL al SCPA,
      *        porque al estar completo se rebajo el SCPA con dicho CAPI
               IF ( VEN-IND-CALC IN VEN NOT = 'N' ) OR
                  ( ( VEN-IND-CALC IN VEN = 'N'    ) AND
                    ( VEN-VAL-FINA IN VEN NOT > ZEROES ) )
                   MOVE VEN-NUM-IDLC IN VEN TO VEN-IDLC
                   PERFORM LOD-RDLC
                   IF VEN-STAT-OKS
                       ADD VEN-VAL-CAPI IN VEN TO DLC-SCPA(VEN-IDLC)
                   ELSE
                       GO TO FIN-INI-VEN.

      **Si desea un vencimiento siguiente al actual
      *     IF VEN-IVAS-SIG
      **    Si el VEN original esta incompleto resta su CAPITAL al SCPA,
      **    porque al estar incompleto no se rebajo el SCPA con dicho CA
      *         IF VEN-IND-CALC IN VEN = 'N'
      *             MOVE VEN-NUM-IDLC IN VEN TO VEN-IDLC
      *             PERFORM LOD-RDLC
      *             IF VEN-STAT-OKS
      *                 SUBTRACT VEN-VAL-CAPI IN VEN FROM
      *                                              DLC-SCPA(VEN-IDLC)
      *             ELSE
      *                 GO TO FIN-INI-VEN.
      *
      *carga indice de trabajo con VEN-EAUX : La estructura o la primera
      *de ellas que genera el vencimiento actual
           MOVE VEN-EAUX TO VEN-IEVC.
      *
      *Busca codigo de tabla asociado a CIC= CAM-COD-MNAC IN CAM-VARI.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR' TO TAB-CIC-TTAB IN TAB.
           MOVE CAM-COD-MNAC IN CAM-VARI TO TAB-CIC-CTAB IN TAB.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'CICDOC PAGNX' TO VEN-STAT
               GO TO FIN-INI-VEN.
           MOVE TAB-COD-CTAB IN TAB TO CIC-VLR-MNAC.
      *Busca codigo de tabla asociado a CIC='MIPL'
           MOVE FIO-GET-KEY    TO FIO-CMND.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE 'COL'          TO FIO-SIST.
           MOVE 'MIPL' TO MSC-CIC-TMSC IN MSC.
           MOVE 'P'    TO MSC-CIC-CMSC IN MSC.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
               MOVE 'CICMIPLPNX' TO VEN-STAT
               GO TO FIN-INI-VEN.
           MOVE MSC-COD-CMSC IN MSC TO CIC-MIPL-P.
      *Carga Tipo de Tasa de Interes INT-TIPT
           MOVE OPC-CAI-IOPC IN OPC TO ICG-CAI-IOPC IN ICG.
           MOVE OPC-IIC-IOPC IN OPC TO ICG-IIC-IOPC IN ICG.
           MOVE ZEROES              TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE 'INT'               TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF NOT ( FIO-STAT-OKS AND
                    ICG-CAI-IOPC IN ICG = OPC-CAI-IOPC IN OPC AND
                    ICG-IIC-IOPC IN ICG = OPC-IIC-IOPC IN OPC AND
                    ICG-NUM-ICAN IN ICG = ZEROES AND
                    ICG-CIC-IOPV IN ICG = SPACES AND
                    ICG-NUM-IVCT IN ICG = ZEROES AND
                    ICG-IND-TTAS IN ICG = 'INT' )
               MOVE 'ICG    NEX' TO VEN-STAT
               GO TO FIN-INI-VEN.
           MOVE ICG-COD-TINT IN ICG TO INT-TIPT.
           IF INT-CVTI NOT > SPACES
               MOVE ICG-SGV-TINT IN ICG TO INT-TINT
           ELSE
               MOVE ICG-SGV-SPRD IN ICG TO INT-TINT.
      *Busca codigo de como opera
           MOVE SPACES TO CIC-OPEC.
           MOVE OPC-COD-TOOC IN OPC TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-TOC.
           IF NOT FIO-STAT-OKS
               MOVE 'VEN    TOCNX' TO VEN-STAT
               GO TO FIN-INI-VEN
           ELSE
               MOVE 'COL'               TO MSC-COD-SIST FIO-SIST
               MOVE 'OPEC'              TO MSC-COD-TMSC IN MSC
               MOVE TOC-MSC-OPEC IN TOC TO MSC-COD-CMSC IN MSC
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-MSC
               IF NOT FIO-STAT-OKS
                   MOVE 'VEN    OPENX'      TO VEN-STAT
                   GO TO FIN-INI-VEN
               ELSE
                   MOVE MSC-CIC-CMSC IN MSC TO CIC-OPEC.
       FIN-INI-VEN.
           EXIT.

       FIN-VEN SECTION.
       INI-FIN-VEN.
           IF NOT VEN-STAT-OKS
               GO TO FIN-FIN-VEN.
      *INI Obtener Fecha Inicio Mora para  el vencimiento
           MOVE EVC-DFVC(VEN-IEVC) TO FEC-ITM1.
           MOVE EVC-MFVC(VEN-IEVC) TO FEC-ITM2.
           MOVE EVC-SFVC(VEN-IEVC) TO FEC-ITM3.
           MOVE EVC-AFVC(VEN-IEVC) TO FEC-ITM4.
           IF EVC-DESD(VEN-IEVC) > 0
               MOVE EVC-DESD(VEN-IEVC) TO FEC-NDIA
               MOVE FEC-FORM-FEC       TO FEC-FORM
               MOVE FEC-SUM-DIA        TO FEC-CMND
      *        PERFORM PRO-FEC
               PERFORM CAL-FEC
               IF NOT FEC-STAT-OKS
                   MOVE 'VENFIMVER+' TO VEN-STAT
                   GO TO FIN-FIN-VEN.

      *DAD ini  12-AUG-1991
      * Fecha de MORA sera igual a la Fecha del Vencimiento sin Analisis
      *     MOVE FEC-FORM-FEC TO FEC-FORM.
      *     MOVE FEC-VHBL-S   TO FEC-VHBL.
      *     MOVE FEC-FBLK-N   TO FEC-FBLK.
      *     MOVE FEC-CHOY-N   TO FEC-CHOY.
      *     MOVE FEC-VAL-FEC  TO FEC-CMND.
      *     PERFORM PRO-FEC.
      *     IF ( NOT FEC-STAT-OKS ) AND ( NOT FEC-STAT-FER )
      *         MOVE 'VENFIMVERHBL' TO VEN-STAT
      *         GO TO FIN-FIN-VEN.
      *     IF FEC-STAT-FER
      *         MOVE FEC-FORM-FEC TO FEC-FORM
      *         MOVE FEC-SIG-HBL  TO FEC-CMND
      *         PERFORM CAL-FEC
      *         IF NOT FEC-STAT-OKS
      *             MOVE 'VENFIMVERSHB' TO VEN-STAT
      *             GO TO FIN-FIN-VEN.
      *DAD fin  12-AUG-1991
       IMV-FIN-VEN.
           MOVE FEC-ITM1 TO VEN-DIMV.
           MOVE FEC-ITM2 TO VEN-MIMV.
           MOVE FEC-ITM3 TO VEN-SIMV.
           MOVE FEC-ITM4 TO VEN-AIMV.
      *FIN Obtener Fecha Inicio Mora
      *
      *Lee el documento y la estructura de vencimiento asociado al
      *vencimiento encontrado
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           IF EVC-IDLC(VEN-IEVC) NOT > 0
               MOVE EVC-IVCT(VEN-IEVC) TO DLC-NUM-IDLC IN DLC
           ELSE
               MOVE EVC-IDLC(VEN-IEVC) TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
               MOVE VEN-SDFL TO VEN-STAT
               GO TO FIN-FIN-VEN.
           MOVE OPC-CIC-IOPC IN OPC TO EVC-CIC-IOPC IN EVC.
           MOVE EVC-IEVC(VEN-IEVC)  TO EVC-NUM-IEVC IN EVC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-EVC.
           IF NOT FIO-STAT-OKS
               MOVE VEN-SEFL TO VEN-STAT
               GO TO FIN-FIN-VEN.
           IF VEN-IVAS-ANT
               PERFORM ANT-CAN
           ELSE
      *        PERFORM SIG-CAN
      *        MOVE VEN-CAPI TO VEN-VKCC
               GO TO CON-FIN-VEN.
      *
      *Si el VEN generado esta incompleto con FINA > 0, suma el capital
      *SCPA, ya que:
      *Caso 1) hacia atras    : al cancelar dicho VEN el CAPI se rebajo
      *                         SCPA, y ahora debe sumarse al SCPA
      *((Caso 2) hacia adelante : para calcular intereses el CAPI se reb
      *                         del SCPA, y ahora debe sumarse al SCPA))
           IF ( VEN-CALC = 'N' ) AND ( VEN-FINA > ZEROES )
               PERFORM OBT-DOC
               IF NOT VEN-STAT-OKS
                   GO TO FIN-VEN
               ELSE
               IF EVC-IDLC(VEN-IEVC) NOT > 0
                   MOVE EVC-IVCT(VEN-IEVC) TO VEN-I
                   ADD VEN-VKCC TO DLC-SCPA(VEN-I)
               ELSE
                   MOVE EVC-IDLC(VEN-IEVC) TO VEN-I
                   ADD VEN-VKCC TO DLC-SCPA(VEN-I).
       CON-FIN-VEN.
      *
      *Si pidio un vencimiento anterior las estructuras que no generan
      *el vencimiento pedido deben ser proyectadas nuevamente, para
      *que la fecha de proximo vencimiento quede siempre adelantada
           IF VEN-IVAS-ANT
               PERFORM RST-FPVC.
      *
       FIN-FIN-VEN.
           MOVE RCV-IRCV IN RCV-VRBL TO RCV-KEY-IRCV IN RCV.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           MOVE ICG-IICG IN ICG-VRBL TO ICG-KEY-IICG IN ICG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ICG.
       EXT-FIN-VEN.
           EXIT.

       OBT-EVC SECTION.
       INI-OBT-EVC.
      *Pone en 0 indice de estructuras concurrentes
           MOVE 0 TO VEN-IVCC.
      *Lee estructuras de vencimiento
           MOVE 0 TO VEN-IEVC.
           MOVE VEN-CIC-IOPC IN VEN TO EVC-CIC-IOPC IN EVC.
           MOVE 1                   TO EVC-NUM-IEVC IN EVC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-EVC.
           IF NOT ( FIO-STAT-OKS AND
                    EVC-CIC-IOPC IN EVC = OPC-CIC-IOPC IN OPC )
               MOVE VEN-SEFL TO VEN-STAT
               GO TO FIN-OBT-EVC.
       LOOP-OBT-EVC.
      *Si pidio un vencimiento anterior y no ha cancelado ningun vencimi
      *de la estructura y el vencimiento actual no pertenece a dicha est
      * o bien si
      *Se pidio un vencimiento siguiente y los vencimientos de la estruc
      *estan todos cancelados entonces
      *la estructura NO se considera
           IF ( VEN-IVAS-ANT AND EVC-NUM-VCAN IN EVC = 0 AND
                EVC-NUM-IEVC IN EVC NOT = VEN-NUM-IEVC IN VEN ) OR
              ( VEN-IVAS-SIG AND
                EVC-NUM-VIGU IN EVC = EVC-NUM-VCAN IN EVC )
               GO TO NXT-OBT-EVC.
      *
      *Suma el contador de estructuras y valida contra el limte
           ADD 1 TO VEN-IEVC.
           IF VEN-IEVC > 10
               MOVE VEN-SEML TO VEN-STAT
               GO TO FIN-OBT-EVC.
      *
      *Guarda los valores de la estructura en EVC-VARI
           MOVE EVC-NUM-IEVC IN EVC TO EVC-IEVC(VEN-IEVC).
      *
      *     marca la estructura que genero el vencimiento actual (grabad
      *     IF EVC-NUM-IEVC IN EVC = VEN-NUM-IEVC IN VEN
      *         MOVE VEN-IEVC TO VEN-EAUX.
      *    marca mas abajo considerando que puede haber sido generado
      *    por varias estructuras
      *
           MOVE EVC-NUM-IVCT IN EVC TO EVC-IVCT(VEN-IEVC).
           MOVE EVC-NUM-VIGU IN EVC TO EVC-VIGU(VEN-IEVC).
           MOVE EVC-NUM-VCAN IN EVC TO EVC-VCAN(VEN-IEVC).
           MOVE EVC-NUM-SEVE IN EVC TO EVC-SEVE(VEN-IEVC).
           MOVE EVC-IND-UTSV IN EVC TO EVC-UTSV(VEN-IEVC).
           MOVE EVC-NUM-DPVC IN EVC TO EVC-DPVC(VEN-IEVC).
           MOVE EVC-NUM-MPVC IN EVC TO EVC-MPVC(VEN-IEVC).
           MOVE EVC-NUM-SPVC IN EVC TO EVC-SPVC(VEN-IEVC).
           MOVE EVC-NUM-APVC IN EVC TO EVC-APVC(VEN-IEVC).
      *
      *La fecha de proximo vencimiento no considera analisis de feriado,
      *por lo tanto ahora calcula EVC-FFVC
           MOVE EVC-DPVC(VEN-IEVC) TO FEC-ITM1.
           MOVE EVC-MPVC(VEN-IEVC) TO FEC-ITM2.
           MOVE EVC-SPVC(VEN-IEVC) TO FEC-ITM3.
           MOVE EVC-APVC(VEN-IEVC) TO FEC-ITM4.
           IF OPC-IND-AFER IN OPC = 'N'
               MOVE EVC-FPVC(VEN-IEVC) TO EVC-FFVC(VEN-IEVC)
               GO TO CON-OBT-EVC.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-FER
               MOVE FEC-SIG-HBL  TO FEC-CMND
               MOVE FEC-FORM-FEC TO FEC-FORM
      *       PERFORM PRO-FEC.
              PERFORM CAL-FEC.
           MOVE FEC-ITM1 TO EVC-DFVC(VEN-IEVC).
           MOVE FEC-ITM2 TO EVC-MFVC(VEN-IEVC).
           MOVE FEC-ITM3 TO EVC-SFVC(VEN-IEVC).
           MOVE FEC-ITM4 TO EVC-AFVC(VEN-IEVC).
       CON-OBT-EVC.
      *Carga las estructuras que dieron origen al vencimiento
           IF EVC-FFVC(VEN-IEVC) = VEN-FVEN
               ADD 1 TO VEN-IVCC
               IF VEN-IVCC NOT > VEN-LVCC
                   MOVE VEN-IEVC TO VEN-VVCC(VEN-IVCC)
                   IF VEN-IVCC = 1
                       MOVE VEN-IEVC TO VEN-EAUX
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'VEN    CCOVF' TO VEN-STAT
                   GO TO EXT-OBT-EVC.
      *
           MOVE EVC-NUM-DESD IN EVC TO EVC-DESD(VEN-IEVC).
           MOVE EVC-VAL-VENC IN EVC TO EVC-VENC(VEN-IEVC).
           MOVE EVC-IND-CAUT IN EVC TO EVC-CAUT(VEN-IEVC).
           MOVE EVC-VAL-VCVF IN EVC TO EVC-VCVF(VEN-IEVC).
      *
      *Busca CIC en tabla asociado a Codigo=EVC-MSC-TCVE IN EVC
           MOVE 'COL'       TO FIO-SIST.
           MOVE FIO-GET-KEY TO FIO-CMND.
           MOVE 'CVC'               TO TAB-COD-TTAB IN TAB.
           MOVE EVC-MSC-TCVE IN EVC TO TAB-COD-CTAB IN TAB.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'CICCVC NEX' TO VEN-STAT
               GO TO FIN-OBT-EVC.
           MOVE TAB-CIC-CTAB IN TAB TO EVC-TCVE(VEN-IEVC).
           IF EVC-TCVE(VEN-IEVC) = 'IF'
               IF ( AYF-ITCV = 'FI' ) OR ( AYF-ITCV NOT > SPACES )
                   MOVE 'FI' TO AYF-ITCV
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE EVC-TCVE(VEN-IEVC) TO AYF-ITCV.
      *
           MOVE EVC-NUM-DPVE IN EVC TO EVC-DPVE(VEN-IEVC).
           MOVE EVC-NUM-IDLC IN EVC TO EVC-IDLC(VEN-IEVC).
      *
      *INI Obtener Juliano para Fecha FINAL de Vencimiento
           MOVE EVC-DFVC(VEN-IEVC) TO FEC-ITM1.
           MOVE EVC-MFVC(VEN-IEVC) TO FEC-ITM2.
           MOVE EVC-SFVC(VEN-IEVC) TO FEC-ITM3.
           MOVE EVC-AFVC(VEN-IEVC) TO FEC-ITM4.
           MOVE FEC-FORM-FEC       TO FEC-FORM.
           MOVE FEC-RET-JUL        TO FEC-CMND.
      *    PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE VEN-SEFL TO VEN-STAT
               GO TO FIN-OBT-EVC.
           MOVE FEC-FJUL TO EVC-JPVC(VEN-IEVC).
      *FIN Obtener Juliano para Fecha FINAL de Vencimiento
      *
       NXT-OBT-EVC.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-EVC.
           IF FIO-STAT-OKS AND EVC-CIC-IOPC IN EVC = OPC-CIC-IOPC IN OPC
               GO TO LOOP-OBT-EVC.
       FIN-OBT-EVC.
      *Redundante preguntar por los dos
           IF VEN-IEVC = 0 OR VEN-IVCC = 0
               MOVE VEN-SEFL TO VEN-STAT
           ELSE
               MOVE VEN-IEVC TO VEN-EMAX
               MOVE VEN-IVCC TO VEN-MVCC.
       EXT-OBT-EVC.
           EXIT.

      * ANT-EVC SECTION.
      * INI-ANT-EVC.
      *     MOVE 1 TO VEN-IEVC.
      * LOOP-ANT-EVC.
      *     IF EVC-IVCT(VEN-IEVC) > EVC-IVCT(VEN-EAUX)
      *         PERFORM DEC-STR
      *         ADD 1 TO EVC-VCAN(VEN-IEVC) , VEN-VCAN.
      *     ADD 1 TO VEN-IEVC.
      *     IF VEN-IEVC NOT > VEN-EMAX
      *         GO TO LOOP-ANT-EVC.
      * FIN-ANT-EVC.
      *     EXIT.

       ANT-EVC SECTION.
       INI-ANT-EVC.
           MOVE 1 TO VEN-IEVC.
       LU1-ANT-EVC.
           IF EVC-VIGU(VEN-IEVC) = EVC-VCAN(VEN-IEVC)
               GO TO NXT-ANT-EVC.
           MOVE 1 TO VEN-IVCC.
      *
       LU2-ANT-EVC.
           IF VEN-VVCC(VEN-IVCC) = VEN-IEVC
               GO TO NXT-ANT-EVC.
           ADD 1 TO VEN-IVCC.
           IF VEN-IVCC NOT > VEN-MVCC
               GO TO LU2-ANT-EVC.
      *
           PERFORM OBT-FYJ.
       NXT-ANT-EVC.
           ADD 1 TO VEN-IEVC.
           IF VEN-IEVC NOT > VEN-EMAX
               GO TO LU1-ANT-EVC.
       FIN-ANT-EVC.
           EXIT.

       INC-VEN SECTION.
       INI-INC-VEN.
      *Incrementa estructura nro. VEN-IEVC ( variando segun VEN-VVCC() )
           PERFORM INC-STR.
      *Obtiene la estructura siguiente a vencer ( el minimo juliano )
           PERFORM MIN-STR.
           IF NOT VEN-STAT-OKS
               GO TO FIN-INC-VEN.
      *Realiza un LUP para todos los vencimientos concurrentes guardados
      *en el vector VEN-VVCC usando la variable VEN-IEVC ( toma primero
      *la estructura que tiene FO si existe ).
           MOVE 0 TO VEN-VKCC VEN-SKCC.
           MOVE 0 TO VEN-VFCC VEN-SFCC.
           MOVE 'S' TO AYF-CALCULAR-INTERES.
           MOVE 'S' TO AYF-SZRO.

           IF VEN-IXFO > 1
               MOVE VEN-IXFO TO VEN-IVCC
               PERFORM CAL-VVCC
               IF NOT VEN-STAT-OKS
                   GO TO FIN-INC-VEN
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE 0 TO VEN-IXFO.

           MOVE 1 TO VEN-IVCC.
       LUP-INC-VEN.
           PERFORM CAL-VVCC.
           IF NOT VEN-STAT-OKS
               GO TO FIN-INC-VEN.
           ADD 1 TO VEN-IVCC.
           IF VEN-IVCC = VEN-IXFO
               ADD 1 TO VEN-IVCC.
           IF VEN-IVCC NOT > VEN-MVCC
               GO TO LUP-INC-VEN.
      *Revisa si todos los SCPA estan en 0, eso significa que el
      *credito se pago antes de esta cuota por lo tanto implica STAT=EOF
           IF AYF-SZRO = 'S'
               MOVE VEN-SEOF TO VEN-STAT
               GO TO FIN-INC-VEN.
      *Mueve los valores acumulados para los vencimientos concurrentes
      *a los valores de resultado
           MOVE VEN-VKCC TO VEN-CAPI.
           MOVE VEN-SKCC TO VEN-SCAP.
           MOVE VEN-VFCC TO VEN-FINA.
           MOVE VEN-SFCC TO VEN-SFIN.
      *
      *Actualiza el Juliano de la amortizacion del Documento Y
      *Mueve la fecha del vencimiento a la fecha de amortizacion del
      *documento ( Recordar que existen por cada 'vencimiento' dos fecha
      *la FFVC que es la fecha del vencimiento sin analisis de feriado y
      *la FPVC que es la fecha del vencimiento mas analisis de feriado )
           MOVE 1 TO VEN-IVCC.
       AMT-INC-VEN.
           MOVE VEN-VVCC(VEN-IVCC) TO VEN-IEVC.
           IF EVC-TCVE(VEN-IEVC) = 'IO' OR 'CO' OR 'FO' OR 'CE'
                                    OR 'FP'
               IF EVC-IDLC(VEN-IEVC) = 0
                   MOVE EVC-IVCT(VEN-IEVC) TO VEN-IDLC
                   MOVE AYF-JAMT TO DLC-JAMT(VEN-IDLC)
                   MOVE EVC-DFVC(VEN-IEVC) TO DLC-DAMT(VEN-IDLC)
                   MOVE EVC-MFVC(VEN-IEVC) TO DLC-MAMT(VEN-IDLC)
                   MOVE EVC-SFVC(VEN-IEVC) TO DLC-SAMT(VEN-IDLC)
                   MOVE EVC-AFVC(VEN-IEVC) TO DLC-AAMT(VEN-IDLC)
               ELSE
                   MOVE EVC-IDLC(VEN-IEVC) TO VEN-IDLC
                   MOVE AYF-JAMT TO DLC-JAMT(VEN-IDLC)
                   MOVE EVC-DFVC(VEN-IEVC) TO DLC-DAMT(VEN-IDLC)
                   MOVE EVC-MFVC(VEN-IEVC) TO DLC-MAMT(VEN-IDLC)
                   MOVE EVC-SFVC(VEN-IEVC) TO DLC-SAMT(VEN-IDLC)
                   MOVE EVC-AFVC(VEN-IEVC) TO DLC-AAMT(VEN-IDLC).
           ADD 1 TO VEN-IVCC.
           IF VEN-IVCC NOT > VEN-MVCC
               GO TO AMT-INC-VEN.
      *
           MOVE VEN-VVCC(1) TO VEN-IEVC.
       FIN-INC-VEN.
           EXIT.

       CAL-VVCC SECTION.
       INI-CAL-VVCC.
           MOVE VEN-VVCC(VEN-IVCC) TO VEN-IEVC.
      *Obtiene documento legal credito y calcula juliano para fec.amorti
           PERFORM OBT-DOC.
      *Obtiene el VEN con numero de vencimiento EVC-IVCT(VEN-IEVC)
           PERFORM OBT-AYF.
           IF NOT VEN-STAT-OKS
               GO TO FIN-CAL-VVCC.
      *Suma el valor del capital del vencimiento al valor ya amortizado
           IF AYF-TCVE = 'IO' OR 'CO' OR 'FO' OR 'CE' OR 'FP'
               ADD VEN-CAPI TO AYF-SCYA.
           IF AYF-IULT-YES AND CIC-OPEC = 'B'
               SUBTRACT VEN-CAPI FROM VEN-FINA
               MOVE VEN-FINA TO VEN-SFIN.
      *Acumula los valores de resultado en los valores para vencimientos
      *concurrentes
           ADD VEN-CAPI TO VEN-VKCC.
           ADD VEN-SCAP TO VEN-SKCC.
           ADD VEN-FINA TO VEN-VFCC.
           ADD VEN-SFIN TO VEN-SFCC.
       FIN-CAL-VVCC.
           EXIT.

       DEC-VEN SECTION.
       INI-DEC-VEN.
           PERFORM DEC-STR.
           PERFORM MAX-STR.
       FIN-DEC-VEN.
           EXIT.

       SIG-CAN SECTION.
       INI-SIG-CAN.
           MOVE SPACES TO VEN-SCTB VEN-SCBZ.
           PERFORM SIG-ANT-CAN-FST.
       LUP-SIG-CAN.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = RCV-CIC-IOPV IN RCV AND
                    VEN-NUM-IVEN IN VEN = RCV-NUM-IVCT IN RCV )
               GO TO FIN-SIG-CAN.
           SUBTRACT RCV-SGV-CAPI IN RCV FROM VEN-SCAP.
           MOVE     RCV-SGV-INTE IN RCV TO   VEN-IDNI.
           SUBTRACT RCV-SGV-FINA IN RCV FROM VEN-SFIN.
           PERFORM SIG-ANT-CAN-NXT.
           GO TO LUP-SIG-CAN.
       FIN-SIG-CAN.
           EXIT.

       ANT-CAN SECTION.
       INI-ANT-CAN.
           MOVE SPACES TO VEN-SCTB VEN-SCBZ.
           MOVE ZEROES TO VEN-CAPI VEN-SCAP
                          VEN-FINA VEN-SFIN VEN-VKCC.
           PERFORM SIG-ANT-CAN-FST.
       LUP-ANT-CAN.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = RCV-CIC-IOPV IN RCV AND
                    VEN-NUM-IVEN IN VEN = RCV-NUM-IVCT IN RCV )
               GO TO FIN-ANT-CAN.
           IF RCV-SGV-CAPI IN RCV < ZEROES OR
              RCV-SGV-FINA IN RCV < ZEROES OR
              RCV-MSC-STAT IN RCV = 'R'
               GO TO NXT-ANT-CAN.
      *Usa VEN-VKCC solo como auxiliar, para usarlo en actualizacion de
           ADD RCV-SGV-CAPI IN RCV TO VEN-VKCC.
           IF RCV-MSC-STAT IN RCV = 'F'
               ADD RCV-SGV-CAPI IN RCV TO VEN-CAPI
               MOVE 'N'                TO VEN-CALC
           ELSE
           IF RCV-MSC-STAT IN RCV = 'C'
               ADD RCV-SGV-FINA IN RCV TO VEN-FINA
               MOVE 'N'                TO VEN-CALC
           ELSE
               ADD RCV-SGV-CAPI IN RCV TO VEN-CAPI
               ADD RCV-SGV-FINA IN RCV TO VEN-FINA
               MOVE SPACES             TO VEN-CALC.
           MOVE RCV-SGV-INTE IN RCV TO VEN-IDNI.
       NXT-ANT-CAN.
           PERFORM SIG-ANT-CAN-NXT.
           GO TO LUP-ANT-CAN.
       FIN-ANT-CAN.
           EXIT.

       SIG-ANT-CAN-FST SECTION.
       INI-SIG-ANT-CAN-FST.
      *Busca primera cancelacion para VEN
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           MOVE OPC-CIC-IOPC IN OPC TO RCV-CIC-IOPV IN RCV.
           MOVE VEN-NUM-IVEN IN VEN TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
       FIN-SIG-ANT-CAN-FST.
           EXIT.

       SIG-ANT-CAN-NXT SECTION.
       INI-SIG-ANT-CAN-NXT.
           MOVE RCV-IND-SCTB IN RCV TO VEN-SCTB.
           MOVE RCV-IND-SCBZ IN RCV TO VEN-SCBZ.
      *Busca siguiente cancelacion para VEN
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-RCV.
       FIN-SIG-ANT-CAN-NXT.
           EXIT.

       RST-FPVC SECTION.
       INI-RST-FPVC.
           MOVE 1 TO VEN-I.
       LU1-RST-FPVC.
           IF EVC-VCAN(VEN-I) NOT > 0
               GO TO NXT-RST-FPVC.
           IF EVC-VIGU(VEN-I) = EVC-VCAN(VEN-I)
               GO TO NXT-RST-FPVC.
           MOVE 1 TO VEN-IVCC.
      *
       LU2-RST-FPVC.
           IF VEN-VVCC(VEN-IVCC) = VEN-I
               GO TO NXT-RST-FPVC.
           ADD 1 TO VEN-IVCC.
           IF VEN-IVCC NOT > VEN-MVCC
               GO TO LU2-RST-FPVC.
      *Respalda VEN-IEVC
           MOVE VEN-IEVC TO VEN-AUXI.
      *Carga VEN-IEVC y VEN-IVAS ( antes de llamar a OBT-FYJ )
           MOVE VEN-I TO VEN-IEVC.
           MOVE 'S'   TO VEN-IVAS.
           PERFORM OBT-FYJ.
      *Restaura VEN-IEVC y VEN-IVAS
           MOVE VEN-AUXI TO VEN-IEVC.
           MOVE 'A' TO VEN-IVAS.
       NXT-RST-FPVC.
           ADD 1 TO VEN-I.
           IF VEN-I NOT > VEN-EMAX
               GO TO LU1-RST-FPVC.
       FIN-RST-FPVC.
           EXIT.

       INC-STR SECTION.
       INI-INC-STR.
           ADD 1 TO VEN-VCAN.
           MOVE 1 TO VEN-IVCC.
       LUP-INC-STR.
           MOVE VEN-VVCC(VEN-IVCC) TO VEN-IEVC.
      *Va a incrementar estructura: suma 1 al numero de vencimientos
      *cancelados, si no quedan todos cancelados llama a OBT-FYJ
           ADD 1 TO EVC-VCAN(VEN-IEVC).
           IF EVC-VIGU(VEN-IEVC) NOT = EVC-VCAN(VEN-IEVC)
               PERFORM OBT-FYJ.
           ADD 1 TO VEN-IVCC.
           IF VEN-IVCC NOT > VEN-MVCC
               GO TO LUP-INC-STR.
       FIN-INC-STR.
           EXIT.

       MIN-STR SECTION.
       INI-MIN-STR.
           MOVE 0          TO VEN-EAUX.
           MOVE 0          TO VEN-IVCC.
           MOVE 0          TO VEN-IXFO.
           MOVE 0          TO VEN-NEVF VEN-NEVK.
           MOVE 1          TO VEN-IEVC.
           MOVE '99999999' TO VEN-FMIN.
       LOOP-MIN-STR.
      *Si la estructura esta toda cancelada no la considera, esto es
      *porque al ir proyectando existen estructuras que se van terminand
           IF EVC-VIGU(VEN-IEVC) = EVC-VCAN(VEN-IEVC)
               GO TO NXT-MIN-STR.

           IF ( EVC-FFVC(VEN-IEVC) < VEN-FMIN OR
                EVC-FFVC(VEN-IEVC) = VEN-FMIN ) AND
                EVC-TCVE(VEN-IEVC) = ( 'FO' OR 'FP' ) AND
                VEN-IXFO > 0
               GO TO NXT-MIN-STR.

           IF EVC-FFVC(VEN-IEVC) < VEN-FMIN
               MOVE EVC-FFVC(VEN-IEVC) TO VEN-FMIN
               MOVE VEN-IEVC           TO VEN-EAUX
               MOVE 1 TO VEN-IVCC
               MOVE VEN-IEVC TO VEN-VVCC(VEN-IVCC)
               MOVE 0        TO VEN-NEVF VEN-NEVK
               PERFORM ANL-TCV
               IF EVC-TCVE(VEN-IEVC) = ( 'FO' OR 'FP' )
                   MOVE VEN-IVCC TO VEN-IXFO
               ELSE
                   MOVE 0 TO VEN-IXFO
           ELSE
           IF EVC-FFVC(VEN-IEVC) = VEN-FMIN
               ADD 1 TO VEN-IVCC
               IF VEN-IVCC NOT > VEN-LVCC
                   MOVE VEN-IEVC TO VEN-VVCC(VEN-IVCC)
                   PERFORM ANL-TCV
                   IF EVC-TCVE(VEN-IEVC) = ( 'FO' OR 'FP' )
                       MOVE VEN-IVCC TO VEN-IXFO
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'VEN    CCOVF' TO VEN-STAT
                   GO TO EXT-MIN-STR.

       NXT-MIN-STR.
           ADD 1 TO VEN-IEVC.
           IF VEN-IEVC NOT > VEN-EMAX
               GO TO LOOP-MIN-STR.
       FIN-MIN-STR.
      *Carga variable con el total de los vencimientos concurrentes
           MOVE VEN-IVCC TO VEN-MVCC.
      *
      *Pregunta si no encontro minima estructura ( todas canceladas ) mu
      *status SENO
      *en caso contrario
      *carga el VEN-IEVC con el numero de la estructura minima y
      *se suma 1 a los cancelados de la operacion para obtener el siguie
      *numero de vencimiento que se carga en la estructura que correspon
           IF VEN-EAUX = 0
               MOVE VEN-SENO TO VEN-STAT
               GO TO EXT-MIN-STR.
      *Suma 1 al numero de vencimiento
           ADD 1 TO VEN-NVEN.
      *Recorre todos los vencimientos concurrentes
           MOVE 1 TO VEN-IVCC.
       CAN-MIN-STR.
           MOVE VEN-VVCC(VEN-IVCC) TO VEN-IEVC.
      *JSS 7-APR-1991 18:02:34
      *    ADD 1 VEN-VCAN GIVING EVC-IVCT(VEN-IEVC).
           MOVE VEN-NVEN TO EVC-IVCT(VEN-IEVC).
           ADD 1 TO VEN-IVCC.
           IF VEN-IVCC NOT > VEN-MVCC
               GO TO CAN-MIN-STR.
      *
           MOVE VEN-EAUX TO VEN-IEVC.
       EXT-MIN-STR.
           EXIT.

       ANL-TCV SECTION.
       INI-ANL-TCV.
           IF EVC-BCCR(VEN-IEVC) = 'F' OR EVC-VICR(VEN-IEVC) = 'F'
               ADD 1 TO VEN-NEVF
           ELSE
               ADD 1 TO VEN-NEVK.
       FIN-ANL-TCV.
           EXIT.

       DEC-STR SECTION.
       INI-DEC-STR.
           SUBTRACT 1 FROM VEN-VCAN.
           MOVE 1 TO VEN-IVCC.
       LUP-DEC-STR.
           MOVE VEN-VVCC(VEN-IVCC) TO VEN-IEVC.
      *     SUBTRACT 1 FROM EVC-VCAN(VEN-IEVC).
      *     IF EVC-VCAN(VEN-IEVC) NOT < 0
           IF EVC-VCAN(VEN-IEVC) > 0
               PERFORM OBT-FYJ.
           ADD 1 TO VEN-IVCC.
           IF VEN-IVCC NOT > VEN-MVCC
               GO TO LUP-DEC-STR.
       FIN-DEC-STR.
           EXIT.

       MAX-STR SECTION.
       INI-MAX-STR.
           MOVE 0 TO VEN-EAUX.
           MOVE 0 TO VEN-IVCC.
           MOVE 0 TO VEN-IXFO.
           MOVE 0 TO VEN-NEVF VEN-NEVK.
           MOVE 1 TO VEN-IEVC.
           MOVE 0 TO VEN-FMAX.
       LOOP-MAX-STR.
           IF EVC-VCAN(VEN-IEVC) NOT > 0
               GO TO NXT-MAX-STR.

           IF ( EVC-FFVC(VEN-IEVC) > VEN-FMAX OR
                EVC-FFVC(VEN-IEVC) = VEN-FMAX ) AND
                EVC-TCVE(VEN-IEVC) = ( 'FO' OR 'FP' ) AND
                VEN-IXFO > 0
               GO TO NXT-MAX-STR.

           IF EVC-FFVC(VEN-IEVC) > VEN-FMAX
               MOVE EVC-FFVC(VEN-IEVC) TO VEN-FMAX
               MOVE VEN-IEVC           TO VEN-EAUX
               MOVE 1 TO VEN-IVCC
               MOVE VEN-IEVC TO VEN-VVCC(VEN-IVCC)
               MOVE 0        TO VEN-NEVF VEN-NEVK
               PERFORM ANL-TCV
               IF EVC-TCVE(VEN-IEVC) = ( 'FO' OR 'FP' )
                   MOVE VEN-IVCC TO VEN-IXFO
               ELSE
                   MOVE 0 TO VEN-IXFO
           ELSE
           IF EVC-FFVC(VEN-IEVC) = VEN-FMAX
               ADD 1 TO VEN-IVCC
               IF VEN-IVCC NOT > VEN-LVCC
                   MOVE VEN-IEVC TO VEN-VVCC(VEN-IVCC)
                   PERFORM ANL-TCV
                   IF EVC-TCVE(VEN-IEVC) = ( 'FO' OR 'FP' )
                       MOVE VEN-IVCC TO VEN-IXFO
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'VEN    CCOVF' TO VEN-STAT
                   GO TO EXT-MAX-STR.
       NXT-MAX-STR.
           ADD 1 TO VEN-IEVC.
           IF VEN-IEVC NOT > VEN-EMAX
               GO TO LOOP-MAX-STR.
       FIN-MAX-STR.
      *Carga variable con el total de los vencimientos concurrentes
           MOVE VEN-IVCC TO VEN-MVCC.
      *
      *Pregunta si no encontro maxima estructura ( todas canceladas ) mu
      *status SENO
      *en caso contrario
      *carga el VEN-IEVC con el numero de la estructura maxima y
      *se suma 1 a los cancelados de la operacion para obtener el siguie
      *numero de vencimiento que se carga en la estructura que correspon
           IF VEN-EAUX = 0
               MOVE VEN-SENO TO VEN-STAT
               GO TO EXT-MAX-STR.
      *
      *Recorre toda las etructuras de tipo 1 y actualiza FAMT con la fec
      *de la estructura maxima
           PERFORM ACT-FAMT.
           IF NOT VEN-STAT-OKS
               GO TO EXT-MAX-STR.
      *Resta 1 al numero de vencimiento
           SUBTRACT 1 FROM VEN-NVEN.
      *Recorre todos los vencimientos concurrentes
           MOVE 1 TO VEN-IVCC.
       CAN-MAX-STR.
           MOVE VEN-VVCC(VEN-IVCC) TO VEN-IEVC.
      *JSS 7-APR-1991 18:03:17
      *    ADD 1 VEN-VCAN GIVING EVC-IVCT(VEN-IEVC).
           MOVE VEN-NVEN TO EVC-IVCT(VEN-IEVC).
      *
           SUBTRACT 1 FROM EVC-VCAN(VEN-IEVC).
      *
           ADD 1 TO VEN-IVCC.
           IF VEN-IVCC NOT > VEN-MVCC
               GO TO CAN-MAX-STR.
      *
           MOVE VEN-EAUX TO VEN-IEVC.
       EXT-MAX-STR.
           EXIT.

       ACT-FAMT SECTION.
       INI-ACT-FAMT.
      *Recorre toda las etructuras de tipo 1 y actualiza FAMT con la fec
      *de la estructura maxima
           MOVE 0 TO VEN-FMAX.
           MOVE 1 TO VEN-IEVC.
       LUP-ACT-FAMT.
           IF EVC-VCAN(VEN-IEVC) NOT > 0
               GO TO NXT-ACT-FAMT.
           IF EVC-TCVE(VEN-IEVC) = 'IC' OR 'IF' OR 'FE'
               GO TO NXT-ACT-FAMT.
           IF EVC-FFVC(VEN-IEVC) < VEN-FMAX
               GO TO NXT-ACT-FAMT.
           MOVE EVC-FFVC(VEN-IEVC) TO VEN-FMAX.
           PERFORM OBT-DOC.
           IF NOT VEN-STAT-OKS
               GO TO FIN-ACT-FAMT.
           IF EVC-IDLC(VEN-IEVC) = 0
               MOVE EVC-IVCT(VEN-IEVC) TO VEN-I
           ELSE
               MOVE EVC-IDLC(VEN-IEVC) TO VEN-I.
           MOVE EVC-DFVC(VEN-IEVC) TO DLC-DAMT(VEN-I).
           MOVE EVC-MFVC(VEN-IEVC) TO DLC-MAMT(VEN-I).
           MOVE EVC-SFVC(VEN-IEVC) TO DLC-SAMT(VEN-I).
           MOVE EVC-AFVC(VEN-IEVC) TO DLC-AAMT(VEN-I).
       NXT-ACT-FAMT.
           ADD 1 TO VEN-IEVC.
           IF VEN-IEVC NOT > VEN-EMAX
               GO TO LUP-ACT-FAMT.
       FIN-ACT-FAMT.
           EXIT.

       OBT-FYJ SECTION.
       INI-OBT-FYJ.
      *Suma o resta periodo entre vencimiento para la estructura nro. VE
      *y deja en variable EVC-FPVC(VEN-IEVC)
           IF ( EVC-UTSV(VEN-IEVC) = 'M' OR 'A' ) AND
              EVC-DPVE(VEN-IEVC) > ZEROES
               MOVE EVC-DPVE(VEN-IEVC) TO FEC-ITM1
           ELSE
               MOVE EVC-DPVC(VEN-IEVC) TO FEC-ITM1.
           MOVE EVC-MPVC(VEN-IEVC) TO FEC-ITM2.
           MOVE EVC-SPVC(VEN-IEVC) TO FEC-ITM3.
           MOVE EVC-APVC(VEN-IEVC) TO FEC-ITM4.
           IF EVC-UTSV(VEN-IEVC) = 'D'
               MOVE EVC-SEVE(VEN-IEVC) TO FEC-NDIA
               IF VEN-IVAS-SIG
                   MOVE FEC-SUM-DIA TO FEC-CMND
               ELSE
                   MOVE FEC-RST-DIA TO FEC-CMND
           ELSE
           IF EVC-UTSV(VEN-IEVC) = 'M'
               MOVE EVC-SEVE(VEN-IEVC) TO FEC-NMES
               IF VEN-IVAS-SIG
                   MOVE FEC-SUM-MES TO FEC-CMND
               ELSE
                   MOVE FEC-RST-MES TO FEC-CMND
           ELSE
      *    Asume ano
               MOVE EVC-SEVE(VEN-IEVC) TO FEC-NANO
               IF VEN-IVAS-SIG
                   MOVE FEC-SUM-ANO TO FEC-CMND
               ELSE
                   MOVE FEC-RST-ANO TO FEC-CMND.
           MOVE FEC-FORM-FEC TO FEC-FORM.
      *    PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           MOVE FEC-ITM1 TO EVC-DPVC(VEN-IEVC).
           MOVE FEC-ITM2 TO EVC-MPVC(VEN-IEVC).
           MOVE FEC-ITM3 TO EVC-SPVC(VEN-IEVC).
           MOVE FEC-ITM4 TO EVC-APVC(VEN-IEVC).
      *
      *Analiza feriado para la fecha del vencimiento
           IF OPC-IND-AFER IN OPC = 'N'
               MOVE EVC-FPVC(VEN-IEVC) TO EVC-FFVC(VEN-IEVC)
               GO TO CON-OBT-FYJ.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-FER
               MOVE FEC-SIG-HBL  TO FEC-CMND
               MOVE FEC-FORM-FEC TO FEC-FORM
      *        PERFORM PRO-FEC.
               PERFORM CAL-FEC.
           MOVE FEC-ITM1 TO EVC-DFVC(VEN-IEVC).
           MOVE FEC-ITM2 TO EVC-MFVC(VEN-IEVC).
           MOVE FEC-ITM3 TO EVC-SFVC(VEN-IEVC).
           MOVE FEC-ITM4 TO EVC-AFVC(VEN-IEVC).
       CON-OBT-FYJ.
      *
      *Calcula el juliano para la fecha del vencimiento
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-RET-JUL  TO FEC-CMND.
      *    PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           MOVE FEC-FJUL TO EVC-JPVC(VEN-IEVC).
       FIN-OBT-FYJ.
           EXIT.

       OBT-DOC SECTION.
       INI-OBT-DOC.
           IF NOT VEN-STAT-OKS
               GO TO FIN-OBT-DOC.
      *
      *Si la estructura no esta asociada a ningun documento mueve
      *el numero de la estructura para accesar el DLC en caso contrario
      *mueve el numero del documento que tiene asociado la estructura
           IF EVC-IDLC(VEN-IEVC) = 0
               MOVE EVC-IVCT(VEN-IEVC) TO VEN-IDLC
           ELSE
               MOVE EVC-IDLC(VEN-IEVC) TO VEN-IDLC.
           IF VEN-IDLC > 10
               MOVE VEN-SDML TO VEN-STAT
               GO TO FIN-OBT-DOC.
      *Carga el documento con numero VEN-IDLC
           PERFORM LOD-RDLC.
       FIN-OBT-DOC.
           EXIT.

       LOD-RDLC SECTION.
       INI-LOD-RDLC.
      *Revisa si el documento ya fue cargado anteriormente
           IF DLC-TDOC(VEN-IDLC) NOT = SPACES
               GO TO FIN-LOD-RDLC.
      *
      *Lee el documento y carga en variables DLC-VARI
           MOVE VEN-CIC-IOPC IN VEN TO DLC-CIC-IOPC IN DLC.
           MOVE VEN-IDLC            TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
               MOVE VEN-SDFL TO VEN-STAT
               GO TO FIN-LOD-RDLC.
      *Carga codigo computacional del codigo tipo de documento del DLC
           MOVE FIO-GET-KEY    TO FIO-CMND.
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'DOC'               TO TAB-COD-TTAB IN TAB.
           MOVE DLC-COD-TDOC IN DLC TO TAB-COD-CTAB IN TAB.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'CICDOC PAGNX' TO VEN-STAT
               GO TO FIN-LOD-RDLC.
           MOVE TAB-CIC-CTAB IN TAB TO DLC-TDOC(VEN-IDLC).
      *
           MOVE DLC-MSC-MIPL IN DLC TO DLC-MIPL(VEN-IDLC).
           MOVE DLC-VAL-SDLC IN DLC TO DLC-SDLC(VEN-IDLC).
           MOVE DLC-VAL-SCPA IN DLC TO DLC-SCPA(VEN-IDLC).
      *Calcula el valor de capital ya amortizado
           SUBTRACT DLC-VAL-SCPA IN DLC FROM OPC-VAL-CRED IN OPC
                    GIVING AYF-SCYA.
           MOVE DLC-VAL-SINT IN DLC TO DLC-SINT(VEN-IDLC).
           MOVE DLC-FEC-FAMT IN DLC TO DLC-FAMT(VEN-IDLC).
      *
           MOVE DLC-CAI-IOPC IN DLC TO ICG-CAI-IOPC IN ICG.
           MOVE DLC-IIC-IOPC IN DLC TO ICG-IIC-IOPC IN ICG.
           MOVE DLC-NUM-IDLC IN DLC TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES       TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES       TO ICG-NUM-IVCT IN ICG.
           MOVE 'INT'        TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES       TO ICG-FEC-FINI IN ICG.
           MOVE 'ICG-KEY-IICG ' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF FIO-STAT-OKS AND
              ICG-CAI-IOPC IN ICG = DLC-CAI-IOPC IN DLC AND
              ICG-IIC-IOPC IN ICG = DLC-IIC-IOPC IN DLC AND
              ICG-NUM-ICAN IN ICG = DLC-NUM-IDLC IN DLC AND
              ICG-CIC-IOPV IN ICG = SPACES       AND
              ICG-NUM-IVCT IN ICG = ZEROES       AND
              ICG-IND-TTAS IN ICG = 'INT'
               IF INT-CVTI NOT > SPACES
                   MOVE ICG-SGV-TINT IN ICG TO DLC-TINT(VEN-IDLC)
               ELSE
                   MOVE ICG-SGV-SPRD IN ICG TO DLC-TINT(VEN-IDLC)
           ELSE
               MOVE INT-TINT TO DLC-TINT(VEN-IDLC).
       CON-LOD-RDLC.
      *Calcula el juliano para la fecha de amortizacion
           MOVE DLC-DAMT(VEN-IDLC) TO FEC-ITM1.
           MOVE DLC-MAMT(VEN-IDLC) TO FEC-ITM2.
           MOVE DLC-SAMT(VEN-IDLC) TO FEC-ITM3.
           MOVE DLC-AAMT(VEN-IDLC) TO FEC-ITM4.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-RET-JUL  TO FEC-CMND.
      *    PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           MOVE FEC-FJUL TO DLC-JAMT(VEN-IDLC).
       FIN-LOD-RDLC.
           EXIT.

       OBT-AYF SECTION.
       INI-OBT-AYF.
           IF NOT VEN-STAT-OKS
               GO TO FIN-OBT-AYF.
      *
      *Mueve tipo de calculo de la estructura a calcular
           MOVE EVC-TCVE(VEN-IEVC) TO AYF-TCVE.
      *
      *Busca si el vencimiento que esta revisando es el ultimo por cance
      *considerando todo el documento ( es decir si esta cancelando con
      *cuota todo el documento : AYF-IULT = 'S' )
           PERFORM ULT-AYF.
      *
      *Si el tipo de calculo es sin intereses
           IF AYF-TCVE = 'IN'
               IF AYF-IULT-YES
      *        Si con el vencimiento actual se cancela todo el documento
      *        Mueve el saldo insoluto al capital total
      *        Suma el saldo insoluto, intereses devengados para obtener
      *        final ademas si el manejo de interes es prorrateado segun
      *        de cada cuota suma al valor final el saldo de los interes
                   ADD DLC-SCPA(VEN-IDLC) , DLC-SINT(VEN-IDLC) ,
                       EVC-VCVF(VEN-IEVC)   GIVING VEN-CAPI
                   MOVE VEN-CAPI TO VEN-SCAP VEN-FINA VEN-SFIN
                   MOVE 0 TO DLC-SCPA(VEN-IDLC)
                   MOVE 0 TO DLC-SINT(VEN-IDLC)
                   GO TO FIN-OBT-AYF
               ELSE
                   MOVE EVC-VCVF(VEN-IEVC) TO VEN-CAPI VEN-SCAP
                                              VEN-FINA VEN-SFIN
                   GO TO FIN-OBT-AYF.
      *
      *Si el tipo de documento asociado a la estructura no es letra
      *calcula en PAG-OBT-AYF
           IF ( DLC-TDOC(VEN-IDLC) NOT = CIC-TDOC-LTR ) AND
              ( NOT (  AYF-TCVE = 'IC' OR 'IF' OR 'FE' ) )
               GO TO PAG-OBT-AYF.
           MOVE 'N' TO AYF-SZRO.
      *
      **     IF AYF-TCVE = 'FE'
      ***Mueve Juliano de la amortizacion del documento ( es la fecha de
      ***vencimiento anterior de la estructura ) y Juliano del vencimien
      ***proyectado ahora
      **         MOVE DLC-JAMT(VEN-IDLC) TO AYF-JANT
      **         MOVE EVC-JPVC(VEN-IEVC) TO AYF-JAMT
      ***Calcula la separacion en dias entre los julianos
      **         SUBTRACT AYF-JANT FROM AYF-JAMT GIVING INT-SEPD
      ***Actualiza el Juliano anterior con el Juliano actual de amortiza
      **         MOVE AYF-JAMT TO AYF-JANT
      ***Actualiza el Juliano de la amortizacion del Documento
      **         MOVE AYF-JAMT TO DLC-JAMT(VEN-IDLC)
      **     ELSE
      *Obtiene separacion en dias ( INT-SEPD ) entre fecha de colocacion
      *y la fecha del vencimiento
           PERFORM OBT-SEDF.
           IF NOT VEN-STAT-OKS
               GO TO FIN-OBT-AYF.

           IF AYF-BCCR = 'F' OR AYF-VICR = 'F'
      *        Si tipo calculo es 'F*' mueve valor final de estructura
      *        a valor final y a saldo valor final del vencimiento
      *        y calcula valor capital
               MOVE EVC-VCVF(VEN-IEVC) TO VEN-FINA
                                          VEN-SFIN
               PERFORM CAL-CAPI
               IF AYF-IULT-YES
      *    Si con el vencimiento actual se cancela todo el documento
      *    Mueve el saldo insoluto al capital total
      *    Suma el saldo insoluto, intereses devengados para obtener val
      *    final ademas si el manejo de interes es prorrateado segun cap
      *    de cada cuota suma al valor final el saldo de los intereses
                   ADD DLC-SCPA(VEN-IDLC) , DLC-SINT(VEN-IDLC) ,
                       VEN-CAPI GIVING VEN-CAPI
                   MOVE VEN-CAPI TO VEN-SCAP
                   PERFORM CAL-FINA
                   MOVE 0 TO DLC-SCPA(VEN-IDLC)
                   MOVE 0 TO DLC-SINT(VEN-IDLC)
               ELSE
                   NEXT SENTENCE
           ELSE
      *        Si tipo calculo NO es 'F*' mueve valor capital de estruct
      *        a valor capital y a saldo valor capital del vencimiento
      *        y calcula valor final
               IF AYF-IULT-YES
                   ADD DLC-SCPA(VEN-IDLC) , DLC-SINT(VEN-IDLC) ,
                       EVC-VCVF(VEN-IEVC)   GIVING VEN-CAPI
                   MOVE VEN-CAPI TO VEN-SCAP
                   PERFORM CAL-FINA
                   MOVE 0 TO DLC-SCPA(VEN-IDLC)
                   MOVE 0 TO DLC-SINT(VEN-IDLC)
               ELSE
                   MOVE EVC-VCVF(VEN-IEVC) TO VEN-CAPI
                                              VEN-SCAP
                   PERFORM CAL-FINA.
           GO TO FIN-OBT-AYF.
       PAG-OBT-AYF.
      *
      *Mueve el Saldo Capital por Amortizar ( Saldo Insoluto )
           MOVE DLC-SCPA(VEN-IDLC) TO AYF-SCPA.
           IF AYF-SCPA > ZEROES
               MOVE 'N' TO AYF-SZRO.
      *
           IF AYF-BCCR = 'F' OR AYF-VICR = 'F'
      *mueve 0 al saldo de interes
      *Mueve saldo de intereses a intereses devengados no incluidos
      *Mueve el valor final de EVC al valor final
               MOVE 0                  TO AYF-SINT
               MOVE DLC-SINT(VEN-IDLC) TO AYF-IDNI
               MOVE EVC-VCVF(VEN-IEVC) TO AYF-FINA
           ELSE
      *mueve saldo de intereses al saldo de interes
      *Mueve 0 a intereses devengados no incluidos
      *Mueve el valor capital de EVC al valor capital
               MOVE DLC-SINT(VEN-IDLC) TO AYF-SINT
               MOVE 0                  TO AYF-IDNI
               MOVE EVC-VCVF(VEN-IEVC) TO AYF-CAPI.
      *
      *Mueve Juliano de la amortizacion del documento ( es la fecha del
      *vencimiento anterior de la estructura ) y Juliano del vencimiento
      *proyectado ahora
           MOVE DLC-JAMT(VEN-IDLC) TO AYF-JANT.
           MOVE EVC-JPVC(VEN-IEVC) TO AYF-JAMT.
      *
      *Busca si el vencimiento que esta revisando es el ultimo por cance
      *considerando todo el documento ( es decir si esta cancelando con
      *cuota todo el documento : AYF-IULT = 'S' )
      *     PERFORM ULT-AYF.
      *
      *Obtiene valor final, valor capital, saldo insoluto, actualiza sal
      *interes
           PERFORM CAL-AYF.
           IF NOT VEN-STAT-OKS
               GO TO FIN-OBT-AYF.
      *     MOVE EVC-DPVC(VEN-IEVC) TO DLC-DAMT(VEN-IDLC).
      *     MOVE EVC-MPVC(VEN-IEVC) TO DLC-MAMT(VEN-IDLC).
      *     MOVE EVC-SPVC(VEN-IEVC) TO DLC-SAMT(VEN-IDLC).
      *     MOVE EVC-APVC(VEN-IEVC) TO DLC-AAMT(VEN-IDLC).
      *Mueve la fecha del vencimiento a la fecha de amortizacion del
      *documento ( Recordar que existen por cada 'vencimiento' dos fecha
      *la FFVC que es la fecha del vencimiento sin analisis de feriado y
      *la FPVC que es la fecha del vencimiento mas analisis de feriado )
      *     MOVE EVC-DFVC(VEN-IEVC) TO DLC-DAMT(VEN-IDLC).
      *     MOVE EVC-MFVC(VEN-IEVC) TO DLC-MAMT(VEN-IDLC).
      *     MOVE EVC-SFVC(VEN-IEVC) TO DLC-SAMT(VEN-IDLC).
      *     MOVE EVC-AFVC(VEN-IEVC) TO DLC-AAMT(VEN-IDLC).
      *Mueve el saldo insoluto al documento
           MOVE AYF-SCPA TO DLC-SCPA(VEN-IDLC).
      *
           IF VEN-CALC = 'N'
      *JSS-INI 20-JUN-1997
               AND VEN-KEST NOT = 'S'
      *JSS-FIN 20-JUN-1997
               GO TO CON-OBT-AYF.
      *
           IF AYF-BCCR = 'F' OR AYF-VICR = 'F'
      *        Si tipo de calculo es 'F*' mueve al saldo de interes del
      *        el valor de los intereses
               IF AYF-CALCULAR-INTERES-SI
                   MOVE AYF-IDNI TO DLC-SINT(VEN-IDLC)
               ELSE
                   NEXT SENTENCE
           ELSE
      *        Si tipo de calculo NO es 'F*' mueve al saldo de interes d
      *        documento el valor del saldo de interes
               MOVE AYF-SINT TO DLC-SINT(VEN-IDLC).
           IF AYF-CALCULAR-INTERES-SI
               MOVE 'N' TO AYF-CALCULAR-INTERES.
      *
      *Actualiza el Juliano de la amortizacion del Documento
      *Al haber vencimientos concurrentes debe hacerlo al final
      *     MOVE AYF-JAMT TO DLC-JAMT(VEN-IDLC).
      *
      *Mueve el valor capital al valor capital del vencimiento y al sald
      *valor capital del vencimiento,
      *mueve el saldo de los intereses al valor de los interes no inclui
      *del vencimiento, y
      *mueve el valor final al valor final del vencimiento y al saldo de
      *valor final del vencimiento
       CON-OBT-AYF.
           MOVE AYF-CAPI TO VEN-CAPI , VEN-SCAP.
           MOVE DLC-SINT(VEN-IDLC) TO VEN-IDNI.
           MOVE AYF-FINA TO VEN-FINA , VEN-SFIN.
       FIN-OBT-AYF.
           EXIT.

       OBT-SEDF SECTION.
       INI-OBT-SEDF.
      *Diferencia en dias entre OPC-FEC-FCOL y EVC-FFVC(VEN-IEVC)
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.
           MOVE EVC-DFVC(VEN-IEVC)  TO FEC-DEC2.
           MOVE EVC-MFVC(VEN-IEVC)  TO FEC-MEC2.
           MOVE EVC-SFVC(VEN-IEVC)  TO FEC-SEC2.
           MOVE EVC-AFVC(VEN-IEVC)  TO FEC-AEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
      *    PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE 'FCOLPVDFDIA' TO VEN-STAT
               GO TO FIN-OBT-SEDF.
           MOVE FEC-NDIA TO INT-SEPD.
       FIN-OBT-SEDF.
           EXIT.

       CAL-CAPI SECTION.
       INI-CAL-CAPI.
      *Carga parametros para calculo de interes
           PERFORM BUS-PINT.
           PERFORM OBT-VTIN.
           IF INT-CMSG NOT > SPACES
      *Calcula valor capital = valor final / ( 1 + TIPE )
               ADD 1 TO INT-TIPE
               DIVIDE VEN-FINA BY INT-TIPE GIVING VEN-CAPI ROUNDED
               SUBTRACT 1 FROM INT-TIPE
               IF OPC-COD-VCOC IN OPC = CIC-VLR-MNAC
                   MOVE VEN-CAPI TO PES-SGV-DECI
                   PERFORM PES-SCTV
                   MOVE PES-SGV-ENTE TO VEN-CAPI
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE INT-CMSG TO VEN-STAT
               MOVE INT-MEN2 TO VEN-MEN2
               GO TO FIN-CAL-CAPI.
           MOVE VEN-CAPI TO VEN-SCAP.
       FIN-CAL-CAPI.
           EXIT.

       CAL-FINA SECTION.
       INI-CAL-FINA.
      *Carga parametros para calculo de interes
           PERFORM BUS-PINT.
           PERFORM OBT-VTIN.
           IF INT-CMSG NOT > SPACES
      *Calcula valor final = valor capital * ( 1 + TIPE )
               ADD 1 TO INT-TIPE
               MULTIPLY VEN-CAPI BY INT-TIPE GIVING VEN-FINA ROUNDED
               SUBTRACT 1 FROM INT-TIPE
               IF OPC-COD-VCOC IN OPC = CIC-VLR-MNAC
                   MOVE VEN-FINA TO PES-SGV-DECI
                   PERFORM PES-SCTV
                   MOVE PES-SGV-ENTE TO VEN-FINA
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE INT-CMSG TO VEN-STAT
               MOVE INT-MEN2 TO VEN-MEN2
               GO TO FIN-CAL-FINA.
           MOVE VEN-FINA TO VEN-SFIN.
       FIN-CAL-FINA.
           EXIT.

       ULT-AYF SECTION.
       INI-ULT-AYF.
      *Suma 1 a los cancelados de la estructura para efectos de la pregu
           MOVE VEN-IEVC TO VEN-EAUX.
      *
           MOVE 1 TO VEN-I.
       LU1-ULT-AYF.
           MOVE VEN-VVCC(VEN-I) TO VEN-IEVC.
           ADD 1 TO EVC-VCAN(VEN-IEVC).
           ADD 1 TO VEN-I.
           IF VEN-I NOT > VEN-MVCC
               GO TO LU1-ULT-AYF.
      *
           MOVE 1 TO VEN-IEVC.
           MOVE 'S' TO AYF-IULT.
       LOOP-ULT-AYF.
           IF EVC-IDLC(VEN-IEVC) = VEN-IDLC AND
              EVC-VCAN(VEN-IEVC) < EVC-VIGU(VEN-IEVC)
               MOVE 'N' TO AYF-IULT
           ELSE
               ADD 1 TO VEN-IEVC
               IF VEN-IEVC NOT > VEN-EMAX
                   GO TO LOOP-ULT-AYF.
       FIN-ULT-AYF.
      *
           MOVE 1 TO VEN-I.
       LU2-ULT-AYF.
           MOVE VEN-VVCC(VEN-I) TO VEN-IEVC.
           SUBTRACT 1 FROM EVC-VCAN(VEN-IEVC).
           ADD 1 TO VEN-I.
           IF VEN-I NOT > VEN-MVCC
               GO TO LU2-ULT-AYF.
      *
           MOVE VEN-EAUX TO VEN-IEVC.
       EXT-ULT-AYF.
           EXIT.

       CAL-AYF SECTION.
       INI-CAL-AYF.
      *Calcula la separacion en dias entre los julianos
           SUBTRACT AYF-JANT FROM AYF-JAMT GIVING INT-SEPD.
      *Carga parametros para obtener tasa de interes del periodo
           PERFORM BUS-PINT.
      *Actualiza el Juliano anterior con el Juliano actual de amortizaci
           MOVE AYF-JAMT TO AYF-JANT.
      *Obtiene tasa de interes del periodo TIPE
           IF ( INT-CVTI > SPACES AND VEN-FTBS > ZEROES )
               MOVE VEN-DTBS TO INT-DBTV
               MOVE VEN-MTBS TO INT-MBTV
               MOVE VEN-STBS TO INT-SBTV
               MOVE VEN-ATBS TO INT-ABTV.
      *    PERFORM OBT-VTIN.
      *SMC-INI 07.09.1993
      *    PERFORM GNS-CAL-INT.
           PERFORM COL-CAL-INT.
      *SMC-FIN 07.09.1993
           IF INT-CMSG > SPACES
               MOVE INT-CMSG TO VEN-STAT
               MOVE INT-MEN2 TO VEN-MEN2
               GO TO FIN-CAL-AYF.
           IF INT-IETB > SPACES
               MOVE 'N' TO VEN-CALC.
      *
           ADD 1 TO INT-TIPE.
      *Calcula intereses devengados no incluidos
           IF AYF-CALCULAR-INTERES-SI
               COMPUTE AYF-IDNI ROUNDED =
                      ( AYF-SCPA + AYF-SINT ) * ( INT-TIPE - 1 ) +
                                       AYF-IDNI * INT-TIPE
      *Si la moneda del credito es nacional, redondea sin centavos
               IF OPC-COD-VCOC IN OPC = CIC-VLR-MNAC
                   MOVE AYF-IDNI TO PES-SGV-DECI
                   PERFORM PES-SCTV
                   MOVE PES-SGV-ENTE TO AYF-IDNI
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE 0 TO AYF-IDNI.
      *
           IF AYF-IULT-YES
      *        Si con el vencimiento actual se cancela todo el documento
      *        llama a parrafo CAL-AYF-ULT
               PERFORM CAL-AYF-ULT
           ELSE
           IF AYF-BCCR = 'F' OR AYF-VICR = 'F'
      *        Si tipo de calculo es 'F*'
      *        Si la tasa es estimada entonces el valor final es
      *        el conocido ( AYF-FINA ) y el capital = 0 ( AYF-CAPI )
      *        ( KEST es un switch para indicar que devuelva el capital
      *          estimado, esta inicializado siempre en 'N' )
               IF INT-IETB > SPACES AND ( VEN-KEST NOT = 'S' )
                   MOVE 0 TO AYF-CAPI
               ELSE
      *            Analiza como es el interes respecto del valor final
                   IF AYF-IDNI > AYF-FINA
                       SUBTRACT AYF-FINA FROM AYF-IDNI
                       MOVE 0 TO AYF-CAPI
                   ELSE
                       SUBTRACT AYF-IDNI FROM AYF-FINA GIVING AYF-CAPI
      *                El capital calculado puede ser sea mayor que el
      *                resto del documento
                       IF AYF-CAPI > AYF-SCPA
                           PERFORM CAL-AYF-ULT
                       ELSE
                           MOVE 0 TO AYF-IDNI
           ELSE
      *        Si tipo de calculo NO es 'F*'
      *        Si la tasa es estimada
      *JSS-INI 13-JUN-1997
      *        IF INT-IETB > SPACES
               IF INT-IETB > SPACES AND ( VEN-KEST NOT = 'S' )
      *JSS-FIN 13-JUN-1997
      *            Si existe un F* en el vencimiento que se genera
      *            se mueve al final el capital conocido y el capital en
      *            ( ya que el valor final sera el conocido : el final d
      *            f* + los capitales de las otras estructuras )
      *            en caso de no existir ningun f* el capital es el cono
      *            ( AYF-CAPI ) y el final es 0 ( AYF-FINA )
                   IF VEN-NEVF > 0
                       MOVE AYF-CAPI TO AYF-FINA
                       MOVE 0        TO AYF-CAPI
                   ELSE
                       MOVE 0        TO AYF-FINA
               ELSE
      *        Si la tasa es real
      *        El capital calculado puede ser sea mayor que el resto del
      *        documento
               IF AYF-CAPI > AYF-SCPA
                   PERFORM CAL-AYF-ULT
               ELSE
      *        Si el capital calculado no es mayor que el resto del docu
      *        Calcula valor final
      *        En el caso de interes prorrateado segun capital de cada c
      *        saca la proporcion del saldo de interes correspondiente
               ADD AYF-CAPI , AYF-IDNI GIVING AYF-FINA
               MOVE 0 TO AYF-IDNI
               IF DLC-MIPL(VEN-IDLC) = CIC-MIPL-P
                   MULTIPLY AYF-SINT BY AYF-CAPI GIVING AYF-VAUX
                   DIVIDE AYF-SCPA INTO AYF-VAUX
                   IF OPC-COD-VCOC IN OPC = CIC-VLR-MNAC
      *                Si es moneda nacional redondea sin centavos y
      *                suma la proporcion de interes al valor final
      *                y lo resta al saldo de interes
                       MOVE AYF-VAUX TO PES-SGV-DECI
                       PERFORM PES-SCTV
                       MOVE PES-SGV-ENTE TO AYF-VAUX
                       ADD AYF-VAUX TO AYF-FINA
                       SUBTRACT AYF-VAUX FROM AYF-SINT
                   ELSE
      *                suma la proporcion de interes al valor final
      *                y lo resta al saldo de interes
                       ADD AYF-VAUX TO AYF-FINA
                       SUBTRACT AYF-VAUX FROM AYF-SINT
      *
               ELSE
      *            Si el manejo del saldo de interes no es prorrateado
      *            suma el saldo de interes al valor final y
      *            deja el saldo de intereses en 0
                   ADD AYF-SINT TO AYF-FINA
                   MOVE 0 TO AYF-SINT.
       CON-CAL-AYF.
      *Actualiza saldo insoluto restando el valor del capital
           SUBTRACT AYF-CAPI FROM AYF-SCPA.
       FIN-CAL-AYF.
           EXIT.

       CAL-AYF-ULT SECTION.
       INI-CAL-AYF-ULT.
      *Setea que es el ultimo vencimiento
           MOVE 'S' TO AYF-IULT.
      *En este caso con el vencimiento actual se cancela todo el documen
      *Mueve el saldo insoluto al capital total
           MOVE AYF-SCPA TO AYF-CAPI.
      *Si la tasa de interes es estimada el valor final = 0, ya
      *que no se conoce realmente
      *JSS-INI 13-JUN-1997
      *    IF INT-IETB > SPACES
           IF INT-IETB > SPACES AND ( VEN-KEST NOT = 'S' )
      *JSS-FIN 13-JUN-1997
               MOVE 0 TO AYF-FINA
           ELSE
      *    Suma el saldo insoluto, intereses devengados para obtener val
      *    final ademas si el manejo de interes es prorrateado segun cap
      *    de cada cuota suma al valor final el saldo de los intereses
               ADD AYF-CAPI , AYF-IDNI GIVING AYF-FINA
               MOVE 0 TO AYF-IDNI
               IF DLC-MIPL(VEN-IDLC) = CIC-MIPL-P
                   ADD AYF-SINT TO AYF-FINA
                   MOVE 0 TO AYF-SINT.
       FIN-CAL-AYF-ULT.
           EXIT.

      *JSS-INI 28-FEB-1994
       COM-REG-VEN SECTION.
       INI-COM-REG-VEN.
           MOVE 0 TO VEN-AUXI.
           MOVE VEN-NUM-IDLC IN VEN TO VEN-IDLC.
           PERFORM LOD-RDLC.
           IF NOT VEN-STAT-OKS
               GO TO FIN-COM-REG-VEN.
      *Calcula numero de vencimientos cancelados
           IF OPC-NUM-TVCC IN OPC NOT > ZEROES
               ADD OPC-NUM-VCCO IN OPC
                   OPC-NUM-VCCM IN OPC
                   OPC-NUM-VCCV IN OPC GIVING VEN-VCAN
           ELSE
               MOVE OPC-NUM-TVCC IN OPC TO VEN-VCAN.
      *Si estan todos los vencimientos cancelados resta 1 al numero de
      *vencimientos cancelados como un 'truco' para no considerarlos
      *posteriormente
           IF OPC-NUM-VCVG IN OPC NOT > ZEROES
               SUBTRACT 1 FROM VEN-VCAN.
      *
           MOVE 'A' TO VEN-IVAS.
           PERFORM OBT-EVC.
           IF NOT VEN-STAT-OKS
               GO TO FIN-COM-REG-VEN.
      *
           IF OPC-VAL-SCRE IN OPC NOT > 0
               IF VEN-NUM-IVCT IN VEN = OPC-NUM-IVEN IN OPC
                   IF VEN-NUM-IVCT IN VEN = 1
                       MOVE OPC-FEC-FCOL IN OPC TO VEN-FMAX
                       GO TO CON-COM-REG-VEN
                   ELSE
                       PERFORM ANT-EVC
                       PERFORM DEC-VEN
                       IF NOT VEN-STAT-OKS
                           GO TO FIN-COM-REG-VEN
                       ELSE
                           GO TO CON-COM-REG-VEN
               ELSE
                   NEXT SENTENCE
           ELSE
           IF VEN-NUM-IVCT IN VEN = 1
               IF DLC-FEC-FDEV IN DLC > OPC-FEC-FCOL IN OPC
                   MOVE DLC-FEC-FDEV IN DLC TO VEN-FMAX
                   GO TO CON-COM-REG-VEN
               ELSE
                   MOVE OPC-FEC-FCOL IN OPC TO VEN-FMAX
                   GO TO CON-COM-REG-VEN.
      *
           PERFORM ANT-EVC.
           PERFORM DEC-VEN.
           IF NOT VEN-STAT-OKS
               GO TO FIN-COM-REG-VEN.
      *Compara la fecha del DLC con la FMAX del VEN anterior
      *FMAX = MAX(FDEV,FVEN anterior) y continua
           IF DLC-FEC-FDEV IN DLC > VEN-FMAX
               MOVE DLC-FEC-FDEV IN DLC TO VEN-FMAX.
       CON-COM-REG-VEN.
      *FUNO = MIN(CANDIDATO=MAX(FDEV,FCOL o FVEN anterior),FVEN actual)
           IF VEN-FEC-FVEN IN VEN < VEN-FMAX
               MOVE VEN-NUM-DVEN IN VEN TO INT-DUNO
               MOVE VEN-NUM-MVEN IN VEN TO INT-MUNO
               MOVE VEN-NUM-SVEN IN VEN TO INT-SUNO
               MOVE VEN-NUM-AVEN IN VEN TO INT-AUNO
           ELSE
               MOVE VEN-DMAX TO INT-DUNO
               MOVE VEN-MMAX TO INT-MUNO
               MOVE VEN-SMAX TO INT-SUNO
               MOVE VEN-AMAX TO INT-AUNO.
      *Carga FDOS, FCOL, FBTV, VCAM, IOPC, IDLC y llama a rutina GNS-CAL
      *para obtener tasa de periodo
           MOVE VEN-NUM-DVEN IN VEN     TO INT-DDOS.
           MOVE VEN-NUM-MVEN IN VEN     TO INT-MDOS.
           MOVE VEN-NUM-SVEN IN VEN     TO INT-SDOS.
           MOVE VEN-NUM-AVEN IN VEN     TO INT-ADOS.

           MOVE OPC-NUM-DCOL IN OPC     TO INT-DCOL.
           MOVE OPC-NUM-MCOL IN OPC     TO INT-MCOL.
           MOVE OPC-NUM-SCOL IN OPC     TO INT-SCOL.
           MOVE OPC-NUM-ACOL IN OPC     TO INT-ACOL.

           IF VEN-FTBS > ZEROES
               MOVE VEN-DTBS TO INT-DBTV
               MOVE VEN-MTBS TO INT-MBTV
               MOVE VEN-STBS TO INT-SBTV
               MOVE VEN-ATBS TO INT-ABTV
           ELSE
               MOVE OPC-NUM-DCOL IN OPC TO INT-DBTV
               MOVE OPC-NUM-MCOL IN OPC TO INT-MBTV
               MOVE OPC-NUM-SCOL IN OPC TO INT-SBTV
               MOVE OPC-NUM-ACOL IN OPC TO INT-ABTV.

           MOVE OPC-COD-VCOC IN OPC     TO INT-VCAM.
           MOVE OPC-CIC-IOPC IN OPC     TO INT-IOPC.
           MOVE VEN-NUM-IDLC IN VEN     TO INT-IDLC.
      *     PERFORM GNS-CAL-INT.
           PERFORM COL-CAL-INT.
      *SMC-FIN 09.09.1993
           IF INT-CMSG > SPACES
               MOVE INT-CMSG TO VEN-STAT
               MOVE INT-MEN2 TO VEN-MEN2
               GO TO FIN-COM-REG-VEN.
      *
      *Por definicion al entrar a esta SECTION el VEN esta incompleto
      *Si esta completo en terminos de final, el capital es 0 y por lo
      *tanto la instruccion ADD no afecta.
      *Si esta completo en terminos de capital, entonces el SCPA
      *ya ha sido rebajado, con lo cual el ADD deja el SCPA con el
      *saldo corregido para el calculo de interes respectivo
           IF OPC-VAL-SCRE IN OPC > 0
               MULTIPLY OPC-VAL-SCRE IN OPC BY INT-TIPE GIVING
                    AYF-SINT ROUNDED
           ELSE
      *JSS-INI 26-AUG-1994 Se suma el SCAP en vez del CAPI ya que
      *pueden existir pagos parciales a cuotas de capital conocido
      *        ADD VEN-VAL-CAPI IN VEN TO DLC-SCPA(VEN-IDLC)
               ADD VEN-VAL-SCAP IN VEN TO DLC-SCPA(VEN-IDLC)
      *JSS-FIN 26-AUG-1994
               MULTIPLY DLC-SCPA(VEN-IDLC) BY INT-TIPE GIVING
                        AYF-SINT ROUNDED.
      *
           MOVE OPC-COD-VCOC IN OPC TO PES-COD-VCAM.
           MOVE AYF-SINT  TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO AYF-SINT.
      *
      *Si a la cuota le falta el valor final, lo completa con el interes
      *correspondiente
           IF VEN-VAL-FINA IN VEN = 0
      *JSS-INI 26-AUG-1994 Se suma el SCAP en vez del CAPI ya que
      *pueden existir pagos parciales a cuotas de capital conocido
      *        ADD AYF-SINT VEN-VAL-CAPI IN VEN GIVING
               ADD AYF-SINT VEN-VAL-SCAP IN VEN GIVING
                            VEN-VAL-FINA IN VEN
      *JSS-FIN 26-AUG-1994
               MOVE VEN-VAL-FINA IN VEN TO VEN-VAL-SFIN IN VEN
           ELSE
      *Si a la cuota le falta el valor capital, lo completa con el inter
      *correspondiente
               MOVE 1 TO VEN-AUXI
               SUBTRACT AYF-SINT FROM VEN-VAL-FINA IN VEN
                               GIVING VEN-VAL-CAPI IN VEN
               MOVE VEN-VAL-CAPI IN VEN TO VEN-VAL-SCAP IN VEN.

      *Verifica si el capital es mayor que el saldo del credito,
      *asume capital el saldo del credito
           IF OPC-VAL-SCRE IN OPC > 0
               IF VEN-VAL-SCAP IN VEN > OPC-VAL-SCRE IN OPC
                   MOVE OPC-VAL-SCRE IN OPC TO VEN-VAL-CAPI IN VEN
                   MOVE VEN-VAL-CAPI IN VEN TO VEN-VAL-SCAP IN VEN
                   ADD AYF-SINT VEN-VAL-CAPI IN VEN
                         GIVING VEN-VAL-FINA IN VEN
                   MOVE VEN-VAL-FINA IN VEN TO VEN-VAL-SFIN IN VEN
               ELSE
                   NEXT SENTENCE
           ELSE
               IF VEN-VAL-SCAP IN VEN > DLC-SCPA(VEN-IDLC)
                   MOVE DLC-SCPA(VEN-IDLC)  TO VEN-VAL-CAPI IN VEN
                   MOVE VEN-VAL-CAPI IN VEN TO VEN-VAL-SCAP IN VEN
                   ADD AYF-SINT VEN-VAL-CAPI IN VEN
                         GIVING VEN-VAL-FINA IN VEN
                   MOVE VEN-VAL-FINA IN VEN TO VEN-VAL-SFIN IN VEN.

      *Si los intereses son mayores que el valor final ( se considera
      *la diferencia como intereses devengados no incluidos )
           IF AYF-SINT > VEN-VAL-FINA IN VEN
               SUBTRACT VEN-VAL-FINA IN VEN FROM AYF-SINT
                 GIVING VEN-VAL-IDNI IN VEN
               MOVE 0 TO VEN-VAL-CAPI IN VEN
               MOVE 0 TO VEN-VAL-SCAP IN VEN
           ELSE
               MOVE 0 TO VEN-VAL-IDNI IN VEN.
      *Si es la ultima cuota y el valor de capital es menor que el saldo
      *del credito, asume capital el saldo del credito
           IF VEN-FEC-FVEN IN VEN = DLC-FEC-FMAV IN DLC
               IF OPC-VAL-SCRE IN OPC > 0
                   IF VEN-VAL-SCAP IN VEN < OPC-VAL-SCRE IN OPC
                       MOVE OPC-VAL-SCRE IN OPC TO VEN-VAL-CAPI IN VEN
                       MOVE VEN-VAL-CAPI IN VEN TO VEN-VAL-SCAP IN VEN
                       ADD AYF-SINT VEN-VAL-CAPI IN VEN
                             GIVING VEN-VAL-FINA IN VEN
                       MOVE VEN-VAL-FINA IN VEN TO VEN-VAL-SFIN IN VEN
                       MOVE 0                   TO VEN-VAL-IDNI IN VEN
                   ELSE
                       NEXT SENTENCE
               ELSE
                   IF VEN-VAL-SCAP IN VEN < DLC-SCPA(VEN-IDLC)
                       MOVE DLC-SCPA(VEN-IDLC)  TO VEN-VAL-CAPI IN VEN
                       MOVE VEN-VAL-CAPI IN VEN TO VEN-VAL-SCAP IN VEN
                       ADD AYF-SINT VEN-VAL-CAPI IN VEN
                             GIVING VEN-VAL-FINA IN VEN
                       MOVE VEN-VAL-FINA IN VEN TO VEN-VAL-SFIN IN VEN
                       MOVE 0                   TO VEN-VAL-IDNI IN VEN.
      *
           MOVE OPC-COD-VCOC IN OPC TO PES-COD-VCAM.
           MOVE VEN-VAL-CAPI IN VEN TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO VEN-VAL-CAPI IN VEN.
      *
           MOVE OPC-COD-VCOC IN OPC TO PES-COD-VCAM.
           MOVE VEN-VAL-FINA IN VEN TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO VEN-VAL-FINA IN VEN.
      *
      *Solo si la cuota la completo con capital, tengo que restar
      *al SCPA
           IF VEN-AUXI = 1
               SUBTRACT VEN-VAL-SCAP IN VEN FROM
                        DLC-SCPA(VEN-NUM-IDLC IN VEN).
           IF VEN-NUM-IVCT IN VEN = 1
               GO TO FIN-COM-REG-VEN.
           MOVE 'S' TO VEN-IVAS.
           PERFORM OBT-FYJ.
           MOVE EVC-JPVC(VEN-IEVC) TO AYF-JAMT.
           PERFORM ACT-VDLC.
       FIN-COM-REG-VEN.
           EXIT.
      *JSS-FIN 28-FEB-1994

       ACT-VDLC SECTION.
       INI-ACT-VDLC.
      *Actualiza el Juliano de la amortizacion del Documento Y
      *Mueve la fecha del vencimiento a la fecha de amortizacion del
      *documento ( Recordar que existen por cada 'vencimiento' dos fecha
      *la FPVC que es la fecha del vencimiento sin analisis de feriado y
      *la FFVC que es la fecha del vencimiento mas analisis de feriado )
           MOVE 1 TO VEN-IVCC.
       AMT-ACT-VDLC.
           MOVE VEN-VVCC(VEN-IVCC) TO VEN-IEVC.
           IF EVC-TCVE(VEN-IEVC) = 'IO' OR 'CO' OR 'FO' OR 'CE'
               IF EVC-IDLC(VEN-IEVC) = 0
                   MOVE EVC-IVCT(VEN-IEVC) TO VEN-IDLC
                   MOVE AYF-JAMT TO DLC-JAMT(VEN-IDLC)
                   MOVE EVC-DFVC(VEN-IEVC) TO DLC-DAMT(VEN-IDLC)
                   MOVE EVC-MFVC(VEN-IEVC) TO DLC-MAMT(VEN-IDLC)
                   MOVE EVC-SFVC(VEN-IEVC) TO DLC-SAMT(VEN-IDLC)
                   MOVE EVC-AFVC(VEN-IEVC) TO DLC-AAMT(VEN-IDLC)
               ELSE
                   MOVE EVC-IDLC(VEN-IEVC) TO VEN-IDLC
                   MOVE AYF-JAMT TO DLC-JAMT(VEN-IDLC)
                   MOVE EVC-DFVC(VEN-IEVC) TO DLC-DAMT(VEN-IDLC)
                   MOVE EVC-MFVC(VEN-IEVC) TO DLC-MAMT(VEN-IDLC)
                   MOVE EVC-SFVC(VEN-IEVC) TO DLC-SAMT(VEN-IDLC)
                   MOVE EVC-AFVC(VEN-IEVC) TO DLC-AAMT(VEN-IDLC).
           ADD 1 TO VEN-IVCC.
           IF VEN-IVCC NOT > VEN-MVCC
               GO TO AMT-ACT-VDLC.
      *
           MOVE VEN-VVCC(1) TO VEN-IEVC.
       FIN-ACT-VDLC.
           EXIT.

       ANL-FRD-FINT SECTION.
       INI-ANL-FRD-FINT.
           MOVE INT-DDMA TO FEC-ITM1.
           MOVE INT-MDMA TO FEC-ITM2.
           MOVE INT-SDMA TO FEC-ITM3.
           MOVE INT-ADMA TO FEC-ITM4.
       LUP-ANL-FRD-FINT.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-OKS
               MOVE FEC-ITM1 TO INT-DDMA
               MOVE FEC-ITM2 TO INT-MDMA
               MOVE FEC-ITM3 TO INT-SDMA
               MOVE FEC-ITM4 TO INT-ADMA
               GO TO FIN-ANL-FRD-FINT.
           IF NOT FEC-STAT-FER
               MOVE MSG-COD-MENS TO VEN-STAT
               GO TO FIN-ANL-FRD-FINT.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-RST-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
      *    PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE MSG-COD-MENS TO VEN-STAT
           ELSE
               GO TO LUP-ANL-FRD-FINT.
       FIN-ANL-FRD-FINT.
           EXIT.

       BUS-PINT SECTION.
       INI-BUS-PINT.
      *Carga los parametros para obtener tasa de interes
           MOVE DLC-TINT(VEN-IDLC)  TO INT-TINT.
           MOVE OPC-COD-VCOC IN OPC TO INT-VCAM.

           MOVE DLC-DAMT(VEN-IDLC)  TO INT-DUNO.
           MOVE DLC-MAMT(VEN-IDLC)  TO INT-MUNO.
           MOVE DLC-SAMT(VEN-IDLC)  TO INT-SUNO.
           MOVE DLC-AAMT(VEN-IDLC)  TO INT-AUNO.
           MOVE EVC-DFVC(VEN-IEVC)  TO INT-DDOS.
           MOVE EVC-MFVC(VEN-IEVC)  TO INT-MDOS.
           MOVE EVC-SFVC(VEN-IEVC)  TO INT-SDOS.
           MOVE EVC-AFVC(VEN-IEVC)  TO INT-ADOS.

           MOVE OPC-NUM-DCOL IN OPC TO INT-DCOL INT-DBTV.
           MOVE OPC-NUM-MCOL IN OPC TO INT-MCOL INT-MBTV.
           MOVE OPC-NUM-SCOL IN OPC TO INT-SCOL INT-SBTV.
           MOVE OPC-NUM-ACOL IN OPC TO INT-ACOL INT-ABTV.
      *SMC-INI 07.09.1993
           MOVE OPC-CIC-IOPC IN OPC TO INT-IOPC.
           MOVE 1                   TO INT-IDLC.
      *SMC-FIN 07.09.1993
       FIN-BUS-PINT.
           EXIT.


      * Rutina que a partir de la fecha de colocacion, busca la
      * ultima fecha de cambio de tasa antes de la fecha de ejecucion
      * La fecha de ultimo cambio de tasa se calcula solo para el primer
      * vencimiento, para los demas se mantiene la fecha calculada
      * Entrada : WSS-FEC-FINT  ( FCOL )
      * Salida  : WSS-FEC-FUCT
       CAL-ULT-CAMBIO-TASA SECTION.
      *----------------------------
       INI-CAL-ULT-CAMBIO-TASA.
           IF ICG-COD-CVTI IN ICG NOT > SPACES
               GO TO FIN-CAL-ULT-CAMBIO-TASA.

           IF ICG-MSC-TFPR IN ICG = 'F'
               PERFORM CARGA-FTBS
               GO TO FIN-CAL-ULT-CAMBIO-TASA.

           IF WSS-PVEZ IN WSS-VARI NOT = 'S'
               GO TO FIN-CAL-ULT-CAMBIO-TASA.

       LUP-CAL-ULT-CAMBIO-TASA.
           IF WSS-FEC-FINT IN WSS-VARI > HOY-FHOY
               GO TO FIN-CAL-ULT-CAMBIO-TASA.

           MOVE WSS-FEC-FINT IN WSS-VARI TO WSS-FEC-FUCT IN WSS-VARI.

           IF ICG-MSC-UTPR IN ICG = 'D'
               MOVE ICG-NUM-PREP IN ICG TO FEC-NDIA
               MOVE FEC-SUM-DIA         TO FEC-CMND
           ELSE
           IF ICG-MSC-UTPR IN ICG = 'M'
               MOVE ICG-NUM-PREP IN ICG TO FEC-NMES
               MOVE FEC-SUM-MES         TO FEC-CMND
           ELSE
               MOVE ICG-NUM-PREP IN ICG TO FEC-NANO
               MOVE FEC-SUM-ANO         TO FEC-CMND.

           MOVE WSS-NUM-DINT IN WSS-VARI TO FEC-ITM1.
           MOVE WSS-NUM-MINT IN WSS-VARI TO FEC-ITM2.
           MOVE WSS-NUM-SINT IN WSS-VARI TO FEC-ITM3.
           MOVE WSS-NUM-AINT IN WSS-VARI TO FEC-ITM4.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               GO TO FIN-CAL-ULT-CAMBIO-TASA.

           MOVE FEC-ITM1 TO WSS-NUM-DINT IN WSS-VARI.
           MOVE FEC-ITM2 TO WSS-NUM-MINT IN WSS-VARI.
           MOVE FEC-ITM3 TO WSS-NUM-SINT IN WSS-VARI.
           MOVE FEC-ITM4 TO WSS-NUM-AINT IN WSS-VARI.
           GO TO LUP-CAL-ULT-CAMBIO-TASA.
       FIN-CAL-ULT-CAMBIO-TASA.
           EXIT.


      ******************************************************************
      *El parametro VEN-FTBS sirve para buscar la ultima tasa vigente
      *a esa fecha (si lleva valor), y si no lleva valor, busca la tasa
      *a fecha de colocacion
       CARGA-FTBS SECTION.
      *******************
       INI-CARGA-FTBS.
           IF WSS-PVEZ IN WSS-VARI = 'S'
               MOVE OPC-FEC-FCOL IN OPC TO WSS-FEC-FUCT IN WSS-VARI
                                           WSS-FEC-FXXX IN WSS-VARI
           ELSE
           IF WSS-PVEZ IN WSS-VARI NOT = 'S' AND
              VEN-FEC-FVEN IN VEN NOT > HOY-FHOY
               MOVE VEN-FEC-FVEN IN VEN TO WSS-FEC-FUCT IN WSS-VARI
               MOVE VEN-FEC-FVEN IN VEN TO WSS-FEC-FXXX IN WSS-VARI
           ELSE
               MOVE WSS-FEC-FXXX TO WSS-FEC-FUCT IN WSS-VARI.
       FIN-CARGA-FTBS.
           EXIT.

       COPY GNSBGPES.
      *SMC-INI 09.09.1993
       COPY COLBGINT.
      *SMC-FIN 09.09.1993
       COPY GNSBGCVI.
       COPY COLBFEVC.
       COPY COLBFRCV.
       COPY COLBFRDT.
      *DAD ini  22-JUL-1991
       COPY COLBGCAU.
       COPY COLBGCTO.
      *DAD fin  22-JUL-1991
      *>>>>
      *    07-OCT-98 03:56 PM     ,PAI= ,CLI= ,SOP=MVS  V 1.1.3
       D-PH-MVR SECTION.
       INI-PH-MVR.
       FIN-PH-MVR.
           EXIT.
       D-DL-MVR SECTION.
       INI-DL-MVR.
       FIN-DL-MVR.
           EXIT.
       D-DL-FMO SECTION.
       INI-DL-FMO.
       FIN-DL-FMO.
           EXIT.
       D-DL-TFU SECTION.
       INI-DL-TFU.
       FIN-DL-TFU.
           EXIT.
       D-DL-FFU SECTION.
       INI-DL-FFU.
       FIN-DL-FFU.
           EXIT.
       D-DL-RAY SECTION.
       INI-DL-RAY.
       FIN-DL-RAY.
           EXIT.
