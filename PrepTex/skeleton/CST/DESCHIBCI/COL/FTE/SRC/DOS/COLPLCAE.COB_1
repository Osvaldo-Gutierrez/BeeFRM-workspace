       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPLCAE.
       AUTHOR.          BEETEAM(JGM).
       DATE-WRITTEN.    15-Feb-00 12:31 PM.

      * Programa Listador de Reporte CAE sin Sort.
      *
      * V 1.1.2
      *


       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.

            C01 IS SALTO
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT RPTCAE       ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTCAE       ASSIGN TO        UT-S-RPTCAE.
           SELECT RPTCAE       ASSIGN TO        UT-S-RPTCAE.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       FD  RPTCAE LABEL RECORDS OMITTED
           BLOCK CONTAINS 0 RECORDS
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-CAE     PIC X(132).

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
      *
       COPY TABBROFI.
      *
       COPY GNSBRMSC.
       COPY COLBRCAE.
       COPY COLRRCAE.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSWGGRC.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY COLRWCAE.
       COPY COLRNCAE.
       COPY COLROCAE.
       COPY GNSWGSYS.
       01  PGM-HRSR-CAE   VALUE 'N'       PIC X(01).
           88 HAY-REGISTROS-EN-SORT-CAE  VALUE 'S'.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *
       01  WSS-VARI.
           03 WSS-REG-CABE.
              05  WSS-CAI-COPC  VALUE '    '     PIC X(04).
              05  WSS-IIC-COPC  VALUE '00000000' PIC X(08).
           03 WSS-VAL-CRED      VALUE 0          PIC 9(13)V9(02).
           03 WSS-COD-OFOC      VALUE SPACES     PIC X(03).
           03 WSS-FEC-FPRO.
              05 WSS-NUM-SPRO                    PIC 9(02).
              05 WSS-NUM-APRO                    PIC 9(02).
              05 WSS-NUM-MPRO                    PIC 9(02).
              05 WSS-NUM-DPRO                    PIC 9(02).

      * AQUI EXISTIA LABEL RF INI
      * AQUI EXISTIA LABEL RF FIN
       COPY COLRTCAE.

       PROCEDURE DIVISION.
      *==================

      * AQUI EXISTIA LABEL FIN_DEC INI
      * AQUI EXISTIA LABEL FIN_DEC FIN

       MAIN SECTION.
      *------------
       INI-MAIN.
      *    MOVE SYS-MXFL TO SYS-CMND.
      *    PERFORM GNS-PRO-SYS.
       COPY GNSBGEDB.
           MOVE 'COLPLCAE' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
       INI-INP-SRT.
      *     MOVE 'COLPLCAE' TO RPT-NPGM.
           PERFORM CAL-HDR.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-CAE.
       FST-INP-SRT.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-CAE.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ARCHIVO-CAE NO TIENE INFORMACION'
               PERFORM GNS-PRO-END.
      *
           IF CAE-CIC-IOPC IN CAE NOT = WSS-REG-CABE IN WSS-VARI

               DISPLAY 'NO EXISTE REG. DE CONTROL'
               PERFORM GNS-PRO-END
           ELSE
               MOVE CAE-FEC-FPRO IN CAE TO WSS-FEC-FPRO IN WSS-VARI.
      *
      *
      *
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-CAE.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ARCHIVO-CAE NO TIENE DETALLE    '
               PERFORM GNS-PRO-END.
       COPY COLRMCAE.
       INI-OUT-SRT.
           OPEN OUTPUT RPTCAE.
           PERFORM INITIATE-RPTCAE.
           MOVE SRT TO SRT-OLD-CAE.
           MOVE SRT TO SRT-CUR-CAE.
      *
           DISPLAY 'FEC-FPRO ' WSS-FEC-FPRO  IN WSS-VARI.
      *
           MOVE CAE-COD-OFOC IN CAE      TO WSS-COD-OFOC IN WSS-VARI.
           MOVE WSS-NUM-SPRO IN WSS-VARI TO WSS-NUM-SHAS IN WSS-CAE.
           MOVE WSS-NUM-APRO IN WSS-VARI TO WSS-NUM-AHAS IN WSS-CAE.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO WSS-NUM-MHAS IN WSS-CAE.
           MOVE WSS-NUM-DPRO IN WSS-VARI TO WSS-NUM-DHAS IN WSS-CAE.
       LUP-MAIN.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
       MOV-INP-SRT.
       COPY COLRMCAE.
       LUP-OUT-SRT.
           IF WSS-COD-OFOC IN WSS-VARI NOT = CAE-COD-OFOC IN CAE
              MOVE ZEROES    TO WSS-VAL-TCRE IN WSS-CAE
              MOVE ZEROES    TO WSS-VAL-CRED IN WSS-VARI
              MOVE CAE-COD-OFOC IN CAE TO WSS-COD-OFOC IN WSS-VARI
              MOVE CAE-VAL-CRED IN CAE TO WSS-VAL-CRED IN WSS-VARI
           ELSE
           ADD CAE-VAL-CRED IN CAE       TO WSS-VAL-CRED IN WSS-VARI.
      *
           MOVE WSS-VAL-CRED IN WSS-VARI TO WSS-VAL-TCRE IN SRT.
      *
      *
           PERFORM GENERATE-DL-CAE.
       NXT-INP-SRT.
       NXT-OUT-SRT.
           MOVE SRT TO SRT-OLD-CAE.
       RET-OUT-SRT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-CAE.
           GO TO LUP-MAIN.
       FIN-MAIN.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-CAE.
       FIN-OUT-SRT.
           IF HAY-REGISTROS-EN-SORT-CAE
                PERFORM TERMINATE-RPTCAE.
           CLOSE RPTCAE.
           IF PGM-STAT-SRT-MAL
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       COPY COLBFCAE.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGIRH.
       COPY COLRECAE.
      *    15-FEB-00 12:30 PM     ,PAI= ,CLI= ,SOP=MVS  V 1.1.3
       D-CF-CAE-CAE-COD-OFOC SECTION.
       INI-CF-CAE-CAE-COD-OFOC.
      *Mediante BUS-OFI se obtiene Nombre de la oficina de tabla OFI
           IF CAE-COD-OFOC IN CAE > SPACES
              MOVE CAE-COD-OFOC IN CAE TO OFI-COD-OFIC IN OFI
              PERFORM BUS-OFI
              MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFOC IN WSS-CAE
           ELSE
              MOVE SPACES TO WSS-GLS-OFOC IN WSS-CAE.
      *
           MOVE ZEROES                   TO WSS-VAL-TCRE IN WSS-CAE.
           MOVE ZEROES                   TO WSS-VAL-CRED IN WSS-VARI.
       FIN-CF-CAE-CAE-COD-OFOC.
           EXIT.
       D-CH-CAE-CAE-COD-OFOC SECTION.
       INI-CH-CAE-CAE-COD-OFOC.
      *
      *Mediante BUS-OFI se obtiene Nombre de la oficina de tabla OFI
           IF CAE-COD-OFOC IN CAE > SPACES
              MOVE CAE-COD-OFOC IN CAE TO OFI-COD-OFIC IN OFI
              PERFORM BUS-OFI
              MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFOC IN WSS-CAE
           ELSE
              MOVE SPACES TO WSS-GLS-OFOC IN WSS-CAE.
       FIN-CH-CAE-CAE-COD-OFOC.
           EXIT.
       D-PH-CAE SECTION.
       INI-PH-CAE.
       FIN-PH-CAE.
           EXIT.
       D-DL-CAE SECTION.
       INI-DL-CAE.
       FIN-DL-CAE.
           EXIT.
       COPY GNSBBMSG.
       COPY GNSBBMSC.
       COPY GNSBFMSC.
       COPY GNSBBTAB.
       COPY GNSBGABT.
       COPY TABBFOFI.
       COPY TABBBOFI.
       COPY TABBVOFI.

