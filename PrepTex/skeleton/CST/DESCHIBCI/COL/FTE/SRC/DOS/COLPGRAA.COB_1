       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPGRAA.
       AUTHOR.          CONSIST  (R.A.A.).
       DATE-WRITTEN.    23-FEB-1993.

      * CARGA DE DATOS EN ARCHIVO VSAM INDEXADO CON DOS LLAVES
      * ALTERNAS, PARA SER TOMADO POR PROGRAMA 'COLPPRAA'.

       ENVIRONMENT DIVISION.
      *====================
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT  LECTORA ASSIGN TO LECTORA.
      *
      *DOS SELECT  COLRAA  ASSIGN TO SYS010-COLRAA
      *MVS SELECT  COLRAA  ASSIGN TO        COLRAA
           SELECT  COLRAA  ASSIGN TO        COLRAA
                ORGANIZATION         IS INDEXED
      *         ACCESS               IS DYNAMIC
                ACCESS               IS SEQUENTIAL
                RECORD KEY           IS RAA-KEY
      *         ALTERNATE RECORD KEY IS RAA-ALT-KEY1
      *                   WITH DUPLICATES
      *         ALTERNATE RECORD KEY IS RAA-ALT-KEY2
      *                   WITH DUPLICATES
                FILE STATUS          IS FIO-STAT.

       DATA DIVISION.
      *=============
       FILE SECTION.
       FD  LECTORA
           LABEL RECORD  OMITTED
           RECORD CONTAINS 80.
      *
       01  REG-LECTORA.
           05  FILLER                  PIC X(07).
           05  REG-LECT.
               08  LLAVE-PRIN          PIC 9(05).
               08  GLOSA-PRIN          PIC X(15).
               08  LLAVE-ALT1          PIC X(05).
               08  GLOSA-ALT1          PIC X(20).
               08  LLAVE-ALT2          PIC 9(05).
               08  GLOSA-ALT2          PIC X(15).
           05  FILLER                  PIC X(08).
      *
       FD  COLRAA
           LABEL RECORDS STANDARD
           RECORD CONTAINS 65.
      *
       01  REG-COLRAA.
           05  RAA-KEY                 PIC 9(05).
           05  RAA-GLOSA               PIC X(15).
           05  RAA-ALT-KEY1            PIC X(05).
           05  RAA-GLOSA1              PIC X(20).
           05  RAA-ALT-KEY2            PIC 9(05).
           05  RAA-GLOSA2              PIC X(15).

       WORKING-STORAGE SECTION.
      *-----------------------
       77  FIO-STAT                    PIC X(02)      VALUE SPACES.
       77  WS-FIN                      PIC 9(01)      VALUE 0.
       77  WS-LEIDOS                   PIC 9(03)      VALUE 0.
       77  WS-GRABADOS                 PIC 9(03)      VALUE 0.
       77  WS-REG-COLRAA               PIC X(65)      VALUE SPACES.
      *

       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
       ABRIR.
      *    OPEN I-O    COLRAA.
           OPEN OUTPUT COLRAA.
           IF  FIO-STAT > '00' AND NOT = '90'
               DISPLAY 'FALLO OPEN DE ARCHIVO; STATUS ' FIO-STAT
               GO TO FIN.
           OPEN INPUT LECTORA.
      *
       PROCESO.
           PERFORM LLENA-COLRAA THRU F-LLENA-COLRAA UNTIL WS-FIN = 1.
           DISPLAY 'REGS. LEIDOS   = ' WS-LEIDOS.
           DISPLAY 'REGS. GRABADOS = ' WS-GRABADOS.
      *
           CLOSE LECTORA.
      *
      *PROCESO2.
      *    DISPLAY 'TERMINE GRABACION DE REGISTROS EN ARCHIVO;'
      *    DISPLAY 'AHORA VOY A HACER START Y LEER POR LLAVE PRINCIPAL'.
      *    MOVE ZEROES    TO RAA-KEY.
      *    START COLRAA KEY NOT < RAA-KEY.
      *    IF  FIO-STAT > '00'
      *        DISPLAY 'FALLO START ARCHIVO; STATUS ' FIO-STAT
      *        GO TO FIN.
      *
      *LECTURA.
      *    READ COLRAA NEXT.
      *    IF  FIO-STAT = '10'
      *        GO TO FIN.
      *    IF  FIO-STAT > '00'
      *        DISPLAY 'ERROR EN LECTURA NEXT; STATUS ' FIO-STAT
      *        GO TO FIN.
      *    DISPLAY 'LEYO = ' REG-COLRAA.
      *    GO TO LECTURA.
      *
       FIN.
           CLOSE COLRAA.
           STOP RUN.
      *
       LLENA-COLRAA.
           READ LECTORA      AT END MOVE 1 TO WS-FIN
                                    GO TO F-LLENA-COLRAA.
           ADD  1   TO WS-LEIDOS.
      *
           MOVE REG-LECT     TO REG-COLRAA.
           DISPLAY 'LEYO  ' REG-LECT.
           WRITE REG-COLRAA.
           IF  FIO-STAT > '00'
               MOVE 1   TO WS-FIN
               DISPLAY 'NO GRABO REG.; LLAVE = ' RAA-KEY
               DISPLAY 'STATUS ' FIO-STAT
               GO TO F-LLENA-COLRAA.
           DISPLAY 'GRABO ' REG-COLRAA.
           ADD  1   TO WS-GRABADOS.
      *
       F-LLENA-COLRAA.
           EXIT.
