       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPGFVX.
       AUTHOR.          BEE.
       DATE-WRITTEN.
      * Programa Graba archivo con flujos futuros
      * Autor: BEE (ALD).
      *
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.

       COPY COLBRFVD REPLACING ==FVD.== BY ==FVX.==.
       COPY COLBRFVD.
       COPY GNSWGCPT.
       COPY GNSWGSYS.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSBRMSC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       01  WSS-VARI.
           03  WSS-FVX                        PIC X(200).
           03  PRIMER-VEZ                     PIC X(01).
           03  WSS-CIC-IOPC                   PIC X(12).
           03  WSS-EXISTE        VALUE 'N'    PIC X(01).
           03  WSS-SGV-CAPI                   PIC 9(14)V9(04).
           03  WSS-SGV-INTE                   PIC 9(14)V9(04).
           03  WSS-SGV-COMI                   PIC 9(14)V9(04).
           03  WSS-SGV-AUXI                   PIC 9(12)V9(04).
           03  WSS-GLS-CAPT.
               05  WSS-GLS-ENTC               PIC X(12).
               05  WSS-GLS-DECC               PIC X(04).
           03  WSS-GLS-INTT.
               05  WSS-GLS-ENTI               PIC X(14).
               05  WSS-GLS-DECI               PIC X(04).
           03  WSS-NUM-RLEI   VALUE ZEROES    PIC 9(06).
           03  WSS-NUM-RSEL   VALUE ZEROES    PIC 9(06).
           03  WSS-NUM-RGRA   VALUE ZEROES    PIC 9(06).
           03  WSS-NUM-RECH   VALUE ZEROES    PIC 9(06).
           03  WSS-NUM-OPER                   PIC 9(08).
           03  WSS-FEC-FPRO.
               05  WSS-NUM-SPRO               PIC 9(02).
               05  WSS-NUM-APRO               PIC 9(02).
               05  WSS-NUM-MPRO               PIC 9(02).
               05  WSS-NUM-DPRO               PIC 9(02).
           03  WSS-FEC-FVCT.
               05  WSS-NUM-SVCT               PIC 9(02).
               05  WSS-NUM-AVCT               PIC 9(02).
               05  WSS-NUM-MVCT               PIC 9(02).
               05  WSS-NUM-DVCT               PIC 9(02).
           03  WSS-FEC-FVEN.
               05  WSS-NUM-SVEN               PIC 9(02).
               05  WSS-NUM-AVEN               PIC 9(02).
               05  WSS-NUM-MVEN               PIC 9(02).
               05  WSS-NUM-DVEN               PIC 9(02).
           03  WSS-COD-VCOC                   PIC X(06).
           03  WSS-GLS-CCSB                   PIC X(12).
           03  WSS-IND-DISP                   PIC X(01).


       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
       INI-MAIN.
           COPY GNSBGEDB.
           MOVE 'COLPGFVX' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           PERFORM OPEN-FILE.
           PERFORM INI-VAR.
           PERFORM PRO-FVD.
           PERFORM CLOSE-FILE.
           PERFORM MUESTRA-ESTADISTICAS.
       FIN-MAIN.
           PERFORM GNS-PRO-END.


      ******************************************************************
       OPEN-FILE SECTION.
      *******************
       INI-OPEN-FILE.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-FVD.
           MOVE 'COL' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE 'TAB' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM COL-FIO-FVX.
       FIN-OPEN-FILE.
           EXIT.

       INI-VAR SECTION.
      *****************
       INI-INI-VAR.
           DISPLAY 'INICIO CAPTURA DE PARAMETROS '.
           DISPLAY '============================ '.

      * Valida codigo de display (S/N).
      * Captura Indicador para desplegar los Display en el programa.
           ACCEPT WSS-IND-DISP IN WSS-VARI.
           DISPLAY 'INDICADOR DE DISPLAY (S/N)  : ' WSS-IND-DISP
                                                         IN WSS-VARI.
           IF WSS-IND-DISP IN WSS-VARI NOT = 'S' AND NOT = 'N'
               DISPLAY 'ERROR, codigo de Display no es valido, '
               DISPLAY 'Debe Ingresar S o N '
               DISPLAY 'PROCESO CANCELADO...'
               PERFORM GNS-PRO-ABT.

       FIN-INI-VAR.
           EXIT.

      ******************************************************************
       PRO-FVD SECTION.
      ****************
       INI-PRO-FVD.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-FVD.
           IF NOT FIO-STAT-OKS
              GO TO FIN-PRO-FVD.


           MOVE FVD-CIC-IOPC IN FVD TO WSS-CIC-IOPC.
           MOVE FVD-VAL-SCRE IN FVD TO WSS-SGV-CAPI.
           MOVE ZEROES              TO WSS-SGV-INTE.
           MOVE 'N'                 TO WSS-EXISTE.
           MOVE 'S'                 TO PRIMER-VEZ.
           MOVE FVD TO WSS-FVX.

       LUP-PRO-FVD.


           IF NOT FIO-STAT-OKS
              IF WSS-EXISTE = 'S'
                  PERFORM LLENAR-FVX
                  GO TO FIN-PRO-FVD
              ELSE
                  GO TO FIN-PRO-FVD.

      * Esto es para las estadisticas.
           ADD 1 TO WSS-NUM-RLEI IN WSS-VARI.
           IF FVD-CIC-IOPC IN FVD = WSS-CIC-IOPC
               IF FVD-IND-CALC IN FVD NOT = 'N' OR
                  PRIMER-VEZ = 'S'
      * DPM INI 28.09.1999
                   MOVE FVD-FEC-FVEN IN FVD TO WSS-FEC-FVEN
      * DPM FIN 28.09.1999
                   MOVE FVD     TO WSS-FVX
                   COMPUTE WSS-SGV-INTE = FVD-SGV-INTE IN FVD +
                                      WSS-SGV-INTE
                   MOVE 'N' TO PRIMER-VEZ
                   MOVE 'S' TO WSS-EXISTE
                   GO TO NXT-PRO-FVD
               ELSE
                   GO TO NXT-PRO-FVD.

           IF WSS-EXISTE = 'S'
               PERFORM LLENAR-FVX.

           MOVE 'N' TO PRIMER-VEZ.
           MOVE 'S' TO WSS-EXISTE.
           MOVE FVD                 TO WSS-FVX.

           MOVE FVD-CIC-IOPC IN FVD TO WSS-CIC-IOPC.
           MOVE FVD-SGV-INTE IN FVD TO WSS-SGV-INTE.
           MOVE FVD-VAL-SCRE IN FVD TO WSS-SGV-CAPI.
      * DPM INI 28.09.1999
           MOVE FVD-FEC-FVEN IN FVD TO WSS-FEC-FVEN.
      * DPM FIN 28.09.1999

           ADD 1 TO WSS-NUM-RSEL IN WSS-VARI.
       NXT-PRO-FVD.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-FVD.
           GO TO LUP-PRO-FVD.
       FIN-PRO-FVD.
           EXIT.



       LLENAR-FVX SECTION.
       INI-LLENAR-FVX.
           MOVE WSS-FVX TO FVX.
           MOVE 'N' TO WSS-EXISTE.
           ADD 1 TO  WSS-NUM-RGRA IN WSS-VARI.
           MOVE WSS-SGV-INTE             TO FVD-SGV-INTE IN FVX.
           MOVE WSS-SGV-CAPI             TO FVD-SGV-CAPI IN FVX.
      *    DISPLAY 'FVX-CIC-IOPC ' FVD-CIC-IOPC IN FVX.
      *    DISPLAY 'FVX-VAL-SCRE ' FVD-VAL-SCRE IN FVX.
      *    DISPLAY 'FVX-SGV-INTE ' FVD-SGV-INTE IN FVX.
      * DPM INI 28.09.1999
           MOVE WSS-FEC-FVEN TO FVD-FEC-FVEN IN FVX.
      * DPM FIN 28.09.1999
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-FVX.
      * DPM INI 28.09.1999
           MOVE ZEROES TO WSS-FEC-FVEN.
      * DPM FIN 28.09.1999
       FIN-LLENAR-FVX.
           EXIT.


      ******************************************************************
       MUESTRA-ESTADISTICAS SECTION.
      *****************************
       INI-MUESTRA-ESTADISTICAS.
           DISPLAY ' '.
           DISPLAY ' ESTADISTICAS DEL PROCESO.'.
           DISPLAY ' -------------------------'.
           DISPLAY ' '.
           DISPLAY 'REGISTROS LEIDOS DE TABLA FVD          : '
                                        WSS-NUM-RLEI IN WSS-VARI.
           DISPLAY 'REGISTROS GRABADOS EN TABLA FVX        : '
                                        WSS-NUM-RGRA IN WSS-VARI.
       FIN-MUESTRA-ESTADISTICAS.
           EXIT.


      ******************************************************************
       CLOSE-FILE SECTION.
      ********************
       INI-CLOSE-FILE.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-FVX.
           PERFORM COL-FIO-FVD.
           MOVE 'COL' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE 'TAB' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
       FIN-CLOSE-FILE.
           EXIT.

      ******************************************************************
      * Copys necesarios para la ejecucion del programa.

       COPY COLBFFVX.
       COPY COLBFFVD.
       COPY GNSBFMSG.
       COPY GNSBFMSC.
       COPY GNSBFTAB.
       COPY GNSBBTAB.
       COPY GNSBBMSG.
       COPY GNSBBMSC.
       COPY GNSBGDTC.

       COPY GNSBGIDD.

       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBGEND.
       COPY GNSBGABT.
