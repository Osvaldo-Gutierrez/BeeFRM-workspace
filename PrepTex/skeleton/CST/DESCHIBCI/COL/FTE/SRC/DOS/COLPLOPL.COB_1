       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPLOPL.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    20-Oct-94 04:00 PM.

      * Programa Listador de Reporte OPL sin Sort.

      *<<<< CMT_ID
      *>>>>

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT RPTOPL       ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTOPL       ASSIGN TO        UT-S-RPTOPL.
           SELECT RPTOPL       ASSIGN TO        UT-S-RPTOPL.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       FD  RPTOPL LABEL RECORD OMITTED
           REPORT IS RPT-OPL
      *<<<< FD_RPT
      *>>>>
           .
      *<<<< FLS
      *>>>>

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY COLBROPC.
       COPY COLRROPL.
      *<<<< RR
      *>>>>
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY COLRWOPL.
      *<<<< RW
      *>>>>
       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
      * COPY COLBROPC.
       COPY COLBRROV.
       COPY COLBRCAN.
       COPY COLBRDLC.
       COPY COLBRDCC.

       COPY GNSWGFEC.
       COPY GNSWGHOY.
      * COPY GNSWGUIB.
       01  WSS-VARI.
          03  WSS-COD-PLZO.
               05  WSS-MSC-TPZO             PIC X(01).
               05  WSS-MSC-CPZO             PIC X(01).
      *    03 WSS-TOT-ACUM.
      *       05 WSS-TOT-LEID                PIC 9(07) VALUE 0.
      *       05 WSS-TOT-PROC                PIC 9(07) VALUE 0.
      *       05 WSS-TOT-ACTU                PIC 9(07) VALUE 0.
      *       05 WSS-TOT-SCLA                PIC 9(07) VALUE 0.
      *       05 WSS-TOT-SDLC                PIC 9(07) VALUE 0.
      *       05 WSS-TOT-CANA                PIC 9(07) VALUE 0.
      *       05 WSS-TOT-SCAN                PIC 9(07) VALUE 0.
      *       05 WSS-TOT-SROV                PIC 9(07) VALUE 0.
          03 WSS-FEC-FINF.
             05 WSS-FEC-DINF                    PIC 9(02).
             05 WSS-FEC-MINF                    PIC 9(02).
             05 WSS-FEC-SINF                    PIC 9(02).
             05 WSS-FEC-AINF                    PIC 9(02).
          03 WSS-FEC-COMP.
             05 WSS-FEC-SCOM                    PIC 9(02).
             05 WSS-FEC-ACOM                    PIC 9(02).
             05 WSS-FEC-MCOM                    PIC 9(02).
             05 WSS-FEC-DCOM                    PIC 9(02).
          03 WSS-FEC-FIN1.
             05 WSS-NUM-DIN1                    PIC 9(02).
             05 WSS-NUM-MIN1                    PIC 9(02).
             05 WSS-NUM-SIN1                    PIC 9(02).
             05 WSS-NUM-AIN1                    PIC 9(02).
          03 WSS-FEC-FSIS.
             05 WSS-NUM-ASIS                    PIC 9(02).
             05 WSS-NUM-MSIS                    PIC 9(02).
             05 WSS-NUM-DSIS                    PIC 9(02).
          03 WSS-HORA-LST.
             05 WSS-NUM-HH                      PIC 9(02).
             05 WSS-NUM-MM                      PIC 9(02).
             05 WSS-NUM-SS                      PIC 9(02).
      *>>>>
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCC-REQA==.
      *>>>>

       REPORT SECTION.
      *--------------
       COPY COLRFOPL.
      *<<<< RF
      *>>>>
           .
       COPY COLRTOPL.
      *<<<< RT
      *>>>>

       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
       DEC-PH-OPL SECTION.
           USE BEFORE REPORTING PH-OPL.
       INI-PH-OPL.
       FIN-PH-OPL.
           EXIT.
       DEC-FF-OPL SECTION.
           USE BEFORE REPORTING FF-OPL.
       INI-FF-OPL.
       FIN-FF-OPL.
           EXIT.
      *<<<< FIN_DEC
      *>>>>
       END DECLARATIVES.

       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'COLPLOPL' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *<<<< INI
      *     COPY GNSBGEDB.
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.
      * Captura Fecha de Proceso
           DISPLAY 'INGRESE FECHA DEL INFORME (DDMMSSAA) '.
           ACCEPT  WSS-FEC-FINF IN WSS-VARI.
           DISPLAY WSS-FEC-FINF IN WSS-VARI.

      *VAL-FEC Valida Fecha de Informe
           DISPLAY 'FECHA DEL INFORME : ' WSS-FEC-FINF IN WSS-VARI.
           MOVE WSS-FEC-FINF IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-ABT.

           MOVE WSS-FEC-DINF IN WSS-VARI TO WSS-FEC-DINF IN WSS-OPL
                                            WSS-FEC-DCOM IN WSS-VARI.
           MOVE WSS-FEC-MINF IN WSS-VARI TO WSS-FEC-MINF IN WSS-OPL
                                            WSS-FEC-MCOM IN WSS-VARI.
           MOVE WSS-FEC-SINF IN WSS-VARI TO WSS-FEC-SINF IN WSS-OPL
                                            WSS-FEC-SCOM IN WSS-VARI.
           MOVE WSS-FEC-AINF IN WSS-VARI TO WSS-FEC-AINF IN WSS-OPL
                                            WSS-FEC-ACOM IN WSS-VARI.
      * Captura Hora del Informe
           ACCEPT WSS-HORA-LST FROM TIME.
      * Captura Fecha del Informe
           ACCEPT WSS-FEC-FSIS FROM DATE.
           MOVE WSS-NUM-DSIS IN WSS-VARI TO WS1-NUM-DPRO IN WSS-OPL.
           MOVE WSS-NUM-MSIS IN WSS-VARI TO WS1-NUM-MPRO IN WSS-OPL.
           MOVE 19                       TO WS1-NUM-SPRO IN WSS-OPL.
           MOVE WSS-NUM-ASIS IN WSS-VARI TO WS1-NUM-APRO IN WSS-OPL.
           MOVE WSS-NUM-HH   IN WSS-VARI TO WS1-NUM-HORA IN WSS-OPL.
           MOVE WSS-NUM-MM   IN WSS-VARI TO WS1-NUM-MINU IN WSS-OPL.
           MOVE WSS-NUM-SS   IN WSS-VARI TO WS1-NUM-SEGU IN WSS-OPL.
      *>>>>
       INI-INP-SRT.
      *<<<< INI_INP
      *>>>>
      *     MOVE 'COLPLOPL' TO RPT-NPGM.
           CALL 'GNSPLHDR' USING RPT-VARI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FST-INP-SRT.
      *<<<< INI_FST_INP
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-OPC.
      *<<<< FIN_FST_INP
      *>>>>
       INI-OUT-SRT.
      *<<<< INI_OUT
      *>>>>
           OPEN OUTPUT RPTOPL.
           INITIATE RPT-OPL.
      *<<<< FST_OUT
      *>>>>
       LUP-MAIN.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
      *<<<< LUP_INP
           PERFORM PRO-OPC.
      *>>>>
       MOV-INP-SRT.
       COPY COLRMOPL.
      *<<<< RM
      *>>>>
       LUP-OUT-SRT.
      *<<<< LUP_OUT
      *>>>>
           MOVE SPACES TO WSS-KEY.
           MOVE SPACES TO WSS-GLS-ERR.
           GENERATE DL-OPL.
      *<<<< FIN_GEN_OUT
      *>>>>
       NXT-INP-SRT.
       NXT-OUT-SRT.
      *<<<< INI_NXT_INP
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-OPC.
      *<<<< FIN_NXT_INP
      *>>>>
           GO TO LUP-MAIN.
       FIN-MAIN.
       FIN-INP-SRT.
      *<<<< FIN_INP
      *>>>>
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FIN-OUT-SRT.
      *<<<< FIN_OUT
           GENERATE DL-OPL.
      *>>>>
           TERMINATE RPT-OPL.
      *<<<< FIN_TMT
      *>>>>
           CLOSE RPTOPL.
      *<<<< FIN
      *>>>>
           IF PGM-STAT-SRT-MAL
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       COPY COLBFOPC.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGABT.

      *<<<< EOF
       PRO-OPC SECTION.
       INI-PRO-OPC.
           ADD 1 TO WSS-TOT-LEID
           IF OPC-FEC-FINP = WSS-FEC-COMP AND
              OPC-COD-TOPC = 'D'             AND
              OPC-MSC-STAT = 'A'             AND
              OPC-VAL-SCRE > ZEROES

      *  Busca DLC para examinar situacion contable
              MOVE OPC-CIC-IOPC TO DLC-CIC-IOPC
              MOVE 001          TO DLC-NUM-IDLC
              MOVE FIO-GET-KEY  TO FIO-CMND
              PERFORM COL-FIO-DLC
              IF FIO-STAT-OKS
      *          Si se encuentra vencida o castigada
                 IF DLC-IND-SCTB = 'VCD' OR 'CAS'
                    ADD 1 TO WSS-TOT-PROC

      *             Busca Relacion Operacion Vencimientos
      *             para obtener operacion original
                    MOVE LOW-VALUES   TO ROV-KEY-IROV
                    MOVE OPC-CIC-IOPC TO ROV-CIC-IOPC
                    MOVE FIO-GET-NLS TO FIO-CMND
                    PERFORM COL-FIO-ROV
                    IF FIO-STAT-OKS AND ROV-CIC-IOPC = OPC-CIC-IOPC

      *                Busca Documento Legal del Credito con clave ROV
      *                para obtener plazo cont. oper. original
                       MOVE ROV-CIC-IOPV TO DLC-CIC-IOPC
                       MOVE 001          TO DLC-NUM-IDLC
                       MOVE FIO-GET-KEY  TO FIO-CMND
                       PERFORM COL-FIO-DLC
                       IF FIO-STAT-OKS
                          MOVE DLC-COD-PLZO TO WSS-COD-PLZO
      *                   Busca Cancelacion para verificar que
      *                   este completa (estado ACA)
                          MOVE FIO-GET-KEY  TO FIO-CMND
                          MOVE ROV-KEY-IVCT TO CAN-KEY-ICAN
                          PERFORM COL-FIO-CAN
                          IF FIO-STAT-OKS
                            IF CAN-MSC-STAT = 'A'
      *                       Busca DLC para obtener datos adicionales
      *                       para accesar la tabla DCC
                              MOVE OPC-CIC-IOPC    TO DLC-CIC-IOPC
                              MOVE 001             TO DLC-NUM-IDLC
                              MOVE FIO-GET-KEY-UPD TO FIO-CMND
                              PERFORM COL-FIO-DLC
                              IF FIO-STAT-OKS
      *                         Busca en el Diccionario de Ctas. Contabl
                                MOVE 'DCC'        TO DCC-COD-TTAB
                                MOVE 'CAP'        TO DCC-MSC-TCCT
                                MOVE OPC-COD-VCOC TO DCC-COD-VCAM
                                MOVE OPC-COD-TOOC TO DCC-COD-TOCR
                                MOVE OPC-COD-AOOC TO DCC-COD-AOCR
                                MOVE WSS-COD-PLZO TO DCC-COD-PLZO
                                MOVE DLC-IND-SCRT TO DCC-IND-SCRT
                                MOVE DLC-IND-SCTB TO DCC-IND-SCTB
                                MOVE DLC-IND-SCBZ TO DCC-IND-SCBZ

                                MOVE FIO-GET-KEY TO FIO-CMND
                                PERFORM COL-FIO-DCC
                                IF FIO-STAT-OKS AND
                                        DCC-IND-VIGE IN DCC = 'S'
      *                            Si existe y esta vigente
      *                            actualiza campo plazo de DLC
                                   ADD 1 TO WSS-TOT-ACTU
                                   MOVE WSS-COD-PLZO TO DLC-COD-PLZO
                                   MOVE FIO-MOD TO FIO-CMND
                                   PERFORM COL-FIO-DLC
                                ELSE
                                  ADD 1 TO WSS-TOT-SCLA
                                  MOVE 'DCC INEXISTENTE O NO VIGENTE'
                                       TO WSS-GLS-ERR
                                  MOVE DCC-COD-TABL TO WSS-KEY
                                  GENERATE DL-OPL
                                  MOVE FIO-ULK-REC TO FIO-CMND
                                  PERFORM COL-FIO-DLC
                              ELSE
                                ADD 1 TO WSS-TOT-SDLC
                                MOVE 'NO EXISTE DLC' TO WSS-GLS-ERR
                                MOVE DLC-KEY-IDLC IN DLC TO WSS-KEY
                                GENERATE DL-OPL
                            ELSE
                              ADD 1 TO WSS-TOT-CANA
                              MOVE 'STATUS <> A EN CAN' TO WSS-GLS-ERR
                              MOVE CAN-KEY-ICAN IN CAN  TO WSS-KEY
                              GENERATE DL-OPL
                          ELSE
                            ADD 1 TO WSS-TOT-SCAN
                            MOVE 'NO EXISTE CAN' TO WSS-GLS-ERR
                            MOVE CAN-KEY-ICAN IN CAN TO WSS-KEY
                            GENERATE DL-OPL
                       ELSE
                         ADD 1 TO WSS-TOT-SDLC
                         MOVE 'NO EXISTE DLC' TO WSS-GLS-ERR
                         MOVE DLC-KEY-IDLC    TO WSS-KEY
                         GENERATE DL-OPL
                    ELSE
                      ADD 1 TO WSS-TOT-SROV
                      MOVE 'NO EXISTE ROV' TO WSS-GLS-ERR
                      MOVE ROV-KEY-IROV    TO WSS-KEY
                      GENERATE DL-OPL
                 ELSE
                   NEXT SENTENCE
              ELSE
                 ADD 1 TO WSS-TOT-SDLC
                 MOVE 'NO EXISTE DLC' TO WSS-GLS-ERR
                 MOVE DLC-KEY-IDLC IN DLC TO WSS-KEY
                 GENERATE DL-OPL.
      *
      * Lee siguiente OPC
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           GO TO LUP-INP-SRT.
       FIN-PRO-OPC.
           EXIT.

      * COPY COLBFOPC.
       COPY COLBFROV.
       COPY COLBFCAN.
       COPY COLBFDLC.
       COPY COLBFDCC.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBBMSG.
      *>>>>
