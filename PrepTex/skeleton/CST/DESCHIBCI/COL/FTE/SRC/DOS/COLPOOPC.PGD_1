       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.    COLPOOPC.
       AUTHOR.        BEE-TEAM (EX-CONSIST).
       DATE-WRITTEN.  20-JUN-1997 (RBG ULTIMA MODIFICACION).

      * ACTUALIZA ARCHIVO COLOPC EN FORMA INTERACTIVA.

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *==============
       WORKING-STORAGE SECTION.
      *------------------------
       COPY COLBROPC.

       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSBRMSG.
       COPY GNSBRMSC.
       COPY GNSWCFIO.
       COPY GNSWVFIO.

      * PTC ini
      *COPY GNSWGFRM.
       COPY GNSWG3CF.
       COPY GNSWGQUE.
       COPY GNSWVIDD.
       COPY GNSWCSCR.
      *COPY GNSWVSCR.
       COPY GNSWV3CR.
      * PTC fin
      *<<<< FIN_SCR_VARI
       COPY GNSWGRQA REPLACING ==01  ADR-REQA== BY ==02  SCR-RQA1==.
       COPY GNSWGRQA REPLACING ==01  ADR-REQA== BY ==02  SCR-RQA2==.
           02 SCR-KEY-IRDC                         PIC X(04).
           02 SCR-IND-MRDC                         PIC X(01).
           02 SCR-IND-MITR                         PIC X(01).
           02 SCR-IND-MCOM                         PIC X(01).
           02 SCR-IND-MCYA                         PIC X(01).
           02 SCR-MSC-TCAN                         PIC X(01).
           02 SCR-IND-ACAN                         PIC X(03).
      *JUS ini  29-NOV-1994
           02 SCR-IND-CTBL                         PIC X(01).
      *JUS fin  29-NOV-1994
      *>>>>
       COPY COLWIOPC.
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGSYS.
      *<<<< WSS
       COPY GNSBRTAB.
       COPY TABBROFI.
       COPY TABBRUSR.
       COPY GNSWGPES.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGIDC.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       COPY SGCBRDBC.
      *RVM-CST-INI 14-OCT-1996
       COPY SGCBRDCP.
       COPY SGCBRDCE.
      *RVM-CST-FIN 14-OCT-1996
       COPY COLBRRDC.
       COPY COLBRITR.
       COPY COLBRCOM.
       COPY COLBRCYA.
       COPY COLBRDLC.
       COPY COLBREVC.
       COPY COLBRVEN.
      *SMC-INI 27.08.1993
       COPY COLWGVEN.
       COPY COLWGVIN.
       COPY COLWGINT.
      *SMC-FIN 27.08.1993
      *Registros incorporados para cambio de entidades por prorrogas
       COPY COLBRCCB.
       COPY COLBRCCR.
       COPY COLBRCCT.
       COPY COLBRCUF.
       COPY COLBRICG.
       COPY COLBRRCE.
       COPY COLBRRCV.
       COPY COLBRRDT.
      *
       COPY COLBRROV.
       COPY COLBRAUT.
       COPY COLBRCAN.
       COPY COLBRMVO.
       COPY COLBRTOC.
      *RVM-CST-INI 6-AUG-1996
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-SDC-REQA==.
       COPY SGCBRDCC REPLACING ==01  DCC== BY ==01  SDC==.
      *RVM-CST-FIN 6-AUG-1996
       COPY COLWGMVO.
       COPY GNSWGCPT.
       COPY GNSWGSTR.
       COPY SGCBRRCO.
       COPY SGCBROPE.
       COPY SGCBRRCD.
       COPY COLBRICC.
       COPY TABBRCAM.
      *JPA ini  23-01-95
       COPY COLBRPOC.
      *JPA fin  23-01-95
      *ALD/8-AUG-1988
       COPY DEUBRDBD.
       COPY COLWGRNO.
       COPY COLWGCEO.
      *
      *DAD ini  21-JUL-1992
       COPY COLWGLAV.
      *DAD fin  21-JUL-1992

       01  WSS-VARI.
      *RVM-CST-INI 30-JAN-1997
           03  WSS-DAT-POS45.
               05  FILLER                             PIC X(02).
               05  WSS-COD-POS45                      PIC X(01).
      *RVM-CST-FIN 30-JAN-1997
      *SMC-INI 27.08.1993
           03 WSS-NUM-NICG                             PIC 9(03).
           03 WSS-NUM-IVEN                             PIC 9(03).
      *SMC-FIN 27.08.1993
      *JPA ini  23-01-95     DADO EL USO DEL MODULO DE MANEJO BQ
           03 WSS-CAI-ICIC.
              05 WSS-COD-TCIC                     PIC X(01).
              05 WSS-COD-CCIC                     PIC X(03).
           03  WSS-MSC-TCAN                       PIC X(01).
           03  WSS-CPT-NOMB.
               05  WSS-CPT-DESC                   PIC X(40).
               05  WSS-CPT-IOPV                   PIC X(12).
               05  WSS-CPT-DATA                   PIC X(40).
           03  WSS-CPT-NOMB-R REDEFINES WSS-CPT-NOMB PIC X(92).
      *JPA fin  23-01-95
      *JUS ini  29-NOV-1994
      *        Flag auxiliar para control de activacion sin contabilizar
           03 WSS-IND-CTBL                             PIC X(01).
      *JUS fin  29-NOV-1994
      *DAD ini  18-JUL-1994   (Memo.23-06-94)
           03  WSS-COD-OFOC                        PIC X(03).
      *DAD fin  18-JUL-1994
      *DAD ini  21-JUL-1992
           03 WSS-CIC-ILDC.
              05 WSS-CAI-ILDC                          PIC X(04).
              05 WSS-IIC-ILDC                          PIC 9(08).
      *DAD fin  21-JUL-1992
           03  BUS-POR-KEYS       VALUE SPACES         PIC X(01).
           03  BUS-POR-CLTE       VALUE 'C'            PIC X(01).
           03  WSS-IND-PCYA       VALUE 'S'            PIC X(01).
           03  WSS-IND-PAUT       VALUE 'N'            PIC X(01).
           03  WSS-GLS-DAT1       VALUE SPACES         PIC X(01).
           03  WSS-COD-CAUX.
               05  WSS-COD-TOOC                        PIC X(03).
               05  WSS-COD-AOOC                        PIC X(03).
      * RBG/INI/18-OCT-1996
           03  WSS-COD-UAUX.
               05  WSS-COD-USUARIO                     PIC X(09).
               05  WSS-COD-OFICINA                     PIC X(03).
      * RBG/FIN/18-OCT-1996  
           03  WSS-OPC-LNBT                            PIC X(01).
      *ISP RENOVACIONES
      * ALD-BCI-INI/14.06.1996
           03  WSS-ROV-RENO     COMP-3 VALUE ZEROES PIC S9(11)V9(04).
           03  WSS-VAL-DIFE     COMP-3 VALUE ZEROES PIC  9(11)V9(04).
           03  WSS-SGV-RENO-PES COMP-3 VALUE ZEROES PIC S9(11)V9(04).
           03  WSS-VAL-PASO            VALUE ZEROES PIC  9(01)V9(04).
      * ALD-BCI-FIN/14.06.1996
           03  WSS-SGV-RENO     COMP-3 VALUE ZEROES PIC S9(11)V9(04).
           03  WSS-ROV-SGV-RENO COMP-3 VALUE ZEROES PIC S9(11)V9(04).
           03  WSS-ROV-COD-VCVR                     PIC X(06).
           03  WSS-CIC-IOPV                       PIC X(12).
           03  WSS-MENS.
               05  WSS-DCOR                       PIC X(12).
               05  EDT-CAN-SGV-TREN PIC  --.---.---.--9,99999.
               05  WSS-ABRV                       PIC X(05).
               05  EDT-WSS-SGV-RENO PIC  --.---.---.--9,99999.
               05  WSS-DESC                       PIC X(40).
           03  EDT-OPC-VAL-CRED     PIC  --.---.---.--9,99999.
           03  RCAN-CAN-KEY-ICAN                  PIC X(15).
           03  WSS-TOT-RCAN   VALUE ZEROES        PIC 9(04).
           03  WSS-VLR.
               05  WSS-CIC-VCAM.
      *
      *            Tipo Valor
                   07  WSS-CIC-TVAL                     PIC X(01).
      *
      *            Codigo Valor
                   07  WSS-CIC-CVAL                     PIC X(03).
      *
      *            Tipo Cambio
                   07  WSS-CIC-TCAM                     PIC X(08).
      *
           03  WSS-PCAN                             PIC X(08).
      *
      *DAD ini  13-MAR-1995 / 01-MAR-1995   (Manejo LDC  LINEA de AVANCE
        COPY COLWGLDC.
      *DAD fin  13-MAR-1995 / 01-MAR-1995
      *DAD ini  02-AUG-1994       (Manejo de LDC)
       COPY LDCWGCCU.
       COPY LDCWGCEG.
       COPY SGCWGGRP.
       COPY SGCBRREC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-REC-REQA==.
      *DAD fin  02-AUG-1994
       COPY COLWGADO.
      *DAD ini  02-ENE-1992   (Memo.09-12-91)
           COPY USPC113.
      *DAD fin  02-ENE-1992
      *>>>>
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *RVM-CST-INI 14-OCT-1996
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCE-REQA==.
      *RVM-CST-FIN 14-OCT-1996
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CCB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CCR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CCT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CUF-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MVO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *JPA ini  23-01-94
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-POC-REQA==.
      *JPA fin  23-01-94
      *ALD/8-AUG-1988
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBD-REQA==.
      *
      *>>>>
       01  PGM-VARI.
           03 PGM-ICKY                 VALUE 0 PIC 9(01).
              88 PGM-LIMPIAR-LLAVES    VALUE 0.
              88 PGM-NO-LIMPIAR-LLAVES VALUE 1.
           03 PGM-STAT.
              05 PGM-STAT-OPC           VALUE '23'      PIC X(02).
                 88 PGM-STAT-OPC-OKS    VALUE '00'.
                 88 PGM-STAT-OPC-NUL    VALUE '  '.
              05 PGM-STAT-RDC           VALUE '23'      PIC X(02).
                 88 PGM-STAT-RDC-OKS    VALUE '00'.
                 88 PGM-STAT-RDC-NUL    VALUE '  '.
              05 PGM-STAT-DBC           VALUE '23'      PIC X(02).
                 88 PGM-STAT-DBC-OKS    VALUE '00'.
                 88 PGM-STAT-DBC-NUL    VALUE '  '.
              05 PGM-STAT-RCD           VALUE '23'      PIC X(02).
                 88 PGM-STAT-RCD-OKS    VALUE '00'.
                 88 PGM-STAT-RCD-NUL    VALUE '  '.
              05 PGM-STAT-ROV           VALUE '23'      PIC X(02).
                 88 PGM-STAT-ROV-OKS    VALUE '00'.
                 88 PGM-STAT-ROV-NUL    VALUE '  '.
              05 PGM-STAT-ITR           VALUE '23'      PIC X(02).
                 88 PGM-STAT-ITR-OKS    VALUE '00'.
                 88 PGM-STAT-ITR-NUL    VALUE '  '.
              05 PGM-STAT-COM           VALUE '23'      PIC X(02).
                 88 PGM-STAT-COM-OKS    VALUE '00'.
                 88 PGM-STAT-COM-NUL    VALUE '  '.
              05 PGM-STAT-CYA           VALUE '23'      PIC X(02).
                 88 PGM-STAT-CYA-OKS    VALUE '00'.
                 88 PGM-STAT-CYA-NUL    VALUE '  '.
              05 PGM-STAT-AUT           VALUE '23'      PIC X(02).
                 88 PGM-STAT-AUT-OKS    VALUE '00'.
                 88 PGM-STAT-AUT-NUL    VALUE '  '.
              05 PGM-STAT-CAN           VALUE '23'      PIC X(02).
                 88 PGM-STAT-CAN-OKS    VALUE '00'.
                 88 PGM-STAT-CAN-NUL    VALUE '  '.

       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
      *<<<< CMA
           02 FILLER                      PIC X(3000).
      *>>>>
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Para Proceso Genera y Activa con registro MVO (Pro. Linea)
      * COPY GNSLGFIO.
       COPY COLLGCCT.
      *DAD fin  17-MAY-1993


       PROCEDURE DIVISION.
      *===================
       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
       LUP-MAIN.
           IF SCR-INST = SCR-INST-HCM
                 PERFORM SCR-COM.
           IF SCR-CCPP = 'ACC'
               IF SCR-STPP = SCR-STAT-CON OR SCR-STAT-SON
                   PERFORM SCR-ACC
               ELSE
                   MOVE 'GNS'          TO MSG-COD-SIST
                   MOVE 'SPP    NOSOP' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN1
                   MOVE SCR-STPP     TO FRM-MEN2
                   PERFORM SCR-MSSG
                   PERFORM SCR-COM
           ELSE
               MOVE 'GNS'          TO MSG-COD-SIST
               MOVE 'CPP    NOSOP' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE SCR-CCPP     TO FRM-MEN2
               PERFORM SCR-MSSG
               PERFORM SCR-COM.
           GO TO LUP-MAIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
       COPY GNSBGEIB.
       COPY GNSBGEDB.
           MOVE LOW-VALUES TO OPC-FLD.
           PERFORM GNS-PRO-RCK.
           PERFORM GNS-BUS-VCA.
           PERFORM GNS-HDL-SYS.
           PERFORM GNS-HDL-FRM.
           PERFORM GNS-HDL-VSM.
           MOVE 'COLPOOPC' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      * PTC ini
           PERFORM GNS-ERR-QUE.
      * PTC fin
      *<<<< INI_FIO
           MOVE +3000 TO SCR-TCMA.
           IF SCR-DESDE-CMN
                MOVE SPACES TO SCR-KEY-IRDC
                MOVE SPACES TO SCR-IND-MRDC
                MOVE SPACES TO SCR-IND-MITR
                MOVE SPACES TO SCR-IND-MCOM
                MOVE SPACES TO SCR-IND-MCYA
                MOVE SPACES TO SCR-IND-ACAN
                MOVE SPACES TO SCR-MSC-TCAN.
      *>>>>
      *JSS 9-APR-1991 18:37:24
           MOVE 'COL'    TO FIO-SIST.
           MOVE 'VSN'    TO TAB-COD-TTAB IN TAB.
           MOVE 'PGMCAN' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND ( TAB-MSC-STAT IN TAB = 'S' )
               MOVE TAB-GLS-DCOR IN TAB TO WSS-PCAN
           ELSE
               MOVE 'COLPOCAN'          TO WSS-PCAN.
      *
       FIN-INI.
           EXIT.

       COPY GNSBHSYS.
       COPY GNSBHFRM.
       COPY GNSBHVSM.
       COPY GNSBPRCK.
       COPY GNSBBVCA.
       COPY GNSBBIDD.

       SCR-COM SECTION.
       INI-SCR-COM.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-OPC.
           PERFORM EDT-KEY-OPC.
           PERFORM EDT-FLD-OPC.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-HCM TO SCR-INST.
           MOVE SCR-CMNP     TO SYS-PROG.
           MOVE SCR-VARI     TO SYS-CMMA.
           MOVE SCR-TCMA     TO SYS-TCMA.
           MOVE SYS-XCTL     TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
           MOVE FRM-CLR-FRM  TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE 'XCTERR    ' TO MSG-COD-MENS.
           MOVE 'GNS'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE FRM-MSG      TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       COPY GNSBGGBK.
       FIN-SCR-COM.
           EXIT.

       SCR-ACC SECTION.
       INI-SCR-ACC.
           IF SCR-INST = SCR-INST-HKY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM HBL-KEY
               IF PGM-LIMPIAR-LLAVES
                   PERFORM SCR-CLRA-OPC
                   PERFORM EDT-KEY-OPC
                   PERFORM EDT-FLD-OPC
                   PERFORM SCR-PUTA
                   PERFORM SCR-EXIT
               ELSE
                   PERFORM CLR-FLD-OPC
                   PERFORM EDT-FLD-OPC
                   PERFORM SCR-PUTA
                   PERFORM SCR-EXIT
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ACC
           ELSE
           IF SCR-INST = SCR-INST-GCS
                PERFORM GET-ACC
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON.
           PERFORM DESSCRTRL.
           MOVE SPACES TO FRM-MENS.
           IF SCR-STAT NOT = SCR-STAT-CON
               PERFORM CMN-ACC.
           PERFORM SCR-MSSG.
       FIN-SCR-ACC.
           EXIT.

       SCR-KEY SECTION.
       INI-SCR-KEY.
           PERFORM SCR-RST.
           PERFORM GET-KEY.
           IF FRM-STAT-ABT
                   MOVE SPACES TO FRM-MENS
                   PERFORM SCR-MSSG
                   GO TO FIN-SCR-KEY.
       FND-SCR-KEY.
           MOVE SPACES TO FRM-MENS.
           PERFORM FND-KEY.
           IF FIO-STAT-OKS
               PERFORM PUT-SCR
               MOVE 0 TO PGM-ICKY
               GO TO FIN-SCR-KEY.
      *JSS ELSE
      *        PERFORM CLR-FLD-OPC.
       ERR-SCR-KEY.
      * PTC: JSS
           MOVE 'S' TO SCR-IERR.
      *
           MOVE 1 TO PGM-ICKY.
           IF FRM-MENS NOT > SPACES
               IF FIO-STAT-EOF
                   MOVE 'REGEOF    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
               IF FIO-STAT = FIO-STAT-NEX
                   MOVE 'REGNEX    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
           MOVE SCR-STAT-ABT TO SCR-STAT.
        FIN-SCR-KEY.
           EXIT.

       SCR-RST SECTION.
       INI-SCR-RST.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
           MOVE LOW-VALUES   TO OPC-FLD.
       FIN-SCR-RST.
           EXIT.

       GET-KEY SECTION.
       INI-GET-KEY.
           PERFORM SCR-GKEY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-KEY.
           EXIT.

       FND-KEY SECTION.
       INI-FND-KEY.
           PERFORM KEY-ALL-OPC.
      *<<<< FND_KEY
           IF OPC-IIC-IOPC IN OPC-FLD > ZEROES
               GO TO CON-FND-KEY
           ELSE
           IF DBC-NUM-ICLI IN OPC-FLD > ZEROES
      *IDC-CLI Busca Cliente por medio de IdC
               MOVE DBC-NUM-ICLI IN OPC-FLD TO DBC-NUM-ICLI IN DBC
               MOVE DBC-IND-ICLI IN OPC-FLD TO DBC-IND-ICLI IN DBC
               MOVE DBC-GLS-ICLI IN OPC-FLD TO DBC-GLS-ICLI IN DBC
               MOVE 'DBC-IDC-ICLI' TO FIO-AKEY
               MOVE FIO-GET-KEY    TO FIO-CMND
               PERFORM ANL-KEY-OPC
               IF NOT FIO-STAT-OKS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN2
                   MOVE '00'         TO FIO-STAT
                   MOVE SCR-STAT-CON TO SCR-STAT
                   GO TO FIN-FND-KEY
               ELSE
                   NEXT SENTENCE
           ELSE
           IF DBC-GLS-NOMC IN OPC-FLD > SPACES
      *NOM-CLI Busca Cliente por medio del Nombre

               MOVE DBC-GLS-NOMC IN OPC-FLD TO STR-GLS-GSTR
               PERFORM STR-UNS
               MOVE STR-GLS-FUNS IN STR-VARI(1) TO DBC-GLS-APAT IN DBC
               MOVE STR-GLS-FUNS IN STR-VARI(2) TO DBC-GLS-AMAT IN DBC
               MOVE STR-GLS-FUNS IN STR-VARI(3) TO DBC-GLS-NOMB IN DBC

               MOVE 'DBC-GLS-NOMC'  TO FIO-AKEY
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM ANL-KEY-OPC
               IF NOT FIO-STAT-OKS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN2
                   MOVE '00'         TO FIO-STAT
                   MOVE SCR-STAT-CON TO SCR-STAT
                   GO TO FIN-FND-KEY.
       CON-FND-KEY.
      *>>>>
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           MOVE FIO-STAT TO PGM-STAT-OPC.
      *<<<< FIN_FND_KEY
           IF NOT FIO-STAT-OKS
               GO TO FIN-FND-KEY.

           MOVE '00' TO PGM-STAT-OPC.
           IF NOT BUS-POR-KEYS = BUS-POR-CLTE
               GO TO OPC-FND-KEY.
           PERFORM GET-CUR-RDC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'RDC    INCKY' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
           PERFORM GET-NXT-RDC.
           IF SCR-IND-MRDC = 'M'
               MOVE MSG-GLS-DESC TO FRM-MENS.
           GO TO ANL-CLI.
       OPC-FND-KEY.
           PERFORM GET-CUR-RDC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'OPC    NORDC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
           MOVE '00'   TO PGM-STAT-RDC.
           MOVE 'IDLC' TO SCR-KEY-IRDC.
           PERFORM GET-NXT-RDC.
           IF SCR-IND-MRDC = 'M'
               MOVE 'M'          TO DBC-IND-ICLI IN OPC-FLD
               MOVE MSG-GLS-DESC TO DBC-GLS-NOMC IN DBC
               MOVE SPACES TO MSG-COD-SIST
               MOVE SPACES TO MSG-COD-MENS
               GO TO ANL-CLI.
           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'RDC    NOCLI' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
           MOVE '00' TO PGM-STAT-DBC.
           MOVE ADR-DBC-REQA TO SCR-RQA1.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN            TO DBC-GLS-NOMC IN OPC-FLD.
           MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN OPC-FLD.
           MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN OPC-FLD.
           MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN OPC-FLD.
           MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN OPC-FLD.
       ANL-CLI.
           PERFORM ANL-KEY-ALL.
           IF MSG-COD-MENS NOT = SPACES
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
       REC-OPC-STAT.
           MOVE PGM-STAT-OPC TO FIO-STAT.
           IF OPC-MSC-STAT IN OPC = 'A'
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'OPC    ACAYA' TO MSG-COD-MENS
               PERFORM GET-MSG

               MOVE MSG-GLS-DESC TO CPT-STR1
               MOVE MSG-GLS-DATA TO CPT-STR2
               PERFORM CPT-BLKS
               MOVE CPT-STRN     TO FRM-MENS

               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.

           IF OPC-MSC-STAT IN OPC = 'D'
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'OPC    DESYA' TO MSG-COD-MENS
               PERFORM GET-MSG

               MOVE MSG-GLS-DESC TO CPT-STR1
               MOVE MSG-GLS-DATA TO CPT-STR2
               PERFORM CPT-BLKS
               MOVE CPT-STRN     TO FRM-MENS

               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.

           IF OPC-MSC-STAT IN OPC = 'S'
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'OPC    SUSYA' TO MSG-COD-MENS
               PERFORM GET-MSG

               MOVE MSG-GLS-DESC TO CPT-STR1
               MOVE MSG-GLS-DATA TO CPT-STR2
               PERFORM CPT-BLKS
               MOVE CPT-STRN     TO FRM-MENS

               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.

      *JSS 16-MAY-1991 15:32:57 ( para manejo de cuenta corriente )
           IF OPC-MSC-STAT IN OPC = 'X' OR 'B' OR 'G'
               MOVE 'COL'               TO MSG-COD-SIST
               MOVE 'OPCSTT'            TO MSG-COD-TMSG
               MOVE OPC-MSC-STAT IN OPC TO MSG-COD-CMSG
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE SCR-STAT-CON TO SCR-STAT
               MOVE '00'         TO FIO-STAT
               GO TO FIN-FND-KEY.
      *
      *DAD ini  01-MAR-1995   (Manejo LDC  Comando APR )
      *     IF NOT ( OPC-MSC-STAT IN OPC = 'L' )
           IF NOT ( OPC-MSC-STAT IN OPC = 'L' OR
                    OPC-MSC-STAT IN OPC = 'J' )
      *DAD fin  01-MAR-1995
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'OPC    LIQNO' TO MSG-COD-MENS
               PERFORM GET-MSG

               MOVE MSG-GLS-DESC TO CPT-STR1
               MOVE MSG-GLS-DATA TO CPT-STR2
               PERFORM CPT-BLKS
               MOVE CPT-STRN     TO FRM-MENS

               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
           PERFORM GET-FEC-FACO.
      *JUS ini  29-NOV-1994    Incorporando comando ANC para dejar
      *                        No Contabilizable la Operacion
           MOVE 'S' TO WSS-IND-CTBL IN WSS-VARI.
           IF SCR-CMND = 'ANC'
               IF OPC-FEC-FCOL IN OPC = OPC-FEC-FINP IN OPC
                   MOVE 'N'   TO WSS-IND-CTBL IN WSS-VARI
                   MOVE 'ACA' TO SCR-CMND
               ELSE
               IF OPC-FEC-FCOL IN OPC < OPC-FEC-FINP IN OPC
                   MOVE 'N'   TO WSS-IND-CTBL IN WSS-VARI
                   MOVE 'ACO' TO SCR-CMND.

      * RBG INI 22-APR-1996 
      *    IF SCR-CMND = 'ACA' OR SCR-CMND = 'ACO'
      *ALD-BCI-INI/28.08.1996
      *    IF SCR-CMND = 'ACA' OR SCR-CMND = 'ACO' OR SCR-CMND = 'ACB'
      *ALD-BCI-FIN/28.08.1996
               MOVE WSS-IND-CTBL IN WSS-VARI TO
                    SCR-IND-CTBL IN SCR-VARI.
           IF (SCR-CMND = 'ACA' OR SCR-CMND = 'ACO' OR SCR-CMND = 'ASO'
           OR  SCR-CMND = 'ASC') AND (CYA-IND-TCYA IN OPC-FLD = 'CTBL')
               MOVE 'COL'         TO MSG-COD-SIST
               MOVE 'CODCTBLNOVA' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.

           IF (SCR-CMND = 'ACB' OR SCR-CMND = 'ASB')
           AND (CYA-IND-TCYA IN OPC-FLD NOT = 'CTBL')
               MOVE 'COL'         TO MSG-COD-SIST
               MOVE 'CODCTBLNOVA' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-FND-KEY.
      * RBG FIN 22-APR-1996  

      *JUS fin  29-NOV-1994
      *DAD ini  01-MAR-1995   (Manejo LDC )
           IF ( SCR-CMND = 'ACA' OR
                SCR-CMND = 'ASC' ) AND
      *DAD fin  01-MAR-1995
              OPC-FEC-FINP IN OPC NOT = OPC-FEC-FCOL IN OPC
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'FECFINPFCOLD' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO CPT-STR1
               MOVE MSG-GLS-DATA TO CPT-STR2
               PERFORM CPT-BLKS
               MOVE CPT-STRN     TO FRM-MENS

               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
      *ALD-BCI-INI/17.07.1996
      *DAD ini  01-MAR-1995   (Manejo LDC  Comando APR )
      *     IF ( SCR-CMND = 'ACO' OR
      *          SCR-CMND = 'ASO' ) AND
      *DAD fin  01-MAR-1995
      *        OPC-FEC-FINP IN OPC NOT = OPC-FEC-FCOL IN OPC AND
      *        WSS-IND-PAUT IN WSS-VARI = 'S'
      *         MOVE 'COL'          TO MSG-COD-SIST
      *         MOVE 'TCYAAUTNOACA' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         MOVE MSG-GLS-DESC TO CPT-STR1
      *         MOVE MSG-GLS-DATA TO CPT-STR2
      *         PERFORM CPT-BLKS
      *         MOVE CPT-STRN     TO FRM-MENS
      *         MOVE '00'         TO FIO-STAT
      *         MOVE SCR-STAT-CON TO SCR-STAT
      *         GO TO FIN-FND-KEY.
      *ALD-BCI-FIN/17.07.1996

      *ALD/8-AUG-1988
           IF DBC-IND-ICLI IN OPC-FLD = 'M'
               GO TO UPD-OPE.
           MOVE RDC-CIC-ICLI IN RDC TO RCO-CIC-ICLI IN RCO.
           MOVE OPC-CIC-IOPC IN OPC TO RCO-CIC-IOPE IN RCO.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'RCO    YAEXI' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
       UPD-OPE.
           MOVE OPC-CIC-IOPC IN OPC TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'OPE    YAEXI' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
           IF OPC-IND-RENO IN OPC NOT > SPACES
                GO TO NOT-BUS-ROV.

           PERFORM BUS-CIC-RENO
           IF OPC-IND-RENO IN OPC = RNO-CIC-NOV IN RNO-VARI
               PERFORM GET-ROV-NOV
               IF MSG-COD-MENS > SPACES
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE '00'         TO FIO-STAT
                   MOVE SCR-STAT-CON TO SCR-STAT
                   GO TO FIN-FND-KEY
               ELSE
      * RBG INI 22-APR-1996 
      *        IF ( SCR-CMND = 'ACA' OR 'ACO' ) AND
      *              PGM-STAT-CAN-OKS
               IF ( SCR-CMND = 'ACA' OR SCR-CMND = 'ACO'
                  OR SCR-CMND = 'ACB') AND PGM-STAT-CAN-OKS
      * RBG FIN 22-APR-1996 
      *JSS 15-MAY-1991 20:41:00 ( agregado OR 'P' para manejo de cc )
                     IF NOT ( CAN-MSC-STAT IN CAN = 'C' OR 'W' OR 'P' )
                         MOVE 'NOVSTAT INV' TO MSG-COD-MENS
                         PERFORM MSG-ABT-KEY
                         GO TO FIN-FND-KEY
                     ELSE
                         PERFORM BUS-CNC
                         IF SCR-MSC-TCAN = 'N'
                             PERFORM VRF-ROV-NOV
                             IF CAN-SGV-TREN IN CAN > WSS-SGV-RENO
                                 MOVE CAN-SGV-TREN IN CAN TO
                                      EDT-CAN-SGV-TREN
                                 MOVE WSS-SGV-RENO TO
                                      EDT-WSS-SGV-RENO
                                 MOVE 'COL'         TO MSG-COD-SIST
                                 MOVE 'TOTOPC NOV<' TO MSG-COD-MENS
                                 PERFORM GET-MSG
      * NO ES NECESARIO ABORTAR, SE ACTIVAN CON STATUS ESPECIAL
      *                          STRING MSG-GLS-DCOR
      *                                 EDT-CAN-SGV-TREN
      *                                 MSG-GLS-ABRV
      *                                 EDT-WSS-SGV-RENO
      *                                 MSG-GLS-DESC
      *                                 DELIMITED BY SIZE
      *                          INTO FRM-MENS

                                 MOVE MSG-GLS-DCOR TO WSS-DCOR
                                 MOVE CAN-SGV-TREN IN CAN TO
                                      EDT-CAN-SGV-TREN
                                 MOVE MSG-GLS-ABRV TO WSS-ABRV
                                 MOVE WSS-SGV-RENO TO
                                      EDT-WSS-SGV-RENO
                                 MOVE MSG-GLS-DESC TO WSS-DESC
                                 MOVE WSS-MENS     TO CPT-STRN
                                 PERFORM CPT-BLKS
                                 MOVE CPT-STRN     TO FRM-MENS
                                 MOVE WSS-ROV-SGV-RENO TO
                                      ROV-SGV-RENO IN ROV
                                 MOVE WSS-ROV-COD-VCVR TO
                                      ROV-COD-VCVR IN ROV
                             ELSE
                                 MOVE 'COL'        TO MSG-COD-SIST
                                 MOVE 'ACAOPC NOV' TO MSG-COD-MENS
                                 PERFORM GET-MSG

                                 MOVE MSG-GLS-DESC TO CPT-STR1
                                 MOVE MSG-GLS-DATA TO CPT-STR2
                                 PERFORM CPT-BLKS
                                 MOVE CPT-STRN     TO FRM-MENS
                                 MOVE 'NOV' TO SCR-IND-ACAN
                                 MOVE WSS-ROV-COD-VCVR TO
                                      ROV-COD-VCVR IN ROV
                                 MOVE WSS-ROV-SGV-RENO TO
                                      ROV-SGV-RENO IN ROV.
      *                           COMPUTE ROV-SGV-RENO IN ROV =
      *                                   WSS-ROV-SGV-RENO -
      *                                 ( WSS-SGV-RENO -
      *                                   CAN-SGV-TREN IN CAN ).

           PERFORM BUS-CIC-RENO
           IF (OPC-IND-RENO IN OPC = RNO-CIC-REN IN RNO-VARI) OR
              (OPC-IND-RENO IN OPC = RNO-CIC-PRO IN RNO-VARI)
               PERFORM GET-ROV-REN
      *         IF ( SCR-CMND = 'ACA' OR 'ACO' )
      *             IF WSS-SGV-RENO > OPC-VAL-CRED IN OPC
      *                  MOVE OPC-VAL-CRED IN OPC TO EDT-OPC-VAL-CRED
      *                  MOVE WSS-SGV-RENO TO EDT-WSS-SGV-RENO
      *                  MOVE 'COL' TO MSG-COD-SIST
      *                  MOVE 'TOTOPC REN<' TO MSG-COD-MENS
      *                  PERFORM GET-MSG
      * NO ES NECESARIO ABORTAR PUES EN INGRESO VALIDO QUE EL MONTO
      * DEL CREDITO NO SEA MENOR QUE LA SUMA LAS CANCELACIONES ASOCIADAS
      *                 STRING MSG-GLS-DCOR
      *                        EDT-OPC-VAL-CRED
      *                        MSG-GLS-ABRV
      *                        EDT-WSS-SGV-RENO
      *                        MSG-GLS-DESC
      *                        DELIMITED BY SIZE
      *                 INTO FRM-MENS
      *                  MOVE MSG-GLS-DCOR TO WSS-DCOR
      *                  MOVE OPC-VAL-CRED IN OPC TO EDT-CAN-SGV-TREN
      *                  MOVE MSG-GLS-ABRV TO WSS-ABRV
      *                  MOVE WSS-SGV-RENO TO EDT-WSS-SGV-RENO
      *                  MOVE MSG-GLS-DESC TO WSS-DESC
      *                  MOVE WSS-MENS     TO CPT-STRN
      *                  PERFORM CPT-BLKS
      *                  MOVE CPT-STRN     TO FRM-MENS
      *             ELSE
                        IF OPC-IND-RENO IN OPC = RNO-CIC-REN IN RNO-VARI
                            MOVE 'COL'        TO MSG-COD-SIST
                            MOVE 'ACAOPC REN' TO MSG-COD-MENS
                            MOVE 'REN' TO SCR-IND-ACAN
                            PERFORM GET-MSG
                            MOVE MSG-GLS-DESC TO CPT-STR1
                            MOVE MSG-GLS-DATA TO CPT-STR2
                            PERFORM CPT-BLKS
                            MOVE CPT-STRN     TO FRM-MENS
                            COMPUTE ROV-SGV-RENO IN ROV =
                                  OPC-VAL-CRED IN OPC -
                                ( OPC-VAL-CRED IN OPC - WSS-SGV-RENO )
                        ELSE
                            IF OPC-IND-RENO IN OPC = RNO-CIC-PRO
                                                     IN RNO-VARI
                                MOVE 'COL'        TO MSG-COD-SIST
                                MOVE 'ACAOPC PRO' TO MSG-COD-MENS
                                MOVE 'PRO'        TO SCR-IND-ACAN
                                PERFORM GET-MSG
                                MOVE MSG-GLS-DESC TO CPT-STR1
                                MOVE MSG-GLS-DATA TO CPT-STR2
                                PERFORM CPT-BLKS
                                MOVE CPT-STRN     TO FRM-MENS
                                COMPUTE ROV-SGV-RENO IN ROV =
                                      OPC-VAL-CRED IN OPC -
                                ( OPC-VAL-CRED IN OPC - WSS-SGV-RENO ).

      *DAD ini  20-ABR-1992   (Memo.13-03-92 pto.1)
           IF CAN-MSC-STAT IN CAN NOT = 'C'
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CAN    IOPNO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO CPT-STR1
               MOVE MSG-GLS-DATA TO CPT-STR2
               PERFORM CPT-BLKS
               MOVE CPT-STRN     TO FRM-MENS
               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
      *DAD fin  20-ABR-1992
       NOT-BUS-ROV.
           MOVE PGM-STAT-OPC TO FIO-STAT.
      *>>>>
       FIN-FND-KEY.
      * PTC: JSS
           IF FIO-STAT = FIO-STAT-NEX
               MOVE 'S' TO SCR-IERR.
       EXT-FND-KEY.
      *
           EXIT.

       PUT-SCR SECTION.
       INI-PUT-SCR.
      *ALD-BCI-INI/28.02.1996
           IF SCR-CMND = 'APR'
               GO TO APR-PUT-SCR.
      *ALD-BCI-FIN/28.02.1996
      *DAD ini  02-ENE-1992   (Memo.09-12-91)
           MOVE 'COL'        TO FIO-SIST.
           MOVE 'VSN'        TO TAB-COD-TTAB IN TAB.
           MOVE 'OFIUSP ACA' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND
              TAB-MSC-STAT IN TAB = 'S'
               PERFORM VAL-OFI-USP.
      *ALD-BCI-INI/28.02.1996
       APR-PUT-SCR.
      *ALD-BCI-FIN/28.02.1996
      *DAD fin  02-ENE-1992
      *DAD ini  04-OCT-1993   (Memo.28-06-93)
      *Valida existencia de informacion en campos informados con perdida
           PERFORM VAL-DAT-PREV-ACA.
           IF MSG-COD-MENS > SPACES
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE SCR-STAT-CON TO SCR-STAT.
      *DAD fin  04-OCT-1993
           PERFORM PUT-ALL-OPC.
       FIN-PUT-SCR.
           EXIT.

       CMN-ACC SECTION.
       INI-CMN-ACC.
           IF SCR-STAT = SCR-STAT-ABT OR SCR-VFLD = SCR-VFLD-NOT
               MOVE 'ACCION NO REALIZADA' TO FRM-MENS
               GO TO FIN-CMN-ACC.
      *<<<< INI_CMN_ACC
           IF NOT ( SCR-CMND = 'ACA' OR
      *DAD ini  02-AUG-1994       (Manejo de LDC)
                    SCR-CMND = 'ACO' OR
      *DAD ini  01-MAR-1995   (Manejo LDC  Comando APR )
                    SCR-CMND = 'APR' OR
      *DAD fin  01-MAR-1995
                    SCR-CMND = 'ASC' OR
                    SCR-CMND = 'ASO' OR
      *DAD fin  02-AUG-1994

      * RBG INI 22-APR-1996 
                    SCR-CMND = 'ACB' OR
                    SCR-CMND = 'ASB' )    
      * RBG FIN 22-APR-1996 

               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'CMDINV' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-ACC.
      *ALD
           PERFORM KEY-ALL-OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-ACC.
           GO TO NOV-CMN-ACC.
      *>>>>
           PERFORM KEY-ALL-OPC.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-ACC.
      *<<<< CMN_ACC_RET
       NOV-CMN-ACC.
      *RVM-CST-INI 30-OCT-1996
           MOVE OPC-COD-RMOC IN OPC TO CCU-OPC-RMOC IN CCU-VARI.
      *RVM-CST-FIN 30-OCT-1996
      *JSS 17-MAY-1991 11:38:41 ( para manejo de cuenta corriente )
      *Determina ( WSS-OPC-LNBT ) si es con cargo en cuenta corriente
      *y si es en Linea(S), BATCH(N) o Manual(M)
      *DAD ini  01-MAR-1995   (Manejo LDC  Comando APR )
           IF SCR-CMND = 'APR'
      *ALD-BCI-INI/12.03.1996
      *ALD-BCI-INI/29.10.1995
               IF OPC-COD-INSI IN OPC = 'X'
                   MOVE 'APRNOINSIESX' TO MSG-COD-MENS               
                   GO TO MSG-CMN-ACC
               ELSE
      *ALD-BCI-FIN/29.10.1995
      *ALD-BCI-FIN/12.03.1996
               IF OPC-MSC-STAT IN OPC = 'L'
                   GO TO CON-CMN-ACC
               ELSE
                   MOVE 'OPC    APRYA' TO MSG-COD-MENS
                   GO TO MSG-CMN-ACC.

      * RBG INI 22-APR-1996 
      *    IF ( SCR-CMND = 'ASC' OR
      *          SCR-CMND = 'ASO' ) AND
           IF ( SCR-CMND = 'ASC' OR
                SCR-CMND = 'ASO' OR SCR-CMND = 'ASB' ) AND
                OPC-MSC-STAT IN OPC NOT = 'J'
                   MOVE 'OPC    APRNO' TO MSG-COD-MENS
                   GO TO MSG-CMN-ACC.
      * RBG FIN 22-APR-1996 

      *DAD ini  13-MAR-1995
      * Identifica si Linea de Credito es del tipo Linea de Avance
      *     PERFORM GET-LDC-LAV.
      *JPA 21-MAR-1995 sistema LDC opere solo con MLT
            PERFORM GET-LDC-LAV.
            PERFORM SET-LDC-LAV.
      *DAD fin  13-MAR-1995 / 01-MAR-1995
      *DAD ini  02-AUG-1994       (Manejo de LDC)
      * Verifica llamado a rutina de evaluacion de cupos.
           MOVE OPC-CAI-IOPC IN OPC-FLD TO CCU-CAI-IOPC IN CCU-VARI(1).
           MOVE OPC-IIC-IOPC IN OPC-FLD TO CCU-IIC-IOPC IN CCU-VARI(1).
           MOVE OPC-VAL-SCRE IN OPC-FLD TO CCU-VAL-SCRE IN CCU-VARI(1).
           MOVE OPC-COD-VCOC IN OPC-FLD TO CCU-VOPR     IN CCU-VARI.
      *RVM-CST-INI 14-OCT-1996
      *ALD-BCI-INI/02.11.1995
      *     MOVE OPC-COD-OFOC IN OPC-FLD TO CCU-OPC-OFOC IN CCU-VARI.
      *     MOVE OPC-COD-RMOC IN OPC-FLD TO CCU-OPC-RMOC IN CCU-VARI.
      *ALD-BCI-FIN/02.11.1995
           MOVE DBC-NUM-ICLI IN OPC-FLD TO DBC-NUM-ICLI IN DBC.
           MOVE DBC-VRF-ICLI IN OPC-FLD TO DBC-VRF-ICLI IN DBC.
           MOVE DBC-IND-ICLI IN OPC-FLD TO DBC-IND-ICLI IN DBC.
           MOVE DBC-GLS-ICLI IN OPC-FLD TO DBC-GLS-ICLI IN DBC.
           MOVE 'DBC-IDC-ICLI' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF FIO-STAT-OKS
               IF DBC-IND-TICL IN DBC = 'P'
                   MOVE DBC-KEY-IDBC IN DBC TO DCP-KEY-IDCP IN DCP
                   MOVE FIO-GET-KEY TO FIO-CMND
                   PERFORM SGC-FIO-DCP
                   MOVE DCP-COD-TBAN IN DCP TO
                        CCU-COD-TBAN IN CCU-VARI
               ELSE
               IF DBC-IND-TICL IN DBC = 'E'
                   MOVE DBC-KEY-IDBC IN DBC TO DCE-KEY-IDCE IN DCE
                   MOVE FIO-GET-KEY TO FIO-CMND
                   PERFORM SGC-FIO-DCE
                   MOVE DCE-COD-TBAN IN DCE TO
                        CCU-COD-TBAN IN CCU-VARI.
      *RVM-CST-FIN 14-OCT-1996
      * Comandos ASC y ASO no deben validar cupo

      * RBG INI 22-APR-1996 
      *    IF SCR-CMND = 'ASC' OR 'ASO'
           IF SCR-CMND = 'ASC' OR SCR-CMND = 'ASO' OR SCR-CMND = 'ASB'
      * RBG FIN 22-APR-1996 

      *JPA ini 21-MAR-1995 AGREGO AL IF
      * ALD INI  19-DEC-1995 
      *        OR ( LDC-CICL IN LDC-VARI NOT = 'MLT' AND
      *             LDC-FLAG IN LDC-VARI     = 'S')
      * ALD FIN 19-DEC-1995 
      *DAD ini  13-MAR-1995 / 01-MAR-1995
      * Obliga que para L. AVANCE se efectue Validacion (FVEN MLT)
      *         IF LDC-CICL IN LDC-VARI NOT = 'MLT'
      *DAD fin  13-MAR-1995 / 01-MAR-1995
               GO TO NO-VAL-CCU.

      *RVM-CST-INI 30-JAN-1997
           MOVE 'COL'                    TO TAB-COD-SIST.
           MOVE 'AUX'                    TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-TOOC IN OPC-FLD  TO WSS-COD-TOOC IN WSS-VARI.
           MOVE OPC-COD-AOOC IN OPC-FLD  TO WSS-COD-AOOC IN WSS-VARI.
           MOVE WSS-COD-CAUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS NOT = 'COD    NEX'
               MOVE TAB-COD-DAT3 IN TAB(5) TO 
                    WSS-DAT-POS45 IN WSS-VARI
           ELSE
               MOVE SPACES                 TO
                    WSS-DAT-POS45 IN WSS-VARI.

           IF WSS-COD-POS45 IN WSS-VARI = 'C' OR 'V'
               MOVE SPACES TO CCU-SERR
               MOVE SPACES TO MSG-COD-MENS
               MOVE SPACES TO FRM-MENS
               MOVE 'N' TO CCU-COD-1NEX
               MOVE 'N' TO CCU-COD-ERRF
               MOVE 'N' TO CCU-COD-1EXI
               MOVE 'N' TO CCU-COD-1EXC
               GO TO FIN-LDC-CCU.
      *RVM-CST-FIN 30-JAN-1997

        COPY COLIPCCU.
      *DAD ini  13-MAR-1995 / 01-MAR-1995    (Manejo LDC  LINEA de AVANC
      *     IF SCR-CMND = 'ASC' OR 'ASO'
      *         IF LDC-CICL IN LDC-VARI = 'MLT'
      *             IF CCU-COD-MEN2 NOT = 'VTODLC>LDC'
      *                 GO TO NO-VAL-CCU.
      *DAD fin  13-MAR-1995 / 01-MAR-1995
           IF CCU-SERR = 'E'
               GO TO FIN-CMN-ACC.

      *FLB CST 31-MAR-1995
           PERFORM KEY-ALL-OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-ACC.
       NO-VAL-CCU.
           MOVE SPACES TO MSG-COD-MENS.
      *DAD fin  02-AUG-1994
      *JPA ini  22-MAR-1995
           IF SCR-MSC-TCAN = 'N'
               PERFORM GET-CAN-FRM.
      *JPA fin  22-MAR-1995
           PERFORM BUS-TCYA-LOB.
           IF MSG-COD-MENS > SPACES
               PERFORM BCK-OUT
               GO TO MSG-CMN-ACC.
           IF SCR-IND-ACAN = 'NOV'
                MOVE 'O' TO ADO-IND-ORIG
                PERFORM PRO-NOV-OPC
                MOVE ADO-MSC-MOPC TO ADO-MSC-TCAN
                MOVE CAN-KEY-ICAN IN CAN TO ADO-KEY-ICAN
                MOVE IDD-FSIS IN IDD-VARI TO ADO-FIDD
                MOVE ADO-CMMA TO SYS-CMMA
                MOVE SYS-LINK TO SYS-CMND
                MOVE WSS-PCAN TO SYS-PROG
                MOVE ADO-TCMA TO SYS-TCMA
                PERFORM GNS-PRO-SYS
                MOVE SYS-CMMA TO ADO-CMMA
                IF ADO-GLS-MENS > SPACES
                    MOVE ADO-GLS-MENS TO MSG-GLS-DESC FRM-MENS
                    GO TO FIN-CMN-ACC
                ELSE
                    NEXT SENTENCE
           ELSE
           IF SCR-IND-ACAN = 'REN' OR 'PRO'
                MOVE 'O' TO ADO-IND-ORIG
                MOVE CAN-KEY-ICAN IN CAN TO ADO-KEY-ICAN
                MOVE OPC-CIC-IOPC IN OPC TO ADO-KEY-IOPC
                MOVE ADO-MSC-MCAN TO ADO-MSC-TCAN
                MOVE IDD-FSIS IN IDD-VARI TO ADO-FIDD
                MOVE ADO-CMMA TO SYS-CMMA
                MOVE SYS-LINK TO SYS-CMND
                MOVE WSS-PCAN TO SYS-PROG
                MOVE ADO-TCMA TO SYS-TCMA
                PERFORM GNS-PRO-SYS
                MOVE SYS-CMMA TO ADO-CMMA
                IF ADO-GLS-MENS > SPACES
                    MOVE ADO-GLS-MENS TO MSG-GLS-DESC FRM-MENS
      * RBG/INI/8-OCT-1996
      *             GO TO FIN-CMN-ACC.
                    GO TO FIN-CMN-ACC
                ELSE
                    MOVE ADO-KEY-ICAN TO CAN-KEY-ICAN IN CAN
      * RBG/INI/8-JUL-1997
                    IF CAN-CAI-IOPC IN CAN = 'MULT'
                        PERFORM REV-EXI-ROV
                        IF MSG-COD-MENS > SPACES
                            GO TO MSG-CMN-ACC
                        ELSE
                            NEXT SENTENCE
                    ELSE
      * RBG/FIN/8-JUL-1997
                        MOVE FIO-GET-KEY TO FIO-CMND
                        PERFORM COL-FIO-CAN
                        IF CAN-MSC-STAT IN CAN = 'A'
                            NEXT SENTENCE
                        ELSE
                            MOVE 'NOACACANPPRO' TO MSG-COD-MENS
                            GO TO MSG-CMN-ACC.
      * RBG/FIN/8-OCT-1996

           IF SCR-MSC-TCAN = 'N'
               PERFORM ACT-OPC-ROV.

           PERFORM PRO-OPC-CYA.
           IF MSG-COD-MENS > SPACES
                GO TO FIN-CMN-ACC.
      *ALD
           GO TO CON-CMN-ACC.
      *>>>>
      *Con comentarios ya que este programa ocupa un modulo de manejo
      *especial
      *     PERFORM RET-ALL-OPC.
      *<<<< CMN_ACC
       CON-CMN-ACC.
           PERFORM KEY-ALL-OPC.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-ACC.
      *DAD ini  01-MAR-1995   (Manejo LDC  Comando APR )
           IF SCR-CMND = 'APR'
      *ALD-BCI-INI/12.03.1996
               MOVE '0' TO OPC-COD-INSI IN OPC
      *ALD-BCI-FIN/12.03.1996
               MOVE 'J' TO OPC-MSC-STAT IN OPC
               GO TO MOD-CMN-ACC.
      *DAD fin  01-MAR-1995
      *DAD ini  21-JUL-1992
      * Enganche con Rutina que Revisa Linea de Avance, si corresponde
           IF OPC-CAI-ILDC IN OPC-FLD NOT > SPACES AND
              OPC-IIC-ILDC IN OPC-FLD NOT > ZEROES
               GO TO CON-CMN-ACC-LDA-FIN.

           MOVE 'COL'          TO FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'BCI    LAVAN' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND
                    TAB-MSC-STAT IN TAB = 'S' )
               GO TO CON-CMN-ACC-LDA-FIN.

      * Inicializacion de Variables para rutina Linea de Avance
           MOVE SPACES                   TO MSG-COD-MENS.
           MOVE SPACES                   TO WSS-CAI-ILDC IN WSS-VARI.
           MOVE ZEROES                   TO WSS-IIC-ILDC IN WSS-VARI.
           MOVE WSS-CIC-ILDC IN WSS-VARI TO LAV-IOPC IN LAV-VARI(1)
                                            LAV-IOPC IN LAV-VARI(2)
                                            LAV-AOPC IN LAV-VARI(1)
                                            LAV-AOPC IN LAV-VARI(2).

      * Carga Deudor y Operacion del Credito a Activar para rutina LAv
           MOVE RDC-CIC-ICLI IN RDC TO LAV-ICLI IN LAV-VARI.
           MOVE OPC-CIC-IOPC IN OPC TO LAV-IOPC IN LAV-VARI(1).

      * Considera Credito si es Prorroga de Credito Cancelado para rutin
           IF ( CAN-CAI-IOPC IN OPC-FLD NOT > SPACES AND
                CAN-IIC-IOPC IN OPC-FLD NOT > ZEROES ) OR
              OPC-IND-RENO IN OPC-FLD NOT = 'PRO'
               MOVE ZEROES TO LAV-SCRE IN LAV-VARI(1)
               GO TO CON-CMN-ACC-LDA-PRO.

      * Para dejar con KEY's de la Pantalla el registro CAN y leer la CA
      *     PERFORM KEY-CAN-OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'CANPRO NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC        TO FRM-MEN1
               MOVE CAN-KEY-ICAN IN CAN TO FRM-MEN2
               MOVE FIO-BCK-OUT         TO FIO-CMND
               PERFORM COL-FIO-OPC
               GO TO FIN-CMN-ACC.

      * Carga el Credito de la Cancelacion solo si es 'PTT' para rutina
           IF CAN-MSC-CANC IN CAN = 'PTT'
               MOVE CAN-CIC-IOPC IN CAN TO LAV-AOPC IN LAV-VARI(1).
           MOVE ZEROES TO LAV-SCRE IN LAV-VARI(1).
       CON-CMN-ACC-LDA-PRO.
           MOVE 'ACA'                TO LAV-CMND IN LAV-VARI.
           MOVE IDD-FSIS IN IDD-VARI TO LAV-VIDD IN LAV-VARI.
           MOVE LAV-CMMA IN LAV-VARI TO SYS-CMMA.
           MOVE LAV-TCMA IN LAV-VARI TO SYS-TCMA.
           MOVE 'COLPPLAV'           TO SYS-PROG.
           MOVE SYS-LINK             TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA TO LAV-CMMA IN LAV-VARI.
           IF LAV-CMSG IN LAV-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE LAV-CMSG IN LAV-VARI TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC         TO FRM-MEN1
               MOVE LAV-MENS IN LAV-VARI TO FRM-MEN2
               MOVE FIO-BCK-OUT          TO FIO-CMND
               PERFORM COL-FIO-OPC
               GO TO FIN-CMN-ACC.
       CON-CMN-ACC-LDA-FIN.
      *DAD fin  21-JUL-1992
      *JUS ini  01-DIC-1994     MUEVO FEC-COMPUT. A FEC-CTBL(ING)
           MOVE OPC-NUM-DINP IN OPC-FLD TO OPC-NUM-DINP IN OPC
                                           OPC-NUM-DING IN OPC.
           MOVE OPC-NUM-MINP IN OPC-FLD TO OPC-NUM-MINP IN OPC
                                           OPC-NUM-MING IN OPC.
           MOVE OPC-NUM-SINP IN OPC-FLD TO OPC-NUM-SINP IN OPC
                                           OPC-NUM-SING IN OPC.
           MOVE OPC-NUM-AINP IN OPC-FLD TO OPC-NUM-AINP IN OPC
                                           OPC-NUM-AING IN OPC.
      *JUS fin  01-DIC-1994
           IF SCR-IND-ACAN = 'NOV' OR 'REN' OR  'PRO'
      *JSS 20-MAY-1991 16:32:18 ( para manejo cuenta corriente )
               IF WSS-OPC-LNBT = 'S' OR 'N'
      *DAD ini  21-AUG-1992   (Memo.12-08-92)
      *             MOVE 'G' TO OPC-MSC-STAT IN OPC
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Por ahora solo se procesan PTT de PRO con LAV con Abono en Cta.Ct
      *El Abono con Cta.Cte. se activa con 'A' y activa MVO de cta cte
                   MOVE 'S' TO MVO-LINE IN MVO-VARI
      *DAD fin  17-MAY-1993
                   PERFORM GEN-REG-MVO
                   IF MVO-CMSG NOT > SPACES
                       MOVE 'A' TO OPC-MSC-STAT IN OPC
                   ELSE
                       PERFORM BCK-OUT
                       MOVE MVO-CMSG TO MSG-COD-MENS
                       GO TO MSG-CMN-ACC
      *DAD fin  21-AUG-1992
               ELSE
      *
               MOVE 'A' TO OPC-MSC-STAT IN OPC
           ELSE
           IF SCR-MSC-TCAN = 'N'
               MOVE 'S' TO OPC-MSC-STAT IN OPC
           ELSE
      *JSS 17-MAY-1991 11:38:41 ( para manejo de cuenta corriente )
      *Si el abono es con cuenta corriente en linea debe activar con 'A'
      *generar MVO para cuenta corriente
      *si es con cuenta corriente en batch ( diferido ) debe activar con
               IF WSS-OPC-LNBT = 'N'
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *El Abono con Cta.Cte. en Batch se activa con 'A' y genera MVO de
      *             MOVE 'B' TO OPC-MSC-STAT IN OPC
                   PERFORM GEN-REG-MVO
                   IF MVO-CMSG NOT > SPACES
                       MOVE 'A' TO OPC-MSC-STAT IN OPC
                   ELSE
                       PERFORM BCK-OUT
                       MOVE MVO-CMSG TO MSG-COD-MENS
                       GO TO MSG-CMN-ACC
      *DAD fin  17-MAY-1993
               ELSE
               IF WSS-OPC-LNBT = 'S'
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *El Abono con Cta.Cte. en Linea se activa con 'A' y activa MVO de
                   MOVE 'S' TO MVO-LINE IN MVO-VARI
      *DAD fin  17-MAY-1993
                   PERFORM GEN-REG-MVO
                   IF MVO-CMSG NOT > SPACES
                       MOVE 'A' TO OPC-MSC-STAT IN OPC
                   ELSE
                       PERFORM BCK-OUT
                       MOVE MVO-CMSG TO MSG-COD-MENS
                       GO TO MSG-CMN-ACC
               ELSE
      *
               MOVE 'A' TO OPC-MSC-STAT IN OPC.

      *DAD ini  09-AGO-1994   (Memo.15-07-94)
           PERFORM CHQ-USP.
           MOVE USP-COD-USUARIO TO OPC-COD-ATRN IN OPC.
      *DAD fin  09-AGO-1994
      *JUS ini  21-12-94
           MOVE SCR-IND-CTBL IN SCR-VARI TO OPC-IND-CTBL IN OPC.
      *JUS fin  21-12-94
      *DAD ini  01-MAR-1995   (Manejo LDC  Comando APR )
       MOD-CMN-ACC.
      * RBG/INI/20-JUN-1997
      * Esto es para grabar la fecha y hora de la activacion de la OPC
      * independiente del comando utilizado.
           IF OPC-MSC-STAT IN OPC = 'A'
               PERFORM GET-FHOY
               MOVE HOY-DHOY TO OPC-NUM-DTRN IN OPC
               MOVE HOY-MHOY TO OPC-NUM-MTRN IN OPC
               MOVE HOY-SHOY TO OPC-NUM-STRN IN OPC
               MOVE HOY-AHOY TO OPC-NUM-ATRN IN OPC

               MOVE HOY-HHHY TO OPC-NUM-HHTR IN OPC
               MOVE HOY-MMHY TO OPC-NUM-MMTR IN OPC
               MOVE HOY-SSHY TO OPC-NUM-SSTR IN OPC.
      * RBG/FIN/20-JUN-1997
      *DAD fin  01-MAR-1995
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               PERFORM BCK-OUT
               GO TO FIN-CMN-ACC.

      *DAD ini  15-NOV-1993   (Memo.27-10-93)
      *Valida existencia de informacion en campos informados con perdida
           IF MSG-COD-MENS NOT > SPACES
               PERFORM VAL-DAT-PREV-ACA
               IF MSG-COD-MENS > SPACES
                   MOVE MSG-GLS-DESC TO FRM-MEN1
                   PERFORM BCK-OUT
                   GO TO FIN-CMN-ACC.
      *DAD fin  15-NOV-1993
      *DAD ini  01-MAR-1995   (Manejo LDC  Comando APR )
           IF OPC-MSC-STAT IN OPC = 'J'
               MOVE 'OPC    APROK' TO MSG-COD-MENS
               GO TO MSG-CMN-ACC.
      *DAD fin  01-MAR-1995
      *SMC-INI 27.08.1993 GRABA ICG, CUANDO LA PRIMERA ICG ES C/R AL FLU
      *                   POSEE PERIODO DE REPACTO.
           PERFORM OBT-TSA-OPC.

           IF  MSG-COD-MENS > SPACES
               PERFORM BCK-OUT
               GO TO MSG-CMN-ACC.
      *SMC-FIN 27.08.1993

      *Operacion activada, carga el codigo de mensaje correspondiente
      *ALD/8-AUG-1988
           IF OPC-MSC-STAT IN OPC = 'S'
               MOVE 'OPC    SUSOK' TO MSG-COD-MENS
           ELSE
           IF OPC-MSC-STAT IN OPC = 'A'
               PERFORM UPD-DBR-COPE
               IF FIO-STAT-OKS
                   IF SCR-IND-ACAN = 'NOV'
                       MOVE 'OPC    NOVOK' TO MSG-COD-MENS
                   ELSE
                   IF SCR-IND-ACAN = 'REN'
                       MOVE 'OPC    RENOK' TO MSG-COD-MENS
                   ELSE
                   IF SCR-IND-ACAN = 'PRO'
                       MOVE 'OPC    PROOK' TO MSG-COD-MENS
                   ELSE
                       MOVE 'OPC    ACAOK' TO MSG-COD-MENS
               ELSE
                   GO TO FIN-CMN-ACC
           ELSE
               MOVE 'OPCSTT'            TO MSG-COD-TMSG
               MOVE OPC-MSC-STAT IN OPC TO MSG-COD-CMSG.
      *Llama a parrafo para cambiar operaciones en caso de prorrogas
      *totales ( cancelar totalmente un credito ), SOLO en caso de
      *operaciones activadas con 'A' ( no suspendidas ni en espera )
           IF ( OPC-IND-RENO IN OPC-FLD = 'PRO' ) AND
              ( OPC-MSC-STAT IN OPC = 'A' )
               MOVE OPC-CAI-IOPC IN OPC-FLD TO CEO-CAI-IOPC-PRO
               MOVE OPC-IIC-IOPC IN OPC-FLD TO CEO-IIC-IOPC-PRO
               MOVE EIBTRMID                TO CEO-CAI-IOPC-PSO
               MOVE OPC-IIC-IOPC IN OPC-FLD TO CEO-IIC-IOPC-PSO
               PERFORM CAM-ENT-OPC
               IF CEO-CMSG > SPACES
                   PERFORM BCK-OUT
                   MOVE CEO-CMSG TO MSG-COD-MENS
                   MOVE CEO-MEN2 TO FRM-MEN2
      *DAD ini  21-JUL-1992
                   GO TO MSG-CMN-ACC.

      * Enganche con Rutina que Revisa Linea de Avance, si corresponde
           IF OPC-CAI-ILDC IN OPC-FLD NOT > SPACES AND
              OPC-IIC-ILDC IN OPC-FLD NOT > ZEROES
               GO TO CON-CMN-ACC-RLO-FIN.

           MOVE 'COL'          TO FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'BCI    LAVAN' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND
                    TAB-MSC-STAT IN TAB = 'S' )
               GO TO CON-CMN-ACC-RLO-FIN.

      * Inicializacion de Variables para rutina Linea de Avance
           MOVE SPACES                   TO WSS-CAI-ILDC IN WSS-VARI.
           MOVE ZEROES                   TO WSS-IIC-ILDC IN WSS-VARI.
           MOVE WSS-CIC-ILDC IN WSS-VARI TO LAV-IOPC IN LAV-VARI(1)
                                            LAV-IOPC IN LAV-VARI(2)
                                            LAV-AOPC IN LAV-VARI(1)
                                            LAV-AOPC IN LAV-VARI(2).

      * Cuando es Prorroga Carga el Credito de la Cancelacion y el Credi
      * Activado, para invertir si existe y grabar RLO en rutina LAv
           IF OPC-IND-RENO IN OPC-FLD NOT = 'PRO'
               GO TO CON-CMN-ACC-RLO-PRO.

           MOVE CAN-CAI-IOPC IN OPC-FLD  TO WSS-CAI-ILDC IN WSS-VARI.
           MOVE CAN-IIC-IOPC IN OPC-FLD  TO WSS-IIC-ILDC IN WSS-VARI.
           MOVE WSS-CIC-ILDC IN WSS-VARI TO LAV-IOPC IN LAV-VARI(1).
           MOVE OPC-CAI-IOPC IN OPC-FLD  TO WSS-CAI-ILDC IN WSS-VARI.
           MOVE OPC-IIC-IOPC IN OPC-FLD  TO WSS-IIC-ILDC IN WSS-VARI.
           MOVE WSS-CIC-ILDC IN WSS-VARI TO LAV-AOPC IN LAV-VARI(1).
           MOVE 'PRO'                    TO LAV-CMND IN LAV-VARI.
           MOVE IDD-FSIS IN IDD-VARI     TO LAV-VIDD IN LAV-VARI.
           MOVE LAV-CMMA IN LAV-VARI     TO SYS-CMMA.
           MOVE LAV-TCMA IN LAV-VARI     TO SYS-TCMA.
           MOVE 'COLPPLAV'               TO SYS-PROG.
           MOVE SYS-LINK                 TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA TO LAV-CMMA IN LAV-VARI.
           IF LAV-CMSG IN LAV-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE LAV-CMSG IN LAV-VARI TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC         TO FRM-MEN1
               MOVE LAV-MENS IN LAV-VARI TO FRM-MEN2
               MOVE FIO-BCK-OUT          TO FIO-CMND
               PERFORM COL-FIO-OPC
               GO TO FIN-CMN-ACC.
           GO TO CON-CMN-ACC-RLO-FIN.
       CON-CMN-ACC-RLO-PRO.
      * Carga el Credito de la Cancelacion cuando es Prorroga o el Credi
      * Activado en otros casos para rutina L. Avances
           IF OPC-IND-RENO IN OPC-FLD NOT = 'PRO'
               MOVE OPC-CAI-IOPC IN OPC-FLD  TO WSS-CAI-ILDC IN WSS-VARI
               MOVE OPC-IIC-IOPC IN OPC-FLD  TO WSS-IIC-ILDC IN WSS-VARI
               MOVE WSS-CIC-ILDC IN WSS-VARI TO LAV-IOPC IN LAV-VARI(1)
           ELSE
      *     IF OPC-IND-RENO IN OPC-FLD = 'PRO'
      *         MOVE CAN-CAI-IOPC IN OPC-FLD  TO WSS-CAI-ILDC IN WSS-VAR
      *         MOVE CAN-IIC-IOPC IN OPC-FLD  TO WSS-IIC-ILDC IN WSS-VAR
      *         MOVE WSS-CIC-ILDC IN WSS-VARI TO LAV-IOPC IN LAV-VARI(1)
               GO TO CON-CMN-ACC-RLO-FIN.
           MOVE 'GRA'                TO LAV-CMND IN LAV-VARI.
           MOVE IDD-FSIS IN IDD-VARI TO LAV-VIDD IN LAV-VARI.
           MOVE LAV-CMMA IN LAV-VARI TO SYS-CMMA.
           MOVE LAV-TCMA IN LAV-VARI TO SYS-TCMA.
           MOVE 'COLPPLAV'           TO SYS-PROG.
           MOVE SYS-LINK             TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA TO LAV-CMMA IN LAV-VARI.
           IF LAV-CMSG IN LAV-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE LAV-CMSG IN LAV-VARI TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC         TO FRM-MEN1
               MOVE LAV-MENS IN LAV-VARI TO FRM-MEN2
               MOVE FIO-BCK-OUT          TO FIO-CMND
               PERFORM COL-FIO-OPC
               GO TO FIN-CMN-ACC.
       CON-CMN-ACC-RLO-FIN.
      *DAD fin  21-JUL-1992
       MSG-CMN-ACC.
           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG
           MOVE MSG-GLS-DESC TO FRM-MEN1.
      *>>>>
       FIN-CMN-ACC.
           EXIT.

      *DAD ini  13-MAR-1995 / 01-MAR-1995   (Manejo LDC  LINEA de AVANCE
        COPY COLBGLDC.
      *DAD fin  13-MAR-1995 / 01-MAR-1995
      *DAD ini  02-AUG-1994       (Manejo de LDC)
       COPY COLBGCCU.
      *COPY LDCBGCCU.
       COPY LDCBKCCU.
       COPY LDCBKCEG.
       COPY SGCBBGRP.
       COPY SGCBFREC.
      *DAD fin  02-AUG-1994

      *SMC-INI 27.08.1993
       OBT-TSA-OPC SECTION.
       INI-OBT-TSA-OPC.
           MOVE OPC-CAI-IOPC IN OPC TO ICG-CAI-IOPC IN ICG.
           MOVE OPC-IIC-IOPC IN OPC TO ICG-IIC-IOPC IN ICG.
           MOVE ZEROES              TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE 'INT'               TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF NOT ( FIO-STAT-OKS AND
                    ICG-CAI-IOPC IN ICG = OPC-CAI-IOPC IN OPC-FLD AND
                    ICG-IIC-IOPC IN ICG = OPC-IIC-IOPC IN OPC-FLD AND
                    ICG-NUM-ICAN IN ICG = ZEROES AND
                    ICG-CIC-IOPV IN ICG = SPACES AND
                    ICG-NUM-IVCT IN ICG = ZEROES AND
                    ICG-IND-TTAS IN ICG = 'INT' )
                    MOVE 'ICG    NEX' TO MSG-COD-MENS
                    GO TO FIN-OBT-TSA-OPC.

           IF ICG-MSC-TFPR = 'F' AND ICG-NUM-PREP IN ICG > ZEROS
              MOVE 2 TO   WSS-NUM-NICG IN WSS-VARI
              COMPUTE WSS-NUM-IVEN IN WSS-VARI =
              ( WSS-NUM-NICG IN WSS-VARI - 1 ) * ICG-NUM-PREP IN ICG
              PERFORM GEN-PUT-ICG UNTIL WSS-NUM-IVEN IN WSS-VARI NOT <
                                        OPC-NUM-VCOR IN OPC.
       FIN-OBT-TSA-OPC.
           EXIT.

       GEN-PUT-ICG SECTION.
       INI-GEN-PUT-ICG.
           MOVE OPC-CIC-IOPC IN OPC       TO VEN-CIC-IOPC IN VEN.
           MOVE WSS-NUM-IVEN IN WSS-VARI  TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY               TO FIO-CMND.

           IF OPC-IND-VSTR IN OPC = 'S'
              PERFORM COL-OBT-VEN
              IF NOT VEN-STAT-OKS
      *LRH ini  12-ABR-1994   (Memo.26-01-94, Pto.3)
      *           MOVE 'VEN    NEX' TO MSG-COD-MENS
                 MOVE VEN-STAT    TO MSG-COD-MENS
                 MOVE VEN-MEN2    TO FRM-MEN2
                 MOVE FIO-BCK-OUT TO FIO-CMND
                 PERFORM COL-FIO-OPC
      *LRH fin  12-ABR-1994
                 GO TO MSG-CMN-ACC.

           IF NOT ( OPC-IND-VSTR IN OPC = 'S' )
              PERFORM COL-FIO-VEN
              IF NOT FIO-STAT-OKS
                 MOVE 'VEN    NEX' TO MSG-COD-MENS
                 GO TO MSG-CMN-ACC.

           MOVE VEN-FEC-FVEN IN VEN TO ICG-FEC-FINI IN ICG.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-ICG.

           IF FIO-STAT-OKS
               MOVE FIO-MOD TO FIO-CMND
           ELSE
               MOVE FIO-PUT TO FIO-CMND.

           PERFORM COL-FIO-ICG.
           IF NOT FIO-STAT-OKS
              MOVE 'ICGCRFNOWRT ' TO MSG-COD-MENS
              GO TO MSG-CMN-ACC.

           ADD 1 TO WSS-NUM-NICG IN WSS-VARI.

           COMPUTE WSS-NUM-IVEN IN WSS-VARI =
           ( WSS-NUM-NICG IN WSS-VARI - 1 ) * ICG-NUM-PREP IN ICG.
       FIN-GEN-PUT-ICG.
           EXIT.
      *SMC-FIN 27.08.1993

       SCR-EXIT SECTION.
       INI-SCR-EXIT.
           MOVE 'P'      TO SCR-ICMN.
           MOVE SCR-NTRN TO SYS-NTRN.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-RTRN TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-SCR-EXIT.
           EXIT.

       SCR-PUTA SECTION.
       INI-SCR-PUTA.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE OPC-FLD TO FRM-DFLD.
           MOVE FRM-PUT-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-PUTA.
           EXIT.

       SCR-MSSG SECTION.
       INI-SCR-MSSG.
           IF FRM-MEN1 NOT > SPACES
               MOVE SPACES TO FRM-MEN1.
           IF FRM-MEN2 NOT > SPACES
               MOVE SPACES TO FRM-MEN2.
           MOVE FRM-MENS TO OPC-GLS-MENS.
       FIN-SCR-MSSG.
           EXIT.

       SCR-GKEY SECTION.
       INI-SCR-GKEY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-OPC
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO OPC-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GKEY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-OPC.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR

      * PTC:
               MOVE 'S' TO SCR-IERR

               PERFORM SCR-MSSG
               PERFORM EDT-KEY-OPC
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-OPC.
           PERFORM VAL-IKY-OPC.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-MKY-OPC.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-AKY-OPC.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GKEY.
           PERFORM VAL-CON-KEY-OPC.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GKEY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-OPC.

       ERR-SCR-GKEY.

      * PTC:
           MOVE 'S' TO SCR-IERR.

           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-OPC.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GKEY.
           PERFORM SCR-MSSG.

       GET-ACC SECTION.
       INI-GET-ACC.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC          TO OPC-GLS-MEN2
               MOVE SCR-PRMT TO OPC-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO OPC-FLD.
           IF NOT ( ( FRM-FFLD = FRM-FFLD-PF12 OR FRM-FFLD-PF3 ) OR
                      SCR-CONF > SPACES )
               PERFORM VAL-NUM-KEY-OPC
               PERFORM VAL-NUM-FLD-OPC.
       FIN-GET-ACC.
           MOVE SCR-STAT-SON TO SCR-STAT.

       GET-CON SECTION.
       INI-GET-CON.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC          TO OPC-GLS-MEN2
               MOVE SCR-PRMT TO OPC-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO OPC-FLD.
       FIN-GET-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.

       CLR-MSG SECTION.
       INI-CLR-MSG.
           MOVE SPACES TO OPC-GLS-MENS.
       FIN-CLR-MSG.
           EXIT.

       HBL-KEY SECTION.
       INI-HBL-KEY.
      * PTC ini
           IF NOT SCR-OFRM-SRV
      * PTC fin
           IF SCR-DESDE-CMN
               MOVE OPC-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO OPC-FLD
               MOVE FRM-MENS TO OPC-GLS-MENS.
           PERFORM PRO-FLD-OPC.
           PERFORM UNP-KEY-OPC.
           PERFORM FST-KEY-OPC.
           MOVE SPACES TO SCR-KEY-IRDC.
           MOVE SPACES TO SCR-IND-MRDC.
           MOVE SPACES TO SCR-IND-MITR.
           MOVE SPACES TO SCR-IND-MCOM.
           MOVE SPACES TO SCR-IND-MCYA.
           MOVE SPACES TO SCR-IND-ACAN.
           MOVE SPACES TO SCR-MSC-TCAN.
       FIN-HBL-KEY.
           EXIT.

       HBL-FLD SECTION.
       INI-HBL-FLD.
           PERFORM PRO-IKY-OPC.
           PERFORM PRO-AKY-OPC.
           PERFORM UNP-MKY-OPC.
           PERFORM UNP-FLD-OPC.
           PERFORM FST-FLD-OPC.
       FIN-HBL-FLD.
           EXIT.

       FST-MSG SECTION.
       INI-FST-MSG.
           MOVE -1 TO OPC-GLS-MENS-LEN.
       FIN-FST-MSG.
           EXIT.

       PRO-ALL SECTION.
       INI-PRO-ALL.
           PERFORM PRO-KEY-OPC.
           PERFORM PRO-FLD-OPC.
           PERFORM FST-MSG.
       FIN-PRO-ALL.
           EXIT.

       SCR-TRL SECTION.
       INI-SCR-TRL.
           IF FRM-MEN1 NOT > SPACES
               MOVE SCR-PRMT TO FRM-MEN1.
           IF SCR-STAT = SCR-STAT-SON
               MOVE SCR-INST-GCS TO SCR-INST
               PERFORM PRO-ALL
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-OPC
               PERFORM EDT-FLD-OPC
               PERFORM SCR-PUTA
      * PTC: JSS
               IF SCR-STAT NOT = SCR-STPP
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   PERFORM SCR-EXIT
               ELSE
      *
               PERFORM SCR-EXIT.
      *ASUME SCR-STAT-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.
           MOVE SCR-INST-GAB TO SCR-INST.
           PERFORM PRO-ALL.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-OPC
           PERFORM EDT-FLD-OPC
           PERFORM SCR-PUTA
      * PTC: JSS
           IF SCR-STAT NOT = SCR-STPP
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *
           PERFORM SCR-EXIT.
       FIN-SCR-TRL.
           EXIT.

       DESSCRTRL SECTION.
       INI-DESSCRTRL.
           IF SCR-INST = SCR-INST-GCF
                  PERFORM SCR-GCNF
                  GO TO FIN-DESSCRTRL.
           MOVE SCR-VFLD-NOT TO SCR-VFLD.
           MOVE FRM-FFLD TO SCR-FFLD.
           IF SCR-STAT = SCR-STAT-ABT OR SCR-STAT-CON
                  GO TO FIN-DESSCRTRL.
           IF SCR-FFLD-RET OR SCR-FFLD-PF10
                  MOVE SCR-VFLD-YES TO SCR-VFLD
                  PERFORM PRO-CONF.
       FIN-DESSCRTRL.
           IF SCR-FFLD-PF10 OR SCR-FFLD-PF3
                 MOVE SCR-INST-HCM TO SCR-INST
           ELSE
                 MOVE SCR-INST-HKY TO SCR-INST.
       EXT-DESSCRTRL.
           EXIT.

       PRO-CONF SECTION.
       INI-PRO-CONF.
           IF FRM-MENS NOT > SPACES
               IF SCR-CONF NOT > SPACES
                   GO TO FIN-PRO-CONF
               ELSE
                   MOVE SCR-CONF TO FRM-MENS
           ELSE
               IF FRM-MEN1 NOT > SPACES
                   MOVE SCR-CONF TO FRM-MEN1.
           MOVE SCR-INST-GCF TO SCR-INST.
           PERFORM SCR-MSSG.
           PERFORM PRO-KEY-OPC.
           PERFORM PRO-FLD-OPC.
           PERFORM FST-MSG.
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM EDT-KEY-OPC
               PERFORM EDT-FLD-OPC.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-PRO-CONF.
           EXIT.

       SCR-GCNF SECTION.
       INI-SCR-GCNF.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3  OR
                               FRM-FFLD-PF4 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC          TO OPC-GLS-MEN2
               MOVE SCR-CONF TO OPC-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO OPC-FLD.
           MOVE FRM-FFLD TO SCR-FFLD.
           IF FRM-FFLD = FRM-FFLD-PF3
               MOVE SCR-VFLD-NOT TO SCR-VFLD
           ELSE
           IF FRM-FFLD = FRM-FFLD-RET OR FRM-FFLD-PF10 OR FRM-FFLD-PF4
               MOVE SCR-VFLD-YES TO SCR-VFLD
               PERFORM VAL-NUM-KEY-OPC
               PERFORM VAL-NUM-FLD-OPC
           ELSE
           IF FRM-FFLD = FRM-FFLD-PF12
               MOVE SCR-STPP TO SCR-STAT
               IF SCR-STAT = SCR-STAT-MOD
                   PERFORM VAL-NUM-KEY-OPC
                   PERFORM VAL-NUM-FLD-OPC
                   PERFORM SCR-TRL
               ELSE
                   MOVE SCR-VFLD-NOT TO SCR-VFLD.
       FIN-SCR-GCNF.
           EXIT.

      *JSS COPY COLBMOPC.
       COPY COLBQOPC.

       COPY COLBFOPC.
       COPY GNSBFMSC.
       COPY GNSBFMSG.
       COPY GNSBGSYS.
       COPY GNSBGVSM.
       COPY GNSBGDTC.
      *COPY GNSBGFRM.
       COPY GNSBG3CF.
       COPY GNSBGQUE.
      * PTC fin
       COPY GNSBGMSG.
       COPY GNSBEKEY.
       COPY GNSBIABT.
      *PTC-INI
       PGM-EBR-ALL SECTION.
       INI-PGM-EBR-ALL.
           MOVE FIO-EBR-ALL TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FIN-PGM-EBR-ALL.
           EXIT.
      *PTC-FIN
      *<<<< EOF
      *DAD ini  09-AGO-1994   (Memo.15-07-94)
       CHQ-USP SECTION.
       INI-CHQ-USP.
           COPY USPC143.
       FIN-CHQ-USP.
           EXIT.
      *DAD fin  09-AGO-1994
      *DAD ini  02-ENE-1992   (Memo.09-12-91)

      ******************************************************************
      *DAD ini  02-ENE-1992   (Memo.09-12-91)
       VAL-OFI-USP SECTION.
      *********************
       INI-VAL-OFI-USP.
      *DAD ini  09-AGO-1994   (Memo.15-07-94)
           PERFORM CHQ-USP.
      *DAD fin  09-AGO-1994
      *DAD ini  18-JUL-1994   (Memo.23-06-94)
           MOVE TAB-GLS-ABRV IN TAB TO WSS-COD-OFOC IN WSS-VARI.
           IF USP-COD-OFICINA = WSS-COD-OFOC IN WSS-VARI
               GO TO FIN-VAL-OFI-USP.
      *DAD fin  18-JUL-1994

      * RBG/INI/13-NOV-1996
           IF USP-COD-OFICINA NOT = OPC-COD-OFOC IN OPC
               MOVE 'COL'                TO FIO-STAT
               MOVE 'VEO'                TO TAB-COD-TTAB     IN TAB
               MOVE USP-COD-USUARIO      TO WSS-COD-USUARIO  IN WSS-VARI
               MOVE OPC-COD-OFOC IN OPC  TO WSS-COD-OFICINA  IN WSS-VARI
               MOVE WSS-COD-UAUX IN WSS-VARI TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY              TO FIO-CMND
               PERFORM GNS-FIO-TAB
               IF ( FIO-STAT-OKS AND TAB-IND-VIGE = 'S' )
                   GO TO FIN-VAL-OFI-USP
               ELSE
                  MOVE 'COL'            TO FIO-STAT
                  MOVE 'VEO'            TO TAB-COD-TTAB    IN TAB
                  MOVE USP-COD-USUARIO  TO WSS-COD-USUARIO IN WSS-VARI
                  MOVE '  *'            TO WSS-COD-OFICINA IN WSS-VARI
                  MOVE WSS-COD-UAUX IN WSS-VARI TO TAB-COD-CTAB IN TAB
                  MOVE FIO-GET-KEY              TO FIO-CMND
                  PERFORM GNS-FIO-TAB
                  IF NOT ( FIO-STAT-OKS AND TAB-IND-VIGE = 'S' )
                      MOVE 'COL'           TO MSG-COD-SIST
                      MOVE 'OFIUSP NOACA'  TO MSG-COD-MENS
                      PERFORM GET-MSG
                      MOVE MSG-GLS-DESC    TO FRM-MEN1
                      MOVE USP-COD-OFICINA TO FRM-MEN2
                      MOVE SCR-STAT-CON    TO SCR-STAT.
      * RBG/FIN/21-OCT-1996 
       FIN-VAL-OFI-USP.
           EXIT.
      *DAD fin  02-ENE-1992

      ******************************************************************
       GEN-REG-MVO SECTION.
       INI-GEN-REG-MVO.
           MOVE SPACES TO MVO-CMSG.
           MOVE OPC-CIC-IOPC IN OPC TO CYA-CIC-IOPC IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICAN IN CYA.
           MOVE 1                   TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-GEN-REG-MVO.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS AND
                    CYA-CIC-IOPC IN CYA = OPC-CIC-IOPC IN OPC AND
                    CYA-NUM-ICAN IN CYA = ZEROES )
               GO TO FIN-GEN-REG-MVO.
      *DAD ini  29-NOV-1991   (Memo.22-11-91)
           IF CYA-SGV-LIQU IN CYA = ZEROES
               GO TO NXT-GEN-REG-MVO.
      *DAD fin  29-NOV-1991
           PERFORM GET-FHOY.
           MOVE HOY-DHOY TO MVO-DPRO.
           MOVE HOY-MHOY TO MVO-MPRO.
           MOVE HOY-SHOY TO MVO-SPRO.
           MOVE HOY-AHOY TO MVO-APRO.
           MOVE 'O'      TO MVO-ORIG.
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Para Proceso Genera y Activa con registro MVO (Pro. Linea)
           EXEC CICS ADDRESS
                     TWA(TWA-PNT0)
           END-EXEC.
      *DAD fin  17-MAY-1993
           PERFORM COL-GEN-MVO.
           IF MVO-CMSG > SPACES
               MOVE MVO-MEN2 TO FRM-MEN2
               GO TO FIN-GEN-REG-MVO.
       NXT-GEN-REG-MVO.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-GEN-REG-MVO.
       FIN-GEN-REG-MVO.
           EXIT.

       GET-CAN-FRM SECTION.
       INI-GET-CAN-FRM.
           MOVE CAN-CAI-IOPC IN OPC-FLD TO CAN-CAI-IOPC IN CAN.
           MOVE CAN-IIC-IOPC IN OPC-FLD TO CAN-IIC-IOPC IN CAN.
           MOVE CAN-NUM-ICAN IN OPC-FLD TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           MOVE FIO-STAT TO PGM-STAT-CAN.
       FIN-GET-CAN-FRM.
           EXIT.

       GET-ROV-NOV SECTION.
       INI-GET-ROV-NOV.
      * RECUPERA CANCELACION(NOV)  ASOCIADA A OPERACION
           MOVE OPC-CIC-IOPC IN OPC TO ROV-CIC-IOPC IN ROV.
           MOVE SPACES              TO ROV-CIC-IOPV IN ROV.
           MOVE ZEROES              TO ROV-NUM-IVCT IN ROV.
           MOVE '23' TO PGM-STAT-CAN.
           MOVE FIO-GET-NLS TO FIO-CMND.
       CIC-GET-ROV-NOV.
           PERFORM COL-FIO-ROV.
           IF NOT ( FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = ROV-CIC-IOPC IN ROV )
               MOVE FIO-STAT TO PGM-STAT-ROV
               GO TO FIN-GET-ROV-NOV.

           IF OPC-CIC-IOPC IN OPC NOT = ROV-CIC-IOPC IN ROV
               GO TO FIN-GET-ROV-NOV.

           IF ROV-IIC-IOPV IN ROV > ZEROES AND
              ROV-NUM-IVCT IN ROV > ZEROES

      * INICIALIZA ACUMULADOR CON VALOR DE ROV DE OPC A ACTIVAR
      * PARA CONSIDERARLO EN LA SUMATORIA Y ADEMAS LO RESPALDA
                MOVE ROV-SGV-RENO IN ROV TO WSS-SGV-RENO
                                            WSS-ROV-SGV-RENO
                MOVE ROV-COD-VCVR IN ROV TO WSS-ROV-COD-VCVR
                MOVE FIO-STAT TO PGM-STAT-ROV
                MOVE ROV-KEY-IVCT IN ROV TO CAN-KEY-ICAN IN CAN
                MOVE FIO-GET-KEY TO FIO-CMND
                PERFORM COL-FIO-CAN
                MOVE FIO-STAT TO PGM-STAT-CAN
           ELSE
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO CIC-GET-ROV-NOV.
           PERFORM OBT-VAL-CAMB.
           MOVE WSS-SGV-RENO-PES TO WSS-SGV-RENO.
       FIN-GET-ROV-NOV.
           EXIT.

       VRF-ROV-NOV SECTION.
       INI-VRF-ROV-NOV.

           MOVE SPACES TO MSG-COD-MENS.
      * LEERA ( POR ROV ) TODAS LAS OPERACIONES ASOCIADAS A LA
      * MISMA CANCELACION
           MOVE CAN-KEY-ICAN IN CAN TO ROV-KEY-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
       CIC-VRF-ROV-NOV.
           PERFORM COL-FIO-ROV.
           IF FIO-STAT-OKS AND
              CAN-CIC-IOPC IN CAN = ROV-CIC-IOPV IN ROV

      * SOLO CONTABILIZA AQUELLAS OPERACIONES YA ACTIVADAS EN ESTADO
      * ESPECIAL DE NOVACION
                IF ROV-MSC-STAT IN ROV = 'S'
                    PERFORM OBT-VAL-CAMB
                    ADD WSS-SGV-RENO-PES TO WSS-SGV-RENO
                    MOVE 'ROV-KEY-IVCT' TO FIO-AKEY
                    MOVE FIO-GET-NXT TO FIO-CMND
                    GO TO CIC-VRF-ROV-NOV
                ELSE
                    MOVE 'ROV-KEY-IVCT' TO FIO-AKEY
                    MOVE FIO-GET-NXT TO FIO-CMND
                    GO TO CIC-VRF-ROV-NOV.
       FIN-VRF-ROV-NOV.
           EXIT.

       OBT-VAL-CAMB SECTION.
       INI-OBT-VAL-CAMB.
           MOVE 1 TO CAM-SGV-VCAM IN CAM.
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB.
           MOVE '0999'         TO TAB-CIC-CTAB.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM GNS-FIO-TAB.
           IF TAB-COD-CTAB NOT = ROV-COD-VCVR IN ROV
               MOVE CAN-NUM-DCAN IN CAN TO CAM-NUM-DCAM IN CAM(1)
               MOVE CAN-NUM-MCAN IN CAN TO CAM-NUM-MCAM IN CAM(1)
               MOVE CAN-NUM-SCAN IN CAN TO CAM-NUM-SCAM IN CAM(1)
               MOVE CAN-NUM-ACAN IN CAN TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAN-NUM-DCAN IN CAN TO CAM-NUM-DCAM IN CAM(2)
               MOVE CAN-NUM-MCAN IN CAN TO CAM-NUM-MCAM IN CAM(2)
               MOVE CAN-NUM-SCAN IN CAN TO CAM-NUM-SCAM IN CAM(2)
               MOVE CAN-NUM-ACAN IN CAN TO CAM-NUM-ACAM IN CAM(2)
               MOVE ROV-COD-VCVR IN ROV TO CAM-COD-VCAM IN CAM(1)
               MOVE TAB-COD-CTAB IN TAB TO CAM-COD-VCAM IN CAM(2)
               MOVE FIO-GET-KEY  TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT FIO-STAT-OKS
                   MOVE 1 TO CAM-SGV-VCAM IN CAM.
           MULTIPLY ROV-SGV-RENO IN ROV BY CAM-SGV-VCAM IN CAM
                    GIVING WSS-SGV-RENO-PES ROUNDED.
           MOVE WSS-SGV-RENO-PES TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-RENO-PES.
       FIN-OBT-VAL-CAMB.
           EXIT.


       GET-ROV-REN SECTION.
       INI-GET-ROV-REN.
      * RECUPERA CANCELACIONES (REN)  ASOCIADAS A OPERACION
      *    DEJA EN ZERO EN TOTAL DE CANCELACIONES QUE RENUEVAN LA OPERAC
           MOVE ZEROES TO WSS-TOT-RCAN.
           MOVE OPC-CIC-IOPC IN OPC TO ROV-CIC-IOPC IN ROV.
           MOVE LOW-VALUES          TO ROV-KEY-IVCT IN ROV.
           MOVE FIO-GET-NLS TO FIO-CMND.
      * ASUME QUE NO ENCONTRARA ROV'S
           MOVE '23' TO PGM-STAT-ROV.
       CIC-GET-ROV-REN.
           PERFORM COL-FIO-ROV.
           IF NOT ( FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = ROV-CIC-IOPC IN ROV )
               GO TO VRF-RCAN.

           IF OPC-CIC-IOPC IN OPC NOT = ROV-CIC-IOPC IN ROV
               GO TO VRF-RCAN.

           IF NOT ( ROV-IIC-IOPV IN ROV > ZEROES AND
                    ROV-NUM-IVCT IN ROV > ZEROES )
                       MOVE FIO-GET-NXT TO FIO-CMND
                       GO TO CIC-GET-ROV-REN
           ELSE
                MOVE FIO-STAT TO PGM-STAT-ROV
                MOVE ROV-KEY-IVCT IN ROV TO CAN-KEY-ICAN IN CAN
                MOVE FIO-GET-KEY TO FIO-CMND
                PERFORM COL-FIO-CAN
                IF FIO-STAT-OKS AND
      *JSS 15-MAY-1991 20:41:00 ( agregado OR 'P' para manejo de cc )
                   ( CAN-MSC-STAT IN CAN = 'C' OR 'W' OR 'P' )
                       MOVE CAN-KEY-ICAN TO RCAN-CAN-KEY-ICAN
                       ADD 1 TO WSS-TOT-RCAN
      *                 ADD ROV-SGV-RENO IN ROV TO WSS-SGV-RENO
                       ADD CAN-SGV-TREN IN CAN TO WSS-SGV-RENO
                       MOVE FIO-GET-NXT TO FIO-CMND
                       GO TO CIC-GET-ROV-REN.
       VRF-RCAN.
      * EN INGRESO VERIFICO QUE EXISTIERA AL MENOS UNA CANCELACION
      * CON STATUS 'C' OR 'W'
           IF WSS-TOT-RCAN = ZEROES
               GO TO FIN-GET-ROV-REN.

      *    RECUPERA ULTIMA CANCELACION CON STATUS 'C' O 'W'
           MOVE RCAN-CAN-KEY-ICAN TO CAN-KEY-ICAN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           MOVE FIO-STAT TO PGM-STAT-CAN.

      * ELIMINAR UNA VEZ QUE FUNCIONE LO OTRO
      *     IF WSS-TOT-RCAN > 1
      *         MOVE 'MULT' TO CAN-CAI-IOPC IN OPC-FLD
      *         MOVE ZEROES TO CAN-IIC-IOPC IN OPC-FLD
      *         MOVE ZEROES TO CAN-NUM-ICAN IN OPC-FLD
      *     ELSE
      *         MOVE CAN-CAI-IOPC IN CAN TO CAN-CAI-IOPC IN OPC-FLD
      *         MOVE CAN-IIC-IOPC IN CAN TO CAN-IIC-IOPC IN OPC-FLD
      *         MOVE CAN-NUM-ICAN IN CAN TO CAN-NUM-ICAN IN OPC-FLD.
       FIN-GET-ROV-REN.
           EXIT.

       GET-CAN SECTION.
       INI-GET-CAN.
           MOVE ROV-KEY-IVCT IN ROV TO CAN-KEY-ICAN IN CAN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           MOVE FIO-STAT TO PGM-STAT-CAN.
       FIN-GET-CAN.
           EXIT.

      *JPA ini  23-01-94     POR USO DE COPY COLBQOPC
      *BUS-CNC SECTION.
      *INI-BUS-CNC.
      *    MOVE SPACES TO TAB SCR-MSC-TCAN.
      *    MOVE 'COL' TO TAB-COD-SIST.
      *    MOVE 'CNC' TO TAB-COD-TTAB IN TAB.
      *    MOVE CAN-MSC-CANC IN CAN TO TAB-COD-CTAB IN TAB.
      *    PERFORM BUS-TAB.
      *    MOVE TAB-GLS-ABRV IN TAB TO OPC-IND-RENO IN OPC-FLD.
      *    MOVE TAB-CIC-CTAB IN TAB TO SCR-MSC-TCAN.
      *FIN-BUS-CNC.
      *    EXIT.
      *JPA fin  23-01-94

       MSG-ABT-KEY SECTION.
       INI-MSG-ABT-KEY.
           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE '00' TO FIO-STAT.
           MOVE SCR-STAT-CON TO SCR-STAT.
       FIN-MSG-ABT-KEY.
           EXIT.

       PRO-NOV-OPC SECTION.
       INI-PRO-NOV-OPC.
           MOVE SPACES TO MSG-COD-MENS.
      * RECUPERA POR ROV LAS LLAVES LAS OPERACIONES ASOCIADAS
      * A LA CANCELACION QUE ESTA EN LA PANTALLA
           MOVE CAN-CAI-IOPC IN OPC-FLD TO ROV-CAI-IOPV IN ROV.
           MOVE CAN-IIC-IOPC IN OPC-FLD TO ROV-IIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN OPC-FLD TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
       CIC-PRO-NOV-OPC.
           PERFORM COL-FIO-ROV.
           IF FIO-STAT-OKS AND
              CAN-CAI-IOPC IN OPC-FLD = ROV-CAI-IOPV IN ROV AND
              CAN-IIC-IOPC IN OPC-FLD = ROV-IIC-IOPV IN ROV
                PERFORM PRO-OPC-ROV
                IF MSG-COD-MENS NOT > SPACES
                      MOVE 'ROV-KEY-IVCT' TO FIO-AKEY
                      MOVE FIO-GET-NXT TO FIO-CMND
                      GO TO CIC-PRO-NOV-OPC.
           MOVE 'COL' TO MSG-COD-SIST.
           MOVE 'OPC    NOVOK' TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
       FIN-PRO-NOV-OPC.
           EXIT.

       PRO-OPC-ROV SECTION.
       INI-PRO-OPC-ROV.
           IF ROV-MSC-STAT IN ROV NOT = 'S'
                GO TO FIN-PRO-OPC-ROV.
           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF OPC-MSC-STAT = 'S'
               PERFORM MOD-ROV
               PERFORM PRO-OPC-CYA.
           PERFORM ACT-OPC-OPC.
           PERFORM UPD-DBR-COPE.
       FIN-PRO-OPC-ROV.
           EXIT.

       ACT-OPC-ROV SECTION.
       INI-ACT-OPC-ROV.
           PERFORM KEY-ALL-OPC.
           MOVE OPC-CIC-IOPC IN OPC TO ROV-CIC-IOPC IN ROV.
           MOVE CAN-KEY-ICAN IN CAN TO ROV-KEY-IVCT IN ROV.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-ROV.

           IF SCR-IND-ACAN = 'NOV'
      *         MOVE ROV-SGV-RENO IN OPC-FLD TO ROV-SGV-RENO IN ROV
               MOVE 'A' TO ROV-MSC-STAT
           ELSE
               MOVE 'S' TO ROV-MSC-STAT.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-ROV.
      *ALD
      *     MOVE FIO-GET-KEY-UPD TO FIO-CMND.
      *     PERFORM COL-FIO-OPC.
       FIN-ACT-OPC-ROV.
           EXIT.

       MOD-ROV SECTION.
       INI-MOD-ROV.
      *Debe hacerse por llave principal
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF SCR-IND-ACAN = 'NOV'
               MOVE 'A' TO ROV-MSC-STAT
           ELSE
               MOVE 'S' TO ROV-MSC-STAT.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ROV.
       FIN-MOD-ROV.
           EXIT.

       PRO-OPC-CYA SECTION.
       INI-PRO-OPC-CYA.
           MOVE SPACES TO MSG-COD-MENS.
           PERFORM GET-CUR-CYA.
           PERFORM CRG-SAF.
           IF NOT FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'SAFE   ERR' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
           ELSE
               MOVE SPACES TO MSG-COD-MENS.
       FIN-PRO-OPC-CYA.
           EXIT.

       ACT-OPC-OPC SECTION.
       INI-ACT-OPC-OPC.
      *JUS ini  01-DIC-1994    MUEVO FEC-COMP. A FEC-CTBL (ING)
           MOVE OPC-NUM-DINP IN OPC-FLD TO OPC-NUM-DINP IN OPC
                                           OPC-NUM-DING IN OPC.
           MOVE OPC-NUM-MINP IN OPC-FLD TO OPC-NUM-MINP IN OPC
                                           OPC-NUM-MING IN OPC.
           MOVE OPC-NUM-SINP IN OPC-FLD TO OPC-NUM-SINP IN OPC
                                           OPC-NUM-SING IN OPC.
           MOVE OPC-NUM-AINP IN OPC-FLD TO OPC-NUM-AINP IN OPC
                                           OPC-NUM-AING IN OPC.
      *JUS fin  01-DIC-1994
      *JSS 17-MAY-1991 11:38:41 ( para manejo de cuenta corriente )
           IF WSS-OPC-LNBT = 'S' OR 'N'
               MOVE 'G' TO OPC-MSC-STAT IN OPC
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Por ahora no se procesan NOV con Abono en Cta.Cte., por lo que NO
      *se Incorporo manejo del Abono/Cargo en Cta.Cte. ( Linea / Batch )
      *y de la MVO de Cta.Cte. ( Activar / Generar ).
      *DAD fin  17-MAY-1993
           ELSE
      *
           MOVE 'A' TO OPC-MSC-STAT IN OPC.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FIN-ACT-OPC-OPC.
           EXIT.

      *ALD/8-AUG-1988
       UPD-DBR-COPE SECTION.
       INI-UPD-DBR-COPE.
           MOVE SYS-GET-DATE TO SYS-CMND.
           PERFORM GNS-PRO-SYS.

      *ISP NO ACTUALIZA DBD PARA VERSION BCI.
           MOVE 'COL' TO TAB-COD-SIST.
           MOVE 'VSN' TO TAB-COD-TTAB IN TAB.
           MOVE 'BCI    ADBD' TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS NOT > SPACES
               PERFORM GET-UPD-DBD
               IF NOT FIO-STAT-OKS
                   GO TO FIN-UPD-DBR-COPE
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE SPACES TO MSG-COD-MENS.

      *ISP NO ACTUALIZA RCO PARA VERSION BCI.
           MOVE 'COL' TO TAB-COD-SIST.
           MOVE 'VSN' TO TAB-COD-TTAB IN TAB.
           MOVE 'BCI    ARCO' TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS NOT > SPACES
              PERFORM GET-UPD-RCO
              IF NOT FIO-STAT-OKS
                  GO TO FIN-UPD-DBR-COPE
              ELSE
                  NEXT SENTENCE
            ELSE
                MOVE SPACES TO MSG-COD-MENS.
      *ISP NO ACTUALIZA OPE PARA VERSION BCI.
           MOVE 'COL' TO TAB-COD-SIST.
           MOVE 'VSN' TO TAB-COD-TTAB IN TAB.
           MOVE 'BCI    AOPE' TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS NOT > SPACES
               PERFORM GET-UPD-OPE
               IF FIO-STAT-OKS
                   PERFORM BCK-OUT
                   MOVE 'COL' TO MSG-COD-SIST
                   MOVE 'OPE    YAEXI' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FIO-STAT-NEX TO FIO-STAT
                   GO TO FIN-UPD-DBR-COPE
               ELSE
                   PERFORM PUT-OPE
           ELSE
               MOVE SPACES TO MSG-COD-MENS.
       FIN-UPD-DBR-COPE.
           EXIT.

       GET-UPD-DBD SECTION.
       INI-GET-UPD-DBD.
           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC'      TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = RDC-CIC-IOPC IN RDC )
               MOVE '00' TO FIO-STAT
               GO TO FIN-GET-UPD-DBD.
       LUP-GET-UPD-DBD.
           IF RDC-NUM-IDLC IN RDC > ZEROES
               GO TO NXT-GET-RDC-DBD.
           MOVE RDC-CIC-ICLI IN RDC TO DBD-CIC-ICLI IN DBD.
           MOVE OPC-STP-ITRN IN OPC TO DBD-STP-ITRN IN DBD.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DEU-FIO-DBD.
           IF NOT FIO-STAT-OKS
               GO TO ING-DBD.
           ADD OPC-NUM-VCVG IN OPC TO DBD-NUM-VCVG IN DBD.
           ADD 1 TO DBD-NUM-OCTD IN DBD.
           ADD 1 TO DBD-NUM-OCVG IN DBD.
           IF OPC-FEC-FCOL IN OPC     < DBD-FEC-FPCR IN DBD OR
              DBD-FEC-FPCR IN DBD NOT > ZEROES
               MOVE OPC-FEC-FCOL IN OPC TO DBD-FEC-FPCR IN DBD.
           IF OPC-FEC-FCOL IN OPC > DBD-FEC-FUCR IN DBD
               MOVE OPC-FEC-FCOL IN OPC TO DBD-FEC-FUCR IN DBD.
       MOD-DBD.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM DEU-FIO-DBD.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-GET-UPD-DBD.
           GO TO NXT-GET-RDC-DBD.
       ING-DBD.
           MOVE OPC-NUM-VCVG IN OPC TO DBD-NUM-VCVG IN DBD.
           PERFORM INI-REG-DBD.
           MOVE 1 TO DBD-NUM-OCTD IN DBD.
           MOVE 1 TO DBD-NUM-OCVG IN DBD.
           MOVE OPC-FEC-FCOL IN OPC TO DBD-FEC-FPCR IN DBD.
           MOVE OPC-FEC-FCOL IN OPC TO DBD-FEC-FUCR IN DBD.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DEU-FIO-DBD.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-GET-UPD-DBD.
       NXT-GET-RDC-DBD.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = RDC-CIC-IOPC IN RDC )
               MOVE '00' TO FIO-STAT
               GO TO FIN-GET-UPD-DBD.
           GO TO LUP-GET-UPD-DBD.
       FIN-GET-UPD-DBD.
           EXIT.

       GET-UPD-RCO SECTION.
       INI-GET-UPD-RCO.
           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC'      TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = RDC-CIC-IOPC IN RDC )
               MOVE '00' TO FIO-STAT
               GO TO FIN-GET-UPD-RCO.
       LUP-GET-UPD-RCO.
           MOVE RDC-CIC-ICLI IN RDC TO RCO-CIC-ICLI IN RCO.
           MOVE OPC-CIC-IOPC IN OPC TO RCO-CIC-IOPE IN RCO.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF FIO-STAT-OKS
               GO TO NXT-GET-RDC-RCO.
           PERFORM PUT-RCO.
           IF NOT FIO-STAT-OKS
               GO TO FIN-GET-UPD-RCO.
       NXT-GET-RDC-RCO.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = RDC-CIC-IOPC IN RDC )
               MOVE '00' TO FIO-STAT
               GO TO FIN-GET-UPD-RCO.
           GO TO LUP-GET-UPD-RCO.
       FIN-GET-UPD-RCO.
           EXIT.

       GET-UPD-OPE SECTION.
       INI-GET-UPD-OPE.
           MOVE OPC-CIC-IOPC IN OPC TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
       FIN-GET-UPD-OPE.
           EXIT.

       PUT-RCO SECTION.
       INI-PUT-RCO.
           MOVE SYS-TSTP TO RCO-STP-ITRN IN RCO.
           PERFORM INI-REG-RCO.
           MOVE RDC-CIC-ICLI IN RDC TO RCO-CIC-ICLI IN RCO.
           MOVE OPC-CIC-IOPC IN OPC TO RCO-CIC-IOPE IN RCO.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT.
       FIN-PUT-RCO.
           EXIT.

       PUT-OPE SECTION.
       INI-PUT-OPE.
           MOVE SYS-TSTP TO OPE-STP-ITRN IN OPE.
           PERFORM INI-REG-OPE.
           MOVE OPC-CIC-IOPC IN OPC TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT.
       FIN-PUT-OPE.
           EXIT.

       BCK-OUT SECTION.
       INI-BCK-OUT.
           MOVE FIO-BCK-OUT TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF FIO-STAT-OKS
               MOVE '49' TO FIO-STAT.
       FIN-BCK-OUT.
           EXIT.

       INI-REG-DBD SECTION.
       INI-INI-REG-DBD.
           MOVE SPACES                     TO DBD-GLS-FLAG IN DBD.
           MOVE SPACES                     TO DBD-MSC-TACC IN DBD.
           MOVE SPACES                     TO DBD-COD-OTRN IN DBD.
           MOVE SPACES                     TO DBD-COD-ATRN IN DBD.
           MOVE ZEROES                     TO DBD-SAM-PIVA IN DBD.
           MOVE SPACES                     TO DBD-IND-CASB IN DBD.
           MOVE SPACES                     TO DBD-IND-DVCB IN DBD.
           MOVE SPACES                     TO DBD-IND-DVDB IN DBD.
           MOVE SPACES                     TO DBD-IND-GARV IN DBD.
           MOVE SPACES                     TO DBD-IND-DLDC IN DBD.
           MOVE ZEROES                     TO DBD-NUM-SOLR IN DBD.
           MOVE ZEROES                     TO DBD-NUM-VCCO IN DBD.
           MOVE ZEROES                     TO DBD-NUM-VCCA IN DBD.
           MOVE ZEROES                     TO DBD-NUM-VCCP IN DBD.
           MOVE ZEROES                     TO DBD-NUM-VCCR IN DBD.
           MOVE ZEROES                     TO DBD-FEC-FUCA IN DBD.
           MOVE ZEROES                     TO DBD-FEC-FEMA IN DBD.
           MOVE ZEROES                     TO DBD-VAL-EMUF IN DBD.
           MOVE ZEROES                     TO DBD-VAL-EPUF IN DBD.
           MOVE SPACES                     TO DBD-IND-CRCB IN DBD.
           MOVE ZEROES                     TO DBD-FEC-FCRI IN DBD.
           MOVE SPACES                     TO DBD-IND-CRVB IN DBD.
           MOVE SPACES                     TO DBD-IND-CRCS IN DBD.
           MOVE SPACES                     TO DBD-IND-CRVS IN DBD.
           MOVE SPACES                     TO DBD-GLS-DISP IN DBD.
       FIN-INI-REG-DBD.
           EXIT.

       INI-REG-RCO SECTION.
       INI-INI-REG-RCO.
           MOVE SPACES                     TO RCO-GLS-FLAG IN RCO.
           MOVE SPACES                     TO RCO-MSC-TACC IN RCO.
           MOVE SPACES                     TO RCO-MSC-STAT IN RCO.
           MOVE SPACES                     TO RCO-COD-OTRN IN RCO.
           MOVE SPACES                     TO RCO-COD-ATRN IN RCO.
           MOVE SPACES                     TO RCO-COD-STAT IN RCO.
           MOVE 'TAB'                      TO FIO-SIST.
           MOVE 'RCO'                      TO TAB-CIC-TTAB IN TAB.
           IF RDC-NUM-IDLC IN RDC NOT > ZEROES
               MOVE 'DIR' TO TAB-CIC-CTAB IN TAB
           ELSE
               MOVE 'IND' TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL'  TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           MOVE TAB-COD-CTAB IN TAB TO RCO-COD-RCOP IN RCO.
           MOVE RDC-NUM-DIRE IN RDC TO RCO-NUM-DIRE IN RCO.
           MOVE RDC-VAL-LIMD IN RDC TO RCO-VAL-PRCO IN RCO.
           MOVE OPC-COD-COOC IN OPC TO RCO-COD-COPR IN RCO.
           MOVE SPACES              TO RCO-GLS-DISP IN RCO.
       FIN-INI-REG-RCO.
           EXIT.

       INI-REG-OPE SECTION.
       INI-INI-REG-OPE.
           MOVE SPACES                     TO OPE-GLS-FLAG IN OPE.
           MOVE SPACES                     TO OPE-MSC-TACC IN OPE.
           MOVE SPACES                     TO OPE-MSC-STAT IN OPE.
           MOVE SPACES                     TO OPE-COD-OTRN IN OPE.
           MOVE SPACES                     TO OPE-COD-ATRN IN OPE.
           MOVE SPACES                     TO OPE-COD-STAT IN OPE.
           MOVE OPC-COD-VCOC IN OPC        TO OPE-COD-VCOP IN OPE.
           MOVE OPC-COD-COOC IN OPC        TO OPE-COD-COPR IN OPE.
           MOVE OPC-COD-OFOC IN OPC        TO OPE-COD-OFOP IN OPE.
           MOVE OPC-COD-RMOC IN OPC        TO OPE-COD-EJOP IN OPE.
           MOVE OPC-FEC-FCOL IN OPC        TO OPE-FEC-FIOP IN OPE.
           MOVE ZEROES                     TO OPE-FEC-FTOP IN OPE.
           MOVE SPACES                     TO OPE-COD-MOTT IN OPE.
           MOVE ZEROES                     TO OPE-FEC-FROP IN OPE.
           MOVE SPACES                     TO OPE-IND-MCLI IN OPE.
      *    MOVE SPACES                     TO OPE-GLS-DISP IN OPE.
       FIN-INI-REG-OPE.
           EXIT.
      *

       CRG-SAF SECTION.
       INI-CRG-SAF.
           IF CYA-IND-MAUT IN CYA NOT = 'S'
               GO TO NXT-GET-CYA.

           IF CYA-SGV-LIQU IN CYA NOT > ZEROES
               MOVE '0670'          TO ICC-COD-TRAN IN ICC
           ELSE
               MOVE '0770'          TO ICC-COD-TRAN IN ICC.
           MOVE '01'                TO ICC-IND-INDI IN ICC.
           MOVE CYA-CIC-ICYA IN CYA TO ICC-COD-CCTE IN ICC.
           IF CYA-SGV-LIQU IN CYA NOT > ZEROES
               MOVE  '000000000072' TO ICC-COD-SERI IN ICC
           ELSE
               MOVE  '000000000052' TO ICC-COD-SERI IN ICC.
           MOVE ZEROES              TO ICC-SGV-VPE2 IN ICC.
           MOVE CYA-SGV-LIQU IN CYA TO ICC-SGV-VPE2 IN ICC.
           MOVE '0'                 TO ICC-IND-TCAM IN ICC.
           MOVE 1                   TO ICC-SGV-VCON IN ICC.
           MOVE OPC-COD-OFOC IN OPC TO ICC-COD-OFOC IN ICC.
           MOVE SPACES              TO ICC-COD-UBIC IN ICC.
           MOVE SPACES              TO ICC-COD-ITRE IN ICC.
           MOVE SPACES              TO ICC-GLS-DISP IN ICC.

      *ISP PONE VALORES EN VARIABLES FIO PARA QUE EN CASO DE FALLAR
      *    EL WRITE, LAS DECLARATIVAS ENTREGEN INFORMACION CORRECTA
      *    NO SE USA FIO, PUES ARCHIVO SAM ==> CLAUSULA 'RBA'

           MOVE FIO-PUT TO FIO-CMND.
           MOVE 'COLVSAF' TO FIO-VOID.
           MOVE ICC TO FIO-DFLD.
           MOVE 100 TO FIO-RLEN.

      *     EXEC CICS WRITE
      *                 DATASET('COLVSAF')
      *                 FROM(ICC)
      *                 LENGTH(100)
      *                 RIDFLD(SAF-COD-TRN)
      *                 RBA
      *     END-EXEC.
           MOVE '00' TO FIO-STAT.
      *
           IF NOT FIO-STAT-OKS
               GO TO FIN-CRG-SAF.

       NXT-GET-CYA.
           PERFORM GET-NXT-CYA.
           IF MSG-COD-MENS = 'OPC    MCYA'
               GO TO INI-CRG-SAF.
       FIN-CRG-SAF.
           EXIT.

       GET-CUR-RDC SECTION.
       INI-GET-CUR-RDC.
           MOVE OPC-CAI-IOPC IN OPC TO RDC-CAI-IOPC IN RDC.
           MOVE OPC-IIC-IOPC IN OPC TO RDC-IIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
      *DSP COMPATIBILIDAD VSAM-DTC FIO-GET-KEY TO FIO-CMND.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF FIO-STAT-OKS AND
              RDC-CAI-IOPC IN RDC = OPC-CAI-IOPC IN OPC AND
              RDC-IIC-IOPC IN RDC = OPC-IIC-IOPC IN OPC AND
              RDC-NUM-IDLC IN RDC = ZEROES
               NEXT SENTENCE
           ELSE
               MOVE '23' TO FIO-STAT.
      *DSP COMPATIBILIDAD VSAM-DTC
           IF FIO-STAT-OKS
               MOVE '00' TO PGM-STAT-RDC
           ELSE
               MOVE '23' TO PGM-STAT-RDC.
       FIN-GET-CUR-RDC.
           EXIT.

       GET-NXT-RDC SECTION.
       INI-GET-NXT-RDC.
           MOVE SPACES TO MSG-COD-SIST.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF FIO-STAT-OKS AND
              OPC-CAI-IOPC IN OPC = RDC-CAI-IOPC IN RDC AND
              OPC-IIC-IOPC IN OPC = RDC-IIC-IOPC IN RDC AND
              RDC-NUM-IDLC IN RDC = ZEROES
                MOVE 'M' TO SCR-IND-MRDC
                MOVE 'COL'          TO MSG-COD-SIST
                MOVE 'OPC    MDDIR' TO MSG-COD-MENS
                PERFORM GET-MSG
           ELSE
                MOVE SPACES TO SCR-IND-MRDC
                PERFORM GET-CUR-RDC.
       FIN-GET-NXT-RDC.
           EXIT.

       ANL-KEY-OPC SECTION.
       INI-ANL-KEY-OPC.
           PERFORM GET-CLI.
           IF MSG-COD-MENS > SPACES
               MOVE ZEROES TO DBC-NUM-ICLI IN OPC-FLD
               MOVE SPACES TO DBC-VRF-ICLI IN OPC-FLD
               MOVE SPACES TO DBC-IND-ICLI IN OPC-FLD
               MOVE SPACES TO DBC-GLS-ICLI IN OPC-FLD
               MOVE FIO-STAT-NEX TO FIO-STAT
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-ANL-KEY-OPC
           ELSE
               MOVE '00' TO PGM-STAT-DBC
               MOVE ADR-DBC-REQA TO SCR-RQA1
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN            TO DBC-GLS-NOMC IN OPC-FLD
               MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN OPC-FLD
               MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN OPC-FLD
               MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN OPC-FLD
               MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN OPC-FLD
               PERFORM BUS-DEU-DIR
               IF FIO-STAT-OKS
                   MOVE BUS-POR-CLTE TO BUS-POR-KEYS
                   MOVE RDC-CIC-IOPC IN RDC TO OPC-CIC-IOPC IN OPC
               ELSE
                   MOVE 'COL' TO MSG-COD-SIST
                   MOVE 'CLI    NODIR' TO MSG-COD-MENS
                   MOVE FIO-STAT-NEX TO FIO-STAT.
       FIN-ANL-KEY-OPC.
           EXIT.
       ANL-KEY-ALL SECTION.
       INI-ANL-KEY-ALL.
           PERFORM GET-CUR-ITR.
           IF NOT FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'OPC    NOINT' TO MSG-COD-MENS
               GO TO FIN-ANL-KEY-ALL.
      *LRH ini  12-ABR-1994   (Memo.26-01-94, Pto.3)
      *DAD ini  06-JUL-1994   (Memo.07-07-94 Pto.1)
           IF OPC-IND-VSTR IN OPC = 'S'
      *DAD fin  06-JUL-1994
               MOVE OPC-CAI-IOPC IN OPC-FLD TO EVC-CAI-IOPC IN EVC
               MOVE OPC-IIC-IOPC IN OPC-FLD TO EVC-IIC-IOPC IN EVC
               MOVE 1                       TO EVC-NUM-IEVC IN EVC
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM COL-FIO-EVC
               IF NOT FIO-STAT-OKS
                   MOVE 'COL'        TO MSG-COD-SIST
                   MOVE 'EVC    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-ANL-KEY-ALL
               ELSE
                   MOVE 'COL'          TO TAB-COD-SIST FIO-SIST
                   MOVE 'CVC'          TO TAB-CIC-TTAB IN TAB
                   MOVE 'FP'           TO TAB-CIC-CTAB IN TAB
                   MOVE FIO-GET-KEY    TO FIO-CMND
                   MOVE 'TAB-CIC-TABL' TO FIO-AKEY
                   PERFORM GNS-FIO-TAB
                   IF NOT FIO-STAT-OKS
                       MOVE 'COL'          TO MSG-COD-SIST
                       MOVE 'CIC    FPNEX' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       GO TO FIN-ANL-KEY-ALL
                   ELSE
                       IF EVC-MSC-TCVE IN EVC NOT = TAB-COD-CTAB IN TAB
                           PERFORM GET-NXT-ITR.
      *     PERFORM GET-NXT-ITR.
      *LRH fin  12-ABR-1994
           IF SCR-IND-MITR = 'M'
               MOVE 'MULTIPLES'  TO ITR-COD-TINT IN OPC-FLD
           ELSE
               MOVE '00' TO PGM-STAT-ITR
               PERFORM PUT-ITR-OPC.
           PERFORM GET-CUR-COM.
           IF FIO-STAT-OKS
                MOVE '00' TO PGM-STAT-COM
                PERFORM GET-NXT-COM
                IF SCR-IND-MCOM = 'M'
                    MOVE 'MULTIPLES' TO COM-COD-TINT IN OPC-FLD
                ELSE
                    PERFORM PUT-COM-OPC
           ELSE
                MOVE SPACES TO MSG-COD-SIST
                MOVE SPACES TO MSG-COD-MENS
                MOVE ZEROES TO COM-SGV-TINT IN OPC-FLD
                MOVE SPACES TO COM-COD-TINT IN OPC-FLD.
           PERFORM BUS-AUT-CYA.
           PERFORM GET-CUR-CYA.
           IF FIO-STAT-OKS
                MOVE '00' TO PGM-STAT-CYA
                PERFORM GET-NXT-CYA
                IF SCR-IND-MCYA = 'M'
                    MOVE 'M'          TO CYA-IND-TCYA IN OPC-FLD
                    MOVE MSG-GLS-DESC TO FRM-MEN2
                    MOVE SPACES TO MSG-COD-SIST
                    MOVE SPACES TO MSG-COD-MENS
                ELSE
                    PERFORM PUT-CYA-OPC
           ELSE
                MOVE SPACES TO MSG-COD-SIST
                MOVE SPACES TO MSG-COD-MENS
                MOVE SPACES TO CYA-IND-TCYA IN OPC-FLD
                MOVE SPACES TO CYA-CAI-ICYA IN OPC-FLD
                MOVE ZEROES TO CYA-IIC-ICYA IN OPC-FLD.
           MOVE OPC-CIC-IOPC IN OPC TO AUT-CIC-IOPC IN AUT.
           MOVE 'AUT'               TO AUT-NUM-ICAN IN AUT.
           MOVE 1                   TO AUT-NUM-ICYA IN AUT.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-AUT.
           IF FIO-STAT-OKS
               MOVE '00' TO PGM-STAT-AUT
               PERFORM PUT-AUT-OPC
           ELSE
               MOVE SPACES TO MSG-COD-SIST
               MOVE SPACES TO MSG-COD-MENS
               MOVE ZEROES TO AUT-IIC-ICYA IN OPC-FLD
               MOVE SPACES TO AUT-CAI-ICYA IN OPC-FLD.
           PERFORM GET-CUR-ROV.
       FIN-ANL-KEY-ALL.
           EXIT.

       GET-CUR-ITR SECTION.
       INI-GET-CUR-ITR.
           MOVE 'ITR-KEY-IICG' TO FIO-AKEY.
           MOVE OPC-CIC-IOPC IN OPC TO ITR-CIC-IOPC IN ITR.
           MOVE ZEROES              TO ITR-NUM-ICAN IN ITR.
           MOVE SPACES              TO ITR-CIC-IOPV IN ITR
           MOVE ZEROES              TO ITR-NUM-IVCT IN ITR
           MOVE 'INT'               TO ITR-IND-TTAS IN ITR.
           MOVE ZEROES              TO ITR-FEC-FINI IN ITR.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ITR.
           IF NOT ( FIO-STAT-OKS AND
                    ITR-CIC-IOPC IN ITR = OPC-CIC-IOPC IN OPC AND
                    ITR-NUM-ICAN IN ITR = ZEROES              AND
                    ITR-CIC-IOPV IN ITR = SPACES              AND
                    ITR-NUM-IVCT IN ITR = ZEROES              AND
                    ITR-IND-TTAS IN ITR = 'INT'  )
               MOVE '23' TO FIO-STAT.
       FIN-GET-CUR-ITR.
           EXIT.

       GET-NXT-ITR SECTION.
       INI-GET-NXT-ITR.
           MOVE 'ITR-KEY-IICG' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-ITR.
           IF FIO-STAT-OKS                              AND
              ITR-CIC-IOPC IN ITR = OPC-CIC-IOPC IN OPC AND
              ITR-NUM-ICAN IN ITR = ZEROES              AND
              ITR-CIC-IOPV IN ITR = SPACES              AND
              ITR-NUM-IVCT IN ITR = ZEROES              AND
              ITR-IND-TTAS IN ITR = 'INT'
                MOVE 'M' TO SCR-IND-MITR
           ELSE
                MOVE SPACES TO SCR-IND-MITR
                PERFORM GET-CUR-ITR.
       FIN-GET-NXT-ITR.
           EXIT.

       GET-CUR-COM SECTION.
       INI-GET-CUR-COM.
           MOVE 'COM-KEY-IICG' TO FIO-AKEY.
           MOVE OPC-CIC-IOPC IN OPC TO COM-CIC-IOPC IN COM.
           MOVE ZEROES              TO COM-NUM-ICAN IN COM.
           MOVE SPACES              TO COM-CIC-IOPV IN COM.
           MOVE ZEROES              TO COM-NUM-IVCT IN COM.
           MOVE 'COM'               TO COM-IND-TTAS IN COM.
           MOVE ZEROES              TO COM-FEC-FINI IN COM.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-COM.
           IF NOT ( FIO-STAT-OKS AND
                    COM-CIC-IOPC IN COM = OPC-CIC-IOPC IN OPC AND
                    COM-NUM-ICAN IN COM = ZEROES              AND
                    COM-CIC-IOPV IN COM = SPACES              AND
                    COM-NUM-IVCT IN COM = ZEROES              AND
                    COM-IND-TTAS IN COM = 'COM' )
               MOVE '23' TO FIO-STAT.
       FIN-GET-CUR-COM.
           EXIT.

       GET-NXT-COM SECTION.
       INI-GET-NXT-COM.
           MOVE 'COM-KEY-IICG' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-COM.
           IF FIO-STAT-OKS                              AND
              COM-CIC-IOPC IN COM = OPC-CIC-IOPC IN OPC AND
              COM-NUM-ICAN IN COM = ZEROES              AND
              COM-CIC-IOPV IN COM = SPACES              AND
              COM-NUM-IVCT IN COM = ZEROES              AND
              COM-IND-TTAS IN COM = 'COM'
                MOVE 'M' TO SCR-IND-MCOM
           ELSE
                MOVE SPACES TO SCR-IND-MCOM
                PERFORM GET-CUR-COM.
       FIN-GET-NXT-COM.
           EXIT.

       GET-CUR-CYA SECTION.
       INI-GET-CUR-CYA.
           MOVE 'CYA-KEY-ICYA' TO FIO-AKEY.
           MOVE OPC-CIC-IOPC IN OPC TO CYA-CIC-IOPC IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICAN IN CYA.
           MOVE 1                   TO CYA-NUM-ICYA IN CYA.
      *DSP COMPATIBILIDAD VSAM-DTC FIO-GET-KEY TO FIO-CMND.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF FIO-STAT-OKS AND
              CYA-CIC-IOPC IN CYA = OPC-CIC-IOPC IN OPC AND
              CYA-NUM-ICAN IN CYA = ZEROES AND
              CYA-NUM-ICYA IN CYA = 1
               NEXT SENTENCE
           ELSE
               MOVE '23' TO FIO-STAT.
      *DSP COMPATIBILIDAD VSAM-DTC
       FIN-GET-CUR-CYA.
           EXIT.

       GET-NXT-CYA SECTION.
       INI-GET-NXT-CYA.
           MOVE SPACES TO MSG-COD-SIST.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE 'CYA-KEY-ICYA' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF FIO-STAT-OKS                              AND
              OPC-CIC-IOPC IN OPC = CYA-CIC-IOPC IN CYA AND
              CYA-NUM-ICAN IN CYA = ZEROES
               MOVE 'M' TO SCR-IND-MCYA
               MOVE 'COL'         TO MSG-COD-SIST
               MOVE 'OPC    MCYA' TO MSG-COD-MENS
               PERFORM GET-MSG
           ELSE
               MOVE SPACES TO SCR-IND-MCYA
               PERFORM GET-CUR-CYA.
       FIN-GET-NXT-CYA.
           EXIT.

       GET-CUR-ROV SECTION.
       INI-GET-CUR-ROV.
           MOVE 'ROV-KEY-IROV' TO FIO-AKEY.
           MOVE OPC-CIC-IOPC IN OPC TO ROV-CIC-IOPC IN ROV.
           MOVE CAN-KEY-ICAN IN CAN TO ROV-KEY-IVCT IN ROV.
      *DSP COMPATIBILIDAD VSAM-DTC FIO-GET-KEY TO FIO-CMND.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF FIO-STAT-OKS AND
              ROV-CIC-IOPC IN ROV = OPC-CIC-IOPC IN OPC AND
              ROV-KEY-IVCT IN ROV = CAN-KEY-ICAN IN CAN
               NEXT SENTENCE
           ELSE
               MOVE '23' TO FIO-STAT.
      *DSP COMPATIBILIDAD VSAM-DTC
           IF FIO-STAT-OKS
               MOVE '00' TO PGM-STAT-ROV.
       FIN-GET-CUR-ROV.
           EXIT.

       BUS-DEU-DIR SECTION.
       INI-BUS-DEU-DIR.
           MOVE SPACES              TO RDC-KEY-IRDC IN RDC.
           MOVE DBC-CAI-ICLI IN DBC TO RDC-CAI-ICLI IN RDC.
           MOVE DBC-IIC-ICLI IN DBC TO RDC-IIC-ICLI IN RDC.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           IF FRM-FFLD = FRM-FFLD-PF7
               MOVE '999999999999' TO RDC-KEY-IDLC IN RDC
               MOVE 999 TO RDC-NUM-IDLC IN RDC
               MOVE FIO-GET-LEQ TO FIO-CMND.
       LUP-BUS-DEU-DIR.
           PERFORM COL-FIO-RDC.
           IF FIO-STAT-OKS AND
              RDC-CIC-ICLI IN RDC = DBC-CIC-ICLI IN DBC
               IF RDC-NUM-IDLC IN RDC = ZEROES
                   MOVE '00' TO PGM-STAT-RDC
                   MOVE ADR-RDC-REQA TO SCR-RQA2
                   MOVE 'IRDC' TO SCR-KEY-IRDC
                   GO TO FIN-BUS-DEU-DIR
               ELSE
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE FIO-GET-PRV TO FIO-CMND
                       GO TO LUP-BUS-DEU-DIR
                   ELSE
                       MOVE FIO-GET-NXT TO FIO-CMND
                       GO TO LUP-BUS-DEU-DIR
            ELSE
               MOVE SPACES TO SCR-RQA2
               MOVE FIO-STAT-NEX TO FIO-STAT.
       FIN-BUS-DEU-DIR.
           EXIT.
       BUS-AUT-CYA SECTION.
       INI-BUS-AUT-CYA.
           MOVE 'N' TO WSS-IND-PAUT IN WSS-VARI.
           MOVE 'CYA-KEY-ICYA' TO FIO-AKEY.
           MOVE OPC-CIC-IOPC IN OPC TO CYA-CIC-IOPC IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICAN IN CYA.
           MOVE 1                   TO CYA-NUM-ICYA IN CYA.
      *DSP COMPATIBILIDAD VSAM-DTC FIO-GET-KEY TO FIO-CMND.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-BUS-AUT-CYA.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS                        AND
              OPC-CIC-IOPC IN OPC = CYA-CIC-IOPC IN CYA AND
              CYA-NUM-ICAN IN CYA = ZEROES )
               GO TO FIN-BUS-AUT-CYA.
           IF CYA-IND-TCYA IN CYA > SPACES
               MOVE 'TAB' TO MSC-COD-SIST
               MOVE 'TCYA' TO MSC-COD-TMSC IN MSC
               MOVE CYA-IND-TCYA IN CYA TO MSC-COD-CMSC IN MSC
               PERFORM BUS-MSC
               IF MSC-COD-DAT1(2) = 'S'
                   MOVE 'S' TO WSS-IND-PAUT IN WSS-VARI
                   GO TO FIN-BUS-AUT-CYA.
           MOVE 'CYA-KEY-ICYA' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-BUS-AUT-CYA.
       FIN-BUS-AUT-CYA.
           EXIT.

      *Revisa el primer CYA asociado a la OPC para ver si tiene cargo en
      *cuenta corriente y si es linea o batch
       BUS-TCYA-LOB SECTION.
       INI-BUS-TCYA-LOB.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE SPACES TO WSS-OPC-LNBT IN WSS-VARI.
           MOVE OPC-CIC-IOPC IN OPC TO CYA-CIC-IOPC IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICAN IN CYA.
           MOVE 1                   TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF NOT FIO-STAT-OKS
               MOVE 'CYA    NEX' TO MSG-COD-MENS
               MOVE CYA-KEY-ICYA IN CYA TO FRM-MEN2
               GO TO FIN-BUS-TCYA-LOB.
           IF CYA-IND-TCYA IN CYA > SPACES
               MOVE 'TCYA'              TO MSC-COD-TMSC IN MSC
               MOVE CYA-IND-TCYA IN CYA TO MSC-COD-CMSC IN MSC
               MOVE 'TAB'       TO FIO-SIST
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-MSC
               IF FIO-STAT-OKS
                   IF MSC-CIC-CMSC IN MSC = 'CC'
                       IF MSC-COD-DAT1(2) = 'S' OR 'N' OR 'M'
                           MOVE MSC-COD-DAT1(2) TO WSS-OPC-LNBT
                       ELSE
                           MOVE 'MSCTCYACCLB?' TO MSG-COD-MENS
                           MOVE MSC-COD-TABL IN MSC TO FRM-MEN2
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'MSC    NEX' TO MSG-COD-MENS
                   MOVE MSC-COD-TABL IN MSC TO FRM-MEN2.
       FIN-BUS-TCYA-LOB.
           EXIT.

       GET-FEC-FACO SECTION.
       INI-GET-FEC-FACO.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY TO OPC-NUM-DINP IN OPC.
           MOVE HOY-MHOY TO OPC-NUM-MINP IN OPC.
           MOVE HOY-SHOY TO OPC-NUM-SINP IN OPC.
           MOVE HOY-AHOY TO OPC-NUM-AINP IN OPC.
       FIN-GET-FEC-FACO.
           EXIT.

      * RBG/INI/9-JUL-1997
       REV-EXI-ROV SECTION.
      *********************
       INI-REV-EXI-ROV
           MOVE 'ROV-KEY-IROV' TO FIO-AKEY.
           MOVE OPC-CIC-IOPC IN OPC TO ROV-CIC-IOPC IN ROV.
           MOVE SPACES              TO ROV-CIC-IOPV IN ROV.
           MOVE ZEROES              TO ROV-NUM-IVCT IN ROV.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LEE-SIG-ROV.
           PERFORM COL-FIO-ROV.
           IF FIO-STAT-OKS AND
               ROV-CIC-IOPC IN ROV = OPC-CIC-IOPC IN OPC
               MOVE ROV-KEY-IVCT IN ROV TO CAN-KEY-ICAN IN CAN
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM COL-FIO-CAN
               IF CAN-MSC-STAT IN CAN = 'A'
                   MOVE 'ROV-KEY-IROV' TO FIO-AKEY
                   MOVE FIO-GET-NXT TO FIO-CMND
                   GO TO LEE-SIG-ROV
               ELSE
                   MOVE 'NOACACANPPRO' TO MSG-COD-MENS
                   GO TO FIN-REV-EXI-ROV.

       FIN-REV-EXI-ROV.
           EXIT.
      * RBG/FIN/9-JUL-1997

      *RVM-CST-INI 6-AUG-1996
       COPY SGCBFDCC REPLACING ==DCC== BY ==SDC==
                      ==ADR-DCC-REQA== BY ==ADR-SDC-REQA==.
      *RVM-CST-FIN 6-AUG-1996
       COPY COLBFDLC.
       COPY COLBFEVC.
       COPY COLBFVEN.
       COPY COLBFCCB.
       COPY COLBFCCR.
       COPY COLBFCCT.
       COPY COLBFCUF.
       COPY COLBFICG.
       COPY COLBFRCE.
       COPY COLBFRCV.
       COPY COLBFRDT.
       COPY COLBFRDC.
       COPY SGCBFDBC.
      *RVM-CST-INI 14-OCT-1996
       COPY SGCBFDCP.
       COPY SGCBFDCE.
      *RVM-CST-FIN 14-OCT-1996
       COPY COLBFITR.
       COPY COLBFCOM.
       COPY COLBFCYA.
       COPY COLBFROV.
       COPY COLBFAUT.
       COPY COLBFCAN.
       COPY COLBFTOC.
       COPY COLBFMVO.
       COPY COLBGMVO.
      *SMC-INI 27.08.1993
       COPY COLBGVEN.
       COPY COLBGVIN.
       COPY COLBGINT.
       COPY GNSBPFEC.
      *SMC-FIN 27.08.1993
      *DAD ini  04-OCT-1993   (Memo.28-06-93)
       COPY COLBGVDA.
      *DAD fin  04-OCT-1993
       COPY SGCBGDOM.
       COPY GNSBGCPT.
       COPY GNSBGSTR.
       COPY SGCBGCLI.
       COPY COLBGCLI.
       COPY COLBGRNO.
       COPY SGCBFRCO.
       COPY SGCBFOPE.
       COPY SGCBFRCD.
      *ALD/8-AUG-1988
       COPY DEUBFDBD.
      *
       COPY GNSBVIDC.
       COPY GNSBPVRF.
       COPY GNSBVIND.
       COPY GNSBVMSC.
      *
       COPY GNSBGPES.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBBMSC.
       COPY GNSBBTAB.
       COPY GNSBFTAB.
      *
       COPY TABBBOFI.
       COPY TABBFOFI.
       COPY TABBBUSR.
       COPY TABBFUSR.
       COPY GNSBGCAM.
       COPY TABBFCAM.
      *ISP VAL-COD Y VAL-TAB NECESARIOS SOLO MIENTRAS SE MANTENGA
      *    MANEJO DE VERSIONES BCI
       COPY GNSBVCOD.
       COPY GNSBVTAB.
       COPY COLBGTCT.
       COPY COLBGCEO.
      *JPA ini  23-01-95
       COPY COLBFPOC.
       COPY GNSBVNUM.
      *JPA fin  23-01-95
      *>>>>

