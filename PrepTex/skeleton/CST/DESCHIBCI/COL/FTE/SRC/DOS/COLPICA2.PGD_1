       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   COLPICA2.
       AUTHOR.       BEE.
       DATE-WRITTEN. 24-Jun-19 05:23 PM.

      * NOMBRE PROGRAMA                   COLPICA2
      * VERSION                           3.1
      * OPCION                            CON + UPD
      * ARCHIVO BASE                      COLCAN
      * PANTALLA                          COLCAN
      * INP/OUT                           DATACOM
      * TAMANO COMMAREA                   250


       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
       COPY GNSWCSCR.
       COPY GNSWGCVT.
       77  WSS-TAG-COLPICA2-INI PIC X(125) VALUE                        
           '<IDNPGM NOM=$COLPICA2$ SKL=$06.02.01.1$ VSN=${vsnpq}$        
      -    'GEN=$24-Jun-19 05:23 PM$ FNC=${fncpq}$/>'.    
      *PTC-INI
      *PTC-SUB
      * COPY GNSWVSCR.
       COPY GNSWV3CR.
      *PTC-FIN
       COPY COLWGENG.
       COPY COLW1CAN.
       COPY GNSWGRQA REPLACING
                     ==01  ADR-REQA== BY ==02  SCR-CAN-REQA==.
           02 SCR-KEY-ICAN                     PIC X(03).
       COPY COLWICAN.
       COPY COLBRCAN.


       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSBRMSC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
      *PTC-INI
      *PTC-SUB
      *COPY GNSWGFRM.
       COPY GNSWG3CF.
      *PTC-FIN
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       COPY GNSWGIDC.
       COPY GNSWGSYS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY TABBROFI.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY TABBRUSR.

      *<<<< WSS
       COPY LDCBRLCC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LCC-REQA==.
       COPY LDCBRRLO.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RLO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-BDO-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PTT-REQA==.        
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AXU-REQA==.        
       COPY COLWGPMP.
       COPY COLBRDIC.                                                   
                                                                        
       COPY COLWGPVE.                                                   
      *>>>>
      *<<<< WSS
       COPY GNSWGQUE.
       COPY GNSWGTSK.                                                   
       COPY COLMXW05.                                                   
       COPY COLBRTMC.
       COPY COLBRCYA.
       COPY COLBRICG.
       COPY COLBRITR.
       COPY COLBROPC.
       COPY COLBRRCV.
       COPY COLBRROV.
       COPY COLBRVEN.
       COPY COLBRRDC.
       COPY SGCBRDCE.
       COPY SGCBRDCP.
       COPY COLBRCOM.
       COPY SGCBRDBC.
       COPY SGCBRRCO.
       COPY SGCBROPE.
       COPY GNSWGCPT.
       COPY GNSWGCIC.
       COPY GNSBRCIC.
       COPY TABBRCAM.
       COPY TABBRVLR.
       COPY TABWGTXC.
       COPY COLWGVEN.
       COPY COLWGINT.
       COPY COLWGPDC.                                                   
       COPY COLBRPCP.                                                   
       COPY GNSWGCVI.
       COPY COLBRDLC.
       COPY COLBREVC.
       COPY COLBRTOC.
       COPY GNSWGPES.
       COPY TABBRTIO.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TIO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DIC-REQA==.        
                                                                        
       COPY COLBRIXT.                                                   
       COPY COLWGTIM.
       COPY COLWGCXE.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-IXT-REQA==.        
       COPY COLBRCEN.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CEN-REQA==.
       COPY COLBRCXE.                                                   
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CXE-REQA==.        
       COPY GNSWINVC.
       COPY COLWGGCN.
       COPY COLWGHNJ.
       COPY COLWGIFR.                                                   
       COPY COLWGDPS.
       01 WCC-VARI.
          03 WSS-AST    VALUE '*'                  PIC X(01).
          03 WSS-C0     VALUE '0'                  PIC X(01).
          03 WSS-C1     VALUE '1'                  PIC X(01).
          03 WSS-C00    VALUE '00'                 PIC X(02).
          03 WSS-C23    VALUE '23'                 PIC X(02).
          03 WSS-1      VALUE 1                    PIC 9(01).
          03 WSS-3      VALUE 3                    PIC 9(01).
          03 WSS-19     VALUE 19                   PIC 9(02).
          03 WSS-A      VALUE 'A'                  PIC X(01).
          03 WSS-E      VALUE 'E'                  PIC X(01).
          03 WSS-S      VALUE 'S'                  PIC X(01).
          03 WSS-C      VALUE 'C'                  PIC X(01).
          03 WSS-R      VALUE 'R'                  PIC X(01).
          03 WSS-B      VALUE 'B'                  PIC X(01).
          03 WSS-K      VALUE 'K'                  PIC X(01).
          03 WSS-X      VALUE 'X'                  PIC X(01).
          03 WSS-W      VALUE 'W'                  PIC X(01).
          03 WSS-T      VALUE 'T'                  PIC X(01).
          03 WSS-G      VALUE 'G'                  PIC X(01).
          03 WSS-H      VALUE 'H'                  PIC X(01).
          03 WSS-P      VALUE 'P'                  PIC X(01).
          03 WSS-M      VALUE 'M'                  PIC X(01).
          03 WSS-N      VALUE 'N'                  PIC X(01).
          03 WSS-I      VALUE 'I'                  PIC X(01).
          03 WSS-V      VALUE 'V'                  PIC X(01).
          03 WSS-COL    VALUE 'COL'                PIC X(03).
          03 WSS-CNC    VALUE 'CNC'                PIC X(03).
          03 WSS-ACT    VALUE 'ACT'                PIC X(03).
          03 WSS-ING    VALUE 'ING'                PIC X(03).
          03 WSS-REV    VALUE 'REV'                PIC X(03).
          03 WSS-ELI    VALUE 'ELI'                PIC X(03).
          03 WSS-ELC    VALUE 'ELC'                PIC X(03).
          03 WSS-MOD    VALUE 'MOD'                PIC X(03).
          03 WSS-ACC    VALUE 'ACC'                PIC X(03).
          03 WSS-CON    VALUE 'CON'                PIC X(03).
          03 WSS-VSN    VALUE 'VSN'                PIC X(03).
          03 WSS-ICM    VALUE 'ICM'                PIC X(03).
          03 WSS-TAB    VALUE 'TAB'                PIC X(03).
          03 WCC-VLR    VALUE 'VLR'                PIC X(03).
          03 WSS-GNS    VALUE 'GNS'                PIC X(03).
          03 WSS-KTT    VALUE 'KTT'                PIC X(03).
          03 WSS-PTT    VALUE 'PTT'                PIC X(03).
          03 WSS-COD-PESO VALUE '0999  '           PIC X(06).
          03 WSS-CC     VALUE 'CC'                 PIC X(02).
          03 WSS-TCYA   VALUE 'TCYA'               PIC X(04).
          03 WSS-SAF4   VALUE 'SAF4'               PIC X(04).
          03 WSS-C170   VALUE '170'                PIC X(03).
          03 WSS-COD-PROG                          PIC X(12).

       COPY COLW2CAN.

           03  WSS-VAL-CMP2                      PIC S9(11)V9(5).
           03  WSS-MSG-MENS.
               05  WSS-MSG-PREV                     PIC X(09).
               05  WSS-MSG-TENT                     PIC X(01).
               05  WSS-MSG-FENT                     PIC X(01).
               05  WSS-MSG-SENT                     PIC X(01).
           03  WSS-MSC-CACC                         PIC X(08).
           03  WSS-SGV-DELT  COMP-3  VALUE ZEROES   PIC S9(09)V9(04).

           COPY USPC113.

       01  WSS-AUXI.
           05 WSS-MSJS.
              07 WSS-MSJ0                              PIC X(22).
              07 FILLER                                PIC X(01).
              07 WSS-MSJ1                              PIC X(16).
              07 FILLER                                PIC X(01).
              07 WSS-MSJ2                              PIC X(22).
              07 FILLER                                PIC X(01).
              07 WSS-MSJ3                              PIC X(16).
       01 WSS-PCP-VARI.
           03 WS-PCP-GRAC OCCURS  14 TIMES INDEXED BY WS-CCO-Q.         
              05 WS-PCP-CAL    COMP-3   PIC S9(11)V9(04).               
              05 WS-PCP-TAS    COMP-3   PIC  9(02)V9(04).               
              05 WS-PCP-ING    COMP-3   PIC S9(11)V9(04).               
              05 WS-PCP-CPT             PIC  X(06).                     
              05 WS-PCP-FCA             PIC  X(08).                     
              05 WS-PCP-TIP             PIC  X(04).                     
              05 WS-PCP-EFA             PIC  X(01).                     
              05 WS-PCP-PIM   COMP-3    PIC S9(02)V9(03).               
              05 WS-PCP-INC             PIC X(01).                      
       01 WSS-CA2-CELI   VALUE 'CA2ELI  '   PIC X(08).
       01 WSS-CA2-CELC   VALUE 'CA2ELC  '   PIC X(08).
       COPY COLWGCA2.
       COPY GNSWGIDM.
      *>>>>
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VLR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
      *>>>>
       01  PGM-VARI.
           03 PGM-ICLR                  VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-TODO          VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-LLAVES        VALUE 'K'       PIC X(01).
           03 PGM-LIMPIAR-CAMPOS        VALUE 'F'       PIC X(01).
           03 PGM-NO-LIMPIAR-NADA       VALUE 'N'       PIC X(01).
           03 PGM-STAT.
              05 PGM-STAT-OPC.
                 88 PGM-STAT-OPC-NUL    VALUE '  '.
                 07 PGM-STT1-OPC        VALUE '2' PIC X(01).
                    88 PGM-STAT-OPC-OKS VALUE '0'.
                 07 PGM-STT2-OPC        VALUE '3' PIC X(01).
              05 PGM-STAT-CAN.
                 88 PGM-STAT-CAN-NUL    VALUE '  '.
                 07 PGM-STT1-CAN        VALUE '2' PIC X(01).
                    88 PGM-STAT-CAN-OKS VALUE '0'.
                 07 PGM-STT2-CAN        VALUE '3' PIC X(01).
              05 PGM-STAT-DBC.
                 88 PGM-STAT-DBC-NUL    VALUE '  '.
                 07 PGM-STT1-DBC        VALUE '2' PIC X(01).
                    88 PGM-STAT-DBC-OKS VALUE '0'.
                 07 PGM-STT2-DBC        VALUE '3' PIC X(01).
              05 PGM-STAT-VEN.
                 88 PGM-STAT-VEN-NUL    VALUE '  '.
                 07 PGM-STT1-VEN        VALUE '2' PIC X(01).
                    88 PGM-STAT-VEN-OKS VALUE '0'.
                 07 PGM-STT2-VEN        VALUE '3' PIC X(01).
              05 PGM-STAT-RCV.
                 88 PGM-STAT-RCV-NUL    VALUE '  '.
                 07 PGM-STT1-RCV        VALUE '2' PIC X(01).
                    88 PGM-STAT-RCV-OKS VALUE '0'.
                 07 PGM-STT2-RCV        VALUE '3' PIC X(01).
              05 PGM-STAT-ROV.
                 88 PGM-STAT-ROV-NUL    VALUE '  '.
                 07 PGM-STT1-ROV        VALUE '2' PIC X(01).
                    88 PGM-STAT-ROV-OKS VALUE '0'.
                 07 PGM-STT2-ROV        VALUE '3' PIC X(01).
              05 PGM-STAT-ICG.
                 88 PGM-STAT-ICG-NUL    VALUE '  '.
                 07 PGM-STT1-ICG        VALUE '2' PIC X(01).
                    88 PGM-STAT-ICG-OKS VALUE '0'.
                 07 PGM-STT2-ICG        VALUE '3' PIC X(01).
              05 PGM-STAT-COM.
                 88 PGM-STAT-COM-NUL    VALUE '  '.
                 07 PGM-STT1-COM        VALUE '2' PIC X(01).
                    88 PGM-STAT-COM-OKS VALUE '0'.
                 07 PGM-STT2-COM        VALUE '3' PIC X(01).
              05 PGM-STAT-CYA.
                 88 PGM-STAT-CYA-NUL    VALUE '  '.
                 07 PGM-STT1-CYA        VALUE '2' PIC X(01).
                    88 PGM-STAT-CYA-OKS VALUE '0'.
                 07 PGM-STT2-CYA        VALUE '3' PIC X(01).
              05 PGM-STAT-ITR.                                          
                 88 PGM-STAT-ITR-NUL    VALUE '  '.                     
                 07 PGM-STT1-ITR        VALUE '2' PIC X(01).            
                    88 PGM-STAT-ITR-OKS VALUE '0'.                      
                 07 PGM-STT2-ITR        VALUE '3' PIC X(01).            
           03 PGM-SRNF                  VALUE '23'      PIC X(02).
           03 PGM-SOKS                  VALUE '00'      PIC X(02).
           03 PGM-SNUL                  VALUE '  '      PIC X(02).
           03 PGM-SUAR                  VALUE SPACES    PIC X(15).

       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
      *<<<< CMA
           02 FILLER                      PIC X(3000).
      *>>>>
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
       LUP-MAIN.
           IF SCR-INST = SCR-INST-HCM
                 PERFORM SCR-COM.
           IF SCR-CCPP = 'ELI'
                 PERFORM SCR-ELI
           ELSE
                 MOVE SCR-INST-HCM TO SCR-INST.
           GO TO LUP-MAIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
       COPY GNSBGEIB.
       COPY GNSBGEDB.
           MOVE LOW-VALUES TO CAN-FLD.
           MOVE LOW-VALUES TO CAN-EDT.
           PERFORM GNS-PRO-RCK.
           PERFORM GNS-BUS-VCA.
           PERFORM GNS-HDL-SYS.
           PERFORM GNS-HDL-FRM.
           MOVE 'COLPICA2' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      *<<<< ( INI_FIO ) AND ( NOT PGM_VSI )
      * PTC ini                                                         
           PERFORM GNS-ERR-QUE.                                         
           PERFORM GET-TSK-TERM.                                        
      * PTC fin                                                         
           PERFORM GNS-HDL-VSM.
      *>>>>
      *<<<< INI_FIO
           MOVE +3000 TO SCR-TCMA.
           IF SCR-DESDE-CMN
               PERFORM GNS-CLR-RQA.
      *>>>>
      *<<<< INI_FIO
           IF SCR-DESDE-CMN
             IF NOT SCR-OFRM-SRV
               MOVE SPACES TO SCR-COD-TICG
                              SCR-COD-TITR
                              SCR-COD-VCOC
                              SCR-CYA-IND-MCYA
                              SCR-CYA-IND-PAUT
                              SCR-CYA-IND-CAJA
                              SCR-ROV-CAI-IOPC
               MOVE ZEROES TO SCR-ROV-IIC-IOPC
               MOVE WSS-1     TO SCR-SGV-VCAM.
           IF SCR-DESDE-CMN
               MOVE WSS-C     TO SCR-IND-OOD
               MOVE WSS-1     TO SCR-IPRO
               GO TO FIN-INI-FIO.
           IF SCR-INST-EXT = WSS-INST-FTER-CIC
               MOVE WSS-INST-NULL TO SCR-INST-EXT
               PERFORM ING-FTER-CIC.
       FIN-INI-FIO.
      *>>>>
       FIN-INI.
           EXIT.

       COPY GNSBHSYS.
       COPY GNSBHFRM.
       COPY GNSBPRCK.
       COPY GNSBBVCA.
       COPY GNSBBIDD.

       SCR-COM SECTION.
       INI-SCR-COM.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-CAN.
           PERFORM EDT-KEY-CAN.
           PERFORM EDT-FLD-CAN.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-HCM TO SCR-INST.
           MOVE SCR-CMNP     TO SYS-PROG.
           MOVE SCR-VARI     TO SYS-CMMA.
           MOVE SCR-TCMA     TO SYS-TCMA.
           MOVE SYS-XCTL     TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       XCT-ERR.
           MOVE 'XCTERR    ' TO MSG-COD-MENS.
           MOVE 'GNS'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO SYS-MEN1.
           MOVE SYS-PROG     TO SYS-MEN2.
           MOVE SYS-ABOR     TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       COPY GNSBGGBK.
       FIN-SCR-COM.
           EXIT.




       SCR-ELI SECTION.
       INI-SCR-ELI.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ELI
           ELSE
           IF SCR-INST = SCR-INST-GCS
                PERFORM GET-ACC
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON.
           PERFORM DESSCRTRL.
      *<<<< PFS_SCR_ELI
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR
                         FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM VAL-NUM-KEY-CAN
               PERFORM VAL-NUM-FLD-CAN
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM GNS-CLR-RQA
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-ELI.
           PERFORM GNS-CLR-RQA.
      *>>>>
           IF SCR-STAT = SCR-STAT-CON
               MOVE SPACES TO FRM-MENS
           ELSE
           IF SCR-STAT = SCR-STAT-ABT OR SCR-VFLD = SCR-VFLD-NOT
               MOVE 'ELINOT    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
           ELSE
               MOVE SPACES TO FRM-MENS
               PERFORM CMN-ELI
               IF FIO-STAT-OKS
                   IF FRM-MEN1 NOT > SPACES
                       MOVE 'ELIYES    ' TO MSG-COD-MENS
                       MOVE 'GNS' TO MSG-COD-SIST
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MEN1
                   ELSE
                       NEXT SENTENCE
               ELSE
               IF FRM-MENS NOT > SPACES
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ELI.
           EXIT.



       SCR-DMSG SECTION.
       INI-SCR-DMSG.
           IF PGM-ICLR = PGM-NO-LIMPIAR-NADA
               NEXT SENTENCE
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-TODO
               PERFORM SCR-CLRA-CAN
               PERFORM EDT-KEY-CAN
               PERFORM EDT-FLD-CAN
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-LLAVES
               PERFORM CLR-KEY-CAN
               PERFORM EDT-KEY-CAN
           ELSE
               PERFORM CLR-FLD-CAN
               PERFORM EDT-FLD-CAN.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-DMSG.
           EXIT.

       SCR-KEY SECTION.
       INI-SCR-KEY.
           PERFORM SCR-RST.
           PERFORM GET-KEY.
           IF FRM-STAT-ABT
                   MOVE SPACES TO FRM-MENS
                   PERFORM SCR-MSSG
                   GO TO FIN-SCR-KEY.
       FND-SCR-KEY.
           MOVE SPACES TO FRM-MENS.
           PERFORM FND-KEY.
           IF FIO-STAT-OKS
               PERFORM PUT-SCR
               MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
               GO TO FIN-SCR-KEY.
      *JSS ELSE
      *        PERFORM CLR-FLD-CAN.
       ERR-SCR-KEY.
           MOVE 'S' TO SCR-IERR.
           MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR.
           IF FRM-MENS NOT > SPACES
               IF FIO-STAT-EOF
                   MOVE 'REGEOF    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
               IF FIO-STAT = FIO-STAT-NEX
                   MOVE 'REGNEX    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
           MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-SCR-KEY.
           EXIT.

       SCR-RST SECTION.
       INI-SCR-RST.
           MOVE SPACES       TO PGM-ICLR.
           MOVE SPACES       TO SCR-ACTU.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
           MOVE LOW-VALUES   TO CAN-FLD.
       FIN-SCR-RST.
           EXIT.

       GET-KEY SECTION.
       INI-GET-KEY.
           PERFORM SCR-GKEY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-KEY.
           EXIT.

       GET-IKY SECTION.
       INI-GET-IKY.
           PERFORM SCR-GIKY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-IKY.
           EXIT.

       FND-KEY SECTION.
       INI-FND-KEY.
           PERFORM KEY-ALL-CAN.
      *<<<< FND_KEY
       COPY COLB1CAN.
      *>>>>
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF FIO-STAT-OKS
               MOVE CAN-STP-ITRN IN CAN TO SCR-UMOD.
           MOVE FIO-STAT TO PGM-STAT-CAN.
      *<<<< FIN_FND_KEY
           IF PGM-STAT-CAN-OKS
      *BUS-TAB busca glosa de codigo en tabla
               MOVE WSS-COL             TO TAB-COD-SIST
               MOVE WSS-CNC             TO TAB-COD-TTAB IN TAB
               MOVE CAN-MSC-CANC IN CAN TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-CIC-CTAB IN TAB TO SCR-MSC-CCNC
               MOVE TAB-CIC-CTAB IN TAB TO SCR-MSC-CANC
           ELSE
               IF NOT (( SCR-CCPP = WSS-ACT AND
                  SCR-ACTU = SCR-ACTU-ING ) OR
                  ( SCR-CCPP = WSS-ING ))
                   GO TO FIN-FND-KEY.
           IF SCR-MSC-TCAN = WSS-C
               GO TO NOT-FND-ROV.
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF NOT (FIO-STAT-OKS AND
                   CAN-CIC-IOPC IN CAN = ROV-CIC-IOPV IN ROV AND
                   CAN-NUM-ICAN IN CAN = ROV-NUM-IVCT IN ROV)
               MOVE WSS-C23 TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-ROV.
           IF PGM-STAT-ROV-OKS
                MOVE ROV-CAI-IOPC IN ROV TO SCR-ROV-CAI-IOPC
                MOVE ROV-IIC-IOPC IN ROV TO SCR-ROV-IIC-IOPC
           ELSE
               GO TO NOT-FND-ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF FIO-STAT-OKS AND
              CAN-CIC-IOPC IN CAN = ROV-CIC-IOPV IN ROV AND
              CAN-NUM-ICAN IN CAN = ROV-NUM-IVCT IN ROV
               MOVE WSS-COL        TO MSG-COD-SIST
               MOVE 'EXMULOPCXCAN' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           MOVE FIO-STAT TO PGM-STAT-ROV.
           IF PGM-STAT-ROV-OKS
                MOVE ROV-CAI-IOPC IN ROV TO SCR-ROV-CAI-IOPC
                MOVE ROV-IIC-IOPC IN ROV TO SCR-ROV-IIC-IOPC.
       NOT-FND-ROV.
           IF SCR-CCPP = WSS-ACT AND NO-ASIGNE-CORRELATIVO AND
              NOT PGM-STAT-CAN-OKS
               MOVE FIO-STAT-NEX TO FIO-STAT
               GO TO FIN-FND-KEY.
           IF PGM-STAT-CAN-OKS
               IF NOT PGM-STAT-RCV-OKS
                   MOVE FIO-STAT-NEX TO FIO-STAT
                   GO TO FIN-FND-KEY.
           IF NOT PGM-STAT-CAN-OKS AND
              ( SCR-CCPP = WSS-ACT OR SCR-CCPP = WSS-ING )
               PERFORM PUT-OPC-CAN
               PERFORM PUT-DBC-CAN
               PERFORM PUT-VEN-CAN
               PERFORM PUT-ROV-CAN
               PERFORM PUT-CYA-CAN
               PERFORM PUT-RCV-CAN.
       FND-RST-STAT.
           MOVE PGM-STAT-CAN TO FIO-STAT.

           IF ( OPC-NUM-VCVG IN OPC NOT > ZEROES OR
                OPC-VAL-SCRE IN OPC NOT > ZEROES ) AND
              SCR-CMND NOT = WSS-REV
               MOVE WSS-COL        TO MSG-COD-SIST
               MOVE 'OPC    YACAN' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE WSS-C00      TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
       
           MOVE SPACES TO MSG-COD-MENS.

           IF PGM-STAT-CAN-OKS AND SCR-CMND = WSS-ELI
               IF ( CAN-MSC-STAT IN CAN = WSS-R OR WSS-X ) OR
                  ( ( CAN-MSC-STAT IN CAN = WSS-S OR WSS-C OR WSS-W OR 
                      WSS-T OR WSS-G OR WSS-H OR WSS-P ) AND 
                      SCR-CMND NOT = WSS-REV )
                   IF CAN-MSC-STAT IN CAN = WSS-R
                      MOVE 'CAN    REVYA' TO MSG-COD-MENS
                   ELSE
                   IF CAN-MSC-STAT IN CAN = WSS-X
                      MOVE 'CAN    NCCYA' TO MSG-COD-MENS
                   ELSE
                    IF CAN-MSC-STAT IN CAN = WSS-S AND
                       EIBTRNID NOT = WSS-SAF4     AND
                       SCR-CNAL NOT = WSS-C170
                        MOVE 'CAN    SAFYA' TO MSG-COD-MENS
                    ELSE
                   IF CAN-MSC-STAT IN CAN = WSS-G OR WSS-H
                      MOVE 'CAN    CCTYA' TO MSG-COD-MENS
                   ELSE
                   IF CAN-MSC-STAT IN CAN = WSS-T
                      MOVE 'CAN    PTTYA' TO MSG-COD-MENS
                   ELSE
                   IF CAN-MSC-STAT IN CAN = WSS-C                         
                      IF CAN-MSC-TCAN IN CAN = WSS-N                      
                          MOVE 'CAN    NOVYA' TO MSG-COD-MENS           
                      ELSE                                              
                          IF CAN-MSC-TCAN IN CAN = WSS-R                  
                              MOVE 'CAN    RENYA' TO MSG-COD-MENS       
                          ELSE                                          
                              MOVE 'CAN    PROYA' TO MSG-COD-MENS       
                   ELSE                                                 
                   IF CAN-MSC-STAT IN CAN = WSS-W OR WSS-P
                      MOVE 'CAN    ALLYA' TO MSG-COD-MENS.
           IF NOT PGM-STAT-CAN-OKS
              IF CAN-MSC-STAT IN CAN = WSS-X AND 
                              CAN-NUM-ICAN IN CAN > WSS-1
                 MOVE 'CAN    NCCYA' TO MSG-COD-MENS.

           IF PGM-STAT-CAN-OKS AND SCR-CMND = WSS-ELC
              IF CAN-MSC-STAT IN CAN NOT = WSS-C
                  MOVE 'CAN    STTNN' TO MSG-COD-MENS.

           IF MSG-COD-MENS > SPACES
              GO TO VRF-STAT-CANC.
                 
           IF PGM-STAT-CAN-OKS
              IF CAN-MSC-STAT IN CAN = WSS-C AND 
                    MSG-COD-MENS NOT > SPACES AND SCR-CMND = WSS-ELC
                 IF SCR-ROV-CAI-IOPC > SPACES AND
                    SCR-ROV-CAI-IOPC > SPACES
                    MOVE SCR-ROV-CAI-IOPC TO OPC-CAI-IOPC IN OPC
                    MOVE SCR-ROV-IIC-IOPC TO OPC-IIC-IOPC IN OPC
                    MOVE FIO-GET-KEY      TO FIO-CMND
                    PERFORM COL-FIO-OPC
                    IF FIO-STAT-OKS
                       MOVE 'ELIOPCRELAC ' TO MSG-COD-MENS
                       MOVE CAN-CAI-IOPC IN CAN TO OPC-CAI-IOPC IN OPC
                       MOVE CAN-IIC-IOPC IN CAN TO OPC-IIC-IOPC IN OPC
                       MOVE FIO-GET-KEY  TO FIO-CMND
                       PERFORM COL-FIO-OPC
                    ELSE
                       MOVE CAN-CAI-IOPC IN CAN TO OPC-CAI-IOPC IN OPC
                       MOVE CAN-IIC-IOPC IN CAN TO OPC-IIC-IOPC IN OPC
                       MOVE FIO-GET-KEY TO FIO-CMND
                       PERFORM COL-FIO-OPC.

           IF MSG-COD-MENS > SPACES
              GO TO VRF-STAT-CANC.

           IF ( SCR-CCPP = WSS-ING OR WSS-MOD OR WSS-ACT ) OR
              ( SCR-CMND = WSS-CON ) OR SCR-CMND = WSS-ELI
              IF PGM-STAT-CAN-OKS
                 IF CAN-MSC-STAT IN CAN = WSS-A
                     MOVE 'CAN    ACAYA' TO MSG-COD-MENS
                 ELSE
                 IF CAN-MSC-STAT IN CAN = WSS-E
                     MOVE 'CAN    ACAOB' TO MSG-COD-MENS
                 ELSE
                 IF NOT ( CAN-MSC-STAT IN CAN = WSS-I OR
                                         WSS-M OR WSS-V OR WSS-C)
                     MOVE 'CAN    STTNN' TO MSG-COD-MENS.

       VRF-STAT-CANC.
           IF MSG-COD-MENS > SPACES
                MOVE WSS-S        TO SCR-IERR
                MOVE WSS-COL      TO MSG-COD-SIST
                PERFORM GET-MSG
                MOVE MSG-GLS-DESC TO FRM-MEN1
                MOVE WSS-C00      TO FIO-STAT
                MOVE SCR-STAT-CON TO SCR-STAT
                GO TO FIN-FND-KEY.
      *>>>>
       FIN-FND-KEY.
           IF FIO-STAT = FIO-STAT-NEX
               MOVE 'S' TO SCR-IERR.
       EXT-FND-KEY.
           EXIT.

       PUT-SCR SECTION.
       INI-PUT-SCR.
           IF PGM-STAT-CAN-OKS
               MOVE CAN-STP-ITRN IN CAN TO SCR-UMOD.
           PERFORM PUT-ALL-CAN.
       FIN-PUT-SCR.
           EXIT.

       GET-FLD SECTION.
       INI-GET-FLD.
           PERFORM SCR-GFLD.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-FLD.
           EXIT.




       CMN-ELI SECTION.
       INI-CMN-ELI.
           PERFORM KEY-ALL-CAN.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF FIO-STAT-OKS AND
              CAN-STP-ITRN IN CAN NOT = SCR-UMOD
               MOVE FIO-ULK-REC TO FIO-CMND
               PERFORM COL-FIO-CAN
               MOVE FIO-BCK-OUT TO FIO-CMND
               PERFORM COL-FIO-CAN
               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'GNSACCSSIMUL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-ELI.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-ELI.
      *<<<< CMN_ELI
           MOVE FIO-ULK-REC TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           MOVE WSS-COL      TO IDM-SIST.
           MOVE SCR-CNAL     TO IDM-CANA.
           DISPLAY 'RGD SCR-CNAL : ' SCR-CNAL.
           IF SCR-CMND = WSS-ELC
              MOVE WSS-CA2-CELC TO IDM-OPCI
           ELSE
              MOVE WSS-CA2-CELI TO IDM-OPCI.
           MOVE SCR-QIDD     TO IDM-QIDD.
           MOVE SCR-LIDD     TO IDM-LIDD.
           MOVE IDM-CMMA     TO SYS-CMMA.
           MOVE SYS-LINK     TO SYS-CMND.
           MOVE 'GNSPPIDM'   TO SYS-PROG.
           MOVE IDM-TCMA     TO SYS-TCMA.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA TO IDM-CMMA.
           IF IDM-IND-ERROR = SPACES AND IDM-VIGE = WSS-S
               MOVE WSS-C00  TO FIO-STAT
               MOVE IDM-SEDE TO WSS-COD-PROG
           ELSE
              MOVE WSS-AST      TO IDM-CANA
              MOVE IDM-CMMA     TO SYS-CMMA
              PERFORM GNS-PRO-SYS
              MOVE SYS-CMMA TO IDM-CMMA
              IF IDM-IND-ERROR = SPACES AND IDM-VIGE = WSS-S
                  MOVE WSS-C00  TO FIO-STAT
                  MOVE IDM-SEDE TO WSS-COD-PROG
              ELSE
                 MOVE WSS-S         TO SCR-IERR
                 MOVE IDM-GLS-ERROR TO FRM-MEN1
                 MOVE WSS-C23       TO FIO-STAT
                 GO TO FIN-CMN-ELI.

           MOVE SPACES       TO CA2-CMMA.
           MOVE IDD-FSIS IN IDD-VARI TO CA2-VIDD.
           MOVE FIO-MSFL IN FIO-CTTS TO CA2-MSFL.
           MOVE CAN-CIC-IOPC IN CAN TO CA2-CIC-IOPC IN CA2-CMMA.
           MOVE CAN-NUM-ICAN IN CAN TO CA2-NUM-ICAN IN CA2-CMMA.
           MOVE CA2-CMMA     TO SYS-CMMA.
           MOVE SYS-LINK     TO SYS-CMND.
           MOVE WSS-COD-PROG TO SYS-PROG.
           MOVE +1000        TO SYS-TCMA.

           PERFORM GNS-PRO-SYS.

           MOVE SYS-CMMA TO CA2-CMMA.

           IF CA2-COD-MENS IN CA2-CMMA > SPACES
               MOVE FIO-BCK-OUT TO FIO-CMND
               PERFORM COL-FIO-CAN
               MOVE WSS-C23 TO FIO-STAT
               MOVE CA2-COD-MENS IN CA2-CMMA TO MSG-COD-MENS
               MOVE WSS-COL TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS.

           GO TO FIN-CMN-ELI.
      *>>>>
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM COL-FIO-CAN.
       FIN-CMN-ELI.
           EXIT.


       SCR-EXIT SECTION.
       INI-SCR-EXIT.
           MOVE 'P'      TO SCR-ICMN.
           MOVE SCR-NTRN TO SYS-NTRN.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-RTRN TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-SCR-EXIT.
           EXIT.

       SCR-PUTA SECTION.
       INI-SCR-PUTA.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE CAN-FLD TO FRM-DFLD.
           MOVE FRM-PUT-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-PUTA.
           EXIT.

       SCR-MSSG SECTION.
       INI-SCR-MSSG.
           IF FRM-MEN1 NOT > SPACES
               MOVE SPACES TO FRM-MEN1.
           IF FRM-MEN2 NOT > SPACES
               MOVE SPACES TO FRM-MEN2.
           MOVE FRM-MENS TO CAN-GLS-MENS.
       FIN-SCR-MSSG.
           EXIT.

       SCR-GKEY SECTION.
       INI-SCR-GKEY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
      *<<<< PFS_SCR_GKEY
           IF NOT ( FRM-FFLD = FRM-FFLD-PF8 OR FRM-FFLD = FRM-FFLD-PF7 )
      *>>>>
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-CAN
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO CAN-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GKEY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-CAN
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-CAN.
           PERFORM VAL-IKY-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-MKY-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-AKY-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-CON-KEY-CAN.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GKEY.
           IF FRM-UCUR NOT > SPACES
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM FST-KEY-CAN.
       ERR-SCR-GKEY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-CAN.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GKEY.
           PERFORM SCR-MSSG.

       SCR-GIKY SECTION.
       INI-SCR-GIKY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-CAN
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO CAN-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GIKY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-IKY-CAN
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-CAN.
           PERFORM VAL-IKY-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GIKY.
           PERFORM VAL-CON-IKY-CAN.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GIKY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-CAN.
       ERR-SCR-GIKY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-IKY-CAN.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GIKY.
           PERFORM SCR-MSSG.

       SCR-GFLD SECTION.
       INI-SCR-GFLD.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
      *<<<< PFS_SCR_GFLD
           IF NOT ( ( SCR-CCPP = WSS-MOD OR  SCR-CCPP = WSS-ACC OR
                      SCR-CCPP = WSS-ELI                      OR
                    ( SCR-CCPP = WSS-ACT AND SCR-ACTU = SCR-ACTU-MOD ) )
                      AND ( FRM-FFLD = FRM-FFLD-PF8 OR
                            FRM-FFLD = FRM-FFLD-PF7 OR
                            FRM-FFLD = FRM-FFLD-PF5 OR
                            FRM-FFLD = FRM-FFLD-PF6 ) )
      *>>>>
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-FLD-CAN
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO CAN-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GFLD.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-CAN
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           PERFORM VAL-NUM-FLD-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-CAN
               PERFORM EDT-FLD-CAN
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           PERFORM VAL-MKY-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GFLD.
      *<<<< SCR_GFLD_VAL_FLD
      *ISP ES NECESARIO TENER LOS DATOS DE LA OPERACION
      *    PARA LA VALIDACION DE CAMPOS
           MOVE CAN-CAI-IOPC IN CAN-FLD TO OPC-CAI-IOPC IN OPC.
           MOVE CAN-IIC-IOPC IN CAN-FLD TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE WSS-COL      TO MSG-COD-SIST
               MOVE 'OPC    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO ERR-SCR-GFLD.

      *ISP ES NECESARIO TENER LOS DATOS DEL VENCIMIENTO
      *    PARA LA VALIDACION DE CAMPOS
           MOVE CAN-CAI-IOPC IN CAN-FLD TO VEN-CAI-IOPC IN VEN.
           MOVE CAN-IIC-IOPC IN CAN-FLD TO VEN-IIC-IOPC IN VEN.
           MOVE SCR-VEN-NUM-IVEN        TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           IF OPC-IND-VSTR IN OPC = WSS-S
               PERFORM COL-OBT-VEN
               IF VEN-STAT-OKS OR VEN-STAT-ENO
                   MOVE VEN-NUM-IVEN IN VEN TO
                        VEN-NUM-IVCT IN VEN
                   MOVE WSS-C00 TO FIO-STAT
               ELSE
                   MOVE WSS-C23 TO FIO-STAT
           ELSE
               PERFORM COL-FIO-VEN.

           IF NOT FIO-STAT-OKS
               MOVE WSS-COL TO MSG-COD-SIST
               MOVE 'VEN    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO ERR-SCR-GFLD.
           PERFORM GET-MON.
      *>>>>
           PERFORM VAL-FLD-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GFLD.
           MOVE ZEROES       TO SCR-SGV-MDPT.
           MOVE SPACES       TO SCR-IND-NECU.
           MOVE ZEROES       TO SCR-FEC-FOUT.
           MOVE SPACES       TO SCR-VEC-SEG.
           PERFORM VAL-CON-FLD-CAN.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GFLD.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-FLD-CAN.
       ERR-SCR-GFLD.
      *PTC-INI
           MOVE WSS-S TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-CAN.
           PERFORM EDT-FLD-CAN.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
           GO TO FIN-SCR-GFLD.
           PERFORM VAL-FLD-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GFLD.
           PERFORM VAL-CON-FLD-CAN.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GFLD.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-FLD-CAN.
       ERR-SCR-GFLD.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-CAN.
           PERFORM EDT-FLD-CAN.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GFLD.
           MOVE SCR-STAT-MOD TO SCR-STAT.

       GET-ACC SECTION.
       INI-GET-ACC.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
      *<<<< PFS_GET_CON OR PFS_GET_ACC
           IF NOT
              ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD = FRM-FFLD-PF6 OR
                FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD = FRM-FFLD-PF8 )
      *>>>>
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO CAN-GLS-MEN2
               MOVE SCR-PRMT     TO CAN-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO CAN-FLD.
           IF NOT ( ( FRM-FFLD = FRM-FFLD-PF12 OR FRM-FFLD-PF3 ) OR
                      SCR-CONF > SPACES )
               PERFORM VAL-NUM-KEY-CAN
               PERFORM VAL-NUM-FLD-CAN.
       FIN-GET-ACC.
           MOVE SCR-STAT-SON TO SCR-STAT.

       GET-CON SECTION.
       INI-GET-CON.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
      *<<<< PFS_GET_CON OR PFS_GET_ACC
           IF NOT
              ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD = FRM-FFLD-PF6 OR
                FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD = FRM-FFLD-PF8 )
      *>>>>
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO CAN-GLS-MEN2
               MOVE SCR-PRMT     TO CAN-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO CAN-FLD.
       FIN-GET-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.

       CLR-MSG SECTION.
       INI-CLR-MSG.
           MOVE SPACES TO CAN-GLS-MENS.
       FIN-CLR-MSG.
           EXIT.

       HBL-IKY SECTION.
       INI-HBL-IKY.
           IF NOT SCR-OFRM-SRV
           IF SCR-DESDE-CMN
               MOVE CAN-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO CAN-FLD
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO CAN-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO CAN-GLS-MENS.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-FLD-CAN.
           PERFORM PRO-MKY-CAN.
           PERFORM PRO-AKY-CAN.
           MOVE '1' TO FRM-CPIM-AEY.
           PERFORM UNP-IKY-CAN.
           PERFORM FST-KEY-CAN.
           MOVE SPACES TO WSS-IBLK-COMI.                                
       FIN-HBL-IKY.
           EXIT.

       HBL-KEY SECTION.
       INI-HBL-KEY.
           IF NOT SCR-OFRM-SRV
           IF SCR-DESDE-CMN
               MOVE CAN-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO CAN-FLD
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO CAN-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO CAN-GLS-MENS.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-FLD-CAN.
           MOVE '1' TO FRM-CPIM-AEY.
           PERFORM UNP-KEY-CAN.
           PERFORM FST-KEY-CAN.
           MOVE SPACES TO WSS-IBLK-COMI.                                
       FIN-HBL-KEY.
           EXIT.

       HBL-FLD SECTION.
       INI-HBL-FLD.
           IF WSS-IBLK-COMI = WSS-C                                       
              MOVE WSS-N TO WSS-IBLK-COMI                                 
           ELSE                                                         
              MOVE SPACES TO WSS-IBLK-COMI.                             
           PERFORM PRO-IKY-CAN.
           PERFORM PRO-AKY-CAN.
           PERFORM UNP-MKY-CAN.
           PERFORM UNP-FLD-CAN.
           PERFORM FST-FLD-CAN.
      *<<<< FIN_HBL_FLD
           MOVE FRM-CPIM-AEY TO CAN-SGV-GAST-ATR IN CAN-FLD.
           IF SCR-CYA-IND-MCYA = WSS-M
               MOVE FRM-CPIM-AEY TO CYA-IND-TCYA-ATR IN CAN-FLD
               MOVE FRM-CPIM-AEY TO CYA-CAI-ICYA-ATR IN CAN-FLD
               MOVE FRM-CPIM-AEY TO CYA-IIC-ICYA-ATR IN CAN-FLD.
           IF ( SCR-CCPP = WSS-MOD ) OR ( SCR-ACTU = SCR-ACTU-MOD )
               MOVE FRM-CPIM-AEY TO CAN-MSC-CANC-ATR IN CAN-FLD.

           IF NOT SCR-OFRM-SRV
               MOVE WSS-COL          TO FIO-SIST
               MOVE WSS-VSN          TO TAB-COD-TTAB IN TAB
               MOVE 'OFIUSPCANING'   TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-TAB
               IF FIO-STAT-OKS AND
                  TAB-MSC-STAT IN TAB = WSS-S
                  PERFORM VAL-OFI-USP.
           IF FRM-GLS-IITR IN CAN-FLD NOT = FRM-GLS-TINT IN CAN-FLD
               PERFORM BASE-TASA-INI.
      *>>>>
       FIN-HBL-FLD.
           EXIT.

       FST-MSG SECTION.
       INI-FST-MSG.
           MOVE -1 TO CAN-GLS-MENS-LEN.
       FIN-FST-MSG.
           EXIT.

       PRO-ALL SECTION.
       INI-PRO-ALL.
           PERFORM PRO-KEY-CAN.
           PERFORM PRO-FLD-CAN.
           PERFORM FST-MSG.
       FIN-PRO-ALL.
           EXIT.

       SCR-TRL SECTION.
       INI-SCR-TRL.
           IF FRM-MEN1 NOT > SPACES
               MOVE SCR-PRMT TO FRM-MEN1.
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM HBL-FLD
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-CAN
               PERFORM EDT-FLD-CAN
               PERFORM SCR-PUTA
               MOVE SCR-INST-GFL TO SCR-INST
               IF SCR-STAT NOT = SCR-STPP
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   PERFORM SCR-EXIT
               ELSE
                   PERFORM SCR-EXIT.
           IF SCR-STAT = SCR-STAT-SON
               PERFORM PRO-ALL
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-CAN
               PERFORM EDT-FLD-CAN
               PERFORM SCR-PUTA
               MOVE SCR-INST-GCS TO SCR-INST
               IF SCR-STAT NOT = SCR-STPP
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   PERFORM SCR-EXIT
               ELSE
                   PERFORM SCR-EXIT.
      *ASUME SCR-STAT-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.
      *    MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-CAN.
           PERFORM EDT-FLD-CAN.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-GAB TO SCR-INST.
           IF SCR-STAT NOT = SCR-STPP
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
           PERFORM SCR-EXIT.
       FIN-SCR-TRL.
           EXIT.

       DESSCRTRL SECTION.
       INI-DESSCRTRL.
           IF SCR-INST = SCR-INST-GCF
                  PERFORM SCR-GCNF
                  GO TO FIN-DESSCRTRL.
           MOVE SCR-VFLD-NOT TO SCR-VFLD.
           MOVE FRM-FFLD TO SCR-FFLD.
           IF SCR-STAT = SCR-STAT-ABT OR SCR-STAT-CON
                  GO TO FIN-DESSCRTRL.
           IF SCR-FFLD-RET OR SCR-FFLD-PF10
                  MOVE SCR-VFLD-YES TO SCR-VFLD
                  PERFORM PRO-CONF.
       FIN-DESSCRTRL.
           IF SCR-FFLD-PF10 OR SCR-FFLD-PF3
                 MOVE SCR-INST-HCM TO SCR-INST
           ELSE
                 MOVE SCR-INST-HKY TO SCR-INST.
       EXT-DESSCRTRL.
           EXIT.

       PRO-CONF SECTION.
       INI-PRO-CONF.
      *PTC-INI
           IF SCR-OFRM-SRV AND
              SCR-CONF NOT > SPACES
                MOVE SPACES TO FRM-MENS.
      *PTC-FIN
           IF FRM-MENS NOT > SPACES
               IF SCR-CONF NOT > SPACES
                   GO TO FIN-PRO-CONF
               ELSE
                   MOVE SCR-CONF TO FRM-MENS
           ELSE
               IF FRM-MEN1 NOT > SPACES
                   MOVE SCR-CONF TO FRM-MEN1.
           PERFORM PRO-KEY-CAN.
           PERFORM PRO-FLD-CAN.
           PERFORM FST-MSG.
           PERFORM SCR-MSSG.
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM EDT-KEY-CAN
               PERFORM EDT-FLD-CAN.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-GCF TO SCR-INST.
           PERFORM SCR-EXIT.
       FIN-PRO-CONF.
           EXIT.

       SCR-GCNF SECTION.
       INI-SCR-GCNF.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3  OR
                               FRM-FFLD-PF4 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO CAN-GLS-MEN2
               MOVE SCR-CONF     TO CAN-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO CAN-FLD.
           MOVE FRM-FFLD TO SCR-FFLD.
           IF FRM-FFLD = FRM-FFLD-PF3
               MOVE SCR-VFLD-NOT TO SCR-VFLD
           ELSE
           IF FRM-FFLD = FRM-FFLD-RET OR FRM-FFLD-PF10 OR FRM-FFLD-PF4
               MOVE SCR-VFLD-YES TO SCR-VFLD
               PERFORM VAL-NUM-KEY-CAN
               PERFORM VAL-NUM-FLD-CAN
           ELSE
           IF FRM-FFLD = FRM-FFLD-PF12
               MOVE SCR-STPP TO SCR-STAT
               IF SCR-STAT = SCR-STAT-MOD
                   PERFORM VAL-NUM-KEY-CAN
                   PERFORM VAL-NUM-FLD-CAN
                   PERFORM SCR-TRL
               ELSE
                   MOVE SCR-VFLD-NOT TO SCR-VFLD.
       FIN-SCR-GCNF.
           EXIT.


       PGM-EBR-ALL SECTION.
       INI-PGM-EBR-ALL.
           MOVE FIO-EBR-ALL TO FIO-CMND.
           PERFORM COL-FIO-CAN.
       FIN-PGM-EBR-ALL.
           EXIT.


       COPY COLBMCAN.
       COPY COLBFCAN.
       COPY GNSBVNUM.
       COPY GNSBFMSG.
       COPY GNSBGSYS.
       COPY GNSBGDTC.
      *PTC-INI
      *PTC-SUB
      *COPY GNSBGFRM.
       COPY GNSBG3CF.
      *PTC-FIN
       COPY GNSBGMSG.
       COPY GNSBEKEY.
       COPY GNSBIABT.
       COPY GNSBBTAB.
       COPY GNSBVCOD.
       COPY GNSBVTAB.
       COPY GNSBFTAB.
       COPY GNSBBMSC.
       COPY GNSBVIND.
       COPY GNSBVMSC.
       COPY GNSBFMSC.
       COPY GNSBVIDC.
       COPY GNSBPVRF.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY TABBFOFI.
       COPY TABBBUSR.
       COPY TABBVTDU.
       COPY TABBFUSR.

      *<<<< ( EOF ) AND ( NOT PGM_VSI )
       COPY GNSBGVSM.
       COPY GNSBHVSM.
      *>>>>
      *<<<< EOF
       COPY COLBFDIC.                                                   

       RST-STAT SECTION.
       INI-RST-STAT.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
       FIN-RST-STAT.
           EXIT.

       GNS-CLR-RQA SECTION.
       INI-GNS-CLR-RQA.
           MOVE SPACES TO SCR-CAN-REQA.
           MOVE SPACES TO SCR-KEY-ICAN.
       FIN-GNS-CLR-RQA.
           EXIT.
      *>>>>
      *<<<< EOF
       VAL-OFI-USP SECTION.
       INI-VAL-OFI-USP.
           COPY USPC143.
           IF SCR-CMND = WSS-ICM
              GO TO FIN-VAL-OFI-USP.                                    
           MOVE FRM-CPIM-AEY    TO CAN-COD-OFCA-ATR IN CAN-FLD.
           MOVE USP-COD-OFICINA TO CAN-COD-OFCA IN CAN-FLD.
       FIN-VAL-OFI-USP.
           EXIT.

       CHK-PNR-BGT SECTION.
       INI-CHK-PNR-BGT.
           MOVE SPACES TO MSG-COD-MENS.
      *Busca dato 'como opera=wss-opec'
           MOVE OPC-COD-TOOC IN OPC TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM COL-FIO-TOC.
           IF NOT FIO-STAT-OKS
               MOVE 'CANTOOCNEX' TO MSG-COD-MENS
               GO TO FIN-CHK-PNR-BGT.
           MOVE TOC-MSC-OPEC IN TOC TO WSS-OPEC.
      *Si es una prorroga,novacion,renovacion de boleta de garantia
      *debe sumar el RCV-SGV-CAPI (en $ si corresponde) al CAN-SGV-TREN
           IF NOT ( ( CAN-MSC-TCAN = WSS-N OR WSS-R OR WSS-P OR 
                    WSS-K ) AND ( WSS-OPEC = WSS-B ) )
               GO TO FIN-CHK-PNR-BGT.
      *Busca cic de moneda para saber si transforma a $
           MOVE WSS-TAB TO TAB-COD-SIST FIO-SIST.
           MOVE WCC-VLR TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'CODTVLRNEX' TO MSG-COD-MENS
               GO TO FIN-CHK-PNR-BGT.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-VCAM.
      *si es moneda reajustable ( chilena y no pesos ) entonces
      *convierte a pesos
           IF NOT ( WSS-CIC-TVAL     = WSS-C0 AND
                    WSS-CIC-VCAM NOT = WSS-COD-PESO )
               MOVE RCV-SGV-CAPI IN RCV TO WSS-VAL-SVEN
               GO TO SUM-CHK-PNR-BGT.

           MOVE CAN-NUM-SCAN IN CAN     TO NVC-SCAM.
           MOVE CAN-NUM-ACAN IN CAN     TO NVC-ACAM.
           MOVE CAN-NUM-MCAN IN CAN     TO NVC-MCAM.
           MOVE CAN-NUM-DCAN IN CAN     TO NVC-DCAM.
           MOVE RCV-SGV-CAPI IN RCV     TO NVC-VALO.
           MOVE OPC-COD-VCOC IN OPC     TO NVC-MON1.
           MOVE WSS-COD-PESO            TO NVC-MON2.
           MOVE WSS-C                   TO NVC-IND-ACCI.
           PERFORM PRO-NVC-NCD.
           MULTIPLY RCV-SGV-CAPI IN RCV BY NVC-FACT
                    GIVING WSS-VAL-SVEN ROUNDED.

           MOVE WSS-VAL-SVEN TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-SVEN.
       SUM-CHK-PNR-BGT.
           MOVE WSS-VAL-SVEN TO CAN-SGV-TREN IN CAN.                    
       FIN-CHK-PNR-BGT.
           EXIT.

       COPY GNSBGCAM.
       COPY COLBFTMC.
       COPY COLBFCYA.
       COPY COLBFICG.
       COPY COLBFITR.
       COPY SGCBFDBC.
       COPY SGCBFDCE.
       COPY SGCBFDCP.
       COPY COLBFCOM.
       COPY COLBFOPC.
       COPY COLBFRCV.
       COPY COLBFROV.
       COPY COLBFVEN.
       COPY COLBFRDC.
       COPY SGCBFRCO.
       COPY SGCBFOPE.
       COPY GNSBGCPT.
       COPY COLBGCLI.
       COPY GNSBGCIC.
       COPY GNSBFCIC.
       COPY TABBFCAM.
       COPY TABBFVLR.
       COPY TABBFTIO.
       COPY COLBGMPC.
       COPY COLBGVEN.
       COPY COLBGINT.
       COPY GNSBGCVI.
       COPY COLBFDLC.
       COPY COLBFEVC.
       COPY COLBFTOC.
       COPY GNSBGPES.
       COPY GNSBPFEC.
       COPY GNSBGQUE.
       COPY GNSBGTSK.                                                   
       COPY COLBGVDI.

       COPY COLB1IFR.                                                   

      *  CODIGO ADICIONAL PARA ENGANCHE PROGRAMAS
       ING-FTER-CIC SECTION.
       INI-ING-FTER-CIC.
           PERFORM ING-SETE.
           MOVE SCR-INST-GKY TO SCR-INST.
           PERFORM HBL-KEY.
           PERFORM SCR-CLRA-CAN.
           PERFORM EDT-KEY-CAN.
           PERFORM EDT-FLD-CAN.
      *GET-MSG Busca mensaje en tabla
           MOVE WSS-GNS  TO MSG-COD-SIST.
           MOVE 'MSGKEY' TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO CAN-GLS-MENS.
           MOVE SPACES TO SCR-CIC-IOPC
                          SCR-VEC-ENG
                          SCR-VEC-FST
                          SCR-IND-EOV
                          SCR-INST-EXT
                          SCR-MENS-EXT.
           PERFORM SCR-INIT.
           PERFORM SCR-EXIT.
       FIN-ING-FTER-CIC.
           EXIT.

       ING-FTER-CMN SECTION.
       INI-ING-FTER-CMN.
           PERFORM ING-SETE.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-CAN.
           MOVE SCR-MENS-EXT TO CAN-GLS-MENS.
           PERFORM SCR-INIT.
       FIN-ING-FTER-CMN.
           EXIT.

       ING-SETE SECTION.
       INI-ING-SETE.
           PERFORM CRG-TBL-ENG.
           MOVE WSS-NTRN(SCR-IPRO) TO SCR-NTRN.
           MOVE WSS-PROG(SCR-IPRO) TO SCR-PROG.
           MOVE WSS-NMAP(SCR-IPRO) TO SCR-NMAP.
           MOVE WSS-NLIB(SCR-IPRO) TO SCR-NLIB.
       FIN-ING-SETE.
           EXIT.

       EGR-FPEN-CIC SECTION.
       INI-EGR-FPEN-CIC.
           PERFORM CRG-TBL-ENG.
           ADD WSS-1 TO SCR-IPRO.
           IF SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) = SPACES
               GO TO INI-EGR-FPEN-CIC.
           MOVE WSS-INST-FPEN-CIC TO SCR-INST-EXT.
           MOVE WSS-PROG(SCR-IPRO) TO SYS-PROG.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-XCTL TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-EGR-FPEN-CIC.
           EXIT.

       EGR-FTER-CIC SECTION.
       INI-EGR-FTER-CIC.
           PERFORM CRG-TBL-ENG.
           MOVE WSS-1 TO SCR-IPRO.
           MOVE WSS-INST-FTER-CIC TO SCR-INST-EXT.
           MOVE WSS-PROG(SCR-IPRO) TO SYS-PROG.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-XCTL TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-EGR-FTER-CIC.
           EXIT.

       EGR-FTER-CMN SECTION.
       INI-EGR-FTER-CMN.
           PERFORM CRG-TBL-ENG.
           MOVE WSS-1 TO SCR-IPRO.
           MOVE WSS-INST-FTER-CMN TO SCR-INST-EXT.
           MOVE WSS-PROG(SCR-IPRO) TO SYS-PROG.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-XCTL TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-EGR-FTER-CMN.
           EXIT.

       SCR-INIT SECTION.
       INI-SCR-INIT.
           MOVE WSS-3         TO FRM-PLIN.
           MOVE WSS-19        TO FRM-NLIN.
           MOVE FRM-CLR-FRM   TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE FRM-SINI-DBNF TO FRM-SINI.
           MOVE SCR-NMAP      TO FRM-NAME.
           MOVE SCR-NLIB      TO FRM-NLIB.
           MOVE CAN-FLD       TO FRM-DFLD.
           MOVE FRM-INI       TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-INIT.
           EXIT.
       COPY COLBGMPT.

       COPY TABBKTXC.
       COPY COLBFIXT.                                                   
       COPY COLB1CXE.                                                   
       COPY COLBGCXE.                                                   
       COPY COLBFCXE.                                                   
       COPY COLBFCEN.
       COPY COLBGLOF.
       COPY LDCBFLCC.
       COPY LDCBFRLO.
       COPY COLBGPVE.                                                   

       COPY COLB3CAN.
       COPY COLB6CAN.
       COPY COLBKDPS.
       COPY GNSBINVC.
       COPY COLBKGCN.
       COPY COLBKHNJ.

       PROCESA-PCP SECTION.                                             
       INI-PROCESA-PCP.                                                 
           MOVE SCR-QIDD      TO PCP-QIDD.                              
           MOVE SCR-LIDD      TO PCP-LIDD.                              
           MOVE PCP-DINP      TO SYS-CMMA.                              
           MOVE 'COLPPPDC'    TO SYS-PROG.                              
           MOVE QUE-PDC-LITM  TO SYS-TCMA.                              
           MOVE SYS-LINK      TO SYS-CMND.                              
           PERFORM GNS-PRO-SYS.                                         
           MOVE SYS-CMMA TO PCP-DOUT.                                   
           IF PCP-RETO = WSS-C1                                            
               MOVE SPACES TO PCP                                       
               MOVE WSS-COL        TO MSG-COD-SIST                      
               MOVE 'ERROR PCP'    TO PCP-CMSG MSG-COD-MENS             
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC   TO FRM-MENS                          
               MOVE PCP-MMSG       TO FRM-MEN2                          
               MOVE FRM-SUAR-MAL   TO FRM-SUAR                          
               GO TO FIN-PROCESA-PCP.                                   
       FIN-PROCESA-PCP.                                                 
           EXIT.                                                        
      *>>>>                                                             
       PUT-TS-OPC SECTION.                                              
       INI-PUT-TS-OPC.                                                  
                                                                        
           IF NOT SCR-OFRM-SRV                                          
               GO TO FIN-PUT-TS-OPC.                                    
                                                                        
           MOVE PTC-OPC-TYPE-ROPC TO QUE-TYPE.                          
           MOVE TSK-TERM-ALF      TO QUE-TERM.                          
           MOVE PTC-OPC-LENG      TO QUE-LITM.                          
           MOVE WSS-1             TO QUE-NITM.                          
           MOVE QUE-GET           TO QUE-CMND.                          
           PERFORM GNS-PRO-QUE.                                         
           IF QUE-STAT = QUE-STAT-OKS                                   
              MOVE PTC-OPC-TYPE-ROPC TO QUE-TYPE                        
              MOVE TSK-TERM-ALF      TO QUE-TERM                        
              MOVE QUE-DEL           TO QUE-CMND                        
              PERFORM GNS-PRO-QUE                                       
              MOVE PTC-OPC-TYPE-ROPC TO QUE-TYPE                        
              MOVE TSK-TERM-ALF      TO QUE-TERM                        
              MOVE PTC-OPC-LENG      TO QUE-LITM                        
              MOVE CIC-CAI-ICIC      TO PTC-OPC-OPC-CAI-IOPC            
              MOVE CIC-IIC-ICIC      TO PTC-OPC-OPC-IIC-IOPC            
              MOVE PTC-OPC-ITEM      TO QUE-ITEM                        
              MOVE QUE-PUT           TO QUE-CMND                        
              PERFORM GNS-PRO-QUE.                                      
       FIN-PUT-TS-OPC.                                                  
           EXIT.                                                        
                                                                        
       NO-VAL-MLT SECTION.                                              
       INI-NO-VAL-MLT.                                                  
      *ISP MANEJO CODIGO DE CARGO                                       
      *    DESPUES DEL MANEJO DE VALOR PAGADO                           
           IF CAN-SGV-TPAG IN CAN-FLD > ZEROES OR                       
              ( CAN-SGV-TPAG IN CAN-FLD = ZEROES AND                    
                WSS-IBLK-TPAG = WSS-N )                                   
              IF CYA-IND-TCYA IN CAN-FLD NOT > SPACES                   
                   MOVE WSS-COL      TO MSG-COD-SIST                    
                   MOVE 'INDTCYAOBL' TO MSG-COD-MENS                    
                   PERFORM GET-MSG                                      
                   MOVE MSG-GLS-DESC TO FRM-MENS                        
                   MOVE FRM-SUAR-MAL TO FRM-SUAR                        
                   GO TO FIN-NO-VAL-MLT                                 
               ELSE                                                     
                   MOVE CAN-NUM-DOUT IN CAN-FLD TO CAN-NUM-DOUT IN CAN  
                   MOVE CAN-NUM-MOUT IN CAN-FLD TO CAN-NUM-MOUT IN CAN  
                   MOVE CAN-NUM-SOUT IN CAN-FLD TO CAN-NUM-SOUT IN CAN  
                   MOVE CAN-NUM-AOUT IN CAN-FLD TO CAN-NUM-AOUT IN CAN  
                   MOVE CAN-NUM-DCAN IN CAN-FLD TO CAN-NUM-DCAN IN CAN  
                   MOVE CAN-NUM-MCAN IN CAN-FLD TO CAN-NUM-MCAN IN CAN  
                   MOVE CAN-NUM-SCAN IN CAN-FLD TO CAN-NUM-SCAN IN CAN  
                   MOVE CAN-NUM-ACAN IN CAN-FLD TO CAN-NUM-ACAN IN CAN  
                   MOVE WSS-TAB                 TO MSC-COD-SIST         
                   MOVE WSS-TCYA                TO MSC-COD-TMSC IN MSC  
                   MOVE CYA-IND-TCYA IN CAN-FLD TO MSC-COD-CMSC IN MSC  
                   PERFORM BUS-MSC                                      
                   MOVE PTC-OPC-TYPE-ROPC TO QUE-TYPE                   
                   MOVE TSK-TERM-ALF      TO QUE-TERM                   
                   MOVE PTC-OPC-LENG      TO QUE-LITM                   
                   MOVE WSS-1             TO QUE-NITM                   
                   MOVE QUE-GET           TO QUE-CMND                   
                   PERFORM GNS-PRO-QUE                                  
                   IF QUE-STAT NOT = QUE-STAT-OKS                       
                       IF MSC-CIC-CMSC IN MSC = WSS-CC AND                
                         ( SCR-MSC-TCAN = WSS-R OR WSS-N OR 
                                 WSS-P OR WSS-K )    
                          AND CAN-MSC-CANC IN CAN-FLD NOT = WSS-KTT       
                          AND CAN-MSC-CANC IN CAN-FLD NOT = WSS-PTT       
                         MOVE WSS-COL        TO MSG-COD-SIST            
                         MOVE 'OPCPRGACCTNO' TO MSG-COD-MENS            
                         PERFORM GET-MSG                                
                         MOVE MSG-GLS-DESC TO FRM-MENS                  
                         MOVE FRM-SUAR-MAL TO FRM-SUAR                  
                         GO TO FIN-NO-VAL-MLT                           
                       ELSE                                             
                         NEXT SENTENCE                                  
                   ELSE                                                 
                          NEXT SENTENCE                                 
           ELSE                                                         
               IF CYA-IND-TCYA IN CAN-FLD > SPACES                      
                 MOVE WSS-COL      TO MSG-COD-SIST                      
                 MOVE 'INDTCYABLK' TO MSG-COD-MENS                      
                 PERFORM GET-MSG                                        
                 MOVE MSG-GLS-DESC TO FRM-MENS                          
                 MOVE FRM-SUAR-MAL TO FRM-SUAR                          
                 GO TO FIN-NO-VAL-MLT.                                  
                                                                        
       FIN-NO-VAL-MLT.                                                  
           EXIT.                                                        
      * ISP-FIN INVOCADO POR COLB3CAN                                   
      *>>>>
