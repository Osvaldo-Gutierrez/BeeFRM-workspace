       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPGCVA.
       AUTHOR.          BEE TEAM (EX-CONSIST).
       DATE-WRITTEN.    10-JAN-1997
      *OPTIMIZACION  : JGM
      *
      * Genera  cancelaciones a partir  de los  vencimientos  que  ocurr
      * en  una  fecha determinada y que ademas tengan cargo automatico
      * cuenta corriente.
      * FECHA  INGRESADA COMO PARAMETRO.
      * Este programa  cumple la misma  funcionalidad que el COLPGCA1.
      * diferencia radica en el procesamiento de los archivos.
      * COLPGCA1 SE USA UN ARCHIVO INDEXADO LLAMADO VEN
      * COLPGCVS SE USA UN ARCHIVO SECUENCIAL LLAMADO VES
      * MODIFICAR COLPGCA1 Y COLPGCAN.
      *
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *-----------------------
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
      *
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EJC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EJE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-POC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==SCR-CAN-REQA==.
       01  SCR-KEY-ICAN                     PIC X(03).
      *<<<< WSS
       COPY COLBROPC.
       COPY COLBRCYA.
       COPY COLBRAUT.
       COPY COLBRVEN.
       COPY COLBRVES.
       COPY COLBRRCV.
       COPY COLBRCAN.
       COPY COLBRTOC.
       COPY COLBRRDT.
       COPY COLBRDLC.
       COPY COLBREVC.
       COPY COLBRICG.
       COPY COLBRRDC.
       COPY SGCBRRCO.
       COPY SGCBROPE.
       COPY COLWGVEN.
       COPY COLWGCTO.
       COPY COLWGECA.
       COPY TABBRCAM.
       COPY TABBROFI.
       COPY TABBRTIO.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSBRMSC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGPES.
       COPY COLWGINT.
       COPY GNSWGCVI.
       COPY COLBRCOM.
       COPY COLBREJC.
       COPY COLBRITR.
       COPY COLBRPOC.
       COPY COLBRROV.
       COPY COLBRTMC.
       COPY COLWGENG.
       COPY COLWGVIN.
       COPY COLWICAN.
       COPY GNSBRCIC.
       COPY GNSWCNUM.
       COPY GNSWCSCR.
       COPY GNSWCVRF.
       COPY GNSWGCIC.
       COPY GNSWGCPT.
       COPY GNSWGFRM.
       COPY GNSWGIDC.
       COPY GNSWVNUM.
       COPY GNSWVSCR.
       COPY GNSWVVRF.
       COPY SGCBRDBC.
       COPY SGCBRDCP.
       COPY SGCBRDCE.
       COPY TABWGTXC.
       COPY TABBRUSR.
       COPY COLW1CAN.
       COPY COLW2CAN.
      *CONTADORES.
           03 WSS-NUM-GCAN     VALUE ZEROS PIC 9(07).
           03 WSS-NUM-GCYA     VALUE ZEROS PIC 9(07).
           03 WSS-NUM-GRCV     VALUE ZEROS PIC 9(07).
           03 WSS-NUM-GICG     VALUE ZEROS PIC 9(07).
      *
           03 WSS-SGV-TINT     VALUE ZEROS PIC S9(03)V9(04).
      *
           03 WSS-VAL-CMP2                COMP-2.
           03 WSS-DIAS-MORA          VALUE 0 PIC 9(03).
           03 WSS-MSC-CCAA           VALUE SPACES PIC X(05).
           03 WSS-MSC-CCAM           VALUE SPACES PIC X(05).
           03 WSS-MSC-CCAO           VALUE SPACES PIC X(05).
           03 WSS-MSC-MCAN           VALUE SPACES PIC X(01).
           03 WSS-SGV-FINA           COMP-3       PIC S9(11)V9(4).
           03 WSS-NUM-RCHK                        PIC 9(04).
           03 WSS-NUM-RLEI           VALUE ZEROS  PIC 9(08).
           03 WSS-NUM-PLEI           VALUE ZEROS  PIC 9(08).
           03 WSS-NUM-RPRO           VALUE ZEROS  PIC 9(08).
           03 WSS-NUM-RERR           VALUE ZEROS  PIC 9(08).
      *
           03 WSS-COD-OFIC.
              05 WSS-IND-OFIC        OCCURS 10    PIC X(03).
           03 WSS-OFI-NFND           VALUE ZEROS  PIC 9(02).
           03 WSS-MSG-MENS.
              05 WSS-MSG-PREV                     PIC X(09).
              05 WSS-MSG-TENT                     PIC X(01).
              05 WSS-MSG-FENT                     PIC X(01).
              05 WSS-MSG-SENT                     PIC X(01).
           03 WSS-MEN1.
              05 WSS-MEN1-1                       PIC X(15).
              05 WSS-MEN1-2                       PIC X(24).
           03 WSS-SGV-DIFE  VALUE +0              PIC S9(13)V9(05).
           03 WSS-SGV-DIFE-ALF                    PIC  X(24).
           03 WSS-SGV-DIFE-EDT REDEFINES WSS-SGV-DIFE-ALF
                               PIC --.---.---.---.---,-----.
           03 WSS-FEC-FPRO.
              05 WSS-NUM-DPRO    VALUE ZEROES     PIC 9(02).
              05 WSS-NUM-MPRO    VALUE ZEROES     PIC 9(02).
              05 WSS-NUM-SPRO    VALUE ZEROES     PIC 9(02).
              05 WSS-NUM-APRO    VALUE ZEROES     PIC 9(02).
           03 WSS-FEC-FFEC.
              05 WSS-NUM-SFEC                     PIC 9(02).
              05 WSS-NUM-AFEC                     PIC 9(02).
              05 WSS-NUM-MFEC                     PIC 9(02).
              05 WSS-NUM-DFEC                     PIC 9(02).
           03 WSS-FEC-FMIN.
              05 WSS-NUM-DMIN        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-MMIN        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-SMIN        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-AMIN        VALUE ZEROS  PIC 9(02).
           03 WSS-FEC-FINI.
              05 WSS-NUM-DINI        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-MINI        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-SINI        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-AINI        VALUE ZEROS  PIC 9(02).
           03 WSS-FEC-FTER.
              05 WSS-NUM-STER        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-ATER        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-MTER        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-DTER        VALUE ZEROS  PIC 9(02).
           03 WSS-FEC-FBOL.
              05 WSS-NUM-DBOL        VALUE ZEROES PIC 9(02).
              05 WSS-NUM-MBOL        VALUE ZEROES PIC 9(02).
              05 WSS-NUM-SBOL        VALUE ZEROES PIC 9(02).
              05 WSS-NUM-ABOL        VALUE ZEROES PIC 9(02).
           03 WSS-FEC-FUNO.
              05 WSS-NUM-SUNO        VALUE ZEROES PIC 9(02).
              05 WSS-NUM-AUNO        VALUE ZEROES PIC 9(02).
              05 WSS-NUM-MUNO        VALUE ZEROES PIC 9(02).
              05 WSS-NUM-DUNO        VALUE ZEROES PIC 9(02).
           03 WSS-FEC-FFCA.
              05 WSS-NUM-DFCA        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-MFCA        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-SFCA        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-AFCA        VALUE ZEROS  PIC 9(02).
           03 WSS-FEC-FPO1.
              05 WSS-NUM-SPO1    VALUE ZEROES     PIC 9(02).
              05 WSS-NUM-APO1    VALUE ZEROES     PIC 9(02).
              05 WSS-NUM-MPO1    VALUE ZEROES     PIC 9(02).
              05 WSS-NUM-DPO1    VALUE ZEROES     PIC 9(02).
           03 WSS-FEC-FPO2.
              05 WSS-NUM-SPO2    VALUE ZEROES     PIC 9(02).
              05 WSS-NUM-APO2    VALUE ZEROES     PIC 9(02).
              05 WSS-NUM-MPO2    VALUE ZEROES     PIC 9(02).
              05 WSS-NUM-DPO2    VALUE ZEROES     PIC 9(02).
           03 WSS-FEC-FPO3.
              05 WSS-NUM-SPO3    VALUE ZEROES     PIC 9(02).
              05 WSS-NUM-APO3    VALUE ZEROES     PIC 9(02).
              05 WSS-NUM-MPO3    VALUE ZEROES     PIC 9(02).
              05 WSS-NUM-DPO3    VALUE ZEROES     PIC 9(02).
           03 WSS-GLS-MEN2           VALUE SPACES PIC X(40).
           03 WSS-AUX-APIN.
              05 FILLER                           PIC X(04).
              05 WSS-COD-APIN                     PIC X(08).
           03 WSS-RCV-KEY-ICAN.
              05 WSS-RCV-CIC-IOPC-P    VALUE SPACES PIC X(12).
              05 WSS-RCV-NUM-ICAN-P    VALUE ZEROS  PIC 9(03).
           03 WSS-AUX-COCM.
              05 FILLER                           PIC X(04).
              05 WSS-COD-COCM                     PIC X(08).
           03 WSS-COD-OFOC                        PIC X(03).
           03 WSS-COD-COOC                        PIC X(06).
           03 WSS-CIC-CTAB                        PIC X(03).
           03 WSS-CIC-ICYA       VALUE SPACES     PIC X(12).
           03 WSS-VRF-ICYA       VALUE SPACES     PIC X(01).
           03 WSS-NUM-OPCL      VALUE 0           PIC 9(06).
           03 WSS-NUM-SORG      VALUE 0           PIC 9(06).
           03 WSS-NUM-SORL      VALUE 0           PIC 9(06).
           03 WSS-NUM-CANG      VALUE 0           PIC 9(06).
           03 WSS-SGV-ACUM      VALUE 0 COMP-3    PIC S9(13)V9(02).
           03 WSS-AUX-TPAG      VALUE 0 COMP-3    PIC S9(13)V9(02).
           03 WSS-I             VALUE 0           PIC 9(03).
           03 WSS-CNT-DIAS      VALUE 0           PIC 9(03).
           03 WSS-COD-CMSC           VALUE SPACES PIC X(01).
           03 WSS-VEN-KEY-IVEN.
              05 WSS-VEN-CIC-IOPC                 PIC X(12).
              05 WSS-VEN-NUM-IVEN                 PIC 9(03).
           03 WSS-IND-OTRO                        PIC X(01).
           03 WSS-OPC-KEEP                        PIC X(218).
           03 WSS-SGV-PROC COMP-3    VALUE +0     PIC S9(11)V9(04).
           03 WSS-SGV-COLO COMP-3    VALUE +0     PIC S9(11)V9(04).
           03 WSS-FEC-FIN1.
              05 WSS-NUM-DIN1        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-MIN1        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-SIN1        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-AIN1        VALUE ZEROS  PIC 9(02).
       01  HST-VARI.
           03 HST-MSC-TACC VALUE '*'              PIC X(01).
           03 HST-FEC-FFIN                        PIC X(08).


       01  PGM-STAT.
           03 PGM-STAT-OPC           VALUE '23'      PIC X(02).
                 88 PGM-STAT-OPC-OKS    VALUE '00'.
                 88 PGM-STAT-OPC-NUL    VALUE '  '.
           03 PGM-STAT-CYA           VALUE '23'      PIC X(02).
                 88 PGM-STAT-CYA-OKS    VALUE '00'.
                 88 PGM-STAT-CYA-NUL    VALUE '  '.
           03 PGM-STAT-AUT           VALUE '23'      PIC X(02).
                 88 PGM-STAT-AUT-OKS    VALUE '00'.
                 88 PGM-STAT-AUT-NUL    VALUE '  '.
           03 PGM-STAT-DBC           VALUE '23'      PIC X(02).
                 88 PGM-STAT-DBC-OKS    VALUE '00'.
                 88 PGM-STAT-DBC-NUL    VALUE '  '.
           03 PGM-STAT-VEN           VALUE '23'      PIC X(02).
                 88 PGM-STAT-VEN-OKS    VALUE '00'.
                 88 PGM-STAT-VEN-NUL    VALUE '  '.
           03 PGM-STAT-RDC           VALUE '23'      PIC X(02).
                 88 PGM-STAT-RDC-OKS    VALUE '00'.
                 88 PGM-STAT-RDC-NUL    VALUE '  '.
           03 PGM-STAT-RCV           VALUE '23'      PIC X(02).
                 88 PGM-STAT-RCV-OKS    VALUE '00'.
                 88 PGM-STAT-RCV-NUL    VALUE '  '.
           03 PGM-STAT-ITR           VALUE '23'      PIC X(02).
                 88 PGM-STAT-ITR-OKS    VALUE '00'.
                 88 PGM-STAT-ITR-NUL    VALUE '  '.
           03 PGM-STAT-ICG           VALUE '23'      PIC X(02).
                 88 PGM-STAT-ICG-OKS    VALUE '00'.
                 88 PGM-STAT-ICG-NUL    VALUE '  '.
           03 PGM-STAT-CAN           VALUE '23'      PIC X(02).
                 88 PGM-STAT-CAN-OKS    VALUE '00'.
                 88 PGM-STAT-CAN-NUL    VALUE '  '.
           03 PGM-STAT-ROV           VALUE '23'      PIC X(02).
                 88 PGM-STAT-ROV-OKS    VALUE '00'.
                 88 PGM-STAT-ROV-NUL    VALUE '  '.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *VARIABLES DE TRABAJO
       01  PAR-VARI.
      * Variables de Parametros para Obtencion F. Parametro
      * Variables de INPUT
           03 PAR-COD-TPAR                          PIC X(03).
           03 PAR-COD-PROG                          PIC X(03).
           03 PAR-COD-TPRO                          PIC X(03).
           03 PAR-COD-TFEC                          PIC X(03).
      * Variables de OUTPUT
           03 PAR-COD-FPAR                          PIC X(10).
           03 PAR-COD-FPAR-R REDEFINES PAR-COD-FPAR.
              05 PAR-FEC-FPAR                       PIC X(08).
              05 PAR-GLS-FPAR                       PIC X(02).
           03 PAR-COD-STAT                          PIC 9(01).
           03 PAR-COD-MENS                          PIC X(12).
           03 PAR-COD-PAR1.
              05 PAR-COD-PA11                       PIC X(04).
              05 PAR-COD-PA12                       PIC X(03).
       01  WSS-AUXI.
           05 WSS-MSJS.
              07 WSS-MSJ0                              PIC X(22).
              07 FILLER                                PIC X(01).
              07 WSS-MSJ1                              PIC X(16).
              07 FILLER                                PIC X(01).
              07 WSS-MSJ2                              PIC X(22).
              07 FILLER                                PIC X(01).
              07 WSS-MSJ3                              PIC X(16).
       01  TBAN-VARI.
           03 TBAN-AUXI-TBAN                           PIC X(03).
           03  TBAN-IMAX                               PIC 9(02).
           03  TBAN-OMAX           VALUE 30            PIC 9(02).
           03  TBAN-VEC-TBAN.
               05 TBAN-TBAN    OCCURS 30 TIMES.
                  07  TBAN-COD-TBAN                    PIC X(03).
                  07  TBAN-NUM-NDIA                    PIC 9(02).
                  07  TBAN-FEC-FBAN.
                      09  TBAN-NUM-SBAN                PIC 9(02).
                      09  TBAN-NUM-ABAN                PIC 9(02).
                      09  TBAN-NUM-MBAN                PIC 9(02).
                      09  TBAN-NUM-DBAN                PIC 9(02).
           03  TBAN-GLS-DATA.
               05  FILLER                              PIC X(10).
               05  TBAN-NUM-DREI                       PIC 9(02).
               05  FILLER                              PIC X(48).
           03  TBAN-FEC-FAUX.
               05  TBAN-NUM-SAUX                       PIC 9(02).
               05  TBAN-NUM-AAUX                       PIC 9(02).
               05  TBAN-NUM-MAUX                       PIC 9(02).
               05  TBAN-NUM-DAUX                       PIC 9(02).
           03  TBAN-I               VALUE ZEROES       PIC 9(02).
           03  TBAN-J               VALUE ZEROES       PIC 9(02).
       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
      *------------
       INI-MAIN.
           COPY GNSBGEDB.
           MOVE 'COLPGCA1' TO FIO-PROG SCR-USER.
           PERFORM GNS-BUS-IDD.
           PERFORM OPEN-FILE.
           PERFORM PRM-CAN.
           PERFORM INI-CAN.
           PERFORM LUP-PUT-VEN.
           PERFORM CLOSE-FILE.
           PERFORM ESTADISTICAS.
      *
       FIN-MAIN.
           PERFORM GNS-PRO-END.
      ******************************************************************
       OPEN-FILE SECTION.
      *-----------------
       INI-OPEN-FILE.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'COL'   TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE 'TAB'   TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *
           PERFORM COL-FIO-DLC.
           PERFORM COL-FIO-OPC.
           PERFORM COL-FIO-VEN.
           PERFORM COL-FIO-CAN.
           PERFORM COL-FIO-ICG.
           PERFORM COL-FIO-RDC.
           PERFORM COL-FIO-RCV.
           PERFORM COL-FIO-CYA.
           PERFORM COL-FIO-TMC.
      *
           PERFORM SGC-FIO-DBC.
           PERFORM SGC-FIO-OPE.
           PERFORM SGC-FIO-RCO.
           PERFORM TAB-FIO-CAM.
           PERFORM TAB-FIO-OFI.
      *
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM COL-FIO-EVC.
      *
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-VES.
      *
       FIN-OPEN-FILE.
           EXIT.
      ******************************************************************
       PRM-CAN SECTION.
      *---------------
       INI-PRM-CAN.
           PERFORM CARGA-TAB-TBAN.
           IF TBAN-IMAX = ZEROES
               DISPLAY 'NO EXISTEN CODIGOS DE TIPOS DE BANCA'
               PERFORM GNS-PRO-ABT.
           IF TBAN-IMAX > TBAN-OMAX
               DISPLAY 'OVERFLOW DE TIPOS DE BANCAS(30)'
               PERFORM GNS-PRO-ABT.
      *
      * Busca Codigo con CIC de Cargo Automatico en Cta.Cte. desde GCAN
           MOVE 'TAB'        TO FIO-SIST.
           MOVE 'TCYACCGCAN' TO MSC-CIC-MSCL IN MSC.
           MOVE 'MSC'        TO MSC-CIC-TTAB IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT ( FIO-STAT-OKS AND
                    MSC-IND-VIGE IN MSC = 'S' AND
                    MSC-CIC-TTAB IN MSC = 'MSC' AND
                    MSC-CIC-MSCL IN MSC = 'TCYACCGCAN' )
               DISPLAY 'NO EXISTE CODIGO DE CARGO AUTOMATICO EN CUENTA '
                       'CORRIENTE PARA GCAN'
               DISPLAY 'EN MISCELANEO TCYA DEL SISTEMA DE TABLAS, CON '
                       'EL CIC = TCYACCGCAN'
               PERFORM GNS-PRO-ABT.
      *
       DET-PRM-GCAN.
           IF MSC-COD-DAT1 IN MSC(3) = 'M'
               MOVE MSC-COD-CMSC IN MSC TO WSS-MSC-CCAM IN WSS-VARI
           ELSE
           IF MSC-COD-DAT1 IN MSC(3) = 'O'
               MOVE MSC-COD-CMSC IN MSC TO WSS-MSC-CCAO IN WSS-VARI
           ELSE
               DISPLAY 'ERROR:EXISTE OTRO CODIGO SIN CLASIFICAR'
               PERFORM GNS-PRO-ABT.

           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT ( FIO-STAT-OKS AND
                    MSC-IND-VIGE IN MSC = 'S' AND
                    MSC-CIC-TTAB IN MSC = 'MSC' AND
                    MSC-CIC-MSCL IN MSC = 'TCYACCGCAN' )
               GO TO NXT-PRM-CAN.
           GO TO DET-PRM-GCAN.
       NXT-PRM-CAN.

           MOVE 1 TO WSS-I.
           PERFORM LIM-OFI-PRMT UNTIL WSS-I > 10.
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.
      *
      *Captura Fecha de Proceso
           ACCEPT WSS-FEC-FPRO IN WSS-VARI.
           DISPLAY 'FEC DE PROC (DDMMAAAA) : ' WSS-FEC-FPRO IN WSS-VARI.
      *
      *Captura Oficinas del credito
           ACCEPT  WSS-COD-OFIC IN WSS-VARI.
           DISPLAY 'OFICINA                : ' WSS-COD-OFIC IN WSS-VARI.
      *
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.
           DISPLAY WSS-FEC-FPRO IN WSS-VARI.
           MOVE WSS-FEC-FPRO    IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-ABT.
      *
           MOVE WSS-FEC-FPRO IN WSS-VARI TO WSS-FEC-FMIN IN WSS-VARI
                                            WSS-FEC-FFCA IN WSS-VARI.
      *
           MOVE WSS-NUM-SPRO IN WSS-VARI TO WSS-NUM-SPO2 IN WSS-VARI.
           MOVE WSS-NUM-APRO IN WSS-VARI TO WSS-NUM-APO2 IN WSS-VARI.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO WSS-NUM-MPO2 IN WSS-VARI.
           MOVE WSS-NUM-DPRO IN WSS-VARI TO WSS-NUM-DPO2 IN WSS-VARI.
      *
           MOVE WSS-NUM-DPRO IN WSS-VARI TO WSS-NUM-DTER IN WSS-VARI.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO WSS-NUM-MTER IN WSS-VARI.
           MOVE WSS-NUM-SPRO IN WSS-VARI TO WSS-NUM-STER IN WSS-VARI.
           MOVE WSS-NUM-APRO IN WSS-VARI TO WSS-NUM-ATER IN WSS-VARI.
      *
      *VAL-FEC Retrocede Dias del Parametro (Calendario)
           PERFORM BUS-DIA-ANTE.
      *
           MOVE TBAN-J TO TBAN-I.
           MOVE WSS-DIAS-MORA IN WSS-VARI TO TBAN-NUM-NDIA(TBAN-I).
           PERFORM LLE-FEC-TBAN.
           PERFORM DET-FEC-TBAN.
           MOVE 1 TO TBAN-I.
       LUP-DISP.
           IF TBAN-I > TBAN-IMAX
               GO TO NXT-DISP.
      *
           DISPLAY 'BANCA : ' TBAN-COD-TBAN(TBAN-I)
                   ' DIAS : ' TBAN-NUM-NDIA(TBAN-I)
                   ' FECHA: ' TBAN-FEC-FBAN(TBAN-I).
           ADD 1 TO TBAN-I.
           GO TO LUP-DISP.
       NXT-DISP.
      *
           IF WSS-COD-OFIC IN WSS-VARI > SPACES AND
              WSS-IND-OFIC IN WSS-VARI(1) NOT = '*'
               MOVE 1 TO WSS-I
               PERFORM VAL-OFI-PRMT UNTIL WSS-I > 10.
               IF WSS-OFI-NFND IN WSS-VARI = 10
                   DISPLAY 'NO EXISTE NINGUNA OFICINA INGRESADA'
                   PERFORM GNS-PRO-ABT.

           PERFORM BUS-DIA-POST.
      *
           DISPLAY 'FIN VALIDACION DE PARAMETROS'.
           DISPLAY '============================'.
           DISPLAY 'FECHA INICIO  : ' WSS-FEC-FINI IN WSS-VARI.
           DISPLAY 'FECHA TERMINO : ' WSS-FEC-FPRO IN WSS-VARI.
      *
           IF WSS-FEC-FBOL IN WSS-VARI > ZEROES
               DISPLAY 'FECHA BOL-GAR : ' WSS-FEC-FBOL IN WSS-VARI
           ELSE
               DISPLAY 'FECHA BOL-GAR : ' WSS-FEC-FPRO IN WSS-VARI.
       FIN-PRM-CAN.
           EXIT.

      ******************************************************************

       LIM-OFI-PRMT SECTION.
      *---------------------
       INI-LIM-OFI-PRMT.
           MOVE SPACES TO WSS-IND-OFIC IN WSS-VARI(WSS-I)
           ADD 1       TO WSS-I IN WSS-VARI.
       FIN-LIM-OFI-PRMT.
           EXIT.

      ******************************************************************

       VAL-OFI-PRMT SECTION.
      *---------------------
       INI-VAL-OFI-PRMT.
           IF WSS-IND-OFIC IN WSS-VARI(WSS-I) NOT = SPACES
               MOVE WSS-IND-OFIC IN WSS-VARI(WSS-I) TO
                                    OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF (MSG-COD-MENS = 'COD    NEX') OR
                  (MSG-COD-MENS = 'COD    NVG')
                    MOVE 'COL' TO MSG-COD-SIST
                    PERFORM GET-MSG
                    DISPLAY 'OFICINA ' WSS-IND-OFIC IN WSS-VARI(WSS-I)
                    ' ' MSG-GLS-DESC
                    ADD 1 TO WSS-OFI-NFND IN WSS-VARI.
           ADD 1 TO WSS-I IN WSS-VARI.
       FIN-VAL-OFI-PRMT.
           EXIT.

      ******************************************************************

       INI-CAN SECTION.
      *----------------
       INI-INI-CAN.
      * Inicializacion de Variables
           MOVE 'TVAL'         TO MSC-CIC-TMSC IN MSC.
           MOVE '0'            TO MSC-CIC-CMSC IN MSC.
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
               DISPLAY 'EN MISCELANEO TVAL NO EXISTE CODIGO 0'
               PERFORM GNS-PRO-ABT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-COD-CMSC IN WSS-VARI.

      * Proceso para Cargar las tablas  TAB/TIO  y  COL/TOC  en Memoria
           PERFORM COL-CRG-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
               PERFORM GNS-PRO-ABT.
       FIN-INI-CAN.
           EXIT.

      ******************************************************************

       LUP-PUT-VEN SECTION.
      *--------------------
       INI-LUP-VEN.
      * Programacion de Ciclo para Registro VEN
           MOVE FIO-GET-FST              TO FIO-CMND.
      *
       LUP-BUS-VEN.
           PERFORM COL-FIO-VES.
           IF NOT FIO-STAT-OKS
               GO TO FIN-LUP-PUT-VEN.
           MOVE VES TO VEN.

      * Contador de los registros VEN leidos.
      *
           ADD 1 TO WSS-NUM-RLEI IN WSS-VARI.

           IF VEN-COD-TOPC IN VEN NOT = 'D'
               GO TO OTRO-VEN.
      *
           IF VEN-FEC-FVEN IN VEN < WSS-FEC-FUNO IN WSS-VARI
      *       DISPLAY 'VEN-FEC-FVEN < WSS-FEC-FUNO  '
      *        VEN-FEC-FVEN IN VEN ' ' WSS-FEC-FUNO IN WSS-VARI
               GO TO OTRO-VEN.

      * Si la fecha de vencimiento es mayor que la del parametro, sale.
           IF VEN-FEC-FVEN IN VEN > WSS-FEC-FTER IN WSS-VARI
      *        DISPLAY 'VEN-FEC-FVEN > WSS-FEC-FTER '
      *        VEN-FEC-FVEN IN VEN ' ' WSS-FEC-FTER IN WSS-VARI
               GO TO FIN-LUP-PUT-VEN.

      * Si el vencimiento no esta completo
           IF VEN-IND-CALC IN VEN = 'N'
      *        DISPLAY 'VENCIMIENTO INCOMPLETO : ' VEN-CIC-IOPC IN VEN
               GO TO OTRO-VEN.

      * Si el vencimiento esta cancelado
           IF VEN-VAL-SCAP IN VEN = ZEROS AND
              VEN-VAL-SFIN IN VEN = ZEROS
      *        DISPLAY 'VEN SALDO= 0 : ' VEN-CIC-IOPC IN VEN
      *                              ' '  VEN-NUM-IVCT IN VEN
               GO TO OTRO-VEN.

      *  Credito tenga cargo automatico
           PERFORM BUS-CYA-AUT.
           IF NOT (FIO-STAT-OKS AND
                   VEN-IND-CAUT IN VEN NOT = 'N')
                DISPLAY 'NO C.AUTOMATICO: ' VEN-CIC-IOPC IN VEN
               GO TO OTRO-VEN.
      *
      * Si NO existe la OPC
           MOVE VEN-CIC-IOPC IN VEN TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'OPC    NEX' TO MSG-COD-MENS
               DISPLAY MSG-COD-MENS
               ADD 1 TO WSS-NUM-RERR IN WSS-VARI
               GO TO OTRO-VEN.

      * Si el credito no esta activado
           IF OPC-MSC-STAT IN OPC NOT = 'A'
              DISPLAY 'OPC NO ACTIVA: ' VEN-CIC-IOPC IN VEN
              GO TO OTRO-VEN.

      * Valida que el credito no este cancelado
           IF OPC-VAL-SCRE IN OPC NOT > ZEROES
              DISPLAY 'OPC SALDO = 0 : ' VEN-CIC-IOPC IN VEN
               GO TO OTRO-VEN.
           MOVE OPC-COD-VCOC IN OPC TO SCR-COD-VCOC.
      *
           IF VEN-NUM-IVCT IN VEN NOT = OPC-NUM-IVEN IN OPC
               DISPLAY 'ERROR :  '
                       'OPC-NUM-IVEN <> VEN-NUM-IVCT '
                       ' OPC: ' OPC-CIC-IOPC IN OPC
                       ' VEN: ' VEN-NUM-IVCT IN VEN
               GO TO OTRO-VEN.

      * Busca con el Codigo Tipo Operacion en la Tabla cargada en Memori
      * 'Sistema que lo Maneja'
           MOVE OPC-COD-TOOC IN OPC TO CTO-TOOC IN CTO-VARI.
           PERFORM COL-BUS-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
                       'CON CODIGO : '     CTO-TOOC IN CTO-VARI
                       ' EN CREDITO : '    OPC-CIC-IOPC IN OPC
               GO TO OTRO-VEN.

      * Valida el 'Sistema que lo Maneja' de la Operacion de Credito
           IF CTO-SIST IN CTO-VARI NOT = 'COL'
              DISPLAY 'NO OPERA COL: ' VEN-CIC-IOPC IN VEN
               GO TO OTRO-VEN.
      *
           MOVE CTO-OPEC IN CTO-VARI TO WSS-OPEC.

      * Valida que pertenezca a la oficina
           IF WSS-COD-OFIC IN WSS-VARI > SPACES AND
              WSS-IND-OFIC IN WSS-VARI(1) NOT = '*'
               MOVE 1 TO WSS-I
               PERFORM SEL-OFI-PRMT UNTIL WSS-I > 10 OR
               OPC-COD-OFOC IN OPC = WSS-IND-OFIC IN WSS-VARI(WSS-I)
               IF WSS-I > 10
               DISPLAY 'NO CORRESPONDE OFICINA : ' VEN-CIC-IOPC IN VEN
               GO TO OTRO-VEN.
      *
           DISPLAY 'OPERA COMO : ' WSS-OPEC.
      *
           IF  (VEN-FEC-FVEN IN VEN NOT < WSS-FEC-FPO1 IN WSS-VARI)
           AND (VEN-FEC-FVEN IN VEN NOT > WSS-FEC-FPO2 IN WSS-VARI)
           AND WSS-FEC-FPO1 IN WSS-VARI > ZEROES
             IF WSS-OPEC = 'B'
                  NEXT SENTENCE
             ELSE
                  GO TO OTRO-VEN.

           MOVE 'N'                 TO WSS-IND-OTRO.
           MOVE VEN-KEY-IVEN IN VEN TO WSS-VEN-KEY-IVEN.
           IF VEN-NUM-IVEN IN VEN NOT > 1
               GO TO CON-LUP-PUT-VEN.
      *
      *Comparar con la opc
           SUBTRACT 1 FROM VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF FIO-STAT-OKS AND
              VEN-CIC-IOPC IN VEN = WSS-VEN-CIC-IOPC
               IF VEN-VAL-SFIN IN VEN > ZEROES OR
                  VEN-VAL-SCAP IN VEN > ZEROES
                   MOVE 'S' TO WSS-IND-OTRO
               ELSE
                   MOVE 'N' TO WSS-IND-OTRO
           ELSE
               MOVE 'N' TO WSS-IND-OTRO.
      *
       CON-LUP-PUT-VEN.
           MOVE WSS-VEN-KEY-IVEN TO VEN-KEY-IVEN IN VEN.
           MOVE FIO-GET-KEY      TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF WSS-IND-OTRO = 'S'
      *         DISPLAY 'NO CORR.VEN : ' VEN-CIC-IOPC IN VEN
               GO TO OTRO-VEN.
      *
           IF VEN-FEC-FVEN IN VEN < WSS-FEC-FUNO IN WSS-VARI
               GO TO OTRO-VEN.
      *
           IF VEN-FEC-FVEN IN VEN > WSS-FEC-FTER IN WSS-VARI
               GO TO OTRO-VEN.
      *
           IF VEN-NUM-IVCT IN VEN NOT = OPC-NUM-IVEN IN OPC
               DISPLAY 'ERROR DE INCONSISTENCIA: NO CORRESPONDE EL '
                       'OPC-NUM-IVEN CON EL VENCIMIENTO A CARGAR '
                       'EN CREDITO : '    OPC-CIC-IOPC IN OPC
               GO TO OTRO-VEN.


           PERFORM DET-CLI-CCTE.
           IF MSG-COD-MENS > SPACES
               IF MSG-COD-MENS = 'OTRO-VEN'
                   MOVE SPACES TO MSG-COD-MENS
                   GO TO OTRO-VEN
               ELSE
                   GO TO DIS-MEN-ERR.

           MOVE SPACES              TO WSS-GLS-MEN2.
           MOVE VEN-NUM-IVCT IN VEN TO WSS-NUM-IVCT.
           PERFORM BUS-REG-RCV.
           IF MSG-COD-MENS > SPACES
               GO TO DIS-MEN-ERR.

      *Carga variable de  'COMMAREA' Simula ingreso
      *********************************************
           MOVE LOW-VALUES   TO CAN-FLD.
           MOVE 'ING'        TO SCR-CMND SCR-CCPP.
           MOVE 'CTE'        TO SCR-MSC-CANC.
           MOVE 'M'          TO SCR-STPP.
      *********************************************
      *
           MOVE SPACES      TO MSG-COD-MENS.
           PERFORM FND-KEY.
           DISPLAY 'FND-KEY-STAT   :'   FIO-STAT.
           IF MSG-COD-MENS > SPACES
              DISPLAY OPC-CIC-IOPC IN OPC ':' FRM-MENS
              GO TO OTRO-VEN.
      *
           PERFORM GEN-CTE.
      *
       DIS-MEN-ERR.
           IF MSG-COD-MENS  = SPACES
              ADD 1 TO WSS-NUM-RPRO IN WSS-VARI
              GO TO OTRO-VEN.

           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           DISPLAY MSG-GLS-DESC    WSS-GLS-MEN2.
      *
       OTRO-VEN.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-BUS-VEN.
       FIN-LUP-PUT-VEN.
           EXIT.

      ******************************************************************
       FND-KEY SECTION.
      *----------------
       INI-FND-KEY.
      *COPY COLB1CAN.
       CON-FND-KEY.
           MOVE OPC-COD-VCOC IN OPC TO SCR-COD-VCOC.
           MOVE OPC-CIC-IOPC IN OPC TO CAN-CIC-IOPC IN CAN.
      *
           MOVE WSS-NUM-DPRO IN WSS-VARI TO CAN-NUM-DCAN IN CAN-FLD.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO CAN-NUM-MCAN IN CAN-FLD.
           MOVE WSS-NUM-SPRO IN WSS-VARI TO CAN-NUM-SCAN IN CAN-FLD.
           MOVE WSS-NUM-APRO IN WSS-VARI TO CAN-NUM-ACAN IN CAN-FLD.
      *
           PERFORM BUS-COR-CAN.
      *
           IF MSG-COD-MENS NOT = SPACES
              DISPLAY MSG-COD-MENS
              GO TO VRF-STAT-CANC.
      *
       CON-BUS-KEY-IVEN.
           MOVE OPC-CIC-IOPC IN OPC     TO CAN-CIC-IOPC IN CAN.
           MOVE CAN-NUM-ICAN IN CAN-FLD TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF FIO-STAT-OKS
              MOVE '23'           TO FIO-STAT
              MOVE 'CAN   EXISTE' TO MSG-COD-MENS
              DISPLAY MSG-COD-MENS
              GO TO VRF-STAT-CANC.

       FIN-VRF-RCV.
           PERFORM GET-CUR-ITR.
           IF NOT PGM-STAT-ITR-OKS
               MOVE ZEROES TO ITR-SGV-SPRD IN ITR
               MOVE ZEROES TO ITR-SGV-TINT IN ITR
               MOVE SPACES TO ITR-COD-TINT IN ITR
               MOVE SPACES TO ITR-COD-CVTI IN ITR.

           IF ITR-COD-CVTI IN ITR  NOT > SPACES
              MOVE ITR-SGV-TINT IN ITR TO FRM-SGV-TINT IN CAN-FLD
           ELSE
             MOVE ITR-SGV-SPRD IN ITR TO FRM-SGV-TINT IN CAN-FLD
             IF ( ITR-MSC-TFPR = 'C' AND
                  ITR-SGV-TINT IN ITR > 0  )
                  MOVE ITR-SGV-TINT IN ITR TO SCR-SGV-SPR2
             ELSE
                 MOVE 0  TO SCR-SGV-SPR2.
      *
           IF ITR-COD-TINT IN ITR > SPACES
               MOVE 'COL'               TO TAB-COD-SIST
               MOVE 'INT'               TO TAB-COD-TTAB IN TAB
               MOVE ITR-COD-TINT IN ITR TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-IITR IN CAN-FLD.
      *
      *TIPO DE TASA
           IF ITR-COD-CVTI > SPACES
              MOVE 'COL'          TO TAB-COD-SIST
              MOVE 'INT'          TO TAB-CIC-TTAB IN TAB
              MOVE 'CAN'          TO TAB-CIC-CTAB IN TAB
              MOVE 'TAB-CIC-TABL' TO FIO-AKEY
              PERFORM BUS-TAB
              MOVE TAB-COD-CTAB IN TAB TO SCR-COD-TICG
            ELSE
              MOVE ITR-COD-TINT IN ITR TO SCR-COD-TICG.
       NXT-FND-KEY.
      ********************************************************
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           MOVE FIO-STAT TO PGM-STAT-CAN.
      ********************************************************
      *COPY COLB2CAN.
           IF PGM-STAT-CAN-OKS
              MOVE '23'           TO FIO-STAT
              MOVE 'CAN   EXISTE' TO MSG-COD-MENS
              DISPLAY MSG-COD-MENS
              GO TO VRF-STAT-CANC.

       FND-RST-STAT.
           MOVE PGM-STAT-CAN TO FIO-STAT.
           MOVE SPACES       TO MSG-COD-MENS.

           IF ( SCR-CCPP = 'ING'  )
              IF PGM-STAT-CAN-OKS
                 IF CAN-MSC-STAT IN CAN = 'A'
                     MOVE 'CAN    ACAYA' TO MSG-COD-MENS
                 ELSE
                 IF CAN-MSC-STAT IN CAN = 'E'
                     MOVE 'CAN    ACAOB' TO MSG-COD-MENS
                 ELSE
                 IF NOT ( CAN-MSC-STAT IN CAN = 'I' OR 'M' OR 'V' )
                     MOVE 'CAN    STTNN' TO MSG-COD-MENS.
       VRF-STAT-CANC.
       FIN-FND-KEY.
           EXIT.

      ********************************************************
       BUS-REG-DLC SECTION.
       INI-BUS-REG-DLC.
      *
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE VEN-NUM-IDLC IN VEN TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF  NOT FIO-STAT-OKS
               MOVE 'DLC    NEX'    TO MSG-COD-MENS.
       FIN-BUS-REG-DLC.
           EXIT.
       MOVER-DATOS-CAN SECTION.
       INI-MOVER-DATOS-CAN.
      *REG-ICG.
           MOVE ZEROES TO ICG-FEC-FINI IN ICG.
           MOVE ZEROES TO ICG-FEC-FTER IN ICG.
           MOVE SPACES TO ICG-GLS-DISP IN ICG.
           MOVE ZEROES TO ICG-NUM-PREP IN ICG.
           MOVE ZEROES TO ICG-SGV-SPRD IN ICG.
           MOVE ZEROES TO ICG-SGV-TINT IN ICG.
           MOVE ZEROES TO ICG-SGV-MNTO IN ICG.
      *Reg-cya.
           MOVE SPACES TO CYA-GLS-DISP IN CYA.
           MOVE SPACES TO CYA-GLS-FLAG IN CYA.
           MOVE SPACES TO CYA-IND-INTE IN CYA.
           MOVE SPACES TO CYA-COD-OFIC IN CYA.
           MOVE SPACES TO CYA-IND-FREE IN CYA.
           MOVE SPACES TO CYA-VRF-ICYA IN CYA.
           MOVE ZEROES TO CYA-SGV-LIQU IN CYA.
      *Reg-rcv.
           MOVE SPACES TO RCV-KEY-IDLC IN RCV.
           MOVE ZEROES TO RCV-NUM-IEVC IN RCV.
           MOVE SPACES TO RCV-MSC-MCAN IN RCV.
           MOVE SPACES TO RCV-IND-SCTB IN RCV.
           MOVE ZEROES TO RCV-FEC-FCAN IN RCV.
           MOVE ZEROES TO RCV-FEC-FOUT IN RCV.
           MOVE ZEROES TO RCV-SGV-CAPI IN RCV.
           MOVE ZEROES TO RCV-SGV-INTE IN RCV.
           MOVE ZEROES TO RCV-SGV-FINA IN RCV.
           MOVE ZEROES TO RCV-SGV-REAJ IN RCV.
           MOVE ZEROES TO RCV-SGV-INTN IN RCV.
           MOVE ZEROES TO RCV-SGV-INTM IN RCV.
           MOVE SPACES TO RCV-GLS-DISP IN RCV.
      *
           PERFORM GET-FHOY.
      *Fecha,hora,usuario,autor transaccion
           MOVE HOY-DHOY IN HOY-VARI     TO CAN-NUM-DTRN IN CAN.
           MOVE HOY-MHOY IN HOY-VARI     TO CAN-NUM-MTRN IN CAN.
           MOVE HOY-AHOY IN HOY-VARI     TO CAN-NUM-ATRN IN CAN.
           MOVE HOY-SHOY IN HOY-VARI     TO CAN-NUM-STRN IN CAN.
           MOVE HOY-HHOY IN HOY-VARI     TO CAN-HRA-HRTR IN CAN.
           MOVE SCR-USER                 TO CAN-COD-ATRN IN CAN.
      *
           MOVE ZEROES                   TO CAN-SGV-GAST IN CAN.
           MOVE ZEROES                   TO CAN-SGV-TPAG IN CAN.
           MOVE ZEROES                   TO CAN-SGV-TREN IN CAN.
           MOVE ZEROES                   TO CAN-SGV-DIFE IN CAN.
           MOVE ZEROES                   TO CAN-SGV-IMOK IN CAN.
      *
           MOVE OPC-CIC-IOPC IN OPC      TO CAN-CIC-IOPC IN CAN.
           MOVE OPC-COD-RMOC IN OPC      TO CAN-COD-RCAN IN CAN.
           MOVE OPC-COD-OFOC IN OPC      TO CAN-COD-OFCA IN CAN.
      *
           MOVE CAN-NUM-ICAN IN CAN-FLD  TO CAN-NUM-ICAN IN CAN.
           MOVE    1                     TO CAN-NUM-TVCC IN CAN.
           MOVE 'CTE'                    TO CAN-MSC-CANC IN CAN.
           MOVE 'G'                      TO CAN-MSC-STAT IN CAN.
           MOVE 'COLPGCA1'               TO CAN-COD-ATRN IN CAN.
      *
           MOVE WSS-NUM-DPRO IN WSS-VARI TO CAN-NUM-DCAN IN CAN.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO CAN-NUM-MCAN IN CAN.
           MOVE WSS-NUM-SPRO IN WSS-VARI TO CAN-NUM-SCAN IN CAN.
           MOVE WSS-NUM-APRO IN WSS-VARI TO CAN-NUM-ACAN IN CAN.
      *Ctbl.
           MOVE WSS-NUM-DPRO IN WSS-VARI TO CAN-NUM-DEGR IN CAN.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO CAN-NUM-MEGR IN CAN.
           MOVE WSS-NUM-SPRO IN WSS-VARI TO CAN-NUM-SEGR IN CAN.
           MOVE WSS-NUM-APRO IN WSS-VARI TO CAN-NUM-AEGR IN CAN.
      *
           MOVE HOY-DHOY IN HOY-VARI     TO CAN-NUM-DOUT IN CAN.
           MOVE HOY-MHOY IN HOY-VARI     TO CAN-NUM-MOUT IN CAN.
           MOVE HOY-SHOY IN HOY-VARI     TO CAN-NUM-SOUT IN CAN.
           MOVE HOY-AHOY IN HOY-VARI     TO CAN-NUM-AOUT IN CAN.
      *
           MOVE WSS-NUM-DMIN IN WSS-VARI TO WSS-NUM-DCTB IN WSS-VARI.
           MOVE WSS-NUM-MMIN IN WSS-VARI TO WSS-NUM-MCTB IN WSS-VARI.
           MOVE WSS-NUM-SMIN IN WSS-VARI TO WSS-NUM-SCTB IN WSS-VARI.
           MOVE WSS-NUM-AMIN IN WSS-VARI TO WSS-NUM-ACTB IN WSS-VARI.
      *
       FIN-MOVER-DATOS-CAN.
           EXIT.
      *
       MOVER-DATOS-CYA SECTION.
       INI-MOVER-DATOS-CYA.
      *
           MOVE SPACES TO CYA-IND-INTE IN CYA.
           IF VEN-VAL-SCAP IN VEN = ZERO
              MOVE 'I'  TO CYA-IND-INTE IN CYA.
      *
           MOVE OPC-CIC-IOPC IN OPC     TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN-FLD TO CYA-NUM-ICAN IN CYA.
           MOVE 1                       TO CYA-NUM-ICYA IN CYA.
      *
      *Fecha,hora,usuario,autor transaccion
           MOVE ZEROES                  TO CYA-NUM-DTRN IN CYA.
           MOVE ZEROES                  TO CYA-NUM-MTRN IN CYA.
           MOVE ZEROES                  TO CYA-NUM-ATRN IN CYA.
           MOVE ZEROES                  TO CYA-NUM-STRN IN CYA.
           MOVE ZEROES                  TO CYA-HRA-HRTR IN CYA.
           MOVE SPACES                  TO CYA-COD-ATRN IN CYA.
      *
           MOVE CAN-SGV-TPAG IN CAN     TO CYA-SGV-LIQU IN CYA.
      *
           MOVE WSS-MSC-CCAA IN WSS-VARI TO CYA-IND-TCYA IN CYA.
           MOVE SPACES                   TO CYA-IND-MAUT IN CYA.
           MOVE AUT-CAI-ICYA IN AUT      TO CYA-CAI-ICYA IN CYA.
           MOVE AUT-IIC-ICYA IN AUT      TO CYA-IIC-ICYA IN CYA.
      *
           IF CYA-IND-TCYA IN CYA > SPACES
               MOVE 'TAB'               TO MSC-COD-SIST
               MOVE 'TCYA'              TO MSC-COD-TMSC IN MSC
               MOVE CYA-IND-TCYA IN CYA TO MSC-COD-CMSC IN MSC
               PERFORM BUS-MSC
               MOVE MSC-COD-DAT1(2) TO CYA-IND-MAUT IN CYA.
       FIN-MOVER-DATOS-CYA.
           EXIT.
      *
       MOVER-DATOS-RCV SECTION.
       INI-MOVER-DATOS-RCV.
      *
           PERFORM GET-FHOY.
      *Fecha,hora,usuario,autor transaccion
           MOVE ZEROES                   TO RCV-NUM-DTRN IN RCV.
           MOVE ZEROES                   TO RCV-NUM-MTRN IN RCV.
           MOVE ZEROES                   TO RCV-NUM-ATRN IN RCV.
           MOVE ZEROES                   TO RCV-NUM-STRN IN RCV.
           MOVE ZEROES                   TO RCV-HRA-HRTR IN RCV.
           MOVE SPACES                   TO RCV-COD-ATRN IN RCV.
      *
           MOVE SPACES                   TO RCV-MSC-TACC IN RCV.
           MOVE SPACES                   TO RCV-MSC-STAT IN RCV.
      *
           MOVE SPACES                   TO RCV-COD-ATRN IN RCV.
      *
           MOVE WSS-MSC-MCAN IN WSS-VARI TO RCV-MSC-MCAN IN RCV.
           MOVE OPC-CIC-IOPC IN OPC      TO RCV-CIC-IOPC IN RCV.
           MOVE OPC-CIC-IOPC IN OPC      TO RCV-CIC-IOPV IN RCV.
      *
           MOVE CAN-NUM-ICAN IN CAN-FLD  TO RCV-NUM-ICAN IN RCV.
           MOVE ZEROES                   TO RCV-FEC-FCAN IN RCV.
           MOVE ZEROES                   TO RCV-FEC-FOUT IN RCV.
      *
           PERFORM BUS-REG-DLC.
           MOVE DLC-CIC-IOPC IN DLC      TO RCV-CIC-IOPD IN RCV.
      *
           MOVE VEN-NUM-IVCT IN VEN      TO RCV-NUM-IVCT IN RCV.
           MOVE VEN-NUM-IDLC IN VEN      TO RCV-NUM-IDLC IN RCV.
      *
           MOVE VEN-IND-SCTB IN VEN      TO RCV-IND-SCTB IN RCV.
           MOVE VEN-IND-SCBZ IN VEN      TO RCV-IND-SCBZ IN RCV.
           MOVE VEN-VAL-IDNI IN VEN      TO RCV-SGV-INTE IN RCV.
      *
           MOVE VEN-VAL-SCAP IN VEN      TO RCV-SGV-CAPI IN RCV.
           MOVE VEN-VAL-SFIN IN VEN      TO RCV-SGV-FINA IN RCV.
       FIN-MOVER-DATOS-RCV.
           EXIT.
      ******************************************************************
       GEN-CTE SECTION.
      *----------------
       INI-GEN-CTE.
           MOVE SPACES TO WSS-CMSG.
           MOVE 'S'    TO WSS-IBLK-TINT.
           MOVE 'S'    TO WSS-IBLK-TPAG.
      *RET-CYA-CAN
           MOVE WSS-MSC-CCAA IN WSS-VARI TO CYA-IND-TCYA IN CYA.
           MOVE AUT-CAI-ICYA IN AUT      TO CYA-CAI-ICYA IN CYA.
           MOVE AUT-IIC-ICYA IN AUT      TO CYA-IIC-ICYA IN CYA.
      *
           MOVE SPACES       TO WSS-CIC-VCAM.
           MOVE 'TAB'        TO TAB-COD-SIST.
           MOVE 'VLR'        TO TAB-COD-TTAB IN TAB.
           MOVE SCR-COD-VCOC TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB
           IF MSG-COD-MENS NOT > SPACES
               MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-VCAM.

           IF FRM-SUAR = FRM-SUAR-MAL
               MOVE 'ERROR' TO WSS-CMSG
               DISPLAY OPC-CIC-IOPC IN OPC ':' FRM-MENS
               GO TO FIN-GEN-CTE.
      *
      *Graba entidades relacionadas a l a cancelacion
           MOVE SPACES    TO  WSS-CMSG.
           PERFORM CMN-ING.
       FIN-GEN-CTE.
           EXIT.
      *
      ******************************************************************
       CMN-ING SECTION.
      *----------------
       INI-CMN-ING.
      *<<<< CMN_ING
           PERFORM MOVER-DATOS-CAN.
      *
           PERFORM VAL-CON-FLD-CAN.
           IF MSG-COD-MENS > SPACES
              DISPLAY MSG-COD-MENS ' '
                      CAN-CIC-IOPC IN CAN
              GO TO FIN-CMN-ING.

           IF CAN-SGV-TPAG IN CAN < ZEROES
              MOVE 'SGV-TPAG < 0'      TO MSG-COD-MENS
              DISPLAY MSG-COD-MENS ' '
                      CAN-CIC-IOPC IN CAN
              GO TO FIN-CMN-ING.
      *
           IF WSS-CIC-TVAL = '0'
              MOVE CAN-SGV-TPAG IN CAN TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO CAN-SGV-TPAG IN CAN.
      *
      *Cancelacion no verificada
           MOVE 'I'    TO WSS-MSG-FENT.
           MOVE 'I'    TO CAN-MSC-STAT IN CAN.
      *
           PERFORM VRF-ACT-CYA.
           IF NOT PGM-STAT-CYA-OKS
              DISPLAY 'ERROR GENERAR CYA : '
                       CYA-CIC-IOPC IN CYA
              PERFORM BCK-OUT
              GO TO FIN-CMN-ING.
      *
           PERFORM CHK-PNR-BGT.
      *
           MOVE 'G'     TO CAN-MSC-STAT IN CAN.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
              PERFORM BCK-OUT
              DISPLAY 'ERROR INCONSIS.INGRESO : INFORMAR '
                       CAN-KEY-ICAN IN CAN
              GO TO FIN-CMN-ING.
      *
           PERFORM ACT-ICG.
           IF MSG-COD-MENS NOT = SPACES
              DISPLAY 'ACT-ICG '  MSG-COD-MENS
              PERFORM BCK-OUT
              GO TO FIN-CMN-ING.

           PERFORM ACT-RCV.
           IF MSG-COD-MENS NOT = SPACES
              DISPLAY 'ACT-RCV '  MSG-COD-MENS
              PERFORM BCK-OUT
              GO TO FIN-CMN-ING.
      *
      *Se ingresaron tadas las entidades relacionadas al Vencimiento.
      ***************************
           PERFORM CHK-PNT.
           ADD 1 TO WSS-NUM-PLEI IN WSS-VARI.
      ***************************
       FIN-CMN-ING.
           EXIT.

      ******************************************************************
       VRF-ACT-CYA SECTION.
      *--------------------
       INI-VRF-ACT-CYA.
           MOVE '00'         TO PGM-STAT-CYA.
           MOVE SCR-MSC-TCAN TO WSS-MSG-TENT.
           MOVE 'N'          TO WSS-MSG-SENT.
      *
       ACT-CYA.
           MOVE OPC-CIC-IOPC IN OPC     TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN-FLD TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES                  TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = CYA-CIC-IOPC IN CYA AND
                    CAN-NUM-ICAN IN CAN-FLD = CYA-NUM-ICAN IN CYA )
      *
              IF CAN-SGV-TPAG IN CAN > ZEROES
                 PERFORM MOVER-DATOS-CYA
                 MOVE FIO-PUT TO FIO-CMND
                 PERFORM COL-FIO-CYA.
      *
       FIN-ACT-CYA.
           IF NOT PGM-STAT-CYA-OKS
              MOVE FIO-STAT TO PGM-STAT-CYA
              GO TO FIN-VRF-ACT-CYA.

           MOVE 'V' TO CAN-MSC-STAT IN CAN.
           MOVE 'V' TO WSS-MSG-SENT.
      *
       MSG-VRF-ACT-CYA.
           IF CAN-MSC-STAT IN CAN  NOT = 'V'
              DISPLAY 'CAN SIN VERIFICAR NO SE GENERA '
              DISPLAY 'OPERACION    ' OPC-CIC-IOPC IN OPC
              DISPLAY 'CAN-MSC-STAT ' CAN-MSC-STAT IN CAN.
       FIN-VRF-ACT-CYA.
           EXIT.
      ******************************************************************
       CHK-PNR-BGT SECTION.
      *--------------------
       INI-CHK-PNR-BGT.
      *Prorroga,Novacion,Renovacion Boleta de garantia
           IF NOT ( ( CAN-MSC-TCAN = 'N' OR 'R' OR 'P' ) AND
              ( WSS-OPEC = 'B' ) )
               GO TO FIN-CHK-PNR-BGT.
      *
      *Busca cic de moneda para saber si transforma a $
           MOVE 'TAB'               TO TAB-COD-SIST FIO-SIST.
           MOVE 'VLR'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'CODTVLRNEX' TO MSG-COD-MENS
               GO TO FIN-CHK-PNR-BGT.
      *
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-VCAM.
      *
      *convierte a pesos
           IF NOT ( WSS-CIC-TVAL     = '0' AND
                    WSS-CIC-VCAM NOT = '0999' )
               MOVE VEN-VAL-CAPI IN VEN TO WSS-VAL-SVEN
               GO TO SUM-CHK-PNR-BGT.

           MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE '0999  '            TO TAB-CIC-CTAB IN TAB.
           MOVE CAN-FEC-FCAN IN CAN TO TAB-FEC-FTRN IN TAB.
      *
           PERFORM GET-VCAM.
           IF MSG-COD-MENS = SPACES
               MULTIPLY  VEN-VAL-CAPI IN VEN
                     BY  CAM-SGV-VCAM IN CAM
                 GIVING  WSS-VAL-SVEN ROUNDED
           ELSE
               GO TO FIN-CHK-PNR-BGT.
      *
           MOVE WSS-VAL-SVEN TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-SVEN.
       SUM-CHK-PNR-BGT.
           ADD WSS-VAL-SVEN TO CAN-SGV-TREN IN CAN.
       FIN-CHK-PNR-BGT.
           EXIT.
      ******************************************************************
       VAL-CYA-IND-TCYA SECTION.
       INI-VAL-CYA-IND-TCYA.
      * NO OBLIGATORIO
           IF CYA-IND-TCYA IN CYA NOT > SPACES
               MOVE SPACES TO CYA-IND-TCYA IN CYA
               GO TO FIN-VAL-CYA-IND-TCYA.
      *
           MOVE 'TAB'                   TO MSC-COD-SIST.
           MOVE 'TCYA'                  TO MSC-COD-TMSC IN MSC.
           MOVE CYA-IND-TCYA IN CYA     TO MSC-COD-CMSC IN MSC.
           PERFORM VAL-IND.
           IF MSG-COD-MENS NOT = SPACES
               GO TO FIN-VAL-CYA-IND-TCYA.
      *
       FIN-VAL-CYA-IND-TCYA.
           EXIT.

       VAL-CON-FLD-CAN SECTION.
       INI-VAL-CON-FLD-CAN.
           MOVE ZEROES TO WSS-SGV-RAFV IN WSS-VARI.
           MOVE ZEROES TO WSS-AUX-CAPI IN WSS-VARI.
           MOVE SPACES TO MSG-COD-MENS.
      *
           MOVE ZEROES TO SCR-SGV-INTN.
           MOVE ZEROES TO SCR-SGV-INTM.
           MOVE ZEROES TO SCR-SGV-INT.
           MOVE ZEROES TO WSS-AUX-INTN
                          WSS-AUX-INTM
                          WSS-AUX-INMO
                          WSS-AUX-IMMO
                          SCR-SGV-INMO
                          SCR-SGV-IMMO.
      *
       CONT-SIN-COBR.
      * Resta los Gastos
           MOVE ZEROES TO CAN-SGV-TREN IN CAN.
           MOVE ZEROES TO CAN-SGV-DIFE IN CAN.
           MOVE ZEROES TO WSS-SGV-TINT IN WSS-VARI.
           MOVE SPACES TO WSS-MSC-MCAN IN WSS-VARI.
      *
           IF CAN-SGV-TPAG IN CAN NOT > ZEROES
              MOVE ZEROES TO CAN-SGV-TPAG IN CAN.
      *
      *Traspasa Monto a $ (SCAP,SFIN)
           PERFORM GET-SLD.
           IF FRM-SUAR = FRM-SUAR-MAL
               GO TO END-VAL-CON-FLD-CAN.
      *
           IF CAN-FEC-FCAN IN CAN   < VEN-FEC-FVEN IN VEN
               MOVE 'A' TO WSS-MSC-MCAN IN WSS-VARI
           ELSE
           IF CAN-FEC-FCAN IN CAN > VEN-FEC-FVEN IN VEN
               MOVE 'V' TO WSS-MSC-MCAN IN WSS-VARI
           ELSE
               MOVE 'F' TO WSS-MSC-MCAN IN WSS-VARI.
      *
           MOVE 'COL'               TO TAB-COD-SIST.
           MOVE 'INT'               TO TAB-COD-TTAB IN TAB.
           MOVE ITR-COD-TINT IN ITR TO TAB-COD-CTAB IN TAB.
           MOVE ITR-COD-TINT IN ITR TO SCR-COD-TICG.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-TINT IN CAN-FLD.
           MOVE FRM-SUAR-OKS        TO FRM-SUAR.
      *
           IF CAN-FEC-FCAN IN CAN < VEN-FEC-FVEN IN VEN
              IF WSS-IBLK-TINT = 'S'
                  MOVE ZEROES TO WSS-SGV-TINT IN WSS-VARI.
      *
           IF CAN-FEC-FCAN IN CAN = VEN-FEC-FVEN IN VEN AND
              ( SCR-MSC-ECAN  NOT = 'T'  OR
                OPC-NUM-VCOR IN OPC = 1 )
                MOVE ZEROES TO WSS-SGV-TINT IN WSS-VARI.
      *
      *
           MOVE ZEROES              TO SCR-SGV-IPFC.
           MOVE OPC-VAL-SCRE IN OPC TO WSS-VAL-SCRE IN WSS-VARI.
      *
      *Cancelacion CTE.
           PERFORM PRO-TCAN-CTE.
           IF FRM-SUAR = FRM-SUAR-MAL
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               GO TO END-VAL-CON-FLD-CAN.

      *Convierte a Pesos el Interes Pagado a FCAN
           MULTIPLY  SCR-SGV-IPFC  BY  SCR-SGV-VCAM
             GIVING  SCR-SGV-IPFC  ROUNDED.
      *
           IF WSS-CIC-TVAL = '0'
               MOVE SCR-SGV-IPFC TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO SCR-SGV-IPFC.
      *
       CON-VLD-FLD-SEC.
           IF FRM-SUAR = FRM-SUAR-MAL
               GO TO END-VAL-CON-FLD-CAN.
      *
           IF CAN-SGV-TPAG IN CAN NOT > ZEROES
              IF SCR-MSC-ECAN = 'E'
                 MOVE WSS-VAL-SVEN TO CAN-SGV-TPAG IN CAN.

      *'CTT' O 'CTE' Con Valor > zero
      * Pago  Cantidad, Posible Diferencia
           MOVE CAN-SGV-TPAG IN CAN TO WSS-SGV-TPAG.
           IF WSS-SGV-TPAG < ZEROES
              SUBTRACT WSS-SGV-TPAG   FROM  0
                GIVING WSS-SGV-TPAG.
      *
           SUBTRACT   WSS-VAL-SVEN    FROM   WSS-SGV-TPAG
             GIVING   CAN-SGV-DIFE IN CAN.

           IF ( CAN-SGV-DIFE IN CAN NOT = ZEROS ) AND
              ( SCR-CMND NOT = 'IVP' )   AND
              ( SCR-CMND NOT = 'MVP' )
               MOVE 'NODEBEIRTPAG' TO MSG-COD-MENS
               DISPLAY MSG-COD-MENS
               GO TO END-VAL-CON-FLD-CAN.

           IF WSS-VAL-SVEN < WSS-VAL-SCAP AND
              WSS-OPEC NOT = 'B'
               IF NOT ( SCR-CMND = 'IVP' OR SCR-CMND = 'MVP' )
                   MOVE 'CANTIPEDESC>' TO MSG-COD-MENS
                   DISPLAY MSG-COD-MENS
                   GO TO END-VAL-CON-FLD-CAN
               ELSE
                   IF ( SCR-MSC-TCAN = 'C' ) AND
                      ( SCR-MSC-FCAN = 'T' ) AND
                      ( SCR-MSC-ECAN = 'T' OR 'E' )
                       SUBTRACT WSS-VAL-SVEN FROM WSS-VAL-SCAP
                         GIVING CAN-SGV-DIFE IN CAN.
      *
      * Despues del Manejo de Valor Pagado
           IF CAN-SGV-TPAG IN CAN > ZEROES OR
              ( CAN-SGV-TPAG IN CAN = ZEROES AND
                WSS-IBLK-TPAG = 'N' )
      *
              IF CYA-IND-TCYA IN CYA NOT > SPACES
                   MOVE 'INDTCYAOBL' TO MSG-COD-MENS
                   DISPLAY MSG-COD-MENS
                   GO TO END-VAL-CON-FLD-CAN
               ELSE
                 MOVE 'TAB'               TO MSC-COD-SIST
                 MOVE 'TCYA'              TO MSC-COD-TMSC IN MSC
                 MOVE CYA-IND-TCYA IN CYA TO MSC-COD-CMSC IN MSC
                 PERFORM BUS-MSC
                 IF MSC-CIC-CMSC IN MSC = 'CAJA' AND
                    CAN-FEC-FOUT IN CAN NOT = CAN-FEC-FCAN IN CAN
                    MOVE 'CANOUTCANCJI' TO MSG-COD-MENS
                    GO TO END-VAL-CON-FLD-CAN
                 ELSE
                   IF MSC-CIC-CMSC IN MSC = 'CC' AND
                      ( SCR-MSC-TCAN = 'R' OR 'N' OR 'P' )
                       MOVE 'OPCPRGACCTNO' TO MSG-COD-MENS
                       DISPLAY MSG-COD-MENS
                       GO TO END-VAL-CON-FLD-CAN
                   ELSE
                       NEXT SENTENCE
           ELSE
               IF CYA-IND-TCYA IN CYA > SPACES
                 MOVE 'INDTCYABLK' TO MSG-COD-MENS
                 DISPLAY MSG-COD-MENS
                 GO TO END-VAL-CON-FLD-CAN.

           IF ( CYA-IND-TCYA IN CYA NOT > SPACES AND
                 ( CYA-CAI-ICYA IN CYA  > SPACES OR
                   CYA-IIC-ICYA IN CYA  > ZEROES ) )

                   MOVE 'INDTCYAICYA' TO MSG-COD-MENS
                   DISPLAY MSG-COD-MENS
                   GO TO END-VAL-CON-FLD-CAN.

           IF CYA-IND-TCYA IN CYA NOT > SPACES
               GO TO FIN-VAL-ICYA.

           IF WSS-GLS-DAT1 NOT > SPACES
               GO TO FIN-VAL-ICYA.

           IF CYA-IIC-ICYA IN CYA NOT > ZEROES
               MOVE 'IICICYACCOBL' TO MSG-COD-MENS
               DISPLAY MSG-COD-MENS
               GO TO END-VAL-CON-FLD-CAN.
      *
           PERFORM GET-CLI-OPC.
           MOVE RDC-CIC-ICLI IN RDC TO RCO-CIC-ICLI IN RCO.
           MOVE CYA-CAI-ICYA IN CYA TO RCO-CAI-IOPE IN RCO.
           MOVE CYA-IIC-ICYA IN CYA TO RCO-IIC-IOPE IN RCO.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF FIO-STAT-OKS
               IF RCO-COD-STAT IN RCO = 'ELI'
                   MOVE 'COL'          TO MSG-COD-SIST
                   MOVE 'CICICYACNVIG' TO MSG-COD-MENS
                   DISPLAY MSG-COD-MENS
                   GO TO END-VAL-CON-FLD-CAN
               ELSE
               IF WSS-GLS-DAT1 = 'O'
                   MOVE 'CICICYACSCLI' TO MSG-COD-MENS
                   DISPLAY MSG-COD-MENS
                   GO TO END-VAL-CON-FLD-CAN
               ELSE
                   GO TO CER-VAL-CYA-CAI-ICYA.
      *
           MOVE 'RCO-KEY-IOPE' TO FIO-AKEY.
           MOVE CYA-CAI-ICYA IN CAN-FLD TO RCO-CAI-IOPE IN RCO.
           MOVE CYA-IIC-ICYA IN CAN-FLD TO RCO-IIC-IOPE IN RCO.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CICICYACCNEX' TO MSG-COD-MENS
               DISPLAY MSG-COD-MENS
               GO TO END-VAL-CON-FLD-CAN
           ELSE
               IF RCO-COD-STAT IN RCO = 'ELI'
                   MOVE 'CICICYACNVIG' TO MSG-COD-MENS
                   DISPLAY MSG-COD-MENS
                   GO TO END-VAL-CON-FLD-CAN
               ELSE
               IF WSS-GLS-DAT1 = 'M'
                   MOVE 'CICICYACNCLI' TO MSG-COD-MENS
                   DISPLAY MSG-COD-MENS
                   GO TO END-VAL-CON-FLD-CAN.
      *
       CER-VAL-CYA-CAI-ICYA.
           MOVE RCO-CIC-IOPE IN RCO TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF OPE-FEC-FTOP IN OPE > ZEROES
               IF OPE-FEC-FTOP IN OPE > OPE-FEC-FROP IN OPE
                   MOVE 'FECFTOPICYA>' TO MSG-COD-MENS
                   DISPLAY MSG-COD-MENS
                   GO TO END-VAL-CON-FLD-CAN.
       FIN-VAL-ICYA.
       END-VAL-CON-FLD-CAN.
      * Suma Los Gastos
           ADD CAN-SGV-GAST IN CAN   TO   CAN-SGV-TPAG IN CAN.

      *Para Moneda Nacional siempre muestra valor renovado.
           IF WSS-CIC-TVAL = '0'
             MOVE CAN-SGV-DIFE IN CAN TO PES-SGV-DECI IN PES-VARI
             PERFORM PES-SCTV
             MOVE PES-SGV-ENTE IN PES-VARI TO CAN-SGV-DIFE IN CAN

             MOVE CAN-SGV-TPAG IN CAN TO PES-SGV-DECI IN PES-VARI
             PERFORM PES-SCTV
             MOVE PES-SGV-ENTE IN PES-VARI TO CAN-SGV-TPAG IN CAN

             MOVE CAN-SGV-TREN IN CAN TO PES-SGV-DECI IN PES-VARI
             PERFORM PES-SCTV
             MOVE PES-SGV-ENTE IN PES-VARI TO CAN-SGV-TREN IN CAN.
      *
           IF FRM-GLS-IITR IN CAN-FLD NOT =
                              FRM-GLS-TINT IN CAN-FLD AND
              FRM-SUAR = FRM-SUAR-MAL
                  MOVE SPACES   TO FRM-IND-TIPE IN CAN-FLD
                  MOVE SPACES   TO WSS-IBLK-TINT.

      *VALIDA EXISTENCIA DE INF.EN CAMPOS INFORMADOS CON PERDIDA
           IF NOT ( MSG-COD-MENS > SPACES OR
                    FRM-SUAR = FRM-SUAR-MAL )
                    IF MSG-COD-MENS > SPACES
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE FRM-SUAR-MAL TO FRM-SUAR.
       FIN-VAL-CON-FLD-CAN.
           EXIT.

      *
       GET-SLD SECTION.
       INI-GET-SLD.
           MOVE FRM-SUAR-OKS        TO FRM-SUAR.
           MOVE VEN-VAL-SCAP IN VEN TO WSS-VAL-SCAP.
           MOVE VEN-VAL-SFIN IN VEN TO WSS-VAL-SVEN.
           MOVE VEN-VAL-SFIN IN VEN TO WSS-VAL-SMON.
      *
           MOVE VEN-VAL-SCAP IN VEN TO RCV-SGV-CAPI IN RCV.
           MOVE VEN-VAL-SFIN IN VEN TO RCV-SGV-FINA IN RCV.

      *VAL-COD Valida codigo de tabla
           MOVE 'TAB'        TO TAB-COD-SIST.
           MOVE 'VLR'        TO TAB-COD-TTAB IN TAB.
           MOVE SCR-COD-VCOC TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF FRM-SUAR = FRM-SUAR-MAL
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE 'CODTVLRNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-GET-SLD.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-VCAM.

      *CONVIERTE A PESOS
           MOVE 1 TO SCR-SGV-VCAM.
           IF NOT ( WSS-CIC-TVAL = '0' AND
                    WSS-CIC-VCAM NOT = '0999' )
               GO TO VRF-MON-NAC.

           MOVE '0999  '            TO TAB-CIC-CTAB IN TAB.
           MOVE SCR-COD-VCOC        TO TAB-COD-CTAB IN TAB.
           MOVE CAN-NUM-DCAN IN CAN TO TAB-NUM-DTRN IN TAB.
           MOVE CAN-NUM-MCAN IN CAN TO TAB-NUM-MTRN IN TAB.
           MOVE CAN-NUM-SCAN IN CAN TO TAB-NUM-STRN IN TAB.
           MOVE CAN-NUM-ACAN IN CAN TO TAB-NUM-ATRN IN TAB.
           PERFORM GET-VCAM.
           IF MSG-COD-MENS NOT = SPACES
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE 'TAB' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-GET-SLD.
      *
           MOVE CAM-SGV-VCAM IN CAM TO SCR-SGV-VCAM
      *
           MULTIPLY  WSS-VAL-SVEN BY SCR-SGV-VCAM
             GIVING  WSS-VAL-SVEN ROUNDED.

           MULTIPLY  WSS-VAL-SCAP BY SCR-SGV-VCAM
             GIVING  WSS-VAL-SCAP ROUNDED.
      *
       VRF-MON-NAC.
           IF WSS-CIC-TVAL = '0'
               MOVE WSS-VAL-SVEN TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-SVEN
               MOVE WSS-VAL-SCAP TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-SCAP.
       FIN-GET-SLD.
           EXIT.

       PRO-TCAN-CTE SECTION.
       INI-PRO-TCAN-CTE.
           IF WSS-OPEC NOT = 'D'
              GO TO NXT-PRO-TCAN-CTE.
      *
           PERFORM CAL-NUM-DHBL
           IF CAN-FEC-FCAN IN CAN > WSS-FEC-FTOP IN WSS-VARI
      * fecha FPAS solo es usada para no perder la FVEN inicial.
              MOVE VEN-NUM-DVEN IN VEN TO WSS-NUM-DPAS IN WSS-VARI
              MOVE VEN-NUM-MVEN IN VEN TO WSS-NUM-MPAS IN WSS-VARI
              MOVE VEN-NUM-SVEN IN VEN TO WSS-NUM-SPAS IN WSS-VARI
              MOVE VEN-NUM-AVEN IN VEN TO WSS-NUM-APAS IN WSS-VARI
      *
      * Muevo la fecha FIMV a la FVEN para que procese en forma normal.
              MOVE VEN-NUM-DIMV IN VEN TO VEN-NUM-DVEN IN VEN
              MOVE VEN-NUM-MIMV IN VEN TO VEN-NUM-MVEN IN VEN
              MOVE VEN-NUM-SIMV IN VEN TO VEN-NUM-SVEN IN VEN
              MOVE VEN-NUM-AIMV IN VEN TO VEN-NUM-AVEN IN VEN
              PERFORM PRO-MORA-CTE
      *
              MOVE WSS-NUM-DPAS IN WSS-VARI TO VEN-NUM-DVEN IN VEN
              MOVE WSS-NUM-MPAS IN WSS-VARI TO VEN-NUM-MVEN IN VEN
              MOVE WSS-NUM-SPAS IN WSS-VARI TO VEN-NUM-SVEN IN VEN
              MOVE WSS-NUM-APAS IN WSS-VARI TO VEN-NUM-AVEN IN VEN
              GO TO FIN-PRO-TCAN-CTE
           ELSE
           IF CAN-FEC-FCAN IN CAN NOT > WSS-FEC-FTOP IN WSS-VARI
              PERFORM PRO-DESC-CTE
              GO TO FIN-PRO-TCAN-CTE.
      *
       NXT-PRO-TCAN-CTE.
           IF OPC-NUM-VCOR IN OPC = 1
               IF CAN-FEC-FCAN IN CAN > VEN-FEC-FIMV IN VEN
      * LA FECHA FPAS, NO PERDER LA FVEN INICIAL.
                  MOVE VEN-NUM-DVEN IN VEN TO WSS-NUM-DPAS IN WSS-VARI
                  MOVE VEN-NUM-MVEN IN VEN TO WSS-NUM-MPAS IN WSS-VARI
                  MOVE VEN-NUM-SVEN IN VEN TO WSS-NUM-SPAS IN WSS-VARI
                  MOVE VEN-NUM-AVEN IN VEN TO WSS-NUM-APAS IN WSS-VARI
      *
      * Muevo la fecha FIMV a la FVEN para que procese en forma normal.
                  MOVE VEN-NUM-DIMV IN VEN TO VEN-NUM-DVEN IN VEN
                  MOVE VEN-NUM-MIMV IN VEN TO VEN-NUM-MVEN IN VEN
                  MOVE VEN-NUM-SIMV IN VEN TO VEN-NUM-SVEN IN VEN
                  MOVE VEN-NUM-AIMV IN VEN TO VEN-NUM-AVEN IN VEN
                  PERFORM PRO-MORA-CTE
      *
      * La fecha FPAS solo es usada para no perder la FVEN inicial.
                  MOVE WSS-NUM-DPAS IN WSS-VARI TO VEN-NUM-DVEN IN VEN
                  MOVE WSS-NUM-MPAS IN WSS-VARI TO VEN-NUM-MVEN IN VEN
                  MOVE WSS-NUM-SPAS IN WSS-VARI TO VEN-NUM-SVEN IN VEN
                  MOVE WSS-NUM-APAS IN WSS-VARI TO VEN-NUM-AVEN IN VEN
                  GO TO FIN-PRO-TCAN-CTE.
      *
           IF CAN-FEC-FCAN IN CAN > VEN-FEC-FVEN IN VEN
               PERFORM PRO-MORA-CTE
           ELSE
           IF CAN-FEC-FCAN IN CAN NOT > VEN-FEC-FVEN IN VEN
               PERFORM PRO-DESC-CTE
              GO TO FIN-PRO-TCAN-CTE.
       FIN-PRO-TCAN-CTE.
           EXIT.

       PRO-DESC-CTE SECTION.
      *---------------------*
       INI-PRO-DESC-CTE.
           IF OPC-NUM-VCOR IN OPC = 1
               PERFORM PRO-DESC-CTE-1VCTO
               GO TO FIN-PRO-DESC-CTE.
      *
           PERFORM CAL-TFPR-CAN.
           IF INT-CMSG > SPACES
               GO TO FIN-PRO-DESC-CTE.
      *
           IF ICG-SGV-TINT IN ICG     = ZEROES
              IF WSS-IBLK-TINT = 'N' AND ITR-COD-CVTI IN ITR > SPACES
                  NEXT SENTENCE
              ELSE
               MOVE VEN-VAL-SFIN IN VEN TO WSS-VAL-SVEN
               GO TO NXT-PRO-DESC-CTE.
      *
           MOVE VEN-VAL-SFIN IN VEN     TO WSS-VAL-SMON.
      *
           MOVE CAN-NUM-DCAN IN CAN-FLD TO FEC-DEC1.
           MOVE CAN-NUM-MCAN IN CAN-FLD TO FEC-MEC1.
           MOVE CAN-NUM-SCAN IN CAN-FLD TO FEC-SEC1.
           MOVE CAN-NUM-ACAN IN CAN-FLD TO FEC-AEC1.
      *
           MOVE VEN-NUM-DVEN IN VEN     TO FEC-DEC2.
           MOVE VEN-NUM-MVEN IN VEN     TO FEC-MEC2.
           MOVE VEN-NUM-SVEN IN VEN     TO FEC-SEC2.
           MOVE VEN-NUM-AVEN IN VEN     TO FEC-AEC2.
      *
           MOVE ITR-COD-TINT IN ITR     TO INT-TIPT.
           MOVE ICG-SGV-TINT IN ICG     TO INT-TINT.
      *
      *    PERFORM CAL-TIPE-DESC.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE ZEROES TO FEC-NDIA.
      *
           MOVE FEC-NDIA                TO INT-SEPA INT-SEPD.
           MOVE CAN-NUM-DCAN IN CAN-FLD TO INT-DDMA INT-DBTV.
           MOVE CAN-NUM-MCAN IN CAN-FLD TO INT-MDMA INT-MBTV.
           MOVE CAN-NUM-SCAN IN CAN-FLD TO INT-SDMA INT-SBTV.
           MOVE CAN-NUM-ACAN IN CAN-FLD TO INT-ADMA INT-ABTV.
           MOVE OPC-COD-VCOC IN OPC     TO INT-VCAM.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-PRO-DESC-CTE.
      *
           ADD 1 TO INT-TIPE.
           DIVIDE WSS-VAL-SMON BY INT-TIPE
           GIVING WSS-VAL-SVEN.
      *
           IF FRM-SGV-TINT IN CAN-FLD = ICG-SGV-TINT IN ICG   AND
              OPC-NUM-VCVG IN OPC = 1                         AND
              WSS-CMP-FCAN IN WSS-VARI NOT > DLC-FEC-FDEV IN DLC
               IF WSS-OPEC = 'B'
                   MOVE ZEROES TO VEN-VAL-SCAP IN VEN
                   MOVE ZEROES TO WSS-VAL-SVEN IN WSS-VARI
               ELSE
                   MOVE VEN-VAL-SCAP IN VEN TO WSS-VAL-SVEN.
      *
       NXT-PRO-DESC-CTE.
           MOVE   SCR-SGV-IPFC  TO  SCR-SGV-INMO.
           ADD    WSS-VAL-SVEN  TO  SCR-SGV-IPFC.
      *
           IF WSS-OPEC NOT = 'B'
               SUBTRACT VEN-VAL-SCAP IN VEN FROM SCR-SGV-IPFC.

           MULTIPLY  SCR-SGV-IPFC  BY  SCR-SGV-VCAM
             GIVING  SCR-SGV-INTN.
      *
           IF SCR-SGV-INTN > -1 AND
              SCR-SGV-INTN < 1
              MOVE ZEROES TO SCR-SGV-INTN.

           IF WSS-CIC-TVAL = '0'
              MOVE SCR-SGV-INTN TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO SCR-SGV-INTN
              MOVE ZEROES TO SCR-SGV-INTM
              MOVE ZEROES TO SCR-SGV-INT.
      *
           MOVE WSS-VAL-SVEN TO WSS-VAL-SMON.
      *
           MULTIPLY WSS-VAL-SVEN BY SCR-SGV-VCAM
             GIVING WSS-VAL-SVEN ROUNDED.
      *
           IF WSS-CIC-TVAL = '0'
               MOVE WSS-VAL-SVEN TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-SVEN.
       FIN-PRO-DESC-CTE.
           EXIT.
      *
       PRO-DESC-CTE-1VCTO SECTION.
      *--------------------------*
       INI-PRO-DESC-CTE-1VCTO.
      * La fecha FPAS solo es usada para no perder la FVEN inicial.
           MOVE VEN-NUM-DVEN IN VEN TO WSS-NUM-DPAS IN WSS-VARI.
           MOVE VEN-NUM-MVEN IN VEN TO WSS-NUM-MPAS IN WSS-VARI.
           MOVE VEN-NUM-SVEN IN VEN TO WSS-NUM-SPAS IN WSS-VARI.
           MOVE VEN-NUM-AVEN IN VEN TO WSS-NUM-APAS IN WSS-VARI.
      *
      * Muevo la fecha FIMV a la FVEN para que procese en forma normal.
           MOVE VEN-NUM-DIMV IN VEN TO VEN-NUM-DVEN IN VEN.
           MOVE VEN-NUM-MIMV IN VEN TO VEN-NUM-MVEN IN VEN.
           MOVE VEN-NUM-SIMV IN VEN TO VEN-NUM-SVEN IN VEN.
           MOVE VEN-NUM-AIMV IN VEN TO VEN-NUM-AVEN IN VEN.

           MOVE OPC-VAL-SCRE IN OPC TO WSS-VAL-SCRE IN WSS-VARI.
      *
           PERFORM CAL-TFPR-CAN.
           IF INT-CMSG > SPACES
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-PRO-DESC-CTE-VENCT.
      *
           IF ICG-SGV-TINT IN ICG     = ZEROES
              IF WSS-IBLK-TINT = 'N' AND ITR-COD-CVTI IN ITR > SPACES
                  NEXT SENTENCE
              ELSE
               MOVE VEN-VAL-SFIN IN VEN TO WSS-VAL-SVEN
               GO TO NXT-PRO-DESC-CTE-1VCTO.
      *
           IF FRM-SGV-TINT IN CAN-FLD = ICG-SGV-TINT IN ICG      AND
              OPC-NUM-VCVG IN OPC = 1                            AND
              WSS-CMP-FCAN IN WSS-VARI NOT > DLC-FEC-FDEV IN DLC AND
              WSS-OPEC = 'B'
               MOVE ZEROES TO VEN-VAL-SCAP IN VEN
               MOVE ZEROES TO WSS-VAL-SVEN IN WSS-VARI
               GO TO NXT-PRO-DESC-CTE-1VCTO.
      *
      *    PERFORM PRO-UVCT-DVEG.
            MOVE DLC-NUM-DDEV IN DLC TO FEC-DEC1.
            MOVE DLC-NUM-MDEV IN DLC TO FEC-MEC1.
            MOVE DLC-NUM-SDEV IN DLC TO FEC-SEC1.
            MOVE DLC-NUM-ADEV IN DLC TO FEC-AEC1.
      *
           IF ICG-SGV-TINT IN ICG     = FRM-SGV-TINT IN CAN-FLD
               MOVE CAN-NUM-DCAN IN CAN-FLD TO FEC-DEC2
               MOVE CAN-NUM-MCAN IN CAN-FLD TO FEC-MEC2
               MOVE CAN-NUM-SCAN IN CAN-FLD TO FEC-SEC2
               MOVE CAN-NUM-ACAN IN CAN-FLD TO FEC-AEC2
           ELSE
               MOVE VEN-NUM-DVEN IN VEN     TO FEC-DEC2
               MOVE VEN-NUM-MVEN IN VEN     TO FEC-MEC2
               MOVE VEN-NUM-SVEN IN VEN     TO FEC-SEC2
               MOVE VEN-NUM-AVEN IN VEN     TO FEC-AEC2.
      *
           MOVE ITR-COD-TINT IN ITR     TO INT-TIPT.
           MOVE FRM-SGV-TINT IN CAN-FLD TO INT-TINT.
           MOVE 'S'                     TO WSS-IND-SPR2.
           PERFORM CAL-TIPE.
           IF INT-CMSG > SPACES
               GO TO FIN-PRO-DESC-CTE-VENCT.
      *
           IF WSS-OPEC = 'B'
               MULTIPLY OPC-VAL-SCRE IN OPC BY INT-TIPE
                 GIVING WSS-VAL-SMO1
           ELSE
               MULTIPLY VEN-VAL-SCAP IN VEN BY INT-TIPE
                 GIVING WSS-VAL-SMO1.
      *
           IF ICG-SGV-TINT IN ICG  = FRM-SGV-TINT IN CAN-FLD
               GO TO CON-PRO-DESC-CTE-1VCTO.
      *
           MOVE CAN-NUM-DCAN IN CAN-FLD TO FEC-DEC1
           MOVE CAN-NUM-MCAN IN CAN-FLD TO FEC-MEC1
           MOVE CAN-NUM-SCAN IN CAN-FLD TO FEC-SEC1
           MOVE CAN-NUM-ACAN IN CAN-FLD TO FEC-AEC1
           MOVE VEN-NUM-DVEN IN VEN     TO FEC-DEC2.
           MOVE VEN-NUM-MVEN IN VEN     TO FEC-MEC2.
           MOVE VEN-NUM-SVEN IN VEN     TO FEC-SEC2.
           MOVE VEN-NUM-AVEN IN VEN     TO FEC-AEC2.
           MOVE ITR-COD-TINT IN ITR     TO INT-TIPT.
           MOVE ICG-SGV-TINT IN ICG TO INT-TINT.
      *
      *
      *    PERFORM CAL-TIPE-DESC.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE ZEROES TO FEC-NDIA.
      *
           MOVE FEC-NDIA                TO INT-SEPA INT-SEPD.
           MOVE CAN-NUM-DCAN IN CAN-FLD TO INT-DDMA INT-DBTV.
           MOVE CAN-NUM-MCAN IN CAN-FLD TO INT-MDMA INT-MBTV.
           MOVE CAN-NUM-SCAN IN CAN-FLD TO INT-SDMA INT-SBTV.
           MOVE CAN-NUM-ACAN IN CAN-FLD TO INT-ADMA INT-ABTV.
           MOVE OPC-COD-VCOC IN OPC     TO INT-VCAM.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-PRO-DESC-CTE-VENCT.
      *
           IF WSS-OPEC = 'B'
               MULTIPLY OPC-VAL-SCRE IN OPC BY INT-TIPE
                 GIVING WSS-VAL-SMO2
           ELSE
               MULTIPLY VEN-VAL-SCAP IN VEN BY INT-TIPE
                 GIVING WSS-VAL-SMO2.
      *
           SUBTRACT WSS-VAL-SMO2 FROM WSS-VAL-SMO1
             GIVING WSS-VAL-SMO1.
      *
       CON-PRO-DESC-CTE-1VCTO.
           IF WSS-OPEC = 'B'
               MOVE WSS-VAL-SMO1 TO WSS-VAL-SVEN
           ELSE
               ADD VEN-VAL-SCAP IN VEN  WSS-VAL-SMO1
               GIVING WSS-VAL-SVEN.
      *
       NXT-PRO-DESC-CTE-1VCTO.
      *
           MOVE SCR-SGV-IPFC TO SCR-SGV-INMO.
           ADD WSS-VAL-SVEN TO SCR-SGV-IPFC.
           IF WSS-OPEC NOT = 'B'
               SUBTRACT VEN-VAL-SCAP IN VEN FROM SCR-SGV-IPFC.

           MULTIPLY SCR-SGV-IPFC BY SCR-SGV-VCAM GIVING SCR-SGV-INTN.
           IF SCR-SGV-INTN > -1 AND
              SCR-SGV-INTN < 1
              MOVE ZEROES TO SCR-SGV-INTN.

           IF WSS-CIC-TVAL = '0'
              MOVE SCR-SGV-INTN TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO SCR-SGV-INTN
              MOVE ZEROES TO SCR-SGV-INTM
              MOVE ZEROES TO SCR-SGV-INT.
      *
           MOVE WSS-VAL-SVEN TO WSS-VAL-SMON.
           MULTIPLY WSS-VAL-SVEN BY SCR-SGV-VCAM
                             GIVING WSS-VAL-SVEN ROUNDED.
           IF WSS-CIC-TVAL = '0'
               MOVE WSS-VAL-SVEN TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-SVEN.
      *
       FIN-PRO-DESC-CTE-VENCT.
      * La fecha FPAS solo es usada para no perder la FVEN inicial.
           MOVE WSS-NUM-DPAS IN WSS-VARI TO VEN-NUM-DVEN IN VEN.
           MOVE WSS-NUM-MPAS IN WSS-VARI TO VEN-NUM-MVEN IN VEN.
           MOVE WSS-NUM-SPAS IN WSS-VARI TO VEN-NUM-SVEN IN VEN.
           MOVE WSS-NUM-APAS IN WSS-VARI TO VEN-NUM-AVEN IN VEN.
       FIN-PRO-DESC-CTE-1VCTO.
           EXIT.
      *
      *
       CAL-TFPR-CAN SECTION.
      *--------------------*
       INI-CAL-TFPR-CAN.
           MOVE SPACES TO WSS-CMSG WSS-MENS.
      *Si VEN ya esta completo continua en el despliegue
           IF VEN-IND-CALC IN VEN NOT = 'N'
               GO TO DSP-CAL-TFPR-CAN.
       DSP-CAL-TFPR-CAN.
           IF ( SCR-MSC-FCAN = 'T' AND SCR-MSC-ECAN = 'E' ) OR
              OPC-NUM-VCOR IN OPC = 1
               MOVE VEN-VAL-SCAP IN VEN TO VEN-VAL-SCAP IN CAN-FLD
               MOVE VEN-VAL-SFIN IN VEN TO VEN-VAL-SFIN IN CAN-FLD
               MOVE VEN-VAL-SCAP IN VEN TO RCV-SGV-CAPI IN CAN-FLD
               MOVE VEN-VAL-SFIN IN VEN TO RCV-SGV-FINA IN CAN-FLD.
       FIN-CAL-TFPR-CAN.
           EXIT.
      *
      *
       CAL-TIPE SECTION.
      *-----------------*
       INI-CAL-TIPE.
           MOVE OPC-COD-VCOC IN OPC     TO INT-VCAM.
           MOVE FEC-FEC1                TO INT-FUNO.
           MOVE FEC-FEC2                TO INT-FDOS.
      *
           MOVE OPC-NUM-DCOL IN OPC     TO INT-DCOL.
           MOVE OPC-NUM-MCOL IN OPC     TO INT-MCOL.
           MOVE OPC-NUM-SCOL IN OPC     TO INT-SCOL.
           MOVE OPC-NUM-ACOL IN OPC     TO INT-ACOL.
      *
           MOVE CAN-NUM-DCAN IN CAN-FLD TO INT-DBTV.
           MOVE CAN-NUM-MCAN IN CAN-FLD TO INT-MBTV.
           MOVE CAN-NUM-SCAN IN CAN-FLD TO INT-SBTV.
           MOVE CAN-NUM-ACAN IN CAN-FLD TO INT-ABTV.
      *
           IF WSS-IND-SPR2 = 'S' AND
              VEN-NUM-IVCT IN VEN = 1 AND
              INT-CVTI > SPACES AND INT-TFPR = 'C' AND
              SCR-SGV-SPR2 > 0
               MOVE 'COL'       TO FIO-SIST
               MOVE FIO-GET-KEY TO FIO-CMND
               MOVE 'VSNLIQTMXCBCI' TO TAB-COD-TABL IN TAB
               PERFORM GNS-FIO-TAB
               IF FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S'
                   MOVE SCR-SGV-SPR2 TO INT-SPR2.
      *
           MOVE SPACES              TO WSS-IND-SPR2.
           MOVE OPC-CIC-IOPC IN OPC TO INT-IOPC
           MOVE VEN-NUM-IDLC IN VEN TO INT-IDLC
           PERFORM COL-CAL-INT.
      *
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR.
       FIN-CAL-TIPE.
           EXIT.
      *
       PRO-MORA-CTE SECTION.
       INI-PRO-MORA-CTE.
           IF VEN-IND-CALC IN VEN = 'N'
               MOVE 'VENCALCMORAN'       TO MSG-COD-MENS
               GO TO FIN-PRO-MORA-CTE.
      *
      *Valor final del vcto.
           MOVE VEN-VAL-SFIN IN VEN TO WSS-VAL-SMON.
      *
      *Busca fecha inicio de Mora.
           PERFORM PRO-FUPM.
      *
           MOVE CAN-NUM-DCAN IN CAN TO FEC-DEC2.
           MOVE CAN-NUM-MCAN IN CAN TO FEC-MEC2.
           MOVE CAN-NUM-SCAN IN CAN TO FEC-SEC2.
           MOVE CAN-NUM-ACAN IN CAN TO FEC-AEC2.
      *
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE ZEROES TO FEC-NDIA.
      *
           MOVE FEC-NDIA  TO INT-SEPA INT-SEPD WSS-DIAM.
      *Vercion
           MOVE 'COL'          TO TAB-COD-SIST FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'BCI    DPTMC' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB
           IF FIO-STAT-OKS AND
              TAB-IND-VIGE IN TAB = 'S'
               PERFORM PRO-MORA-TXC
           ELSE
           IF CAN-FEC-FCAN IN CAN     > VEN-FEC-FVEN IN VEN AND
              CAN-FEC-FCAN IN CAN NOT > VEN-FEC-FIMV IN VEN
               PERFORM VAL-TMAX-CONV
           ELSE
               PERFORM PRO-MORA-TMC.
      *
           IF FRM-SUAR = FRM-SUAR-MAL
               GO TO FIN-PRO-MORA-CTE.
      *
           IF WSS-IBLK-TINT = 'S'
               GO TO CON-PRO-CTE-TIPE.
      *
           IF WSS-SGV-TINT IN WSS-VARI NOT > ZEROES
               MOVE 0 TO INT-TIPE
               GO TO CON-PRO-CTE-TIPE.
     *
       CON-PRO-MORA-CTE.
           MOVE WSS-DIAM                 TO INT-SEPA INT-SEPD.
           MOVE ITR-COD-TINT IN ITR      TO INT-TIPT.
           MOVE WSS-SGV-TINT IN WSS-VARI TO INT-TINT.
           MOVE SPACES                   TO INT-CVTI.
      *
           MOVE WSS-NUM-DUPM            TO INT-DDMA.
           MOVE WSS-NUM-MUPM            TO INT-MDMA.
           MOVE WSS-NUM-SUPM            TO INT-SDMA.
           MOVE WSS-NUM-AUPM            TO INT-ADMA.
      *
           MOVE OPC-COD-VCOC IN OPC     TO INT-VCAM.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-PRO-MORA-CTE.
      *
       CON-PRO-CTE-TIPE.
           MOVE WSS-VAL-SMON TO WSS-VAL-SCRE.
      *
           MULTIPLY INT-TIPE BY WSS-VAL-SCRE
             GIVING WSS-VAL-SVEN.
      *
           COMPUTE
           SCR-SGV-INMO = VEN-VAL-SFIN IN VEN -
                          VEN-VAL-SCAP IN VEN.
      *
           MOVE WSS-VAL-SVEN TO SCR-SGV-IMMO.
           MULTIPLY WSS-VAL-SVEN BY SCR-SGV-VCAM
           GIVING   SCR-SGV-INTM.
      *
           ADD WSS-VAL-SCRE TO WSS-VAL-SVEN.
      *
           ADD WSS-VAL-SVEN TO SCR-SGV-IPFC.
      *
           IF WSS-OPEC NOT = 'B'
               SUBTRACT VEN-VAL-SCAP IN VEN FROM SCR-SGV-IPFC.

           MULTIPLY SCR-SGV-IPFC BY SCR-SGV-VCAM
             GIVING SCR-SGV-INT.
      *
           SUBTRACT SCR-SGV-INTM FROM SCR-SGV-INT
             GIVING SCR-SGV-INTN.
      *
      *
           IF SCR-SGV-INTN > -1 AND
              SCR-SGV-INTN < 1
              MOVE ZEROES TO SCR-SGV-INTN.

      *
           IF WSS-CIC-TVAL = '0'
              MOVE SCR-SGV-INTM TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO SCR-SGV-INTM
      *
              MOVE SCR-SGV-INTN TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO SCR-SGV-INTN.
      *
           MOVE WSS-VAL-SVEN    TO   WSS-VAL-SMON.
      *
           MULTIPLY WSS-VAL-SVEN BY SCR-SGV-VCAM
             GIVING WSS-VAL-SVEN ROUNDED.
      *
           IF WSS-CIC-TVAL = '0'
               MOVE WSS-VAL-SVEN TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-SVEN.
       FIN-PRO-MORA-CTE.
           EXIT.

       PRO-MORA-TXC SECTION.
       INI-PRO-MORA-TXC.
           PERFORM BUS-CIC-PLZO.
           IF FRM-SUAR = FRM-SUAR-MAL
               GO TO FIN-PRO-MORA-TXC.
      *
           PERFORM DET-OPC-PRO-ORIG.
           IF FRM-SUAR = FRM-SUAR-MAL
               GO TO FIN-PRO-MORA-TXC.
      *
           MOVE WSS-PLZO                 TO TXC-PLZO.
           MOVE OPC-COD-VCOC IN OPC      TO TXC-VCOC.
           MOVE CAN-NUM-DCAN IN CAN      TO TXC-DEC2.
           MOVE CAN-NUM-MCAN IN CAN      TO TXC-MEC2.
           MOVE CAN-NUM-SCAN IN CAN      TO TXC-SEC2.
           MOVE CAN-NUM-ACAN IN CAN      TO TXC-AEC2.
      *
           MOVE WSS-NUM-DUPM IN WSS-VARI TO TXC-DEC1.
           MOVE WSS-NUM-MUPM IN WSS-VARI TO TXC-MEC1.
           MOVE WSS-NUM-SUPM IN WSS-VARI TO TXC-SEC1.
           MOVE WSS-NUM-AUPM IN WSS-VARI TO TXC-AEC1.

           PERFORM TAB-BUS-TXC.
           IF TXC-CMSG > SPACES
               MOVE TXC-CMSG     TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-PRO-MORA-TXC.
      *
           DIVIDE TXC-ATXC BY 100 GIVING WSS-INT-TIPE ROUNDED.
      *
           IF WSS-IBLK-TINT = 'S'
               MOVE '1'             TO FRM-IND-TIPE IN CAN-FLD
               MOVE WSS-INT-TIPE    TO INT-TIPE
               MULTIPLY  WSS-INT-TIPE  BY  100
                 GIVING  WSS-SGV-TINT  IN  WSS-VARI

               DIVIDE WSS-SGV-TINT IN WSS-VARI BY 100
               GIVING INT-TIPE

               PERFORM GLS-INT-TIPE
               GO TO FIN-PRO-MORA-TXC.
      *
           IF FRM-IND-TIPE IN CAN-FLD > SPACES
               DIVIDE WSS-SGV-TINT IN WSS-VARI BY 100
               GIVING INT-TIPE
               MOVE 'S' TO WSS-IBLK-TINT
               PERFORM GLS-INT-TIPE
               GO TO CMP-INT-TIPE-TXC.
      *
           MOVE SPACES           TO FRM-IND-TIPE IN CAN-FLD.
           MOVE ITR-COD-TINT IN ITR     TO INT-TIPT.
           MOVE WSS-SGV-TINT IN WSS-VARI TO INT-TINT.
           MOVE SPACES                   TO INT-CVTI.
           MOVE WSS-NUM-DUPM             TO INT-DDMA.
           MOVE WSS-NUM-MUPM             TO INT-MDMA.
           MOVE WSS-NUM-SUPM             TO INT-SDMA.
           MOVE WSS-NUM-AUPM             TO INT-ADMA.
           MOVE OPC-COD-VCOC IN OPC      TO INT-VCAM.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-PRO-MORA-TXC.
       CMP-INT-TIPE-TXC.
           IF INT-TIPE > WSS-INT-TIPE
               MOVE 'COL'         TO MSG-COD-SIST
               MOVE 'CANTIPE>TXC' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL  TO FRM-SUAR.
       FIN-PRO-MORA-TXC.
           EXIT.
      *
       GLS-INT-TIPE SECTION.
       INI-GLS-INT-TIPE.
           MOVE 'TIPE'              TO ITR-COD-TINT IN ITR.
           MOVE 'TIPE'              TO SCR-COD-TICG.
           MOVE 'COL'               TO TAB-COD-SIST.
           MOVE 'INT'               TO TAB-COD-TTAB IN TAB.
           MOVE ITR-COD-TINT IN ITR TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS = 'COD    NEX' OR
              ITR-COD-TINT IN ITR NOT > SPACES
               MOVE 'TASA PERIODO' TO FRM-GLS-TINT IN CAN-FLD
           ELSE
               MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-TINT IN CAN-FLD.
       FIN-GLS-INT-TIPE.
           EXIT.
      *
       PRO-FUPM SECTION.
       INI-PRO-FUPM.
      *Fecha Inicio de mora
           MOVE VEN-NUM-DVEN IN VEN     TO FEC-DEC1 WSS-NUM-DUPM.
           MOVE VEN-NUM-MVEN IN VEN     TO FEC-MEC1 WSS-NUM-MUPM.
           MOVE VEN-NUM-SVEN IN VEN     TO FEC-SEC1 WSS-NUM-SUPM.
           MOVE VEN-NUM-AVEN IN VEN     TO FEC-AEC1 WSS-NUM-AUPM.
      *
           MOVE VEN-NUM-IVCT IN VEN     TO RCV-NUM-IVCT IN RCV.
           MOVE OPC-CAI-IOPC IN OPC     TO RCV-CAI-IOPV IN RCV.
           MOVE OPC-IIC-IOPC IN OPC     TO RCV-IIC-IOPV IN RCV.
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF NOT (FIO-STAT-OKS AND
              OPC-CAI-IOPC IN OPC = RCV-CAI-IOPV IN RCV AND
              OPC-IIC-IOPC IN OPC = RCV-IIC-IOPV IN RCV AND
              VEN-NUM-IVCT IN VEN = RCV-NUM-IVCT IN RCV )
               GO TO EXT-PRO-FUPM.
      *
           MOVE 1             TO WSS-NUM-ICAN IN WSS-VARI.
       LUP-PRO-FUPM.
           MOVE RCV-KEY-ICAN  TO CAN-KEY-ICAN IN CAN.
           MOVE FIO-GET-KEY   TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF CAN-MSC-FCAN IN CAN = 'P'
               GO TO NXT-PRO-FUPM.
      *
           IF CAN-MSC-STAT IN CAN NOT = 'R' AND
              CAN-SGV-TPAG IN CAN NOT < ZEROES AND
              CAN-SGV-TREN IN CAN NOT < ZEROES AND
              CAN-FEC-FCAN IN CAN >     VEN-FEC-FVEN IN VEN      AND
              CAN-FEC-FCAN IN CAN >     WSS-FEC-FUPM IN WSS-VARI AND
              CAN-NUM-ICAN IN CAN-FLD NOT = CAN-NUM-ICAN IN CAN-FLD
      *
               MOVE CAN-NUM-DCAN IN CAN TO FEC-DEC1 WSS-NUM-DUPM
               MOVE CAN-NUM-MCAN IN CAN TO FEC-MEC1 WSS-NUM-MUPM
               MOVE CAN-NUM-SCAN IN CAN TO FEC-SEC1 WSS-NUM-SUPM
               MOVE CAN-NUM-ACAN IN CAN TO FEC-AEC1 WSS-NUM-AUPM.
      *
       NXT-PRO-FUPM.
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF NOT (FIO-STAT-OKS AND
              OPC-CAI-IOPC IN OPC = RCV-CAI-IOPV IN RCV AND
              OPC-IIC-IOPC IN OPC = RCV-IIC-IOPV IN RCV AND
              VEN-NUM-IVCT IN VEN = RCV-NUM-IVCT IN RCV )
               GO TO EXT-PRO-FUPM.
      *
           GO TO LUP-PRO-FUPM.
       EXT-PRO-FUPM.
       FIN-PRO-FUPM.
           EXIT.

      ******************************************************************

      ******************************************************************
       VAL-TMAX-CONV SECTION.
      ***********************
       INI-VAL-TMAX-CONV.
           MOVE   0    TO WSS-INT-TB90
                          WSS-INT-TS90
                          WSS-INT-TMAX.
      *
           MOVE 'TAB'          TO TAB-COD-SIST FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999'         TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF OPC-COD-VCOC IN OPC = TAB-COD-CTAB IN TAB
               MOVE 'S' TO WSS-PESO
           ELSE
               MOVE 'N' TO WSS-PESO.
      *
           MOVE 'TVAL'         TO MSC-CIC-TMSC IN MSC.
           MOVE '0'            TO MSC-CIC-CMSC IN MSC.
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF OPC-MSC-TVOC IN OPC = MSC-COD-CMSC IN MSC
             MOVE WSS-IND-TMMN IN WSS-VARI TO WSS-IND-TMON IN WSS-VARI
           ELSE
             MOVE WSS-IND-TMMX IN WSS-VARI TO WSS-IND-TMON IN WSS-VARI.
      *
           IF WSS-PESO-SI
               PERFORM BUS-CIC-PLZO
               IF WSS-PLZO-B90
                   MOVE FRM-SGV-TINT IN CAN-FLD TO WSS-INT-TB90
               ELSE
                   MOVE FRM-SGV-TINT IN CAN-FLD TO WSS-INT-TS90
           ELSE
               MOVE FRM-SGV-TINT IN CAN-FLD TO WSS-INT-TMAX.
      *
           MOVE ZEROES              TO INT-TIPE.
           MOVE OPC-NUM-DCOL IN OPC TO INT-DDMA.
           MOVE OPC-NUM-MCOL IN OPC TO INT-MDMA.
           MOVE OPC-NUM-SCOL IN OPC TO INT-SDMA.
           MOVE OPC-NUM-ACOL IN OPC TO INT-ADMA.
           MOVE OPC-COD-VCOC IN OPC TO INT-VCAM.
           IF WSS-PESO-SI
               PERFORM VAL-TMXC-PESO
           ELSE
           IF WSS-IND-TMON = WSS-IND-TMMN
               PERFORM VAL-TMXC-MREA
           ELSE
               PERFORM VAL-TMXC-MEXT.
       FIN-VAL-TMAX-CONV.
           EXIT.

       VAL-TMXC-PESO SECTION.
       INI-VAL-TMXC-PESO.
           IF WSS-INT-TB90 NOT > 0
               GO TO TS9-VAL-TMXC-PESO.
      *
           MOVE OPC-NUM-DCOL IN OPC    TO CAM-NUM-DCAM IN CAM(1).
           MOVE OPC-NUM-MCOL IN OPC    TO CAM-NUM-MCAM IN CAM(1).
           MOVE OPC-NUM-SCOL IN OPC    TO CAM-NUM-SCAM IN CAM(1).
           MOVE OPC-NUM-ACOL IN OPC    TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           MOVE CAM-COD-MNAC           TO CAM-COD-VCAM IN CAM(1).
           MOVE 'TB90'                 TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               MOVE 'CAM$TB9NEX' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-TMXC-PESO.
      *
           IF CAM-IND-VIGE IN CAM NOT = 'S'
               MOVE 'CAM$TB9NVG' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-TMXC-PESO.
      *
           MOVE CAM-SGV-VCAM IN CAM TO INT-TINT.
           MOVE 'VMSS'              TO INT-TIPT.
      *
           IF WSS-IBLK-TINT NOT = 'S' AND
              FRM-IND-TIPE IN CAN-FLD NOT > SPACES
               MOVE 30   TO INT-SEPD.
      *
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-VAL-TMXC-PESO.
      *
           MOVE INT-TIPE TO WSS-INT-TMXC.
           IF WSS-IBLK-TINT = 'S'
               MOVE '1' TO FRM-IND-TIPE IN CAN-FLD
               MULTIPLY  INT-TIPE   BY 100
                 GIVING  WSS-SGV-TINT IN WSS-VARI
               PERFORM GLS-INT-TIPE
               GO TO FIN-VAL-TMXC-PESO.
      *
           IF FRM-IND-TIPE IN CAN-FLD > SPACES
              DIVIDE  WSS-SGV-TINT IN WSS-VARI BY 100
              GIVING  WSS-INT-TIPE
              PERFORM GLS-INT-TIPE
      *
              IF WSS-INT-TIPE > INT-TIPE
                  MOVE 'CAN$TB9>TMXC' TO MSG-COD-MENS
                  MOVE FRM-SUAR-MAL   TO FRM-SUAR
                  GO TO FIN-VAL-TMXC-PESO
              ELSE
                  MOVE WSS-INT-TIPE TO INT-TIPE
                  MOVE 'S' TO WSS-IBLK-TINT
                  GO TO FIN-VAL-TMXC-PESO.
      *
           MOVE SPACES              TO FRM-IND-TIPE IN CAN-FLD.
           MOVE WSS-SGV-TINT IN WSS-VARI TO INT-TINT.
           MOVE ITR-COD-TINT IN ITR      TO INT-TIPT.
           MOVE SPACES                   TO INT-CVTI.
      *
           MOVE 30       TO INT-SEPD.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-VAL-TMXC-PESO.
      *
           MOVE INT-TIPE                TO WSS-INT-TB90.
           MOVE FRM-SGV-TINT IN CAN-FLD TO INT-TINT.
           MOVE ITR-COD-TINT IN ITR     TO INT-TIPT.
           MOVE 30       TO INT-SEPD.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-VAL-TMXC-PESO.
      *
           MOVE INT-TIPE                TO WSS-INT-TIPE.
           IF WSS-INT-TIPE > WSS-INT-TMXC
               MOVE WSS-INT-TIPE TO WSS-INT-TMXC.
      *
           IF WSS-INT-TB90 > WSS-INT-TMXC
               MOVE 'CAN$TB9>TMXC' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL   TO FRM-SUAR
               GO TO FIN-VAL-TMXC-PESO.
      *
       TS9-VAL-TMXC-PESO.
           IF WSS-INT-TS90 NOT > 0
               GO TO FIN-VAL-TMXC-PESO.
      *
           MOVE OPC-NUM-DCOL IN OPC    TO CAM-NUM-DCAM IN CAM(1).
           MOVE OPC-NUM-MCOL IN OPC    TO CAM-NUM-MCAM IN CAM(1).
           MOVE OPC-NUM-SCOL IN OPC    TO CAM-NUM-SCAM IN CAM(1).
           MOVE OPC-NUM-ACOL IN OPC    TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           MOVE CAM-COD-MNAC           TO CAM-COD-VCAM IN CAM(1).
           MOVE 'TS90'                 TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               MOVE 'CAM$TS9NEX' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-TMXC-PESO.
      *
           IF CAM-IND-VIGE IN CAM NOT = 'S'
               MOVE 'CAM$TS9NVG' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-TMXC-PESO.
      *
           MOVE CAM-SGV-VCAM IN CAM TO INT-TINT.
           MOVE 'VMSS'              TO INT-TIPT.
           IF WSS-IBLK-TINT NOT = 'S' AND
              FRM-IND-TIPE IN CAN-FLD NOT > SPACES
               MOVE 30  TO INT-SEPD.
      *
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-VAL-TMXC-PESO.
      *
           MOVE INT-TIPE                TO WSS-INT-TMXC.
           IF WSS-IBLK-TINT = 'S'
               MOVE '1' TO FRM-IND-TIPE IN CAN-FLD
               MULTIPLY INT-TIPE BY 100
                 GIVING WSS-SGV-TINT IN WSS-VARI
               PERFORM GLS-INT-TIPE
               GO TO FIN-VAL-TMXC-PESO.
      *
           IF FRM-IND-TIPE IN CAN-FLD > SPACES
              DIVIDE WSS-SGV-TINT IN WSS-VARI  BY 100
              GIVING WSS-INT-TIPE
              PERFORM GLS-INT-TIPE
      *
              IF WSS-INT-TIPE > INT-TIPE
                  MOVE 'CAN$TS9>TMXC' TO MSG-COD-MENS
                  MOVE FRM-SUAR-MAL   TO FRM-SUAR
                  GO TO FIN-VAL-TMXC-PESO
              ELSE
                  MOVE WSS-INT-TIPE TO INT-TIPE
                  MOVE 'S' TO WSS-IBLK-TINT
                  GO TO FIN-VAL-TMXC-PESO.
      *
           MOVE SPACES               TO FRM-IND-TIPE IN CAN-FLD.
           MOVE WSS-SGV-TINT IN WSS-VARI  TO INT-TINT.
           MOVE ITR-COD-TINT IN ITR       TO INT-TIPT.
           MOVE SPACES                    TO INT-CVTI.
           MOVE 30                        TO INT-SEPD.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-VAL-TMXC-PESO.
      *
           MOVE INT-TIPE TO WSS-INT-TS90.
           MOVE FRM-SGV-TINT IN CAN-FLD TO INT-TINT.
           MOVE ITR-COD-TINT IN ITR     TO INT-TIPT.
           MOVE 30                      TO INT-SEPD.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-VAL-TMXC-PESO.
      *
           MOVE INT-TIPE TO WSS-INT-TIPE.
           IF WSS-INT-TIPE > WSS-INT-TMXC
               MOVE WSS-INT-TIPE TO WSS-INT-TMXC.
      *
           IF WSS-INT-TS90 > WSS-INT-TMXC
               MOVE 'CAN$TS9>TMXC' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL   TO FRM-SUAR
               GO TO FIN-VAL-TMXC-PESO.
       FIN-VAL-TMXC-PESO.
           EXIT.

       VAL-TMXC-MREA SECTION.
       INI-VAL-TMXC-MREA.
           IF WSS-INT-TMAX NOT > 0
               GO TO FIN-VAL-TMXC-MREA.
           MOVE OPC-NUM-DCOL IN OPC    TO CAM-NUM-DCAM IN CAM(1).
           MOVE OPC-NUM-MCOL IN OPC    TO CAM-NUM-MCAM IN CAM(1).
           MOVE OPC-NUM-SCOL IN OPC    TO CAM-NUM-SCAM IN CAM(1).
           MOVE OPC-NUM-ACOL IN OPC    TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           MOVE OPC-COD-VCOC IN OPC    TO CAM-COD-VCAM IN CAM(1).
           MOVE 'TMXC'                 TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               MOVE 'CAMTMXCNEX' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-TMXC-MREA.
      *
           MOVE CAM-SGV-VCAM IN CAM TO INT-TINT.
           IF CAM-IND-VIGE IN CAM NOT = 'S'
               MOVE 'CAMTMXCNVG' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-TMXC-MREA.
      *
           MOVE 'VASS'              TO INT-TIPT.
           IF WSS-IBLK-TINT NOT = 'S' AND
              FRM-IND-TIPE IN CAN-FLD NOT > SPACES
               MOVE 30   TO INT-SEPD.
      *
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-VAL-TMXC-MREA.
      *
           MOVE INT-TIPE TO WSS-INT-TMXC.
           IF WSS-IBLK-TINT = 'S'
               MOVE '1' TO FRM-IND-TIPE IN CAN-FLD
               MULTIPLY  INT-TIPE   BY  100
                 GIVING  WSS-SGV-TINT IN WSS-VARI
               PERFORM GLS-INT-TIPE
               GO TO FIN-VAL-TMXC-MREA.
      *
           IF FRM-IND-TIPE IN CAN-FLD > SPACES
              DIVIDE  WSS-SGV-TINT IN WSS-VARI  BY 100
              GIVING  WSS-INT-TIPE
              PERFORM GLS-INT-TIPE
              IF WSS-INT-TIPE > INT-TIPE
                  MOVE 'CAN$TB9>TMXC' TO MSG-COD-MENS
                  MOVE FRM-SUAR-MAL   TO FRM-SUAR
                  GO TO FIN-VAL-TMXC-MREA
              ELSE
                  MOVE WSS-INT-TIPE TO INT-TIPE
                  MOVE 'S' TO WSS-IBLK-TINT
                  GO TO FIN-VAL-TMXC-MREA.
      *
           MOVE SPACES              TO FRM-IND-TIPE IN CAN-FLD.
           MOVE WSS-SGV-TINT IN WSS-VARI TO INT-TINT.
           MOVE ITR-COD-TINT IN ITR      TO INT-TIPT.
           MOVE SPACES                   TO INT-CVTI.
           MOVE 30                       TO INT-SEPD.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-VAL-TMXC-MREA.
      *
           MOVE INT-TIPE TO WSS-INT-TMAX.
           MOVE FRM-SGV-TINT IN CAN-FLD TO INT-TINT.
           MOVE ITR-COD-TINT IN ITR     TO INT-TIPT.
           MOVE 30                      TO INT-SEPD.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-VAL-TMXC-MREA.
      *
           MOVE INT-TIPE TO WSS-INT-TIPE.
           IF WSS-INT-TIPE > WSS-INT-TMXC
               MOVE WSS-INT-TIPE TO WSS-INT-TMXC.
      *
           IF WSS-INT-TMAX > WSS-INT-TMXC
               MOVE 'CANTMRJ>TMXC' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL   TO FRM-SUAR
               GO TO FIN-VAL-TMXC-MREA.
       FIN-VAL-TMXC-MREA.
           EXIT.

       VAL-TMXC-MEXT SECTION.
       INI-VAL-TMXC-MEXT.
           IF WSS-INT-TMAX NOT > 0
               GO TO FIN-VAL-TMXC-MEXT.
      *
           MOVE OPC-NUM-DCOL IN OPC    TO CAM-NUM-DCAM IN CAM(1).
           MOVE OPC-NUM-MCOL IN OPC    TO CAM-NUM-MCAM IN CAM(1).
           MOVE OPC-NUM-SCOL IN OPC    TO CAM-NUM-SCAM IN CAM(1).
           MOVE OPC-NUM-ACOL IN OPC    TO CAM-NUM-ACAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           MOVE 'TMEX'                 TO CAM-COD-VCAM IN CAM(1).
           MOVE 'TMXC'                 TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
               MOVE 'CAMTMXCNEX' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-TMXC-MEXT.
      *
           IF CAM-IND-VIGE IN CAM NOT = 'S'
               MOVE 'CAMTMXCNVG' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-TMXC-MEXT.
      *
           MOVE CAM-SGV-VCAM IN CAM TO INT-TINT.
           MOVE 'VASS'              TO INT-TIPT.
           IF WSS-IBLK-TINT NOT = 'S' AND
              FRM-IND-TIPE IN CAN-FLD NOT > SPACES
               MOVE 30     TO INT-SEPD.
      *
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-VAL-TMXC-MEXT.
      *
           MOVE INT-TIPE TO WSS-INT-TMXC.
           IF WSS-IBLK-TINT = 'S'
               MOVE '1' TO FRM-IND-TIPE IN CAN-FLD
               MULTIPLY INT-TIPE    BY  100
                 GIVING WSS-SGV-TINT IN WSS-VARI
               PERFORM GLS-INT-TIPE
               GO TO FIN-VAL-TMXC-MEXT.
      *
           IF FRM-IND-TIPE IN CAN-FLD > SPACES
              DIVIDE WSS-SGV-TINT IN WSS-VARI  BY 100
              GIVING WSS-INT-TIPE
              PERFORM GLS-INT-TIPE
              IF WSS-INT-TIPE > INT-TIPE
                  MOVE 'CANTMEX>TMXC' TO MSG-COD-MENS
                  MOVE FRM-SUAR-MAL   TO FRM-SUAR
                  GO TO FIN-VAL-TMXC-MEXT
              ELSE
                  MOVE WSS-INT-TIPE TO INT-TIPE
                  MOVE 'S' TO WSS-IBLK-TINT
                  GO TO FIN-VAL-TMXC-MEXT.
      *
           MOVE SPACES              TO FRM-IND-TIPE IN CAN-FLD.
           MOVE WSS-SGV-TINT IN WSS-VARI TO INT-TINT.
           MOVE ITR-COD-TINT IN ITR      TO INT-TIPT.
           MOVE SPACES                   TO INT-CVTI.
           MOVE 30                       TO INT-SEPD.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-VAL-TMXC-MEXT.
      *
           MOVE INT-TIPE                TO WSS-INT-TMAX.
           MOVE FRM-SGV-TINT IN CAN-FLD TO INT-TINT.
           MOVE ITR-COD-TINT IN ITR     TO INT-TIPT.
           MOVE 30                      TO INT-SEPD.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-VAL-TMXC-MEXT.
      *
           MOVE INT-TIPE TO WSS-INT-TIPE.
           IF WSS-INT-TIPE > WSS-INT-TMXC
               MOVE WSS-INT-TIPE TO WSS-INT-TMXC.
      *
           IF WSS-INT-TMAX > WSS-INT-TMXC
               MOVE 'CANTMEX>TMXC' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL   TO FRM-SUAR
               GO TO FIN-VAL-TMXC-MEXT.
       FIN-VAL-TMXC-MEXT.
           EXIT.

       BUS-CIC-PLZO SECTION.
       INI-BUS-CIC-PLZO.
           MOVE 'VSN'         TO TAB-COD-TTAB IN TAB.
           MOVE 'CALMORAFMAV' TO TAB-COD-CTAB IN TAB.
           MOVE 'COL' TO FIO-SIST.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S' )
               GO TO FMV-BUS-CIC-PLZO.
      *
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE VEN-NUM-IDLC IN VEN TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
               MOVE 'DLC    NEX'        TO MSG-COD-MENS
               MOVE DLC-KEY-IDLC IN DLC TO FRM-MEN2
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-BUS-CIC-PLZO.
      *
           MOVE 'PZO'               TO TAB-COD-TTAB IN TAB.
           MOVE DLC-COD-PLZO IN DLC TO TAB-COD-CTAB IN TAB.
           MOVE 'TAB' TO FIO-SIST.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-CIC-CTAB IN TAB TO WSS-PLZO
           ELSE
               MOVE 'TABPZO NEX' TO MSG-COD-MENS
               MOVE TAB-COD-CTAB IN TAB TO FRM-MEN2
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
           GO TO FIN-BUS-CIC-PLZO.
      *
       FMV-BUS-CIC-PLZO.
           MOVE DLC-KEY-IDLC IN DLC TO WSS-DLC-KEY-IDLC.
           MOVE ZEROS               TO WSS-DLC-FEC-FMAV.
           MOVE ZEROS               TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS         TO FIO-CMND.
       LUP-BUS-CIC-PLZO.
           PERFORM COL-FIO-DLC.
           IF NOT (FIO-STAT-OKS AND
                   DLC-CIC-IOPC IN DLC = WSS-DLC-CIC-IOPC)
               GO TO CON-BUS-CIC-PLZO.
      *
           IF DLC-FEC-FMAV IN DLC > WSS-DLC-FEC-FMAV
               MOVE DLC-FEC-FMAV IN DLC TO WSS-DLC-FEC-FMAV.
      *
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-BUS-CIC-PLZO.
       CON-BUS-CIC-PLZO.
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.
      *
           MOVE WSS-DLC-NUM-DMAV    TO FEC-DEC2.
           MOVE WSS-DLC-NUM-MMAV    TO FEC-MEC2.
           MOVE WSS-DLC-NUM-SMAV    TO FEC-SEC2.
           MOVE WSS-DLC-NUM-AMAV    TO FEC-AEC2.
      *
           MOVE FEC-FORM-FEC        TO FEC-FORM.
           MOVE FEC-DIF-DIA         TO FEC-CMND.
           PERFORM CAL-FEC.
           IF FEC-NDIA < 90
               MOVE 'C1' TO WSS-PLZO
           ELSE
               MOVE 'S9' TO WSS-PLZO.
      *
           MOVE WSS-DLC-KEY-IDLC TO DLC-KEY-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.
       FIN-BUS-CIC-PLZO.
           EXIT.


      ******************************************************************
       LIM-TBAN SECTION.
      ****************
       INI-LIM-TBAN.
           MOVE 1 TO MOV-I.
       LUP-LIM-TBAN.
           IF MOV-I > 20
               GO TO FIN-LIM-TBAN.
           MOVE SPACES TO WSS-TBAN (MOV-I).
       SIG-LIM-TBAN.
           ADD 1 TO MOV-I.
           GO TO LUP-LIM-TBAN.
       FIN-LIM-TBAN.
           EXIT.
      ******************************************************************
       CHK-EXI-TBAN SECTION.
      *********************
       INI-CHK-EXT-TBAN.
           MOVE 1 TO MOV-I.
       LUP-VEC-TBAN.
           IF WSS-COD-BANC IN WSS-VARI = WSS-TBAN (MOV-I) AND
              WSS-COD-BANC IN WSS-VARI > SPACES
               MOVE 'S' TO WSS-IND-EBAN IN WSS-VARI
               GO TO FIN-CHK-EXT-TBAN.
           IF MOV-I = 20
               MOVE 'N' TO WSS-IND-EBAN IN WSS-VARI
               GO TO FIN-CHK-EXT-TBAN
           ELSE
               ADD 1 TO MOV-I
               GO TO LUP-VEC-TBAN.
       FIN-CHK-EXT-TBAN.
           EXIT.
      ******************************************************************
       CAL-NUM-DHBL SECTION.
      **********************
       INI-CAL-NUM-DHBL.
      *VAL-FEC Va sumando un dia habil hasta acumular 2.
           MOVE 1     TO WSS-NUM-1HBL IN WSS-VARI.
           MOVE 1     TO WSS-NUM-CONT IN WSS-VARI.
           MOVE VEN-NUM-DVEN IN VEN TO WSS-NUM-DTOP IN WSS-VARI.
           MOVE VEN-NUM-MVEN IN VEN TO WSS-NUM-MTOP IN WSS-VARI.
           MOVE VEN-NUM-SVEN IN VEN TO WSS-NUM-STOP IN WSS-VARI.
           MOVE VEN-NUM-AVEN IN VEN TO WSS-NUM-ATOP IN WSS-VARI.
      *
      * Controlo si es Habil o No Habil.
           MOVE VEN-NUM-DVEN IN VEN TO FEC-ITM1.
           MOVE VEN-NUM-MVEN IN VEN TO FEC-ITM2.
           MOVE VEN-NUM-SVEN IN VEN TO FEC-ITM3.
           MOVE VEN-NUM-AVEN IN VEN TO FEC-ITM4.
      *
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-FER
              MOVE 'S' TO WSS-IND-FERI IN WSS-VARI
           ELSE
              MOVE 'N' TO WSS-IND-FERI IN WSS-VARI.
      *
      * Ya Controle si es Habil o No Habil.
       SUM-DIA-SHBL.
           MOVE WSS-NUM-DTOP TO FEC-ITM1.
           MOVE WSS-NUM-MTOP TO FEC-ITM2.
           MOVE WSS-NUM-STOP TO FEC-ITM3.
           MOVE WSS-NUM-ATOP TO FEC-ITM4.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-SUM-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
           PERFORM CAL-FEC.
           MOVE FEC-ITM1 TO WSS-NUM-DTOP.
           MOVE FEC-ITM2 TO WSS-NUM-MTOP.
           MOVE FEC-ITM3 TO WSS-NUM-STOP.
           MOVE FEC-ITM4 TO WSS-NUM-ATOP.
      *
           MOVE WSS-NUM-DTOP TO FEC-ITM1.
           MOVE WSS-NUM-MTOP TO FEC-ITM2.
           MOVE WSS-NUM-STOP TO FEC-ITM3.
           MOVE WSS-NUM-ATOP TO FEC-ITM4.
      *
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-FER
              GO TO SUM-DIA-SHBL.

           IF (WSS-NUM-CONT IN WSS-VARI = 1) AND
              (WSS-IND-FERI IN WSS-VARI = 'N')
                 GO TO FIN-CAL-NUM-DHBL.

           IF (WSS-NUM-CONT IN WSS-VARI = 2) AND
              (WSS-IND-FERI IN WSS-VARI = 'S')
                 GO TO FIN-CAL-NUM-DHBL
           ELSE
               ADD 1 TO WSS-NUM-CONT IN WSS-VARI
               GO TO SUM-DIA-SHBL.

       FIN-CAL-NUM-DHBL.
           EXIT.
      ******************************************************************
       RST-DIA-HBLS SECTION.
      **********************
       INI-RST-DIA-HBLS.
      * Calculo el numero de dias que hay entre la FCAN y FVEN
           MOVE VEN-NUM-DVEN IN VEN     TO FEC-DEC1.
           MOVE VEN-NUM-MVEN IN VEN     TO FEC-MEC1.
           MOVE VEN-NUM-SVEN IN VEN     TO FEC-SEC1.
           MOVE VEN-NUM-AVEN IN VEN     TO FEC-AEC1.
           MOVE CAN-NUM-DOUT IN CAN-FLD TO FEC-DEC2.
           MOVE CAN-NUM-MOUT IN CAN-FLD TO FEC-MEC2.
           MOVE CAN-NUM-SOUT IN CAN-FLD TO FEC-SEC2.
           MOVE CAN-NUM-AOUT IN CAN-FLD TO FEC-AEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE ZEROES TO FEC-NDIA.
           MOVE FEC-NDIA TO WSS-NUM-TOP1 IN WSS-VARI.
           IF WSS-NUM-TOP1 IN WSS-VARI > WSS-NUM-TOPE IN WSS-VARI
               MOVE 'N' TO WSS-IND-MORA IN WSS-VARI
               GO TO FIN-RST-DIA-HBLS.

      *VAL-FEC Va restando un dia habil hasta acumular 6.
           MOVE 'N' TO WSS-IND-MORA IN WSS-VARI.
           MOVE 1   TO WSS-NUM-CONT IN WSS-VARI.
      *
           MOVE CAN-NUM-DOUT IN CAN TO WSS-NUM-DTOP IN WSS-VARI.
           MOVE CAN-NUM-MOUT IN CAN TO WSS-NUM-MTOP IN WSS-VARI.
           MOVE CAN-NUM-SOUT IN CAN TO WSS-NUM-STOP IN WSS-VARI.
           MOVE CAN-NUM-AOUT IN CAN TO WSS-NUM-ATOP IN WSS-VARI.
      * Resta 6 dias habiles y se salta los no habiles.
       REST-DIA-HBLS.
           MOVE WSS-NUM-DTOP TO FEC-ITM1.
           MOVE WSS-NUM-MTOP TO FEC-ITM2.
           MOVE WSS-NUM-STOP TO FEC-ITM3.
           MOVE WSS-NUM-ATOP TO FEC-ITM4.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-RST-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
           PERFORM CAL-FEC.
           MOVE FEC-ITM1 TO WSS-NUM-DTOP.
           MOVE FEC-ITM2 TO WSS-NUM-MTOP.
           MOVE FEC-ITM3 TO WSS-NUM-STOP.
           MOVE FEC-ITM4 TO WSS-NUM-ATOP.
      *VAL-FEC Validar Fecha.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-FER
              GO TO REST-DIA-HBLS.

           IF VEN-FEC-FVEN IN VEN > WSS-FEC-FTOP IN WSS-VARI
               MOVE 'N' TO WSS-IND-MORA IN WSS-VARI
               GO TO FIN-RST-DIA-HBLS.

           IF (WSS-NUM-CONT IN WSS-VARI = WSS-NUM-DIAS IN WSS-VARI) AND
              (VEN-FEC-FVEN IN VEN NOT > WSS-FEC-FTOP IN WSS-VARI)
                 MOVE 'S' TO WSS-IND-MORA IN WSS-VARI
                 GO TO FIN-RST-DIA-HBLS
           ELSE
               ADD 1 TO WSS-NUM-CONT IN WSS-VARI
               GO TO REST-DIA-HBLS.
       FIN-RST-DIA-HBLS.
           EXIT.
      ******************************************************************
      *
      *
       DET-OPC-PRO-ORIG SECTION.
       INI-DET-OPC-PRO-ORIG.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           IF OPC-IND-RENO IN OPC NOT = 'PRO'
               GO TO NXT-DET-OPC-PRO-ORIG.
      *
       NXT-DET-OPC-PRO-ORIG.
           MOVE 1                            TO CAM-SGV-VCAM IN CAM.
           IF WSS-CIC-VCAM NOT = '0998'
               MOVE '0998  '                 TO CAM-COD-VCAM IN CAM(1)
               MOVE OPC-COD-VCOC IN OPC      TO CAM-COD-VCAM IN CAM(2)
               MOVE OPC-NUM-DCOL IN OPC      TO CAM-NUM-DCAM IN CAM(1)
               MOVE OPC-NUM-MCOL IN OPC      TO CAM-NUM-MCAM IN CAM(1)
               MOVE OPC-NUM-SCOL IN OPC      TO CAM-NUM-SCAM IN CAM(1)
               MOVE OPC-NUM-ACOL IN OPC      TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT ( FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
                   MOVE 'TAB'        TO MSG-COD-SIST
                   MOVE 'CAM    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN1
                   MOVE CAM-KEY-CAMB TO FRM-MEN2
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-DET-OPC-PRO-ORIG.
           DIVIDE  OPC-VAL-CRED IN OPC BY CAM-SGV-VCAM IN CAM
           GIVING  TXC-MNTO ROUNDED.
       FIN-DET-OPC-PRO-ORIG.
           EXIT.
      *****************************************************
      *COPY COLB3CAN
       GET-OPC SECTION.
       INI-GET-OPC.
           MOVE CAN-CIC-IOPC IN CAN TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FIN-GET-OPC.
           EXIT.

       GET-MON SECTION.
       INI-GET-MON.
           MOVE SPACES TO WSS-CIC-VCAM.
           MOVE 'TAB'        TO TAB-COD-SIST.
           MOVE 'VLR'        TO TAB-COD-TTAB IN TAB.
           MOVE SCR-COD-VCOC TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB
           IF MSG-COD-MENS NOT > SPACES
               MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-VCAM.
       FIN-GET-MON.
           EXIT.

       ACT-ICG SECTION.
       INI-ACT-ICG.
           MOVE SPACES                  TO  MSG-COD-MENS.
           MOVE CAN-NUM-ICAN IN CAN-FLD TO ICG-NUM-ICAN IN ICG.
           MOVE OPC-CIC-IOPC IN OPC     TO ICG-CIC-IOPC IN ICG.
           MOVE OPC-CIC-IOPC IN OPC     TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES                  TO ICG-NUM-IVCT IN ICG.
           MOVE 'INT'                   TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES                  TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF FIO-STAT-OKS
               MOVE '00' TO PGM-STAT-ICG
               MOVE 'ICGNUMEXIS'  TO  MSG-COD-MENS
               GO TO FIN-ACT-ICG
           ELSE
               MOVE '23' TO PGM-STAT-ICG.
      *
           MOVE OPC-CIC-IOPC IN OPC     TO ICG-CIC-IOPC IN ICG.
           MOVE OPC-CIC-IOPC IN OPC     TO ICG-CIC-IOPV IN ICG.
           MOVE CAN-NUM-ICAN IN CAN-FLD TO ICG-NUM-ICAN IN ICG.
           MOVE ZEROES                  TO ICG-NUM-IVCT IN ICG.
           MOVE 'INT'                   TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES                  TO ICG-FEC-FINI IN ICG.
           MOVE ZEROES                  TO ICG-FEC-FTER IN ICG.
           MOVE ZEROES                  TO ICG-SGV-SPRD IN ICG.
           MOVE ZEROES                  TO ICG-SGV-MNTO IN ICG.
           MOVE SPACES                  TO ICG-GLS-DISP IN ICG.
           MOVE SPACES                  TO ICG-COD-ATRN IN ICG.
      *
           IF SCR-COD-TICG > SPACES
               MOVE SCR-COD-TICG TO ICG-COD-TINT IN ICG.
      *
           IF ICG-COD-CVTI IN ICG > SPACES
               MOVE WSS-SGV-TINT IN WSS-VARI TO ICG-SGV-SPRD IN ICG
           ELSE
               MOVE WSS-SGV-TINT IN WSS-VARI TO ICG-SGV-TINT IN ICG.
      *
       PUT-REG-ICG.
           IF ICG-SGV-TINT IN ICG > ZEROES OR
              WSS-IBLK-TINT IN WSS-VARI NOT = 'S'
              MOVE FIO-PUT TO FIO-CMND
              PERFORM COL-FIO-ICG
              IF NOT FIO-STAT-OKS
                 MOVE 'NO-GRABA-REG-ICG' TO  MSG-COD-MENS.
       FIN-ACT-ICG.
           EXIT.

       ACT-RCV SECTION.
       INI-ACT-RCV.
      *
           MOVE SPACES TO MSG-COD-MENS.
      *
           MOVE OPC-CIC-IOPC IN OPC     TO RCV-CIC-IOPC IN RCV.
           MOVE OPC-CIC-IOPC IN OPC     TO RCV-CIC-IOPV IN RCV.
           MOVE CAN-NUM-ICAN IN CAN-FLD TO RCV-NUM-ICAN IN RCV.
           MOVE VEN-NUM-IVEN IN VEN     TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF FIO-STAT-OKS
              MOVE 'REGRCVEXIS>' TO MSG-COD-MENS
              GO TO FIN-ACT-RCV.
      *
           PERFORM MOVER-DATOS-RCV.
           PERFORM CAL-CAPI-REAJ.
      *
           MOVE SCR-RCV-STAT        TO RCV-MSC-STAT IN RCV.
           MOVE SCR-SGV-INTM        TO RCV-SGV-INTM IN RCV.
           MOVE SCR-SGV-INTN        TO RCV-SGV-INTN IN RCV.
      *
           IF WSS-CIC-TVAL = '0' AND WSS-CIC-VCAM NOT = '0999'
               PERFORM OBT-VAL-CAM
           ELSE
           IF WSS-CIC-VCAM = '0999'
               MOVE 1 TO WSS-SGV-VCAN IN WSS-VARI
               MOVE 1 TO WSS-SGV-VCOL IN WSS-VARI
               MOVE RCV-SGV-CAPI IN RCV TO WSS-SGV-CAPI IN WSS-VARI.

           COMPUTE
           WSS-SGV-CAPP IN WSS-VARI ROUNDED =
           RCV-SGV-CAPI IN RCV *   WSS-SGV-VCOL IN WSS-VARI.
      *
           MOVE WSS-SGV-CAPP IN WSS-VARI TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-CAPP IN WSS-VARI.

      * Boletas de garantia intereses son  :
      * SGV-INTN = Intereses Monatorios cancelados
           IF CAN-MSC-TCAN IN CAN NOT = 'P' AND
              WSS-OPEC IN WSS-VARI = 'B'
               COMPUTE
               RCV-SGV-INTN IN RCV = (CAN-SGV-TPAG IN CAN -
                                      CAN-SGV-GAST IN CAN -
                                      RCV-SGV-INTM IN RCV )
               GO TO PUT-REG-RCV.
      *
           IF CAN-MSC-TCAN IN CAN NOT = 'P' AND
              RCV-SGV-INTN IN RCV > ZEROES
               COMPUTE
               RCV-SGV-INTN IN RCV = ((CAN-SGV-TPAG IN CAN +
                                       CAN-SGV-TREN IN CAN ) -
                                       WSS-SGV-CAPP IN WSS-VARI -
                                       RCV-SGV-INTM IN RCV -
                                       CAN-SGV-GAST IN CAN -
                                       RCV-SGV-REAJ IN RCV )
               MOVE RCV-SGV-INTN IN RCV TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO RCV-SGV-INTN IN RCV
               GO TO PUT-REG-RCV.
      *
      * SGV-REAJ = Valores reajustables Cancelados.
           IF CAN-MSC-TCAN IN CAN NOT = 'P' AND
              RCV-SGV-REAJ IN RCV NOT = ZEROES
              COMPUTE
              RCV-SGV-REAJ IN RCV =(( CAN-SGV-TPAG IN CAN +
                                      CAN-SGV-TREN IN CAN ) -
                                      WSS-SGV-CAPP IN WSS-VARI -
                                      RCV-SGV-INTN IN RCV -
                                      CAN-SGV-GAST IN CAN -
                                      RCV-SGV-INTM )
              MOVE RCV-SGV-REAJ IN RCV TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO RCV-SGV-REAJ IN RCV
              GO TO PUT-REG-RCV.
      *
      * SGV-INTM = Intereses Monatorios cancelados.
           IF CAN-MSC-TCAN IN CAN NOT = 'P' AND
              RCV-SGV-REAJ IN RCV = ZEROES AND
              RCV-SGV-INTN IN RCV = ZEROES AND
              RCV-SGV-INTM IN RCV > ZEROES
      *
              COMPUTE
              RCV-SGV-INTM IN RCV = (( CAN-SGV-TPAG IN CAN +
                                       CAN-SGV-TREN IN CAN ) -
                                       CAN-SGV-GAST IN CAN -
                                       WSS-SGV-CAPP IN WSS-VARI )
              MOVE RCV-SGV-INTM IN RCV TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO RCV-SGV-INTM IN RCV.
       PUT-REG-RCV.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF NOT FIO-STAT-OKS
              MOVE 'NO-GRABA-REG-CYA' TO  MSG-COD-MENS.
       FIN-ACT-RCV.
           EXIT.

       CAL-CAPI-REAJ SECTION.
       INI-CAL-CAPI-REAJ.
           PERFORM GET-MON.
           IF NOT ( WSS-CIC-TVAL     = '0' AND
                    WSS-CIC-VCAM NOT = '0999' )
              GO TO FIN-CAL-CAPI-REAJ.
      *
           IF RCV-SGV-CAPI IN RCV NOT > ZEROES
               MOVE 0 TO WSS-SGV-CAPI
               GO TO FIN-CAL-CAPI-REAJ.
      *
           MOVE ZEROES TO WSS-SGV-TPAG.
           MOVE ZEROES TO WSS-VAL-INTE.
      *
           MOVE '0999  '            TO TAB-CIC-CTAB IN TAB.
           MOVE SCR-COD-VCOC        TO TAB-COD-CTAB IN TAB.
           MOVE CAN-FEC-FCAN IN CAN TO TAB-FEC-FTRN IN TAB.
           PERFORM GET-VCAM.
           IF MSG-COD-MENS = SPACES AND
              CAM-SGV-VCAM IN CAM > ZEROES
      *
              IF CAN-MSC-TCAN IN CAN = 'C'
                 COMPUTE
                 WSS-VAL-INTE ROUNDED = (CAN-SGV-TREN IN CAN +
                                         CAN-SGV-TPAG IN CAN)
                                          / CAM-SGV-VCAM IN CAM
      *
                 MOVE WSS-VAL-INTE    TO  WSS-SGV-TPAG
                 DIVIDE SCR-SGV-IPFC BY CAM-SGV-VCAM IN CAM
                 GIVING WSS-VAL-INTE ROUNDED.
      *
      *PAGADO en moneda reajustable
           IF WSS-SGV-TPAG NOT > WSS-VAL-INTE
               MOVE ZEROES TO WSS-SGV-CAPI
           ELSE
               SUBTRACT WSS-VAL-INTE FROM WSS-SGV-TPAG
                 GIVING WSS-SGV-CAPI.
      *
           IF WSS-SGV-CAPI > RCV-SGV-CAPI IN RCV
              MOVE RCV-SGV-CAPI IN RCV TO WSS-SGV-CAPI.
      *
      *------------------>
      *
           IF WSS-CIC-TVAL = '0'   AND
              WSS-CIC-VCAM NOT = '0999'
               PERFORM OBT-VAL-CAM
           ELSE
           IF WSS-CIC-VCAM = '0999'
               MOVE 1 TO WSS-SGV-VCAN IN WSS-VARI
               MOVE 1 TO WSS-SGV-VCOL IN WSS-VARI.

           MULTIPLY WSS-SGV-CAPI BY  WSS-SGV-VCAN IN WSS-VARI
             GIVING WSS-SGV-RAFC.

           IF MSG-COD-MENS = SPACES
              MULTIPLY WSS-SGV-CAPI BY WSS-SGV-VCOL IN WSS-VARI
              GIVING   WSS-SGV-RAFO.

           SUBTRACT WSS-SGV-RAFO FROM WSS-SGV-RAFC
           GIVING   RCV-SGV-REAJ IN RCV.
      *
           MOVE RCV-SGV-REAJ IN RCV TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO RCV-SGV-REAJ IN RCV.
       FIN-CAL-CAPI-REAJ.
           EXIT.

       BUS-COR-CAN SECTION.
       INI-BUS-COR-CAN.
      *
           MOVE SPACES        TO MSG-COD-MENS.
           MOVE OPC-CIC-IOPC IN OPC TO CAN-CIC-IOPC IN CAN.
           MOVE 999                 TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CAI-IOPC IN OPC = CAN-CAI-IOPC IN CAN AND
                    OPC-IIC-IOPC IN OPC = CAN-IIC-IOPC IN CAN )
               MOVE '23'    TO FIO-STAT
               MOVE ZEROS   TO CAN-NUM-ICAN IN CAN-FLD.
      *
           ADD  1 TO CAN-NUM-ICAN IN CAN-FLD.
           MOVE 1 TO WSS-ICOR.
      *
           MOVE 'NOEXISTECAN' TO MSG-COD-MENS.
      *Compara fecha de cancelacion, fecha can ultima.
       LEE-NXT-CAN.
           IF FIO-STAT-OKS
              IF CAN-MSC-STAT IN CAN NOT = 'A'
                 MOVE 'CAN  ANTNACT' TO MSG-COD-MENS
                 DISPLAY MSG-COD-MENS
                 GO TO FIN-VAL-CAN-FEC-FCAN.
      *
           IF FIO-STAT-OKS
               IF CAN-MSC-STAT IN CAN NOT = 'R' AND
                  CAN-SGV-TPAG IN CAN NOT < ZEROES AND
                  CAN-SGV-TREN IN CAN NOT < ZEROES
      *
                   MOVE CAN-NUM-SCAN IN CAN     TO FEC-SEC1
                   MOVE CAN-NUM-ACAN IN CAN     TO FEC-AEC1
                   MOVE CAN-NUM-MCAN IN CAN     TO FEC-MEC1
                   MOVE CAN-NUM-DCAN IN CAN     TO FEC-DEC1
                   MOVE CAN-FEC-FCAN IN CAN-FLD TO FEC-FEC2
                   MOVE FEC-FORM-FEC            TO FEC-FORM
                   MOVE FEC-CMP-FEC             TO FEC-CMND
                   PERFORM PRO-FEC
                   IF FEC-STAT-GRT
                       MOVE 'FECFCANANT>' TO MSG-COD-MENS
                       GO TO FIN-VAL-CAN-FEC-FCAN
                   ELSE
                       MOVE 'EXISTECAN' TO MSG-COD-MENS
               ELSE
                   GO TO LEE-NXT-CAN.

           IF MSG-COD-MENS = 'EXISTECAN'
               MOVE SPACES TO MSG-COD-MENS.
      *
           IF MSG-COD-MENS = 'NOEXISTECAN'
               MOVE SPACES              TO MSG-COD-MENS
               MOVE OPC-CAI-IOPC IN OPC TO DLC-CAI-IOPC IN DLC
               MOVE OPC-IIC-IOPC IN OPC TO DLC-IIC-IOPC IN DLC
               MOVE ZEROES              TO DLC-NUM-IDLC IN DLC
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM COL-FIO-DLC
      *
               IF FIO-STAT-OKS AND
                  OPC-CAI-IOPC IN OPC = DLC-CAI-IOPC IN DLC AND
                  OPC-IIC-IOPC IN OPC = DLC-IIC-IOPC IN DLC
                   IF DLC-IND-SCTB IN DLC = 'VCD' OR
                      DLC-IND-SCTB IN DLC = 'CAS'
      *
                       MOVE CAN-FEC-FCAN IN CAN-FLD TO FEC-FEC1
                       MOVE VEN-NUM-SIMV IN VEN     TO FEC-SEC2
                       MOVE VEN-NUM-AIMV IN VEN     TO FEC-AEC2
                       MOVE VEN-NUM-MIMV IN VEN     TO FEC-MEC2
                       MOVE VEN-NUM-DIMV IN VEN     TO FEC-DEC2
                       MOVE FEC-FORM-FEC            TO FEC-FORM
                       MOVE FEC-CMP-FEC             TO FEC-CMND
                       PERFORM PRO-FEC
                       IF FEC-STAT-LES
                           MOVE 'FECFCANFIMV<' TO MSG-COD-MENS
                           GO TO FIN-VAL-CAN-FEC-FCAN.
      *
      *Compara fecha de cancelacion, fecha colocacion.
           IF CAN-FEC-FCAN IN CAN-FLD > ZEROES
               MOVE CAN-FEC-FCAN IN CAN-FLD TO FEC-FEC1
               MOVE OPC-NUM-SCOL IN OPC     TO FEC-SEC2
               MOVE OPC-NUM-ACOL IN OPC     TO FEC-AEC2
               MOVE OPC-NUM-MCOL IN OPC     TO FEC-MEC2
               MOVE OPC-NUM-DCOL IN OPC     TO FEC-DEC2
               MOVE FEC-FORM-FEC            TO FEC-FORM
               MOVE FEC-CMP-FEC             TO FEC-CMND
               PERFORM PRO-FEC
               IF FEC-STAT-LES
                   MOVE 'FECFCANFCOL<' TO MSG-COD-MENS
                   GO TO FIN-VAL-CAN-FEC-FCAN.

           MOVE CAN-NUM-DCAN IN CAN-FLD to WSS-NUM-DAUX IN WSS-VARI.
           MOVE CAN-NUM-MCAN IN CAN-FLD TO WSS-NUM-MAUX IN WSS-VARI.
           MOVE CAN-NUM-SCAN IN CAN-FLD TO WSS-NUM-SAUX IN WSS-VARI.
           MOVE CAN-NUM-ACAN IN CAN-FLD TO WSS-NUM-AAUX IN WSS-VARI.
       FIN-VAL-CAN-FEC-FCAN.
       FIN-BUS-COR-CAN.
           EXIT.


       GET-CUR-ITR SECTION.
       INI-GET-CUR-ITR.
      *TASA DEL CREDITO
           MOVE 'ITR-KEY-IICG'      TO FIO-AKEY.
           MOVE OPC-CIC-IOPC IN OPC TO ITR-CIC-IOPC IN ITR.
           MOVE ZEROES              TO ITR-NUM-ICAN IN ITR.
           MOVE SPACES              TO ITR-CIC-IOPV IN ITR.
           MOVE ZEROES              TO ITR-NUM-IVCT IN ITR.
           MOVE 'INT'               TO ITR-IND-TTAS IN ITR.
           MOVE ZEROES              TO ITR-FEC-FINI IN ITR.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ITR.
           IF FIO-STAT-OKS AND
              ITR-CIC-IOPC IN ITR = CAN-CIC-IOPC IN CAN AND
              ITR-NUM-ICAN IN ITR = ZEROES              AND
              ITR-CIC-IOPV IN ITR = SPACES              AND
              ITR-NUM-IVCT IN ITR = ZEROES              AND
              ITR-IND-TTAS IN ITR = 'INT'
               MOVE '00' TO PGM-STAT-ITR
           ELSE
               MOVE '23' TO PGM-STAT-ITR.
       FIN-GET-CUR-ITR.
           EXIT.


       GET-CUR-ICG SECTION.
       INI-GET-CUR-ICG.
           MOVE CAN-CIC-IOPC IN CAN TO ICG-CIC-IOPC IN ICG.
           MOVE CAN-NUM-ICAN IN CAN-FLD TO ICG-NUM-ICAN IN ICG.
           MOVE CAN-CIC-IOPC IN CAN     TO ICG-CIC-IOPV IN ICG
           MOVE ZEROES                  TO ICG-NUM-IVCT IN ICG
           MOVE 'INT'                   TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES                  TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF FIO-STAT-OKS
               MOVE '00' TO PGM-STAT-ICG
           ELSE
               MOVE '23' TO PGM-STAT-ICG.
       FIN-GET-CUR-ICG.
           EXIT.

      *****************************************************
      *          RUTINAS DEL INICIO DEL PROGRAMA
      *****************************************************

      *****************************************************
      *CARGA TABLA DE TIPOS DE BANCAS ( CODIGOS Y DIAS )
      *****************************************************
       BUS-DIA-ANTE SECTION.
       INI-BUS-DIA-ANTE.
      *VAL-FEC Retrocede Dias del Parametro (Calendario)
       BUS-DIA-HBL.
           MOVE WSS-FEC-FMIN TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-RST-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
           PERFORM CAL-FEC.
           MOVE FEC-FECH TO WSS-FEC-FINI.

      *VAL-FEC Validar Fecha
           MOVE WSS-FEC-FINI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF WSS-CNT-DIAS IN WSS-VARI < WSS-DIAS-MORA
              MOVE WSS-FEC-FINI IN WSS-VARI TO WSS-FEC-FMIN IN WSS-VARI
              ADD   1           TO WSS-CNT-DIAS IN WSS-VARI
              GO TO BUS-DIA-HBL.
      *
      *VAL-FEC Retrocede Dias Hasta siguiente Habil
       RET-DIA-HBL.
           MOVE WSS-FEC-FMIN TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-RST-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
           PERFORM CAL-FEC.
           MOVE FEC-FECH TO WSS-FEC-FINI.

      *VAL-FEC Validar Fecha
           MOVE WSS-FEC-FINI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-FER
              MOVE WSS-FEC-FINI IN WSS-VARI TO WSS-FEC-FMIN IN WSS-VARI
              GO TO RET-DIA-HBL.

           MOVE WSS-FEC-FMIN IN WSS-VARI TO WSS-FEC-FINI IN WSS-VARI.
           MOVE WSS-NUM-DMIN IN WSS-VARI TO WSS-NUM-DUNO IN WSS-VARI.
           MOVE WSS-NUM-MMIN IN WSS-VARI TO WSS-NUM-MUNO IN WSS-VARI.
           MOVE WSS-NUM-SMIN IN WSS-VARI TO WSS-NUM-SUNO IN WSS-VARI.
           MOVE WSS-NUM-AMIN IN WSS-VARI TO WSS-NUM-AUNO IN WSS-VARI.
       FIN-BUS-DIA-ANTE.
           EXIT.
      *
       BUS-DIA-POST SECTION.
      *---------------------
       INI-BUS-DIA-POST.
      *VAL-FEC Va sumando un dia hasta encontrar el siguiente dia habil
       SUM-DIA-NHBL.
           MOVE WSS-NUM-DPO2 TO FEC-ITM1.
           MOVE WSS-NUM-MPO2 TO FEC-ITM2.
           MOVE WSS-NUM-SPO2 TO FEC-ITM3.
           MOVE WSS-NUM-APO2 TO FEC-ITM4.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-SUM-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
           PERFORM CAL-FEC.
           MOVE FEC-ITM1 TO WSS-NUM-DPO2.
           MOVE FEC-ITM2 TO WSS-NUM-MPO2.
           MOVE FEC-ITM3 TO WSS-NUM-SPO2.
           MOVE FEC-ITM4 TO WSS-NUM-APO2.

      *VAL-FEC Validar Fecha
           MOVE WSS-NUM-DPO2 TO FEC-ITM1.
           MOVE WSS-NUM-MPO2 TO FEC-ITM2.
           MOVE WSS-NUM-SPO2 TO FEC-ITM3.
           MOVE WSS-NUM-APO2 TO FEC-ITM4.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-FER
              IF WSS-FEC-FPO1 IN WSS-VARI NOT > ZEROES
                 MOVE WSS-FEC-FPO2 IN WSS-VARI TO WSS-FEC-FPO1
                                                   IN WSS-VARI
                 GO TO SUM-DIA-NHBL
              ELSE
                 MOVE WSS-FEC-FPO2 IN WSS-VARI TO WSS-FEC-FPO3
                                                   IN WSS-VARI
                 GO TO SUM-DIA-NHBL.

           IF WSS-FEC-FPO3 = ZEROES
              MOVE WSS-FEC-FPO1 IN WSS-VARI TO WSS-FEC-FPO2 IN WSS-VARI
           ELSE
              MOVE WSS-FEC-FPO3 IN WSS-VARI TO WSS-FEC-FPO2 IN WSS-VARI.
      *
           IF WSS-FEC-FPO2 IN WSS-VARI > ZEROES
              MOVE WSS-FEC-FPO2 IN WSS-VARI TO WSS-FEC-FTER
                                                IN WSS-VARI
      *
              MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DBOL
              MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MBOL
              MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-SBOL
              MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-ABOL.
       FIN-BUS-DIA-POST.
           EXIT.

       CARGA-TAB-TBAN SECTION.
      *-----------------------
       INI-CARGA-TAB-TBAN.
           MOVE 'NEX'   TO TBAN-COD-TBAN(1).
           MOVE ZEROES  TO TBAN-NUM-NDIA(1).
           MOVE 1       TO TBAN-J.
           MOVE 1       TO TBAN-IMAX.
           MOVE ZEROES  TO WSS-DIAS-MORA.
           MOVE 'SGC'   TO TAB-COD-SIST FIO-SIST.
           MOVE 'BAN '  TO TAB-COD-TTAB IN TAB.
           MOVE SPACES  TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-CARGA-TAB-TBAN.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND
              TAB-COD-TTAB IN TAB = 'BAN' )
               GO TO FIN-CARGA-TAB-TBAN.

            IF NOT ( TAB-COD-CTAB IN TAB > SPACES AND
               TAB-IND-VIGE IN TAB = 'S' )
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO LUP-CARGA-TAB-TBAN.

             ADD 1 TO TBAN-IMAX.

             IF TBAN-IMAX > TBAN-OMAX
                 GO TO FIN-CARGA-TAB-TBAN.

              MOVE TAB-COD-CTAB IN TAB TO TBAN-COD-TBAN(TBAN-IMAX).
              MOVE TAB-GLS-DATA IN TAB TO TBAN-GLS-DATA.

              IF TBAN-NUM-DREI NOT NUMERIC
                  MOVE ZEROES TO TBAN-NUM-NDIA(TBAN-IMAX)
              ELSE
                  MOVE TBAN-NUM-DREI TO TBAN-NUM-NDIA(TBAN-IMAX).

           IF TBAN-NUM-NDIA(TBAN-IMAX) > WSS-DIAS-MORA
               MOVE TBAN-IMAX                TO TBAN-J
               MOVE TBAN-NUM-NDIA(TBAN-IMAX) TO WSS-DIAS-MORA.

           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-CARGA-TAB-TBAN.
       FIN-CARGA-TAB-TBAN.
           EXIT.
      *SI PARA DISTINTAS BANCAS ES EL MISMO NUMERO DE DIAS ESTA
      *RUTINA LLENA TODAS LAS FECHAS QUE CORRESPONDAN A ESE
      *NUMERO DE DIAS.

      ******************************************************************

       LLE-FEC-TBAN SECTION.
      *---------------------
       INI-LLE-FEC-TBAN.
           MOVE 1 TO TBAN-J.
       LUP-LLE-FEC-TBAN.
           IF TBAN-J > TBAN-IMAX
               GO TO FIN-LLE-FEC-TBAN.
           IF TBAN-NUM-NDIA(TBAN-J) = TBAN-NUM-NDIA(TBAN-I)
               MOVE WSS-NUM-DMIN IN WSS-VARI TO TBAN-NUM-DBAN(TBAN-J)
               MOVE WSS-NUM-MMIN IN WSS-VARI TO TBAN-NUM-MBAN(TBAN-J)
               MOVE WSS-NUM-SMIN IN WSS-VARI TO TBAN-NUM-SBAN(TBAN-J)
               MOVE WSS-NUM-AMIN IN WSS-VARI TO TBAN-NUM-ABAN(TBAN-J).
           ADD 1 TO TBAN-J.
           GO TO LUP-LLE-FEC-TBAN.
       FIN-LLE-FEC-TBAN.
           EXIT.

      *DETERMINA LAS FECHAS DE INICIO PARA CADA TIPO DE BANCA
      ******************************************************************
       DET-FEC-TBAN SECTION.
      *---------------------
       INI-DET-FEC-TBAN.
           MOVE 1 TO TBAN-I.
       LUP-DET-FEC-TBAN.
           IF TBAN-I > TBAN-IMAX
               GO TO FIN-DET-FEC-TBAN.

           IF TBAN-FEC-FBAN(TBAN-I) > ZEROES
               ADD 1 TO TBAN-I
               GO TO LUP-DET-FEC-TBAN.

           MOVE TBAN-NUM-NDIA(TBAN-I)    TO WSS-DIAS-MORA.
           MOVE ZEROES                   TO WSS-CNT-DIAS IN WSS-VARI.
           MOVE WSS-FEC-FPRO IN WSS-VARI TO WSS-FEC-FMIN IN WSS-VARI.
      *VAL-FEC Retrocede Dias del Parametro (Calendario)
       BUS-DIA-HBL-TBAN.
           MOVE WSS-FEC-FMIN TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-RST-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
           PERFORM CAL-FEC.
           MOVE FEC-FECH TO WSS-FEC-FIN1.
           IF WSS-CNT-DIAS IN WSS-VARI < WSS-DIAS-MORA
              MOVE WSS-FEC-FIN1 IN WSS-VARI TO WSS-FEC-FMIN IN WSS-VARI
              ADD   1           TO WSS-CNT-DIAS IN WSS-VARI
              GO TO BUS-DIA-HBL-TBAN.
      *
      *VAL-FEC Retrocede Dias Hasta siguiente Habil
       RET-DIA-HBL-TBAN.
           MOVE WSS-FEC-FMIN TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-RST-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
           PERFORM CAL-FEC.
           MOVE FEC-FECH TO WSS-FEC-FIN1.

      *VAL-FEC Validar Fecha
           MOVE WSS-FEC-FIN1 TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-FER
              MOVE WSS-FEC-FIN1 IN WSS-VARI TO WSS-FEC-FMIN IN WSS-VARI
              GO TO RET-DIA-HBL-TBAN.
      *
      *     DISPLAY 'MAS DE UN DIA DE MORA'.
           MOVE WSS-DIAS-MORA IN WSS-VARI TO TBAN-NUM-NDIA(TBAN-I).
           PERFORM LLE-FEC-TBAN.
           ADD 1 TO TBAN-I.
           GO TO LUP-DET-FEC-TBAN.
       FIN-DET-FEC-TBAN.
           EXIT.
      *VALIDA QUE VENCIMIENTO CORRESPONDA POR PERIODO DE
      *TIPO DE BANCA
      ******************************************************************
       DET-PRD-BANCA SECTION.
      *----------------------
       INI-DET-PRD-BANCA.
      *    DISPLAY ' VALIDA TIPO BANCA '.
           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
              MOVE 'CLI    INEX' TO MSG-COD-MENS
              GO TO FIN-DET-PRD-BANCA.
      *
           IF DBC-IND-TICL IN DBC = 'P'
              MOVE DBC-CIC-ICLI IN DBC TO DCP-CIC-ICLI IN DCP
              MOVE FIO-GET-KEY TO FIO-CMND
              PERFORM SGC-FIO-DCP
              IF FIO-STAT-OKS
                  MOVE DCP-COD-TBAN IN DCP TO TBAN-AUXI-TBAN
               ELSE
                   MOVE 'DCP    NEX' TO MSG-COD-MENS
                   GO TO FIN-DET-PRD-BANCA
           ELSE
               MOVE DBC-CIC-ICLI IN DBC TO DCE-CIC-ICLI IN DCE
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM SGC-FIO-DCE
               IF FIO-STAT-OKS
                   MOVE DCE-COD-TBAN IN DCE TO TBAN-AUXI-TBAN
               ELSE
                   MOVE 'DCE    NEX' TO MSG-COD-MENS
                   GO TO FIN-DET-PRD-BANCA.
      *
           MOVE 1 TO TBAN-I.
      *    DISPLAY 'TIPO BANCA : ' TBAN-AUXI-TBAN.
       LUP-DET-PRD-BANCA.
           IF TBAN-I > TBAN-IMAX
                DISPLAY 'BANCA NO VALIDA OPC : ' OPC-CIC-IOPC IN OPC
                MOVE TBAN-FEC-FBAN(1) TO TBAN-FEC-FAUX
                GO TO EXT-DET-PRD-BANCA.
      *
           IF TBAN-COD-TBAN(TBAN-I) = TBAN-AUXI-TBAN
               MOVE TBAN-FEC-FBAN(TBAN-I) TO TBAN-FEC-FAUX
               GO TO EXT-DET-PRD-BANCA.
           ADD 1 TO TBAN-I.
           GO TO LUP-DET-PRD-BANCA.
       EXT-DET-PRD-BANCA.
      *     DISPLAY 'FVEN : ' VEN-FEC-FVEN IN VEN.
      *     DISPLAY 'FAUX : ' TBAN-FEC-FAUX.
           IF VEN-FEC-FVEN IN VEN < TBAN-FEC-FAUX
              MOVE 'OTRO-VEN' TO MSG-COD-MENS.
       FIN-DET-PRD-BANCA.
           EXIT.
       COPY TABBBTXC.
      *****************************************************
       SEL-OFI-PRMT SECTION.
      *----------------------
       INI-SEL-OFI-PRMT.
           ADD 1 TO WSS-I.
       FIN-SEL-OFI-PRMT.
           EXIT.

      ******************************************************************

       BUS-CYA-AUT SECTION.
      *--------------------
       INI-BUS-CYA-AUT.
           MOVE VEN-CIC-IOPC IN VEN TO AUT-CIC-IOPC IN AUT.
           MOVE 'AUT'               TO AUT-NUM-ICAN IN AUT.
           MOVE 1                   TO AUT-NUM-ICYA IN AUT.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-AUT.
           IF FIO-STAT-OKS
               MOVE AUT TO CYA.
       FIN-BUS-CYA-AUT.
           EXIT.

      ******************************************************************
      * DETERMINA DE QUIEN ES CTA.CTE CARGO(MISMO/OTRO) CLIENT
       DET-CLI-CCTE SECTION.
      *---------------------
       INI-DET-CLI-CCTE.
           MOVE SPACES TO WSS-MSC-CCAA IN WSS-VARI
                          MSG-COD-MENS.
      * Busca CIC del Cliente con el CIC del Credito en RDC
      * RDC-NUM-IDLC = 0 ====> DEU.DIR.
           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC'      TO FIO-AKEY.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT FIO-STAT-OKS
               MOVE 'RDC    NOCLI'      TO MSG-COD-MENS
               MOVE RDC-KEY-IDLC IN RDC TO WSS-GLS-MEN2
               GO TO FIN-DET-CLI-CCTE.

           PERFORM DET-PRD-BANCA.
           IF MSG-COD-MENS > SPACES
               GO TO FIN-DET-CLI-CCTE.

      * Chequea pertenesca al Cliente Credito la Cta.Cte de cargo en RCO
           MOVE RDC-CIC-ICLI IN RDC TO RCO-CIC-ICLI IN RCO.
           MOVE CYA-CIC-ICYA IN CYA TO RCO-CIC-IOPE IN RCO.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF FIO-STAT-OKS
               MOVE WSS-MSC-CCAM IN WSS-VARI TO WSS-MSC-CCAA IN WSS-VARI
               GO TO VIG-DET-CLI-CCTE.

      * Chequea pertenesca a Otro Cliente la Cta.Cte de cargo en RCO
           MOVE CYA-CIC-ICYA IN CYA TO RCO-CIC-IOPE IN RCO.
           MOVE 'RCO-KEY-IOPE' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF NOT FIO-STAT-OKS
               MOVE 'CICICYACCNEX'      TO MSG-COD-MENS
               MOVE CYA-CIC-ICYA IN CYA TO WSS-GLS-MEN2
               GO TO FIN-DET-CLI-CCTE.
      *
           MOVE WSS-MSC-CCAO IN WSS-VARI TO WSS-MSC-CCAA IN WSS-VARI.

       VIG-DET-CLI-CCTE.
           MOVE RCO-CIC-IOPE IN RCO TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF OPE-FEC-FTOP IN OPE > ZEROES
               IF OPE-FEC-FTOP IN OPE > OPE-FEC-FROP IN OPE
                   MOVE 'FECFTOPICYA>'      TO MSG-COD-MENS
                   MOVE OPE-CIC-IOPE IN OPE TO WSS-GLS-MEN2.
       FIN-DET-CLI-CCTE.
           EXIT.
      ******************************************************************
       PRO-MORA-TMC SECTION.
       INI-PRO-MORA-TMC.
           PERFORM BUS-CIC-PLZO.
           IF FRM-SUAR = FRM-SUAR-MAL
               GO TO FIN-PRO-MORA-TMC.
      *
           MOVE CAN-NUM-DCAN IN CAN TO TMC-NUM-DTMC IN TMC.
           MOVE CAN-NUM-MCAN IN CAN TO TMC-NUM-MTMC IN TMC.
           MOVE CAN-NUM-ACAN IN CAN TO TMC-NUM-ATMC IN TMC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-TMC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'         TO MSG-COD-SIST
               MOVE 'TASDNEXFCAN' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL  TO FRM-SUAR
               GO TO FIN-PRO-MORA-TMC.
      *
           IF WSS-CIC-VCAM = '0998'
               MOVE TMC-SGV-UFAC IN TMC TO WSS-SGV-CANT
           ELSE
           IF WSS-PLZO-B90
               MOVE TMC-SGV-89AC IN TMC TO WSS-SGV-CANT
           ELSE
               MOVE TMC-SGV-PEAC IN TMC TO WSS-SGV-CANT.

           MOVE WSS-NUM-DUPM IN WSS-VARI TO TMC-NUM-DTMC IN TMC.
           MOVE WSS-NUM-MUPM IN WSS-VARI TO TMC-NUM-MTMC IN TMC.
           MOVE WSS-NUM-AUPM IN WSS-VARI TO TMC-NUM-ATMC IN TMC.

           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-TMC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'         TO MSG-COD-SIST
               MOVE 'TASDNEXFVEN' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL  TO FRM-SUAR
               GO TO FIN-PRO-MORA-TMC.
      *
           IF WSS-CIC-VCAM = '0998'
               MOVE TMC-SGV-UFAC IN TMC TO WSS-SGV-VENT
           ELSE
           IF WSS-PLZO-B90
               MOVE TMC-SGV-89AC IN TMC TO WSS-SGV-VENT
           ELSE
               MOVE TMC-SGV-PEAC IN TMC TO WSS-SGV-VENT.
      *
           SUBTRACT WSS-SGV-VENT FROM WSS-SGV-CANT
             GIVING WSS-SGV-MTMC.
      *
           DIVIDE WSS-SGV-MTMC BY 36000
           GIVING WSS-INT-TIPE ROUNDED.
      *
           IF WSS-IBLK-TINT = 'S'
               MOVE '1'            TO  FRM-IND-TIPE IN CAN-FLD
               MOVE WSS-INT-TIPE   TO  INT-TIPE
               MULTIPLY WSS-INT-TIPE       BY 100
                 GIVING WSS-SGV-TINT IN  WSS-VARI
      *
               DIVIDE  WSS-SGV-TINT IN WSS-VARI BY 100
               GIVING  INT-TIPE
               PERFORM GLS-INT-TIPE
               GO TO FIN-PRO-MORA-TMC.
      *
           IF FRM-IND-TIPE IN CAN-FLD > SPACES
               DIVIDE WSS-SGV-TINT IN WSS-VARI BY 100
               GIVING INT-TIPE
               MOVE 'S'   TO   WSS-IBLK-TINT
               PERFORM GLS-INT-TIPE
               GO TO CMP-INT-TIPE.
      *
           MOVE SPACES              TO FRM-IND-TIPE IN CAN-FLD.
           MOVE ITR-COD-TINT IN ITR TO INT-TIPT.
           MOVE WSS-SGV-TINT IN WSS-VARI TO INT-TINT.
           MOVE SPACES TO INT-CVTI.
      *
      *    Cambio  OPC-NUM-xCOL IN OPC  x  WSS-NUM-xUPM  --->  INT-xDMA
           MOVE WSS-NUM-DUPM            TO INT-DDMA.
           MOVE WSS-NUM-MUPM            TO INT-MDMA.
           MOVE WSS-NUM-SUPM            TO INT-SDMA.
           MOVE WSS-NUM-AUPM            TO INT-ADMA.
           MOVE OPC-COD-VCOC IN OPC     TO INT-VCAM.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG            TO MSG-COD-MENS
               MOVE CAM-KEY-CAMB IN CAM TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-PRO-MORA-TMC.
      *
       CMP-INT-TIPE.
           IF INT-TIPE > WSS-INT-TIPE
               MOVE 'COL'         TO MSG-COD-SIST
               MOVE 'CANTIPE>TMC' TO MSG-COD-MENS
               MOVE FRM-SUAR-MAL  TO FRM-SUAR.
       FIN-PRO-MORA-TMC.
           EXIT.
      ********************************************************
       BUS-REG-RCV SECTION.
      *--------------------
       INI-BUS-REG-RCV.
           MOVE 'P'                 TO WSS-COD-IPAR.
           MOVE SPACES              TO MSG-COD-MENS.
           MOVE SPACES              TO WSS-RCV-CIC-IOPC-P IN WSS-VARI.
           MOVE ZEROES              TO WSS-RCV-NUM-ICAN-P IN WSS-VARI.
           MOVE VEN-CIC-IOPC IN VEN TO RCV-CIC-IOPV IN RCV.
           MOVE WSS-NUM-IVCT        TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-BUS-REG-RCV.
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           PERFORM COL-FIO-RCV.
           IF NOT ( FIO-STAT-OKS AND
                    RCV-CIC-IOPV IN RCV = VEN-CIC-IOPC IN VEN AND
                    RCV-NUM-IVCT IN RCV = WSS-NUM-IVCT )
               GO TO CON-BUS-REG-RCV.
      *
           IF WSS-COD-IPAR = 'P'
               MOVE 'I' TO WSS-COD-IPAR
           ELSE
               MOVE 'P' TO WSS-COD-IPAR.
      *
           IF RCV-NUM-ICAN IN RCV > WSS-RCV-NUM-ICAN-P IN WSS-VARI
               MOVE RCV-SGV-FINA IN RCV TO WSS-SGV-FINA IN WSS-VARI
               MOVE RCV-SGV-CAPI IN RCV TO WSS-SGV-CAPI IN WSS-VARI
               MOVE RCV-KEY-ICAN IN RCV TO WSS-RCV-KEY-ICAN
                                                        IN WSS-VARI.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-BUS-REG-RCV.

       CON-BUS-REG-RCV.
           IF WSS-RCV-CIC-IOPC-P IN WSS-VARI NOT > SPACES
               GO TO FIN-BUS-REG-RCV.

           MOVE WSS-RCV-KEY-ICAN IN WSS-VARI TO CAN-KEY-ICAN IN CAN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
              GO TO FIN-BUS-REG-RCV.
      *
           IF CAN-MSC-STAT IN CAN = 'G' OR
              CAN-MSC-STAT IN CAN = 'H' OR
              CAN-MSC-STAT IN CAN = 'P' OR
              CAN-MSC-STAT IN CAN = 'S' OR
              CAN-MSC-STAT IN CAN = 'W' OR
              CAN-MSC-STAT IN CAN = 'C' OR
              CAN-MSC-STAT IN CAN = 'I' OR
              CAN-MSC-STAT IN CAN = 'V'
                MOVE 'CAN    YAEXI'      TO MSG-COD-MENS
                MOVE CAN-KEY-ICAN IN CAN TO WSS-GLS-MEN2
                GO TO FIN-BUS-REG-RCV.

      *Si existen CTT ( existen antiguas que no tienen cambiado el
      *SIGNO ==> QUE SI EXISTEN CTT PARES ASUME REVERSA )
           IF CAN-MSC-STAT IN CAN NOT = 'A'
              DISPLAY 'CANCELACION CON STATUS DESCONOCIDO : '
                       CAN-MSC-STAT IN CAN
                       MOVE 'CAN    YAEXI'      TO MSG-COD-MENS
                       MOVE CAN-KEY-ICAN IN CAN TO WSS-GLS-MEN2.
                       GO TO FIN-BUS-REG-RCV.
      *
           IF WSS-NUM-IVCT = 0
             IF WSS-SGV-FINA IN WSS-VARI < ZEROES OR
                WSS-SGV-CAPI IN WSS-VARI < ZEROES OR
                WSS-COD-IPAR = 'P'
                GO TO FIN-BUS-REG-RCV
              ELSE
                 MOVE 'CAN    YAEXI'      TO MSG-COD-MENS
                 MOVE CAN-KEY-ICAN IN CAN TO WSS-GLS-MEN2
           ELSE
           IF WSS-SGV-FINA IN WSS-VARI NOT < ZEROES AND
              WSS-SGV-CAPI IN WSS-VARI NOT < ZEROES
              MOVE 'CAN    YAEXI'      TO MSG-COD-MENS
              MOVE CAN-KEY-ICAN IN CAN TO WSS-GLS-MEN2
           ELSE
              GO TO FIN-BUS-REG-RCV.
       FIN-BUS-REG-RCV.
           EXIT.
      ********************************************************

       CLOSE-FILE SECTION.
      *------------------
       INI-CLOSE-FILE.
      *
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-TMC.
           PERFORM COL-FIO-OPC.
           PERFORM COL-FIO-CYA.
           PERFORM COL-FIO-VEN.
           PERFORM COL-FIO-VES.
           PERFORM COL-FIO-RCV.
           PERFORM COL-FIO-CAN.
           PERFORM COL-FIO-RDC.
           PERFORM SGC-FIO-OPE.
           PERFORM SGC-FIO-RCO.
       FIN-CLOSE-FILE.
           EXIT.
      **************************************************
       CHK-PNT SECTION.
      *----------------
       INI-CHK-PNT.
           MOVE FIO-CHK-PNT TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
               DISPLAY 'CHECK-PNT ERRONEO'.
       FIN-CHK-PNT.
           EXIT.
       BCK-OUT SECTION.
      *----------------
       INI-BCK-OUT.
           MOVE FIO-BCK-OUT TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF FIO-STAT-OKS
      *        Para informar que el backout se realizo con exito
               MOVE '49' TO FIO-STAT.
       FIN-BCK-OUT.
           EXIT.
      **************************************************
       COPY COLBFOPC.
       COPY COLBFCYA.
       COPY COLBFAUT.
       COPY COLBFVEN.
       COPY COLBFVES.
       COPY COLBFRCV.
       COPY COLBFCAN.
       COPY COLBFTOC.
       COPY COLBFRDT.
       COPY COLBFDLC.
       COPY COLBFEVC.
       COPY COLBFICG.
       COPY COLBFRDC.
       COPY COLBFCOM.
       COPY COLBFEJC.
       COPY COLBFITR.
       COPY COLBFPOC.
      *
       COPY COLBGVEN.
       COPY COLBGCTO.
       COPY COLBGINT.
       COPY COLBGCLI.
       COPY COLBGVDI.
       COPY COLBGMPC.
       COPY COLIOTMC.
      *
       COPY SGCBFRCO.
       COPY SGCBFOPE.
       COPY TABBFCAM.
       COPY TABBVOFI.
       COPY TABBFOFI.
       COPY GNSBFMSG.
       COPY GNSBFMSC.
       COPY GNSBFTAB.
       COPY GNSBBTAB.
       COPY GNSBBMSG.
       COPY GNSBBMSC.
       COPY GNSBGCAM.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY GNSBGHOY.
       COPY GNSBGEND.
       COPY GNSBGABT.
       COPY GNSBGPES.
       COPY GNSBGCVI.
       COPY GNSBEKEY.
       COPY GNSBFCIC.
       COPY GNSBBCIC.
       COPY GNSBGCPT.
       COPY GNSBBVRF.
       COPY GNSBVCOD.
       COPY GNSBVIDC.
       COPY GNSBVIND.
       COPY GNSBVMSC.
       COPY GNSBBNUM.
       COPY GNSBVTAB.
      *
       COPY SGCBFDBC.
       COPY SGCBFDCP.
       COPY SGCBFDCE.
       COPY TABBBOFI.
       COPY TABBBUSR.
       COPY TABBFUSR.
       COPY TABBVTDU.
      *
       PRO-UVCT-DVEG SECTION.
      ***********************
       INI-PRO-UVCT-DVEG.
           MOVE DLC-NUM-DDEV IN DLC TO FEC-DEC1.
           MOVE DLC-NUM-MDEV IN DLC TO FEC-MEC1.
           MOVE DLC-NUM-SDEV IN DLC TO FEC-SEC1.
           MOVE DLC-NUM-ADEV IN DLC TO FEC-AEC1.
       FIN-PRO-UVCT-DVEG.
           EXIT.
       ESTADISTICAS  SECTION.
      ***********************
       INI-ESTADISTICAS.
           DISPLAY 'ESTADISTICAS DEL PROCESO COLPGCVA'.
           DISPLAY '================================='.
           DISPLAY 'REG. VEN  LEIDOS..: 'WSS-NUM-RLEI IN WSS-VARI.
           DISPLAY 'REG. VEN  PROCESAD: 'WSS-NUM-PLEI IN WSS-VARI.
           DISPLAY 'REG. ERRONEOS.....: 'WSS-NUM-RERR IN WSS-VARI.
      *
       FIN-ESTADISTICAS.
           EXIT.

