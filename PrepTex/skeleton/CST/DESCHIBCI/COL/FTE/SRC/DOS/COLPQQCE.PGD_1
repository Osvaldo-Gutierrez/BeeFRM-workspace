       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   COLPQQCE.
       AUTHOR.       BEETEAM.
       DATE-WRITTEN. 02-Jun-14 05:54 PM.

      * NOMBRE PROGRAMA                   COLPQQCE
      * VERSION PGM                       3.1
      * VERSION SKL                       07.08.21
      * OPCION                            CON
      * ARCHIVO BASE                      SGCDBC
      * PANTALLA                          COLQCE
      * INP/OUT                           DATACOM
      * TAMANO COMMAREA                   250


       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.
       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
      * COPY GNSWGSCR.
       COPY GNSWGCVT.
       77  WSS-TAG-COLPQQCE-INI PIC X(125) VALUE                        
           '<IDNPGM NOM=$COLPQQCE$ SKL=$07.08.21$ VSN=${vsnpq}$        
      -    'GEN=$02-Jun-14 05:54 PM$ FNC=${fncpq}$/>'.    

       COPY GNSWCSCR.
       COPY GNSWVSCR.
      *<<<< FIN_SCR_VARI
           03  SCR-VARI-PFS.
               05  SCR-KEY-IQCE-ACTU.
                   07 SCR-QCE-CIC-IOPC PIC X(16).
                   07 SCR-QCE-COD-SIST PIC X(03).
                   07 SCR-QCE-COD-EVEN PIC X(03).
                   07 SCR-QCE-NUM-IROC PIC 9(03).
      *>>>>                                      
       COPY COLWIQCE.

       COPY SGCBRDBC.


       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSBRMSC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGFRM.
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       COPY GNSWGIDC.
       COPY GNSWGSYS.

      *<<<< WSS
       COPY GNSWGCPT.
       COPY COLBRCEN.
       COPY COLBRCEC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CEN-REQA==.

       01  WSS-VARI.                                                    
           03  WSS-COD-CAUX.
               05  WSS-COD-TOOC               PIC X(03).
               05  WSS-COD-AOOC               PIC X(03).
           03 WSS-RUT-FORM.
              05 WSS-RUT-NUME           VALUE ' '       PIC X(08).
              05 WSS-RUT-GION           VALUE '-'       PIC X(01).
              05 WSS-RUT-DIGI           VALUE ' '       PIC X(01).
      *    03 WSS-COD-EVEN.                                       
      *       05 WSS-COD-SIST                           PIC X(03).
      *       05 WSS-COD-EVTO                           PIC X(03).
      *    03 WSS-COD-PLAN.                                       
      *       05 WSS-CAI-PLAN                           PIC X(04).
      *       05 WSS-IIC-PLAN                           PIC X(08).
      *>>>>
       01  PGM-VARI.
           03 PGM-ICLR                  VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-TODO          VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-LLAVES        VALUE 'K'       PIC X(01).
           03 PGM-LIMPIAR-CAMPOS        VALUE 'F'       PIC X(01).
           03 PGM-NO-LIMPIAR-NADA       VALUE 'N'       PIC X(01).
           03 PGM-PROG                                  PIC X(08).
           03 PGM-NTRN                                  PIC X(04).
           03 PGM-STAT.
              05 PGM-STAT-DBC.
                 88 PGM-STAT-DBC-NUL    VALUE '  '.
                 07 PGM-STT1-DBC        VALUE '2' PIC X(01).
                    88 PGM-STAT-DBC-OKS VALUE '0'.
                 07 PGM-STT2-DBC        VALUE '3' PIC X(01).
              05 PGM-STAT-CEC.
                 88 PGM-STAT-CEC-NUL    VALUE '  '.
                 07 PGM-STT1-CEC        VALUE '2' PIC X(01).
                    88 PGM-STAT-CEC-OKS VALUE '0'.
                 07 PGM-STT2-CEC        VALUE '3' PIC X(01).
           03 PGM-SRNF                  VALUE '23'      PIC X(02).
           03 PGM-SOKS                  VALUE '00'      PIC X(02).
           03 PGM-SNUL                  VALUE '  '      PIC X(02).
           03 PGM-SUAR                  VALUE SPACES    PIC X(15).

       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 FILLER                    PIC X(250).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
       LUP-MAIN.
           IF SCR-INST = SCR-INST-HCM
                 PERFORM SCR-COM.
           IF SCR-CCPP = 'ACC'
                 PERFORM SCR-ACC
           ELSE
                 MOVE SCR-INST-HCM TO SCR-INST.
           GO TO LUP-MAIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
       COPY GNSBGEIB.
       COPY GNSBGEDB.
           MOVE LOW-VALUES TO QCE-FLD.
           MOVE LOW-VALUES TO QCE-EDT.
           PERFORM GNS-PRO-RCK.
           PERFORM GNS-BUS-VCA.
           PERFORM GNS-HDL-SYS.
           PERFORM GNS-HDL-FRM.
           MOVE 'COLPQQCE' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
       FIN-INI.
           EXIT.

       COPY GNSBHSYS.
       COPY GNSBHFRM.
       COPY GNSBPRCK.
       COPY GNSBBVCA.
       COPY GNSBBIDD.

       SCR-COM SECTION.
       INI-SCR-COM.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-QCE.
           PERFORM EDT-KEY-QCE.
           PERFORM EDT-FLD-QCE.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-HCM TO SCR-INST.
           MOVE SCR-CMNP     TO SYS-PROG.
           MOVE SCR-VARI     TO SYS-CMMA.
           MOVE SCR-TCMA     TO SYS-TCMA.
           MOVE SYS-XCTL     TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       XCT-ERR.
           MOVE 'XCTERR    ' TO MSG-COD-MENS.
           MOVE 'GNS'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO SYS-MEN1.
           MOVE SYS-PROG     TO SYS-MEN2.
           MOVE SYS-ABOR     TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       COPY GNSBGGBK.
       FIN-SCR-COM.
           EXIT.



       SCR-ACC SECTION.
       INI-SCR-ACC.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ACC
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-ACC.
           PERFORM DESSCRTRL.
      *<<<< PFS_SCR_ACC                                                 
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR                
                         FRM-FFLD-PF7 OR FRM-FFLD-PF8                   
               PERFORM VAL-NUM-KEY-QCE                                  
               PERFORM VAL-NUM-FLD-QCE                                  
      *        PERFORM SCRL-COL-QCE                                     
               PERFORM SCR-TRL.                                         
      *>>>>
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ACC.
           EXIT.

       BRW-SCR-ACC SECTION.
       INI-BRW-SCR-ACC.
       FIN-BRW-SCR-ACC.
           EXIT.




       SCR-DMSG SECTION.
       INI-SCR-DMSG.
           IF PGM-ICLR = PGM-NO-LIMPIAR-NADA
               NEXT SENTENCE
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-TODO
               PERFORM SCR-CLRA-QCE
               PERFORM EDT-KEY-QCE
               PERFORM EDT-FLD-QCE
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-LLAVES
               PERFORM CLR-KEY-QCE
               PERFORM EDT-KEY-QCE
           ELSE
               PERFORM CLR-FLD-QCE
               PERFORM EDT-FLD-QCE.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-DMSG.
           EXIT.

       SCR-KEY SECTION.
       INI-SCR-KEY.
           PERFORM SCR-RST.
           PERFORM GET-KEY.
           IF FRM-STAT-ABT
                   MOVE SPACES TO FRM-MENS
                   PERFORM SCR-MSSG
                   GO TO FIN-SCR-KEY.
       FND-SCR-KEY.
           MOVE SPACES TO FRM-MENS.
           PERFORM FND-KEY.
           IF FIO-STAT-OKS
               PERFORM PUT-SCR
               MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
               GO TO FIN-SCR-KEY.
      *JSS ELSE
      *        PERFORM CLR-FLD-QCE.
       ERR-SCR-KEY.
           MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR.
           IF FRM-MENS NOT > SPACES
               IF FIO-STAT-EOF
                   MOVE 'REGEOF    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
               IF FIO-STAT = FIO-STAT-NEX
                   MOVE 'REGNEX    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
           MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-SCR-KEY.
           EXIT.

       SCR-RST SECTION.
       INI-SCR-RST.
           MOVE SPACES       TO PGM-ICLR.
           MOVE SPACES       TO SCR-ACTU.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
           MOVE LOW-VALUES   TO QCE-FLD.
           MOVE LOW-VALUES TO QCE-EDT.
       FIN-SCR-RST.
           EXIT.

       GET-KEY SECTION.
       INI-GET-KEY.
           PERFORM SCR-GKEY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-KEY.
           EXIT.

       GET-IKY SECTION.
       INI-GET-IKY.
           PERFORM SCR-GIKY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-IKY.
           EXIT.

       FND-KEY SECTION.
       INI-FND-KEY.
      *<<<< INI_FND_KEY
           PERFORM KEY-ALL-QCE.
      *VALIDA ESTADO DBC                                                
      *    IF ROC-COD-SIST IN ROC-FLD = 'COL' OR 'CRE'                  
      *    MOVE ROC-CAI-IOPC IN ROC-FLD TO OPC-CAI-IOPC IN OPC          
      *    MOVE ROC-IIC-IOPC IN ROC-FLD TO OPC-IIC-IOPC IN OPC          
           MOVE FIO-GET-KEY     TO FIO-CMND                             
           MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.                                         
           MOVE FIO-STAT TO PGM-STAT-DBC.
           IF FIO-STAT-OKS
              MOVE DBC-STP-ITRN IN DBC TO SCR-UMOD.
              MOVE FIO-STAT TO PGM-STAT-DBC.
           IF NOT FIO-STAT-OKS                                          
              MOVE 'TAB'        TO MSG-COD-SIST                         
              MOVE 'CLI    NEX' TO MSG-COD-MENS                         
              PERFORM GET-MSG                                           
              MOVE MSG-GLS-DESC TO FRM-MENS                             
      *       MOVE '00'         TO FIO-STAT                             
      *       MOVE SCR-STAT-CON TO SCR-STAT                             
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE FRM-SUAR-MAL TO FRM-SUAR
              GO TO FIN-FND-KEY.                                        
                                                                        
      *    IF OPC-MSC-STAT IN OPC = 'A'                                 
      *       IF SCR-CMND = 'ING' OR 'MOD' OR 'ELI'                     
      *          MOVE 'OPC    ACAYA' TO MSG-COD-MENS                    
      *          GO TO SIG-FND-KEY.                                     
      *    MOVE ROC-NUM-IROC IN ROC-FLD TO SCR-NUM-IROC.                
      *    IF SCR-CCPP = 'ING'                                          
      *        MOVE 'S' TO ROC-IND-VIGE IN ROC-FLD                      
      *        PERFORM BUS-COR-ROC                                      
      *        GO TO CON-FND-KEY.                                       
      *    IF ROC-NUM-IROC IN ROC NOT > ZEROES                          
      *        PERFORM BUS-COR-ROC.                                     

           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO FRM-GLS-NOMC IN QCE-FLD.

           MOVE 'CAE'                   TO CEC-COD-ENTI IN CEC.
           MOVE ZEROES                  TO CEC-FEC-FENT IN CEC.
           MOVE SPACES                  TO CEC-COD-RENT IN CEC.
           MOVE CEC-NUM-IENT IN QCE-FLD TO CEC-NUM-IENT IN CEC.
           MOVE '0'                     TO CEC-COD-CCSE IN CEC(1:1).
           MOVE SPACES                  TO CEC-CIC-ISEN IN CEC.
           MOVE ZEROES                  TO CEC-NUM-ISEN IN CEC.
           MOVE FIO-GET-NLS             TO FIO-CMND.
           PERFORM COL-FIO-CEN.

           IF NOT ( FIO-STAT-OKS                              AND
                    DBC-CIC-ICLI IN DBC = CEC-CIC-IENT IN CEC )
              MOVE 'COL'        TO MSG-COD-SIST
              MOVE 'CEC    NEX' TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE FRM-SUAR-MAL TO FRM-SUAR
              GO TO FIN-FND-KEY.

      *CON-FND-KEY.                                                     
      *    IF MSG-COD-MENS > SPACES                                     
      *       MOVE '23' TO FIO-STAT                                     
      *       GO TO FIN-FND-KEY.                                        
      *    IF NOT FIO-STAT-OKS                                          
      *       IF SCR-CMND = 'CON' OR 'MOD' OR 'ANL'                     
      *          MOVE 'ROC    NEX' TO MSG-COD-MENS                      
      *          GO TO SIG-FND-KEY.                                     
      *    IF SCR-CMND = 'ANL' AND ROC-IND-VIGE IN ROC = 'N'            
      *        MOVE 'ROC    YAANL' TO MSG-COD-MENS                      
      *        GO TO SIG-FND-KEY.                                       
                                                                        
      *    IF SCR-CMND = 'ANL' AND ROC-COD-CPTO IN ROC = 'INT'          
      *        MOVE 'ANLCPTINTINV' TO MSG-COD-MENS                      
      *        GO TO SIG-FND-KEY.                                       
                                                                        
                                                                        
      *    IF SCR-CMND = 'ELI' AND ROC-IND-VIGE IN ROC = 'N'            
      *        MOVE 'ROCANL NOELI' TO MSG-COD-MENS                      
      *        GO TO SIG-FND-KEY.                                       
                                                                        
      *    IF OPC-MSC-STAT IN OPC = 'A' AND SCR-CMND = 'ANL'            
      *       IF ROC-COD-OCOB IN ROC = 'FLT'                            
      *          MOVE 'ANLFLT   INV' TO MSG-COD-MENS                    
      *          GO TO SIG-FND-KEY.                                     
                                                                        
      *    GO TO FIN-FND-KEY.                                           
      *SIG-FND-KEY.                                                     
      *    MOVE 'TAB'        TO MSG-COD-SIST.                           
      *    PERFORM GET-MSG.                                             
      *    MOVE MSG-GLS-DESC TO FRM-MENS.                               
      *    MOVE '00'         TO FIO-STAT.                               
      *    MOVE SCR-STAT-CON TO SCR-STAT.                               
      *    GO TO FIN-FND-KEY.                                           
           GO TO FIN-FND-KEY.                                           
      *>>>>                                                             
           PERFORM KEY-ALL-QCE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
       FIN-FND-KEY.
           EXIT.
 
       PUT-SCR SECTION.
       INI-PUT-SCR.
           PERFORM PUT-ALL-QCE.
       FIN-PUT-SCR.
           EXIT.

       STP-EXIT SECTION.
       INI-STP-EXIT.
           MOVE SCR-PROG TO PGM-PROG.
           MOVE SCR-NTRN TO PGM-NTRN.

           MOVE SCR-PROV TO SCR-PROG.
           MOVE SCR-NTRV TO SCR-NTRN.

           MOVE PGM-PROG TO SCR-PROV
           MOVE PGM-NTRN TO SCR-NTRV.
       FIN-STP-EXIT.
           EXIT.

       SCR-EXIT SECTION.
       INI-SCR-EXIT.
           MOVE 'P'      TO SCR-ICMN.
           MOVE SCR-NTRN TO SYS-NTRN.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-RTRN TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-SCR-EXIT.
           EXIT.

       SCR-PUTA SECTION.
       INI-SCR-PUTA.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE QCE-FLD TO FRM-DFLD.
           MOVE FRM-PUT-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-PUTA.
           EXIT.

       SCR-MSSG SECTION.
       INI-SCR-MSSG.
           IF FRM-MEN1 NOT > SPACES
               MOVE SPACES TO FRM-MEN1.
           IF FRM-MEN2 NOT > SPACES
               MOVE SPACES TO FRM-MEN2.
           MOVE FRM-MENS TO QCE-GLS-MENS.
       FIN-SCR-MSSG.
           EXIT.

       SCR-GKEY SECTION.
       INI-SCR-GKEY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-QCE
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO QCE-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GKEY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-QCE.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-QCE
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-QCE.
           PERFORM VAL-IKY-QCE.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-MKY-QCE.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-AKY-QCE.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-CON-KEY-QCE.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GKEY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-QCE.
       ERR-SCR-GKEY.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-QCE.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GKEY.
           PERFORM SCR-MSSG.

       SCR-GIKY SECTION.
       INI-SCR-GIKY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-QCE
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO QCE-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GIKY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-QCE.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               PERFORM SCR-MSSG
               PERFORM EDT-IKY-QCE
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-QCE.
           PERFORM VAL-IKY-QCE.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GIKY.
           PERFORM VAL-CON-IKY-QCE.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GIKY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-QCE.
       ERR-SCR-GIKY.
           PERFORM SCR-MSSG.
           PERFORM EDT-IKY-QCE.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GIKY.
           PERFORM SCR-MSSG.

       GET-CON SECTION.
       INI-GET-CON.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
      *<<<< PFS_GET_CON                                                 
      *    IF NOT ( FRM-FFLD = FRM-FFLD-PF7 )                           
      *    IF NOT ( FRM-FFLD = FRM-FFLD-PF8 )                           
      *>>>>                                                             
      *>>>>
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO QCE-GLS-MEN2
               MOVE SCR-PRMT     TO QCE-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO QCE-FLD.
       FIN-GET-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.

       CLR-MSG SECTION.
       INI-CLR-MSG.
           MOVE SPACES TO QCE-GLS-MENS.
       FIN-CLR-MSG.
           EXIT.

       HBL-IKY SECTION.
       INI-HBL-IKY.
           IF SCR-DESDE-CMN
               MOVE QCE-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO QCE-FLD
      * FLB  7-NOV-1994
               PERFORM CLR-KEY-QCE

               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO QCE-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO QCE-GLS-MENS.
           PERFORM PRO-MKY-QCE.
           PERFORM PRO-AKY-QCE.
           PERFORM UNP-IKY-QCE.
           PERFORM FST-KEY-QCE.
       FIN-HBL-IKY.
           EXIT.

       HBL-KEY SECTION.
       INI-HBL-KEY.
           IF SCR-DESDE-CMN
               MOVE QCE-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO QCE-FLD
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO QCE-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO QCE-GLS-MENS.
           PERFORM UNP-KEY-QCE.
           PERFORM FST-KEY-QCE.
       FIN-HBL-KEY.
           EXIT.

       HBL-FLD SECTION.
       INI-HBL-FLD.
           PERFORM PRO-IKY-QCE.
           PERFORM PRO-AKY-QCE.
           PERFORM UNP-MKY-QCE.
           PERFORM UNP-FLD-QCE.
           PERFORM FST-FLD-QCE.
       FIN-HBL-FLD.
           EXIT.

       FST-MSG SECTION.
       INI-FST-MSG.
           MOVE -1 TO QCE-GLS-MENS-LEN.
       FIN-FST-MSG.
           EXIT.

       PRO-ALL SECTION.
       INI-PRO-ALL.
           PERFORM PRO-KEY-QCE.
           PERFORM FST-MSG.
       FIN-PRO-ALL.
           EXIT.

       SCR-TRL SECTION.
       INI-SCR-TRL.
           IF FRM-MEN1 NOT > SPACES
               MOVE SCR-PRMT TO FRM-MEN1.
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM HBL-FLD
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-QCE
               PERFORM EDT-FLD-QCE
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GFL TO SCR-INST
               PERFORM SCR-EXIT.
           IF SCR-STAT = SCR-STAT-SON
               PERFORM PRO-ALL
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-QCE
               PERFORM EDT-FLD-QCE
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GCS TO SCR-INST
               PERFORM SCR-EXIT.
      *ASUME SCR-STAT-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.
      *    MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-QCE.
           PERFORM EDT-FLD-QCE.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-GAB TO SCR-INST.
           PERFORM SCR-EXIT.
       FIN-SCR-TRL.
           EXIT.

       DESSCRTRL SECTION.
       INI-DESSCRTRL.
           MOVE SCR-VFLD-NOT TO SCR-VFLD.
           MOVE FRM-FFLD TO SCR-FFLD.
       FIN-DESSCRTRL.
           IF SCR-FFLD-PF10 OR SCR-FFLD-PF3
                 MOVE SCR-INST-HCM TO SCR-INST
           ELSE
                 MOVE SCR-INST-HKY TO SCR-INST.
       EXT-DESSCRTRL.
           EXIT.

      * PGM-EBR-ALL SECTION.
      * INI-PGM-EBR-ALL.
      *     MOVE 'GNS' TO FIO-SIST.
      *     MOVE FIO-EBR-ALL TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      * FIN-PGM-EBR-ALL.
      *     EXIT.

       COPY COLBQQCE.
       COPY GNSBVNUM.
       COPY SGCBFDBC.
       COPY GNSBFMSG.
       COPY GNSBGSYS.
       COPY GNSBGDTC.
       COPY GNSBGFRM.
       COPY GNSBGMSG.
       COPY GNSBEKEY.
       COPY GNSBIABT.
       COPY GNSBFTAB.
       COPY GNSBVIND.
       COPY GNSBVMSC.
       COPY GNSBFMSC.
       COPY GNSBVIDC.
       COPY GNSBPVRF.
       COPY GNSBGFEC.
       COPY GNSBGHOY.

      *<<<< EOF                                                         
       COPY COLBFCEN.
       COPY GNSBGCPT.
      *PTC-INI                                                          
      *COPY GNSBGQUE.                                                   
      *COPY GNSBGTSK.                                                   
      *PTC-FIN                                                          

      *COPY GNSBGVSM.                                                   
      *COPY GNSBVCOD.                                                   
                                                                        
      *COPY COLBFOPC.                                                   
      *COPY TABBFCIN.                                                   
      *PVG INI 23-NOV-2004 PRECIOS-PPC                                  
      *COPY TABBFPPC.                                                   
      *PVG FIN 23-NOV-2004 PRECIOS-PPC                                  
      *>>>>                                                             
      *BUS-COR-ROC SECTION.                                             
      *INI-BUS-COR-ROC.                                                 
      *    MOVE 999         TO ROC-NUM-IROC IN ROC.                     
      *    MOVE FIO-GET-LEQ TO FIO-CMND.                                
      *    PERFORM TAB-FIO-ROC.                                         
      *    MOVE FIO-STAT TO PGM-STAT-ROC.                               
      *    IF NOT ( FIO-STAT-OKS AND                                    
      *        ROC-CAI-IOPC IN ROC-FLD  = ROC-CAI-IOPC IN ROC AND       
      *        ROC-IIC-IOPC IN ROC-FLD  = ROC-IIC-IOPC IN ROC AND       
      *        ROC-COD-SIST IN ROC-FLD  = ROC-COD-SIST IN ROC AND       
      *        ROC-COD-EVEN IN ROC-FLD  = ROC-COD-EVEN IN ROC )         
      *        PERFORM KEY-ALL-ROC                                      
      *        MOVE ZEROES TO ROC-NUM-IROC IN ROC                       
      *    ELSE                                                         
      *        MOVE FIO-END-BRW TO FIO-CMND                             
      *        PERFORM TAB-FIO-ROC.                                     
                                                                        
      *    IF SCR-CCPP = 'ING'                                          
      *        ADD 1 TO ROC-NUM-IROC IN ROC                             
      *        MOVE ROC-NUM-IROC IN ROC TO ROC-NUM-IROC IN ROC-FLD.     
      *                                                                 
      *FIN-BUS-COR-ROC.                                                 
      *    EXIT.                                                        
                                                                        
      *SCRL-COL-QCE SECTION.                                            
      *INI-SCRL-COL-QCE.                                                
      *    IF FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF5                   
      *        PERFORM SCRL-COL-QCE-PF7                                 
      *        GO TO FIN-SCRL-COL-QCE.                                  
      *    IF FRM-FFLD = FRM-FFLD-PF8  OR FRM-FFLD-PF6                  
      *        PERFORM SCRL-COL-QCE-PF8                                 
      *        GO TO FIN-SCRL-COL-QCE.                                  
      *FIN-SCRL-COL-QCE.                                                
      *    EXIT.                                                        
                                                                        
      *SCRL-COL-QCE-PF7 SECTION.                                        
      *INI-SCRL-COL-QCE-PF7.                                            
      *    MOVE SCR-KEY-IQCE-ACTU TO QCE-KEY-IQCE IN QCE.               
      *    MOVE FIO-GET-LEQ TO FIO-CMND.                                
      *    PERFORM COL-FIO-CEN.                                         
      *    IF NOT ( FIO-STAT-OKS AND                                    
      *             SGC-KEY-ICLI IN DBC = SCR-KEY-IQCE-ACTU)            
      *        MOVE 'COLCURRNEX' TO MSG-COD-MENS                        
      *        GO TO MSG-SCRL-COL-QCE-PF7.                              
      *PRV-SCRL-COL-QCE-PF8.                                            
      *    MOVE FIO-GET-PRV TO FIO-CMND.                                
      *    PERFORM SGC-FIO-DBC.                                         
      *    IF NOT ( FIO-STAT-OKS AND                                    
      *             CEC-COD-EVEN IN CLE = SCR-CEC-COD-EVEN )            
      *        MOVE 'COL    NOPRV' TO MSG-COD-MENS                      
      *        GO TO MSG-SCRL-COL-QCE-PF7.                              
      *    MOVE FIO-STAT TO PGM-STAT-QCE.                               
      *    PERFORM SCR-CLRA-QCE.                                        
      *    PERFORM PUT-SCR.                                             
      *    GO TO FIN-SCRL-COL-QCE-PF7.                                  
      *MSG-SCRL-COL-QCE-PF7.                                            
      *    MOVE 'TAB' TO MSG-COD-SIST.                                  
      *    PERFORM GET-MSG.                                             
      *    MOVE MSG-GLS-DESC TO FRM-MEN2.                               
      *FIN-SCRL-COL-QCE-PF7.                                            
      *    EXIT.                                                        
                                                                        
      *SCRL-COL-QCE-PF8 SECTION.                                        
      *INI-SCRL-COL-QCE-PF8.                                            
      *    MOVE SCR-KEY-IQCE-ACTU TO QCE-KEY-IQCE IN QCE.               
      *    MOVE FIO-GET-NLS TO FIO-CMND.                                
      *    PERFORM TAB-FIO-ROC.                                         
      *    IF NOT ( FIO-STAT-OKS AND                                    
      *             SGC-KEY-ICLI IN DBC = SCR-KEY-IQCE-ACTU)            
      *        MOVE 'TABCURRNEX' TO MSG-COD-MENS                        
      *        GO TO MSG-SCRL-COL-QCE-PF8.                              
      *NXT-SCRL-COL-QCE-PF8.                                            
      *    MOVE FIO-GET-NXT TO FIO-CMND.                                
      *    PERFORM TAB-FIO-ROC.                                         
      *    IF NOT ( FIO-STAT-OKS AND                                    
      *             ROC-CIC-IOPC IN ROC = SCR-ROC-CIC-IOPC AND          
      *             ROC-COD-SIST IN ROC = SCR-ROC-COD-SIST AND          
      *             ROC-COD-EVEN IN ROC = SCR-ROC-COD-EVEN )            
      *        MOVE 'TAB    NONXT' TO MSG-COD-MENS                      
      *        GO TO MSG-SCRL-COL-QCE-PF8.                              
      *    MOVE FIO-STAT TO PGM-STAT-ROC.                               
      *    PERFORM SCR-CLRA-ROC.                                        
      *    PERFORM PUT-SCR.                                             
      *    GO TO FIN-SCRL-COL-QCE-PF8.                                  
      *MSG-SCRL-COL-QCE-PF8.                                            
      *    MOVE 'TAB' TO MSG-COD-SIST.                                  
      *    PERFORM GET-MSG.                                             
      *    MOVE MSG-GLS-DESC TO FRM-MEN2.                               
      *FIN-SCRL-COL-QCE-PF8.                                            
      *    EXIT.                                                        

