       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPGHZF.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    2-NOV-1992 12:22:49.

      * Genera cancelaciones a partir de los vencimientos que ocurran
      * en la fecha de vencimiento ingresada por parametro, que tengan
      * cargo automatico en cuenta corriente.
   HZF* Se modifico para que genere la cancelacion suspendida con los
      * modulos de los programas interactivos.

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *-----------------------
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
      *DAD ini  23-FEB-1993   (Memo.22-02-93 Pto.1)
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
      *DAD fin  23-FEB-1993
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==SCR-CAN-REQA==.
       01  SCR-KEY-ICAN                     PIC X(03).
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EJE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EJC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-POC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCSCR.
       COPY GNSWVSCR.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       COPY COLWGENG.
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGIDC.
      *DAD ini  23-AGO-1991
       COPY COLWGCTO.
       COPY COLWGECA.
      *DAD fin  23-AGO-1991
       COPY COLW1CAN.
       COPY COLW2CAN.
           03  WSS-VAL-CMP2                COMP-2.
           03 WSS-DIAS-MORA          VALUE 0 PIC 9(03).
           03 WSS-MSC-CCAA           VALUE SPACES PIC X(05).
           03 WSS-MSC-CCAM           VALUE SPACES PIC X(05).
           03 WSS-MSC-CCAO           VALUE SPACES PIC X(05).
           03 WSS-SGV-FINA           COMP-3       PIC S9(11)V9(4).
           03 WSS-NUM-RCHK                        PIC 9(04).
           03 WSS-NUM-RLEI           VALUE ZEROS  PIC 9(04).
           03 WSS-NUM-RPRO           VALUE ZEROS  PIC 9(04).
           03 WSS-NUM-RERR           VALUE ZEROS  PIC 9(04).
           03 WSS-COD-OFIC.
              05 WSS-IND-OFIC        OCCURS 10    PIC X(03).
           03 WSS-OFI-NFND           VALUE ZEROS  PIC 9(02).
           03 WSS-MSG-MENS.
              05 WSS-MSG-PREV                     PIC X(09).
              05 WSS-MSG-TENT                     PIC X(01).
              05 WSS-MSG-FENT                     PIC X(01).
              05 WSS-MSG-SENT                     PIC X(01).
           03 WSS-MEN1.
              05 WSS-MEN1-1                       PIC X(15).
              05 WSS-MEN1-2                       PIC X(24).
           03 WSS-SGV-DIFE  VALUE +0              PIC S9(13)V9(05).
           03 WSS-SGV-DIFE-ALF                    PIC  X(24).
           03 WSS-SGV-DIFE-EDT REDEFINES WSS-SGV-DIFE-ALF
                               PIC --.---.---.---.---,-----.
           03 WSS-FEC-FPRO.
              05 WSS-NUM-DPRO                     PIC 9(02).
              05 WSS-NUM-MPRO                     PIC 9(02).
              05 WSS-NUM-SPRO                     PIC 9(02).
              05 WSS-NUM-APRO                     PIC 9(02).
           03 WSS-FEC-FFEC.
              05 WSS-NUM-SFEC                     PIC 9(02).
              05 WSS-NUM-AFEC                     PIC 9(02).
              05 WSS-NUM-MFEC                     PIC 9(02).
              05 WSS-NUM-DFEC                     PIC 9(02).
           03 WSS-FEC-FMIN.
              05 WSS-NUM-DMIN        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-MMIN        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-SMIN        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-AMIN        VALUE ZEROS  PIC 9(02).
           03 WSS-FEC-FINI.
              05 WSS-NUM-DINI        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-MINI        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-SINI        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-AINI        VALUE ZEROS  PIC 9(02).
           03 WSS-FEC-FTER.
              05 WSS-NUM-STER        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-ATER        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-MTER        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-DTER        VALUE ZEROS  PIC 9(02).
           03 WSS-FEC-FFCA.
              05 WSS-NUM-DFCA        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-MFCA        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-SFCA        VALUE ZEROS  PIC 9(02).
              05 WSS-NUM-AFCA        VALUE ZEROS  PIC 9(02).
           03 WSS-SGV-TINT      COMP-3            PIC S9(04)V9(03).
           03 WSS-GLS-MEN2           VALUE SPACES PIC X(40).
           03 WSS-AUX-APIN.
              05 FILLER                           PIC X(04).
              05 WSS-COD-APIN                     PIC X(08).
           03 WSS-RCV-KEY-ICAN.
              05 WSS-RCV-CIC-IOPC-P    VALUE SPACES PIC X(12).
              05 WSS-RCV-NUM-ICAN-P    VALUE ZEROS  PIC 9(03).
           03 WSS-AUX-COCM.
              05 FILLER                           PIC X(04).
              05 WSS-COD-COCM                     PIC X(08).
           03 WSS-COD-OFOC                        PIC X(03).
           03 WSS-COD-COOC                        PIC X(06).
           03 WSS-CIC-CTAB                        PIC X(03).
           03 WSS-CIC-ICYA       VALUE SPACES     PIC X(12).
           03 WSS-VRF-ICYA       VALUE SPACES     PIC X(01).
           03 WSS-NUM-OPCL      VALUE 0           PIC 9(06).
           03 WSS-NUM-SORG      VALUE 0           PIC 9(06).
           03 WSS-NUM-SORL      VALUE 0           PIC 9(06).
           03 WSS-NUM-CANG      VALUE 0           PIC 9(06).
           03 WSS-SGV-ACUM      VALUE 0 COMP-3    PIC S9(13)V9(02).
           03 WSS-AUX-TPAG      VALUE 0 COMP-3    PIC S9(13)V9(02).
           03 WSS-I             VALUE 0           PIC 9(03).
           03 WSS-CNT-DIAS      VALUE 0           PIC 9(03).
           03 WSS-COD-CMSC           VALUE SPACES PIC X(01).
           03 WSS-VEN-KEY-IVEN.
              05 WSS-VEN-CIC-IOPC                 PIC X(12).
              05 WSS-VEN-NUM-IVEN                 PIC 9(03).
           03 WSS-IND-OTRO                        PIC X(01).
       01  HST-VARI.
           03 HST-MSC-TACC VALUE '*'              PIC X(01).
           03 HST-FEC-FFIN                        PIC X(08).
       COPY COLWGVEN.
       COPY GNSWGCPT.
       COPY COLWGINT.
       COPY GNSWGPES.
       COPY COLBRRDC.
       COPY GNSBRCIC.
       COPY COLBROPC.
       COPY COLBRTMC.
       COPY COLBRDLC.
       COPY COLBRCAN.
       COPY COLBRRCV.
       COPY COLBRICG.
       COPY COLBRITR.
       COPY COLBREVC.
       COPY COLBRTOC.
       COPY COLBRVEN.
       COPY COLBRCYA.
       COPY COLBRAUT.
       COPY COLBRROV.
       COPY SGCBRDBC.
       COPY GNSBRMSC.
       COPY SGCBRRCO.
       COPY SGCBROPE.

      *POR AMBIENTE FIO EN GENERAL
       COPY GNSWCFIO.
       COPY GNSWVFIO.
      *PARA LECTURA DE TABLAS GENERALES Y MENSAJES
       COPY GNSBRTAB.
       COPY GNSBRMSG.
      *PARA VALORES DE CAMBIO Y TABLA TIO
       COPY TABBRCAM.
       COPY TABBRTIO.
       COPY TABBRUSR.
       COPY TABBROFI.
      *PARA RETORNAR FECHA DE HOY
       COPY GNSWGHOY.
      *PARA VALIDAR FECHAS
       COPY GNSWGFEC.
      *PARA OBTENER FUNCIONES DE SISTEMA
       COPY GNSWGSYS.
      *REGISTRO IMAGEN DE PANTALLA
       COPY GNSWGFRM.
       COPY COLWICAN.
      *PARA MARCAR STATUS DE SORT
       01  PGM-STAT.
           03 PGM-STAT-OPC           VALUE '23'      PIC X(02).
                 88 PGM-STAT-OPC-OKS    VALUE '00'.
                 88 PGM-STAT-OPC-NUL    VALUE '  '.
           03 PGM-STAT-CYA           VALUE '23'      PIC X(02).
                 88 PGM-STAT-CYA-OKS    VALUE '00'.
                 88 PGM-STAT-CYA-NUL    VALUE '  '.
           03 PGM-STAT-AUT           VALUE '23'      PIC X(02).
                 88 PGM-STAT-AUT-OKS    VALUE '00'.
                 88 PGM-STAT-AUT-NUL    VALUE '  '.
           03 PGM-STAT-DBC           VALUE '23'      PIC X(02).
                 88 PGM-STAT-DBC-OKS    VALUE '00'.
                 88 PGM-STAT-DBC-NUL    VALUE '  '.
           03 PGM-STAT-VEN           VALUE '23'      PIC X(02).
                 88 PGM-STAT-VEN-OKS    VALUE '00'.
                 88 PGM-STAT-VEN-NUL    VALUE '  '.
           03 PGM-STAT-RDC           VALUE '23'      PIC X(02).
                 88 PGM-STAT-RDC-OKS    VALUE '00'.
                 88 PGM-STAT-RDC-NUL    VALUE '  '.
           03 PGM-STAT-RCV           VALUE '23'      PIC X(02).
                 88 PGM-STAT-RCV-OKS    VALUE '00'.
                 88 PGM-STAT-RCV-NUL    VALUE '  '.
           03 PGM-STAT-ITR           VALUE '23'      PIC X(02).
                 88 PGM-STAT-ITR-OKS    VALUE '00'.
                 88 PGM-STAT-ITR-NUL    VALUE '  '.
           03 PGM-STAT-ICG           VALUE '23'      PIC X(02).
                 88 PGM-STAT-ICG-OKS    VALUE '00'.
                 88 PGM-STAT-ICG-NUL    VALUE '  '.
           03 PGM-STAT-CAN           VALUE '23'      PIC X(02).
                 88 PGM-STAT-CAN-OKS    VALUE '00'.
                 88 PGM-STAT-CAN-NUL    VALUE '  '.
           03 PGM-STAT-ROV           VALUE '23'      PIC X(02).
                 88 PGM-STAT-ROV-OKS    VALUE '00'.
                 88 PGM-STAT-ROV-NUL    VALUE '  '.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *VARIABLES DE TRABAJO
      *01  WSS-VARI. *EXISTE  DEFINIDO EN COPY COLW2CAN
       01  PAR-VARI.
      * Variables de Parametros para Obtencion F. Parametro
      * Variables de INPUT
           03 PAR-COD-TPAR                          PIC X(03).
           03 PAR-COD-PROG                          PIC X(03).
           03 PAR-COD-TPRO                          PIC X(03).
           03 PAR-COD-TFEC                          PIC X(03).
      * Variables de OUTPUT
           03 PAR-COD-FPAR                          PIC X(10).
           03 PAR-COD-FPAR-R REDEFINES PAR-COD-FPAR.
              05 PAR-FEC-FPAR                       PIC X(08).
              05 PAR-GLS-FPAR                       PIC X(02).
           03 PAR-COD-STAT                          PIC 9(01).
           03 PAR-COD-MENS                          PIC X(12).
           03 PAR-COD-PAR1.
              05 PAR-COD-PA11                       PIC X(04).
              05 PAR-COD-PA12                       PIC X(03).
      *HZF 23081993 INI
       COPY COLWGVIN.
      *DAD COPY COLWVRCV.
      *DAD COPY COLWVRDC.
       COPY GNSWGCIC.
       COPY COLBRCOM.
       COPY COLBRPTI.
       COPY COLBREJC.
       COPY COLBRPOC.
      *HZF 23081993 FIN
       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
       INI-MAIN.
      *CARGA NOMBRE PROGRAMA
           COPY GNSBGEDB.
           MOVE 'COLPGHZF' TO FIO-PROG SCR-USER.
           PERFORM GNS-BUS-IDD.
           PERFORM OPEN-FILE.
           PERFORM PRM-CAN.
           PERFORM INI-CAN.
           PERFORM LUP-PUT-VEN.
           PERFORM CLOSE-FILE.
       FIN-MAIN.
      *    IF WSS-NUM-RERR IN WSS-VARI > ZEROES
      *       PERFORM DB2-VSM-ABT
      *    ELSE
      *       PERFORM STP-GNS-PRO-END.

           IF WSS-NUM-RERR IN WSS-VARI > ZEROES
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       OPEN-FILE SECTION.
      *-----------------
       INI-OPEN-FILE.
      *ABRE ARCHIVOS DE TABLAS DE COL, CAMBIOS, TOC
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'COL'   TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE 'TAB'   TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           PERFORM COL-FIO-DLC.
           PERFORM COL-FIO-ICG.
           PERFORM SGC-FIO-DBC.
           PERFORM COL-FIO-RDC.
           PERFORM SGC-FIO-RCO.
           PERFORM SGC-FIO-OPE.
           PERFORM TAB-FIO-CAM.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM COL-FIO-EVC.
           PERFORM COL-FIO-VEN.
           PERFORM COL-FIO-RCV.
           PERFORM COL-FIO-CYA.
           PERFORM COL-FIO-CAN.
           PERFORM COL-FIO-OPC.
           PERFORM COL-FIO-ROV.
       FIN-OPEN-FILE.
           EXIT.
       PRM-CAN SECTION.
      *---------------
       INI-PRM-CAN.
      *DAD ini  23-FEB-1993   (Memo.22-02-93 Pto.1)
      *         09-JUL-1991
      * Busca Codigo con CIC de Cargo Automatico en Cta.Cte. desde GCAN
           MOVE 'TAB'        TO FIO-SIST.
           MOVE 'TCYACCGCAN' TO MSC-CIC-MSCL IN MSC.
           MOVE 'MSC'        TO MSC-CIC-TTAB IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT ( FIO-STAT-OKS AND
                    MSC-IND-VIGE IN MSC = 'S' AND
                    MSC-CIC-TTAB IN MSC = 'MSC' AND
                    MSC-CIC-MSCL IN MSC = 'TCYACCGCAN' )
               DISPLAY 'NO EXISTE CODIGO DE CARGO AUTOMATICO EN CUENTA '
                       'CORRIENTE PARA GCAN'
               DISPLAY 'EN MISCELANEO TCYA DEL SISTEMA DE TABLAS, CON '
                       'EL CIC = TCYACCGCAN'
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
               PERFORM GNS-PRO-ABT.
      *DAD fin  29-MAY-1992
       DET-PRM-GCAN.
      *     MOVE MSC-COD-CMSC IN MSC TO WSS-MSC-CCAA IN WSS-VARI.
           IF MSC-COD-DAT1 IN MSC(3) = 'M'
               MOVE MSC-COD-CMSC IN MSC TO WSS-MSC-CCAM IN WSS-VARI
           ELSE
           IF MSC-COD-DAT1 IN MSC(3) = 'O'
               MOVE MSC-COD-CMSC IN MSC TO WSS-MSC-CCAO IN WSS-VARI
           ELSE
               DISPLAY 'ERROR:EXISTE OTRO CODIGO SIN CLASIFICAR'
               PERFORM GNS-PRO-ABT.

           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT ( FIO-STAT-OKS AND
                    MSC-IND-VIGE IN MSC = 'S' AND
                    MSC-CIC-TTAB IN MSC = 'MSC' AND
                    MSC-CIC-MSCL IN MSC = 'TCYACCGCAN' )
               GO TO NXT-PRM-CAN.
           GO TO DET-PRM-GCAN.
       NXT-PRM-CAN.
      *DAD fin  23-FEB-1993 / 09-JUL-1991

           MOVE 1 TO WSS-I.
           PERFORM LIM-OFI-PRMT UNTIL WSS-I > 10.
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.
      *Captura Fecha de Proceso
           ACCEPT WSS-FEC-FPRO IN WSS-VARI.
           DISPLAY 'FEC DE PROC (DDMMAAAA) : ' WSS-FEC-FPRO IN WSS-VARI.
      *Captura Oficinas del credito
           ACCEPT  WSS-COD-OFIC IN WSS-VARI.
           DISPLAY 'OFICINA                : ' WSS-COD-OFIC IN WSS-VARI.
           DISPLAY 'FIN    CAPTURA    DE PARAMETROS'.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.
      *Captura Dias de Mora
           ACCEPT WSS-DIAS-MORA IN WSS-VARI.
           DISPLAY 'DIAS DE MORA          : ' WSS-DIAS-MORA IN WSS-VARI.
      *VAL-FEC Valida Fecha de Proceso
           DISPLAY WSS-FEC-FPRO IN WSS-VARI.
           MOVE WSS-FEC-FPRO    IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
               PERFORM GNS-PRO-ABT.
      *DAD fin  29-MAY-1992
           MOVE WSS-FEC-FPRO IN WSS-VARI TO WSS-FEC-FMIN IN WSS-VARI
                                            WSS-FEC-FFCA IN WSS-VARI.
      *VAL-FEC Avanza Fecha de Proceso a Siguiente Dia Habil
           MOVE WSS-FEC-FPRO    IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-SIG-HBL  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
               PERFORM GNS-PRO-ABT.
      *DAD fin  29-MAY-1992
           MOVE FEC-FECH                 TO WSS-FEC-FPRO IN WSS-VARI.
           MOVE WSS-NUM-DPRO IN WSS-VARI TO WSS-NUM-DTER IN WSS-VARI.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO WSS-NUM-MTER IN WSS-VARI.
           MOVE WSS-NUM-SPRO IN WSS-VARI TO WSS-NUM-STER IN WSS-VARI.
           MOVE WSS-NUM-APRO IN WSS-VARI TO WSS-NUM-ATER IN WSS-VARI.
           MOVE WSS-FEC-FPRO IN WSS-VARI TO WSS-FEC-FMIN IN WSS-VARI.
      *VAL-FEC Retrocede Dias del Parametro (Calendario)
       BUS-DIA-HBL.
           MOVE WSS-FEC-FMIN TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-RST-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
      *    PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           MOVE FEC-FECH TO WSS-FEC-FINI.

      *VAL-FEC Validar Fecha
           MOVE WSS-FEC-FINI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF WSS-CNT-DIAS IN WSS-VARI < WSS-DIAS-MORA
              MOVE WSS-FEC-FINI IN WSS-VARI TO WSS-FEC-FMIN IN WSS-VARI
              ADD   1           TO WSS-CNT-DIAS IN WSS-VARI
              GO TO BUS-DIA-HBL.
      *VAL-FEC Retrocede Dias Hasta siguiente Habil
       RET-DIA-HBL.
           MOVE WSS-FEC-FMIN TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-RST-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
      *    PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           MOVE FEC-FECH TO WSS-FEC-FINI.

      *VAL-FEC Validar Fecha
           MOVE WSS-FEC-FINI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-FER
              MOVE WSS-FEC-FINI IN WSS-VARI TO WSS-FEC-FMIN IN WSS-VARI
              GO TO RET-DIA-HBL.

           MOVE WSS-FEC-FMIN IN WSS-VARI TO WSS-FEC-FINI IN WSS-VARI.

           IF WSS-COD-OFIC IN WSS-VARI > SPACES AND
              WSS-IND-OFIC IN WSS-VARI(1) NOT = '*'
               MOVE 1 TO WSS-I
               PERFORM VAL-OFI-PRMT UNTIL WSS-I > 10.
               IF WSS-OFI-NFND IN WSS-VARI = 10
                   DISPLAY 'NO EXISTE NINGUNA OFICINA INGRESADA'
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
                   PERFORM GNS-PRO-ABT.
      *DAD fin  29-MAY-1992

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.
           DISPLAY 'FECHA INICIO  : ' WSS-FEC-FINI IN WSS-VARI.
           DISPLAY 'FECHA TERMINO : ' WSS-FEC-FPRO IN WSS-VARI.
       FIN-PRM-CAN.
           EXIT.

      *-----------------------------------------------------------------
       LIM-OFI-PRMT SECTION.
       INI-LIM-OFI-PRMT.
           MOVE SPACES TO WSS-IND-OFIC IN WSS-VARI(WSS-I)
           ADD 1       TO WSS-I IN WSS-VARI.
       FIN-LIM-OFI-PRMT.
           EXIT.
      *-----------------------------------------------------------------
       VAL-OFI-PRMT SECTION.
       INI-VAL-OFI-PRMT.
           IF WSS-IND-OFIC IN WSS-VARI(WSS-I) NOT = SPACES
               MOVE WSS-IND-OFIC IN WSS-VARI(WSS-I) TO
                                    OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF (MSG-COD-MENS = 'COD    NEX') OR
                  (MSG-COD-MENS = 'COD    NVG')
                    MOVE 'COL' TO MSG-COD-SIST
                    PERFORM GET-MSG
                    DISPLAY 'OFICINA ' WSS-IND-OFIC IN WSS-VARI(WSS-I)
                    ' ' MSG-GLS-DESC
                    ADD 1 TO WSS-OFI-NFND IN WSS-VARI.
           ADD 1 TO WSS-I IN WSS-VARI.
       FIN-VAL-OFI-PRMT.
           EXIT.
      ******************************************************************
       INI-CAN SECTION.
      *---------------
       INI-INI-CAN.
      * Inicializacion de Variables
           MOVE 'TVAL'         TO MSC-CIC-TMSC IN MSC.
           MOVE '0'            TO MSC-CIC-CMSC IN MSC.
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
               DISPLAY 'EN MISCELANEO TVAL NO EXISTE CODIGO 0'
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
               PERFORM GNS-PRO-ABT.
      *DAD fin  29-MAY-1992
           MOVE MSC-COD-CMSC IN MSC TO WSS-COD-CMSC IN WSS-VARI.

      *DAD ini  23-AGO-1991
      * Proceso para Cargar las tablas  TAB/TIO  y  COL/TOC  en Memoria
           PERFORM COL-CRG-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
               PERFORM GNS-PRO-ABT.
      *DAD fin  29-MAY-1992 / 23-AGO-1991
       FIN-INI-CAN.
           EXIT.

       LUP-PUT-VEN SECTION.
      *-------------------
       INI-LUP-VEN.
      * Programacion de Ciclo para Registro VEN
           MOVE WSS-NUM-DINI IN WSS-VARI TO VEN-NUM-DVEN IN VEN.
           MOVE WSS-NUM-MINI IN WSS-VARI TO VEN-NUM-MVEN IN VEN.
           MOVE WSS-NUM-SINI IN WSS-VARI TO VEN-NUM-SVEN IN VEN.
           MOVE WSS-NUM-AINI IN WSS-VARI TO VEN-NUM-AVEN IN VEN.
           MOVE FIO-GET-NLS              TO FIO-CMND.
       LUP-BUS-VEN.
           MOVE 'VEN-FEC-FVEN' TO FIO-AKEY.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
               GO TO FIN-LUP-PUT-VEN.

           ADD 1 TO WSS-NUM-RLEI IN WSS-VARI.

      * Si la fecha de vencimiento es mayor que la ingresada por paramet
           IF VEN-FEC-FVEN IN VEN > WSS-FEC-FTER IN WSS-VARI
               GO TO FIN-LUP-PUT-VEN.

      * Si el vencimiento no esta completo
           IF VEN-IND-CALC IN VEN = 'N'
               GO TO OTRO-VEN.

      * Si el vencimiento esta cancelado
           IF VEN-VAL-SCAP IN VEN = ZEROS AND
              VEN-VAL-SFIN IN VEN = ZEROS
               GO TO OTRO-VEN.

      * Si NO existe la OPC
           MOVE VEN-CIC-IOPC IN VEN TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'OPC    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC
               ADD 1 TO WSS-NUM-RERR IN WSS-VARI
               GO TO OTRO-VEN
           ELSE
      * Si el credito no esta activado
               IF OPC-MSC-STAT IN OPC NOT = 'A'
                   GO TO OTRO-VEN.

      * Valida que el credito no este cancelado
           IF OPC-VAL-SCRE IN OPC NOT > ZEROES
               GO TO OTRO-VEN.

      *DAD ini  23-AGO-1991 (optimizacion)
      * Busca con el Codigo Tipo Operacion en la Tabla cargada en Memori
      * 'Sistema que lo Maneja'
           MOVE OPC-COD-TOOC IN OPC TO CTO-TOOC IN CTO-VARI.
           PERFORM COL-BUS-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
                       'CON CODIGO : '     CTO-TOOC IN CTO-VARI
                       ' EN CREDITO : '    OPC-CIC-IOPC IN OPC
               GO TO OTRO-VEN.

      * Valida el 'Sistema que lo Maneja' de la Operacion de Credito
           IF CTO-SIST IN CTO-VARI NOT = 'COL'
               GO TO OTRO-VEN.
      *DAD fin  23-AGO-1991

      * Valida que pertenezca a la oficina
           IF WSS-COD-OFIC IN WSS-VARI > SPACES AND
              WSS-IND-OFIC IN WSS-VARI(1) NOT = '*'
               MOVE 1 TO WSS-I
               PERFORM SEL-OFI-PRMT UNTIL WSS-I > 10 OR
               OPC-COD-OFOC IN OPC = WSS-IND-OFIC IN WSS-VARI(WSS-I)
               IF WSS-I > 10
                   GO TO OTRO-VEN.

      ** Busca vencimiento en DLC para revisar que no existan
      ** vencimientos morosos
      *     MOVE VEN-CIC-IOPC IN VEN TO DLC-CIC-IOPC IN DLC.
      *     MOVE VEN-NUM-IDLC IN VEN TO DLC-NUM-IDLC IN DLC.
      *     MOVE FIO-GET-KEY         TO FIO-CMND.
      *     PERFORM COL-FIO-DLC.
      *     IF FIO-STAT-OKS
      ** Revisa que no existan vencimientos morosos
      *         IF DLC-IND-SCTB IN DLC NOT > SPACES OR
      *            DLC-IND-SCTB IN DLC = 'VIG'
      *             NEXT SENTENCE
      *         ELSE
      *             GO TO OTRO-VEN
      *     ELSE
      *         DISPLAY 'NO EXISTE REGISTRO DLC EN VEN : ' VEN-CIC-IOPC
      *                                                          IN VEN
      *         ADD 1 TO WSS-NUM-RERR IN WSS-VARI
      *         GO TO OTRO-VEN.
      *SE REEMPLAZA LA LECTURA DEL DLC POR EL VEN ANTERIOR PARA VER SI E
      *CANCELADO
           IF VEN-NUM-IVEN IN VEN NOT > 1
               GO TO CON-LUP-PUT-VEN.
           MOVE 'N'                 TO WSS-IND-OTRO.
           MOVE VEN-KEY-IVEN IN VEN TO WSS-VEN-KEY-IVEN.
           SUBTRACT 1 FROM VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF FIO-STAT-OKS AND
              VEN-CIC-IOPC IN VEN = WSS-VEN-CIC-IOPC
               IF VEN-VAL-SFIN IN VEN > ZEROES OR
                  VEN-VAL-SCAP IN VEN > ZEROES
                   MOVE 'S' TO WSS-IND-OTRO
               ELSE
                   MOVE 'N' TO WSS-IND-OTRO
           ELSE
               MOVE 'N' TO WSS-IND-OTRO.
           MOVE WSS-VEN-KEY-IVEN TO VEN-KEY-IVEN IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF WSS-IND-OTRO = 'S'
               GO TO OTRO-VEN.
       CON-LUP-PUT-VEN.
      *DAD ini  23-AGO-1991
           IF VEN-NUM-IVCT IN VEN NOT = OPC-NUM-IVEN IN OPC
               DISPLAY 'ERROR DE INCONSISTENCIA: NO CORRESPONDE EL '
                       'OPC-NUM-IVEN CON EL VENCIMIENTO A CARGAR '
                       'EN CREDITO : '    OPC-CIC-IOPC IN OPC
               GO TO OTRO-VEN.
      *DAD fin  23-AGO-1991

      * Valida que el vencimiento del credito tenga cargo automatico en
           PERFORM BUS-CYA-AUT.
           IF NOT (FIO-STAT-OKS AND VEN-IND-CAUT IN VEN NOT = 'N')
               GO TO OTRO-VEN.

      *DAD ini  23-FEB-1993   (Memo.22-02-93 Pto.1)
           PERFORM DET-CLI-CCTE.
           IF MSG-COD-MENS > SPACES
               GO TO DIS-MEN-ERR.
      *DAD fin  23-FEB-1993

      *JSS 17-DEC-1991 18:26:21 (Memo.09-12-91)
           MOVE SPACES TO WSS-GLS-MEN2.
           MOVE 0 TO WSS-NUM-IVCT.
           PERFORM BUS-REG-RCV.
           IF MSG-COD-MENS > SPACES
               GO TO DIS-MEN-ERR.

           MOVE SPACES TO WSS-GLS-MEN2.
           MOVE VEN-NUM-IVCT IN VEN TO WSS-NUM-IVCT.
           PERFORM BUS-REG-RCV.
           IF MSG-COD-MENS > SPACES
               GO TO DIS-MEN-ERR.
      *HZF 20.08.1993-INI
      *CARGA VARIABLES DE 'COMMAREA' PARA SIMULAR INGRESO
           MOVE 'ING' TO SCR-CMND SCR-CCPP.
           MOVE 'M'   TO SCR-STPP.

      *OBTENER DATOS DE CANCELACION INGRESANDO SOLO LA CLAVE
           MOVE LOW-VALUES   TO CAN-FLD.
           MOVE OPC-CAI-IOPC IN OPC TO CAN-CAI-IOPC IN CAN-FLD.
           MOVE OPC-IIC-IOPC IN OPC TO CAN-IIC-IOPC IN CAN-FLD.
           PERFORM FND-KEY.
           DISPLAY 'STAT   :'          FIO-STAT.
           IF FIO-STAT-OKS OR FIO-STAT = FIO-STAT-NEX
               MOVE 'ERROR' TO WSS-CMSG
               DISPLAY 'FIO-STAT'  FIO-STAT
               DISPLAY OPC-CIC-IOPC IN OPC ':' FRM-MENS
               GO TO OTRO-VEN.
           PERFORM EDT-KEY-CAN.
           PERFORM EDT-FLD-CAN.
           DISPLAY 'CAN ICC:'          CAN-CAI-IOPC IN CAN-FLD.
           DISPLAY 'CAN CAI:'          CAN-IIC-IOPC IN CAN-FLD.
           PERFORM GEN-CTE.
      *HZF 20.08.1993-INI
       DIS-MEN-ERR.
           IF WSS-CMSG > SPACES
              IF FRM-MENS > SPACES
                 DISPLAY FRM-MENS
                 PERFORM BCK-OUT
              ELSE
                 MOVE WSS-CMSG TO MSG-COD-MENS
                 MOVE 'COL' TO MSG-COD-SIST
                 PERFORM GET-MSG
                 DISPLAY MSG-GLS-DESC WSS-GLS-MEN2
                 ADD 1 TO WSS-NUM-RERR IN WSS-VARI
                 PERFORM BCK-OUT
           ELSE
               ADD 1 TO WSS-NUM-RPRO IN WSS-VARI
               PERFORM CHK-PNT.
       OTRO-VEN.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-BUS-VEN.
       FIN-LUP-PUT-VEN.
           EXIT.

      *DAD ini  23-FEB-1993   (Memo.22-02-93 Pto.1)
      * Determina a quien pertenece Cta.Cte de cargo (Mismo/Otro) Client
       DET-CLI-CCTE SECTION.
       INI-DET-CLI-CCTE.
           MOVE SPACES TO WSS-MSC-CCAA IN WSS-VARI
                          MSG-COD-MENS.

      * Busca CIC del Cliente con el CIC del Credito en RDC
      * RDC-NUM-IDLC = 0 ====> DEU.DIR.
           MOVE CYA-CIC-IOPC IN CYA TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC'      TO FIO-AKEY.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT FIO-STAT-OKS
               MOVE 'RDC    NOCLI'      TO MSG-COD-MENS
               MOVE RDC-KEY-IDLC IN RDC TO WSS-GLS-MEN2
               GO TO FIN-DET-CLI-CCTE.

      * Chequea pertenesca al Cliente Credito la Cta.Cte de cargo en RCO
           MOVE RDC-CIC-ICLI IN RDC TO RCO-CIC-ICLI IN RCO.
           MOVE CYA-CIC-ICYA IN CYA TO RCO-CIC-IOPE IN RCO.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF FIO-STAT-OKS
               MOVE WSS-MSC-CCAM IN WSS-VARI TO WSS-MSC-CCAA IN WSS-VARI
               GO TO VIG-DET-CLI-CCTE.

      * Chequea pertenesca a Otro Cliente la Cta.Cte de cargo en RCO
           MOVE CYA-CIC-ICYA IN CYA TO RCO-CIC-IOPE IN RCO.
           MOVE 'RCO-KEY-IOPE' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF FIO-STAT-OKS
               MOVE WSS-MSC-CCAO IN WSS-VARI TO WSS-MSC-CCAA IN WSS-VARI
           ELSE
               MOVE 'CICICYACCNEX'      TO MSG-COD-MENS
               MOVE CYA-CIC-ICYA IN CYA TO WSS-GLS-MEN2
               GO TO FIN-DET-CLI-CCTE.
       VIG-DET-CLI-CCTE.
           MOVE RCO-CIC-IOPE IN RCO TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF OPE-FEC-FTOP IN OPE > ZEROES
               IF OPE-FEC-FTOP IN OPE > OPE-FEC-FROP IN OPE
                   MOVE 'FECFTOPICYA>'      TO MSG-COD-MENS
                   MOVE OPE-CIC-IOPE IN OPE TO WSS-GLS-MEN2.
       FIN-DET-CLI-CCTE.
           EXIT.
      *DAD fin  23-FEB-1993
      ******************************************************************
       BUS-REG-RCV SECTION.
       INI-BUS-REG-RCV.
           MOVE 'P'                 TO WSS-COD-IPAR.
           MOVE SPACES              TO MSG-COD-MENS.
      *DAD ini  23-AGO-1991
           MOVE SPACES              TO WSS-RCV-CIC-IOPC-P IN WSS-VARI.
           MOVE ZEROES              TO WSS-RCV-NUM-ICAN-P IN WSS-VARI.
      *DAD fin  23-AGO-1991
           MOVE VEN-CIC-IOPC IN VEN TO RCV-CIC-IOPV IN RCV.
           MOVE WSS-NUM-IVCT        TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-BUS-REG-RCV.
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           PERFORM COL-FIO-RCV.
           IF NOT ( FIO-STAT-OKS AND
                    RCV-CIC-IOPV IN RCV = VEN-CIC-IOPC IN VEN AND
                    RCV-NUM-IVCT IN RCV = WSS-NUM-IVCT )
               GO TO CON-BUS-REG-RCV.
           IF WSS-COD-IPAR = 'P'
               MOVE 'I' TO WSS-COD-IPAR
           ELSE
               MOVE 'P' TO WSS-COD-IPAR.
      *DAD ini  23-AGO-1991
           IF RCV-NUM-ICAN IN RCV > WSS-RCV-NUM-ICAN-P IN WSS-VARI
               MOVE RCV-SGV-FINA IN RCV TO WSS-SGV-FINA IN WSS-VARI
               MOVE RCV-SGV-CAPI IN RCV TO WSS-SGV-CAPI IN WSS-VARI
               MOVE RCV-KEY-ICAN IN RCV TO WSS-RCV-KEY-ICAN
                                                        IN WSS-VARI.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-BUS-REG-RCV.

       CON-BUS-REG-RCV.
           IF WSS-RCV-CIC-IOPC-P IN WSS-VARI NOT > SPACES
               GO TO FIN-BUS-REG-RCV.
      *DAD fin  23-AGO-1991

           MOVE WSS-RCV-KEY-ICAN IN WSS-VARI TO CAN-KEY-ICAN IN CAN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
      *DAD ini  23-AGO-1991
           IF FIO-STAT-OKS
               IF CAN-MSC-STAT IN CAN = 'G' OR
                  CAN-MSC-STAT IN CAN = 'H' OR
                  CAN-MSC-STAT IN CAN = 'P' OR
                  CAN-MSC-STAT IN CAN = 'S' OR
                  CAN-MSC-STAT IN CAN = 'W' OR
                  CAN-MSC-STAT IN CAN = 'C' OR
                  CAN-MSC-STAT IN CAN = 'I' OR
                  CAN-MSC-STAT IN CAN = 'V'
                   MOVE 'CAN    YAEXI'      TO MSG-COD-MENS
                   MOVE CAN-KEY-ICAN IN CAN TO WSS-GLS-MEN2
               ELSE
               IF CAN-MSC-STAT IN CAN = 'A'
      *Si existen CTT ( existen antiguas que no tienen cambiado el
      *signo ==> que si existen CTT pares asume REVERSA )(Memo.09-12-91)
                   IF WSS-NUM-IVCT = 0
                       IF WSS-SGV-FINA IN WSS-VARI < ZEROES OR
                          WSS-SGV-CAPI IN WSS-VARI < ZEROES OR
                          WSS-COD-IPAR = 'P'
                           GO TO FIN-BUS-REG-RCV
                       ELSE
                           MOVE 'CAN    YAEXI'      TO MSG-COD-MENS
                           MOVE CAN-KEY-ICAN IN CAN TO WSS-GLS-MEN2
                   ELSE
      *
                   IF WSS-SGV-FINA IN WSS-VARI NOT < ZEROES AND
                      WSS-SGV-CAPI IN WSS-VARI NOT < ZEROES
                       MOVE 'CAN    YAEXI'      TO MSG-COD-MENS
                       MOVE CAN-KEY-ICAN IN CAN TO WSS-GLS-MEN2
                   ELSE
                       GO TO FIN-BUS-REG-RCV
               ELSE
      *JSS 17-DEC-1991 18:26:58 (Memo.09-12-91)
      *         IF CAN-MSC-STAT IN CAN = 'I' OR
      *            CAN-MSC-STAT IN CAN = 'V'
      *             DISPLAY 'SE ELIMINAN CANCELACION Y ENTIDADES ANEXAS'
      *                     ' ASOCIADAS A : ' CAN-KEY-ICAN IN CAN
      *             PERFORM COL-ELI-CAN
      *             IF ECA-CMSG IN ECA-VARI > SPACES
      *                 MOVE ECA-CMSG IN ECA-VARI TO MSG-COD-MENS
      *                 MOVE ECA-MEN2 IN ECA-VARI TO WSS-GLS-MEN2
      *             ELSE
      *                 NEXT SENTENCE
      *         ELSE
                   DISPLAY 'CANCELACION CON STATUS DESCONOCIDO : '
                            CAN-MSC-STAT IN CAN
                   MOVE 'CAN    YAEXI'      TO MSG-COD-MENS
                   MOVE CAN-KEY-ICAN IN CAN TO WSS-GLS-MEN2.
      *DAD fin  23-AGO-1991
       FIN-BUS-REG-RCV.
           EXIT.

      *OBTENER DATOS DE CANCELACION INGRESANDO SOLO LA CLAVE

       GEN-CTE SECTION.
       INI-GEN-CTE.
           MOVE SPACES TO WSS-CMSG.
      *CALCULA CANCELACION CPE PARA PRESTAMO INTERMEDIO
           MOVE 'CTE'                   TO CAN-MSC-CANC IN CAN-FLD.
           MOVE OPC-COD-RMOC IN OPC     TO CAN-COD-RCAN IN CAN-FLD.
           MOVE OPC-COD-OFOC IN OPC     TO CAN-COD-OFCA IN CAN-FLD.
           MOVE WSS-FEC-FFCA            TO CAN-FEC-FCAN IN CAN-FLD.
      *DAD ini  09-JUL-1991
      *     MOVE 'CCMA'                  TO CYA-IND-TCYA IN CYA.
           MOVE WSS-MSC-CCAA IN WSS-VARI TO CYA-IND-TCYA IN CAN-FLD.
      *DAD fin  09-JUL-1991
           MOVE AUT-CAI-ICYA IN AUT     TO CYA-CAI-ICYA IN CAN-FLD.
           MOVE AUT-IIC-ICYA IN AUT     TO CYA-IIC-ICYA IN CAN-FLD.
      *    IF AUT-IND-TCYA IN AUT > SPACES
      *       MOVE AUT-IND-TCYA IN AUT  TO CYA-IND-TCYA IN CAN-FLD
      *    ELSE
      *       MOVE 'CMCM'               TO CYA-IND-TCYA IN CAN-FLD.

           PERFORM COL-CAL-CANC.
           IF FRM-SUAR = FRM-SUAR-MAL
               MOVE 'ERROR' TO WSS-CMSG
               DISPLAY OPC-CIC-IOPC IN OPC ':' FRM-MENS
               GO TO FIN-GEN-CTE.
      *GRABAR LAS ENTIDADES RELACIONADAS A LA CANCELACION
           MOVE SPACES TO WSS-CMSG.
           PERFORM CMN-ING.
       FIN-GEN-CTE.
           EXIT.

       BUS-CYA-AUT SECTION.
       INI-BUS-CYA-AUT.
           MOVE OPC-CAI-IOPC IN OPC TO AUT-CAI-IOPC IN AUT.
           MOVE OPC-IIC-IOPC IN OPC TO AUT-IIC-IOPC IN AUT.
           MOVE 'AUT'               TO AUT-NUM-ICAN IN AUT.
           MOVE 1                   TO AUT-NUM-ICYA IN AUT.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-AUT.
           IF FIO-STAT-OKS
               MOVE AUT TO CYA.
       FIN-BUS-CYA-AUT.
           EXIT.

       CLOSE-FILE SECTION.
      *-----------------
       INI-CLOSE-FILE.
      *ABRE ARCHIVOS DE TABLAS DE COL, CAMBIOS, TOC
           MOVE FIO-CLO TO FIO-CMND.
           MOVE 'COL'   TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE 'TAB'   TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           PERFORM COL-FIO-DLC.
           PERFORM COL-FIO-ICG.
           PERFORM SGC-FIO-DBC.
           PERFORM COL-FIO-RDC.
           PERFORM SGC-FIO-RCO.
           PERFORM SGC-FIO-OPE.
           PERFORM TAB-FIO-CAM.
           PERFORM COL-FIO-EVC.
           PERFORM COL-FIO-VEN.
           PERFORM COL-FIO-RCV.
           PERFORM COL-FIO-CYA.
           PERFORM COL-FIO-CAN.
           PERFORM COL-FIO-OPC.
           PERFORM COL-FIO-ROV.
       FIN-CLOSE-FILE.
           EXIT.
       SEL-OFI-PRMT SECTION.
      *--------------------
        INI-SEL-OFI-PRMT.
           ADD 1 TO WSS-I.
        FIN-SEL-OFI-PRMT.
           EXIT.

       FND-KEY SECTION.
       INI-FND-KEY.
           PERFORM KEY-ALL-CAN.
      *<<<< FND_KEY
           DISPLAY 'FIO-STAT ANTES  DECOLB1CAN '   FIO-STAT
       COPY COLB1CAN.
      *>>>>
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           MOVE FIO-STAT TO PGM-STAT-CAN.
      *<<<< FIN_FND_KEY
       COPY COLB2CAN.
      *COLPOCAN
      *========
           IF SCR-CMND = 'REV'
               GO TO FND-KEY-REV.
           PERFORM GET-FEC-FCVC.
           IF PGM-STAT-CAN-OKS
               IF SCR-CMND = 'CAN' AND
                   CAN-FEC-FOUT IN CAN NOT = CAN-FEC-FCAN IN CAN
                   MOVE 'COL' TO MSG-COD-SIST
                   MOVE 'FECFCANNFOUT' TO MSG-COD-MENS
                   PERFORM GET-MSG
      *             STRING MSG-GLS-DESC
      *                MSG-GLS-DATA DELIMITED BY SIZE
      *             INTO FRM-MENS
                   MOVE MSG-GLS-DESC TO CPT-STR1
                   MOVE MSG-GLS-DATA TO CPT-STR2
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN     TO FRM-MENS
                   MOVE '00' TO FIO-STAT
                   MOVE SCR-STAT-CON TO SCR-STAT
                   GO TO FIN-FND-KEY
               ELSE
               IF SCR-CMND = 'CVC'
                   IF SCR-CYA-IND-PAUT = 'S'
                       MOVE 'COL' TO MSG-COD-SIST
                       MOVE 'TCYAAUTNOCVC' TO MSG-COD-MENS
                       PERFORM GET-MSG
      *                 STRING MSG-GLS-DESC
      *                 MSG-GLS-DATA DELIMITED BY SIZE
      *                   INTO FRM-MENS
                       MOVE MSG-GLS-DESC TO CPT-STR1
                       MOVE MSG-GLS-DATA TO CPT-STR2
                       PERFORM CPT-BLKS
                       MOVE CPT-STRN     TO FRM-MENS
                       MOVE '00' TO FIO-STAT
                       MOVE SCR-STAT-CON TO SCR-STAT
                       GO TO FIN-FND-KEY.
      *     PERFORM VRF-CAJA.
      *     IF WSS-IND-CAJA = 'S'
      **     PERFORM REL-COL-SAF.
      **     IF MSG-COD-MENS > SPACES
      **         MOVE '00' TO FIO-STAT
      **         MOVE SCR-STAT-CON TO SCR-STAT
      **         GO TO FIN-FND-KEY.
       FND-KEY-REV.
           MOVE PGM-STAT-CAN TO FIO-STAT.
      *FIN-COLPOCAN
      *-------------
      *>>>>
       FIN-FND-KEY.
           EXIT.

      *COPY COLBGCAN.
      *SIMULA INGRESO CANCELACION
      *INPUT : FORMATO PANTALLA CAN-FLD
      *OUTPUT: FORMATO PANTALLA CAN-FLD
      *STATUS: FRM-SUAR ( IF FRM-SUAR = FRM-SUAR-MAL INDICA ERROR )
       COL-CAL-CANC SECTION.
       INI-COL-CAL-CANC.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-COL-CAL-CANC.
           PERFORM VAL-NUM-FLD-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-COL-CAL-CANC.
           PERFORM VAL-MKY-CAN.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-COL-CAL-CANC.
      *ISP ES NECESARIO TENER LOS DATOS DE LA OPERACION
      *    PARA LA VALIDACION DE CAMPOS
           DISPLAY 'LEE OPC:'  CAN-CAI-IOPC IN CAN-FLD ' '
                               CAN-IIC-IOPC IN CAN-FLD.
           MOVE CAN-CAI-IOPC IN CAN-FLD TO OPC-CAI-IOPC IN OPC.
           MOVE CAN-IIC-IOPC IN CAN-FLD TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'OPC    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO ERR-COL-CAL-CANC.

      *ISP ES NECESARIO TENER LOS DATOS DEL VENCIMIENTO
      *    PARA LA VALIDACION DE CAMPOS
           DISPLAY 'LEE VEN: ' SCR-VEN-NUM-IVEN.
           MOVE CAN-CAI-IOPC IN CAN-FLD TO VEN-CAI-IOPC IN VEN.
           MOVE CAN-IIC-IOPC IN CAN-FLD TO VEN-IIC-IOPC IN VEN.
           MOVE SCR-VEN-NUM-IVEN        TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           IF OPC-IND-VSTR IN OPC = 'S'
               PERFORM COL-OBT-VEN
               IF VEN-STAT-OKS OR VEN-STAT-ENO
                   MOVE VEN-NUM-IVEN IN VEN TO
                        VEN-NUM-IVCT IN VEN
                   MOVE '00' TO FIO-STAT
           DISPLAY 'LEYO VEN: '
               ELSE
                   MOVE '23' TO FIO-STAT
           ELSE
               PERFORM COL-FIO-VEN.

           IF NOT FIO-STAT-OKS
           DISPLAY 'OBT MSG   '
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'VEN    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO ERR-COL-CAL-CANC.

      *ISP SI ES CREDITO REAJUSTABLE ==> VALOR PAGADO EN PESOS, CALCULOS
      *    EN LA MONEDA
      *     IF CAN-SGV-TPAG IN CAN-FLD = ZEROES
      *         GO TO NOT-VAL-CAN-SGV-TPAG.
      *
           PERFORM GET-MON.

           DISPLAY 'VAL-FLD-CAN'
           PERFORM VAL-FLD-CAN.
           DISPLAY 'VAL-FLD-CAN OK'
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-COL-CAL-CANC.
           PERFORM VAL-CON-FLD-CAN.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-COL-CAL-CANC.
           DISPLAY 'FST-FLD-CAN'
           PERFORM FST-FLD-CAN.
           DISPLAY 'FST-FLD-CAN OK'.
       ERR-COL-CAL-CANC.
       FIN-COL-CAL-CANC.
           EXIT.

       CMN-ING SECTION.
       INI-CMN-ING.
           PERFORM RET-ALL-CAN.
      *<<<< CMN_ING
      *ACTIVAR ALD MOVE ZEROES TO CAN-SGV-INTE IN CAN.
      *ACTIVAR ALD MOVE ZEROES TO CAN-SGV-GAST IN CAN.
      *ACTIVAR ALD MOVE ZEROES TO CAN-SGV-RDVA IN CAN.
      *ACTIVAR ALD MOVE ZEROES TO CAN-SGV-IDVA IN CAN.
      *ACTIVAR ALD MOVE ZEROES TO CAN-SGV-DPVA IN CAN.
      *ACTIVAR ALD MOVE ZEROES TO CAN-SGV-CDVA IN CAN.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO CAN-NUM-DTRN IN CAN.
           MOVE HOY-MHOY IN HOY-VARI TO CAN-NUM-MTRN IN CAN.
           MOVE HOY-AHOY IN HOY-VARI TO CAN-NUM-ATRN IN CAN.
           MOVE HOY-SHOY IN HOY-VARI TO CAN-NUM-STRN IN CAN.
           MOVE HOY-HHOY IN HOY-VARI TO CAN-HRA-HRTR IN CAN.

      *ISP ES NECESARIO TENER LOS DATOS DE LA OPERACION
           PERFORM GET-OPC.

           IF SCR-MSC-FCAN = 'T' AND
              SCR-MSC-ECAN = 'E'
                MOVE 1 TO CAN-NUM-TVCC IN CAN
           ELSE
           IF SCR-MSC-FCAN = 'T' AND
              SCR-MSC-ECAN = 'T'
                MOVE OPC-NUM-VCVG IN OPC TO CAN-NUM-TVCC IN CAN
           ELSE
           IF SCR-MSC-FCAN = 'I' OR 'P'
                MOVE ZEROES TO CAN-NUM-TVCC IN CAN
           ELSE
                MOVE 1 TO CAN-NUM-TVCC IN CAN.

      *ISP ASUME CANCELACION NO VERIFICADA
           MOVE 'I' TO WSS-MSG-FENT.
           MOVE 'I' TO CAN-MSC-STAT IN CAN.
           PERFORM VRF-ACT-CYA.
           IF NOT PGM-STAT-CYA-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-ING.
           IF SCR-MSC-TCAN = 'R' OR 'P'
               PERFORM ASS-OPC-ROV
               IF NOT FIO-STAT-OKS
                   MOVE 'I' TO CAN-MSC-STAT IN CAN.
      *HZF-INI
      *GRABACION USUARIO AUTOR TRANSACCION
           MOVE SCR-USER TO CAN-COD-ATRN IN CAN.
           IF CAN-MSC-STAT IN CAN     NOT = 'V'
              DISPLAY 'CANCELACION SIN VERIFICAR NO SE GENERA '
              DISPLAY 'OPERACION ' OPC-CIC-IOPC IN OPC
              DISPLAY 'CAN-MSC-STAT ' CAN-MSC-STAT IN CAN
              GO TO FIN-CMN-ING.
           MOVE 'G'  TO CAN-MSC-STAT IN CAN
      *HZF-FIN
      *>>>>
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           DISPLAY 'GRABO CAN'
      *<<<< FIN_CMN_ING
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en el ingreso : informar
               MOVE 'CANERRORPUT' TO WSS-CMSG
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ING.

           PERFORM ACT-ICG.
           IF NOT PGM-STAT-ICG-OKS
               MOVE 'ICGERRORPUT' TO WSS-CMSG
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-ING.

           PERFORM ACT-RCV.
           IF NOT FIO-STAT-OKS
               MOVE 'RCVERRORPUT' TO WSS-CMSG
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-ING.


       END-CMN-ING.

      **     IF CYA-IND-TCYA IN CAN-FLD = 'M'
      **         MOVE CAN-CAI-IOPC IN CAN-FLD TO SCR-CAI-IOPC
      **         MOVE CAN-IIC-IOPC IN CAN-FLD TO SCR-IIC-IOPC
      **         MOVE CAN-NUM-ICAN IN CAN-FLD TO SCR-NUM-IDOC
      **         MOVE 2 TO WSS-IDX-ICYA
      **         MOVE 'S'    TO SCR-IND-ENG IN SCR-VEC-ENG(WSS-IDX-ICYA)
      **         MOVE 'S'    TO SCR-IND-FST IN SCR-VEC-FST(WSS-IDX-ICYA)
      **         PERFORM EGR-FPEN-CIC.

      *>>>>
       FIN-CMN-ING.
           EXIT.
       VRF-ACT-CYA SECTION.
       INI-VRF-ACT-CYA.

           MOVE '00' TO PGM-STAT-CYA.
           MOVE 'CAN      '  TO WSS-MSG-PREV.
           MOVE SCR-MSC-TCAN TO WSS-MSG-TENT.
           MOVE 'N'          TO WSS-MSG-SENT.
           IF CYA-IND-TCYA IN CAN-FLD = 'M'
               GO TO MSG-VRF-ACT-CYA.

           PERFORM ACT-CYA.
           IF NOT PGM-STAT-CYA-OKS
                MOVE FIO-STAT TO PGM-STAT-CYA
                GO TO FIN-VRF-ACT-CYA.

      *     IF CAN-SGV-TPAG IN CAN = CYA-SGV-LIQU IN CYA
           MOVE 'V' TO CAN-MSC-STAT IN CAN.
           MOVE 'V' TO WSS-MSG-SENT.
       MSG-VRF-ACT-CYA.
           MOVE 'COL' TO MSG-COD-SIST.
           MOVE WSS-MSG-MENS TO MSG-COD-MENS.
           PERFORM GET-MSG.
           IF WSS-MSG-SENT = 'N'
               MOVE WSS-SGV-TCYA TO WSS-NUM-FEDT
               MOVE CAN-SGV-TPAG IN CAN TO WSS-NUM-FALF
      *         STRING MSG-GLS-DESC
      *                WSS-NUM-FEDT
      *                MSG-GLS-DATA
      *                WSS-NUM-FALF DELIMITED BY SIZE
      *         INTO FRM-MENS
               MOVE MSG-GLS-DESC TO WSS-CPT-DESC
               MOVE WSS-NUM-FEDT TO WSS-CPT-FEDT
               MOVE MSG-GLS-DATA TO WSS-CPT-DATA
               MOVE WSS-NUM-FALF TO WSS-CPT-FALF
               MOVE WSS-CPT-BLKS TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN     TO FRM-MENS
               ELSE
      *         STRING MSG-GLS-DESC
      *                MSG-GLS-DATA DELIMITED BY SIZE
      *         INTO FRM-MENS.
               MOVE MSG-GLS-DESC TO CPT-STR1
               MOVE MSG-GLS-DATA TO CPT-STR2
               PERFORM CPT-BLKS
               IF CAN-SGV-DIFE IN CAN-FLD = ZEROES
                   MOVE CPT-STRN     TO FRM-MENS
               ELSE
                   MOVE CPT-STRN     TO FRM-MEN1
                   MOVE 'CANVRFOKDIFE' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO WSS-MEN1-1
                   MOVE CAN-SGV-DIFE IN CAN-FLD TO WSS-SGV-DIFE
                   MOVE WSS-SGV-DIFE            TO WSS-SGV-DIFE-EDT
                   MOVE WSS-SGV-DIFE-ALF        TO WSS-MEN1-2
                   MOVE WSS-MEN1                TO FRM-MEN2.
       FIN-VRF-ACT-CYA.
           EXIT.
       CHK-PNT SECTION.
       INI-CHK-PNT.
           MOVE FIO-CHK-PNT TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
               DISPLAY 'CHECK-PNT ERRONEO'.
       FIN-CHK-PNT.
           EXIT.
       COPY COLB3CAN.
       COPY COLBGVEN.
       COPY COLBGCLI.
       COPY COLBMCAN.
      *COPY COLBQCAN.
      *COPY COLBUCAN.
       COPY COLBFOPC.
       COPY COLBFEJC.
       COPY COLBFPOC.
       COPY COLBFRDC.
      *COPY COLBFTMC.
       COL-FIO-TMC SECTION.
       INI-COL-FIO-TMC.
           MOVE '23' TO FIO-STAT.
       FIN-COL-FIO-TMC.
           EXIT.
      *
       COPY COLBFDLC.
       COPY COLBFVEN.
       COPY COLBFEVC.
       COPY COLBFCAN.
       COPY COLBFRCV.
       COPY COLBFCYA.
       COPY COLBFAUT.
       COPY COLBFICG.
       COPY COLBFITR.
       COPY COLBFROV.
      *MODULO FIO POR CADA TABLA VSAM
       COPY SGCBFRCO.
       COPY SGCBFOPE.
       COPY GNSBFMSC.
       COPY SGCBFDBC.
       COPY GNSBFMSG.
       COPY COLBFTOC.
       COPY GNSBFCIC.
       COPY GNSBFTAB.
       COPY TABBFCAM.
       COPY TABBFUSR.
       COPY TABBFOFI.

      *MODULO DE SERVICIOS DEL SISTEMA
       COPY GNSBBSYS.
      *MODULO PARA DETENER EJECUCION DEL PROGRAMA
       COPY GNSBGEND.
      *MODULO PARA BUSCAR EN TABLAS
       COPY GNSBBMSC.
      *MODULO VARIOS
       COPY GNSBVTAB.
       COPY GNSBVMSC.
       COPY GNSBEKEY.
       COPY GNSBBMSG.
       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY GNSBGCAM.
       COPY TABBBUSR.
       COPY GNSBBTAB.
       COPY GNSBGCIC.
       COPY TABBVTDU.
       COPY GNSBVCOD.
       COPY GNSBGCPT.
       COPY GNSBGPES.
       COPY GNSBVIND.
      *MODULO DE VALIDAR FECHAS
       COPY GNSBGFEC.
       COPY GNSBPFEC.
      *MODULO PARA OBTENER DIA DE HOY
       COPY GNSBGHOY.
      *MODULO VCD
      *COPY COLBGVCD.
      *MODULO INT
       COPY COLBGINT.
      *MODULO COM
       COPY COLBGCOM.
       COPY COLBFCOM.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY COLBGCTO.
      *RUTINA NUMERICA.
       COPY GNSBVNUM.
       COPY GNSBGABT.
       COPY GNSBTABT.
       COPY GNSBVIDC.
       COPY GNSBPVRF.
       COPY COLBGVDI.
      *VAL-DAT-PREV-ING SECTION.
      *INI-VAL-DAT-PREV-ING.
      *    MOVE SPACES TO MSG-COD-MENS IN MSG.
      *FIN-VAL-DAT-PREV-ING.
      *EXIT.
