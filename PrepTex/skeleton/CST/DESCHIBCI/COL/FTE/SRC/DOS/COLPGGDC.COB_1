       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPGGDC.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.
      * Programa Separador de Interfaz Contable en Lotes
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------*
       FILE-CONTROL.
       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       WORKING-STORAGE SECTION.
      *-----------------------*
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY COLBRGDC.
       COPY COLBRRDC.
       COPY COLBRCAN.
       COPY SGCBRDBC.
       COPY FREBRDDC.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.
       COPY GNSWGFEC.
       COPY GNSBRMSG.
       COPY GNSBRTAB.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGHOY.

       01  WSS-VARI.
           03  PAR-FEC-FPAR.
               05 FILLER                        PIC X(01).
               05 PAR-NUM-DPAR   VALUE ZEROES   PIC 9(02).
               05 FILLER                        PIC X(01).
               05 PAR-NUM-MPAR   VALUE ZEROES   PIC 9(02).
               05 FILLER                        PIC X(01).
               05 PAR-NUM-APAR   VALUE ZEROES   PIC 9(02).
           03  WSS-FEC-FPRO.
               05 WSS-NUM-DPRO   VALUE ZEROES   PIC 9(02).
               05 WSS-NUM-MPRO   VALUE ZEROES   PIC 9(02).
               05 WSS-NUM-SPRO   VALUE ZEROES   PIC 9(02).
               05 WSS-NUM-APRO   VALUE ZEROES   PIC 9(02).
           03  WSS-FEC-FAUX.
               05 WSS-NUM-SAUX   VALUE ZEROES   PIC 9(02).
               05 WSS-NUM-AAUX   VALUE ZEROES   PIC 9(02).
               05 WSS-NUM-MAUX   VALUE ZEROES   PIC 9(02).
               05 WSS-NUM-DAUX   VALUE ZEROES   PIC 9(02).
           03  WSS-NUM-RLEI      VALUE ZEROES   PIC 9(03).
           03  WSS-NUM-RSEL      VALUE ZEROES   PIC 9(03).
           03  WSS-NUM-RRCH      VALUE ZEROES   PIC 9(03).
           03  WSS-FEC-FCTB      VALUE ZEROES   PIC 9(08).

      *
       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
      *------------*
       INI-MAIN.
           COPY GNSBGEDB.
           MOVE 'COLPGGDC' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           PERFORM OPEN-FILE.
           PERFORM LEE-PARAM.
           PERFORM INP-SRT.
           PERFORM CLOSE-FILE.
           PERFORM MUESTRA-ESTAD.
       FIN-MAIN.
           PERFORM GNS-PRO-END.
      *
      *
       OPEN-FILE SECTION.
      *-----------------*
       INI-OPEN-FILE.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-GDC.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM FRE-FIO-DDC.
       FIN-OPEN-FILE.
           EXIT.
      *
      *
       LEE-PARAM SECTION.
      *-----------------*
       INI-LEE-PARAM.
           DISPLAY 'CAPTURA DE PARAMETROS.'.
           DISPLAY '----------------------'.
           DISPLAY ' '.
           DISPLAY 'FECHA ULTIMO DIA MES PROCESO: '.
           ACCEPT PAR-FEC-FPAR IN WSS-VARI.
           MOVE PAR-NUM-DPAR TO WSS-NUM-DPRO IN WSS-VARI.
           MOVE PAR-NUM-MPAR TO WSS-NUM-MPRO IN WSS-VARI.
           IF PAR-NUM-APAR > 80
               MOVE 19 TO WSS-NUM-SPRO IN WSS-VARI
           ELSE
               MOVE 20 TO WSS-NUM-SPRO IN WSS-VARI.
           MOVE PAR-NUM-APAR TO WSS-NUM-APRO IN WSS-VARI.
           DISPLAY WSS-FEC-FPRO IN WSS-VARI.
           DISPLAY ' '.

           DISPLAY 'INICIO VALIDACION DE PARAMETROS.'.
      *VAL-FEC Valida fecha proceso
            DISPLAY ' '.
           DISPLAY 'FECHA DE PROCESO:' WSS-FEC-FPRO IN WSS-VARI.
           MOVE WSS-FEC-FPRO IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC             TO FEC-FORM.
           MOVE FEC-FBLK-N               TO FEC-FBLK.
           MOVE FEC-CHOY-N               TO FEC-CHOY.
           MOVE FEC-VHBL-N               TO FEC-VHBL.
           MOVE FEC-VAL-FEC              TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO '
              DISPLAY ' ERROR EN VALIDACION F. DE PROCESO : '
                        WSS-FEC-FPRO IN WSS-VARI '  ' FEC-MENS
              PERFORM GNS-PRO-ABT.

           MOVE WSS-NUM-SPRO IN WSS-VARI TO WSS-NUM-SAUX IN WSS-VARI.
           MOVE WSS-NUM-APRO IN WSS-VARI TO WSS-NUM-AAUX IN WSS-VARI.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO WSS-NUM-MAUX IN WSS-VARI.
           MOVE WSS-NUM-DPRO IN WSS-VARI TO WSS-NUM-DAUX IN WSS-VARI.
       FIN-LEE-PARAM.
           EXIT.
      *
      *
       INP-SRT SECTION.
      *---------------*
       INI-INP-SRT.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-GDC.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR LECTURA ARCHIVO GDC'
               PERFORM GNS-PRO-ABT.

       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
               GO TO FIN-INP-SRT.

           ADD 1 TO WSS-NUM-RLEI IN WSS-VARI.

           MOVE GDC-CIC-IOPC IN GDC TO CAN-CIC-IOPC IN CAN.
           MOVE GDC-NUM-ICAN IN GDC TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT ( FIO-STAT-OKS AND
                    CAN-MSC-STAT IN CAN = 'A' )
               ADD 1 TO WSS-NUM-RRCH IN WSS-VARI
               GO TO NXT-INP-SRT.

           IF GDC-FEC-FINI IN GDC = WSS-FEC-FAUX IN WSS-VARI
               MOVE 'COLOCACIONES'      TO DDC-COD-SIST IN DDC
               MOVE 55502               TO DDC-COD-EVEN IN DDC
               MOVE GDC-COD-COPC IN GDC TO DDC-COD-OFIO IN DDC
               MOVE GDC-CIC-IOPC IN GDC TO DDC-COD-OPER IN DDC
               MOVE '0670'              TO DDC-COD-TRAN IN DDC
               MOVE '7I  '              TO DDC-COD-MVTO IN DDC
               MOVE GDC-FEC-FINI IN GDC TO WSS-FEC-FCTB IN WSS-VARI
               MOVE WSS-FEC-FCTB IN WSS-VARI TO DDC-FEC-FCTB IN DDC
               MOVE GDC-SGV-MNTO IN GDC TO DDC-VAL-COMI IN DDC
               MOVE GDC-SGV-MIVA IN GDC TO DDC-VAL-MIVA IN DDC
               MOVE SPACES              TO DDC-CIC-GLV  IN DDC
               PERFORM MUEVE-RUT-ICLI
               IF NOT FIO-STAT-OKS
                   ADD 1 TO WSS-NUM-RRCH IN WSS-VARI
                   GO TO NXT-INP-SRT
               ELSE
                   MOVE FIO-PUT TO FIO-CMND
                   PERFORM FRE-FIO-DDC
                   IF NOT FIO-STAT-OKS
                       ADD 1 TO WSS-NUM-RRCH IN WSS-VARI
                   ELSE
                       ADD 1 TO WSS-NUM-RSEL IN WSS-VARI
           ELSE
           IF GDC-FEC-FINI IN GDC < WSS-FEC-FAUX IN WSS-VARI
               ADD 1 TO WSS-NUM-RRCH IN WSS-VARI
               GO TO FIN-INP-SRT.

       NXT-INP-SRT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-GDC.
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
      *-----------*
           EXIT.
      *
      *
       CLOSE-FILE SECTION.
      *------------------*
       INI-CLOSE-FILE.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-GDC.
           PERFORM COL-FIO-RDC.
           PERFORM COL-FIO-CAN.
           PERFORM SGC-FIO-DBC.
           PERFORM FRE-FIO-DDC.
       FIN-CLOSE-FILE.
           EXIT.
      *
      *
       MUEVE-RUT-ICLI SECTION.
      *----------------------*
       INI-MUEVE-RUT-ICLI.
           MOVE GDC-CIC-IOPC IN GDC TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           MOVE 'RDC-KEY-IDLC'      TO FIO-AKEY.
           PERFORM COL-FIO-RDC.
           IF NOT ( FIO-STAT-OKS AND
                    GDC-CIC-IOPC IN GDC = RDC-CIC-IOPC IN RDC )
               DISPLAY 'ERROR LECTURA RDC ' GDC-CIC-IOPC IN GDC
               GO TO FIN-MUEVE-RUT-ICLI.

           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR LECTURA DBC ' RDC-CIC-ICLI IN RDC
               GO TO FIN-MUEVE-RUT-ICLI.

           MOVE DBC-NUM-ICLI IN DBC TO DDC-NUM-ICLI IN DDC.
           MOVE DBC-VRF-ICLI IN DBC TO DDC-VRF-ICLI IN DDC.
       FIN-MUEVE-RUT-ICLI.
           EXIT.
      *
      *
       MUESTRA-ESTAD SECTION.
      *---------------------*
       INI-MUESTRA-ESTAD.
           DISPLAY 'ESTADISTICAS DEL PROGRAMA.'.
           DISPLAY '--------------------------'.
           DISPLAY ' '.
           DISPLAY 'REGISTROS LEIDOS DE GDC          : '
                              WSS-NUM-RLEI IN WSS-VARI.
           DISPLAY 'REGISTROS GRABADOS EN FREQDAT    : '
                              WSS-NUM-RSEL IN WSS-VARI.
           DISPLAY 'REGISTROS NO GRABADOS EN FREQDAT : '
                              WSS-NUM-RRCH IN WSS-VARI.
       FIN-MUESTRA-ESTAD.
           EXIT.


       COPY COLBFGDC.
       COPY GNSBBMSG.
       COPY GNSBFMSG.
       COPY COLBFRDC.
       COPY COLBFCAN.
       COPY SGCBFDBC.
       COPY FREBFDDC.

      * COPY GNSBGIDD.
      * Carga Identificacion de Bases de Datos de los Sistemas ( BATCH )
      * 15-JAN-1990 17:10:47
       GNS-BUS-IDD SECTION.
       INI-GNS-BUS-IDD.
           MOVE FIO-INP TO FIO-CMND.
           CALL 'GNSP2IDD' USING FIO-VARI IDD-REGI.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR DE APERTURA, ARCHIVO GNSIDD : ' FIO-STAT
               GOBACK.

           IF IDD-CIDD IN IDD-REGI NOT > SPACES
               MOVE FIO-PROG TO IDD-CIDD IN IDD-REGI.
           MOVE FIO-GET-KEY TO FIO-CMND.
           CALL 'GNSP2IDD' USING FIO-VARI IDD-REGI.
           IF NOT FIO-STAT-OKS
               DISPLAY
                   'NO EXISTE IDENTIFICACION INDEPENDENCIA DE DATOS: '
                                                 IDD-CIDD IN IDD-REGI
               IF IDD-CIDD IN IDD-REGI NOT = 'DEFAULT'
                   MOVE 'DEFAULT' TO IDD-CIDD IN IDD-REGI
                   MOVE FIO-GET-KEY TO FIO-CMND
                   CALL 'GNSP2IDD' USING FIO-VARI IDD-REGI
                   IF NOT FIO-STAT-OKS
                      DISPLAY 'NO EXISTE EL DEFAULT'
                              'COMO IDENTIFICACION INDEPENDENCIA DATOS'
                      MOVE FIO-CLO TO FIO-CMND
                      CALL 'GNSP2IDD' USING FIO-VARI IDD-REGI
                      GOBACK
                   ELSE
                      NEXT SENTENCE
               ELSE
                   MOVE FIO-CLO TO FIO-CMND
                   CALL 'GNSP2IDD' USING FIO-VARI IDD-REGI
                   GOBACK.
           MOVE FIO-CLO TO FIO-CMND.
           CALL 'GNSP2IDD' USING FIO-VARI IDD-REGI.
           DISPLAY 'PROGRAMA USARA : ' IDD-CIDD IN IDD-REGI
                   ' COMO IDENTIFICACION INDEPENDENCIA DE DATOS : '
           DISPLAY 'SISTEMA GRUPO TABLA TIPO IDENTIFICACION'.
           DISPLAY '======================================='.
           MOVE 1 TO IDD-IAUX.
       LUP-GNS-BUS-IDD.
           IF IDD-SIST IN IDD-VARI(IDD-IAUX) > SPACES
               DISPLAY '| ' IDD-SIST IN IDD-VARI(IDD-IAUX) '     '
                            IDD-GRPO IN IDD-VARI(IDD-IAUX) '    '
                            IDD-RGST IN IDD-VARI(IDD-IAUX) '   '
                            IDD-TENT IN IDD-VARI(IDD-IAUX) '        '
                            IDD-IENT IN IDD-VARI(IDD-IAUX) '     |'.
           ADD 1 TO IDD-IAUX.
           IF IDD-IAUX NOT > 30
               GO TO LUP-GNS-BUS-IDD.
           DISPLAY '======================================='.
       FIN-GNS-BUS-IDD.
           EXIT.

       COPY GNSBBSYS.
       COPY GNSBGEND.
       COPY GNSBGABT.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY GNSBFTAB.
       COPY GNSBBTAB.
       COPY GNSBGDTC.
       COPY GNSBTABT.
       COPY GNSBGHOY.

