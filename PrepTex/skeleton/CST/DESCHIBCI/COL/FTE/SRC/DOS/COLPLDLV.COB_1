       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPLDLV.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    30-Apr-93 09:05 PM.

      * Programa Listador de Reporte DLV con Sort.
000000*COMPILED SITE 2000          01.09.98

      ******************************************************************
      *  INTERSOFT                                                     *
      *  MODIFICACION: CONVERTIR REPORT-WRITER A LISTADO, MIGRAR A     *
      *                A COBOL FOR MVS Y CONVERSION 2000               *
      *  FECHA: ABRIL 1998                                             *
      ******************************************************************

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
      *DOS SELECT RPTDLV         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTDLV         ASSIGN TO        UT-S-RPTDLV.
           SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.

      ***** CRW-COMIENZO
      *    SELECT RPTDLV         ASSIGN TO        UT-S-RPTDLV.
           SELECT RPTDLV         ASSIGN TO        RPTDLV.
      ***** CRW-FINAL

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY COLRRDLV.

      ***** CRW-COMIENZO
      *FD  RPTDLV LABEL RECORDS OMITTED
      *    REPORT IS RPT-DLV
      *    .
       FD  RPTDLV
           RECORD CONTAINS 133 CHARACTERS
           BLOCK CONTAINS 0 RECORDS
           LABEL RECORD STANDARD.

       01  RPTDLV-REG           PIC X(133).
      ***** CRW-FINAL

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY COLBROPC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY COLRWDLV.
       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       COPY TABBROFI.
       COPY TABBRTIO.
       COPY COLBRDLC.
       COPY COLBRTOC.
       COPY COLBRRDC.
       COPY SGCBRDBC.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGCPT.
       COPY COLWGCTO.

       01  WSS-VARI.
           03 WSS-FEC-FPRO.
              05 WSS-NUM-DPRO                     PIC 9(02).
              05 WSS-NUM-MPRO                     PIC 9(02).
              05 WSS-NUM-SPRO                     PIC 9(02).
              05 WSS-NUM-APRO                     PIC 9(02).
           03 WSS-FEC-FFEC.
              05 WSS-NUM-SFEC                     PIC 9(02).
              05 WSS-NUM-AFEC                     PIC 9(02).
              05 WSS-NUM-MFEC                     PIC 9(02).
              05 WSS-NUM-DFEC                     PIC 9(02).
           03 WSS-COD-PLZA.
              05 WSS-IND-PLZA                     PIC X(01).
              05 WSS-RES-PLZA                     PIC X(03).
           03 WSS-COD-OFOC                        PIC X(03).
           03 WSS-COD-COOC                        PIC X(06).
           03 WSS-IND-NEXT                        PIC 9(01).
           03 WSS-NUM-IDLC                        PIC 9(03).
           03 WSS-GLS-DATA.
              05 WSS-GLS-TIO                      PIC X(40).
              05 WSS-GLS-AUX                      PIC X(40).
      *>>>>
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>>

      ***** CRW-COMIENZO

      *REPORT SECTION.
      *--------------
      *COPY COLRFDLV.
      *    .
      *COPY COLRTDLV.

       01  RPT-VARIABLES.
           02 RPT-VARIABLES-VARIAS.
               03 RPT-VARI-LINEA              PIC 9(03) VALUE 60.
               03 RPT-VARI-PAGE-COUNTER       PIC 9(03).
           02 RPT-VARIABLES-CONTROL.
               03 RPT-CTRL-COD-COOC           PIC X(06) VALUE SPACES.
               03 RPT-CTRL-COD-OFOC           PIC X(03) VALUE SPACES.
           02 RPT-VARIABLES-TOTALES.
               03 RPT-TOT-NUM-DLCV            PIC 9(11)V9(04) VALUE 0.

       01  PH-DLV.

           03  PH-DLV-01.
               05  RPT-HEAD-DUSU              PIC X(30).
               05  FILLER                     PIC X(092) VALUE SPACES.
               05  RPT-HEAD-FDMA              PIC XXBXXBXXXX.

           03  PH-DLV-02.
               05  RPT-HEAD-DSIS              PIC X(30).
               05  FILLER                     PIC X(018) VALUE SPACES.
               05  FILLER                     PIC X(39)
                   VALUE 'D O C U M E N T O S    V I G E N T E S '.
               05  FILLER                     PIC X(5)
                   VALUE '  A L'.
               05  FILLER                     PIC X(003) VALUE SPACES.
               05  RPT-HEAD-NUM-DPRO          PIC X(2).
               05  FILLER                     PIC X(1)
                   VALUE ALL '-'.
               05  RPT-HEAD-NUM-MPRO          PIC X(2).
               05  FILLER                     PIC X(1)
                   VALUE ALL '-'.
               05  RPT-HEAD-NUM-SPRO          PIC X(2).
               05  RPT-HEAD-NUM-APRO          PIC X(2).
               05  FILLER                     PIC X(017) VALUE SPACES.
               05  FILLER                     PIC X(6)
                   VALUE 'PAGINA'.
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-HEAD-PAGE-COUNTER      PIC ZZZ.

           03  PH-DLV-03.
               05  FILLER                     PIC X(9)
                   VALUE 'OFICINA :'.
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-HEAD-COD-OFOC          PIC X(3).
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-HEAD-GLS-DESC          PIC X(40).
               05  FILLER                     PIC X(020) VALUE SPACES.
               05  FILLER                     PIC X(17)
                   VALUE 'CLASE OPERACION :'.
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-HEAD-GLS-DATA          PIC X(40).

           03  PH-DLV-04.
               05  FILLER                     PIC X(132)
                   VALUE ALL '='.

           03  PH-DLV-05.
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  FILLER                     PIC X(39)
                   VALUE 'IND TIP COD  DEUDOR                    '.
               05  FILLER                     PIC X(39)
                   VALUE '           IDC (RUT)     IND IDENT     '.
               05  FILLER                     PIC X(39)
                   VALUE '          TIPO  FECHA      MONEDA      '.
               05  FILLER                     PIC X(8)
                   VALUE '   MONTO'.

           03  PH-DLV-06.
               05  FILLER                     PIC X(005) VALUE SPACES.
               05  FILLER                     PIC X(39)
                   VALUE 'UBF UBF                                '.
               05  FILLER                     PIC X(39)
                   VALUE '                     MUL DOCUMENTO     '.
               05  FILLER                     PIC X(39)
                   VALUE '      DCTO  MAX VCTO              DOCUM'.
               05  FILLER                     PIC X(4)
                   VALUE 'ENTO'.

           03  PH-DLV-07.
               05  FILLER                     PIC X(132)
                   VALUE ALL '='.

       01  DL-DLV.

           03  DL-DLV-08.
               05  FILLER                     PIC X(002) VALUE SPACES.
               05  RPT-DETA-IND-OFOC          PIC X.
               05  FILLER                     PIC X(002) VALUE SPACES.
               05  RPT-DETA-COD-IUBF          PIC X(3).
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-DETA-COD-CUBF          PIC X(3).
               05  FILLER                     PIC X(002) VALUE SPACES.
               05  RPT-DETA-GLS-NOMC          PIC X(35).
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-DETA-NUM-ICLI          PIC ZZZZZZZZ.
               05  FILLER                     PIC X(1)
                   VALUE ALL '-'.
               05  RPT-DETA-VRF-ICLI          PIC X.
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-DETA-IND-ICLI          PIC X.
               05  RPT-DETA-GLS-AUXI          PIC X.
               05  RPT-DETA-GLS-ICLI          PIC X(3).
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-DETA-IND-MULD          PIC X.
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-DETA-CAI-IOPC          PIC X(4).
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-DETA-IIC-IOPC          PIC X(8).
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-DETA-NUM-IDLC          PIC 9(3).
               05  FILLER                     PIC X(003) VALUE SPACES.
               05  RPT-DETA-GLS-TDOC          PIC X(5).
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-DETA-NUM-DMAV          PIC X(2).
               05  FILLER                     PIC X(1)
                   VALUE ALL '-'.
               05  RPT-DETA-NUM-MMAV          PIC X(2).
               05  FILLER                     PIC X(1)
                   VALUE ALL '-'.
               05  RPT-DETA-NUM-SMAV          PIC X(2).
               05  RPT-DETA-NUM-AMAV          PIC X(2).
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-DETA-GLS-VCOC          PIC X(5).
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-DETA-VAL-NDLC          PIC ZZ.ZZZ.ZZZ.ZZ9,9999.

       01  CF-DLV-OPC-COD-COOC.

           03  CF-DLV-09.
               05  FILLER                     PIC X(132)
                   VALUE ALL '-'.

           03  CF-DLV-10.
               05  FILLER                     PIC X(044) VALUE SPACES.
               05  FILLER                     PIC X(30)
                   VALUE 'CANTIDAD DOCUMENTOS VIGENTES :'.
               05  FILLER                     PIC X(001) VALUE SPACES.
               05  RPT-CTRL-NUM-DLCV          PIC ZZZZZ.
               05  RPT-FILLER                 PIC X(18) VALUE SPACES.

      ***** CRW-FINAL

       PROCEDURE DIVISION.
      *==================

      ***** CRW-COMIENZO
      *DECLARATIVES.
      ***** CRW-FINAL

       DEC-CF-DLV-SRT-COD-OFOC SECTION.

      ***** CRW-COMIENZO
      *    USE BEFORE REPORTING CF-DLV-SRT-COD-OFOC.
      ***** CRW-FINAL

       INI-CF-DLV-SRT-COD-OFOC.
       FIN-CF-DLV-SRT-COD-OFOC.
           EXIT.
       DEC-CF-DLV-OPC-COD-COOC SECTION.

      ***** CRW-COMIENZO
      *    USE BEFORE REPORTING CF-DLV-OPC-COD-COOC.
      ***** CRW-FINAL

       INI-CF-DLV-OPC-COD-COOC.
       FIN-CF-DLV-OPC-COD-COOC.
           EXIT.
       DEC-PH-DLV SECTION.

      ***** CRW-COMIENZO
      *    USE BEFORE REPORTING PH-DLV.
      ***** CRW-FINAL

       INI-PH-DLV.
      *<<<< PH_DLV
      * Mediante BUS-OFI se Obtiene Nombre de la Oficina de Tabla OFI
           IF SRT-COD-OFOC IN SRT > SPACES
               MOVE SRT-COD-OFOC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI.

      * Mediante BUS-TAB Busca Tipo de Operacion Credito de Tabla TIO
           IF OPC-COD-TOOC IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'TIO'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-TOOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TIO IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-TIO IN WSS-VARI.
      * Mediante BUS-TAB Busca Clase de Operacion Credito de Tabla AUX
           IF OPC-COD-COOC IN SRT > SPACES
               MOVE 'COL'               TO TAB-COD-SIST
               MOVE 'AUX'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-COOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-AUX IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-AUX IN WSS-VARI.
      * Se concatenan las glosas de TIO y de AUX
           MOVE WSS-GLS-DATA IN WSS-VARI TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO WSS-GLS-DATA IN WSS-DLV.
      *>>>>
       FIN-PH-DLV.
           EXIT.

      ***** CRW-COMIENZO
      *END DECLARATIVES.
      ***** CRW-FINAL

       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'COLPLDLV' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           SORT GNSSRT
       COPY COLRSDLV.
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
           PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<< INI_INP
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.

      * Captura Fecha de Proceso
           DISPLAY 'FECHA DE PROCESO ( DDMMAAAA ) : '.
           ACCEPT  WSS-FEC-FPRO IN WSS-VARI.
           DISPLAY WSS-FEC-FPRO IN WSS-VARI.
      * Captura Codigo de Oficina
           DISPLAY 'OFICINA (*=TODAS) : '.
           ACCEPT  WSS-COD-OFOC IN WSS-VARI.
           DISPLAY WSS-COD-OFOC IN WSS-VARI.
      * Captura Codigo Clase Operacion
           DISPLAY 'CLASE OPERACION (*=TODAS) : '.
           ACCEPT  WSS-COD-COOC IN WSS-VARI.
           DISPLAY WSS-COD-COOC IN WSS-VARI.

           DISPLAY 'FIN    CAPTURA    DE PARAMETROS'.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

      *VAL-FEC Valida Fecha de Proceso
           DISPLAY WSS-FEC-FPRO IN WSS-VARI.
           MOVE WSS-FEC-FPRO    IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.

           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-END.

           MOVE WSS-NUM-DPRO IN WSS-VARI TO WSS-NUM-DPRO IN WSS-DLV
                                            WSS-NUM-DFEC IN WSS-VARI.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO WSS-NUM-MPRO IN WSS-DLV
                                            WSS-NUM-MFEC IN WSS-VARI.
           MOVE WSS-NUM-SPRO IN WSS-VARI TO WSS-NUM-SPRO IN WSS-DLV
                                            WSS-NUM-SFEC IN WSS-VARI.
           MOVE WSS-NUM-APRO IN WSS-VARI TO WSS-NUM-APRO IN WSS-DLV
                                            WSS-NUM-AFEC IN WSS-VARI.

      *VAL-OFI Valida codigo de Oficina en TABLAS
           IF WSS-COD-OFOC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-OFOC IN WSS-VARI.
           IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-OFOC IN WSS-VARI
               MOVE WSS-COD-OFOC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   PERFORM GNS-PRO-END.

      *VAL-TAB Valida Clase de Operacion en TABLAS
           IF WSS-COD-COOC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-COOC IN WSS-VARI.
           IF WSS-COD-COOC IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-COOC IN WSS-VARI
               MOVE 'COL'                    TO TAB-COD-SIST
               MOVE 'AUX'                    TO TAB-COD-TTAB IN TAB
               MOVE WSS-COD-COOC IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM VAL-TAB
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   PERFORM GNS-PRO-END.

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.

      * Proceso para Cargar las tablas  TAB/TIO  y  COL/TOC  en Memoria
           PERFORM COL-CRG-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
               PERFORM GNS-PRO-END.
      *>>>>
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FST-INP-SRT.
      *<<<< INI_FST_INP
      *DAD  ini  16-MAY-1991
      *     MOVE ZEROES TO OPC-FEC-FCOL IN OPC.
      *     MOVE 'OPC-FEC-FCOL' TO FIO-AKEY.
      *     MOVE FIO-GET-NLS    TO FIO-CMND.
      *     PERFORM COL-FIO-OPC.
      *     IF NOT FIO-STAT-OKS OR
      *        OPC-FEC-FCOL IN OPC > WSS-FEC-FFEC IN WSS-VARI
      *         DISPLAY 'NO HAY REGISTRO HASTA FECHA DE PROCESO : '
      *                 WSS-FEC-FPRO IN WSS-VARI
      *         GO TO FIN-INP-SRT.
      *     GO TO LUP-INP-SRT.
      *DAD  fin  16-MAY-1991
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
      * Proceso de Seleccion y Clasificacion a Partir del Registro OPC
           PERFORM SEL-REG-PRO.
           IF WSS-IND-NEXT IN WSS-VARI = 1
               GO TO NXT-INP-SRT.

      * Busca los Documentos de Credito para Operacion Determinada
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS OR
              DLC-CIC-IOPC IN DLC NOT = OPC-CIC-IOPC IN OPC
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'OPC    DLCNX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   OPC-KEY-IOPC IN OPC
               GO TO NXT-INP-SRT.
       LUP-BUS-OPC-DLC.
           PERFORM BUS-SRT-REG.
           IF WSS-IND-NEXT IN WSS-VARI = 1
               GO TO NXT-INP-SRT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS OR
              DLC-CIC-IOPC IN DLC NOT = OPC-CIC-IOPC IN OPC
               GO TO NXT-INP-SRT.
           GO TO LUP-BUS-OPC-DLC.
      *>>>>
       MOV-INP-SRT.
       COPY COLRMDLV.
           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
      *DAD  ini  16-MAY-1991
      *     MOVE 'OPC-FEC-FCOL' TO FIO-AKEY.
      *DAD  fin  16-MAY-1991
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-OPC.
      *<<<< FIN_NXT_INP
      *DAD  ini  16-MAY-1991
      *     IF OPC-FEC-FCOL IN OPC > WSS-FEC-FFEC IN WSS-VARI
      *         GO TO FIN-INP-SRT.
      *DAD  fin  16-MAY-1991
      *>>>>
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-OPC.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
           OPEN OUTPUT RPTDLV.
           CALL 'GNSPLHDR' USING RPT-VARI.

      ***** CRW-COMIENZO
      *    INITIATE RPT-DLV.
      ***** CRW-FINAL

           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.

      ***** CRW-COMIENZO
           MOVE OPC-COD-COOC IN SRT TO RPT-CTRL-COD-COOC
           MOVE SRT-COD-OFOC IN SRT TO RPT-CTRL-COD-OFOC.
      ***** CRW-FINAL

       LUP-OUT-SRT.
      *<<<< LUP_OUT
           PERFORM GEN-LIN-OUT.
      *>>>>
       GEN-OUT-SRT.

      ***** CRW-COMIENZO
      *    GENERATE DL-DLV.
           PERFORM GENERATE-DL-DLV.

      ***** CRW-FINAL

       NXT-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.

      ***** CRW-COMIENZO
      *    TERMINATE RPT-DLV.
           MOVE RPT-TOT-NUM-DLCV TO RPT-CTRL-NUM-DLCV
           WRITE RPTDLV-REG FROM  CF-DLV-09
           WRITE RPTDLV-REG FROM  CF-DLV-10.
      ***** CRW-FINAL

           CLOSE RPTDLV.
           GO TO EXT-OUT-SRT.

      ***** CRW-COMIENZO

       GENERATE-DL-DLV.
      *****************
           MOVE SRT-IND-OFOC IN SRT            TO RPT-DETA-IND-OFOC
           MOVE DLC-COD-IUBF IN SRT            TO RPT-DETA-COD-IUBF
           MOVE DLC-COD-CUBF IN SRT            TO RPT-DETA-COD-CUBF
           MOVE DBC-GLS-NOMC IN SRT            TO RPT-DETA-GLS-NOMC
           MOVE DBC-NUM-ICLI IN SRT            TO RPT-DETA-NUM-ICLI
           MOVE DBC-VRF-ICLI IN SRT            TO RPT-DETA-VRF-ICLI
           MOVE DBC-IND-ICLI IN SRT            TO RPT-DETA-IND-ICLI
           MOVE WSS-GLS-AUXI IN WSS-DLV        TO RPT-DETA-GLS-AUXI
           MOVE DBC-GLS-ICLI IN SRT            TO RPT-DETA-GLS-ICLI
           MOVE SRT-IND-MULD IN SRT            TO RPT-DETA-IND-MULD
           MOVE DLC-CAI-IOPC IN SRT            TO RPT-DETA-CAI-IOPC
           MOVE DLC-IIC-IOPC IN SRT            TO RPT-DETA-IIC-IOPC
           MOVE DLC-NUM-IDLC IN SRT            TO RPT-DETA-NUM-IDLC
           MOVE WSS-GLS-TDOC IN WSS-DLV        TO RPT-DETA-GLS-TDOC
           MOVE DLC-NUM-DMAV IN SRT            TO RPT-DETA-NUM-DMAV
           MOVE DLC-NUM-MMAV IN SRT            TO RPT-DETA-NUM-MMAV
           MOVE DLC-NUM-SMAV IN SRT            TO RPT-DETA-NUM-SMAV
           MOVE DLC-NUM-AMAV IN SRT            TO RPT-DETA-NUM-AMAV
           MOVE WSS-GLS-VCOC IN WSS-DLV        TO RPT-DETA-GLS-VCOC
           MOVE DLC-VAL-NDLC IN SRT            TO RPT-DETA-VAL-NDLC

           IF RPT-VARI-LINEA > 59 OR RPT-VARI-PAGE-COUNTER = 0 OR
              OPC-COD-COOC IN SRT NOT = RPT-CTRL-COD-COOC      OR
              SRT-COD-OFOC IN SRT NOT = RPT-CTRL-COD-OFOC
              IF SRT-COD-OFOC IN SRT NOT = RPT-CTRL-COD-OFOC OR
                 OPC-COD-COOC IN SRT NOT = RPT-CTRL-COD-COOC
                 MOVE RPT-TOT-NUM-DLCV TO RPT-CTRL-NUM-DLCV
                 WRITE RPTDLV-REG FROM  CF-DLV-09
                 WRITE RPTDLV-REG FROM  CF-DLV-10
                 MOVE 0 TO RPT-TOT-NUM-DLCV
                 ADD 2 TO RPT-VARI-LINEA
                 MOVE SRT-COD-OFOC IN SRT TO RPT-CTRL-COD-OFOC
                 MOVE OPC-COD-COOC IN SRT TO RPT-CTRL-COD-COOC
              END-IF
              PERFORM TITULOS
           END-IF.
           ADD  SRT-NUM-DLCV IN SRT TO RPT-TOT-NUM-DLCV.
           WRITE RPTDLV-REG FROM  DL-DLV-08.
           ADD 1 TO RPT-VARI-LINEA.

       TITULOS.
      *********
           PERFORM DEC-PH-DLV.
           MOVE RPT-DUSU                       TO RPT-HEAD-DUSU
           MOVE RPT-FDMA                       TO RPT-HEAD-FDMA
           MOVE RPT-DSIS                       TO RPT-HEAD-DSIS
           MOVE WSS-NUM-DPRO IN WSS-DLV        TO RPT-HEAD-NUM-DPRO
           MOVE WSS-NUM-MPRO IN WSS-DLV        TO RPT-HEAD-NUM-MPRO
           MOVE WSS-NUM-SPRO IN WSS-DLV        TO RPT-HEAD-NUM-SPRO
           MOVE WSS-NUM-APRO IN WSS-DLV        TO RPT-HEAD-NUM-APRO
           MOVE SRT-COD-OFOC IN SRT            TO RPT-HEAD-COD-OFOC
           MOVE OFI-GLS-DESC                   TO RPT-HEAD-GLS-DESC
           MOVE WSS-GLS-DATA IN WSS-DLV        TO RPT-HEAD-GLS-DATA

           ADD 1 TO RPT-VARI-PAGE-COUNTER
           MOVE RPT-VARI-PAGE-COUNTER TO RPT-HEAD-PAGE-COUNTER
           MOVE SPACES TO RPTDLV-REG
           WRITE RPTDLV-REG AFTER PAGE
           WRITE RPTDLV-REG FROM  PH-DLV-01
           WRITE RPTDLV-REG FROM  PH-DLV-02
           WRITE RPTDLV-REG FROM  PH-DLV-03 AFTER 2
           WRITE RPTDLV-REG FROM  PH-DLV-04
           WRITE RPTDLV-REG FROM  PH-DLV-05
           WRITE RPTDLV-REG FROM  PH-DLV-06
           WRITE RPTDLV-REG FROM  PH-DLV-07
           MOVE 10 TO RPT-VARI-LINEA.

      ***** CRW-FINAL
       EXT-OUT-SRT.
           EXIT.

      *DAD  ini  16-MAY-1991
      * Insertar FIO de OPC, cambiando GNS-FIO-DTC por GNS-BCH-DTC e
      * incorporar el parrafo GNS-BCH-DTC SECTION.
      * COPY COLBFOPC.
      * Modulo FIO para registro OPC en DATACOM, 25-MAR-1993 10:00:37.98
       COL-FIO-OPC SECTION.
       INI-COL-FIO-OPC.
           MOVE ADR-OPC-REQA TO ADR-REQA.
           MOVE 'OPC' TO ADR-TABL IN ADR-REQA.
      *
           MOVE 'COL'  TO IDD-SAUX.
           MOVE 'M'    TO IDD-GAUX.
           MOVE SPACES TO IDD-RAUX.
           MOVE 1 TO IDD-IAUX.
           SET IDD-ITBL TO 1.
           SEARCH IDD-VSIS VARYING IDD-IAUX
             AT END
               GO TO GRP-COL-FIO-OPC
             WHEN IDD-DENT( IDD-ITBL ) = IDD-DAUX
               MOVE IDD-IENT( IDD-ITBL) TO ADR-DBID IN ADR-REQA
               GO TO FSR-COL-FIO-OPC.
       GRP-COL-FIO-OPC.
           MOVE SPACES TO IDD-GAUX.
           MOVE 1      TO IDD-IAUX.
           SET IDD-ITBL TO 1.
           SEARCH IDD-VSIS VARYING IDD-IAUX
             AT END
               MOVE 'En COL-FIO-OPC, NO existe en IDD:' TO FIO-MEN1
               MOVE IDD-DAUX                            TO FIO-MEN2
               PERFORM PRG-ABT
             WHEN IDD-DENT( IDD-ITBL ) = IDD-DAUX
               MOVE IDD-IENT( IDD-ITBL) TO ADR-DBID IN ADR-REQA.
       FSR-COL-FIO-OPC.
      *
           MOVE 'OPC00' TO ADR-ELM1.
           MOVE FIO-PROG TO ADR-PROG.
           IF FIO-KDEF = FIO-KDEF-S
               GO TO CON-COL-FIO-OPC.
           MOVE FIO-CMND TO FIO-IAKY.
           IF NOT FIO-IAKY-CON AND
              ( FIO-AKEY = 'OPC-KEY-IOPC' OR FIO-AKEY NOT > SPACES )
               MOVE OPC-KEY-IOPC IN OPC TO ADR-VKEY IN ADR-REQA
               MOVE 'OPC00' TO ADR-DKEY IN ADR-REQA
           ELSE
           IF FIO-AKEY = 'OPC-FEC-FCOL'
               MOVE OPC-FEC-FCOL IN OPC TO ADR-VKEY IN ADR-REQA
               MOVE 'OPC01' TO ADR-DKEY IN ADR-REQA
           ELSE
           IF FIO-AKEY = 'OPC-FEC-FING'
               MOVE OPC-FEC-FING IN OPC TO ADR-VKEY IN ADR-REQA
               MOVE 'OPC02' TO ADR-DKEY IN ADR-REQA
           ELSE
           IF FIO-AKEY = 'OPC-FEC-FINP'
               MOVE OPC-FEC-FINP IN OPC TO ADR-VKEY IN ADR-REQA
               MOVE 'OPC03' TO ADR-DKEY IN ADR-REQA
           ELSE
               MOVE 'En COL-FIO-OPC, key' TO FIO-MENS
               MOVE FIO-AKEY   TO FIO-MENS-KEY
               MOVE 'Invalida' TO FIO-MENS-FIL
               PERFORM PRG-ABT.
       CON-COL-FIO-OPC.
           MOVE OPC TO FIO-DFLD.
      *DAD  ini  16-MAY-1991
      *    PERFORM GNS-FIO-DTC.
           PERFORM GNS-BCH-DTC.
      *DAD  fin  16-MAY-1991
           IF FIO-STAT-OKS
               MOVE FIO-DFLD TO OPC
           ELSE
               MOVE 'COLOPC' TO FIO-MEN2
               IF FIO-STAT-FTL
                   PERFORM PRG-ABT.
           MOVE SPACES   TO FIO-AKEY.
           MOVE FIO-KDEF-N TO FIO-KDEF.
           MOVE ADR-REQA TO ADR-OPC-REQA.
       FIN-COL-FIO-OPC.
           EXIT.

      * Modulo Generico de acceso a archivos DATACOM BATCH
       GNS-BCH-DTC SECTION.
       INI-GNS-BCH-DTC.
           MOVE '00'     TO FIO-STAT.
           MOVE SPACES   TO FIO-MENS.
           MOVE '  '     TO ADR-STAT IN ADR-REQA.
           GO TO FIO-GKEY FIO-GNXT FIO-GFST FIO-GNLS FIO-GGRT FIO-FPUT
                 FIO-FMOD FIO-FDEL FIO-FCHG FIO-INPF FIO-OUTF FIO-UPDF
                 FIO-CLOF          FIO-FEQL FIO-FFST FIO-FNLS FIO-FGRT
                 FIO-UREC FIO-UALL FIO-FVID FIO-FACC FIO-RLOC FIO-FFNF
                 FIO-RCLN FIO-EXTF FIO-GKEY FIO-GFST FIO-GNLS FIO-GGRT
                 FIO-FEQL FIO-FFST FIO-FNLS FIO-FGRT FIO-GNXT FIO-GKUP
                 FIO-GKUP FIO-EBRW FIO-BKOU FIO-GLEQ FIO-GPRV FIO-CPNT
                 FIO-BRFH
           DEPENDING ON FIO-CMND.
       FIO-FNSF.
           MOVE 'ABORTO : Comando invalido ' TO FIO-MEN1.
           MOVE FIO-CMND                     TO FIO-MENS-CMD.
           MOVE '99' TO FIO-STAT.
           GO TO FIN-GNS-BCH-DTC.
       FIO-GKEY.
           MOVE 'REDKY' TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-GNXT.
      *    DAD
           MOVE 'GETIT' TO ADR-CMND IN ADR-REQA.
      *    DAD
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-GFST.
           MOVE LOW-VALUES TO ADR-VKEY IN ADR-REQA.
      *    DAD
           MOVE 'GSETL' TO ADR-CMND IN ADR-REQA.
      *    DAD
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           IF NOT ADR-STAT-OKS IN ADR-REQA
               GO TO SET-STAT.
      *    DAD
           MOVE 'GETIT' TO ADR-CMND IN ADR-REQA.
      *    DAD
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-GNLS.
      *    DAD
           MOVE 'GSETL' TO ADR-CMND IN ADR-REQA.
      *    DAD
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           IF NOT ADR-STAT-OKS IN ADR-REQA
               GO TO SET-STAT.
      *    DAD
           MOVE 'GETIT' TO ADR-CMND IN ADR-REQA.
      *    DAD
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-GGRT.
           MOVE 'ABORTO : Comando GET-GRT, NO soportado' TO FIO-MEN1.
           MOVE '99' TO FIO-STAT.
           GO TO FIN-GNS-BCH-DTC.
       FIO-FPUT.
           MOVE 'ADDIT' TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-FMOD.
           MOVE 'UPDAT' TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-FDEL.
           MOVE 'DELET' TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-FCHG.
           MOVE 'ABORTO : Comando CHG, NO soportado' TO FIO-MEN1.
           MOVE '99' TO FIO-STAT.
           GO TO FIN-GNS-BCH-DTC.
       FIO-INPF.
           MOVE 'Comando INP, ninguna operacion asociada' TO FIO-MEN1.
           GO TO FIN-GNS-BCH-DTC.
       FIO-OUTF.
           MOVE 'Comando OUT, ninguna operacion asociada' TO FIO-MEN1.
           GO TO FIN-GNS-BCH-DTC.
       FIO-UPDF.
           MOVE 'Comando UPD, ninguna operacion asociada' TO FIO-MEN1.
           GO TO FIN-GNS-BCH-DTC.
       FIO-CLOF.
           MOVE 'Comando CLO, ninguna operacion asociada' TO FIO-MEN1.
           GO TO FIN-GNS-BCH-DTC.
       FIO-FEQL.
           MOVE 'LOCKX' TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-FFST.
           MOVE LOW-VALUES TO ADR-VKEY IN ADR-REQA.
      *    DAD
           MOVE 'GSETL' TO ADR-CMND IN ADR-REQA.
      *    DAD
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-FNLS.
      *    DAD
           MOVE 'GSETL' TO ADR-CMND IN ADR-REQA.
      *    DAD
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-FGRT.
           MOVE 'ABORTO : Comando FND-GRT, NO soportado' TO FIO-MEN1.
           MOVE '99' TO FIO-STAT.
           GO TO FIN-GNS-BCH-DTC.
       FIO-UREC.
           MOVE 'RELES' TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-UALL.
           MOVE 'ABORTO : Comando ULK-ALL, NO soportado' TO FIO-MEN1.
           MOVE '99' TO FIO-STAT.
           GO TO FIN-GNS-BCH-DTC.
       FIO-FVID.
           MOVE 'ABORTO : Comando VID, NO soportado' TO FIO-MEN1.
           MOVE '99' TO FIO-STAT.
           GO TO FIN-GNS-BCH-DTC.
       FIO-FACC.
           MOVE 'Comando ACC, ninguna operacion asociada' TO FIO-MEN1.
           GO TO FIN-GNS-BCH-DTC.
       FIO-RLOC.
           MOVE 'ABORTO : Comando REC-LCK, NO soportado' TO FIO-MEN1.
           MOVE '99' TO FIO-STAT.
           GO TO FIN-GNS-BCH-DTC.
       FIO-FFNF.
           MOVE 'ABORTO : Comando FNF, NO soportado' TO FIO-MEN1.
           MOVE '99' TO FIO-STAT.
           GO TO FIN-GNS-BCH-DTC.
       FIO-RCLN.
           MOVE 'ABORTO : Comando REC-LEN, NO soportado' TO FIO-MEN1.
           MOVE '99' TO FIO-STAT.
           GO TO FIN-GNS-BCH-DTC.
       FIO-EXTF.
           MOVE 'Comando EXT, ninguna operacion asociada' TO FIO-MEN1.
           GO TO FIN-GNS-BCH-DTC.
       FIO-GKUP.
           MOVE 'RDUKY' TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-EBRW.
           MOVE 'Comando END-BRW, sin operacion asociada' TO FIO-MEN1.
           GO TO FIN-GNS-BCH-DTC.
       FIO-BKOU.
           MOVE 'LOGTB' TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-GLEQ.
           MOVE 'LOCKL' TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           IF NOT ADR-STAT-OKS IN ADR-REQA
               GO TO SET-STAT.
           MOVE 'REDLE' TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-GPRV.
           MOVE 'LOCBR' TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           IF NOT ADR-STAT-OKS IN ADR-REQA
               GO TO SET-STAT.
           MOVE 'REDLE' TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-CPNT.
           MOVE 'LOGCP' TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-BRFH.
           MOVE 'Comando BFR-RFH, sin operacion asociada' TO FIO-MEN1.
           GO TO FIN-GNS-BCH-DTC.
       SET-STAT.
           IF ADR-SSTT IN ADR-REQA NOT > SPACES
               MOVE SPACES TO ADR-SSTT IN ADR-REQA.
           IF NOT ADR-STAT-OKS IN ADR-REQA
               MOVE 'Status DTC :'       TO FIO-MENS-DSC
               MOVE ADR-STAT IN ADR-REQA TO FIO-MENS-STT
               MOVE ADR-SSTT IN ADR-REQA TO FIO-MENS-SST
               MOVE 'Key'                TO FIO-MENS-GKY
               MOVE ADR-DKEY IN ADR-REQA TO FIO-MENS-KDT
               MOVE 'Base Datos'         TO FIO-MENS-GBD
               MOVE ADR-DBID IN ADR-REQA TO FIO-MENS-DBI
               MOVE 'Cmd'                TO FIO-MENS-GCM
               MOVE ADR-CMND IN ADR-REQA TO FIO-MENS-CMD
               MOVE 'File'               TO FIO-MENS-GFL.
           IF ADR-STAT-OKS IN ADR-REQA
               MOVE '00' TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = '10'
               MOVE '22' TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = '11'
               MOVE '23' TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = '12'
               MOVE '43' TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = '14'
               MOVE '23' TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = '16'
               MOVE 'LOGTB' TO ADR-CMND IN ADR-REQA
               CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS
               MOVE '47' TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = '18'
               MOVE '44' TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = '19' OR '29'
               MOVE '10' TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = '92'
               MOVE '45' TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = '93'
               MOVE '46' TO FIO-STAT
           ELSE
               MOVE 'Aborto, DTC:'       TO FIO-MENS-DSC
               MOVE '99' TO FIO-STAT.
       FIN-SET-STAT.
       FIN-GNS-BCH-DTC.
           EXIT.
      *DAD  fin  16-MAY-1991
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGABT.

      *<<<< EOF
      ******************************************************************
      * Seleccion del Registro para Proceso Mediante Fecha y Oficina del
       SEL-REG-PRO SECTION.
       INI-SEL-REG-PRO.
           MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.

      *DAD  ini  16-MAY-1991
           IF OPC-FEC-FCOL IN OPC > WSS-FEC-FFEC IN WSS-VARI
               GO TO FIN-SEL-REG-PRO.
      *DAD  fin  16-MAY-1991

      * Se omite la Operacion de Credito que NO este Activada
           IF OPC-MSC-STAT IN OPC NOT = 'A'
               GO TO FIN-SEL-REG-PRO.

      * Se omite la Operacion de Credito que este Cancelada
           IF OPC-VAL-SCRE IN OPC NOT > ZEROES
               GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COOC IN WSS-VARI NOT = '*'
               IF WSS-COD-COOC IN WSS-VARI NOT = OPC-COD-COOC IN OPC
                   GO TO FIN-SEL-REG-PRO.

      * Se omite la Operacion de Credito en Moneda Extranjera
           IF OPC-MSC-TVOC IN OPC = '1'
               GO TO FIN-SEL-REG-PRO.

      * Busca con el Codigo Tipo Operacion en la Tabla cargada en Memori
      * 'Sistema que lo Maneja' y 'Opera Como'
           MOVE OPC-COD-TOOC IN OPC TO CTO-TOOC IN CTO-VARI.
           PERFORM COL-BUS-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
                       'CON CODIGO : '     CTO-TOOC IN CTO-VARI
               GO TO FIN-SEL-REG-PRO.

      * Valida el 'Sistema que lo Maneja' de la Operacion de Credito
           IF CTO-SIST IN CTO-VARI NOT = 'COL'
               GO TO FIN-SEL-REG-PRO.

      * Valida el 'Opera Como' de la Operacion de Credito
           IF CTO-OPEC IN CTO-VARI = 'H' OR
              CTO-OPEC IN CTO-VARI = 'T'
               GO TO FIN-SEL-REG-PRO.

      * Obtiene 'Opera Como'
           MOVE SPACES               TO TOC.
           MOVE CTO-OPEC IN CTO-VARI TO TOC-MSC-OPEC IN TOC.

           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
       FIN-SEL-REG-PRO.
           EXIT.
      ******************************************************************
      * Formacion y Generacion del Registro SRT al Procesar Registros
       BUS-SRT-REG SECTION.
       INI-BUS-SRT-REG.
           MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.
      * Busca oficina a ocupar en sort
           IF DLC-COD-UBFD IN DLC NOT > SPACES
               MOVE OPC-COD-OFOC IN OPC TO SRT-COD-OFOC IN SRT
               MOVE 1                   TO SRT-IND-OFOC IN SRT
           ELSE
               IF DLC-COD-IUBF IN DLC = 'OFI'
                   MOVE DLC-COD-CUBF IN DLC TO SRT-COD-OFOC IN SRT
                   MOVE 1                   TO SRT-IND-OFOC IN SRT
               ELSE
                   IF DLC-COD-PLZA IN DLC > SPACES
                       MOVE DLC-COD-PLZA IN DLC TO
                                              WSS-COD-PLZA IN WSS-VARI
                       MOVE WSS-RES-PLZA IN WSS-VARI TO
                                                   SRT-COD-OFOC IN SRT
                       MOVE 2                   TO SRT-IND-OFOC IN SRT
                   ELSE
                       MOVE OPC-COD-OFOC IN OPC TO SRT-COD-OFOC IN SRT
                       MOVE 2                   TO SRT-IND-OFOC IN SRT.

           IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
               IF WSS-COD-OFOC IN WSS-VARI NOT = SRT-COD-OFOC IN SRT
                   GO TO FIN-BUS-SRT-REG.

           IF SRT-IND-OFOC IN SRT = 1
               MOVE SPACES TO DLC-COD-IUBF IN DLC
               MOVE SPACES TO DLC-COD-CUBF IN DLC.

      * Segun Como Opera Buscara Datos Deudor Indirecto o Deudor Directo
           IF TOC-MSC-OPEC IN TOC = 'D'
               MOVE DLC-NUM-IDLC IN DLC TO WSS-NUM-IDLC IN WSS-VARI
           ELSE
               MOVE ZEROES TO WSS-NUM-IDLC IN WSS-VARI.

      * Busca CIC del Cliente con el CIC de Operaciones de Creditos en R
      * RDC-NUM-IDLC > 0 ====> DEU.IND.
      * RDC-NUM-IDLC = 0 ====> DEU.DIR.
           MOVE DLC-CAI-IOPC IN DLC      TO RDC-CAI-IOPC IN RDC.
           MOVE DLC-IIC-IOPC IN DLC      TO RDC-IIC-IOPC IN RDC.
           MOVE WSS-NUM-IDLC IN WSS-VARI TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'DLC    RDCNX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   RDC-KEY-IDLC IN RDC
               GO TO FIN-BUS-SRT-REG.

      *CIC-CLI Busca Datos del Cliente Mediante su CIC
           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GET-CLI.
           IF MSG-COD-MENS > SPACES
               MOVE SPACES TO DBC-NUM-ICLI IN DBC
                              DBC-VRF-ICLI IN DBC
                              DBC-IND-ICLI IN DBC
                              DBC-GLS-ICLI IN DBC
           ELSE
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC.

           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
           IF NOT FIO-STAT-OKS OR
              RDC-CAI-IOPC IN RDC NOT = DLC-CAI-IOPC IN DLC OR
              RDC-IIC-IOPC IN RDC NOT = DLC-IIC-IOPC IN DLC
               MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.

           IF TOC-MSC-OPEC IN TOC = 'D'
               IF RDC-NUM-IDLC IN RDC NOT > ZEROES OR
                  WSS-IND-NEXT IN WSS-VARI = 1
                   MOVE SPACES TO SRT-IND-MULD IN SRT
               ELSE
                   MOVE 'M'    TO SRT-IND-MULD IN SRT
           ELSE
               IF RDC-NUM-IDLC IN RDC NOT = ZEROES OR
                  WSS-IND-NEXT IN WSS-VARI = 1
                   MOVE SPACES TO SRT-IND-MULD IN SRT
               ELSE
                   MOVE 'M'    TO SRT-IND-MULD IN SRT.

      * Completa Llenado de Campos y Genera el Registro SRT
           MOVE  1  TO SRT-NUM-DLCV IN SRT.
      *    05-MAR-91 03:13 PM
           MOVE DBC-GLS-NOMC IN DBC TO DBC-GLS-NOMC IN SRT.
           MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN SRT.
           MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN SRT.
           MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN SRT.
           MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN SRT.
           MOVE DLC-CAI-IOPC IN DLC TO DLC-CAI-IOPC IN SRT.
           MOVE DLC-IIC-IOPC IN DLC TO DLC-IIC-IOPC IN SRT.
           MOVE DLC-NUM-IDLC IN DLC TO DLC-NUM-IDLC IN SRT.
           MOVE DLC-NUM-DMAV IN DLC TO DLC-NUM-DMAV IN SRT.
           MOVE DLC-NUM-MMAV IN DLC TO DLC-NUM-MMAV IN SRT.
           MOVE DLC-NUM-SMAV IN DLC TO DLC-NUM-SMAV IN SRT.
           MOVE DLC-NUM-AMAV IN DLC TO DLC-NUM-AMAV IN SRT.
           MOVE DLC-VAL-NDLC IN DLC TO DLC-VAL-NDLC IN SRT.
           MOVE OPC-COD-COOC IN OPC TO OPC-COD-COOC IN SRT.
           MOVE OPC-COD-TOOC IN OPC TO OPC-COD-TOOC IN SRT.
           MOVE OPC-COD-VCOC IN OPC TO OPC-COD-VCOC IN SRT.
           MOVE DLC-COD-TDOC IN DLC TO DLC-COD-TDOC IN SRT.
           MOVE DLC-COD-IUBF IN DLC TO DLC-COD-IUBF IN SRT.
           MOVE DLC-COD-CUBF IN DLC TO DLC-COD-CUBF IN SRT.
           RELEASE SRT.
           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
       FIN-BUS-SRT-REG.
           EXIT.
      ******************************************************************
      * Genera Lineas de Detalle a Partir de Registro SRT Ordenado
       GEN-LIN-OUT SECTION.
       INI-GEN-LIN-OUT.
      * Mediante BUS-TAB Busca Tipo de Moneda de Tabla VLR
           IF OPC-COD-VCOC IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-VCOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-ABRV IN TAB TO WSS-GLS-VCOC IN WSS-DLV
           ELSE
               MOVE SPACES TO WSS-GLS-VCOC IN WSS-DLV.

      * Mediante BUS-TAB Busca Tipo de Documento de Tabla DOC
           IF DLC-COD-TDOC IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'DOC'               TO TAB-COD-TTAB IN TAB
               MOVE DLC-COD-TDOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-ABRV IN TAB TO WSS-GLS-TDOC IN WSS-DLV
           ELSE
               MOVE SPACES TO WSS-GLS-TDOC IN WSS-DLV.

           IF DBC-GLS-ICLI IN SRT > SPACES
               MOVE '-'    TO WSS-GLS-AUXI IN WSS-DLV
           ELSE
               MOVE SPACES TO WSS-GLS-AUXI IN WSS-DLV.
       FIN-GEN-LIN-OUT.
           EXIT.
      ******************************************************************

       COPY TABBFOFI.
       COPY COLBFDLC.
       COPY COLBFTOC.
       COPY COLBFRDC.
       COPY SGCBFDBC.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY GNSBVTAB.
       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBGCPT.
       COPY SGCBGCLI.
       COPY COLBGCTO.

      ***** CRW-COMIENZO
       COPY GNSBPFEC.
      ***** CRW-FINAL

      *>>>>

