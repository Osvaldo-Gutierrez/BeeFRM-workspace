       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   COLPQCPT.
       AUTHOR.       CONSIST.
       DATE-WRITTEN. 31-Jul-19 08:09 PM.

      * NOMBRE PROGRAMA                   COLPQCPT
      * VERSION PGM                       3.1
      * VERSION SKL                       19.04.15
      * OPCION                            CON
      * ARCHIVO BASE                      COLOPC
      * PANTALLA                          COLCPT
      * INP/OUT                           DATACOM
      * TAMANO COMMAREA                   250

      ***********************************************************
      * MODIFICACIONES
      * - SE CORRIGE LECTURA DE TABLA VEN PARA VCTOS NO ESTRUCTURADOS
      *
      * FECHA: 03-MAR-2011
      * AUTOR: BEE-TEAM(RGD)
      * MARCA: RGD-INI 03-MAR-2011 CORRIGE LECTURA VEN
      ***********************************************************
      * MANTENCION : INDICADORES CAE Y CAEV
      * RESPONSABLE: AFRI-CGC
      * OBJETIVO   : GRABAR EN TABLA ICG BAJO EL CONCEPTO CAV EL
      *              INDICADOR CAEV CALCULADO
      * ETIQUETA   : *AFRI-INI MAYO-2012 INDICADORES CAE Y CAEV
      *****************************************************************
      * MANTENCION : PREPAGOS TOTALES
      * RESPONSABLE: AFRI-CGC
      * OBJETIVO   : -AUMENTAR LA CANTIDAD DE REGISTROS A INFORMAR DE
      *               10 A 23
      *              -INCORPORAR TABLA DE VERSIONES PARA LIMITAR EL
      *               MONTO DEL CREDITO AL MOMENTO DE CREAR EL
      *               CERTIFICADO
      * ETIQUETA   : *AFRI-INI MAYO-2012 CERTIFICADO PREPAGO
      *****************************************************************
      * MANTENCION : PREPAGOS TOTALES
      * RESPONSABLE: AFRI-CGC
      * OBJETIVO   : -RESTAURACION PRIMER VENCIMIENTO
      * ETIQUETA   : *AFRI-INI JUNIO-2012 ARREGLO VENCIMIENTO
      *****************************************************************
      * MANTENCION : PREPAGOS PARCIALES
      * RESPONSABLE: AFRI-CGC
      * OBJETIVO   :
      *              -INCORPORAR TABLA DE VERSIONES PARA ESTABLECER
      *               MONTO MINIMO SEGUN PORCENTAJE
      *              -SE REALIZA CALCULO DE PREPAGO PARCIAL ASUMIENDO
      *               EL PAGO DE LAS CUOTAS QUE GENEREN MORA.
      *
      * ETIQUETA   : *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
      *****************************************************************
      * MANTENCION : CALCULO CAEV
      * RESPONSABLE: AFRI-CGC
      * OBJETIVO   :
      *              -SE UTILIZA MONTO POR DEFECTO PARA SOLO SIMULAR
      *               EL PREPAGO A LA FECHA DE CONSULTA.
      *               ( MONTO PREPAGO = 99999999999)
      *
      * ETIQUETA   : *AFRI-INI 26-JUN-2012 CALCULO CAEV
      *****************************************************************
      * MANTENCION : OPERACIONES MOROSAS
      * RESPONSABLE: AFRI-CGC
      * OBJETIVO   :
      *              -SE PROCESAN OPERACION CON CUOTAS EN MORA, NO SE
      *               DEBEN CONSIDERAR OPERACIONES EN CARTERA VENCIDA,
      *               CASTIGADA O CON MARCADAS COMO JUDIC
      *
      * ETIQUETA   : *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *****************************************************************
      * MANTENCION : OPERACIONES MOROSAS
      * RESPONSABLE: AFRI-CGC
      * OBJETIVO   :
      *              -SE CORRIGEN OBSERVACIONES
      *
      * ETIQUETA   : *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
      *****************************************************************
      * MANTENCION : CORRECCION CALCULO CAEV
      * RESPONSABLE: AFRI-CGC
      * OBJETIVO   :
      *              -SE CORRIGE CALCULO DEL CAEV
      *
      * ETIQUETA   : *AFRI-INI 28-NOV-2012 CAMBIOS CAEV
      *****************************************************************
      *OBJETIVO: CAMBIAR LECTURA ENTIDAD IMP POR TABLA TIM
      *PROYECTO: ITE - AUMENTO DE DECIMALES
      *FECHA   : ENE-2013
      *AUTOR   : AFRI-CGC
      *ETIQUETA: *AFRI-INI 23-ENE-2013 CAMBIO DECIMALES ITE
      *-----------------------------------------------------------------
      * MANTENCION : OPTIMIZACION TRANSACCIONES LENTAS K100-K130
      * RESPONSABLE: CIMA-OGB
      * OBJETIVO   : OPTIMIZAR LECTURA DE TABLAs  
      * ETIQUETA   : CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
      *****************************************************************
      * PROYECTO : SELECCIONA DE SEGUROS A DEVOLVER
      * OBJETIVO : INCORPORAR LLAMADO A COLPPDPS PARA OBTENER
      *            EL MONTO DE LOS SEGUROS A DEVOLVER
      * RESPONSABLE: AFRI-CGC
      * FECHA 11-SEP-2014
      * ETIQUETA : AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
      *-----------------------------------------------------------------
      *OBJETIVO: AGREGAR VALOR DE IDNI A CERTIFICADOS DE PREPAGO
      *PROYECTO: INCORPORAR IDNI A CERTIFICADOS DE PREPAGO
      *FECHA   : JUN-2016
      *AUTOR   : BEE-MPS
      *ETIQUETA: *MPS-INI 28-JUN-2016 INCORPORAR IDNI A CERT DE PREPAGO
      *-----------------------------------------------------------------
      * PROYECTO : OPTIMIZACION K130
      * OBJETIVO : INCORPORAR MEJORAS EN USO DE RECURSOS PARA DISMINUIR
      *            TIEMPOS DE RESPUESTAS.
      * RESPONSABLE: AFRI-CGC
      * FECHA 25-OCT-2016
      * ETIQUETA : AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *-----------------------------------------------------------------
      * PROYECTO : IDNI
      * OBJETIVO : CONSIDERAR IDNI EN VENCIMIENTOS MOROSOS
      * RESPONSABLE: AFRI
      * FECHA 07-JUN-2017
      * ETIQUETA : AFRI-INI 07-JUN-2017 IDNI EN MOROSOS
      *-----------------------------------------------------------------
      * PROYECTO: COMISION FOGAPE
      * AUTOR:    AFRI
      * OBJETIVO: NORMALIZAR COBRO COMISION FOGAPE
      * ETIQUETA: *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *---------------------------------------------------------------*
      * PROYECTO: ASEGURAMIENTO
      * AUTOR:    AFRI
      * OBJETIVO: COBRAR COMISION NORMALIZA
      * ETIQUETA: *AFRI-INI 13-ENE-2018 COMISION NORMALIZA
      *---------------------------------------------------------------*
      *>>>>
      *>>>>

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.
       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
      * COPY GNSWGSCR.
       COPY GNSWGCVT.
       77  WSS-TAG-COLPQCPT-INI PIC X(125) VALUE                        
           '<IDNPGM NOM=$COLPQCPT$ SKL=$19.04.15$ VSN=${vsnpq}$        
      -    'GEN=$31-Jul-19 08:09 PM$ FNC=${fncpq}$/>'.    

       COPY GNSWCSCR.
      *PTC-INI
      *PTC-SUB
      * COPY GNSWVSCR.
       COPY GNSWV3CR.
      *PTC-FIN
      *>>>>
           03 SCR-NUM-PANT               PIC 9(0007).
           03 SCR-CPT-FLD                PIC X(0850).
      *>>>>
       COPY COLWICPT.

       COPY COLBROPC.


       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSBRMSC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSWGFRM.
       COPY GNSWG3CF.
       COPY GNSWGTSK.
       COPY GNSWGQUE.
      *PTC-FIN
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       COPY GNSWGIDC.
       COPY GNSWGSYS.

      *<<<< WSS
      *AFRI-INI MAYO-2012 INDICADORES CAE Y CAEV
       COPY COLWGCAV.
      *AFRI-FIN MAYO-2012 INDICADORES CAE Y CAEV
       COPY SGCBRDBC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY COLBRDLC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY COLBRRDC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY COLBRICG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY COLBRCAN.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==SCR-CAN-REQA==.
       COPY GNSWGCPT.
       COPY GNSWGSTR.
       COPY COLWXCPT.

      *RGD-INI COPYS
           03  WSS-VAL-CMP2                COMP-2.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-BDO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PTT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AXU-REQA==.

       COPY COLBREVC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY COLBRCXE.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CXE-REQA==.
       COPY COLBRCYA.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY COLBRROV.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY COLBRTOC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY COLBRRCV.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY LDCBRRLO.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RLO-REQA==.
       COPY LDCBRLDC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LDC-REQA==.
       COPY LDCBRLCC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LCC-REQA==.

       COPY SGCBROPE.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
       COPY SGCBRRCO.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.
       COPY SGCBRDCP.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCP-REQA==.
       COPY SGCBRDCE.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCE-REQA==.
       COPY COLBRDIC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DIC-REQA==.
       COPY COLBRITR.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITR-REQA==.
       COPY COLWGVEN.
      *COPY COLWGCIC.
       COPY COLBRVEN.
       COPY COLBRVEN REPLACING ==VEN== BY ==VEN-BKP==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY COLBRIXT.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-IXT-REQA==.
      *AFRI-INI 23-ENE-2013 CAMBIO DECIMALES ITE
      *COPY COLBRIMP.
      *COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-IMP-REQA==.
      *AFRI-FIN 23-ENE-2013 CAMBIO DECIMALES ITE
       COPY COLBRTMC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TMC-REQA==.
      *AFRI-INI MAYO-2012 INDICADORES CAE Y CAEV
      *COPY GNSBRUSR.
       COPY TABBRUSR.
      *AFRI-FIN MAYO-2012 INDICADORES CAE Y CAEV
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
      *COPY FNSBRVEN.
 VER  *COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY COLBRPCP.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PCP-REQA==.
       COPY COLBRCOM.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
       COPY TABBRCAM.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY TABBROFI.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSBRCIC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==.
      *COPY GNSBRMSG.
       COPY COLWGINT.
      *AFRI-INI 29-JUN-2012 CORRECCION CAE
           03 INT-PROY         VALUE 'N'            PIC X(01).
           03 INT-TTAS-INT     VALUE 'INT'          PIC X(03).
       COPY TABBRTXC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TXC-REQA==.
      *AFRI-FIN 29-JUN-2012 CORRECCION CAE
HRS   *COPY COLWGPCP.
       COPY COLWGPDC.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
       COPY COLWGNOR.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
       COPY COLW1CAN.
       COPY COLW2CAN.
       COPY COLWICAN.
       COPY GNSWGPES.
       COPY TABWGTXC.
       COPY COLWGENG.
       COPY GNSWGCIC.
       COPY TABBRTIO.
       COPY COLWGPVE.
       COPY COLWGCXE.
      *AFRI-INI 13-ENE-2018 COMISION NORMALIZA
       COPY COLWGGCN.
      *AFRI-FIN 13-ENE-2018 COMISION NORMALIZA

       01 WSS-VAR-CALCULOS.
           03  WSS-VAL-CPTCAM   VALUE ZEROES        PIC 9(11)V9(04).
      *    03  WSS-VAL-CPTINT   VALUE ZEROES        PIC 9(11)V9(04).
           03  BKP-VAL-SCRE     VALUE ZEROES        PIC S9(11)V9(04).
           03  WSS-VAL-CPTINT   VALUE ZEROES        PIC 9(11).
           03  WSS-CAM-SGV-UF   VALUE ZEROES        PIC 9(08)V9(05).
           03  WSS-VAL-CPTSCRE  VALUE ZEROES        PIC S9(11)V9(04).
           03  WSS-VAL-CPTINTT  VALUE ZEROES        PIC S9(11)V9(04).
           03  WSS-VAL-CPTCRS   VALUE ZEROES        PIC 9(11)V9(04).
           03  WSS-VAL-CPTPGO   VALUE ZEROES        PIC 9(11)V9(04).
           03  WSS-VAL-CPTPGOA  VALUE ZEROES        PIC 9(11)V9(04).
           03  WSS-VAL-CPTCPPR  VALUE ZEROES        PIC 9(11)V9(04).
      *AFRI-INI 31-AGO-2012 OPERACIONES MOROSAS
      *    03  WSS-VAL-CPTREAJ  VALUE ZEROES        PIC 9(11)V9(04).
           03  WSS-VAL-CPTNOR   VALUE ZEROES        PIC 9(11)V9(04).
           03  WSS-VAL-CPTREAJ  VALUE ZEROES        PIC S9(11)V9(04).
      *AFRI-INI 31-AGO-2012 OPERACIONES MOROSAS
           03  WSS-VAL-CPTCAMO  VALUE ZEROES        PIC 9(11)V9(04).
           03  WSS-VAL-CPTCAAD  VALUE ZEROES        PIC 9(11)V9(04).
           03  WSS-IND-CPTCAAD  VALUE SPACES        PIC X(01).
           03  WSS-VAL-CPTFGP   VALUE ZEROES        PIC S9(12).
           03  WSS-VAL-CPTFGPD  VALUE ZEROES        PIC S9(11)V9(4).
  RGD *    03  WSS-VAL-CPTCAPR  VALUE ZEROES        PIC S9(12).
           03  WSS-VAL-CPTCAPR  VALUE ZEROES        PIC S9(12)V9(4).
           03  WSS-VAL-CPTCAPR-BKP  VALUE ZEROES    PIC S9(12).
           03  WSS-VAL-CPTTPAG  VALUE ZEROES        PIC S9(12).
           03  WSS-VAL-CPTING   VALUE ZEROES        PIC S9(12).
           03  WSS-IND-CPTING   VALUE SPACES        PIC X(01).
           03  WSS-GLS-NOCO     VALUE SPACES        PIC X(10).
      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
      *    03  WSS-GLS-NOUF     VALUE SPACES        PIC X(02).
           03  WSS-GLS-NOUF     VALUE 'SI'          PIC X(02).
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
           03  WSS-BAS-FGPE                         PIC 9(08).
           03  WSS-NUM-DPLZ     VALUE ZEROES        PIC 9(04).
           03  WSS-VAL-SCOR                         PIC S9(11)V9(4).
           03  WSS-VAL-COMI                         PIC S9(11)V9(4).
           03  WSS-VAL-SPLZ                         PIC S9(11)V9(4).
           03  WSS-VAL-COPR                         PIC S9(11)V9(4).
           03  WSS-VAL-COPR-R                       PIC S9(11)V9(4).
           03  WSS-CIC-CPTIOPC  VALUE SPACES        PIC X(12).
           03  WSS-COD-MENSCPT  VALUE SPACES        PIC X(12).
           03  WSS-IND-UTSV                         PIC X(01).
           03  WSS-GLS-CPT.
               05 WSS-GLS-CPT1  VALUE SPACES        PIC X(40).
               05 WSS-GLS-CPT2  VALUE SPACES        PIC X(35).
           03  WSS-NUM-EVCCPT   VALUE ZEROES        PIC 9(01).
           03  WSS-SGV-SPRD     VALUE ZEROES        PIC S9(03)V9(4).
           03  WSS-SGV-TINT     VALUE ZEROES        PIC S9(03)V9(4).
           03  WSS-SGV-INT-VEN  VALUE ZEROES COMP-3 PIC S9(11)V9(4).
           03  WSS-SGV-CAP-VEN  VALUE ZEROES COMP-3 PIC S9(11)V9(4).
           03  WSS-SGV-REA-VEN  VALUE ZEROES COMP-3 PIC S9(11)V9(4).
           03  WSS-SGV-PAS-CAL  VALUE ZEROES COMP-3 PIC S9(11)V9(4).

       01 WSS-FEC-FCAL.
           05 WSS-NUM-SFCA     PIC 9(02).
           05 WSS-NUM-AFCA     PIC 9(02).
           05 WSS-NUM-MFCA     PIC 9(02).
           05 WSS-NUM-DFCA     PIC 9(02).
       01 WSS-FEC-FCOL.
           05 WSS-NUM-SCOL     PIC 9(02).
           05 WSS-NUM-ACOL     PIC 9(02).
           05 WSS-NUM-MCOL     PIC 9(02).
           05 WSS-NUM-DCOL     PIC 9(02).
       01 WSS-FEC-FDEV.
           05 WSS-NUM-SDEV     PIC 9(02).
           05 WSS-NUM-ADEV     PIC 9(02).
           05 WSS-NUM-MDEV     PIC 9(02).
           05 WSS-NUM-DDEV     PIC 9(02).
       01 WSS-FEC-FVEC.
           05 WSS-NUM-SVEC     PIC 9(02).
           05 WSS-NUM-AVEC     PIC 9(02).
           05 WSS-NUM-MVEC     PIC 9(02).
           05 WSS-NUM-DVEC     PIC 9(02).
       01 WSS-FEC-CPTFCAM.
           05 WSS-NUM-SCPTCAM  PIC 9(02).
           05 WSS-NUM-ACPTCAM  PIC 9(02).
           05 WSS-NUM-MCPTCAM  PIC 9(02).
           05 WSS-NUM-DCPTCAM  PIC 9(02).
       01 WSS-FEC-CPTFCAA.
           05 WSS-NUM-SCPTCAA  PIC 9(02).
           05 WSS-NUM-ACPTCAA  PIC 9(02).
           05 WSS-NUM-MCPTCAA  PIC 9(02).
           05 WSS-NUM-DCPTCAA  PIC 9(02).
       01 WSS-FEC-CPTPAG.
           05 WSS-NUM-DCPTPAG  PIC 9(02).
           05 WSS-NUM-MCPTPAG  PIC 9(02).
           05 WSS-NUM-SCPTPAG  PIC 9(02).
           05 WSS-NUM-ACPTPAG  PIC 9(02).
       01 WSS-FEC-CPTPAG-R.
           05 WSS-NUM-SCPTPAG-R  PIC 9(02).
           05 WSS-NUM-ACPTPAG-R  PIC 9(02).
           05 WSS-NUM-MCPTPAG-R  PIC 9(02).
           05 WSS-NUM-DCPTPAG-R  PIC 9(02).
      *01 FEC-FECHCPT.
      *    05 FEC-ITMCPT1      PIC 9(02).
      *    05 FEC-ITMCPT2      PIC 9(02).
      *    05 FEC-ITMCPT3      PIC 9(02).
      *    05 FEC-ITMCPT4      PIC 9(02).


      *RGD-FIN COPYS
      *>>>>
      *<<<< WSS_DTC
       01 WSS-NUM-CCUR.
           03 WSS-NUM-ICUR-EDT  PIC  ZZ9.
           03 WSS-NUM-ICUR-ALF  PIC X(03).
           03 WSS-NUM-ICUR      REDEFINES
              WSS-NUM-ICUR-ALF       PIC 9(03).

       01  WSS-MONE.
           03  WSS-COD-UEFES VALUE SPACES            PIC X(06).
           03  WSS-COD-PESOS VALUE SPACES            PIC X(06).
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
       01 WCC-VARI.
          03 WCC-S                 VALUE 'S'         PIC X(01).
          03 WCC-N                 VALUE 'N'         PIC X(01).
          03 WCC-999999999         VALUE 999999999   PIC 9(09).
          03 WCC-0999              VALUE '0999  '    PIC X(06).
          03 WCC-0998              VALUE '0998  '    PIC X(06).
          03 WCC-CAPPREMAYOPC      VALUE 'CAPPREMAYOPC' PIC X(12).
          03 WCC-MSG-NO-ENCONTRADO VALUE 'MSG NO ENCONTRADO' PIC X(17).
          03 WCC-CAMMONCAPP        VALUE 'CAMMONCAPP  ' PIC X(12).
          03 WCC-COL               VALUE 'COL'       PIC X(13).
          03 WCC-MSG               VALUE 'MSG'       PIC X(13).
          03 WCC-1                 VALUE 1           PIC 9(01).
          03 WCC-COM-FOGA          VALUE ZEROES      PIC 9(12)V9(04).
          03 WCC-SEG-INTN          VALUE ZEROES      PIC 9(12)V9(04).
          03 WSS-VAL-COMP-RESP        PIC 9(14)V9(04) VALUE ZEROES.
          03 WSS-SEG-CPTTPAG  VALUE ZEROES        PIC S9(12).
          03 WSS-COMI-ANTE         VALUE ZEROES   PIC S9(11)V9(04).
          03 WSS-REAJ-RESP         VALUE ZEROES   PIC S9(11)V9(04).
          03 WSS-CAPR-RESP         VALUE ZEROES   PIC S9(11)V9(04).
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
          03 WCC-TOC              VALUE 'TOC'           PIC X(03).
          03 WCC-COLPPIS2         VALUE 'COLPPIS2'      PIC X(08).
          03 WCC-TAB              VALUE 'TAB'           PIC X(03).
          03 WCC-INT              VALUE 'INT'           PIC X(03).
          03 WCC-N100             VALUE 100             PIC 9(03).
          03 WCC-N1000            VALUE 1000            PIC 9(04).
          03 WCC-C00              VALUE '00'            PIC X(02).
          03 WCC-ABORTO                                 PIC X(26)
                                  VALUE 'ABORTO : Comando invalido '.
          03 WCC-ABORTO1                                PIC X(59)
                      VALUE 'ABORTO : Comando GET-GRT, NO soportado'.
          03 WCC-ABORTO2                                PIC X(34)
                          VALUE 'ABORTO : Comando CHG, NO soportado'.
          03 WCC-ABORTO3                                PIC X(39)
                     VALUE 'Comando INP, ninguna operacion asociada'.
          03 WCC-ABORTO4                                PIC X(39)
                     VALUE 'Comando OUT, ninguna operacion asociada'.
          03 WCC-ABORTO5                                PIC X(39)
                     VALUE 'Comando UPD, ninguna operacion asociada'.
          03 WCC-ABORTO6                                PIC X(39)
                     VALUE 'Comando CLO, ninguna operacion asociada'.
          03 WCC-ABORTO7                                PIC X(38)
                      VALUE 'ABORTO : Comando FND-GRT, NO soportado'.
          03 WCC-ABORTO8                                PIC X(38)
                      VALUE 'ABORTO : Comando ULK-ALL, NO soportado'.
          03 WCC-ABORTO9                                PIC X(34)
                          VALUE 'ABORTO : Comando VID, NO soportado'.
          03 WCC-ABORTO10                               PIC X(39)
                     VALUE 'Comando ACC, ninguna operacion asociada'.
          03 WCC-ABORTO11                               PIC X(38)
                      VALUE 'ABORTO : Comando REC-LCK, NO soportado'.
          03 WCC-ABORTO12                               PIC X(34)
                          VALUE 'ABORTO : Comando FNF, NO soportado'.
          03 WCC-C99     VALUE '99'                           PIC X(02).
          03 WCC-REDKY   VALUE 'REDKY'                        PIC X(05).
          03 WCC-REDNX   VALUE 'REDNX'                        PIC X(05).
          03 WCC-LOCKY   VALUE 'LOCKY'                        PIC X(05).
          03 WCC-REDKG   VALUE 'REDKG'                        PIC X(05).
          03 WCC-ADDIT   VALUE 'ADDIT'                        PIC X(05).
          03 WCC-UPDAT   VALUE 'UPDAT'                        PIC X(05).
          03 WCC-DELET   VALUE 'DELET'                        PIC X(05).
          03 WCC-LOCKX   VALUE 'LOCKX'                        PIC X(05).
          03 WCC-RELES   VALUE 'RELES'                        PIC X(05).
          03 WCC-ABORTO13                               PIC X(38)
                      VALUE 'ABORTO : Comando REC-LEN, NO soportado'.
          03 WCC-ABORTO14                               PIC X(39)
                     VALUE 'Comando EXT, ninguna operacion asociada'.
          03 WCC-RDUKY   VALUE 'RDUKY'                        PIC X(05).
          03 WCC-ABORTO15                               PIC X(39)
                     VALUE 'Comando END-BRW, sin operacion asociada'.
          03 WCC-LOGTB   VALUE 'LOGTB'                        PIC X(05).
          03 WCC-REDKL   VALUE 'REDKL'                        PIC X(05).
          03 WCC-REDBR   VALUE 'REDBR'                        PIC X(05).
          03 WCC-LOGCP   VALUE 'LOGCP'                        PIC X(05).
          03 WCC-ABORTO16                               PIC X(39)
                     VALUE 'Comando BFR-RFH, sin operacion asociada'.
          03 WCC-STATUS  VALUE 'Status DTC :'                 PIC X(12).
          03 WCC-KEY     VALUE 'Key'                          PIC X(03).
          03 WCC-BASEDATO VALUE 'Base Datos'                  PIC X(10).
          03 WCC-CMD      VALUE 'Cmd'                         PIC X(03).
          03 WCC-FILE     VALUE 'File'                        PIC X(04).
          03 WCC-C10      VALUE '10'                          PIC X(02).
          03 WCC-C22      VALUE '22'                          PIC X(02).
          03 WCC-C23      VALUE '23'                          PIC X(02).
          03 WCC-C11      VALUE '11'                          PIC X(02).
          03 WCC-C43      VALUE '43'                          PIC X(02).
          03 WCC-C12      VALUE '12'                          PIC X(02).
          03 WCC-C14      VALUE '14'                          PIC X(02).
          03 WCC-C16      VALUE '16'                          PIC X(02).
          03 WCC-C47      VALUE '47'                          PIC X(02).
          03 WCC-C18      VALUE '18'                          PIC X(02).
          03 WCC-C44      VALUE '44'                          PIC X(02).
          03 WCC-C19      VALUE '19'                          PIC X(02).
          03 WCC-C29      VALUE '29'                          PIC X(02).
          03 WCC-C92      VALUE '92'                          PIC X(02).
          03 WCC-C45      VALUE '45'                          PIC X(02).
          03 WCC-C93      VALUE '93'                          PIC X(02).
          03 WCC-C46      VALUE '46'                          PIC X(02).
          03 WCC-ABORTO17 VALUE 'Aborto, DTC:'                PIC X(12).
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130      
      *AFRI-INI MAYO-2012 CERTIFICADO PREPAGO
       01 WSS-VARI.
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
          03 WSS-IND-TSS-DPS    VALUE SPACES            PIC X(01).
          03 WSS-IND-DES        VALUE ZEROES            PIC 9(03).
          03 WSS-IND-AUX        VALUE ZEROES            PIC 9(03).
          03 WSS-IND-OTRO       VALUE ZEROES            PIC 9(04).
          03 WSS-IND-ICG        VALUE ZEROES            PIC 9(04).
          03 WSS-IND-CAM        VALUE ZEROES            PIC 9(03).
          03 WSS-IND-TOC        VALUE ZEROES            PIC 9(03).
          03 VEC-TAB-TOC.
             05 WSS-VEC-TAB-TOC   OCCURS 100 TIMES.
                07 VTOC-COD-TABL    VALUE SPACES        PIC X(15).
                07 VTOC-GLS-TABL    VALUE SPACES        PIC X(75).
                07 VTOC-FIO-STAT    VALUE SPACES        PIC X(02).
          03 VEC-TAB-CAM.
             05 WSS-VEC-TAB-CAM   OCCURS 100 TIMES.
                07 VCAM-KEY-CAMB    VALUE SPACES        PIC X(28).
                07 VCAM-GLS-TABL    VALUE SPACES        PIC X(75).
                07 VCAM-FIO-STAT    VALUE SPACES        PIC X(02).
          03 VEC-AUX-ICG.
             05 WSS-VEC-AUX-ICG   OCCURS 100 TIMES.
                07 BASE-KEY-IICG    VALUE SPACES        PIC X(55).
                07 BASE-GLS-TABL    VALUE SPACES        PIC X(117).
                07 BASE-FIO-STAT    VALUE SPACES        PIC X(02).
          03 VEC-AUX-TAB.
             05 WSS-VEC-AUX-TAB   OCCURS 100 TIMES.
                07 AUX-COD-TABL    VALUE SPACES         PIC X(15).
                07 AUX-GLS-TABL    VALUE SPACES         PIC X(195).
                07 AUX-FIO-STAT    VALUE SPACES         PIC X(02).
          03 VEC-DES-COL.
             05 WSS-VEC-DES-COL   OCCURS 100 TIMES.
                07 DES-COD-TABL    VALUE SPACES         PIC X(15).
                07 DES-GLS-TABL    VALUE SPACES         PIC X(195).
                07 DES-FIO-STAT    VALUE SPACES         PIC X(02).
          03 VEC-OTRO.
             05 WSS-VEC-OTRO   OCCURS 100 TIMES.
                07 OTRO-COD-TABL    VALUE SPACES        PIC X(15).
                07 OTRO-GLS-TABL    VALUE SPACES        PIC X(195).
                07 OTRO-FIO-STAT    VALUE SPACES        PIC X(02).
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      *AFRI-INI 28-NOV-2012 CAMBIOS CAEV
          03 WSS-CAM-CAEV                  PIC 9(11)V9(4) VALUE ZEROES.
      *AFRI-FIN 28-NOV-2012 CAMBIOS CAEV
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
          03 WSS-IND-GASTOS                PIC X(01) VALUE 'N'.
          03 WSS-TOT-CAPM                  PIC 9(14) VALUE ZEROES.
          03 WSS-CAP-FINAL                 PIC 9(14) VALUE ZEROES.
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
          03 WSS-DLC-RDEV                  PIC 9(08) VALUE ZEROES.
          03 WSS-CAN-FUAP                  PIC 9(08) VALUE ZEROES.
          03 WSS-CAN-RFUA.
             05 WSS-NUM-SFUA               PIC 9(02) VALUE ZEROES.
             05 WSS-NUM-AFUA               PIC 9(02) VALUE ZEROES.
             05 WSS-NUM-MFUA               PIC 9(02) VALUE ZEROES.
             05 WSS-NUM-DFUA               PIC 9(02) VALUE ZEROES.
          03 WSS-FEC-VANT                  PIC 9(08) VALUE ZEROES.
          03 WSS-VEN-ANTE.
             05 WSS-NUM-SANT               PIC 9(02) VALUE ZEROES.
             05 WSS-NUM-AANT               PIC 9(02) VALUE ZEROES.
             05 WSS-NUM-MANT               PIC 9(02) VALUE ZEROES.
             05 WSS-NUM-DANT               PIC 9(02) VALUE ZEROES.
          03 WSS-IND-VMOR                  PIC X(01) VALUE SPACES.
          03 WSS-VAL-MORASUM               PIC 9(14) VALUE ZEROES.
          03 WSS-VAL-CFGPSUM               PIC 9(14) VALUE ZEROES.
          03 WSS-VAL-INTAUX          PIC S9(11)V9(04) VALUE ZEROES.
          03 WSS-VAL-TEMP            PIC 9(14)V9(04) VALUE ZEROES.
          03 WSS-VAL-INTSUM                PIC 9(14) VALUE ZEROES.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *AFRI-INI 26-JUN-2012 CALCULO CAEV
          03 WSS-IND-SUNO                  PIC X(01) VALUE SPACES.
      *AFRI-FIN 26-JUN-2012 CALCULO CAEV
          03 WSS-TIP-CRED                  PIC X(03) VALUE SPACES.
          03 WSS-KEY-LIMI                  PIC X(12) VALUE SPACES.
          03 WSS-GLS-LIMI.
             05 WSS-MON-LIMI        PIC 9(11)V9(04)  VALUE ZEROES.
             05 WSS-FILLER          PIC X(45) VALUE SPACES.
          03 WSS-MES-INFO                  PIC 9(02).
      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
          03 WSS-VAL-RAPP           PIC 9(11)V9(05) VALUE ZEROES.
          03 WSS-VAL-BASE           PIC X(01) VALUE SPACES.
          03 WSS-GLS-MINI.
             05 WSS-MON-MINI        PIC 9(03) VALUE ZEROES.
             05 WSS-FILLER-1        PIC X(07) VALUE SPACES.
             05 WSS-MON-TIMO        PIC X(06) VALUE SPACES.
             05 WSS-FILLER-2        PIC X(04) VALUE SPACES.
             05 WSS-MON-LIPR        PIC 9(11)V9(04) VALUE ZEROES.
             05 WSS-FILLER-3        PIC X(25) VALUE SPACES.
          03 WSS-VAL-MINC           PIC 9(11)V9(04) VALUE ZEROES.
          03 WSS-NUM-DIFD             PIC 9(04) VALUE ZEROES.
          03 WSS-FEC-FPVC             PIC 9(08) VALUE ZEROES.
          03 WSS-VAL-PREP             PIC S9(14) VALUE ZEROES.
          03 WSS-VAL-CAPA             PIC 9(14) VALUE ZEROES.
          03 WSS-TOT-MORA             PIC 9(14)V9(04) VALUE ZEROES.
          03 WSS-VAL-COMP             PIC 9(14)V9(04) VALUE ZEROES.
          03 WSS-VAL-TMP              PIC 9(14)V9(04) VALUE ZEROES.
          03 WSS-VAL-TM2              PIC 9(14) VALUE ZEROES.
          03 WSS-VAL-VENC             PIC 9(14)V9(04) VALUE ZEROES.
          03 WSS-VAL-NDBA             PIC 9(14)V9(04) VALUE ZEROES.
          03 WSS-QUE-MVEN             PIC X(01) VALUE SPACES.
          03 WSS-IND-MINI             PIC X(01) VALUE SPACES.
          03 WSS-CAM-VENC             PIC X(01) VALUE SPACES.
          03 WSS-COB-COPR             PIC X(01) VALUE SPACES.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *   03 WSS-DLC-FDEV             PIC 9(08) VALUE ZEROES.
          03 WSS-DLC-FDEV.
             05 WSS-DLC-SDEV          PIC 9(02) VALUE ZEROES.
             05 WSS-DLC-ADEV          PIC 9(02) VALUE ZEROES.
             05 WSS-DLC-MDEV          PIC 9(02) VALUE ZEROES.
             05 WSS-DLC-DDEV          PIC 9(02) VALUE ZEROES.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
      *AFRI-FIN MAYO-2012 CERTIFICADO PREPAGO
      *CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
          03 WSS-IND-CAEV    VALUE ZEROES         PIC 9(01).
          03 WSS-IND-FMAV    VALUE ZEROES         PIC 9(01).
          03 WSS-IND-DCRE    VALUE ZEROES         PIC 9(01).
          03 WSS-IND-TASA    VALUE ZEROES         PIC 9(01).
          03 WSS-IND-V999    VALUE ZEROES         PIC 9(01).
          03 WSS-IND-CTCF    VALUE ZEROES         PIC 9(01).
          03 WSS-COD-PESO                         PIC X(12).
          03 WSS-COD-DAT1                         PIC X(01).
       01 WSS-CONSTANTES.
           03 WSS-CT-1        VALUE 1                  PIC 9(01).
           03 WSS-CT-S        VALUE 'S'                PIC X(01).
           03 WSS-CT-K        VALUE 'K'                PIC X(01).
           03 WSS-CT-I        VALUE 'I'                PIC X(01).
           03 WSS-CT-A        VALUE 'A'                PIC X(01).
           03 WSS-CT-M        VALUE 'M'                PIC X(01).
           03 WSS-CT-D        VALUE 'D'                PIC X(01).
           03 WSS-CT-COL      VALUE 'COL'              PIC X(03).
           03 WSS-CT-TAS      VALUE 'TAS'              PIC X(03).
           03 WSS-CT-VSN      VALUE 'VSN'              PIC X(03).
           03 WSS-CT-DES      VALUE 'DES'              PIC X(03).
           03 WSS-CT-LCT      VALUE 'LCT'              PIC X(03).
           03 WSS-CT-VLR      VALUE 'VLR'              PIC X(03).
           03 WSS-CT-TAB      VALUE 'TAB'              PIC X(03).
           03 WSS-CT-TCF      VALUE 'TCF'              PIC X(03).
           03 WSS-CT-PCP      VALUE 'PCP'              PIC X(03).
           03 WSS-CT-TASA     VALUE 'TASA'             PIC X(06).
           03 WSS-CT-0999     VALUE '0999  '           PIC X(06).
           03 WSS-CT-CAEV     VALUE 'CALCULACAEV'      PIC X(11).
           03 WSS-CT-FMAV     VALUE 'CALMORAFMAV'      PIC X(11).
           03 WSS-CT-TABL     VALUE 'TAB-CIC-TABL'     PIC X(12).
           03 WSS-CT-TVCD     VALUE 'TIOVCD      '     PIC X(12).
           03 WSS-CT-TTIO     VALUE 'TIO         '     PIC X(12).
           03 WSS-CT-COD1     VALUE 'CCNPCP  INEX'     PIC X(12).
      *CIMA-FIN 29-JUL-2014 OPT TRANSAC LENTAS
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *COPY COLWGDPS.
      COPY COLWGIS2.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
      *>>>>
       01  PGM-VARI.
           03 PGM-ICLR                  VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-TODO          VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-LLAVES        VALUE 'K'       PIC X(01).
           03 PGM-LIMPIAR-CAMPOS        VALUE 'F'       PIC X(01).
           03 PGM-NO-LIMPIAR-NADA       VALUE 'N'       PIC X(01).
           03 PGM-PROG                                  PIC X(08).
           03 PGM-NTRN                                  PIC X(04).
           03 PGM-STAT.
              05 PGM-STAT-OPC.
                 88 PGM-STAT-OPC-NUL    VALUE '  '.
                 07 PGM-STT1-OPC        VALUE '2' PIC X(01).
                    88 PGM-STAT-OPC-OKS VALUE '0'.
                 07 PGM-STT2-OPC        VALUE '3' PIC X(01).
              05 PGM-STAT-DBC.
                 88 PGM-STAT-DBC-NUL    VALUE '  '.
                 07 PGM-STT1-DBC        VALUE '2' PIC X(01).
                    88 PGM-STAT-DBC-OKS VALUE '0'.
                 07 PGM-STT2-DBC        VALUE '3' PIC X(01).
              05 PGM-STAT-DLC.
                 88 PGM-STAT-DLC-NUL    VALUE '  '.
                 07 PGM-STT1-DLC        VALUE '2' PIC X(01).
                    88 PGM-STAT-DLC-OKS VALUE '0'.
                 07 PGM-STT2-DLC        VALUE '3' PIC X(01).
              05 PGM-STAT-RDC.
                 88 PGM-STAT-RDC-NUL    VALUE '  '.
                 07 PGM-STT1-RDC        VALUE '2' PIC X(01).
                    88 PGM-STAT-RDC-OKS VALUE '0'.
                 07 PGM-STT2-RDC        VALUE '3' PIC X(01).
                 07 PGM-STAT-CYA           VALUE '23'      PIC X(02).
                    88 PGM-STAT-CYA-OKS    VALUE '00'.
                    88 PGM-STAT-CYA-NUL    VALUE '  '.
                 07 PGM-STAT-COM           VALUE '23'      PIC X(02).
                    88 PGM-STAT-COM-OKS    VALUE '00'.
                    88 PGM-STAT-COM-NUL    VALUE '  '.
                 07 PGM-STAT-AUT           VALUE '23'      PIC X(02).
                    88 PGM-STAT-AUT-OKS    VALUE '00'.
                    88 PGM-STAT-AUT-NUL    VALUE '  '.
                 07 PGM-STAT-VEN           VALUE '23'      PIC X(02).
                    88 PGM-STAT-VEN-OKS    VALUE '00'.
                    88 PGM-STAT-VEN-NUL    VALUE '  '.
                 07 PGM-STAT-RCV           VALUE '23'      PIC X(02).
                    88 PGM-STAT-RCV-OKS    VALUE '00'.
                    88 PGM-STAT-RCV-NUL    VALUE '  '.
      *          07 PGM-STAT-ITR           VALUE '23'      PIC X(02).
      *             88 PGM-STAT-ITR-OKS    VALUE '00'.
      *             88 PGM-STAT-ITR-NUL    VALUE '  '.
                 07 PGM-STAT-ITR.
                    88 PGM-STAT-ITR-NUL    VALUE '  '.
                    09 PGM-STT1-ITR        VALUE '2'       PIC X(01).
                       88 PGM-STAT-ITR-OKS VALUE '0'.
                    09 PGM-STT2-ITR        VALUE '3'       PIC X(01).
                 07 PGM-STAT-ICG           VALUE '23'      PIC X(02).
                    88 PGM-STAT-ICG-OKS    VALUE '00'.
                    88 PGM-STAT-ICG-NUL    VALUE '  '.
                 07 PGM-STAT-CAN           VALUE '23'      PIC X(02).
                    88 PGM-STAT-CAN-OKS    VALUE '00'.
                    88 PGM-STAT-CAN-NUL    VALUE '  '.
                 07 PGM-STAT-ROV           VALUE '23'      PIC X(02).
                    88 PGM-STAT-ROV-OKS    VALUE '00'.
                    88 PGM-STAT-ROV-NUL    VALUE '  '.


      *>>>>
           03 PGM-SRNF                  VALUE '23'      PIC X(02).
           03 PGM-SOKS                  VALUE '00'      PIC X(02).
           03 PGM-SNUL                  VALUE '  '      PIC X(02).
           03 PGM-SUAR                  VALUE SPACES    PIC X(15).
           03 PGM-CMMA.
              05 PGM-CMMA-CHR OCCURS 3000 PIC X(01).
       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 DFH-CMMA OCCURS 3000 PIC X(01).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
       LUP-MAIN.
           IF SCR-INST = SCR-INST-HCM
                 PERFORM SCR-COM.
           IF SCR-CCPP = 'MOD'
                 PERFORM SCR-MOD
           ELSE
           IF SCR-CCPP = 'ING'
                 PERFORM SCR-ING
           ELSE
           IF SCR-CCPP = 'ACC'
                 PERFORM SCR-ACC
           ELSE
           IF SCR-CCPP = 'ELI'
                 PERFORM SCR-ELI
           ELSE
           IF SCR-CCPP = 'ACT'
                 PERFORM SCR-ACT
           ELSE
           IF SCR-CCPP = 'PGM'
                 PERFORM SCR-PGM
           ELSE
                 MOVE SCR-INST-HCM TO SCR-INST.
           GO TO LUP-MAIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
       COPY GNSBGEIB.
       COPY GNSBGEDB.
           MOVE LOW-VALUES TO CPT-FLD.
           MOVE LOW-VALUES TO CPT-EDT.
           PERFORM GNS-PRO-RCK.
           PERFORM GNS-BUS-VCA.
           MOVE +3000 TO SCR-TCMA.
           PERFORM GNS-HDL-SYS.
           PERFORM GNS-HDL-FRM.
           MOVE 'COLPQCPT' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      *PTC-INI
           PERFORM GNS-ERR-QUE.
           PERFORM GET-TSK-TERM.
      *PTC-FIN
      *<<<< INI_FIO
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
           MOVE SPACES TO VEC-TAB-CAM.
           MOVE SPACES TO VEC-TAB-TOC.
           MOVE SPACES TO VEC-AUX-ICG.
           MOVE SPACES TO VEC-AUX-TAB.
           MOVE SPACES TO VEC-DES-COL.
           MOVE SPACES TO VEC-OTRO.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
           IF SCR-OFRM-SRV
                MOVE TSK-TERM-ALF TO CPT-COD-TERM
                MOVE TSK-TERM-ALF TO CPT-COD-TERM-MAS
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *         MOVE TSK-TERM-ALF TO DPS-COD-TERM-TSS
                MOVE TSK-TERM-ALF TO IS2-DPS-COD-TERM-TSS
                MOVE TSK-TERM-ALF TO IS2-DPS-COD-TERM-TSD
                MOVE WCC-S        TO WSS-IND-TSS-DPS IN WSS-VARI
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
           ELSE
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *         MOVE EIBTRMID     TO DPS-COD-TERM-TSS
                MOVE EIBTRMID     TO IS2-DPS-COD-TERM-TSS
                MOVE EIBTRMID     TO IS2-DPS-COD-TERM-TSD
                MOVE WCC-S        TO WSS-IND-TSS-DPS IN WSS-VARI
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
                MOVE EIBTRMID     TO CPT-COD-TERM
                MOVE EIBTRMID     TO CPT-COD-TERM-MAS.
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
           MOVE IS2-DPS-TS-VEN    TO QUE-COLA.
           MOVE IS2-DPS-LEN-TSISC TO QUE-LITM.
           MOVE QUE-DEL       TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           MOVE IS2-DPS-TS-DPS    TO QUE-COLA.
           MOVE IS2-DPS-LEN-TSDPS TO QUE-LITM.
           MOVE QUE-DEL       TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
           MOVE +3859 TO SCR-TCMA.
           PERFORM GNS-ERR-QUE.
           IF ( FRM-FFLD = FRM-FFLD-PF5 ) AND ( SCR-NUM-PANT = 1 )
               MOVE SCR-CPT-FLD TO CPT-FLD
               GO TO FIN-INI.

           IF ( FRM-FFLD = FRM-FFLD-PF6 )
               MULTIPLY SCR-NUM-PANT BY WSS-IMAXCPT GIVING QUE-NITM
               ADD 1              TO QUE-NITM
               MOVE CPT-NOM-TSCPT TO QUE-COLA
               MOVE CPT-LEN-TSCPT TO QUE-LITM
               MOVE QUE-GET       TO QUE-CMND
               PERFORM GNS-PRO-QUE
               IF QUE-STAT NOT = QUE-STAT-OKS
                  MOVE SCR-CPT-FLD TO CPT-FLD
                  GO TO FIN-INI.
      *>>>>
       FIN-INI.
           EXIT.

       COPY GNSBHSYS.
       COPY GNSBHFRM.
       COPY GNSBPRCK.
       GNS-BUS-VCA SECTION.
       INI-GNS-BUS-VCA.
           MOVE 0 TO FRM-IFLD.
       LUP-GNS-BUS-VCA.
           ADD 1 TO FRM-IFLD.
           IF FRM-IFLD NOT > EIBCALEN AND
              FRM-IFLD NOT > 3000
                MOVE DFH-CMMA(FRM-IFLD) TO PGM-CMMA-CHR(FRM-IFLD)
                GO TO LUP-GNS-BUS-VCA.
           MOVE PGM-CMMA TO SCR-VARI.
       FIN-GNS-BUS-VCA.
           EXIT.
       COPY GNSBBIDD.

       SCR-COM SECTION.
       INI-SCR-COM.
      *<<<< INI_SCR_COM
           MOVE CPT-NOM-TSCPT TO QUE-COLA.
           MOVE CPT-LEN-TSCPT TO QUE-LITM.
           MOVE QUE-DEL       TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
      *>>>>
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-CPT.
           PERFORM EDT-KEY-CPT.
           PERFORM EDT-FLD-CPT.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-HCM TO SCR-INST.
           MOVE SCR-CMNP     TO SYS-PROG.
           MOVE SCR-VARI     TO SYS-CMMA.
           MOVE SCR-TCMA     TO SYS-TCMA.
           MOVE SYS-XCTL     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       XCT-ERR.
           MOVE 'XCTERR    ' TO MSG-COD-MENS.
           MOVE 'GNS'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO SYS-MEN1.
           MOVE SYS-PROG     TO SYS-MEN2.
           MOVE SYS-ABOR     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       COPY GNSBGGBK.
       FIN-SCR-COM.
           EXIT.

       SCR-MOD SECTION.
       INI-SCR-MOD.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-MOD
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-MOD.
           PERFORM DESSCRTRL.
       MSG-SCR-MOD.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-MOD.
           EXIT.

       BRW-SCR-MOD SECTION.
       INI-BRW-SCR-MOD.
       FIN-BRW-SCR-MOD.
           EXIT.

       SCR-ING SECTION.
       INI-SCR-ING.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-IKY
               MOVE SCR-INST-GKY TO SCR-INST
      *PTC-INI
               IF NOT SCR-OFRM-SRV
                   PERFORM SCR-DMSG
               ELSE
                   PERFORM SCR-PUTA
      *PTC-FIN
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-RST
                PERFORM GET-IKY
                IF NOT FRM-STAT-ABT
                        MOVE SPACES TO FRM-MENS
                        PERFORM FND-KEY
                        IF NOT FIO-STAT-OKS AND
                           FIO-STAT NOT = FIO-STAT-NEX
      *JSS                  PERFORM CLR-FLD-CPT
                            MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
                            PERFORM SCR-TRL
                        ELSE
      *PTC-INI
                        MOVE 'S' TO SCR-IERR
      *PTC-FIN
                        MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR
                        IF FRM-MENS NOT > SPACES
                            MOVE 'REGEXI    ' TO MSG-COD-MENS
                            MOVE 'GNS' TO MSG-COD-SIST
                            PERFORM GET-MSG
                            MOVE MSG-GLS-DESC TO FRM-MENS
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-ING
                        ELSE
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-ING
                ELSE
                        MOVE SPACES TO FRM-MENS
                        PERFORM SCR-MSSG
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ING
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON.
           PERFORM DESSCRTRL.
       MSG-SCR-ING.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ING.
           EXIT.

       SCR-ACC SECTION.
       INI-SCR-ACC.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ACC
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-ACC.
           PERFORM DESSCRTRL.
      *<<<< PFS_SCR_ACC
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6
               PERFORM VAL-NUM-KEY-CPT
               PERFORM VAL-NUM-FLD-CPT
               PERFORM SCRL-TAB-CPT
               PERFORM SCR-TRL.
      *>>>>
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ACC.
           EXIT.

       BRW-SCR-ACC SECTION.
       INI-BRW-SCR-ACC.
       FIN-BRW-SCR-ACC.
           EXIT.

       SCR-ELI SECTION.
       INI-SCR-ELI.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ELI
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-ELI.
           PERFORM DESSCRTRL.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ELI.
           EXIT.

       BRW-SCR-ELI SECTION.
       INI-BRW-SCR-ELI.
       FIN-BRW-SCR-ELI.
           EXIT.

       SCR-ACT SECTION.
       INI-SCR-ACT.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-RST
                PERFORM GET-KEY
                IF NOT FRM-STAT-ABT
                        MOVE SPACES TO FRM-MENS
                        PERFORM FND-KEY
                        IF FIO-STAT-OKS
                            MOVE SCR-ACTU-MOD TO SCR-ACTU
                            PERFORM PUT-SCR
                            MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
                            PERFORM SCR-TRL
                        ELSE
                        MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR
                        IF FIO-STAT-EOF
                            IF FRM-MENS NOT > SPACES
                                MOVE 'REGEOF    ' TO MSG-COD-MENS
                                MOVE 'GNS' TO MSG-COD-SIST
                                PERFORM GET-MSG
                                MOVE MSG-GLS-DESC TO FRM-MENS
                                PERFORM SCR-MSSG
                                MOVE SCR-STAT-ABT TO SCR-STAT
                                PERFORM DESSCRTRL
                                GO TO FIN-SCR-ACT
                            ELSE
                                PERFORM SCR-MSSG
                                MOVE SCR-STAT-ABT TO SCR-STAT
                                PERFORM DESSCRTRL
                                GO TO FIN-SCR-ACT
                        ELSE
                        IF FIO-STAT = FIO-STAT-NEX
                            IF FRM-MENS NOT > SPACES
                                MOVE 'REGNEX    ' TO MSG-COD-MENS
                                MOVE 'GNS' TO MSG-COD-SIST
                                PERFORM GET-MSG
                                MOVE MSG-GLS-DESC TO FRM-MENS
                                PERFORM SCR-MSSG
                                MOVE SCR-STAT-ABT TO SCR-STAT
                                PERFORM DESSCRTRL
                                GO TO FIN-SCR-ACT
                            ELSE
                                PERFORM SCR-MSSG
                                MOVE SCR-STAT-ABT TO SCR-STAT
                                PERFORM DESSCRTRL
                                GO TO FIN-SCR-ACT
                        ELSE
                            MOVE SCR-ACTU-ING TO SCR-ACTU
      *JSS                  PERFORM CLR-FLD-CPT
                            MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
                            PERFORM SCR-TRL
                ELSE
                        MOVE SPACES TO FRM-MENS
                        PERFORM SCR-MSSG
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ACT
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-ACT.
           PERFORM DESSCRTRL.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ACT.
           EXIT.

       BRW-SCR-ACT SECTION.
       INI-BRW-SCR-ACT.
       FIN-BRW-SCR-ACT.
           EXIT.

       SCR-PGM SECTION.
       INI-SCR-PGM.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-RST
                PERFORM GET-KEY
                IF FRM-STAT-ABT
                    MOVE SPACES TO FRM-MENS
                    PERFORM SCR-MSSG
                    PERFORM DESSCRTRL
                    GO TO FIN-SCR-PGM
                ELSE
                    MOVE SPACES TO FRM-MENS
                    PERFORM FND-KEY
                    IF FIO-STAT = FIO-STAT-NEX
                        IF FRM-MENS NOT > SPACES
                            MOVE 'REGNEX    ' TO MSG-COD-MENS
                            MOVE 'GNS' TO MSG-COD-SIST
                            PERFORM GET-MSG
                            MOVE MSG-GLS-DESC TO FRM-MENS
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-PGM
                        ELSE
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-PGM
                    ELSE
                        MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
                        PERFORM SCR-TRL
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-PGM.
       TRL-SCR-PGM.
           PERFORM DESSCRTRL.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-PGM.
           EXIT.

       BRW-SCR-PGM SECTION.
       INI-BRW-SCR-PGM.
       FIN-BRW-SCR-PGM.
           EXIT.

       SCR-DMSG SECTION.
       INI-SCR-DMSG.
           IF PGM-ICLR = PGM-NO-LIMPIAR-NADA
               NEXT SENTENCE
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-TODO
               PERFORM SCR-CLRA-CPT
               PERFORM EDT-KEY-CPT
               PERFORM EDT-FLD-CPT
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-LLAVES
               PERFORM CLR-KEY-CPT
               PERFORM EDT-KEY-CPT
           ELSE
               PERFORM CLR-FLD-CPT
               PERFORM EDT-FLD-CPT.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-DMSG.
           EXIT.

       SCR-KEY SECTION.
       INI-SCR-KEY.
           PERFORM SCR-RST.
           PERFORM GET-KEY.
           IF FRM-STAT-ABT
                   MOVE SPACES TO FRM-MENS
                   PERFORM SCR-MSSG
                   GO TO FIN-SCR-KEY.
       FND-SCR-KEY.
           MOVE SPACES TO FRM-MENS.
           PERFORM FND-KEY.
           IF FIO-STAT-OKS
               PERFORM PUT-SCR
               MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
               GO TO FIN-SCR-KEY.
      *JSS ELSE
      *        PERFORM CLR-FLD-CPT.
       ERR-SCR-KEY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR.
           IF FRM-MENS NOT > SPACES
               IF FIO-STAT-EOF
                   MOVE 'REGEOF    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
               IF FIO-STAT = FIO-STAT-NEX
                   MOVE 'REGNEX    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
           MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-SCR-KEY.
           EXIT.

       SCR-RST SECTION.
       INI-SCR-RST.
           MOVE SPACES       TO PGM-ICLR.
           MOVE SPACES       TO SCR-ACTU.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
           MOVE LOW-VALUES   TO CPT-FLD.
           MOVE LOW-VALUES TO CPT-EDT.
       FIN-SCR-RST.
           EXIT.

       GET-KEY SECTION.
       INI-GET-KEY.
           PERFORM SCR-GKEY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-KEY.
           EXIT.

       GET-IKY SECTION.
       INI-GET-IKY.
           PERFORM SCR-GIKY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-IKY.
           EXIT.

       FND-KEY SECTION.
       INI-FND-KEY.
           PERFORM KEY-ALL-CPT.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           MOVE FIO-STAT TO PGM-STAT-OPC.
           IF NOT FIO-STAT-OKS
              MOVE 'OPC    NEX' TO MSG-COD-MENS
              MOVE 'GNS' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE 'S' TO SCR-IERR
              GO TO EXT-FND-KEY.

           IF OPC-MSC-STAT IN OPC NOT = 'A'
              MOVE 'OPC    NOACA' TO MSG-COD-MENS
              MOVE 'GNS' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE 'S' TO SCR-IERR
              GO TO EXT-FND-KEY.

           IF OPC-VAL-SCRE IN OPC NOT > ZEROES
              MOVE 'OPCSCRENOINF' TO MSG-COD-MENS
              MOVE 'GNS' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE 'S' TO SCR-IERR
              GO TO EXT-FND-KEY.

      *AFRI-INI 31-AGO-2012 OPERACIONES MOROSAS
           IF OPC-IND-VSTR IN OPC NOT = 'S'
               MOVE 'OPCVENNOESTR' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE 'S' TO SCR-IERR
               GO TO EXT-FND-KEY.
      *AFRI-FIN 31-AGO-2012 OPERACIONES MOROSAS
      *  busco ultima fecha de pago pactada
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC
           MOVE FIO-GET-NLS         TO FIO-CMND
           PERFORM COL-FIO-DLC
           IF NOT (FIO-STAT-OKS                               AND
                   OPC-CIC-IOPC IN OPC = DLC-CIC-IOPC IN DLC)
              MOVE ZEROES              TO DLC-FEC-FMAV IN CPT-FLD
              MOVE SPACES              TO DLC-IND-SCRT IN DLC
           ELSE
              MOVE '00'                TO PGM-STAT-DLC
              MOVE DLC-NUM-DMAV IN DLC TO DLC-NUM-DMAV IN CPT-FLD
              MOVE DLC-NUM-MMAV IN DLC TO DLC-NUM-MMAV IN CPT-FLD
              MOVE DLC-NUM-SMAV IN DLC TO DLC-NUM-SMAV IN CPT-FLD
              MOVE DLC-NUM-AMAV IN DLC TO DLC-NUM-AMAV IN CPT-FLD.

           IF DLC-IND-SCRT IN DLC NOT = '   '
      *AFRI-INI 31-AGO-2012 OPERACIONES MOROSAS
      *       MOVE 'CLIENSITUMOR' TO MSG-COD-MENS
              MOVE 'CLIENSITUCAR' TO MSG-COD-MENS
      *AFRI-FIN 31-AGO-2012 OPERACIONES MOROSAS
              MOVE 'GNS' TO MSG-COD-SIST
              PERFORM GET-MSG
      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
      *       MOVE MSG-GLS-DESC TO FRM-MENS.
              MOVE MSG-GLS-DESC TO FRM-MENS
              PERFORM LIM-PTA-ERROR
              GO TO FIN-BUS-CLI-KEY.
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE DLC-FEC-FDEV IN DLC TO WSS-DLC-RDEV IN WSS-VARI.
           IF DLC-IND-SCBZ IN DLC = 'JUDIC'
               MOVE 'CPTCLISITMOR' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM LIM-PTA-ERROR
               GO TO FIN-BUS-CLI-KEY.

           IF (DLC-IND-SCTB IN DLC NOT = '   ' AND
              DLC-IND-SCTB IN DLC NOT = 'MUL')
               MOVE 'CPTCLISITMOR' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM LIM-PTA-ERROR
               GO TO FIN-BUS-CLI-KEY.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           PERFORM GET-FHOY.
           MOVE HOY-DHOY TO WSS-NUM-DFCA FEC-ITM1 WSS-NUM-DCPTPAG.
           MOVE HOY-MHOY TO WSS-NUM-MFCA FEC-ITM2 WSS-NUM-MCPTPAG.
           MOVE HOY-SHOY TO WSS-NUM-SFCA FEC-ITM3 WSS-NUM-SCPTPAG.
           MOVE HOY-AHOY TO WSS-NUM-AFCA FEC-ITM4 WSS-NUM-ACPTPAG.

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           IF DLC-FEC-FMAV IN DLC NOT > WSS-FEC-FCAL
               MOVE 'OPCNOCUOFUTU' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM LIM-PTA-ERROR
               GO TO FIN-BUS-CLI-KEY.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      * SE MUEVE SALDO DEL CREDITO A VARIABLE DE PANTALLA. (HRS)
           MOVE OPC-VAL-SCRE   IN OPC
             TO FRM-VAL-SCRE IN CPT-FLD.

      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
      *AFRI-INI MAYO-2012 CERTIFICADO PREPAGO
      *BUSCO MONTO MAXIMO
      *     MOVE 'COL' TO FIO-SIST.
      *     MOVE 'VSN' TO TAB-COD-TTAB IN TAB.
      *     MOVE 'MONTOMAXICPT' TO TAB-COD-CTAB IN TAB.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      *     IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
      *         MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-LIMI IN WSS-VARI
      *         IF WSS-MON-LIMI IN WSS-VARI IS NOT NUMERIC
      *             MOVE 'MONLIMNONUME' TO MSG-COD-MENS
      *             GO TO FIN-BUS-CLI-KEY.

      *     IF NOT FIO-STAT-OKS OR TAB-IND-VIGE IN TAB NOT = 'S'
      *         MOVE 'MONLIMNONUME' TO MSG-COD-MENS
      *         GO TO FIN-BUS-CLI-KEY.

      *     IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S' AND
      *        OPC-COD-VCOC IN OPC = '0998  ' AND
      *        WSS-MON-LIMI IN WSS-VARI < OPC-VAL-CRED IN OPC
      *         MOVE 'OPCSALEXCMAX' TO MSG-COD-MENS
      *         GO TO FIN-BUS-CLI-KEY.

      *     IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S' AND
      *        OPC-COD-VCOC IN OPC NOT = '0998  '
      *         MOVE WSS-NUM-DCPTPAG         TO WSS-NUM-DCPTCAM
      *         MOVE WSS-NUM-MCPTPAG         TO WSS-NUM-MCPTCAM
      *         MOVE WSS-NUM-SCPTPAG         TO WSS-NUM-SCPTCAM
      *         MOVE WSS-NUM-ACPTPAG         TO WSS-NUM-ACPTCAM
      *         PERFORM OBT-VCAM-FHOY
      *         COMPUTE WSS-MON-LIMI IN WSS-VARI =
      *                 WSS-MON-LIMI IN WSS-VARI * WSS-CAM-SGV-UF
      *         MOVE WSS-MON-LIMI IN WSS-VARI TO PES-SGV-DECI IN PES-VARI
      *         PERFORM PES-SCTV
      *         MOVE PES-SGV-ENTE IN PES-VARI TO WSS-MON-LIMI IN WSS-VARI
      *         IF WSS-MON-LIMI IN WSS-VARI < OPC-VAL-CRED IN OPC
      *             MOVE 'OPCSALEXCMAX' TO MSG-COD-MENS
      *             GO TO FIN-BUS-CLI-KEY.
      *AFRI-FIN MAYO-2012 CERTIFICADO PREPAGO

      *BUSCO PORCENTAJE MINIMO PARA PREPAGO PARCIAL
      *     IF FRM-VAL-PREP IN CPT-FLD > ZEROES
           MOVE 'COL' TO FIO-SIST.
           MOVE 'CSC' TO TAB-COD-TTAB IN TAB.
           MOVE 'CPM' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
               MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-MINI IN WSS-VARI
               IF WSS-MON-MINI IN WSS-VARI IS NOT NUMERIC
                   MOVE 'PORMINNONUME' TO MSG-COD-MENS
                   PERFORM LIM-PTA-ERROR
                   GO TO FIN-BUS-CLI-KEY
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE 'INFOPRENOEXI' TO MSG-COD-MENS
               PERFORM LIM-PTA-ERROR
               GO TO FIN-BUS-CLI-KEY.

           IF WSS-MON-LIPR IN WSS-VARI IS NOT NUMERIC
               MOVE 'MONLIMNONUME' TO MSG-COD-MENS
               PERFORM LIM-PTA-ERROR
               GO TO FIN-BUS-CLI-KEY.

           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S' AND
              OPC-COD-VCOC IN OPC = '0998  ' AND
              WSS-MON-LIPR IN WSS-VARI < OPC-VAL-CRED IN OPC
               MOVE 'OPCSALEXCMAX' TO MSG-COD-MENS
               PERFORM LIM-PTA-ERROR
               GO TO FIN-BUS-CLI-KEY.

           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S' AND
              OPC-COD-VCOC IN OPC NOT = '0998  '
               MOVE WSS-NUM-DCPTPAG         TO WSS-NUM-DCPTCAM
               MOVE WSS-NUM-MCPTPAG         TO WSS-NUM-MCPTCAM
               MOVE WSS-NUM-SCPTPAG         TO WSS-NUM-SCPTCAM
               MOVE WSS-NUM-ACPTPAG         TO WSS-NUM-ACPTCAM
               PERFORM OBT-VCAM-FHOY
               COMPUTE WSS-MON-LIPR IN WSS-VARI =
                       WSS-MON-LIPR IN WSS-VARI * WSS-CAM-SGV-UF
               MOVE WSS-MON-LIPR IN WSS-VARI TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-MON-LIPR IN WSS-VARI
               IF WSS-MON-LIPR IN WSS-VARI < OPC-VAL-CRED IN OPC
                   PERFORM LIM-PTA-ERROR
                   MOVE 'OPCSALEXCMAX' TO MSG-COD-MENS
                   GO TO FIN-BUS-CLI-KEY.
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL

           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'COL'               TO FIO-SIST.
           MOVE 'RDC-KEY-IDLC'      TO FIO-AKEY.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF FIO-STAT-OKS
               MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC
               MOVE FIO-GET-KEY    TO FIO-CMND
               PERFORM GET-CLI
               IF MSG-COD-MENS NOT > SPACES
                   MOVE '00'                TO PGM-STAT-DBC
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN            TO FRM-GLS-NOMC IN CPT-FLD
               ELSE
                   MOVE MSG-GLS-DESC        TO FRM-MENS CPT-GLS-MENS
                   MOVE 'S'                 TO SCR-IERR.

           IF DBC-CIC-ICLI IN DBC > SPACES
              IF DBC-IND-TICL IN DBC = 'P'
                 PERFORM PRO-LEE-DCP
              ELSE
                 PERFORM PRO-LEE-DCE.

      * BUSCO TASA DEL CREDITO
           PERFORM BUSCA-TIPO-TASACPT.
      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
           IF NOT FIO-STAT-OKS
              MOVE 'COL'        TO MSG-COD-SIST
              MOVE 'CODTINTNEX' TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              PERFORM LIM-PTA-ERROR
              GO TO EXT-FND-KEY.
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL

      *  BUSCO PERIODICIDAD DE PAGO
            PERFORM BUSCA-TIPO-PERIODO.

      *  BUSCO MONEDA
           IF OPC-COD-VCOC IN OPC = SPACES
              MOVE 'MONEDA VIENE EN BLANCO'  TO FRM-GLS-MON IN CPT-FLD
           ELSE
              MOVE 'TAB'               TO FIO-SIST
              MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
              MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB
              MOVE FIO-GET-KEY         TO FIO-CMND
              PERFORM GNS-FIO-TAB
              IF FIO-STAT-OKS
                 MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-MON IN CPT-FLD
              ELSE
                 MOVE 'NO ENCONTRADO'     TO FRM-GLS-MON IN CPT-FLD.

      *  BUSCO TIO-AUX
           IF OPC-COD-COOC IN OPC = SPACES
              MOVE 'TIO-AUX VIENE EN BLANCO' TO FRM-GLS-TCRE IN CPT-FLD
           ELSE
              MOVE 'COL'               TO FIO-SIST
              MOVE 'AUX'               TO TAB-COD-TTAB IN TAB
              MOVE OPC-COD-COOC IN OPC TO TAB-COD-CTAB IN TAB
              MOVE FIO-GET-KEY         TO FIO-CMND
              PERFORM GNS-FIO-TAB
              IF FIO-STAT-OKS
                 MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-TCRE IN CPT-FLD
      *AFRI-INI MAYO-2012 INDICADORES CAE Y CAEV
                 MOVE TAB-CIC-CTAB IN TAB(1:3) TO
                                     WSS-TIP-CRED IN WSS-VARI
      *AFRI-FIN MAYO-2012 INDICADORES CAE Y CAEV
              ELSE
                 MOVE 'NO ENCONTRADO'     TO FRM-GLS-TCRE IN CPT-FLD.

      *AFRI-INI 26-JUN-2012 CALCULO CAEV
           MOVE 'N' TO WSS-IND-SUNO IN WSS-VARI.
           IF FRM-VAL-PREP IN CPT-FLD = 99999999999
               MOVE ZEROES TO FRM-VAL-PREP IN CPT-FLD
               MOVE 'S' TO WSS-IND-SUNO IN WSS-VARI.
      *AFRI-FIN 26-JUN-2012 CALCULO CAEV
      *AFRI-INI 31-AGO-2012 OPERACIONES MOROSAS
      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
      *    IF WSS-TIP-CRED IN WSS-VARI NOT = 'CON' AND
      *       FRM-VAL-PREP IN CPT-FLD > ZEROES
      *        MOVE 'PRONOCONPARC' TO MSG-COD-MENS
      *        GO TO FIN-BUS-CLI-KEY.
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
      *AFRI-FIN 31-AGO-2012 OPERACIONES MOROSAS

      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      * SE CARGA EN UNA TS EL CUADRO DE PAGO PARA SU USO
           PERFORM PRO-TS-VEN.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130

      *  SE BUSCA LA PRIMERA VEN VIGENTE EN CURSO
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN
      * RGD-INI 03-MAR-2011 CORRIGE LECTURA VEN
      *    MOVE 1                   TO VEN-NUM-IVEN IN VEN
           IF OPC-IND-VSTR IN OPC = 'S'
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *       MOVE 1                TO VEN-NUM-IVEN IN VEN
              MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
           ELSE
              MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN.
      * RGD-FIN 03-MAR-2011
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *    MOVE FIO-GET-NLS         TO FIO-CMND
           MOVE FIO-GET-KEY         TO FIO-CMND
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
           PERFORM COL-FIO-VEN
           IF NOT (FIO-STAT-OKS                              AND
                   OPC-CIC-IOPC IN OPC = VEN-CIC-IOPC IN VEN)
              MOVE 'OPC    NOVEN' TO MSG-COD-MENS
              MOVE 'GNS' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              PERFORM LIM-PTA-ERROR
              GO TO EXT-FND-KEY.

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           IF VEN-NUM-IVCT IN VEN = 1
               MOVE ZEROES TO WSS-FEC-VANT IN WSS-VARI
           ELSE
               PERFORM BUS-VEN-ANT-CPT
               IF FRM-MENS > SPACES
                   MOVE 'S' TO SCR-IERR
                   PERFORM LIM-PTA-ERROR
                   GO TO EXT-FND-KEY.

      *    IF VEN-FEC-FVEN IN VEN < HOY-FHOY
      *       MOVE 'RTESCRE >0  ' TO MSG-COD-MENS
      *       MOVE 'GNS' TO MSG-COD-SIST
      *       PERFORM GET-MSG
      *       MOVE MSG-GLS-DESC TO FRM-MENS
      *       MOVE 'S' TO SCR-IERR
      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
      *       PERFORM LIM-PTA-ERROR
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
      *       GO TO EXT-FND-KEY.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

      *    VALIDAMOS SI ULTIMA CUOTA FUE PAGADA CON OTRA OP.

           MOVE SPACES  TO FRM-MENS.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    PERFORM VALIDA-ROVOPC-RELAC.
           PERFORM EVAL-CAN-TRAS.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

           IF FRM-MENS  > SPACES
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
              MOVE WSS-CIC-CPTIOPC TO OPC-CIC-IOPC IN OPC
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
              MOVE 'S' TO SCR-IERR
      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
              PERFORM LIM-PTA-ERROR
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
              GO TO EXT-FND-KEY.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE SPACES          TO OPC.
           MOVE WSS-CIC-CPTIOPC    TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY     TO FIO-CMND.
           PERFORM COL-FIO-OPC.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

           MOVE OPC-VAL-SCRE IN OPC TO BKP-VAL-SCRE.
           MOVE ZEROES TO WSS-JCPT.
      *AFRI-INI MAYO-2012 CERTIFICADO PREPAGO
           MOVE WSS-NUM-MCPTPAG TO WSS-MES-INFO IN WSS-VARI.
           MOVE 'T  O  T  A  L '    TO FRM-GLS-TCAN IN CPT-FLD.
           MOVE 'T'                 TO WSS-IND-CPTCAAD.
      *AFRI-FIN MAYO-2012 CERTIFICADO PREPAGO
      *CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
      *
           MOVE ZERO        TO WSS-IND-CAEV.
           MOVE WSS-CT-COL  TO TAB-COD-SIST FIO-SIST.
           MOVE WSS-CT-TAS  TO TAB-COD-TTAB IN TAB.
           MOVE WSS-CT-CAEV TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = WSS-CT-S
              MOVE WSS-CT-1  TO  WSS-IND-CAEV IN WSS-VARI.
      *
           MOVE ZERO          TO WSS-IND-FMAV.
           MOVE WSS-CT-VSN    TO TAB-COD-TTAB IN TAB.
           MOVE WSS-CT-FMAV   TO TAB-COD-CTAB IN TAB.
           MOVE WSS-CT-COL    TO FIO-SIST.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = WSS-CT-S )
               MOVE WSS-CT-1 TO  WSS-IND-FMAV IN WSS-VARI.
      *
           MOVE ZERO                TO WSS-IND-DCRE.
           MOVE WSS-CT-COL          TO TAB-COD-SIST FIO-SIST.
           MOVE WSS-CT-DES          TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-CDOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = WSS-CT-S
              IF (TAB-GLS-DATA IN TAB(60:1) = WSS-CT-K OR
                     TAB-GLS-DATA IN TAB(60:1) = WSS-CT-I)
                  MOVE WSS-CT-1 TO WSS-IND-DCRE IN WSS-VARI.
      *
           MOVE ZERO         TO WSS-IND-TASA.
           MOVE WSS-CT-COL   TO TAB-COD-SIST FIO-SIST.
           MOVE WSS-CT-LCT   TO TAB-COD-TTAB IN TAB.
           MOVE WSS-CT-TASA  TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = WSS-CT-S)
               MOVE WSS-CT-1  TO  WSS-IND-TASA IN WSS-VARI.
           MOVE TAB-COD-DAT1(1) TO WSS-COD-DAT1.
      *
           MOVE ZERO           TO WSS-IND-V999.
           MOVE WSS-CT-TAB     TO TAB-COD-SIST FIO-SIST.
           MOVE WSS-CT-VLR     TO TAB-CIC-TTAB IN TAB.
           MOVE WSS-CT-0999    TO TAB-CIC-CTAB IN TAB.
           MOVE WSS-CT-TABL    TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = WSS-CT-S)
               MOVE WSS-CT-1   TO  WSS-IND-V999 IN WSS-VARI.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO.
      *
           PERFORM BUS-PESO.
      *
           MOVE WSS-CT-COL          TO TAB-COD-SIST FIO-SIST.
           MOVE WSS-CT-PCP          TO TAB-COD-TTAB IN TAB.
           MOVE WSS-CT-TTIO         TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND
              TAB-IND-VIGE IN TAB = WSS-CT-S
               MOVE TAB-GLS-DATA IN TAB TO NOR-GLS-DATA-TIOS
           ELSE
               MOVE WSS-CT-COD1               TO NOR-CMSG.
      *
           MOVE WSS-CT-COL          TO TAB-COD-SIST FIO-SIST.
           MOVE WSS-CT-PCP          TO TAB-COD-TTAB IN TAB.
           MOVE WSS-CT-TVCD         TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND
              TAB-IND-VIGE IN TAB = WSS-CT-S
               MOVE TAB-GLS-DATA IN TAB TO NOR-GLS-DATA-TIOS-VCD
           ELSE
               MOVE WSS-CT-COD1                  TO NOR-CMSG
           END-IF.
      *
           IF NOR-CMSG NOT > SPACES
              PERFORM CARGA-TABLA-BCX
           END-IF
           IF NOR-CMSG NOT > SPACES
              PERFORM CARGA-TABLA-BCV
           END-IF.
      *CIMA-FIN 29-JUL-2014 OPT TRANSAC LENTAS

       LUP-CARGA-PREPAGOS.
      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
      *    MOVE 'T  O  T  A  L '    TO FRM-GLS-TCAN IN CPT-FLD.
      *    MOVE 'T'                 TO WSS-IND-CPTCAAD.
      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
           PERFORM CRG-VEC-CPT.
      *AFRI-INI 26-JUN-2012 CALCULO CAEV
           IF WSS-IND-SUNO IN WSS-VARI = 'S'
               MOVE WCC-1 TO FRM-VAL-PREP IN CPT-FLD
               PERFORM CRG-VEC-CPT
               MOVE ZEROES TO FRM-VAL-PREP IN CPT-FLD
               GO TO FIN-BUS-CLI-KEY.
      *AFRI-FIN 26-JUN-2012 CALCULO CAEV
      *AFRI-INI MAYO-2012 CERTIFICADO PREPAGO
      *    IF WSS-JCPT < 10
           IF WSS-JCPT < WSS-JMAXCPT
      *AFRI-FIN MAYO-2012 CERTIFICADO PREPAGO
              GO TO LUP-CARGA-PREPAGOS.

       FIN-BUS-CLI-KEY.
           IF MSG-COD-MENS > SPACES
              GO TO MSG-FND-KEY.

           MOVE '00' TO PGM-STAT-DBC.

       CNT-FND-KEY.
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      **    MOVE DPS-TS-VEN    TO QUE-COLA.
      **    MOVE DPS-LEN-TSISC TO QUE-LITM.
      *     MOVE IS2-DPS-TS-VEN    TO QUE-COLA.
      *     MOVE IS2-DPS-LEN-TSISC TO QUE-LITM.
      *     MOVE QUE-DEL       TO QUE-CMND.
      *     PERFORM GNS-PRO-QUE.
      *     MOVE IS2-DPS-TS-DPS    TO QUE-COLA.
      *     MOVE IS2-DPS-LEN-TSDPS TO QUE-LITM.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      *     MOVE QUE-DEL       TO QUE-CMND.
      *     PERFORM GNS-PRO-QUE.
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
           PERFORM PUT-TAB.

           MOVE '00' TO FIO-STAT.
           MOVE SCR-STAT-CON TO SCR-STAT.
           GO TO FIN-FND-KEY.

      *----------------------------------------------------------
       MSG-FND-KEY.
           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE '00' TO FIO-STAT.
           MOVE SCR-STAT-CON TO SCR-STAT.
           GO TO FIN-FND-KEY.
      *>>>>
       FIN-FND-KEY.
           IF FIO-STAT = FIO-STAT-NEX
               MOVE 'S' TO SCR-IERR.
       EXT-FND-KEY.
           EXIT.
 
       PUT-SCR SECTION.
       INI-PUT-SCR.
           PERFORM PUT-ALL-CPT.
       FIN-PUT-SCR.
           EXIT.

       STP-EXIT SECTION.
       INI-STP-EXIT.
           MOVE SCR-PROG TO PGM-PROG.
           MOVE SCR-NTRN TO PGM-NTRN.

           MOVE SCR-PROV TO SCR-PROG.
           MOVE SCR-NTRV TO SCR-NTRN.

           MOVE PGM-PROG TO SCR-PROV
           MOVE PGM-NTRN TO SCR-NTRV.
       FIN-STP-EXIT.
           EXIT.

       SCR-EXIT SECTION.
       INI-SCR-EXIT.
           MOVE 'P'      TO SCR-ICMN.
           MOVE SCR-NTRN TO SYS-NTRN.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-RTRN TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       FIN-SCR-EXIT.
           EXIT.

       SCR-PUTA SECTION.
       INI-SCR-PUTA.
      *PTC-INI
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE CPT-FLD TO FRM-DFLD.
           MOVE FRM-PUT-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-PUTA.
           EXIT.

       SCR-MSSG SECTION.
       INI-SCR-MSSG.
           IF FRM-MEN1 NOT > SPACES
               MOVE SPACES TO FRM-MEN1.
           IF FRM-MEN2 NOT > SPACES
               MOVE SPACES TO FRM-MEN2.
           MOVE FRM-MENS TO CPT-GLS-MENS.
       FIN-SCR-MSSG.
           EXIT.

       SCR-GKEY SECTION.
       INI-SCR-GKEY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-CPT
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO CPT-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GKEY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-CPT.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-CPT
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-CPT.
           PERFORM VAL-IKY-CPT.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-MKY-CPT.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-AKY-CPT.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-CON-KEY-CPT.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GKEY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-CPT.
       ERR-SCR-GKEY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-CPT.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GKEY.
           PERFORM SCR-MSSG.

       SCR-GIKY SECTION.
       INI-SCR-GIKY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-CPT
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO CPT-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GIKY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-CPT.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-IKY-CPT
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-CPT.
           PERFORM VAL-IKY-CPT.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GIKY.
           PERFORM VAL-CON-IKY-CPT.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GIKY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-CPT.
       ERR-SCR-GIKY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-IKY-CPT.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GIKY.
           PERFORM SCR-MSSG.

       GET-CON SECTION.
       INI-GET-CON.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
      *<<<< PFS_GET_CON
           IF NOT ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 )
      *>>>>
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO CPT-GLS-MEN2
               MOVE SCR-PRMT     TO CPT-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO CPT-FLD.
       FIN-GET-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.

       CLR-MSG SECTION.
       INI-CLR-MSG.
           MOVE SPACES TO CPT-GLS-MENS.
       FIN-CLR-MSG.
           EXIT.

       HBL-IKY SECTION.
       INI-HBL-IKY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE CPT-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO CPT-FLD
      * FLB  7-NOV-1994
               PERFORM CLR-KEY-CPT

               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO CPT-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO CPT-GLS-MENS.
           PERFORM PRO-MKY-CPT.
           PERFORM PRO-AKY-CPT.
           PERFORM UNP-IKY-CPT.
           PERFORM FST-KEY-CPT.
       FIN-HBL-IKY.
           EXIT.

       HBL-KEY SECTION.
       INI-HBL-KEY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE CPT-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO CPT-FLD
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO CPT-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO CPT-GLS-MENS.
           PERFORM UNP-KEY-CPT.
           PERFORM FST-KEY-CPT.
       FIN-HBL-KEY.
           EXIT.

       HBL-FLD SECTION.
       INI-HBL-FLD.
           PERFORM PRO-IKY-CPT.
           PERFORM PRO-AKY-CPT.
           PERFORM UNP-MKY-CPT.
           PERFORM UNP-FLD-CPT.
           PERFORM FST-FLD-CPT.
       FIN-HBL-FLD.
           EXIT.

       FST-MSG SECTION.
       INI-FST-MSG.
           MOVE -1 TO CPT-GLS-MENS-LEN.
       FIN-FST-MSG.
           EXIT.

       PRO-ALL SECTION.
       INI-PRO-ALL.
           PERFORM PRO-KEY-CPT.
           PERFORM FST-MSG.
       FIN-PRO-ALL.
           EXIT.

       SCR-TRL SECTION.
       INI-SCR-TRL.
      *PTC-INI
           IF SCR-STAT NOT = SCR-STPP
               MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           IF FRM-MEN1 NOT > SPACES
               MOVE SCR-PRMT TO FRM-MEN1.
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM HBL-FLD
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-CPT
               PERFORM EDT-FLD-CPT
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GFL TO SCR-INST
               PERFORM SCR-EXIT.
           IF SCR-STAT = SCR-STAT-SON
               PERFORM PRO-ALL
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-CPT
               PERFORM EDT-FLD-CPT
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GCS TO SCR-INST
               PERFORM SCR-EXIT.
      *ASUME SCR-STAT-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.
      *    MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-CPT.
           PERFORM EDT-FLD-CPT.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-GAB TO SCR-INST.
           PERFORM SCR-EXIT.
       FIN-SCR-TRL.
           EXIT.

       DESSCRTRL SECTION.
       INI-DESSCRTRL.
           MOVE SCR-VFLD-NOT TO SCR-VFLD.
           MOVE FRM-FFLD TO SCR-FFLD.
       FIN-DESSCRTRL.
           IF SCR-FFLD-PF10 OR SCR-FFLD-PF3
                 MOVE SCR-INST-HCM TO SCR-INST
           ELSE
                 MOVE SCR-INST-HKY TO SCR-INST.
       EXT-DESSCRTRL.
           EXIT.

      * PGM-EBR-ALL SECTION.
      * INI-PGM-EBR-ALL.
      *     MOVE 'GNS' TO FIO-SIST.
      *     MOVE FIO-EBR-ALL TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      * FIN-PGM-EBR-ALL.
      *     EXIT.

       COPY COLBQCPT.
       COPY GNSBVNUM.
       COPY COLBFOPC.
       COPY GNSBFMSG.
       COPY GNSBGSYS.
       COPY GNSBGDTC.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSBGFRM.
       COPY GNSBG3CF.
      *PTC-FIN
       COPY GNSBGMSG.
       COPY GNSBEKEY.
       COPY GNSBIABT.
       COPY GNSBFTAB.
       COPY GNSBVIND.
       COPY GNSBVMSC.
       COPY GNSBFMSC.
       COPY GNSBVIDC.
       COPY GNSBPVRF.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
      *PTC-INI
       COPY GNSBGQUE.
       COPY GNSBGTSK.
      *PTC-FIN

      *>>>>
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      * Modulo Generico de acceso a archivos DATACOM.
       GNS-FIO-DTC SECTION.
       INI-GNS-FIO-DTC.
           MOVE WCC-C00     TO FIO-STAT.
           MOVE SPACES   TO FIO-MENS.
           MOVE SPACES   TO ADR-STAT IN ADR-REQA.
           GO TO FIO-GKEY FIO-GNXT FIO-GFST FIO-GNLS FIO-GGRT FIO-FPUT
                 FIO-FMOD FIO-FDEL FIO-FCHG FIO-INPF FIO-OUTF FIO-UPDF
                 FIO-CLOF          FIO-FEQL FIO-FFST FIO-FNLS FIO-FGRT
                 FIO-UREC FIO-UALL FIO-FVID FIO-FACC FIO-RLOC FIO-FFNF
                 FIO-RCLN FIO-EXTF FIO-GKEY FIO-GFST FIO-GNLS FIO-GGRT
                 FIO-FEQL FIO-FFST FIO-FNLS FIO-FGRT FIO-GNXT FIO-GKUP
                 FIO-GKUP FIO-EBRW FIO-BKOU FIO-GLEQ FIO-GPRV FIO-CPNT
                 FIO-BRFH FIO-EBRW
           DEPENDING ON FIO-CMND.
       FIO-FNSF.
           MOVE WCC-ABORTO TO FIO-MEN1.
           MOVE FIO-CMND                     TO FIO-MENS-CMD.
           MOVE WCC-C99 TO FIO-STAT.
           GO TO FIN-GNS-FIO-DTC.
       FIO-GKEY.
           MOVE WCC-REDKY TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-GNXT.
           MOVE WCC-REDNX TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-GFST.
           MOVE LOW-VALUES TO ADR-VKEY IN ADR-REQA.
           MOVE WCC-LOCKY TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           IF NOT ADR-STAT-OKS IN ADR-REQA
               GO TO SET-STAT.
           MOVE WCC-REDKY TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-GNLS.
           MOVE WCC-REDKG TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-GGRT.
           MOVE WCC-ABORTO1 TO FIO-MEN1.
           MOVE WCC-C99 TO FIO-STAT.
           GO TO FIN-GNS-FIO-DTC.
       FIO-FPUT.
           MOVE WCC-ADDIT TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-FMOD.
           MOVE WCC-UPDAT TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-FDEL.
           MOVE WCC-DELET TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-FCHG.
           MOVE WCC-ABORTO2 TO FIO-MEN1.
           MOVE WCC-C99 TO FIO-STAT.
           GO TO FIN-GNS-FIO-DTC.
       FIO-INPF.
           MOVE WCC-ABORTO3 TO FIO-MEN1.
           GO TO FIN-GNS-FIO-DTC.
       FIO-OUTF.
           MOVE WCC-ABORTO4 TO FIO-MEN1.
           GO TO FIN-GNS-FIO-DTC.
       FIO-UPDF.
           MOVE WCC-ABORTO5 TO FIO-MEN1.
           GO TO FIN-GNS-FIO-DTC.
       FIO-CLOF.
           MOVE WCC-ABORTO6 TO FIO-MEN1.
           GO TO FIN-GNS-FIO-DTC.
       FIO-FEQL.
           MOVE WCC-LOCKX TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-FFST.
           MOVE LOW-VALUES TO ADR-VKEY IN ADR-REQA.
           MOVE WCC-LOCKY TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-FNLS.
           MOVE WCC-LOCKY TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-FGRT.
           MOVE WCC-ABORTO7 TO FIO-MEN1.
           MOVE WCC-C99 TO FIO-STAT.
           GO TO FIN-GNS-FIO-DTC.
       FIO-UREC.
           MOVE WCC-RELES TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-UALL.
           MOVE WCC-ABORTO8 TO FIO-MEN1.
           MOVE WCC-C99 TO FIO-STAT.
           GO TO FIN-GNS-FIO-DTC.
       FIO-FVID.
           MOVE WCC-ABORTO9 TO FIO-MEN1.
           MOVE WCC-C99 TO FIO-STAT.
           GO TO FIN-GNS-FIO-DTC.
       FIO-FACC.
           MOVE WCC-ABORTO10 TO FIO-MEN1.
           GO TO FIN-GNS-FIO-DTC.
       FIO-RLOC.
           MOVE WCC-ABORTO11 TO FIO-MEN1.
           MOVE WCC-C99 TO FIO-STAT.
           GO TO FIN-GNS-FIO-DTC.
       FIO-FFNF.
           MOVE WCC-ABORTO12 TO FIO-MEN1.
           MOVE WCC-C99 TO FIO-STAT.
           GO TO FIN-GNS-FIO-DTC.
       FIO-RCLN.
           MOVE WCC-ABORTO13 TO FIO-MEN1.
           MOVE WCC-C99 TO FIO-STAT.
           GO TO FIN-GNS-FIO-DTC.
       FIO-EXTF.
           MOVE WCC-ABORTO14 TO FIO-MEN1.
           GO TO FIN-GNS-FIO-DTC.
       FIO-GKUP.
           MOVE WCC-RDUKY TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-EBRW.
           MOVE WCC-ABORTO15 TO FIO-MEN1.
           GO TO FIN-GNS-FIO-DTC.
       FIO-BKOU.
           MOVE WCC-LOGTB TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-GLEQ.
           MOVE WCC-REDKL TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-GPRV.
           MOVE WCC-REDBR TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-CPNT.
           MOVE WCC-LOGCP TO ADR-CMND IN ADR-REQA.
           CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS.
           GO TO SET-STAT.
       FIO-BRFH.
           MOVE WCC-ABORTO16 TO FIO-MEN1.
           GO TO FIN-GNS-FIO-DTC.
       SET-STAT.
           IF ADR-SSTT IN ADR-REQA NOT > SPACES
               MOVE SPACES TO ADR-SSTT IN ADR-REQA.
           IF NOT ADR-STAT-OKS IN ADR-REQA
               MOVE WCC-STATUS       TO FIO-MENS-DSC
               MOVE ADR-STAT IN ADR-REQA TO FIO-MENS-STT
               MOVE ADR-SSTT IN ADR-REQA TO FIO-MENS-SST
               MOVE WCC-KEY              TO FIO-MENS-GKY
               MOVE ADR-DKEY IN ADR-REQA TO FIO-MENS-KDT
               MOVE WCC-BASEDATO         TO FIO-MENS-GBD
               MOVE ADR-DBID IN ADR-REQA TO FIO-MENS-DBI
               MOVE WCC-CMD              TO FIO-MENS-GCM
               MOVE ADR-CMND IN ADR-REQA TO FIO-MENS-CMD
               MOVE WCC-FILE             TO FIO-MENS-GFL.
           IF ADR-STAT-OKS IN ADR-REQA
               MOVE WCC-C00 TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = WCC-C10
               MOVE WCC-C22 TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = WCC-C11
               MOVE WCC-C23 TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = WCC-C12
               MOVE WCC-C43 TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = WCC-C14
               MOVE WCC-C23 TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = WCC-C16
               MOVE WCC-LOGTB TO ADR-CMND IN ADR-REQA
               CALL 'DBNTRY' USING ADR-UIFB ADR-REQA FIO-DFLD ADR-ELLS
               MOVE WCC-C47 TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = WCC-C18
               MOVE WCC-C44 TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = WCC-C19 OR WCC-C29
               MOVE WCC-C10 TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = WCC-C92
               MOVE WCC-C45 TO FIO-STAT
           ELSE
           IF ADR-STAT IN ADR-REQA = WCC-C93
               MOVE WCC-C46 TO FIO-STAT
           ELSE
               MOVE WCC-ABORTO17       TO FIO-MENS-DSC
               MOVE WCC-C99 TO FIO-STAT.
       FIN-SET-STAT.
       FIN-GNS-FIO-DTC.
           EXIT.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35
      * COPY GNSBGFRM.
       COPY GNSBG3CF.
      *PTC-FIN
       COPY GNSBGMSG.
       COPY GNSBEKEY.
       COPY GNSBIABT.
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *COPY GNSBFTAB.

       COPY GNSBFTAB REPLACING GNS-FIO-TAB BY JNS-FIO-TAB.
       GNS-FIO-TAB SECTION.
       INI-GNS-FIO-TAB.

           IF FIO-CMND = FIO-GET-NLS OR
                         FIO-GET-NXT OR
              FIO-AKEY > SPACES
               PERFORM JNS-FIO-TAB
               GO TO FIN-GNS-FIO-TAB.

           IF FIO-SIST = WCC-COL
               PERFORM BUS-TAB-COL
               GO TO FIN-GNS-FIO-TAB.

           IF FIO-SIST = WCC-TAB
               PERFORM BUS-TAB-TAB
               GO TO FIN-GNS-FIO-TAB.

           PERFORM BUS-TAB-OTRO.

       FIN-GNS-FIO-TAB.
           EXIT.
      *--------------------------------------------------------------
       BUS-TAB-OTRO SECTION.
       INI-BUS-TAB-OTRO.
           MOVE WCC-1 TO WSS-IND-OTRO.
       LOOP-TAB-OTRO.
           IF WSS-IND-OTRO > WCC-N100
               PERFORM JNS-FIO-TAB
               GO TO FIN-BUS-TAB-OTRO.

           IF OTRO-COD-TABL(WSS-IND-OTRO) NOT > SPACES
               MOVE TAB-COD-TABL IN TAB TO OTRO-COD-TABL(WSS-IND-OTRO)
               PERFORM JNS-FIO-TAB
               MOVE FIO-STAT TO OTRO-FIO-STAT(WSS-IND-OTRO)
               MOVE TAB TO OTRO-GLS-TABL(WSS-IND-OTRO)
               GO TO FIN-BUS-TAB-OTRO.

           IF OTRO-COD-TABL(WSS-IND-OTRO) = TAB-COD-TABL IN TAB
               MOVE OTRO-GLS-TABL(WSS-IND-OTRO) TO TAB
               MOVE OTRO-FIO-STAT(WSS-IND-OTRO) TO FIO-STAT
               MOVE SPACES   TO FIO-AKEY
               GO TO FIN-BUS-TAB-OTRO.

           ADD WCC-1 TO WSS-IND-OTRO.
           GO TO LOOP-TAB-OTRO.

       FIN-BUS-TAB-OTRO.
           EXIT.
      *---------------------------------------------------------------
       BUS-TAB-COL SECTION.
       INI-BUS-TAB-COL.
           MOVE WCC-1 TO WSS-IND-DES.
       LOOP-TAB-COL.
           IF WSS-IND-DES > WCC-N100
               PERFORM JNS-FIO-TAB
               GO TO FIN-BUS-TAB-COL.

           IF DES-COD-TABL(WSS-IND-DES) NOT > SPACES
               MOVE TAB-COD-TABL IN TAB TO DES-COD-TABL(WSS-IND-DES)
               PERFORM JNS-FIO-TAB
               MOVE FIO-STAT TO DES-FIO-STAT(WSS-IND-DES)
               MOVE TAB TO DES-GLS-TABL(WSS-IND-DES)
               GO TO FIN-BUS-TAB-COL.

           IF DES-COD-TABL(WSS-IND-DES) = TAB-COD-TABL IN TAB
               MOVE DES-GLS-TABL(WSS-IND-DES) TO TAB
               MOVE DES-FIO-STAT(WSS-IND-DES) TO FIO-STAT
               MOVE SPACES   TO FIO-AKEY
               GO TO FIN-BUS-TAB-COL.

           ADD WCC-1 TO WSS-IND-DES.
           GO TO LOOP-TAB-COL.

       FIN-BUS-TAB-COL.
           EXIT.
      *---------------------------------------------------------------
       BUS-TAB-TAB SECTION.
       INI-BUS-TAB-TAB.
           MOVE WCC-1 TO WSS-IND-AUX.
       LOOP-TAB-TAB.
           IF WSS-IND-AUX > WCC-N100
               PERFORM JNS-FIO-TAB
               GO TO FIN-BUS-TAB-TAB.

           IF AUX-COD-TABL(WSS-IND-AUX) NOT > SPACES
               MOVE TAB-COD-TABL IN TAB TO AUX-COD-TABL(WSS-IND-AUX)
               PERFORM JNS-FIO-TAB
               MOVE FIO-STAT TO AUX-FIO-STAT(WSS-IND-AUX)
               MOVE TAB TO AUX-GLS-TABL(WSS-IND-AUX)
               GO TO FIN-BUS-TAB-TAB.

           IF AUX-COD-TABL(WSS-IND-AUX) = TAB-COD-TABL IN TAB
               MOVE AUX-GLS-TABL(WSS-IND-AUX) TO TAB
               MOVE AUX-FIO-STAT(WSS-IND-AUX) TO FIO-STAT
               MOVE SPACES   TO FIO-AKEY
               GO TO FIN-BUS-TAB-TAB.

           ADD WCC-1 TO WSS-IND-AUX.
           GO TO LOOP-TAB-TAB.

       FIN-BUS-TAB-TAB.
           EXIT.
      *--------------------------------------------------------------
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
       COPY GNSBVIND.
       COPY GNSBVMSC.
       COPY GNSBFMSC.
       COPY GNSBVIDC.
       COPY GNSBPVRF.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
      *PTC-INI
       COPY GNSBGQUE.
       COPY GNSBGTSK.
      *PTC-FIN

      *>>>>
      *<<<< EOF

       COPY GNSBPFEC.

       COPY SGCBFDBC.
       COPY COLBFDLC.
       COPY COLBFRDC.
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *COPY COLBFICG.
       COPY COLBFICG REPLACING COL-FIO-ICG BY KOL-FIO-ICG.
       COL-FIO-ICG SECTION.
       INI-COL-FIO-ICG.
      *SE DEJARAN EN EL VECTOR SOLO AQUELLOS REGISTROS CON
      * ICG-IND-TTAS IN ICG = 'INT'

           IF ICG-IND-TTAS IN ICG NOT = WCC-INT
               PERFORM KOL-FIO-ICG
               GO TO FIN-COL-FIO-ICG.

           MOVE WCC-1 TO WSS-IND-ICG IN WSS-VARI.
           IF FIO-CMND = FIO-GET-NXT
               ADD WCC-1 TO ICG-NUM-ICAN IN ICG.

       LOOP-TAB-ICG.
            IF WSS-IND-ICG > WCC-N100
                MOVE FIO-GET-NLS TO FIO-CMND
                PERFORM KOL-FIO-ICG
                GO TO FIN-COL-FIO-ICG.

            IF BASE-KEY-IICG(WSS-IND-ICG) NOT > SPACES
                MOVE ICG-KEY-IICG IN ICG TO BASE-KEY-IICG(WSS-IND-ICG)
                MOVE FIO-GET-NLS TO FIO-CMND
                PERFORM KOL-FIO-ICG
                MOVE FIO-STAT TO BASE-FIO-STAT(WSS-IND-ICG)
                MOVE ICG TO BASE-GLS-TABL(WSS-IND-ICG)
                GO TO FIN-COL-FIO-ICG.

           IF BASE-KEY-IICG(WSS-IND-ICG) = ICG-KEY-IICG IN ICG
               MOVE BASE-GLS-TABL(WSS-IND-ICG) TO ICG
               MOVE BASE-FIO-STAT(WSS-IND-ICG) TO FIO-STAT
               MOVE SPACES   TO FIO-AKEY
               GO TO FIN-COL-FIO-ICG.

            ADD WCC-1 TO WSS-IND-ICG.
            GO TO LOOP-TAB-ICG.

       FIN-COL-FIO-ICG.
           EXIT.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
       COPY COLBFCAN.
      * POR MORA
       COPY SGCBFOPE.
       COPY TABBFOFI.
       COPY COLBFTMC.
       COPY COLBFIXT.
      *AFRI-INI 23-ENE-2013 CAMBIO DECIMALES ITE
      *COPY COLBFIMP.
      *AFRI-FIN 23-ENE-2013 CAMBIO DECIMALES ITE
       COPY COLBFCOM.
       COPY GNSBFCIC.
       COPY SGCBFRCO.

       PUT-TAB SECTION.
       INI-PUT-TAB.
           MOVE CPT-NOM-TSCPT TO QUE-COLA.
           MOVE CPT-LEN-TSCPT TO QUE-LITM.
           MOVE QUE-DEL       TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           MOVE 1 TO SCR-NUM-PANT.

           MOVE LOW-VALUES TO WSS-FEC-FPAG-IDX-MTI.
           MOVE LOW-VALUES TO WSS-FEC-FPAG-IDX-FRM.
      *
           MOVE 1 TO FRM-IFLD.
           MOVE ZEROES  TO WSS-NITMCPT IN WSS-VARICPT.

           MOVE 1 TO WSS-FCPT IN WSS-VARICPT.
       LUP-PUT-TAB.
           IF WSS-FCPT IN WSS-VARICPT > WSS-FMAXCPT IN WSS-VARICPT
              GO TO FIN-PUT-TAB.
           IF WSS-FEC-FPAG-V(WSS-FCPT) > SPACES
              PERFORM PUT-TAB-CPT
              PERFORM PUT-CPT-QUE
              PERFORM SET-FRM-IFLD
           ELSE
           IF FRM-IFLD = 1 AND WSS-FCPT = 1
      *REVISAR RGD
      *        MOVE 'DEU' TO MSG-COD-SIST
      *        MOVE 'CLF    NEX' TO MSG-COD-MENS
      *        PERFORM GET-MSG
      *        MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE '00' TO FIO-STAT
              MOVE 'S' TO SCR-IERR
              GO TO FIN-PUT-TAB
           ELSE
              MOVE '00' TO FIO-STAT
              GO TO FIN-PUT-TAB.

           ADD 1 TO WSS-FCPT IN WSS-VARICPT.
           GO TO LUP-PUT-TAB.
       FIN-PUT-TAB.
           MOVE 1                  TO QUE-NITM.
           MOVE CPT-LEN-TSCPT-MAS  TO QUE-LITM.
           MOVE CPT-TSCPT-MAS      TO QUE-COLA.

           IF WSS-NITMCPT > CPT-TOT-OCC-CPT
              MOVE 'S'           TO CPT-MAS-IND-HMAS
           ELSE
              MOVE 'N'           TO CPT-MAS-IND-HMAS.

           MOVE WSS-NITMCPT         TO WSS-NUM-ICUR.
           MOVE WSS-NUM-ICUR     TO WSS-NUM-ICUR-EDT.
           MOVE WSS-NUM-ICUR-EDT TO WSS-NUM-ICUR-ALF.
           MOVE WSS-NUM-ICUR-ALF TO CPT-MAS-NUM-TOCC.
           MOVE CPT-MAS-ITEM     TO QUE-ITEM.
           MOVE QUE-PUT          TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           IF WSS-NITMCPT > WSS-IMAXCPT
               MOVE 'DEU' TO MSG-COD-SIST
               MOVE 'CPTOPCDMAS' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.
       EXT-PUT-TAB.
           EXIT.

       VALIDA-ROVOPC-RELAC SECTION.
       INI-VALIDA-ROVOPC-RELAC.
           MOVE SPACES              TO ROV.
           MOVE OPC-CIC-IOPC IN OPC TO ROV-CIC-IOPC IN ROV.
           MOVE OPC-CIC-IOPC IN OPC TO WSS-CIC-CPTIOPC.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF NOT ( FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = ROV-CIC-IOPC IN ROV AND
              ROV-NUM-IVCT IN ROV = CAN-NUM-ICAN IN CAN )
      * ESTAMOS OK. NO HAY OPERACION RELACIONADA CON OPC ORIGINAL
                 GO TO FIN-VALIDA-ROVOPC-RELAC.

           MOVE SPACES              TO OPC.
           MOVE ROV-CIC-IOPV IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE 'ROVNOEXIS' TO MSG-COD-MENS
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS


              GO TO FIN-VALIDA-ROVOPC-RELAC.

           IF OPC-VAL-SCRE IN OPC > ZEROES
               MOVE 'ROVEXISAL'  TO MSG-COD-MENS
               MOVE 'COL'        TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-VALIDA-ROVOPC-RELAC.

           MOVE SPACES          TO OPC.
           MOVE WSS-CIC-CPTIOPC    TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY     TO FIO-CMND.
           PERFORM COL-FIO-OPC.

       FIN-VALIDA-ROVOPC-RELAC.
           EXIT.

       SET-FRM-IFLD SECTION.
       INI-SET-FRM-IFLD.
           IF SCR-OFRM-SRV
                MOVE 1 TO FRM-IFLD
           ELSE
                ADD 1 TO FRM-IFLD.
       FIN-SET-FRM-IFLD.
           EXIT.
      *--------------------------------------------
       SCRL-TAB-CPT SECTION.
       INI-SCRL-TAB-CPT.
           MOVE SPACES TO MSG-COD-MENS.

           IF FRM-FFLD = FRM-FFLD-PF6
               PERFORM PUT-TAB-ASC
           ELSE
               PERFORM PUT-TAB-DSC.
           IF MSG-COD-MENS > SPACES
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.
       FIN-SCRL-TAB-CPT.
           EXIT.

      *----------------------------------------------------
       PUT-TAB-CPT SECTION.
       INI-PUT-TAB-CPT.
           PERFORM CLR-WSS.

           MOVE WSS-FEC-FPAG-V(WSS-FCPT) TO WSS-FEC-FPAG-MTI.
           MOVE WSS-VAL-CAPR-V(WSS-FCPT) TO WSS-VAL-CAPR-MTI.
           MOVE WSS-VAL-INTE-V(WSS-FCPT) TO WSS-VAL-INTE-MTI.
           MOVE WSS-VAL-COPR-V(WSS-FCPT) TO WSS-VAL-COPR-MTI.
           MOVE WSS-VAL-CAAD-V(WSS-FCPT) TO WSS-VAL-CAAD-MTI.
     *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
           MOVE WSS-VAL-MDPS-V(WSS-FCPT) TO WSS-VAL-MDPS-MTI.
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
           MOVE WSS-VAL-REAJ-V(WSS-FCPT) TO WSS-VAL-REAJ-MTI.
           MOVE WSS-VAL-CAMO-V(WSS-FCPT) TO WSS-VAL-CAMO-MTI.
           MOVE WSS-VAL-COFG-V(WSS-FCPT) TO WSS-VAL-COFG-MTI.
           MOVE WSS-VAL-TPAG-V(WSS-FCPT) TO WSS-VAL-TPAG-MTI.

           MOVE WSS-FEC-FPAG-MTI TO WSS-FEC-FPAG-FRM.
           MOVE WSS-VAL-CAPR-MTI TO WSS-VAL-CAPR-FRM.
           MOVE WSS-VAL-INTE-MTI TO WSS-VAL-INTE-FRM.
           MOVE WSS-VAL-COPR-MTI TO WSS-VAL-COPR-FRM.
           MOVE WSS-VAL-CAAD-MTI TO WSS-VAL-CAAD-FRM.
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
           MOVE WSS-VAL-MDPS-MTI TO WSS-VAL-MDPS-FRM.
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
           MOVE WSS-VAL-REAJ-MTI TO WSS-VAL-REAJ-FRM.
           MOVE WSS-VAL-CAMO-MTI TO WSS-VAL-CAMO-FRM.
           MOVE WSS-VAL-COFG-MTI TO WSS-VAL-COFG-FRM.
           MOVE WSS-VAL-TPAG-MTI TO WSS-VAL-TPAG-FRM.

           IF FRM-IFLD > WSS-IMAXCPT
              GO TO FIN-PUT-TAB-CPT.

           MOVE WSS-FEC-FPAG-MTI TO FRM-FEC-FPAG IN CPT-FLD(FRM-IFLD).
           MOVE WSS-VAL-CAPR-MTI TO FRM-VAL-CAPR IN CPT-FLD(FRM-IFLD).
           MOVE WSS-VAL-INTE-MTI TO FRM-VAL-INTE IN CPT-FLD(FRM-IFLD).
           MOVE WSS-VAL-COPR-MTI TO FRM-VAL-COPR IN CPT-FLD(FRM-IFLD).
           MOVE WSS-VAL-CAAD-MTI TO FRM-VAL-CAAD IN CPT-FLD(FRM-IFLD).
     *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
           MOVE WSS-VAL-MDPS-MTI TO FRM-VAL-MDPS IN CPT-FLD(FRM-IFLD).
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS     
           MOVE WSS-VAL-REAJ-MTI TO FRM-VAL-REAJ IN CPT-FLD(FRM-IFLD).
           MOVE WSS-VAL-CAMO-MTI TO FRM-VAL-CAMO IN CPT-FLD(FRM-IFLD).
           MOVE WSS-VAL-COFG-MTI TO FRM-VAL-COFG IN CPT-FLD(FRM-IFLD).
           MOVE WSS-VAL-TPAG-MTI TO FRM-VAL-TPAG IN CPT-FLD(FRM-IFLD).

       FIN-PUT-TAB-CPT.
           EXIT.
      *----------------------------------------------------
       PUT-CPT-QUE SECTION.
       INI-PUT-CPT-QUE.
           ADD 1 TO WSS-NITMCPT.
           MOVE CPT-NOM-TSCPT    TO QUE-COLA.
           MOVE CPT-LEN-TSCPT    TO QUE-LITM.
           MOVE WSS-NITMCPT         TO QUE-NITM.
           MOVE SPACES           TO QUE-ITEM.
           IF SCR-OFRM-SRV
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
               MOVE WSS-VAL-CAPR-MTI TO FRM-VAL-CAPR-EDT IN CPT-EDT
               MOVE WSS-VAL-INTE-MTI TO FRM-VAL-INTE-EDT IN CPT-EDT
               MOVE WSS-VAL-COPR-MTI TO FRM-VAL-COPR-EDT IN CPT-EDT
               MOVE WSS-VAL-CAAD-MTI TO FRM-VAL-CAAD-EDT IN CPT-EDT
               MOVE WSS-VAL-MDPS-MTI TO FRM-VAL-MDPS-EDT IN CPT-EDT
               MOVE WSS-VAL-REAJ-MTI TO FRM-VAL-REAJ-EDT IN CPT-EDT
               MOVE WSS-VAL-CAMO-MTI TO FRM-VAL-CAMO-EDT IN CPT-EDT
               MOVE WSS-VAL-COFG-MTI TO FRM-VAL-COFG-EDT IN CPT-EDT
               MOVE WSS-VAL-TPAG-MTI TO FRM-VAL-TPAG-EDT IN CPT-EDT

               MOVE FRM-VAL-CAPR-EDT IN CPT-EDT TO WSS-VAL-CAPR-MTI-ALF
               MOVE FRM-VAL-INTE-EDT IN CPT-EDT TO WSS-VAL-INTE-MTI-ALF
               MOVE FRM-VAL-COPR-EDT IN CPT-EDT TO WSS-VAL-COPR-MTI-ALF
               MOVE FRM-VAL-CAAD-EDT IN CPT-EDT TO WSS-VAL-CAAD-MTI-ALF
               MOVE FRM-VAL-MDPS-EDT IN CPT-EDT TO WSS-VAL-MDPS-MTI-ALF
               MOVE FRM-VAL-REAJ-EDT IN CPT-EDT TO WSS-VAL-REAJ-MTI-ALF
               MOVE FRM-VAL-CAMO-EDT IN CPT-EDT TO WSS-VAL-CAMO-MTI-ALF
               MOVE FRM-VAL-COFG-EDT IN CPT-EDT TO WSS-VAL-COFG-MTI-ALF
               MOVE FRM-VAL-TPAG-EDT IN CPT-EDT TO WSS-VAL-TPAG-MTI-ALF
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
               MOVE WSS-FEC-FPAG-IDX-MTI TO QUE-ITEM
           ELSE
               MOVE WSS-FEC-FPAG-IDX-FRM TO QUE-ITEM.
           MOVE QUE-PUT  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
       FIN-PUT-CPT-QUE.
           EXIT.
      *----------------------------------------------------

       PUT-TAB-ASC SECTION.
       INI-PUT-TAB-ASC.
           MOVE SPACES TO MSG-COD-MENS.
           MULTIPLY SCR-NUM-PANT BY WSS-IMAXCPT GIVING QUE-NITM.
           MOVE 0 TO FRM-IFLD.
       LUP-PUT-TAB-ASC.
           ADD 1              TO QUE-NITM.
           MOVE CPT-NOM-TSCPT TO QUE-COLA.
           MOVE CPT-LEN-TSCPT TO QUE-LITM.
           MOVE QUE-GET       TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
                   GO TO FIN-PUT-TAB-ASC.
           ADD 1 TO FRM-IFLD.
           MOVE QUE-ITEM TO FRM-FEC-FPAG-IDX(FRM-IFLD).
      *    PERFORM EDT-VAL-CPT.
           IF FRM-IFLD < WSS-IMAXCPT
               GO TO LUP-PUT-TAB-ASC.
       FIN-PUT-TAB-ASC.
           IF FRM-IFLD > 0 AND FRM-IFLD < WSS-IMAXCPT
               ADD 1 FRM-IFLD GIVING WSS-ICPT
               PERFORM CLR-FRM VARYING WSS-ICPT FROM WSS-ICPT BY 1
                                 UNTIL WSS-ICPT > WSS-IMAXCPT.
           IF FRM-IFLD > 0
               ADD 1 TO SCR-NUM-PANT.
           IF FRM-IFLD = WSS-IMAXCPT
               ADD 1              TO QUE-NITM
               MOVE CPT-NOM-TSCPT TO QUE-COLA
               MOVE CPT-LEN-TSCPT TO QUE-LITM
               MOVE QUE-GET       TO QUE-CMND
               PERFORM GNS-PRO-QUE
               IF QUE-STAT = QUE-STAT-OKS
                  MOVE 'COL'        TO MSG-COD-SIST
                  MOVE 'CPTOPCDMAS' TO MSG-COD-MENS.

       EXT-PUT-TAB-ASC.
           EXIT.

       PUT-TAB-DSC SECTION.
       INI-PUT-TAB-DSC.
           MOVE SPACES TO MSG-COD-MENS.
           IF SCR-NUM-PANT = 1
      *        MOVE 'CPTOPCNOPRV' TO MSG-COD-MENS
               GO TO EXT-PUT-TAB-DSC.

           SUBTRACT 1 FROM SCR-NUM-PANT GIVING QUE-NITM.
           MULTIPLY QUE-NITM BY WSS-IMAXCPT GIVING QUE-NITM.
           ADD 1 TO QUE-NITM.
           ADD 1 WSS-IMAXCPT GIVING FRM-IFLD.
       LUP-PUT-TAB-DSC.
           SUBTRACT  1 FROM QUE-NITM.
           MOVE CPT-NOM-TSCPT TO QUE-COLA
           MOVE CPT-LEN-TSCPT TO QUE-LITM
           MOVE QUE-GET       TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
                   GO TO FIN-PUT-TAB-DSC.
           SUBTRACT 1 FROM FRM-IFLD.
           MOVE QUE-ITEM TO FRM-FEC-FPAG-IDX(FRM-IFLD).
      *    PERFORM EDT-VAL-CPT.
           IF FRM-IFLD > 1
               GO TO LUP-PUT-TAB-DSC.
       FIN-PUT-TAB-DSC.

           IF FRM-IFLD NOT > WSS-IMAXCPT AND FRM-IFLD > 1
               SUBTRACT 1 FROM FRM-IFLD GIVING WSS-ICPT
               PERFORM CLR-FRM VARYING WSS-ICPT FROM WSS-ICPT BY -1
                                 UNTIL WSS-ICPT < 1.

           IF FRM-IFLD NOT > WSS-IMAXCPT
               SUBTRACT 1 FROM SCR-NUM-PANT
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'CPTOPCDMAS' TO MSG-COD-MENS.
       EXT-PUT-TAB-DSC.
           EXIT.

      *------------------------------------------------------
       COPY SGCBGCLI.

       COPY GNSBGCPT.
       COPY GNSBGSTR.
       COPY GNSBBTAB.
       COPY GNSBBMSC.

       CLR-FRM SECTION.
       INI-CLR-FRM.
           MOVE ZEROES TO FRM-FEC-FPAG IN CPT-FLD(WSS-ICPT).
           MOVE ZEROES TO FRM-VAL-CAPR IN CPT-FLD(WSS-ICPT).
           MOVE ZEROES TO FRM-VAL-INTE IN CPT-FLD(WSS-ICPT).
           MOVE ZEROES TO FRM-VAL-COPR IN CPT-FLD(WSS-ICPT).
           MOVE ZEROES TO FRM-VAL-CAAD IN CPT-FLD(WSS-ICPT).
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
           MOVE ZEROES TO FRM-VAL-MDPS IN CPT-FLD(WSS-ICPT).
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
           MOVE ZEROES TO FRM-VAL-REAJ IN CPT-FLD(WSS-ICPT).
           MOVE ZEROES TO FRM-VAL-CAMO IN CPT-FLD(WSS-ICPT).
           MOVE ZEROES TO FRM-VAL-COFG IN CPT-FLD(WSS-ICPT).
           MOVE ZEROES TO FRM-VAL-TPAG IN CPT-FLD(WSS-ICPT).
       FIN-CLR-FRM.
           EXIT.

       CLR-WSS SECTION.
       INI-CLR-WSS.
           MOVE ZEROES TO WSS-FEC-FPAG-FRM.
           MOVE ZEROES TO WSS-VAL-CAPR-FRM.
           MOVE ZEROES TO WSS-VAL-INTE-FRM.
           MOVE ZEROES TO WSS-VAL-COPR-FRM.
           MOVE ZEROES TO WSS-VAL-CAAD-FRM.
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
           MOVE ZEROES TO WSS-VAL-MDPS-FRM.
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
           MOVE ZEROES TO WSS-VAL-REAJ-FRM.
           MOVE ZEROES TO WSS-VAL-CAMO-FRM.
           MOVE ZEROES TO WSS-VAL-COFG-FRM.
           MOVE ZEROES TO WSS-VAL-TPAG-FRM.

           IF SCR-OFRM-SRV
               PERFORM CLR-FRM-MTX.
       FIN-CLR-WSS.
           EXIT.

       CLR-FRM-MTX SECTION.
       INI-CLR-FRM-MTX.
           MOVE ZEROES TO FRM-FEC-FPAG IN CPT-FLD(1).
           MOVE ZEROES TO FRM-VAL-CAPR IN CPT-FLD(1).
           MOVE ZEROES TO FRM-VAL-INTE IN CPT-FLD(1).
           MOVE ZEROES TO FRM-VAL-COPR IN CPT-FLD(1).
           MOVE ZEROES TO FRM-VAL-CAAD IN CPT-FLD(1).
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
           MOVE ZEROES TO FRM-VAL-MDPS IN CPT-FLD(1).
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
           MOVE ZEROES TO FRM-VAL-REAJ IN CPT-FLD(1).
           MOVE ZEROES TO FRM-VAL-CAMO IN CPT-FLD(1).
           MOVE ZEROES TO FRM-VAL-COFG IN CPT-FLD(1).
           MOVE ZEROES TO FRM-VAL-TPAG IN CPT-FLD(1).

       FIN-CLR-FRM-MTX.
           EXIT.

       CRG-VEC-CPT SECTION.
       INI-CRG-VEC-CPT.
      * AQUI DEBO CARGAR LOS DATOS DE LOS PREPAGOS CALCULADOS
           MOVE BKP-VAL-SCRE TO OPC-VAL-SCRE IN OPC.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE ZEROES TO WSS-VAL-CPTCAMO
                          WSS-VAL-CPTINT
                          WSS-VAL-CPTFGP.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           PERFORM BUSCO-DIA-HABIL.
           ADD 1 TO WSS-JCPT.
      *AFRI-INI MAYO-2012 CERTIFICADO PREPAGO
           IF WSS-JCPT > 10 AND
              WSS-MES-INFO IN WSS-VARI < WSS-NUM-MCPTPAG
               COMPUTE WSS-JCPT = WSS-JMAXCPT + 1.
      *AFRI-FIN MAYO-2012 CERTIFICADO PREPAGO
           IF WSS-JCPT IN WSS-VARICPT > WSS-JMAXCPT IN WSS-VARICPT
               GO TO FIN-CRG-VEC-CPT.
           PERFORM CLR-CPT-VEC.
      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
      *SE VALIDA EL INGRESO DE UN PREPAGO PARCIAL
           IF FRM-VAL-PREP IN CPT-FLD > ZEROES
               PERFORM CAL-PRE-PARC
               GO TO FIN-CRG-VEC-CPT.
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL

** 1 **  SE CARGA LA FECHA DE PREPAGO DEL CERTIFICADO
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE FEC-FECH    TO WSS-FEC-CPTPAG WSS-FEC-FPAG-V(WSS-JCPT).
           MOVE FEC-FECH TO WSS-FEC-CPTPAG.

           MOVE WSS-NUM-DCPTPAG TO WSS-NUM-DCPTPAG-R.
           MOVE WSS-NUM-MCPTPAG TO WSS-NUM-MCPTPAG-R.
           MOVE WSS-NUM-SCPTPAG TO WSS-NUM-SCPTPAG-R.
           MOVE WSS-NUM-ACPTPAG TO WSS-NUM-ACPTPAG-R.
           IF WSS-FEC-CPTPAG-R > DLC-FEC-FMAV IN DLC
               COMPUTE WSS-JCPT = WSS-JMAXCPT + 1
               GO TO FIN-CRG-VEC-CPT.

           MOVE FEC-FECH TO WSS-FEC-FPAG-V(WSS-JCPT).
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

** 1 **  SE RESCATAN LOS VALORES DE CAMBIO PARA FECHAS DE CURSE Y PAGO
           IF OPC-COD-VCOC IN OPC = '0998  '
              MOVE OPC-NUM-DCOL IN OPC TO WSS-NUM-DCPTCAM
              MOVE OPC-NUM-MCOL IN OPC TO WSS-NUM-MCPTCAM
              MOVE OPC-NUM-SCOL IN OPC TO WSS-NUM-SCPTCAM
              MOVE OPC-NUM-ACOL IN OPC TO WSS-NUM-ACPTCAM
              PERFORM OBT-VCAM-FHOY
              MOVE WSS-CAM-SGV-UF      TO WSS-VAL-CPTCRS
           ELSE
              MOVE 1                   TO WSS-VAL-CPTCRS.
      *
           MOVE WSS-NUM-DCPTPAG TO WSS-NUM-DCPTPAG-R.
           MOVE WSS-NUM-MCPTPAG TO WSS-NUM-MCPTPAG-R.
           MOVE WSS-NUM-SCPTPAG TO WSS-NUM-SCPTPAG-R.
           MOVE WSS-NUM-ACPTPAG TO WSS-NUM-ACPTPAG-R.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE WSS-NUM-DCPTPAG         TO WSS-NUM-DCPTCAM.
           MOVE WSS-NUM-MCPTPAG         TO WSS-NUM-MCPTCAM.
           MOVE WSS-NUM-SCPTPAG         TO WSS-NUM-SCPTCAM.
           MOVE WSS-NUM-ACPTPAG         TO WSS-NUM-ACPTCAM.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           IF OPC-COD-VCOC IN OPC = '0998  '
              MOVE WSS-NUM-DCPTPAG         TO WSS-NUM-DCPTCAM
              MOVE WSS-NUM-MCPTPAG         TO WSS-NUM-MCPTCAM
              MOVE WSS-NUM-SCPTPAG         TO WSS-NUM-SCPTCAM
              MOVE WSS-NUM-ACPTPAG         TO WSS-NUM-ACPTCAM
              PERFORM OBT-VCAM-FHOY
      * VALIDO SI ENCONTRO UF PARA DIA DE CALCULO
      * SI NO ENCUENTRA SE DEBE USAR ULTIMO VALOR CONOCIDO E INFORMAR
              IF ( NOT FIO-STAT-OKS              ) OR
                 ( CAM-MSC-STAT IN CAM NOT = 'S' )
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *          MOVE WSS-VAL-CPTPGOA TO WSS-VAL-CPTPGO
                 PERFORM BUS-FEC-ANTC
                 MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-CPTPGO
                 MOVE WSS-FEC-CPTFCAM TO WSS-FEC-CPTFCAA
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
                 MOVE WSS-FEC-CPTFCAA TO WSS-FEC-CPTFCAM
                 MOVE 'NO'            TO WSS-GLS-NOUF
              ELSE
                 MOVE 'SI'            TO WSS-GLS-NOUF
                 MOVE WSS-FEC-CPTFCAM TO WSS-FEC-CPTFCAA
                 MOVE WSS-CAM-SGV-UF  TO WSS-VAL-CPTPGOA
                 MOVE WSS-CAM-SGV-UF  TO WSS-VAL-CPTPGO
           ELSE
              MOVE 1                   TO WSS-VAL-CPTPGO.

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE WSS-NUM-DCPTPAG         TO WSS-NUM-DCPTCAM.
           MOVE WSS-NUM-MCPTPAG         TO WSS-NUM-MCPTCAM.
           MOVE WSS-NUM-SCPTPAG         TO WSS-NUM-SCPTCAM.
           MOVE WSS-NUM-ACPTPAG         TO WSS-NUM-ACPTCAM.
           PERFORM OBT-VCAM-FHOY.
           IF ( NOT FIO-STAT-OKS              ) OR
              ( CAM-MSC-STAT IN CAM NOT = 'S' )
                PERFORM BUS-FEC-ANTC
                MOVE CAM-SGV-VCAM IN CAM         TO WSS-VAL-CPTNOR
           ELSE
               MOVE WSS-CAM-SGV-UF TO WSS-VAL-CPTNOR.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

           IF OPC-COD-VCOC IN OPC = '0998  ' AND
               WSS-GLS-NOUF = 'NO'
               MOVE 'CPTUF     ' TO WSS-COD-MENSCPT
               PERFORM BUSCA-GLOSAS-CPT
               MOVE WSS-GLS-CPT  TO FRM-GLS-GLO2.

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE 'S' TO WSS-QUE-MVEN IN WSS-VARI.
           MOVE ZEROES TO WSS-VAL-INTAUX IN WSS-VARI.
           MOVE WSS-CAN-FUAP IN WSS-VARI TO WSS-CAN-RFUA IN WSS-VARI.
           MOVE WSS-DLC-RDEV IN WSS-VARI TO WSS-DLC-FDEV IN WSS-VARI.
           MOVE WSS-FEC-VANT IN WSS-VARI TO WSS-VEN-ANTE IN WSS-VARI.
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *    MOVE OPC-VAL-SCRE IN OPC TO DPS-VAL-SCRE.
      *    MOVE VEN-NUM-IVCT IN VEN TO DPS-NUM-IVEN.
           MOVE OPC-VAL-SCRE IN OPC TO IS2-DPS-VAL-SCRE.
           MOVE VEN-NUM-IVCT IN VEN TO IS2-DPS-NUM-IVEN.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTPAG-R
               MOVE SPACES TO FRM-GLS-GLO3
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
      *        PERFORM REV-VEN-MOR.
               PERFORM REV-VEN-MOR
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *        MOVE OPC-VAL-SCRE IN OPC TO DPS-VAL-SCRE
      *        MOVE VEN-NUM-IVEN IN VEN TO DPS-NUM-IVEN.
               MOVE OPC-VAL-SCRE IN OPC TO IS2-DPS-VAL-SCRE
               MOVE VEN-NUM-IVEN IN VEN TO IS2-DPS-NUM-IVEN.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS

           MOVE SPACES TO FRM-GLS-GLO3.

           IF WSS-QUE-MVEN IN WSS-VARI NOT = 'S'
               PERFORM INF-FINAL-SIM
               COMPUTE WSS-JCPT = WSS-JMAXCPT + 1
               GO TO FIN-CRG-VEC-CPT.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *AFRI-INI 28-NOV-2012 CAMBIOS CAEV
           MOVE ZEROES TO WSS-CAM-CAEV IN WSS-VARI.
           MOVE OPC-VAL-SCRE IN OPC TO WSS-CAM-CAEV IN WSS-VARI.
      *AFRI-FIN 28-NOV-2012 CAMBIOS CAEV
           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTPAG-R
               COMPUTE OPC-VAL-SCRE IN OPC =
                   OPC-VAL-SCRE IN OPC - VEN-VAL-SCAP IN VEN.

** 3 **  INICIO PROCESO PARA CALCULAR INTERESES
           MOVE SPACES                  TO INT-TIPT.
           MOVE ZEROES                  TO INT-TINT.
           MOVE OPC-COD-VCOC IN OPC     TO INT-VCAM.
           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTPAG-R
              MOVE VEN-NUM-DVEN IN VEN     TO INT-DUNO WSS-NUM-DDEV
              MOVE VEN-NUM-MVEN IN VEN     TO INT-MUNO WSS-NUM-MDEV
              MOVE VEN-NUM-SVEN IN VEN     TO INT-SUNO WSS-NUM-SDEV
              MOVE VEN-NUM-AVEN IN VEN     TO INT-AUNO WSS-NUM-ADEV
           ELSE
           IF DLC-FEC-FDEV IN DLC > ZEROES
              MOVE DLC-NUM-DDEV IN DLC     TO INT-DUNO WSS-NUM-DDEV
              MOVE DLC-NUM-MDEV IN DLC     TO INT-MUNO WSS-NUM-MDEV
              MOVE DLC-NUM-SDEV IN DLC     TO INT-SUNO WSS-NUM-SDEV
              MOVE DLC-NUM-ADEV IN DLC     TO INT-AUNO WSS-NUM-ADEV
           ELSE
              MOVE OPC-NUM-DCOL IN OPC     TO INT-DUNO WSS-NUM-DDEV
              MOVE OPC-NUM-MCOL IN OPC     TO INT-MUNO WSS-NUM-MDEV
              MOVE OPC-NUM-SCOL IN OPC     TO INT-SUNO WSS-NUM-SDEV
              MOVE OPC-NUM-ACOL IN OPC     TO INT-AUNO WSS-NUM-ADEV.

           MOVE WSS-FEC-CPTPAG          TO INT-FDOS.
           MOVE OPC-NUM-DCOL IN OPC     TO INT-DCOL.
           MOVE OPC-NUM-MCOL IN OPC     TO INT-MCOL.
           MOVE OPC-NUM-SCOL IN OPC     TO INT-SCOL.
           MOVE OPC-NUM-ACOL IN OPC     TO INT-ACOL.
           MOVE WSS-FEC-CPTPAG          TO INT-FBTV.
           MOVE OPC-CIC-IOPC IN OPC     TO INT-IOPC.
           MOVE DLC-NUM-IDLC IN DLC     TO INT-IDLC.
           PERFORM COL-CAL-INT.
           IF INT-CMSG > SPACES
              MOVE ZEROES TO INT-TIPE
              MOVE SPACES TO INT-CMSG.

           PERFORM CAL-INT-NORMAL.

           IF FRM-VAL-PREP IN CPT-FLD > ZEROES
              MOVE FRM-VAL-PREP IN CPT-FLD TO WSS-VAL-CPTING
              MOVE 'SS'                    TO WSS-IND-CPTING
           ELSE
              COMPUTE WSS-VAL-CPTING =
                  (OPC-VAL-SCRE IN OPC     *
                   WSS-VAL-CPTPGO )
              MOVE 'NS'                    TO WSS-IND-CPTING.

           IF WSS-IND-CPTING(1:1) = 'S'
              IF WSS-VAL-CPTINT NOT < WSS-VAL-CPTING
                 MOVE WSS-VAL-CPTING TO WSS-VAL-CPTINT
                 MOVE ZEROES         TO WSS-VAL-CPTING
                 MOVE 'SN'           TO WSS-IND-CPTING
              ELSE
                 COMPUTE WSS-VAL-CPTING =
                         WSS-VAL-CPTING -
                         WSS-VAL-CPTINT
                 MOVE 'SS'           TO WSS-IND-CPTING.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTINT   TO FRM-VAL-INTE-EDT
              MOVE FRM-VAL-INTE-EDT TO WSS-VAL-INTE-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTINT   TO WSS-VAL-INTE-V(WSS-JCPT).

** 3 **  SE CARGAN LOS INTERESES DEL PREPAGO PARA EL CERTIFICADO
** 3 **    ADEMAS SE HACE LA RESTA SI INGRESA MONTO DE PREPAGO

** 3 **  FINAL  PROCESO PARA CALCULAR INTERESES


** 5 **    SE CALCULA EL CAPITAL ADEUDADO DESPUES DEL PAGO

** 6 **    SE CALCULAN LOS REAJUSTES DEL PREPAGO
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE OPC-VAL-SCRE IN OPC    TO WSS-VAL-CPTSCRE.
           MOVE BKP-VAL-SCRE           TO WSS-VAL-CPTSCRE.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           IF OPC-COD-VCOC IN OPC NOT = '0998  '
              MOVE ZEROES              TO WSS-VAL-REAJ-V(WSS-JCPT)
 RGD          MOVE BKP-VAL-SCRE        TO WSS-VAL-CPTCAPR
 RGD          MOVE BKP-VAL-SCRE        TO WSS-VAL-CPTCAPR-BKP
 RGD  *       MOVE WSS-VAL-CPTSCRE     TO WSS-VAL-CPTCAPR
 RGD  *       MOVE WSS-VAL-CPTSCRE     TO WSS-VAL-CPTCAPR-BKP
              GO TO CON-VAL-REAJ.


      *   PARA CALCULAR REAJUSTES - CALCULO A FECHA DE CURSE
           COMPUTE WSS-VAL-CPTCPPR ROUNDED =
                   WSS-VAL-CPTSCRE         *
                   WSS-VAL-CPTCRS.

      *   PARA CALCULAR REAJUSTES - CALCULO A FECHA DE PAGO
           COMPUTE WSS-VAL-CPTREAJ ROUNDED =
                   WSS-VAL-CPTSCRE         *
                   WSS-VAL-CPTPGO

      *   TRANSFIERO VALOR A PREPAGO CALCULADO A FECHA DE CURSE
           MOVE WSS-VAL-CPTREAJ TO WSS-VAL-CPTCAPR.



      *   CALCULO REAJUSTES Y TRANSFIERO AL VECTOR
           COMPUTE WSS-VAL-CPTREAJ ROUNDED =
                   WSS-VAL-CPTREAJ         -
                   WSS-VAL-CPTCPPR.
           MOVE WSS-VAL-CPTREAJ TO WSS-VAL-REAJ-V(WSS-JCPT).

           COMPUTE WSS-VAL-CAAD-V(WSS-JCPT) =
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *            OPC-VAL-SCRE IN OPC   -
                   BKP-VAL-SCRE   -
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
                  (WSS-VAL-CAPR-V(WSS-JCPT) /
                   WSS-VAL-CPTCRS).


           MOVE WSS-VAL-CPTREAJ TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTREAJ.

      * RGD-INI 03-MAR-2011 CORRIGE LECTURA VEN
      *    CALCULO CAPITAL DE PREPAGO A UF DE CURSE Y SUMO REAJUSTES
           COMPUTE WSS-VAL-CPTCAPR-BKP ROUNDED =
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *     (OPC-VAL-SCRE IN OPC * WSS-VAL-CPTCRS) + WSS-VAL-CPTREAJ.
            (BKP-VAL-SCRE * WSS-VAL-CPTCRS) + WSS-VAL-CPTREAJ.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      * RGD-FIN 03-MAR-2011

           PERFORM CAL-REA-NORMAL.

      * RGD-INI 03-MAR-2011 CORRIGE LECTURA VEN
      *    CALCULO CAPITAL DE PREPAGO A UF DE CURSE Y SUMO REAJUSTES
  RGD *    COMPUTE WSS-VAL-CPTCAPR ROUNDED = WSS-SGV-CAP-VEN +
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    COMPUTE WSS-VAL-CPTCAPR = WSS-SGV-CAP-VEN + WSS-SGV-REA-VEN
      *    + (OPC-VAL-SCRE IN OPC * WSS-VAL-CPTCRS) + WSS-VAL-CPTREAJ.
      *    ADD WSS-SGV-REA-VEN TO WSS-VAL-CPTREAJ.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      * RGD-FIN 03-MAR-2011
            COMPUTE WSS-SGV-PAS-CAL =
                           OPC-VAL-SCRE IN OPC * WSS-VAL-CPTCRS.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTREAJ  TO FRM-VAL-REAJ-EDT
              MOVE FRM-VAL-REAJ-EDT TO WSS-VAL-REAJ-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTREAJ  TO WSS-VAL-REAJ-V(WSS-JCPT).


       CON-VAL-REAJ.
           IF WSS-IND-CPTING(1:1) NOT = 'S' AND
              OPC-COD-VCOC IN OPC     = '0998  '
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       COMPUTE WSS-VAL-CPTINT = WSS-VAL-SMO1 -
      *       COMPUTE WSS-VAL-CPTINT = WSS-VAL-CPTINT + (WSS-VAL-SMO1 -
      *                                WSS-VAL-CPTCAPR-BKP)
      *       ADD WSS-SGV-INT-VEN      TO WSS-VAL-CPTINT
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
              IF SCR-OFRM-SRV
                 MOVE WSS-VAL-CPTINT   TO FRM-VAL-INTE-EDT
                 MOVE FRM-VAL-INTE-EDT TO WSS-VAL-INTE-V(WSS-JCPT)
              ELSE
                 MOVE WSS-VAL-CPTINT   TO WSS-VAL-INTE-V(WSS-JCPT)
           ELSE
           IF WSS-IND-CPTING(1:1) NOT = 'S'
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       COMPUTE WSS-VAL-CPTINT = WSS-VAL-SMO1 -
      *       COMPUTE WSS-VAL-CPTINT = WSS-VAL-CPTINT + (WSS-VAL-SMO1 -
      *                                WSS-VAL-CPTSCRE)
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
              MOVE WSS-VAL-CPTINT  TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTINTT
      *       ADD WSS-SGV-INT-VEN      TO WSS-VAL-CPTINT
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       COMPUTE WSS-VAL-CPTINT = WSS-SGV-INT-VEN + WSS-VAL-CPTINTT
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
              IF SCR-OFRM-SRV
                 MOVE WSS-VAL-CPTINT   TO FRM-VAL-INTE-EDT
                 MOVE FRM-VAL-INTE-EDT TO WSS-VAL-INTE-V(WSS-JCPT)
              ELSE
                 MOVE WSS-VAL-CPTINT   TO WSS-VAL-INTE-V(WSS-JCPT).

** 6 **    SE CALCULAN LOS CARGOS POR MORA

** 7 **    SE CALCULAN LOS CARGOS POR MORA
           MOVE WSS-NUM-DCPTPAG         TO WSS-NUM-DCPTCAM.
           MOVE WSS-NUM-MCPTPAG         TO WSS-NUM-MCPTCAM.
           MOVE WSS-NUM-SCPTPAG         TO WSS-NUM-SCPTCAM.
           MOVE WSS-NUM-ACPTPAG         TO WSS-NUM-ACPTCAM.

           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTFCAM
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       PERFORM CALCULA-MORA-CPT
      *    ELSE
      *       MOVE ZEROES  TO WSS-VAL-CPTCAMO.
              PERFORM CALCULA-MORA-CPT.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

           IF WSS-IND-CPTING(1:1) = 'S'
              IF WSS-VAL-CPTCAMO       NOT < WSS-VAL-CPTING
                 MOVE WSS-VAL-CPTING TO WSS-VAL-CPTCAMO
                 MOVE ZEROES         TO WSS-VAL-CPTING
                 MOVE 'SN'           TO WSS-IND-CPTING
              ELSE
                 COMPUTE WSS-VAL-CPTING =
                         WSS-VAL-CPTING -
                         WSS-VAL-CPTCAMO
                 MOVE 'SS'           TO WSS-IND-CPTING.


              IF SCR-OFRM-SRV
                 MOVE WSS-VAL-CPTCAMO  TO FRM-VAL-CAMO-EDT
                 MOVE FRM-VAL-CAMO-EDT TO WSS-VAL-CAMO-V(WSS-JCPT)
              ELSE
                 MOVE WSS-VAL-CPTCAMO  TO WSS-VAL-CAMO-V(WSS-JCPT).

** 8 **    SE PROCEDE A RESCATAR EL VALOR DE COMISION DE FOGAPE
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *    PERFORM CALCULA-COM-FGP.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
 RGDF *    IF WSS-GLS-NOCO = 'SICOBRACOM'

      *+AGREGADO POR CAMBIO EN FOGAPE
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE SPACES TO WSS-IND-VMOR IN WSS-VARI.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           PERFORM SET-VAR-LOCC.
           PERFORM LOC-COM-FGP.

           IF LOC-GLS-NOCO IN LOC-VARI = 'SICOBRACOM' AND
                LOC-COM-FGPE IN LOC-VARI > ZEROES
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       IF OPC-COD-VCOC IN OPC = '0998  ' AND
      *           WSS-GLS-NOUF = 'NO'
      *          COMPUTE WSS-VAL-COMI = LOC-COM-FGPE * WSS-VAL-CPTPGO
      *          MOVE WSS-VAL-COMI  TO WSS-VAL-CPTFGPD
      *       ELSE
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
                 MOVE LOC-COM-FGPE    TO   WSS-VAL-COMI
                 MOVE WSS-VAL-COMI  TO WSS-VAL-CPTFGPD.

      *AFRI-INI 28-NOV-2012 CAMBIOS CAEV
               IF OPC-COD-VCOC IN OPC = '0998  '
                   COMPUTE WSS-CAM-CAEV IN WSS-VARI =
                          WSS-CAM-CAEV IN WSS-VARI + (WSS-VAL-CPTFGPD /
                                              WSS-VAL-CPTPGO)
               ELSE
                   MOVE WSS-VAL-CPTFGPD TO PES-SGV-DECI IN PES-VARI
                   PERFORM PES-SCTV
                   MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTFGPD
                   ADD WSS-VAL-CPTFGPD TO WSS-CAM-CAEV IN WSS-VARI.
      *AFRI-FIN 28-NOV-2012 CAMBIOS CAEV

      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *    IF VEN-FEC-FIMV IN VEN NOT < WSS-FEC-CPTFCAM
      *       GO TO CONT-CAL-FOGAPE.
      *
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE SPACES TO WSS-IND-VMOR IN WSS-VARI.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *    PERFORM SET-VAR-LOCC2.
      *    PERFORM LOC-COM-FGP.
      *
      *    IF LOC-GLS-NOCO IN LOC-VARI = 'SICOBRACOM' AND
      *         LOC-COM-FGPE IN LOC-VARI > ZEROES
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       IF OPC-COD-VCOC IN OPC = '0998  ' AND
      *           WSS-GLS-NOUF = 'NO'
      *          COMPUTE WSS-VAL-COMI = LOC-COM-FGPE * WSS-VAL-CPTPGO
      *          ADD WSS-VAL-COMI  TO WSS-VAL-CPTFGPD
      *       ELSE
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *          MOVE LOC-COM-FGPE    TO   WSS-VAL-COMI
      *          ADD WSS-VAL-COMI  TO WSS-VAL-CPTFGPD.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE

       CONT-CAL-FOGAPE.
           MOVE WSS-VAL-CPTFGPD TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTFGP.
           ADD PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTFGP.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

           IF LOC-GLS-NOCO IN LOC-VARI NOT = 'SICOBRACOM'
              MOVE ZEROES        TO WSS-VAL-CPTFGP.

           IF WSS-IND-CPTING(1:1) = 'S'
              IF WSS-VAL-CPTFGP NOT < WSS-VAL-CPTING
                 MOVE WSS-VAL-CPTING TO WSS-VAL-CPTFGP
                 MOVE ZEROES         TO WSS-VAL-CPTING
                 MOVE 'SN'           TO WSS-IND-CPTING
              ELSE
                 COMPUTE WSS-VAL-CPTING =
                         WSS-VAL-CPTING -
                         WSS-VAL-CPTFGP
                 MOVE 'SS'           TO WSS-IND-CPTING.


      *    MOVE WSS-VAL-CPTFGP TO PES-SGV-DECI IN PES-VARI.
      *    PERFORM PES-SCTV.
      *    MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTFGP.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTFGP   TO FRM-VAL-COFG-EDT
              MOVE FRM-VAL-COFG-EDT TO WSS-VAL-COFG-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTFGP   TO WSS-VAL-COFG-V(WSS-JCPT).


** 4 **    HRS *** HRS *** HRS *** HRS ***  INICIO
** 4 **    SE PROCEDE A RESCATAR EL VALOR DE COMISION DE PREPAGO
           MOVE    WSS-VAL-CPTING    TO WSS-VAL-CPTSCRE.


           MOVE ZEROES                  TO CAN-NUM-PLCO IN CAN-FLD
                                           CAN-NUM-PLCO IN CAN.
           MOVE OPC-CAI-IOPC IN OPC     TO CAN-CAI-IOPC IN CAN-FLD
                                           PCP-IOPC (1:4).
           MOVE OPC-IIC-IOPC IN OPC     TO CAN-IIC-IOPC IN CAN-FLD
                                           PCP-IOPC (5:8).
           MOVE DBC-NUM-ICLI IN DBC     TO PCP-IIDC (1:8)         .
           MOVE 'PAR'                   TO PCP-ACCI.
           MOVE '090'                   TO CAN-COD-OFCA IN CAN-FLD.
           MOVE WSS-NUM-DCPTPAG         TO CAN-NUM-DCAN IN CAN-FLD.
           MOVE WSS-NUM-MCPTPAG         TO CAN-NUM-MCAN IN CAN-FLD.
           MOVE WSS-NUM-SCPTPAG         TO CAN-NUM-SCAN IN CAN-FLD.
           MOVE WSS-NUM-ACPTPAG         TO CAN-NUM-ACAN IN CAN-FLD.
           IF DBC-IND-TICL IN DBC = 'P'
              MOVE DCP-COD-TBAN IN DCP  TO PCP-COD-CLTE
           ELSE
              MOVE DCE-COD-TBAN IN DCE  TO PCP-COD-CLTE.

           MOVE 'CTA'                   TO CCO-COD-EVEN           .
           PERFORM LEE-PLAN-COMI-CAN.
           MOVE 'BUS'                   TO PCP-ACCI.


           PERFORM CARGA-VAR-CPTPCP.
           IF WSS-IND-CPTING(1:1) = 'S'
              MOVE 'S'               TO PCP-IINC.

           PERFORM CAL-COM-PCP.
           MOVE VEN-BKP TO VEN.
           IF PCP-CMSG > SPACES
              MOVE ZEROES            TO PCP-SUCO PCP-SUIM.
           MOVE PCP-SUCO             TO WSS-VAL-COPR.
           ADD  PCP-SUIM             TO WSS-VAL-COPR.


           MOVE WSS-VAL-COPR         TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-COPR.

      *AFRI-INI 28-NOV-2012 CAMBIOS CAEV
           IF OPC-COD-VCOC IN OPC = '0998  '
               COMPUTE WSS-CAM-CAEV IN WSS-VARI =
                       WSS-CAM-CAEV IN WSS-VARI + (WSS-VAL-COPR /
                                                   WSS-VAL-CPTPGO)
           ELSE
               ADD WSS-VAL-COPR TO WSS-CAM-CAEV IN WSS-VARI.
      *AFRI-FIN 28-NOV-2012 CAMBIOS CAEV

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-COPR     TO FRM-VAL-COPR-EDT
              MOVE FRM-VAL-COPR-EDT TO WSS-VAL-COPR-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-COPR     TO WSS-VAL-COPR-V(WSS-JCPT).
** 4 **    SE PROCEDE A RESCATAR EL VALOR DE COMISION DE PREPAGO
** 4 **    HRS *** HRS *** HRS *** HRS ***  FINAL



*******    SE EVALUA VALOR DE CAPITAL PREPAGO A CANCELAR.
**HRS      IF WSS-IND-CPTING(1:1) = 'S'
              IF WSS-VAL-CPTCAPR NOT < WSS-VAL-CPTING
                 MOVE WSS-VAL-CPTING TO WSS-VAL-CPTCAPR
                 MOVE ZEROES         TO WSS-VAL-CPTING
                 MOVE 'SN'           TO WSS-IND-CPTING
              ELSE
                 COMPUTE WSS-VAL-CPTING =
                         WSS-VAL-CPTING -
                         WSS-VAL-CPTCAPR
                 MOVE 'SS'           TO WSS-IND-CPTING.

           IF WSS-IND-CPTING(1:1) = 'N'
              NEXT SENTENCE
           ELSE
              IF  WSS-VAL-CPTING  > ZEROES
                  COMPUTE WSS-VAL-CPTCAPR =
                 (OPC-VAL-SCRE IN OPC * WSS-VAL-CPTPGO)
              ELSE
                  COMPUTE WSS-VAL-CPTCAPR =
                          WSS-VAL-CPTCAPR - WSS-VAL-COPR.

           MOVE WSS-VAL-CPTCAPR TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTCAPR.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTCAPR  TO FRM-VAL-CAPR-EDT
              MOVE FRM-VAL-CAPR-EDT TO WSS-VAL-CAPR-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTCAPR  TO WSS-VAL-CAPR-V(WSS-JCPT).


           IF OPC-COD-VCOC IN OPC = '0998  ' AND
              WSS-VAL-CPTCAPR     > ZEROES
              COMPUTE WSS-VAL-CPTCAAD ROUNDED =
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *               OPC-VAL-SCRE IN OPC     -
                      BKP-VAL-SCRE            -
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
                     (WSS-VAL-CPTCAPR         /
                      WSS-VAL-CPTPGO)
           ELSE
              COMPUTE WSS-VAL-CPTCAAD       =
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *               OPC-VAL-SCRE IN OPC   -
                      BKP-VAL-SCRE   -
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
                      WSS-VAL-CPTCAPR.

           MOVE WSS-VAL-CPTCAAD TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTCAAD.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTCAAD  TO FRM-VAL-CAAD-EDT
              MOVE FRM-VAL-CAAD-EDT TO WSS-VAL-CAAD-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTCAAD  TO WSS-VAL-CAAD-V(WSS-JCPT).

      *    IF WSS-VAL-CPTING  NOT > ZEROES OR
      *       WSS-IND-CPTCAAD = 'P'
           IF (WSS-VAL-CPTING  NOT > ZEROES OR
              WSS-IND-CPTCAAD = 'P') AND
              FRM-VAL-PREP IN CPT-FLD > ZEROES
              MOVE 'P'                 TO WSS-IND-CPTCAAD
              MOVE 'P A R C I A L '    TO FRM-GLS-TCAN IN CPT-FLD.

** 9 **    SE SUMA TOTAL PAGADO LOS MONTOS DE 1+2+3+5+6+7
           COMPUTE WSS-VAL-CPTTPAG       =
                   WSS-VAL-CAPR-V(WSS-JCPT) +
                   WSS-VAL-INTE-V(WSS-JCPT) +
                   WSS-VAL-COPR-V(WSS-JCPT) +
                   WSS-VAL-CAMO-V(WSS-JCPT) +
                   WSS-VAL-COFG-V(WSS-JCPT).

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTTPAG  TO FRM-VAL-TPAG-EDT
              MOVE FRM-VAL-TPAG-EDT TO WSS-VAL-TPAG-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTTPAG  TO WSS-VAL-TPAG-V(WSS-JCPT).


      * VALIDO SI MONTO INGRESADO CUBRE GASTOS MINIMOS DE PREPAGO
           IF FRM-VAL-PREP IN CPT-FLD > ZEROES
              PERFORM VALIDA-MONTO-PREPAGO
      *       IF WSS-VAL-CPTTPAG < FRM-VAL-PREP IN CPT-FLD
              IF WSS-VAL-CPTTPAG < FRM-VAL-PREP IN CPT-FLD AND
                   WSS-IND-CPTCAAD = 'T'
                 MOVE 'VALVPESCRED>' TO MSG-COD-MENS
                 MOVE 'COL'          TO MSG-COD-SIST
                 PERFORM GET-MSG

                 IF FRM-GLS-GLO1 IN CPT-FLD = SPACES
                    MOVE  MSG-GLS-DESC
                      TO   FRM-GLS-GLO1 IN CPT-FLD
                 ELSE
                    IF FRM-GLS-GLO2 IN CPT-FLD = SPACES
                       MOVE  MSG-GLS-DESC
                         TO   FRM-GLS-GLO2 IN CPT-FLD
                    ELSE
                       MOVE  MSG-GLS-DESC
                         TO   FRM-GLS-GLO3 IN CPT-FLD.

      *AFRI-INI MAYO-2012 INDICADORES CAE Y CAEV
           IF WSS-JCPT = 1 AND WSS-TIP-CRED IN WSS-VARI = 'CON'
      *CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
      *        MOVE 'COL' TO TAB-COD-SIST FIO-SIST
      *        MOVE 'TAS' TO TAB-COD-TTAB IN TAB
      *        MOVE 'CALCULACAEV' TO TAB-COD-CTAB IN TAB
      *        MOVE FIO-GET-KEY TO FIO-CMND
      *        PERFORM GNS-FIO-TAB
      *        IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
               IF WSS-IND-CAEV = WSS-CT-1
      *CIMA-FIN 29-JUL-2014 OPT TRANSAC LENTAS
                   MOVE 'KEV'           TO CAV-TIP-IND IN CAV-VARI
                   MOVE WSS-NUM-DCPTPAG TO CAV-NUM-DPAG IN CAV-VARI
                   MOVE WSS-NUM-MCPTPAG TO CAV-NUM-MPAG IN CAV-VARI
                   MOVE WSS-NUM-SCPTPAG TO CAV-NUM-SPAG IN CAV-VARI
                   MOVE WSS-NUM-ACPTPAG TO CAV-NUM-APAG IN CAV-VARI
                   MOVE WSS-VAL-CPTINT TO CAV-VAL-INTN IN CAV-VARI
                   MOVE WSS-VAL-CPTFGP TO CAV-VAL-COMF IN CAV-VARI
                   MOVE WSS-VAL-COPR TO CAV-VAL-COMP IN CAV-VARI
                   MOVE WSS-VAL-CPTCAPR TO CAV-VAL-MONP IN CAV-VARI
      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
                   MOVE 'N' TO CAV-IND-DISP IN CAV-VARI
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
                   IF WSS-IND-CPTCAAD = 'P'
                       COMPUTE CAV-VAL-SALD IN CAV-VARI =
                               (WSS-VAL-CPTCAAD / WSS-VAL-CPTPGO)
                       PERFORM CAL-IND-CAEV
                   ELSE
      *AFRI-INI 28-NOV-2012 CAMBIOS CAEV
      *                COMPUTE CAV-VAL-SALD IN CAV-VARI =
      *                        (WSS-VAL-CPTTPAG / WSS-VAL-CPTPGO)
                       COMPUTE CAV-VAL-SALD IN CAV-VARI = 0 +
                                 WSS-CAM-CAEV IN WSS-VARI
      *AFRI-FIN 28-NOV-2012 CAMBIOS CAEV
                       PERFORM CAL-IND-CAEV.
      *AFRI-INI 31-AGO-2012 OPERACIONES MOROSAS
      *CAP PREPAGADO A FECHA DE OTORGAMIENTO
           IF WSS-VAL-CPTREAJ NOT = ZEROES
               COMPUTE WSS-VAL-CPTCPPR ROUNDED =
                       BKP-VAL-SCRE            *
                       WSS-VAL-CPTCRS
               MOVE WSS-VAL-CPTCPPR TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTCAPR
               IF SCR-OFRM-SRV
                   MOVE WSS-VAL-CPTCAPR  TO FRM-VAL-CAPR-EDT
                   MOVE FRM-VAL-CAPR-EDT TO WSS-VAL-CAPR-V(WSS-JCPT)
               ELSE
                   MOVE WSS-VAL-CPTCAPR  TO WSS-VAL-CAPR-V(WSS-JCPT).
      *AFRI-FIN 31-AGO-2012 OPERACIONES MOROSAS

      *AFRI-INI JUNIO-2012 ARREGLO VENCIMIENTO
           IF WSS-JCPT = 1 AND WSS-TIP-CRED IN WSS-VARI = 'CON'
               MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN
               IF OPC-IND-VSTR IN OPC = 'S'
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *            MOVE 1                TO VEN-NUM-IVEN IN VEN
                   MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
                   MOVE FIO-GET-NLS         TO FIO-CMND
                   PERFORM COL-FIO-VEN
               ELSE
                   MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
                   MOVE FIO-GET-NLS         TO FIO-CMND
                   PERFORM COL-FIO-VEN.
      *AFRI-FIN JUNIO-2012 ARREGLO VENCIMIENTO
      *AFRI-FIN MAYO-2012 INDICADORES CAE Y CAEV
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           IF WSS-JCPT > 1 OR WSS-TIP-CRED IN WSS-VARI NOT = 'CON'
               MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN
               IF OPC-IND-VSTR IN OPC = 'S'
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *            MOVE 1                TO VEN-NUM-IVEN IN VEN
                   MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
                   MOVE FIO-GET-NLS         TO FIO-CMND
                   PERFORM COL-FIO-VEN
               ELSE
                   MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
                   MOVE FIO-GET-NLS         TO FIO-CMND
                   PERFORM COL-FIO-VEN.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
           PERFORM BUS-MON-SEG.
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
           IF WSS-IND-SUNO IN WSS-VARI = WCC-S
               GO TO FIN-CRG-VEC-CPT.
           MOVE WSS-NUM-DCPTPAG  TO FEC-ITM1.
           MOVE WSS-NUM-MCPTPAG  TO FEC-ITM2.
           MOVE WSS-NUM-SCPTPAG  TO FEC-ITM3.
           MOVE WSS-NUM-ACPTPAG  TO FEC-ITM4.
           MOVE FEC-FORM-FEC     TO FEC-FORM.
           MOVE FEC-SUM-DIA      TO FEC-CMND.
           MOVE 1                TO FEC-NDIA.
           PERFORM CAL-FEC.
           MOVE FEC-FECH         TO WSS-FEC-CPTPAG.
           IF NOT FEC-STAT-OKS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE FEC-MENS     TO FRM-MENS.
       FIN-CRG-VEC-CPT.
           EXIT.

       CALCULA-MORA-CPT SECTION.
       INI-CALCULA-MORA-CPT.
      *    MOVE ZEROES              TO WSS-VAL-CAMO-V(WSS-JCPT).
           MOVE ZEROES              TO WSS-VAL-CPTCAMO.

           PERFORM BUS-CIC-PLZO.
           IF FRM-SUAR = FRM-SUAR-MAL
               GO TO FIN-CALCULA-MORA-CPT.

           PERFORM DET-OPC-PRO-ORIG.
           IF FRM-SUAR = FRM-SUAR-MAL
               GO TO FIN-CALCULA-MORA-CPT.

           MOVE WSS-PLZO                 TO TXC-PLZO.
           MOVE OPC-COD-VCOC IN OPC      TO TXC-VCOC.
           MOVE WSS-NUM-DCPTPAG              TO TXC-DEC2.
           MOVE WSS-NUM-MCPTPAG              TO TXC-MEC2.
           MOVE WSS-NUM-SCPTPAG              TO TXC-SEC2.
           MOVE WSS-NUM-ACPTPAG              TO TXC-AEC2.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE VEN-NUM-DIMV IN VEN      TO TXC-DEC1.
      *    MOVE VEN-NUM-MIMV IN VEN      TO TXC-MEC1.
      *    MOVE VEN-NUM-SIMV IN VEN      TO TXC-SEC1.
      *    MOVE VEN-NUM-AIMV IN VEN      TO TXC-AEC1.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

           PERFORM TAB-BUS-TXC.

           IF TXC-CMSG > SPACES
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE TXC-CMSG     TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE TXC-MEN2     TO FRM-MEN2
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-CALCULA-MORA-CPT.

           DIVIDE TXC-ATXC       BY 100 GIVING
                                 WSS-INT-TIPE ROUNDED.
           MOVE WSS-INT-TIPE     TO INT-TIPE.

           MOVE VEN-VAL-SFIN IN VEN TO WSS-VAL-SMON.
           MULTIPLY INT-TIPE BY VEN-VAL-SFIN IN VEN
                             GIVING SCR-SGV-INTM.

           IF SCR-SGV-INTM > ZEROES
              IF OPC-COD-VCOC IN OPC = '0998  '
      *          COMPUTE SCR-SGV-INTM   ROUNDED = (SCR-SGV-INTM *
      *                                            WSS-VAL-CPTPGO)
                 COMPUTE SCR-SGV-INTM    = (SCR-SGV-INTM *
                                                   WSS-VAL-CPTPGO)
                 MOVE SCR-SGV-INTM    TO PES-SGV-DECI IN PES-VARI
                 PERFORM PES-SCTV
                 MOVE PES-SGV-ENTE IN PES-VARI TO SCR-SGV-INTM
              ELSE
                 MOVE SCR-SGV-INTM    TO PES-SGV-DECI IN PES-VARI
                 PERFORM PES-SCTV
                 MOVE PES-SGV-ENTE IN PES-VARI TO SCR-SGV-INTM.

           IF SCR-SGV-INTM > ZEROES
              MOVE 'CPTMORAPER' TO WSS-COD-MENSCPT
              PERFORM BUSCA-GLOSAS-CPT
              MOVE WSS-GLS-CPT  TO FRM-GLS-GLO3
              MOVE SCR-SGV-INTM TO WSS-VAL-CPTCAMO.

       FIN-CALCULA-MORA-CPT.
           EXIT.

       BUS-CIC-PLZO SECTION.
       INI-BUS-CIC-PLZO.
      *CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
      *    MOVE 'VSN'         TO TAB-COD-TTAB IN TAB.
      *    MOVE 'CALMORAFMAV' TO TAB-COD-CTAB IN TAB.
      *    MOVE 'COL' TO FIO-SIST.
      *    MOVE FIO-GET-KEY TO FIO-CMND.
      *    PERFORM GNS-FIO-TAB.
      *    IF ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S' )
           IF WSS-IND-FMAV IN WSS-VARI = WSS-CT-1
      *CIMA-FIN 29-JUL-2014 OPT TRANSAC LENTAS
               GO TO FMV-BUS-CIC-PLZO.
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE 1                   TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
               MOVE 'DLC    NEX'        TO MSG-COD-MENS
               MOVE DLC-KEY-IDLC IN DLC TO FRM-MEN2
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-BUS-CIC-PLZO.

           MOVE 'PZO'               TO TAB-COD-TTAB IN TAB.
           MOVE DLC-COD-PLZO IN DLC TO TAB-COD-CTAB IN TAB.
           MOVE 'TAB' TO FIO-SIST.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-CIC-CTAB IN TAB TO WSS-PLZO
           ELSE
               MOVE 'TABPZO NEX' TO MSG-COD-MENS
               MOVE TAB-COD-CTAB IN TAB TO FRM-MEN2
               MOVE FRM-SUAR-MAL TO FRM-SUAR.

           GO TO FIN-BUS-CIC-PLZO.

       FMV-BUS-CIC-PLZO.
           MOVE DLC-KEY-IDLC IN DLC TO WSS-DLC-KEY-IDLC.
           MOVE ZEROS               TO WSS-DLC-FEC-FMAV.
           MOVE ZEROS               TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS         TO FIO-CMND.
       LUP-BUS-CIC-PLZO.
           PERFORM COL-FIO-DLC.
           IF NOT (FIO-STAT-OKS AND
                   DLC-CIC-IOPC IN DLC = WSS-DLC-CIC-IOPC)
               GO TO CON-BUS-CIC-PLZO.

           IF DLC-FEC-FMAV IN DLC > WSS-DLC-FEC-FMAV
               MOVE DLC-FEC-FMAV IN DLC TO WSS-DLC-FEC-FMAV.

           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-BUS-CIC-PLZO.

       CON-BUS-CIC-PLZO.
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.
           MOVE WSS-DLC-NUM-DMAV    TO FEC-DEC2.
           MOVE WSS-DLC-NUM-MMAV    TO FEC-MEC2.
           MOVE WSS-DLC-NUM-SMAV    TO FEC-SEC2.
           MOVE WSS-DLC-NUM-AMAV    TO FEC-AEC2.
           MOVE FEC-FORM-FEC        TO FEC-FORM.
           MOVE FEC-DIF-DIA         TO FEC-CMND.
           PERFORM CAL-FEC.
           IF FEC-NDIA < 90
               MOVE 'C1' TO WSS-PLZO
           ELSE
               MOVE 'S9' TO WSS-PLZO.

           MOVE WSS-DLC-KEY-IDLC TO DLC-KEY-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.

       FIN-BUS-CIC-PLZO.
           EXIT.

       DET-OPC-PRO-ORIG SECTION.
       INI-DET-OPC-PRO-ORIG.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.

           IF OPC-IND-RENO IN OPC NOT = 'PRO'
               GO TO NXT-DET-OPC-PRO-ORIG.

           MOVE OPC-CIC-IOPC IN OPC TO WSS-CIC-IOPC.
           MOVE DLC-CIC-IOCO IN DLC TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE 'CAM    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE CAM-KEY-CAMB TO FRM-MEN2
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-DET-OPC-PRO-ORIG.

           MOVE 1                            TO CAM-SGV-VCAM IN CAM.
           IF OPC-COD-VCOC IN OPC NOT = '0998'
               MOVE '0998  '                 TO CAM-COD-VCAM IN CAM(1)
               MOVE OPC-COD-VCOC IN OPC      TO CAM-COD-VCAM IN CAM(2)
               MOVE OPC-NUM-DCOL IN OPC      TO CAM-NUM-DCAM IN CAM(1)
               MOVE OPC-NUM-MCOL IN OPC      TO CAM-NUM-MCAM IN CAM(1)
               MOVE OPC-NUM-SCOL IN OPC      TO CAM-NUM-SCAM IN CAM(1)
               MOVE OPC-NUM-ACOL IN OPC      TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT ( FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
                   MOVE 'TAB'        TO MSG-COD-SIST
                   MOVE 'CAM    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN1
                   MOVE CAM-KEY-CAMB TO FRM-MEN2
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   MOVE WSS-CIC-IOPC TO OPC-CIC-IOPC IN OPC
                   MOVE FIO-GET-KEY TO FIO-CMND
                   PERFORM COL-FIO-OPC
                   GO TO FIN-DET-OPC-PRO-ORIG.

           DIVIDE OPC-VAL-CRED IN OPC BY CAM-SGV-VCAM IN CAM
                  GIVING                   TXC-MNTO ROUNDED.
           MOVE WSS-CIC-IOPC TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           GO TO FIN-DET-OPC-PRO-ORIG.

       NXT-DET-OPC-PRO-ORIG.

           MOVE 1                            TO CAM-SGV-VCAM IN CAM.
           IF OPC-COD-VCOC IN OPC NOT = '0998'
               MOVE '0998  '                 TO CAM-COD-VCAM IN CAM(1)
               MOVE OPC-COD-VCOC IN OPC      TO CAM-COD-VCAM IN CAM(2)
               MOVE OPC-NUM-DCOL IN OPC      TO CAM-NUM-DCAM IN CAM(1)
               MOVE OPC-NUM-MCOL IN OPC      TO CAM-NUM-MCAM IN CAM(1)
               MOVE OPC-NUM-SCOL IN OPC      TO CAM-NUM-SCAM IN CAM(1)
               MOVE OPC-NUM-ACOL IN OPC      TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT ( FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
                   MOVE 'TAB'        TO MSG-COD-SIST
                   MOVE 'CAM    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN1
                   MOVE CAM-KEY-CAMB TO FRM-MEN2
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-DET-OPC-PRO-ORIG.

           DIVIDE OPC-VAL-CRED IN OPC BY CAM-SGV-VCAM IN CAM
                  GIVING                   TXC-MNTO ROUNDED.

       FIN-DET-OPC-PRO-ORIG.
           EXIT.

       CALCULA-COM-FGP SECTION.
       INI-CALCULA-COM-FGP.
           MOVE 'NOCOBRACOM'        TO WSS-GLS-NOCO.
           MOVE 'COL'               TO FIO-SIST.
           MOVE 'GARA'              TO MSC-COD-TMSC IN MSC.
           MOVE OPC-IND-GARA IN OPC TO MSC-COD-CMSC IN MSC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT (FIO-STAT-OKS AND MSC-IND-VIGE IN MSC = 'S')
              GO TO FIN-CALCULA-COM-FGP.
           IF MSC-GLS-DATA IN MSC(60:1) NOT = 'F'
              GO TO FIN-CALCULA-COM-FGP.

      *CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
      *     MOVE 'COL'               TO TAB-COD-SIST FIO-SIST.
      *     MOVE 'DES'               TO TAB-COD-TTAB IN TAB.
      *     MOVE OPC-COD-CDOC IN OPC TO TAB-COD-CTAB IN TAB.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      *     IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
      *        IF (TAB-GLS-DATA IN TAB(60:1) = 'K' OR
      *               TAB-GLS-DATA IN TAB(60:1) = 'I')
              IF WSS-IND-DCRE IN WSS-VARI = WSS-CT-1
      *CIMA-FIN 29-JUL-2014 OPT TRANSAC LENTAS
                 GO TO CON-CALCULA-COM-FGP
              ELSE
                 GO TO FIN-CALCULA-COM-FGP.
       CON-CALCULA-COM-FGP.
      *SE LEE RLO PARA OBTENER EL % GARANTIZADO - RLO-VAL-PGA
            MOVE OPC-CAI-IOPC IN OPC TO RLO-CAI-IOPC IN RLO.
            MOVE OPC-IIC-IOPC IN OPC TO RLO-IIC-IOPC IN RLO.
            MOVE ZEROES              TO RLO-NUM-IOPC IN RLO.
            MOVE 'RLO-KEY-IOPC' TO FIO-AKEY.
            MOVE FIO-GET-KEY TO FIO-CMND.
            PERFORM LDC-FIO-RLO.
            IF NOT FIO-STAT-OKS OR
              (OPC-CAI-IOPC IN OPC NOT = RLO-CAI-IOPC IN RLO AND
                  OPC-IIC-IOPC IN OPC NOT = RLO-IIC-IOPC IN RLO AND
                        RLO-NUM-IOPC IN RLO NOT = ZEROES)
               GO TO FIN-CALCULA-COM-FGP.

      *SE LEE LCC PARA OBTENER LA COMISION ORIGEN, LCC-SGV-CO
            MOVE RLO-CIC-ILIC IN RLO TO LCC-CIC-ILIC IN LCC.
            MOVE 'LCC-KEY-ILIC' TO FIO-AKEY.
            MOVE FIO-GET-KEY TO FIO-CMND.
            PERFORM LDC-FIO-LCC.
            IF NOT FIO-STAT-OKS
               GO TO FIN-CALCULA-COM-FGP.

      *CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
      *     MOVE 'COL'       TO TAB-COD-SIST FIO-SIST.
      *     MOVE 'LCT'       TO TAB-COD-TTAB IN TAB.
      *     MOVE 'TASA'      TO TAB-COD-CTAB IN TAB.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      *     IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
            IF WSS-IND-TASA IN WSS-VARI = WSS-CT-1
      *CIMA-FIN 29-JUL-2014 OPT TRANSAC LENTAS
                MOVE 360 TO WSS-BAS-FGPE
            ELSE
      *CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
      *         IF TAB-COD-DAT1(1) = 'A'
                IF WSS-COD-DAT1 = WSS-CT-A
      *CIMA-FIN 29-JUL-2014 OPT TRANSAC LENTAS
                    MOVE 360 TO WSS-BAS-FGPE
                ELSE
      *CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
      *         IF TAB-COD-DAT1(1) = 'M'
                IF WSS-COD-DAT1 = WSS-CT-M
      *CIMA-FIN 29-JUL-2014 OPT TRANSAC LENTAS
                    MOVE 30 TO WSS-BAS-FGPE
                ELSE
      *CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
      *         IF TAB-COD-DAT1(1) = 'D'
                IF WSS-COD-DAT1 = WSS-CT-D
      *CIMA-FIN 29-JUL-2014 OPT TRANSAC LENTAS
                   MOVE 1 TO WSS-BAS-FGPE.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    IF DLC-FEC-FDEV IN DLC > ZEROES
      *       MOVE DLC-NUM-DDEV IN DLC  TO FEC-DEC1
      *       MOVE DLC-NUM-MDEV IN DLC  TO FEC-MEC1
      *       MOVE DLC-NUM-SDEV IN DLC  TO FEC-SEC1
      *       MOVE DLC-NUM-ADEV IN DLC  TO FEC-AEC1
           IF WSS-VEN-ANTE IN WSS-VARI > ZEROES
              MOVE WSS-NUM-DANT IN WSS-VARI TO FEC-DEC1
              MOVE WSS-NUM-MANT IN WSS-VARI TO FEC-MEC1
              MOVE WSS-NUM-SANT IN WSS-VARI TO FEC-SEC1
              MOVE WSS-NUM-AANT IN WSS-VARI TO FEC-AEC1
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           ELSE
              MOVE OPC-NUM-DCOL IN OPC  TO FEC-DEC1
              MOVE OPC-NUM-MCOL IN OPC  TO FEC-MEC1
              MOVE OPC-NUM-SCOL IN OPC  TO FEC-SEC1
              MOVE OPC-NUM-ACOL IN OPC  TO FEC-AEC1.

           MOVE WSS-NUM-DCPTPAG         TO WSS-NUM-DCPTCAM.
           MOVE WSS-NUM-MCPTPAG         TO WSS-NUM-MCPTCAM.
           MOVE WSS-NUM-SCPTPAG         TO WSS-NUM-SCPTCAM.
           MOVE WSS-NUM-ACPTPAG         TO WSS-NUM-ACPTCAM.

           IF VEN-FEC-FIMV IN VEN > WSS-FEC-CPTFCAM
              MOVE WSS-NUM-DCPTPAG        TO FEC-DEC2
              MOVE WSS-NUM-MCPTPAG        TO FEC-MEC2
              MOVE WSS-NUM-SCPTPAG        TO FEC-SEC2
              MOVE WSS-NUM-ACPTPAG        TO FEC-AEC2
           ELSE
              MOVE VEN-NUM-DIMV IN VEN    TO FEC-DEC2
              MOVE VEN-NUM-MIMV IN VEN    TO FEC-MEC2
              MOVE VEN-NUM-SIMV IN VEN    TO FEC-SEC2
              MOVE VEN-NUM-AIMV IN VEN    TO FEC-AEC2.

           MOVE FEC-FORM-FEC           TO FEC-FORM.
           MOVE FEC-DIF-DIA            TO FEC-CMND.
           PERFORM CAL-FEC.
           MOVE FEC-NDIA               TO WSS-NUM-DPLZ.
           IF FIO-STAT NOT = '00'
              GO TO FIN-CALCULA-COM-FGP.


      *    COMPUTE WSS-VAL-SCOR = ( RLO-VAL-PGAR IN RLO *
      *             LCC-SGV-CORI IN LCC *
      *             WSS-NUM-DPLZ      )  / 10000.
      *
      *    DIVIDE OPC-VAL-SCRE IN OPC   BY WSS-BAS-FGPE
      *            GIVING WSS-VAL-SPLZ.
      *    MULTIPLY WSS-VAL-SPLZ  BY WSS-VAL-SCOR
      *        GIVING WSS-VAL-COMI.
           COMPUTE LOC-VAL-SGAR IN LOC-VARI =
            (RLO-VAL-PGAR IN RLO * LCC-SGV-CORI IN LCC) / 10000.
           MOVE WSS-NUM-DPLZ TO LOC-SGV-PLZO IN LOC-VARI
           MULTIPLY LOC-VAL-SGAR IN LOC-VARI BY LOC-SGV-PLZO IN LOC-VARI
            GIVING LOC-VAL-SCOR IN LOC-VARI.
           MOVE WSS-BAS-FGPE TO LOC-BAS-FGPE IN LOC-VARI.
           DIVIDE LOC-VAL-SCOR IN LOC-VARI BY LOC-BAS-FGPE IN LOC-VARI
            GIVING LOC-VAL-SPLZ IN LOC-VARI.
           MOVE OPC-VAL-SCRE IN OPC     TO LOC-VAL-SCRE IN LOC-VARI.
           MULTIPLY LOC-VAL-SPLZ IN LOC-VARI BY LOC-VAL-SCRE IN LOC-VARI
            GIVING LOC-VAL-COMI IN LOC-VARI.
           MOVE LOC-VAL-COMI IN LOC-VARI TO WSS-VAL-COMI.
      *
      *    COMPUTE WSS-VAL-COMI = ( OPC-VAL-SCRE IN OPC /
      *                             WSS-BAS-FGPE ) *
      *                           (( RLO-VAL-PGAR IN RLO *
      *                             LCC-SGV-CORI IN LCC *
      *                             WSS-NUM-DPLZ      ) / 10000).
      *

           IF VEN-FEC-FIMV IN VEN NOT < WSS-FEC-CPTFCAM
              GO TO EXT-CALCULA-COM-FGP.

            MOVE WSS-NUM-DCPTPAG        TO FEC-DEC2.
            MOVE WSS-NUM-MCPTPAG        TO FEC-MEC2.
            MOVE WSS-NUM-SCPTPAG        TO FEC-SEC2.
            MOVE WSS-NUM-ACPTPAG        TO FEC-AEC2.
            MOVE VEN-NUM-DIMV IN VEN    TO FEC-DEC1.
            MOVE VEN-NUM-MIMV IN VEN    TO FEC-MEC1.
            MOVE VEN-NUM-SIMV IN VEN    TO FEC-SEC1.
            MOVE VEN-NUM-AIMV IN VEN    TO FEC-AEC1.

            MOVE FEC-FORM-FEC           TO FEC-FORM.
            MOVE FEC-DIF-DIA            TO FEC-CMND.
            PERFORM CAL-FEC.
            MOVE FEC-NDIA               TO WSS-NUM-DPLZ.
            IF FIO-STAT NOT = '00'
               GO TO FIN-CALCULA-COM-FGP.
           COMPUTE LOC-VAL-SGAR IN LOC-VARI =
            (RLO-VAL-PGAR IN RLO * LCC-SGV-CORI IN LCC) / 10000.
           MOVE WSS-NUM-DPLZ TO LOC-SGV-PLZO IN LOC-VARI
           MULTIPLY LOC-VAL-SGAR IN LOC-VARI BY LOC-SGV-PLZO IN LOC-VARI
            GIVING LOC-VAL-SCOR IN LOC-VARI.
           MOVE WSS-BAS-FGPE TO LOC-BAS-FGPE IN LOC-VARI.
           DIVIDE LOC-VAL-SCOR IN LOC-VARI BY LOC-BAS-FGPE IN LOC-VARI
            GIVING LOC-VAL-SPLZ IN LOC-VARI.
           MOVE VEN-VAL-CAPI IN VEN     TO LOC-VAL-SCRE IN LOC-VARI.
           MULTIPLY LOC-VAL-SPLZ IN LOC-VARI BY LOC-VAL-SCRE IN LOC-VARI
            GIVING LOC-VAL-COMI IN LOC-VARI.
           ADD  LOC-VAL-COMI IN LOC-VARI TO WSS-VAL-COMI.
       EXT-CALCULA-COM-FGP.

            MOVE 'SICOBRACOM' TO WSS-GLS-NOCO .

       FIN-CALCULA-COM-FGP.
           EXIT.

       CARGA-VAR-CPTPCP SECTION.
       INI-CARGA-VAR-CPTPCP.

           MOVE VEN TO VEN-BKP.

           IF WSS-IND-CPTING(1:1) = 'S'
              MOVE FRM-VAL-PREP IN CPT-FLD TO CAN-SGV-TPAG IN CAN-FLD
           ELSE
              MOVE ZEROES                  TO CAN-SGV-TPAG IN CAN-FLD.

           MOVE OPC-CAI-IOPC IN OPC     TO CAN-CAI-IOPC IN CAN-FLD.
           MOVE OPC-IIC-IOPC IN OPC     TO CAN-IIC-IOPC IN CAN-FLD.
           MOVE WSS-NUM-DCPTPAG         TO CAN-NUM-DCAN IN CAN-FLD.
           MOVE WSS-NUM-MCPTPAG         TO CAN-NUM-MCAN IN CAN-FLD.
           MOVE WSS-NUM-SCPTPAG         TO CAN-NUM-SCAN IN CAN-FLD.
           MOVE WSS-NUM-ACPTPAG         TO CAN-NUM-ACAN IN CAN-FLD.
           MOVE ZEROES                  TO PCP-FANT     IN PCP-VARI.
           MOVE ZEROES                  TO PCP-FVEN     IN PCP-VARI.
           MOVE ZEROES                  TO PCP-SUVP     IN PCP-VARI.
           MOVE 'BUS'                   TO PCP-ACCI.
           MOVE PCP                     TO PCP-RPCP.
           MOVE ZEROES                  TO CAN-SGV-COMI IN CAN-FLD .
           MOVE ZEROES                  TO CAN-SGV-TREN IN CAN-FLD .
           MOVE ZEROES                  TO WSS-VAL-SMO7            .
           MOVE ZEROES                  TO WSS-VAL-SMO8            .
           MOVE ZEROES                  TO WSS-VAL-SMO9            .
           MOVE ZEROES                  TO WSS-VAL-SM10            .
           MOVE ZEROES                  TO WSS-SGV-CACU

           IF NOT VEN-FEC-FIMV IN VEN < WSS-FEC-CPTFCAM
              GO TO FIN-CARGA-VAR-CPTPCP.

           MOVE VEN-FEC-FVEN IN VEN     TO PCP-FANT     IN PCP-VARI.

           COMPUTE VEN-NUM-IVEN IN VEN = VEN-NUM-IVCT IN VEN + 1.
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           IF OPC-IND-VSTR IN OPC = 'S'
               PERFORM COL-OBT-VEN
               IF NOT VEN-STAT-OKS
                   GO TO FIN-CARGA-VAR-CPTPCP
               ELSE
                   NEXT SENTENCE
           ELSE
               PERFORM COL-FIO-VEN
               IF NOT FIO-STAT-OKS
                   GO TO FIN-CARGA-VAR-CPTPCP.

           .




       FIN-CARGA-VAR-CPTPCP.
           EXIT.

       CAL-INT-NORMAL SECTION.
       INI-CAL-INT-NORMAL.

      *MPS-INI 28-JUN-2016 INCORPORAR IDNI A CERT DE PREPAGO
      *     MOVE ZEROES         TO WSS-VAL-IDNI IN WSS-VARI.
           IF DLC-VAL-IDNI IN DLC IS NOT NUMERIC 
              MOVE ZEROES TO WSS-VAL-IDNI IN WSS-VARI 
           ELSE 
              MOVE DLC-VAL-IDNI IN DLC TO WSS-VAL-IDNI IN WSS-VARI.
      *MPS-FIN 28-JUN-2016 INCORPORAR IDNI A CERT DE PREPAGO
           MOVE ZEROES         TO SCR-SGV-IPFC.
           MOVE ZEROES         TO WSS-SGV-INT-VEN.
           MOVE WSS-VAL-CPTPGO TO SCR-SGV-VCAM.

      *MPS-INI 28-JUN-2016 INCORPORAR IDNI A CERT DE PREPAGO
      *     COMPUTE WSS-VAL-SMO2 = ( OPC-VAL-SCRE IN OPC     *
           COMPUTE WSS-VAL-SMO2 = ( ( OPC-VAL-SCRE IN OPC + WSS-VAL-IDNI
                                      IN WSS-VARI ) * 
      *MPS-FIN 28-JUN-2016 INCORPORAR IDNI A CERT DE PREPAGO
                                         INT-TIPE ).
           MOVE OPC-VAL-SCRE IN OPC  TO WSS-VAL-SMO1.
           ADD WSS-VAL-SMO1 WSS-VAL-IDNI IN WSS-VARI
                                         GIVING WSS-VAL-SMO1.

           ADD WSS-VAL-SMO1 WSS-VAL-SMO2 GIVING WSS-VAL-SMO1.

           MOVE WSS-VAL-SMO1 TO WSS-VAL-SVEN.

           ADD WSS-VAL-SVEN TO SCR-SGV-IPFC.

           SUBTRACT OPC-VAL-SCRE IN OPC FROM SCR-SGV-IPFC.

           MULTIPLY SCR-SGV-IPFC BY SCR-SGV-VCAM
                             GIVING SCR-SGV-INTN.

           IF SCR-SGV-INTN > -1 AND
              SCR-SGV-INTN < 1
               MOVE ZEROES TO SCR-SGV-INTN.

           MOVE SCR-SGV-INTN TO PES-SGV-DECI IN PES-VARI
           PERFORM PES-SCTV
           MOVE PES-SGV-ENTE IN PES-VARI TO SCR-SGV-INTN.

           MULTIPLY WSS-VAL-SVEN BY SCR-SGV-VCAM
                             GIVING WSS-VAL-SVEN ROUNDED.

           MOVE WSS-VAL-SVEN TO WSS-VAL-SMO1.
           MOVE WSS-VAL-SMO1 TO PES-SGV-DECI IN PES-VARI
           PERFORM PES-SCTV
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-SMO1.

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE SCR-SGV-INTN TO WSS-VAL-CPTINT.
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
           IF WSS-IND-CPTCAAD = 'P'
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
               MOVE SCR-SGV-INTN TO WCC-SEG-INTN
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
               COMPUTE WSS-VAL-PREP IN WSS-VARI =
                     WSS-VAL-PREP IN WSS-VARI - SCR-SGV-INTN.
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS
      *AFRI-INI 28-NOV-2012 CAMBIOS CAEV
           IF OPC-COD-VCOC IN OPC = '0998  '
               COMPUTE WSS-CAM-CAEV IN WSS-VARI =
                       WSS-CAM-CAEV IN WSS-VARI + (SCR-SGV-INTN /
                                            WSS-VAL-CPTPGO)
           ELSE
               ADD SCR-SGV-INTN TO WSS-CAM-CAEV IN WSS-VARI.
      *AFRI-FIN 28-NOV-2012 CAMBIOS CAEV

           ADD SCR-SGV-INTN TO WSS-VAL-CPTINT.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

           IF NOT VEN-FEC-FIMV IN VEN < WSS-FEC-CPTPAG-R
              GO TO FIN-CAL-INT-NORMAL.

           MULTIPLY VEN-VAL-SCAP IN VEN BY SCR-SGV-VCAM
                                 GIVING WSS-SGV-CAP-VEN.

           MULTIPLY VEN-VAL-SFIN IN VEN BY SCR-SGV-VCAM
                                 GIVING WSS-SGV-INT-VEN.

           MOVE WSS-SGV-CAP-VEN TO PES-SGV-DECI IN PES-VARI
           PERFORM PES-SCTV
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-CAP-VEN.

           SUBTRACT WSS-SGV-CAP-VEN FROM WSS-SGV-INT-VEN.

           MOVE WSS-SGV-INT-VEN TO PES-SGV-DECI IN PES-VARI
           PERFORM PES-SCTV
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-INT-VEN.

           ADD WSS-SGV-INT-VEN TO WSS-VAL-CPTINT.
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
           IF WSS-IND-CPTCAAD = 'P'
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
               ADD WSS-SGV-INT-VEN TO WCC-SEG-INTN
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
               COMPUTE WSS-VAL-PREP IN WSS-VARI =
                      WSS-VAL-PREP IN WSS-VARI - WSS-SGV-INT-VEN.
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS


       FIN-CAL-INT-NORMAL.
           EXIT.


       CAL-REA-NORMAL SECTION.
       INI-CAL-REA-NORMAL.
           MOVE ZEROES         TO WSS-SGV-REA-VEN.
           MOVE ZEROES         TO WSS-SGV-CAP-VEN.

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           IF WSS-QUE-MVEN IN WSS-VARI = 'N'
               GO TO FIN-CAL-REA-NORMAL.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           IF NOT VEN-FEC-FIMV IN VEN < WSS-FEC-CPTPAG-R
              GO TO FIN-CAL-REA-NORMAL.

           MOVE WSS-VAL-CPTPGO TO SCR-SGV-VCAM.

           MULTIPLY VEN-VAL-SCAP IN VEN BY SCR-SGV-VCAM
                                 GIVING WSS-SGV-CAP-VEN.

           MOVE WSS-VAL-CPTCRS TO SCR-SGV-VCAM.

           MULTIPLY VEN-VAL-SCAP IN VEN BY SCR-SGV-VCAM
                                 GIVING WSS-SGV-REA-VEN.

           SUBTRACT WSS-SGV-REA-VEN FROM WSS-SGV-CAP-VEN
                                    GIVING WSS-SGV-REA-VEN.

           MOVE WSS-SGV-REA-VEN TO PES-SGV-DECI IN PES-VARI
           PERFORM PES-SCTV
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-REA-VEN.

           MOVE WSS-VAL-CPTCRS TO SCR-SGV-VCAM.

           MULTIPLY VEN-VAL-SCAP IN VEN BY SCR-SGV-VCAM
                                 GIVING WSS-SGV-CAP-VEN.

           MOVE WSS-SGV-CAP-VEN TO PES-SGV-DECI IN PES-VARI
           PERFORM PES-SCTV
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-CAP-VEN.
       FIN-CAL-REA-NORMAL.
           EXIT.


       VALIDA-MONTO-PREPAGO SECTION.
       INI-VALIDA-MONTO-PREPAGO.
           MOVE 'MNTNOCUBDEU ' TO MSG-COD-MENS.
           MOVE 'COL'          TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE  MSG-GLS-DESC  TO   FRM-GLS-GLO1 IN CPT-FLD.
      *    MOVE  'MONTO INGRESADO NO CUBRE DEUDA' TO
      *         FRM-GLS-GLO1 IN CPT-FLD.
           SUBTRACT WSS-VAL-CAMO-V(WSS-JCPT) FROM WSS-VAL-CPTING
           IF WSS-VAL-CPTING NOT > ZEROES
              GO TO FIN-VALIDA-MONTO-PREPAGO.

           SUBTRACT WSS-VAL-INTE-V(WSS-JCPT) FROM WSS-VAL-CPTING
           IF WSS-VAL-CPTING NOT > ZEROES
              GO TO FIN-VALIDA-MONTO-PREPAGO.

           SUBTRACT WSS-VAL-COPR-V(WSS-JCPT) FROM WSS-VAL-CPTING
           IF WSS-VAL-CPTING NOT > ZEROES
              GO TO FIN-VALIDA-MONTO-PREPAGO.

           SUBTRACT WSS-VAL-COFG-V(WSS-JCPT) FROM WSS-VAL-CPTING
           IF WSS-VAL-CPTING NOT > ZEROES
              GO TO FIN-VALIDA-MONTO-PREPAGO.
           MOVE SPACES TO FRM-GLS-GLO1 IN CPT-FLD.
       FIN-VALIDA-MONTO-PREPAGO.
           EXIT.

       CLR-CPT-VEC SECTION.
       INI-CLR-CPT-VEC.
           MOVE SPACES TO WSS-FEC-FPAG-V(WSS-JCPT).
           MOVE ZEROES TO WSS-VAL-CAPR-V(WSS-JCPT).
           MOVE ZEROES TO WSS-VAL-INTE-V(WSS-JCPT).
           MOVE ZEROES TO WSS-VAL-COPR-V(WSS-JCPT).
           MOVE ZEROES TO WSS-VAL-CAAD-V(WSS-JCPT).
     *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
           MOVE ZEROES TO WSS-VAL-MDPS-V(WSS-JCPT).
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
           MOVE ZEROES TO WSS-VAL-REAJ-V(WSS-JCPT).
           MOVE ZEROES TO WSS-VAL-CAMO-V(WSS-JCPT).
           MOVE ZEROES TO WSS-VAL-COFG-V(WSS-JCPT).
           MOVE ZEROES TO WSS-VAL-TPAG-V(WSS-JCPT).
       FIN-CLR-CPT-VEC.
           EXIT.

       PRO-FLD-QUE SECTION.
       INI-PRO-FLD-QUE.
           MOVE 'P' TO  WSS-FEC-FPAG-MTI-ATR.
           MOVE 'P' TO  WSS-VAL-CAPR-MTI-ATR.
           MOVE 'P' TO  WSS-VAL-INTE-MTI-ATR.
           MOVE 'P' TO  WSS-VAL-COPR-MTI-ATR.
           MOVE 'P' TO  WSS-VAL-CAAD-MTI-ATR.
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
           MOVE 'P' TO  WSS-VAL-MDPS-MTI-ATR.
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
           MOVE 'P' TO  WSS-VAL-REAJ-MTI-ATR.
           MOVE 'P' TO  WSS-VAL-CAMO-MTI-ATR.
           MOVE 'P' TO  WSS-VAL-COFG-MTI-ATR.
           MOVE 'P' TO  WSS-VAL-TPAG-MTI-ATR.
       FIN-PRO-FLD-QUE.
           EXIT.

       BUSCO-DIA-HABIL SECTION.
       INI-BUSCO-DIA-HABIL.
           MOVE WSS-NUM-DCPTPAG  TO FEC-ITM1.
           MOVE WSS-NUM-MCPTPAG  TO FEC-ITM2.
           MOVE WSS-NUM-SCPTPAG  TO FEC-ITM3.
           MOVE WSS-NUM-ACPTPAG  TO FEC-ITM4.
           MOVE FEC-FORM-FEC     TO FEC-FORM.
           MOVE FEC-FBLK-S       TO FEC-FBLK.
           MOVE FEC-CHOY-N       TO FEC-CHOY.
           MOVE FEC-VHBL-S       TO FEC-VHBL.
           MOVE FEC-VAL-FEC      TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-FER
              GO TO FIN-BUSCO-DIA-HABIL.
      *SUM-DIA SUMA  1 DIA LA FECHA
           MOVE FEC-FORM-FEC     TO FEC-FORM.
           MOVE FEC-SUM-DIA      TO FEC-CMND.
           MOVE 1                TO FEC-NDIA.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE FEC-MENS     TO FRM-MENS
               GO TO FIN-BUSCO-DIA-HABIL.
           MOVE FEC-ITM1         TO WSS-NUM-DCPTPAG.
           MOVE FEC-ITM2         TO WSS-NUM-MCPTPAG.
           MOVE FEC-ITM3         TO WSS-NUM-SCPTPAG.
           MOVE FEC-ITM4         TO WSS-NUM-ACPTPAG.
           GO TO INI-BUSCO-DIA-HABIL.
       FIN-BUSCO-DIA-HABIL.
           EXIT.

      *>>>> EOF

      *RGD-INI COPYS
       COPY COLBFEVC.
       COPY COLBFCXE.
       COPY COLBFCYA.
       COPY COLBFROV.
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *COPY COLBFTOC.
       COPY COLBFTOC REPLACING COL-FIO-TOC BY KOL-FIO-TOC.
       COL-FIO-TOC SECTION.
       INI-COL-FIO-TOC.
           MOVE WCC-TOC TO TOC-COD-TTAB IN TOC.
           MOVE WCC-1 TO WSS-IND-TOC.
       LOOP-TAB-TOC.
           IF WSS-IND-TOC > WCC-N100
               PERFORM KOL-FIO-TOC
               GO TO FIN-COL-FIO-TOC.

           IF VTOC-COD-TABL(WSS-IND-TOC) NOT > SPACES
               MOVE TOC-COD-TABL IN TOC TO VTOC-COD-TABL(WSS-IND-TOC)
               PERFORM KOL-FIO-TOC
               MOVE FIO-STAT TO VTOC-FIO-STAT(WSS-IND-TOC)
               MOVE TOC TO VTOC-GLS-TABL(WSS-IND-TOC)
               GO TO FIN-COL-FIO-TOC.

           IF VTOC-COD-TABL(WSS-IND-TOC) = TOC-COD-TABL IN TOC
               MOVE VTOC-COD-TABL(WSS-IND-TOC) TO TOC
               MOVE VTOC-FIO-STAT(WSS-IND-TOC) TO FIO-STAT
               MOVE SPACES   TO FIO-AKEY
               GO TO FIN-COL-FIO-TOC.

           ADD WCC-1 TO WSS-IND-TOC.
           GO TO LOOP-TAB-TOC.
       FIN-COL-FIO-TOC.
           EXIT.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
       COPY COLBFRCV.
       COPY LDCBFRLO.
       COPY LDCBFLDC.
       COPY LDCBFLCC.

       COPY SGCBFDCP.
       COPY SGCBFDCE.
       COPY COLBFITR.
       COPY COLBFDIC.
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *COPY COLBFVEN.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      *AFRI-INI 29-JUN-2012 CORRECCION CAE
      *COPY COLBGINT.
       COPY COLBGYNT.
       COPY TABBFTXC.
      *AFRI-FIN 29-JUN-2012 CORRECCION CAE
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *COPY TABBFCAM.
       COPY TABBFCAM REPLACING TAB-FIO-CAM BY TAV-FIO-CAM.
       TAB-FIO-CAM SECTION.
       INI-TAB-FIO-CAM.
           MOVE WCC-1 TO WSS-IND-CAM.
       LOOP-TAB-CAM.
           IF WSS-IND-CAM > WCC-N100
               PERFORM TAV-FIO-CAM
               GO TO FIN-TAB-FIO-CAM.

           IF VCAM-KEY-CAMB(WSS-IND-CAM) NOT > SPACES
               MOVE CAM-KEY-CAMB IN CAM TO VCAM-KEY-CAMB(WSS-IND-CAM)
               PERFORM TAV-FIO-CAM
               MOVE FIO-STAT TO VCAM-FIO-STAT(WSS-IND-CAM)
               MOVE CAM TO VCAM-GLS-TABL(WSS-IND-CAM)
               GO TO FIN-TAB-FIO-CAM.

           IF VCAM-KEY-CAMB(WSS-IND-CAM) = CAM-KEY-CAMB IN CAM
               MOVE VCAM-GLS-TABL(WSS-IND-CAM) TO CAM
               MOVE VCAM-FIO-STAT(WSS-IND-CAM) TO FIO-STAT
               MOVE SPACES   TO FIO-AKEY
               GO TO FIN-TAB-FIO-CAM.

           ADD WCC-1 TO WSS-IND-CAM.
           GO TO LOOP-TAB-CAM.

       FIN-TAB-FIO-CAM.
           EXIT.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
       COPY TABBFUSR.
       COPY COLBGMPC.


       COPY COLB6CAN.
       COPY COLBFPCP.
       COPY COLBGPCP.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *COPY COLBGLOF.
      * FORMULAS - COBRO COMISION FOGAPE - LOF CON CANCELACIONES
      *=========================================================

       LOC-COM-FGP SECTION.
       INI-LOC-COM-FGP.
           PERFORM INI-VAR-LOC.

           PERFORM LOC-DET-MON.
           IF LOC-GLS-NOCO IN LOC-VARI = 'NOCOBRACOM'
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE 'CODTVLRNEX' TO LOC-GLS-MENS IN LOC-VARI
               GO TO FIN-LOC-COM-FGP.

           PERFORM DET-COM-OPER.
           IF LOC-OPEC IN LOC-VARI = 'B' OR
             LOC-COD-TOOC IN LOC-VARI = 'AVC'
               MOVE 'NOCOBRACOM' TO LOC-GLS-NOCO IN LOC-VARI
               GO TO FIN-LOC-COM-FGP.

           PERFORM LOC-DET-FOG.
           IF LOC-GLS-NOCO IN LOC-VARI = 'NOCOBRACOM'
               GO TO FIN-LOC-COM-FGP.

           PERFORM LOC-TIP-CAN.
           IF LOC-GLS-NOCO IN LOC-VARI = 'NOCOBRACOM'
               GO TO FIN-LOC-COM-FGP.

           PERFORM LOC-MOD-CAN.

           IF LOC-CXE-FVEN IN LOC-VARI NOT > ZEROES
               PERFORM BUS-CXE-FGF.

      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
           PERFORM BUS-CXE-CIE-RCV.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
      *SE LEE RLO PARA OBTENER EL % GARANTIZADO - RLO-VAL-PGAR (%GTIA)
           MOVE LOC-CAI-IOPC IN LOC-VARI TO RLO-CAI-IOPC IN RLO.
           MOVE LOC-IIC-IOPC IN LOC-VARI TO RLO-IIC-IOPC IN RLO.
           MOVE ZEROES                   TO RLO-NUM-IOPC IN RLO.
           MOVE 'RLO-KEY-IOPC' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM LDC-FIO-RLO.
           IF NOT FIO-STAT-OKS OR
            (LOC-CAI-IOPC IN LOC-VARI NOT = RLO-CAI-IOPC IN RLO AND
            LOC-IIC-IOPC IN LOC-VARI NOT = RLO-IIC-IOPC IN RLO AND
            RLO-NUM-IOPC IN RLO NOT = ZEROES)
               MOVE 'DEU'        TO MSG-COD-SIST
               MOVE 'RLO    NEX' TO LOC-GLS-MENS IN LOC-VARI
               GO TO FIN-LOC-COM-FGP.

      *SE LEE LCC PARA OBTENER LA COMISION ORIGEN, LCC-SGV-CORI(%COMFGP)
           MOVE RLO-CIC-ILIC IN RLO TO LCC-CIC-ILIC IN LCC.
           MOVE 'LCC-KEY-ILIC' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM LDC-FIO-LCC.
           IF NOT FIO-STAT-OKS
               MOVE 'DEU'        TO MSG-COD-SIST
               MOVE 'LCC    NEX' TO LOC-GLS-MENS IN LOC-VARI
               GO TO FIN-LOC-COM-FGP.

      *SE LEE DLC PARA OBTENER FECHA MAXIMO VENCIMIENTO PARA PAGO TOTAL
           MOVE LOC-CAI-IOPC IN LOC-VARI TO DLC-CAI-IOPC IN DLC.
           MOVE LOC-IIC-IOPC IN LOC-VARI TO DLC-IIC-IOPC IN DLC.
           MOVE 001                      TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY              TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
               MOVE 'DLC    NEX' TO LOC-GLS-MENS IN LOC-VARI
               GO TO FIN-LOC-COM-FGP.

      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
           PERFORM DET-COMI-CTE.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
           PERFORM LOC-DET-COM.
           IF LOC-GLS-TCAN IN LOC-VARI = 'NOCOBRACOM'
               GO TO FIN-LOC-COM-FGP.

           ADD LOC-VAL-MNTO IN LOC-VARI TO LOC-COM-FGPE IN LOC-VARI.
           ADD LOC-VAL-MCAN IN LOC-VARI TO LOC-COM-FGPE IN LOC-VARI.

           IF LOC-CIC-TVAL IN LOC-VARI = 'N'
               PERFORM LOC-CON-MON
               IF LOC-GLS-MENS IN LOC-VARI = 'NOCOBRACOM'
                   GO TO FIN-LOC-COM-FGP
               ELSE
                   NEXT SENTENCE
           ELSE
              MOVE LOC-VAL-MCAN IN LOC-VARI TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO LOC-VAL-MCAN IN LOC-VARI
              MOVE LOC-COM-FGPE IN LOC-VARI TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO LOC-COM-FGPE IN LOC-VARI.

      *    PERFORM LOC-GRA-CXE.

       FIN-LOC-COM-FGP.
           EXIT.
      *----------------------------------------------------------------
      *LEE TABLA LCT PARA DETERMINAR LA BASE DE LA TASA COMISION FOGAPE
      *SEGUN LICITACION.
      *----------------------------------------------------------------
       LOC-LEE-LCT SECTION.
       INI-LOC-LEE-LCT.
           MOVE 'COL'       TO TAB-COD-SIST FIO-SIST.
           MOVE 'LCT'       TO TAB-COD-TTAB IN TAB.
           MOVE 'TASA'      TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
               MOVE 360 TO LOC-BAS-FGPE IN LOC-VARI
           ELSE
               IF TAB-COD-DAT1(1) = 'A'
                   MOVE 360 TO LOC-BAS-FGPE IN LOC-VARI
               ELSE
               IF TAB-COD-DAT1(1) = 'M'
                   MOVE 30 TO LOC-BAS-FGPE IN LOC-VARI
               ELSE
               IF TAB-COD-DAT1(1) = 'D'
                   MOVE 1 TO LOC-BAS-FGPE IN LOC-VARI.
       FIN-LOC-LEE-LCT.
           EXIT.
      *----------------------------------------------------------------
      *DETERMINA LA COMISION FOGAPE SEGUN EL ESTADO DE LA CUOTA A PAGAR
      *----------------------------------------------------------------
       LOC-DET-COM SECTION.
       INI-LOC-DET-COM.
      *CUOTA VIGENTE - PAGO ANTICIPADO - PAGO A LA FECHA
           IF (LOC-MSC-MCAN IN LOC-VARI = 'A' OR
            LOC-MSC-MCAN IN LOC-VARI = 'F')
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *        MOVE LOC-CXE-DVEN IN LOC-VARI TO LOC-NUM-DUN IN LOC-VARI
      *        MOVE LOC-CXE-MVEN IN LOC-VARI TO LOC-NUM-MUN IN LOC-VARI
      *        MOVE LOC-CXE-SVEN IN LOC-VARI TO LOC-NUM-SUN IN LOC-VARI
      *        MOVE LOC-CXE-AVEN IN LOC-VARI TO LOC-NUM-AUN IN LOC-VARI
      *        MOVE LOC-NUM-DCAN IN LOC-VARI TO LOC-NUM-DDO IN LOC-VARI
      *        MOVE LOC-NUM-MCAN IN LOC-VARI TO LOC-NUM-MDO IN LOC-VARI
      *        MOVE LOC-NUM-SCAN IN LOC-VARI TO LOC-NUM-SDO IN LOC-VARI
      *        MOVE LOC-NUM-ACAN IN LOC-VARI TO LOC-NUM-ADO IN LOC-VARI
               PERFORM MOV-FEC-ANTI
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
               PERFORM LOC-DIF-DIA
               PERFORM LOC-PRO-CIE
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *        MOVE LOC-VAL-SALD IN LOC-VARI TO LOC-VAL-SCRE IN LOC-VARI
               COMPUTE LOC-VAL-SCRE IN LOC-VARI =
                       LOC-VAL-SALD IN LOC-VARI - LOC-VAL-TKAP
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
               PERFORM LOC-DET-SCR
               MOVE LOC-VAL-COMI IN LOC-VARI TO LOC-VAL-MNTO
                                                         IN LOC-VARI
           ELSE
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
           IF LOC-MSC-MCAN IN LOC-VARI = WSS-GLS-VVVV AND
              ( LOC-MSC-CANC IN LOC-VARI = WSS-GLS-ICTE OR
                LOC-MSC-CANC IN LOC-VARI = WSS-GLS-ICIE )
               PERFORM CAL-COMI-TOTA
           ELSE
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
      *PLAZOMOR - CUOTA ATRASADA O MOROSA
           IF LOC-MSC-MCAN IN LOC-VARI = 'V'
      *HASTA LA FECHA DE VENCIMIENTO DE LA CUOTA
               MOVE LOC-CXE-DVEN IN LOC-VARI TO LOC-NUM-DUN IN LOC-VARI
               MOVE LOC-CXE-MVEN IN LOC-VARI TO LOC-NUM-MUN IN LOC-VARI
               MOVE LOC-CXE-SVEN IN LOC-VARI TO LOC-NUM-SUN IN LOC-VARI
               MOVE LOC-CXE-AVEN IN LOC-VARI TO LOC-NUM-AUN IN LOC-VARI
               MOVE LOC-NUM-DVEN IN LOC-VARI TO LOC-NUM-DDO IN LOC-VARI
               MOVE LOC-NUM-MVEN IN LOC-VARI TO LOC-NUM-MDO IN LOC-VARI
               MOVE LOC-NUM-SVEN IN LOC-VARI TO LOC-NUM-SDO IN LOC-VARI
               MOVE LOC-NUM-AVEN IN LOC-VARI TO LOC-NUM-ADO IN LOC-VARI
               PERFORM LOC-DIF-DIA
               PERFORM LOC-PRO-CIE
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *        MOVE LOC-VAL-SALD IN LOC-VARI TO LOC-VAL-SCRE IN LOC-VARI
               COMPUTE LOC-VAL-SCRE IN LOC-VARI =
                       LOC-VAL-SALD IN LOC-VARI - LOC-VAL-TKAP
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
               PERFORM LOC-DET-SCR
               COMPUTE LOC-VAL-SALD IN LOC-VARI =
                       LOC-VAL-SALD IN LOC-VARI -
                       LOC-VAL-CAPI IN LOC-VARI
               MOVE LOC-VAL-COMI IN LOC-VARI TO LOC-VAL-MNTO
                                                         IN LOC-VARI
      *DESDE LA FECHA DE VENCIMIENTO DE LA CUOTA A LA FECHA DE CAN
               MOVE LOC-NUM-DVEN IN LOC-VARI TO LOC-NUM-DUN IN LOC-VARI
               MOVE LOC-NUM-MVEN IN LOC-VARI TO LOC-NUM-MUN IN LOC-VARI
               MOVE LOC-NUM-SVEN IN LOC-VARI TO LOC-NUM-SUN IN LOC-VARI
               MOVE LOC-NUM-AVEN IN LOC-VARI TO LOC-NUM-AUN IN LOC-VARI
               MOVE LOC-NUM-DCAN IN LOC-VARI TO LOC-NUM-DDO IN LOC-VARI
               MOVE LOC-NUM-MCAN IN LOC-VARI TO LOC-NUM-MDO IN LOC-VARI
               MOVE LOC-NUM-SCAN IN LOC-VARI TO LOC-NUM-SDO IN LOC-VARI
               MOVE LOC-NUM-ACAN IN LOC-VARI TO LOC-NUM-ADO IN LOC-VARI
               PERFORM LOC-DIF-DIA
               PERFORM LOC-DET-KVE
               PERFORM LOC-DET-SCR
               MOVE LOC-VAL-COMI IN LOC-VARI TO LOC-VAL-MCAN
                                                         IN LOC-VARI
           ELSE
               MOVE 'NOCOBRACOM' TO LOC-GLS-TCAN IN LOC-VARI.
       FIN-LOC-DET-COM.
           EXIT.
      *----------------------------------------------------------------
      *
      *----------------------------------------------------------------
       LOC-CON-CAP SECTION.
       INI-LOC-CON-CAP.

           IF LOC-COD-VCOC IN LOC-VARI = LOC-COD-PESO IN LOC-VARI
               GO TO FIN-LOC-CON-CAP.


           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTPAG-R
               MOVE LOC-COD-VCOC IN LOC-VARI TO CAM-COD-VCAM IN CAM(1)
               MOVE LOC-COD-PESO IN LOC-VARI TO CAM-COD-VCAM IN CAM(2)
               MOVE LOC-NUM-DCAN IN LOC-VARI TO CAM-NUM-DCAM IN CAM(1)
               MOVE LOC-NUM-MCAN IN LOC-VARI TO CAM-NUM-MCAM IN CAM(1)
               MOVE LOC-NUM-SCAN IN LOC-VARI TO CAM-NUM-SCAM IN CAM(1)
               MOVE LOC-NUM-ACAN IN LOC-VARI TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT (FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
                   IF WSS-FEC-CPTPAG-R = LOC-FEC-FCAN IN LOC-VARI OR
                      VEN-FEC-FVEN IN VEN = LOC-FEC-FCAN IN LOC-VARI
                       MOVE WSS-VAL-CPTPGO TO CAM-SGV-VCAM IN CAM
                   ELSE
                  MOVE 'TAB'        TO MSG-COD-SIST
                  MOVE 'CAM    NEX' TO LOC-GLS-MENS IN LOC-VARI
                  GO TO FIN-LOC-CON-CAP
           ELSE
               MOVE WSS-VAL-CPTPGO TO CAM-SGV-VCAM IN CAM.



           MULTIPLY LOC-RCV-CAPI IN LOC-VARI BY CAM-SGV-VCAM IN CAM
                                       GIVING LOC-RCV-CAPI IN LOC-VARI.
           MOVE LOC-RCV-CAPI IN LOC-VARI TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV
           MOVE PES-SGV-ENTE IN PES-VARI TO LOC-RCV-CAPI IN LOC-VARI.
       FIN-LOC-CON-CAP.
           EXIT.
      *----------------------------------------------------------------
      *
      *----------------------------------------------------------------
       LOC-INI-OPC SECTION.
       INI-LOC-INI-OPC.
           MOVE OPC-COD-TOOC IN OPC TO LOC-COD-TOOC IN LOC-VARI.
           MOVE OPC-COD-VCOC IN OPC TO LOC-COD-VCOC IN LOC-VARI.
           MOVE OPC-VAL-CRED IN OPC TO LOC-VAL-CRED IN LOC-VARI.
           MOVE OPC-NUM-VCOR IN OPC TO LOC-NUM-VCOR IN LOC-VARI.
           MOVE OPC-IND-GARA IN OPC TO LOC-IND-GARA IN LOC-VARI.
           MOVE OPC-COD-CDOC IN OPC TO LOC-COD-CDOC IN LOC-VARI.
           MOVE OPC-FEC-FCOL IN OPC TO LOC-FEC-FCOL IN LOC-VARI.
           MOVE OPC-CAI-IOPC IN OPC TO BDO-CAI-IOPC IN BDO-VARI.
           MOVE OPC-IIC-IOPC IN OPC TO BDO-IIC-IOPC IN BDO-VARI.
       FIN-LOC-INI-OPC.
           EXIT.
      *----------------------------------------------------------------
      *ASIGNA VALOR A LOC-VAL-SCRE SEGUN NUMERO DE VENCIMIENTOS
      *----------------------------------------------------------------
       LOC-DET-KVE SECTION.
       INI-LOC-DET-KVE.
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *    MOVE LOC-VAL-CAPI IN LOC-VARI TO LOC-VAL-SCRE IN LOC-VARI.
           COMPUTE LOC-VAL-SCRE IN LOC-VARI =
                   LOC-VAL-CAPI IN LOC-VARI - LOC-VAL-TKAP.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
       FIN-LOC-DET-KVE.
           EXIT.
      *----------------------------------------------------------------
      *DETERMINA LA DIFERENCIA DE DIAS QUE EXISTE ENTRE EL ULTIMO
      *COBRO DE COMISION FOGAPE Y LA FECHA DE CANCELACION O DE
      *VENCIMIENTO SEGUN SEA EL CASO
      *----------------------------------------------------------------
       LOC-DIF-DIA SECTION.
       INI-LOC-DIF-DIA.
           MOVE LOC-NUM-DUN IN LOC-VARI TO FEC-DEC1.
           MOVE LOC-NUM-MUN IN LOC-VARI TO FEC-MEC1.
           MOVE LOC-NUM-SUN IN LOC-VARI TO FEC-SEC1.
           MOVE LOC-NUM-AUN IN LOC-VARI TO FEC-AEC1.
           MOVE LOC-NUM-DDO IN LOC-VARI TO FEC-DEC2.
           MOVE LOC-NUM-MDO IN LOC-VARI TO FEC-MEC2.
           MOVE LOC-NUM-SDO IN LOC-VARI TO FEC-SEC2.
           MOVE LOC-NUM-ADO IN LOC-VARI TO FEC-AEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           MOVE FEC-NDIA TO LOC-SGV-PLZO IN LOC-VARI.
           IF FIO-STAT NOT = '00'
               MOVE 'NOCOBRACOM' TO LOC-GLS-TCAN IN LOC-VARI.
       FIN-LOC-DIF-DIA.
           EXIT.
      *----------------------------------------------------------------
      *CALCULA LA COMISION FOGAPE (FORMULA)
      *----------------------------------------------------------------
       LOC-DET-SCR SECTION.
       INI-LOC-DET-SCR.
      *ALD-AFRI-INI/CALCULO COMISION
      *    COMPUTE LOC-VAL-SGAR IN LOC-VARI =
      *     (RLO-VAL-PGAR IN RLO * LCC-SGV-CORI IN LCC) / 10000.
      *    MULTIPLY LOC-VAL-SGAR IN LOC-VARI BY LOC-SGV-PLZO IN LOC-VARI
      *     GIVING LOC-VAL-SCOR IN LOC-VARI.
           COMPUTE LOC-VAL-SCOR = ( RLO-VAL-PGAR IN RLO *
                                    LCC-SGV-CORI IN LCC *
                                    LOC-SGV-PLZO IN LOC-VARI) / 10000.
           PERFORM LOC-LEE-LCT.
      *    DIVIDE LOC-VAL-SCOR IN LOC-VARI BY LOC-BAS-FGPE IN LOC-VARI
      *     GIVING LOC-VAL-SPLZ IN LOC-VARI.
           DIVIDE LOC-VAL-SCRE IN LOC-VARI BY LOC-BAS-FGPE IN LOC-VARI
            GIVING LOC-VAL-SPLZ IN LOC-VARI.
      *    MULTIPLY LOC-VAL-SPLZ IN LOC-VARI BY LOC-VAL-SCRE IN LOC-VARI
      *     GIVING LOC-VAL-COMI IN LOC-VARI.
           MULTIPLY LOC-VAL-SPLZ IN LOC-VARI BY LOC-VAL-SCOR IN LOC-VARI
            GIVING LOC-VAL-COMI IN LOC-VARI.
      *ALD-AFRI-FIN/CALCULO COMISION
       FIN-LOC-DET-SCR.
           EXIT.
      *----------------------------------------------------------------
      *GRABA LA COMISION FOGAPE EN LA CXE
      *----------------------------------------------------------------
       LOC-GRA-CXE SECTION.
       INI-LOC-GRA-CXE.
           MOVE LOW-VALUES               TO CXE.
           MOVE SPACES                   TO CXE-GLS-FLAG IN CXE.
           MOVE LOC-CAI-IOPC IN LOC-VARI TO CXE-CAI-IOPC IN CXE.
           MOVE LOC-IIC-IOPC IN LOC-VARI TO CXE-IIC-IOPC IN CXE.
           MOVE 'CAN'                    TO CXE-COD-EVEN IN CXE.
           MOVE LOC-NUM-ICAN IN LOC-VARI TO CXE-NUM-EVEN IN CXE.
           MOVE SPACES                   TO CXE-CIC-IOPV IN CXE.
           MOVE ZEROES                   TO CXE-NUM-IVCT IN CXE.
           MOVE 'COMFGF'                 TO CXE-COD-CPTO IN CXE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CXE.
           IF FIO-STAT-OKS
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM COL-FIO-CXE
               MOVE FIO-MOD TO FIO-CMND
           ELSE
               MOVE FIO-PUT TO FIO-CMND.
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
           MOVE LOC-MSC-MCAN IN LOC-VARI TO CXE-MSC-STAT IN CXE.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
           MOVE LOC-COM-FGPE IN LOC-VARI TO CXE-SGV-MNTO IN CXE.
           MOVE LOC-COM-FGPE IN LOC-VARI TO CXE-SGV-MCAL IN CXE.
           MOVE LOC-VAL-MCAN IN LOC-VARI TO CXE-SGV-MCAM IN CXE.
           MOVE LOC-FEC-FVEN IN LOC-VARI TO CXE-FEC-FVEN IN CXE.
           PERFORM COL-FIO-CXE.
       FIN-LOC-GRA-CXE.
           EXIT.
      *----------------------------------------------------------------
      *DETERMINA SI EL CREDITO ES FOGAPE
      *----------------------------------------------------------------
       LOC-DET-FOG SECTION.
       INI-LOC-DET-FOG.
           MOVE 'NOCOBRACOM'             TO LOC-GLS-NOCO IN LOC-VARI.
           MOVE 'COL'                    TO FIO-SIST.
           MOVE 'GARA'                   TO MSC-COD-TMSC IN MSC.
           MOVE LOC-IND-GARA IN LOC-VARI TO MSC-COD-CMSC IN MSC.
           MOVE FIO-GET-KEY              TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT (FIO-STAT-OKS AND MSC-IND-VIGE IN MSC = 'S')
               GO TO FIN-LOC-DET-FOG.
           IF MSC-GLS-DATA IN MSC(60:1) NOT = 'F'
               GO TO FIN-LOC-DET-FOG.

           MOVE 'COL'                    TO TAB-COD-SIST FIO-SIST.
           MOVE 'DES'                    TO TAB-COD-TTAB IN TAB.
           MOVE LOC-COD-CDOC IN LOC-VARI TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
               IF (TAB-GLS-DATA IN TAB(60:1) = 'K' OR
                TAB-GLS-DATA IN TAB(60:1) = 'I')
                  MOVE 'SICOBRACOM' TO LOC-GLS-NOCO IN LOC-VARI.
       FIN-LOC-DET-FOG.
           EXIT.
      *----------------------------------------------------------------
      *LEE TABLA VLR PARA DETERMINAR EL CODIGO DE MONEDA (PESO Y UF)
      *----------------------------------------------------------------
       LOC-DET-MON SECTION.
       INI-LOC-DET-MON.
           MOVE 'SICOBRACOM' TO LOC-GLS-NOCO IN LOC-VARI.

      *CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
      *    MOVE 'TAB'          TO TAB-COD-SIST FIO-SIST.
      *    MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
      *    MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
      *    MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
      *    MOVE FIO-GET-KEY    TO FIO-CMND.
      *    PERFORM GNS-FIO-TAB.
      *    IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
           IF WSS-IND-V999 IN WSS-VARI = 1
      *CIMA-FIN 29-JUL-2014 OPT TRANSAC LENTAS
               MOVE 'NOCOBRACOM' TO LOC-GLS-NOCO IN LOC-VARI
               GO TO FIN-LOC-DET-MON
           ELSE
      *CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
      *        MOVE TAB-COD-CTAB IN TAB TO LOC-COD-PESO IN LOC-VARI
               MOVE WSS-COD-PESO        TO LOC-COD-PESO IN LOC-VARI
      *CIMA-FIN 29-JUL-2014 OPT TRANSAC LENTAS
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
      *        IF LOC-COD-VCOC IN LOC-VARI = TAB-COD-CTAB IN TAB
               IF LOC-COD-VCOC IN LOC-VARI = WSS-COD-PESO
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS      
                   MOVE 'S' TO LOC-CIC-TVAL IN LOC-VARI
                   GO TO FIN-LOC-DET-MON
               ELSE
                   MOVE 'N' TO LOC-CIC-TVAL IN LOC-VARI.
       FIN-LOC-DET-MON.
           EXIT.
      *----------------------------------------------------------------
      *DETERMINA EL MODO DE LA CANCELACION
      *PAGO ANTICIPADO (A) - PAGO A LA FECHA (F) - PAGO MOROSO (V)
      *----------------------------------------------------------------
       LOC-MOD-CAN SECTION.
       INI-LOC-MOD-CAN.
           IF LOC-FEC-FCAN IN LOC-VARI < LOC-FEC-FVEN IN LOC-VARI
               MOVE 'A' TO LOC-MSC-MCAN IN LOC-VARI
           ELSE
           IF LOC-FEC-FCAN IN LOC-VARI > LOC-FEC-FVEN IN LOC-VARI
               MOVE 'V' TO LOC-MSC-MCAN IN LOC-VARI
           ELSE
               MOVE 'F' TO LOC-MSC-MCAN IN LOC-VARI.
       FIN-LOC-MOD-CAN.
           EXIT.
      *----------------------------------------------------------------
      *RUTINA BDO
      *----------------------------------------------------------------
       LOC-OPC-ORI SECTION.
       INI-LOC-OPC-ORI.
           PERFORM LOC-LLE-ENT.
           MOVE SPACES TO LOC-IND-RBDO IN LOC-VARI.
           MOVE SPACES TO LOC-GLS-NOCO IN LOC-VARI.

      *    INGRESA PARAMETROS DE ENTRADA BGBDO
           MOVE LOC-CAI-IOPC IN LOC-VARI TO BDO-CAI-IOPC IN BDO-VARI.
           MOVE LOC-IIC-IOPC IN LOC-VARI TO BDO-IIC-IOPC IN BDO-VARI.
           PERFORM GET-FHOY.
           MOVE HOY-FHOY TO BDO-FEC-FPRO IN BDO-VARI.

           PERFORM BDO-OPE-ANT.
           PERFORM BDO-OPE-ORI.
           MOVE BDO-CIC-ORIG TO BDO-CIC-IOPC IN BDO-VARI.
           IF (BDO-CIC-PROR > SPACES)
               MOVE BDO-CIC-PROR TO BDO-CIC-IOPC IN BDO-VARI.

           MOVE BDO-CIC-IOPC IN BDO-VARI TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           MOVE OPC-IND-GARA IN OPC TO LOC-IND-GARA IN LOC-VARI.
           MOVE OPC-COD-CDOC IN OPC TO LOC-COD-CDOC IN LOC-VARI.
           MOVE OPC-FEC-FCOL IN OPC TO LOC-ORI-FCOL IN LOC-VARI.
           PERFORM LOC-DET-FOG.
           IF LOC-GLS-NOCO IN LOC-VARI = 'NOCOBRACOM'
               PERFORM LOC-RES-ENT
               GO TO FIN-LOC-OPC-ORI.

           PERFORM OBT-SAL-OPC.
           PERFORM BUS-OPC-VOPC.
           IF LOC-IND-RBDO IN LOC-VARI = 'S' OR 'R'
               IF LOC-IND-RBDO IN LOC-VARI = 'S'
                   MOVE LOC-CIC-RBDO IN LOC-VARI TO OPC-CIC-IOPC IN OPC
                   MOVE FIO-GET-KEY TO FIO-CMND
                   PERFORM COL-FIO-OPC
                   MOVE OPC-FEC-FCOL IN OPC TO LOC-CXE-FVEN IN LOC-VARI
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE ZEROES TO LOC-CXE-FVEN IN LOC-VARI.

           PERFORM LOC-RES-ENT.
       FIN-LOC-OPC-ORI.
           EXIT.
      *----------------------------------------------------------------
      *TRANFORMA A PESO LAS VARIABLES QUE SE ULTILIZAN EN EL CALCULO DE
      *LA COMISION EN EL CASO DE QUE LA MONEDA DEL CREDITO SEA UF
      *RAZON = EN LA CXE LOS VALORES SE ALMACENAN EN PESOS
      *----------------------------------------------------------------
       LOC-CON-MON SECTION.
       INI-LOC-CON-MON.


           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTPAG-R
               MOVE LOC-COD-VCOC IN LOC-VARI TO CAM-COD-VCAM IN CAM(1)
               MOVE LOC-COD-PESO IN LOC-VARI TO CAM-COD-VCAM IN CAM(2)
               MOVE LOC-NUM-DCAN IN LOC-VARI TO CAM-NUM-DCAM IN CAM(1)
               MOVE LOC-NUM-MCAN IN LOC-VARI TO CAM-NUM-MCAM IN CAM(1)
               MOVE LOC-NUM-SCAN IN LOC-VARI TO CAM-NUM-SCAM IN CAM(1)
               MOVE LOC-NUM-ACAN IN LOC-VARI TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT (FIO-STAT-OKS AND CAM-IND-VIGE = 'S')
                   IF WSS-FEC-CPTPAG-R = LOC-FEC-FCAN IN LOC-VARI OR
                      VEN-FEC-FVEN IN VEN = LOC-FEC-FCAN IN LOC-VARI
                       MOVE WSS-VAL-CPTPGO TO CAM-SGV-VCAM IN CAM
                   ELSE
                  MOVE 'TAB'        TO MSG-COD-SIST
                  MOVE 'CAM    NEX' TO LOC-GLS-MENS IN LOC-VARI
                  GO TO FIN-LOC-CON-MON
           ELSE
               MOVE WSS-VAL-CPTPGO TO CAM-SGV-VCAM IN CAM.


           MULTIPLY LOC-VAL-MCAN IN LOC-VARI BY CAM-SGV-VCAM IN CAM
                                        GIVING LOC-VAL-MCAN IN LOC-VARI.
           MOVE LOC-VAL-MCAN IN LOC-VARI TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO LOC-VAL-MCAN IN LOC-VARI.
           MULTIPLY LOC-COM-FGPE IN LOC-VARI BY CAM-SGV-VCAM IN CAM
                                        GIVING LOC-COM-FGPE IN LOC-VARI.
           MOVE LOC-COM-FGPE IN LOC-VARI TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO LOC-COM-FGPE IN LOC-VARI.
       FIN-LOC-CON-MON.
           EXIT.
      *----------------------------------------------------------------
      *INICIALIZA VARIABLES LOC DE ENTRADA Y SALIDA DE LA RUTINA
      *----------------------------------------------------------------
       INI-VAR-LOC SECTION.
       INI-INI-VAR-LOC.
           MOVE ZEROES TO LOC-N        IN LOC-VARI.
           MOVE SPACES TO LOC-CIC-TVAL IN LOC-VARI.
           MOVE SPACES TO LOC-MSC-MCAN IN LOC-VARI.
           MOVE SPACES TO LOC-COD-PESO IN LOC-VARI.
      *    MOVE ZEROES TO LOC-CXE-FVEN IN LOC-VARI.
           MOVE SPACES TO LOC-GLS-TCAN IN LOC-VARI.
           MOVE SPACES TO LOC-GLS-NOCO IN LOC-VARI.
           MOVE ZEROES TO LOC-VAL-SCRE IN LOC-VARI.
           MOVE ZEROES TO LOC-VAL-SGAR IN LOC-VARI.
           MOVE ZEROES TO LOC-VAL-SCOR IN LOC-VARI.
           MOVE ZEROES TO LOC-SGV-PLZO IN LOC-VARI.
           MOVE ZEROES TO LOC-VAL-SPLZ IN LOC-VARI.
           MOVE ZEROES TO LOC-BAS-FGPE IN LOC-VARI.
           MOVE ZEROES TO LOC-VAL-COMI IN LOC-VARI.
           MOVE ZEROES TO LOC-VAL-MNTO IN LOC-VARI.
           MOVE ZEROES TO LOC-VAL-MCAN IN LOC-VARI.
           MOVE ZEROES TO LOC-FEC-FUN  IN LOC-VARI.
           MOVE ZEROES TO LOC-FEC-FDO  IN LOC-VARI.
           MOVE SPACES TO LOC-GLS-MENS IN LOC-VARI.
           MOVE ZEROES TO LOC-COM-FGPE IN LOC-VARI.
       FIN-INI-VAR-LOC.
           EXIT.
      *----------------------------------------------------------------
      *VALIDA QUE TIPOS DE CANCELACION NO SON VALIDAS PARA CREDITOS
      *FOGAPE. DICHOS TIPOS DE CANCELACIONES SE ENCUENTRAN EN LA TABLA
      *TCF
      *----------------------------------------------------------------
       LOC-TIP-CAN SECTION.
       INI-LOC-TIP-CAN.
           MOVE ZEROES       TO LOC-N IN LOC-VARI.
           MOVE 'SICOBRACOM' TO LOC-GLS-NOCO IN LOC-VARI.

           MOVE 'COL'        TO TAB-COD-SIST FIO-SIST.
           MOVE 'TCF'        TO TAB-COD-TTAB IN TAB.
           MOVE SPACES       TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
               MOVE 'NOCOBRACOM' TO LOC-GLS-NOCO IN LOC-VARI
               GO TO FIN-LOC-TIP-CAN.

       LUP-TAB-TCF.
           ADD 1 TO LOC-N IN LOC-VARI.
           IF LOC-N IN LOC-VARI > 10
               GO TO FIN-LOC-TIP-CAN.
           IF LOC-MSC-CANC IN LOC-VARI NOT = TAB-COD-DAT3 IN TAB(LOC-N)
               GO TO LUP-TAB-TCF
           ELSE
               MOVE 'NOCOBRACOM' TO LOC-GLS-NOCO IN LOC-VARI.
       FIN-LOC-TIP-CAN.
           EXIT.
      *----------------------------------------------------------------
      *DETERMINA SI LA OPERACION OPERA COMO BOLETA
      *----------------------------------------------------------------
       DET-COM-OPER SECTION.
       INI-DET-COM-OPER.
           MOVE SPACES TO LOC-OPEC IN LOC-VARI.
           MOVE LOC-COD-TOOC IN LOC-VARI TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM COL-FIO-TOC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'OPCTOOCNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE '00' TO FIO-STAT
               GO TO FIN-DET-COM-OPER.
           MOVE TOC-MSC-OPEC IN TOC TO LOC-OPEC IN LOC-VARI.
       FIN-DET-COM-OPER.
           EXIT.
      *----------------------------------------------------------------
      *
      *----------------------------------------------------------------
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *BUS-CXE-FGF SECTION.
      *INI-BUS-CXE-FGF.
      **SI EXISTE UNA CXE PARA EL NUMERO DE CANCELACION INGRESADO COMO
      **PARAMETRO SE ELIMINA
      **    MOVE LOC-CAI-IOPC IN LOC-VARI TO CXE-CAI-IOPC IN CXE.
      **    MOVE LOC-IIC-IOPC IN LOC-VARI TO CXE-IIC-IOPC IN CXE.
      **    MOVE 'CAN'                    TO CXE-COD-EVEN IN CXE.
      **    MOVE LOC-NUM-ICAN IN LOC-VARI TO CXE-NUM-EVEN IN CXE.
      **    MOVE SPACES                   TO CXE-CIC-IOPV IN CXE.
      **    MOVE ZEROES                   TO CXE-NUM-IVCT IN CXE.
      **    MOVE 'COMFGF'                 TO CXE-COD-CPTO IN CXE.
      **    MOVE FIO-GET-KEY TO FIO-CMND.
      **    PERFORM COL-FIO-CXE.
      **    IF FIO-STAT-OKS
      **        MOVE FIO-GET-KEY-UPD TO FIO-CMND
      **        PERFORM COL-FIO-CXE
      **        MOVE FIO-DEL TO FIO-CMND
      **        PERFORM COL-FIO-CXE
      **        GO TO FIN-BUS-CXE-FGF.
*
      *SE OBTIENE LA FECHA EN LA QUE SE PAGO POR ULTIMA VEZ COMISION FGP
      *SI ES LA PRIMERA VEZ LOC-CXE-FVEN = LOC-FEC-FCOL
      *SI NO ES LA PRIMERA VEZ LOC-CXE-FVEN = CXE-FEC-FVEN
      **    MOVE LOC-FEC-FCOL IN LOC-VARI TO LOC-CXE-FVEN IN LOC-VARI.
      *     MOVE ZEROES TO LOC-IND-REVE IN LOC-VARI.
      *    MOVE LOC-CAI-IOPC IN LOC-VARI TO CXE-CAI-IOPC IN CXE.
      *    MOVE LOC-IIC-IOPC IN LOC-VARI TO CXE-IIC-IOPC IN CXE.
      *     MOVE ZEROES                   TO CXE-NUM-EVEN IN CXE.
      *     MOVE SPACES                   TO CXE-COD-EVEN IN CXE.
      *    MOVE SPACES                   TO CXE-CIC-IOPV IN CXE.
      *    MOVE ZEROES                   TO CXE-NUM-IVCT IN CXE.
      *     MOVE SPACES                   TO CXE-COD-CPTO IN CXE.
      *     MOVE FIO-GET-NLS TO FIO-CMND.
      *LUP-BUS-CXE-FGF.
      *    PERFORM COL-FIO-CXE.
      *    IF FIO-STAT-OKS AND
      *     LOC-CAI-IOPC IN LOC-VARI = CXE-CAI-IOPC IN CXE AND
      *     LOC-IIC-IOPC IN LOC-VARI = CXE-IIC-IOPC IN CXE
      *        IF CXE-COD-EVEN IN CXE = 'CAN' AND
      *         CXE-COD-CPTO IN CXE = 'COMFGF'
      *AFRI-INI/LOF CAN MOD
      *         IF LOC-NUM-ICAN IN LOC-VARI = CXE-NUM-EVEN IN CXE
      *            MOVE FIO-GET-NXT TO FIO-CMND
      *            GO TO LUP-BUS-CXE-FGF
      *         ELSE
      *AFRI-FIN/LOF CAN MOD
      *         IF CXE-SGV-MNTO IN CXE > ZEROES
      *        MOVE LOC-CXE-FVEN IN LOC-VARI TO LOC-CX2-FVEN IN LOC-VARI
      *            MOVE CXE-FEC-FVEN IN CXE TO LOC-CXE-FVEN IN LOC-VARI
      *            ADD 1 TO LOC-IND-REVE IN LOC-VARI
      *            MOVE FIO-GET-NXT TO FIO-CMND
      *            GO TO LUP-BUS-CXE-FGF
      *         ELSE
      *            IF LOC-IND-REVE IN LOC-VARI = ZEROES
      *                MOVE LOC-FEC-FCOL IN LOC-VARI TO
      *                                      LOC-CXE-FVEN IN LOC-VARI
      *                MOVE FIO-GET-NXT TO FIO-CMND
      *                GO TO LUP-BUS-CXE-FGF
      *            ELSE
      *                MOVE LOC-CX2-FVEN IN LOC-VARI TO
      *                                      LOC-CXE-FVEN IN LOC-VARI
      *                MOVE FIO-GET-NXT TO FIO-CMND
      *                GO TO LUP-BUS-CXE-FGF
      *        ELSE
      *            MOVE FIO-GET-NXT TO FIO-CMND
      *            GO TO LUP-BUS-CXE-FGF.
      *FIN-BUS-CXE-FGF.
      *    EXIT.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
      *----------------------------------------------------------------
      *RUTINA COLBGBDO
      *----------------------------------------------------------------
       BDO-OPE-ORI SECTION.
       INI-BDO-OPE-ORI.
      *OBTIENE OPC ORIGINAL

      *    LIMPIA VARIABLES
           MOVE SPACES TO BDO-CIC-ORIG IN BDO-VARI.
           MOVE SPACES TO BDO-CIC-PROR IN BDO-VARI.

      *    BUSCA OPC
           MOVE BDO-CIC-IOPC  IN BDO-VARI   TO OPC-CIC-IOPC IN OPC
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM COL-FIO-OPC
           IF NOT FIO-STAT-OKS
               GO TO FIN-BDO-OPE-ORI.

      *    OPC-IND-RENO = SPACES => OPC ORIG
           IF OPC-IND-RENO IN OPC NOT > SPACES
               MOVE BDO-CIC-IOPC IN BDO-VARI TO BDO-CIC-ORIG IN BDO-VARI
               GO TO FIN-BDO-OPE-ORI.

      *    OPC-IND-RENO = 'PRO' => PRORROGA
      *    BDO-CIC-ORIG = N OPC ORIGINAL
      *    BDO-CIC-PROR = N OPC INFORMACION ORIGINAL
           IF OPC-IND-RENO IN OPC = 'PRO'
                MOVE BDO-CIC-IOPC IN BDO-VARI   TO DLC-CIC-IOPC IN DLC
                MOVE ZEROES                     TO DLC-NUM-IDLC IN DLC
                MOVE FIO-GET-NLS TO FIO-CMND
                PERFORM COL-FIO-DLC
                IF FIO-STAT-OKS AND
                   BDO-CIC-IOPC IN BDO-VARI = DLC-CIC-IOPC IN DLC
                   MOVE DLC-CIC-IOCO IN DLC TO BDO-CIC-PROR IN BDO-VARI
                   MOVE OPC-CIC-IOPC IN OPC TO BDO-CIC-ORIG IN BDO-VARI
                   MOVE SPACES TO ROV
                   MOVE  'N'                TO  BDO-1 IN BDO-VARI
                   GO TO FIN-BDO-OPE-ORI.

           MOVE SPACES TO ROV.
           MOVE SPACES TO BDO-CIC-ORIG IN BDO-VARI.
           MOVE SPACES TO BDO-1        IN BDO-VARI.
       NXT-BDO-OPE-ORI.
           MOVE BDO-CIC-IOPC IN BDO-VARI  TO ROV-CIC-IOPC IN ROV.
           MOVE ROV-CIC-IOPC IN ROV       TO BDO-COD-OPCR IN BDO-VARI.
       LUP-BDO-OPE-ORI.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF NOT ( FIO-STAT-OKS AND
                    BDO-COD-OPCR  = ROV-CIC-IOPC IN ROV )
              GO TO FIN-BDO-OPE-ORI.

           IF BDO-1 IN BDO-VARI = SPACES
              MOVE ROV-CIC-IOPV IN ROV TO  BDO-CIC-ORIG IN BDO-VARI
              MOVE  'N'                TO  BDO-1 IN BDO-VARI.

           MOVE ROV-CIC-IOPV IN ROV TO DLC-CIC-IOPC IN DLC.
           MOVE ROV-CIC-IOPV IN ROV TO BDO-COD-OPCR IN BDO-VARI.
           MOVE 001                 TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
              GO TO FIN-BDO-OPE-ORI.

           MOVE ROV-CIC-IOPV IN ROV TO  BDO-CIC-ORIG IN BDO-VARI.
           IF ( DLC-IND-SCTB IN DLC = SPACES OR 'MUL' )
                 MOVE ROV-CIC-IOPV IN ROV TO  BDO-CIC-ORIG IN BDO-VARI
                 GO TO FIN-BDO-OPE-ORI
           ELSE
              MOVE SPACES TO ROV
              MOVE BDO-COD-OPCR TO ROV-CIC-IOPC IN ROV
              GO TO LUP-BDO-OPE-ORI.

       FIN-BDO-OPE-ORI.
           EXIT.
      *-----------------------------------------------------
       BDO-OPE-ANT SECTION.
       INI-BDO-OPE-ANT.
      *    LIMPIA VARIABLES
           MOVE SPACES TO BDO-CIC-ANTE IN BDO-VARI.
           MOVE SPACES TO BDO-CIC-PROR IN BDO-VARI.

      *    BUSCA OPC
           MOVE BDO-CIC-IOPC  IN BDO-VARI   TO OPC-CIC-IOPC IN OPC
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM COL-FIO-OPC
           IF NOT FIO-STAT-OKS
               GO TO FIN-BDO-OPE-ANT.

      *    OPC-IND-RENO = SPACES => OPC ANTE
           IF OPC-IND-RENO IN OPC NOT > SPACES
               MOVE BDO-CIC-IOPC IN BDO-VARI TO BDO-CIC-ANTE IN BDO-VARI
               GO TO FIN-BDO-OPE-ANT.

      *    OPC-IND-RENO = 'PRO' => PRORROGA
      *    BDO-CIC-ANTE = N OPC ANTERIOR
      *    BDO-CIC-PROR = N OPC INFORMACION ANTERIOR
           IF OPC-IND-RENO IN OPC = 'PRO'
                MOVE BDO-CIC-IOPC IN BDO-VARI TO ROV-CIC-IOPC IN ROV
                MOVE FIO-GET-NLS         TO FIO-CMND
                PERFORM COL-FIO-ROV
                IF (NOT FIO-STAT-OKS OR
                    BDO-CIC-IOPC IN BDO-VARI NOT = ROV-CIC-IOPC IN ROV)
                    GO TO FIN-BDO-OPE-ANT
                ELSE
                    MOVE ROV-CIC-IOPV IN ROV TO BDO-CIC-ANTE IN BDO-VARI
                    GO TO FIN-BDO-OPE-ANT.

      *    => RENOVACIONES

           MOVE SPACES TO ROV.
           MOVE SPACES TO BDO-1        IN BDO-VARI.

           MOVE BDO-CIC-IOPC IN BDO-VARI  TO ROV-CIC-IOPC IN ROV.
           MOVE ROV-CIC-IOPC IN ROV       TO BDO-COD-OPCR IN BDO-VARI.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF NOT ( FIO-STAT-OKS AND
                    BDO-COD-OPCR  = ROV-CIC-IOPC IN ROV )
              GO TO FIN-BDO-OPE-ANT.

           IF BDO-1 IN BDO-VARI = SPACES
              MOVE ROV-CIC-IOPV IN ROV TO  BDO-CIC-ANTE IN BDO-VARI
              MOVE  'N'                TO  BDO-1 IN BDO-VARI.

           MOVE ROV-CIC-IOPV IN ROV TO DLC-CIC-IOPC IN DLC.
           MOVE ROV-CIC-IOPV IN ROV TO BDO-COD-OPCR IN BDO-VARI.
           MOVE 001                 TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
              GO TO FIN-BDO-OPE-ANT.

           MOVE ROV-CIC-IOPV IN ROV TO  BDO-CIC-ANTE IN BDO-VARI.
           IF ( DLC-IND-SCTB IN DLC = SPACES OR 'MUL' )
                 MOVE ROV-CIC-IOPV IN ROV TO  BDO-CIC-ANTE IN BDO-VARI
                 GO TO FIN-BDO-OPE-ANT.

       FIN-BDO-OPE-ANT.
           EXIT.
      *-----------------------------------------------------
       OBT-SAL-OPC SECTION.
       INI-OBT-SAL-OPC.

      *    INICIALIZO VARIABLES:
           MOVE ZEROES TO BDO-VAL-SCRE IN BDO-VARI.
           MOVE SPACES TO BDO-COD-ERRO IN BDO-VARI.
           MOVE SPACES TO BDO-GLS-STAT IN BDO-VARI.
           MOVE SPACES TO BDO-IND-SCTB IN BDO-VARI.
           MOVE SPACES TO BDO-CIC-IOPE IN BDO-VARI.
           MOVE SPACES TO VECTOR-OPC.

      *    BUSCO VCAM PESO
      *CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
      *    PERFORM BUS-PESO.
      *CIMA-FIN 29-JUL-2014 OPT TRANSAC LENTAS
           IF (BDO-COD-PESO IN BDO-VARI NOT > SPACES)
                MOVE 'VCAM NOEX' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.


           MOVE BDO-CIC-IOPC IN BDO-VARI TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF (NOT FIO-STAT-OKS)
                MOVE 'OPC  INEX' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           MOVE OPC-VAL-CRED IN OPC TO BDO-VAL-CRED IN BDO-VARI.
           MOVE OPC-IND-VSTR IN OPC TO BDO-IND-VSTR IN BDO-VARI.
           MOVE OPC-VAL-SCRE IN OPC TO BDO-VAL-SCRE IN BDO-VARI.
           MOVE OPC-COD-VCOC IN OPC TO BDO-COD-VCOC IN BDO-VARI.
           MOVE OPC-NUM-VCOR IN OPC TO BDO-NUM-CTOT IN BDO-VARI.
           MOVE OPC-FEC-FCOL IN OPC TO BDO-FEC-FCAM IN BDO-VARI.
           MOVE OPC-COD-TOOC IN OPC TO LOC-COD-TOOC IN LOC-VARI.
           MOVE OPC-COD-VCOC IN OPC TO LOC-COD-VCOC IN LOC-VARI.
           MOVE OPC-VAL-CRED IN OPC TO LOC-VAL-CRED IN LOC-VARI.
           MOVE OPC-NUM-VCOR IN OPC TO LOC-NUM-VCOR IN LOC-VARI.
           MOVE OPC-IND-GARA IN OPC TO LOC-IND-GARA IN LOC-VARI.
           MOVE OPC-COD-CDOC IN OPC TO LOC-COD-CDOC IN LOC-VARI.
           MOVE OPC-FEC-FCOL IN OPC TO LOC-FEC-FCOL IN LOC-VARI.

           IF (OPC-MSC-STAT IN OPC NOT = 'A')
                MOVE 'OPC NOACA' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           MOVE OPC TO OPC-RES.

           PERFORM OBT-EST-OPC.

           PERFORM BUS-SAL-OPC.

           COMPUTE BDO-VAL-SCRE IN BDO-VARI =
                   BDO-VAL-CRED IN BDO-VARI -
                   BDO-CAN-SCRE IN BDO-VARI.

           IF (BDO-VAL-SCRE IN BDO-VARI NOT > ZEROES)
                MOVE ZEROES TO BDO-VAL-SCRE IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           IF (BDO-NUM-CTOT IN BDO-VARI NOT > BDO-CAN-IVCT)
                MOVE 'CTOT<IVCT' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           IF (BDO-IND-ICTT IN BDO-VARI = 'S')
                MOVE ZEROES  TO BDO-VAL-SCRE IN BDO-VARI
                GO TO FIN-OBT-SAL-OPC.

           COMPUTE BDO-NUM-IVEN IN BDO-VARI =
                   BDO-CAN-IVCT IN BDO-VARI + 1.

           COMPUTE BDO-NUM-CPEN IN BDO-VARI =
                   BDO-NUM-CTOT IN BDO-VARI - BDO-CAN-IVCT IN BDO-VARI.

           MOVE BDO-CAN-IVCT IN BDO-VARI TO BDO-NUM-VPAG IN BDO-VARI.
       FIN-OBT-SAL-OPC.
           EXIT.
      *-----------------------------------------------------
       BUS-SAL-OPC SECTION.
       INI-BUS-SAL-OPC.
      *BUSCA SALDO REAL DE OPC

           MOVE ZEROES       TO BDO-NUM-IVEN IN BDO-VARI.
           MOVE ZEROES       TO BDO-CAN-SCRE IN BDO-VARI.
           MOVE ZEROES       TO BDO-VAL-CAPI IN BDO-VARI.
           MOVE SPACES       TO BDO-IND-ICTT IN BDO-VARI.
           MOVE ZEROES       TO BDO-NUM-IVEN IN BDO-VARI.

      *COMIENZA EL PROCESO
           MOVE BDO-CIC-IOPC IN BDO-VARI TO CAN-CIC-IOPC IN CAN.
           MOVE ZEROES                   TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-NLS              TO FIO-CMND.
       LUP-SAL-OPC.
           PERFORM COL-FIO-CAN.
           IF (NOT FIO-STAT-OKS OR
               BDO-CIC-IOPC IN BDO-VARI NOT = CAN-CIC-IOPC IN CAN)
                GO TO FIN-BUS-SAL-OPC
           ELSE
                MOVE ADR-CAN-REQA TO ADR-BDO-REQA.

           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO NXT-SAL-OPC.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                GO TO NXT-SAL-OPC.

           IF CAN-FEC-FCAN IN CAN > BDO-FEC-FPRO IN BDO-VARI
                GO TO FIN-BUS-SAL-OPC.

      *    VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                PERFORM BUS-CAPI
                ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-CAN-SCRE IN BDO-VARI
                MOVE 'S' TO BDO-IND-ICTT IN BDO-VARI
                GO TO FIN-BUS-SAL-OPC.

      *    VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                PERFORM BUS-CAPI
                ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-CAN-SCRE IN BDO-VARI
                GO TO NXT-SAL-OPC.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                PERFORM BUS-CAPI
                ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-CAN-SCRE IN BDO-VARI
                COMPUTE BDO-CAN-IVCT IN BDO-VARI =
                        BDO-CAN-IVCT IN BDO-VARI - 1
                GO TO NXT-SAL-OPC.

      *    VALIDO TIPO DE CANCELACION: PRORROGA
           IF (CAN-MSC-CANC IN CAN = 'PTT' OR 'KTT')
                PERFORM BUS-CAPI
                MOVE BDO-VAL-CAPI IN BDO-VARI TO
                     BDO-VAL-CRED IN BDO-VARI
                PERFORM BUS-SAL-PTT
                GO TO FIN-BUS-SAL-OPC.

      *    VALIDA SI CANCELACION ES PRODUCTO DE TRASPASO
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-CYA.

      *    SIN CYA => CAN NO TRASPASO
           IF NOT (FIO-STAT-OKS AND
               CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
               CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA)
                PERFORM BUS-CAPI
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    MOVE BDO-VAL-CAPI IN BDO-VARI TO
                    BDO-VAL-CRED IN BDO-VARI
                    PERFORM BUS-SAL-PTT
                    GO TO FIN-BUS-SAL-OPC
               ELSE
                    ADD BDO-VAL-CAPI IN BDO-VARI TO
                        BDO-CAN-SCRE IN BDO-VARI
                    GO TO NXT-SAL-OPC.


      *--------- PRODUCTO TRASPASO ---------
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.

      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')
                ADD 1 TO BDO-NUM-VPAG IN BDO-VARI
                ADD 1 TO BDO-CAN-IVCT IN BDO-VARI
                PERFORM BUS-CAPI
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    MOVE BDO-VAL-CAPI IN BDO-VARI TO
                    BDO-VAL-CRED IN BDO-VARI
                    PERFORM BUS-SAL-PTT
                    GO TO FIN-BUS-SAL-OPC
               ELSE
                    ADD BDO-VAL-CAPI IN BDO-VARI TO
                        BDO-CAN-SCRE IN BDO-VARI
                    GO TO NXT-SAL-OPC.

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')
                ADD 1 TO BDO-NUM-CTRS IN BDO-VARI
                PERFORM BDO-NEW-CAN
      *         NUEVA OPERACION IMPAGA
                IF (BDO-IND-CANC IN BDO-VARI NOT = 'S')
                     ADD BDO-ACU-CAPI IN BDO-VARI TO
                         BDO-CAN-SCRE IN BDO-VARI
                     GO TO FIN-BUS-SAL-OPC
      *         NUEVA OPERACION CANCELADA
                ELSE
                     MOVE BDO-RES-IVCT TO BDO-CAN-IVCT IN BDO-VARI
                     ADD BDO-RES-CAPI IN BDO-VARI TO
                         BDO-CAN-SCRE IN BDO-VARI
                     GO TO NXT-SAL-OPC.

       NXT-SAL-OPC.
           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE ADR-BDO-REQA TO ADR-CAN-REQA.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           GO TO LUP-SAL-OPC.

       FIN-BUS-SAL-OPC.
           EXIT.
      *-----------------------------------------------------
       BUS-CAPI SECTION.
       INI-BUS-CAPI.

           MOVE ZEROES              TO BDO-VAL-CAPI IN BDO-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)
               ADD ZEROES           TO BDO-VAL-CAPI IN BDO-VARI
               GO TO FIN-BUS-CAPI
           ELSE
               ADD  RCV-SGV-CAPI IN RCV TO BDO-VAL-CAPI IN BDO-VARI
               MOVE RCV-NUM-IVCT IN RCV TO BDO-CAN-IVCT IN BDO-VARI
               GO TO FIN-BUS-CAPI.

       FIN-BUS-CAPI.
           EXIT.
      *-----------------------------------------------------
       BDO-NEW-CAN SECTION.
       INI-BDO-NEW-CAN.

           MOVE 'N'    TO BDO-IND-CANC IN BDO-VARI.
           MOVE ZEROES TO BDO-ACU-INTN IN BDO-VARI.
           MOVE ZEROES TO BDO-ACU-CAPI IN BDO-VARI.

           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)
                 GO TO FIN-BDO-NEW-CAN.
           MOVE RCV-SGV-CAPI IN RCV TO BDO-RES-CAPI IN BDO-VARI.
           MOVE RCV-SGV-INTM IN RCV TO BDO-RES-INTM IN BDO-VARI.
           MOVE RCV-NUM-IVCT IN RCV TO BDO-RES-IVCT IN BDO-VARI.

           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                 GO TO FIN-BDO-NEW-CAN.

      *    CAMBIA INTERESES NORMALES A MONEDA OPERACION
           MOVE RCV-SGV-INTN IN RCV TO BDO-INI-INTN IN BDO-VARI.
           PERFORM  CAL-CAM-INTN.
           MOVE BDO-CAM-INTN  TO BDO-RES-INTN IN BDO-VARI.
           MOVE BDO-CAM-INTN  TO BDO-VAL-SINT IN BDO-VARI.

       LUP-BDO-NEW-CAN.
      *--------- BUSCA NUEVA OPERACION -----
           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPC IN ROV.

           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV
                MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV
                MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.

           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-ROV.

           IF (NOT FIO-STAT-OKS OR
               (CAN-MSC-TCAN IN CAN = 'P' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPC IN ROV) OR
               (CAN-MSC-TCAN IN CAN = 'R' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPV IN ROV))
                 GO TO FIN-BDO-NEW-CAN.


           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE ROV-CIC-IOPC IN ROV TO RES-CIC-IOPC IN OPC-RES
                MOVE ROV-CIC-IOPC IN ROV TO RCV-CIC-IOPV IN RCV.

           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE ROV-CIC-IOPV IN ROV TO RES-CIC-IOPC IN OPC-RES
                MOVE ROV-CIC-IOPV IN ROV TO RCV-CIC-IOPV IN RCV.

       LUP-OPC.
           MOVE RES-CIC-IOPC IN OPC-RES TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.

           IF NOT FIO-STAT-OKS
               GO TO FIN-BDO-NEW-CAN.

           IF (OPC-MSC-STAT IN OPC NOT = 'A')
               GO TO FIN-BDO-NEW-CAN.

           PERFORM OBT-EST-OPC.

           MOVE OPC-CIC-IOPC IN OPC TO CAN-CIC-IOPC IN CAN.
           MOVE ZEROES              TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-CAN-TRV.
           PERFORM COL-FIO-CAN.
           IF (NOT FIO-STAT-OKS  OR
               OPC-CIC-IOPC IN OPC NOT = CAN-CIC-IOPC IN CAN)
                GO TO FIN-BDO-NEW-CAN.

           IF CAN-FEC-FCAN IN CAN > BDO-FEC-FPRO IN BDO-VARI
                GO TO FIN-BDO-NEW-CAN.

      *   VALIDO CANCELACION ACTIVA
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO LUP-CAN-TRV.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO LUP-CAN-TRV.

      *   VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                MOVE 'S' TO BDO-IND-CANC IN BDO-VARI
                GO TO FIN-BDO-NEW-CAN.

      *   VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                MOVE 'S' TO BDO-IND-CANC IN BDO-VARI
                GO TO FIN-BDO-NEW-CAN.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                PERFORM BUS-CAPI-TRV
                COMPUTE BDO-NUM-IVCT IN BDO-VARI =
                        BDO-RES-IVCT IN BDO-VARI - 1
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO LUP-CAN-TRV.

           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = CYA-CIC-IOPC IN CYA OR
               CAN-NUM-ICAN IN CAN NOT = CYA-NUM-ICAN IN CYA)
                GO TO INI-BDO-NEW-CAN.


           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.

      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')
                GO TO LUP-BDO-NEW-CAN.

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')
                GO TO LUP-BDO-NEW-CAN.

       FIN-BDO-NEW-CAN.
           EXIT.
      *-----------------------------------------------------
       BUS-CAPI-TRV SECTION.
       INI-BUS-BUS-CAPI-TRV.

           MOVE ZEROES              TO BDO-CAN-INTN IN BDO-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)
                GO TO FIN-BUS-CAPI-TRV.

           IF (RCV-SGV-CAPI IN RCV NOT > ZEROES)
                GO TO FIN-BUS-CAPI-TRV.

           IF BDO-COD-VCOC = OPC-COD-VCOC IN OPC
               MOVE RCV-SGV-CAPI IN RCV TO BDO-SGV-CAPI IN BDO-VARI
           ELSE
               PERFORM CAL-CAM-CAPI.

           IF (BDO-VAL-SINT IN BDO-VARI = BDO-SGV-CAPI IN BDO-VARI)
               MOVE BDO-SGV-CAPI IN BDO-VARI TO BDO-ACU-INTN IN BDO-VARI
               MOVE BDO-SGV-CAPI IN BDO-VARI TO BDO-CAN-INTN IN BDO-VARI
                GO TO VAL-SINT.

           IF (BDO-VAL-SINT IN BDO-VARI < BDO-SGV-CAPI IN BDO-VARI)
               MOVE BDO-RES-INTN IN BDO-VARI TO BDO-ACU-INTN IN BDO-VARI
               MOVE BDO-RES-INTN IN BDO-VARI TO BDO-CAN-INTN IN BDO-VARI
               GO TO VAL-SINT.

           IF (BDO-VAL-SINT IN BDO-VARI > BDO-SGV-CAPI IN BDO-VARI)
                ADD BDO-SGV-CAPI IN BDO-VARI TO BDO-ACU-INTN IN BDO-VARI
               MOVE BDO-SGV-CAPI IN BDO-VARI TO BDO-CAN-INTN IN BDO-VARI
                GO TO VAL-SINT.

       VAL-SINT.

           IF   BDO-VAL-SINT IN BDO-VARI NOT > ZEROES
                 MOVE ZEROES TO BDO-CAN-INTN IN BDO-VARI.

           COMPUTE BDO-VAL-SINT IN BDO-VARI =
                  (BDO-RES-INTN IN BDO-VARI -
                   BDO-ACU-INTN IN BDO-VARI).

           IF   BDO-VAL-SINT IN BDO-VARI NOT > ZEROES
                 MOVE ZEROES TO BDO-VAL-SINT IN BDO-VARI.

       VAL-CAPI.
           COMPUTE BDO-ACU-CAPI IN BDO-VARI =
                   BDO-ACU-CAPI IN BDO-VARI +
                  (BDO-SGV-CAPI IN BDO-VARI  -
                   BDO-CAN-INTN IN BDO-VARI).

       FIN-BUS-CAPI-TRV.
           EXIT.
      *-----------------------------------------------------
       CAL-CAM-INTN SECTION.
       INI-CAL-CAM-INTN.

           IF (BDO-COD-VCOC IN BDO-VARI = BDO-COD-PESO IN BDO-VARI)
                MOVE BDO-INI-INTN IN BDO-VARI TO BDO-CAM-INTN
                GO TO FIN-CAL-CAM-INTN.

           MOVE BDO-COD-VCOC IN BDO-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE BDO-COD-PESO IN BDO-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE BDO-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE BDO-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(2).

           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF (NOT FIO-STAT-OKS OR CAM-IND-VIGE IN CAM NOT = 'S' )
                MOVE ZEROES              TO BDO-CAM-INTN IN BDO-VARI
                GO TO FIN-CAL-CAM-INTN.

           COMPUTE  BDO-CAM-INTN IN BDO-VARI ROUNDED =
                    BDO-INI-INTN IN BDO-VARI /
                    CAM-SGV-VCAM IN CAM.

       FIN-CAL-CAM-INTN.
           EXIT.
      *-----------------------------------------------------
       BUS-CAM-OPC SECTION.
       INI-BUS-CAM-OPC.

           IF (BDO-COD-VCOC IN BDO-VARI = BDO-COD-PESO IN BDO-VARI)
                MOVE BDO-VAL-SCRE IN BDO-VARI TO BDO-CAM-SCRE
                GO TO FIN-BUS-CAM-OPC.

           MOVE BDO-COD-VCOC IN BDO-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE BDO-COD-PESO IN BDO-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE BDO-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE BDO-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(2).

           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF (NOT FIO-STAT-OKS OR CAM-IND-VIGE IN CAM NOT = 'S' )
                MOVE ZEROES TO       BDO-CAM-SCRE
                GO TO FIN-BUS-CAM-OPC.

           COMPUTE  BDO-CAM-SCRE IN BDO-VARI ROUNDED =
                    BDO-VAL-SCRE IN BDO-VARI /
                    CAM-SGV-VCAM IN CAM.

       FIN-BUS-CAM-OPC.
           EXIT.
      *-----------------------------------------------------
       BUS-PESO SECTION.
       INI-BUS-PESO.
      *OBTIENE CODIGO VALOR DE CAMBIO DE PESOS

           MOVE SPACES         TO BDO-COD-PESO IN BDO-VARI.
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS.
           MOVE TAB-COD-CTAB IN TAB TO BDO-COD-PESO IN BDO-VARI.

       FIN-BUS-PESO.
           EXIT.
      *-----------------------------------------------------
       BUS-SAL-PTT SECTION.
       INI-BUS-SAL-PTT.
      *BUSCA SALDO REAL DE OPC (PTT)

           MOVE ZEROES       TO BDO-NUM-IVEN IN BDO-VARI.
           MOVE ZEROES       TO BDO-CAN-SCRE IN BDO-VARI.
           MOVE ZEROES       TO BDO-VAL-CAPI IN BDO-VARI.
           MOVE SPACES       TO BDO-IND-ICTT IN BDO-VARI.
           MOVE ZEROES       TO BDO-NUM-IVEN IN BDO-VARI.

      *    BUSCA NUEVA OPERACION
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF (NOT FIO-STAT-OKS)
                 GO TO FIN-BUS-SAL-PTT.

           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF (NOT FIO-STAT-OKS)
                MOVE 'PTT  INEX' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-BUS-SAL-PTT.

           MOVE OPC-IND-VSTR IN OPC TO BDO-IND-VSTR IN BDO-VARI.
           MOVE OPC-COD-VCOC IN OPC TO BDO-COD-VCOC IN BDO-VARI.
           MOVE OPC-COD-VCOC IN OPC TO BDO-NUM-CTOT IN BDO-VARI.
           MOVE OPC-FEC-FCOL IN OPC TO BDO-FEC-FCAM IN BDO-VARI.

           IF (OPC-MSC-STAT IN OPC NOT = 'A')
                MOVE 'PTT NOACA' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-BUS-SAL-PTT.

           MOVE OPC TO OPC-RES.
           PERFORM OBT-EST-OPC.

      *---------------------------
      *    PERFORM BUS-SAL-OPC.
      *---------------------------

      *COMIENZA EL PROCESO
           MOVE OPC-CIC-IOPC IN OPC      TO CAN-CIC-IOPC IN CAN.
           MOVE ZEROES                   TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-NLS              TO FIO-CMND.
       LUP-SAL-PTT.
           PERFORM COL-FIO-CAN.
           IF (NOT FIO-STAT-OKS OR
               OPC-CIC-IOPC IN OPC NOT = CAN-CIC-IOPC IN CAN)
                GO TO FIN-BUS-SAL-PTT
           ELSE
                MOVE ADR-CAN-REQA TO ADR-PTT-REQA.

           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO NXT-SAL-PTT.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                GO TO NXT-SAL-PTT.

           IF CAN-FEC-FCAN IN CAN > BDO-FEC-FPRO IN BDO-VARI
                GO TO FIN-BUS-SAL-PTT.

      *    VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                PERFORM BUS-CAPI
                ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-CAN-SCRE IN BDO-VARI
                MOVE 'S' TO BDO-IND-ICTT IN BDO-VARI
                GO TO FIN-BUS-SAL-PTT.

      *    VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                PERFORM BUS-CAPI
                ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-CAN-SCRE IN BDO-VARI
                GO TO NXT-SAL-PTT.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                PERFORM BUS-CAPI
                ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-CAN-SCRE IN BDO-VARI
                COMPUTE BDO-CAN-IVCT IN BDO-VARI =
                        BDO-CAN-IVCT IN BDO-VARI - 1
                GO TO NXT-SAL-PTT.

      *    VALIDO TIPO DE CANCELACION: PRORROGA
           IF (CAN-MSC-CANC IN CAN = 'PTT' OR 'KTT')
                GO TO INI-BUS-SAL-PTT.

      *    VALIDA SI CANCELACION ES PRODUCTO DE TRASPASO
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-CYA.

      *    SIN CYA => CAN NO TRASPASO
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = CYA-CIC-IOPC IN CYA OR
               CAN-NUM-ICAN IN CAN NOT = CYA-NUM-ICAN IN CYA)
                PERFORM BUS-CAPI
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    GO TO INI-BUS-SAL-PTT
               ELSE
                    ADD BDO-VAL-CAPI IN BDO-VARI TO
                        BDO-CAN-SCRE IN BDO-VARI
                GO TO NXT-SAL-PTT.


      *--------- PRODUCTO TRASPASO ---------
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.

      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')
                ADD 1 TO BDO-CAN-IVCT IN BDO-VARI
                PERFORM BUS-CAPI
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    GO TO INI-BUS-SAL-PTT
               ELSE
                    ADD BDO-VAL-CAPI IN BDO-VARI TO
                        BDO-CAN-SCRE IN BDO-VARI
                GO TO NXT-SAL-PTT.

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')
                ADD 1 TO BDO-NUM-CTRS IN BDO-VARI
                PERFORM BDO-NEW-CAN
      *         NUEVA OPERACION IMPAGA
                IF (BDO-IND-CANC IN BDO-VARI NOT = 'S')
                     ADD BDO-ACU-CAPI IN BDO-VARI TO
                         BDO-CAN-SCRE IN BDO-VARI
                     GO TO FIN-BUS-SAL-PTT
      *         NUEVA OPERACION CANCELADA
                ELSE
                     MOVE BDO-RES-IVCT TO BDO-CAN-IVCT IN BDO-VARI
                     ADD BDO-RES-CAPI IN BDO-VARI TO
                         BDO-CAN-SCRE IN BDO-VARI
                     GO TO NXT-SAL-PTT.

       NXT-SAL-PTT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE ADR-PTT-REQA TO ADR-CAN-REQA.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           GO TO LUP-SAL-PTT.

       FIN-BUS-SAL-PTT.
           EXIT.
      *-----------------------------------------------------
       CAL-CAM-CAPI SECTION.
       INI-CAL-CAM-CAPI.

           MOVE ZEROES TO  BDO-SGV-CAPI IN BDO-VARI.

           IF (BDO-COD-VCOC IN BDO-VARI = BDO-COD-PESO IN BDO-VARI)
               MOVE RCV-SGV-CAPI IN RCV TO BDO-SGV-CAPI IN BDO-VARI
                GO TO FIN-CAL-CAM-CAPI.

           MOVE BDO-COD-VCOC IN BDO-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE BDO-COD-PESO IN BDO-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE BDO-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(1).
           MOVE BDO-FEC-FPRO IN BDO-VARI TO CAM-FEC-FCAM IN CAM(2).

           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF (NOT FIO-STAT-OKS OR CAM-IND-VIGE IN CAM NOT = 'S' )
                MOVE ZEROES              TO BDO-SGV-CAPI IN BDO-VARI
                GO TO FIN-CAL-CAM-CAPI.

           COMPUTE  BDO-SGV-CAPI IN BDO-VARI ROUNDED =
                    RCV-SGV-CAPI IN RCV /
                    CAM-SGV-VCAM IN CAM.

       FIN-CAL-CAM-CAPI.
           EXIT.
      *-----------------------------------------------------
       GRB-VOPC SECTION.
       INI-GRB-VOPC.

           MOVE 'N'    TO BDO-IND-BUSQ.
           SET BDO-NUM-VOPC TO 1.
       LUP-GRB-VOPC.
           IF (BDO-NUM-VOPC > 200)
                GO TO FIN-GRB-VOPC.

           IF (VOPC-CIC-IOPC(BDO-NUM-VOPC) NOT > SPACES )
                MOVE 'S'    TO BDO-IND-BUSQ
                MOVE BDO-CIC-IOPE IN BDO-VARI TO
                     VOPC-CIC-IOPC(BDO-NUM-VOPC)
                MOVE BDO-NUM-ICAN IN BDO-VARI TO
                     VOPC-NUM-ICAN(BDO-NUM-VOPC)
                MOVE BDO-NUM-IVEN IN BDO-VARI TO
                     VOPC-NUM-IVEN(BDO-NUM-VOPC)
                MOVE BDO-RCV-CAPI IN BDO-VARI TO
                     VOPC-SGV-CAPI(BDO-NUM-VOPC)
                GO TO FIN-GRB-VOPC
           ELSE
                SET BDO-NUM-VOPC UP BY 1
                GO TO LUP-GRB-VOPC.

       FIN-GRB-VOPC.
           EXIT.
      *-------------------------------------------------------------
      *-------------------------------------------------------------
       BUS-VOPC SECTION.
       INI-BUS-VOPC.

           MOVE 'N'    TO BDO-IND-BUSQ.
           SET BDO-NUM-VOPC TO 1.

       LUP-BUS-VOPC.
           IF (BDO-NUM-VOPC > 200)
                GO TO FIN-BUS-VOPC.

           IF (VOPC-CIC-IOPC(BDO-NUM-VOPC) NOT > SPACES )
                GO TO FIN-BUS-VOPC.

           IF (VOPC-CIC-IOPC(BDO-NUM-VOPC) = OPC-CIC-IOPC IN OPC)
                MOVE 'S'    TO BDO-IND-BUSQ
                GO TO FIN-BUS-VOPC
           ELSE
                SET BDO-NUM-VOPC UP BY 1
                GO TO LUP-BUS-VOPC.

       FIN-BUS-VOPC.
           EXIT.
      *-------------------------------------------------------------
      *-------------------------------------------------------------
       LIM-VOPC SECTION.
       INI-LIM-VOPC.

           SET BDO-NUM-VOPC TO 1.
       LUP-LIM-VOPC.
           IF (BDO-NUM-VOPC NOT > 200)
                MOVE SPACES TO VOPC-CIC-IOPC(BDO-NUM-VOPC)
                SET BDO-NUM-VOPC UP BY 1
                GO TO LUP-LIM-VOPC.

           IF (BDO-NUM-VOPC > 200)
                SET BDO-NUM-VOPC TO 1
                GO TO FIN-LIM-VOPC.

       FIN-LIM-VOPC.
           EXIT.
      *-------------------------------------------------------------
      *-------------------------------------------------------------
       BUS-VAL-MORP SECTION.
       INI-BUS-VAL-MORP.

           MOVE ZEROES  TO BDO-VAL-MORP.

           IF BDO-FEC-FVEN NOT < BDO-FEC-FPRO
               MOVE 'S'                TO BDO-IND-ERRO
               GO TO FIN-BUS-VAL-MORP.

           MOVE SPACES                   TO BDO-IND-ERRO.
           MOVE BDO-CIC-IOPC             TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY              TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF (NOT FIO-STAT-OKS)
                GO TO FIN-BUS-VAL-MORP.

           MOVE OPC-CIC-IOPC IN OPC      TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-NLS              TO FIO-CMND.

           IF OPC-IND-VSTR IN OPC = 'S'
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *        MOVE 1                TO VEN-NUM-IVEN IN VEN
               MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
           ELSE
               MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN.

       LUP-BUS-VAL-MORP.
           PERFORM COL-FIO-VEN
           IF NOT ( FIO-STAT-OKS  AND
              BDO-CIC-IOPC        =  VEN-CIC-IOPC IN VEN)
                   GO TO FIN-BUS-VAL-MORP.

           IF VEN-FEC-FVEN IN VEN NOT < BDO-FEC-FPRO
               MOVE 'S'                TO BDO-IND-ERRO
               GO TO FIN-BUS-VAL-MORP.

           IF VEN-VAL-SFIN IN VEN NOT > ZEROES
               GO TO NXT-BUS-VAL-MORP.

           IF VEN-FEC-FVEN IN VEN NOT < BDO-FEC-FVEN        AND
              VEN-FEC-FVEN IN VEN < BDO-FEC-FPRO
               ADD VEN-VAL-SCAP IN VEN TO BDO-VAL-MORP.

       NXT-BUS-VAL-MORP.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-BUS-VAL-MORP.
       FIN-BUS-VAL-MORP.
           EXIT.
      *-------------------------------------------------------------
       BUS-FEC-RCV SECTION.
       INI-BUS-FEC-RCV.

           MOVE ZEROES TO BDO-VAL-CCIE.

           MOVE SPACES                   TO BDO-IND-ERRO.
           MOVE BDO-CIC-IOPC             TO RCV-CIC-IOPV IN RCV.
           MOVE BDO-NUM-IVEN IN BDO-VARI TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-BUS-FEC-RCV.
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           PERFORM COL-FIO-RCV.
           IF NOT ( FIO-STAT-OKS   AND
               BDO-CIC-IOPC             = RCV-CIC-IOPV IN RCV )
                ADD ZEROES              TO BDO-VAL-MORP
                GO TO VAL-RCV-TOT.

           IF(RCV-NUM-IVCT IN RCV NOT > ZEROES)
                GO TO VAL-RCV-TOT.

           MOVE RCV-CIC-IOPC IN RCV TO CAN-CIC-IOPC IN CAN.
           MOVE RCV-NUM-ICAN IN RCV TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF (NOT FIO-STAT-OKS OR
               RCV-CIC-IOPC IN RCV NOT = CAN-CIC-IOPC IN CAN OR
               RCV-NUM-ICAN IN RCV NOT = CAN-NUM-ICAN IN CAN)
                GO TO NXT-BUS-FEC-RCV.

           IF (CAN-MSC-CANC IN CAN = 'CIE')
                ADD RCV-SGV-CAPI IN RCV TO BDO-VAL-CCIE
                GO TO NXT-BUS-FEC-RCV.

      *    BUSCA NUEVA OPERACION
           MOVE RCV-CIC-IOPC IN RCV TO ROV-CIC-IOPV IN ROV.
           MOVE RCV-NUM-ICAN IN RCV TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF (NOT FIO-STAT-OKS OR
               RCV-CIC-IOPC IN RCV NOT = ROV-CIC-IOPV IN ROV OR
               RCV-NUM-ICAN IN RCV NOT = ROV-NUM-IVCT IN ROV)
                ADD ZEROES              TO BDO-VAL-MORP
                GO TO NXT-BUS-FEC-RCV.

           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF (NOT FIO-STAT-OKS)
                ADD ZEROES              TO BDO-VAL-MORP
                GO TO NXT-BUS-FEC-RCV.

           IF OPC-FEC-FCOL IN OPC NOT < BDO-FEC-FPRO
                ADD ZEROES              TO BDO-VAL-MORP
                MOVE 'S'                TO BDO-IND-ERRO
                GO TO FIN-BUS-FEC-RCV.

           IF OPC-FEC-FCOL IN OPC NOT < BDO-FEC-FVEN        AND
              OPC-FEC-FCOL IN OPC < BDO-FEC-FPRO
               ADD RCV-SGV-CAPI IN RCV TO BDO-VAL-MORP.

           GO TO NXT-BUS-FEC-RCV.
       VAL-RCV-TOT.
           MOVE SPACES                   TO BDO-IND-ERRO.
           MOVE BDO-CIC-IOPC             TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES                   TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           PERFORM COL-FIO-RCV.
           IF  NOT( FIO-STAT-OKS   AND
               BDO-CIC-IOPC             = RCV-CIC-IOPV IN RCV AND
               ZEROES                   =  RCV-NUM-IVCT IN RCV )
                GO TO FIN-BUS-FEC-RCV.

      *    BUSCA NUEVA OPERACION
           MOVE RCV-CIC-IOPC IN RCV TO ROV-CIC-IOPV IN ROV.
           MOVE RCV-NUM-ICAN IN RCV TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF (NOT FIO-STAT-OKS OR
               RCV-CIC-IOPC IN RCV NOT = ROV-CIC-IOPV IN ROV OR
               RCV-NUM-ICAN IN RCV NOT = ROV-NUM-IVCT IN ROV)
                GO TO FIN-BUS-FEC-RCV.

           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF (NOT FIO-STAT-OKS)
                ADD ZEROES              TO BDO-VAL-MORP
                GO TO FIN-BUS-FEC-RCV.

           IF OPC-FEC-FCOL IN OPC NOT < BDO-FEC-FPRO
               ADD ZEROES              TO BDO-VAL-MORP
               MOVE 'S'                TO BDO-IND-ERRO
               GO TO FIN-BUS-FEC-RCV.

           IF OPC-FEC-FCOL IN OPC > BDO-FEC-FPRO
               ADD RCV-SGV-CAPI IN RCV TO BDO-VAL-MORP
               GO TO FIN-BUS-FEC-RCV.

           MOVE RCV-CIC-IOPC IN RCV TO CAN-CIC-IOPC IN CAN.
           MOVE RCV-NUM-ICAN IN RCV TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF (NOT FIO-STAT-OKS OR
               RCV-CIC-IOPC IN RCV NOT = CAN-CIC-IOPC IN CAN OR
               RCV-NUM-ICAN IN RCV NOT = CAN-NUM-ICAN IN CAN)
               GO TO FIN-BUS-FEC-RCV.

           PERFORM BUS-SAL-MOR.
           ADD BDO-VAL-CAPI IN BDO-VARI TO BDO-VAL-MORP.
           GO TO FIN-BUS-FEC-RCV.

       NXT-BUS-FEC-RCV.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-BUS-FEC-RCV.
       FIN-BUS-FEC-RCV.
           COMPUTE BDO-VAL-MORP ROUNDED = BDO-VAL-MORP - BDO-VAL-CCIE.
           PERFORM BUS-SAL-CIE.
           COMPUTE BDO-VAL-MORP ROUNDED = BDO-VAL-MORP - BDO-ACU-CCIE.
           IF (BDO-VAL-MORP NOT > ZEROES)
                MOVE ZEROES TO BDO-VAL-MORP.

           EXIT.
      *-------------------------------------------------------------
       BUS-SAL-CIE SECTION.
       INI-BUS-SAL-CIE.

           MOVE ZEROES TO BDO-ACU-CCIE.
           MOVE BDO-NUM-IVEN IN BDO-VARI TO BDO-NUM-SVEN IN BDO-VARI.

      *COMIENZA EL PROCESO
           MOVE BDO-CIC-IOPC IN BDO-VARI TO CAN-CIC-IOPC IN CAN.
           MOVE BDO-NUM-SVEN IN BDO-VARI TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-NLS              TO FIO-CMND.
       LUP-SAL-CIE.
           PERFORM COL-FIO-CAN.
           IF (NOT FIO-STAT-OKS OR
               BDO-CIC-IOPC IN BDO-VARI NOT = CAN-CIC-IOPC IN CAN OR
               BDO-NUM-SVEN IN BDO-VARI NOT = CAN-NUM-ICAN IN CAN)
                GO TO FIN-BUS-SAL-CIE
           ELSE
                MOVE ADR-CAN-REQA TO ADR-BDO-REQA.

           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO NXT-SAL-CIE.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                GO TO NXT-SAL-CIE.

           IF CAN-FEC-FCAN IN CAN > BDO-FEC-FVEN
                GO TO FIN-BUS-SAL-CIE.

      *    VALIDA SI CANCELACION ES PRODUCTO DE TRASPASO
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-CYA.

      *    SIN CYA => CAN NO TRASPASO
           IF NOT (FIO-STAT-OKS AND
               CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
               CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA)
                 GO TO NXT-SAL-CIE.

      *--------- PRODUCTO TRASPASO ---------
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.

      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')
                 GO TO NXT-SAL-CIE.

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')
                PERFORM BUS-NEW-CIE
                GO TO NXT-SAL-CIE.

       NXT-SAL-CIE.
           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE ADR-BDO-REQA TO ADR-CAN-REQA.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           GO TO LUP-SAL-CIE.

       FIN-BUS-SAL-CIE.
           EXIT.
      *-------------------------------------------------------------
       BUS-NEW-CIE SECTION.
       INI-BUS-NEW-CIE.

           MOVE ZEROES TO BDO-ACU-INTN IN BDO-VARI.
           MOVE ZEROES TO BDO-ACU-CAPI IN BDO-VARI.

           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)
                 GO TO FIN-BUS-NEW-CIE.
           MOVE RCV-SGV-CAPI IN RCV TO BDO-RES-CAPI IN BDO-VARI.
           MOVE RCV-SGV-INTM IN RCV TO BDO-RES-INTM IN BDO-VARI.
           MOVE RCV-NUM-IVCT IN RCV TO BDO-RES-IVCT IN BDO-VARI.

      *   VALIDO CANCELACION ACTIVA
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO FIN-BUS-NEW-CIE.

      *    CAMBIA INTERESES NORMALES A MONEDA OPERACION
           MOVE RCV-SGV-INTN IN RCV TO BDO-INI-INTN IN BDO-VARI.
           PERFORM  CAL-CAM-INTN.
           MOVE BDO-CAM-INTN  TO BDO-RES-INTN IN BDO-VARI.
           MOVE BDO-CAM-INTN  TO BDO-VAL-SINT IN BDO-VARI.

       LUP-NEW-CIE.
      *--------- BUSCA NUEVA OPERACION -----
           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPC IN ROV.

           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV
                MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV
                MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.

           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-ROV.

           IF (NOT FIO-STAT-OKS OR
               (CAN-MSC-TCAN IN CAN = 'P' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPC IN ROV) OR
               (CAN-MSC-TCAN IN CAN = 'R' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPV IN ROV))
                 GO TO FIN-BUS-NEW-CIE.

           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE ROV-CIC-IOPC IN ROV TO RES-CIC-IOPC IN OPC-RES
                MOVE ROV-CIC-IOPC IN ROV TO RCV-CIC-IOPV IN RCV.

           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE ROV-CIC-IOPV IN ROV TO RES-CIC-IOPC IN OPC-RES
                MOVE ROV-CIC-IOPV IN ROV TO RCV-CIC-IOPV IN RCV.

       LUP-CIE.
           MOVE RES-CIC-IOPC IN OPC-RES TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.

           IF NOT FIO-STAT-OKS
               GO TO FIN-BUS-NEW-CIE.

           IF (OPC-MSC-STAT IN OPC NOT = 'A')
               GO TO FIN-BUS-NEW-CIE.

           MOVE OPC-CIC-IOPC IN OPC TO CAN-CIC-IOPC IN CAN.
           MOVE ZEROES              TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-CIE-TRV.
           PERFORM COL-FIO-CAN.
           IF (NOT FIO-STAT-OKS  OR
               OPC-CIC-IOPC IN OPC NOT = CAN-CIC-IOPC IN CAN)
                GO TO FIN-BUS-NEW-CIE.

           IF CAN-FEC-FCAN IN CAN > BDO-FEC-FPRO
                GO TO FIN-BUS-NEW-CIE.

      *   VALIDO CANCELACION ACTIVA
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO LUP-CIE-TRV.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO LUP-CIE-TRV.

      *   VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT' OR 'CTE')
                GO TO FIN-BUS-NEW-CIE.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                PERFORM BUS-CAPI-CIE
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO LUP-CIE-TRV.

           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = CYA-CIC-IOPC IN CYA OR
               CAN-NUM-ICAN IN CAN NOT = CYA-NUM-ICAN IN CYA)
                GO TO LUP-NEW-CIE.

           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.

      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')
                GO TO LUP-NEW-CIE.

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')
                GO TO LUP-NEW-CIE.

       FIN-BUS-NEW-CIE.
           EXIT.
      *-------------------------------------------------------------
       BUS-CAPI-CIE SECTION.
       INI-BUS-CAPI-CIE.

           MOVE ZEROES              TO BDO-CAN-INTN IN BDO-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)
                GO TO FIN-BUS-CAPI-CIE.

           IF (RCV-SGV-CAPI IN RCV NOT > ZEROES)
                GO TO FIN-BUS-CAPI-CIE.

           IF BDO-COD-VCOC = OPC-COD-VCOC IN OPC
               MOVE RCV-SGV-CAPI IN RCV TO BDO-SGV-CAPI IN BDO-VARI
           ELSE
               PERFORM CAL-CAM-CAPI.

           IF (BDO-VAL-SINT IN BDO-VARI = BDO-SGV-CAPI IN BDO-VARI)
               MOVE BDO-SGV-CAPI IN BDO-VARI TO BDO-ACU-INTN IN BDO-VARI
               MOVE BDO-SGV-CAPI IN BDO-VARI TO BDO-CAN-INTN IN BDO-VARI
                GO TO VAL-SINT.

           IF (BDO-VAL-SINT IN BDO-VARI < BDO-SGV-CAPI IN BDO-VARI)
               MOVE BDO-RES-INTN IN BDO-VARI TO BDO-ACU-INTN IN BDO-VARI
               MOVE BDO-RES-INTN IN BDO-VARI TO BDO-CAN-INTN IN BDO-VARI
               GO TO VAL-SINT.

           IF (BDO-VAL-SINT IN BDO-VARI > BDO-SGV-CAPI IN BDO-VARI)
                ADD BDO-SGV-CAPI IN BDO-VARI TO BDO-ACU-INTN IN BDO-VARI
               MOVE BDO-SGV-CAPI IN BDO-VARI TO BDO-CAN-INTN IN BDO-VARI
                GO TO VAL-SINT.

       VAL-SINT.

           IF   BDO-VAL-SINT IN BDO-VARI NOT > ZEROES
                 MOVE ZEROES TO BDO-CAN-INTN IN BDO-VARI.

           COMPUTE BDO-VAL-SINT IN BDO-VARI =
                  (BDO-RES-INTN IN BDO-VARI -
                   BDO-ACU-INTN IN BDO-VARI).

           IF   BDO-VAL-SINT IN BDO-VARI NOT > ZEROES
                 MOVE ZEROES TO BDO-VAL-SINT IN BDO-VARI.

       VAL-CAPI.
           COMPUTE BDO-ACU-CCIE IN BDO-VARI =
                   BDO-ACU-CCIE IN BDO-VARI +
                  (BDO-SGV-CAPI IN BDO-VARI  -
                   BDO-CAN-INTN IN BDO-VARI).

       FIN-BUS-CAPI-CIE.
           EXIT.
      *-------------------------------------------------------------
       BUS-SAL-MOR SECTION.
       INI-BUS-SAL-MOR.

           MOVE BDO-CIC-IOPC             TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES                   TO BDO-VAL-CAPI IN BDO-VARI.

           MOVE BDO-CIC-IOPC            TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-BUS-SAL-MOR.

           MOVE OPC-NUM-IVEN IN OPC TO BDO-NUM-SVEN IN BDO-VARI.
           MOVE OPC-IND-VSTR IN OPC TO BDO-IND-VSTR IN BDO-VARI.

       LUP-OPC.
           MOVE BDO-CIC-IOPC            TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-BUS-SAL-MOR.

           MOVE BDO-NUM-SVEN IN BDO-VARI TO VEN-NUM-IVEN IN VEN.
           MOVE BDO-CIC-IOPC             TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
       LUP-VEN.

      *VENCIMIENTO ESTRUCTURADO: EJECUTA RUTINA DE EXPANSION DE VEN
           IF (BDO-IND-VSTR IN BDO-VARI = 'S')
                MOVE BDO-NUM-SVEN IN BDO-VARI TO VEN-NUM-IVEN IN VEN
                PERFORM COL-OBT-VEN
                IF (NOT VEN-STAT-OKS)
                     GO TO FIN-BUS-SAL-MOR
                ELSE
                     MOVE VEN-NUM-IVCT IN VEN  TO
                          BDO-NUM-SVEN IN BDO-VARI.

      *VENCIMIENTO NO ESTRUCTURADO: EJECUTA BUSQUEDA DIRECTO EN VEN
           IF (BDO-IND-VSTR IN BDO-VARI NOT = 'S')
               PERFORM COL-FIO-VEN
                IF (NOT FIO-STAT-OKS)
                     GO TO FIN-BUS-SAL-MOR
                ELSE
                     MOVE VEN-NUM-IVEN IN VEN  TO
                          BDO-NUM-SVEN IN BDO-VARI
                     MOVE ADR-VEN-REQA TO ADR-AXU-REQA.

      *    RESPALDO CAPITAL DE VENCIMIENTO ORIGINAL

           IF VEN-FEC-FVEN IN VEN > BDO-FEC-FPRO
               GO TO FIN-BUS-SAL-MOR.

           ADD VEN-VAL-CAPI IN VEN TO BDO-VAL-CAPI IN BDO-VARI.

       NXT-VEN.
           IF (BDO-IND-VSTR IN BDO-VARI NOT = 'S')
               MOVE FIO-GET-NXT TO FIO-CMND
               MOVE ADR-AXU-REQA TO ADR-VEN-REQA
               MOVE FIO-KDEF-S TO FIO-KDEF
           ELSE
               MOVE FIO-GET-KEY TO FIO-CMND.
           ADD 1 TO BDO-NUM-SVEN IN BDO-VARI.
           GO TO LUP-OPC.

       FIN-BUS-SAL-MOR.
           EXIT.
      *-------------------------------------------------------------
       BUS-OPC-VOPC SECTION.
       INI-BUS-OPC-VOPC.
      *BUSCA OPERACIONES ASOCIADAS A OPC ORIG

           MOVE SPACES       TO BDO-IND-ICTT IN BDO-VARI.
           MOVE ZEROES       TO BDO-NUM-IVEN IN BDO-VARI.

           MOVE BDO-CIC-IOPC IN BDO-VARI TO BDO-CIC-IOPE IN BDO-VARI.
           MOVE ZEROES                   TO BDO-NUM-ICAN IN BDO-VARI.
           MOVE ZEROES                   TO BDO-NUM-IVEN IN BDO-VARI.
           PERFORM GRB-VOPC.

      *COMIENZA EL PROCESO
           MOVE BDO-CIC-IOPC IN BDO-VARI TO CAN-CIC-IOPC IN CAN.
           MOVE ZEROES                   TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-NLS              TO FIO-CMND.
       LUP-BUS-OPC-VOPC.
           PERFORM COL-FIO-CAN.
           IF (NOT FIO-STAT-OKS OR
               BDO-CIC-IOPC IN BDO-VARI NOT = CAN-CIC-IOPC IN CAN)
                GO TO FIN-BUS-OPC-VOPC
           ELSE
                MOVE ADR-CAN-REQA TO ADR-BDO-REQA.

           MOVE CAN-NUM-ICAN IN CAN TO BDO-NUM-ICAN IN BDO-VARI.
           PERFORM BUS-RCV-VOPC.
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO NXT-BUS-OPC-VOPC.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                GO TO NXT-BUS-OPC-VOPC.

      *    VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                MOVE 'S' TO BDO-IND-ICTT IN BDO-VARI
                GO TO FIN-BUS-OPC-VOPC.

      *    VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
               MOVE 'R' TO LOC-IND-RBDO IN LOC-VARI
               MOVE BDO-CAI-IOPC IN BDO-VARI TO LOC-CAI-IOPC IN LOC-VARI
               MOVE BDO-IIC-IOPC IN BDO-VARI TO LOC-IIC-IOPC IN LOC-VARI
               PERFORM BUS-CXE-FGF
               GO TO NXT-BUS-OPC-VOPC.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                GO TO NXT-BUS-OPC-VOPC.

      *    VALIDO TIPO DE CANCELACION: PRORROGA
           IF (CAN-MSC-CANC IN CAN = 'PTT' OR 'KTT')
                PERFORM BUS-VOPC-PTT
                GO TO FIN-BUS-OPC-VOPC.

      *    VALIDA SI CANCELACION ES PRODUCTO DE TRASPASO
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-CYA.

      *    SIN CYA => CAN NO TRASPASO
           IF NOT (FIO-STAT-OKS AND
               CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
               CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA)
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    PERFORM BUS-VOPC-PTT
                    GO TO FIN-BUS-OPC-VOPC
               ELSE
                    GO TO NXT-BUS-OPC-VOPC.

      *--------- PRODUCTO TRASPASO ---------
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.

      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    GO TO FIN-BUS-OPC-VOPC
               ELSE
                    GO TO NXT-BUS-OPC-VOPC.

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')
                PERFORM BUS-NEW-VOPC
                     GO TO NXT-BUS-OPC-VOPC.

       NXT-BUS-OPC-VOPC.
           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE ADR-BDO-REQA TO ADR-CAN-REQA.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           GO TO LUP-BUS-OPC-VOPC.

       FIN-BUS-OPC-VOPC.
           EXIT.
      *-------------------------------------------------------------
       BUS-VOPC-PTT SECTION.
       INI-BUS-VOPC-PTT.

           MOVE SPACES       TO BDO-IND-ICTT IN BDO-VARI.
           MOVE ZEROES       TO BDO-NUM-IVEN IN BDO-VARI.

      *    BUSCA NUEVA OPERACION
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF (NOT FIO-STAT-OKS)
                 GO TO FIN-BUS-VOPC-PTT.

           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF (NOT FIO-STAT-OKS)
                MOVE 'PTT  INEX' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-BUS-VOPC-PTT.

           MOVE OPC-CIC-IOPC IN OPC TO BDO-CIC-IOPE IN BDO-VARI.
           PERFORM GRB-VOPC.
           MOVE OPC-IND-VSTR IN OPC TO BDO-IND-VSTR IN BDO-VARI.
           MOVE OPC-COD-VCOC IN OPC TO BDO-COD-VCOC IN BDO-VARI.
           MOVE OPC-COD-VCOC IN OPC TO BDO-NUM-CTOT IN BDO-VARI.
           MOVE OPC-FEC-FCOL IN OPC TO BDO-FEC-FCAM IN BDO-VARI.

           IF (OPC-MSC-STAT IN OPC NOT = 'A')
                MOVE 'PTT NOACA' TO BDO-COD-ERRO IN BDO-VARI
                GO TO FIN-BUS-VOPC-PTT.

           MOVE OPC TO OPC-RES.

      *COMIENZA EL PROCESO
           MOVE OPC-CIC-IOPC IN OPC      TO CAN-CIC-IOPC IN CAN.
           MOVE ZEROES                   TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-NLS              TO FIO-CMND.
       LUP-BUS-VOPC-PTT.
           PERFORM COL-FIO-CAN.
           IF (NOT FIO-STAT-OKS OR
               OPC-CIC-IOPC IN OPC NOT = CAN-CIC-IOPC IN CAN)
                GO TO FIN-BUS-VOPC-PTT
           ELSE
                MOVE ADR-CAN-REQA TO ADR-PTT-REQA.

           MOVE CAN-NUM-ICAN IN CAN TO BDO-NUM-ICAN IN BDO-VARI.
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                GO TO NXT-BUS-VOPC-PTT.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                GO TO NXT-BUS-VOPC-PTT.

      *    VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                MOVE 'S' TO BDO-IND-ICTT IN BDO-VARI
                GO TO FIN-BUS-VOPC-PTT.

      *    VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                MOVE 'S' TO LOC-IND-RBDO IN LOC-VARI
                MOVE CAN-CIC-IOPC IN CAN TO LOC-CIC-RBDO IN LOC-VARI
                GO TO NXT-BUS-VOPC-PTT.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                GO TO NXT-BUS-VOPC-PTT.

      *    VALIDO TIPO DE CANCELACION: PRORROGA
           IF (CAN-MSC-CANC IN CAN = 'PTT' OR 'KTT')
                GO TO INI-BUS-VOPC-PTT.

      *    VALIDA SI CANCELACION ES PRODUCTO DE TRASPASO
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-CYA.

      *    SIN CYA => CAN NO TRASPASO
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = CYA-CIC-IOPC IN CYA OR
               CAN-NUM-ICAN IN CAN NOT = CYA-NUM-ICAN IN CYA)
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    GO TO INI-BUS-VOPC-PTT
               ELSE
                GO TO NXT-BUS-VOPC-PTT.

      *--------- PRODUCTO TRASPASO ---------
           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.

      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')
               IF (CAN-MSC-CANC IN CAN = 'RTT')
                    GO TO INI-BUS-VOPC-PTT
               ELSE
                GO TO NXT-BUS-VOPC-PTT.

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')
                PERFORM BUS-NEW-VOPC
      *         NUEVA OPERACION IMPAGA
                IF (BDO-IND-CANC IN BDO-VARI NOT = 'S')
                     GO TO FIN-BUS-VOPC-PTT
      *         NUEVA OPERACION CANCELADA
                ELSE
                     GO TO NXT-BUS-VOPC-PTT.

       NXT-BUS-VOPC-PTT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE ADR-PTT-REQA TO ADR-CAN-REQA.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           GO TO LUP-BUS-VOPC-PTT.

       FIN-BUS-VOPC-PTT.
           EXIT.
      *-----------------------------------------------------
       BUS-NEW-VOPC SECTION.
       INI-BUS-NEW-VOPC.

           MOVE 'N'    TO BDO-IND-CANC IN BDO-VARI.

           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)
                 GO TO FIN-BUS-NEW-VOPC.

           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                 GO TO FIN-BUS-NEW-VOPC.

      *    CAMBIA INTERESES NORMALES A MONEDA OPERACION

       LUP-NEW-VOPC.
      *--------- BUSCA NUEVA OPERACION -----
           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPC IN ROV.

           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV
                MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV
                MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.

           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-ROV.

           IF (NOT FIO-STAT-OKS OR
               (CAN-MSC-TCAN IN CAN = 'P' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPC IN ROV) OR
               (CAN-MSC-TCAN IN CAN = 'R' AND
                CAN-CIC-IOPC IN CAN NOT = ROV-CIC-IOPV IN ROV))
                 GO TO FIN-BUS-NEW-VOPC.

           IF (CAN-MSC-TCAN IN CAN = 'R')
                MOVE ROV-CIC-IOPC IN ROV TO RES-CIC-IOPC IN OPC-RES
                MOVE ROV-CIC-IOPC IN ROV TO RCV-CIC-IOPV IN RCV.

           IF (CAN-MSC-TCAN IN CAN = 'P')
                MOVE ROV-CIC-IOPV IN ROV TO RES-CIC-IOPC IN OPC-RES
                MOVE ROV-CIC-IOPV IN ROV TO RCV-CIC-IOPV IN RCV.

       LUP-VOPC.
           MOVE RES-CIC-IOPC IN OPC-RES TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.

           IF NOT FIO-STAT-OKS
               GO TO FIN-BUS-NEW-VOPC.

           IF (OPC-MSC-STAT IN OPC NOT = 'A')
               GO TO FIN-BUS-NEW-VOPC.

           MOVE OPC-CIC-IOPC IN OPC TO BDO-CIC-IOPE IN BDO-VARI.
           PERFORM GRB-VOPC.

           MOVE OPC-CIC-IOPC IN OPC TO CAN-CIC-IOPC IN CAN.
           MOVE ZEROES              TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-VOPC-TRV.
           PERFORM COL-FIO-CAN.
           IF (NOT FIO-STAT-OKS  OR
               OPC-CIC-IOPC IN OPC NOT = CAN-CIC-IOPC IN CAN)
                GO TO FIN-BUS-NEW-VOPC.

           MOVE CAN-NUM-ICAN IN CAN TO BDO-NUM-ICAN IN BDO-VARI.

      *   VALIDO CANCELACION ACTIVA
           IF (CAN-MSC-STAT IN CAN NOT = 'A')
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO LUP-VOPC-TRV.

           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
               CAN-SGV-DIFE IN CAN < ZEROES OR
               CAN-SGV-TREN IN CAN < ZEROES)
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO LUP-VOPC-TRV.

      *   VALIDO TIPO DE CANCELACION: TOTAL
           IF (CAN-MSC-CANC IN CAN = 'CTT')
                MOVE 'S' TO BDO-IND-CANC IN BDO-VARI
                GO TO FIN-BUS-NEW-VOPC.

      *   VALIDO TIPO DE CANCELACION: TOTAL 1 VENCIMIENTO
           IF (CAN-MSC-CANC IN CAN = 'CTE')
                MOVE 'S' TO BDO-IND-CANC IN BDO-VARI
                MOVE 'S' TO LOC-IND-RBDO IN LOC-VARI
                MOVE CAN-CIC-IOPC IN CAN TO LOC-CIC-RBDO IN LOC-VARI
                GO TO FIN-BUS-NEW-VOPC.

      *    VALIDO TIPO DE CANCELACION: PARCIAL
           IF (CAN-MSC-CANC IN CAN = 'CIE')
                MOVE FIO-GET-NXT TO FIO-CMND
                GO TO LUP-VOPC-TRV.

           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = CYA-CIC-IOPC IN CYA OR
               CAN-NUM-ICAN IN CAN NOT = CYA-NUM-ICAN IN CYA)
                GO TO INI-BUS-NEW-VOPC.

           MOVE CYA-IND-TCYA IN CYA TO BDO-COD-TCYA IN BDO-VARI.

      *    CAN NO PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  NOT = 'TR' AND
               BDO-GLS-TCYA IN BDO-VARI  NOT = 'PB')
                GO TO LUP-NEW-VOPC.

      *    CAN    PRODUCTO TRASPASO
           IF (BDO-GLS-TCYA IN BDO-VARI  = 'TR' OR
               BDO-GLS-TCYA IN BDO-VARI  = 'PB')
                GO TO LUP-NEW-VOPC.

       FIN-BUS-NEW-VOPC.
           EXIT.
      *-----------------------------------------------------
       BUS-RCV-VOPC SECTION.
       INI-BUS-RCV-VOPC.

           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF (NOT FIO-STAT-OKS OR
               CAN-CIC-IOPC IN CAN NOT = RCV-CIC-IOPC IN RCV OR
               CAN-NUM-ICAN IN CAN NOT = RCV-NUM-ICAN IN RCV)
               GO TO FIN-BUS-CAPI.

           MOVE RCV-NUM-IVCT IN RCV TO BDO-NUM-IVEN IN BDO-VARI.
           MOVE RCV-SGV-CAPI IN RCV TO BDO-RCV-CAPI IN BDO-VARI.

       FIN-BUS-RCV-VOPC.
           EXIT.
      *-----------------------------------------------------
       OBT-EST-OPC SECTION.
       INI-OBT-EST-OPC.

           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE 1                   TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF (NOT FIO-STAT-OKS)
                GO TO FIN-OBT-EST-OPC.


           IF (BDO-IND-SCTB IN BDO-VARI = 'CAS'  OR
               DLC-IND-SCTB IN DLC      = 'CAS')
                MOVE 'CAS' TO BDO-GLS-STAT IN BDO-VARI
                GO TO FIN-OBT-EST-OPC.

           IF (BDO-IND-SCTB IN BDO-VARI = 'VCD' OR
               DLC-IND-SCTB IN DLC      = 'VCD')
                MOVE 'VCD' TO BDO-GLS-STAT IN BDO-VARI
                GO TO FIN-OBT-EST-OPC.

           IF (BDO-IND-SCTB IN BDO-VARI = 'MOR' OR 'MUL')
                GO TO FIN-OBT-EST-OPC.

           IF (BDO-IND-SCTB IN BDO-VARI = 'VIG')
                GO TO FIN-OBT-EST-OPC.

       FIN-OBT-EST-OPC.
           EXIT.
      *----------------------------------------------------------------
      *RESPALDA ENTIDADES UTILIZADAS POR LA RUTINA BDO
      *----------------------------------------------------------------
       LOC-LLE-ENT SECTION.
       INI-LOC-LLE-ENT.
           MOVE SPACES TO OPC-RESP IN LOC-VARI.
           MOVE SPACES TO DLC-RESP IN LOC-VARI.
           MOVE SPACES TO ROV-RESP IN LOC-VARI.
           MOVE SPACES TO CAN-RESP IN LOC-VARI.
           MOVE SPACES TO CYA-RESP IN LOC-VARI.
           MOVE SPACES TO RCV-RESP IN LOC-VARI.
           MOVE SPACES TO VEN-RESP IN LOC-VARI.
           MOVE SPACES TO CAM-RESP IN LOC-VARI.
           MOVE SPACES TO TAB-RESP IN LOC-VARI.

           MOVE OPC TO OPC-RESP IN LOC-VARI.
           MOVE DLC TO DLC-RESP IN LOC-VARI.
           MOVE ROV TO ROV-RESP IN LOC-VARI.
           MOVE CAN TO CAN-RESP IN LOC-VARI.
           MOVE CYA TO CYA-RESP IN LOC-VARI.
           MOVE RCV TO RCV-RESP IN LOC-VARI.
           MOVE VEN TO VEN-RESP IN LOC-VARI.
           MOVE CAM TO CAM-RESP IN LOC-VARI.
           MOVE TAB TO TAB-RESP IN LOC-VARI.
       FIN-LOC-LLE-ENT.
           EXIT.
      *----------------------------------------------------------------
      *RESTAURA ENTIDADES UTILIZADAS POR LA RUTINA BDO
      *----------------------------------------------------------------
       LOC-RES-ENT SECTION.
       INI-LOC-RES-ENT.
           MOVE OPC-RESP IN LOC-VARI TO OPC.
           MOVE DLC-RESP IN LOC-VARI TO DLC.
           MOVE ROV-RESP IN LOC-VARI TO ROV.
           MOVE CAN-RESP IN LOC-VARI TO CAN.
           MOVE CYA-RESP IN LOC-VARI TO CYA.
           MOVE RCV-RESP IN LOC-VARI TO RCV.
           MOVE VEN-RESP IN LOC-VARI TO VEN.
           MOVE CAM-RESP IN LOC-VARI TO CAM.
           MOVE TAB-RESP IN LOC-VARI TO TAB.
       FIN-LOC-RES-ENT.
           EXIT.
      *----------------------------------------------------------------
      *
      *----------------------------------------------------------------
       LOC-BUS-CAPI SECTION.
       INI-LOC-BUS-CAPI.
           MOVE ZEROES TO BDO-SGV-CAPI IN BDO-VARI.
           MOVE 1 TO LOC-N.
       LUP-LOC-BUS-CAPI.
           IF LOC-N > 200
               GO TO FIN-LOC-BUS-CAPI.
           IF VOPC-CIC-IOPC(LOC-N) NOT > SPACES
               GO TO FIN-LOC-BUS-CAPI.
           IF VOPC-CAI-IOPC(LOC-N) =  LOC-CAI-IOPC IN LOC-VARI AND
              VOPC-IIC-IOPC(LOC-N) =  LOC-IIC-IOPC IN LOC-VARI
               MOVE VOPC-NUM-IVEN(LOC-N)  TO
                    BDO-NUM-IVEN IN BDO-VARI
               MOVE VOPC-SGV-CAPI(LOC-N)  TO
                    BDO-SGV-CAPI IN BDO-VARI
               GO TO FIN-LOC-BUS-CAPI.
           ADD 1 TO LOC-N.
           GO TO LUP-LOC-BUS-CAPI.
       FIN-LOC-BUS-CAPI.
           EXIT.
      *----------------------------------------------------------------
      *
      *----------------------------------------------------------------
       LOC-PRO-CIE SECTION.
       INI-LOC-PRO-CIE.
           IF LOC-NUM-VCOR IN LOC-VARI = 1 AND
            (LOC-MSC-CANC IN LOC-VARI = 'CTE' OR
            LOC-MSC-CANC IN LOC-VARI = 'CTT' OR
            LOC-MSC-CANC IN LOC-VARI = 'KTT' OR
            LOC-MSC-CANC IN LOC-VARI = 'PTT' OR
            LOC-MSC-CANC IN LOC-VARI = 'RTT')
              MOVE LOC-VAL-CRED IN LOC-VARI TO LOC-VAL-SALD IN LOC-VARI.
       FIN-LOC-PRO-CIE.
           EXIT.
      *-----------------------------------------------------------------

      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
       MOV-FEC-ANTI SECTION.
       INI-MOV-FEC-ANTI.
           MOVE LOC-CXE-DVEN IN LOC-VARI TO LOC-NUM-DUN IN LOC-VARI.
           MOVE LOC-CXE-MVEN IN LOC-VARI TO LOC-NUM-MUN IN LOC-VARI.
           MOVE LOC-CXE-SVEN IN LOC-VARI TO LOC-NUM-SUN IN LOC-VARI.
           MOVE LOC-CXE-AVEN IN LOC-VARI TO LOC-NUM-AUN IN LOC-VARI.
           IF LOC-MSC-CANC IN LOC-VARI = WSS-GLS-ICTE
               MOVE LOC-NUM-DVEN IN LOC-VARI TO LOC-NUM-DDO
               MOVE LOC-NUM-MVEN IN LOC-VARI TO LOC-NUM-MDO
               MOVE LOC-NUM-SVEN IN LOC-VARI TO LOC-NUM-SDO
               MOVE LOC-NUM-AVEN IN LOC-VARI TO LOC-NUM-ADO
           ELSE
               MOVE LOC-NUM-DCAN IN LOC-VARI TO LOC-NUM-DDO
               MOVE LOC-NUM-MCAN IN LOC-VARI TO LOC-NUM-MDO
               MOVE LOC-NUM-SCAN IN LOC-VARI TO LOC-NUM-SDO
               MOVE LOC-NUM-ACAN IN LOC-VARI TO LOC-NUM-ADO.
       FIN-MOV-FEC-ANTI.
           EXIT.
       BUS-CXE-CIE-RCV SECTION.
       INI-BUS-CXE-CIE-RCV.
           MOVE ZEROES TO LOC-VAL-TKAP.
           MOVE ZEROES TO LOC-VAL-TCIE.
           MOVE ZEROES TO LOC-VAL-MCIE.
           MOVE CAN TO CAN-RESP IN LOC-VARI.
           MOVE RCV TO RCV-RESP IN LOC-VARI.
           MOVE CAN-CAI-IOPC IN CAN          TO RCV-CAI-IOPV IN RCV.
           MOVE CAN-IIC-IOPC IN CAN          TO RCV-IIC-IOPV IN RCV.
           MOVE VEN-NUM-IVCT IN CAN-FLD      TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-BUS-CXE-RCV.
           MOVE 'RCV-KEY-IVCT' TO FIO-AKEY.
           PERFORM COL-FIO-RCV.
           IF NOT ( FIO-STAT-OKS AND
              CAN-CAI-IOPC IN CAN      = RCV-CAI-IOPV IN RCV AND
              CAN-IIC-IOPC IN CAN      = RCV-IIC-IOPV IN RCV AND
              VEN-NUM-IVCT IN CAN-FLD  = RCV-NUM-IVCT IN RCV )
               GO TO EXT-BUS-CXE-CIE-RCV.

           MOVE RCV-CAI-IOPC IN RCV      TO CAN-CAI-IOPC IN CAN.
           MOVE RCV-IIC-IOPC IN RCV      TO CAN-IIC-IOPC IN CAN.
           MOVE RCV-NUM-ICAN IN RCV      TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF CAN-MSC-STAT IN CAN NOT = WSS-GLS-AAAA
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-CXE-RCV.
           IF CAN-SGV-TPAG IN CAN < 0 OR
              CAN-SGV-TREN IN CAN < 0 OR
              CAN-SGV-DIFE IN CAN < 0
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-CXE-RCV.

           IF CAN-MSC-CANC IN CAN  NOT = WSS-GLS-ICIE
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-CXE-RCV.

           COMPUTE LOC-VAL-TKAP = LOC-VAL-TKAP + RCV-SGV-CAPI IN RCV.

           MOVE CAN-CAI-IOPC IN CAN      TO CXE-CAI-IOPC IN CXE.
           MOVE CAN-IIC-IOPC IN CAN      TO CXE-IIC-IOPC IN CXE.
           MOVE CAN-NUM-ICAN IN CAN      TO CXE-NUM-EVEN IN CXE.
           MOVE WSS-GLS-EVCA             TO CXE-COD-EVEN IN CXE.
           MOVE SPACES                   TO CXE-CIC-IOPV IN CXE.
           MOVE ZEROES                   TO CXE-NUM-IVCT IN CXE.
           MOVE SPACES                   TO CXE-COD-CPTO IN CXE.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-BUS-CXE-CXE.
           PERFORM COL-FIO-CXE.
           IF NOT ( FIO-STAT-OKS AND
              CAN-CAI-IOPC IN CAN      = CXE-CAI-IOPC IN CXE AND
              CAN-IIC-IOPC IN CAN      = CXE-IIC-IOPC IN CXE AND
              CAN-NUM-ICAN IN CAN      = CXE-NUM-EVEN IN CXE AND
              CXE-COD-EVEN IN CXE      = WSS-GLS-EVCA )
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-CXE-RCV.

           IF CXE-COD-CPTO IN CXE NOT = WSS-GLS-CFGF
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-CXE-CXE.

           IF CXE-MSC-STAT IN CXE NOT = WSS-GLS-VVVV
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-CXE-CXE.

           COMPUTE LOC-VAL-TCIE = LOC-VAL-TCIE + CXE-SGV-MNTO IN CXE
                                               - CXE-SGV-MCAM IN CXE.
           COMPUTE LOC-VAL-MCIE = LOC-VAL-MCIE + CXE-SGV-MCAM IN CXE.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-BUS-CXE-CXE.
       EXT-BUS-CXE-CIE-RCV.
           MOVE CAN-RESP IN LOC-VARI TO CAN.
           MOVE RCV-RESP IN LOC-VARI TO RCV.
       FIN-BUS-CXE-CIE-RCV.
           EXIT.
       BUS-CXE-FGF SECTION.
       INI-BUS-CXE-FGF.
           MOVE CAN TO CAN-RESP IN LOC-VARI.
           MOVE LOC-CAI-IOPC IN LOC-VARI TO CXE-CAI-IOPC IN CXE.
           MOVE LOC-IIC-IOPC IN LOC-VARI TO CXE-IIC-IOPC IN CXE.
           MOVE ZEROES                   TO CXE-NUM-EVEN IN CXE.
           MOVE SPACES                   TO CXE-COD-EVEN IN CXE.
           MOVE SPACES                   TO CXE-CIC-IOPV IN CXE.
           MOVE ZEROES                   TO CXE-NUM-IVCT IN CXE.
           MOVE SPACES                   TO CXE-COD-CPTO IN CXE.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-BUS-CXE-FGF.
           PERFORM COL-FIO-CXE.
           IF NOT ( FIO-STAT-OKS AND
              LOC-CAI-IOPC IN LOC-VARI = CXE-CAI-IOPC IN CXE AND
              LOC-IIC-IOPC IN LOC-VARI = CXE-IIC-IOPC IN CXE )
            GO TO EXT-BUS-CXE-FGF.
           IF NOT ( CXE-COD-EVEN IN CXE = WSS-GLS-EVCA AND
                   CXE-COD-CPTO IN CXE = WSS-GLS-CFGF )
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-CXE-FGF.
           IF LOC-NUM-ICAN IN LOC-VARI = CXE-NUM-EVEN IN CXE
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-CXE-FGF.
           MOVE LOC-CAI-IOPC IN LOC-VARI TO CAN-CAI-IOPC IN CAN.
           MOVE LOC-IIC-IOPC IN LOC-VARI TO CAN-IIC-IOPC IN CAN.
           MOVE CXE-NUM-EVEN IN CXE      TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF CAN-MSC-STAT IN CAN NOT = WSS-GLS-AAAA
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-CXE-FGF.
           IF CAN-MSC-CANC IN CAN  = WSS-GLS-ICIE AND
              CXE-MSC-STAT IN CXE  = WSS-GLS-VVVV
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-CXE-FGF.
           IF CXE-SGV-MNTO IN CXE > ZEROES
               MOVE CXE-FEC-FVEN IN CXE TO LOC-CXE-FVEN IN LOC-VARI.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-BUS-CXE-FGF.
       EXT-BUS-CXE-FGF.
           MOVE CAN-RESP IN LOC-VARI TO CAN.
       FIN-BUS-CXE-FGF.
           EXIT.
       LOC-DET-SCR-1 SECTION.
       INI-LOC-DET-SCR-1.
           COMPUTE LOC-VAL-SCOR = ( RLO-VAL-PGAR IN RLO *
                                    LCC-SGV-CORI IN LCC *
                            LOC-SGV-PLZO IN LOC-VARI) / WSS-10000.
           PERFORM LOC-LEE-LCT.
           DIVIDE LOC-VAL-SCOR BY LOC-BAS-FGPE IN LOC-VARI
           GIVING LOC-VAL-ALFA.
       FIN-LOC-DET-SCR-1.
           EXIT.
       LOC-DET-MORA SECTION.
       INI-LOC-DET-MORA.
           MOVE LOC-NUM-DVEN IN LOC-VARI TO LOC-NUM-DUN IN LOC-VARI.
           MOVE LOC-NUM-MVEN IN LOC-VARI TO LOC-NUM-MUN IN LOC-VARI.
           MOVE LOC-NUM-SVEN IN LOC-VARI TO LOC-NUM-SUN IN LOC-VARI.
           MOVE LOC-NUM-AVEN IN LOC-VARI TO LOC-NUM-AUN IN LOC-VARI.
           MOVE LOC-NUM-DCAN IN LOC-VARI TO LOC-NUM-DDO IN LOC-VARI.
           MOVE LOC-NUM-MCAN IN LOC-VARI TO LOC-NUM-MDO IN LOC-VARI.
           MOVE LOC-NUM-SCAN IN LOC-VARI TO LOC-NUM-SDO IN LOC-VARI.
           MOVE LOC-NUM-ACAN IN LOC-VARI TO LOC-NUM-ADO IN LOC-VARI.
           PERFORM LOC-DIF-DIA.
           PERFORM LOC-DET-SCR-1.
           IF LOC-VAL-ALFA NOT > ZEROES
               MOVE ZEROES TO LOC-VAL-MCAN
               GO TO FIN-LOC-DET-MORA.
           COMPUTE LOC-VAL-ALF1 = WSS-NUM-IUN1 + LOC-VAL-ALFA.
           COMPUTE LOC-VAL-ALF2 = LOC-VAL-TOTA * LOC-VAL-ALF1
           COMPUTE LOC-VAL-ALF3 = LOC-VAL-ALFA * WSS-NUM-IDOS
           COMPUTE LOC-VAL-ALF4 = WSS-NUM-IUN1 + LOC-VAL-ALF3.
           COMPUTE LOC-VAL-ALF5 = LOC-VAL-ALF2 / LOC-VAL-ALF4
           COMPUTE LOC-VAL-MCAN = LOC-VAL-TOTA - LOC-VAL-ALF5.
           IF LOC-CIC-TVAL IN LOC-VARI = WSS-GLS-INNO
               PERFORM LOC-CON-MON-CAM
               IF LOC-GLS-MENS IN LOC-VARI = WSS-GLS-NCOM
                   GO TO FIN-LOC-DET-MORA
               ELSE
                   NEXT SENTENCE
           ELSE
              MOVE LOC-VAL-MCAN IN LOC-VARI TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO LOC-VAL-MCAN.
       FIN-LOC-DET-MORA.
           EXIT.
       LOC-CON-MON-CAM SECTION.
       INI-LOC-CON-MON-CAM.
           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTPAG-R
               MOVE LOC-COD-VCOC IN LOC-VARI TO CAM-COD-VCAM IN CAM(1)
               MOVE LOC-COD-PESO IN LOC-VARI TO CAM-COD-VCAM IN CAM(2)
               MOVE LOC-NUM-DCAN IN LOC-VARI TO CAM-NUM-DCAM IN CAM(1)
               MOVE LOC-NUM-MCAN IN LOC-VARI TO CAM-NUM-MCAM IN CAM(1)
               MOVE LOC-NUM-SCAN IN LOC-VARI TO CAM-NUM-SCAM IN CAM(1)
               MOVE LOC-NUM-ACAN IN LOC-VARI TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM.
               IF NOT (FIO-STAT-OKS AND CAM-IND-VIGE = WSS-GLS-INSI )
                   IF WSS-FEC-CPTPAG-R = LOC-FEC-FCAN IN LOC-VARI OR
                      VEN-FEC-FVEN IN VEN = LOC-FEC-FCAN IN LOC-VARI
                       MOVE WSS-VAL-CPTPGO TO CAM-SGV-VCAM IN CAM
                   ELSE
                       MOVE GAR-CT-TAB        TO MSG-COD-SIST
                       MOVE GAR-CT-ECAM TO LOC-GLS-MENS IN LOC-VARI
                       GO TO FIN-LOC-CON-MON-CAM
           ELSE
               MOVE WSS-VAL-CPTPGO TO CAM-SGV-VCAM IN CAM.
           MULTIPLY LOC-VAL-MCAN IN LOC-VARI BY CAM-SGV-VCAM IN CAM
                                    GIVING LOC-VAL-MCAN IN LOC-VARI.
           MOVE LOC-VAL-MCAN IN LOC-VARI TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO LOC-VAL-MCAN.
       FIN-LOC-CON-MON-CAM.
           EXIT.
       DET-COMI-CTE SECTION.
       INI-DET-COMI-CTE.
           MOVE LOC-CXE-DVEN TO LOC-NUM-DUN IN LOC-VARI.
           MOVE LOC-CXE-MVEN TO LOC-NUM-MUN IN LOC-VARI.
           MOVE LOC-CXE-SVEN TO LOC-NUM-SUN IN LOC-VARI.
           MOVE LOC-CXE-AVEN TO LOC-NUM-AUN IN LOC-VARI.


           MOVE LOC-NUM-DVEN IN LOC-VARI TO LOC-NUM-DDO IN LOC-VARI.
           MOVE LOC-NUM-MVEN IN LOC-VARI TO LOC-NUM-MDO IN LOC-VARI.
           MOVE LOC-NUM-SVEN IN LOC-VARI TO LOC-NUM-SDO IN LOC-VARI.
           MOVE LOC-NUM-AVEN IN LOC-VARI TO LOC-NUM-ADO IN LOC-VARI.
           PERFORM LOC-DIF-DIA.
           PERFORM LOC-PRO-CIE.
           COMPUTE LOC-VAL-SCRE IN LOC-VARI =
                   LOC-VAL-SALD IN LOC-VARI - LOC-VAL-TKAP
           PERFORM LOC-DET-SCR.
           MOVE LOC-VAL-COMI IN LOC-VARI TO LOC-VAL-ICTE.
           IF LOC-CIC-TVAL IN LOC-VARI = WSS-GLS-INNO
               PERFORM LOC-CON-MON-CTE
               IF LOC-GLS-MENS IN LOC-VARI = WSS-GLS-NCOM
                   GO TO FIN-DET-COMI-CTE
               ELSE
                   NEXT SENTENCE
           ELSE
              MOVE LOC-VAL-ICTE             TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO LOC-VAL-ICTE.
           MOVE LOC-NUM-DVEN IN LOC-VARI TO LOC-NUM-DUN IN LOC-VARI.
           MOVE LOC-NUM-MVEN IN LOC-VARI TO LOC-NUM-MUN IN LOC-VARI.
           MOVE LOC-NUM-SVEN IN LOC-VARI TO LOC-NUM-SUN IN LOC-VARI.
           MOVE LOC-NUM-AVEN IN LOC-VARI TO LOC-NUM-AUN IN LOC-VARI.
           MOVE LOC-NUM-DCAN IN LOC-VARI TO LOC-NUM-DDO IN LOC-VARI.
           MOVE LOC-NUM-MCAN IN LOC-VARI TO LOC-NUM-MDO IN LOC-VARI.
           MOVE LOC-NUM-SCAN IN LOC-VARI TO LOC-NUM-SDO IN LOC-VARI.
           MOVE LOC-NUM-ACAN IN LOC-VARI TO LOC-NUM-ADO IN LOC-VARI.
           PERFORM LOC-DIF-DIA.
           IF LOC-GLS-TCAN IN LOC-VARI = WSS-GLS-NCOM
               MOVE ZEROES  TO LOC-SGV-PLZO IN LOC-VARI
               MOVE SPACES TO MSG-COD-MENS
               MOVE SPACES TO LOC-GLS-TCAN IN LOC-VARI.
           PERFORM LOC-DET-KVE.
           PERFORM LOC-DET-SCR
           MOVE LOC-VAL-COMI IN LOC-VARI TO LOC-VAL-MCTE.
           IF LOC-CIC-TVAL IN LOC-VARI = WSS-GLS-INNO
               PERFORM LOC-CON-MON-MCTE
               IF LOC-GLS-MENS IN LOC-VARI = WSS-GLS-NCOM
                   GO TO FIN-DET-COMI-CTE
               ELSE
                   NEXT SENTENCE
           ELSE
              MOVE LOC-VAL-MCTE             TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO LOC-VAL-MCTE.
       FIN-DET-COMI-CTE.
           EXIT.
       LOC-CON-MON-CTE SECTION.
       INI-LOC-CON-MON-CTE.
           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTPAG-R
               MOVE LOC-COD-VCOC IN LOC-VARI TO CAM-COD-VCAM IN CAM(1)
               MOVE LOC-COD-PESO IN LOC-VARI TO CAM-COD-VCAM IN CAM(2)
               MOVE LOC-NUM-DCAN IN LOC-VARI TO CAM-NUM-DCAM IN CAM(1)
               MOVE LOC-NUM-MCAN IN LOC-VARI TO CAM-NUM-MCAM IN CAM(1)
               MOVE LOC-NUM-SCAN IN LOC-VARI TO CAM-NUM-SCAM IN CAM(1)
               MOVE LOC-NUM-ACAN IN LOC-VARI TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM.
               IF NOT (FIO-STAT-OKS AND CAM-IND-VIGE = WSS-GLS-INSI )
                   IF WSS-FEC-CPTPAG-R = LOC-FEC-FCAN IN LOC-VARI OR
                      VEN-FEC-FVEN IN VEN = LOC-FEC-FCAN IN LOC-VARI
                       MOVE WSS-VAL-CPTPGO TO CAM-SGV-VCAM IN CAM
                   ELSE
                       MOVE GAR-CT-TAB        TO MSG-COD-SIST
                       MOVE GAR-CT-ECAM TO LOC-GLS-MENS IN LOC-VARI
                       GO TO FIN-LOC-CON-MON-CAM
           ELSE
               MOVE WSS-VAL-CPTPGO TO CAM-SGV-VCAM IN CAM.
           MULTIPLY LOC-VAL-ICTE             BY CAM-SGV-VCAM IN CAM
                                      GIVING LOC-VAL-ICTE.
           MOVE LOC-VAL-ICTE             TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO LOC-VAL-ICTE.
       FIN-LOC-CON-MON-CTE.
           EXIT.
       LOC-CON-MON-MCTE SECTION.
       INI-LOC-CON-MON-MCTE.
           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTPAG-R
               MOVE LOC-COD-VCOC IN LOC-VARI TO CAM-COD-VCAM IN CAM(1)
               MOVE LOC-COD-PESO IN LOC-VARI TO CAM-COD-VCAM IN CAM(2)
               MOVE LOC-NUM-DCAN IN LOC-VARI TO CAM-NUM-DCAM IN CAM(1)
               MOVE LOC-NUM-MCAN IN LOC-VARI TO CAM-NUM-MCAM IN CAM(1)
               MOVE LOC-NUM-SCAN IN LOC-VARI TO CAM-NUM-SCAM IN CAM(1)
               MOVE LOC-NUM-ACAN IN LOC-VARI TO CAM-NUM-ACAM IN CAM(1)
               MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT (FIO-STAT-OKS AND CAM-IND-VIGE = WSS-GLS-INSI )
                   IF WSS-FEC-CPTPAG-R = LOC-FEC-FCAN IN LOC-VARI OR
                      VEN-FEC-FVEN IN VEN = LOC-FEC-FCAN IN LOC-VARI
                       MOVE WSS-VAL-CPTPGO TO CAM-SGV-VCAM IN CAM
                   ELSE
                       MOVE GAR-CT-TAB        TO MSG-COD-SIST
                       MOVE GAR-CT-ECAM TO LOC-GLS-MENS IN LOC-VARI
                       GO TO FIN-LOC-CON-MON-CAM
           ELSE
               MOVE WSS-VAL-CPTPGO TO CAM-SGV-VCAM IN CAM.
           MULTIPLY LOC-VAL-MCTE             BY CAM-SGV-VCAM IN CAM
                                         GIVING LOC-VAL-MCTE.
           MOVE LOC-VAL-MCTE             TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO LOC-VAL-MCTE.
       FIN-LOC-CON-MON-MCTE.
           EXIT.
       CAL-COMI-TOTA SECTION.
       INI-CAL-COMI-TOTA.
           IF LOC-VAL-TCIE > LOC-VAL-ICTE
               MOVE ZEROES TO LOC-VAL-MNTO
           ELSE
               COMPUTE LOC-VAL-MNTO = LOC-VAL-ICTE - LOC-VAL-TCIE.
           IF LOC-VAL-MCIE > LOC-VAL-MCTE
               MOVE ZEROES TO LOC-VAL-MCAN
           ELSE
               COMPUTE LOC-VAL-MCAN = LOC-VAL-MCTE - LOC-VAL-MCIE.
           MOVE WSS-GLS-INSI TO LOC-CIC-TVAL IN LOC-VARI.
       FIN-CAL-COMI-TOTA.
           EXIT.
       BUS-CXE-FGF-CTE SECTION.
       INI-BUS-CXE-FGF-CTE.
           MOVE LOC-CXE-FVEA TO LOC-CXE-FMOR.
           MOVE CAN TO CAN-RESP IN LOC-VARI.
           MOVE LOC-CAI-IOPC IN LOC-VARI TO CXE-CAI-IOPC IN CXE.
           MOVE LOC-IIC-IOPC IN LOC-VARI TO CXE-IIC-IOPC IN CXE.
           MOVE ZEROES                   TO CXE-NUM-EVEN IN CXE.
           MOVE SPACES                   TO CXE-COD-EVEN IN CXE.
           MOVE SPACES                   TO CXE-CIC-IOPV IN CXE.
           MOVE ZEROES                   TO CXE-NUM-IVCT IN CXE.
           MOVE SPACES                   TO CXE-COD-CPTO IN CXE.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-BUS-CXE-FGF-CTE.
           PERFORM COL-FIO-CXE.
           IF NOT ( FIO-STAT-OKS AND
              LOC-CAI-IOPC IN LOC-VARI = CXE-CAI-IOPC IN CXE AND
              LOC-IIC-IOPC IN LOC-VARI = CXE-IIC-IOPC IN CXE )
            GO TO EXT-BUS-CXE-FGF-CTE.
           IF NOT ( CXE-COD-EVEN IN CXE = WSS-GLS-EVCA AND
                   CXE-COD-CPTO IN CXE = WSS-GLS-CFGF )
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-CXE-FGF-CTE.
           IF LOC-NUM-ICAN IN LOC-VARI = CXE-NUM-EVEN IN CXE
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-CXE-FGF-CTE.
           MOVE LOC-CAI-IOPC IN LOC-VARI TO CAN-CAI-IOPC IN CAN.
           MOVE LOC-IIC-IOPC IN LOC-VARI TO CAN-IIC-IOPC IN CAN.
           MOVE CXE-NUM-EVEN IN CXE      TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF CAN-MSC-STAT IN CAN NOT = WSS-GLS-AAAA
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-CXE-FGF-CTE.
           IF CXE-SGV-MNTO IN CXE > ZEROES
               IF CXE-FEC-FVEN IN CXE NOT > LOC-FEC-FVEN
                   MOVE CXE-FEC-FVEN IN CXE TO LOC-CXE-FMOR.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-BUS-CXE-FGF-CTE.
       EXT-BUS-CXE-FGF-CTE.
           MOVE CAN-RESP IN LOC-VARI TO CAN.
       FIN-BUS-CXE-FGF-CTE.
           EXIT.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
      *COPY COLBGVEN.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
       COPY TABBKTXC.
       COPY GNSBVCOD.
       COPY TABBVTDU.
       COPY TABBVOFI.
       COPY COLBGCLI.
       COPY GNSBGCAM.
       COPY GNSBVTAB.
       COPY TABBBOFI.
       COPY TABBBUSR.
       COPY GNSBGPES.
      *AFRI-INI MAYO-2012 INDICADORES CAE Y CAEV
       COPY COLBGCAV.
      *AFRI-FIN MAYO-2012 INDICADORES CAE Y CAEV

       PUT-TS-OPC SECTION.
       INI-PUT-TS-OPC.
       FIN-PUT-TS-OPC.
           EXIT.

       NO-VAL-MLT SECTION.
       INI-NO-VAL-MLT.
       FIN-NO-VAL-MLT.
           EXIT.


 RGD  * VER QUE SALE CON ESTE CODIGO
       FIO SECTION.
       INI-FIO.
       FIN-FIO.
           EXIT.

       PCP-PRO-SAF SECTION.
       PCP-PRO-ACT SECTION.
       PCP-PRO-VAL SECTION.
       PCP-PRO-VKY SECTION.
       PCP-PRO-VDA SECTION.
       PCP-PRO-ING SECTION.
       PCP-PRO-MOD SECTION.
       PCP-PRO-ELI SECTION.
       PCP-PRO-CON SECTION.
       PCP-PRO-CO2 SECTION.
       PCP-PRO-PF7 SECTION.
       PCP-PRO-AC7 SECTION.
       PCP-PRO-PF8 SECTION.
       PCP-PRO-AC8 SECTION.
       PCP-PRO-CUR SECTION.
       PROCESA-PCP SECTION.
       INI-PROCESA-PCP.
           MOVE SCR-QIDD      TO PCP-QIDD.
           MOVE SCR-LIDD      TO PCP-LIDD.
           MOVE PCP-DINP      TO SYS-CMMA.
      *    MOVE 'COLPPPCP'    TO SYS-PROG.
      *    MOVE +1012         TO SYS-TCMA.
           MOVE 'COLPPPDC'    TO SYS-PROG.
           MOVE QUE-PDC-LITM  TO SYS-TCMA.
           MOVE SYS-LINK      TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA TO PCP-DOUT.
           MOVE PCP-DOUT TO PCP     .
           IF PCP-RETO = '1'
               MOVE SPACES TO PCP
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'ERROR PCP'    TO PCP-CMSG MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC   TO FRM-MENS
               MOVE PCP-MMSG       TO FRM-MEN2
               MOVE FRM-SUAR-MAL   TO FRM-SUAR
               GO TO FIN-PROCESA-PCP.
       FIN-PROCESA-PCP.
           EXIT.

       SET-VAR-LOCC SECTION.
       INI-SET-VAR-LOCC.

           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTFCAM
               COMPUTE OPC-VAL-SCRE IN OPC =
                   OPC-VAL-SCRE IN OPC + VEN-VAL-SCAP IN VEN.
      *        COMPUTE BKP-VAL-SCRE        =
      *            BKP-VAL-SCRE        + VEN-VAL-SCAP IN VEN.

           IF PCP NOT > SPACES
               MOVE ZEROES TO PCP-SUCO PCP-SUIM PCP-SUVP.
           MOVE ZEROES                  TO LOC-COM-FGPE IN LOC-VARI.
           MOVE ZEROES                  TO LOC-VAL-MCAN IN LOC-VARI.
           MOVE ZEROES                  TO LOC-VAL-MNTO IN LOC-VARI.
      *    MOVE OPC-COD-TOOC IN OPC     TO LOC-COD-TOOC IN LOC-VARI.
      *    MOVE OPC-COD-VCOC IN OPC     TO LOC-COD-VCOC IN LOC-VARI.
      *+ AGREGADO AHORA RGD-FGP
           PERFORM LOC-INI-OPC.
           MOVE OPC-CAI-IOPC IN OPC     TO LOC-CAI-IOPC IN LOC-VARI.
           MOVE OPC-IIC-IOPC IN OPC     TO LOC-IIC-IOPC IN LOC-VARI.
           IF (VEN-VAL-CAPI IN VEN - VEN-VAL-SCAP IN VEN) > ZEROES
             COMPUTE LOC-VAL-SALD IN LOC-VARI =
                OPC-VAL-SCRE IN OPC +
      *         BKP-VAL-SCRE        +
                ( VEN-VAL-CAPI IN VEN - VEN-VAL-SCAP IN VEN )
           ELSE
              MOVE OPC-VAL-SCRE IN OPC  TO LOC-VAL-SALD IN LOC-VARI.
      *       MOVE BKP-VAL-SCRE         TO LOC-VAL-SALD IN LOC-VARI.
      *- AGREGADO AHORA RGD-FGP

 RGDF *    MOVE CAN-SGV-TREN IN CAN-FLD TO LOC-SGV-TREN IN LOC-VARI.


 RGDF *    MOVE CAN-NUM-ICAN IN CAN-FLD TO LOC-NUM-ICAN IN LOC-VARI.
 RGDF *    MOVE VEN-NUM-IVCT IN CAN-FLD TO LOC-NUM-IVCT IN LOC-VARI.
      *    MOVE CAN-NUM-DCAN IN CAN-FLD TO LOC-NUM-DCAN IN LOC-VARI.
      *    MOVE CAN-NUM-MCAN IN CAN-FLD TO LOC-NUM-MCAN IN LOC-VARI.
      *    MOVE CAN-NUM-SCAN IN CAN-FLD TO LOC-NUM-SCAN IN LOC-VARI.
      *    MOVE CAN-NUM-ACAN IN CAN-FLD TO LOC-NUM-ACAN IN LOC-VARI.
           MOVE WSS-NUM-DCPTPAG         TO LOC-NUM-DCAN IN LOC-VARI.
           MOVE WSS-NUM-MCPTPAG         TO LOC-NUM-MCAN IN LOC-VARI.
           MOVE WSS-NUM-SCPTPAG         TO LOC-NUM-SCAN IN LOC-VARI.
           MOVE WSS-NUM-ACPTPAG         TO LOC-NUM-ACAN IN LOC-VARI.
 RGDF *    MOVE RCV-SGV-FINA IN CAN-FLD TO LOC-SGV-FINA IN LOC-VARI.
 RGDF *    MOVE RCV-SGV-CAPI IN CAN-FLD TO LOC-RCV-CAPI IN LOC-VARI.
           PERFORM GET-FHOY.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE HOY-FHOY IN HOY-VARI    TO LOC-FEC-FHOY IN LOC-VARI.
           MOVE WSS-FEC-CPTPAG-R        TO LOC-FEC-FHOY IN LOC-VARI.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *+ AGREGADO AHORA RGD-FGP
      *    MOVE CAN-MSC-CANC IN CAN-FLD TO LOC-MSC-CANC IN LOC-VARI.
      * MOVER CTT PARA PAGO TOTAL Y KTT PARA PAGO PARCIAL
           IF WSS-IND-CPTCAAD = 'T'
              MOVE 'CTT'                TO LOC-MSC-CANC IN LOC-VARI
           ELSE
              MOVE 'KTT'                TO LOC-MSC-CANC IN LOC-VARI.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           IF WSS-IND-VMOR IN WSS-VARI = 'S'
               MOVE 'CTE' TO LOC-MSC-CANC IN LOC-VARI.

      *    IF DLC-FEC-FDEV IN DLC > ZEROES
      *       MOVE DLC-NUM-DDEV IN DLC  TO LOC-CXE-DVEN
      *       MOVE DLC-NUM-MDEV IN DLC  TO LOC-CXE-MVEN
      *       MOVE DLC-NUM-SDEV IN DLC  TO LOC-CXE-SVEN
      *       MOVE DLC-NUM-ADEV IN DLC  TO LOC-CXE-AVEN
           IF WSS-VEN-ANTE IN WSS-VARI > ZEROES
              MOVE WSS-NUM-DANT IN WSS-VARI TO LOC-CXE-DVEN
              MOVE WSS-NUM-MANT IN WSS-VARI TO LOC-CXE-MVEN
              MOVE WSS-NUM-SANT IN WSS-VARI TO LOC-CXE-SVEN
              MOVE WSS-NUM-AANT IN WSS-VARI TO LOC-CXE-AVEN
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           ELSE
              MOVE OPC-NUM-DCOL IN OPC  TO LOC-CXE-DVEN
              MOVE OPC-NUM-MCOL IN OPC  TO LOC-CXE-MVEN
              MOVE OPC-NUM-SCOL IN OPC  TO LOC-CXE-SVEN
              MOVE OPC-NUM-ACOL IN OPC  TO LOC-CXE-AVEN.

      *    MOVE WSS-NUM-DCPTPAG         TO LOC-NUM-DVEN IN LOC-VARI.
      *    MOVE WSS-NUM-MCPTPAG         TO LOC-NUM-MVEN IN LOC-VARI.
      *    MOVE WSS-NUM-SCPTPAG         TO LOC-NUM-SVEN IN LOC-VARI.
      *    MOVE WSS-NUM-ACPTPAG         TO LOC-NUM-AVEN IN LOC-VARI.
      *- AGREGADO AHORA RGD-FGP
           MOVE VEN-NUM-DVEN IN VEN     TO LOC-NUM-DVEN IN LOC-VARI.
           MOVE VEN-NUM-MVEN IN VEN     TO LOC-NUM-MVEN IN LOC-VARI.
           MOVE VEN-NUM-SVEN IN VEN     TO LOC-NUM-SVEN IN LOC-VARI.
           MOVE VEN-NUM-AVEN IN VEN     TO LOC-NUM-AVEN IN LOC-VARI.
           MOVE VEN-VAL-CAPI IN VEN     TO LOC-VAL-CAPI IN LOC-VARI.
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
           MOVE OPC-CAI-IOPC IN OPC     TO CAN-CAI-IOPC IN CAN.
           MOVE OPC-IIC-IOPC IN OPC     TO CAN-IIC-IOPC IN CAN.
           MOVE VEN-NUM-IVCT IN VEN     TO VEN-NUM-IVCT IN CAN-FLD.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
       FIN-SET-VAR-LOCC.
           EXIT.

       SET-VAR-LOCC2 SECTION.
       INI-SET-VAR-LOCC2.

           IF PCP NOT > SPACES
               MOVE ZEROES TO PCP-SUCO PCP-SUIM PCP-SUVP.
           MOVE ZEROES                  TO LOC-COM-FGPE IN LOC-VARI.
           MOVE ZEROES                  TO LOC-VAL-MCAN IN LOC-VARI.
           MOVE ZEROES                  TO LOC-VAL-MNTO IN LOC-VARI.
           PERFORM LOC-INI-OPC.
           MOVE OPC-CAI-IOPC IN OPC     TO LOC-CAI-IOPC IN LOC-VARI.
           MOVE OPC-IIC-IOPC IN OPC     TO LOC-IIC-IOPC IN LOC-VARI.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    COMPUTE LOC-VAL-SALD IN LOC-VARI =
      *         OPC-VAL-SCRE IN OPC - VEN-VAL-CAPI IN VEN.
      *    MOVE VEN-VAL-CAPI IN VEN     TO LOC-VAL-SALD IN LOC-VARI.
           MOVE VEN-VAL-SCAP IN VEN     TO LOC-VAL-SALD IN LOC-VARI.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

           MOVE WSS-NUM-DCPTPAG         TO LOC-NUM-DCAN IN LOC-VARI.
           MOVE WSS-NUM-MCPTPAG         TO LOC-NUM-MCAN IN LOC-VARI.
           MOVE WSS-NUM-SCPTPAG         TO LOC-NUM-SCAN IN LOC-VARI.
           MOVE WSS-NUM-ACPTPAG         TO LOC-NUM-ACAN IN LOC-VARI.
           PERFORM GET-FHOY.
           MOVE HOY-FHOY IN HOY-VARI    TO LOC-FEC-FHOY IN LOC-VARI.
           IF WSS-IND-CPTCAAD = 'T'
              MOVE 'CTT'                TO LOC-MSC-CANC IN LOC-VARI
           ELSE
              MOVE 'KTT'                TO LOC-MSC-CANC IN LOC-VARI.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           IF WSS-IND-VMOR IN WSS-VARI = 'S'
               MOVE 'CTE' TO LOC-MSC-CANC IN LOC-VARI.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    IF DLC-FEC-FDEV IN DLC > ZEROES
      *       MOVE DLC-NUM-DDEV IN DLC  TO LOC-CXE-DVEN
      *       MOVE DLC-NUM-MDEV IN DLC  TO LOC-CXE-MVEN
      *       MOVE DLC-NUM-SDEV IN DLC  TO LOC-CXE-SVEN
      *       MOVE DLC-NUM-ADEV IN DLC  TO LOC-CXE-AVEN
           IF WSS-VEN-ANTE IN WSS-VARI > ZEROES
              MOVE WSS-NUM-DANT IN WSS-VARI TO LOC-CXE-DVEN
              MOVE WSS-NUM-MANT IN WSS-VARI TO LOC-CXE-MVEN
              MOVE WSS-NUM-SANT IN WSS-VARI TO LOC-CXE-SVEN
              MOVE WSS-NUM-AANT IN WSS-VARI TO LOC-CXE-AVEN
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           ELSE
              MOVE OPC-NUM-DCOL IN OPC  TO LOC-CXE-DVEN
              MOVE OPC-NUM-MCOL IN OPC  TO LOC-CXE-MVEN
              MOVE OPC-NUM-SCOL IN OPC  TO LOC-CXE-SVEN
              MOVE OPC-NUM-ACOL IN OPC  TO LOC-CXE-AVEN.

           MOVE WSS-NUM-DCPTPAG         TO LOC-NUM-DVEN IN LOC-VARI.
           MOVE WSS-NUM-MCPTPAG         TO LOC-NUM-MVEN IN LOC-VARI.
           MOVE WSS-NUM-SCPTPAG         TO LOC-NUM-SVEN IN LOC-VARI.
           MOVE WSS-NUM-ACPTPAG         TO LOC-NUM-AVEN IN LOC-VARI.
           MOVE VEN-VAL-CAPI IN VEN     TO LOC-VAL-CAPI IN LOC-VARI.

            MOVE VEN-NUM-DIMV IN VEN    TO LOC-CXE-DVEN.
            MOVE VEN-NUM-MIMV IN VEN    TO LOC-CXE-MVEN.
            MOVE VEN-NUM-SIMV IN VEN    TO LOC-CXE-SVEN.
            MOVE VEN-NUM-AIMV IN VEN    TO LOC-CXE-AVEN.



            MOVE WSS-NUM-DCPTPAG        TO FEC-DEC2.
            MOVE WSS-NUM-MCPTPAG        TO FEC-MEC2.
            MOVE WSS-NUM-SCPTPAG        TO FEC-SEC2.
            MOVE WSS-NUM-ACPTPAG        TO FEC-AEC2.
            MOVE VEN-NUM-DIMV IN VEN    TO FEC-DEC1.
            MOVE VEN-NUM-MIMV IN VEN    TO FEC-MEC1.
            MOVE VEN-NUM-SIMV IN VEN    TO FEC-SEC1.
            MOVE VEN-NUM-AIMV IN VEN    TO FEC-AEC1.
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
           MOVE OPC-CAI-IOPC IN OPC     TO CAN-CAI-IOPC IN CAN.
           MOVE OPC-IIC-IOPC IN OPC     TO CAN-IIC-IOPC IN CAN.
           MOVE VEN-NUM-IVCT IN VEN     TO VEN-NUM-IVCT IN CAN-FLD.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE


       FIN-SET-VAR-LOCC2.

           EXIT.

      *>>>> EOF
      *>>>>

       OBT-VCAM-FHOY SECTION.
       INI-OBT-VCAM-FHOY.
           MOVE '0998  '                 TO CAM-COD-VCAM IN CAM(1).
           MOVE '0999  '                 TO CAM-COD-VCAM IN CAM(2).
           MOVE WSS-FEC-CPTFCAM          TO CAM-FEC-FCAM IN CAM(1)
                                            CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.

           PERFORM TAB-FIO-CAM.
           IF ( NOT FIO-STAT-OKS              ) OR
              ( CAM-MSC-STAT IN CAM NOT = 'S' )
              GO TO FIN-OBT-VCAM-FHOY.
           MOVE CAM-SGV-VCAM IN CAM         TO WSS-CAM-SGV-UF.
       FIN-OBT-VCAM-FHOY.
           EXIT.

       BUSCA-TIPO-TASACPT SECTION.
       INI-BUSCA-TIPO-TASACPT.
           MOVE OPC-CIC-IOPC IN OPC TO ITR-CIC-IOPC IN ITR.
           MOVE ZEROES              TO ITR-NUM-ICAN IN ITR.
           MOVE SPACES              TO ITR-CIC-IOPV IN ITR.
           MOVE ZEROES              TO ITR-NUM-IVCT IN ITR.
           MOVE 'INT'               TO ITR-IND-TTAS IN ITR.
           MOVE ZEROES              TO ITR-FEC-FINI IN ITR.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ITR.
           IF FIO-STAT-OKS AND
              ITR-CIC-IOPC IN ITR = OPC-CIC-IOPC IN OPC AND
              ITR-NUM-ICAN IN ITR = ZEROES              AND
              ITR-CIC-IOPV IN ITR = SPACES              AND
              ITR-NUM-IVCT IN ITR = ZEROES              AND
              ITR-IND-TTAS IN ITR = 'INT'

      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
              MOVE ITR-MSC-PBTI IN ITR TO WSS-VAL-BASE IN WSS-VARI
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL

              IF ITR-COD-CVTI IN ITR > SPACES
                 MOVE ITR-SGV-SPRD IN ITR TO ITR-SGV-TINT IN ITR
                 MOVE 'CPTTASVAR ' TO WSS-COD-MENSCPT
                 PERFORM BUSCA-GLOSAS-CPT
      *          MOVE 'CPTTASVAR ' TO MSG-COD-MENS
      *          MOVE 'COL'        TO MSG-COD-SIST
      *          PERFORM GET-MSG
      *          MOVE MSG-GLS-DESC TO WSS-GLS-CPT1
      *
      *          MOVE 'CPTTASVAR1' TO MSG-COD-MENS
      *          MOVE 'COL'        TO MSG-COD-SIST
      *          PERFORM GET-MSG
      *          MOVE MSG-GLS-DESC TO WSS-GLS-CPT2
                 MOVE WSS-GLS-CPT  TO FRM-GLS-GLO1
              ELSE
                 NEXT SENTENCE
           ELSE
               MOVE '23' TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-ITR.
           IF FIO-STAT-OKS AND ITR-COD-CVTI IN ITR > SPACES
              MOVE 'I'                 TO CAM-MSC-TVAL IN CAM(1)
              MOVE ITR-COD-CVTI IN ITR TO CAM-COD-CVAL IN CAM(1)
              MOVE ITR-MSC-PBTI IN ITR TO CAM-COD-TCAM IN CAM(1)
              MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(1)
              MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(2)
              MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(2)
              MOVE FIO-GET-KEY         TO FIO-CMND
              PERFORM TAB-FIO-CAM
              IF FIO-STAT-OKS
                 ADD CAM-SGV-VCAM IN CAM TO ITR-SGV-TINT IN ITR.

              MOVE ITR-SGV-TINT IN ITR   TO FRM-VAL-TASA IN CPT-FLD.
              IF ITR-COD-TINT IN ITR > SPACES
                 MOVE 'COL'        TO TAB-COD-SIST
                 MOVE 'INT '       TO TAB-COD-TTAB IN TAB
                 MOVE ITR-COD-TINT TO TAB-COD-CTAB IN TAB
                 PERFORM BUS-TAB
                 MOVE TAB-GLS-DESC IN TAB TO
                             FRM-GLS-TASA IN CPT-FLD
              ELSE
                 MOVE SPACES TO FRM-GLS-TASA IN CPT-FLD.

              IF FRM-GLS-TASA IN CPT-FLD = 'MULTIPLES'
                 MOVE ZEROES TO FRM-VAL-TASA IN CPT-FLD.
       FIN-BUSCA-TIPO-TASACPT.
           EXIT.

       BUSCA-TIPO-PERIODO SECTION.
       INI-BUSCA-TIPO-PERIODO.
           MOVE OPC-CIC-IOPC IN OPC TO EVC-CIC-IOPC IN EVC.
           MOVE ZEROES              TO EVC-NUM-IEVC IN EVC.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-EVC.
           IF NOT ( FIO-STAT-OKS AND
              EVC-CIC-IOPC IN EVC = OPC-CIC-IOPC IN OPC )
              GO TO FIN-BUSCA-TIPO-PERIODO.

      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
           MOVE ZEROES TO WSS-FEC-FPVC IN WSS-VARI.
           MOVE 9999   TO WSS-NUM-DIFD IN WSS-VARI.
       REV-FEC-EVC.
           MOVE WSS-NUM-DCPTPAG TO WSS-NUM-DCPTPAG-R.
           MOVE WSS-NUM-MCPTPAG TO WSS-NUM-MCPTPAG-R.
           MOVE WSS-NUM-SCPTPAG TO WSS-NUM-SCPTPAG-R.
           MOVE WSS-NUM-ACPTPAG TO WSS-NUM-ACPTPAG-R.
           IF WSS-FEC-CPTPAG-R <= EVC-FEC-FPVC IN EVC
               PERFORM CAL-DIFDIAS.
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
           MOVE EVC-IND-UTSV IN EVC TO WSS-IND-UTSV.
           MOVE FIO-GET-NXT         TO FIO-CMND.
           PERFORM COL-FIO-EVC.
           IF (FIO-STAT-OKS AND
              EVC-CIC-IOPC IN EVC = OPC-CIC-IOPC IN OPC )
                 MOVE 'MULTIPLE'     TO   FRM-GLS-UTSV IN CPT-FLD
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
      *          GO TO FIN-BUSCA-TIPO-PERIODO.
                 GO TO REV-FEC-EVC.
       INF-SI-NMUL.
           IF FRM-GLS-UTSV IN CPT-FLD = 'MULTIPLE'
               GO TO FIN-BUSCA-TIPO-PERIODO.
      *AFRI-FIN JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
           IF WSS-IND-UTSV > SPACES
              MOVE 'TAB'         TO MSC-COD-SIST
              MOVE 'IPER'        TO MSC-COD-TMSC IN MSC
              MOVE WSS-IND-UTSV  TO MSC-COD-CMSC IN MSC
              PERFORM BUS-MSC
              MOVE MSC-GLS-DCOR IN MSC TO FRM-GLS-UTSV IN CPT-FLD
           ELSE
              MOVE SPACES              TO FRM-GLS-UTSV IN CPT-FLD.

       FIN-BUSCA-TIPO-PERIODO.
           EXIT.

       BUSCA-GLOSAS-CPT SECTION.
       INI-BUSCA-GLOSAS-CPT.
           MOVE SPACES             TO WSS-GLS-CPT.
           MOVE 'COL'              TO FIO-SIST.
           MOVE 'MSG'              TO TAB-COD-TTAB IN TAB.
           MOVE WSS-COD-MENSCPT    TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY        TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
              MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-CPT1
              MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-CPT2
           ELSE
              MOVE 'MSG NO ENCONTRADO' TO WSS-GLS-CPT1.
       FIN-BUSCA-GLOSAS-CPT.
           EXIT.
      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
       LIM-PTA-ERROR SECTION.
       INI-LIM-PTA-ERROR.
              MOVE SPACES      TO FRM-GLS-TCRE     IN CPT-FLD
              MOVE SPACES      TO FRM-GLS-TCAN     IN CPT-FLD
              MOVE ZEROES      TO DBC-NUM-ICLI-ALF IN CPT-FLD
              MOVE SPACES      TO DBC-VRF-ICLI     IN CPT-FLD
              MOVE SPACES      TO DBC-IND-ICLI     IN CPT-FLD
              MOVE SPACES      TO DBC-GLS-ICLI     IN CPT-FLD
              MOVE SPACES      TO FRM-GLS-UTSV     IN CPT-FLD
              MOVE ZEROES      TO OPC-FEC-FCOL     IN CPT-FLD
              MOVE SPACES      TO FRM-GLS-NOMC     IN CPT-FLD
              MOVE ZEROES      TO DLC-FEC-FMAV     IN CPT-FLD
              MOVE SPACES      TO OPC-COD-VCOC     IN CPT-FLD
              MOVE SPACES      TO FRM-GLS-MON      IN CPT-FLD
              MOVE ZEROES      TO FRM-VAL-TASA     IN CPT-FLD
              MOVE SPACES      TO FRM-GLS-TASA     IN CPT-FLD
              MOVE ZEROES      TO FRM-VAL-SCRE     IN CPT-FLD
              MOVE ZEROES      TO OPC-NUM-VCOR     IN CPT-FLD.
       FIN-LIM-PTA-ERROR.
           EXIT.
      *---------------------------------------------------------------
       PRO-PRE-PAR SECTION.
       INI-PRO-PRE-PAR.
      *SE TRABAJARAN TODOS LOS MONTOS EN PESOS
      *SE RESTA CUOTA QUE VENCIO DEL PREPAGO REALIZADO
      *SE CALCULA LA MORA DEL VENCIMIENTO
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE ZEROES TO WSS-VAL-CPTCAMO
                          WSS-VAL-CPTINT
                          WSS-VAL-CPTFGP.
           MOVE ZEROES TO WSS-VAL-MORASUM
                          WSS-VAL-INTSUM
                          WSS-VAL-CFGPSUM.
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
           MOVE ZEROES TO WSS-TOT-CAPM IN WSS-VARI.
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS

       REV-CUO-MOR-PAR.
           MOVE ZEROES TO WSS-VAL-CPTCAMO
                          WSS-VAL-CPTINT
                          WSS-VAL-CPTFGP.

           IF VEN-FEC-FIMV IN VEN NOT < WSS-FEC-CPTPAG-R
               GO TO SUM-PRO-PRE-PAR.

           IF VEN-FEC-FIMV IN VEN > WSS-CAN-RFUA IN WSS-VARI
               MOVE VEN-NUM-DIMV IN VEN      TO TXC-DEC1
               MOVE VEN-NUM-MIMV IN VEN      TO TXC-MEC1
               MOVE VEN-NUM-SIMV IN VEN      TO TXC-SEC1
               MOVE VEN-NUM-AIMV IN VEN      TO TXC-AEC1
           ELSE
               MOVE WSS-NUM-DFUA IN WSS-VARI TO TXC-DEC1
               MOVE WSS-NUM-MFUA IN WSS-VARI TO TXC-MEC1
               MOVE WSS-NUM-SFUA IN WSS-VARI TO TXC-SEC1
               MOVE WSS-NUM-AFUA IN WSS-VARI TO TXC-AEC1.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           PERFORM CALCULA-MORA-CPT.

           IF WSS-VAL-CPTCAMO < ZEROES
               MOVE ZEROES TO WSS-VAL-CPTCAMO.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           ADD WSS-VAL-CPTCAMO TO WSS-VAL-MORASUM.

      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *    PERFORM OBT-COM-NOR-CPT.
      *    ADD NOR-CONO TO WSS-VAL-MORASUM.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE

           MOVE WSS-DLC-FDEV IN WSS-VARI TO DLC-FEC-FDEV IN DLC.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *SE CALCULA COMISION FOGAPE SI ES QUE CORRESPONDE PARA ESTE VEN
           COMPUTE OPC-VAL-SCRE IN OPC = OPC-VAL-SCRE IN OPC -
                                         VEN-VAL-SCAP IN VEN.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    PERFORM SET-VAR-LOCC.
           MOVE 'S' TO WSS-IND-VMOR IN WSS-VARI.
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *    PERFORM SET-VAR-LOCC-MOR.
           PERFORM SET-VAR-LOCC.
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
           MOVE SPACES TO WSS-IND-VMOR IN WSS-VARI.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           PERFORM LOC-COM-FGP.

           IF LOC-GLS-NOCO IN LOC-VARI = 'SICOBRACOM' AND
                LOC-COM-FGPE IN LOC-VARI > ZEROES
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       IF OPC-COD-VCOC IN OPC = '0998  ' AND
      *           WSS-GLS-NOUF = 'NO'
      *          COMPUTE WSS-VAL-COMI = LOC-COM-FGPE * WSS-VAL-CPTPGO
      *          MOVE WSS-VAL-COMI  TO WSS-VAL-CPTFGPD
      *       ELSE
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
                 MOVE LOC-COM-FGPE    TO   WSS-VAL-COMI
                 MOVE WSS-VAL-COMI  TO WSS-VAL-CPTFGPD.

      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *    IF VEN-FEC-FIMV IN VEN NOT < WSS-FEC-CPTFCAM
      *       GO TO CONT-CAL-FOGAP2.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE 'S' TO WSS-IND-VMOR IN WSS-VARI.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *    PERFORM SET-VAR-LOCC2.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE SPACES TO WSS-IND-VMOR IN WSS-VARI.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *    PERFORM LOC-COM-FGP.
      *
      *    IF LOC-GLS-NOCO IN LOC-VARI = 'SICOBRACOM' AND
      *         LOC-COM-FGPE IN LOC-VARI > ZEROES
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       IF OPC-COD-VCOC IN OPC = '0998  ' AND
      *          WSS-GLS-NOUF = 'NO'
      *           COMPUTE WSS-VAL-COMI = LOC-COM-FGPE * WSS-VAL-CPTPGO
      *           ADD WSS-VAL-COMI  TO WSS-VAL-CPTFGPD
      *       ELSE
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *           MOVE LOC-COM-FGPE    TO   WSS-VAL-COMI
      *           ADD WSS-VAL-COMI  TO WSS-VAL-CPTFGPD.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE

      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
           PERFORM OBT-COM-NOR-CPT.
           ADD NOR-CONO TO WSS-VAL-MORASUM.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
       CONT-CAL-FOGAP2.
           MOVE WSS-VAL-CPTFGPD TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTFGP.

           IF LOC-GLS-NOCO IN LOC-VARI NOT = 'SICOBRACOM'
              MOVE ZEROES        TO WSS-VAL-CPTFGP.

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE BKP-VAL-SCRE TO OPC-VAL-SCRE IN OPC.
           ADD WSS-VAL-CPTFGP TO WSS-VAL-CFGPSUM.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

      *LA VEN ESTA EN LA MONEDA DEL CREDITO
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           IF OPC-COD-VCOC IN OPC = '0998  '
               COMPUTE VEN-VAL-FINA IN VEN =
                       VEN-VAL-SFIN IN VEN - VEN-VAL-SCAP IN VEN
               COMPUTE VEN-VAL-FINA IN VEN =
                       VEN-VAL-FINA IN VEN * WSS-VAL-CPTPGO
               MOVE VEN-VAL-FINA IN VEN TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTINT
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
               COMPUTE PES-SGV-DECI IN PES-VARI =
                       VEN-VAL-SCAP IN VEN * WSS-VAL-CPTPGO
               PERFORM PES-SCTV
               ADD PES-SGV-ENTE IN PES-VARI TO WSS-TOT-CAPM IN WSS-VARI
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS
           ELSE
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
               ADD VEN-VAL-SCAP IN VEN TO WSS-TOT-CAPM IN WSS-VARI
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS
               COMPUTE WSS-VAL-CPTINT =
                       VEN-VAL-SFIN IN VEN - VEN-VAL-SCAP IN VEN.

           ADD WSS-VAL-CPTINT TO WSS-VAL-INTSUM.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *SE RESTA EL PAGO DE LA CUOTA PARA REALIZAR EL PREPAGO
           IF OPC-COD-VCOC IN OPC = '0998  '
               COMPUTE WSS-VAL-TMP IN WSS-VARI =
                       VEN-VAL-SFIN IN VEN * WSS-VAL-CPTPGO
               MOVE WSS-VAL-TMP IN WSS-VARI TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-TMP IN WSS-VARI
           ELSE
               MOVE VEN-VAL-SFIN IN VEN TO WSS-VAL-TMP IN WSS-VARI.

           COMPUTE WSS-VAL-PREP IN WSS-VARI =
                   WSS-VAL-PREP IN WSS-VARI - (WSS-VAL-TMP IN WSS-VARI +
                                               WSS-VAL-CPTCAMO     +
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *                                        WSS-VAL-CPTFGP)
                                               WSS-VAL-CPTFGP      +
                                               NOR-CONO).
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    COMPUTE WSS-TOT-MORA IN WSS-VARI = (WSS-VAL-TMP IN WSS-VARI +
           COMPUTE WSS-TOT-MORA IN WSS-VARI =
                   WSS-TOT-MORA IN WSS-VARI + (WSS-VAL-TMP IN WSS-VARI +
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
                                               WSS-VAL-CPTCAMO     +
                                               WSS-VAL-CPTFGP      +
                                               NOR-CONO).

           MOVE ZEROES TO WSS-VAL-CPTCAMO
                          WSS-VAL-CPTFGP
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *                   WSS-VAL-CPTFGP.
                          WSS-VAL-CPTINT.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

           COMPUTE OPC-VAL-SCRE IN OPC = OPC-VAL-SCRE IN OPC -
                                         VEN-VAL-SCAP IN VEN.

           IF WSS-VAL-PREP IN WSS-VARI NOT > ZEROES
               MOVE ZEROES TO WSS-VAL-PREP IN WSS-VARI.          
      *AFRI-INI 07-JUN-2017 IDNI EN MOROSOS
           MOVE VEN-VAL-IDNI IN VEN TO DLC-VAL-IDNI IN DLC.
      *AFRI-FIN 07-JUN-2017 IDNI EN MOROSOS
           MOVE VEN-FEC-FIMV IN VEN TO WSS-DLC-FDEV IN WSS-VARI.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE VEN-FEC-FVEN IN VEN TO WSS-VEN-ANTE IN WSS-VARI.
           MOVE ZEROES TO WSS-CAN-RFUA IN WSS-VARI.
           COMPUTE WSS-VAL-INTAUX IN WSS-VARI = VEN-VAL-SCAP IN VEN +
                                             WSS-VAL-INTAUX IN WSS-VARI.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

      *AHORA QUE SE DESCONTO LA CUOTA MOROSA SE AVANZA AL SIGUIENTE
      *VENCIMIENTO Y SE PROCESA COMO SI FUESE EL PRIMERO VIGENTE

           COMPUTE VEN-NUM-IVEN IN VEN = VEN-NUM-IVCT IN VEN + 1.
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           IF OPC-IND-VSTR IN OPC = 'S'
               PERFORM COL-OBT-VEN
               IF NOT VEN-STAT-OKS OR
                  VEN-CIC-IOPC IN VEN NOT = OPC-CIC-IOPC IN OPC OR
                  VEN-NUM-IVEN IN VEN > OPC-NUM-VCOR IN OPC
                   MOVE 'N' TO WSS-QUE-MVEN IN WSS-VARI
               ELSE
                   MOVE 'S' TO WSS-QUE-MVEN IN WSS-VARI
           ELSE
               PERFORM COL-FIO-VEN
               IF NOT FIO-STAT-OKS
                   MOVE 'N' TO WSS-QUE-MVEN IN WSS-VARI
               ELSE
                   MOVE 'S' TO WSS-QUE-MVEN IN WSS-VARI.

           MOVE WSS-DLC-FDEV IN WSS-VARI TO DLC-FEC-FDEV IN DLC.

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           IF WSS-QUE-MVEN IN WSS-VARI = 'S'
               GO TO REV-CUO-MOR-PAR.

       SUM-PRO-PRE-PAR.
           MOVE WSS-VAL-MORASUM TO WSS-VAL-CPTCAMO
           MOVE WSS-VAL-INTSUM TO WSS-VAL-CPTINT
           MOVE WSS-VAL-CFGPSUM TO WSS-VAL-CPTFGP.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
       FIN-PRO-PRE-PAR.
           EXIT.
      *----------------------------------------------------------------
       EVA-PRE-MIN SECTION.
       INI-EVA-PRE-MIN.
      *UNA VEZ DESCONTADO TODO LO QUE HAY QUE DESCONTAR SE VERIFICA
      *CAPITAL MINIMO A PREPAGAR, DEBE SER MAYOR O IGUAL AL % DEL
      *SALDO DEL CREDITO
           MOVE ZEROES TO WSS-VAL-TMP IN WSS-VARI.
           MOVE 'N' TO WSS-IND-MINI IN WSS-VARI.

           IF OPC-COD-VCOC IN OPC NOT = '0999  '
      *HAY QUE PASAR EL % MINIMO A PREPAGAR A LA FECHA DE PAGO
               COMPUTE WSS-VAL-TMP IN WSS-VARI =
                       OPC-VAL-SCRE IN OPC * WSS-VAL-CPTPGO
               MOVE WSS-VAL-TMP IN WSS-VARI TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-TMP IN WSS-VARI
           ELSE
               MOVE OPC-VAL-SCRE IN OPC TO WSS-VAL-TMP IN WSS-VARI.

           COMPUTE WSS-VAL-TMP IN WSS-VARI =
                   WSS-VAL-TMP IN WSS-VARI / 100.

           COMPUTE WSS-VAL-TM2 IN WSS-VARI =
                   WSS-VAL-TMP IN WSS-VARI * WSS-MON-MINI IN WSS-VARI.

           IF WSS-IND-GASTOS IN WSS-VARI = 'N'
           IF WSS-VAL-TM2 IN WSS-VARI > WSS-VAL-CAPA IN WSS-VARI
               MOVE 'S' TO WSS-IND-MINI IN WSS-VARI
               MOVE ZEROES TO WSS-VAL-COMP IN WSS-VARI
               MOVE ZEROES TO WSS-VAL-COPR
               MOVE WSS-VAL-TM2 IN WSS-VARI TO
                    WSS-VAL-CAPA IN WSS-VARI.

       FIN-EVA-PRE-MIN.
           EXIT.
      *-----------------------------------------------------------------
       CAL-PRE-PARC SECTION.
       INI-CAL-PRE-PARC.
           MOVE 'N' TO WSS-IND-GASTOS IN WSS-VARI.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           IF OPC-NUM-VCOR IN OPC = 1
               MOVE 'PPARNOVA1VEN' TO MSG-COD-MENS
               COMPUTE WSS-JCPT = WSS-JMAXCPT + 1
               GO TO FIN-CAL-PRE-PARC.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           MOVE ZEROES TO WSS-VAL-CPTCAMO
                          WSS-VAL-CPTFGP
                          WSS-VAL-CPTINT.

           MOVE FRM-VAL-PREP IN CPT-FLD TO WSS-VAL-PREP IN WSS-VARI.
           MOVE 'P'                 TO WSS-IND-CPTCAAD.
           MOVE 'P A R C I A L '    TO FRM-GLS-TCAN IN CPT-FLD.
           MOVE 'S' TO WSS-QUE-MVEN IN WSS-VARI.

      *  SE CARGA LA FECHA DE PREPAGO DEL CERTIFICADO
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE FEC-FECH    TO WSS-FEC-CPTPAG WSS-FEC-FPAG-V(WSS-JCPT).
           MOVE FEC-FECH TO WSS-FEC-CPTPAG.

           MOVE WSS-NUM-DCPTPAG TO WSS-NUM-DCPTPAG-R.
           MOVE WSS-NUM-MCPTPAG TO WSS-NUM-MCPTPAG-R.
           MOVE WSS-NUM-SCPTPAG TO WSS-NUM-SCPTPAG-R.
           MOVE WSS-NUM-ACPTPAG TO WSS-NUM-ACPTPAG-R.
           IF WSS-FEC-CPTPAG-R > DLC-FEC-FMAV IN DLC
               COMPUTE WSS-JCPT = WSS-JMAXCPT + 1
               GO TO FIN-CAL-PRE-PARC.

           MOVE FEC-FECH TO WSS-FEC-FPAG-V(WSS-JCPT).
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *  SE RESCATAN LOS VALORES DE CAMBIO PARA FECHAS DE CURSE Y PAGO
           IF OPC-COD-VCOC IN OPC = '0998  '
               IF WSS-VAL-CPTCRS = ZEROES
                   MOVE OPC-NUM-DCOL IN OPC TO WSS-NUM-DCPTCAM
                   MOVE OPC-NUM-MCOL IN OPC TO WSS-NUM-MCPTCAM
                   MOVE OPC-NUM-SCOL IN OPC TO WSS-NUM-SCPTCAM
                   MOVE OPC-NUM-ACOL IN OPC TO WSS-NUM-ACPTCAM
                   PERFORM OBT-VCAM-FHOY
                   MOVE WSS-CAM-SGV-UF      TO WSS-VAL-CPTCRS
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE 1                   TO WSS-VAL-CPTCRS.

           MOVE WSS-NUM-DCPTPAG TO WSS-NUM-DCPTPAG-R.
           MOVE WSS-NUM-MCPTPAG TO WSS-NUM-MCPTPAG-R.
           MOVE WSS-NUM-SCPTPAG TO WSS-NUM-SCPTPAG-R.
           MOVE WSS-NUM-ACPTPAG TO WSS-NUM-ACPTPAG-R.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE WSS-NUM-DCPTPAG         TO WSS-NUM-DCPTCAM.
           MOVE WSS-NUM-MCPTPAG         TO WSS-NUM-MCPTCAM.
           MOVE WSS-NUM-SCPTPAG         TO WSS-NUM-SCPTCAM.
           MOVE WSS-NUM-ACPTPAG         TO WSS-NUM-ACPTCAM.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           IF OPC-COD-VCOC IN OPC = '0998  '
               IF WSS-GLS-NOUF = 'SI'
                   MOVE WSS-NUM-DCPTPAG         TO WSS-NUM-DCPTCAM
                   MOVE WSS-NUM-MCPTPAG         TO WSS-NUM-MCPTCAM
                   MOVE WSS-NUM-SCPTPAG         TO WSS-NUM-SCPTCAM
                   MOVE WSS-NUM-ACPTPAG         TO WSS-NUM-ACPTCAM
                   PERFORM OBT-VCAM-FHOY
      * VALIDO SI ENCONTRO UF PARA DIA DE CALCULO
      * SI NO ENCUENTRA SE DEBE USAR ULTIMO VALOR CONOCIDO E INFORMAR
                   IF (NOT FIO-STAT-OKS              ) OR
                      (CAM-MSC-STAT IN CAM NOT = 'S' )
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *                MOVE WSS-VAL-CPTPGOA TO WSS-VAL-CPTPGO
      *                MOVE WSS-FEC-CPTFCAA TO WSS-FEC-CPTFCAM
                       PERFORM BUS-FEC-ANTC
                       MOVE WSS-FEC-CPTFCAM TO WSS-FEC-CPTFCAA
                       MOVE 'NO'            TO WSS-GLS-NOUF
      *                PERFORM BUS-FEC-ANTC
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
                   ELSE
                       MOVE 'SI'            TO WSS-GLS-NOUF
                       MOVE WSS-FEC-CPTFCAM TO WSS-FEC-CPTFCAA
                       MOVE WSS-CAM-SGV-UF  TO WSS-VAL-CPTPGOA
                       MOVE WSS-CAM-SGV-UF  TO WSS-VAL-CPTPGO
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE 1                   TO WSS-VAL-CPTPGO.

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE WSS-NUM-DCPTPAG         TO WSS-NUM-DCPTCAM.
           MOVE WSS-NUM-MCPTPAG         TO WSS-NUM-MCPTCAM.
           MOVE WSS-NUM-SCPTPAG         TO WSS-NUM-SCPTCAM.
           MOVE WSS-NUM-ACPTPAG         TO WSS-NUM-ACPTCAM.
           PERFORM OBT-VCAM-FHOY.
           IF ( NOT FIO-STAT-OKS              ) OR
              ( CAM-MSC-STAT IN CAM NOT = 'S' )
                PERFORM BUS-FEC-ANTC
                MOVE CAM-SGV-VCAM IN CAM         TO WSS-VAL-CPTNOR
           ELSE
               MOVE WSS-CAM-SGV-UF TO WSS-VAL-CPTNOR.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

           IF OPC-COD-VCOC IN OPC = '0998  ' AND
               WSS-GLS-NOUF = 'NO'
               MOVE 'CPTUF     ' TO WSS-COD-MENSCPT
               PERFORM BUSCA-GLOSAS-CPT
               MOVE WSS-GLS-CPT  TO FRM-GLS-GLO2.

           MOVE 'N' TO WSS-CAM-VENC IN WSS-VARI.
           MOVE ZEROES TO WSS-TOT-MORA IN WSS-VARI.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE 'S' TO WSS-QUE-MVEN IN WSS-VARI.
           MOVE WSS-CAN-FUAP IN WSS-VARI TO WSS-CAN-RFUA IN WSS-VARI.
           MOVE WSS-DLC-RDEV IN WSS-VARI TO WSS-DLC-FDEV IN WSS-VARI.
           MOVE WSS-FEC-VANT IN WSS-VARI TO WSS-VEN-ANTE IN WSS-VARI.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *    MOVE OPC-VAL-SCRE IN OPC TO DPS-VAL-SCRE.
      *    MOVE VEN-NUM-IVCT IN VEN TO DPS-NUM-IVEN.
           MOVE OPC-VAL-SCRE IN OPC TO IS2-DPS-VAL-SCRE.
           MOVE VEN-NUM-IVCT IN VEN TO IS2-DPS-NUM-IVEN.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTPAG-R
               MOVE 'S' TO WSS-CAM-VENC IN WSS-VARI
               MOVE SPACES TO FRM-GLS-GLO3
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
      *        PERFORM PRO-PRE-PAR.
               PERFORM PRO-PRE-PAR
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *        MOVE OPC-VAL-SCRE IN OPC TO DPS-VAL-SCRE
      *        MOVE VEN-NUM-IVEN IN VEN TO DPS-NUM-IVEN.
               MOVE OPC-VAL-SCRE IN OPC TO IS2-DPS-VAL-SCRE
               MOVE VEN-NUM-IVEN IN VEN TO IS2-DPS-NUM-IVEN.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS


           MOVE SPACES TO FRM-GLS-GLO3.

           IF WSS-QUE-MVEN IN WSS-VARI NOT = 'S'
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *        GO TO NO-HAY-MVEN.
               PERFORM INF-FINAL-SIM
               COMPUTE WSS-JCPT = WSS-JMAXCPT + 1
               GO TO FIN-CAL-PRE-PARC.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

      *  INICIO PROCESO PARA CALCULAR INTERESES

           MOVE SPACES                  TO INT-TIPT.
           MOVE ZEROES                  TO INT-TINT.
           MOVE OPC-COD-VCOC IN OPC     TO INT-VCAM.
           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTPAG-R
              MOVE VEN-NUM-DVEN IN VEN     TO INT-DUNO WSS-NUM-DDEV
              MOVE VEN-NUM-MVEN IN VEN     TO INT-MUNO WSS-NUM-MDEV
              MOVE VEN-NUM-SVEN IN VEN     TO INT-SUNO WSS-NUM-SDEV
              MOVE VEN-NUM-AVEN IN VEN     TO INT-AUNO WSS-NUM-ADEV
           ELSE
           IF DLC-FEC-FDEV IN DLC > ZEROES
              MOVE DLC-NUM-DDEV IN DLC     TO INT-DUNO WSS-NUM-DDEV
              MOVE DLC-NUM-MDEV IN DLC     TO INT-MUNO WSS-NUM-MDEV
              MOVE DLC-NUM-SDEV IN DLC     TO INT-SUNO WSS-NUM-SDEV
              MOVE DLC-NUM-ADEV IN DLC     TO INT-AUNO WSS-NUM-ADEV
           ELSE
              MOVE OPC-NUM-DCOL IN OPC     TO INT-DUNO WSS-NUM-DDEV
              MOVE OPC-NUM-MCOL IN OPC     TO INT-MUNO WSS-NUM-MDEV
              MOVE OPC-NUM-SCOL IN OPC     TO INT-SUNO WSS-NUM-SDEV
              MOVE OPC-NUM-ACOL IN OPC     TO INT-AUNO WSS-NUM-ADEV.

           MOVE WSS-FEC-CPTPAG          TO INT-FDOS.
           MOVE OPC-NUM-DCOL IN OPC     TO INT-DCOL.
           MOVE OPC-NUM-MCOL IN OPC     TO INT-MCOL.
           MOVE OPC-NUM-SCOL IN OPC     TO INT-SCOL.
           MOVE OPC-NUM-ACOL IN OPC     TO INT-ACOL.
           MOVE WSS-FEC-CPTPAG          TO INT-FBTV.
           MOVE OPC-CIC-IOPC IN OPC     TO INT-IOPC.
           MOVE DLC-NUM-IDLC IN DLC     TO INT-IDLC.
           PERFORM COL-CAL-INT.
           IF INT-CMSG > SPACES
              MOVE ZEROES TO INT-TIPE
              MOVE SPACES TO INT-CMSG.

           PERFORM CAL-INT-NORMAL.

      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
      *    COMPUTE WSS-VAL-PREP IN WSS-VARI =
      *            WSS-VAL-PREP IN WSS-VARI - WSS-VAL-CPTINT.
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS

      *  SE CARGAN LOS INTERESES DEL PREPAGO PARA EL CERTIFICADO
           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTINT   TO FRM-VAL-INTE-EDT
              MOVE FRM-VAL-INTE-EDT TO WSS-VAL-INTE-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTINT   TO WSS-VAL-INTE-V(WSS-JCPT).

      *    SE CALCULA EL CAPITAL ADEUDADO DESPUES DEL PAGO

      *    SE CALCULAN LOS REAJUSTES DEL PREPAGO
      *EL SALDO DEL CREDITO TIENE QUE VENIR SIN LA CUOTA QUE GENERA
      *MORA, SE DESCUENTA SU CAPITAL SOLAMENTE
       NO-HAY-MVEN.

           MOVE OPC-VAL-SCRE IN OPC TO WSS-VAL-CPTSCRE.
           IF OPC-COD-VCOC IN OPC NOT = '0998  '
              MOVE ZEROES              TO WSS-VAL-REAJ-V(WSS-JCPT)
              MOVE WSS-VAL-CPTSCRE     TO WSS-VAL-CPTCAAD
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       GO TO CON-VAL-REAJ.
              GO TO CON-VAL-REAJ-P.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

      *   PARA CALCULAR REAJUSTES - CALCULO A FECHA DE CURSE
           COMPUTE WSS-VAL-CPTCPPR ROUNDED =
                   WSS-VAL-CPTSCRE         *
                   WSS-VAL-CPTCRS.

      *   PARA CALCULAR REAJUSTES - CALCULO A FECHA DE PAGO
           COMPUTE WSS-VAL-CPTREAJ ROUNDED =
                   WSS-VAL-CPTSCRE         *
                   WSS-VAL-CPTPGO.

      *RESCATO MONTO DE CAPITAL ADEUDADO REAJUSTADO A FECHA DE PAGO
           MOVE WSS-VAL-CPTREAJ TO WSS-VAL-CPTCAAD.
           MOVE WSS-VAL-CPTCAAD TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTCAAD.

      *   CALCULO REAJUSTES Y TRANSFIERO AL VECTOR
           COMPUTE WSS-VAL-CPTREAJ ROUNDED =
                   WSS-VAL-CPTREAJ         -
                   WSS-VAL-CPTCPPR.

      *SE SACAN DECIMALES AL REAJUSTE Y SE INFORMA
           MOVE WSS-VAL-CPTREAJ TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTREAJ.

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *CON-VAL-REAJ.
       CON-VAL-REAJ-P.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTREAJ  TO FRM-VAL-REAJ-EDT
              MOVE FRM-VAL-REAJ-EDT TO WSS-VAL-REAJ-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTREAJ  TO WSS-VAL-REAJ-V(WSS-JCPT).

      *    NO EXISTE MORA PARA LOS PREPAGOS PARCIALES
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE ZEROES  TO WSS-VAL-CPTCAMO.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

           IF SCR-OFRM-SRV
               MOVE WSS-VAL-CPTCAMO  TO FRM-VAL-CAMO-EDT
               MOVE FRM-VAL-CAMO-EDT TO WSS-VAL-CAMO-V(WSS-JCPT)
           ELSE
               MOVE WSS-VAL-CPTCAMO  TO WSS-VAL-CAMO-V(WSS-JCPT).

      *    SE PROCEDE A RESCATAR EL VALOR DE COMISION DE FOGAPE
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *    PERFORM CALCULA-COM-FGP.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      * AGREGADO POR CAMBIO EN FOGAPE
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE SPACES TO WSS-IND-VMOR IN WSS-VARI.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           PERFORM SET-VAR-LOCC.
           PERFORM LOC-COM-FGP.

           IF LOC-GLS-NOCO IN LOC-VARI = 'SICOBRACOM' AND
                LOC-COM-FGPE IN LOC-VARI > ZEROES
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       IF OPC-COD-VCOC IN OPC = '0998  ' AND
      *           WSS-GLS-NOUF = 'NO'
      *          COMPUTE WSS-VAL-COMI = LOC-COM-FGPE * WSS-VAL-CPTPGO
      *          MOVE WSS-VAL-COMI  TO WSS-VAL-CPTFGPD
      *       ELSE
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
                 MOVE LOC-COM-FGPE    TO   WSS-VAL-COMI
                 MOVE WSS-VAL-COMI  TO WSS-VAL-CPTFGPD.

      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *    IF VEN-FEC-FIMV IN VEN NOT < WSS-FEC-CPTFCAM
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       GO TO CONT-CAL-FOGAPE.
      *       GO TO CONT-CAL-FOGAPE-P.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE SPACES TO WSS-IND-VMOR IN WSS-VARI.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *    PERFORM SET-VAR-LOCC2.
      *    PERFORM LOC-COM-FGP.

      *    IF LOC-GLS-NOCO IN LOC-VARI = 'SICOBRACOM' AND
      *         LOC-COM-FGPE IN LOC-VARI > ZEROES
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       IF OPC-COD-VCOC IN OPC = '0998  ' AND
      *           WSS-GLS-NOUF = 'NO'
      *          COMPUTE WSS-VAL-COMI = LOC-COM-FGPE * WSS-VAL-CPTPGO
      *          ADD WSS-VAL-COMI  TO WSS-VAL-CPTFGPD
      *       ELSE
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *          MOVE LOC-COM-FGPE    TO   WSS-VAL-COMI
      *          ADD WSS-VAL-COMI  TO WSS-VAL-CPTFGPD.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *CONT-CAL-FOGAPE.
       CONT-CAL-FOGAPE-P.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           MOVE WSS-VAL-CPTFGPD TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTFGP.
           ADD PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTFGP.
      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
           MOVE PES-SGV-ENTE IN PES-VARI TO WCC-COM-FOGA.
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
           COMPUTE WSS-VAL-PREP IN WSS-VARI =
                   WSS-VAL-PREP IN WSS-VARI - PES-SGV-ENTE IN PES-VARI.
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

           IF LOC-GLS-NOCO IN LOC-VARI NOT = 'SICOBRACOM'
              MOVE ZEROES        TO WSS-VAL-CPTFGP.

      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
      *    COMPUTE WSS-VAL-PREP IN WSS-VARI =
      *            WSS-VAL-PREP IN WSS-VARI - WSS-VAL-CPTFGP.
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTFGP   TO FRM-VAL-COFG-EDT
              MOVE FRM-VAL-COFG-EDT TO WSS-VAL-COFG-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTFGP   TO WSS-VAL-COFG-V(WSS-JCPT).

      *SE CALCULA COMISION DE PREPAGO
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    IF DLC-FEC-FMAV IN DLC = VEN-FEC-FVEN IN VEN
      *        MOVE ZEROES TO WSS-VAL-COPR
      *        MOVE ZEROES TO WSS-VAL-COMP IN WSS-VARI
      *        MOVE 'N' TO WSS-COB-COPR IN WSS-VARI
      *        GO TO CONT-SIN-COPR-PAR.

           IF WSS-TOT-MORA IN WSS-VARI > FRM-VAL-PREP IN CPT-FLD
               MOVE ZEROES TO CAN-SGV-TPAG IN CAN-FLD
           ELSE
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           COMPUTE CAN-SGV-TPAG IN CAN-FLD =
                    FRM-VAL-PREP IN CPT-FLD - WSS-TOT-MORA IN WSS-VARI.
           PERFORM CAL-COM-PRE-PCP.
           IF WSS-COB-COPR IN WSS-VARI = 'N'
               MOVE ZEROES TO WSS-VAL-COPR
           ELSE
               MOVE 999999999 TO WSS-VAL-COPR.

           COMPUTE WSS-VAL-PREP IN WSS-VARI =
                   WSS-VAL-PREP IN WSS-VARI - WSS-VAL-COMP IN WSS-VARI.

           PERFORM CAL-CAP-PREP.
           PERFORM EVA-PRE-MIN.
           PERFORM BUS-COMI-PRE.

      *EN ESTE PUNTO YA SE CALCULO EL CAPITAL PREPAGADO PARA MOVER A LA
      *PANTALLA

           IF OPC-COD-VCOC IN OPC NOT = '0999  '
               COMPUTE WSS-VAL-TMP IN WSS-VARI =
                       OPC-VAL-SCRE IN OPC * WSS-VAL-CPTPGO
               MOVE WSS-VAL-TMP IN WSS-VARI TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-TMP IN WSS-VARI
               IF WSS-VAL-TMP IN WSS-VARI < WSS-VAL-CAPA IN WSS-VARI
                   MOVE 'CAPPREMAYOPC' TO MSG-COD-MENS
                   MOVE WSS-JMAXCPT TO WSS-JCPT
                   PERFORM LIM-PTA-ERROR
                   GO TO FIN-CAL-PRE-PARC
               ELSE
                   CONTINUE
           ELSE
               IF WSS-VAL-CAPA IN WSS-VARI > OPC-VAL-SCRE IN OPC
                   MOVE 'CAPPREMAYOPC' TO MSG-COD-MENS
                   MOVE 'S' TO SCR-IERR
                   MOVE WSS-JMAXCPT TO WSS-JCPT
                   PERFORM LIM-PTA-ERROR
                   GO TO FIN-CAL-PRE-PARC.

           IF SCR-OFRM-SRV
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
      *       MOVE WSS-VAL-CAPA IN WSS-VARI  TO FRM-VAL-CAPR-EDT
              COMPUTE WSS-CAP-FINAL IN WSS-VARI =
                    WSS-TOT-CAPM IN WSS-VARI + WSS-VAL-CAPA IN WSS-VARI
              MOVE WSS-CAP-FINAL IN WSS-VARI TO FRM-VAL-CAPR-EDT
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS
              MOVE FRM-VAL-CAPR-EDT TO WSS-VAL-CAPR-V(WSS-JCPT)
           ELSE
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
      *       MOVE WSS-VAL-CAPA IN WSS-VARI TO WSS-VAL-CAPR-V(WSS-JCPT).
              COMPUTE WSS-CAP-FINAL IN WSS-VARI =
                    WSS-TOT-CAPM IN WSS-VARI + WSS-VAL-CAPA IN WSS-VARI
             MOVE WSS-CAP-FINAL IN WSS-VARI TO WSS-VAL-CAPR-V(WSS-JCPT).
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS


      *SI TUVE QUE CAMBIAR EL CAPITAL PREPAGADO DEBO ENVIAR MENSAJE
           MOVE ZEROES TO WSS-VAL-MINC IN WSS-VARI.
           IF WSS-IND-MINI IN WSS-VARI = 'S' AND
              FRM-GLS-GLO3 NOT > SPACES
               MOVE SPACES             TO WSS-GLS-CPT
               MOVE 'COL'              TO FIO-SIST
               MOVE 'MSG'              TO TAB-COD-TTAB IN TAB
               MOVE 'CAMMONCAPP'       TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY        TO FIO-CMND
               PERFORM GNS-FIO-TAB
               IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
                   MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-CPT1
                   MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-CPT2
                   COMPUTE WSS-VAL-MINC IN WSS-VARI =
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
      *                    WSS-TOT-MORA IN WSS-VARI +
                           WSS-TOT-CAPM IN WSS-VARI +
                           WSS-VAL-CPTCAMO          +
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS
                           WSS-VAL-CAPA IN WSS-VARI +
                           WSS-VAL-COMP IN WSS-VARI +
                           WSS-VAL-CPTFGP           +
                           WSS-VAL-CPTINT
                   MOVE WSS-GLS-CPT  TO FRM-GLS-GLO3
               ELSE
                   COMPUTE WSS-VAL-MINC IN WSS-VARI =
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
      *                    WSS-TOT-MORA IN WSS-VARI +
                           WSS-TOT-CAPM IN WSS-VARI +
                           WSS-VAL-CPTCAMO          +
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS
                           WSS-VAL-CAPA IN WSS-VARI +
                           WSS-VAL-COMP IN WSS-VARI +
                           WSS-VAL-CPTFGP           +
                           WSS-VAL-CPTINT
                   MOVE 'MSG NO ENCONTRADO' TO WSS-GLS-CPT1
                   MOVE WSS-GLS-CPT  TO FRM-GLS-GLO3.

           IF WSS-VAL-MINC IN WSS-VARI > ZEROES AND
              WSS-COB-COPR IN WSS-VARI = 'S'
               MOVE WSS-VAL-COMP IN WSS-VARI TO WSS-VAL-COPR
               COMPUTE CAN-SGV-TPAG IN CAN-FLD =
                    WSS-VAL-MINC IN WSS-VARI - WSS-TOT-MORA IN WSS-VARI
               PERFORM CAL-COM-PRE-PCP
               COMPUTE WSS-VAL-MINC IN WSS-VARI =
                       WSS-VAL-MINC IN WSS-VARI - WSS-VAL-COPR +
                       WSS-VAL-COMP IN WSS-VARI
               MOVE WSS-VAL-MINC IN WSS-VARI TO WSS-VAL-PREP IN WSS-VARI
               PERFORM CALCULA-GASTOS.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-COMP IN WSS-VARI TO FRM-VAL-COPR-EDT
              MOVE FRM-VAL-COPR-EDT TO WSS-VAL-COPR-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-COMP IN WSS-VARI TO WSS-VAL-COPR-V(WSS-JCPT).

      *
           IF OPC-COD-VCOC IN OPC = '0998  '
               COMPUTE WSS-VAL-RAPP IN WSS-VARI ROUNDED =
                                         WSS-VAL-CAPA / WSS-VAL-CPTPGO
               COMPUTE WSS-VAL-CPTREAJ =
                           WSS-VAL-RAPP IN WSS-VARI * WSS-VAL-CPTCRS
               MOVE WSS-VAL-CPTREAJ TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTREAJ
               COMPUTE WSS-VAL-CPTREAJ =
                       WSS-VAL-CAPA IN WSS-VARI - WSS-VAL-CPTREAJ
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
               COMPUTE WSS-VAL-RAPP IN WSS-VARI =
                         WSS-VAL-RAPP IN WSS-VARI * WSS-VAL-CPTCRS
               MOVE WSS-VAL-RAPP IN WSS-VARI TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-RAPP IN WSS-VARI
               ADD WSS-TOT-CAPM IN WSS-VARI TO WSS-VAL-RAPP IN WSS-VARI
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

      *SE SACAN DECIMALES AL REAJUSTE Y SE INFORMA
               MOVE WSS-VAL-CPTREAJ TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTREAJ
               IF SCR-OFRM-SRV
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
                   MOVE WSS-VAL-RAPP IN WSS-VARI  TO FRM-VAL-CAPR-EDT
                   MOVE FRM-VAL-CAPR-EDT TO WSS-VAL-CAPR-V(WSS-JCPT)
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
                   MOVE WSS-VAL-CPTREAJ  TO FRM-VAL-REAJ-EDT
                   MOVE FRM-VAL-REAJ-EDT TO WSS-VAL-REAJ-V(WSS-JCPT)
               ELSE
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
                   MOVE WSS-VAL-RAPP IN WSS-VARI TO
                                               WSS-VAL-CAPR-V(WSS-JCPT)
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
                   MOVE WSS-VAL-CPTREAJ  TO WSS-VAL-REAJ-V(WSS-JCPT)
           ELSE
               NEXT SENTENCE.
      *
      *TRANSFIERO EL CAPITAL PENDIENTE A FECHA DE PAGO
           COMPUTE WSS-VAL-CPTCAAD = WSS-VAL-CPTCAAD -
                                     WSS-VAL-CAPA IN WSS-VARI.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTCAAD  TO FRM-VAL-CAAD-EDT
              MOVE FRM-VAL-CAAD-EDT TO WSS-VAL-CAAD-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTCAAD  TO WSS-VAL-CAAD-V(WSS-JCPT).

      *CALCULA MONTO MINIMO A PREPAGAR
           IF WSS-VAL-MINC IN WSS-VARI = ZEROES
               COMPUTE WSS-VAL-CPTTPAG = FRM-VAL-PREP IN CPT-FLD
           ELSE
               COMPUTE WSS-VAL-CPTTPAG = WSS-VAL-MINC IN WSS-VARI.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTTPAG  TO FRM-VAL-TPAG-EDT
              MOVE FRM-VAL-TPAG-EDT TO WSS-VAL-TPAG-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTTPAG  TO WSS-VAL-TPAG-V(WSS-JCPT).

      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
           PERFORM BUS-MON-SEG.
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    IF WSS-CAM-VENC IN WSS-VARI = 'S'
      *        MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN
               MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
               IF OPC-IND-VSTR IN OPC = 'S'
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *            MOVE 1                TO VEN-NUM-IVEN IN VEN
                   MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
                   MOVE FIO-GET-NLS         TO FIO-CMND
                   PERFORM COL-FIO-VEN
               ELSE
                   MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
                   MOVE FIO-GET-NLS         TO FIO-CMND
                   PERFORM COL-FIO-VEN.


           MOVE WSS-NUM-DCPTPAG  TO FEC-ITM1.
           MOVE WSS-NUM-MCPTPAG  TO FEC-ITM2.
           MOVE WSS-NUM-SCPTPAG  TO FEC-ITM3.
           MOVE WSS-NUM-ACPTPAG  TO FEC-ITM4.
           MOVE FEC-FORM-FEC     TO FEC-FORM.
           MOVE FEC-SUM-DIA      TO FEC-CMND.
           MOVE 1                TO FEC-NDIA.
           PERFORM CAL-FEC.
           MOVE FEC-FECH         TO WSS-FEC-CPTPAG.
           IF NOT FEC-STAT-OKS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE FEC-MENS     TO FRM-MENS.
       FIN-CAL-PRE-PARC.
           EXIT.
      *----------------------------------------------------------------
       BUS-FEC-ANTC SECTION.
       INI-BUS-FEC-ANTC.
      *BUSCO ULTIMO VALOR DE UF CONOCIDO CONTANDO FIN DE SEMANA O DIAS
      *NO HABILES
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE CAM-NUM-DCAM IN CAM(1)  TO FEC-ITM1.
      *    MOVE CAM-NUM-MCAM IN CAM(1)  TO FEC-ITM2.
      *    MOVE CAM-NUM-SCAM IN CAM(1)  TO FEC-ITM3.
      *    MOVE CAM-NUM-ACAM IN CAM(1)  TO FEC-ITM4.
           MOVE WSS-NUM-DCPTPAG         TO FEC-ITM1.
           MOVE WSS-NUM-MCPTPAG         TO FEC-ITM2.
           MOVE WSS-NUM-SCPTPAG         TO FEC-ITM3.
           MOVE WSS-NUM-ACPTPAG         TO FEC-ITM4.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
       FECHA-ANTERIOR.
           MOVE FEC-FORM-FEC     TO FEC-FORM.
           MOVE FEC-RST-DIA      TO FEC-CMND.
           MOVE 1                TO FEC-NDIA.
           PERFORM CAL-FEC.
           MOVE FEC-ITM1 TO CAM-NUM-DCAM IN CAM(1).
           MOVE FEC-ITM2 TO CAM-NUM-MCAM IN CAM(1).
           MOVE FEC-ITM3 TO CAM-NUM-SCAM IN CAM(1).
           MOVE FEC-ITM4 TO CAM-NUM-ACAM IN CAM(1).

           MOVE '0998  '                 TO CAM-COD-VCAM IN CAM(1).
           MOVE '0999  '                 TO CAM-COD-VCAM IN CAM(2).
           MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.

           PERFORM TAB-FIO-CAM.
           IF ( NOT FIO-STAT-OKS              ) OR
              ( CAM-MSC-STAT IN CAM NOT = 'S' )
              GO TO FECHA-ANTERIOR.

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE CAM-SGV-VCAM IN CAM         TO WSS-VAL-CPTPGO.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

       FIN-BUS-FEC-ANTC.
           EXIT.
      *-----------------------------------------------------------------
       CAL-CAP-PREP SECTION.
       INI-CAL-CAP-PREP.
      *EN LA VARIABLE WSS-VAL-PREP ESTA LA SUMA DEL CAPITAL PREPAGADO
      *Y LA COMISION DE PREPAGO
      *EL CAPITAL PREPAGADO ESTA EN PESOS Y QUEDA EN LA VARIABLE
      *WSS-VAL-CAPA

           IF WSS-COB-COPR IN WSS-VARI = 'S'
               MOVE WSS-VAL-PREP IN WSS-VARI TO WSS-VAL-CAPA IN WSS-VARI
               GO TO FIN-CAL-CAP-PREP.

           IF WSS-VAL-BASE IN WSS-VARI = 'A' AND
              OPC-COD-VCOC IN OPC = '0998  '
               COMPUTE WSS-VAL-NDBA IN WSS-VARI = 45/360.

           IF WSS-VAL-BASE IN WSS-VARI = 'A' AND
              OPC-COD-VCOC IN OPC NOT = '0998  '
               COMPUTE WSS-VAL-NDBA IN WSS-VARI = 30/360.

           IF WSS-VAL-BASE IN WSS-VARI NOT = 'A' AND
              OPC-COD-VCOC IN OPC NOT = '0998  '
               MOVE 1 TO WSS-VAL-NDBA IN WSS-VARI.

           COMPUTE WSS-VAL-NDBA IN WSS-VARI =
                   WSS-VAL-NDBA IN WSS-VARI *
                   ( FRM-VAL-TASA IN CPT-FLD / 100 ).

           ADD 1 TO WSS-VAL-NDBA IN WSS-VARI.

           COMPUTE WSS-VAL-CAPA IN WSS-VARI =
                   WSS-VAL-PREP IN WSS-VARI / WSS-VAL-NDBA IN WSS-VARI.

           MOVE WSS-VAL-CAPA IN WSS-VARI TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CAPA IN WSS-VARI.

       FIN-CAL-CAP-PREP.
           EXIT.
      *-----------------------------------------------------------------
       BUS-COMI-PRE SECTION.
       INI-BUS-COMI-PRE.
      *UNA VEZ DETERMINADO EL MONTO DE CAPITAL PREPAGADO SE PUEDE
      *CALCULAR LA COMISION DE PREPAGO

           IF WSS-IND-MINI IN WSS-VARI = 'N' OR
              (WSS-COB-COPR IN WSS-VARI = 'S' AND
              WSS-VAL-COPR = 999999999) OR
              WSS-COB-COPR IN WSS-VARI = 'N'
               GO TO FIN-BUS-COMI-PRE.

           IF WSS-VAL-BASE IN WSS-VARI = 'A' AND
              OPC-COD-VCOC IN OPC = '0998  '
               COMPUTE WSS-VAL-NDBA IN WSS-VARI = 45/360.

           IF WSS-VAL-BASE IN WSS-VARI = 'A' AND
              OPC-COD-VCOC IN OPC NOT = '0998  '
               COMPUTE WSS-VAL-NDBA IN WSS-VARI = 30/360.

      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           IF WSS-VAL-BASE IN WSS-VARI NOT = 'A' AND
              OPC-COD-VCOC IN OPC = '0998  '
               COMPUTE WSS-VAL-NDBA IN WSS-VARI = 45/30.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           IF WSS-VAL-BASE IN WSS-VARI NOT = 'A' AND
              OPC-COD-VCOC IN OPC NOT = '0998  '
               MOVE 1 TO WSS-VAL-NDBA IN WSS-VARI.

           COMPUTE WSS-VAL-NDBA IN WSS-VARI =
                   WSS-VAL-NDBA IN WSS-VARI *
                             ( FRM-VAL-TASA IN CPT-FLD / 100 ).

           COMPUTE WSS-VAL-COMP IN WSS-VARI =
                  (WSS-VAL-CAPA IN WSS-VARI +
                   WSS-VAL-CPTFGP) * WSS-VAL-NDBA IN WSS-VARI.

           MOVE WSS-VAL-COMP IN WSS-VARI TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-COMP IN WSS-VARI.

       FIN-BUS-COMI-PRE.
           EXIT.
      *----------------------------------------------------------------
       CAL-DIFDIAS SECTION.
       INI-CAL-DIFDIAS.

           MOVE SPACES                     TO FEC-FEC1.
           MOVE SPACES                     TO FEC-FEC2.

           MOVE EVC-NUM-DPVC IN EVC TO FEC-DEC2.
           MOVE EVC-NUM-MPVC IN EVC TO FEC-MEC2.
           MOVE EVC-NUM-SPVC IN EVC TO FEC-SEC2.
           MOVE EVC-NUM-APVC IN EVC TO FEC-AEC2.

           MOVE WSS-NUM-DCPTPAG-R TO FEC-DEC1.
           MOVE WSS-NUM-MCPTPAG-R TO FEC-MEC1.
           MOVE WSS-NUM-SCPTPAG-R TO FEC-SEC1.
           MOVE WSS-NUM-ACPTPAG-R TO FEC-AEC1.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND

           PERFORM CAL-FEC
           IF NOT FEC-STAT-OKS
               GO TO FIN-CAL-DIFDIAS.

           IF FEC-NDIA < WSS-NUM-DIFD IN WSS-VARI
               MOVE FEC-NDIA IN FEC-VARI TO WSS-NUM-DIFD IN WSS-VARI
               MOVE EVC-VAL-VENC IN EVC TO WSS-VAL-VENC IN WSS-VARI
               MOVE EVC-FEC-FPVC IN EVC TO WSS-FEC-FPVC IN WSS-VARI.

       FIN-CAL-DIFDIAS.
           EXIT.
      *--------------------------------------------------------------
       CAL-COM-PRE-PCP SECTION.
       INI-CAL-COM-PRE-PCP.
      *SE PROCEDE A RESCATAR EL VALOR DE COMISION DE PREPAGO
      *EL VALOR EN WSS-VAL-PREP ES EL MONTO PREPAGADO
      *SI ES MAYOR QUE CERO HAY QUE BUSCAR LA COMISION DE PREPAGO
      *   SI EL CAPITAL DE PREPAGO QUE SE DESPRENDE DEL CALCULO
      *   ES MENOR AL 25% DEL CAPITAL ADEUDADO ES NECESARIO ESTABLECER
      *   EL NUEVO CAPITAL ADEUDADO Y LA COMISION QUE LE CORRESPONDE
      *SI ES IGUAL O MENOR A CERO HAY QUE CALCULAR LA COMISION DEL
      *25% MINIMO DE CAPITAL A PREPAGAR

           MOVE ZEROES                  TO CAN-NUM-PLCO IN CAN-FLD
                                           CAN-NUM-PLCO IN CAN.
           MOVE OPC-CAI-IOPC IN OPC     TO CAN-CAI-IOPC IN CAN-FLD
                                           PCP-IOPC (1:4).
           MOVE OPC-IIC-IOPC IN OPC     TO CAN-IIC-IOPC IN CAN-FLD
                                           PCP-IOPC (5:8).
           MOVE DBC-NUM-ICLI IN DBC     TO PCP-IIDC (1:8).
           MOVE 'PAR'                   TO PCP-ACCI.
           MOVE '090'                   TO CAN-COD-OFCA IN CAN-FLD.
           MOVE WSS-NUM-DCPTPAG         TO CAN-NUM-DCAN IN CAN-FLD.
           MOVE WSS-NUM-MCPTPAG         TO CAN-NUM-MCAN IN CAN-FLD.
           MOVE WSS-NUM-SCPTPAG         TO CAN-NUM-SCAN IN CAN-FLD.
           MOVE WSS-NUM-ACPTPAG         TO CAN-NUM-ACAN IN CAN-FLD.
           IF DBC-IND-TICL IN DBC = 'P'
              MOVE DCP-COD-TBAN IN DCP  TO PCP-COD-CLTE
           ELSE
              MOVE DCE-COD-TBAN IN DCE  TO PCP-COD-CLTE.

           MOVE 'CTA'                   TO CCO-COD-EVEN.
           PERFORM LEE-PLAN-COMI-CAN.
           MOVE 'BUS'                   TO PCP-ACCI.

           MOVE OPC-CAI-IOPC IN OPC     TO CAN-CAI-IOPC IN CAN-FLD.
           MOVE OPC-IIC-IOPC IN OPC     TO CAN-IIC-IOPC IN CAN-FLD.
           MOVE WSS-NUM-DCPTPAG         TO CAN-NUM-DCAN IN CAN-FLD.
           MOVE WSS-NUM-MCPTPAG         TO CAN-NUM-MCAN IN CAN-FLD.
           MOVE WSS-NUM-SCPTPAG         TO CAN-NUM-SCAN IN CAN-FLD.
           MOVE WSS-NUM-ACPTPAG         TO CAN-NUM-ACAN IN CAN-FLD.
           MOVE ZEROES                  TO PCP-FANT     IN PCP-VARI.
           MOVE ZEROES                  TO PCP-FVEN     IN PCP-VARI.
           MOVE ZEROES                  TO PCP-SUVP     IN PCP-VARI.
           MOVE 'BUS'                   TO PCP-ACCI.
           MOVE PCP                     TO PCP-RPCP.
           MOVE ZEROES                  TO CAN-SGV-COMI IN CAN-FLD .
           MOVE ZEROES                  TO CAN-SGV-TREN IN CAN-FLD .
           MOVE ZEROES                  TO WSS-VAL-SMO7            .
           MOVE ZEROES                  TO WSS-VAL-SMO8            .
           MOVE ZEROES                  TO WSS-VAL-SMO9            .
           MOVE ZEROES                  TO WSS-VAL-SM10            .
           MOVE ZEROES                  TO WSS-SGV-CACU            .
           MOVE 'S'               TO PCP-IINC.
           PERFORM CAL-COM-PCP.
           IF PCP-CMSG > SPACES
               MOVE 'N' TO WSS-COB-COPR IN WSS-VARI
               MOVE ZEROES TO WSS-VAL-COMP IN WSS-VARI
           ELSE
               MOVE 'S' TO WSS-COB-COPR IN WSS-VARI
               MOVE PCP-SUCO TO WSS-VAL-COMP IN WSS-VARI
               ADD PCP-SUIM TO WSS-VAL-COMP IN WSS-VARI.

           MOVE WSS-VAL-COMP IN WSS-VARI TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-COMP IN WSS-VARI.
       FIN-CAL-COM-PRE-PCP.
           EXIT.
      *-----------------------------------------------------------------
       CALCULA-GASTOS SECTION.
       INI-CALCULA-GASTOS.
           MOVE 'S' TO WSS-IND-GASTOS IN WSS-VARI.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
           MOVE WSS-VAL-MORASUM TO WSS-VAL-CPTCAMO.
           MOVE WSS-VAL-INTSUM TO WSS-VAL-CPTINT.
           MOVE WSS-VAL-CFGPSUM TO WSS-VAL-CPTFGP.
           MOVE WSS-DLC-FDEV IN WSS-VARI TO DLC-FEC-FDEV IN DLC.
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
           COMPUTE WSS-VAL-PREP IN WSS-VARI =
                                     WSS-VAL-PREP IN WSS-VARI -
                                     (WSS-VAL-CPTINT + WSS-VAL-CPTFGP +
                                     WSS-TOT-CAPM IN WSS-VARI +
                                     WSS-VAL-CPTCAMO)
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
      *    COMPUTE WSS-VAL-PREP IN WSS-VARI =
      *            WSS-VAL-PREP IN WSS-VARI - WSS-TOT-MORA IN WSS-VARI.
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS

           IF WSS-QUE-MVEN IN WSS-VARI NOT = 'S'
               GO TO NO-HAY-MVE2.

           MOVE SPACES                  TO INT-TIPT.
           MOVE ZEROES                  TO INT-TINT.
           MOVE OPC-COD-VCOC IN OPC     TO INT-VCAM.
           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTPAG-R
              MOVE VEN-NUM-DVEN IN VEN     TO INT-DUNO WSS-NUM-DDEV
              MOVE VEN-NUM-MVEN IN VEN     TO INT-MUNO WSS-NUM-MDEV
              MOVE VEN-NUM-SVEN IN VEN     TO INT-SUNO WSS-NUM-SDEV
              MOVE VEN-NUM-AVEN IN VEN     TO INT-AUNO WSS-NUM-ADEV
           ELSE
           IF DLC-FEC-FDEV IN DLC > ZEROES
              MOVE DLC-NUM-DDEV IN DLC     TO INT-DUNO WSS-NUM-DDEV
              MOVE DLC-NUM-MDEV IN DLC     TO INT-MUNO WSS-NUM-MDEV
              MOVE DLC-NUM-SDEV IN DLC     TO INT-SUNO WSS-NUM-SDEV
              MOVE DLC-NUM-ADEV IN DLC     TO INT-AUNO WSS-NUM-ADEV
           ELSE
              MOVE OPC-NUM-DCOL IN OPC     TO INT-DUNO WSS-NUM-DDEV
              MOVE OPC-NUM-MCOL IN OPC     TO INT-MUNO WSS-NUM-MDEV
              MOVE OPC-NUM-SCOL IN OPC     TO INT-SUNO WSS-NUM-SDEV
              MOVE OPC-NUM-ACOL IN OPC     TO INT-AUNO WSS-NUM-ADEV.

           MOVE WSS-FEC-CPTPAG          TO INT-FDOS.
           MOVE OPC-NUM-DCOL IN OPC     TO INT-DCOL.
           MOVE OPC-NUM-MCOL IN OPC     TO INT-MCOL.
           MOVE OPC-NUM-SCOL IN OPC     TO INT-SCOL.
           MOVE OPC-NUM-ACOL IN OPC     TO INT-ACOL.
           MOVE WSS-FEC-CPTPAG          TO INT-FBTV.
           MOVE OPC-CIC-IOPC IN OPC     TO INT-IOPC.
           MOVE DLC-NUM-IDLC IN DLC     TO INT-IDLC.
           PERFORM COL-CAL-INT.
           IF INT-CMSG > SPACES
              MOVE ZEROES TO INT-TIPE
              MOVE SPACES TO INT-CMSG.

           PERFORM CAL-INT-NORMAL.

      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
      *    COMPUTE WSS-VAL-PREP IN WSS-VARI =
      *            WSS-VAL-PREP IN WSS-VARI - WSS-VAL-CPTINT.
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS

      *  SE CARGAN LOS INTERESES DEL PREPAGO PARA EL CERTIFICADO
           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTINT   TO FRM-VAL-INTE-EDT
              MOVE FRM-VAL-INTE-EDT TO WSS-VAL-INTE-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTINT   TO WSS-VAL-INTE-V(WSS-JCPT).

       NO-HAY-MVE2.

           MOVE OPC-VAL-SCRE IN OPC TO WSS-VAL-CPTSCRE.
           IF OPC-COD-VCOC IN OPC NOT = '0998  '
              MOVE ZEROES              TO WSS-VAL-REAJ-V(WSS-JCPT)
              MOVE WSS-VAL-CPTSCRE     TO WSS-VAL-CPTCAAD
              GO TO CON-VAL-REA2.

      *   PARA CALCULAR REAJUSTES - CALCULO A FECHA DE CURSE
           COMPUTE WSS-VAL-CPTCPPR ROUNDED =
                   WSS-VAL-CPTSCRE         *
                   WSS-VAL-CPTCRS.

      *   PARA CALCULAR REAJUSTES - CALCULO A FECHA DE PAGO
           COMPUTE WSS-VAL-CPTREAJ ROUNDED =
                   WSS-VAL-CPTSCRE         *
                   WSS-VAL-CPTPGO.

      *RESCATO MONTO DE CAPITAL ADEUDADO REAJUSTADO A FECHA DE PAGO
           MOVE WSS-VAL-CPTREAJ TO WSS-VAL-CPTCAAD.
           MOVE WSS-VAL-CPTCAAD TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTCAAD.

      *   CALCULO REAJUSTES Y TRANSFIERO AL VECTOR
           COMPUTE WSS-VAL-CPTREAJ ROUNDED =
                   WSS-VAL-CPTREAJ         -
                   WSS-VAL-CPTCPPR.

      *SE SACAN DECIMALES AL REAJUSTE Y SE INFORMA
           MOVE WSS-VAL-CPTREAJ TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTREAJ.

       CON-VAL-REA2.
           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTREAJ  TO FRM-VAL-REAJ-EDT
              MOVE FRM-VAL-REAJ-EDT TO WSS-VAL-REAJ-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTREAJ  TO WSS-VAL-REAJ-V(WSS-JCPT).

      *    NO EXISTE MORA PARA LOS PREPAGOS PARCIALES
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE ZEROES  TO WSS-VAL-CPTCAMO.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

           IF SCR-OFRM-SRV
               MOVE WSS-VAL-CPTCAMO  TO FRM-VAL-CAMO-EDT
               MOVE FRM-VAL-CAMO-EDT TO WSS-VAL-CAMO-V(WSS-JCPT)
           ELSE
               MOVE WSS-VAL-CPTCAMO  TO WSS-VAL-CAMO-V(WSS-JCPT).

      *    SE PROCEDE A RESCATAR EL VALOR DE COMISION DE FOGAPE
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *    PERFORM CALCULA-COM-FGP.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      * AGREGADO POR CAMBIO EN FOGAPE
           PERFORM SET-VAR-LOCC.
           PERFORM LOC-COM-FGP.

           IF LOC-GLS-NOCO IN LOC-VARI = 'SICOBRACOM' AND
                LOC-COM-FGPE IN LOC-VARI > ZEROES
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       IF OPC-COD-VCOC IN OPC = '0998  ' AND
      *           WSS-GLS-NOUF = 'NO'
      *          COMPUTE WSS-VAL-COMI = LOC-COM-FGPE * WSS-VAL-CPTPGO
      *          MOVE WSS-VAL-COMI  TO WSS-VAL-CPTFGPD
      *       ELSE
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
                 MOVE LOC-COM-FGPE    TO   WSS-VAL-COMI
                 MOVE WSS-VAL-COMI  TO WSS-VAL-CPTFGPD.


      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *    IF VEN-FEC-FIMV IN VEN NOT < WSS-FEC-CPTFCAM
      *       GO TO CONT-CAL-FOGAP2.
      *
      *    PERFORM SET-VAR-LOCC2.
      *    PERFORM LOC-COM-FGP.
      *
      *    IF LOC-GLS-NOCO IN LOC-VARI = 'SICOBRACOM' AND
      *         LOC-COM-FGPE IN LOC-VARI > ZEROES
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *       IF OPC-COD-VCOC IN OPC = '0998  ' AND
      *           WSS-GLS-NOUF = 'NO'
      *          COMPUTE WSS-VAL-COMI = LOC-COM-FGPE * WSS-VAL-CPTPGO
      *          ADD WSS-VAL-COMI  TO WSS-VAL-CPTFGPD
      *       ELSE
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
      *          MOVE LOC-COM-FGPE    TO   WSS-VAL-COMI
      *          ADD WSS-VAL-COMI  TO WSS-VAL-CPTFGPD.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE

       CONT-CAL-FOGAP2.
           MOVE WSS-VAL-CPTFGPD TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTFGP.
           ADD PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTFGP.
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
           COMPUTE WSS-VAL-PREP IN WSS-VARI =
                   WSS-VAL-PREP IN WSS-VARI - PES-SGV-ENTE IN PES-VARI.
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS

           IF LOC-GLS-NOCO IN LOC-VARI NOT = 'SICOBRACOM'
              MOVE ZEROES        TO WSS-VAL-CPTFGP.

      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
      *    COMPUTE WSS-VAL-PREP IN WSS-VARI =
      *            WSS-VAL-PREP IN WSS-VARI - WSS-VAL-CPTFGP.
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTFGP   TO FRM-VAL-COFG-EDT
              MOVE FRM-VAL-COFG-EDT TO WSS-VAL-COFG-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTFGP   TO WSS-VAL-COFG-V(WSS-JCPT).

      *SE CALCULA COMISION DE PREPAGO
           COMPUTE CAN-SGV-TPAG IN CAN-FLD =
                    WSS-VAL-MINC IN WSS-VARI - WSS-TOT-MORA IN WSS-VARI.
           PERFORM CAL-COM-PRE-PCP.
           IF WSS-COB-COPR IN WSS-VARI = 'N'
               MOVE ZEROES TO WSS-VAL-COPR
           ELSE
               MOVE 999999999 TO WSS-VAL-COPR.

           COMPUTE WSS-VAL-PREP IN WSS-VARI =
                   WSS-VAL-PREP IN WSS-VARI - WSS-VAL-COMP IN WSS-VARI.

           PERFORM CAL-CAP-PREP.
           PERFORM EVA-PRE-MIN.
           PERFORM BUS-COMI-PRE.

           IF SCR-OFRM-SRV
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
      *       MOVE WSS-VAL-CAPA IN WSS-VARI  TO FRM-VAL-CAPR-EDT
              COMPUTE WSS-CAP-FINAL IN WSS-VARI =
                    WSS-TOT-CAPM IN WSS-VARI + WSS-VAL-CAPA IN WSS-VARI
              MOVE WSS-CAP-FINAL IN WSS-VARI TO FRM-VAL-CAPR-EDT
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS
              MOVE FRM-VAL-CAPR-EDT TO WSS-VAL-CAPR-V(WSS-JCPT)
           ELSE
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
      *       MOVE WSS-VAL-CAPA IN WSS-VARI TO WSS-VAL-CAPR-V(WSS-JCPT).
              COMPUTE WSS-CAP-FINAL IN WSS-VARI =
                    WSS-TOT-CAPM IN WSS-VARI + WSS-VAL-CAPA IN WSS-VARI
             MOVE WSS-CAP-FINAL IN WSS-VARI TO WSS-VAL-CAPR-V(WSS-JCPT).
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS

       FIN-CALCULA-GASTOS.
           EXIT.
      *AFRI-INI JUNIO-2012 CERTIFICADO PREPAGO PARCIAL
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
       REV-VEN-MOR SECTION.
       INI-REV-VEN-MOR.

           MOVE ZEROES TO WSS-VAL-CPTCAMO
                          WSS-VAL-CPTINT
                          WSS-VAL-CPTFGP.

           MOVE ZEROES TO WSS-VAL-MORASUM
                          WSS-VAL-INTSUM
                          WSS-VAL-CFGPSUM.
      *AFRI-INI 01-OCT-2012 OPERACIONES MOROSAS OBS
           MOVE ZEROES TO WSS-TOT-CAPM IN WSS-VARI.
      *AFRI-FIN 01-OCT-2012 OPERACIONES MOROSAS OBS
       REV-CUO-MOR.

           IF VEN-FEC-FIMV IN VEN NOT < WSS-FEC-CPTPAG-R
               COMPUTE OPC-VAL-SCRE IN OPC = OPC-VAL-SCRE IN OPC -
                                         WSS-VAL-INTAUX IN WSS-VARI
               GO TO MOV-SUM-CAM.

      ***************************************************************
      *SE TRABAJARAN TODOS LOS MONTOS EN PESOS
      *SE RESTA CUOTA QUE VENCIO DEL PREPAGO REALIZADO
      *SE CALCULA LA MORA DEL VENCIMIENTO

           IF VEN-FEC-FIMV IN VEN > WSS-CAN-RFUA IN WSS-VARI
               MOVE VEN-NUM-DIMV IN VEN      TO TXC-DEC1
               MOVE VEN-NUM-MIMV IN VEN      TO TXC-MEC1
               MOVE VEN-NUM-SIMV IN VEN      TO TXC-SEC1
               MOVE VEN-NUM-AIMV IN VEN      TO TXC-AEC1
           ELSE
               MOVE WSS-NUM-DFUA IN WSS-VARI TO TXC-DEC1
               MOVE WSS-NUM-MFUA IN WSS-VARI TO TXC-MEC1
               MOVE WSS-NUM-SFUA IN WSS-VARI TO TXC-SEC1
               MOVE WSS-NUM-AFUA IN WSS-VARI TO TXC-AEC1.

           PERFORM CALCULA-MORA-CPT.

           IF WSS-VAL-CPTCAMO < ZEROES
               MOVE ZEROES TO WSS-VAL-CPTCAMO.

           ADD WSS-VAL-CPTCAMO TO WSS-VAL-MORASUM.

      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      * SE BUSCAN GASTOS DE COBRANZA
      *    PERFORM OBT-COM-NOR-CPT.
      *    ADD NOR-CONO TO WSS-VAL-MORASUM.
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE

           COMPUTE OPC-VAL-SCRE IN OPC = OPC-VAL-SCRE IN OPC -
                                       WSS-VAL-INTAUX IN WSS-VARI.
           MOVE WSS-DLC-FDEV IN WSS-VARI TO DLC-FEC-FDEV IN DLC.

      *SE CALCULA COMISION FOGAPE SI ES QUE CORRESPONDE PARA ESTE VEN
           COMPUTE OPC-VAL-SCRE IN OPC = OPC-VAL-SCRE IN OPC -
                                         VEN-VAL-SCAP IN VEN.

           MOVE 'S' TO WSS-IND-VMOR IN WSS-VARI.
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *    PERFORM SET-VAR-LOCC-MOR.
           PERFORM SET-VAR-LOCC.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
           MOVE SPACES TO WSS-IND-VMOR IN WSS-VARI.
           PERFORM LOC-COM-FGP.

           IF LOC-GLS-NOCO IN LOC-VARI = 'SICOBRACOM' AND
              LOC-COM-FGPE IN LOC-VARI > ZEROES
               MOVE LOC-COM-FGPE    TO   WSS-VAL-COMI
               MOVE WSS-VAL-COMI  TO WSS-VAL-CPTFGPD.

      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *    IF VEN-FEC-FIMV IN VEN NOT < WSS-FEC-CPTFCAM
      *       GO TO CONT-CAL-FOGAP3.
      *
      *    MOVE 'S' TO WSS-IND-VMOR IN WSS-VARI.
      *    PERFORM SET-VAR-LOCC2.
      *    MOVE SPACES TO WSS-IND-VMOR IN WSS-VARI.
      *    PERFORM LOC-COM-FGP.
      *
      *    IF LOC-GLS-NOCO IN LOC-VARI = 'SICOBRACOM' AND
      *       LOC-COM-FGPE IN LOC-VARI > ZEROES
      *        MOVE LOC-COM-FGPE    TO   WSS-VAL-COMI
      *        ADD WSS-VAL-COMI  TO WSS-VAL-CPTFGPD.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      * SE BUSCAN GASTOS DE COBRANZA
           PERFORM OBT-COM-NOR-CPT.
           ADD NOR-CONO TO WSS-VAL-MORASUM.
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE

       CONT-CAL-FOGAP3.
           MOVE WSS-VAL-CPTFGPD TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTFGP.

           IF LOC-GLS-NOCO IN LOC-VARI NOT = 'SICOBRACOM'
              MOVE ZEROES        TO WSS-VAL-CPTFGP.

           ADD WSS-VAL-CPTFGP TO WSS-VAL-CFGPSUM.

      *LA VEN ESTA EN LA MONEDA DEL CREDITO
      *SE RESTA EL PAGO DE LA CUOTA PARA REALIZAR EL PREPAGO
           IF OPC-COD-VCOC IN OPC = '0998  '
               COMPUTE VEN-VAL-FINA IN VEN =
                       VEN-VAL-SFIN IN VEN - VEN-VAL-SCAP IN VEN
               COMPUTE VEN-VAL-FINA IN VEN =
                       VEN-VAL-FINA IN VEN * WSS-VAL-CPTPGO
               MOVE VEN-VAL-FINA IN VEN TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTINT
           ELSE
               COMPUTE WSS-VAL-CPTINT =
                       VEN-VAL-SFIN IN VEN - VEN-VAL-SCAP IN VEN.

           ADD WSS-VAL-CPTINT TO WSS-VAL-INTSUM.

           MOVE ZEROES TO WSS-VAL-CPTCAMO
                          WSS-VAL-CPTFGP
                          WSS-VAL-CPTINT.

           MOVE BKP-VAL-SCRE TO OPC-VAL-SCRE IN OPC.
           COMPUTE WSS-VAL-INTAUX IN WSS-VARI = VEN-VAL-SCAP IN VEN +
                                             WSS-VAL-INTAUX IN WSS-VARI.

      *AFRI-INI 07-JUN-2017 IDNI EN MOROSOS
           MOVE VEN-VAL-IDNI IN VEN      TO DLC-VAL-IDNI IN DLC.
      *AFRI-FIN 07-JUN-2017 IDNI EN MOROSOS
           MOVE VEN-FEC-FIMV IN VEN TO WSS-DLC-FDEV IN WSS-VARI.
           MOVE VEN-FEC-FVEN IN VEN TO WSS-VEN-ANTE IN WSS-VARI.
           MOVE ZEROES TO WSS-CAN-RFUA IN WSS-VARI.

      *AHORA QUE SE DESCONTO LA CUOTA MOROSA SE AVANZA AL SIGUIENTE
      *VENCIMIENTO Y SE PROCESA COMO SI FUESE EL PRIMERO VIGENTE

           COMPUTE VEN-NUM-IVEN IN VEN = VEN-NUM-IVCT IN VEN + 1.
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           IF OPC-IND-VSTR IN OPC = 'S'
               PERFORM COL-OBT-VEN
               IF NOT VEN-STAT-OKS OR
                  VEN-CIC-IOPC IN VEN NOT = OPC-CIC-IOPC IN OPC OR
                  VEN-NUM-IVEN IN VEN > OPC-NUM-VCOR IN OPC
                   MOVE 'N' TO WSS-QUE-MVEN IN WSS-VARI
               ELSE
                   MOVE 'S' TO WSS-QUE-MVEN IN WSS-VARI
           ELSE
               PERFORM COL-FIO-VEN
               IF NOT FIO-STAT-OKS
                   MOVE 'N' TO WSS-QUE-MVEN IN WSS-VARI
               ELSE
                   MOVE 'S' TO WSS-QUE-MVEN IN WSS-VARI.

           MOVE WSS-DLC-FDEV IN WSS-VARI TO DLC-FEC-FDEV IN DLC.

           IF WSS-QUE-MVEN IN WSS-VARI = 'S'
               GO TO REV-CUO-MOR.

       MOV-SUM-CAM.
           MOVE WSS-VAL-MORASUM IN WSS-VARI TO WSS-VAL-CPTCAMO.
           MOVE WSS-VAL-INTSUM IN WSS-VARI TO WSS-VAL-CPTINT.
           MOVE WSS-VAL-CFGPSUM IN WSS-VARI TO WSS-VAL-CPTFGP.
       FIN-REV-VEN-MOR.
           EXIT.
      *---------------------------------------------------------------
       REV-CYA-ROV SECTION.
       INI-REV-CYA-ROV.
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF NOT (FIO-STAT-OKS AND
              CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
              CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA)
               MOVE SPACES TO CYA-IND-TCYA IN CYA.

       FIN-REV-CYA-ROV.
           EXIT.
      *----------------------------------------------------------------
       REV-OPC-ROV SECTION.
       INI-REV-OPC-ROV.
           MOVE SPACES TO OPC.
           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO OPC-CIC-IOPC IN OPC.
       FIN-REV-OPC-ROV.
           EXIT.
      *-----------------------------------------------------------------
       INF-FINAL-SIM SECTION.
       INI-INF-FINAL-SIM.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTINT   TO FRM-VAL-INTE-EDT
              MOVE FRM-VAL-INTE-EDT TO WSS-VAL-INTE-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTINT   TO WSS-VAL-INTE-V(WSS-JCPT).

** 6 **    SE CALCULAN LOS REAJUSTES DEL PREPAGO
           MOVE BKP-VAL-SCRE TO WSS-VAL-CPTSCRE.
           IF OPC-COD-VCOC IN OPC NOT = '0998  '
              MOVE ZEROES              TO WSS-VAL-REAJ-V(WSS-JCPT)
              MOVE BKP-VAL-SCRE        TO WSS-VAL-CPTCAPR
              MOVE BKP-VAL-SCRE        TO WSS-VAL-CPTCAPR-BKP
              GO TO CON-VAL-REAJ-N.

      *   PARA CALCULAR REAJUSTES - CALCULO A FECHA DE CURSE
           COMPUTE WSS-VAL-CPTCPPR ROUNDED =
                   WSS-VAL-CPTSCRE         *
                   WSS-VAL-CPTCRS.

      *   PARA CALCULAR REAJUSTES - CALCULO A FECHA DE PAGO
           COMPUTE WSS-VAL-CPTREAJ ROUNDED =
                   WSS-VAL-CPTSCRE         *
                   WSS-VAL-CPTPGO.

      *   TRANSFIERO VALOR A PREPAGO CALCULADO A FECHA DE CURSE
           MOVE WSS-VAL-CPTREAJ TO WSS-VAL-CPTCAPR.

      *   CALCULO REAJUSTES Y TRANSFIERO AL VECTOR
           COMPUTE WSS-VAL-CPTREAJ ROUNDED =
                   WSS-VAL-CPTREAJ         -
                   WSS-VAL-CPTCPPR.
           MOVE WSS-VAL-CPTREAJ TO WSS-VAL-REAJ-V(WSS-JCPT).

           COMPUTE WSS-VAL-CAAD-V(WSS-JCPT) =
                   BKP-VAL-SCRE   -
                  (WSS-VAL-CAPR-V(WSS-JCPT) /
                   WSS-VAL-CPTCRS).

           MOVE WSS-VAL-CPTREAJ TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTREAJ.

      *    CALCULO CAPITAL DE PREPAGO A UF DE CURSE Y SUMO REAJUSTES
           COMPUTE WSS-VAL-CPTCAPR-BKP ROUNDED =
            (BKP-VAL-SCRE * WSS-VAL-CPTCRS) + WSS-VAL-CPTREAJ.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTREAJ  TO FRM-VAL-REAJ-EDT
              MOVE FRM-VAL-REAJ-EDT TO WSS-VAL-REAJ-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTREAJ  TO WSS-VAL-REAJ-V(WSS-JCPT).

       CON-VAL-REAJ-N.
      *MORA
           IF SCR-OFRM-SRV
               MOVE WSS-VAL-CPTCAMO  TO FRM-VAL-CAMO-EDT
               MOVE FRM-VAL-CAMO-EDT TO WSS-VAL-CAMO-V(WSS-JCPT)
           ELSE
               MOVE WSS-VAL-CPTCAMO  TO WSS-VAL-CAMO-V(WSS-JCPT).

** 8 **    SE PROCEDE A RESCATAR EL VALOR DE COMISION DE FOGAPE

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTFGP   TO FRM-VAL-COFG-EDT
              MOVE FRM-VAL-COFG-EDT TO WSS-VAL-COFG-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTFGP   TO WSS-VAL-COFG-V(WSS-JCPT).


      *NO HAY COMISION DE PREPAGO PORQUE NO HAY NADA QUE PREPAGAR
           MOVE ZEROES TO WSS-VAL-COPR.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-COPR     TO FRM-VAL-COPR-EDT
              MOVE FRM-VAL-COPR-EDT TO WSS-VAL-COPR-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-COPR     TO WSS-VAL-COPR-V(WSS-JCPT).

*******    SE EVALUA VALOR DE CAPITAL PREPAGO A CANCELAR.
           COMPUTE WSS-VAL-CPTCAPR =
                 (BKP-VAL-SCRE * WSS-VAL-CPTPGO)

           MOVE WSS-VAL-CPTCAPR TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTCAPR.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTCAPR  TO FRM-VAL-CAPR-EDT
              MOVE FRM-VAL-CAPR-EDT TO WSS-VAL-CAPR-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTCAPR  TO WSS-VAL-CAPR-V(WSS-JCPT).

           MOVE ZEROES TO WSS-VAL-CPTCAAD.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTCAAD  TO FRM-VAL-CAAD-EDT
              MOVE FRM-VAL-CAAD-EDT TO WSS-VAL-CAAD-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTCAAD  TO WSS-VAL-CAAD-V(WSS-JCPT).

** 9 **    SE SUMA TOTAL PAGADO LOS MONTOS DE 1+2+3+5+6+7
           COMPUTE WSS-VAL-CPTTPAG       =
                   WSS-VAL-CAPR-V(WSS-JCPT) +
                   WSS-VAL-INTE-V(WSS-JCPT) +
                   WSS-VAL-COPR-V(WSS-JCPT) +
                   WSS-VAL-CAMO-V(WSS-JCPT) +
                   WSS-VAL-COFG-V(WSS-JCPT).

      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
           PERFORM BUS-MON-SEG.
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTTPAG  TO FRM-VAL-TPAG-EDT
              MOVE FRM-VAL-TPAG-EDT TO WSS-VAL-TPAG-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTTPAG  TO WSS-VAL-TPAG-V(WSS-JCPT).

       FIN-INF-FINAL-SIM.
           EXIT.
      *---------------------------------------------------------------
      *SECCION QUE BUSCA EL TIPO DE PAGO DE LA ULTIMA CAN Y LA FECHA DE
      *ULTIMO PAGO O ABONO DE LA CUOTA
       EVAL-CAN-TRAS SECTION.
       INI-EVAL-CAN-TRAS.
           MOVE ZEROES TO WSS-CAN-FUAP IN WSS-VARI.
           MOVE SPACES TO CAN.
           MOVE OPC-CIC-IOPC IN OPC   TO WSS-CIC-CPTIOPC.
           MOVE OPC-CIC-IOPC IN OPC   TO CAN-CIC-IOPC IN CAN.
           MOVE 999                   TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-LEQ           TO FIO-CMND.
       VERIF-CAN.
           PERFORM COL-FIO-CAN.
           IF NOT (FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = CAN-CIC-IOPC IN CAN)
               GO TO FIN-EVAL-CAN-TRAS.

      *REVERSA
           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
              CAN-SGV-DIFE IN CAN < ZEROES OR
              CAN-SGV-TREN IN CAN < ZEROES)
               MOVE FIO-GET-PRV TO FIO-CMND
               GO TO VERIF-CAN.
      *CAN NO ACTIVA
           IF (CAN-MSC-STAT IN CAN NOT = 'A'  )
               MOVE FIO-GET-PRV TO FIO-CMND
               GO TO VERIF-CAN.

      *GUARDO CAN LEIDA Y FECHA DE ULTIMO PAGO
           IF CAN-MSC-CANC IN CAN = 'CIE' OR
              OPC-NUM-VCOR IN OPC = 1
               MOVE CAN-FEC-FCAN IN CAN TO WSS-CAN-FUAP IN WSS-VARI.
           PERFORM REV-CYA-ROV.
           IF (CYA-IND-TCYA IN CYA(1:2) NOT = 'PB' AND
              CYA-IND-TCYA IN CYA(1:2) NOT = 'TR')
               GO TO FIN-EVAL-CAN-TRAS.

      *SE BUSCA ROV ASOCIADA A LA CANCELACION PARA VER SI SE PAGO
      *EL TRASPASO
           MOVE SPACES TO ROV.
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF NOT (FIO-STAT-OKS AND
              CAN-CIC-IOPC IN CAN = ROV-CIC-IOPV IN ROV AND
              CAN-NUM-ICAN IN CAN = ROV-NUM-IVCT IN ROV)
               MOVE 'ROVEXISAL'  TO MSG-COD-MENS
               MOVE 'COL'        TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-EVAL-CAN-TRAS.

           PERFORM REV-OPC-ROV.
           IF OPC-CIC-IOPC IN OPC = SPACES OR
              OPC-VAL-SCRE IN OPC > ZEROES OR
              OPC-MSC-STAT IN OPC NOT = 'A'
               MOVE 'ROVEXISAL'  TO MSG-COD-MENS
               MOVE 'COL'        TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-EVAL-CAN-TRAS.

       OTRA-CAN.
           MOVE 'ROVEXISAL'  TO MSG-COD-MENS.
           MOVE 'COL'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE SPACES TO CAN.
           MOVE OPC-CIC-IOPC IN OPC   TO CAN-CIC-IOPC IN CAN.
           MOVE 999                   TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-LEQ           TO FIO-CMND.
       VERIF-CAN-2.
           PERFORM COL-FIO-CAN.
           IF NOT (FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = CAN-CIC-IOPC IN CAN)
               GO TO FIN-EVAL-CAN-TRAS.
      *REVERSA
           IF (CAN-SGV-TPAG IN CAN < ZEROES OR
              CAN-SGV-DIFE IN CAN < ZEROES OR
              CAN-SGV-TREN IN CAN < ZEROES)
               MOVE FIO-GET-PRV TO FIO-CMND
               GO TO VERIF-CAN-2.
      *CAN NO ACTIVA
           IF (CAN-MSC-STAT IN CAN NOT = 'A'  )
               MOVE FIO-GET-PRV TO FIO-CMND
               GO TO VERIF-CAN-2.

           PERFORM REV-CYA-ROV.
           IF (CYA-IND-TCYA IN CYA(1:2) NOT = 'PB' AND
              CYA-IND-TCYA IN CYA(1:2) NOT = 'TR')
               MOVE SPACES       TO MSG-COD-MENS
               MOVE SPACES       TO MSG-COD-SIST
               MOVE SPACES       TO FRM-MENS
               GO TO FIN-EVAL-CAN-TRAS.

      *SE BUSCA ROV ASOCIADA A LA CANCELACION PARA VER SI SE PAGO
      *EL TRASPASO
           MOVE SPACES TO ROV.
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF NOT (FIO-STAT-OKS AND
              CAN-CIC-IOPC IN CAN = ROV-CIC-IOPV IN ROV AND
              CAN-NUM-ICAN IN CAN = ROV-NUM-IVCT IN ROV)
               MOVE 'ROVEXISAL'  TO MSG-COD-MENS
               MOVE 'COL'        TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-EVAL-CAN-TRAS.

           PERFORM REV-OPC-ROV.
           IF OPC-CIC-IOPC IN OPC = SPACES OR
              OPC-VAL-SCRE IN OPC > ZEROES OR
              OPC-MSC-STAT IN OPC NOT = 'A'
               MOVE 'ROVEXISAL'  TO MSG-COD-MENS
               MOVE 'COL'        TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-EVAL-CAN-TRAS.

           IF OPC-VAL-SCRE IN OPC = ZEROES
               GO TO OTRA-CAN.

       FIN-EVAL-CAN-TRAS.
           EXIT.
      *-------------------------------------------------------------
       OBT-COM-NOR-CPT SECTION.
       INI-OBT-COM-NOR-CPT.
      *AFRI-INI 13-ENE-2018 COMISION NORMALIZA
      *    MOVE ZEROES              TO NOR-CONO.
      *    MOVE VEN-FEC-FVEN IN VEN TO NOR-FVEN.
      *    MOVE WSS-FEC-CPTPAG-R    TO NOR-FCAN.
      *    MOVE VEN-CIC-IOPC IN VEN TO NOR-IOPC.
      *
      *    COMPUTE WSS-VAL-TEMP IN WSS-VARI =
      *             VEN-VAL-SFIN IN VEN * WSS-VAL-CPTPGO.
      *
      *    COMPUTE WSS-VAL-TEMP IN WSS-VARI ROUNDED =
      *                             WSS-VAL-TEMP IN WSS-VARI +
      *            ((WSS-VAL-TEMP IN WSS-VARI * TXC-ATXC) / 100).
      *
      *    MOVE WSS-VAL-TEMP IN WSS-VARI TO NOR-TPAG.
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
      *    ADD WSS-VAL-CPTFGPD TO NOR-TPAG.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
      *
      *
      *    MOVE '0999   '           TO NOR-VCAM.
      *    MOVE '*' TO NOR-IVIG.
      *    MOVE '*' TO NOR-ICTA.
      *    PERFORM OBT-COM-NOR.
      *
      *    IF NOR-RETO = '1'
      *        MOVE ZEROES TO NOR-CONO.
           MOVE ZEROES              TO GCN-CONO.
           MOVE VEN-FEC-FVEN IN VEN TO GCN-FVEN.
           MOVE WSS-FEC-CPTPAG-R    TO GCN-FCAN.
           MOVE VEN-CIC-IOPC IN VEN TO GCN-IOPC.

           COMPUTE WSS-VAL-TEMP IN WSS-VARI =
                    VEN-VAL-SFIN IN VEN * WSS-VAL-CPTPGO.
           MOVE WSS-VAL-TEMP IN WSS-VARI TO GCN-TPAG.
           ADD WSS-VAL-CPTFGPD           TO GCN-TPAG.
           MOVE GCN-IND-CPES             TO GCN-VCAM.
           MOVE GCN-ASTE                 TO GCN-IVIG.
           MOVE GCN-ASTE                 TO GCN-ICTA.
           MOVE GCN-N                    TO GCN-IND-ICIE.
           MOVE ZEROES                   TO GCN-CAMB.
           PERFORM COL-LNK-GCN.
           IF GCN-CMSG > SPACES
               MOVE ZEROES   TO NOR-CONO
           ELSE
               MOVE GCN-CONO TO NOR-CONO.
      *AFRI-FIN 13-ENE-2018 COMISION NORMALIZA
       FIN-OBT-COM-NOR-CPT.
           EXIT.
      *-----------------------------------------------------------------
      * COPY COLBGNOR
      *-----------------------------------------------------------------
       OBT-COM-NOR SECTION.
       INI-OBT-COM-NOR.
           PERFORM INI-VARI.
           PERFORM PRO-PCCN.
       FIN-OBT-COM-NOR.
           EXIT.
       INI-VARI SECTION.
       INI-INI-VARI.
           IF NOR-FCAN IS NOT NUMERIC OR
              NOR-FCAN = ZEROES OR
              NOR-FCAN = SPACES
              PERFORM GET-FHOY
              MOVE HOY-FHOY TO NOR-FEC-PROC
           ELSE
              MOVE NOR-FCAN TO NOR-FEC-PROC
           END-IF.
      *CIMA-INI 29-JUL-2014 OPT TRANSAC LENTAS
      *    MOVE 'COL'               TO TAB-COD-SIST FIO-SIST.
      *    MOVE 'PCP'               TO TAB-COD-TTAB IN TAB.
      *    MOVE 'TIO         '      TO TAB-COD-CTAB IN TAB.
      *    MOVE FIO-GET-KEY TO FIO-CMND.
      *    PERFORM GNS-FIO-TAB.
      *    IF FIO-STAT-OKS AND
      *       TAB-IND-VIGE IN TAB = 'S'
      *        MOVE TAB-GLS-DATA IN TAB TO NOR-GLS-DATA-TIOS
      *    ELSE
      *        MOVE 'CCNPCP  INEX'               TO NOR-CMSG
      *    END-IF.
      *
      *    MOVE 'COL'               TO TAB-COD-SIST FIO-SIST.
      *    MOVE 'PCP'               TO TAB-COD-TTAB IN TAB.
      *    MOVE 'TIOVCD      '      TO TAB-COD-CTAB IN TAB.
      *    MOVE FIO-GET-KEY TO FIO-CMND.
      *    PERFORM GNS-FIO-TAB.
      *    IF FIO-STAT-OKS AND
      *       TAB-IND-VIGE IN TAB = 'S'
      *        MOVE TAB-GLS-DATA IN TAB TO NOR-GLS-DATA-TIOS-VCD
      *    ELSE
      *        MOVE 'CCNPCP  INEX'               TO NOR-CMSG
      *    END-IF.
      *
      *    IF NOR-CMSG NOT > SPACES
      *       PERFORM CARGA-TABLA-BCX
      *    END-IF
      *    IF NOR-CMSG NOT > SPACES
      *       PERFORM CARGA-TABLA-BCV
      *    END-IF.
      *CIMA-FIN 29-JUL-2014 OPT TRANSAC LENTAS
       FIN-INI-VARI.
           EXIT.

       PRO-PCCN SECTION.
       INI-PRO-PCCN.
           MOVE SPACES TO NOR-MMSG NOR-CMSG.
           MOVE 0      TO NOR-RETO.
           IF ( DLC-IND-SCTB IN DLC = 'VCD' AND
              DLC-IND-SCBZ IN DLC = SPACES ) OR
              ( DLC-IND-SCTB IN DLC = SPACES OR 'VIG' OR 'MUL' )
               IF DLC-IND-SCTB IN DLC = 'VCD'
                   IF ( NOR-IVIG = '*' OR 'V' )
                       PERFORM VALIDA-COBRO-VCD
                   ELSE
                       MOVE ZEROES  TO  NOR-CONO
                   END-IF
               ELSE
                   IF ( NOR-IVIG = '*' OR 'N' )
                       PERFORM VALIDA-COBRO-VIG
                   ELSE
                       MOVE ZEROES  TO  NOR-CONO
                   END-IF
               END-IF
           ELSE
               MOVE ZEROES  TO  NOR-CONO
           END-IF
           IF  NOR-CMSG  = SPACES
               PERFORM COMPLETA-RETORNO-OK
               GO TO FIN-PRO-PCCN.
           MOVE SPACES TO NOR-DOUT.
           MOVE 1      TO NOR-RETO.
           MOVE 'COL'          TO MSG-COD-SIST
           MOVE NOR-CMSG       TO MSG-COD-MENS
           PERFORM GET-MSG
           MOVE MSG-GLS-DESC TO NOR-MMSG.
       FIN-PRO-PCCN.
           EXIT.

       COMPLETA-RETORNO-OK SECTION.
       INI-COMPLETA-RETORNO-OK.
           MOVE '0'     TO  NOR-RETO.
           MOVE SPACES  TO  NOR-MMSG.
           MOVE NOR-IOPC TO NOR-OOPC.
           MOVE NOR-VCAM TO NOR-OVCA.
           MOVE SPACES   TO NOR-FILL.
       FIN-COMPLETA-RETORNO-OK.
           EXIT.
      *
       CARGA-TABLA-BCX SECTION.
       INI-CARGA-TABLA-BCX.
           MOVE 'COL'               TO TAB-COD-SIST FIO-SIST.
           MOVE 'BCX'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND
              'BCX' = TAB-COD-TTAB IN TAB AND
              TAB-IND-VIGE IN TAB = 'S'
               PERFORM REDNX-BCX UNTIL ('BCX' NOT = TAB-COD-TTAB OR
                                 FIO-STAT = '14' OR NOR-BCX = 200)
           ELSE
               MOVE 'CCNBCX   INEX' TO NOR-CMSG
           END-IF.
       FIN-CARGA-TABLA-BCX.
           EXIT.

       REDNX-BCX SECTION.
       INI-REDNX-BCX.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND
              'BCX' = TAB-COD-TTAB IN TAB AND TAB-IND-VIGE = 'S'
               ADD 1 TO NOR-BCX
               MOVE TAB-COD-CTAB IN TAB TO NOR-COD-BANCA(NOR-BCX)
               MOVE TAB-GLS-DATA IN TAB TO NOR-GLS-DATA(NOR-BCX)
           END-IF.
       FIN-REDNX-BCX.
           EXIT.

       CARGA-TABLA-BCV SECTION.
       INI-CARGA-TABLA-BCV.
           MOVE 'COL'               TO TAB-COD-SIST FIO-SIST.
           MOVE 'BCV'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND
              'BCV' = TAB-COD-TTAB IN TAB AND
              TAB-IND-VIGE IN TAB = 'S'
               PERFORM REDNX-BCV UNTIL ('BCV' NOT = TAB-COD-TTAB OR
                                 FIO-STAT = '14' OR NOR-BCV = 200)
           ELSE
               MOVE 'CCNBCV   INEX' TO NOR-CMSG
           END-IF.
       FIN-CARGA-TABLA-BCV.
           EXIT.

       REDNX-BCV SECTION.
       INI-REDNX-BCV.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND
              'BCV' = TAB-COD-TTAB IN TAB AND TAB-IND-VIGE = 'S'
               ADD 1 TO NOR-BCV
               MOVE TAB-COD-CTAB IN TAB TO NOR-COD-BANCA-VCD(NOR-BCV)
               MOVE TAB-GLS-DATA IN TAB TO NOR-GLS-DATA-VCD(NOR-BCV)
           END-IF.
       FIN-REDNX-BCV.
           EXIT.
       VAL-FO-EVC SECTION.
       INI-VAL-FO-EVC.
           MOVE OPC-CIC-IOPC IN OPC TO EVC-CIC-IOPC IN EVC.
           MOVE ZEROES              TO EVC-NUM-IEVC IN EVC
                                       NOR-EVC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-EVC.
           PERFORM CAL-NUM-FO-EVC UNTIL
                   ( NOT FIO-STAT-OKS OR
                     OPC-CIC-IOPC IN OPC NOT = EVC-CIC-IOPC IN EVC OR
                     NOR-EVC > 1).
       FIN-VAL-FO-EVC.
           EXIT.
       CAL-NUM-FO-EVC SECTION.
       INI-CAL-NUM-FO-EVC.
           IF EVC-MSC-TCVE = 'FO'
               ADD 1 TO NOR-EVC
           END-IF.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-EVC.
       FIN-CAL-NUM-FO-EVC.
           EXIT.

       VALIDA-COBRO-VCD SECTION.
       INI-VALIDA-COBRO-VCD.
           MOVE 0 TO NOR-CONSUMO.
           PERFORM VAL-TIPO-OPC-VCD VARYING NOR-I FROM 1 BY 1 UNTIL
                               ( NOR-CONSUMO = 1 OR NOR-I > 20 OR
                                 NOR-GLS-TIO-VCD(NOR-I) = SPACES ).
           PERFORM VALIDA-COBRO.
       FIN-VALIDA-COBRO-VCD.
           EXIT.

       VALIDA-COBRO-VIG SECTION.
       INI-VALIDA-COBRO-VIG.
           MOVE 0 TO NOR-CONSUMO.
           PERFORM VAL-TIPO-OPC VARYING NOR-I FROM 1 BY 1 UNTIL
                               ( NOR-CONSUMO = 1 OR NOR-I > 20 OR
                                 NOR-GLS-TIO(NOR-I) = SPACES ).
           PERFORM VALIDA-COBRO.
       FIN-VALIDA-COBRO-VIG.
           EXIT.
       VALIDA-COBRO SECTION.
       INI-VALIDA-COBRO.
           IF NOR-CONSUMO = 1
                 PERFORM VALIDA-BANCA-CLIENTE
                 IF  NOR-CMSG > SPACES
                     GO TO FIN-VALIDA-COBRO
                 END-IF
                 IF NOR-TBAN = 1
                    PERFORM LEER-VEN
                    IF NOR-CMSG NOT > SPACES
                       PERFORM OBT-NUM-DIAS
                       IF NOR-CMSG NOT > SPACES
                          IF NOR-NUM-DIAS > ZEROES
                             PERFORM CAL-COM-NORMA
                          ELSE
                             MOVE ZEROES  TO  NOR-CONO
                          END-IF
                       END-IF
                    END-IF
                 ELSE
                    MOVE ZEROES  TO  NOR-CONO
                 END-IF
           ELSE
              MOVE ZEROES  TO  NOR-CONO
           END-IF.
       FIN-VALIDA-COBRO.
           EXIT.
       LEER-VEN SECTION.
       INI-LEER-VEN.
           IF NOT ( NOR-FVEN IS NOT NUMERIC OR
                    NOR-FVEN = ZEROES OR
                    NOR-FVEN = SPACES)
               MOVE NOR-FVEN TO VEN-FEC-FVEN IN VEN
               GO TO FIN-LEER-VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
           IF OPC-IND-VSTR IN OPC = 'S'
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *       MOVE 1                TO VEN-NUM-IVEN IN VEN
              MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
           ELSE
              MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
           END-IF.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
              MOVE 'CCNVEN  INEX' TO NOR-CMSG
           END-IF.
       FIN-LEER-VEN.
           EXIT.
       CAL-COM-NORMA SECTION.
       INI-CAL-COM-NORMA.
           MOVE 0 TO NOR-PLAN.
           PERFORM VAL-TIPO-PLAN VARYING NOR-J FROM 1 BY 1
                                 UNTIL (NOR-PLAN = 1 OR NOR-J = 45 OR
                                        NOR-COD-PLAN(NOR-J) = SPACES)
           IF NOR-PLAN = 1
              IF NOR-NUM-DIAS NOT < NOR-NUM-DIME
                 PERFORM CONT-CAL-MORA
              END-IF
           ELSE
              IF NOR-NUM-DIAS NOT < NOR-NUM-DIMC
                 PERFORM CONT-CAL-MORA
              END-IF
           END-IF.
       FIN-CAL-COM-NORMA.
           EXIT.
       CONT-CAL-MORA SECTION.
       INI-CONT-CAL-MORA.
           PERFORM OBT-CTA-CTE.
           IF (( NOR-CTA-CTE = 1 AND NOR-ICTA = 'S' ) OR
               ( NOR-CTA-CTE = 0 AND NOR-ICTA = 'N' ) OR
               ( NOR-CTA-CTE = 1 AND NOR-ICTA = '*' ) OR
               ( NOR-CTA-CTE = 0 AND NOR-ICTA = '*' ))
              PERFORM CALCULA-PORCENTAJE
              IF NOR-PORC = 1 AND
                 NOR-SALIR = 1
                 PERFORM VAL-MTO-CALC
                 MOVE 0 TO NOR-TBAN NOR-PORC
              ELSE
                 IF NOR-PORC = 0
                    MOVE ZEROES  TO  NOR-CONO
                 ELSE
                    PERFORM VAL-MTO-CALC
                 END-IF
              END-IF
           ELSE
              MOVE ZEROES  TO  NOR-CONO
           END-IF.
       FIN-CONT-CAL-MORA.
           EXIT.
       CALCULA-PORCENTAJE SECTION.
       INI-CALCULA-PORCENTAJE.
           MOVE 0 TO NOR-PORC.
           MOVE NOR-NUM-DIAS TO NOR-DIF-DIAS-R
           IF DBC-IND-TICL IN DBC = 'P'
              MOVE DCP-COD-TBAN IN DCP TO NOR-COD-TBAN
           ELSE
              MOVE DCE-COD-TBAN IN DCE TO NOR-COD-TBAN
           END-IF

      * TRANSFORMAR VALOR PAGADO A UF PARA BUSCAR TRAMO
           IF NOR-VCAM = '0999  '
              COMPUTE NOR-SGV-TPAG ROUNDED = NOR-TPAG / NOR-SGV-VCAM
              MOVE    NOR-SGV-TPAG TO NOR-SGV-CALC-FIJO
           ELSE
              MOVE NOR-TPAG TO NOR-SGV-TPAG NOR-SGV-CALC-FIJO
           END-IF

           IF DLC-IND-SCTB IN DLC = 'VCD'
              MOVE 1 TO NOR-I
              PERFORM VAL-TRAMO-BANCA-VCD UNTIL
                      (NOR-PORC = 1 OR NOR-I > NOR-BCV)

              IF NOR-PORC = 1
                 MOVE 0 TO NOR-TRAMO-ANT NOR-SGV-CALC-R NOR-SALIR
                           NOR-SGV-AUX
                 PERFORM BUS-SGTE-TRAMO-VCD UNTIL
                        NOR-KEY-BCA NOT = NOR-VAL-KEY OR NOR-SALIR = 1
                 IF NOR-SALIR = 0
                    MOVE 0 TO NOR-SGV-CALC-R
                 END-IF

                 IF NOR-VCAM = '0999  '
                    COMPUTE NOR-SGV-CALC ROUNDED = NOR-SGV-CALC-R *
                                               NOR-SGV-VCAM / 100
                 ELSE
                   COMPUTE NOR-SGV-CALC ROUNDED = NOR-SGV-CALC-R / 100
                 END-IF
              END-IF
           ELSE
              MOVE 1 TO NOR-I
              PERFORM VAL-TRAMO-BANCA UNTIL
                     (NOR-PORC = 1 OR NOR-I > NOR-BCX)

              IF NOR-PORC = 1
                 MOVE 0 TO NOR-TRAMO-ANT NOR-SGV-CALC-R NOR-SALIR
                           NOR-SGV-AUX
                 PERFORM BUS-SGTE-TRAMO UNTIL
                         NOR-KEY-BCA NOT = NOR-VAL-KEY OR NOR-SALIR = 1
                 IF NOR-SALIR = 0
                    MOVE 0 TO NOR-SGV-CALC-R
                 END-IF
                 IF NOR-VCAM = '0999  '
                    COMPUTE NOR-SGV-CALC ROUNDED = NOR-SGV-CALC-R *
                                                  NOR-SGV-VCAM / 100
                 ELSE
                   COMPUTE NOR-SGV-CALC ROUNDED = NOR-SGV-CALC-R / 100
                 END-IF
              END-IF
           END-IF.
       FIN-CALCULA-PORCENTAJE.
           EXIT.

       VAL-TRAMO-BANCA SECTION.
       INI-VAL-TRAMO-BANCA.
           MOVE NOR-COD-BANCA(NOR-I) TO NOR-COD-KEY-BANCA.

           IF NOR-KEY-BCA NOT < NOR-VAL-KEY

               MOVE NOR-GLS-DATA(NOR-I) TO NOR-GLS-DATA-PORC
               MOVE NOR-KEY-BCA TO NOR-VAL-KEY
               MOVE 1 TO NOR-PORC
           ELSE
               ADD 1 TO NOR-I
           END-IF.
       FIN-VAL-TRAMO-BANCA.
           EXIT.

       BUS-SGTE-TRAMO SECTION.
       INI-BUS-SGTE-TRAMO.
           COMPUTE NOR-SGV-AUX = NOR-SGV-TPAG + NOR-TRAMO-ANT.
           IF NOR-SGV-AUX > NOR-TRAMO-R
               COMPUTE NOR-SGV-CALC-R = NOR-SGV-CALC-R +
                      (NOR-TRAMO-R - NOR-TRAMO-ANT) *
                       NOR-SGV-PORC
               ADD NOR-TRAMO-ANT TO NOR-SGV-TPAG
               SUBTRACT NOR-TRAMO-R FROM NOR-SGV-TPAG
               MOVE NOR-TRAMO-R TO NOR-TRAMO-ANT
               ADD 1 TO NOR-I
               MOVE NOR-COD-BANCA(NOR-I) TO NOR-COD-KEY-BANCA
               MOVE NOR-GLS-DATA(NOR-I) TO NOR-GLS-DATA-PORC
           ELSE
               IF NOR-SGV-TPAG = 0
                   MOVE 1 TO NOR-SALIR
               ELSE
                   COMPUTE NOR-SGV-CALC-R = NOR-SGV-CALC-R +
                                        (NOR-SGV-TPAG * NOR-SGV-PORC)
                   MOVE 1 TO NOR-SALIR
               END-IF
           END-IF.
       FIN-BUS-SGTE-TRAMO.
           EXIT.

       VAL-TRAMO-BANCA-VCD SECTION.
       INI-VAL-TRAMO-BANCA-VCD.
           MOVE NOR-COD-BANCA-VCD(NOR-I) TO NOR-COD-KEY-BANCA.
           IF NOR-KEY-BCA NOT < NOR-VAL-KEY
               MOVE NOR-GLS-DATA-VCD(NOR-I) TO NOR-GLS-DATA-PORC
               MOVE NOR-KEY-BCA TO NOR-VAL-KEY
               MOVE 1 TO NOR-PORC
           ELSE
               ADD 1 TO NOR-I
           END-IF.
       FIN-VAL-TRAMO-BANCA-VCD.
           EXIT.

       BUS-SGTE-TRAMO-VCD SECTION.
       INI-BUS-SGTE-TRAMO-VCD.
           COMPUTE NOR-SGV-AUX = NOR-SGV-TPAG + NOR-TRAMO-ANT.
           IF NOR-SGV-AUX > NOR-TRAMO-R
               COMPUTE NOR-SGV-CALC-R = NOR-SGV-CALC-R +
                      (NOR-TRAMO-R - NOR-TRAMO-ANT) *
                       NOR-SGV-PORC
               ADD NOR-TRAMO-ANT TO NOR-SGV-TPAG
               SUBTRACT NOR-TRAMO-R FROM NOR-SGV-TPAG
               MOVE NOR-TRAMO-R TO NOR-TRAMO-ANT
               ADD 1 TO NOR-I
               MOVE NOR-COD-BANCA-VCD(NOR-I) TO NOR-COD-KEY-BANCA
               MOVE NOR-GLS-DATA-VCD(NOR-I) TO NOR-GLS-DATA-PORC
           ELSE
               IF NOR-SGV-TPAG = 0
                   MOVE 1 TO NOR-SALIR
               ELSE
                   COMPUTE NOR-SGV-CALC-R = NOR-SGV-CALC-R +
                                        (NOR-SGV-TPAG * NOR-SGV-PORC)
                   MOVE 1 TO NOR-SALIR
               END-IF
           END-IF.
       FIN-BUS-SGTE-TRAMO-VCD.
           EXIT.

       VAL-TIPO-OPC SECTION.
       INI-VAL-TIPO-OPC.
           IF NOR-GLS-TIO(NOR-I) = OPC-COD-TOOC IN OPC
               MOVE 1 TO NOR-CONSUMO
           END-IF.
       FIN-VAL-TIPO-OPC.
           EXIT.

       VAL-TIPO-OPC-VCD SECTION.
       INI-VAL-TIPO-OPC-VCD.
           IF NOR-GLS-TIO-VCD (NOR-I) = OPC-COD-TOOC IN OPC
               MOVE 1 TO NOR-CONSUMO
           END-IF.
       FIN-VAL-TIPO-OPC-VCD.
           EXIT.

       OBT-CTA-CTE SECTION.
       INI-OBT-CTA-CTE.
           MOVE 0 TO NOR-CTA-CTE.
           MOVE RDC-CIC-ICLI IN RDC TO RCO-CIC-ICLI IN RCO
           MOVE FIO-GET-NLS TO FIO-CMND
           PERFORM SGC-FIO-RCO
           IF FIO-STAT-OKS AND
              RDC-CIC-ICLI IN RDC = RCO-CIC-ICLI IN RCO
              PERFORM REC-RCO UNTIL NOT ( FIO-STAT-OKS   AND
                      NOR-CTA-CTE = 0              AND
                      RDC-CIC-ICLI IN RDC = RCO-CIC-ICLI IN RCO )
              END-IF.
       FIN-OBT-CTA-CTE.
           EXIT.

       REC-RCO SECTION.
       INI-REC-RCO.
           MOVE RCO-CIC-IOPE IN RCO TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF FIO-STAT-OKS  AND
              OPE-COD-STAT IN OPE = 'VIG' AND
              OPE-FEC-FIOP IN OPE NOT = NOR-FEC-PROC
               IF OPE-COD-TOPR IN OPE = 'CCT' OR
                  OPE-COD-TOPR IN OPE = 'CPR'
                   MOVE 1 TO NOR-CTA-CTE
               ELSE
                   MOVE 0 TO NOR-CTA-CTE
           ELSE
               MOVE 0 TO NOR-CTA-CTE
           END-IF.

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
       FIN-REC-RCO.
           EXIT.

       VALIDA-BANCA-CLIENTE SECTION.
       INI-VALIDA-BANCA-CLIENTE.
           MOVE 0 TO NOR-TBAN.
           MOVE 1 TO NOR-I.
           MOVE LOW-VALUE           TO RDC.
           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC'      TO FIO-AKEY.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = RDC-CIC-IOPC IN RDC AND
                    RDC-NUM-IDLC IN RDC = ZEROES )
              MOVE 'CCNRDC  INEX'  TO NOR-CMSG
           ELSE
              MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC
              MOVE FIO-GET-KEY         TO FIO-CMND
              PERFORM SGC-FIO-DBC
              IF NOT FIO-STAT-OKS
                 MOVE 'CCNDBC  INEX'  TO NOR-CMSG
              ELSE
                 IF DBC-IND-TICL = 'P'
                    PERFORM PROCESO-PERSONA
                 ELSE
                    IF DBC-IND-TICL = 'E'
                       PERFORM PROCESO-EMPRESA
                    ELSE
                       MOVE 'CCNTPE  DESC'  TO NOR-CMSG
                    END-IF
                 END-IF
              END-IF
           END-IF.
       FIN-VALIDA-BANCA-CLIENTE.
           EXIT.
       PROCESO-PERSONA SECTION.
       INI-PROCESO-PERSONA.
           MOVE DBC-CIC-ICLI IN DBC TO DCP-CIC-ICLI IN DCP.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DCP
           IF NOT FIO-STAT-OKS
              MOVE 'CCNDCP  INEX'  TO NOR-CMSG
           ELSE
              MOVE DCP-COD-TBAN IN DCP TO NOR-COD-TBAN
              MOVE SPACES              TO NOR-DIF-DIAS
              IF DLC-IND-SCTB IN DLC = 'VCD'
                 PERFORM VAL-TIPO-BANCA-VCD
                             VARYING NOR-I FROM 1 BY 1 UNTIL
                             (NOR-TBAN = 1 OR NOR-I > NOR-BCV )
              ELSE
                 PERFORM VAL-TIPO-BANCA
                          VARYING NOR-I FROM 1 BY 1 UNTIL
                          (NOR-TBAN = 1 OR NOR-I > NOR-BCX )
              END-IF
              IF NOR-TBAN = 1
                 PERFORM VAL-ANEXOS-BCX
                 IF NOR-CMSG = SPACES
                    PERFORM BUSCAR-TIPO-CAMBIO
                    IF  NOR-CMSG > SPACES
                        GO TO FIN-PROCESO-PERSONA
                    ELSE
                           COMPUTE NOR-PORC-MIN ROUNDED =
                                        NOR-SGV-MMIN * NOR-SGV-VCAM
                           COMPUTE NOR-PORC-MAX ROUNDED =
                                        NOR-SGV-MMAX * NOR-SGV-VCAM
                    END-IF
                 END-IF
              ELSE
                 MOVE ZEROES  TO  NOR-CONO
              END-IF
           END-IF.
       FIN-PROCESO-PERSONA.
           EXIT.
       PROCESO-EMPRESA SECTION.
       INI-PROCESO-EMPRESA.
           MOVE DBC-CIC-ICLI IN DBC TO DCE-CIC-ICLI IN DCE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DCE.
           IF NOT FIO-STAT-OKS
              MOVE 'CCNDCE  INEX'  TO NOR-CMSG
           ELSE
              MOVE DCE-COD-TBAN IN DCE TO NOR-COD-TBAN
              MOVE SPACES              TO NOR-DIF-DIAS
              IF DLC-IND-SCTB IN DLC = 'VCD'
                 PERFORM VAL-TIPO-BANCA-VCD
                              VARYING NOR-I FROM 1 BY 1 UNTIL
                              (NOR-TBAN = 1 OR NOR-I > NOR-BCV )
              ELSE
                 PERFORM VAL-TIPO-BANCA
                              VARYING NOR-I FROM 1 BY 1 UNTIL
                              (NOR-TBAN = 1 OR NOR-I > NOR-BCX)
              END-IF
              IF NOR-TBAN = 1
                 PERFORM VAL-ANEXOS-BCX
                 IF NOR-CMSG = SPACES
                    PERFORM BUSCAR-TIPO-CAMBIO
                    IF  NOR-CMSG > SPACES
                        GO TO FIN-PROCESO-EMPRESA
                    ELSE
                           COMPUTE NOR-PORC-MIN ROUNDED =
                                     NOR-SGV-MMIN * NOR-SGV-VCAM
                           COMPUTE NOR-PORC-MAX ROUNDED =
                                     NOR-SGV-MMAX * NOR-SGV-VCAM
                    END-IF
                 END-IF
              END-IF
           END-IF.
       FIN-PROCESO-EMPRESA.
           EXIT.


       VAL-TIPO-BANCA SECTION.
       INI-VAL-TIPO-BANCA.
           IF NOR-COD-BANCA(NOR-I) = NOR-VAL-KEY
               MOVE NOR-GLS-DATA(NOR-I) TO NOR-GLS-DATA-BANCA
               MOVE 1 TO NOR-TBAN
           END-IF.
       FIN-VAL-TIPO-BANCA.
           EXIT.

       VAL-TIPO-BANCA-VCD SECTION.
       INI-VAL-TIPO-BANCA-VCD.
           IF NOR-COD-BANCA-VCD(NOR-I) = NOR-VAL-KEY
               MOVE NOR-GLS-DATA-VCD(NOR-I) TO NOR-GLS-DATA-BANCA
               MOVE 1 TO NOR-TBAN
           END-IF.
       FIN-VAL-TIPO-BANCA-VCD.
           EXIT.

       VAL-TIPO-PLAN SECTION.
       INI-VAL-TIPO-PLAN.
           IF DBC-IND-TICL IN DBC = 'P'
               IF DCP-COD-TPLN IN DCP = NOR-COD-PLAN(NOR-J)
                   MOVE 1 TO NOR-PLAN
               END-IF
           ELSE
               IF DCE-COD-TPLN IN DCE = NOR-COD-PLAN(NOR-J)
                   MOVE 1 TO NOR-PLAN
               END-IF
           END-IF.
       FIN-VAL-TIPO-PLAN.
           EXIT.


       VAL-MTO-CALC SECTION.
       INI-VAL-MTO-CALC.
           IF NOR-SGV-CALC > NOR-PORC-MAX
               MOVE NOR-PORC-MAX     TO NOR-CONO
           ELSE
               MOVE NOR-SGV-CALC     TO NOR-CONO
           END-IF.

           IF NOR-CONO < NOR-PORC-MIN
               MOVE NOR-PORC-MIN     TO NOR-CONO
           END-IF.
       FII-VAL-MTO-CALC.
           EXIT.
       OBT-NUM-DIAS SECTION.
       INI-OBT-NUM-DIAS.
********* SE AGREGA DEPENDENCIA DE VEN-FEC-FVEN CON TABLA VEN
           IF VEN-FEC-FVEN IN VEN NOT < NOR-FEC-PROC
              MOVE ZEROES   TO NOR-NUM-DIAS
              GO TO FIN-OBT-NUM-DIAS.
           MOVE VEN-NUM-DVEN IN VEN TO FEC-DEC1.
           MOVE VEN-NUM-MVEN IN VEN TO FEC-MEC1.
           MOVE VEN-NUM-SVEN IN VEN TO FEC-SEC1.
           MOVE VEN-NUM-AVEN IN VEN TO FEC-AEC1.
           MOVE NOR-NUM-DPROC TO FEC-DEC2.
           MOVE NOR-NUM-MPROC TO FEC-MEC2.
           MOVE NOR-NUM-SPROC TO FEC-SEC2.
           MOVE NOR-NUM-APROC TO FEC-AEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE 'FECSTATNOOK'    TO NOR-CMSG
           ELSE
               MOVE FEC-NDIA TO NOR-NUM-DIAS.
       FIN-OBT-NUM-DIAS.
           EXIT.
       BUSCAR-TIPO-CAMBIO SECTION.
       INI-BUSCAR-TIPO-CAMBIO.
           IF NOR-GLS-MONE = '0999  '
              MOVE 1 TO NOR-SGV-VCAM
           ELSE
              MOVE WSS-VAL-CPTNOR TO NOR-SGV-VCAM
           END-IF.
       FIN-BUSCAR-TIPO-CAMBIO.
           EXIT.
       VAL-ANEXOS-BCX SECTION.
       INI-VAL-ANEXOS-BCX.
           IF NOR-SGV-MMIN IS NOT NUMERIC
               MOVE 'CCNPJEMINNNU' TO  NOR-CMSG
           END-IF.

           IF NOR-NUM-DIMC IS NOT NUMERIC
               MOVE 'CCNDIAINMNNU' TO  NOR-CMSG
           END-IF.

           IF NOR-IND-TDMC NOT = 'H' AND 'C'
               MOVE 'CCNINDHACOER' TO  NOR-CMSG
           END-IF.

           IF NOR-GLS-MONE NOT > SPACES
               MOVE 'CCNMONINVALI' TO  NOR-CMSG
           ELSE
               PERFORM VAL-MONEDA-BCX
           END-IF.
       FIN-VAL-ANEXOS-BCX.
           EXIT.

       VAL-MONEDA-BCX SECTION.
       INI-VAL-MONEDA-BCX.
           MOVE 'TAB'         TO TAB-COD-SIST FIO-SIST.
           MOVE 'VLR '        TO TAB-COD-TTAB IN TAB.
           MOVE NOR-GLS-MONE   TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY   TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'CCNMONNOOK  ' TO  NOR-CMSG
           ELSE
              IF TAB-IND-VIGE IN TAB NOT = 'S'
                 MOVE 'CCNMONNOVIG ' TO  NOR-CMSG
              END-IF
           END-IF.
       FIN-VAL-MONEDA-BCX.
           EXIT.
*********************************************************************
******* FIN  COPY COLBGNOR.
*********************************************************************
       BUS-VEN-ANT-CPT SECTION.
       INI-BUS-VEN-ANT-CPT.
      *----------------------------------------------------------------
           COMPUTE VEN-NUM-IVEN IN VEN = VEN-NUM-IVCT IN VEN - 1.
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           IF OPC-IND-VSTR IN OPC = 'S'
               PERFORM COL-OBT-VEN
               IF NOT VEN-STAT-OKS OR
                  VEN-CIC-IOPC IN VEN NOT = OPC-CIC-IOPC IN OPC OR
                  VEN-NUM-IVEN IN VEN > OPC-NUM-VCOR IN OPC
                   MOVE 'OPC    NOVEN' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-BUS-VEN-ANT-CPT
               ELSE
                   MOVE VEN-FEC-FVEN IN VEN TO WSS-FEC-VANT IN WSS-VARI
           ELSE
               PERFORM COL-FIO-VEN
               IF NOT FIO-STAT-OKS
                   MOVE 'OPC    NOVEN' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-BUS-VEN-ANT-CPT
                   MOVE 'N' TO WSS-QUE-MVEN IN WSS-VARI
               ELSE
                   MOVE VEN-FEC-FVEN IN VEN TO WSS-FEC-VANT IN WSS-VARI.

      *  SE BUSCA LA PRIMERA VEN VIGENTE EN CURSO
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN
           IF OPC-IND-VSTR IN OPC = 'S'
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *       MOVE 1                TO VEN-NUM-IVEN IN VEN
              MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
           ELSE
              MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN.

           MOVE FIO-GET-NLS         TO FIO-CMND
           PERFORM COL-FIO-VEN
           IF NOT (FIO-STAT-OKS                              AND
                   OPC-CIC-IOPC IN OPC = VEN-CIC-IOPC IN VEN)
              MOVE 'OPC    NOVEN' TO MSG-COD-MENS
              MOVE 'GNS' TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS.

       FIN-BUS-VEN-ANT-CPT.
           EXIT.
      *--------------------------------------------------------------
       SET-VAR-LOCC-MOR SECTION.
       INI-SET-VAR-LOCC-MOR.

           IF VEN-FEC-FIMV IN VEN < WSS-FEC-CPTFCAM
               COMPUTE OPC-VAL-SCRE IN OPC =
                   OPC-VAL-SCRE IN OPC + VEN-VAL-SCAP IN VEN.

           IF PCP NOT > SPACES
               MOVE ZEROES TO PCP-SUCO PCP-SUIM PCP-SUVP.
           MOVE ZEROES                  TO LOC-COM-FGPE IN LOC-VARI.
           MOVE ZEROES                  TO LOC-VAL-MCAN IN LOC-VARI.
           MOVE ZEROES                  TO LOC-VAL-MNTO IN LOC-VARI.
           PERFORM LOC-INI-OPC.
           MOVE OPC-CAI-IOPC IN OPC     TO LOC-CAI-IOPC IN LOC-VARI.
           MOVE OPC-IIC-IOPC IN OPC     TO LOC-IIC-IOPC IN LOC-VARI.
           IF (VEN-VAL-CAPI IN VEN - VEN-VAL-SCAP IN VEN) > ZEROES
             COMPUTE LOC-VAL-SALD IN LOC-VARI =
                OPC-VAL-SCRE IN OPC +
                ( VEN-VAL-CAPI IN VEN - VEN-VAL-SCAP IN VEN )
           ELSE
              MOVE OPC-VAL-SCRE IN OPC  TO LOC-VAL-SALD IN LOC-VARI.

           MOVE VEN-NUM-DVEN IN VEN     TO LOC-NUM-DCAN IN LOC-VARI.
           MOVE VEN-NUM-MVEN IN VEN     TO LOC-NUM-MCAN IN LOC-VARI.
           MOVE VEN-NUM-SVEN IN VEN     TO LOC-NUM-SCAN IN LOC-VARI.
           MOVE VEN-NUM-AVEN IN VEN     TO LOC-NUM-ACAN IN LOC-VARI.
           PERFORM GET-FHOY.
      *AFRI-INI 28-AGO-2012 OPERACIONES MOROSAS
      *    MOVE HOY-FHOY IN HOY-VARI    TO LOC-FEC-FHOY IN LOC-VARI.
           MOVE WSS-FEC-CPTPAG-R        TO LOC-FEC-FHOY IN LOC-VARI.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS
           MOVE 'CTE' TO LOC-MSC-CANC IN LOC-VARI.

           IF WSS-VEN-ANTE IN WSS-VARI > ZEROES
              MOVE WSS-NUM-DANT IN WSS-VARI TO LOC-CXE-DVEN
              MOVE WSS-NUM-MANT IN WSS-VARI TO LOC-CXE-MVEN
              MOVE WSS-NUM-SANT IN WSS-VARI TO LOC-CXE-SVEN
              MOVE WSS-NUM-AANT IN WSS-VARI TO LOC-CXE-AVEN
           ELSE
              MOVE OPC-NUM-DCOL IN OPC  TO LOC-CXE-DVEN
              MOVE OPC-NUM-MCOL IN OPC  TO LOC-CXE-MVEN
              MOVE OPC-NUM-SCOL IN OPC  TO LOC-CXE-SVEN
              MOVE OPC-NUM-ACOL IN OPC  TO LOC-CXE-AVEN.

           MOVE VEN-NUM-DVEN IN VEN     TO LOC-NUM-DVEN IN LOC-VARI.
           MOVE VEN-NUM-MVEN IN VEN     TO LOC-NUM-MVEN IN LOC-VARI.
           MOVE VEN-NUM-SVEN IN VEN     TO LOC-NUM-SVEN IN LOC-VARI.
           MOVE VEN-NUM-AVEN IN VEN     TO LOC-NUM-AVEN IN LOC-VARI.
           MOVE VEN-VAL-CAPI IN VEN     TO LOC-VAL-CAPI IN LOC-VARI.
      *AFRI-INI 13-SEP-2017 COMISION FOGAPE
           MOVE OPC-CAI-IOPC IN OPC     TO CAN-CAI-IOPC IN CAN.
           MOVE OPC-IIC-IOPC IN OPC     TO CAN-IIC-IOPC IN CAN.
           MOVE VEN-NUM-IVCT IN VEN     TO VEN-NUM-IVCT IN CAN-FLD.
      *AFRI-FIN 13-SEP-2017 COMISION FOGAPE
       FIN-SET-VAR-LOCC-MOR.
           EXIT.
      *AFRI-FIN 28-AGO-2012 OPERACIONES MOROSAS

      *RGD-FIN COPYS

      *AFRI-INI 11-SEP-2014 SELECCION DE SEGUROS
       BUS-MON-SEG SECTION.
       INI-BUS-MON-SEG.
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *     MOVE WSS-VAL-CPTPGO          TO DPS-SGV-VCPR.
      *     MOVE OPC-CAI-IOPC IN CPT-FLD TO DPS-CAI-IOPC.
      *     MOVE OPC-IIC-IOPC IN CPT-FLD TO DPS-IIC-IOPC.
      *     MOVE WSS-NUM-DCPTPAG         TO DPS-NUM-DCAN.
      *     MOVE WSS-NUM-MCPTPAG         TO DPS-NUM-MCAN.
      *     MOVE WSS-NUM-SCPTPAG         TO DPS-NUM-SCAN.
      *     MOVE WSS-NUM-ACPTPAG         TO DPS-NUM-ACAN.

      *     IF DPS-NUM-DOUT NOT > ZEROES AND
      *        DPS-NUM-MOUT NOT > ZEROES AND
      *        DPS-NUM-SOUT NOT > ZEROES AND
      *        DPS-NUM-AOUT NOT > ZEROES
      *         MOVE WSS-NUM-DCPTPAG         TO DPS-NUM-DOUT
      *         MOVE WSS-NUM-MCPTPAG         TO DPS-NUM-MOUT
      *         MOVE WSS-NUM-SCPTPAG         TO DPS-NUM-SOUT
      *         MOVE WSS-NUM-ACPTPAG         TO DPS-NUM-AOUT.

       *    IF FRM-VAL-PREP IN CPT-FLD > ZEROES
       *        MOVE OPC-VAL-SCRE IN OPC TO DPS-VAL-SCRE
       *        MOVE DPS-GLS-IKTT TO DPS-MSC-CANC
       *        MOVE WSS-VAL-CAPR-V(WSS-JCPT) TO WSS-CAPR-RESP
       *        MOVE WSS-VAL-REAJ-V(WSS-JCPT) TO WSS-REAJ-RESP
       *        COMPUTE DPS-SGV-PREP =
       *          WSS-VAL-CAPR-V(WSS-JCPT) + WSS-VAL-REAJ-V(WSS-JCPT) -
       *          WSS-TOT-CAPM IN WSS-VARI
       *    ELSE
       *        MOVE ZEROES TO DPS-SGV-PREP
       *        MOVE DPS-GLS-ICTT TO DPS-MSC-CANC.

       *    MOVE SPACES TO DPS-IND-TIPR.
       *    MOVE SPACES TO DPS-COD-MENS.
       *    MOVE ZEROES TO DPS-VAL-MDPT.
       *    MOVE DPS-GLS-CPT TO DPS-GLS-TCON.
       *    PERFORM COL-LNK-DPS.
       *    IF DPS-COD-MENS > SPACES
       *        MOVE ZEROES TO WSS-VAL-MDPS-V(WSS-JCPT)
       *    ELSE
       *        MOVE DPS-VAL-MDPT TO WSS-VAL-MDPS-V(WSS-JCPT).

       *    PERFORM CAL-COM-CSEG.
       *    IF MSG-COD-MENS > SPACES
       *        GO TO FIN-BUS-MON-SEG.

       *    IF DPS-MSC-CANC = DPS-GLS-IKTT
       *        IF WSS-VAL-CAAD-V(WSS-JCPT) > ZEROES
       *           MOVE WSS-VAL-CAAD-V(WSS-JCPT) TO WSS-VAL-CPTCAAD
       *           IF (WSS-VAL-CPTCAAD > DPS-VAL-MDPT)
       *               COMPUTE WSS-VAL-CPTCAAD =
       *                             WSS-VAL-CPTCAAD - DPS-VAL-MDPT
       *               MOVE WSS-VAL-CPTCAAD TO PES-SGV-DECI IN PES-VARI
       *               PERFORM PES-SCTV
       *               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTCAAD
       *               IF SCR-OFRM-SRV
       *                   MOVE WSS-VAL-CPTCAAD TO FRM-VAL-CAAD-EDT
       *                   MOVE FRM-VAL-CAAD-EDT TO
       *                                         WSS-VAL-CAAD-V(WSS-JCPT)
       *                   GO TO FIN-BUS-MON-SEG
       *               ELSE
       *                   MOVE WSS-VAL-CPTCAAD  TO
       *                                         WSS-VAL-CAAD-V(WSS-JCPT)
       *                   GO TO FIN-BUS-MON-SEG
       *           ELSE
       *               MOVE WSS-VAL-CPTCAAD TO PES-SGV-DECI IN PES-VARI
       *               PERFORM PES-SCTV
       *               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTCAAD
       *               IF SCR-OFRM-SRV
       *                   MOVE ZEROES          TO FRM-VAL-CAAD-EDT
       *                   MOVE FRM-VAL-CAAD-EDT TO
       *                                         WSS-VAL-CAAD-V(WSS-JCPT)
       *                   GO TO FIN-BUS-MON-SEG
       *               ELSE
       *                   MOVE ZEROES           TO
       *                                         WSS-VAL-CAAD-V(WSS-JCPT)
       *                   GO TO FIN-BUS-MON-SEG
       *        ELSE
       *            GO TO FIN-BUS-MON-SEG.

       *    IF WSS-VAL-CPTTPAG > DPS-VAL-MDPT
       *        COMPUTE WSS-VAL-CPTTPAG = WSS-VAL-CPTTPAG -
       *                                    DPS-VAL-MDPT
       *    ELSE
       *        MOVE ZEROES TO WSS-VAL-CPTTPAG.
           MOVE WSS-VAL-CPTPGO          TO IS2-DPS-SGV-VCPR.
           MOVE OPC-CAI-IOPC IN CPT-FLD TO IS2-DPS-CAI-IOPC.
           MOVE OPC-IIC-IOPC IN CPT-FLD TO IS2-DPS-IIC-IOPC.
           MOVE WSS-NUM-DCPTPAG         TO IS2-DPS-NUM-DCAN.
           MOVE WSS-NUM-MCPTPAG         TO IS2-DPS-NUM-MCAN.
           MOVE WSS-NUM-SCPTPAG         TO IS2-DPS-NUM-SCAN.
           MOVE WSS-NUM-ACPTPAG         TO IS2-DPS-NUM-ACAN.

           IF IS2-DPS-NUM-DOUT NOT > ZEROES AND
              IS2-DPS-NUM-MOUT NOT > ZEROES AND
              IS2-DPS-NUM-SOUT NOT > ZEROES AND
              IS2-DPS-NUM-AOUT NOT > ZEROES
               MOVE WSS-NUM-DCPTPAG         TO IS2-DPS-NUM-DOUT
               MOVE WSS-NUM-MCPTPAG         TO IS2-DPS-NUM-MOUT
               MOVE WSS-NUM-SCPTPAG         TO IS2-DPS-NUM-SOUT
               MOVE WSS-NUM-ACPTPAG         TO IS2-DPS-NUM-AOUT.

           IF FRM-VAL-PREP IN CPT-FLD > ZEROES
               MOVE OPC-VAL-SCRE IN OPC TO IS2-DPS-VAL-SCRE
               MOVE IS2-DPS-GLS-IKTT TO IS2-DPS-MSC-CANC
               MOVE WSS-VAL-CAPR-V(WSS-JCPT) TO WSS-CAPR-RESP
               MOVE WSS-VAL-REAJ-V(WSS-JCPT) TO WSS-REAJ-RESP
               COMPUTE IS2-DPS-SGV-PREP =
                 WSS-VAL-CAPR-V(WSS-JCPT) + WSS-VAL-REAJ-V(WSS-JCPT) -
                 WSS-TOT-CAPM IN WSS-VARI
           ELSE
               MOVE ZEROES TO IS2-DPS-SGV-PREP
               MOVE IS2-DPS-GLS-ICTT TO IS2-DPS-MSC-CANC.

           MOVE SPACES TO IS2-DPS-IND-TIPR.
           MOVE SPACES TO IS2-DPS-COD-MENS.
           MOVE ZEROES TO IS2-DPS-VAL-MDPT.
           MOVE IS2-DPS-GLS-CPT TO IS2-DPS-GLS-TCON.
           PERFORM COL-LNK-DPS.
           IF IS2-DPS-COD-MENS > SPACES
               MOVE ZEROES TO WSS-VAL-MDPS-V(WSS-JCPT)
           ELSE
               MOVE IS2-DPS-VAL-MDPT TO WSS-VAL-MDPS-V(WSS-JCPT).

           PERFORM CAL-COM-CSEG.
           IF MSG-COD-MENS > SPACES
               GO TO FIN-BUS-MON-SEG.

           IF IS2-DPS-MSC-CANC = IS2-DPS-GLS-IKTT
               IF WSS-VAL-CAAD-V(WSS-JCPT) > ZEROES
                  MOVE WSS-VAL-CAAD-V(WSS-JCPT) TO WSS-VAL-CPTCAAD
                  IF (WSS-VAL-CPTCAAD > IS2-DPS-VAL-MDPT)
                      COMPUTE WSS-VAL-CPTCAAD =
                                    WSS-VAL-CPTCAAD - IS2-DPS-VAL-MDPT
                      MOVE WSS-VAL-CPTCAAD TO PES-SGV-DECI IN PES-VARI
                      PERFORM PES-SCTV
                      MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTCAAD
                      IF SCR-OFRM-SRV
                          MOVE WSS-VAL-CPTCAAD TO FRM-VAL-CAAD-EDT
                          MOVE FRM-VAL-CAAD-EDT TO
                                                WSS-VAL-CAAD-V(WSS-JCPT)
                          GO TO FIN-BUS-MON-SEG
                      ELSE
                          MOVE WSS-VAL-CPTCAAD  TO
                                                WSS-VAL-CAAD-V(WSS-JCPT)
                          GO TO FIN-BUS-MON-SEG
                  ELSE
                      MOVE WSS-VAL-CPTCAAD TO PES-SGV-DECI IN PES-VARI
                      PERFORM PES-SCTV
                      MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-CPTCAAD
                      IF SCR-OFRM-SRV
                          MOVE ZEROES          TO FRM-VAL-CAAD-EDT
                          MOVE FRM-VAL-CAAD-EDT TO
                                                WSS-VAL-CAAD-V(WSS-JCPT)
                          GO TO FIN-BUS-MON-SEG
                      ELSE
                          MOVE ZEROES           TO
                                                WSS-VAL-CAAD-V(WSS-JCPT)
                          GO TO FIN-BUS-MON-SEG
               ELSE
                   GO TO FIN-BUS-MON-SEG.

           IF WSS-VAL-CPTTPAG > IS2-DPS-VAL-MDPT
               COMPUTE WSS-VAL-CPTTPAG = WSS-VAL-CPTTPAG -
                                           IS2-DPS-VAL-MDPT
           ELSE
               MOVE ZEROES TO WSS-VAL-CPTTPAG.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
           IF SCR-OFRM-SRV
               MOVE WSS-VAL-CPTTPAG  TO FRM-VAL-TPAG-EDT
               MOVE FRM-VAL-TPAG-EDT TO WSS-VAL-TPAG-V(WSS-JCPT)
           ELSE
               MOVE WSS-VAL-CPTTPAG  TO WSS-VAL-TPAG-V(WSS-JCPT).

       FIN-BUS-MON-SEG.
           EXIT.
      *----------------------------------------------------------------
      *SE IGUALA LA LOGICA DEL CANCELADOR PARA PREPAGOS PARCIALES CON
      * DEVOLUCION DE SEGUROS
       CAL-COM-CSEG SECTION.
       INI-CAL-COM-CSEG.
      *
           MOVE SPACES TO MSG-COD-MENS.
      *SE VALIDA EL INGRESO DE UN PREPAGO PARCIAL
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *    IF DPS-MSC-CANC NOT = DPS-GLS-IKTT OR
           IF IS2-DPS-MSC-CANC NOT = IS2-DPS-GLS-IKTT OR
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
              (WSS-COB-COPR IN WSS-VARI = WCC-S AND
              WSS-VAL-COMP IN WSS-VARI NOT > ZEROES) OR
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *       DPS-VAL-MDPT NOT > ZEROES OR
              IS2-DPS-VAL-MDPT NOT > ZEROES OR
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
              WSS-COB-COPR IN WSS-VARI NOT = WCC-S
               GO TO FIN-CAL-COM-CSEG.

           MOVE WSS-VAL-COMP TO WSS-COMI-ANTE IN WCC-VARI.

           MOVE SPACES TO FRM-GLS-GLO3.
           MOVE WCC-N  TO WSS-IND-GASTOS IN WSS-VARI.
           MOVE FRM-VAL-PREP IN CPT-FLD TO WSS-VAL-PREP IN WSS-VARI.
           COMPUTE WSS-VAL-CPTCAAD = WSS-VAL-CPTCAAD +
                                     WSS-VAL-CAPA IN WSS-VARI.

           IF WSS-TOT-MORA IN WSS-VARI > FRM-VAL-PREP IN CPT-FLD
               MOVE ZEROES TO CAN-SGV-TPAG IN CAN-FLD
               MOVE ZEROES TO WSS-VAL-PREP IN WSS-VARI
           ELSE
               COMPUTE WSS-VAL-PREP IN WSS-VARI =
                   WSS-VAL-PREP IN WSS-VARI - WSS-TOT-MORA IN WSS-VARI
               COMPUTE CAN-SGV-TPAG IN CAN-FLD =
                    FRM-VAL-PREP IN CPT-FLD - WSS-TOT-MORA IN WSS-VARI.

           COMPUTE CAN-SGV-TPAG IN CAN-FLD = CAN-SGV-TPAG IN CAN-FLD +
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *                                      DPS-VAL-MDPT.
                                             IS2-DPS-VAL-MDPT.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130

           MOVE WSS-VAL-COMP TO WSS-VAL-COMP-RESP.

           PERFORM CAL-COM-PRE-PCP.
           IF WSS-COB-COPR IN WSS-VARI = WCC-N
               MOVE ZEROES TO WSS-VAL-COPR
           ELSE
               MOVE WCC-999999999 TO WSS-VAL-COPR.

           IF WSS-VAL-PREP IN WSS-VARI > WCC-SEG-INTN
               COMPUTE WSS-VAL-PREP IN WSS-VARI =
                       WSS-VAL-PREP IN WSS-VARI - WCC-SEG-INTN
           ELSE
               MOVE ZEROES TO WSS-VAL-PREP IN WSS-VARI.

           IF WSS-VAL-PREP IN WSS-VARI > WCC-COM-FOGA
               COMPUTE WSS-VAL-PREP IN WSS-VARI =
                       WSS-VAL-PREP IN WSS-VARI - WCC-COM-FOGA
           ELSE
               MOVE ZEROES TO WSS-VAL-PREP IN WSS-VARI.

           IF WSS-VAL-PREP IN WSS-VARI > WSS-VAL-COMP IN WSS-VARI
               COMPUTE WSS-VAL-PREP IN WSS-VARI =
                     WSS-VAL-PREP IN WSS-VARI - WSS-VAL-COMP IN WSS-VARI
           ELSE
               MOVE ZEROES TO WSS-VAL-PREP IN WSS-VARI.

           PERFORM CAL-CAP-PREP.

           PERFORM EVA-PRE-MIN.

           COMPUTE WSS-VAL-CAPA IN WSS-VARI = WSS-VAL-CAPA IN WSS-VARI +
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *                                       DPS-VAL-MDPT.
                                              IS2-DPS-VAL-MDPT.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130

           PERFORM BUS-COMI-PRE.

           IF WSS-IND-MINI IN WSS-VARI = WCC-S
               COMPUTE WSS-VAL-CAPA IN WSS-VARI =
                                 WSS-VAL-CAPA IN WSS-VARI -
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *                                       DPS-VAL-MDPT.
                                              IS2-DPS-VAL-MDPT.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130

      *EN ESTE PUNTO YA SE CALCULO EL CAPITAL PREPAGADO PARA MOVER A LA
      *PANTALLA

           IF OPC-COD-VCOC IN OPC NOT = WCC-0999
               COMPUTE WSS-VAL-TMP IN WSS-VARI =
                       OPC-VAL-SCRE IN OPC * WSS-VAL-CPTPGO
               MOVE WSS-VAL-TMP IN WSS-VARI TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-TMP IN WSS-VARI
               IF WSS-VAL-TMP IN WSS-VARI < WSS-VAL-CAPA IN WSS-VARI
                   MOVE WCC-CAPPREMAYOPC TO MSG-COD-MENS
                   MOVE WCC-S TO SCR-IERR
                   MOVE WSS-JMAXCPT TO WSS-JCPT
                   PERFORM LIM-PTA-ERROR
                   GO TO FIN-CAL-COM-CSEG
               ELSE
                   CONTINUE
           ELSE
               IF WSS-VAL-CAPA IN WSS-VARI > OPC-VAL-SCRE IN OPC
                   MOVE WCC-CAPPREMAYOPC TO MSG-COD-MENS
                   MOVE WCC-S TO SCR-IERR
                   MOVE WSS-JMAXCPT TO WSS-JCPT
                   PERFORM LIM-PTA-ERROR
                   GO TO FIN-CAL-COM-CSEG.

           IF SCR-OFRM-SRV
              MOVE WSS-CAPR-RESP TO WSS-CAP-FINAL IN WSS-VARI
              MOVE WSS-CAP-FINAL IN WSS-VARI TO FRM-VAL-CAPR-EDT
              MOVE FRM-VAL-CAPR-EDT TO WSS-VAL-CAPR-V(WSS-JCPT)
           ELSE
              MOVE WSS-CAPR-RESP TO WSS-CAP-FINAL IN WSS-VARI
             MOVE WSS-CAP-FINAL IN WSS-VARI TO WSS-VAL-CAPR-V(WSS-JCPT).

      *SI TUVE QUE CAMBIAR EL CAPITAL PREPAGADO DEBO ENVIAR MENSAJE
           MOVE ZEROES TO WSS-VAL-MINC IN WSS-VARI.

           IF WSS-IND-MINI IN WSS-VARI = WCC-S AND
              FRM-GLS-GLO3 NOT > SPACES
               MOVE SPACES             TO WSS-GLS-CPT
               MOVE WCC-COL              TO FIO-SIST
               MOVE WCC-MSG              TO TAB-COD-TTAB IN TAB
               MOVE WCC-CAMMONCAPP       TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY        TO FIO-CMND
               PERFORM GNS-FIO-TAB
               IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = WCC-S
                   MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-CPT1
                   MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-CPT2
                   COMPUTE WSS-VAL-MINC IN WSS-VARI =
                           WSS-TOT-CAPM IN WSS-VARI +
                           WSS-VAL-CPTCAMO          +
                           WSS-VAL-CAPA IN WSS-VARI +
                           WSS-VAL-COMP IN WSS-VARI +
                           WSS-VAL-CPTFGP           +
                           WSS-VAL-CPTINT
                   MOVE WSS-GLS-CPT  TO FRM-GLS-GLO3
               ELSE
                   COMPUTE WSS-VAL-MINC IN WSS-VARI =
                           WSS-TOT-CAPM IN WSS-VARI +
                           WSS-VAL-CPTCAMO          +
                           WSS-VAL-CAPA IN WSS-VARI +
                           WSS-VAL-COMP IN WSS-VARI +
                           WSS-VAL-CPTFGP           +
                           WSS-VAL-CPTINT
                   MOVE WCC-MSG-NO-ENCONTRADO TO WSS-GLS-CPT1
                   MOVE WSS-GLS-CPT  TO FRM-GLS-GLO3.

           IF WSS-IND-MINI IN WSS-VARI = WCC-S
               COMPUTE WSS-VAL-MINC IN WSS-VARI =
                           WSS-REAJ-RESP            +
                           WSS-VAL-CPTCAMO          +
                           WSS-CAPR-RESP            +
                           WSS-VAL-COMP IN WSS-VARI +
                           WSS-VAL-CPTFGP           +
                           WSS-VAL-CPTINT           +
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *                    DPS-VAL-MDPT.
                           IS2-DPS-VAL-MDPT.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130

           IF WSS-VAL-MINC IN WSS-VARI > ZEROES AND
              WSS-COB-COPR IN WSS-VARI = WCC-S
               MOVE WSS-VAL-COMP IN WSS-VARI TO WSS-VAL-COPR
               COMPUTE CAN-SGV-TPAG IN CAN-FLD =
                                             WSS-VAL-MINC IN WSS-VARI -
                                             WSS-TOT-MORA IN WSS-VARI
               PERFORM CAL-COM-PRE-PCP
               COMPUTE WSS-VAL-MINC IN WSS-VARI =
                       WSS-VAL-MINC IN WSS-VARI - WSS-VAL-COPR +
                       WSS-VAL-COMP IN WSS-VARI
               MOVE WSS-VAL-MINC IN WSS-VARI TO
                                              WSS-VAL-PREP IN WSS-VARI.

           IF WSS-VAL-COMP NOT > WSS-COMI-ANTE IN WCC-VARI
               MOVE ZEROES TO WSS-COMI-ANTE IN WCC-VARI
           ELSE
               COMPUTE WSS-COMI-ANTE IN WCC-VARI = WSS-VAL-COMP -
                                            WSS-COMI-ANTE IN WCC-VARI.

           IF WSS-VAL-MINC IN WSS-VARI > ZEROES
               COMPUTE WSS-VAL-MINC IN WSS-VARI =
                                WSS-VAL-MINC IN WSS-VARI -
                                WSS-COMI-ANTE IN WCC-VARI -
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *                         DPS-VAL-MDPT.
                                IS2-DPS-VAL-MDPT.
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130

           IF WSS-COB-COPR IN WSS-VARI = WCC-S
               COMPUTE WSS-CAP-FINAL IN WSS-VARI =
                              WSS-CAPR-RESP - WSS-COMI-ANTE IN WCC-VARI
               IF SCR-OFRM-SRV
                   MOVE WSS-CAP-FINAL IN WSS-VARI TO FRM-VAL-CAPR-EDT
                   MOVE FRM-VAL-CAPR-EDT TO WSS-VAL-CAPR-V(WSS-JCPT)
               ELSE
                   MOVE WSS-CAP-FINAL IN WSS-VARI TO
                                               WSS-VAL-CAPR-V(WSS-JCPT).

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-COMP IN WSS-VARI TO FRM-VAL-COPR-EDT
              MOVE FRM-VAL-COPR-EDT TO WSS-VAL-COPR-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-COMP IN WSS-VARI TO WSS-VAL-COPR-V(WSS-JCPT).
      *
           IF OPC-COD-VCOC IN OPC = WCC-0998
      *SE SACAN DECIMALES AL REAJUSTE Y SE INFORMA
               IF SCR-OFRM-SRV
                   MOVE WSS-CAP-FINAL TO FRM-VAL-CAPR-EDT
                   MOVE FRM-VAL-CAPR-EDT TO WSS-VAL-CAPR-V(WSS-JCPT)
                   MOVE WSS-REAJ-RESP    TO FRM-VAL-REAJ-EDT
                   MOVE FRM-VAL-REAJ-EDT TO WSS-VAL-REAJ-V(WSS-JCPT)
               ELSE
                   MOVE WSS-CAP-FINAL TO WSS-VAL-CAPR-V(WSS-JCPT)
                   MOVE WSS-REAJ-RESP    TO WSS-VAL-REAJ-V(WSS-JCPT)
           ELSE
               NEXT SENTENCE.
      *
      *TRANSFIERO EL CAPITAL PENDIENTE A FECHA DE PAGO
           COMPUTE WSS-VAL-CPTCAAD = WSS-VAL-CPTCAAD -
                                     (WSS-CAP-FINAL + WSS-REAJ-RESP) +
                                     WSS-TOT-CAPM.
           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTCAAD  TO FRM-VAL-CAAD-EDT
              MOVE FRM-VAL-CAAD-EDT TO WSS-VAL-CAAD-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTCAAD  TO WSS-VAL-CAAD-V(WSS-JCPT).

      *CALCULA MONTO MINIMO A PAGAR
           IF WSS-VAL-MINC IN WSS-VARI = ZEROES
               COMPUTE WSS-VAL-CPTTPAG = FRM-VAL-PREP IN CPT-FLD
           ELSE
               COMPUTE WSS-VAL-CPTTPAG = WSS-VAL-MINC IN WSS-VARI.

           IF SCR-OFRM-SRV
              MOVE WSS-VAL-CPTTPAG  TO FRM-VAL-TPAG-EDT
              MOVE FRM-VAL-TPAG-EDT TO WSS-VAL-TPAG-V(WSS-JCPT)
           ELSE
              MOVE WSS-VAL-CPTTPAG  TO WSS-VAL-TPAG-V(WSS-JCPT).

           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
           IF OPC-IND-VSTR IN OPC = WCC-S
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *        MOVE WCC-1               TO VEN-NUM-IVEN IN VEN
               MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
               MOVE FIO-GET-NLS         TO FIO-CMND
               PERFORM COL-FIO-VEN
           ELSE
               MOVE OPC-NUM-IVEN IN OPC TO VEN-NUM-IVEN IN VEN
               MOVE FIO-GET-NLS         TO FIO-CMND
               PERFORM COL-FIO-VEN.

       FIN-CAL-COM-CSEG.
           EXIT.
      *----------------------------------------------------------------
      *AFRI-INI 25-OCT-2016 OPTIMIZACION K130
      *COPY COLBKDPS.
       COL-LNK-DPS SECTION.
       INI-COL-LNK-DPS.
           MOVE SCR-QIDD   TO IS2-DPS-QIDD.
           MOVE SCR-LIDD   TO IS2-DPS-LIDD.
           MOVE IS2-DPS-CMMA   TO SYS-CMMA.
           MOVE SYS-LINK   TO SYS-CMND.
           MOVE WCC-COLPPIS2 TO SYS-PROG.
           MOVE IS2-DPS-TCMA   TO SYS-TCMA.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA TO IS2-DPS-CMMA.
       FIN-COL-LNK-DPS.
           EXIT.
      *--------------------------------------------------------------
       PRO-TS-VEN SECTION.
       INI-PRO-TS-VEN.

           IF WSS-IND-TSS-DPS IN WSS-VARI NOT = WCC-S
               GO TO FIN-PRO-TS-VEN.

           IF OPC-IND-VSTR IN OPC NOT = IS2-ISC-S
               MOVE SPACES TO WSS-IND-TSS-DPS IN WSS-VARI
               GO TO FIN-PRO-TS-VEN.

           MOVE IS2-ISC-1               TO QUE-NITM.
           MOVE IS2-ISC-LEN-TSISC       TO QUE-LITM.
           MOVE IS2-DPS-TS-VEN          TO QUE-COLA.
           MOVE QUE-GET             TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT = QUE-STAT-OKS
               GO TO FIN-PRO-TS-VEN.

           MOVE SPACES TO VEN.
           MOVE IS2-ISC-1 TO VEN-NUM-IVEN IN VEN.
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.

       LOOP-VEN.
           IF VEN-NUM-IVEN IN VEN > OPC-NUM-VCOR IN OPC
               GO TO FIN-PRO-TS-VEN.

           PERFORM KOL-OBT-VEN.
           IF NOT VEN-STAT-OKS
               MOVE SPACES TO WSS-IND-TSS-DPS IN WSS-VARI
               GO TO FIN-PRO-TS-VEN.

           MOVE WCC-C00 TO FIO-STAT.

           MOVE VEN-NUM-IVEN IN VEN TO QUE-NITM.
           MOVE IS2-ISC-LEN-TSISC       TO QUE-LITM.
           MOVE IS2-DPS-TS-VEN          TO QUE-COLA.
           MOVE VEN                 TO QUE-ITEM.
           MOVE QUE-PUT             TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               MOVE SPACES TO WSS-IND-TSS-DPS IN WSS-VARI
               GO TO FIN-PRO-TS-VEN.

           ADD IS2-ISC-1 TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           GO TO LOOP-VEN.

       FIN-PRO-TS-VEN.
           EXIT.
      *----------------------------------------------------------------
       COPY COLBGVEN REPLACING COL-OBT-VEN BY KOL-OBT-VEN
                               COL-FIO-VEN BY KOL-FIO-VEN.
       COL-OBT-VEN SECTION.
       INI-COL-OBT-BEN.

           IF WSS-IND-TSS-DPS IN WSS-VARI NOT = WCC-S
               PERFORM KOL-OBT-VEN
               GO TO FIN-COL-OBT-BEN.

           MOVE ZEROES TO QUE-NITM.
           MOVE VEN-NUM-IVEN IN VEN TO QUE-NITM.

           IF FIO-CMND = FIO-GET-NXT
               ADD IS2-ISC-1 TO QUE-NITM
               MOVE QUE-NITM TO VEN-NUM-IVEN IN VEN
               IF VEN-NUM-IVEN IN VEN > OPC-NUM-VCOR IN OPC
                   SET VEN-STAT-TVX TO TRUE
                   MOVE WCC-C22 TO FIO-STAT
                   MOVE SPACES   TO FIO-AKEY
                   GO TO FIN-COL-OBT-BEN
               ELSE
                   NEXT SENTENCE
           ELSE
               NEXT SENTENCE.

           IF FIO-CMND = FIO-GET-NLS AND
              VEN-NUM-IVEN IN VEN = ZEROES
               ADD IS2-ISC-1                TO QUE-NITM
               MOVE IS2-ISC-LEN-TSISC       TO QUE-LITM
               MOVE IS2-DPS-TS-VEN          TO QUE-COLA
               MOVE QUE-GET             TO QUE-CMND
               PERFORM GNS-PRO-QUE
               MOVE QUE-ITEM TO VEN
               SET VEN-STAT-OKS TO TRUE
               MOVE WCC-C00 TO FIO-STAT
               MOVE SPACES  TO FIO-AKEY
               GO TO FIN-COL-OBT-BEN.

           IF VEN-NUM-IVEN IN VEN = ZEROES
               ADD IS2-ISC-1 TO QUE-NITM.

           MOVE IS2-ISC-LEN-TSISC       TO QUE-LITM.
           MOVE IS2-DPS-TS-VEN          TO QUE-COLA.
           MOVE QUE-GET             TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               SET VEN-STAT-TVX TO TRUE
               MOVE WCC-C22 TO FIO-STAT
               MOVE SPACES   TO FIO-AKEY
               GO TO FIN-COL-OBT-BEN.

           MOVE QUE-ITEM TO VEN.
           SET VEN-STAT-OKS TO TRUE.
           MOVE WCC-C00 TO FIO-STAT.
           MOVE SPACES   TO FIO-AKEY.

       FIN-COL-OBT-BEN.
           EXIT.
      *---------------------------------------------------------------
       COPY COLBFVEN REPLACING COL-FIO-VEN BY KOL-FIO-VEN.
       COL-FIO-VEN SECTION.
       INI-COL-FIO-BEN.

           IF WSS-IND-TSS-DPS IN WSS-VARI NOT = WCC-S
               PERFORM KOL-OBT-VEN
               GO TO FIN-COL-FIO-BEN.

           MOVE ZEROES TO QUE-NITM.
           MOVE VEN-NUM-IVEN IN VEN TO QUE-NITM.

           IF FIO-CMND = FIO-GET-NXT
               ADD IS2-ISC-1 TO QUE-NITM
               MOVE QUE-NITM TO VEN-NUM-IVEN IN VEN
               IF VEN-NUM-IVEN IN VEN > OPC-NUM-VCOR IN OPC
                   SET VEN-STAT-TVX TO TRUE
                   MOVE SPACES   TO FIO-AKEY
                   MOVE WCC-C22 TO FIO-STAT
                   GO TO FIN-COL-FIO-BEN
               ELSE
                   NEXT SENTENCE
           ELSE
               NEXT SENTENCE.

           IF FIO-CMND = FIO-GET-NLS AND
              VEN-NUM-IVEN IN VEN = ZEROES
               ADD IS2-ISC-1                TO QUE-NITM
               MOVE IS2-ISC-LEN-TSISC       TO QUE-LITM
               MOVE IS2-DPS-TS-VEN          TO QUE-COLA
               MOVE QUE-GET             TO QUE-CMND
               PERFORM GNS-PRO-QUE
               MOVE QUE-ITEM TO VEN
               SET VEN-STAT-OKS TO TRUE
               MOVE WCC-C00 TO FIO-STAT
               MOVE SPACES  TO FIO-AKEY
               GO TO FIN-COL-FIO-BEN.

           IF VEN-NUM-IVEN IN VEN = ZEROES
               ADD IS2-ISC-1 TO QUE-NITM.

           MOVE IS2-ISC-LEN-TSISC       TO QUE-LITM.
           MOVE IS2-DPS-TS-VEN          TO QUE-COLA.
           MOVE QUE-GET             TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               SET VEN-STAT-TVX TO TRUE
               MOVE SPACES   TO FIO-AKEY
               MOVE WCC-C22 TO FIO-STAT
               GO TO FIN-COL-FIO-BEN.

           MOVE QUE-ITEM TO VEN.
           SET VEN-STAT-OKS TO TRUE.
           MOVE SPACES   TO FIO-AKEY.
           MOVE WCC-C00 TO FIO-STAT.

       FIN-COL-FIO-BEN.
           EXIT.
      *---------------------------------------------------------------
      *AFRI-FIN 25-OCT-2016 OPTIMIZACION K130
      *AFRI-FIN 11-SEP-2014 SELECCION DE SEGUROS
      *>>>>
      *AFRI-INI 13-ENE-2018 COMISION NORMALIZA
       COPY COLBKGCN.
      *AFRI-FIN 13-ENE-2018 COMISION NORMALIZA
      *>>>>
