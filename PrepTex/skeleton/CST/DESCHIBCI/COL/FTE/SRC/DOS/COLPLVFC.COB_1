       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPLVFC.
       AUTHOR.          CONSIST (JGM).
       DATE-WRITTEN.    26-Jul-99 12:04 PM.

      * Programa Listador de Reporte VFC sin Sort.
      *
      * V 1.1.2
      *


       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.

            C01 IS SALTO
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT RPTVFC       ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTVFC       ASSIGN TO        UT-S-RPTVFC.
           SELECT RPTVFC       ASSIGN TO        UT-S-RPTVFC.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       FD  RPTVFC LABEL RECORDS OMITTED
           BLOCK CONTAINS 0 RECORDS
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-VFC     PIC X(132).

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VFC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY COLBRVFC.
       COPY COLRRVFC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSWGGRC.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY COLRWVFC.
       COPY COLRNVFC.
       COPY COLROVFC.
       COPY GNSWGSYS.
       01  PGM-HRSR-VFC   VALUE 'N'       PIC X(01).
           88 HAY-REGISTROS-EN-SORT-VFC  VALUE 'S'.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       COPY TABBRTIO.
       COPY GNSWGHOY.
       COPY GNSWGFEC.
       COPY GNSWGCPT.
       COPY TABBRUSR.
       01  WSS-VARI.
           03  WSS-FEC-FHST.
               05  WSS-NUM-SHST                PIC 9(02).
               05  WSS-NUM-AHST                PIC 9(02).
               05  WSS-NUM-MHST                PIC 9(02).
               05  WSS-NUM-DHST                PIC 9(02).

           03  WSS-FEC-FINI.
               05  WSS-NUM-SINI                PIC 9(02).
               05  WSS-NUM-AINI                PIC 9(02).
               05  WSS-NUM-MINI                PIC 9(02).
               05  WSS-NUM-DINI                PIC 9(02).

           03  WSS-FEC-FTER.
               05  WSS-NUM-STER                PIC 9(02).
               05  WSS-NUM-ATER                PIC 9(02).
               05  WSS-NUM-MTER                PIC 9(02).
               05  WSS-NUM-DTER                PIC 9(02).

           03  WSS-NUM-NDIA                    PIC 9(02).


           03 WSS-BANCA.
              05  WSS-IND-TIPO                     PIC X(01).
                  88 BANCA-PERSONAS   VALUE 'P' 'N' ' '.
              05  WSS-IND-BANCA                    PIC X(02).
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
      *>>>>

      * AQUI EXISTIA LABEL RF INI
      * AQUI EXISTIA LABEL RF FIN
       COPY COLRTVFC.

       PROCEDURE DIVISION.
      *==================

      * AQUI EXISTIA LABEL FIN_DEC INI
      * AQUI EXISTIA LABEL FIN_DEC FIN

       MAIN SECTION.
      *------------
       INI-MAIN.
      *    MOVE SYS-MXFL TO SYS-CMND.
      *    PERFORM GNS-PRO-SYS.
       COPY GNSBGEDB.
      *    MOVE 'COL' TO RPT-SIST.
           MOVE 'COLPLVFC' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *<<<< INI
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'TAB' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR EN APERTURA ARCHIVO TAB'
               PERFORM GNS-PRO-ABT.

      *DPM fin  14-FEB-1996
      *>>>>
       INI-INP-SRT.
      *     MOVE 'COLPLVFC' TO RPT-NPGM.
           PERFORM CAL-HDR.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-VFC.
       FST-INP-SRT.
      *<<<< INI_FST_INP
      *
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-VFC.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR EN LEE ENCABEZADO VFC'
               PERFORM GNS-PRO-ABT.

      * Traspaso la Fecha "Desde" al Reporte
           MOVE VFC-NUM-DINI IN VFC TO WSS-NUM-DDES IN WSS-VFC.
           MOVE VFC-NUM-MINI IN VFC TO WSS-NUM-MDES IN WSS-VFC.
           MOVE VFC-NUM-SINI IN VFC TO WSS-NUM-SDES IN WSS-VFC.
           MOVE VFC-NUM-AINI IN VFC TO WSS-NUM-ADES IN WSS-VFC.

      * Traspaso la Fecha "Hasta" al Reporte
           MOVE VFC-NUM-DTER IN VFC TO WSS-NUM-DHAS IN WSS-VFC.
           MOVE VFC-NUM-MTER IN VFC TO WSS-NUM-MHAS IN WSS-VFC.
           MOVE VFC-NUM-STER IN VFC TO WSS-NUM-SHAS IN WSS-VFC.
           MOVE VFC-NUM-ATER IN VFC TO WSS-NUM-AHAS IN WSS-VFC.
      *
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-VFC.
           IF NOT FIO-STAT-OKS
                OPEN OUTPUT RPTVFC
                GO TO FIN-MAIN.
       COPY COLRMVFC.
           GO TO INI-OUT-SRT.
      *>>>>
       INI-OUT-SRT.
           OPEN OUTPUT RPTVFC.
           PERFORM INITIATE-RPTVFC.
           MOVE SRT TO SRT-OLD-VFC.
           MOVE SRT TO SRT-CUR-VFC.
      *    PERFORM VFC-FST-PRO-CTL.
       LUP-MAIN.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
      *<<<< LUP_INP
      *>>>>
       MOV-INP-SRT.
       COPY COLRMVFC.
       LUP-OUT-SRT.
      *<<<< LUP_OUT
      **************************************************************
           MOVE 'SGC'                   TO FIO-SIST.
           MOVE 'BAN'                   TO TAB-COD-TTAB.
           MOVE VFC-COD-TBAN IN VFC     TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TBAN IN WSS-VFC
           ELSE
               MOVE SPACES               TO WSS-GLS-TBAN IN WSS-VFC.
      **************************************************************
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'VLR'               TO TAB-COD-TTAB IN TAB.
           MOVE VFC-COD-VCOC IN VFC TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS NOT = SPACES
              MOVE MSG-GLS-DCOR TO WSS-GLS-MONE IN WSS-VFC
           ELSE
              MOVE TAB-GLS-ABRV TO WSS-GLS-MONE IN WSS-VFC.
      **************************************************************
      * Boleta Garantia
           IF VFC-CTO-OPEC IN VFC  NOT = 'B'
               SUBTRACT  VFC-VAL-SCAP IN VFC FROM VFC-VAL-SFIN IN VFC
                 GIVING  WSS-VAL-INTV IN WSS-VFC
           ELSE
               MOVE VFC-VAL-SFIN IN VFC TO WSS-VAL-INTV IN WSS-VFC.
      **************************************************************
           IF VFC-IND-MORA IN VFC = 'S'
               MOVE ' SI' TO WSS-IND-MOR IN WSS-VFC
           ELSE
               MOVE ' NO' TO WSS-IND-MOR IN WSS-VFC.
      **************************************************************
           MOVE VFC-COD-RMOC IN VFC TO USR-COD-USER IN USR.
           PERFORM BUS-USR.
           MOVE USR-GLS-DESC IN USR TO WSS-GLS-RMOC IN WSS-VFC.
      *>>>>
           PERFORM GENERATE-DL-VFC.
       NXT-INP-SRT.
       NXT-OUT-SRT.
           MOVE SRT TO SRT-OLD-VFC.
       RET-OUT-SRT.
      *<<<< INI_NXT_INP
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-VFC.
           GO TO LUP-MAIN.
       FIN-MAIN.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-VFC.
       FIN-OUT-SRT.
           IF HAY-REGISTROS-EN-SORT-VFC
                PERFORM TERMINATE-RPTVFC.
           CLOSE RPTVFC.
           IF PGM-STAT-SRT-MAL
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       COPY COLBFVFC.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGIRH.
       COPY COLREVFC.
      *    26-JUL-99 11:58 AM     ,PAI= ,CLI= ,SOP=MVS  V 1.1.3
       D-CF-VFC-VFC-COD-TBAN SECTION.
       INI-CF-VFC-VFC-COD-TBAN.
           MOVE 'SGC'                   TO FIO-SIST.
           MOVE 'BAN'                   TO TAB-COD-TTAB.
           MOVE VFC-COD-TBAN IN VFC     TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TBAN IN WSS-VFC
           ELSE
               MOVE SPACES               TO WSS-GLS-TBAN IN WSS-VFC.
       FIN-CF-VFC-VFC-COD-TBAN.
           EXIT.
       D-CF-VFC-VFC-COD-RMOC SECTION.
       INI-CF-VFC-VFC-COD-RMOC.
           MOVE VFC-COD-RMOC IN VFC TO USR-COD-USER IN USR.
           PERFORM BUS-USR.
           MOVE USR-GLS-DESC IN USR TO WSS-GLS-RMOC IN WSS-VFC.
       FIN-CF-VFC-VFC-COD-RMOC.
           EXIT.
       D-PH-VFC SECTION.
       INI-PH-VFC.
       FIN-PH-VFC.
           EXIT.
       D-DL-VFC SECTION.
       INI-DL-VFC.
       FIN-DL-VFC.
           EXIT.
       COPY GNSBGABT.

      *<<<< EOF
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBPFEC.
       COPY GNSBBMSG.
       COPY GNSBGCPT.
       COPY TABBBUSR.
       COPY TABBFUSR.
       COPY GNSBBTAB.
      *>>>>
