       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPLTEC.
       AUTHOR.          BEE-TEAM.
       DATE-WRITTEN.    08-Jun-98 11:44 AM.

      * Programa Listador de Reporte TEC con Sort.
      *
      * V 1.1.2
      *
      *<<<< CMT_ID
      *>>>>

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            C01 IS SALTO
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
      *DOS SELECT RPTTEC         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTTEC         ASSIGN TO        UT-S-RPTTEC.
           SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT RPTTEC         ASSIGN TO        UT-S-RPTTEC.
      *<<<< IOS
      *DOS SELECT RPTTE2         ASSIGN TO SYS012-UR-1403-S.
      *MVS SELECT RPTTE2         ASSIGN TO        UT-S-RPTTE2.
           SELECT RPTTE2         ASSIGN TO        UT-S-RPTTE2.
      *>>>>

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY COLRRTEC.
      *<<<< RR
      *>>>>
       FD  RPTTEC LABEL RECORDS OMITTED
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-TEC     PIC X(132).
      *<<<< FD_RPT
      *>>>>
      *<<<< FLS
       FD  RPTTE2 LABEL RECORDS OMITTED
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-TE2     PIC X(132).
      *>>>>

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LMC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY COLBRLMC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSWGGRC.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY COLRWTEC.
      *<<<< RW
       COPY COLRWTE2.
      *>>>>
       COPY COLRNTEC.
      *<<<< RN
       COPY COLRNTE2.
      *>>>>
       COPY COLROTEC.
      *<<<< RO
       COPY COLROTE2.
      *>>>>
       COPY GNSWGSYS.
       01  PGM-HRSR-TEC   VALUE 'N'       PIC X(01).
           88 HAY-REGISTROS-EN-SORT-TEC  VALUE 'S'.

       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       COPY TABBRUSR.
       COPY COLBRAUX.
       COPY COLBRRDC.
       COPY TABBROFI.
       COPY SGCBRDBC.
       COPY COLBRDPC.
       COPY COLBROPC.
       COPY COLBRDLC.
       COPY GNSBRCIC.
       COPY TABBRCAM.
       COPY GNSWGCIC.
       COPY GNSWGHOY.
       COPY GNSWGFEC.
       COPY GNSWGCPT.
       COPY GNSWCVRF.
       COPY GNSWVVRF.

       01  PGM-HRSR-TE2 VALUE 'N' PIC X(01).
           88 HAY-REGISTROS-EN-SORT-TE2 VALUE 'S'.

       01  WSS-VARI.
      * Fecha de Proceso (Primer parametro del programa)
           03 WSS-FEC-PRO.
              05 WSS-NUM-DPRO          PIC 9(02) VALUE 0.
              05 WSS-NUM-MPRO          PIC 9(02) VALUE 0.
              05 WSS-NUM-SPRO          PIC 9(02) VALUE 0.
              05 WSS-NUM-APRO          PIC 9(02) VALUE 0.

      * Fecha del Periodo a procesar
           03 WSS-FEC-TRAB.
              05 WSS-FEC-TRAB-SAM.
                 07 WSS-NUM-SATRAB     PIC 9(04) VALUE 0.
                 07 WSS-NUM-SATRAB-R   REDEFINES WSS-NUM-SATRAB.
                    09 WSS-NUM-STRAB   PIC 9(02).
                    09 WSS-NUM-ATRAB   PIC 9(02).
                 07 WSS-NUM-MTRAB      PIC 9(02) VALUE 0.
                 07 WSS-NUM-DTRAB      PIC 9(02) VALUE 0.

      * Fecha Real del Movimiento.
           03 WSS-FEC-FREA.
              05 WSS-FEC-REA-SAM.
                 07 WSS-NUM-SAMREA    PIC 9(06) VALUE 0.
                 07 WSS-NUM-SAMREA-R  REDEFINES WSS-NUM-SAMREA.
                    09 WSS-NUM-SREA   PIC 9(02).
                    09 WSS-NUM-AREA   PIC 9(02).
                    09 WSS-NUM-MREA   PIC 9(02).
                 07 WSS-NUM-DREA      PIC 9(02) VALUE 0.

      * Fecha Contable del Movimiento.
           03 WSS-FEC-FCTB.
              05 WSS-FEC-CTB-SAM.
                 07 WSS-NUM-SAMCTB    PIC 9(06) VALUE 0.
                 07 WSS-NUM-SAMCTB-R  REDEFINES WSS-NUM-SAMCTB.
                    09 WSS-NUM-SCTB   PIC 9(02).
                    09 WSS-NUM-ACTB   PIC 9(02).
                    09 WSS-NUM-MCTB   PIC 9(02).
                 07 WSS-NUM-DCTB      PIC 9(02) VALUE 0.

           03 WSS-FEC-FLMC.
              05 WSS-NUM-6LMC          PIC X(06).
              05 WSS-NUM-2LM           PIC 9(02).

           03 WSS-TODO-USO             PIC 9(06) VALUE 0.

           03 WSS-COD-OFIC             PIC X(03) VALUE SPACES.
           03 WSS-COD-OFIC2            PIC X(03) VALUE SPACES.

           03 WSS-TIP-EMIS             PIC X(01).
              88 OK-TIP-EMIS       VALUE 'B' 'L'.
              88 EMIS-BORRADOR     VALUE 'B'.
              88 EMIS-LEGAL        VALUE 'L'.

           03 WSS-COD-OFOC                        PIC X(03).
           03 WSS-CIC-CCSB                        PIC X(12).

           03 WSS-FOL-FINA     VALUE ZEROES       PIC 9(06).
           03 WSS-FOL-TERM     VALUE ZEROES       PIC 9(06).

           03 WSS-PORCE-TRAN                      PIC 9(03)V999.
           03 WSS-GLS-EXTRA                       PIC X(80).
           03 WSS-PORCE-TRA2                      PIC 9(03)V9.
           03 WSS-PORCENTAJE                      PIC ZZ9,999.
           03 WSS-QUIEN       VALUE 'R'           PIC X(01).
           03 WSS-IND-CTA     VALUE ZEROES        PIC 9(03).
           03 WSS-TOP-CTA     VALUE ZEROES        PIC 9(03).
           03 WSS-ENCUENTRA   VALUE 'N'           PIC X(01).
           03 WSS-IND-ERRO                        PIC 9(01).
           03 WSS-VAL-PESOS                       PIC 9(13).
      * RRM-INI 04-NOV-1998
           03 WSS-VAL-ENUFS   VALUE ZEROES        PIC 9(11)V9(04).
      * RRM-FIN 04-NOV-1998
           03 WSS-COD-MNAC     VALUE '0999  '     PIC X(06).
           03 WSS-TOT-BANCO    OCCURS 100.
              05 WSS-COD-CTA                      PIC X(12).
              05 WSS-GLS-CTA                      PIC X(66).
              05 WSS-BAS-BANC                     PIC 9(13).
              05 WSS-SGV-BANC                     PIC 9(13).
           03 WSS-IND-1VEZ    VALUE 'S'           PIC X(01).
      * RRM-INI 09-OCT-1998 FECHA AUXILIAR.
           03 WSS-FEC-AUXI.
              05 WSS-NUM-DAUX  VALUE ZEROES       PIC 9(02).
              05 WSS-NUM-MAUX  VALUE ZEROES       PIC 9(02).
              05 WSS-NUM-SAUX  VALUE ZEROES       PIC 9(02).
              05 WSS-NUM-AAUX  VALUE ZEROES       PIC 9(02).
      * RRM-FIN 09-OCT-1998
      *>>>>
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DPC-REQA==.
      *>>>>

      * AQUI EXISTIA LABEL RF INI
      *<<<< RF
      *>>>>
      * AQUI EXISTIA LABEL RF FIN
       COPY COLRTTEC.
      *<<<< RT
       COPY COLRTTE2.
      *>>>>

       PROCEDURE DIVISION.
      *==================

      * AQUI EXISTIA LABEL FIN_DEC INI
      *<<<< FIN_DEC
      *>>>>
      * AQUI EXISTIA LABEL FIN_DEC FIN

       MAIN SECTION.
      *------------
       INI-MAIN.
      *<<<< MAX_FILE
      *>>>>
      *    MOVE SYS-MXFL TO SYS-CMND.
      *    PERFORM GNS-PRO-SYS.
       COPY GNSBGEDB.
      *     MOVE 'COL' TO RPT-SIST.
           MOVE 'COLPLTEC' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *<<<< INI
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.
           DISPLAY '----------------------------'.

      *Captura Fecha de Proceso
           DISPLAY 'FECHA DE INICIO ( DDMMAAAA ) : '.
           ACCEPT  WSS-FEC-PRO IN WSS-VARI.
           DISPLAY WSS-FEC-PRO IN WSS-VARI.

      *Captura Codigo de Oficina
           DISPLAY 'OFICINA : '.
           ACCEPT  WSS-COD-OFIC IN WSS-VARI.
           DISPLAY WSS-COD-OFIC IN WSS-VARI.

      *Captura Tipo de Emision
           DISPLAY 'EMISION : '.
           ACCEPT  WSS-TIP-EMIS IN WSS-VARI.
           DISPLAY WSS-TIP-EMIS IN WSS-VARI.

           DISPLAY 'FIN    CAPTURA    DE PARAMETROS'.
           DISPLAY '*******************************'.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

      *VAL-FEC Valida Fecha de Proceso
           DISPLAY WSS-FEC-PRO IN WSS-VARI.
           MOVE WSS-FEC-PRO    IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-END.

      *VAL-OFI Valida codigo de Oficina en TABLAS
           DISPLAY WSS-COD-OFIC.
           IF WSS-COD-OFIC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-OFIC IN WSS-VARI.
           IF WSS-COD-OFIC IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-OFIC IN WSS-VARI
               MOVE WSS-COD-OFIC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   PERFORM GNS-PRO-END.

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.

      * Asigno a variable Titulo especial para movimientos con efecto
      * Retroactivo.
           MOVE  'OPERACIONES CURSADAS CON FECHA DEL MES ANTERIOR' TO
                 WSS-TIT-ANEX.

      *RRM   DISPLAY 'WSS-FEC-PRO: ' WSS-FEC-PRO.

           MOVE WSS-NUM-SPRO TO WSS-NUM-STRAB.
           MOVE WSS-NUM-APRO TO WSS-NUM-ATRAB.
           MOVE WSS-NUM-MPRO TO WSS-NUM-MTRAB.
           MOVE WSS-NUM-DPRO TO WSS-NUM-DTRAB.

      * Calculo de dias de inicio y termino del periodo
           IF WSS-NUM-MPRO > 1
              SUBTRACT 1 FROM WSS-NUM-MPRO GIVING WSS-NUM-MTRAB
           ELSE
              MOVE 12 TO WSS-NUM-MTRAB
              SUBTRACT 1 FROM WSS-NUM-SATRAB.

           MOVE '01' TO WSS-NUM-DINI IN WSS-TEC
                        WSS-NUM-DINI IN WSS-TE2.
      * RRM-INI 09-OCT-1998
      *   MOVE FEC-DMES(WSS-NUM-MTRAB)   TO WSS-NUM-DTER IN WSS-TEC
      *                                     WSS-NUM-DTER IN WSS-TE2.
           MOVE WSS-FEC-PRO IN WSS-VARI TO WSS-FEC-AUXI IN WSS-VARI.
           MOVE   1          TO WSS-NUM-DAUX IN WSS-VARI.
           MOVE FEC-RST-DIA  TO FEC-CMND.
           MOVE WSS-FEC-AUXI TO FEC-FECH.
           MOVE   1          TO FEC-NDIA.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           PERFORM CAL-FEC.
           MOVE FEC-FECH TO WSS-FEC-AUXI.
           MOVE WSS-NUM-DAUX IN WSS-VARI TO WSS-NUM-DTER IN WSS-TEC
                                            WSS-NUM-DTER IN WSS-TE2.
      * RRM-FIN09-OCT-1998
           MOVE WSS-NUM-MTRAB IN WSS-VARI TO WSS-NUM-MINI IN WSS-TEC
                                             WSS-NUM-MINI IN WSS-TE2.
           MOVE WSS-NUM-MTRAB IN WSS-VARI TO WSS-NUM-MTER IN WSS-TEC
                                             WSS-NUM-MTER IN WSS-TE2.
           MOVE WSS-NUM-ATRAB IN WSS-VARI TO WSS-NUM-AINI IN WSS-TEC
                                             WSS-NUM-AINI IN WSS-TE2.
           MOVE WSS-NUM-ATRAB IN WSS-VARI TO WSS-NUM-ATER IN WSS-TEC
                                             WSS-NUM-ATER IN WSS-TE2.
           MOVE WSS-NUM-STRAB IN WSS-VARI TO WSS-NUM-SINI IN WSS-TEC
                                             WSS-NUM-SINI IN WSS-TE2.
           MOVE WSS-NUM-STRAB IN WSS-VARI TO WSS-NUM-STER IN WSS-TEC
                                             WSS-NUM-STER IN WSS-TE2.

           DISPLAY 'FECHA INICIO'.
           DISPLAY WSS-NUM-DINI IN WSS-TEC
                   WSS-NUM-MINI IN WSS-TEC
                   WSS-NUM-SINI IN WSS-TEC
                   WSS-NUM-AINI IN WSS-TEC.
           DISPLAY 'FECHA TERMINO'.
           DISPLAY WSS-NUM-DTER IN WSS-TEC
                   WSS-NUM-MTER IN WSS-TEC
                   WSS-NUM-STER IN WSS-TEC
                   WSS-NUM-AINI IN WSS-TEC.
      *>>>>
           SORT GNSSRT
       COPY COLRSTEC.
      *<<<< RS
      *>>>>
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
      *<<<< FIN
      *>>>>
           IF PGM-STAT-SRT-MAL OR SORT-RETURN > 0
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<< INI_INP
      *>>>>
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-LMC.
       FST-INP-SRT.
      *<<<< INI_FST_INP
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-LMC.
      *<<<< FIN_FST_INP
      *>>>>
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
           ADD 1 TO WSS-TODO-USO.
      *RRM   DISPLAY WSS-TODO-USO.
      * Procesa segun Oficina ( * = Todas )
           IF WSS-COD-OFIC IN WSS-VARI = '*'
              NEXT SENTENCE
           ELSE
              IF LMC-COD-OFOC IN LMC NOT = WSS-COD-OFIC IN WSS-VARI
                 GO TO NXT-INP-SRT.

      * Verifico que la fecha Real del movimiento  se encuentre dentro
      * del periodo a procesar.
      *RRM:(29-APR-1998) Se debe filtrar por la fecha Contable y no por
      *    la fecha Real.

      *RRM IF LMC-NUM-MREA IN LMC NOT = WSS-NUM-MTRAB
           IF LMC-NUM-MCTB IN LMC NOT = WSS-NUM-MTRAB
              GO TO NXT-INP-SRT
           ELSE
      *RRM IF LMC-NUM-AREA IN LMC NOT = WSS-NUM-ATRAB
           IF LMC-NUM-ACTB IN LMC NOT = WSS-NUM-ATRAB
                 GO TO NXT-INP-SRT.

      * Verifico qur el codigo del movimiento sea CUR
           IF LMC-COD-MVTO IN LMC NOT = 'CUR'
              GO TO NXT-INP-SRT.

      * Verifico que el tipo de cuenta contable sea IMP
           IF LMC-MSC-TCCT IN LMC NOT = 'IMP'
              GO TO NXT-INP-SRT.

      * Se crea un campo adicional (de tipo numerico) en el archivo SORT
      * para ser usado como llave primaria de ordenamiento y lograr que
      * los movimientos con efecto retroactivo sean emitidos al princi-
      * pio del listado.

      * Verifico que la fecha contable del movimiento se encuentre dentr
      * del periodo a procesar, de no ser asi el movimiento debe ser pro
      * cesado con efecto retroactivo, por lo que debe ser listado en el
      * Anexo del reporte (haciendo a SRT-NUM-TIPO = 0).

      *RRM  DISPLAY 'PASO' WSS-TODO-USO.
           MOVE LMC-FEC-FCTB IN LMC TO WSS-FEC-FCTB IN WSS-VARI.
           MOVE LMC-FEC-FREA IN LMC TO WSS-FEC-FREA IN WSS-VARI.

      *RRM    DISPLAY '  '.
      *RRM    DISPLAY 'FECHA CTBLE (SSAAMM): ' WSS-NUM-SAMCTB IN WSS-VAR
      *RRM    DISPLAY 'FECHA REAL  (SSAAMM): ' WSS-NUM-SAMREA IN WSS-VAR

           IF WSS-NUM-SAMCTB IN WSS-VARI > WSS-NUM-SAMREA IN WSS-VARI
                MOVE ZERO TO SRT-NUM-TIPO IN SRT
           ELSE
                MOVE 1 TO SRT-NUM-TIPO IN SRT.
      *>>>>
       MOV-INP-SRT.
       COPY COLRMTEC.
      *<<<< RM
      *>>>>
           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-LMC.
      *<<<< FIN_NXT_INP
      *>>>>
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
      *<<<< FIN_INP
      *>>>>
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-LMC.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
      *<<<< INI_OUT
           OPEN OUTPUT RPTTE2.
           PERFORM INITIATE-RPTTE2.
      *RRM-INI 20-JAN-1999
           IF EMIS-LEGAL
              MOVE FIO-UPD TO FIO-CMND
           ELSE
              MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-DPC.
      *RRM-INI 20-JAN-1999
      *>>>>
           OPEN OUTPUT RPTTEC.
      *     MOVE 'COLPLTEC' TO RPT-NPGM.
           PERFORM CAL-HDR.
           PERFORM INITIATE-RPTTEC.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           MOVE SRT TO SRT-OLD-TEC.
           MOVE SRT TO SRT-CUR-TEC.
      *<<<< FST_OUT
           PERFORM TE2-FST-PRO-CTL.
      *>>>>
           PERFORM TEC-FST-PRO-CTL.
       LUP-OUT-SRT.
      *<<<< LUP_OUT
            PERFORM BUSCA-DEUDOR.
      * Se mueve el RUT del deudor
            MOVE DBC-NUM-ICLI IN DBC TO WSS-NUM-ICLI IN WSS-TEC.
            MOVE DBC-VRF-ICLI IN DBC TO WSS-VRF-ICLI IN WSS-TEC.
            MOVE DBC-IND-ICLI IN DBC TO WSS-IND-ICLI IN WSS-TEC.
            MOVE DBC-GLS-ICLI IN DBC TO WSS-GLS-ICLI IN WSS-TEC.

      *RRM-INI 29-APR-1998 Era problema de archivo.
      **RRM-INI 03/04/1998
      *      IF LMC-CAI-IOPC IN SRT = LMC-CAI-IOPC-OLD IN SRT-OLD-TEC AN
      *         LMC-IIC-IOPC IN SRT = LMC-IIC-IOPC-OLD IN SRT-OLD-TEC AN
      *         WSS-IND-1VEZ IN WSS-VARI NOT = 'S'
      *           GO TO NXT-OUT-SRT
      *      ELSE
      *         MOVE 'N' TO WSS-IND-1VEZ.
      **RRM-FIN 03/04/1998
      *RRM-FIN 29-APR-1998

            PERFORM BUSCA-OPC.
            PERFORM BUSCA-DLC.
            PERFORM UBICA-CTA-MATRIZ.
            IF WSS-ENCUENTRA = 'S'
             ADD WSS-VAL-PESOS IN WSS-VARI TO WSS-BAS-BANC(WSS-IND-CTA)
             ADD LMC-SGV-ICTB  IN SRT      TO WSS-SGV-BANC(WSS-IND-CTA).

      *RRM-INI 29-APR-1998. Esta instruccion se debe hacer en el PH_
      *     IF SRT-NUM-TIPO IN SRT > 0
      *        MOVE SPACES TO WSS-TIT-ANEX.
      *RRM-FIN 29-APR-1998
      *>>>>
       GEN-OUT-SRT.
           PERFORM GENERATE-DL-TEC.
      *<<<< FIN_GEN_OUT
      *>>>>
       NXT-OUT-SRT.
           MOVE SRT TO SRT-OLD-TEC.
       RET-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
      *<<<< FIN_OUT
           MOVE 1 TO WSS-IND-CTA.
           PERFORM SACA-CUENTAS UNTIL (WSS-IND-CTA > WSS-TOP-CTA).
           GO TO TERMINA-REPORTE.

       SACA-CUENTAS.
           MOVE 'M' TO WSS-QUIEN.
           PERFORM BUSCA-GLS-CTA.
           MOVE WSS-COD-CTA(WSS-IND-CTA)  TO WSS-COD-CTBL  IN WSS-TE2.
           MOVE WSS-GLS-CTA(WSS-IND-CTA)  TO WSS-DESC-CTBL IN WSS-TE2.
           MOVE WSS-BAS-BANC(WSS-IND-CTA) TO WSS-BAS-CTBL  IN WSS-TE2.
           MOVE WSS-SGV-BANC(WSS-IND-CTA) TO WSS-SGV-CTBL  IN WSS-TE2.
           ADD 1 TO WSS-IND-CTA.
           PERFORM PRO-DL-TE2.

       TERMINA-REPORTE.
           PERFORM TERMINATE-RPTTE2.
           CLOSE RPTTE2.
      *>>>>
           IF HAY-REGISTROS-EN-SORT-TEC
                PERFORM TERMINATE-RPTTEC.
      *<<<< FIN_TMT
      *>>>>
           CLOSE RPTTEC.
       EXT-OUT-SRT.
           EXIT.
       COPY COLBFLMC.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGIRH.
       COPY COLRETEC.
      *    29-APR-98 11:28 AM     ,PAI= ,CLI= ,SOP=MVS  V 1.1.3
       D-CF-TEC-LMC-CIC-CCSB SECTION.
       INI-CF-TEC-LMC-CIC-CCSB.
       FIN-CF-TEC-LMC-CIC-CCSB.
           EXIT.
       D-CF-TEC-LMC-COD-OFOC SECTION.
       INI-CF-TEC-LMC-COD-OFOC.
      *RRM-INI 20-JAN-1999
           MOVE LMC-COD-OFOC IN SRT TO WSS-COD-OFOC IN WSS-VARI.
           PERFORM GRABAR-FOLIOS.
      *RRM-FIN 20-JAN-1999
       FIN-CF-TEC-LMC-COD-OFOC.
           EXIT.
       D-CF-TEC-SRT-NUM-TIPO SECTION.
       INI-CF-TEC-SRT-NUM-TIPO.
       FIN-CF-TEC-SRT-NUM-TIPO.
           EXIT.
       D-PH-TEC SECTION.
       INI-PH-TEC.
      *<<<< PH_TEC
      * RRM-INI 29-APR-1998
      * Verifica si asigna Titulo o no.
           IF SRT-NUM-TIPO IN SRT > 0
               MOVE SPACES TO WSS-TIT-ANEX.
      * RRM-FIN 29-APR-1998

      * Busco Glosa Cta.Contable
           IF LMC-CIC-CCSB IN SRT > SPACES
            PERFORM BUSCA-GLS-CTA.

      * Mediante BUS-OFI Obtiene Nombre Oficina de Tabla OFI
           IF LMC-COD-OFOC IN SRT > SPACES
               MOVE LMC-COD-OFOC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI.

      * Verifico cambio de Oficina para leer Folio
           IF WSS-COD-OFIC2 IN WSS-VARI NOT = LMC-COD-OFOC IN SRT
              PERFORM BUSCA-FOLIO
              MOVE LMC-COD-OFOC IN SRT TO WSS-COD-OFIC2 IN WSS-VARI.

      * Incrementa Nro. de Folio
           ADD 1 TO WSS-NUM-FOLO IN WSS-TEC.

      * Mediante BUS-TAB Busca Tipo de Moneda de Tabla VLR
           IF LMC-COD-VCOC IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE LMC-COD-VCOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-VCOC IN WSS-TEC
           ELSE
               MOVE SPACES TO WSS-GLS-VCOC IN WSS-TEC.
      *>>>>
       FIN-PH-TEC.
           EXIT.
       D-DL-TEC SECTION.
       INI-DL-TEC.
      *<<<< DL_TEC
      * RRM-INI 31-DEC-1998
      * OBTENGO ULTIMO VENCIMIENTO
           MOVE LMC-CAI-IOPC IN SRT TO DLC-CAI-IOPC IN DLC.
           MOVE LMC-IIC-IOPC IN SRT TO DLC-IIC-IOPC IN DLC.
           MOVE LMC-NUM-IDLC IN SRT TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
              DISPLAY 'PROCESO ABORTADO, ERROR EN ARCHIVO DLC'
              DISPLAY  LMC-CIC-IOPC ' NO SE ENCUENTRA EN DLC'
              PERFORM GNS-PRO-ABT.
           MOVE DLC-NUM-DMAV IN DLC TO WSS-NUM-DMAV IN WSS-TEC.
           MOVE DLC-NUM-MMAV IN DLC TO WSS-NUM-MMAV IN WSS-TEC.
           MOVE DLC-NUM-SMAV IN DLC TO WSS-NUM-SMAV IN WSS-TEC.
           MOVE DLC-NUM-AMAV IN DLC TO WSS-NUM-AMAV IN WSS-TEC.
      * RRM-FIN  31-DEC-1998
      *>>>>
       FIN-DL-TEC.
           EXIT.
       COPY GNSBGABT.

      *<<<< EOF
       BUSCA-DEUDOR SECTION.
      **********************
       INI-BUSCA-GLS-DEUDOR.
           MOVE LMC-IDC-ICLI IN SRT TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
              MOVE 'ERROR NO EXISTE DEUDOR' TO WSS-GLS-NOMC IN WSS-TEC
           ELSE
              MOVE DBC-GLS-NOMC IN DBC      TO CPT-STRN IN CPT-VARI
              PERFORM CPT-BLKS
              MOVE CPT-STRN     IN CPT-VARI TO WSS-GLS-NOMC IN WSS-TEC.
       FIN-BUSCA-GLS-DEUDOR.
           EXIT.

      ******************************************************************
       BUSCA-DLC SECTION.
      *******************
       INI-BUSCA-DLC.
           MOVE LMC-CAI-IOPC IN SRT TO DLC-CAI-IOPC IN DLC.
           MOVE LMC-IIC-IOPC IN SRT TO DLC-IIC-IOPC IN DLC.
           MOVE LMC-NUM-IDLC IN SRT TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
              DISPLAY 'PROCESO ABORTADO, ERROR EN ARCHIVO DLC'
              DISPLAY  LMC-CIC-IOPC ' NO SE ENCUENTRA EN DLC'
              PERFORM GNS-PRO-ABT
           ELSE
             IF DLC-MSC-TIMP IN DLC = 'I'
                MOVE '   I   ' TO WSS-NUM-PORCE IN WSS-TEC
             ELSE
              IF WSS-VAL-PESOS IN WSS-VARI > ZEROES
                DIVIDE LMC-SGV-ICTB IN SRT BY WSS-VAL-PESOS IN WSS-VARI
                       GIVING WSS-PORCE-TRAN IN WSS-VARI ROUNDED
                MULTIPLY WSS-PORCE-TRAN IN WSS-VARI BY 100
                         GIVING WSS-PORCE-TRA2
                MOVE WSS-PORCE-TRA2 TO WSS-PORCE-TRAN
                MOVE WSS-PORCE-TRAN TO WSS-PORCENTAJE
                MOVE WSS-PORCENTAJE TO WSS-NUM-PORCE IN WSS-TEC.

       FIN-BUSCA-DLC.
           EXIT.

      ******************************************************************
       BUSCA-OPC SECTION.
      *******************
       INI-BUSCA-OPC.
           MOVE LMC-CAI-IOPC IN SRT TO OPC-CAI-IOPC IN OPC.
           MOVE LMC-IIC-IOPC IN SRT TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
              DISPLAY 'PROCESO ABORTADO, ERROR EN ARCHIVO OPC'
              DISPLAY  LMC-CIC-IOPC ' NO SE ENCUENTRA EN OPC'
              PERFORM GNS-PRO-ABT
           ELSE
      * RRM-INI 04-NOV-1998
      *       MOVE OPC-VAL-CRED IN OPC TO WSS-VAL-PESOS IN WSS-VARI
      * RRM-FIN 04-NOV-1998
              IF OPC-COD-VCOC IN OPC NOT =  WSS-COD-MNAC IN WSS-VARI
      * RRM-INI 04-NOV-1998
      *          DISPLAY OPC-VAL-CRED IN OPC ' UFS'
                 MOVE OPC-VAL-CRED IN OPC TO WSS-VAL-ENUFS IN WSS-VARI
                 PERFORM CONVERTIR-A-MONNAC
      *          PERFORM CONVERTIR-A-MONNAC.
              ELSE
                 MOVE OPC-VAL-CRED IN OPC TO WSS-VAL-PESOS IN WSS-VARI.
      *          DISPLAY WSS-VAL-PESOS IN WSS-VARI ' $'.
      * RRM-FIN 04-NOV-1998
           MOVE WSS-VAL-PESOS IN WSS-VARI TO WSS-NUM-BIMP IN WSS-TEC.
       FIN-BUSCA-OPC.
           EXIT.

      ******************************************************************
       CONVERTIR-A-MONNAC SECTION.
      ****************************
      * Convierte a pesos los valores almacenados en moneda
      * reajustable.
       INI-CNV-MON-NAC.
            MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
            MOVE WSS-COD-MNAC IN WSS-VARI
                                     TO CAM-COD-VCAM IN CAM(2)
            MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(1)
                                        CAM-FEC-FCAM IN CAM(2)
            MOVE FIO-GET-KEY TO FIO-CMND
            PERFORM TAB-FIO-CAM
            IF NOT FIO-STAT-OKS OR
               CAM-IND-VIGE IN CAM NOT = 'S'
               DISPLAY ' '
               DISPLAY 'NO EXI VCAM : '
                        CAM-KEY-CAMB IN CAM  ' PARA : '
                        OPC-CIC-IOPC IN OPC
               MOVE 1 TO WSS-IND-ERRO IN WSS-VARI
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'CAMVCAMNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   OPC-CIC-IOPC IN OPC
               GO TO FIN-CNV-MON-NAC
            ELSE
                MOVE 0 TO WSS-IND-ERRO IN WSS-VARI
                MULTIPLY CAM-SGV-VCAM IN CAM
      * RRM-INI 04-NOV-1998
      *                  BY WSS-VAL-PESOS IN WSS-VARI
                         BY WSS-VAL-ENUFS IN WSS-VARI
      * RRM-FIN 04-NOV-1998
                            GIVING WSS-VAL-PESOS IN WSS-VARI ROUNDED.
      *          PERFORM PES-SCTV
      *          MOVE PES-SGV-ENTE IN PES-VARI
      *                               TO WSS-VALOR-PESOS IN WSS-VARI.
       FIN-CNV-MON-NAC.
           EXIT.

      ******************************************************************
       BUSCA-GLS-CTA SECTION.
      ***********************
       INI-BUSCA-GLS-CTA.
      * Mediante BUS-TAB Busca Cuenta Contable de Tabla PCC
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'PCC'               TO TAB-COD-TTAB IN TAB.
           IF WSS-QUIEN = 'M'
              MOVE WSS-COD-CTA(WSS-IND-CTA) TO TAB-COD-CTAB IN TAB
           ELSE
              MOVE LMC-CIC-CCSB IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF WSS-QUIEN = 'M'
              MOVE TAB-GLS-DESC TO WSS-GLS-CTA(WSS-IND-CTA)
           ELSE
              MOVE TAB-GLS-DESC TO WSS-GLS-CCSB  IN WSS-TEC.
       FIN-BUSCA-GLS-CTA.
           EXIT.

      ******************************************************************
       UBICA-CTA-MATRIZ SECTION.
      **************************
       INI-UBICA-CTA-MATRIZ.
           MOVE 1 TO WSS-IND-CTA.
           MOVE 'N' TO WSS-ENCUENTRA.
           IF WSS-TOP-CTA = 0
              PERFORM MUEVE-CAMPOS-CTA
              GO TO FIN-UBICA-CTA-MATRIZ.
           PERFORM RECORRE-MATRIZ UNTIL (WSS-IND-CTA > WSS-TOP-CTA
                                      OR WSS-ENCUENTRA = 'S').
           IF WSS-ENCUENTRA = 'N'
              PERFORM MUEVE-CAMPOS-CTA.
           GO TO FIN-UBICA-CTA-MATRIZ.

       RECORRE-MATRIZ.
           IF LMC-CIC-CCSB IN SRT = WSS-COD-CTA(WSS-IND-CTA)
              MOVE 'S' TO WSS-ENCUENTRA
           ELSE
              ADD 1 TO WSS-IND-CTA.

       MUEVE-CAMPOS-CTA.
           ADD 1 TO WSS-TOP-CTA
           MOVE LMC-CIC-CCSB  IN SRT      TO WSS-COD-CTA(WSS-TOP-CTA).
           DISPLAY WSS-GLS-EXTRA IN WSS-VARI.
           MOVE WSS-GLS-EXTRA IN WSS-VARI TO WSS-GLS-CTA(WSS-TOP-CTA).
           DISPLAY WSS-GLS-CTA(WSS-TOP-CTA).
           MOVE WSS-VAL-PESOS IN WSS-VARI TO WSS-BAS-BANC(WSS-TOP-CTA).
           MOVE LMC-SGV-ICTB  IN SRT      TO WSS-SGV-BANC(WSS-TOP-CTA).

       FIN-UBICA-CTA-MATRIZ.
           EXIT.

      ******************************************************************
       BUSCA-FOLIO SECTION.
      *********************
       INI-BUSCA-FOLIO.
           MOVE '5'                 TO DPC-TIP-REGI IN DPC.
           MOVE LMC-COD-OFOC IN SRT TO DPC-COD-OFI5 IN DPC.
           MOVE SPACES              TO DPC-FIL-FIL5 IN DPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DPC.
           IF FIO-STAT = '23'
              MOVE ZEROES TO DPC-NUM-FOI5 IN DPC
              MOVE ZEROES TO DPC-NUM-FOF5 IN DPC
              MOVE SPACES TO DPC-GLS-DIS5 IN DPC
              IF EMIS-LEGAL
                 MOVE FIO-PUT TO FIO-CMND
                 PERFORM COL-FIO-DPC.
      *
           MOVE DPC-NUM-FOF5 IN DPC TO WSS-NUM-FOLO IN WSS-TEC.
      *RRM-INI 11-FEB-1999
           MOVE DPC-NUM-FOF5 IN DPC TO WSS-FOL-FINA IN WSS-VARI.
      *RRM-FIN 11-FEB-1999
           ADD 1 TO WSS-FOL-FINA IN WSS-VARI.
       FIN-BUSCA-FOLIO.
           EXIT.

      ******************************************************************
       GRABAR-FOLIOS SECTION.
      ***********************
       INI-GRABAR-FOLIOS.
           MOVE '5'                      TO DPC-TIP-REGI IN DPC.
           MOVE WSS-COD-OFOC IN WSS-VARI TO DPC-COD-OFI5 IN DPC.
           MOVE SPACES                   TO DPC-FIL-FIL5 IN DPC.
      *RRM-INI 20-JAN-1999
           IF EMIS-LEGAL
              MOVE FIO-GET-KEY-UPD TO FIO-CMND
              PERFORM COL-FIO-DPC
              IF NOT FIO-STAT-OKS
                 DISPLAY 'ABORTO, AL INTENTAR TOMAR DE UPD LA TABLA DPC'
                 PERFORM GNS-PRO-ABT.
      *RRM-FIN 20-JAN-1999
           MOVE WSS-NUM-FOLO IN WSS-TEC  TO DPC-NUM-FOF5 IN DPC.
           MOVE WSS-FOL-FINA IN WSS-VARI TO DPC-NUM-FOI5 IN DPC.
           MOVE SPACES                   TO DPC-GLS-DIS5 IN DPC.
           IF EMIS-LEGAL
              MOVE FIO-MOD TO FIO-CMND
              PERFORM COL-FIO-DPC.
       FIN-GRABAR-FOLIOS.
           EXIT.

      ******************************************************************
       D-PH-TE2 SECTION.
      ******************
       INI-D-PH-TE2.
       FIN-D-PH-TE2.
           EXIT.

      ******************************************************************
       D-DL-TE2 SECTION.
      ******************
       INI-D-DL-TE2.
       FIN-D-DL-TE2.
           EXIT.

      ******************************************************************
       D-CF-TE2-OPC-FEC-FING SECTION.
      *******************************
       INI-D-CF-TE2-OPC-FEC-FING.
       FIN-D-CF-TE2-OPC-FEC-FING.
           EXIT.

      ******************************************************************
       D-CF-TE2-OPC-COD-VCOC SECTION.
      *******************************
       INI-D-CF-TE2-OPC-COD-VCOC.
       FIN-D-CF-TE2-OPC-COD-VCOC.
           EXIT.

      ******************************************************************
       D-CF-TE2-OPC-COD-OFOC SECTION.
      *******************************
       INI-D-CF-TE2-OPC-COD-OFOC.
       FIN-D-CF-TE2-OPC-COD-OFOC.
           EXIT.

      ******************************************************************
      * D-CF-TEC-LMC-COD-OFOC SECTION.
      *******************************
      * INI-D-CF-TEC-LMC-COD-OFOC.
      * FIN-D-CF-TEC-LMC-COD-OFOC.
      *     EXIT.

      ******************************************************************
      * D-CF-TEC-LMC-CIC-CCSB SECTION.
      *******************************
      * INI-D-CF-TEC-LMC-CIC-CCSB.
      * FIN-D-CF-TEC-LMC-CIC-CCSB.
      *     EXIT.

      ******************************************************************
      * D-CF-TEC-SRT-NUM-TIPO SECTION.
      *******************************
      * INI-D-CF-TEC-SRT-NUM-TIPO.
      * FIN-D-CF-TEC-SRT-NUM-TIPO.
      *     EXIT.

      ******************************************************************
       COPY COLRETE2.
      ******************************************************************
       COPY GNSBPFEC.
       COPY GNSBFCIC.
       COPY TABBFUSR.
       COPY TABBFOFI.
       COPY TABBFCAM.
       COPY COLBFOPC.
       COPY COLBFDLC.
       COPY COLBFRDC.
       COPY SGCBFDBC.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY TABBBUSR.
       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBGCPT.
       COPY GNSBBCIC.
       COPY SGCBGCLI.
       COPY COLBFDPC.
      *>>>>
