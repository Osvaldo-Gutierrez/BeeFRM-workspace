       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   COLPQAVA.
       AUTHOR.       OSVALDO DONOSO J..
       DATE-WRITTEN. 14-Feb-94 06:11 PM.

      * NOMBRE PROGRAMA                   COLPQAVA
      * VERSION                           3.1
      * OPCION                            CON + UPD
      * ARCHIVO BASE                      COLLDA
      * PANTALLA                          COLAVA
      * INP/OUT                           DATACOM
      * TAMANO COMMAREA                   250


       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
       COPY GNSWCSCR.
       COPY GNSWVSCR.
      *<<< Variables de mi commarea
           03  SCR-CAR-FECH                   PIC  X(10).
           03  SCR-KEY-VCAM.
               04 SCR-CAM-FEC1                PIC  X(08).
               04 SCR-CAM-FEC2                PIC  X(08).
               04 SCR-CAM-COD1                PIC  X(06).
               04 SCR-CAM-COD2                PIC  X(06).
           03  SCR-SGV-VCAM                   PIC S9(11)V9(04) COMP-3.
           03  SCR-VAL-UTLZ                   PIC S9(11)V9(04) COMP-3.
           03  SCR-VAL-DISP                   PIC S9(11)V9(04) COMP-3.
           03  SCR-COL-COP                    PIC  X(12).
           03  SCR-ULT-OPC                    PIC  9(02).
      *<<<< FIN_SCR_VARI
           03  SCR-VARI-PFS.
               05  SCR-KEY-IRLO-ASCE      PIC X(24).
               05  SCR-KEY-IRLO-DESC      PIC X(24).
               05  SCR-KEY-ILDA-RAIZ      PIC X(12).
               05  SCR-KEY-ILDA-ACTU.
                   07 SCR-KEY-ILDA-ACTU-CIC PIC X(12).
                   07 SCR-KEY-ILDA-ACTU-COP PIC X(12).
               05  SCR-KEY-ACC            PIC X(13).
      *>>>>
       COPY COLWIAVA.
       COPY COLBRLDA.


       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LDA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGFRM.
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       COPY GNSWGSYS.

      *<<<< WSS AND PGM_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RLO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>>
      *<<<< WSS
       01  PFS-VARI.
           03 PFS-IVEZ-TOT        VALUE 'S' PIC X(01).
      *>>>>
       COPY TABBRCAM.
       COPY COLBRRLO.
       COPY COLBROPC.
       COPY COLBRDLC.
       COPY COLBRICG.
       COPY SGCBRDBC.
       COPY GNSWGCPT.
       COPY GNSWGHOY.
      * << Variables definidas por codigo adicional
       01  WR-VARIABLES.
           02 WR-COP.
              03 WR-NUM-SIS.
                 04 WR-NUM-SIS-L       PIC X(01).
                 04 FILLER             PIC X(03).
              03 WR-COD-CRR            PIC X(08).
           02 WR-ENTERO                PIC S9(11).
      *  Linea de detalle
       01  WR-FRM-LIN-DET.
           02 WR-FRM-CIC-IOPC      PIC X(12).
           02 FILLER               PIC X(01).
           02 WR-FRM-FEC-FCOL.
              03 OPC-NUM-DCOL      PIC X(02).
              03 OPC-NUM-MCOL      PIC X(02).
              03 OPC-NUM-SCOL      PIC X(02).
              03 OPC-NUM-ACOL      PIC X(02).
           02 FILLER               PIC X(01).
           02 WR-FRM-FEC-FMAV.
              03 DLC-NUM-DMAV      PIC X(02).
              03 DLC-NUM-MMAV      PIC X(02).
              03 DLC-NUM-SMAV      PIC X(02).
              03 DLC-NUM-AMAV      PIC X(02).
           02 FILLER               PIC X(01).
           02 WR-FRM-SGV-TINT      PIC ZZ9,9999.
           02 WR-FRM-VAL-CRED      PIC ---.---.---.--9,9999.
           02 WR-FRM-VAL-SCRE      PIC ---.---.---.--9,9999.
       01  WR-FRM-DISP.
           02 WR-FRM-GLS-DISP      PIC X(17).
           02 WR-FRM-VAL-DISP      PIC ---.---.---.--9,9999.
       01  WR-FRM-UTLZ.
           02 WR-FRM-GLS-UTLZ      PIC X(17).
           02 WR-FRM-VAL-UTLZ      PIC ---.---.---.--9,9999.
      *>>>>
       01  PGM-VARI.
           03 PGM-ICLR                  VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-TODO          VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-LLAVES        VALUE 'K'       PIC X(01).
           03 PGM-LIMPIAR-CAMPOS        VALUE 'F'       PIC X(01).
           03 PGM-NO-LIMPIAR-NADA       VALUE 'N'       PIC X(01).
           03 PGM-STAT.
              05 PGM-STAT-LDA.
                 88 PGM-STAT-LDA-NUL    VALUE '  '.
                 07 PGM-STT1-LDA        VALUE '2' PIC X(01).
                    88 PGM-STAT-LDA-OKS VALUE '0'.
                 07 PGM-STT2-LDA        VALUE '3' PIC X(01).
           03 PGM-SRNF                  VALUE '23'      PIC X(02).
           03 PGM-SOKS                  VALUE '00'      PIC X(02).
           03 PGM-SNUL                  VALUE '  '      PIC X(02).
           03 PGM-SUAR                  VALUE SPACES    PIC X(15).

       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 FILLER                    PIC X(423).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
       LUP-MAIN.
           IF SCR-INST = SCR-INST-HCM
                 PERFORM SCR-COM.
           IF SCR-CCPP = 'ACC'
                 PERFORM SCR-ACC
           ELSE
                 MOVE SCR-INST-HCM TO SCR-INST.
           GO TO LUP-MAIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
       COPY GNSBGEIB.
       COPY GNSBGEDB.
           MOVE LOW-VALUES TO AVA-FLD.
           MOVE LOW-VALUES TO AVA-EDT.
           PERFORM GNS-PRO-RCK.
           PERFORM GNS-BUS-VCA.
           MOVE +423 TO SCR-TCMA.
           PERFORM GNS-HDL-SYS.
           PERFORM GNS-HDL-FRM.
           MOVE 'COLPQAVA' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
       FIN-INI.
           EXIT.

       COPY GNSBHSYS.
       COPY GNSBHFRM.
       COPY GNSBPRCK.
       COPY GNSBBVCA.
       COPY GNSBBIDD.

       SCR-COM SECTION.
       INI-SCR-COM.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-AVA.
           PERFORM EDT-KEY-AVA.
           PERFORM EDT-FLD-AVA.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-HCM TO SCR-INST.
           MOVE SCR-CMNP     TO SYS-PROG.
           MOVE SCR-VARI     TO SYS-CMMA.
           MOVE SCR-TCMA     TO SYS-TCMA.
           MOVE SYS-XCTL     TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       XCT-ERR.
           MOVE 'XCTERR    ' TO MSG-COD-MENS.
           MOVE 'GNS'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO SYS-MEN1.
           MOVE SYS-PROG     TO SYS-MEN2.
           MOVE SYS-ABOR     TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       COPY GNSBGGBK.
       FIN-SCR-COM.
           EXIT.



       SCR-ACC SECTION.
       INI-SCR-ACC.
           IF SCR-INST = SCR-INST-HKY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM HBL-KEY
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ACC
           ELSE
           IF SCR-INST = SCR-INST-GFL
                PERFORM GET-FLD
           ELSE
           IF SCR-INST = SCR-INST-GCS
                PERFORM GET-ACC
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON.
           PERFORM DESSCRTRL.
      *<<<< PFS_SCR_ACC
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 OR
                         FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM VAL-NUM-KEY-AVA
               PERFORM VAL-NUM-FLD-AVA
               PERFORM SCRL-TAB-AVA
               PERFORM SCR-TRL.
      *>>>>
           MOVE SPACES TO FRM-MENS.
           IF SCR-STAT NOT = SCR-STAT-CON
               PERFORM CMN-ACC.
           PERFORM SCR-MSSG.
       FIN-SCR-ACC.
           EXIT.




       SCR-DMSG SECTION.
       INI-SCR-DMSG.
           IF PGM-ICLR = PGM-NO-LIMPIAR-NADA
               NEXT SENTENCE
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-TODO
               PERFORM SCR-CLRA-AVA
               PERFORM EDT-KEY-AVA
               PERFORM EDT-FLD-AVA
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-LLAVES
               PERFORM CLR-KEY-AVA
               PERFORM EDT-KEY-AVA
           ELSE
               PERFORM CLR-FLD-AVA
               PERFORM EDT-FLD-AVA.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-DMSG.
           EXIT.

       SCR-KEY SECTION.
       INI-SCR-KEY.
           PERFORM SCR-RST.
           PERFORM GET-KEY.
           IF FRM-STAT-ABT
                   MOVE SPACES TO FRM-MENS
                   PERFORM SCR-MSSG
                   GO TO FIN-SCR-KEY.
       FND-SCR-KEY.
           MOVE SPACES TO FRM-MENS.
           PERFORM FND-KEY.
           IF FIO-STAT-OKS
               PERFORM PUT-SCR
               MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
               GO TO FIN-SCR-KEY.
      *JSS ELSE
      *        PERFORM CLR-FLD-AVA.
       ERR-SCR-KEY.
           MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR.
           IF FRM-MENS NOT > SPACES
               IF FIO-STAT-EOF
                   MOVE 'REGEOF    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
               IF FIO-STAT = FIO-STAT-NEX
                   MOVE 'REGNEX    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
           MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-SCR-KEY.
           EXIT.

       SCR-RST SECTION.
       INI-SCR-RST.
           MOVE SPACES       TO PGM-ICLR.
           MOVE SPACES       TO SCR-ACTU.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
           MOVE LOW-VALUES   TO AVA-FLD.
       FIN-SCR-RST.
           EXIT.

       GET-KEY SECTION.
       INI-GET-KEY.
           PERFORM SCR-GKEY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-KEY.
           EXIT.

       GET-IKY SECTION.
       INI-GET-IKY.
           PERFORM SCR-GIKY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-IKY.
           EXIT.

       FND-KEY SECTION.
       INI-FND-KEY.
           PERFORM KEY-ALL-AVA.
      *<<
           MOVE SPACES              TO SCR-VARI-PFS.
      *<< Analizo por llave de acceso
           IF (LDA-NUM-SIS IN AVA-FLD > SPACES)
               MOVE 'LDA-COP'       TO SCR-KEY-ACC
           ELSE
              MOVE FIO-GET-NLS      TO FIO-CMND
              MOVE DBC-CIC-ICLI     TO CLI-CIC IN LDA
              MOVE 'LDA-CLV-LDA-1'  TO FIO-AKEY SCR-KEY-ACC
              PERFORM COL-FIO-LDA
              IF DBC-CIC-ICLI NOT = CLI-CIC IN LDA
                 MOVE '23'          TO FIO-STAT PGM-STAT-LDA
                 GO TO FIN-FND-KEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-LDA.
           MOVE FIO-STAT TO PGM-STAT-LDA.
       FIN-FND-KEY.
           EXIT.

       PUT-SCR SECTION.
       INI-PUT-SCR.
      *<<<< PUT_SCR
           IF PGM-STAT-LDA-OKS
               PERFORM INIT-VARI
               MOVE LDA-COP IN LDA TO SCR-KEY-ILDA-ACTU-COP
               MOVE CLI-CIC IN LDA TO SCR-KEY-ILDA-ACTU-CIC
               MOVE LDA-COP IN LDA TO SCR-KEY-ILDA-RAIZ
               MOVE SPACES TO LDA-CLV-RLO-1 IN RLO
               MOVE SCR-KEY-ILDA-RAIZ TO LDA-COP IN RLO
               MOVE 'LDA-CLV-RLO-1' TO FIO-AKEY
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM COL-FIO-RLO
               IF FIO-STAT-OKS AND
                  LDA-COP IN RLO = SCR-KEY-ILDA-RAIZ
                   MOVE SPACES TO SCR-KEY-IRLO-ASCE
                                  SCR-KEY-IRLO-DESC
                   PERFORM LLENAR-TABLA-ASCE
               ELSE
                   PERFORM LIMPIAR-TABLA VARYING FRM-IFLD FROM 1 BY 1
                                         UNTIL   FRM-IFLD > 8
                   MOVE 'COL' TO MSG-COD-SIST
                   MOVE 'RLO    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
      *>>>>
           PERFORM PUT-ALL-AVA.
       FIN-PUT-SCR.
           EXIT.

       GET-FLD SECTION.
       INI-GET-FLD.
           PERFORM SCR-GFLD.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-FLD.
           EXIT.



       CMN-ACC SECTION.
       INI-CMN-ACC.
           IF SCR-STAT = SCR-STAT-ABT OR SCR-VFLD = SCR-VFLD-NOT
               MOVE 'ACCION NO REALIZADA' TO FRM-MENS
               GO TO FIN-CMN-ACC.
           PERFORM KEY-ALL-AVA.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-LDA.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-ACC.
           PERFORM RET-ALL-AVA.
       FIN-CMN-ACC.
           EXIT.



       SCR-EXIT SECTION.
       INI-SCR-EXIT.
           MOVE 'P'      TO SCR-ICMN.
           MOVE SCR-NTRN TO SYS-NTRN.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-RTRN TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-SCR-EXIT.
           EXIT.

       SCR-PUTA SECTION.
       INI-SCR-PUTA.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE AVA-FLD TO FRM-DFLD.
           MOVE FRM-PUT-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-PUTA.
           EXIT.

       SCR-MSSG SECTION.
       INI-SCR-MSSG.
           IF FRM-MEN1 NOT > SPACES
               MOVE SPACES TO FRM-MEN1.
           IF FRM-MEN2 NOT > SPACES
               MOVE SPACES TO FRM-MEN2.
           MOVE FRM-MENS TO AVA-GLS-MENS.
       FIN-SCR-MSSG.
           EXIT.

       SCR-GKEY SECTION.
       INI-SCR-GKEY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-AVA
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO AVA-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GKEY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-AVA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-AVA
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-AVA.
           PERFORM VAL-IKY-AVA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-MKY-AVA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-AKY-AVA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-CON-KEY-AVA.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GKEY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-AVA.
       ERR-SCR-GKEY.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-AVA.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GKEY.
           PERFORM SCR-MSSG.

       SCR-GIKY SECTION.
       INI-SCR-GIKY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-AVA
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO AVA-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GIKY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-AVA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               PERFORM SCR-MSSG
               PERFORM EDT-IKY-AVA
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-AVA.
           PERFORM VAL-IKY-AVA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GIKY.
           PERFORM VAL-CON-IKY-AVA.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GIKY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-AVA.
       ERR-SCR-GIKY.
           PERFORM SCR-MSSG.
           PERFORM EDT-IKY-AVA.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GIKY.
           PERFORM SCR-MSSG.

       SCR-GFLD SECTION.
       INI-SCR-GFLD.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-FLD-AVA
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO AVA-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GFLD.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-AVA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-AVA
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           PERFORM VAL-NUM-FLD-AVA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-AVA
               PERFORM EDT-FLD-AVA
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           PERFORM VAL-MKY-AVA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GFLD.
           PERFORM VAL-FLD-AVA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GFLD.
           PERFORM VAL-CON-FLD-AVA.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GFLD.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-FLD-AVA.
       ERR-SCR-GFLD.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-AVA.
           PERFORM EDT-FLD-AVA.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GFLD.
           MOVE SCR-STAT-MOD TO SCR-STAT.

       GET-ACC SECTION.
       INI-GET-ACC.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO AVA-GLS-MEN2
               MOVE SCR-PRMT     TO AVA-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO AVA-FLD.
           IF NOT ( ( FRM-FFLD = FRM-FFLD-PF12 OR FRM-FFLD-PF3 ) OR
                      SCR-CONF > SPACES )
               PERFORM VAL-NUM-KEY-AVA
               PERFORM VAL-NUM-FLD-AVA.
       FIN-GET-ACC.
           MOVE SCR-STAT-SON TO SCR-STAT.

       GET-CON SECTION.
       INI-GET-CON.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
      *<<<< PFS_GET_CON
           IF NOT ( FRM-FFLD = FRM-FFLD-PF5 )
           IF NOT ( FRM-FFLD = FRM-FFLD-PF6 )
           IF NOT ( FRM-FFLD = FRM-FFLD-PF7 )
           IF NOT ( FRM-FFLD = FRM-FFLD-PF8 )
      *>>>>
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO AVA-GLS-MEN2
               MOVE SCR-PRMT     TO AVA-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO AVA-FLD.
       FIN-GET-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.

       CLR-MSG SECTION.
       INI-CLR-MSG.
           MOVE SPACES TO AVA-GLS-MENS.
       FIN-CLR-MSG.
           EXIT.

       HBL-IKY SECTION.
       INI-HBL-IKY.
           IF SCR-DESDE-CMN
               MOVE AVA-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO AVA-FLD
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO AVA-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO AVA-GLS-MENS.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-FLD-AVA.
           PERFORM PRO-MKY-AVA.
           PERFORM PRO-AKY-AVA.
           PERFORM UNP-IKY-AVA.
           PERFORM FST-KEY-AVA.
           MOVE '1' TO FRM-CPIM-AEY.
       FIN-HBL-IKY.
           EXIT.

       HBL-KEY SECTION.
       INI-HBL-KEY.
           IF SCR-DESDE-CMN
               MOVE AVA-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO AVA-FLD
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO AVA-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO AVA-GLS-MENS.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-FLD-AVA.
           PERFORM UNP-KEY-AVA.
           PERFORM FST-KEY-AVA.
           MOVE '1' TO FRM-CPIM-AEY.
       FIN-HBL-KEY.
           EXIT.

       HBL-FLD SECTION.
       INI-HBL-FLD.
           PERFORM PRO-IKY-AVA.
           PERFORM PRO-AKY-AVA.
           PERFORM UNP-MKY-AVA.
           PERFORM UNP-FLD-AVA.
           PERFORM FST-FLD-AVA.
       FIN-HBL-FLD.
           EXIT.

       FST-MSG SECTION.
       INI-FST-MSG.
           MOVE -1 TO AVA-GLS-MENS-LEN.
       FIN-FST-MSG.
           EXIT.

       PRO-ALL SECTION.
       INI-PRO-ALL.
           PERFORM PRO-KEY-AVA.
           PERFORM PRO-FLD-AVA.
           PERFORM FST-MSG.
       FIN-PRO-ALL.
           EXIT.

       SCR-TRL SECTION.
       INI-SCR-TRL.
           IF FRM-MEN1 NOT > SPACES
               MOVE SCR-PRMT TO FRM-MEN1.
           IF SCR-STAT = SCR-STAT-MOD
               MOVE SCR-INST-GFL TO SCR-INST
               PERFORM HBL-FLD
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-AVA
               PERFORM EDT-FLD-AVA
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           IF SCR-STAT = SCR-STAT-SON
               MOVE SCR-INST-GCS TO SCR-INST
               PERFORM PRO-ALL
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-AVA
               PERFORM EDT-FLD-AVA
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *ASUME SCR-STAT-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.
           MOVE SCR-INST-GAB TO SCR-INST.
      *    MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-AVA.
           PERFORM EDT-FLD-AVA.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-TRL.
           EXIT.

       DESSCRTRL SECTION.
       INI-DESSCRTRL.
           IF SCR-INST = SCR-INST-GCF
                  PERFORM SCR-GCNF
                  GO TO FIN-DESSCRTRL.
           MOVE SCR-VFLD-NOT TO SCR-VFLD.
           MOVE FRM-FFLD TO SCR-FFLD.
           IF SCR-STAT = SCR-STAT-ABT OR SCR-STAT-CON
                  GO TO FIN-DESSCRTRL.
           IF SCR-FFLD-RET OR SCR-FFLD-PF10
                  MOVE SCR-VFLD-YES TO SCR-VFLD
                  PERFORM PRO-CONF.
       FIN-DESSCRTRL.
           IF SCR-FFLD-PF10 OR SCR-FFLD-PF3
                 MOVE SCR-INST-HCM TO SCR-INST
           ELSE
                 MOVE SCR-INST-HKY TO SCR-INST.
       EXT-DESSCRTRL.
           EXIT.

       PRO-CONF SECTION.
       INI-PRO-CONF.
           IF FRM-MENS NOT > SPACES
               IF SCR-CONF NOT > SPACES
                   GO TO FIN-PRO-CONF
               ELSE
                   MOVE SCR-CONF TO FRM-MENS
           ELSE
               IF FRM-MEN1 NOT > SPACES
                   MOVE SCR-CONF TO FRM-MEN1.
           MOVE SCR-INST-GCF TO SCR-INST.
           PERFORM SCR-MSSG.
           PERFORM PRO-KEY-AVA.
           PERFORM PRO-FLD-AVA.
           PERFORM FST-MSG.
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM EDT-KEY-AVA
               PERFORM EDT-FLD-AVA.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-PRO-CONF.
           EXIT.

       SCR-GCNF SECTION.
       INI-SCR-GCNF.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3  OR
                               FRM-FFLD-PF4 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO AVA-GLS-MEN2
               MOVE SCR-CONF     TO AVA-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO AVA-FLD.
           MOVE FRM-FFLD TO SCR-FFLD.
           IF FRM-FFLD = FRM-FFLD-PF3
               MOVE SCR-VFLD-NOT TO SCR-VFLD
           ELSE
           IF FRM-FFLD = FRM-FFLD-RET OR FRM-FFLD-PF10 OR FRM-FFLD-PF4
               MOVE SCR-VFLD-YES TO SCR-VFLD
               PERFORM VAL-NUM-KEY-AVA
               PERFORM VAL-NUM-FLD-AVA
           ELSE
           IF FRM-FFLD = FRM-FFLD-PF12
               MOVE SCR-STPP TO SCR-STAT
               IF SCR-STAT = SCR-STAT-MOD
                   PERFORM VAL-NUM-KEY-AVA
                   PERFORM VAL-NUM-FLD-AVA
                   PERFORM SCR-TRL
               ELSE
                   MOVE SCR-VFLD-NOT TO SCR-VFLD.
       FIN-SCR-GCNF.
           EXIT.


       COPY COLBMAVA.
       COPY COLBFLDA.
       COPY GNSBVNUM.
       COPY GNSBFMSG.
       COPY GNSBGSYS.
       COPY GNSBGDTC.
       COPY GNSBGFRM.
       COPY GNSBGMSG.
       COPY GNSBEKEY.
       COPY GNSBIABT.
       COPY GNSBFTAB.
       COPY GNSBPVRF.

      *<<<< EOF
       SCRL-TAB-AVA SECTION.
       INI-SCRL-TAB-AVA.
           IF FRM-FFLD = FRM-FFLD-PF5
               PERFORM SCRL-TAB-AVA-PF5
               GO TO FIN-SCRL-TAB-AVA.
           IF FRM-FFLD = FRM-FFLD-PF6
               PERFORM SCRL-TAB-AVA-PF6
               GO TO FIN-SCRL-TAB-AVA.
           IF FRM-FFLD = FRM-FFLD-PF7
               PERFORM SCRL-TAB-AVA-PF7
               GO TO FIN-SCRL-TAB-AVA.
           IF FRM-FFLD = FRM-FFLD-PF8
               PERFORM SCRL-TAB-AVA-PF8
               GO TO FIN-SCRL-TAB-AVA.
       FIN-SCRL-TAB-AVA.
           EXIT.

       LLENAR-TABLA-ASCE SECTION.
       INI-LLENAR-TABLA-ASCE.
           MOVE 1 TO FRM-IFLD.
       LUP-LLENAR-TABLA-ASCE.
           IF PFS-IVEZ-TOT = 'S'
               PERFORM PROCESO-CADA-HIJO.
           IF FRM-IFLD NOT > 8
               PERFORM CARGAR-TABLA.
           IF FRM-IFLD = 1
               MOVE LDA-CLV-RLO-1 IN RLO TO SCR-KEY-IRLO-DESC
               MOVE SPACES              TO SCR-KEY-IRLO-ASCE
           ELSE
           IF FRM-IFLD = 8
               MOVE LDA-CLV-RLO-1 IN RLO TO SCR-KEY-IRLO-ASCE.
       NXT-LLENAR-TABLA-ASCE.
           ADD 1 TO FRM-IFLD.
           IF PFS-IVEZ-TOT = 'N'
               IF FRM-IFLD > 8
                   GO TO FIN-LLENAR-TABLA-ASCE.
           MOVE 'LDA-CLV-RLO-1' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-RLO.
           IF FIO-STAT-OKS AND
               LDA-COP IN RLO = SCR-KEY-ILDA-RAIZ
               GO TO LUP-LLENAR-TABLA-ASCE.
           PERFORM LIMPIAR-TABLA VARYING FRM-IFLD FROM FRM-IFLD BY 1
                                 UNTIL   FRM-IFLD > 8.
       FIN-LLENAR-TABLA-ASCE.
           EXIT.

       LLENAR-TABLA-DESC SECTION.
       INI-LLENAR-TABLA-DESC.
           MOVE 8 TO FRM-IFLD.
       LUP-LLENAR-TABLA-DESC.
           PERFORM CARGAR-TABLA.
           IF FRM-IFLD = 8
               MOVE LDA-CLV-RLO-1 IN RLO TO SCR-KEY-IRLO-ASCE
               MOVE SPACES              TO SCR-KEY-IRLO-DESC
           ELSE
           IF FRM-IFLD = 1
               MOVE LDA-CLV-RLO-1 IN RLO TO SCR-KEY-IRLO-DESC.
       PRV-LLENAR-TABLA-DESC.
           SUBTRACT 1 FROM FRM-IFLD.
           IF FRM-IFLD < 1
               GO TO FIN-LLENAR-TABLA-DESC.
           MOVE 'LDA-CLV-RLO-1' TO FIO-AKEY.
           MOVE FIO-GET-PRV TO FIO-CMND.
           PERFORM COL-FIO-RLO.
           IF FIO-STAT-OKS AND
              LDA-COP IN RLO = SCR-KEY-ILDA-RAIZ
               GO TO LUP-LLENAR-TABLA-DESC.
           PERFORM LIMPIAR-TABLA VARYING FRM-IFLD FROM FRM-IFLD BY -1
                                 UNTIL   FRM-IFLD < 1.
       FIN-LLENAR-TABLA-DESC.
           EXIT.

       SCRL-TAB-AVA-PF5 SECTION.
       INI-SCRL-TAB-AVA-PF5.
           IF SCR-KEY-IRLO-DESC NOT > SPACES
               MOVE 'RLO    NOPRV' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-AVA-PF5.
           MOVE SCR-KEY-IRLO-DESC TO LDA-CLV-RLO-1 IN RLO.
           MOVE 'LDA-CLV-RLO-1' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-RLO.
           IF NOT FIO-STAT-OKS
               MOVE 'RLOCURRNEX' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-AVA-PF5.
           MOVE 'LDA-CLV-RLO-1' TO FIO-AKEY.
           MOVE FIO-GET-PRV TO FIO-CMND.
           PERFORM COL-FIO-RLO.
           IF FIO-STAT-OKS AND
              LDA-COP IN RLO = SCR-KEY-ILDA-RAIZ
               PERFORM LLENAR-TABLA-DESC
               GO TO FIN-SCRL-TAB-AVA-PF5.
           MOVE 'RLO    NOPRV' TO MSG-COD-MENS.
       MSG-SCRL-TAB-AVA-PF5.
           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MEN2.
       FIN-SCRL-TAB-AVA-PF5.
           EXIT.

       SCRL-TAB-AVA-PF6 SECTION.
       INI-SCRL-TAB-AVA-PF6.
           IF SCR-KEY-IRLO-ASCE NOT > SPACES
               MOVE 'RLO    NONXT' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-AVA-PF6.
           MOVE SCR-KEY-IRLO-ASCE TO LDA-CLV-RLO-1 IN RLO.
           MOVE 'LDA-CLV-RLO-1' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-RLO.
           IF NOT FIO-STAT-OKS
               MOVE 'RLOCURRNEX' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-AVA-PF6.
           MOVE 'LDA-CLV-RLO-1' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-RLO.
           IF FIO-STAT-OKS AND
              LDA-COP IN RLO = SCR-KEY-ILDA-RAIZ
               MOVE 'N' TO PFS-IVEZ-TOT
               PERFORM LLENAR-TABLA-ASCE
               GO TO FIN-SCRL-TAB-AVA-PF6.
           MOVE 'RLO    NONXT' TO MSG-COD-MENS.
       MSG-SCRL-TAB-AVA-PF6.
           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MEN2.
       FIN-SCRL-TAB-AVA-PF6.
           EXIT.

       SCRL-TAB-AVA-PF7 SECTION.
       INI-SCRL-TAB-AVA-PF7.
           MOVE SCR-KEY-ILDA-ACTU-COP TO LDA-COP IN LDA
           MOVE SCR-KEY-ILDA-ACTU-CIC TO CLI-CIC IN LDA.
           MOVE SCR-KEY-ACC TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-LDA.
           IF NOT FIO-STAT-OKS
               MOVE 'LDACURRNEX' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-AVA-PF7.
           MOVE SCR-KEY-ACC TO FIO-AKEY.
           MOVE FIO-GET-PRV TO FIO-CMND.
           PERFORM COL-FIO-LDA.
           IF NOT FIO-STAT-OKS
               MOVE 'LDA    NOPRV' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-AVA-PF7.
           MOVE FIO-STAT TO PGM-STAT-LDA.
           PERFORM PUT-SCR.
           GO TO FIN-SCRL-TAB-AVA-PF7.
       MSG-SCRL-TAB-AVA-PF7.
           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MEN2.
       FIN-SCRL-TAB-AVA-PF7.
           EXIT.

       SCRL-TAB-AVA-PF8 SECTION.
       INI-SCRL-TAB-AVA-PF8.
           MOVE SCR-KEY-ILDA-ACTU-COP TO LDA-COP IN LDA
           MOVE SCR-KEY-ILDA-ACTU-CIC TO CLI-CIC IN LDA.
           MOVE SCR-KEY-ACC TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-LDA.
           IF NOT FIO-STAT-OKS
               MOVE 'LDACURRNEX' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-AVA-PF8.
           MOVE SCR-KEY-ACC TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-LDA.
           IF NOT FIO-STAT-OKS
               MOVE 'LDA    NONXT' TO MSG-COD-MENS
               GO TO MSG-SCRL-TAB-AVA-PF8.
           MOVE FIO-STAT TO PGM-STAT-LDA.
           PERFORM PUT-SCR.
           GO TO FIN-SCRL-TAB-AVA-PF8.
       MSG-SCRL-TAB-AVA-PF8.
           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MEN2.
       FIN-SCRL-TAB-AVA-PF8.
           EXIT.
      *>>>>
      *<<<< EOF
       CARGAR-TABLA SECTION.
       INI-CARGAR-TABLA.
           MOVE SPACES             TO WR-FRM-LIN-DET
           MOVE COL-COP IN RLO     TO WR-FRM-CIC-IOPC
           PERFORM LEER-OPC.
           IF OPC-VAL-SCRE > 0 AND (OPC-MSC-STAT = 'A' OR = 'B')
              NEXT SENTENCE
           ELSE
              IF FRM-FFLD = FRM-FFLD-PF5
                 ADD 1 TO FRM-IFLD
                 GO TO FIN-CARGAR-TABLA
              ELSE
                 SUBTRACT 1 FROM FRM-IFLD
                 GO TO FIN-CARGAR-TABLA.

           MOVE COL-COP IN RLO     TO DLC-CIC-IOPC IN DLC
           MOVE '001'              TO DLC-NUM-IDLC IN DLC
           MOVE 'DLC-KEY-IDLC'     TO FIO-AKEY
           MOVE FIO-GET-KEY        TO FIO-CMND
           PERFORM COL-FIO-DLC
           IF NOT FIO-STAT-OKS
              MOVE ZEROES          TO DLC-FEC-FMAV IN DLC.

           MOVE COL-COP IN RLO     TO ICG-CIC-IOPC IN ICG
           MOVE '000'              TO ICG-NUM-ICAN IN ICG
           MOVE SPACES             TO ICG-CIC-IOPV IN ICG
           MOVE '000'              TO ICG-NUM-IVCT IN ICG
           MOVE 'INT'              TO ICG-IND-TTAS IN ICG
           MOVE '00000000'         TO ICG-FEC-FINI IN ICG
           MOVE 'ICG-KEY-IICG'     TO FIO-AKEY
           MOVE FIO-GET-KEY        TO FIO-CMND
           PERFORM COL-FIO-ICG
           IF FIO-STAT-OKS
              NEXT SENTENCE
           ELSE
              MOVE 0                TO ICG-SGV-TINT IN ICG.

           MOVE CORR OPC-FEC-FCOL IN OPC TO WR-FRM-FEC-FCOL
           MOVE CORR DLC-FEC-FMAV IN DLC TO WR-FRM-FEC-FMAV
           MOVE      ICG-SGV-TINT IN ICG TO WR-FRM-SGV-TINT
           MOVE      OPC-VAL-CRED IN OPC TO WR-FRM-VAL-CRED
           MOVE      OPC-VAL-SCRE IN OPC TO WR-FRM-VAL-SCRE
           MOVE      WR-FRM-LIN-DET      TO FRM-LIN-DET(FRM-IFLD).
           MOVE      FRM-IFLD            TO SCR-ULT-OPC.
       FIN-CARGAR-TABLA.
           EXIT.
       INIT-VARI SECTION.
       INI-INIT-VARI.
           MOVE 1                   TO SCR-ULT-OPC
           MOVE 0                   TO SCR-VAL-UTLZ
           MOVE LDA-VAL-AUT IN LDA  TO SCR-VAL-DISP.
       FIN-INIT-VARI.
           EXIT.
       PROCESO-CADA-HIJO SECTION.
       INI-PROCESO-CADA-HIJO.
           PERFORM LEER-OPC.
           IF OPC-VAL-SCRE > 0 AND (OPC-MSC-STAT = 'A' OR = 'B')
               ADD OPC-VAL-SCRE IN OPC TO SCR-VAL-UTLZ
               SUBTRACT OPC-VAL-SCRE IN OPC FROM SCR-VAL-DISP
               MOVE COL-COP IN RLO TO SCR-COL-COP.
       FIN-PROCESO-CADA-HIJO.
           EXIT.
       LIMPIAR-TABLA SECTION.
       INI-LIMPIAR-TABLA.
           MOVE SPACES TO FRM-LIN-DET IN AVA-FLD(FRM-IFLD).
       FIN-LIMPIAR-TABLA.
           EXIT.
       LEER-OPC SECTION.
       INI-LEER-OPC.
           MOVE COL-COP IN RLO     TO OPC-CIC-IOPC IN OPC
           MOVE 'OPC-KEY-IOPC'     TO FIO-AKEY
           MOVE FIO-GET-KEY        TO FIO-CMND
           PERFORM COL-FIO-OPC
           IF NOT FIO-STAT-OKS
              MOVE 0               TO OPC-VAL-SCRE IN OPC
              MOVE 0               TO OPC-VAL-CRED IN OPC
              MOVE ZEROES          TO OPC-FEC-FCOL IN OPC
              GO TO FIN-LEER-OPC.

           IF (OPC-COD-VCOC = '0999  ')
               GO TO FIN-LEER-OPC.

           IF (SCR-CAR-FECH NOT = 'CARGADA OK')
               MOVE 'CARGADA OK'   TO SCR-CAR-FECH
               PERFORM GET-FHOY
               MOVE HOY-FHOY       TO SCR-CAM-FEC1 SCR-CAM-FEC2.

           MOVE SCR-CAM-FEC1       TO CAM-FEC-FCAM IN CAM (1)
           MOVE SCR-CAM-FEC2       TO CAM-FEC-FCAM IN CAM (2)
           MOVE OPC-COD-VCOC       TO CAM-COD-VCAM IN CAM (1)
           MOVE '0999  '           TO CAM-COD-VCAM IN CAM (2)

           IF (SCR-KEY-VCAM NOT = CAM-KEY-CAMB IN CAM)
               MOVE CAM-KEY-CAMB IN CAM TO SCR-KEY-VCAM
               MOVE 'CAM-KEY-CAMB' TO FIO-AKEY
               MOVE FIO-GET-KEY    TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT FIO-STAT-OKS
                  MOVE 'En TABLA CAM, no econtre valor paridad a hoy '
                  TO FIO-MENS
                  MOVE OPC-COD-VCOC TO FIO-MENS-FIL
                  GO TO PRG-ABT
               ELSE
                  MOVE CAM-SGV-VCAM IN CAM TO SCR-SGV-VCAM.

               COMPUTE WR-ENTERO ROUNDED = OPC-VAL-SCRE * SCR-SGV-VCAM.
               MOVE WR-ENTERO           TO OPC-VAL-SCRE.
       FIN-LEER-OPC.
           EXIT.
       PON-TOT-FRM SECTION.
       INI-PON-TOT-FRM.
           IF (SCR-INST NOT = SCR-INST-GAB)
               GO TO FIN-PON-TOT-FRM.

           MOVE FRM-LIN-DET(SCR-ULT-OPC) TO WR-FRM-LIN-DET
           IF (WR-FRM-CIC-IOPC     = SCR-COL-COP OR
               WR-FRM-CIC-IOPC NOT > SPACES)
               MOVE SCR-VAL-DISP         TO WR-FRM-VAL-DISP
               MOVE SCR-VAL-UTLZ         TO WR-FRM-VAL-UTLZ
               MOVE 'Monto utilizado:'   TO WR-FRM-GLS-UTLZ
               MOVE 'Cupo disponible:'   TO WR-FRM-GLS-DISP
               MOVE WR-FRM-DISP          TO FRM-GLS-DISP
               MOVE WR-FRM-UTLZ          TO FRM-GLS-UTLZ
           ELSE
           IF (FRM-MEN2 NOT > SPACES)
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE 'LDAEXIPAG'          TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC         TO FRM-MEN2
               MOVE SPACES               TO FRM-GLS-DISP
               MOVE SPACES               TO FRM-GLS-UTLZ.
       FIN-PON-TOT-FRM.
           EXIT.
      *Copia el modulo FIO asociado a la entidad RLO, OPC, DLC, ICG
       COPY TABBFCAM.
       COPY COLBFRLO.
       COPY COLBFOPC.
       COPY COLBFDLC.
       COPY COLBFICG.
       COPY SGCBFDBC.
       COPY GNSBGCPT.
       COPY GNSBGHOY.
      *>>>>
