       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPGFFD.
       AUTHOR.          BEE.
       DATE-WRITTEN.
      * Programa Graba archivo con flujos futuros
      * Autor: BEE (ALD).
      *
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.

       COPY COLBRFFD.
       COPY COLBRFVD.
       COPY GNSWGCPT.
       COPY GNSWGSYS.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSBRMSC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       01  WSS-VARI.
           03  WSS-EXISTE        VALUE 'N'    PIC X(01).
           03  WSS-SGV-CAPI                   PIC 9(14)V9(04).
           03  WSS-SGV-INTE                   PIC 9(14)V9(04).
           03  WSS-SGV-COMI                   PIC 9(14)V9(04).
           03  WSS-SGV-AUXI                   PIC 9(12)V9(04).
           03  WSS-GLS-CAPT.
               05  WSS-GLS-ENTC               PIC X(12).
               05  WSS-GLS-DECC               PIC X(04).
           03  WSS-GLS-INTT.
               05  WSS-GLS-ENTI               PIC X(14).
               05  WSS-GLS-DECI               PIC X(04).
           03  WSS-NUM-RLEI   VALUE ZEROES    PIC 9(06).
           03  WSS-NUM-RSEL   VALUE ZEROES    PIC 9(06).
           03  WSS-NUM-RGRA   VALUE ZEROES    PIC 9(06).
           03  WSS-NUM-RECH   VALUE ZEROES    PIC 9(06).
           03  WSS-NUM-OPER                   PIC 9(08).
           03  WSS-FEC-FPRO.
               05  WSS-NUM-SPRO               PIC 9(02).
               05  WSS-NUM-APRO               PIC 9(02).
               05  WSS-NUM-MPRO               PIC 9(02).
               05  WSS-NUM-DPRO               PIC 9(02).
           03  WSS-FEC-FVCT.
               05  WSS-NUM-SVCT               PIC 9(02).
               05  WSS-NUM-AVCT               PIC 9(02).
               05  WSS-NUM-MVCT               PIC 9(02).
               05  WSS-NUM-DVCT               PIC 9(02).
           03  WSS-FEC-FVEN.
               05  WSS-NUM-SVEN               PIC 9(02).
               05  WSS-NUM-AVEN               PIC 9(02).
               05  WSS-NUM-MVEN               PIC 9(02).
               05  WSS-NUM-DVEN               PIC 9(02).
           03  WSS-COD-VCOC                   PIC X(06).
           03  WSS-GLS-CCSB                   PIC X(12).
           03  WSS-IND-DISP                   PIC X(01).


       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
       INI-MAIN.
           COPY GNSBGEDB.
           MOVE 'COLPGFFD' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           PERFORM OPEN-FILE.
           PERFORM INI-VAR.
           PERFORM PRO-FVD.
           PERFORM CLOSE-FILE.
           PERFORM MUESTRA-ESTADISTICAS.
       FIN-MAIN.
           PERFORM GNS-PRO-END.


      ******************************************************************
       OPEN-FILE SECTION.
      *******************
       INI-OPEN-FILE.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-FVD.
           MOVE 'COL' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE 'TAB' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM COL-FIO-FFD.
       FIN-OPEN-FILE.
           EXIT.

       INI-VAR SECTION.
      *****************
       INI-INI-VAR.
           DISPLAY 'INICIO CAPTURA DE PARAMETROS '.
           DISPLAY '============================ '.

      * Valida codigo de display (S/N).
      * Captura Indicador para desplegar los Display en el programa.
           ACCEPT WSS-IND-DISP IN WSS-VARI.
           DISPLAY 'INDICADOR DE DISPLAY (S/N)  : ' WSS-IND-DISP
                                                         IN WSS-VARI.
           IF WSS-IND-DISP IN WSS-VARI NOT = 'S' AND NOT = 'N'
               DISPLAY 'ERROR, codigo de Display no es valido, '
               DISPLAY 'Debe Ingresar S o N '
               DISPLAY 'PROCESO CANCELADO...'
               PERFORM GNS-PRO-ABT.

       FIN-INI-VAR.
           EXIT.

      ******************************************************************
       PRO-FVD SECTION.
      ****************
       INI-PRO-FVD.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-FVD.
           IF NOT FIO-STAT-OKS
              GO TO FIN-PRO-FVD.


           MOVE FVD-SGV-CAPI IN FVD TO WSS-NUM-OPER.
           MOVE FVD-CIC-IOPC IN FVD TO WSS-FEC-FPRO.

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-FVD.
           IF NOT FIO-STAT-OKS
              GO TO FIN-PRO-FVD.

           MOVE FVD-GLS-CCSB IN FVD TO WSS-GLS-CCSB.
           MOVE FVD-COD-VCOC IN FVD TO WSS-COD-VCOC.
           MOVE FVD-FEC-FVEN IN FVD TO WSS-FEC-FVEN.

           MOVE ZEROES              TO WSS-SGV-CAPI.
           MOVE ZEROES              TO WSS-SGV-INTE.
           MOVE 'N'                 TO WSS-EXISTE.

       LUP-PRO-FVD.
           IF NOT FIO-STAT-OKS
              IF WSS-EXISTE = 'S'
                  PERFORM LLENAR-FFD
                  GO TO FIN-PRO-FVD
              ELSE
                  GO TO FIN-PRO-FVD.

      * Esto es para las estadisticas.
           ADD 1 TO WSS-NUM-RLEI IN WSS-VARI.

           IF FVD-GLS-CCSB IN FVD = WSS-GLS-CCSB  AND
              FVD-COD-VCOC IN FVD = WSS-COD-VCOC  AND
              FVD-FEC-FVEN IN FVD = WSS-FEC-FVEN
               COMPUTE WSS-SGV-CAPI = FVD-SGV-CAPI + WSS-SGV-CAPI
               COMPUTE WSS-SGV-INTE = FVD-SGV-INTE + WSS-SGV-INTE
               MOVE 'S' TO WSS-EXISTE
               GO TO NXT-PRO-FVD
           ELSE
               PERFORM LLENAR-FFD.

           MOVE 'S' TO WSS-EXISTE.

           MOVE FVD-GLS-CCSB IN FVD TO WSS-GLS-CCSB.
           MOVE FVD-COD-VCOC IN FVD TO WSS-COD-VCOC.
           MOVE FVD-FEC-FVEN IN FVD TO WSS-FEC-FVEN.

           MOVE FVD-SGV-CAPI IN FVD TO WSS-SGV-CAPI.
           MOVE FVD-SGV-INTE IN FVD TO WSS-SGV-INTE.


           ADD 1 TO WSS-NUM-RSEL IN WSS-VARI.
       NXT-PRO-FVD.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-FVD.
           GO TO LUP-PRO-FVD.
       FIN-PRO-FVD.
           EXIT.



       LLENAR-FFD SECTION.
       INI-LLENAR-FFD.
           MOVE 'N' TO WSS-EXISTE.
           ADD 1 TO WSS-NUM-RGRA IN WSS-VARI.
           MOVE '|'                      TO FFD-IND-FIL1 IN FFD
                                            FFD-IND-FIL2 IN FFD
                                            FFD-IND-FIL3 IN FFD
                                            FFD-IND-FIL4 IN FFD
                                            FFD-IND-FIL5 IN FFD
                                            FFD-IND-FIL6 IN FFD
                                            FFD-IND-FIL7 IN FFD
                                            FFD-IND-FIL8 IN FFD
                                            FFD-IND-FIL9 IN FFD.
           MOVE WSS-GLS-CCSB             TO FFD-GLS-CCSB IN FFD.

           MOVE WSS-COD-VCOC             TO FFD-COD-VCOC IN FFD.
           MOVE WSS-NUM-DVEN             TO WSS-NUM-DVCT IN WSS-VARI.
           MOVE WSS-NUM-MVEN             TO WSS-NUM-MVCT IN WSS-VARI.
           MOVE WSS-NUM-SVEN             TO WSS-NUM-SVCT IN WSS-VARI.
           MOVE WSS-NUM-AVEN             TO WSS-NUM-AVCT IN WSS-VARI.
           MOVE WSS-FEC-FVCT             TO FFD-FEC-FVEN IN FFD.

           MOVE WSS-SGV-CAPI             TO WSS-SGV-AUXI IN WSS-VARI.
           MOVE   WSS-SGV-AUXI           TO WSS-GLS-CAPT IN WSS-VARI.
           IF   WSS-SGV-CAPI NOT < ZEROES
               MOVE '+'                  TO FFD-CAP-SIGN IN FFD
           ELSE
               MOVE '-'                  TO FFD-CAP-SIGN IN FFD.
           MOVE WSS-GLS-ENTC IN WSS-VARI TO FFD-CAP-ENTC IN FFD.
           MOVE '.'                      TO FFD-CAP-PDEC IN FFD.
           MOVE WSS-GLS-DECC IN WSS-VARI TO FFD-CAP-DECC IN FFD.

           MOVE WSS-SGV-INTE             TO WSS-SGV-AUXI IN WSS-VARI.
           MOVE   WSS-SGV-AUXI           TO WSS-GLS-CAPT IN WSS-VARI.
           IF   WSS-SGV-INTE NOT < ZEROES
               MOVE '+'                  TO FFD-INT-SIGN IN FFD
           ELSE
               MOVE '-'                  TO FFD-INT-SIGN IN FFD.
           MOVE WSS-GLS-ENTC IN WSS-VARI TO FFD-INT-ENTC IN FFD.
           MOVE '.'                      TO FFD-INT-PDEC IN FFD.
           MOVE WSS-GLS-DECC IN WSS-VARI TO FFD-INT-DECC IN FFD.


           MOVE WSS-NUM-OPER             TO FFD-NUM-OPER IN FFD.
           MOVE WSS-FEC-FPRO             TO FFD-FEC-FPRO IN FFD.
           MOVE 'COL'                    TO FFD-COD-ORIG IN FFD.
           MOVE ZEROES                   TO WSS-SGV-COMI IN WSS-VARI.
           MOVE WSS-SGV-COMI             TO WSS-SGV-AUXI IN WSS-VARI.
           MOVE   WSS-SGV-AUXI           TO WSS-GLS-CAPT IN WSS-VARI.
           IF   WSS-SGV-COMI NOT < ZEROES
               MOVE '+'                  TO FFD-COM-SIGN IN FFD
           ELSE
               MOVE '-'                  TO FFD-COM-SIGN IN FFD.
           MOVE WSS-GLS-ENTC IN WSS-VARI TO FFD-COM-ENTC IN FFD.
           MOVE '.'                      TO FFD-COM-PDEC IN FFD.
           MOVE WSS-GLS-DECC IN WSS-VARI TO FFD-COM-DECC IN FFD.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-FFD.
       FIN-LLENAR-FFD.
           EXIT.


      ******************************************************************
       MUESTRA-ESTADISTICAS SECTION.
      *****************************
       INI-MUESTRA-ESTADISTICAS.
           DISPLAY ' '.
           DISPLAY ' ESTADISTICAS DEL PROCESO.'.
           DISPLAY ' -------------------------'.
           DISPLAY ' '.
           DISPLAY 'REGISTROS LEIDOS DE TABLA FVD          : '
                                        WSS-NUM-RLEI IN WSS-VARI.
           DISPLAY 'REGISTROS GRABADOS EN TABLA FFD        : '
                                        WSS-NUM-RGRA IN WSS-VARI.
       FIN-MUESTRA-ESTADISTICAS.
           EXIT.


      ******************************************************************
       CLOSE-FILE SECTION.
      ********************
       INI-CLOSE-FILE.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-FFD.
           PERFORM COL-FIO-FVD.
           MOVE 'COL' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE 'TAB' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
       FIN-CLOSE-FILE.
           EXIT.

      ******************************************************************
      * Copys necesarios para la ejecucion del programa.

       COPY COLBFFFD.
       COPY COLBFFVD.
       COPY GNSBFMSG.
       COPY GNSBFMSC.
       COPY GNSBFTAB.
       COPY GNSBBTAB.
       COPY GNSBBMSG.
       COPY GNSBBMSC.
       COPY GNSBGDTC.

       COPY GNSBGIDD.

       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBGEND.
       COPY GNSBGABT.
