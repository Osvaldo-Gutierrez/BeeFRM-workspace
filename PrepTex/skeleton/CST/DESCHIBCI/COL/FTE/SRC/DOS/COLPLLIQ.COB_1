       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPLLIQ.
       AUTHOR.          CONSIST.
      * Programa Listador de Reporte  con Sort.
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *DOS SELECT RPT         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPT         ASSIGN TO        UT-S-RPT.
           SELECT RPT         ASSIGN TO SYS011-UR-1403-S.
       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
      *COPY LIQRR.
       COPY COLRRLIQ.
       FD  RPT LABEL RECORDS OMITTED
      *    REPORT IS RPT-
           REPORT IS RPT-LIQ
           .
       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY COLBROPC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGIFD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
      *COPY LIQRW.
       COPY COLRWLIQ.
       COPY GNSWGSYS.
      *<<<< WSS
       01  WSS-VARI.
           03  WSS-SDEU                       VALUE 0      PIC 9(01).
               88  WSS-MULTIPLES-DEUDORES     VALUE 1.
           03  WSS-NOMULTIPLES                VALUE 0      PIC 9(01).
           03  WSS-MULTIPLES                  VALUE 1      PIC 9(01).
           03 PGM-STAT.
              05 PGM-STAT-RDC                 VALUE '23'   PIC X(02).
                 88 PGM-STAT-RDC-OKS          VALUE '00'.
                 88 PGM-STAT-RDC-NUL          VALUE '  '.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY SGCBRDBC.
       COPY SGCBRRCD.
       COPY COLBRRDC.
       COPY COLBRICG.
       COPY COLBRCYA.
       COPY TABBROFI.
       COPY TABBRUSR.
       COPY TABBRVLR.
       COPY TABBRCAM.
       COPY GNSWGCPT.
      *>>>>
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VLR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *>>>>
       REPORT SECTION.
      *--------------
      *COPY LIQRF.
       COPY COLRFLIQ.
           .
      *COPY LIQRT.
       COPY COLRTLIQ.
       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
       END DECLARATIVES.
       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'COLPLLIQ' TO FIO-PROG.
           PERFORM BUS-FSIS.
           SORT GNSSRT
      *COPY LIQRS.
       COPY COLRSLIQ.
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
       COPY GNSBGGBK.
       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FST-INP-SRT.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
           PERFORM GET-CUR-RDC.
           PERFORM GET-CLI.
           PERFORM CPT-NOM.
      *>>>>
       MOV-INP-SRT.
      *COPY LIQRM.
       COPY COLRMLIQ.
           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
           IF NOT PGM-STAT-RDC-OKS
               GO TO NEX-RDC.
           PERFORM GET-NXT-RDC.
           IF WSS-MULTIPLES-DEUDORES
               MOVE WSS-MULTIPLES TO SRT-IND-MULT IN SRT
               PERFORM GET-CLI
               GO TO MOV-INP-SRT
           ELSE
               MOVE WSS-NOMULTIPLES TO SRT-IND-MULT IN SRT.
      * ES NECESARIO SETEAR PARA IR A BUSCAR MENSAJE
       NEX-RDC.
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           OPEN OUTPUT RPT.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
       LUP-OUT-SRT.
      *<<<< LUP_OUT
           MOVE SRT-IND-MULT IN SRT TO WSS-SDEU.
           IF WSS-MULTIPLES-DEUDORES
               MOVE 'MULTIPLES DEUDORES DIRECTOS' TO
                    WSS-GLS-MSG1 IN WSS-LIQ
           ELSE
               MOVE SPACES TO WSS-GLS-MSG1 IN WSS-LIQ.
      *>>>>
       GEN-OUT-SRT.
           GENERATE DL-.
       NXT-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
           TERMINATE RPT-.
           CLOSE RPT.
       COPY COLBFOPC.
       COPY GNSBGDTC.
       COPY GNSBGIFD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
      *<<<< EOF
       CPT-NOM SECTION.
       INI-CPT-NOM.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC.
       FIN-CPT-NOM.
           EXIT.
      * GET-CUR
      * =======
       GET-CUR-RDC SECTION.
       INI-GET-CUR-RDC.
           MOVE OPC-CAI-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.
           MOVE OPC-IIC-IOPC IN OPC TO RDC-IIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC'  TO FIO-AKEY.
           MOVE FIO-GET-KEY     TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF FIO-STAT-OKS
               MOVE '00' TO PGM-STAT-RDC
           ELSE
               DISPLAY 'ERROR: NO EXISTE REGISTRO RDC '
                       RDC-CIC-IOPC IN RDC RDC-NUM-IDLC IN RDC
               MOVE '23' TO PGM-STAT-RDC.
       FIN-GET-CUR-RDC.
           EXIT.
       GET-CUR-ICG SECTION.
       INI-GET-CUR-ICG.
           MOVE OPC-CIC-IOPC IN OPC TO ICG-CIC-IOPC IN ICG.
           MOVE ZEROES              TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES              TO ICG-KEY-IVCT IN ICG.
           MOVE 'INT'               TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ICG.
       FIN-GET-CUR-ICG.
           EXIT.
       GET-CUR-CYA SECTION.
       INI-GET-CUR-CYA.
           MOVE OPC-CIC-IOPC IN OPC TO CYA-CIC-IOPC IN CYA
           MOVE ZEROES              TO CYA-NUM-ICAN IN CYA
           MOVE 1                   TO CYA-NUM-ICYA IN CYA
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM COL-FIO-CYA
       FIN-GET-CUR-CYA.
           EXIT.
       GET-NXT-RDC SECTION.
       INI-GET-NXT-RDC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF FIO-STAT-OKS
               MOVE '00' TO PGM-STAT-RDC
           ELSE
               MOVE '23' TO PGM-STAT-RDC.
           IF PGM-STAT-RDC-OKS AND
              OPC-CAI-IOPC IN SRT = RDC-CAI-IOPC IN RDC AND
              OPC-IIC-IOPC IN SRT = RDC-IIC-IOPC IN RDC AND
              RDC-NUM-IDLC IN RDC = ZEROES
              MOVE WSS-MULTIPLES   TO WSS-SDEU
           ELSE
              MOVE WSS-NOMULTIPLES TO WSS-SDEU
              PERFORM GET-CUR-RDC.
       FIN-GET-NXT-RDC.
           EXIT.
       GET-CLI SECTION.
       INI-GET-KEY.
           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'RDC    NOCLI' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO DBC-GLS-NOMC IN DBC.
       FIN-GET-KEY.
           EXIT.
       COPY GNSBFTAB.
       COPY SGCBFDBC.
       COPY SGCBFRCD.
       COPY COLBFRDC.
       COPY COLBFICG.
       COPY COLBFCYA.
       COPY TABBFOFI.
       COPY TABBFUSR.
       COPY TABBFVLR.
       COPY TABBFCAM.
       COPY SGCBGCLI.
       COPY GNSBGCPT.
       COPY GNSBBMSC.
       COPY GNSBBTAB.
       COPY TABBBOFI.
       COPY TABBBUSR.
       COPY GNSBVCOD.
       COPY TABBVOFI.
       COPY TABBVUSR.
       COPY GNSBVTAB.
       COPY SGCBGDOM.
       COPY GNSBGMSG.
      *COPY GNSNFMSG.
       COPY GNSBFMSG.
      *
      *>>>>
