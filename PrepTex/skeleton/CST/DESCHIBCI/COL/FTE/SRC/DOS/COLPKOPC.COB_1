       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPKOPC.
       AUTHOR.          CONSIST.
      * Programa de Carga de Archivo OPC Nuevo.
       ENVIRONMENT DIVISION.
      *====================
       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *-----------------------
      *<<<< WSS_DTC
      *COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OLD-REQA==.
      *<<<< WSS
      *COPY GNSBRMSG.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGIFD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY COLBROPC.
      *COPY COLBROLD.         COPIAR DENTRO DEL PROGRAMA.
      *    Operacion Credito
      *    -----------------
      *
      *    Nombre Registro : OLD
      *    Clave(s)        : OLD-KEY-IOLD(UU), OLD-STP-ITRN(UU)
      *    Largo           : 218
      *    Bloqueo         : 4
      *    Observaciones   :
      *
       01  OLD.
      *
      *    Filler Compatibilidad VSAM/MVS
           03  OLD-GLS-FLAG                             PIC X(01).
      *
      *MOD-01  STR COD-IOLD
      *    Clave Primaria Registro
           03  OLD-KEY-IREG.
      *
      *KEY     Identificacion Operacion Credito
               05  OLD-KEY-IOLD.
      *
      *            Cod. Int. Comp. Operacion Credito
                   07  OLD-CIC-IOLD.
      *
      *                Centro Asignacion Identificacion
                       09  OLD-CAI-IOLD.
                           11  OLD-COD-TOLD             PIC X(01).
                           11  OLD-COD-COLD             PIC X(03).
      *
      *                Ident. Interna Computacional
                       09  OLD-IIC-IOLD.
                           11  OLD-COD-OOLD.
                               13  OLD-COD-SOLD         PIC X(02).
                               13  OLD-IND-SOLD         PIC X(01).
                           11  OLD-GLS-NOLD             PIC X(05).
      *
      *ING-01
      *        Time Stamp Transaccion
               05  OLD-STP-ITRN.
      *
      *            Fecha Transaccion
                   07  OLD-FEC-FTRN.
                       09  OLD-NUM-STRN                 PIC 9(02).
                       09  OLD-NUM-ATRN                 PIC 9(02).
                       09  OLD-NUM-MTRN                 PIC 9(02).
                       09  OLD-NUM-DTRN                 PIC 9(02).
      *
      *            Hora Transaccion
                   07  OLD-HRA-HRTR.
                       09  OLD-NUM-HHTR                 PIC 9(02).
                       09  OLD-NUM-MMTR                 PIC 9(02).
                       09  OLD-NUM-SSTR                 PIC 9(02).
      *
      *REQ Indicador Tipo Accion
           03  OLD-MSC-TACC                             PIC X(01).
      *
      *    Indicador Status
           03  OLD-MSC-STAT                             PIC X(01).
      *
      *REQ Codigo Origen Transaccion
           03  OLD-COD-OTRN.
      *
      *        Indicador Tipo Origen
               05  OLD-MSC-TTRN                         PIC X(01).
      *
      *        Codigo Tipo Origen
               05  OLD-COD-TTRN                         PIC X(03).
      *
      *REQ Autor Transaccion
           03  OLD-COD-ATRN                             PIC X(12).
      *
      *ELI-01
      *    Digito Verificador Operacion Cursada
      *    03  OLD-VRF-IOLD                             PIC X(01).
      *
      *REQ Valor de Cambio Operacion Credito            TAB VLR
           03  OLD-COD-VCOC.
      *
      *MOD-01  NOM IND-TVOC
      *        Miscelaneo Tipo Valor                    TAB TVAL
               05  OLD-MSC-TVOC                         PIC X(01).
      *
      *        Codigo Valor
               05  OLD-COD-CVOC                         PIC X(03).
      *
      *MOD-01  NOM IND-TCOC
      *        Codigo Tipo Cambio
               05  OLD-COD-TCOC                         PIC X(02).
      *
      *MOD-01  STR COD-IOLD
      *REQ Codigo Clase Operacion Credito               COL AUX
           03  OLD-COD-COOC.
      *
      *        Codigo Tipo Operacion                    TAB TIO
               05  OLD-COD-TOOC                         PIC X(03).
      *
      *ING-01
      *        Codigo Auxiliar Operacion
               05  OLD-COD-AOOC                         PIC X(03).
      *
      *ING-01
      *REQ Codigo Oficina Operacion Credito             TAB OFI
           03  OLD-COD-OFOC                             PIC X(03).
      *
      *    Responsable Mantencion Operacion Credito     TAB USR
           03  OLD-COD-RMOC                             PIC X(12).
      *
      *MOD-01  NOM COD-DEST
      *    Codigo Destino Operacion Credito             COL DES
           03  OLD-COD-CDOC                             PIC X(03).
      *
      *MOD-01  STR OLD-COD-ILDC
      *    Cod. Int. Comp. Linea de Credito
           03  OLD-CIC-ILDC.
      *
      *        Centro Asignacion Identificacion
               05  OLD-CAI-ILDC.
                   07  OLD-COD-TLDC                     PIC X(01).
                   07  OLD-COD-CLDC                     PIC X(03).
      *
      *        Ident. Interna Computacional
               05  OLD-IIC-ILDC.
                   07  OLD-COD-OLDC.
                       09  OLD-COD-SLDC                 PIC X(02).
                       09  OLD-IND-SLDC                 PIC X(01).
                   07  OLD-GLS-NLDC                     PIC X(05).
      *
      *ELI-01
      *    Digito Verificador Linea de Credito
      *    03  OLD-VRF-ILDC                             PIC X(01).
      *
      *REQ Fecha Curse o Colocacion
           03  OLD-FEC-FCOL.
               05  OLD-NUM-SCOL                         PIC 9(02).
               05  OLD-NUM-ACOL                         PIC 9(02).
               05  OLD-NUM-MCOL                         PIC 9(02).
               05  OLD-NUM-DCOL                         PIC 9(02).
      *
      *REQ Fecha Curse Contable
           03  OLD-FEC-FING.
               05  OLD-NUM-SING                         PIC 9(02).
               05  OLD-NUM-AING                         PIC 9(02).
               05  OLD-NUM-MING                         PIC 9(02).
               05  OLD-NUM-DING                         PIC 9(02).
      *
      *REQ Fecha Curse Computacional
           03  OLD-FEC-FINP.
               05  OLD-NUM-SINP                         PIC 9(02).
               05  OLD-NUM-AINP                         PIC 9(02).
               05  OLD-NUM-MINP                         PIC 9(02).
               05  OLD-NUM-DINP                         PIC 9(02).
      *
      *MOD-01  PIC 9(13)V9(05)
      *REQ Monto Credito
           03  OLD-VAL-CRED             COMP-3          PIC 9(11)V9(04).
      *
      *MOD-01  PIC 9(13)V9(05)
      *REQ Saldo Valor Credito
           03  OLD-VAL-SCRE             COMP-3          PIC 9(11)V9(04).
      *
      *ELI-01
      *    Codigo Tipo Tasa Interes                     COL INT
      *    03  OLD-COD-TINT                             PIC X(12).
      *
      *ELI-01
      *    Valor Tasa
      *    03  OLD-SGV-TINT             COMP-3          PIC S9(03)V9(4).
      *
      *ING-01
      *REQ Analisis Feriados (S/N)                      COL AFER
           03  OLD-IND-AFER                             PIC X(01).
      *
      *ING-01
      *REQ Modalidad Calculo Valores Finales            COL MCVF
           03  OLD-MSC-MCVF                             PIC X(01).
      *
      *ING-01
      *REQ Tipo Calculo Vencimientos                    COL TCVE
           03  OLD-MSC-TCVE.
      *
      *ING-01
      *        Base Calculo Credito                     COL BCCR
               05  OLD-MSC-BCCR                         PIC X(01).
      *
      *ING-01
      *        Valores Informados Credito               COL VICR
               05  OLD-MSC-VICR                         PIC X(01).
      *
      *MOD-01  PIC X(01)
      *    Tipo Renovacion                              COL RENO
           03  OLD-IND-RENO                             PIC X(03).
      *
      *MOD-01  PIC X(01)
      *    Condicion Garantia                           COL GARA
           03  OLD-IND-GARA                             PIC X(03).
      *
      *ELI-01
      *    Tipo Tasa Comision                           COL COM
      *    03  OLD-COD-TCOM                             PIC X(04).
      *
      *ELI-01
      *    Valor Tasa Comision
      *    03  OLD-SGV-TCOM             COMP-3          PIC S9(03)V9(4).
      *
      *MOD-01  PIC S9(13)V9(05)
      *MOD-01  NOM SGV-COMI
      *    Valor Comision
           03  OLD-SGV-VCOM             COMP-3          PIC S9(11)V9(4).
      *
      *MOD-01  PIC 9(13)V9(05)
      *    Valor Gastos
           03  OLD-VAL-GAST             COMP-3          PIC S9(11)V9(4).
      *
      *    Codigo de Seguro Desgravamen                 TAB IVB
           03  OLD-COD-SEGD.
               05  OLD-COD-ISEG                         PIC X(03).
               05  OLD-COD-CSEG                         PIC X(03).
               05  OLD-COD-SSEG                         PIC X(03).
      *
      *MOD-01  PIC 9(13)V9(05)
      *MOD-01  NOM VAL-SEGU
      *    Valor Seguro
           03  OLD-VAL-SEGD             COMP-3          PIC 9(11)V9(04).
      *
      *MOD-01  PIC 9(13)V9(05)
      *    Valor Liquido
           03  OLD-SGV-LIQU             COMP-3          PIC S9(11)V9(4).
      *
      *ELI-01
      *    Cursada por Insistencia                      COL CINS
      *    03  OLD-IND-CINS                             PIC X(01).
      *
      *MOD-01  NOM NUM-GPVC
      *REQ Numero Estructura Proximo Vencimiento
           03  OLD-NUM-IEVC                             PIC 9(03).
      *
      *ING-01
      *REQ Numero Vencimientos Originales
           03  OLD-NUM-VCOR                             PIC 9(03).
      *
      *REQ Numero Vencimientos Vigentes
           03  OLD-NUM-VCVG                             PIC 9(03).
      *
      *    Numero Venctos Cancelados en forma Oportuna
           03  OLD-NUM-VCCO                             PIC 9(03).
      *
      *    Numero Vencimientos Cancelados Morosos
           03  OLD-NUM-VCCM                             PIC 9(03).
      *
      *    Numero de Vencimientos Cancelados Vencidos
           03  OLD-NUM-VCCV                             PIC 9(03).
      *
      *REQ Numero Total Vencimientos Cancelados
           03  OLD-NUM-TVCC                             PIC 9(03).
      *
      *MOD-01  STR OLD-COD-ICEN
      *    Cod. Int. Comp. Credito Enlace
           03  OLD-CIC-ICEN.
      *
      *        Centro Asignacion Identificacion
               05  OLD-CAI-ICEN.
                   07  OLD-COD-TCEN                     PIC X(01).
                   07  OLD-COD-CCEN                     PIC X(03).
      *
      *        Ident. Interna Computacional
               05  OLD-IIC-ICEN.
                   07  OLD-COD-OCEN.
                       09  OLD-COD-SCEN                 PIC X(02).
                       09  OLD-IND-SCEN                 PIC X(01).
                   07  OLD-GLS-NCEN                     PIC X(05).
      *
      *ELI-01
      *    Digito Verificador Credito Enlace
      *    03  OLD-VRF-ICEN                             PIC X(01).
      *
      *ELI-01
      *    Ind. ( Switch ) Modificacion en Carga        COL MCAR
      *    03  OLD-IND-MCAR                             PIC X(01).
      *
      *ING-01
      *    Codigo Area Gestion                          COL GES
           03  OLD-COD-AGES                             PIC X(02).
      *
      *MOD-01  PIC X(07)
      *    Glosa Disponible
           03  OLD-GLS-DISP                             PIC X(05).
       01  WSS-VARI.
           03 WSS-NUM-ROLD           VALUE 0      PIC 9(05).
           03 WSS-NUM-RNEW           VALUE 0      PIC 9(05).
           03 WSS-NUM-RMOD           VALUE 0      PIC 9(05).
           03 WSS-NUM-RBAD           VALUE 0      PIC 9(05).
       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
      *------------
       INI-MAIN.
           COPY GNSBGEDB.
           MOVE 'COLPKOPC' TO FIO-PROG.
           PERFORM BUS-FSIS.
      *    PERFORM OPEN-FILE.
           PERFORM LUP-PUT-REG.
           PERFORM CLOSE-FILE.
       FIN-MAIN.
           COPY GNSBGGBK.
      ******************************************************************
       OPEN-FILE SECTION.
      *-----------------
       INI-OPEN-FILE.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-OLD.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR AL ABRIR ARCHIVO ANTIGUAS TABLAS'
               DISPLAY 'FIO-STAT = ' FIO-STAT
               STOP RUN.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR AL ABRIR ARCHIVO ANTIGUAS TABLAS'
               DISPLAY 'FIO-STAT = ' FIO-STAT
               STOP RUN.
       FIN-OPEN-FILE.
           EXIT.
      ******************************************************************
       LUP-PUT-REG SECTION.
      *-------------------
       INI-LUP-REG.
      * Programacion de Ciclo para Registro OLD
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-OLD.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO HAY REGISTROS EN ARCHIVO ANTIGUO '
               GO TO FIN-LUP-REG.
      *         MOVE 'COL'          TO MSG-COD-SIST
      *         MOVE 'OPC    OPCNX' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         DISPLAY MSG-GLS-DESC   OPC-KEY-IOPC IN OPC
       LUP-OLD-NEW.
      * Proceso de Seleccion y Clasificacion a Partir del Registro ANTIG
           ADD 1 TO WSS-NUM-ROLD IN WSS-VARI.
           PERFORM BUS-REG-NEW.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-OLD.
           IF FIO-STAT-OKS
               GO TO LUP-OLD-NEW.
       FIN-LUP-REG.
           EXIT.
      ******************************************************************
      * Formacion y Generacion del Registro NEW al Procesar Registro ANT
       BUS-REG-NEW SECTION.
       INI-BUS-REG-NEW.
      * Formacion del Registro NEW
           MOVE OLD          TO OPC.
      * Genera el Registro NEW
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE FIO-PUT TO FIO-CMND
               PERFORM COL-FIO-OPC
               ADD 1 TO WSS-NUM-RNEW IN WSS-VARI
           ELSE
               MOVE FIO-MOD TO FIO-CMND
               PERFORM COL-FIO-OPC
               ADD 1 TO WSS-NUM-RMOD IN WSS-VARI.
           IF NOT FIO-STAT-OKS
               ADD 1 TO WSS-NUM-RBAD IN WSS-VARI
               DISPLAY 'REGISTRO ERRONEO : '  OPC.
       FIN-BUS-REG-NEW.
           EXIT.
      ******************************************************************
       CLOSE-FILE SECTION.
      *------------------
       INI-CLOSE-FILE.
           DISPLAY 'REGISTROS OLD LEIDOS   : ' WSS-NUM-ROLD IN WSS-VARI.
           DISPLAY 'REGISTROS RECHAZADOS   : ' WSS-NUM-RBAD IN WSS-VARI.
           DISPLAY 'REGISTROS NEW GRABADOS : ' WSS-NUM-RNEW IN WSS-VARI.
           DISPLAY 'REGISTROS MODIFICADOS  : ' WSS-NUM-RMOD IN WSS-VARI.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           PERFORM COL-FIO-OLD.
       FIN-CLOSE-FILE.
           EXIT.
      ******************************************************************
      *COPY GNSBFMSG.
      *COPY GNSBBMSG.
       COPY GNSBGDTC.
       COPY GNSBGIFD.
       COPY GNSBTABT.
       COPY COLBFOPC.
      *COPY COLBFOLD.            COPIAR DENTRO DEL PROGRAMA.
      * Modulo FIO para registro OLD en DATACOM, 16-SEP-1988 17:55:38.03
       COL-FIO-OLD SECTION.
       INI-COL-FIO-OLD.
           MOVE ADR-OLD-REQA TO ADR-REQA.
           MOVE 'OPC' TO ADR-TABL IN ADR-REQA.
           MOVE IFD-GSIS( 14 ) TO ADR-DBID IN ADR-REQA.
           MOVE 'OPC00' TO ADR-ELM1.
           MOVE FIO-PROG TO ADR-PROG.
           IF FIO-KDEF = FIO-KDEF-S
               GO TO CON-COL-FIO-OLD.
           MOVE FIO-CMND TO FIO-IAKY.
           IF NOT FIO-IAKY-CON AND
              ( FIO-AKEY = 'OLD-KEY-IOLD' OR FIO-AKEY NOT > SPACES )
               MOVE OLD-KEY-IOLD IN OLD TO ADR-VKEY IN ADR-REQA
               MOVE 'OPC00' TO ADR-DKEY IN ADR-REQA
           ELSE
               MOVE 'En COL-FIO-OLD, key' TO FIO-MENS
               MOVE FIO-AKEY   TO FIO-MENS-KEY
               MOVE 'Invalida' TO FIO-MENS-FIL
               GO TO PRG-ABT.
       CON-COL-FIO-OLD.
           MOVE OLD TO FIO-DFLD.
           PERFORM GNS-FIO-DTC.
           IF FIO-STAT-OKS
               MOVE FIO-DFLD TO OLD
           ELSE
               MOVE 'COLOLD' TO FIO-MEN2
               IF FIO-STAT-FTL
                   GO TO PRG-ABT.
           MOVE SPACES   TO FIO-AKEY.
           MOVE FIO-KDEF-N TO FIO-KDEF.
           MOVE ADR-REQA TO ADR-OLD-REQA.
       FIN-COL-FIO-OLD.
           EXIT.
