       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPLIC4.
       AUTHOR.          BEE (DPM).
       DATE-WRITTEN.    18-Apr-97 03:59 PM.

      * Programa Listador de Reporte IC4 con Sort.


       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
      *DOS SELECT RPTIC4         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTIC4         ASSIGN TO        UT-S-RPTIC4.
           SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT RPTIC4         ASSIGN TO        UT-S-RPTIC4.
      *<<<< IOS
           SELECT RPTIC5         ASSIGN TO        UT-S-RPTIC5.
           SELECT RPTIC6         ASSIGN TO        UT-S-RPTIC6.
      *>>>>

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY COLRRIC4.
      *<<<< RR
           03 SRT-FLD-DETA   PIC X(209).
      *>>>>
       FD  RPTIC4 LABEL RECORDS OMITTED
           REPORT IS RPT-IC4
      *<<<< FD_RPT
           RECORD CONTAINS 81 CHARACTERS
      *>>>>
           .
      *<<<< FLS
       FD  RPTIC5 LABEL RECORDS OMITTED
           REPORT IS RPT-IC5
           RECORD CONTAINS 81 CHARACTERS.
       FD  RPTIC6 LABEL RECORDS OMITTED
           REPORT IS RPT-IC6
           RECORD CONTAINS 81 CHARACTERS.
      *>>>>

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LMS-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY COLBRLMS.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY COLRWIC4.
      *<<<< RW
       COPY COLRWIC5.
       COPY COLRWIC6.
      *>>>>
       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY TABBROFI.
       COPY GNSBRMSC.
       COPY COLBRCYA.
       COPY COLBRDLC.
       COPY COLBRDCC.
       COPY COLBRTOC.
       COPY COLBRRCV.
       01  WSS-VARI.
           03 WSS-SW-LMS-VACIO  VALUE 'N' PIC X(01).
           03 WSS-IND-CANC VALUE SPACES PIC X(03).
           03 WSS-NUM-ICAN VALUE ZEROES PIC 9(03).
           03 WSS-COD-ULT  VALUE SPACES PIC X(03).
           03 WSS-FLD-T405.
              05 W45-SGV-AMOR   VALUE ZEROES PIC S9(13)V9(02).
              05 W45-SGV-ICTE   VALUE ZEROES PIC S9(13)V9(02).
              05 W45-SGV-IMOR   VALUE ZEROES PIC S9(13)V9(02).
              05 W45-SGV-REAJ   VALUE ZEROES PIC S9(13)V9(02).
              05 W45-SGV-VAPA   VALUE ZEROES PIC S9(13)V9(02).
              05 W45-COD-CANC   PIC X(03).
              05 W45-COD-CCTE   PIC X(08).
              05 W45-COD-ODES   PIC X(03).
              05 W45-NUM-DCUR   PIC 9(02).
              05 W45-NUM-MCUR   PIC 9(02).
              05 W45-NUM-SCUR   PIC 9(02).
              05 W45-NUM-ACUR   PIC 9(02).
      *        05 W45-COD-OFPA VALUE SPACES PIC X(03).
              05 W45-COD-CTOB VALUE SPACES PIC X(12).
              05 W45-SGV-REMO VALUE ZEROES PIC S9(13)V9(02).
              05 W45-COD-VCOC VALUE SPACES PIC X(06).
              05 W45-COD-COOC VALUE SPACES PIC X(06).
              05 FILLER         PIC X(20).
           03 WSS-FLD-T006.
              05 WS6-SGV-VAPA   VALUE ZEROES PIC S9(13)V9(02).
              05 WS6-COD-CCTE   PIC X(08).
              05 FILLER         PIC X(65).
           03 WSS-FEC-FINF.
              05 WSS-NUM-DINF                    PIC 9(02).
              05 WSS-NUM-MINF                    PIC 9(02).
              05 WSS-NUM-SINF                    PIC 9(02).
              05 WSS-NUM-AINF                    PIC 9(02).
           03 WSS-NUM-SSIS                       PIC 9(02).
           03 WSS-FEC-FSIS.
              05 WSS-NUM-ASIS                    PIC 9(02).
              05 WSS-NUM-MSIS                    PIC 9(02).
              05 WSS-NUM-DSIS                    PIC 9(02).
           03 WSS-FEC-FIN2.
              05 WSS-NUM-SIN2       VALUE 19     PIC 9(02).
              05 WSS-NUM-AIN2                    PIC 9(02).
              05 WSS-NUM-MIN2                    PIC 9(02).
              05 WSS-NUM-DIN2                    PIC 9(02).
           03 WSS-COD-OFOC                       PIC X(03).
           03 WSS-COD-OFCR                       PIC X(03).
           03 WSS-COD-OGEN                       PIC X(03).
           03 WSS-COD-OFIC                       PIC X(03).
           03 WSS-COD-NOPE                       PIC X(12).
           03 WSS-MULTIP        VALUE 'N'        PIC X(01).
           03 WSS-TCYA-DUB      VALUE SPACES     PIC X(05).
           03 WSS-TRE-ANTI      VALUE ZERO       PIC 9(01).
           03 WSS-COD-COOC.
              05 WSS-COD-TOOC                    PIC X(03).
              05 WSS-COD-AOOC                    PIC X(03).
           03 WSS-COD-CCTE      VALUE ZEROES     PIC X(08).
           03 WSS-CIC-CCSB                       PIC X(12).
           03 WSS-SORT-VACIO                     PIC X(02) VALUE 'NO'.
               88  SORT-VACIO                     VALUE 'SI'.
           03 WSS-VEO-CYA                        PIC X(01) VALUE 'S'.
               88  VEO-CYA                        VALUE 'S'.
           03 WSS-HORA-LST.
              05 WSS-NUM-HH                      PIC 9(02).
              05 WSS-NUM-MM                      PIC 9(02).
              05 WSS-NUM-SS                      PIC 9(02).
      * totalizador de debe para interfaz
           03 WSS-IND-DISP          VALUE SPACES PIC X(01).
      * INDICADORES DE TIPOS DE CUENTAS
           03 WSS-IND-INT           VALUE SPACES PIC X(03).
           03 WSS-IND-IMO           VALUE SPACES PIC X(03).
           03 WSS-IND-RJS           VALUE SPACES PIC X(03).
           03 WSS-IND-RMO           VALUE SPACES PIC X(03).
           03 WSS-IND-CAP           VALUE SPACES PIC X(03).
           03 WSS-IND-IMP           VALUE SPACES PIC X(03).
           03 WSS-IND-NOT           VALUE SPACES PIC X(03).
           03 WSS-IND-RIM           VALUE SPACES PIC X(03).
           03 WSS-IND-IPN           VALUE SPACES PIC X(03).
           03 WSS-IND-OBL           VALUE SPACES PIC X(03).
           03 WSS-IND-ORD           VALUE SPACES PIC X(03).
           03 WSS-IND-ORH           VALUE SPACES PIC X(03).
           03 WSS-IND-SEG           VALUE SPACES PIC X(03).
           03 WSS-IND-SEP           VALUE SPACES PIC X(03).
           03 WSS-IND-GST           VALUE SPACES PIC X(03).
      *DPM ini  14-APR-1997 Se incluyo cod. REC para AMORT. CAP
           03 WSS-IND-REC           VALUE SPACES PIC X(03).
      *DPM fin  14-APR-1997
           03 WSS-COD-OFIC2      VALUE SPACES PIC X(03).
           03 WSS-MARCA          VALUE '@$%'  PIC X(03).
           03 WSS-FEC-FCUR.
              05 WSS-NUM-DCUR   VALUE ZEROES PIC 9(02).
              05 WSS-NUM-MCUR   VALUE ZEROES PIC 9(02).
              05 WSS-NUM-SCUR   VALUE ZEROES PIC 9(02).
              05 WSS-NUM-ACUR   VALUE ZEROES PIC 9(02).
           03 WSS-COD-VCOC      VALUE SPACES PIC X(06).
           03 WSS-OPEC                      PIC X(01).
      *>>>>
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
      *>>>>

       REPORT SECTION.
      *--------------
       COPY COLRFIC4.
      *<<<< RF
      *>>>>
           .
       COPY COLRTIC4.
      *<<<< RT
       COPY COLRFIC5.
           .
       COPY COLRTIC5.
       COPY COLRFIC6.
           .
       COPY COLRTIC6.
      *>>>>

       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
       DEC-CF-IC4-SRT-COD-OFIC SECTION.
           USE BEFORE REPORTING CF-IC4-SRT-COD-OFIC.
       INI-CF-IC4-SRT-COD-OFIC.
      *<<<< CF_IC4_SRT_COD_OFIC
           MOVE 0 TO PAGE-COUNTER IN RPT-IC4.
      *>>>>
       FIN-CF-IC4-SRT-COD-OFIC.
           EXIT.
       DEC-CF-IC4-SRT-COD-TREG SECTION.
           USE BEFORE REPORTING CF-IC4-SRT-COD-TREG.
       INI-CF-IC4-SRT-COD-TREG.
       FIN-CF-IC4-SRT-COD-TREG.
           EXIT.
       DEC-CF-IC4-SRT-CIC-CCSB SECTION.
           USE BEFORE REPORTING CF-IC4-SRT-CIC-CCSB.
       INI-CF-IC4-SRT-CIC-CCSB.
       FIN-CF-IC4-SRT-CIC-CCSB.
           EXIT.
       DEC-PH-IC4 SECTION.
           USE BEFORE REPORTING PH-IC4.
       INI-PH-IC4.
      *<<<< PH_IC4
           IF SRT-COD-OFIC IN SRT > SPACES
               MOVE SRT-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI
                                           WSS-COD-OFI  IN WSS-IC4
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFOC IN WSS-IC4.

           IF SRT-COD-OFIC IN SRT NOT = WSS-COD-OFIC2 IN WSS-VARI
              MOVE WSS-MARCA IN WSS-VARI TO WSS-IND-CPAG IN WSS-IC4
              MOVE SRT-COD-OFIC IN SRT TO WSS-COD-OFIC2 IN WSS-VARI
           ELSE
              MOVE SPACES TO WSS-IND-CPAG IN WSS-IC4
                             WSS-COD-OFI  IN WSS-IC4.
      *>>>>
       FIN-PH-IC4.
           EXIT.
      *<<<< FIN_DEC
       DEC-CF-IC5-SRT-COD-TREG SECTION.
           USE BEFORE REPORTING CF-IC5-SRT-COD-TREG.
       INI-CF-IC5-SRT-COD-TREG.
       FIN-CF-IC5-SRT-COD-TREG.
           EXIT.
       DEC-CF-IC5-SRT-COD-OFIC SECTION.
           USE BEFORE REPORTING CF-IC5-SRT-COD-OFIC.
       INI-CF-IC5-SRT-COD-OFIC.
           MOVE 0 TO PAGE-COUNTER IN RPT-IC5.
       FIN-CF-IC5-SRT-COD-OFIC.
           EXIT.
       DEC-CF-IC5-SRT-CIC-CCSB SECTION.
           USE BEFORE REPORTING CF-IC5-SRT-CIC-CCSB.
       INI-CF-IC5-SRT-CIC-CCSB.
       FIN-CF-IC5-SRT-CIC-CCSB.
           EXIT.
       DEC-PH-IC5 SECTION.
           USE BEFORE REPORTING PH-IC5.
       INI-PH-IC5.
           IF SRT-COD-OFIC IN SRT > SPACES
               MOVE SRT-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI
                                           WSS-COD-OFI  IN WSS-IC5
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFOC IN WSS-IC5.

           IF SRT-COD-OFIC IN SRT NOT = WSS-COD-OFIC2 IN WSS-VARI
              MOVE WSS-MARCA IN WSS-VARI TO WSS-IND-CPAG IN WSS-IC5
              MOVE SRT-COD-OFIC IN SRT TO WSS-COD-OFIC2 IN WSS-VARI
           ELSE
              MOVE SPACES TO WSS-IND-CPAG IN WSS-IC5
                             WSS-COD-OFI  IN WSS-IC5.
       FIN-PH-IC5.
           EXIT.
       DEC-CF-IC6-SRT-COD-TREG SECTION.
           USE BEFORE REPORTING CF-IC6-SRT-COD-TREG.
       INI-CF-IC6-SRT-COD-TREG.
       FIN-CF-IC6-SRT-COD-TREG.
           EXIT.
       DEC-CF-IC6-SRT-COD-OFIC SECTION.
           USE BEFORE REPORTING CF-IC6-SRT-COD-OFIC.
       INI-CF-IC6-SRT-COD-OFIC.
           MOVE 0 TO PAGE-COUNTER IN RPT-IC6.
       FIN-CF-IC6-SRT-COD-OFIC.
           EXIT.
       DEC-CF-IC6-SRT-COD-ODES SECTION.
           USE BEFORE REPORTING CF-IC6-SRT-COD-ODES.
       INI-CF-IC6-SRT-COD-ODES.
       FIN-CF-IC6-SRT-COD-ODES.
           EXIT.
       DEC-PH-IC6 SECTION.
           USE BEFORE REPORTING PH-IC6.
       INI-PH-IC6.
           IF SRT-COD-OFIC IN SRT > SPACES
               MOVE SRT-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI
                                           WSS-COD-OFI  IN WSS-IC6
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFOC IN WSS-IC6.

           IF SRT-COD-OFIC IN SRT NOT = WSS-COD-OFIC2 IN WSS-VARI
              MOVE WSS-MARCA IN WSS-VARI TO WSS-IND-CPAG IN WSS-IC6
              MOVE SRT-COD-OFIC IN SRT TO WSS-COD-OFIC2 IN WSS-VARI
           ELSE
              MOVE SPACES TO WSS-IND-CPAG IN WSS-IC6
                             WSS-COD-OFI  IN WSS-IC6.
       FIN-PH-IC6.
           EXIT.
      *>>>>
       END DECLARATIVES.

       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'COLPLIC4' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *<<<< INI
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'COL' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-INP TO FIO-CMND.
           MOVE 'TAB' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           DISPLAY '============================'.
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.
           DISPLAY '============================'.
      * Captura Fecha de Proceso
           DISPLAY 'INGRESE FECHA DEL INFORME (DDMMSSAA) '.
           DISPLAY '-------------------------------------'.
           ACCEPT  WSS-FEC-FINF IN WSS-VARI.
           DISPLAY 'FECHA : ' WSS-FEC-FINF IN WSS-VARI.
      * Captura Codigo de Oficina
           DISPLAY 'OFICINA (*=TODAS): '.
           DISPLAY '-------------------'.
           ACCEPT  WSS-COD-OFIC IN WSS-VARI.
           DISPLAY 'OFICINA : ' WSS-COD-OFIC IN WSS-VARI.
           DISPLAY 'FIN    CAPTURA DE PARAMETROS'.
      * Captura Hora del Informe
           ACCEPT WSS-HORA-LST FROM TIME.
      * Captura Fecha del Informe
           ACCEPT WSS-FEC-FSIS FROM DATE.
           IF WSS-NUM-ASIS IN WSS-VARI > 80
              MOVE 19 TO WSS-NUM-SSIS IN WSS-VARI
           ELSE
              MOVE 20 TO WSS-NUM-SSIS IN WSS-VARI.
      * Captura indicador de display
           ACCEPT WSS-IND-DISP IN WSS-VARI.
           IF WSS-IND-DISP IN WSS-VARI NOT = 'S' AND
                                       NOT = 'N'
               MOVE 'N' TO WSS-IND-DISP IN WSS-VARI.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.
           DISPLAY '==============================='.
      *1
      *VAL-FEC Valida Fecha de Informe
           DISPLAY 'FECHA DEL INFORME : ' WSS-FEC-FINF IN WSS-VARI.
           MOVE WSS-FEC-FINF IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-ABT.

      *2
      *VAL-OFI Valida codigo de Oficina en TABLAS
           IF WSS-COD-OFIC IN WSS-VARI NOT = '*' AND
              WSS-COD-OFIC IN WSS-VARI > SPACES
               DISPLAY 'OFICINA : ' WSS-COD-OFIC IN WSS-VARI
               MOVE WSS-COD-OFIC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   PERFORM GNS-PRO-ABT.
      *
           DISPLAY '============================'.
           DISPLAY 'FIN VALIDACION DE PARAMETROS'.
           DISPLAY '============================'.
      *
      * ABRE ARCHIVO CYA
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-CYA.
      *
      * ABRE ARCHIVO DLC
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-DLC.
      *
      * ABRE ARCHIVO DCC
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-DCC.
      *
      * ABRE ARCHIVO RCV
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-RCV.
      *>>>>
           SORT GNSSRT
       COPY COLRSIC4.
      *<<<< RS
      *>>>>
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
      *<<<< FIN
      *>>>>
           IF PGM-STAT-SRT-MAL OR SORT-RETURN > 0
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<< INI_INP
      *RESCATA COD DE SEG
           MOVE 'SEG'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-SEG IN WSS-VARI.
      *RESCATA COD DE SEP
           MOVE 'SEP'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-SEP IN WSS-VARI.
      *RESCATA COD DE GST
           MOVE 'GST'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-GST IN WSS-VARI.
      *RESCATA COD DE INT
           MOVE 'IGA'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-INT IN WSS-VARI.
      *RESCATA COD DE IMO
           MOVE 'IGM'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-IMO IN WSS-VARI.
      *RESCATA COD DE RJS
           MOVE 'RGA'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-RJS IN WSS-VARI.
      *RESCATA COD DE RMO
           MOVE 'RGM'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-RMO IN WSS-VARI.
      *RESCATA COD DE CAP
           MOVE 'CAP'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-CAP IN WSS-VARI.
      *RESCATA COD DE IMP
           MOVE 'IMP'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-IMP IN WSS-VARI.
      *RESCATA COD DE NOT
           MOVE 'NOT'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-NOT IN WSS-VARI.
      *RESCATA COD DE RIM
           MOVE 'RIM'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-RIM IN WSS-VARI.
      *RESCATA COD DE IPN
           MOVE 'IPN'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-IPN IN WSS-VARI.
      *RESCATA COD DE OBL
           MOVE 'OBL'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-OBL IN WSS-VARI.
      *RESCATA COD DE ORD
           MOVE 'ORD'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-ORD IN WSS-VARI.
      *RESCATA COD DE ORH
           MOVE 'ORH'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-ORH IN WSS-VARI.
      *DPM ini  14-APR-1997
      *RESCATA COD DE REC
           MOVE 'REC'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-REC IN WSS-VARI.
      *DPM fin  14-APR-1997
      *>>>>
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-LMS.
       FST-INP-SRT.
      *<<<< INI_FST_INP
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-LMS.
      *<<<< FIN_FST_INP
      *CHEQUEA QUE LMS TENGA DATOS
           IF NOT FIO-STAT-OKS
               DISPLAY ' ARCHIVO DE ENTRADAA COLLMS VACIO'
               DISPLAY 'FIN DEL PROCESO...'
               DISPLAY ' '
               MOVE 'S' TO WSS-SW-LMS-VACIO IN WSS-VARI
               GO TO EXT-INP-SRT.
      *
      * INICIO DE PRIMERA LECTURA SECUENCIAL DE ARCHIVO LMS.
           IF WSS-COD-OFIC IN WSS-VARI NOT = '*'
               PERFORM POS-OFI-PAR.
      *
      *ALMACENA CODIGO DE OFICINA Y NUMERO DE OPERACION
           MOVE LMS-COD-OFOC IN LMS TO WSS-COD-OFOC IN WSS-VARI.
           MOVE LMS-COD-MVTO IN LMS TO WSS-COD-ULT  IN WSS-VARI.
           MOVE LMS-COD-OGEN IN LMS TO WSS-COD-OGEN IN WSS-VARI.
           MOVE LMS-COD-OFCR IN LMS TO WSS-COD-OFCR IN WSS-VARI.
           IF LMS-COD-MVTO IN LMS = 'CUR'
              MOVE LMS-CIC-IOPC IN LMS TO WSS-COD-NOPE IN WSS-VARI
           ELSE
              MOVE LMS-CIC-IOPC IN LMS TO WSS-COD-NOPE IN WSS-VARI
              MOVE LMS-NUM-ICAN IN LMS TO WSS-NUM-ICAN IN WSS-VARI
              MOVE LMS-IND-CANC IN LMS TO WSS-IND-CANC IN WSS-VARI.
           MOVE LMS-CIC-CCSB IN LMS TO WSS-CIC-CCSB IN WSS-VARI.
      *SE MUEVE FECHA DE PROCESO SEGUN FECHA DEL SISTEMA
           MOVE WSS-NUM-SSIS IN WSS-VARI TO WSS-NUM-SPRO IN WSS-IC4
                                            WSS-NUM-SPRO IN WSS-IC5
                                            WSS-NUM-SPRO IN WSS-IC6.
           MOVE WSS-NUM-ASIS IN WSS-VARI TO WSS-NUM-APRO IN WSS-IC4
                                            WSS-NUM-APRO IN WSS-IC5
                                            WSS-NUM-APRO IN WSS-IC6.
           MOVE WSS-NUM-MSIS IN WSS-VARI TO WSS-NUM-MPRO IN WSS-IC4
                                            WSS-NUM-MPRO IN WSS-IC5
                                            WSS-NUM-MPRO IN WSS-IC6.
           MOVE WSS-NUM-DSIS IN WSS-VARI TO WSS-NUM-DPRO IN WSS-IC4
                                            WSS-NUM-DPRO IN WSS-IC5
                                            WSS-NUM-DPRO IN WSS-IC6.

           MOVE LMS-FEC-FPRO IN LMS      TO LMS-FEC-FCTB IN LMS.
           MOVE LMS-COD-VCOC IN LMS      TO WSS-COD-VCOC IN WSS-VARI.
           MOVE LMS-COD-COOC IN LMS      TO WSS-COD-COOC IN WSS-VARI.

      * FECHA CONTABLE (LMC) A VARIABLES WSS DE REPORTES
           MOVE LMS-NUM-DCTB IN LMS      TO SRT-NUM-DCTB IN SRT.
           MOVE LMS-NUM-MCTB IN LMS      TO SRT-NUM-MCTB IN SRT.
           MOVE LMS-NUM-SCTB IN LMS      TO SRT-NUM-SCTB IN SRT.
           MOVE LMS-NUM-ACTB IN LMS      TO SRT-NUM-ACTB IN SRT.

      * SE MUEVE PRIMERA FECHA DEL ARCHIVO
           MOVE LMS-NUM-DREA IN LMS      TO WSS-NUM-DCUR IN WSS-VARI.
           MOVE LMS-NUM-MREA IN LMS      TO WSS-NUM-MCUR IN WSS-VARI.
           MOVE LMS-NUM-AREA IN LMS      TO WSS-NUM-ACUR IN WSS-VARI.
           MOVE LMS-NUM-SREA IN LMS      TO WSS-NUM-SCUR IN WSS-VARI.

      * SE MUEVE FECHA DE PROCESO A FECHA AUXILIAR PARA SU
      * VALIDACION CON FECHA CONTABLE (LMS)
           MOVE WSS-NUM-DINF IN WSS-VARI TO WSS-NUM-DIN2 IN WSS-VARI.
           MOVE WSS-NUM-MINF IN WSS-VARI TO WSS-NUM-MIN2 IN WSS-VARI.
           MOVE WSS-NUM-AINF IN WSS-VARI TO WSS-NUM-AIN2 IN WSS-VARI.
           MOVE WSS-NUM-SINF IN WSS-VARI TO WSS-NUM-SIN2 IN WSS-VARI.
      * VALIDA FECHA EN ARCHIVO CON LA DEL PARAMETRO JCL
           IF LMS-FEC-FCTB IN LMS NOT = WSS-FEC-FIN2 IN WSS-VARI
              DISPLAY ' **** FECHA CONTABLE  EN  ARCHIVO ES'
              DISPLAY ' **** DISTINTA A LA FECHA DE PROCESO'
              DISPLAY ' **** SEGUN PARAMETRO........... '
              DISPLAY ' **** EL PROCESO SE AUTOCANCELA '
              DISPLAY 'FECHA PARAMETRO : ' WSS-FEC-FIN2 IN WSS-VARI
              DISPLAY 'FECHA EN MOVTOS : ' LMS-FEC-FCTB IN LMS
              PERFORM GNS-PRO-ABT.
      *>>>>
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
           IF WSS-IND-DISP IN WSS-VARI = 'S'
               DISPLAY 'LUP INP'
               DISPLAY 'LMS COD MVTO ' LMS-COD-MVTO IN LMS
               DISPLAY 'LMS CIC IOPC ' LMS-CIC-IOPC IN LMS
               DISPLAY 'LMS NUM ICAN ' LMS-NUM-ICAN IN LMS
               DISPLAY 'LMS COD OFOC ' LMS-COD-OFOC IN LMS
               DISPLAY 'WSS COD ULT ' WSS-COD-ULT
               DISPLAY 'WSS CIC NOPE ' WSS-COD-NOPE
               DISPLAY 'WSS NUM ICAN ' WSS-NUM-ICAN
               DISPLAY 'WSS COD OFOC ' WSS-COD-OFOC IN WSS-VARI.

           IF LMS-COD-MVTO IN LMS NOT = WSS-COD-ULT AND
              WSS-COD-ULT IN WSS-VARI = 'CAN'
               PERFORM GRABA-REG-456
               PERFORM LIMPIA-REG45
               PERFORM LIMPIA-REG6
               MOVE LMS-COD-OFOC IN LMS TO WSS-COD-OFOC IN WSS-VARI
               MOVE LMS-COD-MVTO IN LMS TO WSS-COD-ULT IN WSS-VARI
               MOVE LMS-COD-OGEN IN LMS TO WSS-COD-OGEN IN WSS-VARI
               MOVE LMS-COD-OFCR IN LMS TO WSS-COD-OFCR IN WSS-VARI
               MOVE LMS-CIC-IOPC IN LMS TO WSS-COD-NOPE IN WSS-VARI
               MOVE LMS-NUM-ICAN IN LMS TO WSS-NUM-ICAN IN WSS-VARI
               MOVE LMS-COD-VCOC IN LMS TO WSS-COD-VCOC IN WSS-VARI
               MOVE LMS-COD-COOC IN LMS TO WSS-COD-COOC IN WSS-VARI.

           IF LMS-COD-MVTO IN LMS = 'CAN' OR 'VEN'
              IF LMS-CIC-IOPC IN LMS = WSS-COD-NOPE IN WSS-VARI
                 AND LMS-NUM-ICAN IN LMS = WSS-NUM-ICAN IN WSS-VARI
      *DPM ini  14-APR-1997
      *            IF LMS-MSC-TCCT IN LMS = WSS-IND-CAP IN WSS-VARI
                  IF LMS-MSC-TCCT IN LMS = WSS-IND-CAP IN WSS-VARI OR
                     LMS-MSC-TCCT IN LMS = WSS-IND-REC IN WSS-VARI
      *DPM fin  14-APR-1997
                     PERFORM DATOS-CAP456
                  ELSE
                     PERFORM SETEA-DATOS-456
                     IF LMS-IND-LIQU IN LMS = 'L ' AND VEO-CYA
                        PERFORM PRO-CYA
                        MOVE 'N' TO WSS-VEO-CYA IN WSS-VARI
                     ELSE
                        NEXT SENTENCE
              ELSE
                  PERFORM GRABA-REG-456
                  PERFORM LIMPIA-REG45
                  PERFORM LIMPIA-REG6
                  MOVE 'S' TO WSS-VEO-CYA IN WSS-VARI
                  MOVE ZEROES TO WSS-COD-CCTE IN WSS-VARI
                  PERFORM GRABA-WSS456.
           GO TO NXT-INP-SRT.
      *>>>>
       MOV-INP-SRT.
       COPY COLRMIC4.
      *<<<< RM
      *>>>>
           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-LMS.
      *<<<< FIN_NXT_INP
      *>>>>
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
      *<<<< FIN_INP
           IF WSS-COD-ULT IN WSS-VARI = 'CAN' OR 'VEN'
              PERFORM GRABA-REG-456
              PERFORM LIMPIA-REG45
              PERFORM LIMPIA-REG6.

       EXT-INP-SRT.
      *>>>>
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-LMS.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
      *<<<< INI_OUT
           IF WSS-SW-LMS-VACIO IN WSS-VARI = 'S'
               GO TO EXT-OUT-SRT.
           DISPLAY '--> FIN PROCESO DE SORT'.
           DISPLAY '--> INICIO PROCESO DE INFORMES'.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-OFI.
           OPEN OUTPUT RPTIC5.
           OPEN OUTPUT RPTIC6.
           INITIATE RPT-IC5 RPT-IC6.
           GO TO PARRAFO.
      *>>>>
           OPEN OUTPUT RPTIC4.
      *     MOVE 'COLPLIC4' TO RPT-NPGM.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-IC4.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
      *<<<< FST_OUT
       PARRAFO.
           OPEN OUTPUT RPTIC4.
      *     MOVE 'COLPLIC4' TO RPT-NPGM.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-IC4.
           MOVE 'NO' TO WSS-SORT-VACIO.
           RETURN GNSSRT AT END
           MOVE 'SI' TO WSS-SORT-VACIO
           GO TO FIN-OUT-SRT.
           MOVE SRT-CIC-CCSB IN SRT TO WSS-CIC-CCSB IN WSS-VARI.
           MOVE SRT-COD-OFIC IN SRT TO WSS-COD-OFOC IN WSS-VARI.
           MOVE SRT-COD-TREG IN SRT TO WSS-TRE-ANTI IN WSS-VARI.
           PERFORM DATOS-MASCARA.
      *>>>>
       LUP-OUT-SRT.
      *<<<< LUP_OUT
           DISPLAY 'SRT ' SRT.
           PERFORM MUEVE-FEC-SORT-RPT.

           IF SRT-COD-TREG IN SRT NOT = WSS-TRE-ANTI IN WSS-VARI
               MOVE SPACES              TO WSS-COD-OFIC2 IN WSS-VARI
               MOVE SRT-CIC-CCSB IN SRT TO WSS-CIC-CCSB IN WSS-VARI
               MOVE SRT-COD-OFIC IN SRT TO WSS-COD-OFOC IN WSS-VARI
               MOVE SRT-COD-TREG IN SRT TO WSS-TRE-ANTI IN WSS-VARI.

           IF SRT-COD-TREG IN SRT = 4
              PERFORM PROCESA-REG-4
              GENERATE DL-IC4
              GO TO NXT-OUT-SRT.

           IF SRT-COD-TREG IN SRT = 5
              PERFORM PROCESA-REG-5
              GENERATE DL-IC5
              GO TO NXT-OUT-SRT.

           IF SRT-COD-TREG IN SRT = 6
              PERFORM PROCESA-REG-6
              GENERATE DL-IC6
              GO TO NXT-OUT-SRT.

           GO TO NXT-OUT-SRT.
      *>>>>
       GEN-OUT-SRT.
           GENERATE DL-IC4.
      *<<<< FIN_GEN_OUT
      *>>>>
       NXT-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
      *<<<< FIN_OUT
           TERMINATE RPT-IC5 RPT-IC6.
      *>>>>
           TERMINATE RPT-IC4.
      *<<<< FIN_TMT
           CLOSE RPTIC5 RPTIC6.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           PERFORM COL-FIO-DLC.
           PERFORM COL-FIO-DCC.
           PERFORM COL-FIO-RCV.

           MOVE 'COL' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE 'TAB' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *>>>>
           CLOSE RPTIC4.
       EXT-OUT-SRT.
           EXIT.
       COPY COLBFLMS.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGABT.

      *<<<< EOF
       COPY TABBFOFI.
       COPY TABBBOFI.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBFMSC.
       COPY TABBVOFI.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY COLBFCYA.
       COPY COLBFDLC.
       COPY COLBFDCC.
       COPY COLBFTOC.
       COPY COLBFRCV.
      *
       DATOS-CAP456 SECTION.
       INI-DATOS-CAP456.
           MOVE LMS-IND-CANC IN LMS TO WSS-IND-CANC IN WSS-VARI.
           MOVE LMS-COD-OFOC IN LMS TO WSS-COD-OFOC IN WSS-VARI.
           MOVE LMS-CIC-CCSB IN LMS TO WSS-CIC-CCSB IN WSS-VARI.
           MOVE LMS-COD-COOC IN LMS TO WSS-COD-COOC IN WSS-VARI.
           MOVE LMS-CIC-IOPC IN LMS TO WSS-COD-NOPE IN WSS-VARI.
           MOVE LMS-NUM-ICAN IN LMS TO WSS-NUM-ICAN IN WSS-VARI.
           MOVE LMS-COD-OFCR IN LMS TO WSS-COD-OFCR IN WSS-VARI.
           MOVE LMS-COD-OGEN IN LMS TO WSS-COD-OGEN IN WSS-VARI.
           MOVE LMS-SGV-ICTB IN LMS TO W45-SGV-AMOR IN WSS-VARI.
       FIN-DATOS-CAP456.
           EXIT.

       PRO-CYA SECTION.
       INI-PRO-CYA.
           MOVE LMS-CIC-IOPC IN LMS TO CYA-CIC-IOPC IN CYA.
           MOVE LMS-NUM-ICAN IN LMS TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF NOT FIO-STAT-OKS
              OR CYA-CIC-IOPC IN CYA  NOT = LMS-CIC-IOPC IN LMS
              OR CYA-NUM-ICAN IN CYA  NOT = LMS-NUM-ICAN IN LMS
              MOVE 'CYACUR INEX' TO  MSG-COD-MENS IN MSG
              DISPLAY 'NO EXISTE CYA PARA OPER: ' LMS-CIC-IOPC
              DISPLAY 'FIO-STAT:' FIO-STAT
              MOVE SPACES TO WSS-TCYA-DUB IN WSS-VARI
              MOVE ZEROES TO WSS-COD-CCTE IN WSS-VARI
           ELSE
              MOVE 'N' TO WSS-MULTIP IN WSS-VARI
              MOVE CYA-IND-TCYA IN CYA TO WSS-TCYA-DUB IN WSS-VARI
              MOVE CYA-IIC-ICYA IN CYA TO WSS-COD-CCTE IN WSS-VARI.
       FIN-PRO-CYA.
           EXIT.

       GRABA-REG-456 SECTION.
       INI-GRABA-REG-456.
           PERFORM MUEVE-FEC-CUR.
           IF WSS-MULTIP IN WSS-VARI = 'S'
              MOVE 'MULT'                   TO SRT-COD-TCYA IN SRT
           ELSE
              MOVE WSS-TCYA-DUB IN WSS-VARI TO SRT-COD-TCYA IN SRT
              MOVE WSS-COD-CCTE IN WSS-VARI TO W45-COD-CCTE IN WSS-VARI
                                               WS6-COD-CCTE IN WSS-VARI.

           PERFORM BUS-CTA-CAP.

           IF WSS-COD-OFCR IN WSS-VARI = WSS-COD-OGEN IN WSS-VARI AND
              WSS-COD-OFCR IN WSS-VARI = WSS-COD-OFOC IN WSS-VARI
              MOVE WSS-COD-OFCR IN WSS-VARI TO SRT-COD-OFIC IN SRT
              MOVE WSS-COD-OGEN IN WSS-VARI TO SRT-COD-OFOC IN SRT
              MOVE WSS-CIC-CCSB IN WSS-VARI TO SRT-CIC-CCSB IN SRT
              MOVE WSS-COD-NOPE IN WSS-VARI TO SRT-CIC-IOPC IN SRT
              MOVE 4                        TO SRT-COD-TREG IN SRT
              MOVE WSS-IND-CANC IN WSS-VARI
                                       TO W45-COD-CANC IN WSS-VARI
              MOVE WSS-FLD-T405 IN WSS-VARI TO SRT-FLD-DETA IN SRT
              RELEASE SRT
           ELSE
      * REGISTRO 5
              MOVE WSS-COD-OFCR IN WSS-VARI TO SRT-COD-OFIC IN SRT
              MOVE WSS-CIC-CCSB IN WSS-VARI TO SRT-CIC-CCSB IN SRT
              MOVE WSS-COD-NOPE IN WSS-VARI TO SRT-CIC-IOPC IN SRT
              MOVE 5                        TO SRT-COD-TREG IN SRT
              MOVE WSS-COD-VCOC IN WSS-VARI TO W45-COD-VCOC IN WSS-VARI
              MOVE WSS-COD-COOC IN WSS-VARI TO W45-COD-COOC IN WSS-VARI
              MOVE WSS-IND-CANC IN WSS-VARI TO W45-COD-CANC IN WSS-VARI
              MOVE WSS-COD-OGEN IN WSS-VARI TO SRT-COD-OFOC IN SRT
              MOVE WSS-FLD-T405 IN WSS-VARI TO SRT-FLD-DETA IN SRT
              RELEASE SRT
              MOVE 6                        TO SRT-COD-TREG IN SRT
              MOVE WSS-COD-OGEN IN WSS-VARI TO SRT-COD-OFIC IN SRT
              MOVE WSS-COD-NOPE IN WSS-VARI TO SRT-CIC-IOPC IN SRT
              MOVE WSS-COD-OFCR IN WSS-VARI TO SRT-COD-ODES IN SRT
              MOVE WSS-FLD-T006 IN WSS-VARI TO SRT-FLD-DETA IN SRT
              MOVE SPACES                   TO SRT-CIC-CCSB IN SRT
              RELEASE SRT
              GO TO FIN-GRABA-REG-456.
      *
       LUP-GRABA-REG-456.
      *DPM ini  14-APR-1997
      *     IF LMS-MSC-TCCT = WSS-IND-CAP IN WSS-VARI
           IF LMS-MSC-TCCT = WSS-IND-CAP IN WSS-VARI OR
              LMS-MSC-TCCT = WSS-IND-REC IN WSS-VARI
      *DPM ini  14-APR-1997
              MOVE LMS-SGV-ICTB IN LMS TO W45-SGV-AMOR IN WSS-VARI.
           IF LMS-MSC-TCCT = WSS-IND-INT IN WSS-VARI
              MOVE LMS-SGV-ICTB IN LMS TO W45-SGV-ICTE IN WSS-VARI.
           IF LMS-MSC-TCCT = WSS-IND-IMO IN WSS-VARI
              MOVE LMS-SGV-ICTB IN LMS TO W45-SGV-IMOR IN WSS-VARI.
           IF LMS-MSC-TCCT = WSS-IND-RJS IN WSS-VARI
              MOVE LMS-SGV-ICTB IN LMS TO W45-SGV-REAJ IN WSS-VARI.
           IF LMS-IND-LIQU = 'L '
              ADD  LMS-SGV-ICTB IN LMS TO W45-SGV-VAPA IN WSS-VARI
                                          WS6-SGV-VAPA IN WSS-VARI.
       FIN-GRABA-REG-456.
           EXIT.
      *
       SETEA-DATOS-456 SECTION.
       INI-SETEA-DATOS-456.
           IF LMS-MSC-TCCT = WSS-IND-INT IN WSS-VARI
              MOVE LMS-SGV-ICTB IN LMS TO W45-SGV-ICTE IN WSS-VARI.

           IF LMS-MSC-TCCT = WSS-IND-IMO IN WSS-VARI
              MOVE LMS-SGV-ICTB IN LMS TO W45-SGV-IMOR IN WSS-VARI.

           IF LMS-MSC-TCCT = WSS-IND-RJS IN WSS-VARI OR
              LMS-MSC-TCCT = WSS-IND-RMO IN WSS-VARI
              ADD LMS-SGV-ICTB IN LMS TO W45-SGV-REAJ IN WSS-VARI.

           IF LMS-MSC-TCCT = WSS-IND-OBL IN WSS-VARI
              MOVE LMS-CIC-CCSB IN LMS TO W45-COD-CTOB IN WSS-VARI.

           IF LMS-IND-LIQU = 'L '
              ADD  LMS-SGV-ICTB IN LMS TO W45-SGV-VAPA IN WSS-VARI
                                          WS6-SGV-VAPA IN WSS-VARI.
       FIN-SETEA-DATOS-456.
           EXIT.

       GRABA-WSS456 SECTION.
       INI-GRABA-WSS456.
           MOVE LMS-IND-CANC IN LMS TO WSS-IND-CANC IN WSS-VARI.
           MOVE LMS-COD-OFCR IN LMS TO WSS-COD-OFCR IN WSS-VARI.
           MOVE LMS-COD-OGEN IN LMS TO WSS-COD-OGEN IN WSS-VARI.
           MOVE LMS-COD-OFOC IN LMS TO WSS-COD-OFOC IN WSS-VARI.
           MOVE LMS-CIC-CCSB IN LMS TO WSS-CIC-CCSB IN WSS-VARI.
           MOVE LMS-COD-COOC IN LMS TO WSS-COD-COOC IN WSS-VARI.
           MOVE LMS-CIC-IOPC IN LMS TO WSS-COD-NOPE IN WSS-VARI.
           MOVE LMS-NUM-ICAN IN LMS TO WSS-NUM-ICAN IN WSS-VARI.
           MOVE LMS-COD-VCOC IN LMS TO WSS-COD-VCOC IN WSS-VARI.
      *DPM ini  14-APR-1997
      *     IF LMS-MSC-TCCT IN LMS = WSS-IND-CAP IN WSS-VARI
           IF LMS-MSC-TCCT IN LMS = WSS-IND-CAP IN WSS-VARI OR
              LMS-MSC-TCCT IN LMS = WSS-IND-REC IN WSS-VARI
      *DPM ini  14-APR-1997
              PERFORM DATOS-CAP456
           ELSE
              PERFORM SETEA-DATOS-456
              IF LMS-IND-LIQU IN LMS = 'L ' AND VEO-CYA
                 PERFORM PRO-CYA
                 MOVE 'N' TO WSS-VEO-CYA IN WSS-VARI.
       FIN-GRABA-WSS456.
           EXIT.

       LIMPIA-REG45 SECTION.
       INI-LIMPIA-REG45.
           MOVE SPACES  TO WSS-TCYA-DUB IN WSS-VARI.
           MOVE ZEROES  TO W45-SGV-AMOR IN WSS-VARI.
           MOVE ZEROES  TO W45-SGV-ICTE IN WSS-VARI.
           MOVE ZEROES  TO W45-SGV-IMOR IN WSS-VARI.
           MOVE ZEROES  TO W45-SGV-REAJ IN WSS-VARI.
           MOVE ZEROES  TO W45-SGV-VAPA IN WSS-VARI.
      *     MOVE SPACES  TO W45-COD-OFPA IN WSS-VARI.
           MOVE SPACES  TO W45-COD-CANC IN WSS-VARI.
           MOVE SPACES  TO W45-COD-CCTE IN WSS-VARI.
           MOVE SPACES  TO W45-COD-ODES IN WSS-VARI.
           MOVE SPACES  TO W45-COD-CTOB IN WSS-VARI.
           MOVE ZEROES  TO W45-NUM-DCUR IN WSS-VARI.
           MOVE ZEROES  TO W45-NUM-MCUR IN WSS-VARI.
           MOVE ZEROES  TO W45-NUM-SCUR IN WSS-VARI.
           MOVE ZEROES  TO W45-NUM-ACUR IN WSS-VARI.
       FIN-LIMPIA-REG45.
           EXIT.

       LIMPIA-REG6 SECTION.
       INI-LIMPIA-REG6.
           MOVE ZEROES  TO WS6-SGV-VAPA IN WSS-VARI.
           MOVE SPACES  TO WS6-COD-CCTE IN WSS-VARI.
       FIN-LIMPIA-REG6.
           EXIT.

       DATOS-MASCARA SECTION.
       INI-DATOS-MASCARA.
           IF SRT-COD-OFIC IN SRT > SPACES
               MOVE SRT-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
      * OFICINA
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFOC IN WSS-IC4
                                           WSS-GLS-OFOC IN WSS-IC5
                                           WSS-GLS-OFOC IN WSS-IC6.
      * HORA INFORME
           MOVE WSS-NUM-HH  IN WSS-VARI TO WSS-NUM-HORA IN WSS-IC4
                                           WSS-NUM-HORA IN WSS-IC5
                                           WSS-NUM-HORA IN WSS-IC6.
      *
           MOVE WSS-NUM-MM  IN WSS-VARI TO WSS-NUM-MINU IN WSS-IC4
                                           WSS-NUM-MINU IN WSS-IC5
                                           WSS-NUM-MINU IN WSS-IC6.
      *
           MOVE WSS-NUM-SS  IN WSS-VARI TO WSS-NUM-SEGU IN WSS-IC4
                                           WSS-NUM-SEGU IN WSS-IC5
                                           WSS-NUM-SEGU IN WSS-IC6.
       FIN-DATOS-MASCARA.
           EXIT.

       PROCESA-REG-4 SECTION.
       INI-PROCESA-REG-4.
           MOVE SRT-FLD-DETA IN SRT TO WSS-FLD-T405 IN WSS-VARI
           MOVE W45-SGV-AMOR IN WSS-VARI TO WSS-SGV-AMCA IN WSS-IC4.
           MOVE W45-SGV-ICTE IN WSS-VARI TO WSS-SGV-INCT IN WSS-IC4.
           MOVE W45-SGV-IMOR IN WSS-VARI TO WSS-SGV-MORA IN WSS-IC4.
           MOVE W45-SGV-REAJ IN WSS-VARI TO WSS-SGV-REAJ IN WSS-IC4.
           MOVE W45-SGV-VAPA IN WSS-VARI TO WSS-SGV-VAPA IN WSS-IC4.
           MOVE W45-COD-CCTE IN WSS-VARI TO WSS-NUM-CCSB IN WSS-IC4.
           MOVE W45-COD-CANC IN WSS-VARI TO WSS-IND-CANC IN WSS-IC4.
           MOVE W45-COD-CTOB IN WSS-VARI TO WSS-CTA-OBLI IN WSS-IC4.
       FIN-PROCESA-REG-4.
           EXIT.

       PROCESA-REG-5 SECTION.
       INI-PROCESA-REG-5.
           MOVE SRT-FLD-DETA IN SRT TO WSS-FLD-T405 IN WSS-VARI
           MOVE W45-SGV-AMOR IN WSS-VARI TO WSS-SGV-AMCA IN WSS-IC5.
           MOVE W45-SGV-ICTE IN WSS-VARI TO WSS-SGV-INCT IN WSS-IC5.
           MOVE W45-SGV-IMOR IN WSS-VARI TO WSS-SGV-MORA IN WSS-IC5.
           MOVE W45-SGV-REAJ IN WSS-VARI TO WSS-SGV-REAJ IN WSS-IC5.
           MOVE W45-SGV-VAPA IN WSS-VARI TO WSS-SGV-VAPA IN WSS-IC5.
           MOVE W45-COD-CCTE IN WSS-VARI TO WSS-NUM-CCSB IN WSS-IC5.
           MOVE W45-COD-CTOB IN WSS-VARI TO WSS-CTA-OBLI IN WSS-IC5.
           MOVE W45-COD-CANC IN WSS-VARI TO WSS-IND-CANC IN WSS-IC5.
      *     MOVE W45-COD-OFPA IN WSS-VARI TO WSS-COD-OFOC IN WSS-IC5.
       FIN-PROCESA-REG-5.
           EXIT.

       PROCESA-REG-6 SECTION.
       INI-PROCESA-REG-6.
           MOVE SRT-FLD-DETA IN SRT TO WSS-FLD-T006 IN WSS-VARI
           MOVE WS6-SGV-VAPA IN WSS-VARI TO WSS-SGV-VAPA IN WSS-IC6.
           MOVE WS6-COD-CCTE IN WSS-VARI TO WSS-NUM-CCSB IN WSS-IC6.
       FIN-PROCESA-REG-6.
           EXIT.

       POS-OFI-PAR SECTION.
       INI-POS-OFI-PAR.
           IF NOT FIO-STAT-OKS
               GO TO FIN-POS-OFI-PAR.
           IF WSS-COD-OFIC IN WSS-VARI NOT = LMS-COD-OFOC IN LMS
               MOVE FIO-GET-NXT TO FIO-CMND
               PERFORM COL-FIO-LMS
               GO TO INI-POS-OFI-PAR.
           GO TO FIN-POS-OFI-PAR.
       FIN-POS-OFI-PAR.
           EXIT.

       PROCESA-ULT-ANTERIOR SECTION.
       INI-PRO-ULT-ANT.
           IF WSS-TRE-ANTI IN WSS-VARI = 4
              GO TO EXI-PRO-ULT-ANT.

           IF WSS-TRE-ANTI IN WSS-VARI = 5
              GO TO EXI-PRO-ULT-ANT.

           IF WSS-TRE-ANTI IN WSS-VARI = 6
              GO TO EXI-PRO-ULT-ANT.

       EXI-PRO-ULT-ANT.
           MOVE SRT-COD-TREG IN SRT TO WSS-TRE-ANTI IN WSS-VARI.
       FIN-PRO-ULT-ANT.
           EXIT.

       BUSCA-CIC-TCCT SECTION.
       INI-BUSCA-TCCT.
           MOVE 'COL'                            TO FIO-SIST.
           MOVE 'MSC'                            TO MSC-CIC-TTAB IN MSC.
           MOVE 'TCCT'                           TO MSC-CIC-TMSC IN MSC.
           MOVE FIO-GET-KEY                      TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
              MOVE 'COL'       TO MSG-COD-SIST
              MOVE 'CODTCYANX' TO MSG-COD-MENS IN MSG
              PERFORM GET-MSG
              DISPLAY MSG-GLS-DESC   MSC-COD-CMSC
              DISPLAY 'LLAVE : ' MSC-CIC-CMSC IN MSC
              PERFORM GNS-PRO-ABT.
       FIN-BUSCA-CIC-TCCT.
           EXIT.

       MUEVE-FEC-CUR SECTION.
       INI-MUEVE-FEC-CUR.
      * SE MUEVE FECHA REAL DEL CURSE DESDE EL LMS
           MOVE WSS-NUM-DCUR IN WSS-VARI TO W45-NUM-DCUR IN WSS-VARI.
           MOVE WSS-NUM-MCUR IN WSS-VARI TO W45-NUM-MCUR IN WSS-VARI.
           MOVE WSS-NUM-SCUR IN WSS-VARI TO W45-NUM-SCUR IN WSS-VARI.
           MOVE WSS-NUM-ACUR IN WSS-VARI TO W45-NUM-ACUR IN WSS-VARI.

      * SE MUEVE SIGUIENTE FECHA DEL ARCHIVO
           MOVE LMS-NUM-DREA IN LMS      TO WSS-NUM-DCUR IN WSS-VARI.
           MOVE LMS-NUM-MREA IN LMS      TO WSS-NUM-MCUR IN WSS-VARI.
           MOVE LMS-NUM-SREA IN LMS      TO WSS-NUM-SCUR IN WSS-VARI.
           MOVE LMS-NUM-AREA IN LMS      TO WSS-NUM-ACUR IN WSS-VARI.
       FIN-MUEVE-FEC-CUR.
           EXIT.

       MUEVE-FEC-SORT-RPT SECTION.
       INI-MUEVE-FEC-SORT-RPT.
           MOVE SRT-FLD-DETA IN SRT TO WSS-FLD-T405 IN WSS-VARI.
      * SE MUEVE FECHA REAL DEL CURSE DESDE SORT
           MOVE W45-NUM-DCUR IN WSS-VARI TO WSS-NUM-DCUR IN WSS-IC4
                                            WSS-NUM-DCUR IN WSS-IC5.
           MOVE W45-NUM-MCUR IN WSS-VARI TO WSS-NUM-MCUR IN WSS-IC4
                                            WSS-NUM-MCUR IN WSS-IC5.
           MOVE W45-NUM-SCUR IN WSS-VARI TO WSS-NUM-SCUR IN WSS-IC4
                                            WSS-NUM-SCUR IN WSS-IC5.
           MOVE W45-NUM-ACUR IN WSS-VARI TO WSS-NUM-ACUR IN WSS-IC4
                                            WSS-NUM-ACUR IN WSS-IC5.
       FIN-MUEVE-FEC-SORT-RPT.
           EXIT.

       BUSCA-COMO-OPERA SECTION.
       INI-BUSCA-COMO-OPERA.
      *Lee TOC
           MOVE WSS-COD-TOOC IN WSS-VARI TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-TOC.
      *Obtiene Como Opera
           MOVE 'COL'               TO MSC-COD-SIST FIO-SIST.
           MOVE 'OPEC'              TO MSC-COD-TMSC IN MSC.
           MOVE TOC-MSC-OPEC IN TOC TO MSC-COD-CMSC IN MSC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           MOVE MSC-CIC-CMSC IN MSC TO WSS-OPEC IN WSS-VARI.
       FIN-BUSCA-COMO-OPERA.
           EXIT.

       BUS-CTA-CAP SECTION.
       INI-BUS-CTA-CAP.
      * Si es Boleta de Garantia y no viene concepto CAP, se debe
      * obtener cuenta con codigo ORD. Si no es Boleta de Garantia
      * se debe obtener la cuenta de colocacion con codigo CAP
      *DPM ini  2-APR-1997 Se elimino tratamiento de Bol. Grtia ya que
      * la DCC la tratan como CAP
      *     PERFORM BUSCA-COMO-OPERA.
      *     IF WSS-OPEC IN WSS-VARI NOT = 'B'
           MOVE 'CAP' TO DCC-MSC-TCCT IN DCC.
      *     ELSE
      *     IF W45-SGV-AMOR IN WSS-VARI NOT > ZEROES
      *         MOVE 'ORD' TO DCC-MSC-TCCT IN DCC.
      *DPM fin  2-APR-1997

           MOVE WSS-COD-NOPE IN WSS-VARI TO DLC-CIC-IOPC IN DLC.
           MOVE ZEROES                   TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS              TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT (FIO-STAT-OKS AND
                   WSS-COD-NOPE IN WSS-VARI = DLC-CIC-IOPC IN DLC)
               DISPLAY 'NO EXISTE REG DLC PARA OPC '
                                 WSS-COD-NOPE IN WSS-VARI
               MOVE 'INEXISTENTE.' TO WSS-CIC-CCSB IN WSS-VARI
               GO TO FIN-BUS-CTA-CAP.

      *DPM ini  24-FEB-1997 Para obtener sit. ctble se usa la misma
      * logica del CPR
           MOVE WSS-COD-NOPE IN WSS-VARI TO RCV-CIC-IOPC IN RCV.
           MOVE WSS-NUM-ICAN IN WSS-VARI TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES                   TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES                   TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS              TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF NOT (FIO-STAT-OKS AND
                   WSS-COD-NOPE IN WSS-VARI = RCV-CIC-IOPC IN RCV AND
                   WSS-NUM-ICAN IN WSS-VARI = RCV-NUM-ICAN IN RCV)
               DISPLAY 'NO EXISTE REG RCV PARA OPC '
                                 WSS-COD-NOPE IN WSS-VARI
               MOVE 'INEXISTENTE.' TO WSS-CIC-CCSB IN WSS-VARI
               GO TO FIN-BUS-CTA-CAP.

           IF RCV-IND-SCTB IN RCV = 'MOR' OR '   '
               IF DLC-IND-SCTB IN DLC = 'MUL'
                   MOVE SPACES TO DCC-IND-SCTB IN DCC
               ELSE
                   MOVE DLC-IND-SCTB IN DLC TO DCC-IND-SCTB IN DCC
           ELSE
               MOVE RCV-IND-SCTB IN RCV TO DCC-IND-SCTB IN DCC.

           MOVE 'DCC'                    TO DCC-COD-TTAB IN DCC.
           MOVE WSS-COD-VCOC IN WSS-VARI TO DCC-COD-VCAM IN DCC.
           MOVE WSS-COD-COOC IN WSS-VARI TO DCC-COD-COCR IN DCC.
           MOVE DLC-COD-PLZO IN DLC      TO DCC-COD-PLZO IN DCC.
           MOVE DLC-IND-SCRT IN DLC      TO DCC-IND-SCRT IN DCC.
           MOVE DLC-IND-SCBZ IN DLC      TO DCC-IND-SCBZ IN DCC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DCC.
           IF NOT FIO-STAT-OKS
              MOVE '* ' TO DCC-COD-PLZO IN DCC
              MOVE FIO-GET-KEY TO FIO-CMND
              PERFORM COL-FIO-DCC
              IF NOT FIO-STAT-OKS
                 MOVE '*     ' TO DCC-COD-COCR IN DCC
                 MOVE FIO-GET-KEY TO FIO-CMND
                 PERFORM COL-FIO-DCC
                 IF NOT FIO-STAT-OKS
                    DISPLAY 'DCC INEXISTENTE' DCC-COD-TABL IN DCC
                    MOVE 'INEXISTENTE.' TO WSS-CIC-CCSB IN WSS-VARI
                    GO TO FIN-BUS-CTA-CAP.
           MOVE DCC-GLS-CCSB IN DCC TO WSS-CIC-CCSB IN WSS-VARI.
       FIN-BUS-CTA-CAP.
           EXIT.
      *>>>>
