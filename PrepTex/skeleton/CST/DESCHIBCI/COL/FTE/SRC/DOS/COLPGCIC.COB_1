       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPGCIC.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.
      * Programa Generador de Curses a Archivo MCD.
      *          1         2         3         4         5         6
      *01234567890123456789012345678901234567890123456789012345678901234
       ENVIRONMENT DIVISION.
      *====================
       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *-----------------------
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
      * jpa  COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
      * jpa  se incluye las siguientes tablas
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-NTR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
      * fin jpa
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MCD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ERC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-NAC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.
      *DPM ini  12-DEC-1996
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
      *DPM fin  12-DEC-1996
      *<<<< WSS
       COPY COLBROPC.
       COPY COLBRDLC.
       COPY COLBRROV.
      * jpa  COPY COLBRICG.
       COPY COLBRAUX.
       COPY COLBRNTR.
       COPY COLBREVC.
       COPY COLBRCYA.
       COPY COLBRRCV.
       COPY COLBRCAN.
      * jpa fin
      *DPM ini  12-DEC-1996
       COPY COLBRVEN.
      *DPM fin  12-DEC-1996
       COPY COLBRMCD.
       COPY COLBRERC.
       COPY COLBRNAC.
       COPY COLBRTOC.
       COPY TABBRTIO.
       COPY TABBRCAM.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSBRMSC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGPES.
       01  PAR-VARI.
      * FECHA DEL PROCESO
      *DPM ini  18-MAR-1997 Se cambia formato de fecha a DDMMSSAA
      *     03  PAR-FEC-FTAR.
      *         05  PAR-FIL-1                      PIC X(01).
      *         05  PAR-FEC-FTA1.
      *             07  PAR-NUM-DTAR               PIC 9(02).
      *             07  PAR-FIL-SLA1               PIC X(01).
      *             07  PAR-NUM-MTAR               PIC 9(02).
      *             07  PAR-FIL-SLA2               PIC X(01).
      *             07  PAR-NUM-ATAR               PIC 9(02).
      *DPM fin  18-MAR-1997
           03  PAR-FEC-FDES.
               05  PAR-NUM-DDES                   PIC 9(02).
               05  PAR-NUM-MDES                   PIC 9(02).
               05  PAR-NUM-SDES                   PIC 9(02).
               05  PAR-NUM-ADES                   PIC 9(02).
      * INDICE PARA ANALISIS DE VECTOR
           03  PAR-NUM-IVEC                       PIC 9(02).
      * VECTOR DE OPERACIONES O CANCELACIONES
           03  PAR-VEC-ICAN.
               05  PAR-COL-ICAN      OCCURS 6.
      *
      *           IDENTIFICACION CANCELACION / OPERACION
                  07  PAR-KEY-ICAN.
      *
      *               COD. INT. COMP. OPERACION CREDITO
                      09  PAR-CIC-IOPC.
      *
      *                   CENTRO ASIGNACION IDENTIFICACION
                          11  PAR-CAI-IOPC.
                              13  PAR-COD-TOPC    PIC X(01).
                              13  PAR-COD-COPC    PIC X(03).
      *
      *                   IDENT. INTERNA COMPUTACIONAL
                          11 PAR-IIC-IOPC.
                             13 PAR-COD-OOPC.
                                15  PAR-COD-SOPC  PIC X(02).
                                15  PAR-IND-SOPC  PIC X(01).
                             13 PAR-GLS-NOPC      PIC X(05).
                      09 PAR-FIL-IOPC             PIC X(01).
      * Vector de Monedas
           03  PAR-VEC-VCOC.
               05  PAR-COL-VCOC      OCCURS 10.
                   07 PAR-COD-VCOC                PIC X(06).
                   07 PAR-FIL-VCOC                PIC X(01).
      * Vector de Sucursales
           03  PAR-VEC-OFOC.
               05 PAR-COL-OFOC      OCCURS 10.
                  07  PAR-COD-OFOC                PIC X(03).
                  07  PAR-FIL-VCOC                PIC X(01).
      * Vector de Lineas
           03 PAR-VEC-COOC.
              05 PAR-COL-COOC      OCCURS 10.
                 07  PAR-COD-COOC                 PIC X(06).
                 07  PAR-FIL-COOC                 PIC X(01).
      * INDICADOR DE REGISTRO SELECCIONADO
           03  PAR-IND-RSEL                       PIC 9(01).
               88  REG-NO-SELECCIONADO        VALUE 0.
               88  REG-SELECCIONADO           VALUE 1.
       01  WSS-VARI.
           03  WSS-COD-MNAC                       PIC X(06).
           03  WSS-FEC-FFEC.
               05  WSS-NUM-SFEC                   PIC 9(02).
               05  WSS-NUM-AFEC                   PIC 9(02).
               05  WSS-NUM-MFEC                   PIC 9(02).
               05  WSS-NUM-DFEC                   PIC 9(02).
           03  WSS-FEC-FINI.
               05  WSS-NUM-SINI                   PIC 9(02).
               05  WSS-NUM-AINI                   PIC 9(02).
               05  WSS-NUM-MINI                   PIC 9(02).
               05  WSS-NUM-DINI                   PIC 9(02).
           03  WSS-FEC-FORI.
               05  WSS-NUM-SORI                   PIC 9(02).
               05  WSS-NUM-AORI                   PIC 9(02).
               05  WSS-NUM-MORI                   PIC 9(02).
               05  WSS-NUM-DORI                   PIC 9(02).
           03  WSS-COD-CUR                        PIC X(03).
           03  WSS-ANT-NTAS                       PIC X(03).
           03  WSS-IND-TTAS.
               05  WSS-GLS-NTAS                   PIC X(03).
               05  WSS-GLS-STAS                   PIC X(03).
           03  WSS-VEC-MOV OCCURS 100 TIMES INDEXED BY MOV-I MOV-TOPE.
               05  VEC-CPTO                       PIC X(06).
               05  VEC-MONTO                      PIC S9(13)V9(02).
               05  VEC-ES-LIQ                     PIC X(02).
           03  WSS-VEC-CYA OCCURS 100 TIMES INDEXED BY CYA-I CYA-TOPE
                                                       EXI-I EXI-TOPE.
               05  VEC-CPTO-CYA                   PIC X(06).
               05  VEC-MONTO-CYA                  PIC S9(13)V9(02).
      * MONTOS
           03  WSS-SGV-RENO                       PIC S9(13)V9(04).
           03  WSS-VALOR-PESOS                    PIC S9(13)V9(04).
           03  WSS-IPN                            PIC S9(13)V9(04).
      * CONTADORES
           03  WSS-NUM-ROPC      VALUE 0          PIC 9(06).
           03  WSS-NUM-RGRA      VALUE 0          PIC 9(06).
      * LOGICAS
           03  WSS-IND-ERRO                       PIC 9(01).
               88  ERROR-EN-PROCESO               VALUE 1.
           03  WSS-FIN-LOOP                       PIC X(01) VALUE 'N'.
               88  FIN-LOOP                       VALUE 'S'.
           03  WSS-EXISTE                         PIC X(01) VALUE 'N'.
               88  EXISTE                         VALUE 'S'.
      * AUXILIARES
           03  WSS-ULT-CANC                       PIC 9(03).
           03  WSS-CIC-TCVE-IF                    PIC X(02).
           03  AUX-CIC-IOPC                       PIC X(12).
      * NOTARIOS
           03  WSS-RET-NTR.
               05  AUX-VEC-MONTO                  PIC S9(13).
               05  FACT-ABO                       PIC 9(01)V9(04).
               05  FACT-IMP                       PIC 9(01)V9(04).
               05  K-FACT-ABO                     PIC 9(01)V9(04).
               05  K-FACT-IMP                     PIC 9(01)V9(04).
               05  K-IMP-NOT     VALUE 10         PIC 9(03).
      *DPM ini  5-DEC-1996
           03  WSS-OPEC          VALUE SPACES     PIC X(01).
      *DPM ini  17-MAR-1997
           03  WSS-IND-SLFI  VALUE 'N'            PIC X(01).
      *DPM fin  17-MAR-1997
      *DPM ini  18-MAR-1997
           03  WSS-VAL-DIFE          COMP-3        PIC S9(11)V9(4).
      *DPM fin  18-MAR-1997
      *RRM-INI  16-JUN-1999
           03  WSS-CIC-CTAB.
               05 WSS-CIC-CTA1                     PIC X(06).
               05 WSS-CIC-CTA2                     PIC X(06).
      *RRM-FIN  16-JUN-1999

        PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
       INI-MAIN.
           COPY GNSBGEDB.
           MOVE 'COLPGCIC' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           PERFORM OPEN-FILE.
           PERFORM INI-VAR.
           PERFORM PRO-OPC.
           PERFORM CLOSE-FILE.
       FIN-MAIN.
           DISPLAY 'OPERACIONES SELECCIONADAS ' WSS-NUM-ROPC IN WSS-VARI
           DISPLAY 'REGISTROS GRABADOS        ' WSS-NUM-RGRA IN WSS-VARI
           PERFORM GNS-PRO-END.

       OPEN-FILE SECTION.
       INI-OPEN-FILE.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           PERFORM COL-FIO-DLC.
      * jpa      PERFORM COL-FIO-ICG.
           PERFORM COL-FIO-NTR.
           PERFORM COL-FIO-EVC.
           PERFORM COL-FIO-CYA.
           PERFORM COL-FIO-RCV.
           PERFORM COL-FIO-CAN.
      * fin jpa
      *DPM ini  12-DEC-1996
           PERFORM COL-FIO-VEN.
      *DPM fin  12-DEC-1996
           PERFORM COL-FIO-ROV.
           PERFORM TAB-FIO-CAM.
           MOVE 'COL' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE 'TAB' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM COL-FIO-MCD.
           PERFORM COL-FIO-ERC.
           PERFORM COL-FIO-NAC.
       FIN-OPEN-FILE.
           EXIT.
       INI-VAR SECTION.
       INI-INI-VAR.
      *<<<< INI_INI
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.
      *
           MOVE 1  TO PAR-NUM-IVEC IN PAR-VARI.
      *CAPTURA FECHA PROCESO
      *DPM ini  18-MAR-1997 Se cambia formato de fecha a DDMMSSAA
      *     DISPLAY 'FECHA DESDE DESDE TARJETA (*DD/MM/AA) : '.
      *     ACCEPT  PAR-FEC-FTAR IN PAR-VARI.
      *     DISPLAY PAR-FEC-FTA1 IN PAR-VARI.
      *     MOVE PAR-NUM-DTAR IN PAR-VARI TO PAR-NUM-DDES IN PAR-VARI.
      *     MOVE PAR-NUM-MTAR IN PAR-VARI TO PAR-NUM-MDES IN PAR-VARI.
      *     MOVE PAR-NUM-ATAR IN PAR-VARI TO PAR-NUM-ADES IN PAR-VARI.
      *     IF PAR-NUM-ADES IN PAR-VARI < 50
      *        MOVE 20                    TO PAR-NUM-SDES IN PAR-VARI
      *     ELSE
      *        MOVE 19                    TO PAR-NUM-SDES IN PAR-VARI.
           DISPLAY 'FECHA DESDE DESDE TARJETA (DDMMSSAA) : '.
           ACCEPT PAR-FEC-FDES IN PAR-VARI.
      *DPM fin  18-MAR-1997
      *CAPTURA SUCURSAL
           DISPLAY 'SUCURSAL (*/XXX ) hasta 10        : '.
           MOVE SPACES TO
                PAR-VEC-OFOC IN PAR-VARI.
           ACCEPT  PAR-VEC-OFOC IN PAR-VARI.
           DISPLAY PAR-VEC-OFOC IN PAR-VARI.
      *CAPTURA MONEDA
           DISPLAY 'MONEDA (*/XXXXXX ) hasta 10   : '.
           MOVE SPACES TO
                PAR-VEC-VCOC IN PAR-VARI.
           ACCEPT  PAR-VEC-VCOC IN PAR-VARI.
           DISPLAY PAR-VEC-VCOC IN PAR-VARI.
      *CAPTURA LINEA (TIPO OPERACION Y CODIGO AUXILIAR)
           DISPLAY 'LINEA  (*/XXXXXX ) hasta 10: '.
           MOVE SPACES TO
                PAR-VEC-COOC IN PAR-VARI.
           ACCEPT  PAR-VEC-COOC IN PAR-VARI.
           DISPLAY PAR-VEC-COOC IN PAR-VARI.
      *CAPTURA NUMERO OPERACION O CANCELACION
           DISPLAY 'NRO OPE/CAN (*/XXXXXXXXXXXX )  hasta 6 :'.
           MOVE SPACES TO PAR-VEC-ICAN IN PAR-VARI.
           ACCEPT  PAR-VEC-ICAN IN PAR-VARI.
           DISPLAY PAR-VEC-ICAN IN PAR-VARI.
      *VAL-FEC VALIDA FECHA DESDE
           DISPLAY PAR-FEC-FDES IN PAR-VARI.
           MOVE PAR-FEC-FDES    IN PAR-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'FECPROCNEX'   TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
               PERFORM GNS-PRO-ABT
               GO TO FIN-INI-VAR.
      *
      * MUEVE FECHAS DD-MM-SSAA A FORMATO SSAA-MM-DD
           MOVE PAR-NUM-DDES IN PAR-VARI TO WSS-NUM-DFEC IN WSS-VARI.
           MOVE PAR-NUM-MDES IN PAR-VARI TO WSS-NUM-MFEC IN WSS-VARI
           MOVE PAR-NUM-SDES IN PAR-VARI TO WSS-NUM-SFEC IN WSS-VARI.
           MOVE PAR-NUM-ADES IN PAR-VARI TO WSS-NUM-AFEC IN WSS-VARI.
      * OBTIENE DIA HABIL ANTERIOR PARA PROCESAR DESDE ESE DIA
      * INCLUSIVE, ESTO EN EL CASO DE CONTABILIDAD AL VENCIMIENTO
           MOVE PAR-NUM-DDES IN PAR-VARI TO FEC-ITM1 IN FEC-FECH.
           MOVE PAR-NUM-MDES IN PAR-VARI TO FEC-ITM2 IN FEC-FECH.
           MOVE PAR-NUM-SDES IN PAR-VARI TO FEC-ITM3 IN FEC-FECH.
           MOVE PAR-NUM-ADES IN PAR-VARI TO FEC-ITM4 IN FEC-FECH.
       VAL-DIA-DHBL.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-FER OR NOT FEC-STAT-HBL
               MOVE FEC-FORM-FEC TO FEC-FORM
               MOVE FEC-RST-DIA  TO FEC-CMND
               MOVE 1 TO FEC-NDIA
               PERFORM CAL-FEC
               IF NOT FEC-STAT-OKS
                   MOVE 'COL'          TO MSG-COD-SIST
                   MOVE 'FECDHANNEX'   TO MSG-COD-MENS
                   PERFORM GET-MSG
                   DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
                   PERFORM GNS-PRO-ABT
                   GO TO FIN-INI-VAR
               ELSE
                   GO TO VAL-DIA-DHBL.
      *
      *
      * MUEVE FECHAS DD-MM-SSAA A FORMATO SSAA-MM-DD
           MOVE FEC-ITM1 IN FEC-FECH TO WSS-NUM-DINI IN WSS-VARI.
           MOVE FEC-ITM2 IN FEC-FECH TO WSS-NUM-MINI IN WSS-VARI.
           MOVE FEC-ITM3 IN FEC-FECH TO WSS-NUM-SINI IN WSS-VARI.
           MOVE FEC-ITM4 IN FEC-FECH TO WSS-NUM-AINI IN WSS-VARI.
      *
      * OBTIENE COD MOVIMIENTO MEDIANTE CIC
           MOVE 'COL'          TO FIO-SIST.
           MOVE 'MVT'          TO TAB-CIC-TTAB IN TAB.
           MOVE 'CUR'          TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'       TO MSG-COD-SIST
               MOVE 'CICCURNEX' TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
               PERFORM GNS-PRO-ABT
               GO TO FIN-INI-VAR.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-CUR IN WSS-VARI.
      * Se obtiene por unica vez COD_PESO, para chequear si la
      * Operacion es en peso u otra, de la siguiente forma :
           MOVE 'TAB'                     TO FIO-SIST.
           MOVE 'VLR'                     TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '                  TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL'            TO FIO-AKEY.
           MOVE  FIO-GET-KEY              TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS OR TAB-IND-VIGE IN TAB = 'N'
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE 'CICMNACINEX'        TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG '  0999  '
               PERFORM GNS-PRO-ABT
               GO TO FIN-INI-VAR.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-MNAC IN WSS-VARI.
           MOVE SPACES TO MCD.
      * jpa INI
      * Obtiene cod tipo calculo vcto mediante cic "if"
      * este se utilizara para determinar si una operacion
      * tiene o no intereses anticipados.
           MOVE 'COL'          TO FIO-SIST.
           MOVE 'CVC'          TO TAB-CIC-TTAB IN TAB.
           MOVE 'IF'           TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'       TO MSG-COD-SIST
               MOVE 'CICIF NEX' TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
               PERFORM GNS-PRO-ABT
               GO TO FIN-INI-VAR.
           MOVE TAB-COD-CTAB IN TAB TO WSS-CIC-TCVE-IF IN WSS-VARI.
      * Calcula factores para calculo de impuesto a notarios
      * los factores dependen del % de impuesto notario.
      * OJO debe incorporarse en tabla el K-IMP-NOT, por ahora en duro
           COMPUTE K-FACT-ABO IN WSS-VARI = 100 / ( K-IMP-NOT + 100 ).
           COMPUTE K-FACT-IMP IN WSS-VARI = 1 - K-FACT-ABO IN WSS-VARI.
      * jpa fin
       FIN-INI-VAR.
           EXIT.
       PRO-OPC SECTION.
       INI-PRO-OPC.
      *
      * REVISA SI PROCESO ES POR OPERACION-CANCELACION O POR FECHA
           IF ( PAR-VEC-ICAN IN PAR-VARI NOT = SPACES AND
                PAR-VEC-ICAN IN PAR-VARI NOT = ZEROES AND
                PAR-CIC-IOPC IN PAR-VARI(1) NOT = '*           ' )
      *
           DISPLAY 'SELECCIONA OPERACIONES'
      *
               MOVE 1 TO PAR-NUM-IVEC IN PAR-VARI
               MOVE PAR-CIC-IOPC
                        IN PAR-VARI(PAR-NUM-IVEC IN PAR-VARI) TO
                    OPC-CIC-IOPC IN OPC
               MOVE FIO-GET-KEY    TO FIO-CMND
               PERFORM COL-FIO-OPC
               IF NOT FIO-STAT-OKS
                   DISPLAY 'NO ENCONTRE PRIMERA OPERACION : '
                           OPC-CIC-IOPC IN OPC
                   GO TO FIN-PRO-OPC
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE WSS-FEC-FINI IN WSS-VARI TO OPC-FEC-FINP IN OPC
               MOVE 'OPC-FEC-FINP' TO FIO-AKEY
               MOVE FIO-GET-NLS    TO FIO-CMND
               PERFORM COL-FIO-OPC
               IF NOT FIO-STAT-OKS OR
                  OPC-FEC-FINP IN OPC >  WSS-FEC-FFEC IN WSS-VARI
                  DISPLAY 'NO HAY REGISTROS OPC EN RANGO DE FECHAS : '
                          'DESDE ' WSS-FEC-FINI IN WSS-VARI ' A '
                                   WSS-FEC-FFEC IN WSS-VARI
                  GO TO FIN-PRO-OPC.
       LUP-PRO-OPC.
           IF NOT FIO-STAT-OKS OR
              OPC-FEC-FINP IN OPC >  WSS-FEC-FFEC IN WSS-VARI
              GO TO FIN-PRO-OPC.
      *ALD-BCI-INI/22.11.1995
      *
      * BUSCA SISTEMA EN DONDE OPERA
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'TIO'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-TOOC IN OPC TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS = 'COD    NEX'
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'TIO    NEX'   TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC ' ' OPC-KEY-IOPC IN OPC
                       ' ' TAB-COD-CTAB IN TAB
               IF OPC-COD-TOPC IN OPC = 'D'
                  PERFORM GRABAR-ERROR
                  GO TO NXT-PRO-OPC
               ELSE
                  GO TO NXT-PRO-OPC.
           MOVE TAB TO TIO.
           IF TIO-GLS-SIST IN TIO NOT = 'COL'
               GO TO NXT-PRO-OPC.
      *

      *DPM ini  5-DEC-1996
      *Lee TOC
           MOVE OPC-COD-TOOC IN OPC TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-TOC.
      *Obtiene Como Opera
           MOVE 'COL'               TO MSC-COD-SIST FIO-SIST.
           MOVE 'OPEC'              TO MSC-COD-TMSC IN MSC.
           MOVE TOC-MSC-OPEC IN TOC TO MSC-COD-CMSC IN MSC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           MOVE MSC-CIC-CMSC IN MSC TO WSS-OPEC IN WSS-VARI.
      *DPM fin  5-DEC-1996
      *DPM INI  17-MAR-1997
           MOVE OPC-CIC-IOPC IN OPC TO EVC-CIC-IOPC IN EVC.
           MOVE ZEROES TO EVC-NUM-IEVC IN EVC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'N' TO WSS-IND-SLFI IN WSS-VARI.
       LUP-LEE-EVC.
           PERFORM COL-FIO-EVC.
           IF FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = EVC-CIC-IOPC IN EVC
               IF EVC-MSC-TCVE IN EVC = 'FI'
                 MOVE 'S' TO WSS-IND-SLFI IN WSS-VARI
                 MOVE FIO-GET-NXT TO FIO-CMND
                 GO TO LUP-LEE-EVC
               ELSE
                 MOVE 'N' TO WSS-IND-SLFI IN WSS-VARI.
      *DPM FIN  17-MAR-1997

      * PROCESO DE SELECCION Y CLASIFICACION A PARTIR DEL REGISTRO OPC
           PERFORM SEL-REG-CUR.
           IF REG-NO-SELECCIONADO
               GO TO NXT-PRO-OPC.
      *ALD-BCI-FIN/22.11.1995
      *
      * BUSCA SI PARTICIPA EN CONTABILIDAD
      *    MOVE 'COL'               TO TAB-COD-SIST.
      *    MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
      *    MOVE OPC-COD-COOC IN OPC TO TAB-COD-CTAB IN TAB.
      *    PERFORM BUS-TAB.
      *    IF MSG-COD-MENS = 'COD    NEX'
      *        MOVE 'COL'          TO MSG-COD-SIST
      *        MOVE 'AUX    NEX'   TO MSG-COD-MENS IN MSG
      *        PERFORM GET-MSG
      *        DISPLAY MSG-GLS-DESC ' ' OPC-KEY-IOPC IN OPC
      *                ' ' TAB-COD-CTAB IN TAB
      *        PERFORM GRABAR-ERROR
      *        GO TO NXT-PRO-OPC.
      *    MOVE TAB TO AUX.
      *    IF AUX-IND-PCTB IN AUX = 'N'
      *        GO TO NXT-PRO-OPC.
      *
      * AUMENTA CONTADOR DE OPERACIONES LEIDAS OK
           ADD  1  TO WSS-NUM-ROPC IN WSS-VARI.
           PERFORM LIM-VEC.
           IF MSG-COD-MENS IN MSG > SPACES
              GO TO ERR-PRO-OPC.
      *    Para Renovaciones y Novaciones
           PERFORM PRO-ROV.
           IF MSG-COD-MENS IN MSG > SPACES
              GO TO ERR-PRO-OPC.
           PERFORM LEE-DLC.
           IF MSG-COD-MENS IN MSG > SPACES
              GO TO ERR-PRO-OPC.
      *    Para Prorrogas
           PERFORM PRO-PRO.
           IF MSG-COD-MENS IN MSG > SPACES
              GO TO ERR-PRO-OPC.
      *  jpa INI
      *  para CHIBCI imptos,gastos,comisiones,intereses de OPC y DLC
      *           PERFORM PRO-ICG.
      *           IF MSG-COD-MENS IN MSG > SPACES
      *              GO TO ERR-PRO-OPC.
           PERFORM CAR-MOV-OPC.
           IF MSG-COD-MENS IN MSG > SPACES
              GO TO ERR-PRO-OPC.
           PERFORM PRO-DLC.
           IF MSG-COD-MENS IN MSG > SPACES
              GO TO ERR-PRO-OPC.
           PERFORM CAL-IPN.
           IF MSG-COD-MENS IN MSG > SPACES
              GO TO ERR-PRO-OPC.
           PERFORM PRO-CYA.
           IF MSG-COD-MENS IN MSG > SPACES
              GO TO ERR-PRO-OPC.
      *  jpa FIN
           PERFORM GRA-MOV.
           GO TO NXT-PRO-OPC.
       ERR-PRO-OPC.
           MOVE 'COL'          TO MSG-COD-SIST
           PERFORM GET-MSG
           DISPLAY MSG-GLS-DESC ' ' OPC-KEY-IOPC IN OPC
           PERFORM GRABAR-ERROR.
      *    PERFORM GNS-PRO-ABT.
           MOVE SPACES TO MSG-COD-SIST MSG-COD-MENS.
       NXT-PRO-OPC.
      * REVISA SI PROCESO ES POR OPERACION-CANCELACION O POR FECHA
           IF ( PAR-VEC-ICAN IN PAR-VARI NOT = SPACES AND
                PAR-VEC-ICAN IN PAR-VARI NOT = ZEROES AND
                PAR-CIC-IOPC IN PAR-VARI(1) NOT = '*           ' )
               ADD 1 TO  PAR-NUM-IVEC IN PAR-VARI
               IF PAR-NUM-IVEC IN PAR-VARI > 6
                   GO TO FIN-PRO-OPC
               ELSE
                  IF PAR-CIC-IOPC
                     IN PAR-VARI(PAR-NUM-IVEC IN PAR-VARI) = SPACES
                     GO TO FIN-PRO-OPC
                  ELSE
                     MOVE PAR-CIC-IOPC
                          IN PAR-VARI(PAR-NUM-IVEC IN PAR-VARI) TO
                             OPC-CIC-IOPC IN OPC
                     MOVE FIO-GET-KEY    TO FIO-CMND
                     PERFORM COL-FIO-OPC
                     IF NOT FIO-STAT-OKS
                        DISPLAY 'NO ENCONTRE  OPERACION : '
                                 OPC-CIC-IOPC IN OPC
                        GO TO FIN-PRO-OPC
                     ELSE
                        GO TO LUP-PRO-OPC
           ELSE
               MOVE 'OPC-FEC-FINP' TO FIO-AKEY
               MOVE FIO-GET-NXT TO FIO-CMND
               PERFORM COL-FIO-OPC
               GO TO LUP-PRO-OPC.
       FIN-PRO-OPC.
           EXIT.
      *
       GRABAR-ERROR SECTION.
       INI-GRA-ERR.
           MOVE OPC-KEY-IOPC IN OPC TO ERC-CIC-IOPC IN ERC.
           MOVE OPC-COD-OFOC IN OPC TO ERC-COD-OFIC IN ERC.
           MOVE 'CUR'               TO ERC-COD-EVEN IN ERC.
           MOVE 'CIC'               TO ERC-COD-PGRM IN ERC.
           MOVE ZEROES              TO ERC-NUM-CANC IN ERC.
           MOVE OPC-VAL-CRED IN OPC TO ERC-VAL-MNTO IN ERC.
           MOVE MSG-COD-MENS IN MSG TO ERC-COD-MSGE IN ERC.
           MOVE SPACES              TO ERC-GLS-DISP IN ERC.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-ERC.
       FIN-GRA-ERR.
           EXIT.

       SEL-REG-CUR SECTION.
       INI-SEL-REG-CUR.
      * ASUME REGISTRO NO SELECCIONADO
           MOVE 0 TO PAR-IND-RSEL IN PAR-VARI.

      * RBG INI 9-MAY-1996 Se agrego "J" para incluir las OPC con "APR"
      *    IF  OPC-MSC-STAT IN OPC = 'L'
           IF  OPC-MSC-STAT IN OPC = 'L' OR 'J'
      * RBG FIN 9-MAY-1996 Se agrego "J" para incluir las OPC con "APR"
               PERFORM EN-ESTADO-LIQ.
           IF  OPC-MSC-STAT IN OPC NOT = 'A' OR
               OPC-IND-CTBL IN OPC     = 'N'
                   GO TO FIN-SEL-REG-CUR.
      *
      * NO SELECCIONA REGISTROS CUYA OFICINA NO ESTE COMO PARAMETRO
           IF PAR-COD-OFOC IN PAR-VARI(1) NOT = '*  '
               MOVE 1 TO PAR-NUM-IVEC IN PAR-VARI
               PERFORM REV-COD-OFOC
               IF REG-NO-SELECCIONADO
                   GO TO FIN-SEL-REG-CUR
               ELSE
                   MOVE 0 TO PAR-IND-RSEL IN PAR-VARI.
      *
      * NO SELECCIONA REGISTROS CUYA MONEDA NO ESTE COMO PARAMETRO
           IF PAR-COD-VCOC IN PAR-VARI(1) NOT = '*     '
               MOVE 1 TO PAR-NUM-IVEC IN PAR-VARI
               PERFORM REV-COD-VCOC
               IF REG-NO-SELECCIONADO
                   GO TO FIN-SEL-REG-CUR
               ELSE
                   MOVE 0 TO PAR-IND-RSEL IN PAR-VARI.
      *
      * NO SELECCIONA REGISTROS CUYA LINEA NO ESTE EN PARAMETRO
           IF PAR-COD-COOC IN PAR-VARI(1) NOT = '*  '
               MOVE 1 TO PAR-NUM-IVEC IN PAR-VARI
               PERFORM REV-COD-COOC
               IF REG-NO-SELECCIONADO
                   GO TO FIN-SEL-REG-CUR
               ELSE
                   MOVE 0 TO PAR-IND-RSEL IN PAR-VARI.
      *
      * SELECCIONA REGISTRO
           MOVE 1 TO PAR-IND-RSEL IN PAR-VARI.

       FIN-SEL-REG-CUR.
           EXIT.
       EN-ESTADO-LIQ SECTION.
       INI-EST-LIQ.
           MOVE OPC-COD-OFOC IN OPC TO NAC-COD-OFIC IN NAC.
           MOVE OPC-COD-COOC IN OPC TO NAC-COD-COOC IN NAC.
           MOVE OPC-CIC-IOPC IN OPC TO NAC-CIC-IOPC IN NAC.
           MOVE OPC-VAL-CRED IN OPC TO NAC-VAL-CAPI IN NAC.
           MOVE OPC-SGV-LIQU IN OPC TO NAC-SGV-LIQU IN NAC.
           MOVE SPACES              TO NAC-GLS-DISP IN NAC.
      *    LEER VLR
      * Mediante BUS-TAB Busca Tipo de Moneda de Tabla VLR
           IF OPC-COD-VCOC IN OPC > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-ABRV IN TAB TO NAC-GLS-MONE IN NAC
           ELSE
               MOVE SPACES TO NAC-GLS-MONE IN NAC.
      *    LEER CYA
           MOVE OPC-CIC-IOPC IN OPC TO CYA-CIC-IOPC IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF NOT FIO-STAT-OKS
              OR CYA-CIC-IOPC IN CYA NOT = OPC-CIC-IOPC IN OPC
              OR CYA-NUM-ICAN IN CYA NOT = ZEROES
              MOVE 'CYACURINEX' TO MSG-COD-MENS IN MSG
              DISPLAY FIO-STAT
           ELSE
              MOVE CYA-IND-TCYA TO NAC-COD-ABON IN NAC
              MOVE CYA-CIC-ICYA TO NAC-COD-NCTE IN NAC
              MOVE SPACES       TO NAC-COD-DCTE IN NAC
              MOVE FIO-GET-NXT TO FIO-CMND
              PERFORM COL-FIO-CYA
              IF NOT FIO-STAT-OKS
                 OR CYA-CIC-IOPC IN CYA  NOT = OPC-CIC-IOPC IN OPC
                 OR CYA-NUM-ICAN IN CYA  NOT = ZEROES
                 NEXT SENTENCE
              ELSE
                 MOVE 'MULT'       TO NAC-COD-ABON IN NAC
                 MOVE SPACES       TO NAC-COD-NCTE IN NAC
                 MOVE SPACES       TO NAC-COD-DCTE IN NAC.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-NAC.
       FIN-EST-LIQ.
           EXIT.
      ******************************************************************
      * REVISA SI OFICINA CORRESPONDE A PARAMETROS
       REV-COD-OFOC SECTION.
       INI-REV-COD-OFOC.
           IF OPC-COD-OFOC IN OPC =
              PAR-COD-OFOC IN PAR-VARI(PAR-NUM-IVEC IN PAR-VARI)
               MOVE 1 TO PAR-IND-RSEL IN PAR-VARI
               GO TO FIN-REV-COD-OFOC.
           ADD 1 TO PAR-NUM-IVEC IN PAR-VARI.
           IF PAR-NUM-IVEC IN PAR-VARI NOT > 10
               GO TO INI-REV-COD-OFOC.
       FIN-REV-COD-OFOC.
           EXIT.
      *
      ******************************************************************
      * REVISA SI MONEDA CORRESPONDE A PARAMETROS
       REV-COD-VCOC SECTION.
       INI-REV-COD-VCOC.
           IF OPC-COD-VCOC IN OPC =
              PAR-COD-VCOC IN PAR-VARI(PAR-NUM-IVEC IN PAR-VARI)
               MOVE 1 TO PAR-IND-RSEL IN PAR-VARI
               GO TO FIN-REV-COD-VCOC.
           ADD 1 TO PAR-NUM-IVEC IN PAR-VARI.
           IF PAR-NUM-IVEC IN PAR-VARI NOT > 10
               GO TO INI-REV-COD-VCOC.
       FIN-REV-COD-VCOC.
           EXIT.
      *
      ******************************************************************
      * REVISA SI LINEA CORRESPONDE A PARAMETROS
       REV-COD-COOC SECTION.
       INI-REV-COD-COOC.
           IF OPC-COD-COOC IN OPC =
              PAR-COD-COOC IN PAR-VARI(PAR-NUM-IVEC IN PAR-VARI)
               MOVE 1 TO PAR-IND-RSEL IN PAR-VARI
               GO TO FIN-REV-COD-COOC.
           ADD 1 TO PAR-NUM-IVEC IN PAR-VARI.
           IF PAR-NUM-IVEC IN PAR-VARI NOT > 10
               GO TO INI-REV-COD-COOC.
       FIN-REV-COD-COOC.
           EXIT.
       LIM-VEC SECTION.
       INI-LIM-VEC.
           SET MOV-I TO 1.
       LUP-LIM-VEC.
           IF MOV-I > 100
              GO TO FIN-LIM-VEC.
           MOVE SPACES TO  VEC-CPTO   (MOV-I).
           MOVE ZEROES TO  VEC-MONTO  (MOV-I).
           MOVE SPACES TO  VEC-ES-LIQ (MOV-I).
       SIG-LIM-VEC.
           SET MOV-I UP BY 1.
           GO TO LUP-LIM-VEC.
       FIN-LIM-VEC.
           EXIT.
      * jpa INI
      * Proceso ICG se inhibe para CHIBCI
      *
      *       PRO-ICG SECTION.
      *       INI-PRO-ICG.
      *           MOVE SPACES   TO  WSS-ANT-NTAS IN WSS-VARI.
      *           MOVE 'COM   ' TO  WSS-IND-TTAS IN WSS-VARI
      *           PERFORM PRO-ICG-ALL.
      *           IF  MSG-COD-MENS > SPACES
      *               GO TO FIN-PRO-ICG.
      *           MOVE 'IMP   ' TO  WSS-IND-TTAS IN WSS-VARI
      *           PERFORM PRO-ICG-ALL.
      *           IF  MSG-COD-MENS > SPACES
      *               GO TO FIN-PRO-ICG.
      *           MOVE 'GAS   ' TO  WSS-IND-TTAS IN WSS-VARI
      *           PERFORM PRO-ICG-ALL.
      *           MOVE 'INT   ' TO  WSS-IND-TTAS IN WSS-VARI
      *           PERFORM PRO-ICG-ALL.
      *       FIN-PRO-ICG.
      *           EXIT.
      *       PRO-ICG-ALL SECTION.
      *       INI-PRO-ICG-ALL.
      *           MOVE OPC-CIC-IOPC IN OPC      TO ICG-CIC-IOPC IN ICG.
      *           MOVE ZEROES                   TO ICG-NUM-ICAN IN ICG.
      *           MOVE SPACES                   TO ICG-CIC-IOPV IN ICG.
      *           MOVE ZEROES                   TO ICG-NUM-IVCT IN ICG.
      *           MOVE WSS-IND-TTAS IN WSS-VARI TO ICG-IND-TTAS IN ICG.
      *           MOVE ZEROES                   TO ICG-FEC-FINI IN ICG.
      *           MOVE FIO-GET-NLS TO FIO-CMND.
      *       LUP-PRO-ICG-ALL.
      *           PERFORM COL-FIO-ICG.
      *           IF NOT ( FIO-STAT-OKS AND
      *                    ICG-CIC-IOPC IN ICG = OPC-CIC-IOPC IN OPC AND
      *                    ICG-NUM-ICAN IN ICG = ZEROES              AND
      *                    ICG-CIC-IOPV IN ICG = SPACES              AND
      *                    ICG-NUM-IVCT IN ICG = ZEROES              AND
      *                    ICG-GLS-NTAS IN ICG = WSS-GLS-NTAS IN WSS-VAR
      *               GO TO FIN-PRO-ICG-ALL.
      *           IF (ICG-IND-TTAS IN ICG =
      *              'INT   ' OR 'COM   ' OR 'IMP   ' OR 'GAS   ')
      *               MOVE FIO-GET-NXT   TO FIO-CMND
      *               GO TO NXT-PRO-ICG-ALL.
      *           PERFORM CAR-MOV-ICG.
      *       NXT-PRO-ICG-ALL.
      *           MOVE FIO-GET-NXT TO FIO-CMND.
      *           GO TO LUP-PRO-ICG-ALL.
      *       FIN-PRO-ICG-ALL.
      *           EXIT.
      * jpa FIN
       CAR-MOV-OPC SECTION.
       INI-CAR-MOV-OPC.
      * jpa INI
      * Convierte a pesos los valores almacenados en moneda
      * reajustable.
           IF OPC-MSC-TVOC IN OPC     = '0'    AND
              OPC-COD-CVOC IN OPC NOT = '999'  AND
              OPC-VAL-CRED IN OPC NOT = 0
              MOVE OPC-VAL-CRED IN OPC TO WSS-VALOR-PESOS IN WSS-VARI
              PERFORM CONVERTIR-A-MONNAC
              IF ERROR-EN-PROCESO
                GO TO FIN-CAR-MOV-OPC
              ELSE
                MOVE WSS-VALOR-PESOS IN WSS-VARI TO OPC-VAL-CRED IN OPC.

           IF   OPC-MSC-TVOC IN OPC          = '0'   AND
                OPC-COD-CVOC IN OPC      NOT = '999' AND
                WSS-SGV-RENO IN WSS-VARI NOT = 0     AND
                OPC-IND-RENO IN OPC      NOT = 'NOV' AND
                OPC-IND-RENO IN OPC      NOT = 'REN'
              MOVE WSS-SGV-RENO IN WSS-VARI TO WSS-VALOR-PESOS
                                                  IN WSS-VARI
              PERFORM CONVERTIR-A-MONNAC
              IF ERROR-EN-PROCESO
                 GO TO FIN-CAR-MOV-OPC
              ELSE
                 MOVE WSS-VALOR-PESOS IN WSS-VARI TO WSS-SGV-RENO
                                                   IN WSS-VARI.
      * jpa FIN

      *DPM ini  17-MAR-1997 Si es Doc Desc o FI CAP = VEN-VAL-CAPI
      *DPM ini  5-DEC-1996 Si es Doc. Descontado CAP = VEN-VAL-CAPI
      *     IF WSS-OPEC IN WSS-VARI NOT = 'D'
           IF WSS-OPEC IN WSS-VARI NOT = 'D' AND
              WSS-IND-SLFI IN WSS-VARI NOT = 'S'
      *DPM fin  17-MAR-1997
              SET MOV-I TO 1
              MOVE 'CAP   '            TO VEC-CPTO IN WSS-VARI (MOV-I)
              MOVE OPC-VAL-CRED IN OPC TO VEC-MONTO IN WSS-VARI (MOV-I)
           ELSE
              SET MOV-I TO 1
              MOVE 'CAP   '            TO VEC-CPTO IN WSS-VARI (MOV-I)
              PERFORM LEE-PRA-VEN
              IF MSG-COD-MENS > SPACES
                  GO TO FIN-CAR-MOV-OPC
              ELSE
                  MOVE VEN-VAL-CAPI IN VEN
                              TO VEC-MONTO IN WSS-VARI (MOV-I).
      *DPM fin  5-DEC-1996

      *DPM ini  18-MAR-1997 Se cuadra CAP con NEG para tener dif. cero
           IF WSS-SGV-RENO IN WSS-VARI NOT = 0 AND
              VEC-CPTO IN WSS-VARI (MOV-I) = 'CAP   '
               SUBTRACT WSS-SGV-RENO IN WSS-VARI FROM
                                  VEC-MONTO IN WSS-VARI (MOV-I)
                                  GIVING WSS-VAL-DIFE IN WSS-VARI
               MOVE WSS-VAL-DIFE TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO WSS-VAL-DIFE
               IF WSS-VAL-DIFE IN WSS-VARI > -10 AND
                  WSS-VAL-DIFE IN WSS-VARI < 10
                  MOVE WSS-SGV-RENO IN WSS-VARI TO
                                  VEC-MONTO IN WSS-VARI (MOV-I).
      *DPM fin  18-MAR-1997

           IF WSS-SGV-RENO IN WSS-VARI NOT = 0
              SET MOV-I UP BY 1
              MOVE 'NEG   '   TO VEC-CPTO   IN WSS-VARI (MOV-I)
              MOVE 'P '       TO VEC-ES-LIQ IN WSS-VARI (MOV-I)
              MOVE WSS-SGV-RENO IN WSS-VARI
                              TO VEC-MONTO  IN WSS-VARI (MOV-I).

           IF OPC-SGV-LIQU IN OPC NOT = 0
              SET MOV-I UP BY 1
              MOVE 'LIQ   '            TO VEC-CPTO IN WSS-VARI (MOV-I)
              MOVE OPC-SGV-LIQU IN OPC TO VEC-MONTO IN WSS-VARI (MOV-I).
      * jpa INI
      * Para CHIBCI comisiones y gastos se obtienen de la OPC
           IF OPC-SGV-VCOM IN OPC NOT = 0
              SET MOV-I UP BY 1
              MOVE 'COM   '            TO VEC-CPTO IN WSS-VARI (MOV-I)
              MOVE OPC-SGV-VCOM IN OPC TO VEC-MONTO IN WSS-VARI (MOV-I).
           IF OPC-VAL-GAST IN OPC NOT = 0
              SET MOV-I UP BY 1
              MOVE 'GTO   '            TO VEC-CPTO IN WSS-VARI (MOV-I)
              MOVE OPC-VAL-GAST IN OPC TO VEC-MONTO IN WSS-VARI (MOV-I).
      * jpa FIN
           IF OPC-VAL-SEGD IN OPC NOT = 0
              SET MOV-I UP BY 1
      *ALD-BCI-INI/22.11.1995
               MOVE 'COL'               TO FIO-SIST
               MOVE 'SDG'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-SEGD IN OPC TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY    TO FIO-CMND
               PERFORM GNS-FIO-TAB
      *RRM-INI 16-JUN-1999
      *        MOVE TAB-CIC-CTAB IN TAB TO VEC-CPTO IN WSS-VARI (MOV-I)
      *        MOVE 'SEGDES'            TO VEC-CPTO IN WSS-VARI (MOV-I)
               MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-CTAB IN WSS-VARI
               MOVE WSS-CIC-CTA1 IN WSS-VARI
                                       TO VEC-CPTO  IN WSS-VARI (MOV-I)
      *RRM-FIN 16-JUN-1999
             MOVE OPC-VAL-SEGD IN OPC TO VEC-MONTO IN WSS-VARI (MOV-I).
      *ALD-BCI-FIN/22.11.1995
      *ALD-BCI-INI/12.09.1995
           IF OPC-VAL-SEGP IN OPC NOT NUMERIC
              MOVE ZEROES TO OPC-VAL-SEGP IN OPC.
           IF OPC-VAL-SEGP IN OPC NOT = 0
      * RBG-BCI-INI 14-DEC-1995
              MOVE 'COL'                    TO TAB-COD-SIST FIO-SIST
              MOVE 'VSC'                    TO TAB-COD-TTAB IN TAB
              MOVE OPC-COD-COOC IN OPC      TO TAB-COD-CTAB IN TAB
              MOVE FIO-GET-KEY TO FIO-CMND
              PERFORM GNS-FIO-TAB
              IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
      * RBG-BCI-FIN 14-DEC-1995
                 SET MOV-I UP BY 1
                 MOVE 'SEGAUT'            TO VEC-CPTO  IN WSS-VARI
                                                           (MOV-I)
                 MOVE OPC-VAL-SEGP IN OPC TO VEC-MONTO IN WSS-VARI
                                                           (MOV-I).
      *ALD-BCI-FIN/12.09.1995
      *RRM-INI 14-06-1999
           IF OPC-VAL-SEGC IN OPC NOT NUMERIC
              MOVE ZEROES TO OPC-VAL-SEGC IN OPC.
           IF OPC-VAL-SEGC IN OPC NOT = 0
              SET MOV-I UP BY 1
              MOVE 'COL'               TO FIO-SIST
              MOVE 'SDG'               TO TAB-COD-TTAB IN TAB
              MOVE OPC-COD-SEGD IN OPC TO TAB-COD-CTAB IN TAB
              MOVE FIO-GET-KEY    TO FIO-CMND
              PERFORM GNS-FIO-TAB
              MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-CTAB IN WSS-VARI
              MOVE WSS-CIC-CTA2 IN WSS-VARI
                                       TO VEC-CPTO  IN WSS-VARI (MOV-I)
              MOVE OPC-VAL-SEGC IN OPC TO VEC-MONTO IN WSS-VARI (MOV-I).
      *RRM-FIN 14-06-1999
       FIN-CAR-MOV-OPC.
           EXIT.
      * jpa INI

      *DPM ini  12-DEC-1996
       LEE-PRA-VEN SECTION.
       INI-LEE-PRA-VEN.
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
           MOVE 1                   TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
               MOVE 'VEN   INEX' TO  MSG-COD-MENS IN MSG
               GO TO FIN-LEE-PRA-VEN.

      * Convierte a pesos los valores almacenados en moneda
      * reajustable.
           IF OPC-MSC-TVOC IN OPC     = '0'    AND
              OPC-COD-CVOC IN OPC NOT = '999'  AND
              OPC-VAL-CRED IN OPC NOT = 0
              MOVE VEN-VAL-CAPI IN VEN TO WSS-VALOR-PESOS IN WSS-VARI
              PERFORM CONVERTIR-A-MONNAC
              IF ERROR-EN-PROCESO
                  GO TO FIN-LEE-PRA-VEN
              ELSE
                MOVE WSS-VALOR-PESOS IN WSS-VARI TO VEN-VAL-CAPI IN VEN.
       FIN-LEE-PRA-VEN.
           EXIT.
      *DPM fin  12-DEC-1996

       CONVERTIR-A-MONNAC SECTION.
      *==========================
      * Convierte a pesos los valores almacenados en moneda
      * reajustable.
       INI-CNV-MON-NAC.
      *---------------
            MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
            MOVE WSS-COD-MNAC IN WSS-VARI
                                     TO CAM-COD-VCAM IN CAM(2)
            IF OPC-IND-RENO IN OPC = 'PRO'
               MOVE WSS-FEC-FORI IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1)
               MOVE WSS-FEC-FORI IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2)
            ELSE
               MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(1)
               MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(2).
            MOVE FIO-GET-KEY TO FIO-CMND
            PERFORM TAB-FIO-CAM
            IF NOT FIO-STAT-OKS OR
               CAM-IND-VIGE IN CAM NOT = 'S'
               DISPLAY ' '
               DISPLAY 'NO EXI VCAM : '
                        CAM-KEY-CAMB IN CAM  ' PARA : '
                        OPC-CIC-IOPC IN OPC
               MOVE 1 TO WSS-IND-ERRO IN WSS-VARI
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'CAMVCAMNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   OPC-CIC-IOPC IN OPC
               GO TO FIN-CNV-MON-NAC
            ELSE
                MOVE 0 TO WSS-IND-ERRO IN WSS-VARI
                MULTIPLY CAM-SGV-VCAM IN CAM
                         BY WSS-VALOR-PESOS IN WSS-VARI
                            GIVING PES-SGV-DECI IN PES-VARI ROUNDED
                PERFORM PES-SCTV
                MOVE PES-SGV-ENTE IN PES-VARI
                                     TO WSS-VALOR-PESOS IN WSS-VARI.
       FIN-CNV-MON-NAC.
      *---------------
           EXIT.
      * jpa se inhibe para CHIBCI
      *       CAR-MOV-ICG SECTION.
      *       INI-CAR-MOV-ICG.
      *           IF ICG-SGV-MNTO IN ICG > 0
      *              IF WSS-GLS-NTAS IN WSS-VARI = 'IMP' AND
      *                 ICG-IND-TTAS IN ICG NOT = 'IMPINT'
      *                 IF WSS-ANT-NTAS IN WSS-VARI NOT = ICG-GLS-NTAS I
      *                    MOVE ICG-GLS-NTAS IN ICG TO WSS-ANT-NTAS IN W
      *                    SET MOV-I UP BY 1
      *                    MOVE 'IMPCOM'
      *                                   TO VEC-CPTO IN WSS-VARI (MOV-I
      *                    MOVE ICG-SGV-MNTO IN ICG
      *                                   TO VEC-MONTO IN WSS-VARI (MOV-
      *                 ELSE
      *                    ADD ICG-SGV-MNTO IN ICG
      *                                   TO VEC-MONTO IN WSS-VARI (MOV-
      *              ELSE
      *                 SET MOV-I UP BY 1
      *                 MOVE ICG-IND-TTAS IN ICG
      *                                   TO VEC-CPTO IN WSS-VARI (MOV-I
      *                 MOVE ICG-SGV-MNTO IN ICG
      *                                   TO VEC-MONTO IN WSS-VARI (MOV-
      *       FIN-CAR-MOV-ICG.
      *           EXIT.
      * jpa FIN
       CLOSE-FILE SECTION.
       INI-CLOSE-FILE.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           PERFORM COL-FIO-DLC.
           PERFORM TAB-FIO-CAM.
      * jpa INI
      *    PERFORM COL-FIO-ICG.
           PERFORM COL-FIO-EVC.
           PERFORM COL-FIO-CYA.
           PERFORM COL-FIO-CAN.
           PERFORM COL-FIO-RCV.
      * jpa FIN
      *DPM ini  12-DEC-1996
           PERFORM COL-FIO-VEN.
      *DPM fin  12-DEC-1996
           PERFORM COL-FIO-ROV.
           PERFORM COL-FIO-MCD.
           PERFORM COL-FIO-ERC.
           PERFORM COL-FIO-NAC.
           MOVE 'COL' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE 'TAB' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
       FIN-CLOSE-FILE.
           EXIT.
       LEE-DLC SECTION.
       INI-LEE-DLC.
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
               MOVE 'DLC   INEX' TO  MSG-COD-MENS IN MSG.
       FIN-LEE-DLC.
           EXIT.
       PRO-DLC SECTION.
       INI-PRO-DLC.
      * jpa INI
      * Para Chile BCI Impuestos y Gastos Notario se obtienen de la DLC
           IF DLC-VAL-IMPU IN DLC NOT = 0
              SET MOV-I UP BY 1
              MOVE 'IMP   '            TO VEC-CPTO  IN WSS-VARI (MOV-I)
              MOVE DLC-VAL-IMPU IN DLC TO VEC-MONTO IN WSS-VARI (MOV-I).
           IF DLC-VAL-GNOT IN DLC NOT = 0
              PERFORM PRO-NTR
              IF MSG-COD-MENS IN MSG NOT > SPACES
                 SET MOV-I UP BY 1
                 MOVE 'NTN  '          TO VEC-CPTO  IN WSS-VARI (MOV-I)
                 COMPUTE AUX-VEC-MONTO ROUNDED =
                             DLC-VAL-GNOT IN DLC * FACT-ABO IN WSS-VARI
                 MOVE AUX-VEC-MONTO TO VEC-MONTO IN WSS-VARI (MOV-I)
                 IF FACT-IMP NOT = 0
                    SET MOV-I UP BY 1
                    MOVE 'NTI  '       TO VEC-CPTO  IN WSS-VARI (MOV-I)
                    COMPUTE  VEC-MONTO IN WSS-VARI (MOV-I) =
                        DLC-VAL-GNOT IN DLC - AUX-VEC-MONTO IN WSS-VARI.
      * jpa FIN
       FIN-PRO-DLC.
           EXIT.
      * jpa INI
       PRO-NTR SECTION.
      *===============
      * Existen notarios con y sin retencion de impuesto
      * dependiendo de lo anterior, se asigna valores a
      * a las variables FACT-ABO ( factor para monto abonado )
      *                 FACT-IMP ( factor para monto impuesto retenido )
       INI-PRO-NTR.
      *-----------
      * OBTIENE MODO DE PAGO A NOTARIOS
           MOVE DLC-COD-NOTC   TO  NTR-COD-NOTA.
           MOVE OPC-COD-OFOC   TO  NTR-COD-OFIC.
           MOVE DLC-COD-TDOC   TO  NTR-COD-TDOC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-NTR.
           IF NOT FIO-STAT-OKS
              MOVE 'COL'          TO MSG-COD-SIST
              MOVE 'NTR  NOEXI' TO MSG-COD-MENS
              PERFORM GET-MSG
              DISPLAY MSG-GLS-DESC   OPC-CIC-IOPC IN OPC
           ELSE
              IF NTR-IND-RETE = 'S'
                 MOVE K-FACT-ABO IN WSS-VARI TO FACT-ABO IN WSS-VARI
                 MOVE K-FACT-IMP IN WSS-VARI TO FACT-IMP IN WSS-VARI
              ELSE
                 MOVE 0           TO FACT-IMP IN WSS-VARI
                 MOVE 1           TO FACT-ABO IN WSS-VARI.
       FIN-PRO-NTR.
      *-----------
           EXIT.
      * jpa FIN
      *
       PRO-ROV SECTION.
       INI-PRO-ROV.
      * OBTIENE VALOR RENOVADO SI OPC ES INGRESO DE REN/NOV
           MOVE ZEROES TO WSS-SGV-RENO IN WSS-VARI.
           IF OPC-IND-RENO IN OPC = 'NOV' OR 'REN'
              MOVE OPC-CIC-IOPC IN OPC TO ROV-CIC-IOPC IN ROV
              MOVE SPACES              TO ROV-CIC-IOPV IN ROV
              MOVE ZEROES              TO ROV-NUM-IVCT IN ROV
              MOVE FIO-GET-NLS TO FIO-CMND
              PERFORM COL-FIO-ROV
              IF NOT ( FIO-STAT-OKS AND
                       OPC-CIC-IOPC IN OPC = ROV-CIC-IOPC IN ROV )
                  MOVE 'COL'          TO MSG-COD-SIST
                  MOVE 'OPC  ROVNL' TO MSG-COD-MENS
                  PERFORM GET-MSG
                  DISPLAY MSG-GLS-DESC   OPC-CIC-IOPC IN OPC
                  GO TO FIN-PRO-ROV
              ELSE
                  MOVE ZEROES TO WSS-IND-ERRO IN WSS-VARI
                  PERFORM BUS-NXT-ROV
                    UNTIL ERROR-EN-PROCESO OR NOT FIO-STAT-OKS
                    OR  OPC-CIC-IOPC IN OPC NOT = ROV-CIC-IOPC IN ROV
                  IF MSG-GLS-DESC  > SPACES
      *              SUMA CONTADOR DE RECHAZADOS
                     GO TO FIN-PRO-ROV.
       FIN-PRO-ROV.
           EXIT.

       BUS-NXT-ROV SECTION.
       INI-BUS-NXT-ROV.
      *HZF-INI
      *    IF ROV-COD-VCVR IN ROV = OPC-COD-VCOC IN OPC
      *        DISPLAY '##1> WSS-SGV-RENO: ' WSS-SGV-RENO IN WSS-VARI
      *        ADD ROV-SGV-RENO IN ROV TO WSS-SGV-RENO IN WSS-VARI
      *        DISPLAY '##2> WSS-SGV-RENO: ' WSS-SGV-RENO IN WSS-VARI
      *    ELSE
      *        DISPLAY '##3> WSS-SGV-RENO: ' WSS-SGV-RENO IN WSS-VARI
      *        PERFORM OBT-VCAM-MON1
      *        PERFORM OBT-VCAM-MON2
      *        DISPLAY '##4> WSS-SGV-RENO: ' WSS-SGV-RENO IN WSS-VARI.
      *>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
           MOVE ROV-CIC-IOPV IN ROV TO CAN-CIC-IOPC IN CAN.
           MOVE ROV-NUM-IVCT IN ROV TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
              MOVE 1 TO WSS-IND-ERRO IN WSS-VARI
              MOVE 'COL'        TO MSG-COD-SIST
              MOVE 'OPCCANNOEX' TO MSG-COD-MENS
              PERFORM GET-MSG
              DISPLAY MSG-GLS-DESC ROV-CIC-IOPV IN ROV
                             ' - ' ROV-CIC-IOPV IN ROV
              GO TO FIN-BUS-NXT-ROV.
           ADD CAN-SGV-TREN IN CAN TO WSS-SGV-RENO IN WSS-VARI.
      *>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-ROV.
      *HZF-FIN
       FIN-BUS-NXT-ROV.
           EXIT.

      * OBT-VCAM-MON1 SECTION.
      * INI-OBT-VCAM-MON1.
      *     IF WSS-COD-MNAC IN WSS-VARI = ROV-COD-VCVR IN ROV
      *        GO TO FIN-OBT-VCAM-MON1.
      *      MOVE ROV-COD-VCVR IN ROV TO CAM-COD-VCAM IN CAM(1)
      *      MOVE WSS-COD-MNAC IN WSS-VARI
      *                               TO CAM-COD-VCAM IN CAM(2)
      *      MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(1)
      *      MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(2)
      *      MOVE FIO-GET-KEY TO FIO-CMND
      *      PERFORM TAB-FIO-CAM
      *      IF NOT FIO-STAT-OKS OR
      *         CAM-IND-VIGE IN CAM NOT = 'S'
      *         DISPLAY ' '
      *         DISPLAY 'NO EXI VCAM A PARA OPC DE PRO/REN/NOV : '
      *                  CAM-KEY-CAMB IN CAM  ' PARA : '
      *                  OPC-CIC-IOPC IN OPC
      *         MOVE 1 TO WSS-IND-ERRO IN WSS-VARI
      *         MOVE 'COL'        TO MSG-COD-SIST
      *         MOVE 'CAMVCAMNEX' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         DISPLAY MSG-GLS-DESC   OPC-CIC-IOPC IN OPC
      *         GO TO FIN-OBT-VCAM-MON1
      *      ELSE
      *          MULTIPLY CAM-SGV-VCAM IN CAM
      *                   BY ROV-SGV-RENO IN ROV
      *                      GIVING PES-SGV-DECI IN PES-VARI ROUNDED
      * jpa          MOVE WSS-COD-MNAC IN WSS-VARI
      * jpa                              TO PES-COD-VCAM IN PES-VARI
      *          PERFORM PES-SCTV
      *          MOVE PES-SGV-ENTE IN PES-VARI
      *                               TO ROV-SGV-RENO IN ROV.
      * FIN-OBT-VCAM-MON1.
      *     EXIT.
      * OBT-VCAM-MON2 SECTION.
      * INI-OBT-VCAM-MON2.
      *     IF WSS-COD-MNAC IN WSS-VARI = OPC-COD-VCOC IN OPC
      *        ADD ROV-SGV-RENO IN ROV TO WSS-SGV-RENO IN WSS-VARI
      *        GO TO FIN-OBT-VCAM-MON2.
      *      MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
      *      MOVE WSS-COD-MNAC IN WSS-VARI
      *                               TO CAM-COD-VCAM IN CAM(2)
      *      MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(1)
      *      MOVE OPC-FEC-FCOL IN OPC TO CAM-FEC-FCAM IN CAM(2)
      *      MOVE FIO-GET-KEY TO FIO-CMND
      *      PERFORM TAB-FIO-CAM
      *      IF NOT FIO-STAT-OKS OR
      *         CAM-IND-VIGE IN CAM NOT = 'S'
      *         DISPLAY ' '
      *         DISPLAY 'NO EXI VCAM A PARA OPC DE PRO/REN/NOV : '
      *                  CAM-KEY-CAMB IN CAM  ' PARA : '
      *                  OPC-CIC-IOPC IN OPC
      *         MOVE 1 TO WSS-IND-ERRO IN WSS-VARI
      *         MOVE 'COL'        TO MSG-COD-SIST
      *         MOVE 'CAMVCAMNEX' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         DISPLAY MSG-GLS-DESC   OPC-CIC-IOPC IN OPC
      *         GO TO FIN-OBT-VCAM-MON2
      *      ELSE
      *          DIVIDE ROV-SGV-RENO IN ROV
      *              BY CAM-SGV-VCAM IN CAM
      *                      GIVING PES-SGV-DECI IN PES-VARI ROUNDED
      * jpa          MOVE OPC-COD-VCOC IN OPC
      * jpa                              TO PES-COD-VCAM IN PES-VARI
      *          PERFORM PES-SCTV
      *          ADD PES-SGV-ENTE IN PES-VARI
      *                               TO WSS-SGV-RENO IN WSS-VARI.
      * FIN-OBT-VCAM-MON2.
      *     EXIT.
      * jpa INI
       PRO-PRO SECTION.
       INI-PRO-PRO.
      * Obtiene valor renovado si opc es ingreso de prorroga.
      * Conversion a pesos se efectua a la fcol original.
           IF OPC-IND-RENO IN OPC NOT = 'PRO'
              GO TO FIN-PRO-PRO.
           MOVE ZEROES TO WSS-SGV-RENO IN WSS-VARI.
           MOVE OPC-VAL-CRED IN OPC TO WSS-SGV-RENO IN WSS-VARI.
      * Guarda el CIC de la OPC de la prorroga.
           MOVE OPC-CIC-IOPC IN OPC TO AUX-CIC-IOPC IN WSS-VARI.
      * Lee OPC original para rescatar la fecha de origen.
           MOVE DLC-CIC-IOCO IN DLC TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
              MOVE 'COL'        TO MSG-COD-SIST
              MOVE 'OPCORIGNEX' TO MSG-COD-MENS
              PERFORM GET-MSG
              DISPLAY MSG-GLS-DESC   OPC-CIC-IOPC IN OPC
           ELSE
      * Mueve fecha de OPC original para la conversion a valor origen
              MOVE OPC-FEC-FCOL IN OPC TO WSS-FEC-FORI IN WSS-VARI.
      * Vuelve a leer la OPC de la prorroga
           MOVE AUX-CIC-IOPC IN WSS-VARI TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FIN-PRO-PRO.
           EXIT.
      *
       CAL-IPN SECTION.
      *===============
      * Obtiene intereses anticipados.
      * Asume que hay intereses anticipados si:
      *    - credito con estructura de vencimientos
      *    - al menos una EVC posee tip.calc.vctos = "FI"
      * Valor intereses anticipados = ValCred-(Liquido+Imptos+Gastos)
       INI-CAL-IPN.
      *-----------
           IF OPC-IND-VSTR = 'S'
              MOVE OPC-CIC-IOPC IN OPC TO EVC-CIC-IOPC IN EVC
              MOVE ZEROES              TO EVC-NUM-IEVC IN EVC
              MOVE FIO-GET-NLS TO FIO-CMND
              PERFORM COL-FIO-EVC
              IF NOT FIO-STAT-OKS
                 OR OPC-CIC-IOPC IN OPC NOT = EVC-CIC-IOPC IN EVC
                 MOVE 'EVC   INEX' TO  MSG-COD-MENS IN MSG
              ELSE
                 MOVE 'N' TO WSS-FIN-LOOP
                 PERFORM LOOP-EVC UNTIL EVC-MSC-TCVE = WSS-CIC-TCVE-IF
                                     OR FIN-LOOP
                 IF EVC-MSC-TCVE = WSS-CIC-TCVE-IF
      *ALD-BCI-INI/01.02.1996
                    AND OPC-CIC-IOPC IN OPC = EVC-CIC-IOPC IN EVC
      *ALD-BCI-FIN/01.02.1996
                    COMPUTE WSS-IPN IN WSS-VARI = OPC-VAL-CRED IN OPC
                                              - ( OPC-SGV-LIQU IN OPC +
      *ALD-BCI-INI/12.09.1995
                                                  OPC-VAL-SEGP IN OPC +
      *ALD-BCI-FIN/12.09.1995
                                                  OPC-VAL-SEGD IN OPC +
                                                  OPC-SGV-VCOM IN OPC +
                                                  OPC-VAL-GAST IN OPC +
                                                  DLC-VAL-IMPU IN DLC +
                                                  DLC-VAL-GNOT IN DLC )
                    IF WSS-IPN IN WSS-VARI NOT = 0
                       SET MOV-I UP BY 1
                       MOVE 'INTPNG'            TO VEC-CPTO
                                                   IN WSS-VARI (MOV-I)
                       MOVE WSS-IPN IN WSS-VARI TO VEC-MONTO
                                                   IN WSS-VARI (MOV-I).
           GO TO FIN-CAL-IPN.
       LOOP-EVC.
      *--------
           MOVE FIO-GET-NXT TO FIO-CMND
           PERFORM COL-FIO-EVC
           IF NOT FIO-STAT-OKS
              OR OPC-CIC-IOPC IN OPC NOT = EVC-CIC-IOPC IN EVC
              MOVE 'S' TO WSS-FIN-LOOP.
       FIN-CAL-IPN.
      *-----------
           EXIT.
       PRO-CYA SECTION.
      *===============
      * Los montos del abono liquido deben contabilizarse en cuentas
      * distintas dependiendo del Concepto del tipo de abono ( ctacte,
      * vvista, etc ).
      * Genera 'n' conceptos dependiendo de la cantidad de Conceptos
      * distintos correspondientes a los TCYA de las CYA's asociadas
      * al curse de la operacion.
      * Asigna a VEC-CPTO(i) el Concepto del(los) TCYA
      * Asigna a VEV-MONTO(i) la suma de montos de las CYA's cuyos
      * TCYA posean igual Concepto.
      * El concepto esta almacenado en las posiciones 31,32,33 de los
      * datos adicionales de la tabla MSC.TCYA
       INI-PRO-CYA.
      *-----------
           MOVE OPC-CIC-IOPC IN OPC TO CYA-CIC-IOPC IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF NOT FIO-STAT-OKS
              OR CYA-CIC-IOPC IN CYA  NOT = OPC-CIC-IOPC IN OPC
              OR CYA-NUM-ICAN IN CYA  NOT = ZEROES
              MOVE 'CYACURINEX' TO  MSG-COD-MENS IN MSG
              DISPLAY FIO-STAT
           ELSE
              MOVE 'N' TO WSS-FIN-LOOP
              SET CYA-I TO 1
              PERFORM LOOP-CYA UNTIL FIN-LOOP
              SET CYA-TOPE TO CYA-I
              SET CYA-I TO 1
              PERFORM LOOP-VEC-CYA UNTIL CYA-I NOT < CYA-TOPE.
           GO TO FIN-PRO-CYA.
      *
       LOOP-CYA.
      *--------
      * Obtiene el Concepto para el TCYA
      * Chequea si el Concepto se repite en otro CYA ( cargado en matriz
      * Carga matriz con los Conceptos y sus montos ( del CYA ) y
      * acumula en caso de repetirse el Concepto.
           PERFORM OBT-CPTO-TCYA.
           PERFORM CHK-CPTO-EXIS.
           IF NOT EXISTE
              MOVE MSC-COD-DAT3 IN MSC (1) TO VEC-CPTO-CYA
                                          IN WSS-VARI (CYA-I)
              MOVE CYA-SGV-LIQU IN CYA TO VEC-MONTO-CYA
                                          IN WSS-VARI (CYA-I)
              SET CYA-I UP BY 1
           ELSE
              ADD CYA-SGV-LIQU IN CYA  TO VEC-MONTO-CYA
                                          IN WSS-VARI (EXI-I).
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF NOT FIO-STAT-OKS
              OR CYA-CIC-IOPC IN CYA  NOT = OPC-CIC-IOPC IN OPC
              OR CYA-NUM-ICAN IN CYA  NOT = ZEROES
              MOVE 'S' TO WSS-FIN-LOOP.
      *
       OBT-CPTO-TCYA.
      *-------------
           MOVE 'TAB'                TO FIO-SIST.
           MOVE 'MSC'                TO MSC-COD-TTAB IN MSC.
           MOVE 'TCYA'               TO MSC-COD-TMSC IN MSC.
           MOVE CYA-IND-TCYA IN CYA  TO MSC-COD-CMSC IN MSC.
           MOVE FIO-GET-KEY          TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
              MOVE 'COL'       TO MSG-COD-SIST
              MOVE 'CODTCYANEX' TO MSG-COD-MENS IN MSG
              PERFORM GET-MSG
              DISPLAY MSG-GLS-DESC   MSC-COD-CMSC
              PERFORM GNS-PRO-ABT
              GO TO FIN-PRO-CYA.
      *
       LOOP-VEC-CYA.
      *------------
      * Recorre matriz con acumulados por CIC
      * Graba en matriz definitiva los CIC y sus montos
      *ALD-BCI-INI/31.10.1995
      *    IF VEC-MONTO-CYA IN WSS-VARI (CYA-I) > ZEROES
      *    IF VEC-MONTO-CYA IN WSS-VARI (CYA-I) NOT = ZEROES
      *ALD-BCI-INI/31.10.1995
              SET MOV-I UP BY 1
              MOVE VEC-CPTO-CYA  IN WSS-VARI (CYA-I) TO
                   VEC-CPTO      IN WSS-VARI (MOV-I)
              MOVE VEC-MONTO-CYA IN WSS-VARI (CYA-I) TO
                   VEC-MONTO     IN WSS-VARI (MOV-I)
              MOVE 'L '                              TO
                   VEC-ES-LIQ    IN WSS-VARI (MOV-I).
           SET CYA-I UP BY 1.
      *
       FIN-PRO-CYA.
      *-----------
           EXIT.
      *
       CHK-CPTO-EXIS SECTION.
      *=====================
       INI-CHK-EXI.
      *-----------
           MOVE 'N'     TO WSS-EXISTE
           SET EXI-TOPE TO CYA-I.
           SET EXI-I    TO 1.
           IF EXI-TOPE = EXI-I
              GO TO FIN-CHK-EXI.
       LUP-CHK-EXI.
      *-----------
           IF EXI-I NOT < EXI-TOPE
              GO TO FIN-CHK-EXI.
           IF MSC-COD-DAT3 IN MSC (1) = VEC-CPTO-CYA
                                        IN WSS-VARI (EXI-I)
              MOVE 'S' TO WSS-EXISTE
           ELSE
              SET EXI-I UP BY 1
              GO TO LUP-CHK-EXI.
       FIN-CHK-EXI.
      *-----------
           EXIT.
      * jpa FIN
      *
       GRA-MOV SECTION.
       INI-GRA-MOV.
           SET MOV-TOPE TO MOV-I.
           SET MOV-I TO 1.
       LUP-GRA-MOV.
           IF MOV-I > MOV-TOPE
              GO TO FIN-GRA-MOV.
           MOVE SPACES                        TO MCD-GLS-FLAG IN MCD.
           MOVE WSS-COD-CUR IN WSS-VARI       TO MCD-COD-MVTO IN MCD.
           MOVE OPC-COD-VCOC IN OPC           TO MCD-COD-VCOC IN MCD.
           MOVE OPC-COD-COOC IN OPC           TO MCD-COD-COOC IN MCD.
      *JPA MOVE OPC-FEC-FING IN OPC           TO MCD-FEC-FCTB IN MCD.
           MOVE OPC-FEC-FINP IN OPC           TO MCD-FEC-FCTB IN MCD.
           MOVE DLC-IND-SCRT IN DLC           TO MCD-IND-SCRT IN MCD.
           IF  DLC-IND-SCTB IN DLC = 'MUL'
               MOVE SPACES                    TO MCD-IND-SCTB IN MCD
           ELSE
               MOVE DLC-IND-SCTB IN DLC       TO MCD-IND-SCTB IN MCD.
           MOVE OPC-CIC-IOPC IN OPC           TO MCD-CIC-IOPC IN MCD.
           MOVE ZEROES                        TO MCD-NUM-ICAN IN MCD.
           MOVE VEC-CPTO   IN WSS-VARI (MOV-I) TO MCD-SGV-CPTO IN MCD.
           MOVE VEC-MONTO  IN WSS-VARI (MOV-I) TO MCD-SGV-MNTO IN MCD.
           MOVE VEC-ES-LIQ IN WSS-VARI (MOV-I) TO MCD-IND-LIQU IN MCD.
           MOVE DLC-IND-SCBZ IN DLC           TO MCD-IND-SCBZ IN MCD.
           MOVE OPC-COD-OFOC IN OPC           TO MCD-COD-OFOC IN MCD.
      *RJZ INI 21-JUNIO-1995
           MOVE OPC-COD-OFOC IN OPC           TO MCD-COD-OFCA IN MCD.
      *RJZ FIN 21-JUNIO-1995
           MOVE DLC-COD-PLZO IN DLC           TO MCD-COD-PLZO IN MCD.
           MOVE WSS-FEC-FFEC IN WSS-VARI      TO MCD-FEC-FMOV IN MCD.
           MOVE OPC-NUM-VCOR IN OPC           TO MCD-NUM-IVCT IN MCD.
           MOVE DLC-NUM-IDLC IN DLC           TO MCD-NUM-IDLC IN MCD.
           MOVE OPC-VAL-SCRE IN OPC           TO MCD-SGV-SCRE IN MCD.
           MOVE OPC-COD-OFOC IN OPC           TO MCD-COD-OFMV IN MCD.
           MOVE SPACES                        TO MCD-IND-CANC IN MCD.
           MOVE OPC-FEC-FCOL IN OPC           TO MCD-FEC-FREA IN MCD.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-MCD.
           ADD 1 TO WSS-NUM-RGRA IN WSS-VARI.
       SIG-GRA-MOV.
           SET MOV-I UP BY 1.
           GO TO LUP-GRA-MOV.
       FIN-GRA-MOV.
           EXIT.
       COPY COLBFOPC.
      *jpa ini
      *COPY COLBFICG.
       COPY COLBFNTR.
       COPY COLBFEVC.
       COPY COLBFCYA.
       COPY COLBFCAN.
       COPY COLBFRCV.
      *jpa fin
      *DPM ini  12-DEC-1996
       COPY COLBFVEN.
      *DPM fin  12-DEC-1996
       COPY COLBFROV.
       COPY COLBFDLC.
       COPY COLBFTOC.
       COPY COLBFMCD.
       COPY COLBFERC.
       COPY COLBFNAC.
       COPY GNSBFMSG.
       COPY GNSBFMSC.
       COPY GNSBFTAB.
       COPY TABBFCAM.
      *DAD  ini 24-ABR-1991
       COPY GNSBBTAB.
      *DAD  fin 24-ABR-1991
       COPY GNSBBMSG.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY GNSBGHOY.
       COPY GNSBGEND.
      *DAD ini  29-MAY-1992   (Memo.27-04-92)
       COPY GNSBGABT.
       COPY GNSBGPES.



