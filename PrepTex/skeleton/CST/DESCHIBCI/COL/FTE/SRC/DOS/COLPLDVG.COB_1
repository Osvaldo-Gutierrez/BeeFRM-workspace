       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPLDVG.
       AUTHOR.          CONSIST (DPM).
       DATE-WRITTEN.    16-Sep-97 08:24 PM.

      * Programa Listador de Reporte DVG con Sort.
      *
      * V 1.1.2
      *
      *<<<< CMT_ID
      *>>>>

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            C01 IS SALTO
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
      *DOS SELECT RPTDVG         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTDVG         ASSIGN TO        UT-S-RPTDVG.
           SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT RPTDVG         ASSIGN TO        UT-S-RPTDVG.
      *<<<< IOS
      *>>>>

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY COLRRDVG.
      *<<<< RR
      *>>>>
       FD  RPTDVG LABEL RECORDS OMITTED
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-DVG     PIC X(132).
      *<<<< FD_RPT
      *>>>>
      *<<<< FLS
      *>>>>

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DVG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY COLBRDVG.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSWGGRC.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY COLRWDVG.
      *<<<< RW
      *>>>>
       COPY COLRNDVG.
      *<<<< RN
      *>>>>
       COPY COLRODVG.
      *<<<< RO
      *>>>>
       COPY GNSWGSYS.
       01  PGM-HRSR-DVG   VALUE 'N'       PIC X(01).
           88 HAY-REGISTROS-EN-SORT-DVG  VALUE 'S'.
           
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       01  WSS-VARI.
           03  WSS-NUM-RLEI       VALUE ZEROES    PIC 9(03).
           03  WSS-NUM-RSEL       VALUE ZEROES    PIC 9(03).
           03  WSS-IND-VACIO      VALUE 'N'       PIC X(01).
           03  WSS-IND-LSIG       VALUE 'N'       PIC X(01).

      * Variables para emulacion de archivo MCD para comparar con
      * CIC de tabla ALG para saber el concepto a grabar en DVG
           03 WSS-IND-IDN                         PIC X(03).
           03 WSS-IND-RDN                         PIC X(03).
           03 WSS-IND-IDS                         PIC X(03).
           03 WSS-IND-RDS                         PIC X(03).
           03 WSS-IND-IDM                         PIC X(03).
           03 WSS-IND-RDM                         PIC X(03).
           03 WSS-COD-PESO                        PIC X(06).
           03 WSS-MSC-MNAC                        PIC X(01).

           03 WSS-CIC-IOPC                        PIC X(12).
           03 WSS-COD-OFOC                        PIC X(03).
           03 WSS-MSC-TCCT                        PIC X(03).
           03 WSS-FEC-FVEN.
              05  WSS-NUM-SVEN   VALUE ZEROES    PIC 9(02).
              05  WSS-NUM-AVEN   VALUE ZEROES    PIC 9(02).
              05  WSS-NUM-MVEN   VALUE ZEROES    PIC 9(02).
              05  WSS-NUM-DVEN   VALUE ZEROES    PIC 9(02).
           03 WSS-FEC-FDEV.
              05  WSS-NUM-SDEV   VALUE ZEROES    PIC 9(02).
              05  WSS-NUM-ADEV   VALUE ZEROES    PIC 9(02).
              05  WSS-NUM-MDEV   VALUE ZEROES    PIC 9(02).
              05  WSS-NUM-DDEV   VALUE ZEROES    PIC 9(02).
           03 WSS-FEC-FCOL.
              05  WSS-NUM-SCOL   VALUE ZEROES    PIC 9(02).
              05  WSS-NUM-ACOL   VALUE ZEROES    PIC 9(02).
              05  WSS-NUM-MCOL   VALUE ZEROES    PIC 9(02).
              05  WSS-NUM-DCOL   VALUE ZEROES    PIC 9(02).
           03 WSS-IND-SCTB                       PIC X(03).
           03 WSS-IND-SCBZ                       PIC X(05).
           03 WSS-IND-SCRT                       PIC X(03).
           03 WSS-COD-PLZO.
              05 WSS-MSC-TPZO                    PIC X(01).
              05 WSS-MSC-CPZO                    PIC X(01).
           03 WSS-COD-VCOC.
              05 WSS-MSC-TVOC                    PIC X(01).
              05 WSS-MSC-CVOC                    PIC X(03).
              05 WSS-MSC-TCOC                    PIC X(02).
           03 WSS-COD-COOC.
              05 WSS-COD-TOOC                    PIC X(03).
              05 WSS-COD-AOOC                    PIC X(03).
           03 WSS-SGV-ICTB    VALUE ZEROES       PIC S9(13)V9(02).
           03 WSS-VAL-SCRE    VALUE ZEROES       PIC 9(11)V9(04).
           03 WSS-GLS-COOC.
              05 WSS-GLS-TOOC                    PIC X(25).
              05 WSS-GLS-AOOC                    PIC X(25).
           03 WSS-SGV-TASA    VALUE ZEROES       PIC S9(04)V9(04).
      *>>>>
      *<<<< WSS_DTC
      * COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
      * COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
      * COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      * COPY COLBRICG.
      * COPY COLBROPC.
      * COPY COLBRDLC.
       COPY COLBRRDC.
       COPY SGCBRDBC.
       COPY TABBROFI.
       COPY COLBRDCC.
       COPY GNSBRMSC.
       COPY GNSWGCPT.
       COPY TABBRCAM.
       COPY GNSWGPES.
      *>>>>

      * AQUI EXISTIA LABEL RF INI
      *<<<< RF
      *>>>>
      * AQUI EXISTIA LABEL RF FIN
       COPY COLRTDVG.
      *<<<< RT
      *>>>>

       PROCEDURE DIVISION.
      *==================

      * AQUI EXISTIA LABEL FIN_DEC INI
      *<<<< FIN_DEC
      *>>>>
      * AQUI EXISTIA LABEL FIN_DEC FIN

       MAIN SECTION.
      *------------
       INI-MAIN.
      *<<<< MAX_FILE
      *>>>>
           MOVE SYS-MXFL TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       COPY GNSBGEDB.
           MOVE 'COL' TO RPT-SIST.
           MOVE 'COLPLDVG' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *<<<< INI
      *>>>>
           SORT GNSSRT
       COPY COLRSDVG.
      *<<<< RS
      *>>>>
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
      *<<<< FIN
      *>>>>
           IF PGM-STAT-SRT-MAL OR SORT-RETURN > 0
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<< INI_INP
           MOVE FIO-INP TO FIO-CMND.
      *     PERFORM COL-FIO-ICG.
      *     PERFORM COL-FIO-OPC.
      *     PERFORM COL-FIO-DLC.
           PERFORM COL-FIO-DCC.
           PERFORM SGC-FIO-DBC.
      *>>>>
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-DVG.
       FST-INP-SRT.
      *<<<< INI_FST_INP
      *RESCATA COD DE INT NORMAL
           MOVE 'IDN'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-IDN IN WSS-VARI.
      *RESCATA COD DE REAJ NORMALES
           MOVE 'RDN'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-RDN IN WSS-VARI.
      *RESCATA COD DE INT SUSPENDIDOS
           MOVE 'IDS'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-IDS IN WSS-VARI.
      *RESCATA COD DE REAJ SUSPENDIDOS
           MOVE 'RDS'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-RDS IN WSS-VARI.
      *RESCATA COD DE INT MORATORIOS
           MOVE 'IDM'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-IDM IN WSS-VARI.
      *RESCATA COD DE REAJ MORATORIOS
           MOVE 'RDM'          TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUSCA-CIC-TCCT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-IND-RDM IN WSS-VARI.

      *Rescata el codigo de PESOS
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CICPESONEX' TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
               PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS-VARI.

      *Rescata codigo de Mon. Nacional
           MOVE 'TAB'  TO FIO-SIST.
           MOVE 'TVAL' TO MSC-CIC-TMSC IN MSC.
           MOVE '0'    TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'CICTVAL0NEX' TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
               PERFORM GNS-PRO-ABT.
           MOVE MSC-COD-CMSC IN MSC TO WSS-MSC-MNAC IN WSS-VARI.
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-DVG.
      *<<<< FIN_FST_INP
           IF NOT FIO-STAT-OKS
               MOVE 'S' TO WSS-IND-VACIO IN WSS-VARI
               GO TO FIN-INP-SRT.

           PERFORM MOVER-DVG-WSS.

      *Obtiene Cuenta CAP
           PERFORM OBT-CUENTA-DCC.
           IF WSS-IND-LSIG IN WSS-VARI = 'S'
               GO TO NXT-INP-SRT.

      *Lee registro DBC
           PERFORM LEE-DBC.
           IF WSS-IND-LSIG IN WSS-VARI = 'S'
               GO TO NXT-INP-SRT.

      *Lee registro ICG para obtener Tasa de Interes
      *     PERFORM COL-BUS-TIN.
      *     IF WSS-IND-LSIG IN WSS-VARI = 'S'
      *         DISPLAY 'ERROR LECTURA ICG: ' WSS-CIC-IOPC IN WSS-VARI
      *         GO TO NXT-INP-SRT.

           MOVE ZEROES TO SRT-VAL-INTD IN SRT
                          SRT-VAL-READ IN SRT
                          SRT-VAL-INTO IN SRT
                          SRT-VAL-REAO IN SRT
                          SRT-VAL-INTM IN SRT
                          SRT-VAL-REAM IN SRT.

           MOVE DVG-NUM-DPRO IN DVG TO WSS-NUM-DPRO IN WSS-DVG.
           MOVE DVG-NUM-MPRO IN DVG TO WSS-NUM-MPRO IN WSS-DVG.
           MOVE DVG-NUM-SPRO IN DVG TO WSS-NUM-SPRO IN WSS-DVG.
           MOVE DVG-NUM-APRO IN DVG TO WSS-NUM-APRO IN WSS-DVG.
      *>>>>
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
           ADD 1 TO WSS-NUM-RLEI IN WSS-VARI.

           MOVE DVG-MSC-TCCT IN DVG TO WSS-MSC-TCCT IN WSS-VARI.
           MOVE DVG-SGV-ICTB IN DVG TO WSS-SGV-ICTB IN WSS-VARI.

           IF DVG-CIC-IOPC IN DVG = WSS-CIC-IOPC IN WSS-VARI AND
              DVG-COD-OFOC IN DVG = WSS-COD-OFOC IN WSS-VARI
               PERFORM DET-TIPO-CPTO
               GO TO NXT-INP-SRT.

           IF WSS-IND-LSIG IN WSS-VARI = 'S'
               MOVE 'N' TO WSS-IND-LSIG IN WSS-VARI
               GO TO SIGUE-INP-SRT.

           IF WSS-MSC-TVOC IN WSS-VARI = WSS-MSC-MNAC IN WSS-VARI
               PERFORM DET-SALDO-EN-PESOS
               IF WSS-IND-LSIG IN WSS-VARI = 'S'
                   MOVE 'N' TO WSS-IND-LSIG IN WSS-VARI
                   GO TO NXT-INP-SRT
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE WSS-VAL-SCRE IN WSS-VARI TO SRT-VAL-SCRE IN SRT.

           PERFORM MOVER-DATOS-SRT.

           ADD 1 TO WSS-NUM-RSEL IN WSS-VARI.
           RELEASE SRT.

       SIGUE-INP-SRT.
           MOVE ZEROES TO SRT-VAL-INTD IN SRT
                          SRT-VAL-READ IN SRT
                          SRT-VAL-INTO IN SRT
                          SRT-VAL-REAO IN SRT
                          SRT-VAL-INTM IN SRT
                          SRT-VAL-REAM IN SRT.

           PERFORM MOVER-DVG-WSS.
           PERFORM DET-TIPO-CPTO.

      *Obtiene Cuenta CAP
           PERFORM OBT-CUENTA-DCC.
           IF WSS-IND-LSIG IN WSS-VARI = 'S'
               DISPLAY 'ERROR LECTURA DCC: ' DCC-KEY-IREG IN DCC
               GO TO NXT-INP-SRT.

      *Lee registro DBC
           PERFORM LEE-DBC.
           IF WSS-IND-LSIG IN WSS-VARI = 'S'
               GO TO NXT-INP-SRT.

      *Lee registro ICG para obtener Tasa de Interes
      *     PERFORM COL-BUS-TIN.
      *     IF WSS-IND-LSIG IN WSS-VARI = 'S'
      *         DISPLAY 'ERROR LECTURA ICG: ' WSS-CIC-IOPC IN WSS-VARI
      *         GO TO NXT-INP-SRT.

           GO TO NXT-INP-SRT.
      *>>>>
       MOV-INP-SRT.
       COPY COLRMDVG.
      *<<<< RM
      *>>>>
           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-DVG.
      *<<<< FIN_NXT_INP
      *>>>>
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
      *<<<< FIN_INP
           IF WSS-IND-VACIO IN WSS-VARI = 'S' AND
              WSS-IND-LSIG IN WSS-VARI = 'N'
               DISPLAY 'ARCHIVO DVG VACIO...'
               DISPLAY 'PROCESO CANCELADO...'
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.

           IF WSS-IND-VACIO IN WSS-VARI NOT = 'S' AND
              WSS-IND-LSIG IN WSS-VARI = 'N'
               IF WSS-MSC-TVOC IN WSS-VARI = WSS-MSC-MNAC IN WSS-VARI
                  PERFORM DET-SALDO-EN-PESOS
                  IF WSS-IND-LSIG IN WSS-VARI = 'S'
                     MOVE 'N' TO WSS-IND-LSIG IN WSS-VARI
                     GO TO FIN-INP-SRT
                  ELSE
                     NEXT SENTENCE
               ELSE
                  MOVE WSS-VAL-SCRE IN WSS-VARI TO SRT-VAL-SCRE IN SRT.

           IF WSS-IND-VACIO IN WSS-VARI NOT = 'S' AND
              WSS-IND-LSIG IN WSS-VARI = 'N'
               PERFORM DET-TIPO-CPTO
               PERFORM MOVER-DATOS-SRT
               ADD 1 TO WSS-NUM-RSEL IN WSS-VARI
               RELEASE SRT.

           MOVE FIO-CLO TO FIO-CMND.
      *     PERFORM COL-FIO-ICG.
      *     PERFORM COL-FIO-OPC.
      *     PERFORM COL-FIO-DLC.
           PERFORM COL-FIO-DCC.
           PERFORM SGC-FIO-DBC.
      *>>>>
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-DVG.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
      *<<<< INI_OUT
           DISPLAY 'ESTADISTICAS'.
           DISPLAY '------------'.
           DISPLAY 'REGISTROS LEIDOS DVG        : '
                                    WSS-NUM-RLEI IN WSS-VARI.
           DISPLAY 'REGISTROS SELECCIONADOS DVG : '
                                    WSS-NUM-RSEL IN WSS-VARI.
      *>>>>
           OPEN OUTPUT RPTDVG.
      *     MOVE 'COLPLDVG' TO RPT-NPGM.
           PERFORM CAL-HDR.
           PERFORM INITIATE-RPTDVG.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           MOVE SRT TO SRT-OLD-DVG.
           MOVE SRT TO SRT-CUR-DVG.
      *<<<< FST_OUT
      *>>>>
      *    PERFORM DVG-FST-PRO-CTL.
       LUP-OUT-SRT.
      *<<<< LUP_OUT
      *Obtiene glosa de oficina
           IF SRT-COD-OFOC IN SRT > SPACES
               MOVE SRT-COD-OFOC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFOC IN WSS-DVG.

      * Mediante BUS-TAB Busca Tipo de Operacion Credito de Tabla TIO
           IF SRT-COD-COOC IN SRT > SPACES
               MOVE SRT-COD-COOC IN SRT     TO WSS-COD-TOOC IN WSS-VARI
               MOVE 'TAB'                   TO TAB-COD-SIST
               MOVE 'TIO'                   TO TAB-COD-TTAB IN TAB
               MOVE WSS-COD-TOOC IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TOOC IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-TOOC IN WSS-VARI.

      *BUS-TAB busca glosa de clase de credito en tabla AUX
           IF SRT-COD-COOC IN SRT > SPACES
               MOVE 'COL'               TO TAB-COD-SIST
               MOVE 'AUX'               TO TAB-COD-TTAB IN TAB
               MOVE SRT-COD-COOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-AOOC IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-AOOC IN WSS-VARI.

           MOVE WSS-GLS-COOC IN WSS-VARI TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN            TO WSS-GLS-COOC IN WSS-VARI.
           MOVE WSS-GLS-COOC IN WSS-VARI TO WSS-GLS-COOC IN WSS-DVG.

      *BUS-TAB busca glosa de Cuenta Contable en tabla PCC
      * Obtiene glosa de cuenta de capital
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'PCC' TO TAB-COD-TTAB IN TAB.
           MOVE SRT-CIC-CCSB IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF FIO-STAT-OKS
             MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-CCSB IN WSS-DVG
           ELSE
             MOVE SPACES TO WSS-GLS-CCSB IN WSS-DVG.
      *>>>>
       GEN-OUT-SRT.
           PERFORM GENERATE-DL-DVG.
      *<<<< FIN_GEN_OUT
      *>>>>
       NXT-OUT-SRT.
           MOVE SRT TO SRT-OLD-DVG.
       RET-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
      *<<<< FIN_OUT
      *>>>>
           IF HAY-REGISTROS-EN-SORT-DVG
                PERFORM TERMINATE-RPTDVG.
      *<<<< FIN_TMT
      *>>>>
           CLOSE RPTDVG.
       EXT-OUT-SRT.
           EXIT.
       COPY COLBFDVG.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGIRH.
       COPY COLREDVG.
      *    05-SEP-97 03:44 PM     ,PAI=CHI ,CLI=BCI ,SOP=MVS  V 1.1.5 
       D-CF-DVG-SRT-COD-COOC SECTION.
       INI-CF-DVG-SRT-COD-COOC.
      *<<<< CF_DVG_SRT_COD_COOC
      *>>>>
       FIN-CF-DVG-SRT-COD-COOC.
           EXIT.
       D-CH-DVG-SRT-COD-COOC SECTION.
       INI-CH-DVG-SRT-COD-COOC.
      *<<<< CH_DVG_SRT_COD_COOC
           MOVE SRT-COD-COOC IN SRT TO WSS-COD-COOC IN WSS-DVG.
      *>>>>
       FIN-CH-DVG-SRT-COD-COOC.
           EXIT.
       D-CF-DVG-SRT-COD-OFOC SECTION.
       INI-CF-DVG-SRT-COD-OFOC.
      *<<<< CF_DVG_SRT_COD_OFOC
      *>>>>
       FIN-CF-DVG-SRT-COD-OFOC.
           EXIT.
       D-CF-DVG-SRT-CIC-CCSB SECTION.
       INI-CF-DVG-SRT-CIC-CCSB.
      *<<<< CF_DVG_SRT_CIC_CCSB
      *>>>>
       FIN-CF-DVG-SRT-CIC-CCSB.
           EXIT.
       D-PH-DVG SECTION.
       INI-PH-DVG.
      *<<<< PH_DVG
      *>>>>
       FIN-PH-DVG.
           EXIT.
       D-DL-DVG SECTION.
       INI-DL-DVG.
      *<<<< DL_DVG
      *>>>>
       FIN-DL-DVG.
           EXIT.
       COPY GNSBGABT.

      *<<<< EOF
      * COPY COLBFICG.
      * COPY COLBFOPC.
      * COPY COLBFDLC.
       COPY COLBFRDC.
       COPY SGCBFDBC.
       COPY TABBBOFI.
       COPY TABBFOFI.
       COPY COLBFDCC.
       COPY GNSBBTAB.
       COPY GNSBBMSG.
       COPY GNSBFMSC.
       COPY GNSBGCPT.
       COPY TABBFCAM.
       COPY GNSBGPES.

       LEE-DBC SECTION.
      *---------------*
       INI-LEE-DBC.
           MOVE WSS-CIC-IOPC IN WSS-VARI TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES                   TO RDC-NUM-IDLC IN RDC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           PERFORM COL-FIO-RDC.
           IF NOT (FIO-STAT-OKS AND
                   WSS-CIC-IOPC IN WSS-VARI = RDC-CIC-IOPC IN RDC)
               MOVE 'S' TO WSS-IND-LSIG IN WSS-VARI
               DISPLAY 'ERROR LECTURA RDC: ' WSS-CIC-IOPC IN WSS-VARI
               GO TO FIN-LEE-DBC.

           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               MOVE 'S' TO WSS-IND-LSIG IN WSS-VARI
               DISPLAY 'ERROR LECTURA DBC: ' RDC-CIC-ICLI IN RDC.
       FIN-LEE-DBC.
           EXIT.


      * Rutina para obtener tasa de interes
      * COL-BUS-TIN SECTION.
      *-------------------*
      * INI-COL-BUS-TIN.
      *     MOVE WSS-CIC-IOPC IN WSS-VARI TO ICG-CIC-IOPC IN ICG.
      *     MOVE ZEROES                   TO ICG-NUM-ICAN IN ICG.
      *     MOVE SPACES                   TO ICG-CIC-IOPV IN ICG.
      *     MOVE ZEROES                   TO ICG-NUM-IVCT IN ICG.
      *     MOVE 'INT'                    TO ICG-IND-TTAS IN ICG.
      *     MOVE ZEROES                   TO ICG-FEC-FINI IN ICG.
      *     MOVE FIO-GET-NLS TO FIO-CMND.
      * LUP-COL-BUS-TIN.
      *     PERFORM COL-FIO-ICG.
      *     IF NOT ( FIO-STAT-OKS AND
      *        ICG-CIC-IOPC IN ICG = WSS-CIC-IOPC IN WSS-VARI AND
      *        ICG-NUM-ICAN IN ICG = ZEROES AND
      *        ICG-CIC-IOPV IN ICG = SPACES AND
      *        ICG-NUM-IVCT IN ICG = ZEROES AND
      *        ICG-IND-TTAS IN ICG = 'INT' )
      *         MOVE 'S' TO WSS-IND-LSIG IN WSS-VARI
      *         GO TO FIN-COL-BUS-TIN.

      *Compara fecha de ICG con fecha de proceso
      *     IF ICG-FEC-FINI IN ICG NOT > DVG-FEC-FPRO IN DVG
      *         GO TO FIN-COL-BUS-TIN.

      * NXT-COL-BUS-TIN.
      *     MOVE FIO-GET-NXT TO FIO-CMND.
      *     GO TO LUP-COL-BUS-TIN.
      * FIN-COL-BUS-TIN.
      *     EXIT.


       DET-TIPO-CPTO SECTION.
      *---------------------*
       INI-DET-TIPO-CPTO.
           IF WSS-MSC-TCCT IN WSS-VARI = WSS-IND-IDN IN WSS-VARI
               MOVE WSS-SGV-ICTB IN WSS-VARI TO SRT-VAL-INTD IN SRT
           ELSE
           IF WSS-MSC-TCCT IN WSS-VARI = WSS-IND-IDS IN WSS-VARI
               MOVE WSS-SGV-ICTB IN WSS-VARI TO SRT-VAL-INTO IN SRT
           ELSE
           IF WSS-MSC-TCCT IN WSS-VARI = WSS-IND-IDM IN WSS-VARI
               MOVE WSS-SGV-ICTB IN WSS-VARI TO SRT-VAL-INTM IN SRT
           ELSE
           IF WSS-MSC-TCCT IN WSS-VARI = WSS-IND-RDN IN WSS-VARI
               MOVE WSS-SGV-ICTB IN WSS-VARI TO SRT-VAL-READ IN SRT
           ELSE
           IF WSS-MSC-TCCT IN WSS-VARI = WSS-IND-RDS IN WSS-VARI
               MOVE WSS-SGV-ICTB IN WSS-VARI TO SRT-VAL-REAO IN SRT
           ELSE
           IF WSS-MSC-TCCT IN WSS-VARI = WSS-IND-RDM IN WSS-VARI
               MOVE WSS-SGV-ICTB IN WSS-VARI TO SRT-VAL-REAM IN SRT.
       FIN-DET-TIPO-CPTO.
           EXIT.


       OBT-CUENTA-DCC SECTION.
      *----------------------*
       INI-OBT-CUENTA-DCC.
           IF WSS-IND-SCTB IN WSS-VARI = 'MUL'
               MOVE SPACES TO DCC-IND-SCTB IN DCC
           ELSE
               MOVE WSS-IND-SCTB IN WSS-VARI TO DCC-IND-SCTB IN DCC.

           MOVE WSS-IND-SCBZ IN WSS-VARI TO DCC-IND-SCBZ IN DCC.
           MOVE WSS-IND-SCRT IN WSS-VARI TO DCC-IND-SCRT IN DCC.
           MOVE 'DCC'                    TO DCC-COD-TTAB IN DCC.
           MOVE 'CAP'                    TO DCC-MSC-TCCT IN DCC.
           MOVE WSS-COD-VCOC IN WSS-VARI TO DCC-COD-VCAM IN DCC.
           MOVE WSS-COD-COOC IN WSS-VARI TO DCC-COD-COCR IN DCC.
           MOVE WSS-COD-PLZO IN WSS-VARI TO DCC-COD-PLZO IN DCC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DCC.
           IF NOT FIO-STAT-OKS
              MOVE '* ' TO DCC-COD-PLZO IN DCC
              MOVE FIO-GET-KEY TO FIO-CMND
              PERFORM COL-FIO-DCC
              IF NOT FIO-STAT-OKS
                 MOVE '*     ' TO DCC-COD-COCR IN DCC
                 MOVE FIO-GET-KEY TO FIO-CMND
                 PERFORM COL-FIO-DCC
                 IF NOT FIO-STAT-OKS
                    MOVE 'S' TO WSS-IND-LSIG IN WSS-VARI.
       FIN-OBT-CUENTA-DCC.
           EXIT.


       BUSCA-CIC-TCCT SECTION.
      *----------------------*
       INI-BUSCA-TCCT.
           MOVE 'COL'                            TO FIO-SIST.
           MOVE 'MSC'                            TO MSC-CIC-TTAB IN MSC.
           MOVE 'TCCT'                           TO MSC-CIC-TMSC IN MSC.
           MOVE FIO-GET-KEY                      TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
              MOVE 'COL'       TO MSG-COD-SIST
              MOVE 'CODTCYANX' TO MSG-COD-MENS IN MSG
              PERFORM GET-MSG
              DISPLAY MSG-GLS-DESC   MSC-COD-CMSC
              DISPLAY 'LLAVE : ' MSC-CIC-CMSC IN MSC
              PERFORM GNS-PRO-ABT.
       FIN-BUSCA-CIC-TCCT.
           EXIT.


       DET-SALDO-EN-PESOS SECTION.
      *--------------------------*
       INI-DET-SALDO-EN-PESOS.
           IF WSS-COD-VCOC IN WSS-VARI = WSS-COD-PESO IN WSS-VARI
               MOVE WSS-VAL-SCRE IN WSS-VARI TO SRT-VAL-SCRE IN SRT
               GO TO FIN-DET-SALDO-EN-PESOS.

           MOVE WSS-COD-VCOC IN WSS-VARI TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE WSS-FEC-FCOL IN WSS-VARI TO CAM-FEC-FCAM IN CAM(1)
           MOVE WSS-FEC-FCOL IN WSS-VARI TO CAM-FEC-FCAM IN CAM(2).

           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS AND CAM-IND-VIGE NOT = 'S'
              MOVE 'COL'        TO MSG-COD-SIST
              MOVE 'CAMVCAMNEX' TO MSG-COD-MENS
              PERFORM GET-MSG
              DISPLAY MSG-GLS-DESC    CAM-KEY-CAMB IN CAM
              MOVE 'S' TO WSS-IND-LSIG IN WSS-VARI
              GO TO FIN-DET-SALDO-EN-PESOS.

           MULTIPLY CAM-SGV-VCAM IN CAM BY WSS-VAL-SCRE  IN WSS-VARI
                                    GIVING WSS-VAL-SCRE  IN WSS-VARI.
           MOVE WSS-VAL-SCRE IN WSS-VARI TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE IN PES-VARI TO SRT-VAL-SCRE IN SRT.
       FIN-DET-SALDO-EN-PESOS.
           EXIT.


       MOVER-DVG-WSS SECTION.
      *---------------------*
       INI-MOVER-DVG-WSS.
           MOVE DVG-CIC-IOPC IN DVG TO WSS-CIC-IOPC IN WSS-VARI.
           MOVE DVG-COD-OFOC IN DVG TO WSS-COD-OFOC IN WSS-VARI.
           MOVE DVG-FEC-FVEN IN DVG TO WSS-FEC-FVEN IN WSS-VARI.
           MOVE DVG-FEC-FDEV IN DVG TO WSS-FEC-FDEV IN WSS-VARI.
           MOVE DVG-FEC-FCOL IN DVG TO WSS-FEC-FCOL IN WSS-VARI.
           MOVE DVG-IND-SCTB IN DVG TO WSS-IND-SCTB IN WSS-VARI.
           MOVE DVG-IND-SCBZ IN DVG TO WSS-IND-SCBZ IN WSS-VARI.
           MOVE DVG-IND-SCRT IN DVG TO WSS-IND-SCRT IN WSS-VARI.
           MOVE DVG-COD-PLZO IN DVG TO WSS-COD-PLZO IN WSS-VARI.
           MOVE DVG-COD-VCOC IN DVG TO WSS-COD-VCOC IN WSS-VARI.
           MOVE DVG-COD-COOC IN DVG TO WSS-COD-COOC IN WSS-VARI.
           MOVE DVG-VAL-SCRE IN DVG TO WSS-VAL-SCRE IN WSS-VARI.
           MOVE DVG-SGV-TASA IN DVG TO WSS-SGV-TASA IN WSS-VARI.
       FIN-MOVER-DVG-WSS.
           EXIT.


       MOVER-DATOS-SRT SECTION.
      *---------------------*
       INI-MOVER-DATOS-SRT.
           MOVE WSS-COD-OFOC IN WSS-VARI TO SRT-COD-OFOC IN SRT.
           MOVE WSS-CIC-IOPC IN WSS-VARI TO SRT-CIC-IOPC IN SRT.
           MOVE WSS-NUM-DVEN IN WSS-VARI TO SRT-NUM-DVEN IN SRT.
           MOVE WSS-NUM-MVEN IN WSS-VARI TO SRT-NUM-MVEN IN SRT.
           MOVE WSS-NUM-SVEN IN WSS-VARI TO SRT-NUM-SVEN IN SRT.
           MOVE WSS-NUM-AVEN IN WSS-VARI TO SRT-NUM-AVEN IN SRT.
           MOVE WSS-COD-COOC IN WSS-VARI TO SRT-COD-COOC IN SRT.
           MOVE WSS-NUM-DCOL IN WSS-VARI TO SRT-NUM-DCOL IN SRT.
           MOVE WSS-NUM-MCOL IN WSS-VARI TO SRT-NUM-MCOL IN SRT.
           MOVE WSS-NUM-SCOL IN WSS-VARI TO SRT-NUM-SCOL IN SRT.
           MOVE WSS-NUM-ACOL IN WSS-VARI TO SRT-NUM-ACOL IN SRT.
           MOVE WSS-NUM-DDEV IN WSS-VARI TO SRT-NUM-DDEV IN SRT.
           MOVE WSS-NUM-MDEV IN WSS-VARI TO SRT-NUM-MDEV IN SRT.
           MOVE WSS-NUM-SDEV IN WSS-VARI TO SRT-NUM-SDEV IN SRT.
           MOVE WSS-NUM-ADEV IN WSS-VARI TO SRT-NUM-ADEV IN SRT.
           MOVE DBC-NUM-ICLI IN DBC      TO SRT-NUM-ICLI IN SRT.
           MOVE DBC-VRF-ICLI IN DBC      TO SRT-VRF-ICLI IN SRT.
           MOVE DCC-GLS-CCSB IN DCC      TO SRT-CIC-CCSB IN SRT.
           MOVE WSS-SGV-TASA IN WSS-VARI TO SRT-SGV-TINT IN SRT.
       FIN-MOVER-DATOS-SRT.
           EXIT.
      *>>>>
