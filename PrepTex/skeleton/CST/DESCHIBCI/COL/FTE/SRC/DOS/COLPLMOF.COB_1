       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPLMOF.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    26-Jul-88 01:38 PM.
      * Programa Listador de Reporte MOF con Sort.
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *DOS SELECT RPTMOF         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTMOF         ASSIGN TO        UT-S-RPTMOF.
           SELECT RPTMOF         ASSIGN TO SYS011-UR-1403-S.
       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY COLRRMOF.
       FD  RPTMOF LABEL RECORDS OMITTED
           REPORT IS RPT-MOF
           .
       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY COLBROPC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGIFD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY COLRWMOF.
       COPY GNSWGSYS.
      *<<<< WSS
       COPY GNSBRMSG.
       COPY GNSBRMSC.
       COPY GNSBRTAB.
       COPY TABBRUSR.
       COPY TABBROFI.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       01  WSS-VARI.
           03 WSS-FEC-FINI.
              05 WSS-NUM-DINI                     PIC 9(02).
              05 WSS-NUM-MINI                     PIC 9(02).
              05 WSS-NUM-SINI                     PIC 9(02).
              05 WSS-NUM-AINI                     PIC 9(02).
           03 WSS-FEC-FTER.
              05 WSS-NUM-DTER                     PIC 9(02).
              05 WSS-NUM-MTER                     PIC 9(02).
              05 WSS-NUM-STER                     PIC 9(02).
              05 WSS-NUM-ATER                     PIC 9(02).
           03 WSS-FEC-FFEC.
              05 WSS-NUM-SFEC                     PIC 9(02).
              05 WSS-NUM-AFEC                     PIC 9(02).
              05 WSS-NUM-MFEC                     PIC 9(02).
              05 WSS-NUM-DFEC                     PIC 9(02).
           03 WSS-FEC-FFET.
              05 WSS-NUM-SFET                     PIC 9(02).
              05 WSS-NUM-AFET                     PIC 9(02).
              05 WSS-NUM-MFET                     PIC 9(02).
              05 WSS-NUM-DFET                     PIC 9(02).
           03 WSS-FEC-FREG.
              05 WSS-NUM-SREG                     PIC 9(02).
              05 WSS-NUM-AREG                     PIC 9(02).
              05 WSS-NUM-MREG                     PIC 9(02).
              05 WSS-NUM-DREG                     PIC 9(02).
           03 WSS-COD-OFOC                        PIC X(03).
           03 WSS-IND-NEXT                        PIC 9(01).
           03 WSS-COD-VCOC                        PIC X(06).
           03 WSS-COD-TOOC                        PIC X(03).
           03 WSS-TAB-VLR-TIO.
              05 WSS-TAB-OPNU.
                 07 WSS-NUM-OPNU                  PIC 9(06).
                 07 WSS-VAL-OPNU                  PIC 9(12)V9999.
              05 WSS-TAB-RENO.
                 07 WSS-NUM-RENO                  PIC 9(06).
                 07 WSS-VAL-RENO                  PIC 9(12)V9999.
              05 WSS-TAB-TOPE.
                 07 WSS-NUM-TOPE                  PIC 9(06).
                 07 WSS-VAL-TOPE                  PIC 9(12)V9999.
      *>>>>
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
      *>>>>
       REPORT SECTION.
      *--------------
       COPY COLRFMOF.
           .
       COPY COLRTMOF.
       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
       DEC-CF-MOF-OPC-COD-OFOC SECTION.
           USE BEFORE REPORTING CF-MOF-OPC-COD-OFOC.
       INI-CF-MOF-OPC-COD-OFOC.
       FIN-CF-MOF-OPC-COD-OFOC.
           EXIT.
       DEC-PH-MOF SECTION.
           USE BEFORE REPORTING PH-MOF.
       INI-PH-MOF.
      *<<<< PH_MOF
      * Mediante BUS-OFI Busca Nombre de Oficina de Tabla OFI
           IF OPC-COD-OFOC IN SRT > SPACES
               MOVE OPC-COD-OFOC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI.
      *>>>>
       FIN-PH-MOF.
           EXIT.
       END DECLARATIVES.
       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'COLPLMOF' TO FIO-PROG.
           PERFORM BUS-FSIS.
           SORT GNSSRT
       COPY COLRSMOF.
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
       COPY GNSBGGBK.
      *    STOP RUN.
       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<< INI_INP
           DISPLAY 'Inicio de Captura de Parametros'.
      *Captura Fecha de Inicio
           DISPLAY 'FECHA DE INICIO ( DDMMAAAA ) : '.
           ACCEPT  WSS-FEC-FINI IN WSS-VARI.
           DISPLAY WSS-FEC-FINI IN WSS-VARI.
      *Captura Fecha de Termino
           DISPLAY 'FECHA DE TERMINO ( DDMMAAAA ) : '
           ACCEPT  WSS-FEC-FTER IN WSS-VARI.
           DISPLAY WSS-FEC-FTER IN WSS-VARI.
      *Captura Codigo de Oficina
           DISPLAY 'OFICINA : '.
           ACCEPT  WSS-COD-OFOC IN WSS-VARI.
           DISPLAY WSS-COD-OFOC IN WSS-VARI.
           DISPLAY 'Fin    de Captura    de Parametros'.
           DISPLAY 'Inicio de Validacion de Parametros'.
      *VAL-FEC Valida Fecha de Inicio
           DISPLAY WSS-FEC-FINI IN WSS-VARI.
           MOVE WSS-FEC-FINI    IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               GOBACK.
      *VAL-FEC Valida Fecha de Termino
           DISPLAY WSS-FEC-FTER IN WSS-VARI.
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               GOBACK.
      *CMP-FEC Compara Fecha de Inicio con Fecha de Termino
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FEC1.
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-GRT
               MOVE 'TAB'         TO MSG-COD-SIST
               MOVE 'FECFINIFTER' TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG
               GOBACK.
           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DINI IN WSS-MOF
                                            WSS-NUM-DFEC IN WSS-VARI.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MINI IN WSS-MOF
                                            WSS-NUM-MFEC IN WSS-VARI.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SINI IN WSS-MOF
                                            WSS-NUM-SFEC IN WSS-VARI.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AINI IN WSS-MOF
                                            WSS-NUM-AFEC IN WSS-VARI.
           MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DTER IN WSS-MOF
                                            WSS-NUM-DFET IN WSS-VARI.
           MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MTER IN WSS-MOF
                                            WSS-NUM-MFET IN WSS-VARI.
           MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-STER IN WSS-MOF
                                            WSS-NUM-SFET IN WSS-VARI.
           MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-ATER IN WSS-MOF
                                            WSS-NUM-AFET IN WSS-VARI.
      *VAL-OFI Valida codigo de Oficina en TABLAS
           IF WSS-COD-OFOC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-OFOC IN WSS-VARI.
           IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-OFOC IN WSS-VARI
               MOVE WSS-COD-OFOC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   GOBACK.
           DISPLAY 'Fin de Validacion de Parametros'.
      * Inicializa Variables
           MOVE ZEROES TO WSS-TAB-VLR-TIO IN WSS-VARI.
      *>>>>
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FST-INP-SRT.
      *<<<< INI_FST_INP
           MOVE WSS-FEC-FFEC IN WSS-VARI TO OPC-FEC-FCOL IN OPC.
           MOVE 'OPC-FEC-FCOL'           TO FIO-AKEY.
           MOVE FIO-GET-NLS              TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS OR
              OPC-FEC-FCOL IN OPC > WSS-FEC-FFET IN WSS-VARI
               DISPLAY 'NO HAY REGISTROS PARA RANGO DE FECHAS : DESDE '
                       WSS-FEC-FINI IN WSS-VARI ' A '
                       WSS-FEC-FTER IN WSS-VARI
               GO TO FIN-INP-SRT.
           GO TO LUP-INP-SRT.
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
      * Proceso de Seleccion y Clasificacion a Partir del Registro OPC
           PERFORM SEL-REG-PRO.
           IF WSS-IND-NEXT IN WSS-VARI = 1
               GO TO NXT-INP-SRT.
      *>>>>
       MOV-INP-SRT.
       COPY COLRMMOF.
           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
           MOVE 'OPC-FEC-FCOL' TO FIO-AKEY.
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-OPC.
      *<<<< FIN_NXT_INP
           IF OPC-FEC-FCOL IN OPC > WSS-FEC-FFET IN WSS-VARI
               GO TO FIN-INP-SRT.
      *>>>>
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
      *<<<< INI_OUT
           MOVE 'OFICINA'       TO WSS-GLS-OFIC IN WSS-MOF.
           MOVE 'O F I C I N A' TO WSS-GLS-TOFI IN WSS-MOF.
      *>>>>
           OPEN OUTPUT RPTMOF.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-MOF.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
      *<<<< FST_OUT
           MOVE OPC-COD-VCOC IN SRT TO WSS-COD-VCOC IN WSS-VARI.
           MOVE OPC-COD-TOOC IN SRT TO WSS-COD-TOOC IN WSS-VARI.
           MOVE OPC-COD-OFOC IN SRT TO WSS-COD-OFOC IN WSS-VARI.
      *>>>>
       LUP-OUT-SRT.
      *<<<< LUP_OUT
           IF OPC-COD-OFOC IN SRT NOT = WSS-COD-OFOC IN WSS-VARI OR
              OPC-COD-VCOC IN SRT NOT = WSS-COD-VCOC IN WSS-VARI OR
              OPC-COD-TOOC IN SRT NOT = WSS-COD-TOOC IN WSS-VARI
               PERFORM GEN-LIN-OUT
               MOVE OPC-COD-OFOC IN SRT TO WSS-COD-OFOC    IN WSS-VARI
               MOVE OPC-COD-VCOC IN SRT TO WSS-COD-VCOC    IN WSS-VARI
               MOVE OPC-COD-TOOC IN SRT TO WSS-COD-TOOC    IN WSS-VARI
               MOVE ZEROES              TO WSS-TAB-VLR-TIO IN WSS-VARI.
           PERFORM GEN-TAB-TOT.
           GO TO NXT-OUT-SRT.
      *>>>>
       GEN-OUT-SRT.
           GENERATE DL-MOF.
       NXT-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
      *<<<< FIN_OUT
           PERFORM GEN-LIN-OUT.
      *>>>>
           TERMINATE RPT-MOF.
           CLOSE RPTMOF.
       COPY COLBFOPC.
       COPY GNSBGDTC.
       COPY GNSBGIFD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
      *<<<< EOF
      ******************************************************************
      * Seleccion del Registro para Proceso Mediante Oficina del Listado
       SEL-REG-PRO SECTION.
       INI-SEL-REG-PRO.
           MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.
           IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
               IF WSS-COD-OFOC IN WSS-VARI NOT = OPC-COD-OFOC IN OPC
                   GO TO FIN-SEL-REG-PRO.
           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
       FIN-SEL-REG-PRO.
           EXIT.
      ******************************************************************
      * Genera Totales en Tabla Acumulando segun Moneda y Tipo Operacion
       GEN-TAB-TOT SECTION.
       INI-GEN-TAB-TOT.
           IF OPC-IND-RENO IN SRT NOT = SPACES
               ADD        1            TO WSS-NUM-RENO IN WSS-VARI
               ADD OPC-VAL-CRED IN SRT TO WSS-VAL-RENO IN WSS-VARI
           ELSE
               ADD        1            TO WSS-NUM-OPNU IN WSS-VARI
               ADD OPC-VAL-CRED IN SRT TO WSS-VAL-OPNU IN WSS-VARI.
           ADD        1            TO WSS-NUM-TOPE IN WSS-VARI.
           ADD OPC-VAL-CRED IN SRT TO WSS-VAL-TOPE IN WSS-VARI.
       FIN-GEN-TAB-TOT.
           EXIT.
      ******************************************************************
      * Genera Lineas de Detalle a Partir de Registro SRT y Tabla de Tot
       GEN-LIN-OUT SECTION.
       INI-GEN-LIN-OUT.
      * Mediante BUS-TAB Busca Tipo de Moneda de Tabla VLR
           IF WSS-COD-VCOC IN WSS-VARI > SPACES
               MOVE 'TAB'                    TO TAB-COD-SIST
               MOVE 'VLR'                    TO TAB-COD-TTAB IN TAB
               MOVE WSS-COD-VCOC IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-VCOC IN WSS-MOF
           ELSE
               MOVE SPACES TO WSS-GLS-VCOC IN WSS-MOF.
      * Mediante BUS-TAB Busca Tipo de Operacion de Tabla TIO
           IF WSS-COD-TOOC IN WSS-VARI > SPACES
               MOVE 'TAB'                    TO TAB-COD-SIST
               MOVE 'TIO'                    TO TAB-COD-TTAB IN TAB
               MOVE WSS-COD-TOOC IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TOOC IN WSS-MOF
           ELSE
               MOVE SPACES TO WSS-GLS-TOOC IN WSS-MOF.
      * Completa Linea de Detalle con Totales Acumulados
           MOVE WSS-NUM-RENO IN WSS-VARI TO WSS-NUM-RENO IN WSS-MOF.
           MOVE WSS-VAL-RENO IN WSS-VARI TO WSS-VAL-RENO IN WSS-MOF.
           MOVE WSS-NUM-OPNU IN WSS-VARI TO WSS-NUM-OPNU IN WSS-MOF.
           MOVE WSS-VAL-OPNU IN WSS-VARI TO WSS-VAL-OPNU IN WSS-MOF.
           MOVE WSS-NUM-TOPE IN WSS-VARI TO WSS-NUM-TOPE IN WSS-MOF.
           MOVE WSS-VAL-TOPE IN WSS-VARI TO WSS-VAL-TOPE IN WSS-MOF.
           GENERATE DL-MOF.
       FIN-GEN-LIN-OUT.
           EXIT.
      ******************************************************************
       COPY GNSBFMSG.
       COPY GNSBFMSC.
       COPY GNSBFTAB.
       COPY TABBFUSR.
       COPY TABBFOFI.
       COPY GNSBBMSG.
       COPY GNSBBMSC.
       COPY GNSBBTAB.
       COPY TABBBUSR.
       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
      *>>>>
