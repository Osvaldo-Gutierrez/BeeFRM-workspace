       IDENTIFICATION DIVISION.
      *=======================*
       PROGRAM-ID.      COLPGW18.
       AUTHOR.          BEE.
      * ============================================================= *
      * SISTEMA  :  GENERACION DE ACTIVOS Y PASIVOS.                  *
      * AMBIENTE :  COBOL II                                          *
      * FECHA    :  15/12/1998                                        *
      * OBJETIVO :  GENERA ARCHIVO DE TASAS ESPECIALES.               *
      * ------------------------------------------------------------- *
      * ARCHIVOS DE ENTRADA :                                         *
      * CAM                                                           *
      * ------------------------------------------------------------- *
      * ARCHIVOS DE SALIDA  :                                         *
      * TABESCAM (ARCHIVO DE TASAS ESPECIALES)                        *
      * ------------------------------------------------------------- *
      * ABENDS PROGRAMADOS.                                           *
      *   CODIGO           D E S C R I P C I O N                      *
      *   ------   -----------------------------------------------    *
      *    2001    ERROR AL ABRIR ARCHIVO                             *
      *    2002    ERROR AL LEER  ARCHIVO                             *
      *    2003    ERROR AL GRABAR REGISTRO                           *
      *    2004    ERROR AL CERRAR ARCHIVO                            *
      *---------------------------------------------------------------*

       DATE-WRITTEN.
      * PROYECTO :
      * Programa para Generar TASAS ESPECIALES
      * Bancos Chilenos BCI.
      *
       ENVIRONMENT DIVISION.
      *====================*
       CONFIGURATION SECTION.
      *---------------------*
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.

       INPUT-OUTPUT SECTION.
      *--------------------*
       FILE-CONTROL.
      *     SELECT COLBCI ASSIGN TO COLBCI.

       DATA DIVISION.
      *=============*
       WORKING-STORAGE SECTION.
      *-----------------------*
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-IDD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.

       COPY TABBRCAM.
       COPY COLBRA17.
      *
       COPY GNSBRTAB.
       COPY GNSBRIDD.
       COPY GNSBRMSG.
       COPY GNSBRMSC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.
       COPY GNSWGFEC.
       COPY GNSWGHOY.



      *
       01  WSS-VARI.
           03 WSS-NUM-LCAM  VALUE ZEROES PIC 9(09).
           03 WSS-NUM-GA17  VALUE ZEROES PIC 9(09).

           03 WSS-FEC-FCAM.
              05 WSS-NUM-SCAM            PIC 9(02).
              05 WSS-NUM-ACAM            PIC 9(02).
              05 WSS-NUM-MCAM            PIC 9(02).
              05 WSS-NUM-DCAM            PIC 9(02).


       PROCEDURE DIVISION.
      *==================*
       MAIN SECTION.
      *------------*
       INI-MAIN.
      *--------*
           COPY GNSBGEDB.

           MOVE 'COLPGW18' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           PERFORM ABRE-ARCHIVOS.
           PERFORM PRO-CAM.

           PERFORM CLOSE-ARCHIVOS.
           PERFORM ESTADISTICAS.
       FIN-MAIN.
      *--------*
           PERFORM GNS-PRO-END.




       PRO-CAM SECTION.
      *---------------*
       INI-PRO-CAM.
           DISPLAY ' INICIO PROGRAMA COLPGW18- CA.'.

           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ERROR AL LEER PRIMER REG.CAM: ' FIO-STAT
              GO TO FIN-PRO-CAM.

       LUP-PRO-CAM.
           ADD 1                   TO WSS-NUM-LCAM.

           IF CAM-MSC-TVAL(1) IN CAM  =  'I'   OR
              CAM-COD-CVAL(1) IN CAM  = '998'

              MOVE CAM-FEC-FCAM(1) IN CAM TO WSS-FEC-FCAM IN WSS-VARI


              STRING WSS-NUM-MCAM WSS-NUM-DCAM WSS-NUM-SCAM WSS-NUM-ACAM
              DELIMITED BY SIZE
              INTO A17-FEC-FCAM IN A17

              MOVE SPACES                  TO A17-GLS-DIS1 IN A17
              MOVE SPACES                  TO A17-GLS-DIS2 IN A17
              MOVE SPACES                  TO A17-GLS-DIS3 IN A17

              MOVE CAM-COD-CVAL(1) IN CAM  TO A17-COD-CVAL IN A17
              MOVE CAM-SGV-VCAM    IN CAM  TO A17-SGV-VCAM IN A17

              MOVE FIO-PUT TO FIO-CMND
              PERFORM COL-FIO-A17
              IF NOT FIO-STAT-OKS
                 DISPLAY 'ERROR AL GRABAR REG.A17 : ' FIO-STAT
                 GO TO FIN-PRO-CAM
              ELSE
                 ADD 1    TO WSS-NUM-GA17.

       NXT-PRO-CAM.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ERROR AL LEER PRIMER REG.CAM: ' FIO-STAT
              GO TO FIN-PRO-CAM
           ELSE
              GO TO LUP-PRO-CAM.

       FIN-PRO-CAM.
           EXIT.


       ABRE-ARCHIVOS SECTION.
      *---------------------*
       INI-ABRE-ARCHIVOS.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-CAM.

           MOVE FIO-OUT TO FIO-CMND.
           PERFORM COL-FIO-A17.
       FIN-ABRE-ARCHIVOS.
           EXIT.

       CLOSE-ARCHIVOS SECTION.
      *----------------------*
       INI-CLOSE-ARCHIVOS.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM TAB-FIO-CAM.

           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-A17.


       FIN-CLOSE-ARCHIVOS.
           EXIT.
      *
       ESTADISTICAS SECTION.
      *--------------------*
       INI-ESTADISTICAS.
           DISPLAY ' '.
           DISPLAY ' TOTALES DE CONTROL '.
           DISPLAY ' ------------------ '.
           DISPLAY ' 1) REG. LEIDOS ....: ' WSS-NUM-LCAM.
           DISPLAY ' 2) REG. GRABADOS...: ' WSS-NUM-GA17.
           DISPLAY ' '.
       FIN-ESTADISTICAS.
           EXIT.
      *EOF
      *
       COPY TABBFCAM.
       COPY COLBFA17.
      *
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBGABT.
       COPY GNSBBTAB.
       COPY GNSBFMSG.
       COPY GNSBBMSG.
       COPY GNSBFTAB.
       COPY GNSBFMSC.
       COPY GNSBGEND.
       COPY GNSBPFEC.
       COPY GNSBGFEC.
       COPY GNSBGHOY.

