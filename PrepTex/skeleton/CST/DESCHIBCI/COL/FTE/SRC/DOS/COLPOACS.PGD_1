       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   COLPOACS.
       AUTHOR.       CONSIST.
       DATE-WRITTEN. 03-OCT-91 17:34 PM.

      * RUTINA INVOCA CANCELACIONES

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
       COPY GNSWGQUE.
       COPY GNSWCSCR.
      *COPY GNSWVSCR.
       COPY GNSWV3CR.
       COPY COLWGENG.
       COPY COLW1CAN.
       COPY GNSWGRQA REPLACING
                     ==01  ADR-REQA== BY ==02  SCR-CAN-REQA==.
           02 SCR-KEY-ICAN                     PIC X(03).
       COPY COLBRCRS.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CRS-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWVIDD.
      *COPY GNSWGFRM.
       COPY GNSWG3CF.
       COPY GNSWGSYS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSBRMSC.
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       COPY GNSWGIDC.
      *<<<< WSS_DTC
      * RBG/INI/12-NOV-1996
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
      * RBG/FIN/12-NOV-1996
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VLR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ERR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==.
      *>>>>
      *<<<< WSS
      * RBG/INI/12-NOV-1996
       COPY SGCBRDCE.
       COPY SGCBRDCP.
       COPY COLBRCOM.
      * RBG/FIN/12-NOV-1996
       COPY GNSBRERR.
       COPY COLWGPMP.
       COPY TABBROFI.
       COPY TABBRUSR.
       COPY COLBRCAN.
       COPY COLBRTMC.
       COPY COLBRCYA.
       COPY COLBRICG.
       COPY COLBRITR.
       COPY COLBROPC.
       COPY COLBRRCV.
       COPY COLBRROV.
       COPY COLBRVEN.
       COPY COLBRRDC.
       COPY SGCBRDBC.
       COPY SGCBRRCO.
       COPY SGCBROPE.
       COPY GNSWGCPT.
       COPY GNSWGCIC.
       COPY GNSBRCIC.
       COPY TABBRCAM.
       COPY TABBRVLR.

       COPY COLWGVEN.
      *SMC-INI 09.09.1993
       COPY COLWGINT.
      *SMC-FIN 09.09.1993
       COPY GNSWGCVI.
       COPY COLBRDLC.
       COPY COLBREVC.
       COPY COLBRTOC.
       COPY GNSWGPES.
      *ALD-BCI-INI/10.05.1999
       COPY TABWGTXC.
      *ALD-BCI-FIN/10.05.1999

       COPY COLWGADO.
       COPY GNSWGTDQ.
       COPY COLWGTDS.
       COPY COLWICAN.
       COPY COLW2CAN.
      *DAD ini  21-ABR-1993
           03  WSS-VAL-CMP2                COMP-2.
      *DAD fin  21-ABR-1993
           03 WSS-GLS-DATI.
               05  FILLER                           PIC X(06).
               05  WSS-IND-CSAF                     PIC X(01).
               05  FILLER                           PIC X(03).
           03 WSS-SW                                PIC 9(01).
           03  WSS-FEC-FCNC.
               05  WSS-NUM-ACNC                     PIC 9(02).
               05  WSS-NUM-MCNC                     PIC 9(02).
               05  WSS-NUM-DCNC                     PIC 9(02).
           03  WSS-MSG-MENS.
               05  WSS-MSG-PREV                     PIC X(09).
               05  WSS-MSG-TENT                     PIC X(01).
               05  WSS-MSG-FENT                     PIC X(01).
               05  WSS-MSG-SENT                     PIC X(01).
           03  WSS-CRS-CIC-IOPC.
               05  WSS-CRS-CAI-IOPC                   PIC X(04).
               05  WSS-CRS-IIC-IOPC                   PIC 9(08).
           03  WSS-PCAN                             PIC X(08).
       01  WSS-AUXI.
           05 WSS-MSJS.
              07 WSS-MSJ0                              PIC X(22).
              07 FILLER                                PIC X(01).
              07 WSS-MSJ1                              PIC X(16).
              07 FILLER                                PIC X(01).
              07 WSS-MSJ2                              PIC X(22).
              07 FILLER                                PIC X(01).
              07 WSS-MSJ3                              PIC X(16).
      *>>>>
       01  PGM-VARI.
           03 PGM-ICLR                  VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-TODO          VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-LLAVES        VALUE 'K'       PIC X(01).
           03 PGM-LIMPIAR-CAMPOS        VALUE 'F'       PIC X(01).
           03 PGM-NO-LIMPIAR-NADA       VALUE 'N'       PIC X(01).
           03 PGM-STAT.
              05 PGM-STAT-CRS           VALUE '23'      PIC X(02).
                 88 PGM-STAT-CRS-OKS    VALUE '00'.
                 88 PGM-STAT-CRS-NUL    VALUE '  '.
              05 PGM-STAT-OPC           VALUE '23'      PIC X(02).
                 88 PGM-STAT-OPC-OKS    VALUE '00'.
                 88 PGM-STAT-OPC-NUL    VALUE '  '.
              05 PGM-STAT-CAN           VALUE '23'      PIC X(02).
                 88 PGM-STAT-CAN-OKS    VALUE '00'.
                 88 PGM-STAT-CAN-NUL    VALUE '  '.
              05 PGM-STAT-DBC           VALUE '23'      PIC X(02).
                 88 PGM-STAT-DBC-OKS    VALUE '00'.
                 88 PGM-STAT-DBC-NUL    VALUE '  '.
              05 PGM-STAT-ROV           VALUE '23'      PIC X(02).
                 88 PGM-STAT-ROV-OKS    VALUE '00'.
                 88 PGM-STAT-ROV-NUL    VALUE '  '.
              05 PGM-STAT-VEN           VALUE '23'      PIC X(02).
                 88 PGM-STAT-VEN-OKS    VALUE '00'.
                 88 PGM-STAT-VEN-NUL    VALUE '  '.
              05 PGM-STAT-ITR           VALUE '23'      PIC X(02).
                 88 PGM-STAT-ITR-OKS    VALUE '00'.
                 88 PGM-STAT-ITR-NUL    VALUE '  '.
              05 PGM-STAT-ICG           VALUE '23'      PIC X(02).
                 88 PGM-STAT-ICG-OKS    VALUE '00'.
                 88 PGM-STAT-ICG-NUL    VALUE '  '.
              05 PGM-STAT-CYA           VALUE '23'      PIC X(02).
                 88 PGM-STAT-CYA-OKS    VALUE '00'.
                 88 PGM-STAT-CYA-NUL    VALUE '  '.
              05 PGM-STAT-RCV           VALUE '23'      PIC X(02).
                 88 PGM-STAT-RCV-OKS    VALUE '00'.
                 88 PGM-STAT-RCV-NUL    VALUE '  '.
           03 PGM-SRNF                  VALUE '23'      PIC X(02).
           03 PGM-SOKS                  VALUE '00'      PIC X(02).
           03 PGM-SNUL                  VALUE '  '      PIC X(02).
           03 PGM-SUAR                  VALUE SPACES    PIC X(02).
              88 PGM-STRO               VALUE 'TO'.
              88 PGM-SCNC               VALUE 'CC'.

       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
      *JSS 02 FILLER                  PIC X(900).
           02 FILLER                  PIC X(3500).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================
       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
       LUP-MAIN.
           PERFORM GNS-ERR-TDQ THRU FIN-GNS-ERR-TDQ.
           MOVE TDQ-GET TO TDQ-CMND.
           MOVE 'KOL1'  TO TDQ-COLA.
           MOVE +100    TO TDQ-LITM.
           PERFORM GNS-PRO-TDQ.
           IF TDQ-STAT NOT = TDQ-STAT-OKS
       COPY GNSBGGBK.
           MOVE TDQ-ITEM TO SAFTKOL1.
      *     MOVE KOL1-KEY-CRE     TO ADO-KEY-IOPC.
           IF KOL1-IND-PAGO = '0'
               PERFORM PRO-ING-CAN
               IF WSS-SW NOT = ZEROES
                  GO TO LUP-MAIN.
           MOVE KOL1-KEY-OPE     TO ADO-KEY-IOPC.
           IF KOL1-IND-PAGO = '0'
               MOVE KOL1-NUM-VTO-PAG TO ADO-NUM-IVCT
           ELSE
               SUBTRACT 1 FROM KOL1-NUM-VTO-PAG GIVING ADO-NUM-IVCT.
           MOVE KOL1-VAL-PAG   TO ADO-VAL-TPAG.
           MOVE KOL1-COD-EST21 TO ADO-ET21.
           MOVE 'S'            TO ADO-IND-ORIG.

           MOVE IDD-FSIS IN IDD-VARI TO ADO-FIDD.
           MOVE ADO-CMMA TO SYS-CMMA.
           MOVE SYS-LINK TO SYS-CMND.
           MOVE WSS-PCAN TO SYS-PROG.
           MOVE ADO-TCMA TO SYS-TCMA.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA TO ADO-CMMA.
           IF ADO-GLS-MENS > SPACES
                 MOVE ADO-GLS-MENS TO MSG-GLS-DESC FRM-MENS
           ELSE
                 MOVE 'COL'          TO MSG-COD-SIST
                 MOVE 'CAN    PAGOK' TO MSG-COD-MENS
      *           PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO FRM-MENS.
           GO TO LUP-MAIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
      * NO ABORTA CON COMMAREA 0
      *COPY GNSBGEIB.
       COPY GNSBGEDB.

      *COPY GNSBGCMA.
           MOVE LOW-VALUES TO CAN-FLD.
           MOVE LOW-VALUES TO CAN-EDT.
           PERFORM GNS-HDL-SYS.
           PERFORM GNS-HDL-FRM.
           PERFORM GNS-HDL-VSM.

           MOVE 'COLPOACS' TO FIO-PROG.
           PERFORM GET-IDD-CAN.

      *JSS 9-APR-1991 18:37:24
           MOVE 'COL'    TO FIO-SIST.
           MOVE 'VSN'    TO TAB-COD-TTAB IN TAB.
           MOVE 'PGMCAN' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND ( TAB-MSC-STAT IN TAB = 'S' )
               MOVE TAB-GLS-DCOR IN TAB TO WSS-PCAN
           ELSE
               MOVE 'COLPOCAN' TO WSS-PCAN.
      *
       FIN-INI.
           EXIT.

       COPY GNSBHSYS.
       COPY GNSBHFRM.
       COPY GNSBHVSM.

       GET-IDD-CAN SECTION.
       INI-GET-IDD-CAN.
           MOVE 'COLPOCAN' TO IDD-PROG.
           EXEC CICS LINK
                     PROGRAM('GNSPPIDD')
                     COMMAREA(IDD-VARI)
                     LENGTH(+507)
           END-EXEC.
       FIN-GET-IDD-CAN.
           EXIT.

       FND-KEY SECTION.
       INI-FND-KEY.
           PERFORM KEY-ALL-CAN.
      *<<<< FND_KEY
       COPY COLB1CAN.
      *>>>>
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           MOVE FIO-STAT TO PGM-STAT-CAN.
      *<<<< FIN_FND_KEY
       COPY COLB2CAN.
      *>>>>
       FIN-FND-KEY.
           EXIT.

       CMN-ING SECTION.
       INI-CMN-ING.
           PERFORM RET-ALL-CAN.
      *<<<< CMN_ING
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO CAN-NUM-DTRN IN CAN.
           MOVE HOY-MHOY IN HOY-VARI TO CAN-NUM-MTRN IN CAN.
           MOVE HOY-AHOY IN HOY-VARI TO CAN-NUM-ATRN IN CAN.
           MOVE HOY-SHOY IN HOY-VARI TO CAN-NUM-STRN IN CAN.
           MOVE HOY-HHOY IN HOY-VARI TO CAN-HRA-HRTR IN CAN.

      *ISP ES NECESARIO TENER LOS DATOS DE LA OPERACION
           PERFORM GET-OPC.

           IF SCR-MSC-FCAN = 'T' AND
              SCR-MSC-ECAN = 'E'
                MOVE 1 TO CAN-NUM-TVCC IN CAN
           ELSE
           IF SCR-MSC-FCAN = 'T' AND
              SCR-MSC-ECAN = 'T'
                MOVE OPC-NUM-VCVG IN OPC TO CAN-NUM-TVCC IN CAN
           ELSE
           IF SCR-MSC-FCAN = 'I' OR 'P'
                MOVE ZEROES TO CAN-NUM-TVCC IN CAN
           ELSE
                MOVE 1 TO CAN-NUM-TVCC IN CAN.

      *ISP ASUME CANCELACION NO VERIFICADA
           MOVE 'I' TO WSS-MSG-FENT.
           MOVE 'I' TO CAN-MSC-STAT IN CAN.
           PERFORM VRF-ACT-CYA.
           IF NOT PGM-STAT-CYA-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-ING.
      *>>>>
           IF KOL1-IND-PAGO = '0'
               MOVE 'SAFE' TO CAN-COD-OTRN IN CAN.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-CAN.
      *<<<< FIN_CMN_ING
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en el ingreso : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ING.

           PERFORM ACT-ICG.
           IF NOT PGM-STAT-ICG-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-ING.


      *DPM ini  11-OCT-1996 Los perform siguientes fueron cambiados
      *de prioridad para calcular CAN-SGV-IMOK
           IF SCR-MSC-TCAN = 'R' OR 'P'
               PERFORM ASS-OPC-ROV.

           PERFORM ACT-RCV.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-CMN-ING.
      *DPM fin  11-OCT-1996

       END-CMN-ING.
           IF CYA-IND-TCYA IN CAN-FLD = 'M'
               MOVE CAN-CAI-IOPC IN CAN-FLD TO SCR-CAI-IOPC
               MOVE CAN-IIC-IOPC IN CAN-FLD TO SCR-IIC-IOPC
               MOVE CAN-NUM-ICAN IN CAN-FLD TO SCR-NUM-IDOC
               MOVE 2 TO WSS-IDX-ICYA
               MOVE 'S'    TO SCR-IND-ENG IN SCR-VEC-ENG(WSS-IDX-ICYA)
               MOVE 'S'    TO SCR-IND-FST IN SCR-VEC-FST(WSS-IDX-ICYA)
               PERFORM EGR-FPEN-CIC.
      *>>>>
       FIN-CMN-ING.
           EXIT.

       VRF-ACT-CYA SECTION.
       INI-VRF-ACT-CYA.
           MOVE '00' TO PGM-STAT-CYA.
           MOVE 'CAN      '  TO WSS-MSG-PREV.
           MOVE SCR-MSC-TCAN TO WSS-MSG-TENT.
           MOVE 'N'          TO WSS-MSG-SENT.
           IF CYA-IND-TCYA IN CAN-FLD = 'M'
               GO TO MSG-VRF-ACT-CYA.

           PERFORM ACT-CYA.
           IF NOT PGM-STAT-CYA-OKS
                MOVE FIO-STAT TO PGM-STAT-CYA
                GO TO FIN-VRF-ACT-CYA.

      *     IF CAN-SGV-TPAG IN CAN = CYA-SGV-LIQU IN CYA
      *JSS 26-APR-1991 17:30:10
      *    MOVE 'V' TO CAN-MSC-STAT IN CAN.
           MOVE 'S' TO CAN-MSC-STAT IN CAN.
           MOVE 'V' TO WSS-MSG-SENT.

       MSG-VRF-ACT-CYA.
           MOVE 'COL'        TO MSG-COD-SIST.
           MOVE WSS-MSG-MENS TO MSG-COD-MENS.
           PERFORM GET-MSG.
           IF WSS-MSG-SENT = 'N'
               MOVE WSS-SGV-TCYA TO WSS-NUM-FEDT
               MOVE CAN-SGV-TPAG IN CAN TO WSS-NUM-FALF
               MOVE SPACES TO WSS-MSJS
               MOVE MSG-GLS-DESC TO WSS-MSJ0
               MOVE WSS-NUM-FEDT TO WSS-MSJ1
               MOVE MSG-GLS-DATA TO WSS-MSJ2
               MOVE WSS-NUM-FALF TO WSS-MSJ3
               MOVE WSS-MSJS TO FRM-MENS
            ELSE
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE MSG-GLS-DATA TO FRM-MEN2.
       FIN-VRF-ACT-CYA.
           EXIT.

       EGR-FPEN-CIC SECTION.
       INI-EGR-FPEN-CIC.
           PERFORM CRG-TBL-ENG.
           ADD 1 TO SCR-IPRO.
           IF SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) = SPACES
               GO TO INI-EGR-FPEN-CIC.
           MOVE WSS-INST-FPEN-CIC  TO SCR-INST-EXT.
           MOVE WSS-PROG(SCR-IPRO) TO SYS-PROG.
           MOVE SCR-VARI           TO SYS-CMMA.
           MOVE SCR-TCMA           TO SYS-TCMA.
           MOVE SYS-XCTL           TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-EGR-FPEN-CIC.
           EXIT.

       CHK-ERR-FND-KEY SECTION.
       INI-CHK-ERR-FND-KEY.
           IF NOT FIO-STAT-OKS AND
              FIO-STAT NOT = FIO-STAT-NEX
               GO TO FIN-CHK-ERR-FND-KEY
           ELSE
               IF FRM-MENS NOT > SPACES
                   MOVE 'REGEXI    ' TO MSG-COD-MENS.
           MOVE 1 TO WSS-SW.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO SYS-DHOY IN SYS-VARI.
           MOVE HOY-MHOY IN HOY-VARI TO SYS-MHOY IN SYS-VARI.
           MOVE HOY-AHOY IN HOY-VARI TO SYS-AHOY IN SYS-VARI.
           MOVE HOY-SHOY IN HOY-VARI TO SYS-SHOY IN SYS-VARI.
           MOVE HOY-HHOY IN HOY-VARI TO SYS-HHOY IN SYS-VARI.
           PERFORM BUS-COR-ERR.
           MOVE MSG-COD-MENS        TO ERR-COD-MENS IN ERR.
           MOVE 'COLPOACS'          TO ERR-COD-ATRN IN ERR.
           MOVE ERR-SVRT-FAT        TO ERR-IND-SVRT IN ERR.
           MOVE ERR-TERR-VLD        TO ERR-COD-TERR IN ERR.
           MOVE ADR-CAN-REQA        TO ADR-REQA.
           MOVE CAN-CIC-IOPC IN CAN TO ADR-VKEY IN ADR-REQA.
      *DAD ini  03-OCT-1991
           MOVE FRM-MEN2            TO ERR-GLS-ANEX IN ERR.
      *DAD fin  03-OCT-1991
           PERFORM PRO-IER.
       FIN-CHK-ERR-FND-KEY.
           EXIT.

       CHK-FRM-SUAR SECTION.
       INI-CHK-FRM-SUAR.
           IF NOT (FRM-SUAR = FRM-SUAR-MAL )
               GO TO FIN-CHK-FRM-SUAR.
           MOVE 1 TO WSS-SW.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO SYS-DHOY IN SYS-VARI.
           MOVE HOY-MHOY IN HOY-VARI TO SYS-MHOY IN SYS-VARI.
           MOVE HOY-AHOY IN HOY-VARI TO SYS-AHOY IN SYS-VARI.
           MOVE HOY-SHOY IN HOY-VARI TO SYS-SHOY IN SYS-VARI.
           MOVE HOY-HHOY IN HOY-VARI TO SYS-HHOY IN SYS-VARI.
           PERFORM BUS-COR-ERR.
           MOVE MSG-COD-MENS        TO ERR-COD-MENS IN ERR.
           MOVE 'COLPOACS'          TO ERR-COD-ATRN IN ERR.
           MOVE ERR-SVRT-FAT        TO ERR-IND-SVRT IN ERR.
           MOVE ERR-TERR-VLD        TO ERR-COD-TERR IN ERR.
           MOVE ADR-CAN-REQA        TO ADR-REQA.
           MOVE CAN-CIC-IOPC IN CAN TO ADR-VKEY IN ADR-REQA.
      *DAD ini  03-OCT-1991
           MOVE FRM-MEN2            TO ERR-GLS-ANEX IN ERR.
      *DAD fin  03-OCT-1991
           PERFORM PRO-IER.
       FIN-CHK-FRM-SUAR.
           EXIT.

       CHK-CMN-ING SECTION.
       INI-CHK-CMN-ING.
           IF FIO-STAT-OKS
               GO TO FIN-CHK-CMN-ING.
           IF FRM-MENS NOT > SPACES
               MOVE 'FIOSTAT' TO MSG-COD-TMSG
               MOVE FIO-STAT  TO MSG-COD-CMSG.
           MOVE 1 TO WSS-SW.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO SYS-DHOY IN SYS-VARI.
           MOVE HOY-MHOY IN HOY-VARI TO SYS-MHOY IN SYS-VARI.
           MOVE HOY-AHOY IN HOY-VARI TO SYS-AHOY IN SYS-VARI.
           MOVE HOY-SHOY IN HOY-VARI TO SYS-SHOY IN SYS-VARI.
           MOVE HOY-HHOY IN HOY-VARI TO SYS-HHOY IN SYS-VARI.
           PERFORM BUS-COR-ERR.
           MOVE MSG-COD-MENS        TO ERR-COD-MENS IN ERR.
           MOVE 'COLPOACS'          TO ERR-COD-ATRN IN ERR.
           MOVE ERR-SVRT-FAT        TO ERR-IND-SVRT IN ERR.
           MOVE ERR-TERR-VLD        TO ERR-COD-TERR IN ERR.
           MOVE ADR-CAN-REQA        TO ADR-REQA.
           MOVE CAN-CIC-IOPC IN CAN TO ADR-VKEY IN ADR-REQA.
      *DAD ini  03-OCT-1991
           MOVE FRM-MEN2            TO ERR-GLS-ANEX IN ERR.
      *DAD fin  03-OCT-1991
           PERFORM PRO-IER.
       FIN-CHK-CMN-ING.
           EXIT.

       BUS-COR-ERR SECTION.
       INI-BUS-COR-ERR.
           MOVE 'COLPOACS'           TO ERR-COD-PRGM IN ERR.
           MOVE SYS-SHOY IN SYS-VARI TO ERR-NUM-SEJE IN ERR.
           MOVE SYS-AHOY IN SYS-VARI TO ERR-NUM-AEJE IN ERR.
           MOVE SYS-MHOY IN SYS-VARI TO ERR-NUM-MEJE IN ERR.
           MOVE SYS-DHOY IN SYS-VARI TO ERR-NUM-DEJE IN ERR.
           MOVE 99                   TO ERR-NUM-CEJE IN ERR.
           MOVE 9999                 TO ERR-NUM-CERR IN ERR.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM GNS-FIO-ERR.
           IF NOT ( FIO-STAT-OKS AND
                    ERR-COD-PRGM IN ERR  = 'COLPOACS' AND
                    SYS-SHOY IN SYS-VARI =  ERR-NUM-SEJE IN ERR AND
                    SYS-AHOY IN SYS-VARI =  ERR-NUM-AEJE IN ERR AND
                    SYS-MHOY IN SYS-VARI =  ERR-NUM-MEJE IN ERR AND
                    SYS-DHOY IN SYS-VARI =  ERR-NUM-DEJE IN ERR )
               MOVE SYS-SHOY IN SYS-VARI TO ERR-NUM-SEJE IN ERR
               MOVE SYS-AHOY IN SYS-VARI TO ERR-NUM-AEJE IN ERR
               MOVE SYS-MHOY IN SYS-VARI TO ERR-NUM-MEJE IN ERR
               MOVE SYS-DHOY IN SYS-VARI TO ERR-NUM-DEJE IN ERR
               MOVE 1                    TO ERR-NUM-CEJE IN ERR
               MOVE 1                    TO ERR-NUM-CERR IN ERR
               MOVE 'COLPOACS'           TO ERR-COD-PRGM IN ERR
               GO TO FIN-BUS-COR-ERR.
           ADD 1 TO ERR-NUM-CERR IN ERR.
       FIN-BUS-COR-ERR.
           EXIT.

       PRO-ING-CAN SECTION.
       INI-PRO-ING-CAN.
           MOVE LOW-VALUES TO CAN-FLD.
           PERFORM VAL-NUM-KEY-CAN.
           PERFORM VAL-NUM-FLD-CAN.
           MOVE 'C'       TO SCR-MSC-TCAN.
           MOVE 'T'       TO SCR-MSC-FCAN.
           MOVE 'E'       TO SCR-MSC-ECAN.
           MOVE 'ING'     TO SCR-CCPP.
           MOVE 'COL'     TO SCR-SIST.
           MOVE 'ING'     TO SCR-CMND.
           MOVE SPACES TO FRM-MENS.
           MOVE ZEROES TO WSS-SW.
           MOVE KOL1-KEY-OPE        TO CAN-CIC-IOPC IN CAN.
           MOVE KOL1-NUM-VTO-PAG    TO VEN-NUM-IVCT IN CAN-FLD.
           MOVE KOL1-NUM-VTO-PAG    TO VEN-NUM-IVEN IN CAN-FLD.
           MOVE CAN-CAI-IOPC IN CAN TO CAN-CAI-IOPC IN CAN-FLD.
           MOVE CAN-IIC-IOPC IN CAN TO CAN-IIC-IOPC IN CAN-FLD.
           MOVE ZEROES              TO CAN-NUM-ICAN IN CAN-FLD.
           PERFORM FND-KEY.
           PERFORM CHK-ERR-FND-KEY.
           IF WSS-SW NOT = ZEROES
               GO TO FIN-PRO-ING-CAN.
           MOVE 'CTE'            TO CAN-MSC-CANC IN CAN-FLD.
           MOVE KOL1-COD-OFI-REC TO CAN-COD-OFCA IN CAN-FLD.
           MOVE 'TCYA'  TO MSC-CIC-TMSC IN MSC.
           MOVE 'CAJA'  TO MSC-CIC-CMSC IN MSC.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
       LUP-BUS-CAJA.
           MOVE 'TAB' TO FIO-SIST.
           PERFORM GNS-FIO-MSC.
           IF NOT ( FIO-STAT-OKS AND
                    MSC-CIC-CMSC IN MSC = 'CAJA' AND
                    MSC-CIC-TMSC IN MSC = 'TCYA' )
               MOVE 'EFEC'  TO CYA-IND-TCYA IN CAN-FLD
           ELSE
               MOVE MSC-GLS-DAT1 IN MSC TO WSS-GLS-DATI IN WSS-VARI
               IF WSS-IND-CSAF IN WSS-VARI = KOL1-COD-EST21
                   MOVE MSC-COD-CMSC IN MSC TO CYA-IND-TCYA IN CAN-FLD
               ELSE
                   MOVE 'MSC-CIC-TABL' TO FIO-AKEY
                   MOVE FIO-GET-NXT TO FIO-CMND
                   GO TO LUP-BUS-CAJA.
           MOVE KOL1-FEC-CAN-REA         TO WSS-FEC-FCNC IN WSS-VARI.
           MOVE KOL1-VAL-PAG             TO CAN-SGV-TPAG IN CAN-FLD.
           MOVE WSS-NUM-DCNC IN WSS-VARI TO CAN-NUM-DCAN IN CAN-FLD.
           MOVE WSS-NUM-MCNC IN WSS-VARI TO CAN-NUM-MCAN IN CAN-FLD.
           IF WSS-NUM-ACNC IN WSS-VARI > 80
              MOVE '19'                 TO CAN-NUM-SCAN IN CAN-FLD
           ELSE
              MOVE '20'                 TO CAN-NUM-SCAN IN CAN-FLD.
           MOVE WSS-NUM-ACNC IN WSS-VARI TO CAN-NUM-ACAN IN CAN-FLD.
           PERFORM VAL-NUM-KEY-CAN.
           PERFORM VAL-NUM-FLD-CAN.
           MOVE 'S' TO WSS-IBLK-TINT.
           MOVE 'N' TO WSS-IBLK-TPAG.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-CAN-FEC-FOUT.
           PERFORM CHK-FRM-SUAR.
           IF WSS-SW NOT = ZEROES
               GO TO FIN-PRO-ING-CAN.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-CAN-FEC-FCAN.
           PERFORM CHK-FRM-SUAR.
           IF WSS-SW NOT = ZEROES
               GO TO FIN-PRO-ING-CAN.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-CAN-FEC-FEGR.
           PERFORM CHK-FRM-SUAR.
           IF WSS-SW NOT = ZEROES
               GO TO FIN-PRO-ING-CAN.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-CON-FLD-CAN.
           PERFORM CHK-FRM-SUAR.
           IF WSS-SW NOT = ZEROES
               GO TO FIN-PRO-ING-CAN.
           PERFORM CMN-ING.
           PERFORM CHK-CMN-ING.
       FIN-PRO-ING-CAN.
           EXIT.

      *DPM ini  9-JAN-1997
       COPY COLBGMPC.
      *DPM fin  9-JAN-1997

      * RBG/INI/12-NOV-1996
       COPY SGCBFDCE.
       COPY SGCBFDCP.
       COPY COLBFCOM.
      * RBG/FIN/12-NOV-1996
       COPY GNSBVNUM.
       COPY GNSBGIER.
       COPY GNSBGCAM.
       COPY COLBFTMC.
       COPY COLBFCYA.
       COPY COLBFICG.
       COPY COLBFITR.
       COPY COLBFOPC.
       COPY COLBFRCV.
       COPY COLBFROV.
       COPY COLBFVEN.
       COPY COLBFCAN.
       COPY COLBFRDC.
       COPY SGCBFDBC.
       COPY SGCBFRCO.
       COPY SGCBFOPE.
       COPY GNSBGCPT.
       COPY COLBGMPT.
       COPY COLBGCLI.
       COPY GNSBGCIC.
       COPY GNSBFCIC.
       COPY TABBFCAM.
       COPY TABBFVLR.
       COPY COLBGVEN.
      *SMC-INI 09.09.1993
       COPY COLBGINT.
      *SMC-FIN 09.09.1993
       COPY GNSBGCVI.
       COPY COLBFDLC.
       COPY COLBFEVC.
       COPY COLBFTOC.
       COPY GNSBGPES.

      *DAD ini  04-AGO-1993   (Memo.28-06-93)
       COPY COLBGVDI.
      *DAD fin  04-AGO-1993
       COPY COLB3CAN.
       COPY COLBMCAN.
       COPY COLBFCRS.
       COPY GNSBFMSG.
       COPY GNSBGSYS.
       COPY GNSBGVSM.
       COPY GNSBGDTC.
      *COPY GNSBGFRM.
       COPY GNSBG3CF.
       COPY GNSBGMSG.
       COPY GNSBIABT.
       COPY GNSBFTAB.
       COPY GNSBGTDQ.
       COPY GNSBEKEY.
       COPY GNSBBTAB.
       COPY GNSBVCOD.
       COPY GNSBVTAB.
       COPY GNSBBMSC.
       COPY GNSBVIND.
       COPY GNSBVMSC.
       COPY GNSBFERR.
       COPY GNSBFMSC.
       COPY GNSBVIDC.
       COPY GNSBPVRF.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY GNSBGHOY.
       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY TABBFOFI.
       COPY TABBBUSR.
       COPY TABBVTDU.
       COPY TABBFUSR.
       COPY GNSBGQUE.
      *ALD-BCI-INI/10.05.1999
       COPY TABBKTXC.
      *ALD-BCI-FIN/10.05.1999
       PGM-EBR-ALL SECTION.
       INI-PGM-EBR-ALL.
           MOVE FIO-EBR-ALL TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FIN-PGM-EBR-ALL.
           EXIT.
