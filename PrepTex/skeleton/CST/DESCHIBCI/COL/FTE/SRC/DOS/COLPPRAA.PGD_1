       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPPRAA.
       AUTHOR.          CONSIST  (R.A.A.).
       DATE-WRITTEN.    23-FEB-1993.

      * PRUEBA DE RECORRIDO POR LLAVE ALTERNA EN ARCHIVO VSAM INDEXADO
      * PARA VER SI SE PIERDEN PUNTEROS, LUEGO DE CAMBIAR DE LLAVE.

       ENVIRONMENT DIVISION.
      *====================
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
      *DOS SELECT  COLRAA ASSIGN TO SYS010-COLRAA
      *MVS SELECT  COLRAA ASSIGN TO        COLRAA
           SELECT  COLRAA ASSIGN TO        COLRAA
                ORGANIZATION         IS INDEXED
                ACCESS               IS DYNAMIC
                RECORD KEY           IS RAA-KEY
                ALTERNATE RECORD KEY IS RAA-ALT-KEY1
                          WITH DUPLICATES
                ALTERNATE RECORD KEY IS RAA-ALT-KEY2
                          WITH DUPLICATES
                FILE STATUS          IS FIO-STAT.

       DATA DIVISION.
      *=============
       FILE SECTION.
       FD  COLRAA
           LABEL RECORDS STANDARD
           RECORD CONTAINS 65.
      *
       01  REG-COLRAA.
           05  RAA-KEY                 PIC 9(05).
           05  RAA-GLOSA               PIC X(15).
           05  RAA-ALT-KEY1            PIC X(05).
           05  RAA-GLOSA1              PIC X(20).
           05  RAA-ALT-KEY2            PIC 9(05).
           05  RAA-GLOSA2              PIC X(15).

       WORKING-STORAGE SECTION.
      *-----------------------
       77  FIO-STAT                    PIC X(02)      VALUE SPACES.
       77  WS-I                        PIC 9(03)      VALUE 0.
       77  WS-REG-COLRAA               PIC X(65)      VALUE SPACES.
       77  WS-RAA-KEY                  PIC X(05)      VALUE ZEROES.
       77  WS-TIPO                     PIC X(05)      VALUE SPACES.
      *

       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
       ABRIR.
           OPEN INPUT COLRAA.
           IF  FIO-STAT NOT = '00'
               DISPLAY 'ERROR AL ABRIR ARCHIVO; STATUS ' FIO-STAT
               GO TO FIN.
           ACCEPT WS-TIPO.
      *
       START-ALT-KEY1.
           MOVE SPACES       TO RAA-ALT-KEY1.
      *    START COLRAA KEY RAA-ALT-KEY1 NOT < RAA-ALT-KEY1.
           START COLRAA KEY NOT < RAA-ALT-KEY1.
           IF  FIO-STAT > '00'
               DISPLAY 'FALLO START POR LLAVE ALT.1; STATUS ' FIO-STAT
               GO TO FIN.
      *
       READ-NEXT-ALT-KEY1.
----> *    READ COLRAA KEY RAA-ALT-KEY1 NEXT.
           READ COLRAA NEXT.
           IF  FIO-STAT = '10'
               DISPLAY 'FIN DE ARCHIVO LLAVE ALT1 '
               GO TO FIN.
OJO-> *    IF  FIO-STAT > '00'
      *        DISPLAY 'FALLO READ NEXT; STATUS ' FIO-STAT
      *        GO TO FIN.
      *
           DISPLAY 'LEYO LLAVE ALT1 = ' RAA-ALT-KEY1
                   ',   GLOSA1 = ' RAA-GLOSA1.
           DISPLAY REG-COLRAA.
           IF  RAA-ALT-KEY1 = WS-TIPO
               ADD  1       TO WS-I.
           IF  WS-I > 4
               GO TO LECTURA-DIRECTA.
           MOVE RAA-KEY    TO WS-RAA-KEY.
           GO TO READ-NEXT-ALT-KEY1.
      *
       LECTURA-DIRECTA.
           MOVE 0            TO WS-I.
           MOVE REG-COLRAA   TO WS-REG-COLRAA.
           DISPLAY 'VOY A LEER POR LLAVE DIRECTA EL REGISTRO ANTERIOR'.
           DISPLAY 'LLAVE PRINCIPAL = ' WS-RAA-KEY.
           MOVE WS-RAA-KEY   TO RAA-KEY.
           READ COLRAA.
           IF  FIO-STAT > '00'
               DISPLAY 'NO LEYO POR CLAVE PRINCIPAL; STATUS ' FIO-STAT
               GO TO FIN.
           DISPLAY 'REGISTRO LEIDO; LLAVE PRINCIPAL = ' RAA-KEY
           DISPLAY 'LLAVE ALTERNA = ' RAA-ALT-KEY1
                   'GLOSA1 = ' RAA-GLOSA1
           DISPLAY REG-COLRAA.
           DISPLAY 'AHORA INTENTO RETOMAR LECTURA POR LLAVE ALTERNA'.
      *
           MOVE WS-REG-COLRAA  TO REG-COLRAA.
           GO TO READ-NEXT-ALT-KEY1.
      *
       FIN.
           CLOSE COLRAA.
           STOP RUN.
