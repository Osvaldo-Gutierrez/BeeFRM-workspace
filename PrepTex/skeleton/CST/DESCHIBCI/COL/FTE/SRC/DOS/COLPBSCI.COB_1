       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPBSCI.
       AUTHOR.          ADA(rvm).
       DATE-WRITTEN.    21-DIC-1999 15:00.

      * Programa Generador Datos para :
      * "Interfaz con otros sistemas para emision de Certificados".

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *------------------------
       COPY COLBRSCI.
       COPY COLBRSCO.
       COPY SGCBRDBC.

       COPY GNSWGFEC.
       COPY GNSWVFIO.
       COPY GNSWCFIO.
       COPY GNSWVIDD.
       COPY GNSWGHOY.
       COPY GNSWGSYS.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSBRMSC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.

       01  WSS-VARI.
           03  WSS-FEC-FINI.
               05  WSS-NUM-SINI                       PIC 9(02).
               05  WSS-NUM-AINI                       PIC 9(02).
               05  WSS-NUM-MINI                       PIC 9(02).
               05  WSS-NUM-DINI                       PIC 9(02).
           03  WSS-FEC-FFIN.
               05  WSS-NUM-SFIN                       PIC 9(02).
               05  WSS-NUM-AFIN                       PIC 9(02).
               05  WSS-NUM-MFIN                       PIC 9(02).
               05  WSS-NUM-DFIN                       PIC 9(02).
           03  WSS-FEC-FINN.
               05  WSS-NUM-DINN                       PIC 9(02).
               05  WSS-NUM-MINN                       PIC 9(02).
               05  WSS-NUM-SINN                       PIC 9(02).
               05  WSS-NUM-AINN                       PIC 9(02).
           03  WSS-FEC-FFNN.
               05  WSS-NUM-DFNN                       PIC 9(02).
               05  WSS-NUM-MFNN                       PIC 9(02).
               05  WSS-NUM-SFNN                       PIC 9(02).
               05  WSS-NUM-AFNN                       PIC 9(02).
           03  WSS-NUM-SCOL       VALUE ZEROES        PIC 9(06).
           03  WSS-NUM-SCIG       VALUE ZEROES        PIC 9(06).
      *
       PROCEDURE DIVISION.
      *===================
       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.
           PERFORM INI.
           IF NOT FIO-STAT-OKS
               GO TO FIN-MAIN.

      *GRABA REGISTRO DE INICIO
           MOVE ZEROES                   TO SCI-CIC-ICLI IN SCI.
           MOVE ZEROES                   TO SCI-NUM-ICLI IN SCI.
           MOVE ZEROES                   TO SCI-VRF-ICLI IN SCI.
           MOVE WSS-FEC-FINI IN WSS-VARI TO SCI-FEC-FINI IN SCI.
           MOVE WSS-FEC-FFIN IN WSS-VARI TO SCI-FEC-FFIN IN SCI.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-SCI.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR: AL GRABAR EN COLSCI : ' FIO-STAT
               MOVE 100 TO RETURN-CODE
               PERFORM GNS-PRO-END.
      *

           PERFORM PROCESA-SCO.

       FIN-MAIN.
           PERFORM IMP-ESTD.
           PERFORM CLO-FIL.
           PERFORM GNS-PRO-END.

       PROCESA-SCO SECTION.
       INI-PROCESA-SCO.
           MOVE WSS-FEC-FINI IN WSS-VARI TO SCO-FEC-FSCO IN SCO
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-PROCESA-SCO.
           MOVE 'SCO-FEC-FSCO' TO FIO-AKEY.
           PERFORM COL-FIO-SCO.
           IF NOT FIO-STAT-OKS OR
              (SCO-FEC-FSCO IN SCO < WSS-FEC-FINI IN WSS-VARI) OR
              (SCO-FEC-FSCO IN SCO > WSS-FEC-FFIN IN WSS-VARI)
               IF NOT FIO-STAT-OKS
                   IF FIO-CMND = FIO-GET-NLS
                       DISPLAY ' '
                       DISPLAY 'ERROR: NO EXISTEN DATOS SCO ENTRE EL: '
                       WSS-FEC-FINI IN WSS-VARI ' Y EL: '
                       WSS-FEC-FFIN IN WSS-VARI ' STAT: ' FIO-STAT
                       PERFORM GNS-PRO-ABT
                   ELSE
                       GO TO FIN-PROCESA-SCO.

           ADD 1 TO WSS-NUM-SCOL IN WSS-VARI.

           MOVE SCO-CIC-ICLI IN SCO TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF FIO-STAT-OKS
               MOVE DBC-CIC-ICLI IN DBC TO SCI-CIC-ICLI IN SCI
               MOVE DBC-NUM-ICLI IN DBC TO SCI-NUM-ICLI IN SCI
               MOVE DBC-VRF-ICLI IN DBC TO SCI-VRF-ICLI IN SCI
           ELSE
               DISPLAY 'ERROR: CLIENTE NO EXISTE CON CIC : '
                      SCO-CIC-ICLI IN SCO
               GO TO NXT-PROCESA-SCO.

           IF DBC-IND-ICLI IN DBC > SPACES OR
              DBC-GLS-ICLI IN DBC > SPACES
               GO TO NXT-PROCESA-SCO.

           MOVE SCO-FEC-FIRS IN SCO TO SCI-FEC-FINI IN SCI.
           MOVE SCO-FEC-FTRS IN SCO TO SCI-FEC-FFIN IN SCI.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-SCI.
           IF FIO-STAT-OKS
               ADD 1 TO WSS-NUM-SCIG IN WSS-VARI
           ELSE
               DISPLAY 'ERROR: AL GRABAR EN COLSCI : ' FIO-STAT
               MOVE 100 TO RETURN-CODE
               PERFORM GNS-PRO-END.
       NXT-PROCESA-SCO.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-PROCESA-SCO.
       FIN-PROCESA-SCO.
           EXIT.

       INI SECTION.
       INI-INI.
           MOVE 'COLPBSCI' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      *
           PERFORM GET-FHOY.
      *Captura Fecha de Inicio
           DISPLAY 'FECHA INICIO  ( DDMMSSAA ) : '.
           ACCEPT  WSS-FEC-FINN IN WSS-VARI.
           DISPLAY WSS-FEC-FINN IN WSS-VARI.
      *Captura Fecha de Termino
           DISPLAY 'FECHA TERMINO ( DDMMSSAA ) : '.
           ACCEPT  WSS-FEC-FFNN IN WSS-VARI.
           DISPLAY WSS-FEC-FFNN IN WSS-VARI.

      *VAL-FEC Valida Fecha de Inicio
           MOVE WSS-FEC-FINN IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT
               PERFORM GNS-PRO-ABT.

      *VAL-FEC Valida Fecha de Termino
           MOVE WSS-FEC-FFNN IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT
               PERFORM GNS-PRO-ABT.

      *MUEVE FECHA DE INICIO
           MOVE WSS-NUM-DINN IN WSS-VARI TO WSS-NUM-DINI IN WSS-VARI.
           MOVE WSS-NUM-MINN IN WSS-VARI TO WSS-NUM-MINI IN WSS-VARI.
           MOVE WSS-NUM-SINN IN WSS-VARI TO WSS-NUM-SINI IN WSS-VARI.
           MOVE WSS-NUM-AINN IN WSS-VARI TO WSS-NUM-AINI IN WSS-VARI.

      *MUEVE FECHA DE TERMINO
           MOVE WSS-NUM-DFNN IN WSS-VARI TO WSS-NUM-DFIN IN WSS-VARI.
           MOVE WSS-NUM-MFNN IN WSS-VARI TO WSS-NUM-MFIN IN WSS-VARI.
           MOVE WSS-NUM-SFNN IN WSS-VARI TO WSS-NUM-SFIN IN WSS-VARI.
           MOVE WSS-NUM-AFNN IN WSS-VARI TO WSS-NUM-AFIN IN WSS-VARI.

           MOVE FIO-OUT TO FIO-CMND.
           PERFORM COL-FIO-SCI.
           DISPLAY 'STATUS DE APERTURA OUTPUT COLSCI : ' FIO-STAT
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR: EN APERTURA COLSCI, PROCESO CANCELADO'
               PERFORM GNS-PRO-ABT.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-SCO.
           DISPLAY 'STATUS DE APERTURA INPUT  COLSCO : ' FIO-STAT.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR: EN APERTURA COLSCO, PROCESO CANCELADO'
               PERFORM GNS-PRO-ABT.

           PERFORM SGC-FIO-DBC.

           MOVE '00' TO FIO-STAT.
       FIN-INI.
           EXIT.

       IMP-ESTD SECTION.
       INI-IMP-ESTD.
           DISPLAY ' '
           DISPLAY 'ESTADISTICAS COLPBSCI'.
           DISPLAY '---------------------'.
           DISPLAY 'REGISTROS    SCO LEIDOS  ......: '
                    WSS-NUM-SCOL IN WSS-VARI.
           DISPLAY 'REGISTROS COLSCI GRABADOS......: '
                    WSS-NUM-SCIG IN WSS-VARI.
           DISPLAY ' '.
       FIN-IMP-ESTD.
           EXIT.

       CLO-FIL SECTION.
       INI-CLO-FIL.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-SCI.
           PERFORM COL-FIO-SCO.
           PERFORM SGC-FIO-DBC.
       FIN-CLO-FIL.
           EXIT.
      *-----------------------------------------------------------------
       COPY COLIOSCI.
       COPY COLIOSCO.
       COPY SGCBFDBC.
      *
       COPY GNSBGEND.
       COPY GNSBGABT.
       COPY GNSBTABT.
       COPY GNSBBTAB.
       COPY GNSBBMSG.
       COPY GNSBFMSG.
       COPY GNSBFMSC.
       COPY GNSBFTAB.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBBSYS.
       COPY GNSBGHOY.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
