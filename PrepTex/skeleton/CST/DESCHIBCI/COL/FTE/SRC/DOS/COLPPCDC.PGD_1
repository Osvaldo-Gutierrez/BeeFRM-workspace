       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.    COLPPCDC.
       AUTHOR.        CONSIST.
       DATE-WRITTEN.  30-OCT-1995      ( Ultima Modificacion )

      *Obtiene datos para generacion Cuponera
      *de una operacion de credito

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
       COPY GNSWCSCR.
       COPY GNSWV3CR.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGQUE.
       COPY GNSWGELS.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWVIDD.
       COPY GNSBRIDD.
       COPY GNSWG3CF.
       COPY GNSWGSYS.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY COLWGINT.
       COPY GNSWGPES.
       COPY GNSBRMSG.
       COPY GNSBRTAB.
       COPY GNSBRMSC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.

       COPY COLBRRCV.
       COPY COLBRVEN.
       COPY COLBROPC.
       COPY COLBRICG.
       COPY COLBRDLC.
       COPY COLBREVC.
       COPY COLBRTOC.
       COPY COLBRRDC.
       COPY TABBROFI.
       COPY TABBRCAM.
       COPY SGCBRDBC.
       COPY SGCBRRCD.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.

       COPY COLWGVEN.
       COPY GNSWGCPT.

       COPY COLWGCDC.

       01  WSS-VARI.
           03  WSS-VAL-FINA-EDT         PIC  ZZ.ZZZ.ZZZ.ZZ9,9999.
           03  WSS-RCV-AREA.
               05 WSS-TRAN                           PIC X(04).
               05 WSS-IOPC                           PIC X(12).
           03  WSS-AREA.
               05 WSS-CIC-IOPC                       PIC X(12).
               05 WSS-GLS-REST                       PIC X(1194).
           03  WSS-COD-LUGA.
               05 WSS-IND-LUGA                       PIC X(01).
               05 WSS-COD-PAIS                       PIC X(03).
           03  WSS-I             VALUE ZEROES        PIC 9(02).
           03  WSS-IMAX          VALUE 60            PIC 9(02).
           03  WSS-KEY-IDLC.
               05 WSS-COD-TOPC                       PIC X(01).
               05 WSS-GLS-NOPC                       PIC X(11).


       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           03 FILLER                          PIC X(1866).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================
       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.
           PERFORM GNS-HDL-VSM.
           MOVE 'COL'      TO SCR-SIST.
           MOVE 'COLPPCDC' TO IDD-COD-CIDD IN IDD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-IDD.
           IF NOT FIO-STAT-OKS
               MOVE 'DEFAULT' TO IDD-COD-CIDD IN IDD
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-IDD
               IF NOT FIO-STAT-OKS
                   MOVE
                   'NO EXISTE REGISTRO IDD CON LLAVE : '
                   TO SYS-MEN1
                   MOVE IDD-COD-CIDD IN IDD TO SYS-MEN2
                   MOVE SYS-ABOR TO SYS-CMND
                   PERFORM GNS-PRO-SYS
               ELSE
                   MOVE IDD TO IDD-REGI
           ELSE
               MOVE IDD TO IDD-REGI.
           MOVE DFHCOMMAREA(1:EIBCALEN)    TO WSS-AREA.
           MOVE WSS-CIC-IOPC IN WSS-VARI TO CDC-IOPC.
           PERFORM INI-VARI.
           PERFORM PRO-CCDC.
           MOVE CDC-CMMA TO DFHCOMMAREA.
        FIN-MAIN.
           EXEC CICS RETURN
           END-EXEC.

       INI-VARI SECTION.
       INI-INI-VARI.
           MOVE SPACES TO CDC-MENS.
           MOVE SPACES TO CDC-DESC1.
           MOVE SPACES TO CDC-DESC2.
           MOVE SPACES TO CDC-NOMC.
           MOVE SPACES TO CDC-DIRE.
           MOVE SPACES TO CDC-LUGA.
           MOVE SPACES TO CDC-OFOC.
           MOVE SPACES TO CDC-GOFI.
           MOVE ZEROES TO CDC-VCOR.
           MOVE SPACES TO CDC-SAFE.
           MOVE SPACES TO CDC-TCAM.
           MOVE SPACES TO CDC-MONE.
           PERFORM CLR-VCTO VARYING WSS-I FROM 1 BY 1 UNTIL
                   WSS-I > WSS-IMAX.
       FIN-INI-VARI.
           EXIT.

       CLR-VCTO SECTION.
       INI-CLR-VCTO.
           MOVE ZEROES TO CDC-DVEN(WSS-I).
           MOVE ZEROES TO CDC-MVEN(WSS-I).
           MOVE ZEROES TO CDC-SVEN(WSS-I).
           MOVE ZEROES TO CDC-AVEN(WSS-I).
           MOVE ZEROES TO CDC-FINA(WSS-I).
       FIN-CLR-VCTO.
           EXIT.

       PRO-CCDC SECTION.
       INI-PRO-CCDC.
           MOVE CDC-IOPC TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE 'OPC    NEX'        TO CDC-MENS
               GO TO FIN-PRO-CCDC.

           IF NOT ( OPC-MSC-STAT IN OPC = 'L' OR
              OPC-MSC-STAT IN OPC = 'A' )
               MOVE 'ESTADOOPCINV' TO CDC-MENS
               GO TO FIN-PRO-CCDC.

      *Total de Cuotas
           IF OPC-NUM-VCOR IN OPC > WSS-IMAX
               MOVE 'CUOT>MAX60' TO CDC-MENS
               GO TO FIN-PRO-CCDC.
           MOVE OPC-NUM-VCOR IN OPC TO CDC-VCOR.

      *Obtiene Oficina Credito
           MOVE OPC-COD-OFOC IN OPC TO CDC-OFOC.

      *Obtiene Glosa Oficina Credito
           MOVE OPC-COD-OFOC IN OPC TO OFI-COD-OFIC IN OFI.
           PERFORM BUS-OFI.
           MOVE OFI-GLS-DESC IN OFI TO CDC-GOFI.
      *Obtiene Moneda y tipo de Cambio
           MOVE 'TAB'               TO TAB-COD-SIST
           MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
           MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB
           PERFORM BUS-TAB
           MOVE TAB-GLS-ABRV IN TAB TO CDC-MONE.
           MOVE TAB-COD-DAT1(7)     TO CDC-TCAM.

      *Obtiene mensaje para cupon de cancelacion.
           MOVE 'COL'        TO TAB-COD-SIST.
           MOVE 'CDC'        TO TAB-COD-TTAB IN TAB.
           MOVE 'C'          TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO CDC-DESC1.
           MOVE TAB-GLS-DATA IN TAB TO CDC-DESC2.
      *Busca Clave Safe
           MOVE OPC-CAI-IOPC IN OPC TO DLC-CAI-IOPC IN DLC.
           MOVE OPC-IIC-IOPC IN OPC TO DLC-IIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT ( FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = DLC-CIC-IOPC IN DLC )
               MOVE 'OPCSINDLCASO' TO CDC-MENS
               GO TO FIN-PRO-CCDC.
           MOVE DLC-KEY-IDLC IN DLC      TO WSS-KEY-IDLC IN WSS-VARI.
           IF OPC-COD-TOPC IN OPC = 'D'
               MOVE '4' TO WSS-COD-TOPC IN WSS-VARI.
           MOVE WSS-KEY-IDLC IN WSS-VARI TO CDC-SAFE.
      *Busca Nombre Clientes
           MOVE OPC-CAI-IOPC IN OPC TO RDC-CAI-IOPC IN RDC.
           MOVE OPC-IIC-IOPC IN OPC TO RDC-IIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT FIO-STAT-OKS
               MOVE 'OPCSINCLIASO' TO CDC-MENS
               GO TO FIN-PRO-CCDC.
           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               MOVE 'OPCCONCLINEX' TO CDC-MENS
               GO TO FIN-PRO-CCDC.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO CDC-NOMC.

      *Busca Direccion Cliente
           MOVE DBC-CAI-ICLI IN DBC TO RCD-CAI-ICLI IN RCD.
           MOVE DBC-IIC-ICLI IN DBC TO RCD-IIC-ICLI IN RCD.
           MOVE RDC-NUM-DIRE IN RDC TO RCD-NUM-DIRE IN RCD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCD.
           IF NOT FIO-STAT-OKS
               MOVE 'DIREOPCINEX' TO CDC-MENS
               GO TO FIN-PRO-CCDC.
           MOVE RCD-GLS-DIRE IN RCD TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO CDC-DIRE.

           IF RCD-GLS-DIRE IN RCD NOT > SPACES
               MOVE SPACES TO CDC-LUGA
           ELSE
               MOVE RCD-COD-LUGA IN RCD TO WSS-COD-LUGA IN WSS-VARI
               MOVE 'TAB'               TO TAB-COD-SIST
               IF WSS-IND-LUGA IN WSS-VARI = 'P'
                   MOVE 'PAI'                    TO TAB-COD-TTAB
                   MOVE WSS-COD-PAIS IN WSS-VARI TO TAB-COD-CTAB IN TAB
                   PERFORM BUS-TAB
                   MOVE TAB-GLS-DESC IN TAB TO CDC-LUGA
               ELSE
                   MOVE 'COM'                    TO TAB-COD-TTAB
                   MOVE WSS-COD-LUGA IN WSS-VARI TO TAB-COD-CTAB IN TAB
                   PERFORM BUS-TAB
                   MOVE TAB-GLS-DESC IN TAB TO CDC-LUGA.

      *Busca Datos Vencimiento
           IF OPC-IND-VSTR IN OPC = 'N'
               PERFORM PRO-VEN-NSTR
           ELSE
               PERFORM PRO-VEN-SSTR.

       FIN-PRO-CCDC.
           EXIT.

       PRO-VEN-SSTR SECTION.
       INI-PRO-VEN-SSTR.
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
           MOVE 1                   TO VEN-NUM-IVEN IN VEN.
       LUP-PRO-VEN-SSTR.
           MOVE FIO-GET-KEY TO FIO-CMND.
           MOVE OPC-FEC-FCOL IN OPC TO VEN-FTBS.
           MOVE 'S'                 TO VEN-KEST.
           PERFORM COL-OBT-VEN.
           IF VEN-STAT-EOF
               GO TO FIN-PRO-VEN-SSTR.
           IF NOT VEN-STAT-OKS
               MOVE 'ERRRUTEXPVEN' TO CDC-MENS
               GO TO FIN-PRO-VEN-SSTR.

           MOVE VEN-NUM-DVEN IN VEN TO CDC-DVEN(VEN-NUM-IVEN IN VEN).
           MOVE VEN-NUM-MVEN IN VEN TO CDC-MVEN(VEN-NUM-IVEN IN VEN).
           MOVE VEN-NUM-SVEN IN VEN TO CDC-SVEN(VEN-NUM-IVEN IN VEN).
           MOVE VEN-NUM-AVEN IN VEN TO CDC-AVEN(VEN-NUM-IVEN IN VEN).
      *ALD-BCI-INI/23.11.1995
           MOVE VEN-VAL-FINA IN VEN TO WSS-VAL-FINA-EDT.
           MOVE WSS-VAL-FINA-EDT    TO CDC-FINA(VEN-NUM-IVEN IN VEN).
      *    MOVE VEN-VAL-FINA IN VEN TO CDC-FINA(VEN-NUM-IVEN IN VEN).
      *ALD-BCI-INI/23.11.1995
           ADD 1 TO VEN-NUM-IVEN IN VEN.
           IF VEN-NUM-IVEN IN VEN > OPC-NUM-VCOR IN OPC
               GO TO FIN-PRO-VEN-SSTR.
           GO TO LUP-PRO-VEN-SSTR.
       FIN-PRO-VEN-SSTR.
           EXIT.

       PRO-VEN-NSTR SECTION.
       INI-PRO-VEN-NSTR.
           MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN.
           MOVE 0                   TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-PRO-VEN-NSTR.
           PERFORM COL-FIO-VEN.
           IF NOT ( FIO-STAT-OKS AND
                    VEN-CIC-IOPC IN VEN = OPC-CIC-IOPC IN OPC )
               GO TO FIN-PRO-VEN-NSTR.

           MOVE VEN-NUM-DVEN IN VEN TO CDC-DVEN(VEN-NUM-IVEN IN VEN).
           MOVE VEN-NUM-MVEN IN VEN TO CDC-MVEN(VEN-NUM-IVEN IN VEN).
           MOVE VEN-NUM-SVEN IN VEN TO CDC-SVEN(VEN-NUM-IVEN IN VEN).
           MOVE VEN-NUM-AVEN IN VEN TO CDC-AVEN(VEN-NUM-IVEN IN VEN).
      *ALD-BCI-INI/23.11.1995
           MOVE VEN-VAL-FINA IN VEN TO WSS-VAL-FINA-EDT.
           MOVE WSS-VAL-FINA-EDT    TO CDC-FINA(VEN-NUM-IVEN IN VEN).
      *    MOVE VEN-VAL-FINA IN VEN TO CDC-FINA(VEN-NUM-IVEN IN VEN).
      *ALD-BCI-INI/23.11.1995

           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-PRO-VEN-NSTR.
       FIN-PRO-VEN-NSTR.
           EXIT.

       COPY GNSBFMSG.
       COPY GNSBFTAB.
       COPY GNSBFMSC.
       COPY GNSBGMSG.
       COPY GNSBGFEC.
       COPY GNSBBTAB.
       COPY GNSBPFEC.
       COPY GNSBGHOY.
       COPY GNSBGDTC.
       COPY GNSBIABT.
       COPY GNSBG3CF.
       COPY GNSBGSYS.
       COPY GNSBGQUE.
       COPY COLBGINT.
       COPY GNSBGPES.
       COPY GNSBGCPT.
       COPY COLBFRCV.
       COPY COLBFVEN.
       COPY COLBFOPC.
       COPY COLBFICG.
       COPY COLBFDLC.
       COPY COLBFEVC.
       COPY COLBFRDC.
       COPY COLBFTOC.
       COPY SGCBFDBC.
       COPY SGCBFRCD.
       COPY COLBGVEN.
       COPY TABBFCAM.
       COPY TABBFOFI.
       COPY TABBBOFI.
       COPY GNSBHVSM.
       COPY GNSBGVSM.
       COPY GNSBFIDD.
       PGM-EBR-ALL SECTION.
       INI-PGM-EBR-ALL.
           MOVE FIO-EBR-ALL TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FIN-PGM-EBR-ALL.
           EXIT.
