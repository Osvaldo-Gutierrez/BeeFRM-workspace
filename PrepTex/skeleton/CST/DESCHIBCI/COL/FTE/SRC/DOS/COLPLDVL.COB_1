       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPLDVL.
       AUTHOR.          BEETEAM.
       DATE-WRITTEN.    11-May-99 03:40 PM.

      * Programa Listador de Reporte DVG sin Sort.
      *
      * V 1.1.2
      *
      *<<<< CMT_ID
      *>>>>

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.

            C01 IS SALTO
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
           SELECT RPTDVL       ASSIGN TO        RPTDVL.


      *<<<< IOS
      *>>>>
       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       FD  RPTDVL LABEL RECORDS OMITTED
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-DVL     PIC X(132).

      *<<<< FD_RPT
      *>>>>
      *<<<< FLS
      *>>>>

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DVG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY COLBRDVL.
       COPY COLRRDVL.

       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSWGGRC.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY COLRWDVL.

       COPY COLRNDVL.
       COPY COLRODVL.
      *<<<< RO
       COPY GNSWGSYS.
       01  PGM-HRSR-DVL   VALUE 'N'       PIC X(01).
           88 HAY-REGISTROS-EN-SORT-DVL  VALUE 'S'.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).


       01  WSS-VARI.
           03  WSS-NUM-RLEI       VALUE ZEROES    PIC 9(03).
           03  WSS-NUM-RSEL       VALUE ZEROES    PIC 9(03).
           03  WSS-IND-VACIO      VALUE 'N'       PIC X(01).
           03  WSS-IND-LSIG       VALUE 'N'       PIC X(01).

      * Variables para emulacion de archivo MCD para comparar con
      * CIC de tabla ALG para saber el concepto a grabar en DVG
           03 WSS-IND-IDN                         PIC X(03).
           03 WSS-IND-RDN                         PIC X(03).
           03 WSS-IND-IDS                         PIC X(03).
           03 WSS-IND-RDS                         PIC X(03).
           03 WSS-IND-IDM                         PIC X(03).
           03 WSS-IND-RDM                         PIC X(03).
           03 WSS-COD-PESO                        PIC X(06).
           03 WSS-MSC-MNAC                        PIC X(01).

           03 WSS-CIC-IOPC                        PIC X(12).
           03 WSS-COD-OFOC                        PIC X(03).
           03 WSS-MSC-TCCT                        PIC X(03).
           03 WSS-COD-PLZO.
              05 WSS-MSC-TPZO                    PIC X(01).
              05 WSS-MSC-CPZO                    PIC X(01).
           03 WSS-COD-VCOC.
              05 WSS-MSC-TVOC                    PIC X(01).
              05 WSS-MSC-CVOC                    PIC X(03).
              05 WSS-MSC-TCOC                    PIC X(02).
           03 WSS-COD-COOC.
              05 WSS-COD-TOOC                    PIC X(03).
              05 WSS-COD-AOOC                    PIC X(03).
           03 WSS-SGV-ICTB    VALUE ZEROES       PIC S9(13)V9(02).
           03 WSS-VAL-SCRE    VALUE ZEROES       PIC 9(11)V9(04).
           03 WSS-GLS-COOC.
              05 WSS-GLS-TOOC                    PIC X(25).
              05 WSS-GLS-AOOC                    PIC X(25).
           03 WSS-SGV-TASA    VALUE ZEROES       PIC S9(04)V9(04).
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.

       COPY TABBROFI.
       COPY GNSBRMSC.
       COPY GNSWGCPT.
       COPY TABBRCAM.
       COPY GNSWGPES.
      *>>>>
      * AQUI EXISTIA LABEL RF INI
      *>>>>
      * AQUI EXISTIA LABEL RF FIN
       COPY COLRTDVL.

       PROCEDURE DIVISION.
      *==================
      * AQUI EXISTIA LABEL FIN_DEC INI

      *<<<< FIN_DEC
      *>>>>
      * AQUI EXISTIA LABEL FIN_DEC FIN

       MAIN SECTION.
      *------------
       INI-MAIN.
      *    MOVE SYS-MXFL TO SYS-CMND.
      *    PERFORM GNS-PRO-SYS.
       COPY GNSBGEDB.
      *    MOVE 'COL' TO RPT-SIST.
           MOVE 'COLPLDVL' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *<<<< INI
       INI-INP-SRT.
      *<<<< INI_INP
           PERFORM CAL-HDR.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-DVL.
       FST-INP-SRT.
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-DVL.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NOT-OKS'
                GO TO FIN-MAIN.
      *<<<< FIN_FST_INP
           IF NOT FIO-STAT-OKS
               MOVE 'S' TO WSS-IND-VACIO IN WSS-VARI
               GO TO FIN-INP-SRT.
           MOVE ZEROES TO SRT-VAL-INTD IN SRT SRT-VAL-READ IN SRT
                          SRT-VAL-INTO IN SRT SRT-VAL-REAO IN SRT
                          SRT-VAL-INTM IN SRT SRT-VAL-REAM IN SRT.

           MOVE DVL-NUM-DPRO IN DVL TO WSS-NUM-DPRO IN WSS-DVL.
           MOVE DVL-NUM-MPRO IN DVL TO WSS-NUM-MPRO IN WSS-DVL.
           MOVE DVL-NUM-SPRO IN DVL TO WSS-NUM-SPRO IN WSS-DVL.
           MOVE DVL-NUM-APRO IN DVL TO WSS-NUM-APRO IN WSS-DVL.

       INI-PRIMER-VAL.
           ADD 1    TO WSS-NUM-RLEI IN WSS-VARI.
      *Obtiene Cuenta CAP
       INI-OUT-SRT.
           OPEN OUTPUT RPTDVL.
           PERFORM INITIATE-RPTDVL.
           MOVE SRT TO SRT-OLD-DVL.
           MOVE SRT TO SRT-CUR-DVL.
      *<<<< FST_OUT
      *>>>>
       LUP-MAIN.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.

           PERFORM MOVER-DATOS-SRT.
           ADD   1  TO WSS-NUM-RSEL IN WSS-VARI.
           PERFORM GENERATE-DL-DVL.
       RET-OUT-SRT.
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-DVL.
      *<<<< FIN_NXT_INP
           GO TO LUP-MAIN.
       FIN-MAIN.
       FIN-INP-SRT.
      *<<<< FIN_INP
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-DVL.
       FIN-OUT-SRT.
      *<<<< FIN_OUT
           DISPLAY 'ESTADISTICAS'.
           DISPLAY '------------'.
           DISPLAY 'REGISTROS SELECCIONADOS DVL : '
                                    WSS-NUM-RSEL IN WSS-VARI.
           IF HAY-REGISTROS-EN-SORT-DVL
              PERFORM TERMINATE-RPTDVL.
      *>>>>
           CLOSE RPTDVL.
           IF PGM-STAT-SRT-MAL
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       COPY COLBFDVL.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGIRH.
       COPY COLREDVL.
      *    11-MAY-99 11:42 AM     ,PAI= ,CLI= ,SOP=MVS  V 1.1.3
       D-CF-DVL-SRT-COD-COOC SECTION.
       INI-CF-DVL-SRT-COD-COOC.
      *<<<< CF_DVL_SRT_COD_COOC
      *>>>>
       FIN-CF-DVL-SRT-COD-COOC.
           EXIT.
       D-CH-DVL-SRT-COD-COOC SECTION.
       INI-CH-DVL-SRT-COD-COOC.
      *<<<< CH_DVL_SRT_COD_COOC
           MOVE SRT-COD-COOC IN SRT TO WSS-COD-COOC IN WSS-DVL.
      * Mediante BUS-TAB Busca Tipo de Operacion Credito de Tabla TIO
           IF SRT-COD-COOC IN SRT > SPACES
               MOVE SRT-COD-COOC IN SRT     TO WSS-COD-TOOC IN WSS-VARI
               MOVE 'TAB'                   TO TAB-COD-SIST
               MOVE 'TIO'                   TO TAB-COD-TTAB IN TAB
               MOVE WSS-COD-TOOC IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TOOC IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-TOOC IN WSS-VARI.

      *BUS-TAB busca glosa de clase de credito en tabla AUX
           IF SRT-COD-COOC IN SRT > SPACES
               MOVE 'COL'               TO TAB-COD-SIST
               MOVE 'AUX'               TO TAB-COD-TTAB IN TAB
               MOVE SRT-COD-COOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-AOOC IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-AOOC IN WSS-VARI.

           MOVE WSS-GLS-COOC IN WSS-VARI TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN     TO WSS-GLS-COOC IN WSS-VARI.
           MOVE WSS-GLS-COOC IN WSS-VARI TO WSS-GLS-COOC IN WSS-DVL.
      *>>>>
       FIN-CH-DVL-SRT-COD-COOC.
           EXIT.
       D-CF-DVL-SRT-COD-OFOC SECTION.
       INI-CF-DVL-SRT-COD-OFOC.



      *<<<< CF_DVL_SRT_COD_OFOC
      *>>>>
       FIN-CF-DVL-SRT-COD-OFOC.
           EXIT.
       D-CF-DVL-SRT-CIC-CCSB SECTION.
       INI-CF-DVL-SRT-CIC-CCSB.

      *<<<< CF_DVL_SRT_CIC_CCSB
       FIN-CF-DVL-SRT-CIC-CCSB.
           EXIT.
       D-PH-DVL SECTION.
       INI-PH-DVL.
      *<<<< PH_DVL
      * DPM ini  23-FEB-1998
      *Obtiene glosa de oficina
           IF SRT-COD-OFOC IN SRT > SPACES
               MOVE SRT-COD-OFOC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFOC IN WSS-DVL.

      *BUS-TAB busca glosa de Cuenta Contable en tabla PCC
      * Obtiene glosa de cuenta de capital
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'PCC' TO TAB-COD-TTAB IN TAB.
           MOVE SRT-CIC-CCSB IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF FIO-STAT-OKS
             MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-CCSB IN WSS-DVL
           ELSE
             MOVE SPACES TO WSS-GLS-CCSB IN WSS-DVL.
       FIN-PH-DVG.
           EXIT.
       D-DL-DVL SECTION.
       INI-DL-DVL.

       FIN-DL-DVL.
           EXIT.
       COPY GNSBGABT.
      *<<<< EOF
       COPY TABBBOFI.
       COPY TABBFOFI.
       COPY GNSBBTAB.
       COPY GNSBBMSG.
       COPY GNSBFMSC.
       COPY GNSBGCPT.
       COPY TABBFCAM.
       COPY GNSBGPES.

       BUSCA-CIC-TCCT SECTION.
      *----------------------*
       INI-BUSCA-TCCT.
           MOVE 'COL'                            TO FIO-SIST.
           MOVE 'MSC'                            TO MSC-CIC-TTAB IN MSC.
           MOVE 'TCCT'                           TO MSC-CIC-TMSC IN MSC.
           MOVE FIO-GET-KEY                      TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
              MOVE 'COL'       TO MSG-COD-SIST
              MOVE 'CODTCYANX' TO MSG-COD-MENS IN MSG
              PERFORM GET-MSG
              DISPLAY MSG-GLS-DESC   MSC-COD-CMSC
              DISPLAY 'LLAVE : ' MSC-CIC-CMSC IN MSC
              PERFORM GNS-PRO-ABT.
       FIN-BUSCA-CIC-TCCT.
           EXIT.


       MOVER-DATOS-SRT SECTION.
      *---------------------*
       INI-MOVER-DATOS-SRT.
           MOVE DVL-COD-OFOC IN DVL TO SRT-COD-OFOC IN SRT.
           MOVE DVL-CIC-IOPC IN DVL TO SRT-CIC-IOPC IN SRT.
           MOVE DVL-COD-COOC IN DVL TO SRT-COD-COOC IN SRT.
      *
           MOVE DVL-NUM-DVEN IN DVL TO SRT-NUM-DVEN IN SRT.
           MOVE DVL-NUM-MVEN IN DVL TO SRT-NUM-MVEN IN SRT.
           MOVE DVL-NUM-SVEN IN DVL TO SRT-NUM-SVEN IN SRT.
           MOVE DVL-NUM-AVEN IN DVL TO SRT-NUM-AVEN IN SRT.
      *
           MOVE DVL-NUM-DCOL IN DVL TO SRT-NUM-DCOL IN SRT.
           MOVE DVL-NUM-MCOL IN DVL TO SRT-NUM-MCOL IN SRT.
           MOVE DVL-NUM-SCOL IN DVL TO SRT-NUM-SCOL IN SRT.
           MOVE DVL-NUM-ACOL IN DVL TO SRT-NUM-ACOL IN SRT.
      *
           MOVE DVL-NUM-DDEV IN DVL TO SRT-NUM-DDEV IN SRT.
           MOVE DVL-NUM-MDEV IN DVL TO SRT-NUM-MDEV IN SRT.
           MOVE DVL-NUM-SDEV IN DVL TO SRT-NUM-SDEV IN SRT.
           MOVE DVL-NUM-ADEV IN DVL TO SRT-NUM-ADEV IN SRT.
      *
           MOVE DVL-NUM-ICLI IN DVL TO SRT-NUM-ICLI IN SRT.
           MOVE DVL-VRF-ICLI IN DVL TO SRT-VRF-ICLI IN SRT.
           MOVE DVL-CIC-CCSB IN DVL TO SRT-CIC-CCSB IN SRT.
           MOVE DVL-SGV-TASA IN DVL TO SRT-SGV-TINT IN SRT.
      *
           MOVE DVL-VAL-SCRE IN DVL TO SRT-VAL-SCRE IN SRT.
      *
           MOVE DVL-VAL-INTD IN DVL TO SRT-VAL-INTD IN SRT.
           MOVE DVL-VAL-READ IN DVL TO SRT-VAL-READ IN SRT.
           MOVE DVL-VAL-INTO IN DVL TO SRT-VAL-INTO IN SRT.
           MOVE DVL-VAL-REAO IN DVL TO SRT-VAL-REAO IN SRT.
           MOVE DVL-VAL-INTM IN DVL TO SRT-VAL-INTM IN SRT.
           MOVE DVL-VAL-REAM IN DVL TO SRT-VAL-REAM IN SRT.
       FIN-MOVER-DATOS-SRT.
           EXIT.
      *>>>>
