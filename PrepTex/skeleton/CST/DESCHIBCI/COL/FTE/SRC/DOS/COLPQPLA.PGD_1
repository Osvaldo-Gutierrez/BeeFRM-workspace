       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   COLPQPLA.
       AUTHOR.       BEE LTDA.
       DATE-WRITTEN. 28-Aug-19 09:02 AM.

      * NOMBRE PROGRAMA                   COLPQPLA
      * VERSION PGM                       3.1
      * VERSION SKL                       19.04.15
      * OPCION                            CON
      * ARCHIVO BASE                      COLOPC
      * PANTALLA                          COLPLA
      * INP/OUT                           DATACOM
      * TAMANO COMMAREA                   250

      *<<<< CMT_ID
      ****************************************************************
      * MANTENCION : CORRECCION MONTO COMISION
      * RESPONSABLE: AFRI-ALD
      * ETIQUETA   : *AFRI-INI 16-ABR-2012 CORRECCION COMISION
      * OBJETIVO   : ARREGLAR MONTO DE COMISION PARA CURSE DE CREDITOS
      *              FOGAPE
      ****************************************************************
      * PROYECTO : BACKVALUE - CURSES RETROACTIVOS
      * OBJETIVO : DESCUENTA INTERESES PARA DIFERENCIA FECHAS(LIQ - ACT)
      *            EN PRIMER VENCIMIENTO
      * RESPONSABLE : CIMA-OGB
      * ETIQUETA : OGB-INI 01-JUL-2016 BACKVALUE
      *----------------------------------------------------------------*
      * PROYECTO : BACKVALUE - UF Y TASA VARIABLE
      * NUB      : 53614
      * OBJETIVO : PERMITIR CORRECCION DE BACKVALUE PARA UF Y TASA VAR
      * RESPONSABLE : CIMA-OGB
      * ETIQUETA : OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *----------------------------------------------------------------*
      * PROYECTO  : HABILITACION CUADROS DE PAGOS COLPLA COLPL1 PARA BEX
      * AUTOR     : AJA
      * FECHA     : 18-ABR-2018
      * OBJETIVO  : INCORPORAR COMISIONES BEX
      * ARCHIVOS  : NA
      * PARAMETROS: NA
      * ETIQUETA  : AJA-INI 18-ABR-2018 INCORPORAR COM BEX - 53882
      *----------------------------------------------------------------*
      * PROYECTO  : CELULA WHOLESALE MICROSERVICIO A01
      * AUTOR     : RRM
      * FECHA     : 07-AGO-2019
      * OBJETIVO  : EDITAR CAMPOS PARA MICROSERVICIO A01
      * ARCHIVOS  : NA
      * PARAMETROS: NA
      * ETIQUETA  : RRM-INI AGO-2019 MICROSERVICIO A01
      *----------------------------------------------------------------*
      *>>>>

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.
       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
      * COPY GNSWGSCR.
       COPY GNSWGCVT.
       77  WSS-TAG-COLPQPLA-INI PIC X(125) VALUE                        
           '<IDNPGM NOM=$COLPQPLA$ SKL=$19.04.15$ VSN=${vsnpq}$        
      -    'GEN=$28-Aug-19 09:02 AM$ FNC=${fncpq}$/>'.    

       COPY GNSWCSCR.
      *PTC-INI
      *PTC-SUB
      * COPY GNSWVSCR.
       COPY GNSWV3CR.
      *PTC-FIN
      *<<<< MI_COMMAREA
           03 SCR-FRM-OPE                   PIC X(01).
           03 SCR-NUM-PANT                  PIC 9(02).
           03 CNE-ITR-COD-TINT              PIC X(12).
           03 SCR-PLA-FLD                   PIC X(1761).
           03 SCR-GLS-VEXP                  PIC X(10).
           03 SCR-VAL-CRED-ALF              PIC X(15).
           03 SCR-VAL-INTE-ALF              PIC X(14).
           03 SCR-VAL-VCOM-ALF              PIC X(15).
           03 SCR-VAL-GAST-ALF              PIC X(15).
           03 SCR-VAL-IMPU-ALF              PIC X(14).
           03 SCR-GLS-TINT                  PIC X(25).
           03 SCR-MSC-FCAN                  PIC X(01).
           03 SCR-MSC-ECAN                  PIC X(01).
           03 SCR-SGV-INTN                  PIC S9(11)V9(04).

      *>>>>
       COPY COLWIPLA.

       COPY COLBROPC.


       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSWGFRM.
       COPY GNSWG3CF.
       COPY GNSWGTSK.
       COPY GNSWGQUE.
      *PTC-FIN
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGSYS.

      *<<<< WSS
       01 WSS-DEBUG.
          03 WSS-DEBUG-1   VALUE ZEROES  PIC 9(11)V9(04).
          03 WSS-DEBUG-2   VALUE SPACES  PIC X(40).
      ***************************************************************
       01  CAN-FLD.
           03  CAN-CAI-IOPC                            PIC X(04).
           03  CAN-IIC-IOPC                            PIC X(08).
           03  CAN-NUM-ICAN                            PIC 9(03).
           03  CAN-COD-OFCA                            PIC X(03).
           03  CAN-FEC-FCAN                            PIC X(08).
           03  CAN-SGV-TPAG                            PIC 9(11)V9(04).
           03  CAN-SGV-TREN                            PIC 9(11)V9(04).
           03  CAN-SGV-COMI                            PIC S9(11)V9(04).
           03  COM-SGV-TINT                            PIC S9(03)V9(04).
           03  DBC-NUM-ICLI                            PIC X(08).
      *AJA-INI 18-ABR-2018 INCORPORAR COM BEX - 53882
           03  CAN-NUM-PLCO                            PIC 9(06).
      *AJA-FIN 18-ABR-2018 INCORPORAR COM BEX - 53882

       01  DATOS-PVG.
           03 PVG-VALOR     PIC S9(11)V9(04).
           03 PVG-VALOR-ALF PIC X(20).
           03 PVG-VALOR-EDT REDEFINES
              PVG-VALOR-ALF PIC ---.---.---.---,----.
           03 PVG-NUM      PIC 9(03).
           03 PVG-COLA.
              05 PVG-GLOSA  PIC X(20).
              05 PVG-SEGURO PIC X(06).
              05 PVG-VAL-Q  PIC X(20).
              05 PVG-FILLER VALUE SPACES PIC X(01).
              05 PVG-CUOTA  PIC 9(03).
      ***************************************************************
      *******
       01  WSS-INI-DSP    VALUE 'INI-DSP' PIC X(07).
       01  WSS-MSG-DSP    VALUE SPACES    PIC X(20).
       01  WSS-FIN-DSP    VALUE 'FIN-DSP' PIC X(07).
       COPY COLMXW05.
       COPY GNSBRMSC.
       COPY GNSWGPES.
       COPY COLWGINT.
       COPY COLWGVEN.
DSP   *COPY COLWGSDP.
      *<<<< WSS_IBM
       COPY COLBRCOM.
       COPY SGCBRDBC.
       COPY COLBRVEN.
       COPY COLBRCCT.
       COPY COLBRDLC.
       COPY COLBRRDC.
       COPY COLBREVC.
       COPY COLBRICG.
       COPY COLBRITR.
       COPY COLBRRCV.
      *OGB-INI 01-JUL-2016 BACKVALUE
       COPY COLBROIA.
      *OGB-FIN 01-JUL-2016 BACKVALUE

       COPY TABBRCAM.
       COPY TABBROFI.
       COPY COLBRTOC.
       COPY COLBRPCP.
       COPY COLWGPCP.
       COPY COLBRCXA.
       COPY COLBRRCC.
       COPY TABWGRCC.

       COPY COLWGCXE.

      *AFRI-INI/FEB-2015/PLATAFORMA UNICA
       COPY COLBRVEI.
       COPY COLWGVEI.
      *AFRI-FIN/FEB-2015/PLATAFORMA UNICA

       COPY COLWGUVD.
       COPY TABWGSGS.
       COPY TABBRROC.
       COPY TABBRSGS.
       COPY COLBRCXE.
       COPY SGCBRDCP.
       COPY COLBRPVC.
       COPY GNSWGCPT.
       COPY GNSWGSTR.
       01   PLC-VARI.
             03 PLC-IND-COB                                PIC X(01).
             03 PLC-OPEC                                   PIC X(01).
             03 PLC-CIC-TVAL                               PIC X(01).
             03 PLC-VAL-SCRE                         PIC S9(11)V9(4).
             03 PLC-VAL-SCR2                         PIC S9(10)V9(2).
             03 PLC-IFLD                                   PIC 9(08).
             03 PLC-GLS-NOCO                               PIC X(10).
             03 PLC-VAL-SGAR                         PIC S9(11)V9(4).
             03 PLC-VAL-SCOR                         PIC S9(11)V9(4).
             03 PLC-SGV-PLZO                               PIC 9(08).
             03 PLC-VAL-SPLZ                         PIC S9(11)V9(4).
             03 PLC-BAS-FGPE                               PIC 9(08).
             03 PLC-VAL-COMI                         PIC S9(11)V9(4).
             03 PLC-VAL-MNTO                         PIC S9(11)V9(4).
             03 PLC-FEC-FUN.
               05 PLC-NUM-DUN                              PIC 9(02).
               05 PLC-NUM-MUN                              PIC 9(02).
               05 PLC-NUM-SUN                              PIC 9(02).
               05 PLC-NUM-AUN                              PIC 9(02).
             03 PLC-FEC-FDO.
               05 PLC-NUM-DDO                              PIC 9(02).
               05 PLC-NUM-MDO                              PIC 9(02).
               05 PLC-NUM-SDO                              PIC 9(02).
               05 PLC-NUM-ADO                              PIC 9(02).
            03 PLC-FEC-FCAN.
              05 PLC-NUM-SCAN                 VALUE ZEROES PIC 9(02).
              05 PLC-NUM-ACAN                 VALUE ZEROES PIC 9(02).
              05 PLC-NUM-MCAN                 VALUE ZEROES PIC 9(02).
              05 PLC-NUM-DCAN                 VALUE ZEROES PIC 9(02).
            03 PLC-CXE-FVEN.
              05 PLC-CXE-SVEN                 VALUE ZEROES PIC 9(02).
              05 PLC-CXE-AVEN                 VALUE ZEROES PIC 9(02).
              05 PLC-CXE-MVEN                 VALUE ZEROES PIC 9(02).
              05 PLC-CXE-DVEN                 VALUE ZEROES PIC 9(02).
       01   WSS-VARI.
            03  WSS-CAM-SGV-VCAM                   PIC S9(06)V9(09).
            03  WSS-GLS-COCR.
                05 WSS-GLS-TOCR                          PIC X(05).
                05 WSS-GLS-FILL             VALUE SPACES PIC X(01).
                05 WSS-GLS-AOCR                          PIC X(05).
            03  WSS-VAL-TPES                             PIC 9(11).
            03  WSS-CON-VEN                              PIC 9(04).
            03  WSS-GLS-NULL                             PIC X(30).
            03  WSS-IND-VCCR                VALUE SPACES PIC X(02).
                 88  MONEDA-NO-VIGENTE      VALUE 'N '.
                 88  MONEDA-NO-EXISTENTE    VALUE ' X'.
                 88  MONEDA-NEX-NVG         VALUE 'NX'.
            03  WSS-IND-VCCR-RED REDEFINES WSS-IND-VCCR.
                 05  WSS-IND-NVIG                        PIC X(01).
                 05  WSS-IND-NEXI                        PIC X(01).
            03  WSS-I                                    PIC 9(04).
            03  WSS-IMAX                    VALUE 4      PIC 9(04).
            03  WSS-IVEN-MAS1               VALUE 0      PIC 9(03).
            03  WSS-NITM                    VALUE 0      PIC 9(03).
            03  WSS-FEC-FVNA.
                05 WSS-NUM-SVNA                          PIC 9(02).
                05 WSS-NUM-AVNA                          PIC 9(02).
                05 WSS-NUM-MVNA                          PIC 9(02).
                05 WSS-NUM-DVNA                          PIC 9(02).
            03  WSS-FEC-FVEN.
                05 WSS-NUM-SVEN                          PIC 9(02).
                05 WSS-NUM-AVEN                          PIC 9(02).
                05 WSS-NUM-MVEN                          PIC 9(02).
                05 WSS-NUM-DVEN                          PIC 9(02).
            03  WSS-NUM-IVCT       VALUE ZEROES          PIC 9(03).
            03  WSS-VAL-CAPI       VALUE ZEROES    PIC 9(11)V9(04).
            03  WSS-CIC-SEGD       VALUE SPACES          PIC X(12).
            03  WSS-CIC-LET                              PIC X(12).
                88  ES-LETRA                VALUE 'LTR'.
           03  WSS-VAL-COMI                            PIC S9(11)V9(4).
           03  WSS-SGV-CACU     VALUE ZEROES           PIC S9(11)V9(4).
           03  WSS-VAL-SMO7                            PIC S9(11)V9(4).
           03  WSS-VAL-SMO8                            PIC S9(11)V9(4).
           03  WSS-VAL-SMO9                            PIC S9(11)V9(4).
           03  WSS-VAL-SM10                            PIC S9(11)V9(4).
           03  WSS-VAL-SVEN                            PIC S9(11)V9(4).
           03  WSS-OPEC         VALUE SPACES           PIC X(01).
      *AJA-INI 18-ABR-2018 INCORPORAR COM BEX - 53882
           03  WSS-VAL-VCAM     VALUE 0 COMP-3       PIC S9(11)V9(04).
           03  WSS-IND-FLAG           VALUE 0          PIC 9(01).
           03  WSS-IBLK-COMI                           PIC X(01).
           03  WCC-1            VALUE 1                PIC 9(01).
           03  WCC-2            VALUE 2                PIC 9(01).
           03  WCC-3            VALUE 3                PIC 9(01).
           03  WCC-4            VALUE 4                PIC 9(01).
           03  WCC-5            VALUE 5                PIC 9(01).
           03  WCC-7            VALUE 7                PIC 9(01).
           03  WCC-B            VALUE 'B'              PIC X(01).
           03  WCC-T            VALUE 'T'              PIC X(01).
           03  WCC-E            VALUE 'E'              PIC X(01).
           03  WCC-001          VALUE '001'            PIC X(03).
           03  WCC-23           VALUE '23'             PIC X(02).
           03  WCC-FLV          VALUE 'FLV'            PIC X(03).
           03  WCC-COM-KEY      VALUE 'COM-KEY-IICG'   PIC X(12).
      *AJA-FIN 18-ABR-2018 INCORPORAR COM BEX - 53882
      *OGB-INI 01-JUL-2016 BACKVALUE
           03  WSS-COD-PESO                       PIC X(06).
           03  WSS-IND-DESC-INT    VALUE SPACES   PIC X(01).
           03  WSS-IND-TAUT        VALUE SPACES   PIC X(03).
           03  WSS-SGV-VINT        VALUE ZEROES   PIC S9(11)V9(4).
           03  WSS-VAL-INT1        VALUE ZEROES   PIC S9(11)V9(4).
           03  WSS-GLS-PLZBV.
               05 WSS-NUM-PMIN                    PIC 9(03).
               05 FILLER                          PIC X(02).
               05 WSS-NUM-PMAX                    PIC 9(03).
           03  WSS-GLS-MTOBV.
               05 WSS-NUM-MMNM                    PIC 9(11).
               05 FILLER                          PIC X(09).
               05 WSS-NUM-MMAX                    PIC 9(11).
      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           03  WSS-NUM-NDIA           VALUE ZEROES    PIC 9(05).
           03  WSS-IND-NPER           VALUE SPACES    PIC X(01).
           03  WSS-NUM-NPER           VALUE ZEROES    PIC 9(05).

           03  WSS-DIF-DVEN           VALUE ZEROES    PIC 9(04).
           03  WSS-DIF-DICG           VALUE ZEROES    PIC 9(04).
           03  WSS-BCK-AUX-CBV.
               05 WSS-BCK-IND-MTO                     PIC X(01).
               05 WSS-BCK-IND-PZO                     PIC X(01).
               05 FILLER                              PIC X(01).
               05 WSS-BCK-COD-VCMT                    PIC X(06).
               05 WSS-BCK-SGV-MMIN                    PIC 9(11)V9(4).
               05 FILLER                              PIC X(01).
               05 WSS-BCK-SGV-MMAX                    PIC 9(11)V9(4).
               05 FILLER                              PIC X(04).
               05 WSS-BCK-NUM-PMIN                    PIC 9(05).
               05 FILLER                              PIC X(01).
               05 WSS-BCK-IND-PMIN                    PIC X(01).
               05 FILLER                              PIC X(02).
               05 WSS-BCK-NUM-PMAX                    PIC 9(05).
               05 FILLER                              PIC X(01).
               05 WSS-BCK-IND-PMAX                    PIC X(01).

           03  WSS-COD-MTBV.
               05 WSS-COD-MTOBV   VALUE 'MTOBV'       PIC X(05).
               05 WSS-COD-MNDBV                       PIC X(06).
               05 FILLER          VALUE SPACES        PIC X(01).

           03  WSS-GLS-LMMT.
               05 WSS-SGV-LMMT-MMIN                   PIC 9(11)V9(4).
               05 FILLER                              PIC X(05).
               05 WSS-SGV-LMMT-MMAX                   PIC 9(11)V9(4).

           03  WSS-GLS-VAL-AUX              PIC  ZZ.ZZZ.ZZZ.ZZ9,9999.

      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           03  WSS-CT-1       VALUE 1             PIC 9(01).
           03  WSS-CT-N       VALUE 'N'           PIC X(01).
           03  WSS-CT-S       VALUE 'S'           PIC X(01).
           03  WSS-CT-A       VALUE 'A'           PIC X(01).
           03  WSS-CT-L       VALUE 'L'           PIC X(01).
           03  WSS-CT-COL     VALUE 'COL'         PIC X(03).
           03  WSS-CT-TAB     VALUE 'TAB'         PIC X(03).
           03  WSS-CT-VSN     VALUE 'VSN'         PIC X(03).
           03  WSS-CT-VLR     VALUE 'VLR'         PIC X(03).
           03  WSS-CT-ABV     VALUE 'ABV'         PIC X(03).
           03  WSS-CT-CBV     VALUE 'CBV'         PIC X(03).
           03  WSS-CT-DIN     VALUE 'DIN'         PIC X(03).
           03  WSS-CT-CIN     VALUE 'CIN'         PIC X(03).
           03  WSS-CT-PRO     VALUE 'PRO'         PIC X(03).
           03  WSS-CT-REN     VALUE 'REN'         PIC X(03).
           03  WSS-CT-INT     VALUE 'INT'         PIC X(03).
           03  WSS-CT-0999    VALUE '0999'        PIC X(04).
           03  WSS-CT-TABAKEY VALUE 'TAB-CIC-TABL' PIC X(12).
           03  WSS-CT-CICPESO VALUE 'CICPESONEX  ' PIC X(12).
           03  WSS-CT-NDIABV  VALUE 'NDIA > PMAX ' PIC X(12).
           03  WSS-CT-NODLC   VALUE 'OPC  NODLC  ' PIC X(12).
           03  WSS-CT-PVINX   VALUE 'VEN    PVINX' PIC X(12).
           03  WSS-CT-DESINT  VALUE 'DESCINT>MMAX' PIC X(12).
           03  WSS-CT-DIN1VN  VALUE 'DINT>INT1VEN' PIC X(12).
      *OGB-FIN 01-JUL-2016 BACKVALUE
      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           03  WSS-CT-CAMNEX  VALUE 'CAM    NEX'   PIC X(10).
           03  WSS-CT-2       VALUE 2             PIC 9(01).
           03  WSS-CT-D       VALUE 'D'           PIC X(01).
           03  WSS-CT-M       VALUE 'M'           PIC X(01).
           03  WSS-CT-C       VALUE 'C'           PIC X(01).
           03  WSS-CT-1PT0    VALUE '1.0'         PIC X(03).
           03  WSS-CT-VEN     VALUE 'VEN'         PIC X(03).
           03  WSS-CT-BCK     VALUE 'BCK'         PIC X(03).
           03  WSS-CT-ANT     VALUE 'ANT'         PIC X(03).
           03  WSS-CT-DES     VALUE 'DES'         PIC X(03).
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *RRM-INI AGO-2019 MICROSERVICIO A01
           03 WSS-COD-TXP.
              05 WSS-COD-TPLA VALUE 'TXPLA'       PIC X(05).
              05 WSS-COD-NTRN VALUE SPACES        PIC X(04).
              05 WSS-COD-REST VALUE SPACES        PIC X(03).

       01  WSS-CTE.
           03 WNN-1           VALUE 1             PIC 9(01).
           03 WNN-2           VALUE 2             PIC 9(01).
           03 WNN-3           VALUE 3             PIC 9(01).
           03 WNN-4           VALUE 4             PIC 9(01).
      *RRM-INI AGO-2019 MICROSERVICIO A01

       COPY COLWGPLA.
      *<<<< WSS_DTC
       COPY LDCBRLCC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LCC-REQA==.
       COPY LDCBRRLO.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RLO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CCT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PIP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VLR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PCP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-SGS-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CXE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CXA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCC-REQA==.
      *OGB-INI 01-JUL-2016 BACKVALUE
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OIA-REQA==.
      *OGB-FIN 01-JUL-2016 BACKVALUE
      *AJA-INI 18-ABR-2018 INCORPORAR COM BEX - 53882
       COPY COLBRCAN.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.
       COPY SGCBRDCE.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCE-REQA==.
       COPY COLBRDIC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DIC-REQA==.
       COPY COLRWC1V.
       COPY COLRWCDP.
      *AJA-FIN 18-ABR-2018 INCORPORAR COM BEX - 53882
      *>>>>
       01  PGM-VARI.
           03 PGM-ICLR                  VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-TODO          VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-LLAVES        VALUE 'K'       PIC X(01).
           03 PGM-LIMPIAR-CAMPOS        VALUE 'F'       PIC X(01).
           03 PGM-NO-LIMPIAR-NADA       VALUE 'N'       PIC X(01).
           03 PGM-PROG                                  PIC X(08).
           03 PGM-NTRN                                  PIC X(04).
           03 PGM-STAT.
              05 PGM-STAT-OPC.
                 88 PGM-STAT-OPC-NUL    VALUE '  '.
                 07 PGM-STT1-OPC        VALUE '2' PIC X(01).
                    88 PGM-STAT-OPC-OKS VALUE '0'.
                 07 PGM-STT2-OPC        VALUE '3' PIC X(01).
              05 PGM-STAT-DBC.
                 88 PGM-STAT-DBC-NUL    VALUE '  '.
                 07 PGM-STT1-DBC        VALUE '2' PIC X(01).
                    88 PGM-STAT-DBC-OKS VALUE '0'.
                 07 PGM-STT2-DBC        VALUE '3' PIC X(01).
              05 PGM-STAT-ITR.
                 88 PGM-STAT-ITR-NUL    VALUE '  '.
                 07 PGM-STT1-ITR        VALUE '2' PIC X(01).
                    88 PGM-STAT-ITR-OKS VALUE '0'.
                 07 PGM-STT2-ITR        VALUE '3' PIC X(01).
           03 PGM-SRNF                  VALUE '23'      PIC X(02).
           03 PGM-SOKS                  VALUE '00'      PIC X(02).
           03 PGM-SNUL                  VALUE '  '      PIC X(02).
           03 PGM-SUAR                  VALUE SPACES    PIC X(15).
           03 PGM-CMMA.
              05 PGM-CMMA-CHR OCCURS 1869 PIC X(01).
       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 DFH-CMMA OCCURS 1869 PIC X(01).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
       LUP-MAIN.
           IF SCR-INST = SCR-INST-HCM
                 PERFORM SCR-COM.
           IF SCR-CCPP = 'ACC'
                 PERFORM SCR-ACC
           ELSE
                 MOVE SCR-INST-HCM TO SCR-INST.
           GO TO LUP-MAIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
       COPY GNSBGEIB.
       COPY GNSBGEDB.
           MOVE LOW-VALUES TO PLA-FLD.
           MOVE LOW-VALUES TO PLA-EDT.
      *<<<< PGM_POS_EDB
           MOVE LOW-VALUES TO PLA-STP.
      *>>>>
           PERFORM GNS-PRO-RCK.
           PERFORM GNS-BUS-VCA.
           MOVE +1869 TO SCR-TCMA.
           PERFORM GNS-HDL-SYS.
           PERFORM GNS-HDL-FRM.
           MOVE 'COLPQPLA' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      *PTC-INI
           PERFORM GNS-ERR-QUE.
           PERFORM GET-TSK-TERM.
      *PTC-FIN
      *<<<< INI_FIO
           MOVE +1900 TO SCR-TCMA.
           PERFORM GNS-ERR-QUE.
           PERFORM GET-TSK-TERM.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE SPACES TO FRM-MENS.
           MOVE SPACES TO PLA-GLS-MENS IN PLA-FLD.
           IF SCR-OFRM-SRV
               MOVE TSK-TERM-ALF TO WSS-PLA-TERM-ALF
               MOVE WSS-PLA-TERM-ALF TO PLA-COD-TERM
               MOVE WSS-PLA-TERM-ALF TO PLA-COD-TERM-MAS
           ELSE
               MOVE EIBTRMID     TO WSS-PLA-TERM-ALF
               MOVE WSS-PLA-TERM-ALF TO PLA-COD-TERM
               MOVE WSS-PLA-TERM-ALF TO PLA-COD-TERM-MAS.

           PERFORM GNS-ERR-QUE.
      *>>>>
       FIN-INI.
           EXIT.

       COPY GNSBHSYS.
       COPY GNSBHFRM.
       COPY GNSBPRCK.
       GNS-BUS-VCA SECTION.
       INI-GNS-BUS-VCA.
           MOVE 0 TO FRM-IFLD.
       LUP-GNS-BUS-VCA.
           ADD 1 TO FRM-IFLD.
           IF FRM-IFLD NOT > EIBCALEN AND
              FRM-IFLD NOT > 1869
                MOVE DFH-CMMA(FRM-IFLD) TO PGM-CMMA-CHR(FRM-IFLD)
                GO TO LUP-GNS-BUS-VCA.
           MOVE PGM-CMMA TO SCR-VARI.
       FIN-GNS-BUS-VCA.
           EXIT.
       COPY GNSBBIDD.

       SCR-COM SECTION.
       INI-SCR-COM.
      *<<<< INI_SCR_COM
           MOVE WSS-PLA-TERM-ALF TO QUE-TERM
           MOVE 'PLAM'   TO QUE-TYPE.
           MOVE QUE-DEL  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           MOVE WSS-PLA-TERM-ALF TO QUE-TERM
           MOVE 'GPLA'   TO QUE-TYPE.
           MOVE QUE-DEL  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
      *>>>>
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-PLA.
           PERFORM EDT-KEY-PLA.
           PERFORM EDT-FLD-PLA.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-HCM TO SCR-INST.
           MOVE SCR-CMNP     TO SYS-PROG.
           MOVE SCR-VARI     TO SYS-CMMA.
           MOVE SCR-TCMA     TO SYS-TCMA.
           MOVE SYS-XCTL     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       XCT-ERR.
           MOVE 'XCTERR    ' TO MSG-COD-MENS.
           MOVE 'GNS'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO SYS-MEN1.
           MOVE SYS-PROG     TO SYS-MEN2.
           MOVE SYS-ABOR     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       COPY GNSBGGBK.
       FIN-SCR-COM.
           EXIT.



       SCR-ACC SECTION.
       INI-SCR-ACC.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ACC
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-ACC.
           PERFORM DESSCRTRL.
      *<<<< PFS_SCR_ACC
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6
               PERFORM VAL-NUM-KEY-PLA
               PERFORM VAL-NUM-FLD-PLA
               PERFORM SCRL-TAB-PLA
               PERFORM SCR-TRL.
      *>>>>
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ACC.
           EXIT.

       BRW-SCR-ACC SECTION.
       INI-BRW-SCR-ACC.
       FIN-BRW-SCR-ACC.
           EXIT.




       SCR-DMSG SECTION.
       INI-SCR-DMSG.
           IF PGM-ICLR = PGM-NO-LIMPIAR-NADA
               NEXT SENTENCE
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-TODO
               PERFORM SCR-CLRA-PLA
               PERFORM EDT-KEY-PLA
               PERFORM EDT-FLD-PLA
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-LLAVES
               PERFORM CLR-KEY-PLA
               PERFORM EDT-KEY-PLA
           ELSE
               PERFORM CLR-FLD-PLA
               PERFORM EDT-FLD-PLA.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-DMSG.
           EXIT.

       SCR-KEY SECTION.
       INI-SCR-KEY.
           PERFORM SCR-RST.
           PERFORM GET-KEY.
           IF FRM-STAT-ABT
                   MOVE SPACES TO FRM-MENS
                   PERFORM SCR-MSSG
                   GO TO FIN-SCR-KEY.
       FND-SCR-KEY.
           MOVE SPACES TO FRM-MENS.
           PERFORM FND-KEY.
           IF FIO-STAT-OKS
               PERFORM PUT-SCR
               MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
               GO TO FIN-SCR-KEY.
      *JSS ELSE
      *        PERFORM CLR-FLD-PLA.
       ERR-SCR-KEY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR.
           IF FRM-MENS NOT > SPACES
               IF FIO-STAT-EOF
                   MOVE 'REGEOF    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
               IF FIO-STAT = FIO-STAT-NEX
                   MOVE 'REGNEX    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
           MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-SCR-KEY.
           EXIT.

       SCR-RST SECTION.
       INI-SCR-RST.
           MOVE SPACES       TO PGM-ICLR.
           MOVE SPACES       TO SCR-ACTU.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
           MOVE LOW-VALUES   TO PLA-FLD.
           MOVE LOW-VALUES TO PLA-EDT.
      *<<<< SCR_RST
           MOVE LOW-VALUES TO PLA-STP.
      *>>>>
       FIN-SCR-RST.
           EXIT.

       GET-KEY SECTION.
       INI-GET-KEY.
           PERFORM SCR-GKEY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-KEY.
           EXIT.

       GET-IKY SECTION.
       INI-GET-IKY.
           PERFORM SCR-GIKY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-IKY.
           EXIT.

       FND-KEY SECTION.
       INI-FND-KEY.
           PERFORM KEY-ALL-PLA.
      *<<<< FND_KEY
       LUP-OPC.
      *>>>>
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF FIO-STAT-OKS
               MOVE OPC-STP-ITRN IN OPC TO SCR-UMOD.
           MOVE FIO-STAT TO PGM-STAT-OPC.
      *<<<< FIN_FND_KEY
           IF NOT FIO-STAT-OKS
               MOVE 'OPCIDLCNORDC' TO MSG-COD-MENS IN MSG
               GO TO MSG-FND-KEY.

      *AFRI-INI/FEB-2015/PLATAFORMA UNICA
           IF SCR-CMND = 'IFR'
              IF NOT OPC-ACTIVADA
                 MOVE 'IFRCMNDINVAL' TO MSG-COD-MENS IN MSG
                 GO TO MSG-FND-KEY.
      *AFRI-FIN/FEB-2015/PLATAFORMA UNICA

      *AFRI-INI 16-ABR-2012 CORRECCION COMISION
      *    IF OPC-LIQUIDADA OR OPC-ACTIVADA
           IF OPC-LIQUIDADA OR OPC-ACTIVADA OR OPC-MSC-STAT IN OPC = 'O'
      *AFRI-FIN 16-ABR-2012 CORRECCION COMISION
              NEXT SENTENCE
           ELSE
               MOVE 'S' TO SCR-IERR
               MOVE 'OPCSTATINVAL' TO MSG-COD-MENS IN MSG
               GO TO MSG-FND-KEY.

      *AFRI-INI/FEB-2015/PLATAFORMA UNICA
           IF SCR-CMND = 'IFR'
              PERFORM PRE-IFR
              IF MSG-COD-MENS > SPACES
                 GO TO MSG-FND-KEY
              ELSE
                 GO TO IFR-FND-KEY.
      *AFRI-FIN/FEB-2015/PLATAFORMA UNICA

           MOVE OPC-CIC-IOPC IN OPC TO ITR-CIC-IOPC IN ITR.
           MOVE ZEROES              TO ITR-NUM-ICAN IN ITR.
           MOVE SPACES              TO ITR-CIC-IOPV IN ITR.
           MOVE ZEROES              TO ITR-NUM-IVCT IN ITR.
           MOVE 'INT'               TO ITR-IND-TTAS IN ITR.
           MOVE ZEROES              TO ITR-FEC-FINI IN ITR.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ITR.
           IF FIO-STAT-OKS AND
              ITR-CIC-IOPC IN ITR = OPC-CIC-IOPC IN OPC AND
              ITR-NUM-ICAN IN ITR = ZEROES              AND
              ITR-CIC-IOPV IN ITR = SPACES              AND
              ITR-NUM-IVCT IN ITR = ZEROES              AND
              ITR-IND-TTAS IN ITR = 'INT'
               IF ITR-COD-CVTI IN ITR > SPACES
                   MOVE ITR-SGV-SPRD IN ITR TO ITR-SGV-TINT IN ITR
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE '23' TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-ITR.
           IF FIO-STAT-OKS AND ITR-COD-CVTI IN ITR > SPACES
               MOVE 'I'                 TO CAM-MSC-TVAL IN CAM(1)
               MOVE ITR-COD-CVTI IN ITR TO CAM-COD-CVAL IN CAM(1)
               MOVE ITR-MSC-PBTI IN ITR TO CAM-COD-TCAM IN CAM(1)
               MOVE OPC-FEC-FCOL IN OPC  TO CAM-FEC-FCAM IN CAM(1)
               MOVE OPC-FEC-FCOL IN OPC  TO CAM-FEC-FCAM IN CAM(2)
               MOVE OPC-COD-VCOC IN OPC  TO CAM-COD-VCAM IN CAM(2)
               MOVE FIO-GET-KEY          TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF FIO-STAT-OKS
                   ADD CAM-SGV-VCAM IN CAM TO ITR-SGV-TINT IN ITR.

      *AFRI-INI/FEB-2015/PLATAFORMA UNICA
       IFR-FND-KEY.
      *AFRI-FIN/FEB-2015/PLATAFORMA UNICA

           MOVE OPC-CAI-IOPC IN OPC     TO RDC-CAI-IOPC IN RDC.
           MOVE OPC-IIC-IOPC IN OPC     TO RDC-IIC-IOPC IN RDC.
           MOVE ZEROES                  TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF FIO-STAT-OKS AND
              (OPC-CAI-IOPC IN OPC = RDC-CAI-IOPC IN RDC) AND
              (OPC-IIC-IOPC IN OPC = RDC-IIC-IOPC IN RDC) AND
              (RDC-NUM-IDLC IN RDC = ZEROES)
               NEXT SENTENCE
           ELSE
               MOVE '23' TO FIO-STAT.
           IF FIO-STAT-OKS AND
              (OPC-CAI-IOPC IN OPC = RDC-CAI-IOPC IN RDC) AND
              (OPC-IIC-IOPC IN OPC = RDC-IIC-IOPC IN RDC) AND
              (RDC-NUM-IDLC IN RDC = ZEROES)
              MOVE RDC-CIC-ICLI IN RDC  TO DBC-CIC-ICLI IN DBC
              MOVE FIO-GET-KEY          TO FIO-CMND
              PERFORM SGC-FIO-DBC
              IF FIO-STAT-OKS
                  NEXT SENTENCE
              ELSE
                  MOVE 'CLI    NEX' TO MSG-COD-MENS
                  GO TO MSG-FND-KEY
           ELSE
               MOVE 'CLI    NODIR' TO MSG-COD-MENS
               GO TO MSG-FND-KEY.
           PERFORM BUS-CIC-OPEC.
           PERFORM BUS-CIC-SEGD.
           PERFORM LEE-DLC.
           IF MSG-COD-MENS > SPACES
                GO TO MSG-FND-KEY.

           IF SCR-CMND = 'CSM'
              PERFORM BUS-EVC-VA
              IF MSG-COD-MENS > SPACES
                 GO TO MSG-FND-KEY
              ELSE
                 PERFORM CRE-SIN-MORA
                 IF MSG-COD-MENS > SPACES
                    GO TO MSG-FND-KEY.

           PERFORM PUT-PLA.
      *AJA-INI 18-ABR-2018 INCORPORAR COM BEX - 53882                   BEX
           PERFORM BUS-DAT-COM.
      *AJA-FIN 18-ABR-2018 INCORPORAR COM BEX - 53882
           PERFORM PLC-DET-CCF.
           PERFORM DET-PLC-SCRE.

           IF SCR-CMND = 'ENO'
              GO TO CONT-FND-KEY.

           MOVE ZEROES  TO PLA-TOT-ITDC.
      *AFRI-INI/FEB-2015/PLATAFORMA UNICA
      *    IF SCR-CMND NOT = 'CSM'
      *       PERFORM PUT-TAB
      *    ELSE
      *        PERFORM PUT-SIN-MORA.
           IF SCR-CMND = 'CSM'
               PERFORM PUT-SIN-MORA
           ELSE
           IF SCR-CMND = 'IFR'
              PERFORM PUT-IFR
           ELSE
              PERFORM PUT-TAB.
      *AFRI-FIN/FEB-2015/PLATAFORMA UNICA

       CONT-FND-KEY.

           MOVE '00' TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-OPC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
           MOVE SCR-STAT-CON TO SCR-STAT.
           GO TO FIN-FND-KEY.
      *----------------------------------------------------------
       MSG-FND-KEY.
           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE '00' TO FIO-STAT.
           MOVE SCR-STAT-CON TO SCR-STAT.
           GO TO FIN-FND-KEY.
      *>>>>
       FIN-FND-KEY.
           IF FIO-STAT = FIO-STAT-NEX
               MOVE 'S' TO SCR-IERR.
       EXT-FND-KEY.
           EXIT.
 
       PUT-SCR SECTION.
       INI-PUT-SCR.
           IF PGM-STAT-OPC-OKS
               MOVE OPC-STP-ITRN IN OPC TO SCR-UMOD.
           PERFORM PUT-ALL-PLA.
       FIN-PUT-SCR.
           EXIT.

       STP-EXIT SECTION.
       INI-STP-EXIT.
           MOVE SCR-PROG TO PGM-PROG.
           MOVE SCR-NTRN TO PGM-NTRN.

           MOVE SCR-PROV TO SCR-PROG.
           MOVE SCR-NTRV TO SCR-NTRN.

           MOVE PGM-PROG TO SCR-PROV
           MOVE PGM-NTRN TO SCR-NTRV.
       FIN-STP-EXIT.
           EXIT.

       SCR-EXIT SECTION.
       INI-SCR-EXIT.
           MOVE 'P'      TO SCR-ICMN.
           MOVE SCR-NTRN TO SYS-NTRN.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-RTRN TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       FIN-SCR-EXIT.
           EXIT.

       SCR-PUTA SECTION.
       INI-SCR-PUTA.
      *PTC-INI
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE PLA-FLD TO FRM-DFLD.
           MOVE FRM-PUT-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-PUTA.
           EXIT.

       SCR-MSSG SECTION.
       INI-SCR-MSSG.
           IF FRM-MEN1 NOT > SPACES
               MOVE SPACES TO FRM-MEN1.
           IF FRM-MEN2 NOT > SPACES
               MOVE SPACES TO FRM-MEN2.
           MOVE FRM-MENS TO PLA-GLS-MENS.
       FIN-SCR-MSSG.
           EXIT.

       SCR-GKEY SECTION.
       INI-SCR-GKEY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-PLA
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO PLA-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GKEY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-PLA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-PLA
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-PLA.
      *<<<< SCR_GKEY_VAL_IKY
      *PTC-INI:   12-NOV-1996 08:50:01
           IF SCR-OFRM-SRV

              MOVE PTC-OPC-TYPE TO QUE-TYPE
              MOVE WSS-PLA-TERM-ALF TO QUE-TERM
              MOVE PTC-OPC-LENG TO QUE-LITM
              MOVE 1            TO  QUE-NITM
              MOVE QUE-GET      TO QUE-CMND
              PERFORM GNS-PRO-QUE
              IF QUE-STAT = QUE-STAT-OKS
                  MOVE QUE-ITEM TO PTC-OPC-ITEM
                  MOVE PTC-OPC-OPC-CAI-IOPC TO OPC-CAI-IOPC IN PLA-FLD
                  MOVE PTC-OPC-OPC-IIC-IOPC TO OPC-IIC-IOPC IN PLA-FLD.
      *PTC-FIN:   12-NOV-1996 08:50:01
      *>>>>
           PERFORM VAL-IKY-PLA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-MKY-PLA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-AKY-PLA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-CON-KEY-PLA.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GKEY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-PLA.
       ERR-SCR-GKEY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-PLA.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GKEY.
           PERFORM SCR-MSSG.

       SCR-GIKY SECTION.
       INI-SCR-GIKY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-PLA
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO PLA-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GIKY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-PLA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-IKY-PLA
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-PLA.
           PERFORM VAL-IKY-PLA.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GIKY.
           PERFORM VAL-CON-IKY-PLA.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GIKY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-PLA.
       ERR-SCR-GIKY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-IKY-PLA.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GIKY.
           PERFORM SCR-MSSG.

       GET-CON SECTION.
       INI-GET-CON.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
      *<<<< PFS_GET_CON
           IF NOT ( FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6 )
      *>>>>
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO PLA-GLS-MEN2
               MOVE SCR-PRMT     TO PLA-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO PLA-FLD.
       FIN-GET-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.

       CLR-MSG SECTION.
       INI-CLR-MSG.
           MOVE SPACES TO PLA-GLS-MENS.
       FIN-CLR-MSG.
           EXIT.

       HBL-IKY SECTION.
       INI-HBL-IKY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE PLA-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO PLA-FLD
      * FLB  7-NOV-1994
               PERFORM CLR-KEY-PLA

               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO PLA-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO PLA-GLS-MENS.
           PERFORM PRO-MKY-PLA.
           PERFORM PRO-AKY-PLA.
           PERFORM UNP-IKY-PLA.
           PERFORM FST-KEY-PLA.
       FIN-HBL-IKY.
           EXIT.

       HBL-KEY SECTION.
       INI-HBL-KEY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE PLA-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO PLA-FLD
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO PLA-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO PLA-GLS-MENS.
           PERFORM UNP-KEY-PLA.
           PERFORM FST-KEY-PLA.
       FIN-HBL-KEY.
           EXIT.

       HBL-FLD SECTION.
       INI-HBL-FLD.
           PERFORM PRO-IKY-PLA.
           PERFORM PRO-AKY-PLA.
           PERFORM UNP-MKY-PLA.
           PERFORM UNP-FLD-PLA.
           PERFORM FST-FLD-PLA.
       FIN-HBL-FLD.
           EXIT.

       FST-MSG SECTION.
       INI-FST-MSG.
           MOVE -1 TO PLA-GLS-MENS-LEN.
       FIN-FST-MSG.
           EXIT.

       PRO-ALL SECTION.
       INI-PRO-ALL.
           PERFORM PRO-KEY-PLA.
           PERFORM FST-MSG.
       FIN-PRO-ALL.
           EXIT.

       SCR-TRL SECTION.
       INI-SCR-TRL.
      *PTC-INI
           IF SCR-STAT NOT = SCR-STPP
               MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           IF FRM-MEN1 NOT > SPACES
               MOVE SCR-PRMT TO FRM-MEN1.
      *<<<< FIN_SCR_TRL
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM HBL-FLD
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-PLA
               PERFORM EDT-FLD-PLA
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GFL TO SCR-INST
               PERFORM SCR-EXIT.
           IF SCR-STAT = SCR-STAT-SON
               PERFORM PRO-ALL
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-PLA
               PERFORM EDT-FLD-PLA
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GCS TO SCR-INST
               PERFORM SCR-EXIT.
           MOVE SCR-STAT-CON TO SCR-STAT.
           PERFORM PRO-ALL.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-PLA.
      *POR ESTA  INSTRUCCION SE AGREGO ESTE CODIGO ADICIONAL
      *RRM-INI AGO-2019 MICROSERVICIO A01
      *  Las condiciones para editar se obtienen desde tabla VSN:
      *  - 3270 (KQ95) SI debe editar.
      *  - MTI  (K058) NO debe editar (¿?).
      *  - MCS  (KA01) SI debe editar.
      *    IF NOT SCR-OFRM-SRV                                          00012080
           PERFORM LEE-VSN-TXPLA.
           IF FIO-STAT-OKS AND TAB-IND-VIGE = WSS-CT-S
               IF SCR-OFRM-SRV
                   PERFORM INIC-FRM-VAL-IDX
                   PERFORM EDT-FLD-PLA
               ELSE
      *RRM-FIN AGO-2019 MICROSERVICIO A01
           PERFORM EDT-FLD-PLA.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-GAB TO SCR-INST.
           PERFORM SCR-EXIT.
           GO TO FIN-SCR-TRL.
      *>>>>
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM HBL-FLD
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-PLA
               PERFORM EDT-FLD-PLA
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GFL TO SCR-INST
               PERFORM SCR-EXIT.
           IF SCR-STAT = SCR-STAT-SON
               PERFORM PRO-ALL
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-PLA
               PERFORM EDT-FLD-PLA
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GCS TO SCR-INST
               PERFORM SCR-EXIT.
      *ASUME SCR-STAT-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.
      *    MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-PLA.
           PERFORM EDT-FLD-PLA.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-GAB TO SCR-INST.
           PERFORM SCR-EXIT.
       FIN-SCR-TRL.
           EXIT.

       DESSCRTRL SECTION.
       INI-DESSCRTRL.
           MOVE SCR-VFLD-NOT TO SCR-VFLD.
           MOVE FRM-FFLD TO SCR-FFLD.
       FIN-DESSCRTRL.
           IF SCR-FFLD-PF10 OR SCR-FFLD-PF3
                 MOVE SCR-INST-HCM TO SCR-INST
           ELSE
                 MOVE SCR-INST-HKY TO SCR-INST.
       EXT-DESSCRTRL.
           EXIT.

      * PGM-EBR-ALL SECTION.
      * INI-PGM-EBR-ALL.
      *     MOVE 'GNS' TO FIO-SIST.
      *     MOVE FIO-EBR-ALL TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      * FIN-PGM-EBR-ALL.
      *     EXIT.

       COPY COLBQPLA.
       COPY GNSBVNUM.
       COPY COLBFOPC.
       COPY GNSBFMSG.
       COPY GNSBGSYS.
       COPY GNSBGDTC.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSBGFRM.
       COPY GNSBG3CF.
      *PTC-FIN
       COPY GNSBGMSG.
       COPY GNSBEKEY.
       COPY GNSBIABT.
       COPY GNSBFTAB.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
      *PTC-INI
       COPY GNSBGQUE.
       COPY GNSBGTSK.
      *PTC-FIN

      *<<<< EOF
       COPY COLBGSGS.
       COPY COLBGUVD.
       COPY TABBGSGS.
       COPY COLBFCXE.
       COPY TABBFROC.
       COPY TABBFSGS.
       COPY SGCBFDCP.
       COPY GNSBBMSC.
       COPY COLBFPVC.
      *OGB-INI 01-JUL-2016 BACKVALUE
       COPY COLBFOIA.
      *OGB-FIN 01-JUL-2016 BACKVALUE

      *AJA-INI 18-ABR-2018 INCORPORAR COM BEX - 53882
       COPY COLBFCAN.
       COPY COLBFPCP.
       COPY SGCBFDCE.
       COPY COLBFDIC.
      *AJA-FIN 18-ABR-2018 INCORPORAR COM BEX - 53882

       LEE-DLC SECTION.
       INI-LEE-DLC.
           MOVE OPC-CAI-IOPC IN OPC     TO DLC-CAI-IOPC IN DLC.
           MOVE OPC-IIC-IOPC IN OPC     TO DLC-IIC-IOPC IN DLC.
           MOVE ZEROES                  TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT ( FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = DLC-CIC-IOPC IN DLC )
                MOVE 'DLCIDLCNEX' TO MSG-COD-MENS
                GO TO FIN-LEE-DLC.
           MOVE 'TAB' TO FIO-SIST.
           MOVE 'DOC' TO TAB-COD-TTAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           MOVE DLC-COD-TDOC IN DLC TO TAB-COD-CTAB
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE SPACES      TO  TAB-CIC-CTAB
                                    WSS-CIC-LET
           ELSE
               MOVE TAB-CIC-CTAB TO WSS-CIC-LET.
       FIN-LEE-DLC.
           EXIT.
       COPY GNSBFMSC.
       PUT-TAB SECTION.
       INI-PUT-TAB.
           MOVE WSS-PLA-TERM-ALF TO QUE-TERM
           MOVE 'GPLA'   TO QUE-TYPE.
           MOVE QUE-DEL  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           MOVE WSS-PLA-TERM-ALF TO QUE-TERM
           MOVE 'PLAM'   TO QUE-TYPE.
           MOVE QUE-DEL  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           ADD 1 OPC-NUM-IVEN IN OPC GIVING WSS-IVEN-MAS1.
           MOVE 1 TO SCR-NUM-PANT.
           MOVE LOW-VALUES TO PLA-WSS-NUM-IVCT-IDX.
           MOVE LOW-VALUES TO PLB-WSS-NUM-IVCT-IDX.
           MOVE ZEROES TO
                 PLA-WSS-NUM-IVCT
                 PLA-WSS-VAL-IMPC
                 PLA-WSS-VAL-COMC
                 PLA-WSS-VAL-SEGC
                 PLA-WSS-VAL-GASC
                 PLA-WSS-VAL-INTC
                 PLA-WSS-VAL-SCAP
                 PLA-WSS-VAL-TOTA.

           PERFORM GET-FHOY.
           MOVE 1 TO FRM-IFLD.
           IF FRM-NUM-IVEN IN PLA-FLD > ZEROES
               MOVE FRM-NUM-IVEN IN PLA-FLD TO VEN-NUM-IVEN IN VEN
           ELSE
           MOVE ZEROES  TO VEN-NUM-IVEN IN VEN.
           MOVE 1 TO WSS-CON-VEN.
           MOVE OPC-CIC-IOPC TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-NLS  TO FIO-CMND.
       LUP-PUT-TAB.
           IF OPC-IND-VSTR IN OPC = 'N'
              PERFORM COL-FIO-VEN
              IF FIO-STAT-OKS AND
                 OPC-CIC-IOPC = VEN-CIC-IOPC IN VEN
                 PERFORM VAL-DLC-LET
                 IF (DLC-MSC-STAT IN DLC = 'R' OR 'C')
                    NEXT SENTENCE
                 ELSE
                    PERFORM PUT-TAB-PLA
                    PERFORM PUT-PLA-QUE
                    MOVE ZEROES TO PLA-WSS-VAL-COMC
                    ADD 1 TO WSS-CON-VEN
                    ADD 1 TO FRM-IFLD
              ELSE
                    MOVE '00' TO FIO-STAT
                    GO TO FIN-PUT-TAB
           ELSE
              MOVE HOY-DHOY TO VEN-DTBS
              MOVE HOY-MHOY TO VEN-MTBS
              MOVE HOY-SHOY TO VEN-STBS
              MOVE HOY-AHOY TO VEN-ATBS
              MOVE 'S'      TO VEN-KEST
              PERFORM COL-OBT-VEN
              MOVE VEN-STAT TO WSS-DEBUG-2
              PERFORM GNS-ERR-QUE
              IF VEN-STAT-OKS AND
                 OPC-CIC-IOPC = VEN-CIC-IOPC IN VEN
                 PERFORM VAL-DLC-LET
                 IF (DLC-MSC-STAT IN DLC = 'R' OR 'C')
                    NEXT SENTENCE
                 ELSE
                    PERFORM PUT-TAB-PLA
                    PERFORM PUT-PLA-QUE
                    MOVE ZEROES TO PLA-WSS-VAL-COMC
                    ADD 1 TO WSS-CON-VEN
                    ADD 1 TO FRM-IFLD
              ELSE
                    MOVE '00' TO FIO-STAT
                    GO TO FIN-PUT-TAB.
           MOVE FIO-GET-NXT  TO FIO-CMND.
           IF WSS-CON-VEN NOT < WSS-IVEN-MAS1
                MOVE 'N' TO VEN-INIT
                GO TO LUP-PUT-TAB
           ELSE
              GO TO LUP-PUT-TAB.
       FIN-PUT-TAB.
           IF SCR-OFRM-SRV                                              00012080
              PERFORM PUT-PLA-MAS.                                      00012090
           IF WSS-NITM > WSS-IMAX
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'PLAVENDMAS' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.
       EXT-PUT-TAB.
           EXIT.
       PUT-PLA-MAS SECTION.                                             00012120
       INI-PUT-PLA-MAS.                                                 00012130
           MOVE 1                  TO QUE-NITM.                         00012140
           MOVE WSS-PLA-TERM-ALF TO QUE-TERM
           MOVE PLA-LEN-TSPLA-MAS  TO QUE-LITM.                         00012150
           MOVE PLA-NOM-TSPLA-MAS  TO QUE-COLA.                         00012160
           IF PLA-TOT-ITDC > PLA-TOT-IMAX                               00012170
              MOVE 'S'             TO PLA-MAS-IND-HMAS                  00012180
              MOVE PLA-TOT-IMAX    TO PLA-MAS-NUM-TOCC                  00012430
           ELSE                                                         00012190
              MOVE PLA-TOT-ITDC    TO PLA-MAS-NUM-TOCC                  00012430
              MOVE 'N'             TO PLA-MAS-IND-HMAS.                 00012200
           MOVE PLA-MAS-ITEM       TO QUE-ITEM.                         00012220
           MOVE QUE-PUT            TO QUE-CMND.                         00012230
           PERFORM GNS-PRO-QUE.                                         00012240
       FIN-PUT-PLA-MAS.                                                 00012250
           EXIT.
       VAL-DLC-LET SECTION.
       INI-VAL-DLC-LET.
           IF NOT ES-LETRA
                GO TO FIN-VAL-DLC-LET.
           MOVE VEN-CIC-IOPC IN VEN TO DLC-CIC-IOPC IN DLC.
           MOVE VEN-NUM-IDLC IN VEN TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
                  MOVE 'PLADLCNOEXI' TO MSG-COD-MENS
                  GO TO FIN-VAL-DLC-LET.
       FIN-VAL-DLC-LET.
           EXIT.
       SCRL-TAB-PLA SECTION.
       INI-SCRL-TAB-PLA.
           MOVE SPACES TO MSG-COD-MENS.
           IF FRM-FFLD = FRM-FFLD-PF6
               PERFORM PUT-TAB-ASC
           ELSE
               PERFORM PUT-TAB-DSC.
           IF MSG-COD-MENS > SPACES
               MOVE 'COL' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.
       FIN-SCRL-TAB-PLA.
           EXIT.

       PUT-TAB-ASC SECTION.
       INI-PUT-TAB-ASC.
           MOVE SPACES TO MSG-COD-MENS.
           MULTIPLY SCR-NUM-PANT BY WSS-IMAX GIVING QUE-NITM.
           MOVE 0 TO FRM-IFLD.
       LUP-PUT-TAB-ASC.
           ADD 1                 TO QUE-NITM.
           MOVE WSS-PLA-TERM-ALF TO QUE-TERM.
           MOVE 'GPLA'           TO QUE-TYPE.
           MOVE PLA-WSS-LENG     TO QUE-LITM.
           MOVE QUE-GET          TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               IF FRM-IFLD = 0
                   MOVE 'PLAVENNONXT' TO MSG-COD-MENS
                   GO TO FIN-PUT-TAB-ASC
               ELSE
                   GO TO FIN-PUT-TAB-ASC.
           ADD 1 TO FRM-IFLD.
           MOVE QUE-ITEM TO FRM-NUM-IVCT-IDX(FRM-IFLD).
           IF FRM-IFLD < WSS-IMAX
               GO TO LUP-PUT-TAB-ASC.
       FIN-PUT-TAB-ASC.
           IF FRM-IFLD > 0 AND FRM-IFLD < WSS-IMAX
               ADD 1 FRM-IFLD GIVING WSS-I
               PERFORM CLR-FRM VARYING WSS-I FROM WSS-I BY 1
                                 UNTIL WSS-I > WSS-IMAX.
           IF FRM-IFLD > 0
               ADD 1 TO SCR-NUM-PANT.
           IF FRM-IFLD = WSS-IMAX
               ADD 1         TO QUE-NITM

               MOVE WSS-PLA-TERM-ALF TO QUE-TERM
               MOVE 'GPLA'   TO QUE-TYPE
               MOVE PLA-WSS-LENG TO QUE-LITM
               MOVE QUE-GET  TO QUE-CMND
               PERFORM GNS-PRO-QUE
               IF QUE-STAT = QUE-STAT-OKS
                   MOVE 'PLAVENDMAS' TO MSG-COD-MENS.
       EXT-PUT-TAB-ASC.
           EXIT.

       PUT-TAB-DSC SECTION.
       INI-PUT-TAB-DSC.
           MOVE SPACES TO MSG-COD-MENS.
           IF SCR-NUM-PANT = 1
               MOVE 'PLAVENNOPRV' TO MSG-COD-MENS
               GO TO EXT-PUT-TAB-DSC.
           SUBTRACT 1 FROM SCR-NUM-PANT GIVING QUE-NITM.
           MULTIPLY QUE-NITM BY WSS-IMAX GIVING QUE-NITM.
           ADD 1 TO QUE-NITM.
           ADD 1 WSS-IMAX GIVING FRM-IFLD.
       LUP-PUT-TAB-DSC.
           SUBTRACT  1 FROM QUE-NITM.

           MOVE WSS-PLA-TERM-ALF TO QUE-TERM.
           MOVE 'GPLA'   TO QUE-TYPE.
           MOVE PLA-WSS-LENG TO QUE-LITM.
           MOVE QUE-GET  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               IF FRM-IFLD > WSS-IMAX
                   MOVE 'PLAVENNOPRV' TO MSG-COD-MENS
                   GO TO FIN-PUT-TAB-DSC
               ELSE
                   GO TO FIN-PUT-TAB-DSC.
           SUBTRACT 1 FROM FRM-IFLD.
           MOVE QUE-ITEM TO FRM-NUM-IVCT-IDX(FRM-IFLD).
           IF FRM-IFLD > 1
               GO TO LUP-PUT-TAB-DSC.
       FIN-PUT-TAB-DSC.
           IF FRM-IFLD NOT > WSS-IMAX AND FRM-IFLD > 1
               SUBTRACT 1 FROM FRM-IFLD GIVING WSS-I
               PERFORM CLR-FRM VARYING WSS-I FROM WSS-I BY -1
                                 UNTIL WSS-I < 1.
           IF FRM-IFLD NOT > WSS-IMAX
               SUBTRACT 1 FROM SCR-NUM-PANT
               MOVE 'PLAVENDMAS' TO MSG-COD-MENS.
       EXT-PUT-TAB-DSC.
           EXIT.
       PUT-TAB-PLA SECTION.
       INI-PUT-TAB-PLA.
           IF PLC-IND-COB IN PLC-VARI = 'S'
               PERFORM PLC-COB-CFG.
           IF VEN-NUM-IVCT IN VEN NOT < OPC-NUM-IVEN IN OPC
               MOVE 'N' TO PLA-WSS-IND-CANC
           ELSE
               MOVE 'S' TO PLA-WSS-IND-CANC.

           IF OPC-NUM-VCOR IN OPC = 1 AND
              VEN-VAL-SFIN IN VEN NOT > ZEROES
               MOVE 'S' TO PLA-WSS-IND-CANC.

           IF OPC-VAL-SCRE IN OPC NOT > ZEROES
               MOVE 'S' TO PLA-WSS-IND-CANC.

           MOVE VEN-NUM-IVCT IN VEN TO PLA-WSS-NUM-IVCT.
           MOVE VEN-NUM-DVEN IN VEN TO PLA-WSS-NUM-DVEN.
           MOVE VEN-NUM-MVEN IN VEN TO PLA-WSS-NUM-MVEN.
           MOVE VEN-NUM-SVEN IN VEN TO PLA-WSS-NUM-SVEN.
           MOVE VEN-NUM-AVEN IN VEN TO PLA-WSS-NUM-AVEN.
           ADD PLC-VAL-MNTO IN PLC-VARI TO PLA-WSS-VAL-COMC.
           MOVE VEN-VAL-CAPI IN VEN TO PLA-WSS-VAL-SCAP.
           MOVE VEN-VAL-FINA IN VEN TO PLA-WSS-VAL-TOTA.
           MOVE ZEROES              TO PLA-WSS-VAL-GASC.
           COMPUTE PLA-WSS-VAL-INTC =
              PLA-WSS-VAL-TOTA -
              PLA-WSS-VAL-SCAP.
           ADD PLC-VAL-MNTO IN PLC-VARI TO PLA-WSS-VAL-TOTA.

      *OGB-INI 01-JUL-2016 BACKVALUE
           PERFORM VAL-BACKVALUE.
           IF WSS-IND-DESC-INT = WSS-CT-S AND
              OPC-NUM-IVEN IN OPC NOT > WSS-CT-1
              PERFORM CAL-BACKVALUE
              SUBTRACT WSS-SGV-VINT FROM PLA-WSS-VAL-INTC
              SUBTRACT WSS-SGV-VINT FROM PLA-WSS-VAL-TOTA.
      *OGB-FIN 01-JUL-2016 BACKVALUE

      *AJA-INI 18-ABR-2018 INCORPORAR COM BEX - 53882
           MOVE VEN-FEC-FVEN IN VEN (WCC-7:WCC-2) TO
                        CAN-FEC-FCAN IN CAN-FLD(WCC-1:WCC-2).
           MOVE VEN-FEC-FVEN IN VEN (WCC-5:WCC-2) TO
                        CAN-FEC-FCAN IN CAN-FLD(WCC-3:WCC-2).
           MOVE VEN-FEC-FVEN IN VEN (WCC-1:WCC-4) TO
                        CAN-FEC-FCAN IN CAN-FLD(WCC-5:WCC-4).
           PERFORM DET-COM-OPER.

           IF PLC-OPEC IN PLC-VARI = WCC-B
               MOVE OPC-VAL-SCRE IN OPC TO CAN-SGV-TPAG IN CAN-FLD
           ELSE
               MOVE VEN-VAL-SFIN IN VEN TO CAN-SGV-TPAG IN CAN-FLD.


           MOVE ZEROES TO PCP-SUVP.
           MOVE ZEROES TO PCP-RENO.
           MOVE ZEROES TO WSS-VAL-SMO7.
           MOVE ZEROES TO WSS-VAL-SMO8.
           MOVE ZEROES TO WSS-VAL-SMO9.
           MOVE ZEROES TO WSS-VAL-SM10.
           MOVE ZEROES TO WSS-VAL-SVEN.
           MOVE SPACES TO CCO-COM-ANTE.
           MOVE SPACES TO DLC-FEC-FDEV IN DLC.
           PERFORM CAL-COM-PCP.

           IF PCP-RETO = WCC-1
               MOVE ZEROES TO WSS-VAL-COMI IN WSS-CDP
               MOVE ZEROES TO WSS-VAL-COMI IN WSS-C1V
           ELSE
               COMPUTE WSS-VAL-COMI IN WSS-CDP ROUNDED =
                       PCP-SUCO / WSS-VAL-VCAM IN WSS-VARI +
                       PCP-SUIM / WSS-VAL-VCAM IN WSS-VARI
               MOVE WSS-VAL-COMI IN WSS-CDP TO WSS-VAL-COMI IN WSS-C1V.
           ADD VEN-VAL-SCAP IN VEN TO WSS-SGV-CACU.

           ADD WSS-VAL-COMI IN WSS-C1V TO PLA-WSS-VAL-COMC.
           ADD WSS-VAL-COMI IN WSS-C1V TO PLA-WSS-VAL-TOTA.
      *AJA-FIN 18-ABR-2018 INCORPORAR COM BEX - 53882

           MOVE ZEROES              TO WSS-VAL-COMI IN WSS-VARI.
           MOVE ZEROES              TO PLA-WSS-VAL-SEGC
           IF VEN-NUM-IVCT IN VEN = 1 AND OPC-NUM-VCOR IN OPC = 1
              PERFORM OBT-COM-DUMMY
              PERFORM OBT-IMP-DUMMY.
           IF WSS-CIC-SEGD IN WSS-VARI NOT = 'SGSSISPRECIO'
               GO TO CNT-SGS-PRC.
           MOVE OPC-VAL-CRED IN OPC TO OSG-OPC-VAL-SCRE.
           IF VEN-NUM-IVCT IN VEN = 1 AND OPC-NUM-VCOR IN OPC = 1
              MOVE VEN-FEC-FVEN IN VEN TO WSS-FEC-FVEN IN WSS-VARI
              MOVE VEN-NUM-IVCT IN VEN TO WSS-NUM-IVCT IN WSS-VARI
              MOVE OPC-VAL-CRED IN OPC TO OSG-OPC-VAL-SCRE
              MOVE ZEROES              TO WSS-VAL-CAPI IN WSS-VARI
              PERFORM OBT-SEG
              GO TO CNT-SGS-PRC.
           IF VEN-NUM-IVCT IN VEN = 1
              MOVE VEN-FEC-FVEN IN VEN TO WSS-FEC-FVEN IN WSS-VARI
              MOVE VEN-NUM-IVCT IN VEN TO WSS-NUM-IVCT IN WSS-VARI
              MOVE VEN-VAL-CAPI IN VEN TO WSS-VAL-CAPI IN WSS-VARI
           ELSE
              PERFORM OBT-SEG
              MOVE VEN-FEC-FVEN IN VEN TO WSS-FEC-FVEN IN WSS-VARI
              MOVE VEN-NUM-IVCT IN VEN TO WSS-NUM-IVCT IN WSS-VARI.
       CNT-SGS-PRC.
           IF FRM-IFLD NOT > WSS-IMAX
               MOVE PLA-WSS-NUM-IVCT-IDX TO FRM-NUM-IVCT-IDX(FRM-IFLD).
       FIN-PUT-TAB-PLA.
           EXIT.
       PUT-PLA-QUE SECTION.
       INI-PUT-PLA-QUE.
           PERFORM PRO-FLD-QUE.
           ADD 1 TO PLA-TOT-ITDC.
           ADD 1 TO WSS-NITM.
           MOVE WSS-PLA-TERM-ALF TO QUE-TERM
           MOVE 'GPLA'   TO QUE-TYPE.
           MOVE WSS-NITM TO QUE-NITM.
           IF SCR-OFRM-SRV                                              00012080
               PERFORM EDT-FLD-QUE
               MOVE PLB-WSS-NUM-IVCT-IDX TO QUE-ITEM
           ELSE
           MOVE PLA-WSS-NUM-IVCT-IDX TO QUE-ITEM.
           MOVE PLA-WSS-LENG TO QUE-LITM.
           MOVE QUE-PUT  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF FRM-NUM-IVEN IN PLA-FLD NOT > 1
            ADD PLA-WSS-VAL-INTC TO FRM-VAL-INTE IN PLA-FLD.
       FIN-PUT-PLA-QUE.
           EXIT.
       PUT-PLA SECTION.
       INI-PUT-PLA.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO DBC-GLS-NOMC IN PLA-FLD.
           IF OPC-COD-VCOC IN OPC > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'VLR' TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-VCOC IN OPC TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-VEXP IN PLA-FLD
           ELSE
               MOVE SPACES              TO FRM-GLS-VEXP IN PLA-FLD.
           MOVE 'TVAL' TO MSC-CIC-TMSC IN MSC.
           MOVE '0'    TO MSC-CIC-CMSC IN MSC.
           MOVE 'TAB' TO FIO-SIST.
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO MSC-COD-CMSC IN MSC.
           MOVE 1 TO CAM-SGV-VCAM IN CAM.
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB.
           MOVE '0999  '       TO TAB-CIC-CTAB.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO TAB-COD-CTAB IN TAB.
           IF TAB-COD-CTAB  NOT   = OPC-COD-VCOC IN OPC AND
              MSC-COD-CMSC IN MSC = OPC-MSC-TVOC IN OPC
               MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-VEXP IN PLA-FLD
               MOVE OPC-NUM-DCOL IN OPC TO CAM-NUM-DCAM IN CAM(1)
               MOVE OPC-NUM-MCOL IN OPC TO CAM-NUM-MCAM IN CAM(1)
               MOVE OPC-NUM-SCOL IN OPC TO CAM-NUM-SCAM IN CAM(1)
               MOVE OPC-NUM-ACOL IN OPC TO CAM-NUM-ACAM IN CAM(1)
               MOVE OPC-NUM-DCOL IN OPC TO CAM-NUM-DCAM IN CAM(2)
               MOVE OPC-NUM-MCOL IN OPC TO CAM-NUM-MCAM IN CAM(2)
               MOVE OPC-NUM-SCOL IN OPC TO CAM-NUM-SCAM IN CAM(2)
               MOVE OPC-NUM-ACOL IN OPC TO CAM-NUM-ACAM IN CAM(2)
               MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
               MOVE TAB-COD-CTAB IN TAB TO CAM-COD-VCAM IN CAM(2)
               MOVE FIO-GET-KEY  TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT FIO-STAT-OKS
                   MOVE 1 TO CAM-SGV-VCAM IN CAM.
           MOVE CAM-SGV-VCAM IN CAM TO WSS-CAM-SGV-VCAM IN WSS-VARI.
           MOVE OPC-NUM-DCOL IN OPC TO OPC-NUM-DCOL IN PLA-FLD.
           MOVE OPC-NUM-MCOL IN OPC TO OPC-NUM-MCOL IN PLA-FLD.
           MOVE OPC-NUM-SCOL IN OPC TO OPC-NUM-SCOL IN PLA-FLD.
           MOVE OPC-NUM-ACOL IN OPC TO OPC-NUM-ACOL IN PLA-FLD.
           MULTIPLY OPC-VAL-CRED IN OPC BY WSS-CAM-SGV-VCAM IN
                       WSS-VARI GIVING FRM-VAL-CRED IN PLA-FLD.
           MOVE OPC-COD-VCOC IN OPC     TO PES-COD-VCAM IN PES-VARI.
           MOVE FRM-VAL-CRED IN PLA-FLD TO PES-SGV-DECI IN PES-VARI.
           PERFORM PES-SCTV
           MOVE PES-SGV-ENTE IN PES-VARI TO FRM-VAL-CRED IN PLA-FLD.
           MOVE ZEROES              TO FRM-VAL-INTE IN PLA-FLD.
           PERFORM OBT-IMP-GNOT.
           PERFORM OBT-PORTES.
           MOVE OPC-VAL-GAST IN OPC TO FRM-VAL-GAST IN PLA-FLD.
           MOVE OPC-SGV-VCOM IN OPC TO FRM-VAL-VCOM IN PLA-FLD.
           MOVE OPC-VAL-SEGD IN OPC TO OPC-VAL-SEGD IN PLA-FLD.
           ADD OPC-VAL-SEGC IN OPC TO OPC-VAL-SEGD IN PLA-FLD.
           MOVE OPC-SGV-LIQU IN OPC TO OPC-SGV-LIQU IN PLA-FLD.
      *AJA-INI 18-ABR-2018 INCORPORAR COM BEX - 53882
           MOVE CAM-SGV-VCAM IN CAM TO WSS-VAL-VCAM IN WSS-VARI.
      *AJA-FIN 18-ABR-2018 INCORPORAR COM BEX - 53882
       FIN-PUT-PLA.
           EXIT.
       OBT-IMP-GNOT SECTION.
       INI-OBT-IMP-GNOT.
           MOVE ZEROES TO FRM-VAL-GAST IN PLA-FLD.
           MOVE ZEROES TO FRM-VAL-IMPU IN PLA-FLD.
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = DLC-CIC-IOPC IN DLC )
               GO TO FIN-OBT-IMP-GNOT.
       LUP-OBT-IMP-GNOT.
           ADD DLC-VAL-GNOT IN DLC TO FRM-VAL-GAST IN PLA-FLD.
           ADD DLC-VAL-IMPU IN DLC TO FRM-VAL-IMPU IN PLA-FLD.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = DLC-CIC-IOPC IN DLC
               GO TO LUP-OBT-IMP-GNOT.
       FIN-OBT-IMP-GNOT.
           EXIT.
       OBT-PORTES SECTION.
       INI-OBT-PORTES.
           MOVE OPC-CIC-IOPC IN OPC      TO ICG-CIC-IOPC IN ICG.
           MOVE ZEROES                   TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES                   TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES                   TO ICG-NUM-IVCT IN ICG.
           MOVE 'GASPCU'                 TO ICG-IND-TTAS IN ICG.
           MOVE OPC-FEC-FCOL IN OPC      TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF  FIO-STAT-OKS
               ADD ICG-SGV-MNTO IN ICG   TO FRM-VAL-GAST IN PLA-FLD.
       FIN-OBT-PORTES.
           EXIT.
       OBT-COM-DUMMY SECTION.
       INI-OBT-COM-DUMMY.
           MOVE OPC-CIC-IOPC IN OPC      TO ICG-CIC-IOPC IN ICG.
           MOVE ZEROES                   TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES                   TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES                   TO ICG-NUM-IVCT IN ICG.
           MOVE 'COMDUM'                 TO ICG-IND-TTAS IN ICG.
           MOVE OPC-FEC-FCOL IN OPC      TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF  FIO-STAT-OKS
               ADD ICG-SGV-MNTO IN ICG   TO PLA-WSS-VAL-TOTA
                                            PLA-WSS-VAL-IMPC.
       FIN-OBT-COM-DUMMY.
           EXIT.
       OBT-IMP-DUMMY SECTION.
       INI-OBT-IMP-DUMMY.
           MOVE OPC-CIC-IOPC IN OPC      TO ICG-CIC-IOPC IN ICG.
           MOVE ZEROES                   TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES                   TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES                   TO ICG-NUM-IVCT IN ICG.
           MOVE 'IMPDUM'                 TO ICG-IND-TTAS IN ICG.
           MOVE OPC-FEC-FCOL IN OPC      TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ICG.
       FIN-OBT-IMP-DUMMY.
           EXIT.
       OBT-SEG SECTION.
       INI-OBT-SEG.
           IF VEN-NUM-IVCT IN VEN = 1 AND OPC-NUM-VCOR IN OPC = 1
               GO TO CNT-OBT-SEG-ULT.

           MOVE SPACES TO MSG-COD-MENS.
           MOVE 'CRE'  TO OSG-SGS-COD-SYST IN OSG-VARI.
           MOVE 'CUR'  TO OSG-SGS-COD-EVNT IN OSG-VARI.
           MOVE 'CON'  TO OSG-CXE-COD-EVEN IN OSG-VARI.
           MOVE SPACES TO OSG-IND-OCOB     IN OSG-VARI.
           IF WSS-NUM-IVCT IN WSS-VARI = 1
              MOVE OPC-NUM-SCOL IN OPC   TO OSG-NUM-SUNO
              MOVE OPC-NUM-ACOL IN OPC   TO OSG-NUM-AUNO
              MOVE OPC-NUM-MCOL IN OPC   TO OSG-NUM-MUNO
              MOVE OPC-NUM-DCOL IN OPC   TO OSG-NUM-DUNO
           ELSE
              MOVE WSS-NUM-SVNA      TO OSG-NUM-SUNO
              MOVE WSS-NUM-AVNA      TO OSG-NUM-AUNO
              MOVE WSS-NUM-MVNA      TO OSG-NUM-MUNO
              MOVE WSS-NUM-DVNA      TO OSG-NUM-DUNO.

           MOVE WSS-NUM-DVEN IN WSS-VARI TO OSG-NUM-DDOS.
           MOVE WSS-NUM-MVEN IN WSS-VARI TO OSG-NUM-MDOS.
           MOVE WSS-NUM-SVEN IN WSS-VARI TO OSG-NUM-SDOS.
           MOVE WSS-NUM-AVEN IN WSS-VARI TO OSG-NUM-ADOS.
           MOVE VEN-NUM-DVEN IN VEN      TO OSG-NUM-DFVC.
           MOVE VEN-NUM-MVEN IN VEN      TO OSG-NUM-MFVC.
           MOVE VEN-NUM-SVEN IN VEN      TO OSG-NUM-SFVC.
           MOVE VEN-NUM-AVEN IN VEN      TO OSG-NUM-AFVC.
           MOVE OPC-NUM-DCOL IN OPC      TO OSG-NUM-DCAM.
           MOVE OPC-NUM-MCOL IN OPC      TO OSG-NUM-MCAM.
           MOVE OPC-NUM-SCOL IN OPC      TO OSG-NUM-SCAM.
           MOVE OPC-NUM-ACOL IN OPC      TO OSG-NUM-ACAM.
           MOVE WSS-NUM-DVEN IN WSS-VARI TO WSS-NUM-DVNA.
           MOVE WSS-NUM-MVEN IN WSS-VARI TO WSS-NUM-MVNA.
           MOVE WSS-NUM-SVEN IN WSS-VARI TO WSS-NUM-SVNA.
           MOVE WSS-NUM-AVEN IN WSS-VARI TO WSS-NUM-AVNA.

           MOVE SPACES TO OSG-COD-MENS.
           MOVE 'COL' TO MSG-COD-SIST.
           IF VEN-NUM-IVCT IN VEN = 2
              MOVE OPC-VAL-CRED IN OPC TO OSG-OPC-VAL-SCRE.

           PERFORM CALC-SEG-PRECIO.
           IF OSG-COD-MENS  > SPACES
             GO TO FIN-OBT-SEG.

           SUBTRACT WSS-VAL-CAPI IN WSS-VARI FROM OSG-OPC-VAL-SCRE.
           MOVE VEN-VAL-CAPI IN VEN TO WSS-VAL-CAPI IN WSS-VARI.

           MOVE WSS-NITM    TO QUE-NITM.
           MOVE WSS-PLA-TERM-ALF TO QUE-TERM.
           MOVE 'GPLA'   TO QUE-TYPE.
           MOVE PLA-WSS-LENG TO QUE-LITM.
           MOVE QUE-GET  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               MOVE 'PLAVENNEX' TO MSG-COD-MENS
               GO TO FIN-OBT-SEG.

           MOVE QUE-ITEM TO PLB-WSS-NUM-IVCT-IDX.
           MOVE OSG-VAL-SEGC  TO PLA-WSS-VAL-SEGC.
           ADD  OSG-VAL-SEGC  TO PLA-WSS-VAL-TOTA.
           MOVE ZEROES        TO OSG-VAL-SEGC.
           IF WSS-NITM NOT > WSS-IMAX
               MOVE PLB-WSS-NUM-IVCT-IDX TO FRM-NUM-IVCT-IDX(WSS-NITM).

           MOVE WSS-NITM    TO QUE-NITM.
           MOVE WSS-PLA-TERM-ALF TO QUE-TERM.
           MOVE 'GPLA'   TO QUE-TYPE.
           MOVE PLA-WSS-LENG TO QUE-LITM.
           MOVE PLB-WSS-NUM-IVCT-IDX TO QUE-ITEM.
           MOVE QUE-MOD  TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           IF QUE-STAT NOT = QUE-STAT-OKS
               MOVE 'PLAQUEMODNO' TO MSG-COD-MENS
               GO TO FIN-OBT-SEG.

           IF NOT (VEN-NUM-IVCT IN VEN = OPC-NUM-VCOR IN OPC)
               GO TO FIN-OBT-SEG.

       CNT-OBT-SEG-ULT.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE 'CRE'  TO OSG-SGS-COD-SYST IN OSG-VARI.
           MOVE 'CUR'  TO OSG-SGS-COD-EVNT IN OSG-VARI.
           MOVE 'CON'  TO OSG-CXE-COD-EVEN IN OSG-VARI.
           MOVE SPACES TO OSG-IND-OCOB     IN OSG-VARI.

           IF VEN-NUM-IVCT IN VEN = 1 AND OPC-NUM-VCOR IN OPC = 1
              MOVE OPC-NUM-SCOL IN OPC TO OSG-NUM-SUNO
              MOVE OPC-NUM-ACOL IN OPC TO OSG-NUM-AUNO
              MOVE OPC-NUM-MCOL IN OPC TO OSG-NUM-MUNO
              MOVE OPC-NUM-DCOL IN OPC TO OSG-NUM-DUNO
           ELSE
              MOVE WSS-NUM-SVEN        TO OSG-NUM-SUNO
              MOVE WSS-NUM-AVEN        TO OSG-NUM-AUNO
              MOVE WSS-NUM-MVEN        TO OSG-NUM-MUNO
              MOVE WSS-NUM-DVEN        TO OSG-NUM-DUNO.

           MOVE VEN-NUM-DVEN IN VEN TO OSG-NUM-DDOS.
           MOVE VEN-NUM-MVEN IN VEN TO OSG-NUM-MDOS.
           MOVE VEN-NUM-SVEN IN VEN TO OSG-NUM-SDOS.
           MOVE VEN-NUM-AVEN IN VEN TO OSG-NUM-ADOS.
           MOVE VEN-NUM-DVEN IN VEN TO OSG-NUM-DFVC.
           MOVE VEN-NUM-MVEN IN VEN TO OSG-NUM-MFVC.
           MOVE VEN-NUM-SVEN IN VEN TO OSG-NUM-SFVC.
           MOVE VEN-NUM-AVEN IN VEN TO OSG-NUM-AFVC.
           MOVE OPC-NUM-DCOL IN OPC TO OSG-NUM-DCAM.
           MOVE OPC-NUM-MCOL IN OPC TO OSG-NUM-MCAM.
           MOVE OPC-NUM-SCOL IN OPC TO OSG-NUM-SCAM.
           MOVE OPC-NUM-ACOL IN OPC TO OSG-NUM-ACAM.
           MOVE VEN-NUM-DVEN IN VEN TO WSS-NUM-DVNA.
           MOVE VEN-NUM-MVEN IN VEN TO WSS-NUM-MVNA.
           MOVE VEN-NUM-SVEN IN VEN TO WSS-NUM-SVNA.
           MOVE VEN-NUM-AVEN IN VEN TO WSS-NUM-AVNA.

           MOVE SPACES TO OSG-COD-MENS.
           MOVE 'COL' TO MSG-COD-SIST.

           PERFORM CALC-SEG-PRECIO.
           IF OSG-COD-MENS  > SPACES
             GO TO FIN-OBT-SEG.

           MOVE OSG-VAL-SEGC  TO PLA-WSS-VAL-SEGC.
           ADD OSG-VAL-SEGC   TO PLA-WSS-VAL-TOTA.
           MOVE ZEROES        TO OSG-VAL-SEGC.
       FIN-OBT-SEG.
           EXIT.
       CAL-DPES SECTION.
       INI-CAL-DPES.
       FIN-CAL-DPES.
           EXIT.
       GET-RDE SECTION.
       INI-GET-RDE.
       FIN-GET-RDE.
           EXIT.
       CLR-FRM SECTION.
       INI-CLR-FRM.
           MOVE ZEROES              TO FRM-NUM-IVCT IN PLA-FLD(WSS-I).
           MOVE ZEROES              TO FRM-NUM-DVEN IN PLA-FLD(WSS-I).
           MOVE ZEROES              TO FRM-NUM-MVEN IN PLA-FLD(WSS-I).
           MOVE ZEROES              TO FRM-NUM-SVEN IN PLA-FLD(WSS-I).
           MOVE ZEROES              TO FRM-NUM-AVEN IN PLA-FLD(WSS-I).
           MOVE ZEROES              TO FRM-VAL-SCAP IN PLA-FLD(WSS-I).
           MOVE ZEROES              TO FRM-VAL-TOTA IN PLA-FLD(WSS-I).
           MOVE ZEROES              TO FRM-VAL-IMPC IN PLA-FLD(WSS-I).
           MOVE ZEROES              TO FRM-VAL-COMC IN PLA-FLD(WSS-I).
           MOVE ZEROES              TO FRM-VAL-INTC IN PLA-FLD(WSS-I).

           MOVE ZEROES              TO FRM-VAL-SEGC IN PLA-FLD(WSS-I).
           MOVE ZEROES              TO FRM-VAL-COMC IN PLA-FLD(WSS-I).
           MOVE ZEROES              TO FRM-VAL-GASC IN PLA-FLD(WSS-I).
       FIN-CLR-FRM.
           EXIT.
       CLR-SCR-RDE SECTION.
       INI-CLR-SCR-RDE.
       FIN-CLR-SCR-RDE.
           EXIT.
       PUT-TOT-PLA SECTION.
       INI-PUT-TOT-PLA.
       FIN-PUT-TOT-PLA.
           EXIT.
       CAL-TPES SECTION.
       INI-CAL-TPES.
       FIN-CAL-TPES.
           EXIT.
       BUS-CIC-SEGD SECTION.
       INI-BUS-CIC-SEGD.
           MOVE 'COL' TO TAB-COD-SIST FIO-SIST.
           MOVE 'SDG' TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-SEGD IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS OR
                  TAB-IND-VIGE NOT = 'S'
               MOVE SPACES TO WSS-CIC-SEGD IN WSS-VARI
               GO TO FIN-BUS-CIC-SEGD.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-SEGD IN WSS-VARI.
       FIN-BUS-CIC-SEGD.
           EXIT.
       BUS-CIC-OPEC SECTION.
       INI-BUS-CIC-OPEC.
           MOVE OPC-COD-TOOC IN OPC TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-TOC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'               TO MSG-COD-SIST
               MOVE 'OPCTOOCNEX  '      TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC        TO FRM-MEN1
               MOVE OPC-COD-TOOC IN OPC TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-BUS-CIC-OPEC.
           MOVE 'COL'               TO FIO-SIST.
           MOVE 'OPEC'              TO MSC-COD-TMSC IN MSC.
           MOVE TOC-MSC-OPEC IN TOC TO MSC-COD-CMSC IN MSC.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'               TO MSG-COD-SIST
               MOVE 'OPCOPECNEX  '      TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC        TO FRM-MEN1
               MOVE TOC-MSC-OPEC IN TOC TO FRM-MEN2
               MOVE FRM-SUAR-MAL        TO FRM-SUAR
               GO TO FIN-BUS-CIC-OPEC.
           MOVE MSC-CIC-CMSC IN MSC TO SCR-FRM-OPE.
       FIN-BUS-CIC-OPEC.
           EXIT.
       COPY LDCBFLCC.
       COPY LDCBFRLO.
       COPY TABBFCAM.
       COPY TABBFOFI.
       COPY COLBFTOC.
       COPY GNSBPFEC.
DSP   *COPY COLBGSDC.
DSP   *COPY COLBGSCV.
DSP   *COPY COLBGSDP.
       COPY SGCBGCLI.
       COPY GNSBGCPT.
       COPY GNSBGSTR.
       COPY TABBGCAM.
       COPY GNSBGPES.
       COPY COLBGINT.
       COPY COLBGVEN.
       COPY SGCBFDBC.
       COPY COLBFDLC.
       COPY COLBFCOM.

       COPY COLBFRDC.
       COPY COLBFVEN.
       COPY COLBFCCT.
       COPY COLBFEVC.
       COPY COLBFICG.
       COPY COLBFITR.
       COPY COLBFCXA.
       COPY COLBFRCC.
       COPY COLBFRCV.
       COPY GNSBBTAB.

      *AFRI-INI/FEB-2015/PLATAFORMA UNICA
       COPY COLBGVEI.
      *AFRI-FIN/FEB-2015/PLATAFORMA UNICA

       COPY COLBGCXE.

       PUT-SIN-MORA SECTION.
       INI-PUT-SIN-MORA.

           MOVE ZEROES TO FRM-VAL-GAST IN PLA-FLD.
           MOVE ZEROES TO FRM-VAL-IMPU IN PLA-FLD.

           MOVE WSS-PLA-TERM-ALF TO QUE-TERM
           MOVE 'GPLA'           TO QUE-TYPE.
           MOVE QUE-DEL          TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           MOVE 1                TO SCR-NUM-PANT.
           MOVE LOW-VALUES       TO PLA-WSS-NUM-IVCT-IDX.
           MOVE ZEROES           TO PLA-WSS-NUM-IVCT
                                    PLA-WSS-NUM-IVCT
                                    PLA-WSS-VAL-IMPC
                                    PLA-WSS-VAL-COMC
                                    PLA-WSS-VAL-SEGC
                                    PLA-WSS-VAL-GASC
                                    PLA-WSS-VAL-INTC
                                    PLA-WSS-VAL-SCAP
                                    PLA-WSS-VAL-TOTA.

           PERFORM GET-FHOY.

           MOVE 1                TO FRM-IFLD.
           MOVE ZEROES           TO VEN-NUM-IVEN IN VEN.
           MOVE 1                TO WSS-CON-VEN.
           MOVE SPACES           TO INT-CMSG.


       LUP-PUT-SIN-MORA.

           ADD 1 TO VEN-NUM-IVEN IN VEN.

           IF VEN-NUM-IVEN IN VEN > OPC-NUM-VCOR IN OPC
              MOVE '00' TO FIO-STAT
              GO TO FIN-PUT-SIN-MORA.

           PERFORM CUO-SIN-MORA.
           IF NOT INT-CMSG > SPACES
               PERFORM PUT-TAB-PLA
               PERFORM PUT-PLA-QUE
               MOVE ZEROES TO PLA-WSS-VAL-COMC
               ADD 1 TO WSS-CON-VEN
               ADD 1 TO FRM-IFLD
           ELSE
               MOVE '00' TO FIO-STAT
               GO TO FIN-PUT-SIN-MORA.

           IF WSS-CXE-VCUR = ZEROES
               MOVE '00' TO FIO-STAT
               GO TO FIN-PUT-SIN-MORA.

           IF VEN-NUM-IVEN IN VEN = OPC-NUM-VCOR IN OPC
              MOVE '00' TO FIO-STAT
              GO TO FIN-PUT-SIN-MORA.

           GO TO LUP-PUT-SIN-MORA.

       FIN-PUT-SIN-MORA.

           IF WSS-NITM > WSS-IMAX
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'PLAVENDMAS' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.

       EXT-PUT-SIN-MORA.
           EXIT.

       BUS-EVC-VA SECTION.
       INI-BUS-EVC-VA.

           MOVE OPC-CIC-IOPC IN OPC TO EVC-CIC-IOPC IN EVC.
           MOVE ZEROES              TO EVC-NUM-IEVC IN EVC.
           MOVE FIO-GET-NLS         TO FIO-CMND.
           PERFORM COL-FIO-EVC.
       LUP-BUS-EVC-VA.
           IF NOT ( FIO-STAT-OKS AND
               EVC-CIC-IOPC IN EVC = OPC-CIC-IOPC IN OPC )
               MOVE 'EVCVA  NEX' TO MSG-COD-MENS
               GO TO FIN-BUS-EVC-VA.

           MOVE 'COL'               TO FIO-SIST.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           MOVE 'CVC'               TO TAB-COD-TTAB IN TAB.
           MOVE EVC-MSC-TCVE IN EVC TO TAB-COD-CTAB IN TAB.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              MOVE 'EVCVA  NEX' TO MSG-COD-MENS
              GO TO FIN-BUS-EVC-VA.

           IF TAB-CIC-CTAB IN TAB = 'VA'
              GO TO FIN-BUS-EVC-VA.

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-EVC.
           GO TO LUP-BUS-EVC-VA.

       FIN-BUS-EVC-VA.
           EXIT.
       PLC-DET-CCF SECTION.
       INI-PLC-DET-CCF.
           PERFORM INI-VAR-PLC.

           MOVE 'S' TO PLC-IND-COB IN PLC-VARI.

           PERFORM PLC-DET-FOG.
           IF PLC-GLS-NOCO IN PLC-VARI = 'NOCOBRACOM'
               MOVE 'N' TO PLC-IND-COB IN PLC-VARI
               GO TO FIN-PLC-DET-CCF.

           PERFORM DET-COM-OPER.
           IF PLC-OPEC IN PLC-VARI = 'B'
               MOVE 'N' TO PLC-IND-COB IN PLC-VARI
               GO TO FIN-PLC-DET-CCF.

           MOVE OPC-CAI-IOPC IN OPC TO RLO-CAI-IOPC IN RLO.
           MOVE OPC-IIC-IOPC IN OPC TO RLO-IIC-IOPC IN RLO.
           MOVE ZEROES              TO RLO-NUM-IOPC IN RLO.
           MOVE 'RLO-KEY-IOPC' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM LDC-FIO-RLO.
           IF NOT FIO-STAT-OKS OR
            (OPC-CAI-IOPC IN OPC NOT = RLO-CAI-IOPC IN RLO AND
            OPC-IIC-IOPC IN OPC NOT = RLO-IIC-IOPC IN RLO AND
            RLO-NUM-IOPC IN RLO NOT = ZEROES)
               MOVE 'N' TO PLC-IND-COB IN PLC-VARI
               GO TO FIN-PLC-DET-CCF.

           MOVE RLO-CIC-ILIC IN RLO TO LCC-CIC-ILIC IN LCC.
           MOVE 'LCC-KEY-ILIC' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM LDC-FIO-LCC.
           IF NOT FIO-STAT-OKS
               MOVE 'N' TO PLC-IND-COB IN PLC-VARI.

       FIN-PLC-DET-CCF.
           EXIT.
       PLC-COB-CFG SECTION.
       INI-PLC-COB-CFG.
           IF VEN-NUM-IVCT IN VEN NOT = 1
               COMPUTE PLC-IFLD = FRM-IFLD - 1
               COMPUTE PLC-VAL-SCRE IN PLC-VARI =
                   PLC-VAL-SCRE IN PLC-VARI - PLC-VAL-SCR2 IN PLC-VARI
               MOVE VEN-FEC-FVEN IN VEN TO PLC-FEC-FCAN IN PLC-VARI.

           PERFORM PLC-DET-MON.
           IF PLC-GLS-NOCO IN PLC-VARI = 'NOCOBRACOM'
               GO TO FIN-PLC-COB-CFG.

           PERFORM PLC-DET-COM.

           IF PLC-CIC-TVAL IN PLC-VARI = 'S'
              MOVE PLC-VAL-MNTO IN PLC-VARI TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO PLC-VAL-MNTO IN PLC-VARI.

           MOVE VEN-VAL-CAPI IN VEN TO PLC-VAL-SCR2 IN PLC-VARI.
           MOVE VEN-FEC-FVEN IN VEN TO PLC-CXE-FVEN IN PLC-VARI.

       FIN-PLC-COB-CFG.
           EXIT.
       PLC-LEE-LCT SECTION.
       INI-PLC-LEE-LCT.
           MOVE 'COL'       TO TAB-COD-SIST FIO-SIST.
           MOVE 'LCT'       TO TAB-COD-TTAB IN TAB.
           MOVE 'TASA'      TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
               MOVE 360 TO PLC-BAS-FGPE IN PLC-VARI
           ELSE
               IF TAB-COD-DAT1(1) = 'A'
                   MOVE 360 TO PLC-BAS-FGPE IN PLC-VARI
               ELSE
               IF TAB-COD-DAT1(1) = 'M'
                   MOVE 30 TO PLC-BAS-FGPE IN PLC-VARI
               ELSE
               IF TAB-COD-DAT1(1) = 'D'
                   MOVE 1 TO PLC-BAS-FGPE IN PLC-VARI.

      *AFRI-INI 16-ABR-2012 CORRECCION COMISION
      *    MULTIPLY PLC-BAS-FGPE IN PLC-VARI BY 10000
      *                                 GIVING PLC-BAS-FGPE IN PLC-VARI.
      *AFRI-FIN 16-ABR-2012 CORRECCION COMISION
       FIN-PLC-LEE-LCT.
           EXIT.
       PLC-DET-COM SECTION.
       INI-PLC-DET-COM.
           MOVE PLC-CXE-DVEN IN PLC-VARI TO PLC-NUM-DUN IN PLC-VARI.
           MOVE PLC-CXE-MVEN IN PLC-VARI TO PLC-NUM-MUN IN PLC-VARI.
           MOVE PLC-CXE-SVEN IN PLC-VARI TO PLC-NUM-SUN IN PLC-VARI.
           MOVE PLC-CXE-AVEN IN PLC-VARI TO PLC-NUM-AUN IN PLC-VARI.
           MOVE PLC-NUM-DCAN IN PLC-VARI TO PLC-NUM-DDO IN PLC-VARI.
           MOVE PLC-NUM-MCAN IN PLC-VARI TO PLC-NUM-MDO IN PLC-VARI.
           MOVE PLC-NUM-SCAN IN PLC-VARI TO PLC-NUM-SDO IN PLC-VARI.
           MOVE PLC-NUM-ACAN IN PLC-VARI TO PLC-NUM-ADO IN PLC-VARI.
           PERFORM PLC-DIF-DIA.
           PERFORM PLC-DET-SCR.
           MOVE PLC-VAL-COMI IN PLC-VARI TO PLC-VAL-MNTO IN PLC-VARI.

       FIN-PLC-DET-COM.
           EXIT.
       PLC-DIF-DIA SECTION.
       INI-PLC-DIF-DIA.
           MOVE PLC-NUM-DUN IN PLC-VARI TO FEC-DEC1.
           MOVE PLC-NUM-MUN IN PLC-VARI TO FEC-MEC1.
           MOVE PLC-NUM-SUN IN PLC-VARI TO FEC-SEC1.
           MOVE PLC-NUM-AUN IN PLC-VARI TO FEC-AEC1.
           MOVE PLC-NUM-DDO IN PLC-VARI TO FEC-DEC2.
           MOVE PLC-NUM-MDO IN PLC-VARI TO FEC-MEC2.
           MOVE PLC-NUM-SDO IN PLC-VARI TO FEC-SEC2.
           MOVE PLC-NUM-ADO IN PLC-VARI TO FEC-AEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           MOVE FEC-NDIA TO PLC-SGV-PLZO IN PLC-VARI.
           IF FIO-STAT NOT = '00'
               MOVE 'NOCOBRACOM' TO PLC-GLS-NOCO IN PLC-VARI.
       FIN-PLC-DIF-DIA.
           EXIT.
       PLC-DET-SCR SECTION.
       INI-PLC-DET-SCR.
      *AFRI-INI 16-ABR-2012 CORRECCION COMISION
           COMPUTE PLC-VAL-SCOR IN PLC-VARI = ( RLO-VAL-PGAR IN RLO *
                                LCC-SGV-CORI IN LCC *
                                PLC-SGV-PLZO IN PLC-VARI ) / 10000.
           PERFORM PLC-LEE-LCT.
           DIVIDE PLC-VAL-SCRE IN PLC-VARI BY PLC-BAS-FGPE IN PLC-VARI
            GIVING PLC-VAL-SPLZ IN PLC-VARI.
           MULTIPLY PLC-VAL-SPLZ IN PLC-VARI BY PLC-VAL-SCOR IN PLC-VARI
            GIVING PLC-VAL-COMI IN PLC-VARI.
      *    MULTIPLY PLC-VAL-SCRE IN PLC-VARI BY RLO-VAL-PGAR IN RLO
      *     GIVING PLC-VAL-SGAR IN PLC-VARI.
      *    MULTIPLY PLC-VAL-SGAR IN PLC-VARI BY LCC-SGV-CORI IN LCC
      *     GIVING PLC-VAL-SCOR IN PLC-VARI.
      *    MULTIPLY PLC-VAL-SCOR IN PLC-VARI BY PLC-SGV-PLZO IN PLC-VARI
      *     GIVING PLC-VAL-SPLZ IN PLC-VARI.
      *    PERFORM PLC-LEE-LCT.
      *    DIVIDE PLC-VAL-SPLZ IN PLC-VARI BY PLC-BAS-FGPE IN PLC-VARI
      *     GIVING PLC-VAL-COMI IN PLC-VARI.
      *AFRI-FIN 16-ABR-2012 CORRECCION COMISION
       FIN-PLC-DET-SCR.
           EXIT.
       PLC-DET-FOG SECTION.
       INI-PLC-DET-FOG.
           MOVE 'NOCOBRACOM'        TO PLC-GLS-NOCO IN PLC-VARI.
           MOVE 'COL'               TO FIO-SIST.
           MOVE 'GARA'              TO MSC-COD-TMSC IN MSC.
           MOVE OPC-IND-GARA IN OPC TO MSC-COD-CMSC IN MSC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT (FIO-STAT-OKS AND MSC-IND-VIGE IN MSC = 'S')
               GO TO FIN-PLC-DET-FOG.
           IF MSC-GLS-DATA IN MSC(60:1) NOT = 'F'
               GO TO FIN-PLC-DET-FOG.

           MOVE 'COL'               TO TAB-COD-SIST FIO-SIST.
           MOVE 'DES'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-CDOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
               IF (TAB-GLS-DATA IN TAB(60:1) = 'K' OR
                TAB-GLS-DATA IN TAB(60:1) = 'I')
                  MOVE 'SICOBRACOM' TO PLC-GLS-NOCO IN PLC-VARI.
       FIN-PLC-DET-FOG.
           EXIT.
       PLC-DET-MON SECTION.
       INI-PLC-DET-MON.
           MOVE 'TAB'          TO TAB-COD-SIST FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT (FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S')
               MOVE 'NOCOBRACOM' TO PLC-GLS-NOCO IN PLC-VARI
               GO TO FIN-PLC-DET-MON
           ELSE
               IF OPC-COD-VCOC IN OPC = TAB-COD-CTAB IN TAB
                   MOVE 'S' TO PLC-CIC-TVAL IN PLC-VARI
                   GO TO FIN-PLC-DET-MON
               ELSE
                   MOVE 'N' TO PLC-CIC-TVAL IN PLC-VARI.
       FIN-PLC-DET-MON.
           EXIT.
       INI-VAR-PLC SECTION.
       INI-INI-VAR-PLC.
           MOVE SPACES TO PLC-IND-COB  IN PLC-VARI.
           MOVE SPACES TO PLC-OPEC     IN PLC-VARI.
           MOVE ZEROES TO PLC-IFLD     IN PLC-VARI.
           MOVE ZEROES TO PLC-FEC-FCAN IN PLC-VARI.
           MOVE SPACES TO PLC-GLS-NOCO IN PLC-VARI.
           MOVE ZEROES TO PLC-VAL-SGAR IN PLC-VARI.
           MOVE ZEROES TO PLC-VAL-SCOR IN PLC-VARI.
           MOVE ZEROES TO PLC-SGV-PLZO IN PLC-VARI.
           MOVE ZEROES TO PLC-VAL-SPLZ IN PLC-VARI.
           MOVE ZEROES TO PLC-BAS-FGPE IN PLC-VARI.
           MOVE ZEROES TO PLC-VAL-COMI IN PLC-VARI.
           MOVE ZEROES TO PLC-VAL-MNTO IN PLC-VARI.
           MOVE ZEROES TO PLC-FEC-FUN  IN PLC-VARI.
           MOVE ZEROES TO PLC-FEC-FDO  IN PLC-VARI.
           MOVE SPACES TO PLC-CIC-TVAL IN PLC-VARI.
       FIN-INI-VAR-PLC.
           EXIT.
       DET-COM-OPER SECTION.
       INI-DET-COM-OPER.
           MOVE SPACES TO PLC-OPEC IN PLC-VARI.
           MOVE OPC-COD-TOOC IN OPC TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM COL-FIO-TOC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'OPCTOOCNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00' TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-DET-COM-OPER.
           MOVE TOC-MSC-OPEC IN TOC TO PLC-OPEC IN PLC-VARI.
       FIN-DET-COM-OPER.
           EXIT.

      *AJA-INI 18-ABR-2018 INCORPORAR COM BEX - 53882
       COPY COLBGPCP.
       PCP-PRO-SAF SECTION.
       PCP-PRO-ACT SECTION.
       PCP-PRO-VAL SECTION.
       PCP-PRO-VKY SECTION.
       PCP-PRO-VDA SECTION.
       PCP-PRO-ING SECTION.
       PCP-PRO-MOD SECTION.
       PCP-PRO-ELI SECTION.
       PCP-PRO-CON SECTION.
       PCP-PRO-CO2 SECTION.
       PCP-PRO-PF7 SECTION.
       PCP-PRO-AC7 SECTION.
       PCP-PRO-PF8 SECTION.
       PCP-PRO-AC8 SECTION.
       PCP-PRO-CUR SECTION.
       COPY COLB6CAN.
       PROCESA-PCP SECTION.
       INI-PROCESA-PCP.
           PERFORM COL-PRO-PCP.
           IF PCP-RETO = WCC-1
              MOVE SPACES TO PCP
              GO TO FIN-PROCESA-PCP.
       FIN-PROCESA-PCP.
           EXIT.

       BUS-DAT-COM SECTION.
       INI-BUS-DAT-COM.
           MOVE ZEROES TO CAN-SGV-GAST IN CAN
           MOVE WCC-COM-KEY         TO FIO-AKEY
           MOVE OPC-CIC-IOPC IN OPC TO COM-CIC-IOPC IN COM
           MOVE ZEROES              TO COM-NUM-ICAN IN COM
           MOVE SPACES              TO COM-CIC-IOPV IN COM
           MOVE ZEROES              TO COM-NUM-IVCT IN COM
           MOVE WCC-FLV             TO COM-IND-TTAS IN COM
           MOVE ZEROES              TO COM-FEC-FINI IN COM
           MOVE FIO-GET-NLS TO FIO-CMND
           PERFORM COL-FIO-COM
           IF NOT ( FIO-STAT-OKS AND
              COM-CIC-IOPC IN COM = OPC-CIC-IOPC IN OPC AND
              COM-NUM-ICAN IN COM = ZEROES              AND
              COM-CIC-IOPV IN COM = SPACES              AND
              COM-NUM-IVCT IN COM = ZEROES              AND
              COM-IND-TTAS IN COM = WCC-FLV )
              MOVE WCC-23    TO FIO-STAT
              MOVE ZEROES TO COM-SGV-TINT IN COM.

           MOVE COM-SGV-TINT IN COM TO COM-SGV-TINT IN CAN-FLD
           MOVE ZEROES              TO WSS-SGV-CACU
           MOVE ZEROES              TO CAN-NUM-PLCO IN CAN-FLD
           MOVE OPC-CAI-IOPC IN OPC TO CAN-CAI-IOPC IN CAN-FLD
           MOVE OPC-IIC-IOPC IN OPC TO CAN-IIC-IOPC IN CAN-FLD
           MOVE WCC-001             TO CAN-NUM-ICAN IN CAN-FLD
           MOVE OPC-COD-OFOC IN OPC TO CAN-COD-OFCA IN CAN-FLD
           MOVE OPC-FEC-FCOL IN OPC(WCC-7:WCC-2) TO
                           CAN-FEC-FCAN IN CAN-FLD(WCC-1:WCC-2)
           MOVE OPC-FEC-FCOL IN OPC(WCC-5:WCC-2) TO
                           CAN-FEC-FCAN IN CAN-FLD(WCC-3:WCC-2)
           MOVE OPC-FEC-FCOL IN OPC(WCC-1:WCC-4) TO
                           CAN-FEC-FCAN IN CAN-FLD(WCC-5:WCC-4)
           MOVE ZEROES              TO CAN-SGV-TPAG IN CAN-FLD
           MOVE ZEROES              TO CAN-SGV-TREN IN CAN-FLD
           MOVE ZEROES              TO CAN-SGV-COMI IN CAN-FLD
           MOVE SPACES              TO DBC-NUM-ICLI IN CAN-FLD
           MOVE WCC-T               TO SCR-MSC-FCAN
           MOVE WCC-E               TO SCR-MSC-ECAN
           MOVE ZEROES              TO SCR-SGV-INTN
           MOVE ZEROES              TO PCP-SUVP
           IF COM-SGV-TINT IN CAN-FLD > ZEROES
               PERFORM LEE-PLAN-COMI-CAN
           ELSE
               MOVE ZEROES TO WSS-VAL-COMI IN WSS-CDP
                              WSS-VAL-COMI IN WSS-C1V.
       FIN-BUS-DAT-COM.
           EXIT.

      *AJA-FIN 18-ABR-2018 INCORPORAR COM BEX - 53882

       DET-PLC-SCRE SECTION.
       INI-DET-PLC-SCRE.
           MOVE ZEROES              TO PLC-VAL-SCR2 IN PLC-VARI.
           IF PLC-IND-COB IN PLC-VARI NOT = 'S'
               GO TO FIN-DET-PLC-SCRE.
           IF VEN-NUM-IVCT IN VEN = 1
               MOVE OPC-VAL-CRED IN OPC TO PLC-VAL-SCRE IN PLC-VARI
               MOVE OPC-FEC-FCOL IN OPC TO PLC-CXE-FVEN IN PLC-VARI
               MOVE VEN-FEC-FVEN IN VEN TO PLC-FEC-FCAN IN PLC-VARI
               GO TO FIN-DET-PLC-SCRE.
           MOVE OPC-FEC-FCOL IN OPC TO PLC-CXE-FVEN IN PLC-VARI
           MOVE ZEROES              TO PLC-VAL-SCR2 IN PLC-VARI.
           MOVE OPC-VAL-CRED IN OPC TO PLC-VAL-SCRE.
           MOVE ZEROES  TO VEN-NUM-IVEN IN VEN.
           MOVE OPC-CIC-IOPC TO VEN-CIC-IOPC IN VEN.
           MOVE FIO-GET-NLS  TO FIO-CMND.
       LUP-DET-PLC-SCRE.
           IF OPC-IND-VSTR IN OPC = 'N'
              PERFORM COL-FIO-VEN
              IF FIO-STAT-OKS AND
                 OPC-CIC-IOPC = VEN-CIC-IOPC IN VEN
                  IF VEN-NUM-IVCT IN VEN NOT < FRM-NUM-IVEN IN PLA-FLD
           MOVE VEN-FEC-FVEN IN VEN TO PLC-FEC-FCAN IN PLC-VARI
                      GO TO FIN-DET-PLC-SCRE
                  ELSE
           MOVE VEN-FEC-FVEN IN VEN TO PLC-CXE-FVEN IN PLC-VARI
                      COMPUTE PLC-VAL-SCRE = PLC-VAL-SCRE -
                              VEN-VAL-CAPI IN VEN
              ELSE
                  MOVE '00' TO FIO-STAT
                  GO TO FIN-DET-PLC-SCRE
           ELSE
              MOVE HOY-DHOY TO VEN-DTBS
              MOVE HOY-MHOY TO VEN-MTBS
              MOVE HOY-SHOY TO VEN-STBS
              MOVE HOY-AHOY TO VEN-ATBS
              MOVE 'S'      TO VEN-KEST
              PERFORM COL-OBT-VEN
              IF VEN-STAT-OKS AND
                 OPC-CIC-IOPC = VEN-CIC-IOPC IN VEN
                  IF VEN-NUM-IVCT IN VEN NOT < FRM-NUM-IVEN IN PLA-FLD
           MOVE VEN-FEC-FVEN IN VEN TO PLC-FEC-FCAN IN PLC-VARI
                      GO TO FIN-DET-PLC-SCRE
                  ELSE
           MOVE VEN-FEC-FVEN IN VEN TO PLC-CXE-FVEN IN PLC-VARI
                      COMPUTE PLC-VAL-SCRE = PLC-VAL-SCRE -
                              VEN-VAL-CAPI IN VEN
              ELSE
                    MOVE '00' TO FIO-STAT
                    GO TO FIN-DET-PLC-SCRE.
           MOVE FIO-GET-NXT  TO FIO-CMND.
           IF WSS-CON-VEN NOT < WSS-IVEN-MAS1
                MOVE 'N' TO VEN-INIT
               GO TO LUP-DET-PLC-SCRE
           ELSE
               GO TO LUP-DET-PLC-SCRE.
       FIN-DET-PLC-SCRE.
           EXIT.
       EDT-FLD-QUE SECTION.
       INI-EDT-FLD-QUE.
           MOVE PLA-WSS-NUM-IVCT  TO
                FRM-NUM-IVCT-EDT IN PLA-EDT.
           MOVE FRM-NUM-IVCT-EDT IN PLA-EDT TO
                PLB-WSS-NUM-IVCT-ALF

           MOVE PLA-WSS-IND-CANC TO PLB-WSS-IND-CANC.
           MOVE PLA-WSS-FEC-FVEN TO PLB-WSS-FEC-FVEN.

           MOVE PLA-WSS-VAL-IMPC  TO
                FRM-VAL-IMPC-EDT IN PLA-EDT.
           MOVE FRM-VAL-IMPC-EDT IN PLA-EDT TO
                PLB-WSS-VAL-IMPC-ALF

           MOVE PLA-WSS-VAL-COMC TO
                FRM-VAL-COMC-EDT IN PLA-EDT.
           MOVE FRM-VAL-COMC-EDT IN PLA-EDT TO
                PLB-WSS-VAL-COMC-ALF.

           MOVE PLA-WSS-VAL-SEGC TO
                FRM-VAL-SEGC-EDT IN PLA-EDT.
           MOVE FRM-VAL-SEGC-EDT IN PLA-EDT TO
                PLB-WSS-VAL-SEGC-ALF.

           MOVE PLA-WSS-VAL-GASC TO
                FRM-VAL-GASC-EDT IN PLA-EDT.
           MOVE FRM-VAL-GASC-EDT IN PLA-EDT TO
                PLB-WSS-VAL-GASC-ALF.

           MOVE PLA-WSS-VAL-INTC  TO
                FRM-VAL-INTC-EDT IN PLA-EDT.
           MOVE FRM-VAL-INTC-EDT IN PLA-EDT TO
                PLB-WSS-VAL-INTC-ALF.

           MOVE PLA-WSS-VAL-SCAP TO
                FRM-VAL-SCAP-EDT IN PLA-EDT.
           MOVE FRM-VAL-SCAP-EDT IN PLA-EDT TO
                PLB-WSS-VAL-SCAP-ALF.

           MOVE PLA-WSS-VAL-TOTA TO
                FRM-VAL-TOTA-EDT IN PLA-EDT.
           MOVE FRM-VAL-TOTA-EDT IN PLA-EDT TO
                PLB-WSS-VAL-TOTA-ALF.
       FIN-EDT-FLD-QUE.
           EXIT.
       PRO-FLD-QUE SECTION.
       INI-PRO-FLD-QUE.
           MOVE 'P' TO PLB-WSS-NUM-IVCT-ATR.
           MOVE 'P' TO PLB-WSS-IND-CANC-ATR.
           MOVE 'P' TO PLB-WSS-FEC-FVEN-ATR.
           MOVE 'P' TO PLB-WSS-VAL-COMC-ATR.
           MOVE 'P' TO PLB-WSS-VAL-INTC-ATR.
           MOVE 'P' TO PLB-WSS-VAL-SCAP-ATR.
           MOVE 'P' TO PLB-WSS-VAL-IMPC-ATR.
           MOVE 'P' TO PLB-WSS-VAL-SEGC-ATR.
           MOVE 'P' TO PLB-WSS-VAL-GASC-ATR.
           MOVE 'P' TO PLB-WSS-VAL-TOTA-ATR.
       FIN-PRO-FLD-QUE.
           EXIT.

      *AFRI-INI/FEB-2015/PLATAFORMA UNICA
       PRE-IFR SECTION.
       INI-PRE-IFR.

           MOVE OPC-COD-TOOC IN OPC TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM COL-FIO-TOC.
           IF NOT FIO-STAT-OKS
               MOVE 'TEFNO TOCOPC'  TO MSG-COD-MENS IN MSG
               GO TO FIN-PRE-IFR.

           MOVE 'COL'               TO MSC-COD-SIST FIO-SIST.
           MOVE 'OPEC'              TO MSC-COD-TMSC IN MSC.
           MOVE TOC-MSC-OPEC IN TOC TO MSC-COD-CMSC IN MSC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
               MOVE 'TEFNO TOCMSC'  TO MSG-COD-MENS IN MSG
               GO TO FIN-PRE-IFR.

           MOVE MSC-CIC-CMSC IN MSC TO WSS-OPEC IN WSS-VARI.
           IF WSS-OPEC NOT = 'P'
               MOVE 'S' TO SCR-IERR
               MOVE 'TEF TIPONVAL' TO MSG-COD-MENS IN MSG
               GO TO FIN-PRE-IFR.

      *--------------  TASA DE EFECTIVA  ---------------------------*
           MOVE OPC-CIC-IOPC IN OPC TO ITR-CIC-IOPC IN ITR.
           MOVE ZEROES              TO ITR-NUM-ICAN IN ITR.
           MOVE SPACES              TO ITR-CIC-IOPV IN ITR.
           MOVE ZEROES              TO ITR-NUM-IVCT IN ITR.
           MOVE 'TEF'               TO ITR-IND-TTAS IN ITR.
           MOVE ZEROES              TO ITR-FEC-FINI IN ITR.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ITR.
           IF FIO-STAT-OKS AND
              ITR-CIC-IOPC IN ITR = OPC-CIC-IOPC IN OPC AND
              ITR-NUM-ICAN IN ITR = ZEROES              AND
              ITR-CIC-IOPV IN ITR = SPACES              AND
              ITR-NUM-IVCT IN ITR = ZEROES              AND
              ITR-IND-TTAS IN ITR = 'TEF'
               IF ITR-COD-CVTI IN ITR > SPACES
                   MOVE ITR-SGV-SPRD IN ITR TO ITR-SGV-TINT IN ITR
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE '23' TO FIO-STAT.

           MOVE FIO-STAT TO PGM-STAT-ITR.

       FIN-PRE-IFR.
           EXIT.


       PUT-IFR SECTION.
       INI-PUT-IFR.

           MOVE WSS-PLA-TERM-ALF TO QUE-TERM
           MOVE 'GPLA'           TO QUE-TYPE.
           MOVE QUE-DEL          TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           ADD 1 OPC-NUM-IVEN IN OPC GIVING WSS-IVEN-MAS1.
           MOVE 1             TO FRM-IFLD.
           MOVE 1             TO WSS-CON-VEN.
           MOVE 1             TO SCR-NUM-PANT.
           MOVE LOW-VALUES    TO PLA-WSS-NUM-IVCT-IDX.
           MOVE ZEROES        TO PLA-WSS-NUM-IVCT
                                 PLA-WSS-VAL-IMPC
                                 PLA-WSS-VAL-COMC
                                 PLA-WSS-VAL-SEGC
                                 PLA-WSS-VAL-GASC
                                 PLA-WSS-VAL-INTC
                                 PLA-WSS-VAL-SCAP
                                 PLA-WSS-VAL-TOTA.

           PERFORM GET-FHOY.

           MOVE ZEROES        TO VEI-NUM-IVEI IN VEI.
           MOVE OPC-CIC-IOPC  TO VEI-CIC-IOPC IN VEI.
           MOVE FIO-GET-NLS   TO FIO-CMND.
       LUP-PUT-IFR.
           MOVE HOY-DHOY TO VEI-DTBS
           MOVE HOY-MHOY TO VEI-MTBS
           MOVE HOY-SHOY TO VEI-STBS
           MOVE HOY-AHOY TO VEI-ATBS
           MOVE 'S'      TO VEI-KEST
           PERFORM COL-OBT-VEI
           IF VEI-STAT-OKS AND
              OPC-CIC-IOPC = VEI-CIC-IOPC IN VEI
                 PERFORM PUT-IFR-PLA
                 PERFORM PUT-PLA-QUE
                 ADD 1 TO WSS-CON-VEN
                 ADD 1 TO FRM-IFLD
           ELSE
                 MOVE '00' TO FIO-STAT
                 GO TO FIN-PUT-IFR.

           MOVE FIO-GET-NXT  TO FIO-CMND.
           IF WSS-CON-VEN NOT < WSS-IVEN-MAS1
                MOVE 'N' TO VEI-INIT
                GO TO LUP-PUT-IFR
           ELSE
              GO TO LUP-PUT-IFR.

       FIN-PUT-IFR.
           IF WSS-NITM > WSS-IMAX
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'PLAVENDMAS' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2.

       EXT-PUT-IFR.
           EXIT.
      *--------------------------------------------
       PUT-IFR-PLA SECTION.
       INI-PUT-IFR-PLA.

           MOVE ZEROES              TO PLA-WSS-VAL-COMC.
           MOVE VEI-NUM-IVCT IN VEI TO PLA-WSS-NUM-IVCT.
           MOVE VEI-NUM-DVEI IN VEI TO PLA-WSS-NUM-DVEN.
           MOVE VEI-NUM-MVEI IN VEI TO PLA-WSS-NUM-MVEN.
           MOVE VEI-NUM-SVEI IN VEI TO PLA-WSS-NUM-SVEN.
           MOVE VEI-NUM-AVEI IN VEI TO PLA-WSS-NUM-AVEN.
           MOVE VEI-VAL-ICAP IN VEI TO PLA-WSS-VAL-SCAP.
           MOVE VEI-VAL-FINA IN VEI TO PLA-WSS-VAL-TOTA.
           COMPUTE PLA-WSS-VAL-INTC = PLA-WSS-VAL-TOTA -
                                      PLA-WSS-VAL-SCAP.

           MOVE ZEROES              TO WSS-VAL-COMI IN WSS-VARI.
      *MHM-INI 11-OCT-2011 PENTA
           IF OPC-VAL-SCRE IN OPC > ZEROES
               IF VEI-NUM-IVCT IN VEI < OPC-NUM-IVEN IN OPC
                   MOVE 'C' TO PLA-WSS-IND-CANC
               ELSE
                   MOVE SPACES TO PLA-WSS-IND-CANC
           ELSE
               MOVE 'C' TO PLA-WSS-IND-CANC.
      *MHM-FIN 11-OCT-2011 PENTA
           IF FRM-IFLD NOT > WSS-IMAX
               MOVE PLA-WSS-NUM-IVCT-IDX TO FRM-NUM-IVCT-IDX(FRM-IFLD).

       FIN-PUT-IFR-PLA.
           EXIT.
      *AFRI-FIN/FEB-2015/PLATAFORMA UNICA
      *OGB-INI 01-JUL-2016 BACKVALUE
       VAL-BACKVALUE SECTION.
       INI-VAL-BACKVALUE.
           MOVE WSS-CT-N  TO WSS-IND-DESC-INT.
           MOVE SPACES    TO WSS-GLS-PLZBV.
           MOVE SPACES    TO WSS-GLS-MTOBV.
           MOVE SPACES    TO WSS-IND-TAUT.

           PERFORM OBT-CIC-MONE.
           IF MSG-COD-MENS > SPACES
              GO TO FIN-VAL-BACKVALUE.

      *VALIDA TIOAUX
           MOVE WSS-CT-COL          TO TAB-COD-SIST.
           MOVE WSS-CT-COL          TO FIO-SIST.
           MOVE WSS-CT-CBV          TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-COOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND
                    TAB-IND-VIGE  = WSS-CT-S )
               MOVE WSS-CT-N TO WSS-IND-DESC-INT
               GO TO FIN-VAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           MOVE TAB-GLS-DATA IN TAB TO WSS-BCK-AUX-CBV.

           PERFORM VAL-BCK-MONTO.
           IF MSG-COD-MENS > SPACES
              MOVE WSS-CT-N TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.
           PERFORM VAL-BCK-PLAZO.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE


      *VALIDA DIFERENCIA DE FECHAS > 1
           IF OPC-FEC-FCOL IN OPC = OPC-FEC-FINP IN OPC
               MOVE WSS-CT-N TO WSS-IND-DESC-INT
               GO TO FIN-VAL-BACKVALUE.

      *VALIDA QUE NO SEAN PRORROGAS NI RENOVACIONES, ESTADO = ACA
      * Y PRIMER VENCIMIENTO
           IF OPC-IND-RENO IN OPC     = WSS-CT-PRO OR WSS-CT-REN
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

           IF OPC-MSC-STAT IN OPC  NOT = WSS-CT-A
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

           IF VEN-NUM-IVEN IN VEN  NOT = WSS-CT-1
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *    IF OPC-COD-VCOC IN OPC  NOT = WSS-COD-PESO
      *       MOVE WSS-CT-N   TO WSS-IND-DESC-INT
      *       GO TO FIN-VAL-BACKVALUE.

      *VALIDA CREDITOS RENEGOCIADOS - BUSCA EN DESTINO
       VAL-RENEGOCIADO-DES.

           MOVE 'COL'             TO TAB-COD-SIST FIO-SIST.
           MOVE 'DES'             TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-CDOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              GO TO FIN-VAL-BACKVALUE.

           IF TAB-GLS-DATA IN TAB(17:1) = WSS-CT-S
               MOVE WSS-CT-N TO WSS-IND-DESC-INT
               GO TO FIN-VAL-BACKVALUE.

      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

      *DESCARTA OPERACIONES TASA VARIABLE
           MOVE OPC-CAI-IOPC IN OPC TO ICG-CAI-IOPC IN ICG.
           MOVE OPC-IIC-IOPC IN OPC TO ICG-IIC-IOPC IN ICG.
           MOVE ZEROES              TO ICG-NUM-ICAN IN ICG.
           MOVE SPACES              TO ICG-CIC-IOPV IN ICG.
           MOVE ZEROES              TO ICG-NUM-IVCT IN ICG.
           MOVE WSS-CT-INT          TO ICG-IND-TTAS IN ICG.
           MOVE ZEROES              TO ICG-FEC-FINI IN ICG.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-ICG.
           IF NOT ( FIO-STAT-OKS AND
                    ICG-CAI-IOPC IN ICG = OPC-CAI-IOPC IN OPC AND
                    ICG-IIC-IOPC IN ICG = OPC-IIC-IOPC IN OPC AND
                    ICG-NUM-ICAN IN ICG = ZEROES AND
                    ICG-CIC-IOPV IN ICG = SPACES AND
                    ICG-NUM-IVCT IN ICG = ZEROES AND
                    ICG-IND-TTAS IN ICG = WSS-CT-INT )
                    MOVE WSS-CT-N  TO WSS-IND-DESC-INT
                    GO TO FIN-VAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *    IF ICG-COD-CVTI IN ICG > SPACES
      *       MOVE WSS-CT-N  TO WSS-IND-DESC-INT
      *       GO TO FIN-VAL-BACKVALUE.
           IF ICG-COD-CVTI IN ICG NOT > SPACES
              GO TO NO-TASA-VAR.

      * TASA VARIABLE (RESPECTO AL CURSE)
      *  -VALIDA QUE PERIORO DE RESPACTO TASA VARIABLE NO SEA MENOR AL
      *   PERIODO DEL PRIMER VENCIMIENTO
      *
      * DIFRENCIA DE DIAS ENTRE PRIMER VENCIMIENTO Y CURSE
      * LEE VEN PARA OBTENER PLAZO
           MOVE OPC-CAI-IOPC IN OPC   TO VEN-CAI-IOPC IN VEN.
           MOVE OPC-IIC-IOPC IN OPC   TO VEN-IIC-IOPC IN VEN.
           MOVE OPC-NUM-IVEN IN OPC   TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY           TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE VEN-NUM-DVEN IN VEN TO FEC-DEC2.
           MOVE VEN-NUM-MVEN IN VEN TO FEC-MEC2.
           MOVE VEN-NUM-SVEN IN VEN TO FEC-SEC2.
           MOVE VEN-NUM-AVEN IN VEN TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

           MOVE FEC-NDIA TO WSS-DIF-DVEN IN WSS-VARI.
      * DETERMINA EL PERIODO DE REPACTO EN DIAS PARA TASA
      * RESPECTO AL CURSE
           IF ICG-MSC-TFPR IN ICG = WSS-CT-C
              PERFORM ICG-PER-REPACTO-DIAS
              IF NOT FEC-STAT-OKS
                 MOVE WSS-CT-N   TO WSS-IND-DESC-INT
                 GO TO FIN-VAL-BACKVALUE
              ELSE
                 MOVE FEC-NDIA TO WSS-DIF-DICG IN WSS-VARI
                 IF WSS-DIF-DICG IN WSS-VARI < WSS-DIF-DVEN IN WSS-VARI
                    MOVE WSS-CT-N  TO WSS-IND-DESC-INT
                    GO TO FIN-VAL-BACKVALUE.

       NO-TASA-VAR.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

      *PLAZO (DIFERENCIA DIAS ENTRE ACTIVACION Y LIQUIDACION)
           MOVE WSS-CT-COL    TO FIO-SIST.
           MOVE WSS-CT-VSN    TO TAB-COD-TTAB IN TAB.
           MOVE 'PLZBCKVALUE' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
              MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-PLZBV.

           IF WSS-NUM-PMIN IS NOT NUMERIC OR
              WSS-NUM-PMAX IS NOT NUMERIC
              MOVE WSS-CT-N  TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           IF WSS-BCK-IND-PZO = WSS-CT-S
              MOVE WSS-BCK-NUM-PMIN TO WSS-NUM-PMIN
              MOVE WSS-BCK-NUM-PMAX TO WSS-NUM-PMAX.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE


      *MONTO INTERESES MINIMO, MAXIMO Y TOPE
      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO
              GO TO MTOBCK-PESOS.

           MOVE WSS-CT-COL    TO FIO-SIST.
           MOVE WSS-CT-VSN    TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-VCOC IN OPC TO WSS-COD-MNDBV.
           MOVE WSS-COD-MTBV  TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
              MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-LMMT
              IF WSS-SGV-LMMT-MMIN IS NOT NUMERIC OR
                 WSS-SGV-LMMT-MMAX IS NOT NUMERIC
                 MOVE WSS-CT-N  TO WSS-IND-DESC-INT
                 GO TO FIN-VAL-BACKVALUE
              ELSE
                 GO TO CON-VAL-BACKVALUE
           ELSE
              MOVE WSS-CT-N  TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

       MTOBCK-PESOS.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE


           MOVE WSS-CT-COL    TO FIO-SIST.
           MOVE WSS-CT-VSN    TO TAB-COD-TTAB IN TAB.
           MOVE 'MTOBCKVALUE' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
              MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-MTOBV.

           IF WSS-NUM-MMNM IS NOT NUMERIC OR
              WSS-NUM-MMAX IS NOT NUMERIC
              MOVE WSS-CT-N  TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
           MOVE WSS-NUM-MMNM TO WSS-SGV-LMMT-MMIN.
           MOVE WSS-NUM-MMAX TO WSS-SGV-LMMT-MMAX.


       CON-VAL-BACKVALUE.

      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

      *REVISA SI HAY AUTORIZACION Y EL TIPO
      *SI HAY, ENTONCES SE SALTAN LAS SGTES VALIDACIONES
           MOVE SPACES TO OIA.
           MOVE OPC-CAI-IOPC IN OPC    TO OIA-CAI-IOPC IN OIA.
           MOVE OPC-IIC-IOPC IN OPC    TO OIA-IIC-IOPC IN OIA.
           MOVE WSS-CT-ABV             TO OIA-COD-CPTO IN OIA.
           MOVE FIO-GET-KEY            TO FIO-CMND.
           PERFORM COL-FIO-OIA.
           IF FIO-STAT-OKS
              MOVE OIA-COD-OLIQ IN OIA TO WSS-IND-TAUT
              IF OIA-COD-OLIQ IN OIA = WSS-CT-DIN
                 MOVE WSS-CT-S    TO WSS-IND-DESC-INT
                 GO TO FIN-VAL-BACKVALUE
              ELSE
              IF OIA-COD-OLIQ IN OIA = WSS-CT-CIN
                 MOVE WSS-CT-N    TO WSS-IND-DESC-INT
                 GO TO FIN-VAL-BACKVALUE.

      *VALIDA PLAZO
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE OPC-NUM-DINP IN OPC TO FEC-DEC2.
           MOVE OPC-NUM-MINP IN OPC TO FEC-MEC2.
           MOVE OPC-NUM-SINP IN OPC TO FEC-SEC2.
           MOVE OPC-NUM-AINP IN OPC TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

           IF FEC-NDIA <  WSS-NUM-PMIN
              MOVE WSS-CT-N   TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

           IF FEC-NDIA >  WSS-NUM-PMAX
              MOVE WSS-CT-N TO WSS-IND-DESC-INT
              GO TO FIN-VAL-BACKVALUE.

           MOVE WSS-CT-S TO WSS-IND-DESC-INT.

       FIN-VAL-BACKVALUE.
           EXIT.
      *-----------------------------------------------
      *-----------------------------------------------
       CAL-BACKVALUE SECTION.
       INI-CAL-BACKVALUE.

      *OBTENEMOS TASA PERIODO
           MOVE OPC-CIC-IOPC IN OPC         TO INT-IOPC
           MOVE OPC-COD-VCOC IN OPC         TO INT-VCAM.
           MOVE OPC-NUM-DCOL IN OPC         TO INT-DCOL.
           MOVE OPC-NUM-MCOL IN OPC         TO INT-MCOL.
           MOVE OPC-NUM-SCOL IN OPC         TO INT-SCOL.
           MOVE OPC-NUM-ACOL IN OPC         TO INT-ACOL.
           MOVE WSS-CT-1                    TO INT-IDLC.
           MOVE OPC-NUM-DCOL IN OPC         TO INT-DUNO.
           MOVE OPC-NUM-MCOL IN OPC         TO INT-MUNO.
           MOVE OPC-NUM-SCOL IN OPC         TO INT-SUNO.
           MOVE OPC-NUM-ACOL IN OPC         TO INT-AUNO.
           MOVE OPC-NUM-DINP IN OPC         TO INT-DDOS.
           MOVE OPC-NUM-MINP IN OPC         TO INT-MDOS.
           MOVE OPC-NUM-SINP IN OPC         TO INT-SDOS.
           MOVE OPC-NUM-AINP IN OPC         TO INT-ADOS.
           MOVE OPC-NUM-DINP IN OPC         TO INT-DBTV.
           MOVE OPC-NUM-MINP IN OPC         TO INT-MBTV.
           MOVE OPC-NUM-SINP IN OPC         TO INT-SBTV.
           MOVE OPC-NUM-AINP IN OPC         TO INT-ABTV.

           PERFORM COL-CAL-INT.
           IF INT-CMSG > SPACES
              MOVE WSS-CT-N TO WSS-IND-DESC-INT
              GO TO FIN-CAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *    MULTIPLY INT-TIPE BY OPC-VAL-CRED IN OPC
      *             GIVING WSS-SGV-VINT.
      *    MOVE WSS-SGV-VINT TO PES-SGV-DECI IN PES-VARI.
      *    PERFORM PES-SCTV.
      *    MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-VINT.
           MULTIPLY INT-TIPE BY OPC-VAL-CRED IN OPC
                    GIVING WSS-SGV-VINT.

           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO
              MOVE WSS-SGV-VINT TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO WSS-SGV-VINT.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

      *VALIDA QUE DIFERENCIA DE INTERESES NO SEA MAYOR A INT 1ER VEN
           COMPUTE WSS-VAL-INT1 =   VEN-VAL-FINA IN VEN
                                  - VEN-VAL-CAPI IN VEN.

           IF WSS-SGV-VINT > WSS-VAL-INT1
              MOVE WSS-CT-N     TO WSS-IND-DESC-INT
              GO TO FIN-CAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *SI TIO-AUX TIENE LIMITE ESPECIFICO SE SOBRESCRIBE
           IF  WSS-BCK-IND-MTO = WSS-CT-S
               MOVE WSS-BCK-SGV-MMIN TO WSS-SGV-LMMT-MMIN
               MOVE WSS-BCK-SGV-MMAX TO WSS-SGV-LMMT-MMAX.

      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

      *VALIDA MTO INTERESES (MIN, MAX Y TOPE)
      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *    IF WSS-SGV-VINT < WSS-NUM-MMNM
           IF WSS-SGV-VINT < WSS-SGV-LMMT-MMIN
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
              IF WSS-IND-TAUT = WSS-CT-DIN
                 MOVE WSS-CT-S  TO WSS-IND-DESC-INT
                 GO TO FIN-CAL-BACKVALUE
              ELSE
                 MOVE WSS-CT-N  TO WSS-IND-DESC-INT
                 GO TO FIN-CAL-BACKVALUE.

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *    IF WSS-SGV-VINT > WSS-NUM-MMAX
           IF WSS-SGV-VINT > WSS-SGV-LMMT-MMAX
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
              IF WSS-IND-TAUT = WSS-CT-DIN
                 MOVE WSS-CT-S  TO WSS-IND-DESC-INT
                 GO TO FIN-CAL-BACKVALUE
              ELSE
              IF WSS-IND-TAUT = WSS-CT-CIN
                 MOVE WSS-CT-N  TO WSS-IND-DESC-INT
                 GO TO FIN-CAL-BACKVALUE
              ELSE
                 MOVE WSS-CT-N     TO WSS-IND-DESC-INT
                 GO TO FIN-CAL-BACKVALUE.

       FIN-CAL-BACKVALUE.
           EXIT.
      *--------------------------------------------------------------
      *--------------------------------------------------------------
       OBT-CIC-MONE SECTION.
       INI-OBT-CIC-MONE.
           MOVE SPACES                TO TAB-COD-CTAB IN TAB.
           MOVE WSS-CT-TAB            TO FIO-SIST.
           MOVE WSS-CT-VLR            TO TAB-CIC-TTAB IN TAB.
           MOVE WSS-CT-0999           TO TAB-CIC-CTAB IN TAB.
           MOVE WSS-CT-TABAKEY        TO FIO-AKEY.
           MOVE FIO-GET-KEY           TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT  FIO-STAT-OKS
              MOVE WSS-CT-CICPESO TO MSG-COD-MENS
              MOVE WSS-CT-COL     TO MSG-COD-SIST
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC   TO FRM-MENS
              MOVE WSS-CT-S       TO SCR-IERR
              GO TO FIN-OBT-CIC-MONE.

           MOVE TAB-COD-CTAB IN TAB   TO WSS-COD-PESO IN WSS-VARI.
       FIN-OBT-CIC-MONE.
           EXIT.
      *OGB-FIN 01-JUL-2016 BACKVALUE

      *OGB-INI 20-JUL-2017 BACKVALUE - UF TASA VARIABLE
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       ICG-PER-REPACTO-DIAS SECTION.
       INI-ICG-PER-REPACTO-DIAS.
           MOVE OPC-NUM-DCOL IN OPC TO FEC-ITM1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-ITM2.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-ITM3.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-ITM4.

           IF ICG-MSC-UTPR IN ICG = WSS-CT-D
               MOVE FEC-SUM-DIA  TO FEC-CMND
               MOVE ICG-NUM-PREP IN ICG TO FEC-NDIA
           ELSE
           IF ICG-MSC-UTPR IN ICG = WSS-CT-M
               MOVE FEC-SUM-MES TO FEC-CMND
               MOVE ICG-NUM-PREP IN ICG TO FEC-NMES
           ELSE
           IF ICG-MSC-UTPR IN ICG = WSS-CT-A
               MOVE FEC-SUM-ANO TO FEC-CMND
               MOVE ICG-NUM-PREP IN ICG TO FEC-NANO.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           PERFORM CAL-FEC.

      *OBTENEMOS LA DIFERENCIA EN DIAS
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE FEC-ITM1 TO FEC-DEC2.
           MOVE FEC-ITM2 TO FEC-MEC2.
           MOVE FEC-ITM3 TO FEC-SEC2.
           MOVE FEC-ITM4 TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.

       FIN-ICG-PER-REPACTO-DIAS.
           EXIT.
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       VAL-BCK-MONTO SECTION.
       INI-VAL-BCK-MONTO.

           IF WSS-BCK-IND-MTO NOT = WSS-CT-S
              GO TO FIN-VAL-BCK-MONTO.

           IF WSS-BCK-SGV-MMIN < ZEROES OR
              WSS-BCK-SGV-MMAX NOT > ZEROES OR
              WSS-BCK-COD-VCMT NOT > SPACES
              MOVE WSS-CT-N TO WSS-BCK-IND-MTO
              GO TO FIN-VAL-BCK-MONTO.

           IF WSS-BCK-SGV-MMIN IS NOT NUMERIC OR
              WSS-BCK-SGV-MMAX IS NOT NUMERIC
              MOVE WSS-CT-N TO WSS-BCK-IND-MTO
              GO TO FIN-VAL-BCK-MONTO.

           IF WSS-BCK-SGV-MMIN > WSS-BCK-SGV-MMAX
              MOVE WSS-CT-N TO WSS-BCK-IND-MTO
              GO TO FIN-VAL-BCK-MONTO.

           MOVE SPACES           TO TAB.
           MOVE 'TAB'            TO TAB-COD-SIST.
           MOVE 'VLR'            TO TAB-COD-TTAB IN TAB.
           MOVE WSS-BCK-COD-VCMT TO TAB-COD-CTAB IN TAB.
           MOVE TAB-COD-SIST     TO FIO-SIST.
           MOVE FIO-GET-KEY      TO FIO-CMND.
           MOVE WSS-CT-TABAKEY   TO FIO-AKEY.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              MOVE WSS-CT-N TO WSS-BCK-IND-MTO
              GO TO FIN-VAL-BCK-MONTO.

      *CONVERSION DE MONTOS A LA MONEDA DE LA OPERACION

      *SI ES MISMA MONEDA NO SE HACE NADA
           IF OPC-COD-VCOC IN OPC = WSS-BCK-COD-VCMT
              GO TO FIN-VAL-BCK-MONTO.

           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO
              MOVE WSS-BCK-COD-VCMT TO CAM-COD-VCAM IN CAM(1)
           ELSE
           IF WSS-BCK-COD-VCMT = WSS-COD-PESO
              MOVE OPC-COD-VCOC IN OPC TO CAM-COD-VCAM IN CAM(1)
           ELSE
              MOVE WSS-CT-TAB           TO MSG-COD-SIST
              MOVE WSS-CT-CAMNEX        TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC         TO FRM-MEN1
              GO TO FIN-VAL-BCK-MONTO.

           MOVE WSS-COD-PESO           TO CAM-COD-VCAM IN CAM(2).
           MOVE OPC-FEC-FINP IN OPC    TO CAM-FEC-FCAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT ( FIO-STAT-OKS AND CAM-IND-VIGE = WSS-CT-S)
              MOVE WSS-CT-TAB           TO MSG-COD-SIST
              MOVE WSS-CT-CAMNEX        TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC         TO FRM-MEN1
              GO TO FIN-VAL-BCK-MONTO.

           IF OPC-COD-VCOC IN OPC = WSS-COD-PESO IN WSS-VARI
              COMPUTE WSS-BCK-SGV-MMIN ROUNDED = WSS-BCK-SGV-MMIN *
                                         CAM-SGV-VCAM IN CAM
              COMPUTE WSS-BCK-SGV-MMAX ROUNDED = WSS-BCK-SGV-MMAX *
                                         CAM-SGV-VCAM IN CAM
              MOVE WSS-BCK-SGV-MMIN TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO WSS-BCK-SGV-MMIN

              MOVE WSS-BCK-SGV-MMAX TO PES-SGV-DECI IN PES-VARI
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE IN PES-VARI TO WSS-BCK-SGV-MMAX
           ELSE
           IF WSS-BCK-COD-VCMT    = WSS-COD-PESO IN WSS-VARI
              COMPUTE WSS-BCK-SGV-MMIN ROUNDED = WSS-BCK-SGV-MMIN /
                                         CAM-SGV-VCAM IN CAM
              COMPUTE WSS-BCK-SGV-MMAX ROUNDED = WSS-BCK-SGV-MMAX /
                                         CAM-SGV-VCAM IN CAM.

       FIN-VAL-BCK-MONTO.
           EXIT.
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       VAL-BCK-PLAZO SECTION.
       INI-VAL-BCK-PLAZO.

           IF WSS-BCK-IND-PZO NOT = WSS-CT-S
              GO TO FIN-VAL-BCK-PLAZO.

           IF WSS-BCK-NUM-PMIN < ZEROES OR
              WSS-BCK-IND-PMIN NOT > SPACES OR
              WSS-BCK-NUM-PMAX NOT > ZEROES OR
              WSS-BCK-IND-PMAX NOT > SPACES
              MOVE WSS-CT-N TO WSS-BCK-IND-PZO
              GO TO FIN-VAL-BCK-PLAZO.

           IF WSS-BCK-NUM-PMIN IS NOT NUMERIC OR
              WSS-BCK-NUM-PMAX IS NOT NUMERIC
              MOVE WSS-CT-N TO WSS-BCK-IND-PZO
              GO TO FIN-VAL-BCK-PLAZO.

           IF WSS-BCK-IND-PMIN NOT = WSS-CT-D AND WSS-CT-M AND WSS-CT-A
              OR
              WSS-BCK-IND-PMAX NOT = WSS-CT-D AND WSS-CT-M AND WSS-CT-A
              MOVE WSS-CT-N TO WSS-BCK-IND-PZO
              GO TO FIN-VAL-BCK-PLAZO.
      *
      *SE CONVIERTE PLAZO EN DIAS (PARA LOS POSTERIORES COMPARACIONES)
           IF WSS-BCK-IND-PMIN = WSS-CT-D AND
              WSS-BCK-IND-PMAX = WSS-CT-D
              GO TO FIN-VAL-BCK-PLAZO.

           IF WSS-BCK-IND-PMIN NOT = WSS-CT-D
              MOVE WSS-BCK-NUM-PMIN  TO WSS-NUM-NPER
              MOVE WSS-BCK-IND-PMIN  TO WSS-IND-NPER
              PERFORM CAL-PLAZO-DIAS
              MOVE WSS-NUM-NDIA TO WSS-BCK-NUM-PMIN
              MOVE WSS-CT-D     TO WSS-BCK-IND-PMIN.

           IF WSS-BCK-IND-PMAX NOT = WSS-CT-D
              MOVE WSS-BCK-NUM-PMAX  TO WSS-NUM-NPER
              MOVE WSS-BCK-IND-PMAX  TO WSS-IND-NPER
              PERFORM CAL-PLAZO-DIAS
              MOVE WSS-NUM-NDIA TO WSS-BCK-NUM-PMAX
              MOVE WSS-CT-D     TO WSS-BCK-IND-PMAX.

       FIN-VAL-BCK-PLAZO.
           EXIT.
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       CAL-PLAZO-DIAS SECTION.
       INI-CAL-PLAZO-DIAS.
           MOVE ZEROES  TO WSS-NUM-NDIA.
           MOVE OPC-NUM-DCOL IN OPC TO FEC-ITM1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-ITM2.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-ITM3.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-ITM4.

           IF WSS-IND-NPER = WSS-CT-D
               MOVE FEC-SUM-DIA  TO FEC-CMND
               MOVE WSS-NUM-NPER TO FEC-NDIA
           ELSE
           IF WSS-IND-NPER = WSS-CT-M
               MOVE FEC-SUM-MES TO FEC-CMND
               MOVE WSS-NUM-NPER TO FEC-NMES
           ELSE
           IF WSS-IND-NPER = WSS-CT-A
               MOVE FEC-SUM-ANO TO FEC-CMND
               MOVE WSS-NUM-NPER TO FEC-NANO.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           PERFORM CAL-FEC.

      *OBTENEMOS LA DIFERENCIA EN DIAS
           MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
           MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
           MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
           MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.

           MOVE FEC-ITM1 TO FEC-DEC2.
           MOVE FEC-ITM2 TO FEC-MEC2.
           MOVE FEC-ITM3 TO FEC-SEC2.
           MOVE FEC-ITM4 TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
              GO TO FIN-CAL-PLAZO-DIAS.

           MOVE FEC-NDIA TO WSS-NUM-NDIA.

       FIN-CAL-PLAZO-DIAS.
           EXIT.
      *----------------------------------------------------------------
      *----------------------------------------------------------------
       BCKVL-CONVIERTE-MOPE SECTION.
       INI-BCKVL-CONVIERTE-MOPE.
      *POR DEFECTO LA TABLA MTOBCKVALUE ESTA EN PESOS, EN CASO QUE LA
      *OPERACION NO ESTE EN PESOS, SE DEBE PASAR A LA MONEDA DE LA OPE

           MOVE OPC-COD-VCOC IN OPC    TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO           TO CAM-COD-VCAM IN CAM(2).
           MOVE OPC-FEC-FINP IN OPC    TO CAM-FEC-FCAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1) TO CAM-FEC-FCAM IN CAM(2).

           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT ( FIO-STAT-OKS AND CAM-IND-VIGE = WSS-CT-S)
              MOVE WSS-CT-TAB           TO MSG-COD-SIST
              MOVE WSS-CT-CAMNEX        TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE WSS-CT-S             TO SCR-IERR
              MOVE WSS-CT-N             TO WSS-IND-DESC-INT
              MOVE MSG-GLS-DESC         TO FRM-MEN1
              GO TO FIN-BCKVL-CONVIERTE-MOPE.

           COMPUTE WSS-SGV-LMMT-MMIN ROUNDED = WSS-SGV-LMMT-MMIN /
                                       CAM-SGV-VCAM IN CAM
           COMPUTE WSS-SGV-LMMT-MMAX ROUNDED = WSS-SGV-LMMT-MMAX /
                                       CAM-SGV-VCAM IN CAM.
       FIN-BCKVL-CONVIERTE-MOPE.
           EXIT.
      *OGB-FIN 20-JUL-2017 BACKVALUE - UF TASA VARIABLE

      *RRM-INI AGO-2019 MICROSERVICIO A01
       LEE-VSN-TXPLA SECTION.
       INI-LEE-VSN-TXPLA.
           MOVE WSS-CT-COL    TO FIO-SIST.
           MOVE WSS-CT-VSN    TO TAB-COD-TTAB IN TAB.
           MOVE EIBTRNID      TO WSS-COD-NTRN.
           MOVE WSS-COD-TXP   TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY   TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
       FIN-LEE-VSN-TXPLA.
           EXIT.

       INIC-FRM-VAL-IDX SECTION.
       INI-INIC-VAL-IDX.
           MOVE ZEROES TO FRM-VAL-COMC IN PLA-FLD(WNN-1).
           MOVE ZEROES TO FRM-VAL-COMC IN PLA-FLD(WNN-2).
           MOVE ZEROES TO FRM-VAL-COMC IN PLA-FLD(WNN-3).
           MOVE ZEROES TO FRM-VAL-COMC IN PLA-FLD(WNN-4).
           MOVE ZEROES TO FRM-VAL-INTC IN PLA-FLD(WNN-1).
           MOVE ZEROES TO FRM-VAL-INTC IN PLA-FLD(WNN-2).
           MOVE ZEROES TO FRM-VAL-INTC IN PLA-FLD(WNN-3).
           MOVE ZEROES TO FRM-VAL-INTC IN PLA-FLD(WNN-4).
           MOVE ZEROES TO FRM-VAL-SCAP IN PLA-FLD(WNN-1).
           MOVE ZEROES TO FRM-VAL-SCAP IN PLA-FLD(WNN-2).
           MOVE ZEROES TO FRM-VAL-SCAP IN PLA-FLD(WNN-3).
           MOVE ZEROES TO FRM-VAL-SCAP IN PLA-FLD(WNN-4).
           MOVE ZEROES TO FRM-VAL-IMPC IN PLA-FLD(WNN-1).
           MOVE ZEROES TO FRM-VAL-IMPC IN PLA-FLD(WNN-2).
           MOVE ZEROES TO FRM-VAL-IMPC IN PLA-FLD(WNN-3).
           MOVE ZEROES TO FRM-VAL-IMPC IN PLA-FLD(WNN-4).
           MOVE ZEROES TO FRM-VAL-SEGC IN PLA-FLD(WNN-1).
           MOVE ZEROES TO FRM-VAL-SEGC IN PLA-FLD(WNN-2).
           MOVE ZEROES TO FRM-VAL-SEGC IN PLA-FLD(WNN-3).
           MOVE ZEROES TO FRM-VAL-SEGC IN PLA-FLD(WNN-4).
           MOVE ZEROES TO FRM-VAL-GASC IN PLA-FLD(WNN-1).
           MOVE ZEROES TO FRM-VAL-GASC IN PLA-FLD(WNN-2).
           MOVE ZEROES TO FRM-VAL-GASC IN PLA-FLD(WNN-3).
           MOVE ZEROES TO FRM-VAL-GASC IN PLA-FLD(WNN-4).
           MOVE ZEROES TO FRM-VAL-TOTA IN PLA-FLD(WNN-1).
           MOVE ZEROES TO FRM-VAL-TOTA IN PLA-FLD(WNN-2).
           MOVE ZEROES TO FRM-VAL-TOTA IN PLA-FLD(WNN-3).
           MOVE ZEROES TO FRM-VAL-TOTA IN PLA-FLD(WNN-4).
       FIN-INIC-VAL-IDX.
           EXIT.
      *RRM-FIN AGO-2019 MICROSERVICIO A01
      *>>>>
