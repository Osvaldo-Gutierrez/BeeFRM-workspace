       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   COLPQQCP.
       AUTHOR.       AFRI.
       DATE-WRITTEN. 20-Sep-12 09:28 AM.

      * NOMBRE PROGRAMA                   COLPQQCP
      * VERSION PGM                       3.1
      * VERSION SKL                       07.08.21
      * OPCION                            CON
      * ARCHIVO BASE                      COLOPC
      * PANTALLA                          COLQCP
      * INP/OUT                           DATACOM
      * TAMANO COMMAREA                   250


       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.
       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
      * COPY GNSWGSCR.
       COPY GNSWGCVT.
       77  WSS-TAG-COLPQQCP-INI PIC X(125) VALUE                        
           '<IDNPGM NOM=$COLPQQCP$ SKL=$07.08.21$ VSN=$ $        
      -    'GEN=$20-Sep-12 09:28 AM$ FNC=$ $/>'.    

       COPY GNSWCSCR.
      *PTC-INI
      *PTC-SUB
      * COPY GNSWVSCR.
       COPY GNSWV3CR.
      *PTC-FIN
      *<<<< MI_COMMAREA                                                 
           03 CMA-VARI.                                                 
              05 SCR-IMAX      COMP                   PIC S9(04).       
              05 SCR-I         COMP                   PIC S9(04).            
      *>>>>      
       COPY COLWIQCP.

       COPY COLBROPC.


       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSWGFRM.
       COPY GNSWG3CF.
       COPY GNSWGTSK.
       COPY GNSWGQUE.
      *PTC-FIN
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGSYS.

      *<<<<    
       COPY COLWXQCP.                                                           
       COPY COLBRCAN.                                                           
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.                
       COPY COLBRRCV.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY COLBRIXT.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-IXT-REQA==.
       COPY COLBRROV.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY COLBRVEN.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY COLBRCYA.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY COLBRDLC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY COLBREVC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY COLBRTOC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY COLBRICG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY COLBRCXE.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CXE-REQA==.
       COPY GNSBRMSC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY COLWGVEN.
       COPY COLWGINT.
       COPY GNSWGPES.
       COPY TABBRCAM.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
                                                                                
       01  WSS-VARI.                                                            
           03 WSS-FEC-FCAN.                                                     
               05 WSS-NUM-DCAN                        PIC 9(02).                
               05 WSS-NUM-MCAN                        PIC 9(02).                
               05 WSS-NUM-SCAN                        PIC 9(02).                
               05 WSS-NUM-ACAN                        PIC 9(02).                

           03 WSS-FEC-FVEN.
               05 WSS-NUM-DVEN                        PIC 9(02).
               05 WSS-NUM-MVEN                        PIC 9(02).
               05 WSS-NUM-SVEN                        PIC 9(02).
               05 WSS-NUM-AVEN                        PIC 9(02).

           03 WSS-IND-ERCV                            PIC X(01).
           03 WSS-IND-EIXT                            PIC X(01).
           03 WSS-IND-EROV                            PIC X(01).
           03 WSS-IND-ECYA                            PIC X(01).
           03 WSS-IND-ECXE                            PIC X(01).

           03 WSS-IND-EQCP        VALUE ZEROES        PIC 9(04).
           03 WSS-IND-DATO        VALUE SPACES        PIC X(01).

           03 WSS-IND-TCYA.
               05 WSS-IND-TRAS    VALUE SPACES        PIC X(02).
               05 WSS-AUX-TRAS    VALUE SPACES        PIC X(03).

           03 WSS-GLS-CANC.
               05 WSS-GLS-TRAS    VALUE SPACES        PIC X(09).
               05 WSS-GLS-SCTB    VALUE SPACES        PIC X(10).

           03 WSS-IND-TMSC.
               05 WSS-IND-SCTB    VALUE SPACES        PIC X(04).
               05 WSS-IND-CANC    VALUE SPACES        PIC X(08).
      *>>>>
       01  PGM-VARI.
           03 PGM-ICLR                  VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-TODO          VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-LLAVES        VALUE 'K'       PIC X(01).
           03 PGM-LIMPIAR-CAMPOS        VALUE 'F'       PIC X(01).
           03 PGM-NO-LIMPIAR-NADA       VALUE 'N'       PIC X(01).
           03 PGM-PROG                                  PIC X(08).
           03 PGM-NTRN                                  PIC X(04).
           03 PGM-STAT.
              05 PGM-STAT-OPC.
                 88 PGM-STAT-OPC-NUL    VALUE '  '.
                 07 PGM-STT1-OPC        VALUE '2' PIC X(01).
                    88 PGM-STAT-OPC-OKS VALUE '0'.
                 07 PGM-STT2-OPC        VALUE '3' PIC X(01).
           03 PGM-SRNF                  VALUE '23'      PIC X(02).
           03 PGM-SOKS                  VALUE '00'      PIC X(02).
           03 PGM-SNUL                  VALUE '  '      PIC X(02).
           03 PGM-SUAR                  VALUE SPACES    PIC X(15).

       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 FILLER                    PIC X(270).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
       LUP-MAIN.
           IF SCR-INST = SCR-INST-HCM
                 PERFORM SCR-COM.
           IF SCR-CCPP = 'MOD'
                 PERFORM SCR-MOD
           ELSE
           IF SCR-CCPP = 'ING'
                 PERFORM SCR-ING
           ELSE
           IF SCR-CCPP = 'ACC'
                 PERFORM SCR-ACC
           ELSE
           IF SCR-CCPP = 'ELI'
                 PERFORM SCR-ELI
           ELSE
           IF SCR-CCPP = 'ACT'
                 PERFORM SCR-ACT
           ELSE
           IF SCR-CCPP = 'PGM'
                 PERFORM SCR-PGM
           ELSE
                 MOVE SCR-INST-HCM TO SCR-INST.
           GO TO LUP-MAIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
       COPY GNSBGEIB.
       COPY GNSBGEDB.
           MOVE LOW-VALUES TO QCP-FLD.
           MOVE LOW-VALUES TO QCP-EDT.
           PERFORM GNS-PRO-RCK.
           PERFORM GNS-BUS-VCA.
           MOVE +270 TO SCR-TCMA.
           PERFORM GNS-HDL-SYS.
           PERFORM GNS-HDL-FRM.
           MOVE 'COLPQQCP' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      *PTC-INI
           PERFORM GNS-ERR-QUE.
           PERFORM GET-TSK-TERM.
      *PTC-FIN
      *<<<< INI_FIO                                  
           IF SCR-OFRM-SRV                        
              MOVE TSK-TERM-ALF TO QCP-COD-TERM   
              MOVE TSK-TERM-ALF TO QCP-COD-TERM-MAS 
           ELSE                                     
              MOVE EIBTRMID     TO QCP-COD-TERM     
              MOVE EIBTRMID     TO QCP-COD-TERM-MAS.
      *>>>>                                         
       FIN-INI.
           EXIT.

       COPY GNSBHSYS.
       COPY GNSBHFRM.
       COPY GNSBPRCK.
       COPY GNSBBVCA.
       COPY GNSBBIDD.

       SCR-COM SECTION.
       INI-SCR-COM.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-QCP.
           PERFORM EDT-KEY-QCP.
           PERFORM EDT-FLD-QCP.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-HCM TO SCR-INST.
           MOVE SCR-CMNP     TO SYS-PROG.
           MOVE SCR-VARI     TO SYS-CMMA.
           MOVE SCR-TCMA     TO SYS-TCMA.
           MOVE SYS-XCTL     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       XCT-ERR.
           MOVE 'XCTERR    ' TO MSG-COD-MENS.
           MOVE 'GNS'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO SYS-MEN1.
           MOVE SYS-PROG     TO SYS-MEN2.
           MOVE SYS-ABOR     TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       COPY GNSBGGBK.
       FIN-SCR-COM.
           EXIT.

       SCR-MOD SECTION.
       INI-SCR-MOD.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-MOD
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-MOD.
           PERFORM DESSCRTRL.
       MSG-SCR-MOD.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-MOD.
           EXIT.

       BRW-SCR-MOD SECTION.
       INI-BRW-SCR-MOD.
       FIN-BRW-SCR-MOD.
           EXIT.

       SCR-ING SECTION.
       INI-SCR-ING.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-IKY
               MOVE SCR-INST-GKY TO SCR-INST
      *PTC-INI
               IF NOT SCR-OFRM-SRV
                   PERFORM SCR-DMSG
               ELSE
                   PERFORM SCR-PUTA
      *PTC-FIN
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-RST
                PERFORM GET-IKY
                IF NOT FRM-STAT-ABT
                        MOVE SPACES TO FRM-MENS
                        PERFORM FND-KEY
                        IF NOT FIO-STAT-OKS AND
                           FIO-STAT NOT = FIO-STAT-NEX
      *JSS                  PERFORM CLR-FLD-QCP
                            MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
                            PERFORM SCR-TRL
                        ELSE
      *PTC-INI
                        MOVE 'S' TO SCR-IERR
      *PTC-FIN
                        MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR
                        IF FRM-MENS NOT > SPACES
                            MOVE 'REGEXI    ' TO MSG-COD-MENS
                            MOVE 'GNS' TO MSG-COD-SIST
                            PERFORM GET-MSG
                            MOVE MSG-GLS-DESC TO FRM-MENS
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-ING
                        ELSE
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-ING
                ELSE
                        MOVE SPACES TO FRM-MENS
                        PERFORM SCR-MSSG
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ING
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON.
           PERFORM DESSCRTRL.
       MSG-SCR-ING.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ING.
           EXIT.

       SCR-ACC SECTION.
       INI-SCR-ACC.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ACC
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-ACC.
           PERFORM DESSCRTRL.
      *<<<< PFS_SCR_ACC                             
           IF FRM-FFLD = FRM-FFLD-PF6               
                    OR   FRM-FFLD-PF5               
               PERFORM VAL-NUM-KEY-QCP              
               PERFORM VAL-NUM-FLD-QCP              
               PERFORM RST-STAT                     
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY 
               IF SCR-STAT NOT = SCR-STAT-ABT       
                   PERFORM SCR-TRL                  
               ELSE                                 
                   PERFORM DESSCRTRL                
                   GO TO FIN-SCR-ACC.               
      *>>>>                                         
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ACC.
           EXIT.

       BRW-SCR-ACC SECTION.
       INI-BRW-SCR-ACC.
       FIN-BRW-SCR-ACC.
           EXIT.

       SCR-ELI SECTION.
       INI-SCR-ELI.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-KEY
                IF SCR-STAT NOT = SCR-STAT-ABT
                        PERFORM SCR-TRL
                ELSE
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ELI
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-ELI.
           PERFORM DESSCRTRL.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ELI.
           EXIT.

       BRW-SCR-ELI SECTION.
       INI-BRW-SCR-ELI.
       FIN-BRW-SCR-ELI.
           EXIT.

       SCR-ACT SECTION.
       INI-SCR-ACT.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-RST
                PERFORM GET-KEY
                IF NOT FRM-STAT-ABT
                        MOVE SPACES TO FRM-MENS
                        PERFORM FND-KEY
                        IF FIO-STAT-OKS
                            MOVE SCR-ACTU-MOD TO SCR-ACTU
                            PERFORM PUT-SCR
                            MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
                            PERFORM SCR-TRL
                        ELSE
                        MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR
                        IF FIO-STAT-EOF
                            IF FRM-MENS NOT > SPACES
                                MOVE 'REGEOF    ' TO MSG-COD-MENS
                                MOVE 'GNS' TO MSG-COD-SIST
                                PERFORM GET-MSG
                                MOVE MSG-GLS-DESC TO FRM-MENS
                                PERFORM SCR-MSSG
                                MOVE SCR-STAT-ABT TO SCR-STAT
                                PERFORM DESSCRTRL
                                GO TO FIN-SCR-ACT
                            ELSE
                                PERFORM SCR-MSSG
                                MOVE SCR-STAT-ABT TO SCR-STAT
                                PERFORM DESSCRTRL
                                GO TO FIN-SCR-ACT
                        ELSE
                        IF FIO-STAT = FIO-STAT-NEX
                            IF FRM-MENS NOT > SPACES
                                MOVE 'REGNEX    ' TO MSG-COD-MENS
                                MOVE 'GNS' TO MSG-COD-SIST
                                PERFORM GET-MSG
                                MOVE MSG-GLS-DESC TO FRM-MENS
                                PERFORM SCR-MSSG
                                MOVE SCR-STAT-ABT TO SCR-STAT
                                PERFORM DESSCRTRL
                                GO TO FIN-SCR-ACT
                            ELSE
                                PERFORM SCR-MSSG
                                MOVE SCR-STAT-ABT TO SCR-STAT
                                PERFORM DESSCRTRL
                                GO TO FIN-SCR-ACT
                        ELSE
                            MOVE SCR-ACTU-ING TO SCR-ACTU
      *JSS                  PERFORM CLR-FLD-QCP
                            MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
                            PERFORM SCR-TRL
                ELSE
                        MOVE SPACES TO FRM-MENS
                        PERFORM SCR-MSSG
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ACT
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-ACT.
           PERFORM DESSCRTRL.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ACT.
           EXIT.

       BRW-SCR-ACT SECTION.
       INI-BRW-SCR-ACT.
       FIN-BRW-SCR-ACT.
           EXIT.

       SCR-PGM SECTION.
       INI-SCR-PGM.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-KEY
               MOVE SCR-INST-GKY TO SCR-INST
               PERFORM SCR-DMSG
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-RST
                PERFORM GET-KEY
                IF FRM-STAT-ABT
                    MOVE SPACES TO FRM-MENS
                    PERFORM SCR-MSSG
                    PERFORM DESSCRTRL
                    GO TO FIN-SCR-PGM
                ELSE
                    MOVE SPACES TO FRM-MENS
                    PERFORM FND-KEY
                    IF FIO-STAT = FIO-STAT-NEX
                        IF FRM-MENS NOT > SPACES
                            MOVE 'REGNEX    ' TO MSG-COD-MENS
                            MOVE 'GNS' TO MSG-COD-SIST
                            PERFORM GET-MSG
                            MOVE MSG-GLS-DESC TO FRM-MENS
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-PGM
                        ELSE
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-PGM
                    ELSE
                        MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
                        PERFORM SCR-TRL
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON
           ELSE
           IF SCR-INST = SCR-INST-BRW
               MOVE SCR-FFLD TO FRM-FFLD
               PERFORM BRW-SCR-PGM.
       TRL-SCR-PGM.
           PERFORM DESSCRTRL.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-PGM.
           EXIT.

       BRW-SCR-PGM SECTION.
       INI-BRW-SCR-PGM.
       FIN-BRW-SCR-PGM.
           EXIT.

       SCR-DMSG SECTION.
       INI-SCR-DMSG.
           IF PGM-ICLR = PGM-NO-LIMPIAR-NADA
               NEXT SENTENCE
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-TODO
               PERFORM SCR-CLRA-QCP
               PERFORM EDT-KEY-QCP
               PERFORM EDT-FLD-QCP
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-LLAVES
               PERFORM CLR-KEY-QCP
               PERFORM EDT-KEY-QCP
           ELSE
               PERFORM CLR-FLD-QCP
               PERFORM EDT-FLD-QCP.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-DMSG.
           EXIT.

       SCR-KEY SECTION.
       INI-SCR-KEY.
           PERFORM SCR-RST.
           PERFORM GET-KEY.
           IF FRM-STAT-ABT
                   MOVE SPACES TO FRM-MENS
                   PERFORM SCR-MSSG
                   GO TO FIN-SCR-KEY.
       FND-SCR-KEY.
           MOVE SPACES TO FRM-MENS.
           PERFORM FND-KEY.
           IF FIO-STAT-OKS
               PERFORM PUT-SCR
               MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
               GO TO FIN-SCR-KEY.
      *JSS ELSE
      *        PERFORM CLR-FLD-QCP.
       ERR-SCR-KEY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR.
           IF FRM-MENS NOT > SPACES
               IF FIO-STAT-EOF
                   MOVE 'REGEOF    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
               IF FIO-STAT = FIO-STAT-NEX
                   MOVE 'REGNEX    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
           MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-SCR-KEY.
           EXIT.

       SCR-RST SECTION.
       INI-SCR-RST.
           MOVE SPACES       TO PGM-ICLR.
           MOVE SPACES       TO SCR-ACTU.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
           MOVE LOW-VALUES   TO QCP-FLD.
           MOVE LOW-VALUES TO QCP-EDT.
       FIN-SCR-RST.
           EXIT.

       GET-KEY SECTION.
       INI-GET-KEY.
           PERFORM SCR-GKEY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-KEY.
           EXIT.

       GET-IKY SECTION.
       INI-GET-IKY.
           PERFORM SCR-GIKY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-IKY.
           EXIT.

       FND-KEY SECTION.
       INI-FND-KEY.
      *<<<< INI_FND_KEY                                             
           MOVE SPACES TO FRM-MEN1.                                 
           IF (FRM-FFLD = FRM-FFLD-PF5 AND                          
            FRM-IND-HMAS IN QCP-FLD NOT = '-') OR                   
            (FRM-FFLD = FRM-FFLD-PF6 AND                            
            FRM-IND-HMAS IN QCP-FLD = '-')                          
               MOVE PGM-SNUL TO PGM-STAT-OPC                        
               SUBTRACT 1 FROM SCR-I GIVING QCP-I                   
               IF QCP-I NOT > ZEROES                                
                   MOVE 'CAN  OPCPRV' TO MSG-COD-MENS               
                   GO TO ERR-FND-KEY                                
               ELSE                                                 
                   GO TO CARGA-QCP                                  
           ELSE                                                     
           IF (FRM-FFLD = FRM-FFLD-PF6 AND                          
            FRM-IND-HMAS IN QCP-FLD NOT = '-') OR                   
            (FRM-FFLD = FRM-FFLD-PF5 AND                            
            FRM-IND-HMAS IN QCP-FLD = '-')                          
               MOVE PGM-SNUL TO PGM-STAT-OPC                        
               ADD 1 SCR-I GIVING QCP-I                             
               IF QCP-I > SCR-IMAX                                  
                   MOVE 'CAN  OPCNXT' TO MSG-COD-MENS               
                   GO TO ERR-FND-KEY                                
               ELSE                                                 
                   GO TO CARGA-QCP.                                 
      *>>>>                                                         
           PERFORM KEY-ALL-QCP.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF FIO-STAT-OKS
               MOVE OPC-STP-ITRN IN OPC TO SCR-UMOD.
           MOVE FIO-STAT TO PGM-STAT-OPC.
      *<<<< FIN_FND_KEY                                             
           IF NOT FIO-STAT-OKS                                      
               GO TO FIN-FND-KEY.                                   
       CON-FND-KEY.                                                 
           MOVE ZEROES TO SCR-IMAX.                                 
           MOVE 1 TO SCR-I.                                         
           MOVE '00' TO FIO-STAT.                                   
           PERFORM OBT-DAT-TS.                                      
           MOVE 1 TO SCR-I.                                         
           MOVE SCR-I TO QCP-I.                                     
       CARGA-QCP.                                                   
           MOVE SPACES TO MSG-COD-MENS.                             
           IF NOT SCR-OFRM-SRV                                      
           PERFORM PUT-TAB-QCP.                                     
           MOVE '00' TO FIO-STAT.                                   
           GO TO FIN-FND-KEY.                                       
       ERR-FND-KEY.                                                 
           MOVE SCR-STAT-CON TO SCR-STAT.                           
           MOVE 'COL'  TO MSG-COD-SIST.                             
           PERFORM GET-MSG.                                         
           MOVE MSG-GLS-DESC TO FRM-MEN1.                           
           MOVE '00' TO FIO-STAT.                                   
           GO TO FIN-FND-KEY.                                       
      *>>>>                                                         
       FIN-FND-KEY.
           IF FIO-STAT = FIO-STAT-NEX
               MOVE 'S' TO SCR-IERR.
       EXT-FND-KEY.
           EXIT.
 
       PUT-SCR SECTION.
       INI-PUT-SCR.
           IF PGM-STAT-OPC-OKS
               MOVE OPC-STP-ITRN IN OPC TO SCR-UMOD.
           PERFORM PUT-ALL-QCP.
       FIN-PUT-SCR.
           EXIT.

       STP-EXIT SECTION.
       INI-STP-EXIT.
           MOVE SCR-PROG TO PGM-PROG.
           MOVE SCR-NTRN TO PGM-NTRN.

           MOVE SCR-PROV TO SCR-PROG.
           MOVE SCR-NTRV TO SCR-NTRN.

           MOVE PGM-PROG TO SCR-PROV
           MOVE PGM-NTRN TO SCR-NTRV.
       FIN-STP-EXIT.
           EXIT.

       SCR-EXIT SECTION.
       INI-SCR-EXIT.
           MOVE 'P'      TO SCR-ICMN.
           MOVE SCR-NTRN TO SYS-NTRN.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-RTRN TO SYS-CMND.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           PERFORM GNS-PRO-SYS.
       FIN-SCR-EXIT.
           EXIT.

       SCR-PUTA SECTION.
       INI-SCR-PUTA.
      *PTC-INI
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE QCP-FLD TO FRM-DFLD.
           MOVE FRM-PUT-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-PUTA.
           EXIT.

       SCR-MSSG SECTION.
       INI-SCR-MSSG.
           IF FRM-MEN1 NOT > SPACES
               MOVE SPACES TO FRM-MEN1.
           IF FRM-MEN2 NOT > SPACES
               MOVE SPACES TO FRM-MEN2.
           MOVE FRM-MENS TO QCP-GLS-MENS.
       FIN-SCR-MSSG.
           EXIT.

       SCR-GKEY SECTION.
       INI-SCR-GKEY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-QCP
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO QCP-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GKEY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-QCP.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-QCP
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-QCP.
           PERFORM VAL-IKY-QCP.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-MKY-QCP.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-AKY-QCP.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-CON-KEY-QCP.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GKEY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-QCP.
       ERR-SCR-GKEY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-QCP.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GKEY.
           PERFORM SCR-MSSG.

       SCR-GIKY SECTION.
       INI-SCR-GIKY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-QCP
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO QCP-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GIKY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-QCP.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
      *PTC-INI
               MOVE 'S' TO SCR-IERR
      *PTC-FIN
               PERFORM SCR-MSSG
               PERFORM EDT-IKY-QCP
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-QCP.
           PERFORM VAL-IKY-QCP.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GIKY.
           PERFORM VAL-CON-IKY-QCP.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GIKY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-QCP.
       ERR-SCR-GIKY.
      *PTC-INI
           MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           PERFORM SCR-MSSG.
           PERFORM EDT-IKY-QCP.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GIKY.
           PERFORM SCR-MSSG.

       GET-CON SECTION.
       INI-GET-CON.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
      *<<<< PFS_GET_CON OR PFS_GET_ACC                              
           IF NOT (FRM-FFLD = FRM-FFLD-PF6                          
                         OR   FRM-FFLD-PF5)                         
      *>>>>                                                         
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO QCP-GLS-MEN2
               MOVE SCR-PRMT     TO QCP-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO QCP-FLD.
       FIN-GET-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.

       CLR-MSG SECTION.
       INI-CLR-MSG.
           MOVE SPACES TO QCP-GLS-MENS.
       FIN-CLR-MSG.
           EXIT.

       HBL-IKY SECTION.
       INI-HBL-IKY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE QCP-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO QCP-FLD
      * FLB  7-NOV-1994
               PERFORM CLR-KEY-QCP

               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO QCP-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO QCP-GLS-MENS.
           PERFORM PRO-MKY-QCP.
           PERFORM PRO-AKY-QCP.
           PERFORM UNP-IKY-QCP.
           PERFORM FST-KEY-QCP.
       FIN-HBL-IKY.
           EXIT.

       HBL-KEY SECTION.
       INI-HBL-KEY.
      *PTC-INI
           IF NOT SCR-OFRM-SRV
      *PTC-FIN
           IF SCR-DESDE-CMN
               MOVE QCP-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO QCP-FLD
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO QCP-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO QCP-GLS-MENS.
           PERFORM UNP-KEY-QCP.
           PERFORM FST-KEY-QCP.
       FIN-HBL-KEY.
           EXIT.

       HBL-FLD SECTION.
       INI-HBL-FLD.
           PERFORM PRO-IKY-QCP.
           PERFORM PRO-AKY-QCP.
           PERFORM UNP-MKY-QCP.
           PERFORM UNP-FLD-QCP.
           PERFORM FST-FLD-QCP.
       FIN-HBL-FLD.
           EXIT.

       FST-MSG SECTION.
       INI-FST-MSG.
           MOVE -1 TO QCP-GLS-MENS-LEN.
       FIN-FST-MSG.
           EXIT.

       PRO-ALL SECTION.
       INI-PRO-ALL.
           PERFORM PRO-KEY-QCP.
           PERFORM FST-MSG.
       FIN-PRO-ALL.
           EXIT.

       SCR-TRL SECTION.
       INI-SCR-TRL.
      *PTC-INI
           IF SCR-STAT NOT = SCR-STPP
               MOVE 'S' TO SCR-IERR.
      *PTC-FIN
           IF FRM-MEN1 NOT > SPACES
               MOVE SCR-PRMT TO FRM-MEN1.
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM HBL-FLD
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-QCP
               PERFORM EDT-FLD-QCP
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GFL TO SCR-INST
               PERFORM SCR-EXIT.
           IF SCR-STAT = SCR-STAT-SON
               PERFORM PRO-ALL
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-QCP
               PERFORM EDT-FLD-QCP
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GCS TO SCR-INST
               PERFORM SCR-EXIT.
      *ASUME SCR-STAT-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.
      *    MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-QCP.
           PERFORM EDT-FLD-QCP.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-GAB TO SCR-INST.
           PERFORM SCR-EXIT.
       FIN-SCR-TRL.
           EXIT.

       DESSCRTRL SECTION.
       INI-DESSCRTRL.
           MOVE SCR-VFLD-NOT TO SCR-VFLD.
           MOVE FRM-FFLD TO SCR-FFLD.
       FIN-DESSCRTRL.
           IF SCR-FFLD-PF10 OR SCR-FFLD-PF3
                 MOVE SCR-INST-HCM TO SCR-INST
           ELSE
                 MOVE SCR-INST-HKY TO SCR-INST.
       EXT-DESSCRTRL.
           EXIT.

      * PGM-EBR-ALL SECTION.
      * INI-PGM-EBR-ALL.
      *     MOVE 'GNS' TO FIO-SIST.
      *     MOVE FIO-EBR-ALL TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      * FIN-PGM-EBR-ALL.
      *     EXIT.

       COPY COLBQQCP.
       COPY GNSBVNUM.
       COPY COLBFOPC.
       COPY GNSBFMSG.
       COPY GNSBGSYS.
       COPY GNSBGDTC.
      *PTC-INI
      *PTC-SUB
      * ISP  10-MAY-2001 13:46:35 
      * COPY GNSBGFRM.
       COPY GNSBG3CF.
      *PTC-FIN
       COPY GNSBGMSG.
       COPY GNSBEKEY.
       COPY GNSBIABT.
       COPY GNSBBTAB.
       COPY GNSBFTAB.
       COPY GNSBEGLS.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
      *PTC-INI
       COPY GNSBGQUE.
       COPY GNSBGTSK.
      *PTC-FIN

      *<<<<
       COPY COLBFCAN.                                                         
       COPY COLBFRCV.
       COPY COLBFIXT.
       COPY COLBFCXE.
       COPY COLBFROV.
       COPY COLBFVEN.
       COPY COLBFCYA.
       COPY COLBFDLC.
       COPY COLBFEVC.
       COPY COLBFICG.
       COPY COLBFTOC.
       COPY GNSBFMSC.
       COPY GNSBVTAB.                                                   
       COPY COLBGVEN.
       COPY COLBGINT.
       COPY GNSBGPES.
       COPY GNSBPFEC.
       COPY TABBFCAM.
                                                                        
       CAR-OCU-QCP SECTION.                                             
       INI-CAR-OCU-QCP.                                                 

           MOVE 'N'    TO WSS-IND-DATO IN WSS-VARI.
           MOVE ZEROES TO WSS-IND-EQCP IN WSS-VARI.

           MOVE OPC-CAI-IOPC IN QCP-FLD TO OPC-CAI-IOPC IN OPC.
           MOVE OPC-IIC-IOPC IN QCP-FLD TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT (FIO-STAT-OKS)
               GO TO FIN-CAR-OCU-QCP.

           MOVE OPC-CAI-IOPC IN OPC TO CAN-CAI-IOPC IN CAN.
           MOVE OPC-IIC-IOPC IN OPC TO CAN-IIC-IOPC IN CAN.
           IF FRM-IND-HMAS IN QCP-FLD  = '-'                            
              MOVE '999' TO CAN-NUM-ICAN IN CAN                         
              MOVE FIO-GET-LEQ TO FIO-CMND                              
              GO TO LOOP-CAR-QCP                                        
           ELSE                                                         
              MOVE ZEROES              TO CAN-NUM-ICAN IN CAN
              MOVE FIO-GET-NLS TO FIO-CMND.                                
       LOOP-CAR-QCP.                                                    
           PERFORM COL-FIO-CAN.                                         
           IF NOT (FIO-STAT-OKS AND                                     
               OPC-CAI-IOPC IN QCP-FLD = CAN-CAI-IOPC IN CAN AND        
               OPC-IIC-IOPC IN QCP-FLD = CAN-IIC-IOPC IN CAN)           
               MOVE 'OPC  SINCAN' TO MSG-COD-MENS
               GO TO FIN-CAR-OCU-QCP.                                   
                                                                        
           MOVE CAN-NUM-ICAN IN CAN TO QCP-NUM-ICAN(QCP-I).             
                                                                    
           MOVE CAN-NUM-DCAN IN CAN      TO WSS-NUM-DCAN IN WSS-VARI.
           MOVE CAN-NUM-MCAN IN CAN      TO WSS-NUM-MCAN IN WSS-VARI.
           MOVE CAN-NUM-SCAN IN CAN      TO WSS-NUM-SCAN IN WSS-VARI.
           MOVE CAN-NUM-ACAN IN CAN      TO WSS-NUM-ACAN IN WSS-VARI.
                                                                    
           MOVE WSS-FEC-FCAN IN WSS-VARI TO QCP-FEC-FCAN(QCP-I).    
                                                                    
           MOVE CAN-SGV-COMI IN CAN      TO QCP-SGV-COMI(QCP-I).    
           MOVE CAN-MSC-CANC IN CAN      TO QCP-MSC-CANC(QCP-I).    
           MOVE CAN-COD-OFCA IN CAN      TO QCP-COD-OFCA(QCP-I).    
           MOVE CAN-SGV-TPAG IN CAN      TO QCP-SGV-TPAG(QCP-I).    
           MOVE CAN-SGV-TREN IN CAN      TO QCP-SGV-TREN(QCP-I).    
           MOVE CAN-SGV-DIFE IN CAN      TO QCP-SGV-DIFE(QCP-I).    

           PERFORM LEE-CAN-RCV.
           IF WSS-IND-ERCV IN WSS-VARI = 'N'
              MOVE ZEROES                TO QCP-NUM-IVEN(QCP-I)
           ELSE
              IF RCV-NUM-IVCT IN RCV NOT > ZEROES
                  MOVE OPC-NUM-IVEN IN OPC   TO QCP-NUM-IVEN(QCP-I)
              ELSE
                  MOVE RCV-NUM-IVCT IN RCV   TO QCP-NUM-IVEN(QCP-I).

           MOVE RCV-SGV-INTN IN RCV      TO QCP-SGV-INTN(QCP-I).
           MOVE RCV-SGV-CAPI IN RCV      TO QCP-SGV-CAPI(QCP-I).
           MOVE RCV-SGV-INTM IN RCV      TO QCP-SGV-INTM(QCP-I).

           PERFORM LEE-CAN-IXT.
           IF WSS-IND-EIXT IN WSS-VARI = 'N'
               MOVE ZEROES               TO QCP-SGV-IMPT(QCP-I)
           ELSE
               MOVE IXT-SGV-MCAL IN IXT  TO QCP-SGV-IMPT(QCP-I).
      * LEER VEN
           IF OPC-IND-VSTR IN OPC = 'S'
               MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN
               MOVE QCP-NUM-IVEN(QCP-I) TO VEN-NUM-IVEN IN VEN
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM COL-OBT-VEN
           ELSE
               MOVE OPC-CIC-IOPC IN OPC TO VEN-CIC-IOPC IN VEN
               MOVE QCP-NUM-IVEN(QCP-I) TO VEN-NUM-IVEN IN VEN
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM COL-FIO-VEN.

           MOVE VEN-NUM-DVEN IN VEN      TO WSS-NUM-DVEN IN WSS-VARI.
           MOVE VEN-NUM-MVEN IN VEN      TO WSS-NUM-MVEN IN WSS-VARI.
           MOVE VEN-NUM-SVEN IN VEN      TO WSS-NUM-SVEN IN WSS-VARI.
           MOVE VEN-NUM-AVEN IN VEN      TO WSS-NUM-AVEN IN WSS-VARI.
           MOVE WSS-FEC-FVEN IN WSS-VARI TO QCP-FEC-FVEN(QCP-I).
           MOVE VEN-VAL-FINA IN VEN      TO QCP-SGV-FINA(QCP-I).
      * LEE CXE
           PERFORM LEE-CAN-CXE.
           IF WSS-IND-ECXE IN WSS-VARI = 'N'
               MOVE ZEROES               TO QCP-SGV-MCAL(QCP-I)
           ELSE
               MOVE CXE-SGV-MCAL IN CXE  TO QCP-SGV-MCAL(QCP-I).
      * LEE CYA
           MOVE CAN-CAI-IOPC IN CAN TO CYA-CAI-IOPC IN CYA.
           MOVE CAN-IIC-IOPC IN CAN TO CYA-IIC-IOPC IN CYA.
           MOVE CAN-NUM-ICAN IN CAN TO CYA-NUM-ICAN IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF NOT (FIO-STAT-OKS AND
                CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
                CAN-NUM-ICAN IN CAN = CYA-NUM-ICAN IN CYA )
                MOVE SPACES TO FRM-IND-TCYA(QCP-I)
                MOVE SPACES TO WSS-IND-TCYA IN WSS-VARI
           ELSE
                MOVE CYA-IND-TCYA IN CYA TO WSS-IND-TCYA IN WSS-VARI
                MOVE WSS-IND-TCYA IN WSS-VARI TO QCP-IND-TCYA(QCP-I).

           IF WSS-IND-TRAS IN WSS-VARI = 'PB' OR 'TR'
                 MOVE 'TRASPASO'          TO WSS-GLS-TRAS IN WSS-VARI
                 MOVE 'SCTB'              TO WSS-IND-SCTB IN WSS-VARI
                 MOVE WSS-AUX-TRAS        TO WSS-IND-CANC IN WSS-VARI   
                 MOVE 'COL' TO TAB-COD-SIST                             
                 MOVE 'MSC' TO TAB-COD-TTAB IN TAB                      
                 MOVE WSS-IND-TMSC IN WSS-VARI TO TAB-COD-CTAB IN TAB   
                 PERFORM BUS-TAB                                        
                 MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-SCTB IN WSS-VARI   
                 MOVE WSS-GLS-CANC IN WSS-VARI TO QCP-GLS-CANC(QCP-I)   
           ELSE
              IF CAN-MSC-CANC IN CAN > SPACES                           
                 MOVE 'COL' TO TAB-COD-SIST                             
                 MOVE 'CNC ' TO TAB-COD-TTAB IN TAB                     
                 MOVE CAN-MSC-CANC IN CAN TO TAB-COD-CTAB IN TAB        
                 PERFORM BUS-TAB                                        
                 MOVE TAB-GLS-DESC IN TAB TO                            
                      QCP-GLS-CANC(QCP-I).                              
      * DETERMINA GLOSA TIPO CANCELACION
           PERFORM LEE-CAN-ROV.
           IF WSS-IND-EROV IN WSS-VARI = 'N'
               MOVE SPACES              TO  QCP-CAI-IOPC(QCP-I)
               MOVE ZEROES              TO  QCP-IIC-IOPC(QCP-I)
           ELSE
               MOVE ROV-CAI-IOPC IN ROV TO  QCP-CAI-IOPC(QCP-I)
               MOVE ROV-IIC-IOPC IN ROV TO  QCP-IIC-IOPC(QCP-I).
           IF WSS-IND-DATO IN WSS-VARI = 'N'
               IF FRM-IND-CANC IN QCP-FLD > ZEROES
                  IF NOT (FRM-IND-CANC IN QCP-FLD =
                      CAN-NUM-ICAN IN CAN)
                      GO TO SIG-CAR-OCU-QCP
                  ELSE
                      MOVE 'S' TO WSS-IND-DATO IN WSS-VARI
                      GO TO SIG-CAR-OCU-QCP
               ELSE
                  NEXT SENTENCE
           ELSE
               NEXT SENTENCE.

       NXT-CAR-OCU-QCP.                                                 
           PERFORM INC-REG-TS.                                          
           ADD 1 TO WSS-IND-EQCP IN WSS-VARI.                           
       SIG-CAR-OCU-QCP.                                                 
           IF FRM-IND-HMAS IN QCP-FLD  = '-'                            
               MOVE FIO-GET-PRV TO FIO-CMND                             
               GO TO LOOP-CAR-QCP                                       
           ELSE                                                         
              MOVE FIO-GET-NXT TO FIO-CMND                                 
              GO TO LOOP-CAR-QCP.                                          
       FIN-CAR-OCU-QCP.                                                 
           IF SCR-OFRM-SRV                                              
              PERFORM PUT-QCP-MAS.                                      
           EXIT.                                                        
                                                                        
       PUT-QCP-MAS SECTION.                                             
       INI-PUT-QCP-MAS.                                                 
           MOVE 1                  TO QUE-NITM.                         
           MOVE QCP-LEN-TSQCP-MAS  TO QUE-LITM.                         
           MOVE QCP-NOM-TSQCP-MAS  TO QUE-COLA.                         
           IF WSS-IND-EQCP > QCP-IMAX-MTX                               
              MOVE 'S'                      TO QCP-MAS-IND-HMAS         
              MOVE QCP-IMAX-MTX             TO QCP-MAS-NUM-TOCC         
           ELSE                                                         
              MOVE 'N'                      TO QCP-MAS-IND-HMAS         
              MOVE WSS-IND-EQCP IN WSS-VARI TO QCP-MAS-NUM-TOCC.        
           MOVE QCP-MAS-ITEM       TO QUE-ITEM.                         
           MOVE QUE-PUT            TO QUE-CMND.                         
           PERFORM GNS-PRO-QUE.                                         
       FIN-PUT-QCP-MAS.                                                 
           EXIT.                                                        
                                                                        
       OBT-PARAM SECTION.                                               
       INI-OBT-PARAM.                                                   
       FIN-OBT-PARAM.                                                   
           EXIT.                                                        
                                                                        
       OBT-DAT-TS SECTION.                                              
       INI-OBT-DAT-TS.                                                  
           EXEC CICS HANDLE CONDITION QIDERR(CON-OBT-DAT-TS)            
                                     ITEMERR(CON-OBT-DAT-TS)            
           END-EXEC.                                                    
                                                                        
           MOVE QCP-NOM-TSQCP     TO QUE-COLA.                          
           MOVE QUE-DEL           TO QUE-CMND.                          
           PERFORM GNS-PRO-QUE.                                         
       CON-OBT-DAT-TS.                                                  
           MOVE QCP-SI-IMP TO QCP-IMP.                                  
           PERFORM CLR-VEC-TS VARYING QCP-I FROM 1 BY 1 UNTIL           
                   QCP-I > QCP-IMAX.                                    
           MOVE 1 TO QCP-I.                                             
           PERFORM CAR-OCU-QCP.                                         
       NXT-OBT-DAT-TS.                                                  
           IF QCP-IMP = QCP-SI-IMP                                      
               PERFORM WRT-TS.                                          
       FIN-OBT-DAT-TS.                                                  
           EXIT.                                                        
                                                                        
       PUT-TAB-QCP SECTION.                                             
       INI-PUT-TAB-QCP.                                                 
           PERFORM RED-TS.                                              
           PERFORM LLE-DAT-PNT VARYING QCP-I FROM 1 BY 1                
                   UNTIL QCP-I > QCP-IMAX.                              
       FIN-PUT-TAB-QCP.                                                 
           EXIT.                                                        
                                                                        
       LLE-DAT-PNT SECTION.                                             
       INI-LLE-DAT-PNT.                                                 
           MOVE QCP-NUM-ICAN IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-NUM-ICAN IN QCP-FLD(QCP-I).                         
           MOVE QCP-NUM-IVEN IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-NUM-IVEN IN QCP-FLD(QCP-I).                         
           MOVE QCP-FEC-FVEN IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-FEC-FVEN IN QCP-FLD(QCP-I).                         
           MOVE QCP-FEC-FCAN IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-FEC-FCAN IN QCP-FLD(QCP-I).                         
           MOVE QCP-SGV-IMPT IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-SGV-IMPT IN QCP-FLD(QCP-I).                         
           MOVE QCP-SGV-COMI IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-SGV-COMI IN QCP-FLD(QCP-I).                         
           MOVE QCP-SGV-INTN IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-SGV-INTN IN QCP-FLD(QCP-I).                         
           MOVE QCP-SGV-CAPI IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-SGV-CAPI IN QCP-FLD(QCP-I).                         
           MOVE QCP-SGV-FINA IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-SGV-FINA IN QCP-FLD(QCP-I).                         
           MOVE QCP-SGV-INTM IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-SGV-INTM IN QCP-FLD(QCP-I).                         
           MOVE QCP-SGV-MCAL IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-SGV-MCAL IN QCP-FLD(QCP-I).                         
           MOVE QCP-GLS-CANC IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-GLS-CANC IN QCP-FLD(QCP-I).                         
           MOVE QCP-CAI-IOPC IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-CAI-IOPC IN QCP-FLD(QCP-I).                         
           MOVE QCP-IIC-IOPC IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-IIC-IOPC IN QCP-FLD(QCP-I).                         
           MOVE QCP-MSC-CANC IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-MSC-CANC IN QCP-FLD(QCP-I).                         
           MOVE QCP-IND-TCYA IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-IND-TCYA IN QCP-FLD(QCP-I).                         
           MOVE QCP-COD-OFCA IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-COD-OFCA IN QCP-FLD(QCP-I).                         
           MOVE QCP-SGV-TPAG IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-SGV-TPAG IN QCP-FLD(QCP-I).                         
           MOVE QCP-SGV-TREN IN QCP-ARRE-TS(QCP-I) TO                         
                FRM-SGV-TREN IN QCP-FLD(QCP-I).                         
           MOVE QCP-SGV-DIFE IN QCP-ARRE-TS(QCP-I) TO                   
                FRM-SGV-DIFE IN QCP-FLD(QCP-I).                         
       FIN-LLE-DAT-PNT.                                                 
           EXIT.                                                        
                                                                        
       INC-REG-TS SECTION.                                              
       INI-INC-REG-TS.                                                  
           MOVE QCP-SI-IMP TO QCP-IMP.                                  
              ADD 1 TO QCP-I.                                           
              IF QCP-I > QCP-IMAX                                       
                PERFORM WRT-TS                                          
                PERFORM CLR-VEC-TS VARYING QCP-I FROM 1 BY 1            
                                     UNTIL QCP-I > QCP-IMAX             
                MOVE 1 TO QCP-I.                                        
           MOVE QCP-NO-IMP TO QCP-IMP.                                  
       FIN-INC-REG-TS.                                                  
           EXIT.                                                        
                                                                        
                                                                        
       WRT-TS SECTION.                                                  
       INI-WRT-TS.                                                      
           ADD 1 TO SCR-IMAX.                                           
           MOVE QCP-NOM-TSQCP     TO QUE-COLA.                          
           MOVE QCP-TS            TO QUE-ITEM.                          
           MOVE QCP-LEN-TSQCP     TO QUE-LITM.                          
           MOVE QCP-I             TO QUE-NITM.                          
           MOVE QUE-PUT           TO QUE-CMND.                          
           PERFORM GNS-PRO-QUE.                                         
       FIN-WRT-TS.                                                      
           EXIT.                                                        
                                                                        
       RED-TS SECTION.                                                  
       INI-RED-TS.                                                      
           MOVE QCP-I TO SCR-I.                                         
           EXEC CICS HANDLE CONDITION QIDERR(FIN-RED-TS)                
                                     ITEMERR(FIN-RED-TS)                
           END-EXEC.                                                    
           MOVE QCP-NOM-TSQCP      TO QUE-COLA.                         
           MOVE QCP-TS             TO QUE-ITEM.                         
           MOVE QCP-LEN-TSQCP      TO QUE-LITM.                         
           MOVE QCP-I              TO QUE-NITM.                         
           MOVE QUE-GET            TO QUE-CMND.                         
           PERFORM GNS-PRO-QUE.                                         
           MOVE QUE-ITEM           TO QCP-TS.                           
       FIN-RED-TS.                                                      
           EXIT.                                                        
                                                                        
       CLR-VEC-TS SECTION.                                              
       INI-CLR-VEC-TS.                                                  
           MOVE ZEROES TO QCP-NUM-ICAN IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-NUM-IVEN IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-FEC-FVEN IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-FEC-FCAN IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-SGV-IMPT IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-SGV-COMI IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-SGV-INTN IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-SGV-CAPI IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-SGV-FINA IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-SGV-INTM IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-SGV-MCAL IN QCP-ARRE-TS(QCP-I).           
           MOVE SPACES TO QCP-GLS-CANC IN QCP-ARRE-TS(QCP-I).           
           MOVE SPACES TO QCP-CAI-IOPC IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-IIC-IOPC IN QCP-ARRE-TS(QCP-I).           
           MOVE SPACES TO QCP-MSC-CANC IN QCP-ARRE-TS(QCP-I).           
           MOVE SPACES TO QCP-IND-TCYA IN QCP-ARRE-TS(QCP-I).           
           MOVE SPACES TO QCP-COD-OFCA IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-SGV-TPAG IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-SGV-TREN IN QCP-ARRE-TS(QCP-I).           
           MOVE ZEROES TO QCP-SGV-DIFE IN QCP-ARRE-TS(QCP-I).           
       FIN-CLR-VEC-TS.                                                  
           EXIT.                                                        
                                                                        
       RST-STAT SECTION.                                                
       INI-RST-STAT.                                                          
           MOVE SCR-STPP     TO SCR-STAT.                               
           MOVE SCR-MFLD-NOT TO SCR-MFLD.                               
       FIN-RST-STAT.                                                    
           EXIT.                                                        

       LEE-CAN-RCV SECTION.
       INI-LEE-CAN-RCV.
           MOVE 'S' TO WSS-IND-ERCV IN WSS-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-NUM-ICAN IN CAN TO RCV-NUM-ICAN IN RCV.
           MOVE SPACES              TO RCV-CIC-IOPV IN RCV.
           MOVE ZEROES              TO RCV-NUM-IVCT IN RCV.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF NOT (FIO-STAT-OKS AND
               CAN-CIC-IOPC IN CAN = RCV-CIC-IOPC IN RCV AND
               CAN-NUM-ICAN IN CAN = RCV-NUM-ICAN IN RCV)
               MOVE 'N' TO WSS-IND-ERCV IN WSS-VARI
               GO TO FIN-LEE-CAN-RCV.
       FIN-LEE-CAN-RCV.
           EXIT.

       LEE-CAN-IXT SECTION.
       INI-LEE-CAN-IXT.
           MOVE 'S' TO WSS-IND-EIXT IN WSS-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO IXT-CIC-IOPC IN IXT.
           MOVE CAN-NUM-ICAN IN CAN TO IXT-NUM-ICAN IN IXT.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-IXT.
           IF NOT (FIO-STAT-OKS)
               MOVE 'N' TO WSS-IND-EIXT IN WSS-VARI
               GO TO FIN-LEE-CAN-IXT.
       FIN-LEE-CAN-IXT.
           EXIT.

       LEE-CAN-CXE SECTION.
       INI-LEE-CAN-CXE.
           MOVE 'S' TO WSS-IND-ECXE IN WSS-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO CXE-KEY-IOPC IN CXE.
           MOVE CAN-MSC-CANC IN CAN TO CXE-COD-EVEN IN CXE.
           MOVE CAN-NUM-ICAN IN CAN TO CXE-NUM-EVEN IN CXE.
           MOVE SPACES              TO CXE-CIC-IOPV IN CXE.
           MOVE ZEROES              TO CXE-NUM-IVCT IN CXE.
           MOVE SPACES              TO CXE-COD-CPTO IN CXE.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CXE.
           IF NOT (FIO-STAT-OKS AND
               CAN-CIC-IOPC IN CAN = CXE-KEY-IOPC IN CXE AND
               CAN-MSC-CANC IN CAN = CXE-COD-EVEN IN CXE AND
               CAN-NUM-ICAN IN CAN = CXE-NUM-EVEN IN CXE)
               MOVE 'N' TO WSS-IND-ECXE IN WSS-VARI
               GO TO FIN-LEE-CAN-CXE.
       FIN-LEE-CAN-CXE.
           EXIT.

       LEE-CAN-ROV SECTION.
       INI-LEE-CAN-ROV.
           MOVE 'S' TO WSS-IND-EROV IN WSS-VARI.
           MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF NOT (FIO-STAT-OKS)
               MOVE 'N' TO WSS-IND-EROV IN WSS-VARI.
               GO TO FIN-LEE-CAN-ROV.
       FIN-LEE-CAN-ROV.
           EXIT.

      *>>>>
