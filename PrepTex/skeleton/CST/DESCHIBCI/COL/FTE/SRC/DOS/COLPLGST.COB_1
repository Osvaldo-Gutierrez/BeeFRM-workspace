       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      COLPLGST.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    05-Dec-95 03:37 PM.

      * Programa Listador de Reporte GST con Sort.

      *<<<< CMT_ID
      *>>>>

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
      *DOS SELECT RPTGST         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTGST         ASSIGN TO        UT-S-RPTGST.
           SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT RPTGST         ASSIGN TO        UT-S-RPTGST.
      *<<<< IOS
      *>>>>

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY COLRRGST.
      *<<<< RR
      *>>>>
       FD  RPTGST LABEL RECORDS OMITTED
           REPORT IS RPT-GST
      *<<<< FD_RPT
      *>>>>
           .
      *<<<< FLS
      *>>>>

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY COLBROPC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY COLRWGST.
      *<<<< RW
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY COLBRRDC.
       COPY SGCBRDBC.
       COPY TABBRCOM.
       COPY TABBROFI.
       COPY TABBRTIO.

       COPY GNSWGCPT.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
      *>>>>


      *>>>>
       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       01  WSS-VARI.
           03  WSS-GLS-DATA.
               05  WSS-IND-REGI OCCURS 20  PIC X(03).
           03  WSS-FEC-FINI.
               05  WSS-NUM-DINI            PIC 9(02).
               05  WSS-NUM-MINI            PIC 9(02).
               05  WSS-NUM-SINI            PIC 9(02).
               05  WSS-NUM-AINI            PIC 9(02).
           03  WSS-FEC-FTER.
               05  WSS-NUM-DTER            PIC 9(02).
               05  WSS-NUM-MTER            PIC 9(02).
               05  WSS-NUM-STER            PIC 9(02).
               05  WSS-NUM-ATER            PIC 9(02).
           03  WSS-FEC-FEC1.
               05  WSS-NUM-SEC1            PIC 9(02).
               05  WSS-NUM-AEC1            PIC 9(02).
               05  WSS-NUM-MEC1            PIC 9(02).
               05  WSS-NUM-DEC1            PIC 9(02).
           03  WSS-FEC-FEC2.
               05  WSS-NUM-SEC2            PIC 9(02).
               05  WSS-NUM-AEC2            PIC 9(02).
               05  WSS-NUM-MEC2            PIC 9(02).
               05  WSS-NUM-DEC2            PIC 9(02).
           03  WSS-COD-REGI  VALUE SPACES  PIC X(02).
           03  WSS-CNTD      VALUE 0       PIC 9(02).
           03  WSS-CMAX      VALUE 20      PIC 9(02).
      *>>>>
      *<<<< WSS_DTC
      *>>>>

       REPORT SECTION.
      *--------------
       COPY COLRFGST.
      *<<<< RF
      *>>>>
           .
       COPY COLRTGST.
      *<<<< RT
      *>>>>

       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
       DEC-CF-GST-OPC-COD-OFOC SECTION.
           USE BEFORE REPORTING CF-GST-OPC-COD-OFOC.
       INI-CF-GST-OPC-COD-OFOC.
      *<<<< CF_GST_OPC_COD_OFOC
      *>>>>
       FIN-CF-GST-OPC-COD-OFOC.
           EXIT.
       DEC-PH-GST SECTION.
           USE BEFORE REPORTING PH-GST.
       INI-PH-GST.
      *<<<< PH_GST
      *>>>>
       FIN-PH-GST.
           EXIT.
       DEC-FF-GST SECTION.
           USE BEFORE REPORTING FF-GST.
       INI-FF-GST.
      *<<<< FF_GST
      *>>>>
       FIN-FF-GST.
           EXIT.
      *<<<< FIN_DEC
      *>>>>
       END DECLARATIVES.

       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'COLPLGST' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *<<<< INI
      *>>>>
           SORT GNSSRT
       COPY COLRSGST.
      *<<<< RS
      *>>>>
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
      *<<<< FIN
      *>>>>
           IF PGM-STAT-SRT-MAL OR SORT-RETURN > 0
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<< INI_INP
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.
      * Captura fecha inicio proceso
           ACCEPT WSS-FEC-FINI IN WSS-VARI.
           DISPLAY 'FECHA DE PROCESO : ' WSS-FEC-FINI IN WSS-VARI.
      * Captura fecha fin proceso
           ACCEPT WSS-FEC-FTER IN WSS-VARI.
           DISPLAY 'FECHA DE PROCESO : ' WSS-FEC-FTER IN WSS-VARI.
      * Captura codigo de region
           ACCEPT WSS-COD-REGI IN WSS-VARI.
           DISPLAY 'CODIGO REGION : ' WSS-COD-REGI IN WSS-VARI.
           DISPLAY 'FIN CAPTURA DE PARAMETROS'.
      * Validacion de parametros
           DISPLAY 'INICIO VALIDACION PARAMETROS'.
           DISPLAY WSS-FEC-FINI IN WSS-VARI.
      *VAL-FEC Valida fecha inicio proceso
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC             TO FEC-FORM.
           MOVE FEC-FBLK-N               TO FEC-FBLK.
           MOVE FEC-CHOY-N               TO FEC-CHOY.
           MOVE FEC-VHBL-N               TO FEC-VHBL.
           MOVE FEC-VAL-FEC              TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO '
              DISPLAY ' ERROR EN VALIDACION F. DE PROCESO : '
                        WSS-FEC-FINI IN WSS-VARI '  ' FEC-MENS
              GO TO FIN-INP-SRT.
           DISPLAY ' '.
           DISPLAY WSS-FEC-FTER IN WSS-VARI.
      *VAL-FEC Valida fecha termino proceso
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC             TO FEC-FORM.
           MOVE FEC-FBLK-N               TO FEC-FBLK.
           MOVE FEC-CHOY-N               TO FEC-CHOY.
           MOVE FEC-VHBL-N               TO FEC-VHBL.
           MOVE FEC-VAL-FEC              TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO '
              DISPLAY ' ERROR EN VALIDACION F. DE PROCESO : '
                        WSS-FEC-FTER IN WSS-VARI '  ' FEC-MENS
              GO TO FIN-INP-SRT.

           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DEC1 IN WSS-VARI.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MEC1 IN WSS-VARI.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SEC1 IN WSS-VARI.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AEC1 IN WSS-VARI.

           MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DEC2 IN WSS-VARI.
           MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MEC2 IN WSS-VARI.
           MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-SEC2 IN WSS-VARI.
           MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-AEC2 IN WSS-VARI.


      *Abrir TAB de Col
           MOVE 'COL' TO FIO-SIST.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR EN APERTURA DE TAB DE COL'
               GO TO FIN-INP-SRT.

      *Guarda excepciones de oficina de datos anexos en vector
           PERFORM LIMPIA-VECTOR.
           MOVE 'COL' TO TAB-COD-SIST.
           MOVE 'OFE' TO TAB-COD-TTAB IN TAB.
           MOVE WSS-COD-REGI IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND
              TAB-COD-TTAB IN TAB = 'OFE' AND
              TAB-IND-VIGE IN TAB = 'S' AND
              TAB-GLS-DATA IN TAB > SPACES
               MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-DATA IN WSS-VARI.
      *>>>>
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FST-INP-SRT.
      *<<<< INI_FST_INP
           MOVE WSS-FEC-FEC1 IN WSS-VARI TO OPC-FEC-FINP IN OPC.
           MOVE 'OPC-FEC-FINP' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           GO TO LUP-INP-SRT.
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM COL-FIO-OPC.
      *<<<< FIN_FST_INP
      *>>>>
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
           IF OPC-FEC-FINP IN OPC < WSS-FEC-FEC1 IN WSS-VARI OR
              OPC-FEC-FINP IN OPC > WSS-FEC-FEC2 IN WSS-VARI OR
              OPC-MSC-STAT IN OPC NOT = 'A' OR
              OPC-VAL-GAST IN OPC NOT > 0
               GO TO NXT-INP-SRT.

      *DPM ini  5-DEC-1995
      * BUSCA SISTEMA EN DONDE OPERA
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'TIO'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-TOOC IN OPC TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS = 'COD    NEX'
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'TIO    NEX'   TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC ' ' OPC-KEY-IOPC IN OPC
                       ' ' TAB-COD-CTAB IN TAB
               PERFORM GNS-PRO-ABT.
           MOVE TAB TO TIO.
           IF TIO-GLS-SIST IN TIO NOT = 'COL'
               GO TO NXT-INP-SRT.
      *DPM fin  5-DEC-1995
           MOVE OPC-COD-OFOC IN OPC TO OFI-COD-OFIC IN OFI.
           PERFORM BUS-OFI.
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'COM' TO TAB-COD-TTAB IN TAB.
           MOVE OFI-COD-COMU IN OFI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB TO COM.
           IF COM-COD-REGI IN COM NOT = WSS-COD-REGI IN WSS-VARI
               GO TO NXT-INP-SRT.

           PERFORM BUS-OFI-EXCEP.
           IF NOT FIO-STAT-OKS
               GO TO NXT-INP-SRT.

           PERFORM BUS-NOM-RUT-DEUDOR.
           IF NOT FIO-STAT-OKS
               GO TO FIN-INP-SRT.
           MOVE OPC-CAI-IOPC IN OPC TO OPC-CAI-IOPC IN SRT.
           MOVE OPC-IIC-IOPC IN OPC TO OPC-IIC-IOPC IN SRT.
           MOVE OPC-COD-OFOC IN OPC TO OPC-COD-OFOC IN SRT.
           MOVE OPC-VAL-CRED IN OPC TO OPC-VAL-CRED IN SRT.
           MOVE OPC-VAL-GAST IN OPC TO OPC-VAL-GAST IN SRT.
           MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFIC IN SRT.
           RELEASE SRT.
           GO TO NXT-INP-SRT.
      *>>>>
       MOV-INP-SRT.
       COPY COLRMGST.
      *<<<< RM
      *>>>>
           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
           MOVE 'OPC-FEC-FINP' TO FIO-AKEY.
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-OPC.
      *<<<< FIN_NXT_INP
      *>>>>
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
      *<<<< FIN_INP
      *>>>>
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-OPC.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
      *<<<< INI_OUT
      *>>>>
           OPEN OUTPUT RPTGST.
      *     MOVE 'COLPLGST' TO RPT-NPGM.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-GST.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
      *<<<< FST_OUT
           MOVE 'COLPLGST' TO WSS-GLS-PRGM IN WSS-GST.
           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DINI IN WSS-GST.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MINI IN WSS-GST.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SINI IN WSS-GST.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AINI IN WSS-GST.
           MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DTER IN WSS-GST.
           MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MTER IN WSS-GST.
           MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-STER IN WSS-GST.
           MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-ATER IN WSS-GST.
      *>>>>
       LUP-OUT-SRT.
      *<<<< LUP_OUT
           IF DBC-GLS-ICLI IN SRT > SPACES
               MOVE '-' TO WSS-IND-AUX IN WSS-GST
           ELSE
               MOVE SPACES TO WSS-IND-AUX IN WSS-GST.
      *>>>>
       GEN-OUT-SRT.
           GENERATE DL-GST.
      *<<<< FIN_GEN_OUT
      *>>>>
       NXT-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
      *<<<< FIN_OUT
      *>>>>
           TERMINATE RPT-GST.
      *<<<< FIN_TMT
      *>>>>
           CLOSE RPTGST.
       EXT-OUT-SRT.
           EXIT.
       COPY COLBFOPC.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGABT.

      *<<<< EOF
       COPY COLBFRDC.
       COPY SGCBFDBC.
       COPY TABBFCOM.
       COPY TABBFOFI.
       COPY TABBBOFI.
       COPY TABBVOFI.

       COPY GNSBGCPT.
       COPY GNSBGHOY.
       COPY GNSBBTAB.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY GNSBBMSG.


       BUS-OFI-EXCEP SECTION.
       INI-BUS-OFI-EXCEP.
           MOVE 1 TO WSS-CNTD IN WSS-VARI.
           MOVE '00' TO FIO-STAT.
       LUP-OFI.
           IF WSS-IND-REGI(WSS-CNTD) NOT > SPACES OR
              WSS-CNTD IN WSS-VARI > WSS-CMAX IN WSS-VARI
               GO TO FIN-BUS-OFI-EXCEP.

           IF OPC-COD-OFOC IN OPC = WSS-IND-REGI(WSS-CNTD)
               MOVE '23' TO FIO-STAT
           ELSE
               ADD 1 TO WSS-CNTD IN WSS-VARI
               GO TO LUP-OFI.
       FIN-BUS-OFI-EXCEP.
           EXIT.


       BUS-NOM-RUT-DEUDOR SECTION.
       INI-BUS-NOM-RUT-DEUDOR.
           MOVE '00' TO FIO-STAT.
           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT (FIO-STAT-OKS AND
              OPC-CIC-IOPC IN OPC = RDC-CIC-IOPC IN RDC)
               DISPLAY 'ERROR EN LECTURA DE RDC CON CIC OPC: '
                        OPC-CIC-IOPC IN OPC
               MOVE '23' TO FIO-STAT
               GO TO FIN-BUS-NOM-RUT-DEUDOR.
           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR EN LECTURA DE DBC CON CIC RDC: '
                        RDC-CIC-ICLI IN RDC
               MOVE '23' TO FIO-STAT
               GO TO FIN-BUS-NOM-RUT-DEUDOR.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN            TO DBC-GLS-NOMC IN DBC.
           MOVE DBC-GLS-NOMC IN DBC TO DBC-GLS-NOMC IN SRT.
           MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN SRT.
           MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN SRT.
           MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN SRT.
           MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN SRT.
       FIN-BUS-NOM-RUT-DEUDOR.
           EXIT.


       LIMPIA-VECTOR SECTION.
       INI-LIMPIA-VECTOR.
           MOVE 1 TO WSS-CNTD IN WSS-VARI.
       LUP-LIMPIA.
           IF WSS-CNTD IN WSS-VARI > WSS-CMAX IN WSS-VARI
               GO TO FIN-LIMPIA-VECTOR.
           MOVE SPACES TO WSS-IND-REGI(WSS-CNTD).
           ADD 1 TO WSS-CNTD IN WSS-VARI.
           GO TO LUP-LIMPIA.
       FIN-LIMPIA-VECTOR.
           EXIT.
      *>>>>
