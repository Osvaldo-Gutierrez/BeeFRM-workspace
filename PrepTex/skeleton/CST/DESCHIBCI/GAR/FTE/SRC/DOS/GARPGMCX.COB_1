       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GARPGMCX.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    03-Mar-95 03:38 AM.

      * Genera Interfase Contable M/X

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *=============

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSBRERR.
       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       COPY GARBRMXE.
       COPY GARBRMXE REPLACING MXE BY OLD.

       COPY TABBRMCX.

       01  WSS-VARI.
      * Fecha de Proceso que es leida de tabla TFP
           03 WSS-FEC-FPRO.
              05 WSS-NUM-SPRO                     PIC 9(02).
              05 WSS-NUM-APRO                     PIC 9(02).
              05 WSS-NUM-MPRO                     PIC 9(02).
              05 WSS-NUM-DPRO                     PIC 9(02).
      * Fecha Inicio
      *     03 WSS-FEC-FINI.
      *        05 WSS-NUM-DINI                     PIC 9(02).
      *        05 WSS-NUM-MINI                     PIC 9(02).
      *        05 WSS-NUM-SINI                     PIC 9(02).
      *        05 WSS-NUM-AINI                     PIC 9(02).
      * Fecha Termino
      *     03 WSS-FEC-FTER.
      *        05 WSS-NUM-DTER                     PIC 9(02).
      *        05 WSS-NUM-MTER                     PIC 9(02).
      *        05 WSS-NUM-STER                     PIC 9(02).
      *        05 WSS-NUM-ATER                     PIC 9(02).
      * Fecha Que se mueve a GAR-CLV-GMO-1 en formato SAMD
      *     03 WSS-FEC-FFEC.
      *        05 WSS-NUM-SFEC                     PIC 9(02).
      *        05 WSS-NUM-AFEC                     PIC 9(02).
      *        05 WSS-NUM-MFEC                     PIC 9(02).
      *        05 WSS-NUM-DFEC                     PIC 9(02).
      * Fecha Tope en Formato SAMD
      *     03 WSS-FEC-FFET.
      *        05 WSS-NUM-SFET                     PIC 9(02).
      *        05 WSS-NUM-AFET                     PIC 9(02).
      *        05 WSS-NUM-MFET                     PIC 9(02).
      *        05 WSS-NUM-DFET                     PIC 9(02).
           03 WSS-NUM-TRAS        VALUE 6000      PIC 9(05).
           03 WSS-I               VALUE 0         PIC 9(02).
           03 WSS-J                               PIC 9(02).
           03 WSS-IND-MXEE           VALUE 0      PIC 9(06).
           03 WSS-IND-MCXG           VALUE 0      PIC 9(06).
           03 WSS-IND-ERRO        VALUE ZEROES    PIC 9(01).
           03 WSS-NO-BUSCA-MSG-ERROR VALUE 1      PIC 9(01).
           03 WSS-BUSCA-MSG-ERROR    VALUE 0      PIC 9(01).
      *RVM:Porque en IBM no funciona STRING a una variable con items
      *    de grupo (frm-mens esta dividido en frm-men1 y frm-men2)
           03 WSS-GLS-MSGE.
              05 WSS-GLS-MSG1        VALUE SPACES PIC X(20).
              05 WSS-GLS-MSG2        VALUE SPACES PIC X(22).
              05 WSS-GLS-MSG3        VALUE SPACES PIC X(08).
              05 WSS-GLS-MSG4        VALUE SPACES PIC X(08).
              05 WSS-GLS-MSG5        VALUE SPACES PIC X(08).
              05 WSS-GLS-MSG6        VALUE SPACES PIC X(13).
              05 WSS-GLS-MSG7        VALUE SPACES PIC X(12).
           03 WSS-SW                 VALUE ZEROES PIC 9(01).
      *>>>>
      *<<<< WSS_DTC
      *>>>>

       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'GARPGMCX' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           PERFORM INP-SRT.
           MOVE MXE TO OLD.
           PERFORM FIL-HDR-MCX.
       LUP-MAIN.
           ADD 1 TO WSS-IND-MXEE IN WSS-VARI.
           ADD  1  TO WSS-I IN WSS-VARI.
           IF MXE-COD-OFIC IN MXE NOT =
              MXE-COD-OFIC IN OLD
                  OR
              MXE-COD-MONE IN MXE NOT =
              MXE-COD-MONE IN OLD
                  OR
              WSS-I IN WSS-VARI > 18
               SUBTRACT 1 FROM WSS-I
               MOVE WSS-I TO MCX-NUM-OCUV IN MCX
               PERFORM GEN-REG-MCX
               PERFORM FIL-HDR-MCX
               MOVE MXE TO OLD
               MOVE 1 TO WSS-I.

           MOVE MXE-VEC-MONX IN MXE      TO MCX-VEC-MONX IN MCX(WSS-I).
           MOVE WSS-I        IN WSS-VARI TO MCX-NUM-SECV IN MCX(WSS-I).
           MOVE SPACES                   TO MCX-GLS-DISP IN MCX(WSS-I).

       NXT-MAIN.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-MXE.
           IF FIO-STAT-OKS
               GO TO LUP-MAIN.
           MOVE WSS-I TO MCX-NUM-OCUV IN MCX.
           PERFORM GEN-REG-MCX.
           DISPLAY 'REGISTROS MXE LEIDOS   : ' WSS-IND-MXEE IN WSS-VARI.
           DISPLAY 'REGISTROS MCX GRABADOS : ' WSS-IND-MCXG IN WSS-VARI.

       FIN-MAIN.
           PERFORM FIN.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<< INI_INP

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

      *     DISPLAY 'INICIO CAPTURA DE PARAMETROS'.

      *CAPTURA FECHA DE INICIO
      *     DISPLAY 'FECHA DE INICIO ( DDMMAAAA ) : '.
      *     ACCEPT  WSS-FEC-FINI IN WSS-VARI.
      *     DISPLAY WSS-FEC-FINI IN WSS-VARI.
      *CAPTURA FECHA DE TERMINO
      *     DISPLAY 'FECHA DE TERMINO ( DDMMAAAA ) : '
      *     ACCEPT  WSS-FEC-FTER IN WSS-VARI.
      *     DISPLAY WSS-FEC-FTER IN WSS-VARI.

      *     DISPLAY 'FIN    CAPTURA    DE PARAMETROS'.
      *     DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

      *VAL-FEC VALIDA FECHA DE INICIO
      *     DISPLAY WSS-FEC-FINI IN WSS-VARI.
      *     MOVE WSS-FEC-FINI    IN WSS-VARI TO FEC-FECH.
      *     MOVE FEC-FORM-FEC TO FEC-FORM.
      *     MOVE FEC-FBLK-N   TO FEC-FBLK.
      *     MOVE FEC-CHOY-LE  TO FEC-CHOY.
      *     MOVE FEC-VHBL-N   TO FEC-VHBL.
      *     MOVE FEC-VAL-FEC  TO FEC-CMND.
      *     PERFORM PRO-FEC.
      *     IF NOT FEC-STAT-OKS
      *         DISPLAY FEC-MENS
      *         PERFORM GNS-PRO-END.

      *VAL-FEC VALIDA FECHA DE TERMINO
      *     DISPLAY WSS-FEC-FTER IN WSS-VARI.
      *     MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FECH.
      *     MOVE FEC-FORM-FEC TO FEC-FORM.
      *     MOVE FEC-FBLK-N   TO FEC-FBLK.
      *     MOVE FEC-CHOY-LE  TO FEC-CHOY.
      *     MOVE FEC-VHBL-N   TO FEC-VHBL.
      *     MOVE FEC-VAL-FEC  TO FEC-CMND.
      *     PERFORM PRO-FEC.
      *     IF NOT FEC-STAT-OKS
      *         DISPLAY FEC-MENS
      *         PERFORM GNS-PRO-END.

      *CMP-FEC COMPARA FECHA DE INICIO CON FECHA DE TERMINO
      *     MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FEC1.
      *     MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FEC2.
      *     MOVE FEC-FORM-FEC TO FEC-FORM.
      *     MOVE FEC-CMP-FEC  TO FEC-CMND.
      *     PERFORM PRO-FEC.
      *     IF FEC-STAT-GRT
      *         MOVE 'TAB'         TO MSG-COD-SIST
      *         MOVE 'FECFINIFTER' TO MSG-COD-MENS IN MSG
      *         PERFORM GET-MSG
      *         DISPLAY MSG-GLS-DESC IN MSG
      *         PERFORM GNS-PRO-END.

      *     MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DINI IN WSS-LMG
      *                                      WSS-NUM-DINI IN WSS-MCT
      *                                      WSS-NUM-DFEC IN WSS-VARI.
      *     MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MINI IN WSS-LMG
      *                                      WSS-NUM-MINI IN WSS-MCT
      *                                      WSS-NUM-MFEC IN WSS-VARI.
      *     MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SINI IN WSS-LMG
      *                                      WSS-NUM-SINI IN WSS-MCT
      *                                      WSS-NUM-SFEC IN WSS-VARI.
      *     MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AINI IN WSS-LMG
      *                                      WSS-NUM-AINI IN WSS-MCT
      *                                      WSS-NUM-AFEC IN WSS-VARI.
      *     MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DTER IN WSS-LMG
      *                                      WSS-NUM-DTER IN WSS-MCT
      *                                      WSS-NUM-DFET IN WSS-VARI.
      *     MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MTER IN WSS-LMG
      *                                      WSS-NUM-MTER IN WSS-MCT
      *                                      WSS-NUM-MFET IN WSS-VARI.
      *     MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-STER IN WSS-LMG
      *                                      WSS-NUM-STER IN WSS-MCT
      *                                      WSS-NUM-SFET IN WSS-VARI.
      *     MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-ATER IN WSS-LMG
      *                                      WSS-NUM-ATER IN WSS-MCT
      *                                      WSS-NUM-AFET IN WSS-VARI.

      *     DISPLAY 'FIN VALIDACION DE PARAMETROS'.

      *Lee Tabla de Fechas de Proceso
           MOVE 'GAR' TO TAB-COD-SIST.
           MOVE 'GAR' TO FIO-SIST.
           MOVE 'TFP' TO TAB-COD-TTAB IN TAB.
           MOVE '01'  TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DAT1 TO WSS-FEC-FPRO IN WSS-VARI
               DISPLAY 'FECHA DE PROCESO : ' TAB-GLS-DAT1
           ELSE
              DISPLAY 'ERROR EN LECTURA FECHA DE PROCESO COD 01'.

      *     MOVE 'GARPGMCX' TO RPT-NPGM.

      * ABRE ARCHIVO DE ENTRADA
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-MXE.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR AL ABRIR ARCHIVO MXE DE INPUT' FIO-STAT
               PERFORM GNS-PRO-END.

      * EFECTUA LA APERTURA DEL ARCHIVO SAM DE SALIDA MON. EXT.
           MOVE FIO-OUT TO FIO-CMND.

           PERFORM TAB-FIO-MCX.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR AL ABRIR ARCHIVO MCX DE OUTPUT' FIO-STAT
               PERFORM GNS-PRO-END.

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-MXE.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ARCHIVO DE ENTRADA VACIO '
               PERFORM FIN.

           IF WSS-NUM-APRO NOT = MXE-NUM-APRO IN MXE OR
              WSS-NUM-MPRO NOT = MXE-NUM-MPRO IN MXE OR
              WSS-NUM-DPRO NOT = MXE-NUM-DPRO IN MXE
               DISPLAY
               'FECHA DE MOVIMIENTOS NO CORRESPONDE A '
               'COD. 01 DE TABLA TFP'
               DISPLAY 'F. MOVIMIENTOS : ' MXE-AMD-FPRO IN MXE
               DISPLAY 'F. TABLA TFP   : ' WSS-FEC-FPRO
               PERFORM FIN.

       FIN-INP-SRT.
           EXIT.

       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBGABT.
       COPY GNSBFMSG.
       COPY GNSBGEND.

       COPY GARBFMXE.

       COPY TABBFMCX.

       COPY GNSBBMSG.
       COPY GNSBBTAB.

       GEN-REG-MCX SECTION.
       INI-GEN-REG-MCX.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM TAB-FIO-MCX.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'MCX    NOPUT' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC
               DISPLAY 'REGISTRO MCX : ' MCX
               DISPLAY '||| PROGRAMA CANCELADO'
               PERFORM GNS-PRO-ABT
           ELSE
               ADD 1 TO WSS-IND-MCXG IN WSS-VARI.

       FIN-GEN-REG-MCX.
           EXIT.

      * HEADER DE MCX
       FIL-HDR-MCX SECTION.
       INI-FIL-HDR-MCX.
           MOVE MXE-COD-OFIC IN MXE      TO MCX-COD-OFIC IN MCX.

           ADD  1  TO WSS-NUM-TRAS IN WSS-VARI.
           MOVE WSS-NUM-TRAS IN WSS-VARI TO MCX-NUM-TRAS IN MCX.

           MOVE MXE-AMD-FPRO IN MXE      TO MCX-AMD-FPRO IN MCX.
           MOVE SPACES                   TO MCX-GLS-FIL1 IN MCX.

           MOVE MXE-COD-MONE IN MXE      TO MCX-COD-MONE IN MCX.

           PERFORM LIM-VEC VARYING WSS-J FROM 1 BY 1 UNTIL
                                   WSS-J > 18.
       FIN-FIL-HDR-MCX.
           EXIT.

       LIM-VEC SECTION.
       INI-LIM-VEC.
           MOVE SPACES TO MCX-GLS-ICTA IN MCX(WSS-J)
                          MCX-IND-TDOC IN MCX(WSS-J)
                          MCX-GLS-MOVI IN MCX(WSS-J)
                          MCX-GLS-FIL2 IN MCX(WSS-J)
                          MCX-NUM-ANAL IN MCX(WSS-J)
                          MCX-GLS-DISP IN MCX(WSS-J).
           MOVE ZEROES TO MCX-VAL-MOVI IN MCX(WSS-J)
                          MCX-NUM-VIGE IN MCX(WSS-J)
                          MCX-NUM-SECV IN MCX(WSS-J).
       FIN-LIM-VEC.
           EXIT.

       FIN SECTION.
       INI-FIN.
           MOVE FIO-CLO TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           PERFORM GAR-FIO-MXE.
           PERFORM TAB-FIO-MCX.

           PERFORM GNS-PRO-END.
       FIN-FIN.
           EXIT.
