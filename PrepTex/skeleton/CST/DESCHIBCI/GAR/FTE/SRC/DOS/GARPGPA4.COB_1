       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GARPGPA4.
       AUTHOR.          R. CHIANG.
       DATE-WRITTEN     22-JUN-2003.
      
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
      *        DECIMAL-POINT IS COMMA.
      
       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *-----------------------
      
       COPY LDCBRCLS.
       COPY LDCBRRDS.
       COPY LDCBRLDS.
       COPY LDCBRARS.
       COPY GARBRGS4.
      
       COPY TABBRCAM.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.
      
       01  VARIABLES.
           03 WSS-LEIDOS-CLS      VALUE ZEROES      PIC 9(08).
           03 WSS-LEIDOS-RDS      VALUE ZEROES      PIC 9(08).
           03 WSS-LEIDOS-LDS      VALUE ZEROES      PIC 9(08).
           03 WSS-LEIDOS-ARS      VALUE ZEROES      PIC 9(08).
           03 WSS-INDICA-CLS      VALUE ZEROES      PIC 9(01).
           03 WSS-INDICA-RDS      VALUE ZEROES      PIC 9(01).
           03 WSS-INDICA-LDS      VALUE ZEROES      PIC 9(01).
           03 WSS-INDICA-ARS      VALUE ZEROES      PIC 9(01).
           03 WSS-GRABAR-GS4      VALUE ZEROES      PIC 9(08).
           03 WSS-YALEIDO         VALUE ZEROES      PIC 9(01).
           03 WSS-YALEIDO1        VALUE ZEROES      PIC 9(01).
      
       PROCEDURE DIVISION.
      *==================
      
       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.
           ENTRY 'DBMSCBL'
           MOVE "GARPGPA4" TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           PERFORM OPEN-FILE.
           PERFORM PROCESO.
           PERFORM ESTADISTICAS.
           PERFORM CLOSE-FILE.
           PERFORM GNS-PRO-END.
       FIN-MAIN.
           EXIT.
      *
      ******************************************************************
      *
       OPEN-FILE SECTION.
       INI-OPEN-FILE.
      *    DISPLAY 'INI-OPEN-FILE'.
           MOVE 'GAR'   TO FIO-SIST.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM LDC-FIO-CLS.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM LDC-FIO-RDS.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM LDC-FIO-LDS.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM LDC-FIO-ARS.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM GAR-FIO-GS4.
      *    DISPLAY 'FIN-OPEN-FILE'.
       FIN-OPEN-FILE.
           EXIT.
      *
      ******************************************************************
      *
       PROCESO SECTION.
       PRI-PROCESO.
           MOVE SPACES TO RDS LDS ARS.
       INI-PROCESO.
           PERFORM LEER-LDCCLS.
           IF NOT FIO-STAT-OKS
              GO TO FIN-PROCESO.
      
           IF CLF-MSC-STAT IN CLS NOT = 'A'
              GO TO INI-PROCESO.
      
       RDS-PROCESO.
           IF RDC-CIC-ICLF IN RDS < CLF-CIC-ICLF IN CLS
              PERFORM LEER-LDCRDS
              IF NOT FIO-STAT-OKS
                 GO TO FIN-PROCESO
              ELSE
                 GO TO RDS-PROCESO.
      
           IF RDC-CIC-ICLF IN RDS > CLF-CIC-ICLF IN CLS
              GO TO INI-PROCESO.
      
       LDS-PROCESO.
           IF LDC-CIC-ICLF IN LDS < CLF-CIC-ICLF IN CLS
              PERFORM LEER-LDCLDS
              IF NOT FIO-STAT-OKS
                 GO TO FIN-PROCESO
              ELSE
                 GO TO LDS-PROCESO.
      
           IF LDC-CIC-ICLF IN LDS > CLF-CIC-ICLF IN CLS
              GO TO INI-PROCESO.
      
           IF LDC-CIC-ICLF IN LDS = LDC-CIC-ICLF IN LDS
              PERFORM LEER-PROCESO-LDCARS
              PERFORM LEER-LDCLDS
              IF NOT FIO-STAT-OKS
                 GO TO FIN-PROCESO
              ELSE
                 GO TO LDS-PROCESO.
      
       FIN-PROCESO.
           EXIT.
      *
      ******************************************************************
      *
       LEER-LDCCLS SECTION.
       INI-LEER-LDCCLS.
           MOVE FIO-GET-NXT     TO FIO-CMND.
           PERFORM LDC-FIO-CLS.
           ADD 1 TO WSS-LEIDOS-CLS.
       FIN-LEER-LDCCLS.
           EXIT.
      *
      ******************************************************************
      *
       LEER-LDCRDS SECTION.
       INI-LEER-LDCRDS.
           MOVE FIO-GET-NXT     TO FIO-CMND.
           PERFORM LDC-FIO-RDS.
           ADD 1 TO WSS-LEIDOS-RDS.
       FIN-LEER-LDCRDS.
           EXIT.
      *
      ******************************************************************
      *
       LEER-LDCLDS SECTION.
       INI-LEER-LDCLDS.
           MOVE FIO-GET-NXT     TO FIO-CMND.
           PERFORM LDC-FIO-LDS.
           ADD 1 TO WSS-LEIDOS-LDS.
       FIN-LEER-LDCLDS.
           EXIT.
      *
      *****************************************************************
      *
       LEER-PROCESO-LDCARS SECTION.
       INI-LEER-PROCESO-LDCARS.
           IF LDC-KEY-ILDC IN LDS > ARG-KEY-ILDC IN ARS
              PERFORM LEER-LDCARS
              IF NOT FIO-STAT-OKS
                 GO TO FIN-LEER-PROCESO-LDCARS
              ELSE
                 GO TO INI-LEER-PROCESO-LDCARS.
      
           IF LDC-KEY-ILDC IN LDS < ARG-KEY-ILDC IN ARS
              GO TO FIN-LEER-PROCESO-LDCARS.
      
           IF LDC-KEY-ILDC IN LDS = ARG-KEY-ILDC IN ARS
              MOVE 0 TO WSS-YALEIDO1
              PERFORM GRABAR-GS4
              PERFORM LEER-LDCARS
              IF NOT FIO-STAT-OKS
                 GO TO FIN-LEER-PROCESO-LDCARS
              ELSE
                 GO TO INI-LEER-PROCESO-LDCARS.
      
       FIN-LEER-PROCESO-LDCARS.
           EXIT.
      *
      *****************************************************************
      *
       LEER-LDCARS SECTION.
       INI-LEER-LDCARS.
      
           IF WSS-INDICA-ARS = 1
              MOVE '23' TO FIO-STAT
              GO TO FIN-LEER-LDCARS.
      
           MOVE FIO-GET-NXT     TO FIO-CMND.
           PERFORM LDC-FIO-ARS.
           IF NOT FIO-STAT-OKS
              MOVE 1 TO WSS-INDICA-ARS
              GO TO FIN-LEER-LDCARS.
      
           ADD 1 TO WSS-LEIDOS-ARS.
       FIN-LEER-LDCARS.
           EXIT.
      *
      *****************************************************************
      *
       GRABAR-GS4 SECTION.
       INI-GRABAR-GS4.
           MOVE RDC-CAI-ICLI    IN RDS TO GS4-CAI-ICLI IN GS4.
           MOVE RDC-IIC-ICLI    IN RDS TO GS4-IIC-ICLI IN GS4.
           MOVE RDC-CAI-ICLF    IN RDS TO GS4-CAI-ICLF IN GS4.
           MOVE RDC-IIC-ICLF    IN RDS TO GS4-IIC-ICLF IN GS4.
           MOVE LDC-IND-VIGE    IN LDS TO GS4-IND-VIGE IN GS4.
           MOVE ARG-NUM-ILDC    IN ARS TO GS4-NUM-ILDC IN GS4.
           MOVE ARG-NUM-IARG    IN ARS TO GS4-NUM-IARG IN GS4.
           MOVE ARG-CAI-IGAR    IN ARS TO GS4-CAI-IGAR IN GS4.
           MOVE ARG-IIC-IGAR    IN ARS TO GS4-IIC-IGAR IN GS4.
           MOVE ARG-COD-TOGA    IN ARS TO GS4-COD-TOGA IN GS4.
           MOVE ARG-COD-AOGA    IN ARS TO GS4-COD-AOGA IN GS4.
           MOVE FIO-PUT                TO FIO-CMND.
           PERFORM GAR-FIO-GS4.
           ADD 1 TO WSS-GRABAR-GS4.
        FIN-GRABAR-GS4.
           EXIT.
      *
      ******************************************************************
      *
       ESTADISTICAS SECTION.
       INI-ESTADISTICAS.
           DISPLAY 'REGISTROS LEIDOS DE CLS     : ' WSS-LEIDOS-CLS.
           DISPLAY 'REGISTROS LEIDOS DE RDS     : ' WSS-LEIDOS-RDS.
           DISPLAY 'REGISTROS LEIDOS DE LDS     : ' WSS-LEIDOS-LDS.
           DISPLAY 'REGISTROS LEIDOS DE ARS     : ' WSS-LEIDOS-ARS.
           DISPLAY 'REGISTROS GRABADOS DE GS4   : ' WSS-GRABAR-GS4.
       FIN-ESTADISTICAS.
           EXIT.
      *
      ******************************************************************
      *
       CLOSE-FILE SECTION.
       INI-CLOSE-FILE.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM LDC-FIO-CLS.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM LDC-FIO-RDS.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM LDC-FIO-LDS.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM LDC-FIO-ARS.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GS4.
       FIN-CLOSE-FILE.
           EXIT.
      *
      ******************************************************************
      *
       PRG-ABT SECTION.
       INI-PRG-ABT.
            DISPLAY 'ABORTANDO EN PRG-ABT '.
            DISPLAY 'FIO-MENS : ' FIO-MENS.
            MOVE 100 TO RETURN-CODE.
            GOBACK.
       FIN-PRG-ABT.
            EXIT.
      *
      ******************************************************************
      *
       COPY LDCBFCLS.
       COPY LDCBFRDS.
       COPY LDCBFLDS.
       COPY LDCBFARS.
       COPY GARBFGS4
       .
      
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBGEND.
       COPY GNSBGABT.
       COPY GNSBVTAB.
      
       COPY GNSBFTAB.
       COPY TABBFCAM.
       COPY GNSBFMSG.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY GNSBBSYS.
      *
