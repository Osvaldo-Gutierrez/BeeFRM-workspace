       IDENTIFICATION DIVISION.
       PROGRAM-ID.  GARPGGUB.

      * Traspasa registros del archivo aplanado GUB a la base de datos
      * nueva

       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
       WORKING-STORAGE SECTION.

       COPY GARBRUBS.
       COPY GARBRGUB.

       COPY TABBRCAM.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GBU-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       
       COPY GNSWVSCR.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSLGFIO.
       COPY GNSWGSYS.
   
       01  WS-VARIABLES.
           02 WSS-FIN-ARCH     VALUE ZEROES PIC 9(01).
           02 WSS-REG-LEIDOS   VALUE ZEROES PIC 9(09).
           02 WSS-REG-GRABADOS VALUE ZEROES PIC 9(09).
           02 WSS-CON-ERROR    VALUE ZEROES PIC 9(09).
           
       01  WSS-GRUPO-A.
           02 WSS-DIR-1A       VALUE SPACES PIC X(40).
           02 WSS-DIR-2A       VALUE SPACES PIC X(40).
           02 WSS-OTRO-3A      VALUE SPACES PIC X(30).
           
       01  WSS-GRUPO-B.
           02 WSS-DIR-1B       VALUE SPACES PIC X(50).
           02 WSS-NUM-2B       VALUE SPACES PIC X(10).
           02 WSS-OTRO-3B      VALUE SPACES PIC X(50).

       PROCEDURE DIVISION.
      *
       MAIN-PROGRAM SECTION.
       INI-MAIN.
           ENTRY 'DBMSCBL'               
           MOVE "GARPGGUB" TO FIO-PROG.  
           PERFORM GNS-BUS-IDD.  
           PERFORM OPEN-FILE.
           MOVE 0 TO WSS-FIN-ARCH.
           MOVE 0 TO WSS-REG-LEIDOS.
           MOVE 0 TO WSS-REG-GRABADOS.
           MOVE 0 TO WSS-CON-ERROR.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-UBS.
           IF NOT FIO-STAT-OKS 
              MOVE 1 TO WSS-FIN-ARCH
           ELSE   
              ADD 1 TO WSS-REG-LEIDOS.
           PERFORM PROCESO UNTIL WSS-FIN-ARCH = 1.
           PERFORM ESTADISTICAS.
           PERFORM CLOSE-FILE
           PERFORM GNS-PRO-END.
       FIN-MAIN.
           EXIT.
      *
       OPEN-FILE SECTION.
       INI-OPEN-FILE.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-UBS.
       FIN-OPEN-FILE.
           EXIT.
      *
       PROCESO SECTION.
       INI-PROCESO.
           PERFORM MUEVE-DATOS.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-UBS.
           IF FIO-STAT-EOF
              MOVE 1 TO WSS-FIN-ARCH
           ELSE
              ADD 1 TO WSS-REG-LEIDOS.
       FIN-PROCESO.
           EXIT.
      *
       MUEVE-DATOS SECTION.
       INI-MUEVE-DATOS.      
           MOVE     GUB-GLS-FLAG    IN UBS TO GUB-GLS-FLAG  IN GUB
           MOVE   GAR-NUM-SIS     IN UBS TO GUB-CAI-GTIA  IN GUB
           MOVE   GAR-COD-CRR     IN UBS TO GUB-IIC-GTIA  IN GUB
           MOVE   GUB-FEC-ULT-ACT IN UBS TO GUB-FEC-FTRN  IN GUB
           MOVE   GUB-HOR-ACT     IN UBS TO GUB-HRA-HRTR  IN GUB
           MOVE   GUB-MSC-TACC    IN UBS TO GUB-MSC-TACC  IN GUB
           MOVE   GUB-MSC-STAT    IN UBS TO GUB-MSC-STAT  IN GUB
           MOVE   GUB-TML-ACT     IN UBS TO GUB-COD-OTRN  IN GUB
           MOVE   GUB-IDN-USU-ACT IN UBS TO GUB-COD-ATRN  IN GUB
           MOVE   GAR-TIV-ALM     IN UBS TO GUB-COD-TIAL  IN GUB
           MOVE   GAR-CIV-ALM     IN UBS TO GUB-COD-CIAL  IN GUB
           MOVE   GAR-SIV-ALM     IN UBS TO GUB-COD-SIAL  IN GUB
           MOVE   ZEROES                 TO GUB-NUM-SDEP  IN GUB
           MOVE ZEROES                 TO GUB-NUM-ADEP  IN GUB
           MOVE     ZEROES                 TO GUB-NUM-MDEP  IN GUB
           MOVE   ZEROES                 TO GUB-NUM-DDEP  IN GUB
           MOVE   GAR-TIV-AGT-ADN IN UBS TO GUB-COD-TIAD  IN GUB
           MOVE   GAR-CIV-AGT-ADN IN UBS TO GUB-COD-CIAD  IN GUB
           MOVE   GAR-SIV-AGT-ADN IN UBS TO GUB-COD-SIAD  IN GUB
           MOVE   GAR-COD-UBI-DOC IN UBS TO GUB-COD-UDOC  IN GUB
           MOVE GAR-DIR-1       IN UBS TO WSS-DIR-1A.
           MOVE GAR-DIR-2       IN UBS TO WSS-DIR-2A.
           MOVE WSS-GRUPO-A            TO WSS-GRUPO-B.
           MOVE WSS-DIR-1B             TO GUB-GLS-CLLE  IN GUB
           MOVE WSS-NUM-2B             TO GUB-GLS-NUME  IN GUB
           MOVE       WSS-OTRO-3B            TO GUB-GLS-OTRS  IN GUB
           MOVE   GAR-COD-RGN-UBI IN UBS TO GUB-COD-RGON  IN GUB
           MOVE   GAR-COD-LOC-UBI IN UBS TO GUB-COD-LOCA  IN GUB
           MOVE   GAR-COD-CMN     IN UBS TO GUB-COD-COMU  IN GUB
           MOVE   SPACES                 TO GUB-COD-COLO  IN GUB
           MOVE   SPACES                 TO GUB-COD-POST  IN GUB
           MOVE   SPACES                 TO GUB-COD-REGN  IN GUB
           MOVE   SPACES                 TO GUB-COD-AREA  IN GUB
           MOVE   GUB-FEC-ING-SIS IN UBS TO GUB-FEC-FING  IN GUB
           MOVE   GUB-IDN-USU-ING IN UBS TO GUB-CIC-UING  IN GUB
           MOVE   GUB-GLS-DISP    IN UBS TO GUB-GLS-DISP  IN GUB                             
           MOVE FIO-PUT                TO FIO-CMND.
           PERFORM GAR-FIO-GUB.
           IF FIO-STAT-OKS 
              ADD 1 TO WSS-REG-GRABADOS
    ELSE   
            ADD 1 TO WSS-CON-ERROR.
       FIN-MUEVE-DATOS.
           EXIT.
      *                                                                 
       ESTADISTICAS SECTION.                                            
       INI-ESTADISTICAS.                                                
           DISPLAY 'REGISTROS LEIDOS DE UBS     : ' WSS-REG-LEIDOS.     
           DISPLAY 'REGISTROS GRABADOS DE GUB   : ' WSS-REG-GRABADOS.     
           DISPLAY 'REGISTROS MAL GRABADOS      : ' WSS-CON-ERROR.             
       FIN-ESTADISTICAS.                                                
           EXIT.     
      *     
       CLOSE-FILE SECTION.
       INI-CLOSE-FILE.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-UBS.
       FIN-CLOSE-FILE.
           EXIT.
      *
       COPY GARBFUBS.

       COPY GARBFGUB.

       COPY GNSBBIDD.

       COPY GNSBTABT.
       COPY GNSBGEND.
