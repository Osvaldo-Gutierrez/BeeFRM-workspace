       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GARPGPA1.
       AUTHOR.          R. CHIANG.
       DATE-WRITTEN     19-JUN-2003.
      
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
      *        DECIMAL-POINT IS COMMA.
      
       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *-----------------------
      
       COPY GARBREES.
       COPY COLBROPS.
       COPY GARBRGYO.
      
       COPY TABBRCAM.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.
      
       01  VARIABLES.
           03 WSS-LEIDOS-EES      VALUE ZEROES      PIC 9(08).
           03 WSS-LEIDOS-OPS      VALUE ZEROES      PIC 9(08).
           03 WSS-GRABAR-GYO      VALUE ZEROES      PIC 9(08).
           03 WSS-YALEIDO         VALUE ZEROES      PIC 9(01).
      
      
       PROCEDURE DIVISION.
      *==================
      
       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.
           ENTRY 'DBMSCBL'
           MOVE "GARPGPA1" TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           PERFORM OPEN-FILE.
           MOVE 0 TO WSS-YALEIDO.
           PERFORM PROCESO.
           PERFORM ESTADISTICAS.
           PERFORM CLOSE-FILE.
           PERFORM GNS-PRO-END.
       FIN-MAIN.
           EXIT.
      *
      ******************************************************************
      *
       OPEN-FILE SECTION.
       INI-OPEN-FILE.
      *    DISPLAY 'INI-OPEN-FILE'.
           MOVE 'GAR'   TO FIO-SIST.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-EES.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-OPS.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM GAR-FIO-GYO.
      *    DISPLAY 'FIN-OPEN-FILE'.
       FIN-OPEN-FILE.
           EXIT.
      *
      ******************************************************************
      *
       PROCESO SECTION.
       INI-PROCESO.
      
      *    PERFORM LEER-GARGES.
           PERFORM LEER-COLOPS.
           IF NOT FIO-STAT-OKS
              GO TO FIN-PROCESO.
      
       UNO-PROCESO.
           IF WSS-YALEIDO = 0
      *       PERFORM LEER-COLOPS
              PERFORM LEER-GARGES
              IF NOT FIO-STAT-OKS
                 GO TO FIN-PROCESO.
      
           IF GAR-CIC-IOPC IN EES = OPC-CIC-IOPC IN OPS
              PERFORM GRABAR-GYO
              MOVE 0 TO WSS-YALEIDO
              GO TO UNO-PROCESO.
      *    IF GAR-CIC-IOPC IN EES > OPC-CIC-IOPC IN OPS
           IF OPC-CIC-IOPC IN OPS > GAR-CIC-IOPC IN EES
              MOVE 0 TO WSS-YALEIDO
              GO TO UNO-PROCESO
           ELSE
              MOVE 1 TO WSS-YALEIDO
              GO TO INI-PROCESO.
       FIN-PROCESO.
           EXIT.
      *
      ******************************************************************
      *
       LEER-GARGES SECTION.
       INI-LEER-GARGES.
           MOVE FIO-GET-NXT     TO FIO-CMND.
           PERFORM GAR-FIO-EES.
           ADD 1 TO WSS-LEIDOS-EES.
       FIN-LEER-GARGES.
           EXIT.
      *
      ******************************************************************
      *
       LEER-COLOPS SECTION.
       INI-LEER-COLOPS.
           MOVE FIO-GET-NXT     TO FIO-CMND.
           PERFORM COL-FIO-OPS.
           ADD 1 TO WSS-LEIDOS-OPS.
       FIN-LEER-COLOPC.
           EXIT.
      *
      *****************************************************************
      *
       GRABAR-GYO SECTION.
       INI-GRABAR-GYO.
           MOVE GAR-NUM-SIS     IN EES TO GYO-NUM-SIS     IN GYO.
           MOVE GAR-COD-CRR     IN EES TO GYO-COD-CRR     IN GYO.
           MOVE GAR-NUM-SIS-CDT IN EES TO GYO-NUM-SIS-CDT IN GYO.
           MOVE GAR-COD-CRR-CDT IN EES TO GYO-COD-CRR-CDT IN GYO.
           MOVE OPC-MSC-STAT    IN OPS TO GYO-MSC-STAT    IN GYO.
           MOVE OPC-VAL-SCRE    IN OPS TO GYO-VAL-SCRE    IN GYO.
           MOVE FIO-PUT                TO FIO-CMND.
           PERFORM GAR-FIO-GYO.
           ADD 1 TO WSS-GRABAR-GYO.
        FIN-GRABAR-GYO.
           EXIT.
      *
      ******************************************************************
      *
       ESTADISTICAS SECTION.
       INI-ESTADISTICAS.
           DISPLAY 'REGISTROS LEIDOS DE EES     : ' WSS-LEIDOS-EES.
           DISPLAY 'REGISTROS LEIDOS DE OPS     : ' WSS-LEIDOS-OPS
           DISPLAY 'REGISTROS GRABADOS DE GYO   : ' WSS-GRABAR-GYO.
       FIN-ESTADISTICAS.
           EXIT.
      *
      ******************************************************************
      *
       CLOSE-FILE SECTION.
       INI-CLOSE-FILE.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-EES.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-OPS.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GYO.
       FIN-CLOSE-FILE.
           EXIT.
      *
      ******************************************************************
      *
       PRG-ABT SECTION.
       INI-PRG-ABT.
            DISPLAY 'ABORTANDO EN PRG-ABT '.
            DISPLAY 'FIO-MENS : ' FIO-MENS.
            MOVE 100 TO RETURN-CODE.
            GOBACK.
       FIN-PRG-ABT.
            EXIT.
      *
      ******************************************************************
      *
       COPY GARBFEES.
       COPY COLBFOPS.
       COPY GARBFGYO.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBGEND.
       COPY GNSBGABT.
       COPY GNSBVTAB.
      
       COPY GNSBFTAB.
       COPY TABBFCAM.
       COPY GNSBFMSG.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY GNSBBSYS.
      *
