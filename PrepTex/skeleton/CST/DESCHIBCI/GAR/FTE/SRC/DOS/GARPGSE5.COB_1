       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GARPGSE5.
       AUTHOR.          R. CHIANG.
       DATE-WRITTEN     17-JUN-2003.
      
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
      *        DECIMAL-POINT IS COMMA.
      
       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *-----------------------
      
       COPY GARBRSGM.
       COPY COLBRAUX.
       COPY GARBRGCS.
       COPY GARBRECS.
       COPY GARBRGEC.
       COPY GARBRSGE.
       COPY GARBRGDS.
       COPY GARBRGYO.
       COPY GARBRGMA.
       COPY GARBRDDS.
       COPY GARBRDS2.
       COPY GARBRGS5.
       COPY GARBRNEG.
       COPY GARBREXR.
      
       COPY TABBRCAM.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.
      
       01  VARIABLES.
           03 WSS-LEIDOS-SGM    VALUE ZEROES      PIC 9(05).
           03 WSS-LEIDOS-GCL    VALUE ZEROES      PIC 9(05).
           03 WSS-LEIDOS-SGV    VALUE ZEROES      PIC 9(05).
           03 WSS-LEIDOS-DBS    VALUE ZEROES      PIC 9(05).
           03 WSS-LEIDOS-DDS    VALUE ZEROES      PIC 9(05).
           03 WSS-GRABAR-SGM    VALUE ZEROES      PIC 9(05).
           03 WSS-GRABAR-GMA    VALUE ZEROES      PIC 9(05).
           03 WSS-GRABAR-EXR    VALUE ZEROES      PIC 9(05).
           03 WSS-GRABAR-GCS    VALUE ZEROES      PIC 9(05).
           03 WSS-GRABAR-SGE    VALUE ZEROES      PIC 9(05).
           03 WSS-GRABAR-NEG    VALUE ZEROES      PIC 9(05).
           03 WSS-FIN-ARCHIVO   VALUE SPACES      PIC X(01).
      
           03 WSS-GYO           VALUE ZEROES      PIC 9(01).
           03 WSS-BCO           VALUE ZEROES      PIC 9(01).
           03 WSS-SYA           VALUE ZEROES      PIC 9(01).
           03 WSS-DS2           VALUE ZEROES      PIC 9(01).
           03 WSS-GS5           VALUE ZEROES      PIC 9(01).
           03 WSS-GENER         VALUE ZEROES      PIC 9(01).
           03 WSS-YALEIDO       VALUE ZEROES      PIC 9(01).
           03 WSS-YALEIDO-GDS   VALUE ZEROES      PIC 9(01).
           03 WSS-YALEIDO-BCO   VALUE ZEROES      PIC 9(01).
           03 WSS-YALEIDO-NO2   VALUE ZEROES      PIC 9(01).
           03 WSS-F-GYO         VALUE ZEROES      PIC 9(01).
           03 WSS-LGYO          VALUE ZEROES      PIC 9(01).
           03 WSS-CONTADOR      VALUE ZEROES      PIC 9(05).
           03 WSS-FIN-SGM       VALUE ZEROES      PIC 9(01).
           03 WSS-FIN-BANCO     VALUE ZEROES      PIC 9(01).
           03 WSS-FIN-GDS       VALUE ZEROES      PIC 9(01).
           03 WSS-FIN-DS2       VALUE ZEROES      PIC 9(01).
           03 WSS-FIN-GS5       VALUE ZEROES      PIC 9(01).
           03 WSS-FIN-GYO       VALUE ZEROES      PIC 9(01).
           03 WSS-GAR-NEG       VALUE ZEROES      PIC 9(01).
      
           03 WSS-CAMPO-TABLA.
              05 WSS-CAMPO-1    VALUE SPACES      PIC X(01).
              05 WSS-CAMPO-2    VALUE SPACES      PIC X(01).
              05 WSS-CAMPO-3    VALUE SPACES      PIC X(43).
      
      
       PROCEDURE DIVISION.
      *==================
      
       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.
           ENTRY 'DBMSCBL'
           MOVE "GARPGSE5" TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           PERFORM OPEN-FILE.
           MOVE SPACES TO WSS-FIN-ARCHIVO.
           PERFORM PROCESO.
           PERFORM ESTADISTICAS.
           PERFORM CLOSE-FILE.
           PERFORM GNS-PRO-END.
       FIN-MAIN.
           EXIT.
      *
      ******************************************************************
      *
       OPEN-FILE SECTION.
       INI-OPEN-FILE.
      *    DISPLAY 'INI-OPEN-FILE'.
           MOVE 'GAR'   TO FIO-SIST.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-SGM.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM GAR-FIO-GCS.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-ECS.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-GEC.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM GAR-FIO-SGE.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-GDS.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-GYO.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM GAR-FIO-GMA.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-DDS.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-DS2.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-GS5.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM GAR-FIO-NEG.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM GAR-FIO-EXR.
      *    DISPLAY 'FIN-OPEN-FILE'.
       FIN-OPEN-FILE.
           EXIT.
      *
      ******************************************************************
      *
       PROCESO SECTION.
       INI-PROCESO.
           MOVE 0 TO WSS-GAR-NEG.
           MOVE 0 TO WSS-GYO.
           MOVE 0 TO WSS-BCO.
           MOVE 0 TO WSS-SYA.
           PERFORM LEER-SGM-Y-AUX.
           IF WSS-FIN-SGM = 1
              GO TO TER-PROCESO.
           IF WSS-SYA = 1
              GO TO INI-PROCESO.
           IF WSS-FIN-GDS = 0
              PERFORM LEER-GDS.
           IF WSS-FIN-GDS = 1
              GO TO INI-PROCESO.
           IF WSS-GYO = 1
              GO TO INI-PROCESO.
           IF WSS-FIN-GS5 = 0
              PERFORM NORMATIVA-2.
           IF WSS-GAR-NEG NOT = 1
              PERFORM GRABAR-NEG.
           GO TO INI-PROCESO.
       TER-PROCESO.
           PERFORM GRABAR-BCI.
       FIN-PROCESO.
           EXIT.
      *
      ******************************************************************
      *
       GRABAR-BCI SECTION.
       INI-GRABAR-BCI.
           IF WSS-FIN-BANCO = 1
              GO TO FIN-GRABAR-BCI.
           IF WSS-YALEIDO-BCO = 1
              PERFORM GRABAR-EXR
              MOVE 0 TO WSS-YALEIDO-BCO
           ELSE
              PERFORM LEER-ARCH-BANCO
              IF WSS-FIN-BANCO = 0
                 PERFORM GRABAR-EXR.
           GO TO INI-GRABAR-BCI.
       FIN-GRABAR-BCI.
           EXIT.
      *
      ******************************************************************
      *
       LEER-SGM-Y-AUX SECTION.
       INI-LEER-SGM-Y-AUX.
           MOVE FIO-GET-NXT     TO FIO-CMND.
           PERFORM GAR-FIO-SGM.
           IF FIO-STAT-EOF
              MOVE 1 TO WSS-FIN-SGM
              GO TO FIN-LEER-SGM-Y-AUX.
           ADD 1 TO WSS-LEIDOS-SGM.
       LEER-BCO.
      
           IF WSS-YALEIDO-BCO = 0
              PERFORM LEER-ARCH-BANCO
              IF WSS-FIN-BANCO = 1
                 GO TO LEER-AUX.
           IF SGM-CLV-CSS-1 > ECS-CLV-CSS-1
              PERFORM GRABAR-EXR
              MOVE 0 TO WSS-YALEIDO-BCO
              GO TO LEER-BCO
           ELSE
             IF SGM-CLV-CSS-1 = ECS-CLV-CSS-1
                MOVE 0 TO WSS-YALEIDO-BCO
           ELSE
             IF SGM-CLV-CSS-1 < ECS-CLV-CSS-1
                MOVE 1 TO WSS-YALEIDO-BCO.
       LEER-AUX.
           IF SGM-TIP-OPE > SPACES
              MOVE 'TAB'        TO TAB-COD-SIST
              MOVE 'AUX'        TO TAB-COD-TTAB IN TAB
              MOVE SPACES       TO TAB-COD-CTAB IN TAB
              MOVE SGM-CLA-OPE  TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              IF MSG-COD-MENS > SPACES
                 DISPLAY 'ERROR EN TAB AUX: ' SGM-CLA-OPE SGM-CLV-CSS-1
                 GO TO INI-LEER-SGM-Y-AUX
              ELSE
                 IF TAB-COD-DAT1 IN TAB-GLS-DAT1(2) = 'O' OR 'N'
                    PERFORM GRABAR-GCSE
                    GO TO INI-LEER-SGM-Y-AUX
                 ELSE
                  IF TAB-COD-DAT1 IN TAB-GLS-DAT1(2) = 'A'
                     GO TO PAREA-BCO
                  ELSE
                   DISPLAY 'AUX NO POBLADA:' SGM-CLA-OPE IN SGM
                   GO TO INI-LEER-SGM-Y-AUX
           ELSE
              GO TO INI-LEER-SGM-Y-AUX.
       PAREA-BCO.
           IF SGM-CLV-CSS-1 = ECS-CLV-CSS-1
              PERFORM GRABAR-SGE
              MOVE 1 TO WSS-SYA
           ELSE
      *       IF SGM-CLV-CSS-1 > ECS-CLV-CSS-1
      *          MOVE 0 TO WSS-SYA
      *          GO TO LEER-BCO
      *       ELSE
                 MOVE 0 TO WSS-SYA.
       FIN-LEER-SGM-Y-AUX.
           EXIT.
      *
      *****************************************************************
      *
       GRABAR-GCSE SECTION.
       INI-GRABAR-GCSE.
           MOVE SGM-NUM-SIS    IN SGM TO GCS-NUM-SIS    IN GCS
           MOVE SGM-COD-CRR    IN SGM TO GCS-COD-CRR    IN GCS
           MOVE SGM-TIP-OPE    IN SGM TO GCS-TIP-OPE    IN GCS
           MOVE SGM-STP-OPE    IN SGM TO GCS-STP-OPE    IN GCS
           MOVE SGM-FA-VTO-SEG IN SGM TO GCS-FA-VTO-SEG IN GCS
           MOVE SGM-FM-VTO-SEG IN SGM TO GCS-FM-VTO-SEG IN GCS
           MOVE SGM-FD-VTO-SEG IN SGM TO GCS-FD-VTO-SEG IN GCS
           MOVE FIO-PUT               TO FIO-CMND.
           PERFORM GAR-FIO-GCS.
           ADD 1 TO WSS-GRABAR-GCS.
      *    DISPLAY 'GARANTIAS CORRECTAS SIN EXCEPCION : ' GCS.
        FIN-GRABAR-GCSE.
           EXIT.
      *
      ****************************************************************
      *
       LEER-BANCO SECTION.
       INI-LEER-BANCO.
           IF WSS-YALEIDO = 0
              PERFORM LEER-ARCH-BANCO.
           IF WSS-FIN-BANCO = 1
             GO TO FIN-LEER-BANCO.
           IF SGM-CLV-CSS-1 = ECS-CLV-CSS-1
              PERFORM GRABAR-SGE
              MOVE 1 TO WSS-BCO
              MOVE 0 TO WSS-YALEIDO
           ELSE
              IF SGM-CLV-CSS-1 > ECS-CLV-CSS-1
                 PERFORM GRABAR-EXR
                 MOVE 0 TO WSS-YALEIDO
                 GO TO INI-LEER-BANCO
              ELSE
                 MOVE 1 TO WSS-YALEIDO.
       FIN-LEER-BANCO.
           EXIT.
      *
      ******************************************************************
      *
       LEER-ARCH-BANCO SECTION.
       INI-LEER-ARCH-BANCO.
           IF WSS-FIN-BANCO = 1
              GO TO FIN-LEER-ARCH-BANCO.
      
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-ECS.
           IF FIO-STAT-EOF
              MOVE 1 TO WSS-FIN-BANCO.
       FIN-LEER-ARCH-BANCO.
           EXIT.
      *
      *****************************************************************
      *
       GRABAR-SGE SECTION.
       INI-GRABAR-SGE.
           MOVE SGM-NUM-SIS    IN SGM TO SGE-NUM-SIS    IN SGE.
           MOVE SGM-COD-CRR    IN SGM TO SGE-COD-CRR    IN SGE.
           MOVE SGM-TIP-OPE    IN SGM TO SGE-TIP-OPE    IN SGE.
           MOVE SGM-STP-OPE    IN SGM TO SGE-STP-OPE    IN SGE.
           MOVE SGM-FA-VTO-SEG IN SGM TO SGE-FA-VTO-SEG IN SGE.
           MOVE SGM-FM-VTO-SEG IN SGM TO SGE-FM-VTO-SEG IN SGE.
           MOVE SGM-FD-VTO-SEG IN SGM TO SGE-FD-VTO-SEG IN SGE.
           MOVE ECS-FA-VTO-SEG IN ECS TO SGE-FA-EXC     IN SGE.
           MOVE ECS-FM-VTO-SEG IN ECS TO SGE-FM-EXC     IN SGE.
           MOVE ECS-FD-VTO-SEG IN ECS TO SGE-FD-EXC     IN SGE.
           MOVE FIO-PUT               TO FIO-CMND.
           PERFORM GAR-FIO-SGE.
           ADD 1 TO WSS-GRABAR-SGE.
        FIN-GRABAR-SGE.
           EXIT.
      *
      ************************************************************
      *
       GRABAR-EXR SECTION.
       INI-GRABAR-EXR.
           MOVE ECS-NUM-SIS    IN ECS TO EXR-GAR-NUM-SIS  IN EXR.
           MOVE ECS-COD-CRR    IN ECS TO EXR-GAR-COD-CRR  IN EXR.
           MOVE ECS-FA-VTO-SEG IN ECS TO EXR-FAA-VCTO-EXCP-COM IN EXR.
           MOVE ECS-FM-VTO-SEG IN ECS TO EXR-FMM-VCTO-EXCP-COM IN EXR.
           MOVE ECS-FD-VTO-SEG IN ECS TO EXR-FDD-VCTO-EXCP-COM IN EXR.
           MOVE FIO-PUT               TO FIO-CMND.
           PERFORM GAR-FIO-EXR.
           ADD 1 TO WSS-GRABAR-EXR.
           IF WSS-GRABAR-EXR = 20
              PERFORM GNS-PRO-END.
        FIN-GRABAR-ENR.
           EXIT.
      ******************************************************************
      *
       LEER-GDS SECTION.
       INI-LEER-GDS.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GDS.
           IF FIO-STAT-EOF
              MOVE 1 TO WSS-FIN-GDS
              GO TO FIN-LEER-GDS.
           IF SGM-CLV-CSS-1 IN SGM = GAR-CLV-GDG-1 IN GDS
              IF GAR-COD-LIM IN GDS = 'E'
                 IF WSS-FIN-GYO = 0
                    PERFORM ESPECIFICA
                 ELSE
                    GO TO FIN-LEER-GDS
              ELSE
                 IF GAR-COD-LIM IN GDS = 'G'
                    IF WSS-FIN-ARCHIVO = SPACES
                       PERFORM GENERAL
                    ELSE
                       GO TO FIN-LEER-GDS
                 ELSE
      *             DISPLAY 'SALIO POR NEXT SENTENCE'
                    NEXT SENTENCE
           ELSE
             IF SGM-CLV-CSS-1 IN SGM > GAR-CLV-GDG-1 IN GDS
                GO TO INI-LEER-GDS
             ELSE
                MOVE 1 TO WSS-YALEIDO-GDS.
       FIN-LEER-GDS.
           EXIT.
      *
      ******************************************************************
      *
       ESPECIFICA SECTION.
       INI-ESPECIFICA.
           IF WSS-LGYO = 0
              PERFORM LEER-GARGYO.
           IF WSS-FIN-GYO = 1
              GO TO FIN-ESPECIFICA.
           IF SGM-CLV-CSS-1 IN SGM = GYO-CLV-CSS-1 IN GYO
              IF GYO-MSC-STAT IN GYO = 'A' AND
                 GYO-VAL-SCRE IN GYO > 0
                 PERFORM GRABAR-GMA
                 MOVE 0 TO WSS-LGYO
                 MOVE 1 TO WSS-GYO
              ELSE
                 IF GYO-VAL-SCRE IN GYO = 0
                    MOVE 0 TO WSS-LGYO
                    GO TO INI-ESPECIFICA
                 ELSE
                   IF GYO-MSC-STAT IN GYO NOT = 'A' AND
                      GYO-VAL-SCRE IN GYO > 0
                      MOVE 0 TO WSS-LGYO
                    GO TO INI-ESPECIFICA.
           IF SGM-CLV-CSS-1 IN SGM > GYO-CLV-CSS-1 IN GYO
              MOVE 0 TO WSS-LGYO
              GO TO INI-ESPECIFICA
           ELSE
              MOVE 1 TO WSS-LGYO.
       FIN-ESPECIFICA.
           EXIT.
      *
      ******************************************************************
      *
       LEER-GARGYO SECTION.
       INI-LEER-GARGYO.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GYO.
           IF FIO-STAT-EOF
              MOVE 1 TO WSS-FIN-GYO.
       FIN-LEER-GARGYO.
           EXIT.
      *
      ******************************************************************
      *
       GENERAL SECTION.
       INI-GENERAL.
           IF WSS-GENER = 0
              PERFORM LEER-DS2.
           IF WSS-FIN-ARCHIVO = 'A'
              GO TO FIN-GENERAL.
           IF SGM-CLV-CSS-1 IN SGM = DS2-CLV-CSS-1 IN DS2
              IF DS2-MSC-STAT IN DS2 = 'A' AND
                 DS2-VAL-SCRE IN DS2 > 0
                 PERFORM GRABAR-GMA
                 MOVE 1 TO WSS-GYO
                 MOVE 0 TO WSS-GENER
              ELSE
                 IF DS2-VAL-SCRE IN DS2 = 0
                 MOVE 0 TO WSS-GENER
                    GO TO INI-GENERAL
                 ELSE
                 IF DS2-MSC-STAT IN DS2 NOT = 'A' AND
                    DS2-VAL-SCRE IN DS2 NOT < 0
                    MOVE 0 TO WSS-GENER
                    GO TO INI-GENERAL.
           IF SGM-CLV-CSS-1 IN SGM > DS2-CLV-CSS-1 IN DS2
              MOVE 0 TO WSS-GENER
              GO TO INI-GENERAL
           ELSE
              MOVE 1 TO WSS-GENER.
       FIN-GENERAL.
           EXIT.
      *
      ******************************************************************
      *
       LEER-DDS SECTION.
       INI-LEER-DDS.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-DDS.
       FIN-LEER-DDS.
           EXIT.
      *
      ******************************************************************
      *
       LEER-DS2 SECTION.
       INI-LEER-DS2.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-DS2.
           IF     FIO-STAT-EOF
              MOVE 'A' TO WSS-FIN-ARCHIVO.
       FIN-LEER-DS2.
           EXIT.
      *
      ******************************************************************
      *
       NORMATIVA-2 SECTION.
       INI-NORMATIVA-2.
           IF WSS-YALEIDO-NO2 = 0
              PERFORM LEER-GS5.
           IF WSS-FIN-GS5 = 1
             GO TO FIN-NORMATIVA-2.
           IF SGM-CLV-CSS-1 IN SGM = GS5-CLV-GDD IN GS5
              MOVE 0 TO WSS-YALEIDO-NO2
      *LOP-INI
      *       IF GAR-CLV-GDG-1 IN GDS = GS5-CAI-IGAR IN GS5
              IF GAR-CLV-GDG-1 IN GDS = GS5-CIC-IGAR IN GS5
      *LOP-FIN
                 PERFORM GRABAR-GMA
                 MOVE 1 TO WSS-GS5
                 MOVE 1 TO WSS-GAR-NEG
              ELSE
              IF GAR-CLA-OPE   IN GDS = GS5-TIP-STP  IN GS5
                 PERFORM GRABAR-GMA
                 MOVE 1 TO WSS-GAR-NEG
              ELSE
              IF GAR-TIP-OPE   IN GDS = GS5-COD-TOGA IN GS5
                 PERFORM GRABAR-GMA
                 MOVE 1 TO WSS-GS5
                 MOVE 1 TO WSS-GAR-NEG
              ELSE
              IF GAR-STP-OPE   IN GDS = GS5-COD-AOGA IN GS5
                 PERFORM GRABAR-GMA
                 MOVE 1 TO WSS-GAR-NEG.
      *LOP-INI
      *    IF SGM-CLV-CSS-1 IN SGM > GS5-CLV-GDD IN GS5
      *       MOVE 0 TO WSS-YALEIDO-NO2
      *       GO TO INI-NORMATIVA-2
      *    ELSE
      *       MOVE 1 TO WSS-YALEIDO-NO2.
           IF SGM-CLV-CSS-1 IN SGM < GS5-CLV-GDD IN GS5
              MOVE 1 TO WSS-YALEIDO-NO2
           ELSE
              IF WSS-GAR-NEG = 0
                 MOVE 0 TO WSS-YALEIDO-NO2
                 GO TO INI-NORMATIVA-2
              ELSE
                 MOVE 0 TO WSS-YALEIDO-NO2.
      *LOP-FIN
       FIN-NORMATIVA-2.
           EXIT.
      *
      ******************************************************************
      *
       LEER-GS5 SECTION.
       INI-LEER-GS5.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GS5.
           IF FIO-STAT-EOF
              MOVE 1 TO WSS-FIN-GS5.
       FIN-LEER-GS5.
      
           EXIT.
      *
      *****************************************************************
      *
       GRABAR-GMA SECTION.
       INI-GRABAR-GMA.
           MOVE SGM-NUM-SIS    IN SGM TO  GMA-NUM-SIS    IN GMA
           MOVE SGM-COD-CRR    IN SGM TO  GMA-COD-CRR    IN GMA
           MOVE SGM-TIP-OPE    IN SGM TO  GMA-TIP-OPE    IN GMA
           MOVE SGM-STP-OPE    IN SGM TO  GMA-STP-OPE    IN GMA
           MOVE SGM-COD-PLZ    IN SGM TO  GMA-COD-PLZ    IN GMA
           MOVE SGM-FA-VTO-SEG IN SGM TO  GMA-FA-VTO-SEG IN GMA
           MOVE SGM-FM-VTO-SEG IN SGM TO  GMA-FM-VTO-SEG IN GMA
           MOVE SGM-FD-VTO-SEG IN SGM TO  GMA-FD-VTO-SEG IN GMA
           MOVE SGM-MON-SEG    IN SGM TO  GMA-MON-SEG    IN GMA
           MOVE SGM-VAL-SEG    IN SGM TO  GMA-VAL-SEG    IN GMA
           MOVE SPACES                TO  GMA-FILLER     IN GMA
           MOVE FIO-PUT               TO FIO-CMND.
           PERFORM GAR-FIO-GMA.
           ADD 1 TO WSS-GRABAR-GMA.
        FIN-GRABAR-GMA.
           EXIT.
      *
      *****************************************************************
      *
       GRABAR-NEG SECTION.
       INI-GRABAR-NEG.
           MOVE SGM-NUM-SIS    IN SGM TO  NEG-NUM-SIS    IN NEG
           MOVE SGM-COD-CRR    IN SGM TO  NEG-COD-CRR    IN NEG
           MOVE SGM-TIP-OPE    IN SGM TO  NEG-TIP-OPE    IN NEG
           MOVE SGM-STP-OPE    IN SGM TO  NEG-STP-OPE    IN NEG
           MOVE SGM-FA-VTO-SEG IN SGM TO  NEG-FA-VTO-SEG IN NEG
           MOVE SGM-FM-VTO-SEG IN SGM TO  NEG-FM-VTO-SEG IN NEG
           MOVE SGM-FD-VTO-SEG IN SGM TO  NEG-FD-VTO-SEG IN NEG
           MOVE FIO-PUT               TO FIO-CMND.
           PERFORM GAR-FIO-NEG.
           ADD 1 TO WSS-GRABAR-NEG.
        FIN-GRABAR-NEG.
           EXIT.
      *
      ******************************************************************
      *
       ESTADISTICAS SECTION.
       INI-ESTADISTICAS.
           DISPLAY 'REGISTROS LEIDOS DE SGM   : ' WSS-LEIDOS-SGM.
      *    DISPLAY 'REGISTROS LEIDOS DE SGV   : ' WSS-LEIDOS-SGV.
           DISPLAY 'REGISTROS GRABADOS DE GCS : ' WSS-GRABAR-GCS.
           DISPLAY 'REGISTROS GRABADOS DE SGE : ' WSS-GRABAR-SGE.
           DISPLAY 'REGISTROS GRABADOS DE GMA : ' WSS-GRABAR-GMA.
           DISPLAY 'REGISTROS GRABADOS DE NEG : ' WSS-GRABAR-NEG.
           DISPLAY 'REGISTROS GRABADOS DE EXR : ' WSS-GRABAR-EXR.
       FIN-ESTADISTICAS.
           EXIT.
      *
      ******************************************************************
      *
       CLOSE-FILE SECTION.
       INI-CLOSE-FILE.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-SGM.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GCS.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-ECS.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GEC.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-SGE.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GDS.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GYO.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GMA.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-DDS.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-DS2.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GS5.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-EXR.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-NEG.
       FIN-CLOSE-FILE.
           EXIT.
      *
      ******************************************************************
      *
       PRG-ABT SECTION.
       INI-PRG-ABT.
            DISPLAY 'ABORTANDO EN PRG-ABT '.
            DISPLAY 'FIO-MENS : ' FIO-MENS.
            MOVE 100 TO RETURN-CODE.
            GOBACK.
       FIN-PRG-ABT.
            EXIT.
      *
      ******************************************************************
      *
       COPY GARBFSGM.
       COPY GARBFGCS.
       COPY GARBFECS.
       COPY GARBFSGE.
       COPY GARBFGDS.
       COPY GARBFGYO.
       COPY GARBFGMA.
       COPY GARBFDDS.
       COPY GARBFDS2.
       COPY GARBFGS5.
       COPY GARBFNEG.
       COPY GARBFEXR.
      *
       COPY GARBFGEC.
      
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBGEND.
       COPY GNSBGABT.
       COPY GNSBVTAB.
      
       COPY GNSBFTAB.
       COPY TABBFCAM.
       COPY GNSBFMSG.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY GNSBBSYS.
