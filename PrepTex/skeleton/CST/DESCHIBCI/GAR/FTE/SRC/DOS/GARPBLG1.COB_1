       IDENTIFICATION DIVISION.

       PROGRAM-ID.    GARPBLG1.
       AUTHOR.        CONSIST
      *         PROGRAMA COBOL + DATACOM/DB

      *         SON UTILIZADAS COMO I-O LAS TABLAS DATACOM :

      *             - GDD
      *             - GDG
      *             - GVT
      *             - GES
      *             - GLE
      *             - GUB
      *             - GAP
      *             - GSE
      *             - GDO
      *             - GTP
      *             - GIN
      *             - GSI
      *             - GDP


       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
           DECIMAL-POINT IS COMMA.

       DATA DIVISION.

       WORKING-STORAGE SECTION.

       77    CONT-DEL-GDG           PIC 9(05) VALUE 0.
       77    CONT-LEIDOS            PIC 9(05) VALUE 0.

       01    W-CURRENT-DATE.
             03 W-MM                PIC 9(2).
             03 FILLER              PIC X(1).
             03 W-DD                PIC 9(2).
             03 FILLER              PIC X(1).
             03 W-AA                PIC 9(2).

       COPY GNSWVFIO.
       COPY GNSWCFIO.
       COPY GNSWGSYS.
       COPY GNSWGHOY.
       COPY GNSBRMSG.
       COPY GNSBRTAB.
       COPY GNSBRERR.

       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GAP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GES-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GIN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GLE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GTP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GUB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.

       COPY GARBRGAP.
       COPY GARBRGDD.
       COPY GARBRGDG.
       COPY GARBRGDO.
       COPY GARBRGDP.
       COPY GARBRGES.
       COPY GARBRGIN.
       COPY GARBRGLE.
       COPY GARBRGSE.
       COPY GARBRGSI.
       COPY GARBRGTP.
       COPY GARBRGUB.
       COPY GARBRGVT.
       COPY GARBRCLV.

      *------------------------------------------------------------*
      *                                                            *
      *                   PROGRAMA PRINCIPAL                       *
      *                                                            *
      *------------------------------------------------------------*

       PROCEDURE DIVISION.
       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.
           PERFORM INI.
           IF NOT FIO-STAT-OKS
               GO TO FIN-MAIN.

           PERFORM LUP-CLV UNTIL NOT FIO-STAT-OKS.
       FIN-MAIN.
           DISPLAY ' '.
           DISPLAY ' '.
           DISPLAY 'GARPBLG1 : '.
           DISPLAY ' '.
           DISPLAY 'FIN NORMAL .... '.
           DISPLAY ' '.
           DISPLAY ' ---- GARANTIAS LEIDAS    : ' CONT-LEIDOS ' REGS.'.
           DISPLAY ' '.
           DISPLAY ' ---- GARANTIAS ELIMINADAS : '.
           DISPLAY '        GDG : ' CONT-DEL-GDG.
       COPY GNSBGGBK.

       INI SECTION.
       INI-INI.
           MOVE 'GARPBLG1' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           MOVE ERR-TERR-LGC IN ERR-VARI TO ERR-COD-TERR IN ERR.
           MOVE 'GARPBLG1'               TO ERR-COD-ATRN IN ERR.
           MOVE ERR-TTRN-BAT IN ERR-VARI TO ERR-MSC-TTRN IN ERR.
           MOVE ERR-SVRT-FAT IN ERR-VARI TO ERR-IND-SVRT IN ERR.
           MOVE 'M' TO ERR-MSC-TACC IN ERR.

           PERFORM GET-FHOY.
           MOVE HOY-MHOY TO W-MM IN W-CURRENT-DATE.
           MOVE HOY-DHOY TO W-DD IN W-CURRENT-DATE.
           MOVE HOY-AHOY TO W-AA IN W-CURRENT-DATE.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-CLV.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.

           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GAP.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDD.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDO.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDP.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GES.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GIN.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GLE.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GSE.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GSI.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GTP.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GUB.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

      * POSICIONA CLV.

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-CLV.
           IF NOT FIO-STAT-OKS
               MOVE ERR-SVRT-ADV IN ERR-VARI TO ERR-IND-SVRT IN ERR
               MOVE 'CLV    NEX'    TO ERR-COD-MENS IN ERR
               MOVE SPACES          TO ERR-COD-CMPO IN ERR
               PERFORM PRO-ERR
               PERFORM PRG-ABT
           ELSE
               MOVE ERR-SVRT-REC IN ERR-VARI TO ERR-IND-SVRT IN ERR.

           MOVE 0 TO CONT-LEIDOS.
           MOVE 0 TO CONT-DEL-GDG.
       FIN-INI.
           EXIT.


       LUP-CLV SECTION.
       INI-LUP-CLV.
           ADD 1 TO CONT-LEIDOS.
           MOVE GAR-CLV-CLV-1 IN CLV TO GAR-CLV-GDG-1 IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG GETUPD'    TO ERR-COD-MENS IN ERR
               MOVE 'GAR-CLV-GDG-1' TO ERR-COD-CMPO IN ERR
               MOVE ADR-GDG-REQA    TO ADR-REQA
               PERFORM PRO-ERR
               GO TO NXT-LUP-CLV.

           IF GAR-IND-EXI-GAP = 'S'
               PERFORM ELI-GAP.

           IF GAR-IND-EXI-GDD = 'S'
               PERFORM ELI-GDD.

           IF GAR-IND-EXI-GDO = 'S'
               PERFORM ELI-GDO.

           IF GAR-IND-EXI-GDP = 'S'
               PERFORM ELI-GDP.

           IF GAR-IND-EXI-GES = 'S'
               PERFORM ELI-GES.

           IF GAR-IND-EXI-GIN = 'S'
               PERFORM ELI-GIN.

           IF GAR-IND-EXI-GLE = 'S'
               PERFORM ELI-GLE.

           IF GAR-IND-EXI-GSE = 'S'
               PERFORM ELI-GSE.

           IF GAR-IND-EXI-GSI = 'S'
               PERFORM ELI-GSI.

           IF GAR-IND-EXI-GTP = 'S'
               PERFORM ELI-GTP.

           IF GAR-IND-EXI-GUB = 'S'
               PERFORM ELI-GUB.

           IF GAR-IND-EXI-GVT = 'S'
               PERFORM ELI-GVT.

           PERFORM ELI-GDG.

       NXT-LUP-CLV.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-CLV.
       FIN-LUP-CLV.
           EXIT.

       COPY GARBGVC2.

       ELI-GDG SECTION.
       INI-ELI-GDG.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG    DEL'    TO ERR-COD-MENS IN ERR
               MOVE 'GAR-CLV-GDG-1' TO ERR-COD-CMPO IN ERR
               MOVE ADR-GDG-REQA    TO ADR-REQA
               PERFORM PRO-ERR
               MOVE FIO-STAT-NEX TO FIO-STAT
               GO TO FIN-ELI-GDG.

           ADD 1 TO CONT-DEL-GDG.

       FIN-ELI-GDG.
           EXIT.

       COPY GARBFGAP.
       COPY GARBFGDD.
       COPY GARBFGDG.
       COPY GARBFGDO.
       COPY GARBFGDP.
       COPY GARBFGES.
       COPY GARBFGIN.
       COPY GARBFGLE.
       COPY GARBFGSE.
       COPY GARBFGSI.
       COPY GARBFGTP.
       COPY GARBFGUB.
       COPY GARBFGVT.
       COPY GARBFCLV.

       COPY GNSBBMSG.
       COPY GNSBFMSG.
       COPY GNSBFTAB.
      *COPY GNSBFERR.
       COPY GNSBGERR.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBGHOY.
