       IDENTIFICATION DIVISION.
       PROGRAM-ID.  GARPGGDG.

      * Traspasa registros del archivo aplanado GDG a la base de datos
      * nueva

       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
       WORKING-STORAGE SECTION.

       COPY GARBRGDS.
       COPY GARBRGDG.
       COPY GARBRGIM.
       COPY GARBRGVE.

       COPY TABBRCAM.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.

       COPY GNSWVSCR.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSLGFIO.
       COPY GNSWGSYS.

       01  WS-VARIABLES.
           02 WSS-FIN-ARCH     VALUE ZEROES PIC 9(01).
           02 WSS-REG-LEIDOS   VALUE ZEROES PIC 9(09).
           02 WSS-REG-GRABADOS VALUE ZEROES PIC 9(09).
           02 WSS-CON-ERROR    VALUE ZEROES PIC 9(09).

       PROCEDURE DIVISION.
      *
       MAIN-PROGRAM SECTION.
       INI-MAIN.
           ENTRY 'DBMSCBL'               
           MOVE "GARPGGDG" TO FIO-PROG.  
           PERFORM GNS-BUS-IDD.  
           PERFORM OPEN-FILE.
           MOVE 0 TO WSS-FIN-ARCH.
           MOVE 0 TO WSS-REG-LEIDOS.
           MOVE 0 TO WSS-REG-GRABADOS.
           MOVE 0 TO WSS-CON-ERROR.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GDS.
           IF NOT FIO-STAT-OKS 
              MOVE 1 TO WSS-FIN-ARCH
           ELSE   
              ADD 1 TO WSS-REG-LEIDOS.
           PERFORM PROCESO UNTIL WSS-FIN-ARCH = 1.
           PERFORM ESTADISTICAS.
           PERFORM CLOSE-FILE
           PERFORM GNS-PRO-END.
       FIN-MAIN.
           EXIT.
      *
       OPEN-FILE SECTION.
       INI-OPEN-FILE.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-GDS.
       FIN-OPEN-FILE.
           EXIT.
      *
       PROCESO SECTION.
       INI-PROCESO.
           PERFORM MUEVE-DATOS.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GDS.
           IF FIO-STAT-EOF
              MOVE 1 TO WSS-FIN-ARCH
           ELSE
              ADD 1 TO WSS-REG-LEIDOS.
       FIN-PROCESO.
           EXIT.
      *
       MUEVE-DATOS SECTION.
       INI-MUEVE-DATOS.
           MOVE GDG-GLS-FLAG    IN GDS TO GDG-GLS-FLAG IN GDG.
           MOVE GAR-NUM-SIS     IN GDS TO GDG-CAI-GTIA IN GDG.
           MOVE GAR-COD-CRR     IN GDS TO GDG-IIC-GTIA IN GDG.
           MOVE GDG-FEC-ULT-ACT IN GDS TO GDG-FEC-FTRN IN GDG.
           MOVE GDG-HOR-ACT     IN GDS TO GDG-HRA-HRTR IN GDG.
           MOVE GDG-MSC-TACC    IN GDS TO GDG-MSC-TACC IN GDG.
           MOVE GDG-MSC-STAT    IN GDS TO GDG-MSC-STAT IN GDG.
           MOVE GDG-TML-ACT     IN GDS TO GDG-COD-OTRN IN GDG.
           MOVE GDG-IDN-USU-ACT IN GDS TO GDG-COD-ATRN IN GDG.
           MOVE GAR-COD-OFI     IN GDS TO GDG-COD-OFIC IN GDG.
           MOVE GAR-TIP-OPE     IN GDS TO GDG-COD-TOPE IN GDG.
           MOVE GAR-STP-OPE     IN GDS TO GDG-COD-SOPE IN GDG.
           MOVE GAR-TIP-VCB     IN GDS TO GDG-COD-TVCM IN GDG.
           MOVE GAR-COD-VCB     IN GDS TO GDG-COD-VCGT IN GDG.
           MOVE GAR-TIP-CMB     IN GDS TO GDG-COD-TCGT IN GDG.
           MOVE GAR-FEC-SOL-CNS IN GDS TO GDG-FEC-FSOL IN GDG.
           MOVE GAR-FEC-ESC-CNS IN GDS TO GDG-FEC-FEST IN GDG.
           MOVE GAR-FEC-VTO     IN GDS TO GDG-FEC-FVTO IN GDG.
           MOVE GAR-COD-GRA     IN GDS TO GDG-COD-GGTA IN GDG.
           MOVE GAR-COD-LIM     IN GDS TO GDG-COD-LGTA IN GDG.
           MOVE SPACES                 TO GDG-IND-CBAN IN GDG.
           MOVE GDG-CAI-ICLI    IN GDS TO GDG-CAI-ICLI IN GDG.
           MOVE GDG-IIC-ICLI    IN GDS TO GDG-IIC-ICLI IN GDG.
           MOVE SPACES                 TO GDG-COD-RFCP IN GDG.
           MOVE SPACES                 TO GDG-GLS-NOMP IN GDG.
           MOVE GAR-ES1         IN GDS TO GDG-IND-EST1 IN GDG.
           MOVE GAR-TIV-AUT-ES1 IN GDS TO GDG-NUM-IES1 IN GDG.
           MOVE GAR-CIV-AUT-ES1 IN GDS TO GDG-COD-CES1 IN GDG.
           MOVE GAR-SIV-AUT-ES1 IN GDS TO GDG-COD-SES1 IN GDG.
           MOVE GAR-ES2         IN GDS TO GDG-COD-EST2 IN GDG.
           MOVE GAR-FEC-ALZ     IN GDS TO GDG-FEC-FALZ IN GDG.
           MOVE GAR-EST-ANT     IN GDS TO GDG-COD-ESTA IN GDG.
           MOVE GAR-IND-OBL-INS IN GDS TO GDG-IND-INOB IN GDG.
           MOVE GAR-IND-CPL     IN GDS TO GDG-IND-GTAC IN GDG.
           MOVE GAR-IND-EXI-GDG IN GDS TO GDG-IND-EGDG IN GDG.
           MOVE GAR-IND-EXI-GDD IN GDS TO GDG-IND-EGDD IN GDG.
           MOVE GAR-IND-EXI-GES IN GDS TO GDG-IND-EGES IN GDG.
           MOVE GAR-IND-EXI-GLE IN GDS TO GDG-IND-EGLE IN GDG.
           MOVE GAR-IND-EXI-GDO IN GDS TO GDG-IND-EGDO IN GDG.
           MOVE GAR-IND-EXI-GSE IN GDS TO GDG-IND-EGSE IN GDG.
           MOVE GAR-IND-EXI-GVT IN GDS TO GDG-IND-EGVT IN GDG.
           MOVE GAR-IND-EXI-GTP IN GDS TO GDG-IND-EGTP IN GDG.
           MOVE GAR-IND-EXI-GUB IN GDS TO GDG-IND-EGUB IN GDG.
           MOVE GAR-IND-EXI-GAP IN GDS TO GDG-IND-EGAP IN GDG.
           MOVE GAR-IND-EXI-GIN IN GDS TO GDG-IND-EGIN IN GDG.
           MOVE GAR-IND-EXI-GSI IN GDS TO GDG-IND-EGSI IN GDG.
           MOVE GAR-IND-EXI-GDP IN GDS TO GDG-IND-EGDP IN GDG.
           PERFORM VERIFICA-GIM.                              
           PERFORM VERIFICA-GVE.                              
           MOVE GAR-COD-EJE-ORI IN GDS TO GDG-CIC-EJOR IN GDG.
           MOVE GAR-COD-TIP-ESP IN GDS TO GDG-IND-TESP IN GDG.
           MOVE GAR-TIP-VCB-CON IN GDS TO GDG-COD-TVCC IN GDG.
           MOVE GAR-COD-VCB-CON IN GDS TO GDG-COD-CVCC IN GDG.
           MOVE GAR-TIP-CMB-CON IN GDS TO GDG-COD-TCCO IN GDG.
           MOVE GAR-COD-TSN     IN GDS TO GDG-COD-TSCN IN GDG.
           MOVE GAR-DES-1       IN GDS TO GDG-GLS-DGTA IN GDG.
           MOVE GAR-DES-2       IN GDS TO GDG-GLS-DGT1 IN GDG.
           MOVE GAR-IND-RST-ALZ IN GDS TO GDG-IND-RALZ IN GDG.
           MOVE SPACES                 TO GDG-IND-UTIL IN GDG.
           MOVE ZEROES                 TO GDG-VAL-CCON IN GDG.
           MOVE ZEROES                 TO GDG-VAL-CCOM IN GDG.
           MOVE SPACES                 TO GDG-COD-DESP IN GDG.
           MOVE SPACES                 TO GDG-IND-CLAS IN GDG.
           MOVE ZEROES                 TO GDG-VAL-MNTO IN GDG.
           MOVE SPACES                 TO GDG-COD-GORI IN GDG.
           MOVE SPACES                 TO GDG-COD-UNIC IN GDG.
           MOVE GDG-FEC-ING-SIS IN GDS TO GDG-FEC-FING IN GDG.
           MOVE GDG-IDN-USU-ING IN GDS TO GDG-CIC-UING IN GDG.
           MOVE GDG-GLS-DISP    IN GDS TO GDG-GLS-DISP IN GDG.
           MOVE FIO-PUT                TO FIO-CMND.          
           PERFORM GAR-FIO-GDG.
           IF FIO-STAT-OKS 
           ADD 1 TO WSS-REG-GRABADOS
    ELSE   
              ADD 1 TO WSS-CON-ERROR.
       FIN-MUEVE-DATOS.
           EXIT.
      *
       VERIFICA-GIM SECTION.
       INI-VER-GIM.
           MOVE GDG-CAI-GTIA IN GDG TO GIM-CAI-GTIA IN GIM.
           MOVE GDG-IIC-GTIA IN GDG TO GIM-IIC-GTIA IN GIM.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GIM.
           IF FIO-STAT-OKS
              MOVE "S" TO GDG-IND-EGIM IN GDG
           ELSE
              MOVE "N" TO GDG-IND-EGIM IN GDG.
       FIN-VER-GIM.
           EXIT.
      *
       VERIFICA-GVE SECTION.
       INI-VER-GVE.
           MOVE GDG-CAI-GTIA IN GDG TO GVE-CAI-GTIA IN GVE.
           MOVE GDG-IIC-GTIA IN GDG TO GVE-IIC-GTIA IN GVE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GVE.
           IF FIO-STAT-OKS
              MOVE "S" TO GDG-IND-EGVE IN GDG
           ELSE
              MOVE "N" TO GDG-IND-EGVE IN GDG.
       FIN-VER-GVE.
           EXIT.
      *                                                                 
       ESTADISTICAS SECTION.                                            
       INI-ESTADISTICAS.                                                
           DISPLAY 'REGISTROS LEIDOS DE GDS     : ' WSS-REG-LEIDOS.     
           DISPLAY 'REGISTROS GRABADOS DE GDG   : ' WSS-REG-GRABADOS.     
           DISPLAY 'REGISTROS MAL GRABADOS      : ' WSS-CON-ERROR.
       FIN-ESTADISTICAS.                                                
           EXIT.     
      *     
       CLOSE-FILE SECTION.
       INI-CLOSE-FILE.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GDS.
       FIN-CLOSE-FILE.
           EXIT.
      *
       COPY GARBFGDS.
       COPY GARBFGDG.
       COPY GARBFGIM.
       COPY GARBFGVE.

       COPY GNSBBIDD.

       COPY GNSBTABT.
       COPY GNSBGEND.
