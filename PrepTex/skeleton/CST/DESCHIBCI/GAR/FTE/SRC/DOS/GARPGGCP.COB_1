       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GARPGGCP.
       AUTHOR.          BEE-TEAM.
       DATE-WRITTEN.    23-JUN-2003.

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
      *        DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *-----------------------
      * Archivo GARGCP
       COPY GARBRGCP.
      *
      * Archivo Excepciones de Alza
       COPY GARBREAL.
      *
      * Registros de las Bases Originales.
       COPY GARBRGDG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRMSG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
      *
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.
       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
      *
       01  WSS-VARI.
           03 WSS-NUM-RLEE        VALUE ZEROES          PIC 9(05).
           03 WSS-NUM-GERR        VALUE ZEROES          PIC 9(05).
           03 WSS-NUM-RGRA        VALUE ZEROES          PIC 9(05).
           03 WSS-NUM-RNGR        VALUE ZEROES          PIC 9(05).


       PROCEDURE DIVISION.
      *------------------
       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE "GARPGGCP" TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           PERFORM OPEN-FILE.
           PERFORM PRO-EAL.
           PERFORM DISP-ESTAD.
           PERFORM CLOSE-FILE.
           PERFORM GNS-PRO-END.
       FIN-MAIN.
           EXIT.
      *
      *---------------------------------------------------------------
      *
       OPEN-FILE SECTION.
       INI-OPEN-FILE.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-GDG.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-EAL.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM GAR-FIO-GCP.
       FIN-OPEN-FILE.
           EXIT.
      *
      *---------------------------------------------------------------
      *
       CLOSE-FILE SECTION.
       INI-CLOSE-FILE.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           PERFORM GAR-FIO-GCP.
           PERFORM GAR-FIO-EAL.
       FIN-CLOSE-FILE.
           EXIT.
      *
      *---------------------------------------------------------------
      *
       PRO-EAL SECTION.
       INI-PRO-EAL.
           MOVE FIO-GET-FST  TO FIO-CMND.
       LUP-PRO-EAL.
           PERFORM GAR-FIO-EAL.
           IF NOT FIO-STAT-OKS
               GO TO FIN-PRO-EAL.
           ADD 1 TO WSS-NUM-RLEE IN WSS-VARI.
           MOVE EAL-CAI-IGDG IN EAL TO GAR-NUM-SIS IN GDG.
           MOVE EAL-IIC-IGDG IN EAL TO GAR-COD-CRR IN GDG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTE GDG PARA : ' ID-GARANTIA IN EAL
               ADD 1 TO WSS-NUM-GERR IN WSS-VARI
               GO TO NXT-PRO-EAL.
           IF GAR-ES1 IN GDG < 20
               PERFORM GRA-REG-GCP.

       NXT-PRO-EAL.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-PRO-EAL.
       FIN-PRO-EAL.
           EXIT.
      *
      *---------------------------------------------------------------
      *
       GRA-REG-GCP SECTION.
       INI-GRA-REG-GCP.
           MOVE SPACES TO GCP.
           MOVE GAR-NUM-SIS IN GDG TO GCP-CAI-IGDG IN GCP.
           MOVE GAR-COD-CRR IN GDG TO GCP-IIC-IGDG IN GCP.
           MOVE GAR-TIP-OPE IN GDG TO GCP-COD-TOPE IN GCP.
           MOVE GAR-STP-OPE IN GDG TO GCP-COD-SOPE IN GCP.
           MOVE GAR-ES1 IN GDG     TO GCP-COD-EST1 IN GCP.
           IF GAR-ES1 IN GDG > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'ES1' TO TAB-COD-TTAB IN TAB
               MOVE GAR-ES1 IN GDG TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO GCP-GLS-EST1 IN GCP
           ELSE
               MOVE SPACES TO GCP-GLS-EST1 IN GCP.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GAR-FIO-GCP.
           IF FIO-STAT-OKS
               ADD 1 TO WSS-NUM-RGRA IN WSS-VARI
           ELSE
               ADD 1 TO WSS-NUM-RNGR IN WSS-VARI.
       FIN-GRA-REG-GCP.
           EXIT.
      *
      *---------------------------------------------------------------
      *
       DISP-ESTAD SECTION.
       INI-DISP-ESTAD.
           DISPLAY 'REG. EAL LEIDOS        : ' WSS-NUM-RLEE IN WSS-VARI.
           DISPLAY 'REG. GCP GRABADOS      : ' WSS-NUM-RGRA IN WSS-VARI.
           DISPLAY 'REG. EAL SIN GDG       : ' WSS-NUM-GERR IN WSS-VARI.
       FIN-DISP-ESTAD.
           EXIT.
      *
      *---------------------------------------------------------------
      *


       COPY GARBFGDG.
       COPY GARBFGCP.
       COPY GARBFEAL.
       COPY GNSBFMSG.
       COPY GNSBFTAB.
       COPY GNSBBTAB.
       COPY GNSBBMSG.
       COPY GNSBTABT.
       COPY GNSBGABT.
       COPY GNSBGIDD.
       COPY GNSBGDTC.
       COPY GNSBGEND.
       COPY GNSBGHOY.
       COPY GNSBBSYS.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
