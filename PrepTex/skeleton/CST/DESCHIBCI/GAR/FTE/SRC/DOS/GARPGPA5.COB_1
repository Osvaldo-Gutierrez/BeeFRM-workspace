       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GARPGPA5.
       AUTHOR.          R. CHIANG.
       DATE-WRITTEN     22-JUN-2003.
      
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
      *        DECIMAL-POINT IS COMMA.
      
       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *-----------------------
      
       COPY GARBRDDS.
       COPY GARBRGS4.
       COPY GARBRGS5.
      
       COPY TABBRCAM.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.
      
       01  VARIABLES.
           03 WSS-LEIDOS-DDS      VALUE ZEROES      PIC 9(08).
           03 WSS-LEIDOS-GS4      VALUE ZEROES      PIC 9(08).
           03 WSS-GRABAR-GS5      VALUE ZEROES      PIC 9(08).
           03 WSS-YALEIDO         VALUE ZEROES      PIC 9(01).
           03 WSS-TOT-ARR         VALUE 1000        PIC 9(04).
           03 WSS-IND-ARR         VALUE ZEROES      PIC 9(04).
           03 WSS-AUX-ARR         VALUE ZEROES      PIC 9(04).
           03 WSS-CIC-ICLI.
              05 WSS-CAI-ICLI     VALUE SPACES      PIC X(04).
              05 WSS-IIC-ICLI     VALUE ZEROES      PIC 9(08).
           03 WSS-RSP-GS4         VALUE SPACES      PIC X(48).
      
       01  ARREGLO.
           03 WSS-BKP-GS4  OCCURS  1000      PIC X(48).
      
       PROCEDURE DIVISION.
      *==================
      
       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.
           ENTRY 'DBMSCBL'
           MOVE "GARPGPA5" TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           PERFORM OPEN-FILE.
           PERFORM PROCESO.
           PERFORM ESTADISTICAS.
           PERFORM CLOSE-FILE.
           PERFORM GNS-PRO-END.
       FIN-MAIN.
           EXIT.
      *
      ******************************************************************
      *
       OPEN-FILE SECTION.
       INI-OPEN-FILE.
      *    DISPLAY 'INI-OPEN-FILE'.
           MOVE 'GAR'   TO FIO-SIST.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-DDS.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-GS4.
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM GAR-FIO-GS5.
      *    DISPLAY 'FIN-OPEN-FILE'.
       FIN-OPEN-FILE.
           EXIT.
      *
      ******************************************************************
      *
       PROCESO SECTION.
       INI-PROCESO.
           PERFORM LEER-GARDDS.
           IF NOT FIO-STAT-OKS
              GO TO FIN-PROCESO.
      
           IF GDD-CIC-ICLI IN DDS = WSS-CIC-ICLI
              PERFORM BKP-GS4
              GO TO INI-PROCESO.
      
           MOVE GDD-CIC-ICLI IN DDS TO WSS-CIC-ICLI.
           MOVE ZEROES              TO WSS-IND-ARR.
      
       UNO-PROCESO.
           IF WSS-YALEIDO = 0
              PERFORM LEER-GARGS4
              IF NOT FIO-STAT-OKS
                 GO TO FIN-PROCESO.
           IF GDD-CIC-ICLI IN DDS = GS4-CIC-ICLI IN GS4
              PERFORM GRB-GS4
              PERFORM GRABAR-GS5
              MOVE 0 TO WSS-YALEIDO
              GO TO UNO-PROCESO.
           IF GDD-CIC-ICLI IN DDS > GS4-CIC-ICLI IN GS4
              MOVE 0 TO WSS-YALEIDO
              GO TO UNO-PROCESO
           ELSE
              MOVE 1 TO WSS-YALEIDO
              GO TO INI-PROCESO.
       FIN-PROCESO.
           EXIT.
      *
       BKP-GS4 SECTION.
       INI-BKP-GS4.
           MOVE ZEROES TO WSS-AUX-ARR.
           MOVE GS4    TO WSS-RSP-GS4.
       LUP-BKP-GS4.
           ADD 1                         TO WSS-AUX-ARR.
           IF WSS-AUX-ARR > WSS-IND-ARR
              MOVE WSS-RSP-GS4 TO GS4
              GO TO FIN-BKP-GS4.
           MOVE WSS-BKP-GS4(WSS-AUX-ARR) TO GS4.
           PERFORM GRABAR-GS5.
           GO TO LUP-BKP-GS4.
       FIN-BKP-GS4.
           EXIT.
      ******************************************************************
       GRB-GS4 SECTION.
       INI-GRB-GS4.
           IF WSS-IND-ARR = WSS-TOT-ARR
              DISPLAY 'CLIENTE SUPERO MAXIMO ' GDD-CIC-ICLI IN DDS
              GO TO FIN-GRB-GS4.
           ADD 1    TO WSS-IND-ARR.
           MOVE GS4 TO WSS-BKP-GS4(WSS-IND-ARR).
       FIN-GRB-GS4.
           EXIT.
      *
       LEER-GARDDS SECTION.
       INI-LEER-GARDDS.
           MOVE FIO-GET-NXT     TO FIO-CMND.
           PERFORM GAR-FIO-DDS.
           ADD 1 TO WSS-LEIDOS-DDS.
       FIN-LEER-GARDDS.
           EXIT.
      *
      ******************************************************************
      *
       LEER-GARGS4 SECTION.
       INI-LEER-GARGS4.
           MOVE FIO-GET-NXT     TO FIO-CMND.
           PERFORM GAR-FIO-GS4.
           ADD 1 TO WSS-LEIDOS-GS4.
       FIN-LEER-GARGS4.
           EXIT.
      *
      *****************************************************************
      *
       GRABAR-GS5 SECTION.
       INI-GRABAR-GS5.
           MOVE GAR-NUM-SIS     IN DDS TO GS5-NUM-SIS     IN GS5.
           MOVE GAR-COD-CRR     IN DDS TO GS5-COD-CRR     IN GS5.
           MOVE GS4-CAI-ICLI    IN GS4 TO GS5-CAI-ICLI    IN GS5.
           MOVE GS4-IIC-ICLI    IN GS4 TO GS5-IIC-ICLI    IN GS5.
           MOVE GS4-CAI-ICLF    IN GS4 TO GS5-CAI-ICLF    IN GS5.
           MOVE GS4-IIC-ICLF    IN GS4 TO GS5-IIC-ICLF    IN GS5.
           MOVE GS4-NUM-ILDC    IN GS4 TO GS5-NUM-ILDC    IN GS5.
           MOVE GS4-NUM-IARG    IN GS4 TO GS5-NUM-IARG    IN GS5.
           MOVE GS4-IND-VIGE    IN GS4 TO GS5-IND-VIGE    IN GS5.
           MOVE GS4-CIC-IGAR    IN GS4 TO GS5-CIC-IGAR    IN GS5.
           MOVE GS4-COD-TOGA    IN GS4 TO GS5-COD-TOGA    IN GS5.
           MOVE GS4-COD-AOGA    IN GS4 TO GS5-COD-AOGA    IN GS5.
           MOVE FIO-PUT                TO FIO-CMND.
           PERFORM GAR-FIO-GS5.
           ADD 1 TO WSS-GRABAR-GS5.
        FIN-GRABAR-GS5.
           EXIT.
      *
      ******************************************************************
      *
       ESTADISTICAS SECTION.
       INI-ESTADISTICAS.
           DISPLAY 'REGISTROS LEIDOS DE DDS     : ' WSS-LEIDOS-DDS.
           DISPLAY 'REGISTROS LEIDOS DE GS4     : ' WSS-LEIDOS-GS4
           DISPLAY 'REGISTROS GRABADOS DE GS5   : ' WSS-GRABAR-GS5.
       FIN-ESTADISTICAS.
           EXIT.
      *
      ******************************************************************
      *
       CLOSE-FILE SECTION.
       INI-CLOSE-FILE.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-DDS.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GS4.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GS5.
       FIN-CLOSE-FILE.
           EXIT.
      *
      ******************************************************************
      *
       PRG-ABT SECTION.
       INI-PRG-ABT.
            DISPLAY 'ABORTANDO EN PRG-ABT '.
            DISPLAY 'FIO-MENS : ' FIO-MENS.
            MOVE 100 TO RETURN-CODE.
            GOBACK.
       FIN-PRG-ABT.
            EXIT.
      *
      ******************************************************************
      *
       COPY GARBFDDS.
       COPY GARBFGS4.
       COPY GARBFGS5
       .
      
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBGEND.
       COPY GNSBGABT.
       COPY GNSBVTAB.
      
       COPY GNSBFTAB.
       COPY TABBFCAM.
       COPY GNSBFMSG.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY GNSBBSYS.
      *
