*%! NO_TIENE_TIMESTAMP = TRUE
*%! NO_HDR_CST = TRUE
*% FMT_CHI = TRUE
*% GEN_BCI = TRUE
*% FRM = 'GDP'
*% IF NOT PGM_CLB AND NOT PGM_MEX AND PGM_PQ
*%    ! Codigo adicional para Funcion GARPPVCG = PF5
*%     INCLUDE 'GARSRC:PFALL5.SRC'
*%    ! Codigo adicional programa GARPAGDP
*% END
*%! IF NOT PGM_MCP
*% PGM_PTC = TRUE
*%! END
*% PGM_GDP = TRUE
*% REG = 'GDP'
*% HIJ = 'GDG'
*% CAIREG = 'GDP-CAI-GTIA'
*% IICREG = 'GDP-IIC-GTIA'
*% CAIFLD = 'GDP-CAI-GTIA'
*% IICFLD = 'GDP-IIC-GTIA'
*% SISREG = 'GAR'
*% IF FIN_SCR_VARI
           03 CMA-VARI.
              05 GAR-CAI-GTIA                  PIC X(04).
              05 GAR-IIC-GTIA                  PIC X(08).
              05 GAR-IND-GTAC                  PIC X(01).
              05 GAR-COD-TASN                  PIC 9(03).
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
      *MHM-INI 23-OCT-2003
       COPY GNSWGCPT.
      *MHM-FIN 23-OCT-2003
       COPY GARBRGDG.
       COPY GARBRTAG.
       COPY GARBRGVT.
       COPY GARBRGIM.
       COPY GARBRGVE.
       COPY GARWGVCG.
*% IF PGM_CLB OR PGM_MEX
       COPY GARBRGAP.
       COPY GARBRGDD.
       COPY GARBRGDO.
       COPY GARBRGES.
       COPY GARBRGIN.
       COPY GARBRGLE.
       COPY GARBRGMO.
       COPY GARBRGSE.
       COPY GARBRGSI.
       COPY GARBRGTP.
       COPY GARBRGUB.

       COPY GARWGVDO.
       COPY GARWVVCG.
*% END
*% IF PGM_VAX
           03 WSS-REG                          PIC X(03).
*% END
       COPY GNSWGPES.

*% IF PGM_DTC
      *<<<< WSS AND PGM_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GIM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *>>>>
*% END
*% IF PGM_CHI AND PGM_PQ
      *<<<< PGM_CHI AND PGM_PQ
           COPY USPC113.
      *>>>>
*% END
       01  WSS-VARI.
           03 I                                         PIC 9(06).
           03 WSS-FACT                                  PIC 9(06).
      *MHM-INI 23-OCT-2003
           03 WSS-GLS-CGTA.
              05 WSS-GLS-TOPE                   PIC X(40).
              05 WSS-GLS-SOPE                   PIC X(40).
      *MHM-FIN 23-OCT-2003
      *>>>>
*% END
*% CMA_USR = TRUE
*% IF CMA AND PGM_MVS
           02 FILLER                       PIC X(280).
*% END
*% IF INI_FIO AND PGM_MVS
      *<<<< INI_FIO
           MOVE +280 TO SCR-TCMA.
      *>>>>
*% END
*% IF INI_FIO AND PGM_VAX
      *<<<< INI_FIO
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-OFI.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-TAG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-TAG.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GDG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GVT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GVT.

      *>>>> INI_FIO
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
*% IF GEN_BCI
      *<<<< GEN_BCI
      * Llama a Subrutina Validacion Consistencia Garantia
           IF FRM-FFLD = FRM-FFLD-PF5
               PERFORM GAR-PRO-VCG
               GO TO FIN-FND-KEY.
      *>>>>
*% END
*% FIN_BUS_HIJ = TRUE
       BUS-GDG.
           MOVE GDP-CAI-GTIA IN GDP-FLD TO GDG-CAI-GTIA IN GDG.
           MOVE GDP-IIC-GTIA IN GDP-FLD TO GDG-IIC-GTIA IN GDG.

           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           MOVE FIO-STAT TO PGM-STAT-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG    NEX' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
*% IF PGM_CHI
      *<<<< PGM_CHI
           IF SCR-CCPP = 'ACC' AND 
              SCR-STAT = SCR-STAT-CON
              GO TO FIN-VAL-OFI-USP-GDP.

           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'OFIUSP'       TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S' )
               GO TO FIN-VAL-OFI-USP-GDP.
      *-------------------------------------------------------*
      *Valida USR Contra Oficina
      *ALD-BCI-INI/07032000
           COPY USPC143.
           MOVE 'GARGTUCG/CEN' TO USP-PTA-STR.
           COPY USPC103.
           IF USP-PERMISO = 'P'
               GO TO FIN-VAL-OFI-USP-GDP.
      *    COPY USPC143.
      *ALD-BCI-FIN/07032000
           IF USP-COD-OFICINA NOT = GDG-COD-OFIC IN GDG 
               MOVE 'USRNODEOFI' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
      *-------------------------------------------------------*
       FIN-VAL-OFI-USP-GDP.
      *>>>>
*% END
*% IF PGM_PER AND PGM_GVT
      *<<<< PGM_PER AND PGM_GVT
       COPY GARBVUOF.
           IF MSG-COD-MENS > SPACES
               GO TO ERR-FND-KEY.
      *>>>>
*% END

       FIN-BUS-GDG.
*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GDG-TIP-CGTA IN GDG TO GDG-TIP-CGTA IN GDP-FLD.
           MOVE GDG-STP-CGTA IN GDG TO GDG-STP-CGTA IN GDP-FLD.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GDG TO GDG-COD-CGTA IN GDP-FLD.
*% END
      *BUS-TAB Busca codigo de tabla
           MOVE 'TAB' TO TAB-COD-SIST.
*% IF GEN_BCI
      *<<<< GEN_BCI
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
      *>>>>
*% ELSE
           MOVE 'GTA' TO TAB-COD-TTAB IN TAB.
*% END
           MOVE SPACES TO TAB-COD-CTAB IN TAB.

*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GDG-TIP-CGTA IN GDP-FLD TO TAG-TIP-AGTA IN TAG.
           MOVE GDG-STP-CGTA IN GDP-FLD TO TAG-STP-AGTA IN TAG.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GDP-FLD TO TAG-COD-AGTA IN TAG.
*% END
      *MHM-INI 24-OCT-2003
      *     MOVE TAG-COD-AGTA IN TAG     TO TAB-COD-CTAB IN TAB.
      *     PERFORM BUS-TAB.
      *     IF MSG-COD-MENS = SPACES
      *         MOVE TAB-GLS-DESC IN TAB TO
      *              FRM-GLS-CGTA IN GDP-FLD
      *     ELSE
      *         MOVE SPACES TO FRM-GLS-CGTA IN GDP-FLD.
      *MHM-FIN 24-OCT-2003

      * Busca Glosa Tabla Real/no Real
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GAR-FIO-TAG.
           IF NOT FIO-STAT-OKS
                MOVE 'TAG    NEX' TO MSG-COD-MENS
                MOVE 'GAR' TO MSG-COD-SIST
                PERFORM GET-MSG
           ELSE
                MOVE SPACES TO MSG-COD-MENS
                MOVE 'GAR' TO TAB-COD-SIST
                MOVE 'RAL' TO TAB-COD-TTAB IN TAB
                MOVE TAG-IND-TREA IN TAG TO TAB-COD-CTAB IN TAB
                PERFORM BUS-TAB
                IF MSG-COD-MENS = SPACES
                    MOVE TAB-GLS-DESC IN TAB TO 
                         FRM-GLS-TREA IN GDP-FLD
                ELSE
                    MOVE SPACES TO FRM-GLS-TREA IN GDP-FLD.


           MOVE GDG-CAI-GTIA IN GDG TO GAR-CAI-GTIA IN CMA-VARI.
           MOVE GDG-IIC-GTIA IN GDG TO GAR-IIC-GTIA IN CMA-VARI.
           MOVE GDG-IND-GTAC IN GDG TO GAR-IND-GTAC IN CMA-VARI.
           MOVE GDG-COD-TSCN IN GDG TO GAR-COD-TASN IN CMA-VARI.
           IF SCR-CMND = 'ING'
               PERFORM PUT-GDG-GDP.

      * Valida Este permitido esta Entidad para Tipo-Subtipo
           IF TAG-IND-EGDP IN TAG = 'N'
               MOVE 'TAG    NOPGM' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      * Comando Consulta Error lo trata el GENESIS
           IF SCR-CCPP = 'ACC' AND SCR-STPP = SCR-STAT-CON
               GO TO FIN-FND-KEY.

      * Garantia Alzada
           IF GDG-IND-EST1 IN GDG > '19'
               MOVE 'GDGALZ' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      * Garantia Completa
           IF SCR-CCPP = 'ELI' AND
              GDG-IND-GTAC IN GDG = 'S'
               MOVE 'GAR    CPL' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           GO TO FIN-FND-KEY.
       ERR-FND-KEY.
           MOVE 'GAR' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE SCR-STAT-ABT TO SCR-STAT.
           IF SCR-CCPP = 'ING'
               MOVE '00' TO FIO-STAT
           ELSE
               MOVE FIO-STAT-NEX TO FIO-STAT.

      *>>>>
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
           MOVE SPACES TO GDP-GLS-FLAG IN GDP.
           MOVE SPACES TO GDP-MSC-TACC IN GDP.
           MOVE SPACES TO GDP-CIC-UING IN GDP.
           MOVE 'I'    TO GDP-MSC-STAT IN GDP.

           MOVE ZEROES TO GDP-FEC-FUDP IN GDP-FLD.
           MOVE ZEROES TO GDP-SGV-UDPN IN GDP-FLD.
           MOVE ZEROES TO GDP-NUM-UDPN IN GDP-FLD.

      *>>>>
*% END
*% IF CMN_ING OR CMN_MOD
      *<<<< INI_CMN_ING OR INI_CMN_MOD
           PERFORM GET-FHOY.
           IF SCR-CCPP = 'ING'
              OR SCR-CMND = 'COP'
               MOVE 'I'      TO GDP-MSC-TACC IN GDP

               MOVE HOY-FHOY TO GDP-FEC-FING IN GDP
*% IF PGM_MVS
               MOVE SCR-USER TO GDP-CIC-UING IN GDP
*% END
           ELSE
*% IF PGM_MVS
*% END
               MOVE 'M'      TO GDP-MSC-TACC    IN GDP.
*% IF PGM_MVS
*% END
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en la modificacion : informar               
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-MOD.
      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en el ingreso : informar                    
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ING. 

           MOVE GDP-CAI-GTIA IN GDP TO GDG-CAI-GTIA IN GDG.
           MOVE GDP-IIC-GTIA IN GDP TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF FIO-STAT-OKS
               MOVE 'S' TO GDG-IND-EGDP IN GDG
               MOVE FIO-MOD TO FIO-CMND
               PERFORM GAR-FIO-GDG.

      *>>>>
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en la eliminacion : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.

           MOVE GDP-CAI-GTIA IN GDP TO GDG-CAI-GTIA IN GDG.
           MOVE GDP-IIC-GTIA IN GDP TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF FIO-STAT-OKS
               MOVE ' ' TO GDG-IND-EGDP IN GDG
               MOVE FIO-MOD TO FIO-CMND
               PERFORM GAR-FIO-GDG.

      *>>>>
*% END
*% IF EOF
      *<<<< EOF
*% IF PGM_DTC
      *<<<< PGM_DTC
      *MHM-INI 23-OCT-2003
       COPY GNSBGCPT.
      *MHM-FIN 23-OCT-2003
       COPY GNSBGVSM.
       COPY GNSBHVSM.
      *>>>>
*% END
*% IF PGM_CLB OR PGM_MEX
      *>>>>
       COPY GARBFGAP.
       COPY GARBFGDD.
       COPY GARBFGDO.
       COPY GARBFGES.
       COPY GARBFGIN.
       COPY GARBFGLE.
       COPY GARBFGMO.
       COPY GARBFGSE.
       COPY GARBFGSI.
       COPY GARBFGTP.
       COPY GARBFGUB.
       COPY GARBGVC2.
       COPY GARBGVDO.
       COPY GARBVVCG.
      *<<<<
*% END
       COPY GARBGVCG.
       COPY GARBKVCG.
       COPY GARBFGDG.
       COPY GARBFTAG.
       COPY GARBFGVT.
       COPY GARBFGIM.
       COPY GARBFGVE.
       COPY GNSBGPES.
       COPY GNSBPFEC.
      *>>>>
*% END
