*% FRM = 'GTP'
*% REG = 'GTP'
*% GEN_BCI = TRUE
*% IF FIN_UNP_GTP_GTP
      *<<<< FIN_UNP_GTP_GTP
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN GTP-FLD TO WSS-TIPO IN WSS-VARI
           MOVE GDG-STP-CGTA IN GTP-FLD TO WSS-AUX IN WSS-VARI.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TIAU IN WSS-VARI.
           IF WSS-CIC-TIAU IN WSS-VARI = '952082'
                 MOVE FRM-CPIM-AEY TO GTP-SGV-VTSN-ATR IN GTP-FLD
                 MOVE FRM-CPIM-AEY TO GTP-FEC-FCES-ATR IN GTP-FLD.
      *>>>>
*% END                            
*% IF GTP_COD_IITS
      *<<<< GTP_COD_IITS
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN GTP-FLD TO WSS-TIPO IN WSS-VARI
           MOVE GDG-STP-CGTA IN GTP-FLD TO WSS-AUX IN WSS-VARI.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TIAU IN WSS-VARI.
      *PVG INI 15-OCT-2003
      *    IF WSS-CIC-TIAU IN WSS-VARI = '952082'
           IF WSS-CIC-TIAU IN WSS-VARI = '952086'
      *PVG FIN 15-OCT-2003
              MOVE GTP-COD-IITS IN GTP-FLD TO ACC-COD-NEMO IN ACC
      *PVG INI 15-OCT-2003
      *       MOVE 99999999                TO ACC-FEC-FPRO IN ACC
              MOVE GTP-NUM-SCES IN GTP-FLD TO ACC-NUM-SPRO IN ACC
              MOVE GTP-NUM-ACES IN GTP-FLD TO ACC-NUM-APRO IN ACC
              MOVE GTP-NUM-MCES IN GTP-FLD TO ACC-NUM-MPRO IN ACC
              MOVE GTP-NUM-DCES IN GTP-FLD TO ACC-NUM-DPRO IN ACC
      *PVG FIN 15-OCT-2003
              MOVE FIO-GET-LEQ TO FIO-CMND
              PERFORM GAR-FIO-ACC
              IF NOT (FIO-STAT-OKS AND 
                      ACC-COD-NEMO IN ACC = GTP-COD-IITS IN GTP-FLD)
                  MOVE 'TAB'          TO MSG-COD-SIST
                  MOVE 'NEM    NEX' TO MSG-COD-MENS
                  PERFORM GET-MSG
                  MOVE MSG-GLS-DESC TO FRM-MENS
                  MOVE FRM-SUAR-MAL TO FRM-SUAR
                  GO TO FIN-VAL-GTP-COD-IITS.
      *>>>>
*% END
*% IF FRM_COD_LIST
      *<<<< FRM_COD_LIST
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN GTP-FLD TO WSS-TIPO IN WSS-VARI
           MOVE GDG-STP-CGTA IN GTP-FLD TO WSS-AUX IN WSS-VARI.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TIAU IN WSS-VARI.
      *PVG INI 15-OCT-2003
      *    IF WSS-CIC-TIAU IN WSS-VARI = '952082'
           IF WSS-CIC-TIAU IN WSS-VARI = '952086'
      *PVG FIN 15-OCT-2003
              MOVE GTP-COD-IITS IN GTP-FLD TO ACC-COD-NEMO IN ACC
      *PVG INI 15-OCT-2003
      *       MOVE 99999999                TO ACC-FEC-FPRO IN ACC
              MOVE GTP-NUM-SCES IN GTP-FLD TO ACC-NUM-SPRO IN ACC
              MOVE GTP-NUM-ACES IN GTP-FLD TO ACC-NUM-APRO IN ACC
              MOVE GTP-NUM-MCES IN GTP-FLD TO ACC-NUM-MPRO IN ACC
              MOVE GTP-NUM-DCES IN GTP-FLD TO ACC-NUM-DPRO IN ACC
      *PVG FIN 15-OCT-2003
              MOVE FIO-GET-LEQ TO FIO-CMND
              PERFORM GAR-FIO-ACC
              IF NOT (FIO-STAT-OKS AND 
                      ACC-COD-NEMO IN ACC = GTP-COD-IITS IN GTP-FLD)
                   MOVE SPACES TO FRM-COD-LIST IN GTP-FLD
                   MOVE SPACES TO FRM-GLS-LIST IN GTP-FLD
                   MOVE ZEROES TO GTP-SGV-VTSN IN GTP-FLD
                   GO TO FIN-VAL-FRM-COD-LIST
              ELSE
                 MOVE 'GAR' TO TAB-COD-SIST
                 MOVE 'LST' TO TAB-COD-TTAB IN TAB
                 MOVE ACC-COD-LIST IN ACC TO TAB-COD-CTAB IN TAB
                 PERFORM VAL-COD
                 IF MSG-COD-MENS = 'COD    NEX' OR
                 GTP-COD-IITS IN GTP-FLD NOT > SPACES 
                     MOVE SPACES TO FRM-COD-LIST IN GTP-FLD
                     MOVE SPACES TO FRM-GLS-LIST IN GTP-FLD
                     MOVE ZEROES TO GTP-SGV-VTSN IN GTP-FLD
                     GO TO FIN-VAL-FRM-COD-LIST
                 ELSE
                    MOVE TAB-CIC-CTAB IN TAB TO WSS-LISTA IN WSS-VARI                 
                    MOVE ACC-COD-LIST IN ACC TO FRM-COD-LIST IN GTP-FLD
                    MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-LIST IN GTP-FLD
                    GO TO CONTINUA-VALOR
           ELSE
              MOVE SPACES TO FRM-COD-LIST IN GTP-FLD
              MOVE SPACES TO FRM-GLS-LIST IN GTP-FLD
              GO TO FIN-VAL-FRM-COD-LIST.
       CONTINUA-VALOR.
           IF WSS-LISTA IN WSS-VARI NOT = 'A' AND
              WSS-LISTA IN WSS-VARI NOT = 'B' AND
              WSS-LISTA IN WSS-VARI NOT = 'C'
              MOVE 1 TO GTP-SGV-VTSN IN GTP-FLD
           ELSE
              IF ACC-SGV-VCOU IN ACC < ACC-SGV-VCOP IN ACC
                 MOVE ACC-SGV-VCOU IN ACC TO GTP-SGV-VTSN IN GTP-FLD
              ELSE
                 MOVE ACC-SGV-VCOP IN ACC TO GTP-SGV-VTSN IN GTP-FLD. 
      *>>>>
*% END
*% IF GTP_COD_EITS
      *<<<< GTP_COD_EITS
      *VAL-COD Valida codigo de tabla
           MOVE 'GAR' TO TAB-COD-SIST.
           MOVE 'ES1' TO TAB-COD-TTAB IN TAB.
           MOVE GTP-COD-EITS IN GTP-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX' OR
              GTP-COD-EITS IN GTP-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-EITS IN GTP-FLD
               GO TO FIN-VAL-GTP-COD-EITS
           ELSE
               MOVE TAB-GLS-DCOR IN TAB TO
                    FRM-GLS-EITS IN GTP-FLD.

           IF SCR-CCPP = 'ING'  
               IF GTP-COD-EITS IN GTP-FLD > '10'
                   MOVE 'EST-ITM>10' TO MSG-COD-MENS
                   GO TO ERR-VAL-GTP-COD-EITS
               ELSE
                   GO TO FIN-VAL-GTP-COD-EITS.

      * CAMBIOS DE ESTADO
            IF GTP-COD-EITS IN GTP-FLD NOT = GAR-EST-ANT
               IF NOT (GTP-COD-EITS IN GTP-FLD = GAR-ES1-1 OR
                       GTP-COD-EITS IN GTP-FLD = GAR-ES1-2 OR
                       GTP-COD-EITS IN GTP-FLD = GAR-ES1-3 OR
                       GTP-COD-EITS IN GTP-FLD = GAR-ES1-4)
                   MOVE 'ESTITMNVOANT' TO MSG-COD-MENS
                   GO TO ERR-VAL-GTP-COD-EITS.
           GO TO FIN-VAL-GTP-COD-EITS.

       ERR-VAL-GTP-COD-EITS.
           MOVE 'GAR' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>>
*% END
*% IF GTP_SGV_VTSN
      *<<<< GTP_SGV_VTSN
      * Obtiene Codigo Vlr Cambio de Pesos Med CIC de la Moneda '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
           ELSE
           IF GDG-COD-VCAM IN GTP-FLD = TAB-COD-CTAB IN TAB
               MOVE GTP-SGV-VTSN IN GTP-FLD TO 
                    PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO
                    GTP-SGV-VTSN IN GTP-FLD.
      *>>>>
*% END
*% IF GTP_FEC_FCES
      *<<<< FIN_GTP_FEC_FCES
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN GTP-FLD TO WSS-TIPO IN WSS-VARI
           MOVE GDG-STP-CGTA IN GTP-FLD TO WSS-AUX IN WSS-VARI.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TIAU IN WSS-VARI.
           IF WSS-CIC-TIAU IN WSS-VARI = '952082'
              PERFORM GET-FHOY
              MOVE HOY-SHOY TO GTP-NUM-SCES IN GTP-FLD
              MOVE HOY-AHOY TO GTP-NUM-ACES IN GTP-FLD
              MOVE HOY-MHOY TO GTP-NUM-MCES IN GTP-FLD
              MOVE HOY-DHOY TO GTP-NUM-DCES IN GTP-FLD.

            MOVE GTP-CAI-GTIA IN GTP-FLD TO GVT-CAI-GTIA IN GVT.
            MOVE GTP-IIC-GTIA IN GTP-FLD TO GVT-IIC-GTIA IN GVT.
            MOVE GTP-NUM-ITSN IN GTP-FLD TO GVT-COD-TASN IN GVT.
            MOVE FIO-GET-KEY TO FIO-CMND.
            PERFORM GAR-FIO-GVT.
            IF FIO-STAT-OKS
                  MOVE GVT-NUM-DTSN IN GVT TO FEC-DEC1
                  MOVE GVT-NUM-MTSN IN GVT TO FEC-MEC1
                  MOVE GVT-NUM-STSN IN GVT TO WSS-SIGLO
                  MOVE GVT-NUM-ATSN IN GVT TO WSS-ANO
                  MOVE WSS-FECHA           TO FEC-FSA1
      *     
                  MOVE ZEROES TO WSS-FECHA
                  MOVE GTP-NUM-DCES IN GTP-FLD TO FEC-DEC2
                  MOVE GTP-NUM-MCES IN GTP-FLD TO FEC-MEC2
                  MOVE GTP-NUM-SCES IN GTP-FLD TO WSS-SIGLO
                  MOVE GTP-NUM-ACES IN GTP-FLD TO WSS-ANO
                  MOVE WSS-FECHA    IN WSS-VARI TO FEC-FSA2
                  MOVE FEC-FORM-FEC TO FEC-FORM
                  MOVE FEC-CMP-FEC  TO FEC-CMND
                  PERFORM PRO-FEC
                  IF FEC-STAT-GRT
                      MOVE 'GAR' TO MSG-COD-SIST
                      MOVE 'GTPCMB<TSN' TO MSG-COD-MENS
                      PERFORM GET-MSG
                      MOVE MSG-GLS-DESC TO FRM-MENS
                      MOVE FRM-SUAR-MAL TO FRM-SUAR
                      GO TO FIN-VAL-GTP-FEC-FCES
                  ELSE
                    NEXT SENTENCE
           ELSE
               MOVE 'GTPKEYMALGDG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GTP-FEC-FCES.
      *>>>>
*% END
*% IF FIN_PUT_GDG_GTP
      *<<<< FIN_PUT_GDG_GTP
            IF GDG-TIP-CGTA IN GTP-FLD > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'AUX ' TO TAB-COD-TTAB IN TAB
               MOVE GDG-TIP-CGTA IN GTP-FLD TO WSS-TIP-CGTA IN WSS-VARI
               MOVE GDG-STP-CGTA IN GTP-FLD TO WSS-STP-CGTA IN WSS-VARI
               MOVE WSS-COD-CGTA IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
      *MHM-INI 23-OCT-2003
      *         MOVE TAB-GLS-DESC IN TAB TO
      *              FRM-GLS-CGTA IN GTP-FLD
      *     ELSE
      *         MOVE SPACES TO FRM-GLS-CGTA IN GTP-FLD.
               MOVE TAB-GLS-DESC IN TAB     TO WSS-GLS-SOPE IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-SOPE IN WSS-VARI.

           IF GDG-TIP-CGTA IN GTP-FLD > SPACES
               MOVE 'TAB'                   TO TAB-COD-SIST
               MOVE 'TIO'                   TO TAB-COD-TTAB IN TAB
               MOVE SPACES                  TO TAB-COD-CTAB IN TAB
               MOVE GDG-TIP-CGTA IN GTP-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB             
               MOVE TAB-GLS-DESC IN TAB     TO WSS-GLS-TOPE IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-TOPE IN WSS-VARI.
               
           MOVE WSS-GLS-CGTA TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO FRM-GLS-CGTA IN GTP-FLD.
      *MHM-FIN 23-OCT-2003

*% IF NOT GEN_BCI
           MOVE SPACES              TO WSS-CIC-TOPE IN WSS-VARI.
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
           MOVE SPACES              TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN GTP-FLD TO WSS-TIPO IN WSS-VARI
           MOVE GDG-STP-CGTA IN GTP-FLD TO WSS-AUX IN WSS-VARI.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TIAU IN WSS-VARI.
           IF WSS-CIC-TIAU IN WSS-VARI = '952082'
              MOVE 'GAR' TO TAB-COD-SIST
              MOVE 'NEM' TO TAB-COD-TTAB IN TAB
              MOVE GTP-COD-IITS IN GTP-FLD TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              MOVE TAB-GLS-DAT1 IN TAB TO WSS-LISTA IN WSS-VARI
              MOVE 'GAR' TO TAB-COD-SIST
              MOVE 'LST' TO TAB-COD-TTAB IN TAB
              MOVE WSS-LISTA IN WSS-VARI TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              MOVE WSS-LISTA IN WSS-VARI TO FRM-COD-LIST IN GTP-FLD
              MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-LIST IN GTP-FLD
           ELSE
              MOVE SPACES TO FRM-COD-LIST IN GTP-FLD
              MOVE SPACES TO FRM-GLS-LIST IN GTP-FLD.
*% END
      *>>>>
*% END
*% IF FIN_PUT_GTP_GTP
      *<<<< FIN_PUT_GTP_GTP
           MOVE GTP-COD-EITS IN GTP TO GAR-EST-ANT.

      *BUS-TAB busca glosa de codigo en tabla
           IF GTP-COD-EITS IN GTP-FLD > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'ES1' TO TAB-COD-TTAB IN TAB
               MOVE GTP-COD-EITS IN GTP-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-COD-DAT2 IN TAB(1) TO GAR-ES1-1
               MOVE TAB-COD-DAT2 IN TAB(2) TO GAR-ES1-2
               MOVE TAB-COD-DAT2 IN TAB(3) TO GAR-ES1-3
               MOVE TAB-COD-DAT2 IN TAB(4) TO GAR-ES1-4
               MOVE TAB-GLS-DCOR IN TAB TO
                    FRM-GLS-EITS IN GTP-FLD.

      *PVG INI 15-OCT-2003
           MOVE 'TAB'                    TO TAB-COD-SIST.
           MOVE 'AUX'                    TO TAB-COD-TTAB IN TAB.
           MOVE SPACES                   TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN GTP-FLD  TO WSS-TIPO IN WSS-VARI
           MOVE GDG-STP-CGTA IN GTP-FLD  TO WSS-AUX IN WSS-VARI.
           MOVE WSS-TIPO-AUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-TIAU IN WSS-VARI.
           IF WSS-CIC-TIAU IN WSS-VARI = '952086'
              MOVE GTP-COD-IITS IN GTP-FLD TO ACC-COD-NEMO IN ACC
              MOVE GTP-NUM-SCES IN GTP-FLD TO ACC-NUM-SPRO IN ACC
              MOVE GTP-NUM-ACES IN GTP-FLD TO ACC-NUM-APRO IN ACC
              MOVE GTP-NUM-MCES IN GTP-FLD TO ACC-NUM-MPRO IN ACC
              MOVE GTP-NUM-DCES IN GTP-FLD TO ACC-NUM-DPRO IN ACC
              MOVE FIO-GET-LEQ TO FIO-CMND
              PERFORM GAR-FIO-ACC
              IF NOT (FIO-STAT-OKS AND
                      ACC-COD-NEMO IN ACC = GTP-COD-IITS IN GTP-FLD)
                 MOVE SPACES                 TO FRM-COD-LIST IN GTP-FLD
                 MOVE SPACES                 TO FRM-GLS-LIST IN GTP-FLD
                 MOVE ZEROES                 TO GTP-SGV-VTSN IN GTP-FLD
              ELSE
                 MOVE 'GAR'                  TO TAB-COD-SIST
                 MOVE 'LST'                  TO TAB-COD-TTAB IN TAB
                 MOVE ACC-COD-LIST IN ACC    TO TAB-COD-CTAB IN TAB
                 PERFORM BUS-TAB
                 IF MSG-COD-MENS = 'COD    NEX' OR
                    GTP-COD-IITS IN GTP-FLD NOT > SPACES
                    MOVE SPACES              TO FRM-COD-LIST IN GTP-FLD
                    MOVE SPACES              TO FRM-GLS-LIST IN GTP-FLD
                    MOVE ZEROES              TO GTP-SGV-VTSN IN GTP-FLD
                 ELSE
                    MOVE TAB-CIC-CTAB IN TAB TO WSS-LISTA IN WSS-VARI
                    MOVE ACC-COD-LIST IN ACC TO FRM-COD-LIST IN GTP-FLD
                    MOVE TAB-GLS-DCOR IN TAB TO FRM-GLS-LIST IN GTP-FLD
           ELSE
              MOVE SPACES                    TO FRM-COD-LIST IN GTP-FLD
              MOVE SPACES                    TO FRM-GLS-LIST IN GTP-FLD.
      *PVG FIN 15-OCT-2003
      *>>>>
*% END
*% IF GTP_FEC_CMB_EST
      *<<<< GTP_FEC_CMB_EST

      *VAL-FEC valida que fec. cambio sea mayor o igual a fec. tasacion 
           MOVE GTP-NUM-SIS IN GTP-FLD TO GAR-NUM-SIS IN GVT.
           MOVE GTP-COD-CRR IN GTP-FLD TO GAR-COD-CRR IN GVT.
           MOVE GTP-COD-TSN IN GTP-FLD TO GAR-COD-TSN IN GVT.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           IF FIO-STAT-OKS 
                  MOVE GAR-FD-TSN IN GVT TO FEC-DEC1
                  MOVE GAR-FM-TSN IN GVT TO FEC-MEC1
                  MOVE GAR-FA-TSN IN GVT TO FEC-FSA1
      *     
                  MOVE GTP-FD-CMB-EST IN GTP-FLD TO FEC-DEC2
                  MOVE GTP-FM-CMB-EST IN GTP-FLD TO FEC-MEC2
                  MOVE GTP-FA-CMB-EST IN GTP-FLD TO FEC-FSA2
                  MOVE FEC-FORM-FEC TO FEC-FORM
                  MOVE FEC-CMP-FEC  TO FEC-CMND
                  PERFORM PRO-FEC
                  IF FEC-STAT-GRT
                      MOVE 'GAR' TO MSG-COD-SIST
                      MOVE 'GTPCMB<TSN' TO MSG-COD-MENS
                      PERFORM GET-MSG
                      MOVE MSG-GLS-DESC TO FRM-MENS
                      MOVE FRM-SUAR-MAL TO FRM-SUAR
                      GO TO FIN-VAL-GTP-FEC-CMB-EST
                  ELSE
                      NEXT SENTENCE
           ELSE
               MOVE 'GTPKEYMALGDG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GTP-FEC-CMB-EST.

      *>>>>
*% END
*% IF GTP_COD_EST_ITM
      *<<<< GTP_COD_EST_ITM
      *VAL-COD Valida codigo de tabla
           MOVE 'GAR' TO TAB-COD-SIST.
           MOVE 'ES1' TO TAB-COD-TTAB IN TAB.
           MOVE GTP-COD-EST-ITM IN {FRM}-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX' OR
              GTP-COD-EST-ITM IN {FRM}-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-EITS IN {FRM}-FLD
               GO TO FIN-VAL-GTP-COD-EST-ITM
           ELSE
               MOVE TAB-GLS-DCOR IN TAB TO
                    FRM-GLS-EITS IN {FRM}-FLD.

           IF SCR-CCPP = 'ING'  

               IF GTP-COD-EST-ITM IN {FRM}-FLD > '10'
                   MOVE 'EST-ITM>10' TO MSG-COD-MENS
                   GO TO ERR-VAL-GTP-COD-EST-ITM
               ELSE
                   GO TO FIN-VAL-GTP-COD-EST-ITM.

      * CAMBIOS DE ESTADO
           IF GTP-COD-EST-ITM IN {FRM}-FLD NOT =GAR-EST-ANT
               IF NOT (GTP-COD-EST-ITM IN {FRM}-FLD = GAR-ES1-1 OR
                       GTP-COD-EST-ITM IN {FRM}-FLD = GAR-ES1-2 OR
                       GTP-COD-EST-ITM IN {FRM}-FLD = GAR-ES1-3 OR
                       GTP-COD-EST-ITM IN {FRM}-FLD = GAR-ES1-4)
                   MOVE 'ESTITMNVOANT' TO MSG-COD-MENS
                   GO TO ERR-VAL-GTP-COD-EST-ITM.
           GO TO FIN-VAL-GTP-COD-EST-ITM.

       ERR-VAL-GTP-COD-EST-ITM.
           MOVE 'GAR' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>>
*% END
*% IF GTP_VAL_UNT_ITM
      *<<<< GTP_VAL_UNT_ITM

      * Obtiene Codigo Valor de Cambio de Pesos Mediante CIC de la Moneda '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
           ELSE
           IF GDG-VCB IN GTP-FLD = TAB-COD-CTAB IN TAB
               MOVE GTP-VAL-UNT-ITM IN GTP-FLD TO 
                    PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO
                    GTP-VAL-UNT-ITM IN GTP-FLD.
      *>>>>
*% END
