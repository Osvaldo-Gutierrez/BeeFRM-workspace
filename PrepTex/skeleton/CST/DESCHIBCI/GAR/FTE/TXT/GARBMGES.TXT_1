*% FRM = 'GES'
*% REG = 'GES'
*% FMT_CHI = TRUE
*% GEN_BCI = TRUE
*% IF FIN_UNP_IKY_GES 
      *<<<< FIN_UNP_IKY_GES 
      *RRM-INI 16-APR-2002
           IF SCR-CCPP = 'ING'
               MOVE FRM-CPIM-AEY TO GES-NUM-IGES-ATR IN GES-FLD
               MOVE FRM-CPIM-AEY TO GES-NUM-IGES-STP.
      *RRM-FIN 16-APR-2002
      *>>>>
*% END
*% IF INI_GES_IIC_IDGP
      *<<<< INI_GES_IIC_IDGP
      *>>>>
*% END
*% IF GES_CAI_IDGP
      *>>>>
*% END
*% IF FIN_PUT_GES_GES
      *<<<< FIN_PUT_GES_GES
      *BUS-COL busca datos Documento Legal Credito en Colocaciones
*% IF FMT_CHI
      *<<<< FMT_CHI
           IF GES-IIC-IOPC IN GES-FLD > ZEROES AND                  
      *>>>>
*% ELSE
           IF GES-CIC-ICON IN GES-FLD > ZEROES AND                  
              GES-CIC-IOPC IN GES-FLD > ZEROES AND                  
*% END
              GES-NUM-IDLC IN GES-FLD > ZEROES AND                  
              GES-COD-SIST IN GES-FLD > SPACES                      
                 MOVE 'TAB'                   TO FIO-SIST           
                 MOVE 'TAB'                   TO TAB-COD-SIST
                 MOVE 'SIS'                   TO TAB-COD-TTAB IN TAB
                 MOVE GES-COD-SIST IN GES-FLD TO TAB-COD-CTAB IN TAB
                 MOVE FIO-GET-KEY             TO FIO-CMND           
                 PERFORM GNS-FIO-TAB                                
                 IF FIO-STAT-OKS                                    
*% IF NOT FMT_CHI
      *<<<< NOT FMT_CHI
                    MOVE TAB-CIC-CTAB IN TAB TO DLC-COD-SIST IN DLC 
      *>>>>
*% END
                    PERFORM BUS-COL                                 
                    IF MSG-COD-MENS > SPACES                        
                       GO TO FIN-PUT-GES-GES.                       

      *BUS-TAB busca glosa de codigo en tabla
           IF GES-COD-MVLC IN GES-FLD > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'VLR' TO TAB-COD-TTAB IN TAB
               MOVE GES-COD-MVLC IN GES-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-MVLC IN GES-FLD.

      *BUS-MSC busca glosa de miscelaneo en tabla
           MOVE GES-COD-VCMC IN GES-FLD TO GES-COD-VCMC IN GES.
           IF GES-COD-TVCC IN GES-FLD > SPACES AND
*% IF FMT_CHI
      *<<<< FMT_CHI
                GES-IIC-IOPC IN GES-FLD > ZEROES
      *>>>>
*% ELSE
              ( GES-CIC-ICON IN GES-FLD > ZEROES OR
                GES-COD-CVCC IN GES NOT > SPACES       )
*% END

               MOVE 'TAB' TO MSC-COD-SIST
               MOVE 'TVAL' TO MSC-COD-TMSC IN MSC
               MOVE GES-COD-TVCC IN GES-FLD TO MSC-COD-CMSC IN MSC
               PERFORM BUS-MSC
               MOVE MSC-GLS-DESC IN MSC TO FRM-GLS-TVCC IN GES-FLD
           ELSE
               MOVE SPACES TO GES-COD-TVCC IN GES-FLD
                                FRM-GLS-TVCC IN GES-FLD.
*% IF GEN_BCI
      *<<<< GEN_BCI
      *BUS-TAB busca glosa de codigo en tabla
           IF GES-COD-TOPE IN GES-FLD > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'TIO' TO TAB-COD-TTAB IN TAB
               MOVE GES-COD-TOPE IN GES-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB TO TIO
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-TOPE IN GES-FLD.

      *BUS-TAB busca glosa de codigo en tabla
           IF GES-COD-SOPE IN GES-FLD NOT > SPACES
               GO TO FIN-BUS-AUX.

           IF TIO-GLS-SIST IN TIO = 'COL'
      *VAL-COD Valida EN TABLA AUX DE SISTEMA COL
               MOVE 'COL' TO TAB-COD-SIST
           ELSE
               MOVE 'TAB' TO TAB-COD-SIST.

           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
           MOVE GES-COD-TOPE IN GES-FLD TO WSS-COD-TOPE.
           MOVE GES-COD-SOPE IN GES-FLD TO WSS-COD-SOPE.
           MOVE WSS-COD-AGTA TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO
                FRM-GLS-SOPE IN GES-FLD.

      *>>>>
*% END
       FIN-BUS-AUX.

      *BUS-TAB busca glosa de codigo en tabla
           IF GES-COD-VCMC IN GES-FLD > ZEROES AND
              GES-COD-CVCC IN GES > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'VLR' TO TAB-COD-TTAB IN TAB
               MOVE GES-COD-VCMC IN GES-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-VCMC IN GES-FLD.
      *>>>>
*% END
*% IF FIN_PUT_GDG_GES
      *<<<< FIN_PUT_GDG_GES
*% IF GEN_BCI
      *<<<< GEN_BCI
           IF GDG-TIP-CGTA IN GES-FLD > SPACES
               MOVE 'TAB'                   TO TAB-COD-SIST
               MOVE 'AUX'                   TO TAB-COD-TTAB IN TAB
               MOVE GDG-TIP-CGTA IN GES-FLD TO WSS-COD-TOPE IN WSS-VARI
               MOVE GDG-STP-CGTA IN GES-FLD TO WSS-COD-SOPE IN WSS-VARI
               MOVE WSS-COD-AGTA IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB             
      *MHM-INI 23-OCT-2003
      *         MOVE TAB-GLS-DESC IN TAB     TO FRM-GLS-CGTA IN GES-FLD.
               MOVE TAB-GLS-DESC IN TAB     TO WSS-GLS-SOPE IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-SOPE IN WSS-VARI.

           IF GDG-TIP-CGTA IN GES-FLD > SPACES
               MOVE 'TAB'                   TO TAB-COD-SIST
               MOVE 'TIO'                   TO TAB-COD-TTAB IN TAB
               MOVE SPACES                  TO TAB-COD-CTAB IN TAB
               MOVE GDG-TIP-CGTA IN GES-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB             
               MOVE TAB-GLS-DESC IN TAB     TO WSS-GLS-TOPE IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-TOPE IN WSS-VARI.
               
           MOVE WSS-GLS-CGTA TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO FRM-GLS-CGTA IN GES-FLD.
      *MHM-FIN 23-OCT-2003
      *>>>>
*% END
      *>>>>
*% END
*% IF FIN_UNP_GES_GES
      *<<<< FIN_UNP_GES_GES
           IF SCR-CCPP = 'ING'
              MOVE 'S'          TO GES-IND-SCRE     IN GES-FLD
              MOVE FRM-CPIM-AEY TO GES-IND-SCRE-ATR IN GES-FLD
              MOVE FRM-CPIM-AEY TO GES-IND-SCRE-STP.
      
           MOVE 'GAR'               TO FIO-SIST.              
           MOVE 'VSN'               TO TAB-COD-TTAB IN TAB.   
           MOVE 'SOLOESPECOPE'      TO TAB-COD-CTAB IN TAB.   

           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
              IF TAB-IND-VIGE IN TAB = 'S'
      *RRM-INI 16-APR-2002
                 MOVE FRM-CPIM-AEY TO GES-FEC-FVCR-ATR IN GES-FLD
                 MOVE FRM-CPIM-AEY TO GES-FEC-FVCR-STP
      *RRM-FIN 16-APR-2002
                 MOVE FRM-CPIM-AEY TO GES-COD-TVCC-ATR IN GES-FLD 
                 MOVE FRM-CPIM-AEY TO GES-COD-TVCC-STP 
*% IF GEN_BCI
      *<<<< GEN_BCI
      *JRF-INI 29-JUL-2003
                 MOVE FRM-CPIM-AEY TO GES-COD-TOPE-ATR IN GES-FLD 
                 MOVE FRM-CPIM-AEY TO GES-COD-TOPE-STP 
                 MOVE FRM-CPIM-AEY TO GES-COD-SOPE-ATR IN GES-FLD 
                 MOVE FRM-CPIM-AEY TO GES-COD-SOPE-STP 
      *JRF-FIN 29-JUL-2003
      *>>>>
*% ELSE
      *<<<<
                 MOVE FRM-CPIM-AEY TO GES-COD-COPE-ATR IN GES-FLD 
                 MOVE FRM-CPIM-AEY TO GES-COD-COPE-STP 
      *>>>>
*% END
                 MOVE FRM-CPIM-AEY TO GES-COD-VCMC-ATR IN GES-FLD 
                 MOVE FRM-CPIM-AEY TO GES-COD-VCMC-STP 
                 MOVE FRM-CPIM-AEY TO GES-COD-DCRE-ATR IN GES-FLD 
                 MOVE FRM-CPIM-AEY TO GES-COD-DCRE-STP 
                 MOVE FRM-CPIM-AEY TO GES-IND-TDEU-ATR IN GES-FLD 
                 MOVE FRM-CPIM-AEY TO GES-IND-TDEU-STP.

      *>>>>
*% END
*% IF GES_NUM_IGES
      *<<<< GES_COD_ESP
           IF GES-NUM-IGES IN GES-FLD NOT > ZEROES AND
              SCR-CCPP NOT = 'ING'

               PERFORM KEY-GES-GES
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GAR-FIO-GES
               IF FIO-STAT-OKS
                   GO TO FIN-VAL-GES-NUM-IGES.

           IF GES-NUM-IGES IN GES-FLD NOT > ZEROES
               PERFORM BUS-COR-GES.

           IF GES-NUM-IGES IN GES-FLD = ZEROES
               PERFORM ERR-GLS
                GO TO FIN-VAL-GES-NUM-IGES.
      *>>>>
*% END
*% IF INI_VAL_IKY_GES
      *<<<< INI_VAL_IKY_GES
*% IF FMT_CHI
      *<<<< FMT_CHI
           IF GES-IIC-IOPC IN GES-FLD      > ZEROES  AND
      *>>>>
*% ELSE
           IF GES-CIC-ICON IN GES-FLD      > ZEROES  AND
              GES-CIC-IOPC IN GES-FLD      > ZEROES  AND
*% END
              GES-NUM-IDLC IN GES-FLD      > ZEROES  AND
              GES-CAI-GTIA IN GES-FLD NOT  > ZEROES  AND
              GES-IIC-GTIA IN GES-FLD NOT  > ZEROES  AND
              GES-NUM-IGES IN GES-FLD NOT  > ZEROES  AND
              SCR-CCPP                NOT = 'ING'
              GO TO FIN-VAL-IKY-GES.

      *>>>>
*% END
*% IF INI_VAL_MKY_GES
      *<<<<INI_VAL_MKY_GES
           GO TO FIN-VAL-MKY-GES.
      *>>>>
*% END
*% IF INI_VAL_CON_IKY_GES
      *<<<< INI_VAL_CON_IKY_GES

           IF SCR-CCPP = 'ELI' 
               PERFORM KEY-GES-GES
               ADD 1   TO GES-NUM-IGES IN GES
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GAR-FIO-GES
               IF FIO-STAT-OKS
                   MOVE 'GAR'       TO MSG-COD-SIST
                   MOVE 'IKYSIGEXI' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-CON-IKY-GES
               ELSE
                   GO TO FIN-VAL-CON-IKY-GES.

           IF GES-NUM-IGES IN GES-FLD > 1
               PERFORM KEY-GES-GES
               SUBTRACT 1 FROM GES-NUM-IGES IN GES-FLD
                        GIVING GES-NUM-IGES IN GES

               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GAR-FIO-GES
               IF NOT FIO-STAT-OKS
                   MOVE 'GAR'       TO MSG-COD-SIST
                   MOVE 'IKYANTNEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-CON-IKY-GES
               ELSE
      *            Gtia a conjunto de creditos
                   IF GES-IIC-IOPC IN GES NOT > ZEROES
                       MOVE 'GAR'         TO MSG-COD-SIST
                       MOVE 'GES SOLO 1'  TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE FRM-SUAR-MAL TO FRM-SUAR
                       GO TO FIN-VAL-CON-IKY-GES
                   ELSE

      *                Gtia a un credito individual
      *                Ingresa Item siguientes al primero
                       GO TO FIN-VAL-CON-IKY-GES.

      *>>>>
*% END
*% IF FIN_FST_FLD_GES
      *<<<< FIN_FST_FLD_GES
*% IF FMT_CHI
      *<<<< FMT_CHI
           IF GES-IIC-IOPC IN GES-FLD > ZEROES
      *>>>>
*% ELSE
           IF GES-CIC-ICON IN GES-FLD > ZEROES
*% END
               MOVE FRM-CPIM-AEY TO GES-FEC-FVCR-ATR IN GES-FLD
               MOVE FRM-CPIM-AEY TO GES-FEC-FVCR-STP

               MOVE FRM-CPIM-AEY TO GES-COD-TVCC-ATR IN GES-FLD
               MOVE FRM-CPIM-AEY TO GES-COD-TVCC-STP

*% IF GEN_BCI
      *<<<< GEN_BCI
      *JRF-INI 29-JUL-2003
               MOVE FRM-CPIM-AEY TO GES-COD-TOPE-ATR IN GES-FLD
               MOVE FRM-CPIM-AEY TO GES-COD-TOPE-STP
               MOVE FRM-CPIM-AEY TO GES-COD-SOPE-ATR IN GES-FLD
               MOVE FRM-CPIM-AEY TO GES-COD-SOPE-STP
      *JRF-FIN 29-JUL-2003
      *>>>>
*% ELSE
      *<<<<
               MOVE FRM-CPIM-AEY TO GES-COD-COPE-ATR IN GES-FLD
               MOVE FRM-CPIM-AEY TO GES-COD-COPE-STP
      *>>>>
*% END
               MOVE FRM-CPIM-AEY TO GES-COD-VCMC-ATR IN GES-FLD
               MOVE FRM-CPIM-AEY TO GES-COD-VCMC-STP

               MOVE FRM-CPIM-AEY TO GES-COD-DCRE-ATR IN GES-FLD
               MOVE FRM-CPIM-AEY TO GES-COD-DCRE-STP

               MOVE FRM-CPIM-AEY TO GES-IND-TDEU-ATR IN GES-FLD
               MOVE FRM-CPIM-AEY TO GES-IND-TDEU-STP.
      *>>>>
*% END
*% IF FIN_GES_COD_PACR
      *<<<< FIN_GES_COD_PACR

           MOVE GES-CAI-GTIA IN GES-FLD  TO GAP-CAI-GTIA IN GAP.
           MOVE GES-IIC-GTIA IN GES-FLD  TO GAP-IIC-GTIA IN GAP.
           MOVE GES-COD-PACR IN GES-FLD  TO GAP-COD-PACR IN GAP.
           MOVE FIO-GET-KEY  TO  FIO-CMND.                      
           PERFORM GAR-FIO-GAP.                                 
           IF NOT FIO-STAT-OKS                                  
              MOVE 'GAR'          TO MSG-COD-SIST               
              MOVE 'NOEXISTEGAP ' TO MSG-COD-MENS               
              PERFORM GET-MSG                                   
              MOVE MSG-GLS-DESC TO FRM-MENS                     
              MOVE FRM-SUAR-MAL TO FRM-SUAR                     
              GO TO FIN-VAL-GES-COD-PACR.                       
                                                                
           IF GAP-IND-ESBA IN GAP = 'N'                         
              MOVE 'GAR'          TO MSG-COD-SIST               
              MOVE 'ACRENOBANCO ' TO MSG-COD-MENS               
              PERFORM GET-MSG                                   
              MOVE MSG-GLS-DESC TO FRM-MENS                     
              MOVE FRM-SUAR-MAL TO FRM-SUAR                     
              GO TO FIN-VAL-GES-COD-PACR.                       
                                                                
           IF GAP-IND-MASC IN GAP = 'N'                         
              MOVE 'GAR'          TO MSG-COD-SIST              
              MOVE 'NOACEPTACRE ' TO MSG-COD-MENS              
              PERFORM GET-MSG                                  
              MOVE MSG-GLS-DESC TO FRM-MENS                    
              MOVE FRM-SUAR-MAL TO FRM-SUAR                    
              GO TO FIN-VAL-GES-COD-PACR.                      
                                                               
*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GDG-TIP-CGTA IN GES-FLD TO TAG-TIP-AGTA IN TAG.
           MOVE GDG-STP-CGTA IN GES-FLD TO TAG-STP-AGTA IN TAG.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GES-FLD TO TAG-COD-AGTA IN TAG.
*% END
           MOVE FIO-GET-KEY    TO FIO-CMND.                    
           PERFORM GAR-FIO-TAG.                                
           IF NOT FIO-STAT-OKS                                 
              MOVE 'TAG    NEX' TO MSG-COD-MENS                
              MOVE 'GAR' TO MSG-COD-SIST                       
              PERFORM GET-MSG                                  
              MOVE MSG-GLS-DESC TO FRM-MENS                    
              MOVE FRM-SUAR-MAL TO FRM-SUAR                    
              GO TO FIN-VAL-GES-COD-PACR.                      
                                                               
           IF TAG-IND-EGLE IN TAG NOT = 'S'                    
              GO TO FIN-VAL-GES-COD-PACR.                      
                                                               
           MOVE GES-CAI-GTIA IN GES-FLD TO GLE-CAI-GTIA IN GLE.
           MOVE GES-IIC-GTIA IN GES-FLD TO GLE-IIC-GTIA IN GLE.
           MOVE GES-COD-PACR IN GES-FLD TO GLE-COD-PACR IN GLE.
           MOVE FIO-GET-KEY    TO FIO-CMND.                    
           PERFORM GAR-FIO-GLE.                                
           IF NOT FIO-STAT-OKS                                 
              MOVE 'GLE    NEX' TO MSG-COD-MENS                
              MOVE 'GAR' TO MSG-COD-SIST                       
              PERFORM GET-MSG                                  
              MOVE MSG-GLS-DESC TO FRM-MENS                    
              MOVE FRM-SUAR-MAL TO FRM-SUAR                    
              GO TO FIN-VAL-GES-COD-PACR.                      

      *>>>>
*% END
*% IF INI_GES_COD_SIST
      *<<<< INI_GES_COD_SIST                               
*% IF NOT FMT_CHI
      *<<<< NOT FMT_CHI
           MOVE SPACES              TO DLC-COD-SIST IN DLC.
      *>>>>
*% END
           MOVE 'GAR'               TO FIO-SIST.           
           MOVE 'VSN'               TO TAB-COD-TTAB IN TAB.
           MOVE 'SOLOESPECOPE'      TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY         TO FIO-CMND.           
           PERFORM GNS-FIO-TAB.                            
           IF NOT FIO-STAT-OKS                             
              MOVE 'N' TO WSS-IND-VIGE                     
           ELSE                                            
              MOVE TAB-IND-VIGE IN TAB TO WSS-IND-VIGE.    
                                                           
           IF WSS-IND-VIGE = 'N' AND                       

      *RRM-INI 16-APR-2002
      *       GES-COD-SIST IN GES-FLD NOT > SPACES
              GES-COD-SIST IN GES-FLD NOT > SPACES AND
*% IF FMT_CHI
      *<<<< FMT_CHI
              GES-IIC-IOPC IN GES-FLD NOT > ZEROES AND    
      *>>>>
*% ELSE
              GES-CIC-ICON IN GES-FLD NOT > ZEROES AND
              GES-CIC-IOPC IN GES-FLD NOT > ZEROES AND    
*% END
              GES-NUM-IDLC IN GES-FLD NOT > ZEROES 
      *RRM-FIN 16-APR-2002
               MOVE SPACES TO GES-COD-SIST IN GES-FLD
               GO TO FIN-VAL-GES-COD-SIST.
      *>>>>                                                
*% END
*% IF FIN_GES_COD_SIST
      *<<<< FIN_GES_COD_SIST                               
*% IF NOT FMT_CHI
      *<<<< NOT FMT_CHI
           MOVE TAB-CIC-CTAB IN TAB TO DLC-COD-SIST IN DLC.
      *>>>>
*% END
      *>>>>                                                
*% END
*% IF GES_IND_SCRE
      *<<<< GES_IND_SCRE
           MOVE 'GAR'                    TO TAB-COD-SIST.
           MOVE 'SIN'                    TO TAB-COD-TTAB IN TAB.
           MOVE GES-IND-SCRE IN GES-FLD  TO TAB-COD-CTAB IN TAB. 
           PERFORM VAL-COD.
      *>>>>
*% END
*% IF GES_CIC_ICON
      *<<<< GES_CIC_ICON
      *RRM-INI 16-APR-2002
           IF WSS-IND-VIGE = 'N' AND
              GES-CIC-ICON IN GES-FLD NOT > ZEROES
               MOVE ZEROES TO GES-CIC-ICON IN GES-FLD
               GO TO FIN-VAL-GES-CIC-ICON.
      *RRM-FIN 16-APR-2002

           IF GES-CIC-ICON IN GES-FLD NOT > ZEROES
               MOVE ZEROES TO GES-CIC-ICON IN GES-FLD.

           IF ( GES-NUM-IGES IN GES-FLD > 1 AND
              GES-CIC-ICON IN GES-FLD NOT > ZEROES )
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'GESIICCDTBLK' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GES-CIC-ICON.

           IF WSS-IND-VIGE = 'S' AND              
              GES-CIC-ICON IN GES-FLD NOT > ZEROES
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'GESIICCDTBLK' TO MSG-COD-MENS
               PERFORM GET-MSG                    
               MOVE MSG-GLS-DESC TO FRM-MENS      
               MOVE FRM-SUAR-MAL TO FRM-SUAR      
               GO TO FIN-VAL-GES-CIC-ICON.        

      *>>>>
*% END
*% IF GES_CIC_IOPC
      *<<<< GES_CIC_IOPC
      *RRM-INI 16-APR-2002
           IF WSS-IND-VIGE = 'N' AND
              GES-CIC-IOPC IN GES-FLD NOT > ZEROES
               MOVE ZEROES TO GES-CIC-IOPC IN GES-FLD
               GO TO FIN-VAL-GES-CIC-IOPC.
      *RRM-FIN 16-APR-2002

           IF GES-CIC-IOPC IN GES-FLD NOT > ZEROES
               MOVE ZEROES TO GES-CIC-IOPC IN GES-FLD.

           IF ( GES-CIC-ICON IN GES-FLD     > ZEROES AND
                GES-CIC-IOPC IN GES-FLD NOT > ZEROES     )
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'GESIICCDTBLK' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GES-CIC-IOPC.
      *>>>>
*% END
*% IF GES_IIC_IOPC
      *<<<< GES_IIC_IOPC
      *RRM-INI 16-APR-2002
           IF WSS-IND-VIGE = 'N' AND
              GES-IIC-IOPC IN GES-FLD NOT > ZEROES
               MOVE ZEROES TO GES-IIC-IOPC IN GES-FLD
               GO TO FIN-VAL-GES-IIC-IOPC.
      *RRM-FIN 16-APR-2002

           IF GES-IIC-IOPC IN GES-FLD NOT > ZEROES
               MOVE ZEROES TO GES-IIC-IOPC IN GES-FLD.

      *>>>>
*% END
*% IF GES_NUM_IDLC
      *<<<< GES_NUM_IDLC
      *RRM-INI 16-APR-2002
           IF WSS-IND-VIGE = 'N' AND
              GES-NUM-IDLC IN GES-FLD NOT > ZEROES
               MOVE ZEROES TO GES-NUM-IDLC IN GES-FLD
               GO TO FIN-VAL-GES-NUM-IDLC.
      *RRM-FIN 16-APR-2002

           IF GES-NUM-IDLC IN GES-FLD NOT > ZEROES 
               MOVE ZEROES TO GES-NUM-IDLC IN GES-FLD.

*% IF FMT_CHI
      *<<<< FMT_CHI
           IF ( GES-IIC-IOPC IN GES-FLD     > ZEROES AND
                GES-NUM-IDLC IN GES-FLD NOT > ZEROES )  
      *>>>>
*% ELSE
           IF ( GES-CIC-ICON IN GES-FLD     > ZEROES AND
                GES-NUM-IDLC IN GES-FLD NOT > ZEROES )  
*% END
               MOVE 'GAR'          TO MSG-COD-SIST      
               MOVE 'GESIICCDTBLK' TO MSG-COD-MENS      
               PERFORM GET-MSG                          
               MOVE MSG-GLS-DESC TO FRM-MENS            
               MOVE FRM-SUAR-MAL TO FRM-SUAR            
               GO TO FIN-VAL-GES-NUM-IDLC.              

           IF GES-NUM-IDLC IN GES-FLD NOT > ZEROES
               GO TO FIN-VAL-GES-NUM-IDLC.

      *FLB CST  9-MAY-1994 DLC NO DEBE REPETIRSE
           PERFORM VAL-DLC-IGUA.
           IF MSG-COD-MENS > SPACES
               MOVE 'GAR' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GES-NUM-IDLC.

           PERFORM BUS-COL.
           IF MSG-COD-MENS > SPACES
               MOVE 'GAR' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GES-NUM-IDLC.

*% IF PGM_CHI
      *<<<< PGM_CHI
*% IF NOT GEN_BCI
      *<<<< NOT GEN_BCI
           PERFORM VAL-RDC-GDD.
           IF MSG-COD-MENS > SPACES
               MOVE 'GAR' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GES-NUM-IDLC.
      *>>>>
*% END
      *>>>>
*% END
      *>>>>
*% END
*% IF INI_GES_FEC_FVCR
      *<<<< INI_GES_FEC_VTO_CDT
           IF GES-FEC-FVCR IN GES-FLD NOT > ZEROES
               MOVE ZEROES TO GES-FEC-FVCR IN GES-FLD
               GO TO FIN-VAL-GES-FEC-FVCR.

           MOVE FEC-CHOY-N TO FEC-CHOY.
           MOVE FEC-VHBL-N TO FEC-VHBL.
           MOVE FEC-FBLK-N TO FEC-FBLK.

           MOVE GES-NUM-SVCR IN GES-FLD TO FEC-SEC1.
           MOVE GES-NUM-AVCR IN GES-FLD TO FEC-AEC1.
           MOVE GES-NUM-MVCR IN GES-FLD TO FEC-MEC1.
           MOVE GES-NUM-DVCR IN GES-FLD TO FEC-DEC1.
      *>>>>
*% END
*% IF GES_COD_SIST
      *<<<< GES_COD_SIST
      *>>>>
*% END
*% LBL = ''
*% IF GES_SGV_PLCR
      *<<<< GES_PCT_LIM_CDT
           IF GES-SGV-PLCR IN GES-FLD NOT > ZEROES AND
           GES-SGV-VLCR IN GES-FLD NOT > ZEROES
           PERFORM ERR-GLS
           GO TO FIN-VAL-GES-SGV-PLCR.

           IF GES-SGV-PLCR IN GES-FLD > 100
               MOVE 'GAR'       TO MSG-COD-SIST
               MOVE '%>100'     TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.

      *>>>>
*% END
*% IF GES_COD_MVLC
      *<<<< GES_VCB_LIM_CDT

           IF ( GES-SGV-VLCR IN GES-FLD     > ZEROES AND
                GES-COD-MVLC IN GES-FLD NOT > SPACES ) OR
              ( GES-SGV-VLCR IN GES-FLD NOT > ZEROES AND
                GES-COD-MVLC IN GES-FLD     > SPACES )
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'GESVALVCBCDT' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GES-COD-MVLC.

           IF GES-COD-MVLC IN GES-FLD NOT > SPACES
               MOVE SPACES TO GES-COD-MVLC IN GES-FLD
               MOVE SPACES TO FRM-GLS-MVLC IN GES-FLD
               GO TO FIN-VAL-GES-COD-MVLC.

      *VAL-COD Valida codigo de tabla
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'VLR' TO TAB-COD-TTAB IN TAB.
           MOVE GES-COD-MVLC IN GES-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX' OR
              GES-COD-MVLC IN GES-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-MVLC IN GES-FLD
           ELSE
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-MVLC IN GES-FLD.

*% IF NOT PGM_VMS
      * Obtiene Codigo Valor de Cambio de Pesos Mediante CIC de la Moneda '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS-VARI.
*% END
      *>>>>
*% END
*% IF GES_SGV_VLCR
      *<<<< GES_VAL_LIM_CDT
           IF NOT ( GES-SGV-VLCR IN GES-FLD > ZEROES OR
                    GES-SGV-PLCR IN GES-FLD > ZEROES )
               MOVE 100 TO GES-SGV-PLCR IN GES-FLD
           ELSE

           IF GES-COD-MVLC IN GES-FLD = WSS-COD-PESO IN WSS-VARI
               MOVE GES-SGV-VLCR IN GES-FLD TO 
                    PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO
                    GES-SGV-VLCR IN GES-FLD.
      *>>>>
*% END
*% IF GES_COD_TVCC
      *<<<< GES_TIP_VCB_CDT

           IF GES-COD-TVCC IN GES-FLD NOT > SPACES
               MOVE SPACES TO GES-COD-TVCC IN GES-FLD
               MOVE SPACES TO FRM-GLS-TVCC IN GES-FLD
               GO TO FIN-VAL-GES-COD-TVCC.

      *VAL-MSC Valida indicador ( miscelaneo ) de tabla
           MOVE 'TAB' TO MSC-COD-SIST.
           MOVE 'TVAL' TO MSC-COD-TMSC IN MSC.
           MOVE GES-COD-TVCC IN GES-FLD TO MSC-COD-CMSC IN MSC.
           PERFORM VAL-IND.
           IF MSG-COD-MENS NOT = 'COD    NEX' AND
              GES-COD-TVCC IN GES-FLD > SPACES
               MOVE MSC-GLS-DESC IN MSC TO 
                    FRM-GLS-TVCC IN GES-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-TVCC IN GES-FLD.

      *>>>>
*% END
*% IF GES_COD_COPE
      *<<<< GES_COD_COPE

           IF GES-COD-COPE IN GES-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-COPE IN GES-FLD
               GO TO FIN-VAL-GES-COD-COPE.

           MOVE GES-COD-SIST IN GES-FLD TO TAB-GLS-ABRV IN TAB.    
           MOVE 'TAB'                   TO TAB-COD-SIST.
           MOVE 'TCR '                  TO TAB-COD-TTAB IN TAB.
           MOVE GES-COD-COPE IN GES-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS > SPACES
               IF MSG-COD-MENS NOT = 'COD    NEX'
                   MOVE 'TAB'          TO MSG-COD-SIST
                   MOVE 'CODTIOPNOSIS' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-GES-COD-COPE
               ELSE
                   MOVE SPACES TO FRM-GLS-COPE IN GES-FLD
                   GO TO FIN-VAL-GES-COD-COPE
           ELSE
                MOVE TAB-GLS-DESC IN TAB TO
                     FRM-GLS-COPE IN GES-FLD.

           MOVE GES-COD-SIST IN GES-FLD TO TAB-GLS-ABRV IN TAB.
      *>>>>
*% END
*% IF GES_COD_TOPE
      *<<<< GES_COD_TOPE
      *<<<< GES_TIP_OPE_CDT
           IF GES-COD-TOPE IN GES-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-TOPE IN GES-FLD
               GO TO FIN-VAL-GES-COD-TOPE.

           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'TIO' TO TAB-COD-TTAB IN TAB.
           MOVE GES-COD-TOPE IN GES-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS > SPACES
               IF MSG-COD-MENS NOT = 'COD    NEX'
                   MOVE 'TAB'          TO MSG-COD-SIST
                   MOVE 'CODTIOPNOSIS' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-GES-COD-TOPE
               ELSE
                   MOVE SPACES TO FRM-GLS-TOPE IN GES-FLD
                   GO TO FIN-VAL-GES-COD-TOPE
           ELSE
                MOVE TAB-GLS-DESC IN TAB TO
                     FRM-GLS-TOPE IN GES-FLD.

      *FLB CST  8-NOV-1993 
           MOVE TAB TO TIO.
      *>>>>
*% END
*% IF GES_COD_SOPE
      *<<<< GES_COD_SOPE
      *<<<< GES_STP_OPE_CDT
           IF GES-COD-SOPE IN GES-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-SOPE IN GES-FLD
               GO TO FIN-VAL-GES-COD-SOPE.

      *FLB CST  8-NOV-1993 
           IF TIO-GLS-SIST IN TIO = 'COL'
      *VAL-COD Valida EN TABLA AUX DE SISTEMA COL
               MOVE 'COL' TO TAB-COD-SIST
               MOVE 'AUX' TO TAB-COD-TTAB IN TAB
               MOVE GES-COD-TOPE IN GES-FLD TO WSS-COD-TOPE
               MOVE GES-COD-SOPE IN GES-FLD TO WSS-COD-SOPE
               MOVE WSS-COD-AGTA TO TAB-COD-CTAB IN TAB
               PERFORM VAL-COD
               IF MSG-COD-MENS = 'COD    NEX' OR
                  GES-COD-SOPE IN GES-FLD NOT > SPACES
                   MOVE SPACES TO FRM-GLS-SOPE IN GES-FLD
                   GO TO FIN-VAL-GES-COD-SOPE
               ELSE
                   MOVE TAB-GLS-DESC IN TAB TO
                        FRM-GLS-SOPE IN GES-FLD
                   GO TO FIN-VAL-GES-COD-SOPE.
      *FLB CST  8-NOV-1993 

      *VAL-COD Valida codigo de tabla
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
           MOVE GES-COD-TOPE IN GES-FLD TO WSS-COD-TOPE.
           MOVE GES-COD-SOPE IN GES-FLD TO WSS-COD-SOPE.
           MOVE WSS-COD-AGTA TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX' OR
               GES-COD-SOPE IN GES-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-SOPE IN GES-FLD
            ELSE
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-SOPE IN GES-FLD.
      *>>>>
*% END
*% IF GES_COD_VCMC
      *<<<< GES_VCB_CDT
           IF GES-COD-VCMC IN GES-FLD NOT > ZEROES
               MOVE ZEROES TO GES-COD-VCMC     IN GES-FLD 
               MOVE SPACES TO FRM-GLS-VCMC IN GES-FLD
               GO TO FIN-VAL-GES-COD-VCMC.

      *VAL-COD Valida codigo de tabla
           MOVE 'TAB'        TO TAB-COD-SIST.
           MOVE 'VLR'        TO TAB-COD-TTAB IN TAB.
           MOVE GES-COD-VCMC IN GES-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX' OR
              GES-COD-VCMC IN GES-FLD NOT > ZEROES
               MOVE SPACES TO FRM-GLS-VCMC IN GES-FLD
           ELSE
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-VCMC IN GES-FLD.
      *>>>>
*% END
*% IF GES_COD_DCRE
      *<<<< GES_COD_DST_CDT
           IF GES-COD-DCRE IN GES-FLD NOT > SPACES
               MOVE SPACES TO GES-COD-DCRE IN GES-FLD
               MOVE SPACES TO FRM-GLS-DCRE IN GES-FLD
               GO TO FIN-VAL-GES-COD-DCRE.
      *>>>>
*% END
*% IF GES_NUM_SBGL
      *<<<< GES_NUM_SBGL
      *RRM-INI 30-MAY-2002
      *1.- Verificar si es obligatorio ingresar Nro Solicitud BEE.
*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GDG-TIP-CGTA IN GES-FLD TO TAG-TIP-AGTA IN TAG.
           MOVE GDG-STP-CGTA IN GES-FLD TO TAG-STP-AGTA IN TAG.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GES-FLD TO TAG-COD-AGTA IN TAG.
*% END
           MOVE FIO-GET-KEY    TO FIO-CMND.                    
           PERFORM GAR-FIO-TAG.                                
           IF NOT FIO-STAT-OKS                                 
              MOVE 'TAG    NEX' TO MSG-COD-MENS                
              MOVE 'GAR' TO MSG-COD-SIST                       
              PERFORM GET-MSG                                  
              MOVE MSG-GLS-DESC TO FRM-MENS                    
              MOVE FRM-SUAR-MAL TO FRM-SUAR                    
              GO TO FIN-VAL-GES-NUM-SBGL.
           IF TAG-IND-EGSL IN TAG NOT = 'S'  AND                  
              GES-NUM-SBGL IN GES-FLD NOT > ZEROES
               GO TO FIN-VAL-GES-NUM-SBGL.

      *2.- Verifica si existe la Solicitud BEE ingresada.
           MOVE GES-NUM-SBGL IN GES-FLD TO GSL-KEY-IGSL IN GSL.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GSL.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'GSL    NEX'   TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GES-NUM-SBGL.

      *3.- Verificar si es posible Relacionar con la solicitud BEE.
           MOVE GSL-KEY-IGSL IN GSL     TO GSO-NUM-SBGL IN GSO.
           MOVE GES-CAI-GTIA IN GES-FLD TO GSO-CAI-GTIA IN GSO.
           MOVE GES-IIC-GTIA IN GES-FLD TO GSO-IIC-GTIA IN GSO.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GSO.               
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'GSO    NEX'   TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GES-NUM-SBGL.

      *RRM-INI 27-SEP-2002
      *    IF GSO-COD-ESGA IN GSO NOT = '05'
           IF (GSO-COD-ESGA IN GSO NOT = '05' AND SCR-CCPP = 'ING') OR
              (GSO-COD-ESGA IN GSO NOT = '10' AND SCR-CMND = 'MOD') OR
              (GSO-COD-ESGA IN GSO NOT = '11' AND SCR-CMND = 'MGA')
      *RRM-FIN 27-SEP-2002
               MOVE 'GAR'           TO MSG-COD-SIST
               MOVE 'GES/GSL NOREL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GES-NUM-SBGL.
      *RRM-FIN 30-MAY-2002 
      *>>>>
*% END
*% IF GES_IND_TDEU
      *<<<< GES_TIP_DEU
           IF GES-IND-TDEU IN GES-FLD NOT > SPACES
               MOVE SPACES TO GES-IND-TDEU IN GES-FLD
               GO TO FIN-VAL-GES-IND-TDEU.

           IF NOT ( GES-IND-TDEU IN GES-FLD = 'D' OR 'I' )
               MOVE 'GAR'         TO MSG-COD-SIST
               MOVE 'TDEU    D/I' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>>
*% END
*% IF VAL_CON_FLD_GES
      *<<<< VAL_CON_FLD_GES
*% IF FMT_CHI
      *<<<< FMT_CHI
           IF GES-IIC-IOPC IN GES-FLD = ZEROES AND
      *>>>>
*% ELSE
           IF GES-CIC-ICON IN GES-FLD = ZEROES AND
*% END
              GES-COD-TVCC IN GES-FLD = SPACES AND
              GES-COD-VCMC IN GES-FLD = ZEROES AND
*% IF GEN_BCI
      *<<<< GEN_BCI
              GES-COD-TOPE IN GES-FLD = SPACES AND
              GES-COD-SOPE IN GES-FLD = SPACES AND
      *>>>>
*% ELSE
              GES-COD-COPE IN GES-FLD = SPACES AND
*% END
              GES-COD-DCRE IN GES-FLD = SPACES AND
              GES-IND-TDEU IN GES-FLD = SPACES 
                 MOVE 'GAR' TO MSG-COD-SIST
                 MOVE 'GESVALFLDBLK' TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO FRM-MENS
                 MOVE FRM-SUAR-MAL TO FRM-SUAR
                 GO TO FIN-VAL-CON-FLD-GES.

      *>>>>
*% END
*% IF EOF
      *<<<< EOF BM
       BUS-COL SECTION.
       INI-BUS-COL.
      * LEE DOCUMENTO LEGAL DE CREDITO EN COL

*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GES-CAI-IOPC IN GES-FLD TO DLC-CAI-IOPC IN DLC.
           MOVE GES-IIC-IOPC IN GES-FLD TO DLC-IIC-IOPC IN DLC.
      *>>>>
*% ELSE
           MOVE GES-CIC-ICON IN GES-FLD TO DLC-CIC-ICON IN DLC.
           MOVE GES-CIC-IOPC IN GES-FLD TO DLC-CIC-IOPC IN DLC.
*% END
           MOVE GES-NUM-IDLC IN GES-FLD TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'DLC    NEX'   TO MSG-COD-MENS
               GO TO ERR-BUS-COL.

           IF DLC-VAL-SDLC IN DLC NOT > ZEROES
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'DLC SDLC=0'   TO MSG-COD-MENS
               GO TO ERR-BUS-COL.

           MOVE DLC-FEC-FMAV IN DLC TO GES-FEC-FVCR IN GES.
           MOVE GES-NUM-SVCR IN GES TO GES-NUM-SVCR IN GES-FLD.
           MOVE GES-NUM-AVCR IN GES TO GES-NUM-AVCR IN GES-FLD.
           MOVE GES-NUM-MVCR IN GES TO GES-NUM-MVCR IN GES-FLD.
           MOVE GES-NUM-DVCR IN GES TO GES-NUM-DVCR IN GES-FLD.
      *
*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GES-CAI-IOPC IN GES-FLD TO OPC-CAI-IOPC IN OPC.
           MOVE GES-IIC-IOPC IN GES-FLD TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'OPC    NEX'   TO MSG-COD-MENS
               GO TO ERR-BUS-COL.
      *>>>>
*% END
*% IF GEN_BCI
      *<<<< GEN_BCI
      *JRF-INI 29-JUL-2003
           MOVE OPC-COD-TOOC IN OPC TO GES-COD-TOPE IN GES-FLD.
           MOVE OPC-COD-AOOC IN OPC TO GES-COD-SOPE IN GES-FLD.
      *JRF-FIN 29-JUL-2003
      *>>>>
*% ELSE
      *<<<<
           MOVE OPC-COD-COOC IN OPC TO GES-COD-COPE IN GES-FLD.
      *>>>>
*% END
           MOVE OPC-COD-VCOC IN OPC TO GES-COD-VCMC IN GES-FLD.
*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE OPC-MSC-TVOC IN OPC TO GES-COD-TVCC IN GES-FLD.
      *>>>>
*% ELSE
           MOVE DLC-COD-TVCC IN DLC TO GES-COD-TVCC IN GES-FLD.
*% END
      *    MOVE OPC-COD-CDOC IN OPC TO GES-COD-DCRE IN GES-FLD.
           MOVE SPACES              TO GES-COD-DCRE IN GES-FLD.
           MOVE 'D'                 TO GES-IND-TDEU IN GES-FLD.
*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE DLC-NUM-SMAV IN DLC TO WSS-NUM-SAUX IN WSS-VARI.
           MOVE DLC-NUM-AMAV IN DLC TO WSS-NUM-AAUX IN WSS-VARI.
           MOVE DLC-NUM-MMAV IN DLC TO WSS-NUM-MAUX IN WSS-VARI.
           MOVE DLC-NUM-DMAV IN DLC TO WSS-NUM-DAUX IN WSS-VARI.
      *>>>>
*% ELSE
           MOVE OPC-NUM-SMAV IN OPC TO WSS-NUM-SAUX IN WSS-VARI.
           MOVE OPC-NUM-AMAV IN OPC TO WSS-NUM-AAUX IN WSS-VARI.
           MOVE OPC-NUM-MMAV IN OPC TO WSS-NUM-MAUX IN WSS-VARI.
           MOVE OPC-NUM-DMAV IN OPC TO WSS-NUM-DAUX IN WSS-VARI.
*% END
           MOVE WSS-FEC-FAUX IN WSS-VARI TO GES-FEC-FVCR IN GES-FLD.
           GO TO FIN-BUS-COL.
       ERR-BUS-COL.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE FRM-SUAR-MAL TO FRM-SUAR.
       FIN-BUS-COL.
           EXIT.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       VAL-DLC-IGUA SECTION.
       INI-VAL-DLC-IGUA.
      * DLC no debe repetirse
           PERFORM KEY-GES-GES.
           MOVE ZEROES TO GES-NUM-IGES IN GES.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GAR-FIO-GES.
       LUP-VAL-DLC-IGUA.
           IF NOT ( FIO-STAT-OKS AND
              GES-CAI-GTIA IN GES = GES-CAI-GTIA IN GES-FLD AND
              GES-IIC-GTIA IN GES = GES-IIC-GTIA IN GES-FLD )
               GO TO BRW-VAL-DLC-IGUA.

           IF GES-NUM-IGES IN GES = GES-NUM-IGES IN GES-FLD
               GO TO NXT-VAL-DLC-IGUA.
*% IF FMT_CHI
      *<<<< FMT_CHI
           IF GES-IIC-IOPC IN GES = GES-IIC-IOPC IN GES-FLD AND
              GES-CAI-IOPC IN GES = GES-CAI-IOPC IN GES-FLD AND
      *>>>>
*% ELSE
           IF GES-CIC-ICON IN GES = GES-CIC-ICON IN GES-FLD AND
              GES-CIC-IOPC IN GES = GES-CIC-IOPC IN GES-FLD AND
*% END
              GES-NUM-IDLC IN GES = GES-NUM-IDLC IN GES-FLD
               MOVE 'DLCREPETIDO' TO MSG-COD-MENS
               GO TO BRW-VAL-DLC-IGUA.

       NXT-VAL-DLC-IGUA.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GES.
           GO TO LUP-VAL-DLC-IGUA.
       BRW-VAL-DLC-IGUA.
           IF FIO-STAT-OKS
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM GAR-FIO-GES.
       FIN-VAL-DLC-IGUA.
           EXIT.
      *>>>>
*% END
