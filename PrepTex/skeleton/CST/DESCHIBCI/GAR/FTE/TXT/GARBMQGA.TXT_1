*% FRM = 'QGA'
*% REG = 'QGA'
*% FMT_CHI = TRUE
*% IF DBC_IDC_ICLI
      *<<<< DBC_IDC_ICLI
           IF MSG-COD-MENS > SPACES
               GO TO FIN-VAL-DBC-IDC-ICLI.

           IF DBC-IDC-ICLI IN QGA-FLD = 'M'
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'GDGNOMDDIR'   TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-DBC-IDC-ICLI.

           IF DBC-IDC-ICLI IN QGA-FLD NOT = ZEROES
               MOVE DBC-IDC-ICLI IN QGA-FLD TO DBC-IDC-ICLI IN DBC
               MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY
               MOVE FIO-GET-KEY     TO FIO-CMND
               PERFORM SGC-FIO-DBC
               MOVE FIO-STAT TO PGM-STAT-DBC
               IF NOT FIO-STAT-OKS
                   MOVE 'TAB'        TO MSG-COD-SIST
                   MOVE 'CLI    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE SPACES       TO DBC-GLS-NOMC IN QGA-FLD
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
               ELSE
                  MOVE DBC-CAI-ICLI IN DBC TO
                        CNE-DBC-CAI-ICLI
                   MOVE DBC-IIC-ICLI IN DBC TO
                        CNE-DBC-IIC-ICLI
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN TO DBC-GLS-NOMC IN QGA-FLD.
      *>>>>
*%END
*% IF DBC_VRF_ICLI
      *<<<< DBC_VRF_ICLI
           IF MSG-COD-MENS > SPACES 
               GO TO FIN-VAL-DBC-VRF-ICLI.

           IF DBC-IND-ICLI IN QGA-FLD = 'M'
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'GDGNOMDDIR'   TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-DBC-VRF-ICLI.

           IF DBC-NUM-ICLI IN QGA-FLD NOT = ZEROES
               MOVE DBC-NUM-ICLI IN QGA-FLD TO DBC-NUM-ICLI IN DBC
               MOVE DBC-IND-ICLI IN QGA-FLD TO DBC-IND-ICLI IN DBC
               MOVE DBC-GLS-ICLI IN QGA-FLD TO DBC-GLS-ICLI IN DBC
               MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY
               MOVE FIO-GET-KEY     TO FIO-CMND
               PERFORM SGC-FIO-DBC
               MOVE FIO-STAT TO PGM-STAT-DBC
               IF NOT FIO-STAT-OKS
                   MOVE 'TAB'        TO MSG-COD-SIST
                   MOVE 'CLI    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE SPACES       TO DBC-GLS-NOMC IN QGA-FLD
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
               ELSE
                   MOVE DBC-CAI-ICLI IN DBC TO
                        CNE-DBC-CAI-ICLI
                   MOVE DBC-IIC-ICLI IN DBC TO 
                        CNE-DBC-IIC-ICLI
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN TO DBC-GLS-NOMC IN QGA-FLD.
      *>>>>
*% END
*% IF INI_VAL_CON_KEY_QGA AND NOT PGM_MCP
      *<<<< INI_VAL_CON_KEY_QGA
           IF FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF8 OR
              FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6
               GO TO FIN-VAL-CON-KEY-QGA.
      *>>>>
*% END
*% IF FIN_PUT_GDG_QGA
      *<<<< FIN_PUT_GDG_QGA
           MOVE GDG-IND-EST1 IN GDG    TO CNE-GDG-IND-EST1.
           MOVE GDG-CIC-EJOR IN GDG    TO CNE-GDG-CIC-EJOR.
           MOVE GDG-COD-LGTA IN GDG    TO CNE-GDG-COD-LGTA.

      *BUS-USR busca usuario en tablas
           IF CNE-GDG-CIC-EJOR > SPACES
               MOVE CNE-GDG-CIC-EJOR TO USR-COD-USER IN USR
               PERFORM BUS-USR
               MOVE USR-GLS-DESC IN USR TO FRM-GLS-EJOR IN QGA-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-EJOR IN QGA-FLD.

      *BUS-TAB BUSCA GLOSA DE CODIGO EN TABLA
           IF CNE-GDG-IND-EST1  > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'ES1' TO TAB-COD-TTAB IN TAB
               MOVE CNE-GDG-IND-EST1 TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO
                    FRM-GLS-EST1 IN QGA-FLD.
      *CGL-INI  23-SEP-2003 15:12:31 
      *BUS-TAB busca glosa de codigo en tabla
           IF CNE-GDG-COD-LGTA > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'LIM ' TO TAB-COD-TTAB IN TAB
               MOVE CNE-GDG-COD-LGTA TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO
                    FRM-GLS-LGTA IN QGA-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-LGTA IN QGA-FLD.
      *CGL-FIN  23-SEP-2003 15:12:54 
*% VALIDA = FALSE
*% FINPARRAFO = 'FIN-PUT-GDG-QGA'
      *BUS-TAB Busca codigo de tabla
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
           MOVE SPACES TO TAB-COD-CTAB IN TAB.

*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GDG-TIP-CGTA IN QGA-FLD TO TAG-TIP-AGTA IN TAG.
           MOVE GDG-STP-CGTA IN QGA-FLD TO TAG-STP-AGTA IN TAG.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN QGA-FLD TO TAG-COD-AGTA IN TAG.
*% END
           MOVE TAG-COD-AGTA IN TAG     TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS = SPACES
      *MHM-INI 23-OCT-2003
      *         MOVE TAB-GLS-DESC IN TAB TO
      *              FRM-GLS-CGTA IN QGA-FLD
      *     ELSE
      *         MOVE SPACES TO FRM-GLS-CGTA IN QGA-FLD.
               MOVE TAB-GLS-DESC IN TAB     TO WSS-GLS-SOPE IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-SOPE IN WSS-VARI.

           MOVE 'TAB'                   TO TAB-COD-SIST.
           MOVE 'TIO'                   TO TAB-COD-TTAB IN TAB.
           MOVE SPACES                  TO TAB-COD-CTAB IN TAB.
           MOVE GDG-TIP-CGTA IN QGA-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS = SPACES
               MOVE TAB-GLS-DESC IN TAB     TO WSS-GLS-TOPE IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-TOPE IN WSS-VARI.
               
           MOVE WSS-GLS-CGTA TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO FRM-GLS-CGTA IN QGA-FLD.
      *MHM-FIN 23-OCT-2003

*% EXA_VEN_TSN = TRUE
      * Busca Glosa Tabla Real/no Real
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GAR-FIO-TAG.
           MOVE FIO-STAT TO PGM-STAT-TAG.
           IF NOT FIO-STAT-OKS
                MOVE 'TAG    NEX' TO MSG-COD-MENS
                MOVE 'GAR' TO MSG-COD-SIST
                PERFORM GET-MSG
           ELSE
                MOVE SPACES TO MSG-COD-MENS
                MOVE 'GAR' TO TAB-COD-SIST
                MOVE 'RAL' TO TAB-COD-TTAB IN TAB
                MOVE TAG-IND-TREA IN TAG TO 
                     TAB-COD-CTAB IN TAB
                PERFORM BUS-TAB
                IF MSG-COD-MENS = SPACES
                    MOVE TAB-GLS-DESC IN TAB TO 
                         FRM-GLS-TREA IN QGA-FLD
                ELSE
                    MOVE SPACES TO FRM-GLS-TREA IN QGA-FLD.

      *BUS-FEC Obtiene fecha de vencto. del credito cuando corresponde

           MOVE 'Z'  TO WSS-COD-PACR-N IN WSS-VARI.            
                                                         
           MOVE ZEROES TO WSS-FEC-FTER IN WSS-VARI.            
                                                         
           MOVE GDG-CIC-GTIA IN GDG TO GES-CIC-GTIA IN GES     
           MOVE ZEROES              TO GES-NUM-IGES IN GES     
           MOVE FIO-GET-NLS TO FIO-CMND.                       
           PERFORM GAR-FIO-GES.                                
           IF NOT ( FIO-STAT-OKS  AND                          
                    GES-CIC-GTIA IN GES = GDG-CIC-GTIA IN GDG) 
              MOVE '00'   TO FIO-STAT                          
              MOVE ZEROES TO FRM-NUM-DVEN IN QGA-FLD           
              MOVE ZEROES TO FRM-NUM-MVEN IN QGA-FLD           
              MOVE ZEROES TO FRM-NUM-SVEN IN QGA-FLD           
              MOVE ZEROES TO FRM-NUM-AVEN IN QGA-FLD           
              GO TO LUP-MENSAJE.                               
                                                         
       LUP-GES.                                                
           IF NOT ( FIO-STAT-OKS  AND                          
                    GES-CIC-GTIA IN GES = GDG-CIC-GTIA IN GDG) 
              MOVE '00'   TO FIO-STAT                          
              MOVE WSS-NUM-DTER IN WSS-VARI TO FRM-NUM-DVEN IN QGA-FLD
              MOVE WSS-NUM-MTER IN WSS-VARI TO FRM-NUM-MVEN IN QGA-FLD
              MOVE WSS-NUM-STER IN WSS-VARI TO FRM-NUM-SVEN IN QGA-FLD
              MOVE WSS-NUM-ATER IN WSS-VARI TO FRM-NUM-AVEN IN QGA-FLD
              GO TO LUP-MENSAJE.                                      

           IF GES-FEC-FVCR IN GES > WSS-FEC-FTER IN WSS-VARI AND      
              GES-IND-SCRE IN GES = 'S'  
              MOVE GES-FEC-FVCR IN GES TO WSS-FEC-FTER IN WSS-VARI.   
                                                                
           MOVE FIO-GET-NXT TO FIO-CMND.                              
           PERFORM GAR-FIO-GES.                                       
           GO TO LUP-GES.                                             
                                                                
       LUP-MENSAJE.                                                   
           PERFORM GET-FHOY.                                          
           IF GDG-FEC-FVTO IN GDG > HOY-FHOY                          
              GO TO FIN-PUT-GDG-QGA.

           MOVE 'GAR'        TO MSG-COD-SIST.                         
           MOVE 'FECVTO<HOY' TO MSG-COD-MENS.                         
           PERFORM GET-MSG.                                           
           MOVE MSG-GLS-DESC TO FRM-MEN1.
      *>>>>
*% END
*% IF FIN_PUT_DBC_QGA
      *<<<< FIN_PUT_DBC_QGA
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO DBC-GLS-NOMC IN QGA-FLD.

*% IF NOT PGM_BFA
      *<<<< NOT PGM_BFA
      * BUSCA FIANZA, ESTO NO ES GENERICO
*% LEE_HOY = TRUE
           PERFORM GET-FHOY.
           MOVE DBC-CIC-ICLI IN DBC TO FIA-CIC-ICLI IN FIA.        
           MOVE SPACES              TO FIA-CIC-ICFS IN FIA.        
           MOVE 'FIA-GLS-ICYF'      TO FIO-AKEY.                   
           MOVE FIO-GET-NLS TO FIO-CMND.                           
           PERFORM DEU-FIO-FIA.                                    
           IF NOT ( FIO-STAT-OKS AND                               
                    FIA-CIC-ICLI IN FIA = DBC-CIC-ICLI IN DBC )    
               GO TO FIN-BUS-FIA.                                  
                                                                   
       LUP-BUS-FIA.                                                
           IF FIA-MSC-STAT IN FIA NOT = 'S'                        
               GO TO NXT-BUS-FIA.                                  
                                                                   
           IF FIA-FEC-FALZ IN FIA > ZEROES AND                     
              FRM-GLS-EFIA IN QGA-FLD NOT > SPACES                 
               MOVE 'FIANZA ALZADA' TO FRM-GLS-EFIA IN QGA-FLD     
               GO TO NXT-BUS-FIA.                                  
                                                                   
           IF FIA-FEC-FVEN IN FIA > HOY-FHOY OR                    
              FIA-FEC-FVEN IN FIA NOT > ZEROES                     
               MOVE 'EXISTE FIANZA' TO FRM-GLS-EFIA IN QGA-FLD     
               GO TO FIN-BUS-FIA.                                  
                                                                   
           MOVE 'FIANZA VENCIDA' TO FRM-GLS-EFIA IN QGA-FLD.       
                                                                   
      *Lee la siguiente fianza                                     
       NXT-BUS-FIA.                                                
           MOVE 'FIA-GLS-ICYF' TO FIO-AKEY.                        
           MOVE FIO-GET-NXT TO FIO-CMND.                           
           PERFORM DEU-FIO-FIA.                                    
           IF FIO-STAT-OKS AND                                     
              FIA-CIC-ICLI IN FIA = DBC-CIC-ICLI IN DBC            
               IF FIA-FEC-FALZ IN FIA > ZEROES                     
                   GO TO NXT-BUS-FIA                               
               ELSE                                                
                   GO TO LUP-BUS-FIA.                              
       FIN-BUS-FIA.                                                
      *>>>>
*% END
      *>>>>
*% END
*% IF INI_PUT_GVT_QGA
      *<<<< INI_PUT_GVT_QGA
           IF PGM-STAT-GDG-OKS AND 
              GDG-IND-EGVT IN GDG = 'S'
               MOVE GDG-CAI-GTIA IN GDG TO GVT-CAI-GTIA IN GVT
               MOVE GDG-IIC-GTIA IN GDG TO GVT-IIC-GTIA IN GVT
               MOVE GDG-COD-TSCN IN GDG TO GVT-COD-TASN IN GVT
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GAR-FIO-GVT
               MOVE FIO-STAT TO PGM-STAT-GVT
               IF NOT FIO-STAT-OKS
                   MOVE 'GAR'        TO MSG-COD-SIST
                   MOVE 'GVT    NEX' TO MSG-COD-MENS
                   GO TO FIN-PUT-GVT-QGA
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE '23' TO PGM-STAT-GVT.

      *>>>>
*% END
*% IF FIN_PUT_GVT_QGA
      *<<<< FIN_PUT_GVT_QGA
      *     MOVE ZEROES TO GVT-SGV-VGAS IN GVT
      *                    GVT-SGV-VGAS IN QGA-FLD.

           IF NOT PGM-STAT-TAG-OKS
               GO TO FIN-PUT-GVT-QGA.

      * SE DETERMINA SI LA TASACION ESTA VENCIDA O NO

*% FIN_EXA_VTO_TAS = 'FIN-EXA-VEN-TSN'
*% FEC_FVTA = 'WSS-FEC-FVTA'
*% FEC_DVTA = 'WSS-FEC-DVTA'
*% FEC_MVTA = 'WSS-FEC-MVTA'
*% FEC_AVTA = 'WSS-FEC-AVTA'
*% FEC_SVTA = 'WSS-FEC-SVTA'
*% FEC_FCTA = 'HOY-FHOY'
*% LEE_HOY = TRUE
*%!      * Se determina si la tasacion esta vencida o no

           MOVE WSS-NO-EXA-VENC TO WSS-IND-EXAV.
      * Excluye los Subtipos de Garantia que no requieren Tasacion Efectiva
           IF TAG-NUM-PVTS IN TAG NOT > ZEROES
               GO TO FIN-EXA-VEN-TSN.

      * iNCLUIRcluye los Creditos Hipotecarios.
        
           MOVE GDG-CAI-GTIA IN GDG TO GES-CAI-GTIA IN GES.
           MOVE GDG-IIC-GTIA IN GDG TO GES-IIC-GTIA IN GES.
            MOVE ZEROES              TO GES-NUM-IGES IN GES.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GAR-FIO-GES.
           IF NOT FIO-STAT-OKS OR
              GDG-CAI-GTIA IN GDG NOT = GES-CAI-GTIA IN GES OR
              GDG-IIC-GTIA IN GDG NOT = GES-IIC-GTIA IN GES
               MOVE SPACES TO GES
               MOVE ZEROES TO GES-IIC-GTIA IN GES
                              GES-FEC-FVCR IN GES
                              GES-NUM-IGES IN GES
               IF FIO-STAT-OKS
                   MOVE FIO-END-BRW TO FIO-CMND
                   PERFORM GAR-FIO-GES
               ELSE
                   NEXT SENTENCE
           ELSE 
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM GAR-FIO-GES
               IF GES-COD-SIST IN GES > SPACES
                   MOVE 'TAB'                  TO TAB-COD-SIST
                   MOVE 'SIS'                  TO TAB-COD-TTAB IN TAB
                   MOVE GES-COD-SIST IN GES TO TAB-COD-CTAB IN TAB
                   PERFORM BUS-TAB
                   IF MSG-COD-MENS = SPACES AND TAB-CIC-CTAB = 'HIP'
                       GO TO FIN-EXA-VEN-TSN.
      * FIN-MODIFICACION BANAMEX

           MOVE WSS-SI-EXA-VENC TO WSS-IND-EXAV.
           PERFORM GET-FHOY.
           IF TAG-COD-TPVT IN TAG = 'D'
              MOVE FEC-SUM-DIA TO FEC-CMND
              MOVE TAG-NUM-PVTS IN TAG TO FEC-NDIA
           ELSE
           IF TAG-COD-TPVT IN TAG = 'M'
              MOVE FEC-SUM-MES TO FEC-CMND
              MOVE TAG-NUM-PVTS IN TAG TO FEC-NMES
           ELSE
           IF TAG-COD-TPVT IN TAG = 'A'
              MOVE FEC-SUM-ANO TO FEC-CMND
              MOVE TAG-NUM-PVTS IN TAG TO FEC-NANO.

           MOVE GVT-FEC-FTSN IN GVT TO FEC-FVLD.
           MOVE FEC-DVLD TO FEC-ITM1.
           MOVE FEC-MVLD TO FEC-ITM2.
           MOVE FEC-AVLD TO FEC-ITM4.
           MOVE FEC-SVLD TO FEC-ITM3.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           PERFORM CAL-FEC.

           IF MSG-COD-MENS = SPACES
               MOVE FEC-ITM1 TO WSS-FEC-DVTA IN WSS-VARI
               MOVE FEC-ITM2 TO WSS-FEC-MVTA IN WSS-VARI
               MOVE FEC-ITM4 TO WSS-FEC-AVTA IN WSS-VARI
               MOVE FEC-ITM3 TO WSS-FEC-SVTA IN WSS-VARI
           ELSE
               GO TO FIN-EXA-VEN-TSN.

      * Tasacion Vencida
           IF WSS-FEC-FVTA IN WSS-VARI > HOY-FHOY
               GO TO FIN-EXA-VEN-TSN.

           MOVE 'GAR'        TO MSG-COD-SIST.
           MOVE 'FECTSN<HOY' TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MEN1.
       FIN-EXA-VEN-TSN.

      *>>>>
*% END
*% IF INI_PUT_GDO_QGA
      *<<<< INI_PUT_GDO_QGA
           IF PGM-STAT-GDG-OKS AND 
              GDG-IND-EGDO IN GDG = 'S'
               MOVE GDG-CAI-GTIA IN GDG TO GDO-CAI-GTIA IN GDO
               MOVE GDG-IIC-GTIA IN GDG TO GDO-IIC-GTIA IN GDO
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GAR-FIO-GDO
               MOVE FIO-STAT TO PGM-STAT-GDO
               IF NOT FIO-STAT-OKS
                   MOVE 'GAR'        TO MSG-COD-SIST
                   MOVE 'GDO    NEX' TO MSG-COD-MENS
                   GO TO FIN-PUT-GDO-QGA
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE '23' TO PGM-STAT-GDO.
      *>>>>
*% END
*% IF FIN_PUT_GDO_QGA
      *<<<< FIN_PUT_GDO_QGA
*% VALIDA = FALSE
      *BUS-TAB Busca codigo de tabla
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE GDO-COD-TIEM IN QGA-FLD TO TAB-COD-TTAB IN TAB.

           MOVE GDO-COD-INEM IN QGA-FLD TO WSS-CIV-EMI.
           MOVE GDO-COD-SIEM IN QGA-FLD TO WSS-SIV-EMI.
           MOVE WSS-CIV-SIV   TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS = SPACES
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-IEMI IN QGA-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-IEMI IN QGA-FLD.
           PERFORM VLR-DAP.

           MOVE GVT-SGV-VCTS IN GVT TO GVT-SGV-VCTS IN QGA-FLD
           MOVE ZEROES              TO GVT-SGV-LTSN IN QGA-FLD
           MOVE GVT-SGV-VPND IN GVT TO GVT-SGV-VPND IN QGA-FLD.
      *>>>>
*% END
*% IF INI_PUT_GLE_QGA
      *<<<< INI_PUT_GLE_QGA

           IF PGM-STAT-GDG-OKS AND 
              GDG-IND-EGLE IN GDG = 'S'
               MOVE GDG-CAI-GTIA IN GDG TO GLE-CAI-GTIA IN GLE
               MOVE GDG-IIC-GTIA IN GDG TO GLE-IIC-GTIA IN GLE
               MOVE ZEROES              TO GLE-COD-PACR IN GLE
               MOVE FIO-GET-NLS TO FIO-CMND                   
               PERFORM GAR-FIO-GLE
               MOVE FIO-STAT TO PGM-STAT-GLE
               IF NOT FIO-STAT-OKS
                   MOVE 'GAR'        TO MSG-COD-SIST
                   MOVE 'GLE    NEX' TO MSG-COD-MENS
                   GO TO FIN-PUT-GLE-QGA
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE '23' TO PGM-STAT-GLE.

      *>>>>
*% END
*% IF FIN_PUT_GLE_QGA
      *<<<< FIN_PUT_GLE_QGA
           MOVE GLE-COD-REGI IN GLE TO CNE-GLE-COD-REGI.
      *BUS-TAB busca glosa de codigo en tabla
           IF CNE-GLE-COD-REGI > SPACES
               MOVE 'GAR'           TO TAB-COD-SIST
               MOVE 'REG'           TO TAB-COD-TTAB IN TAB
               MOVE CNE-GLE-COD-REGI TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-REGI IN QGA-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-REGI IN QGA-FLD.
      *>>>>
*% END
*% IF INI_PUT_GSE_QGA
      *<<<< INI_PUT_GSE_QGA

           IF NOT (PGM-STAT-GDG-OKS AND GDG-IND-EGSE IN GDG = 'S')
              MOVE '23' TO PGM-STAT-GSE                           
              GO TO FIN-GSE-QGA.                                  
                                                            
                                                            
           MOVE 99999999      TO WSS-FEC-FINI IN WSS-VARI.        
           MOVE ZEROES        TO WSS-FEC-FTER IN WSS-VARI.        
                                                            
           MOVE GDG-CAI-GTIA IN GDG TO GSE-CAI-GTIA IN GSE.       
           MOVE GDG-IIC-GTIA IN GDG TO GSE-IIC-GTIA IN GSE.       
           MOVE ZEROES              TO GSE-NUM-IGSE IN GSE.       
           MOVE FIO-GET-NLS TO FIO-CMND                           
           PERFORM GAR-FIO-GSE                                    
           MOVE FIO-STAT TO PGM-STAT-GSE                          
           IF NOT ( FIO-STAT-OKS                              AND 
                    GDG-CAI-GTIA IN GDG = GSE-CAI-GTIA IN GSE AND 
                    GDG-IIC-GTIA IN GDG = GSE-IIC-GTIA IN GSE    )
              MOVE 'GAR'        TO MSG-COD-SIST                   
              MOVE 'GSE    NEX' TO MSG-COD-MENS                   
              GO TO FIN-PUT-GSE-QGA.                              
       LUP-GSE-QGA.                                               
           IF NOT ( FIO-STAT-OKS                              AND 
                    GDG-CAI-GTIA IN GDG = GSE-CAI-GTIA IN GSE AND   
                    GDG-IIC-GTIA IN GDG = GSE-IIC-GTIA IN GSE    )  
              MOVE WSS-FEC-FINI IN WSS-VARI TO GSE-FEC-FVSG IN GSE  
              MOVE WSS-FEC-FTER IN WSS-VARI TO GSE-FEC-FVTS IN GSE  
              MOVE '00'  TO FIO-STAT                                
              GO TO FIN-GSE-QGA.                                    
                                                              
           IF GSE-FEC-FVSG IN GSE < WSS-FEC-FINI IN WSS-VARI       
              MOVE GSE-FEC-FVSG IN GSE TO WSS-FEC-FINI IN WSS-VARI.
                                                              
           IF GSE-FEC-FVTS IN GSE > WSS-FEC-FTER IN WSS-VARI       
              MOVE GSE-FEC-FVTS IN GSE TO WSS-FEC-FTER IN WSS-VARI.
                                                              
           MOVE FIO-GET-NXT TO FIO-CMND.                           
           PERFORM GAR-FIO-GSE.                                    
           GO TO LUP-GSE-QGA.                                      
                                                              
       FIN-GSE-QGA.                                                 
      *>>>>
*% END
*% IF FIN_PUT_GSE_QGA
      *<<<< FIN_PUT_GSE_QGA
      * SE DETERMINA SI EL SEGURO ESTA VENCIDO O NO

*% FIN_EXA_VTO_SEG = 'FIN-EXA-VEN-SEG'
*% FEC_FCSE = 'HOY-FHOY'
*% VLR_CRE  = TRUE
*% LEE_GSE  = FALSE

      * Excluye los Creditos Hipotecarios
           IF WSS-IND-EXAV = WSS-NO-EXA-VENC 
               GO TO FIN-EXA-VEN-SEG.

      * Seguro Vigente
           IF GSE-FEC-FVTS IN GSE > HOY-FHOY
               GO TO FIN-EXA-VEN-SEG.

           MOVE 'SEGURO VENCIDO' TO FRM-MEN2.

       FIN-EXA-VEN-SEG.
      *>>>>
*% END
*% IF INI_PUT_GUB_QGA
      *<<<< INI_PUT_GUB_QGA
           IF PGM-STAT-GDG-OKS AND 
              GDG-IND-EGUB IN GDG = 'S'
               MOVE GDG-CAI-GTIA IN GDG TO GUB-CAI-GTIA IN GUB
               MOVE GDG-IIC-GTIA IN GDG TO GUB-IIC-GTIA IN GUB
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GAR-FIO-GUB
               MOVE FIO-STAT TO PGM-STAT-GUB
               IF NOT FIO-STAT-OKS
                   MOVE 'GAR'        TO MSG-COD-SIST
                   MOVE 'GUB    NEX' TO MSG-COD-MENS
                   GO TO FIN-PUT-GUB-QGA
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE '23' TO PGM-STAT-GUB.
      *>>>>
*% END
*% IF FIN_PUT_ALL_QGA
      *<<<< FIN_PUT_ALL_QGA
      *MHM-INI 2-OCT-2003
           PERFORM PUT-GLE-QGA.
           IF FRM-MENS = SPACES AND MSG-COD-MENS > SPACES
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-PUT-ALL-QGA.
      *MHM-FIN 2-OCT-2003

           PERFORM PUT-GDO-QGA.
           IF FRM-MENS = SPACES AND MSG-COD-MENS > SPACES
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-PUT-ALL-QGA.

      * La valorizacion de garantias especificas debe hacerse aqui, pues debe 
      * Haberse calculado previa y eventualmente el valor del deposito a
      * Plazo propio en garantia, lo que se hace en put-gdo

      * OBTIENE CIC DE CODIGO GARANTIA ESPECIFICA
           MOVE 'GAR'          TO FIO-SIST.
           MOVE 'LIM'          TO TAB-CIC-TTAB IN TAB.
           MOVE 'E'            TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'CICESP  NEX'  TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-PUT-ALL-QGA.

           IF GDG-COD-LGTA IN GDG NOT = TAB-COD-CTAB IN TAB
               GO TO FIN-PUT-ALL-QGA.

           MOVE 'TAB'          TO FIO-SIST.                     
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.          
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.          
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.                     
           MOVE FIO-GET-KEY    TO FIO-CMND.                     
           PERFORM GNS-FIO-TAB.                                 
           IF NOT FIO-STAT-OKS                                  
               MOVE 'TAB'          TO MSG-COD-SIST              
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS              
               PERFORM GET-MSG                                  
               MOVE MSG-GLS-DESC   TO FRM-MENS                  
               GO TO FIN-PUT-ALL-QGA                            
           ELSE                                                 
           MOVE TAB-COD-CTAB IN TAB TO VCR-COD-PESO IN VCR-VARI.

      * Garantia especifica, valoriza los creditos correspondientes
           MOVE ZEROES TO GVT-SGV-VCTS IN QGA-FLD.
           MOVE ZEROES TO GVT-SGV-LTSN IN QGA-FLD.
           MOVE ZEROES TO GVT-SGV-VPND IN QGA-FLD.

           MOVE DBC-KEY-IDBC IN DBC TO DBC-KEY-IDBC IN VCR-VARI.
           MOVE GDG-CAI-GTIA IN GDG TO VCR-CAI-GTIA IN VCR-VARI.
           MOVE GDG-IIC-GTIA IN GDG TO VCR-IIC-GTIA IN VCR-VARI.
           MOVE GDG-COD-VCAM IN GDG TO VCR-COD-VCAM IN VCR-VARI.
*% IF PGM_MVS OR PGM_DOS
      *<<<< PGM_MVS OR PGM_DOS
      * Obtiene codigo valor de cambio de pesos mediante cic de la moneda '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-PUT-ALL-QGA.
           MOVE TAB-COD-CTAB IN TAB TO VCR-COD-PESO IN VCR-VARI.
      *>>>>
*% END
           PERFORM GAR-PRO-VCR.
      *MHM-INI 2-OCT-2003
           IF VCR-COD-MENS > SPACES
               MOVE VCR-COD-MENS TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-PUT-ALL-QGA.
      *MHM-FIN 2-OCT-2003

           IF FRM-MENS = SPACES AND MSG-COD-MENS > SPACES
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-PUT-ALL-QGA.

           MOVE GVT-SGV-VCTS IN GVT TO GVT-SGV-VCTS IN QGA-FLD.
           MOVE GVT-SGV-LTSN IN GVT TO GVT-SGV-LTSN IN QGA-FLD.
           MOVE GVT-SGV-VPND IN GVT TO GVT-SGV-VPND IN QGA-FLD.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      *MHM-INI 2-OCT-2003
       PUT-GLE-QGA SECTION.
       INI-PUT-GLE-QGA.
           IF PGM-STAT-GDG-OKS AND
              GDG-IND-EGLE IN GDG = 'S'
               MOVE GDG-CAI-GTIA IN GDG TO GLE-CAI-GTIA IN GLE
               MOVE GDG-IIC-GTIA IN GDG TO GLE-IIC-GTIA IN GLE
               MOVE GDG-COD-GGTA IN GDG TO GLE-COD-PACR IN GLE        
               MOVE FIO-GET-KEY TO FIO-CMND                           
               PERFORM GAR-FIO-GLE                                    
               MOVE FIO-STAT TO PGM-STAT-GLE                          
               IF NOT FIO-STAT-OKS                             
                   MOVE '23'         TO PGM-STAT-GLE                  
                   MOVE 'GAR'        TO MSG-COD-SIST
                   MOVE 'GLE    NEX' TO MSG-COD-MENS
                   GO TO FIN-PUT-GLE-QGA
               ELSE
                   MOVE '00' TO PGM-STAT-GLE
           ELSE
               MOVE '23' TO PGM-STAT-GLE.

           IF PGM-STAT-GLE-NUL
               GO TO FIN-PUT-GLE-QGA.

           IF NOT PGM-STAT-GLE-OKS
               PERFORM CLR-GLE-QGA
               GO TO FIN-PUT-GLE-QGA.

      *BUS-TAB busca glosa de codigo en tabla
           IF GLE-COD-REGI IN GLE > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'REG ' TO TAB-COD-TTAB IN TAB
               MOVE GLE-COD-REGI IN GLE TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-REGI IN QGA-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-REGI IN QGA-FLD.

       FIN-PUT-GLE-QGA.
           EXIT.

       CLR-GLE-QGA SECTION.
       INI-CLR-GLE-QGA.
           MOVE SPACES TO FRM-GLS-REGI IN QGA-FLD.
       FIN-CLR-GLE-QGA.
           EXIT.

      *MHM-FIN 2-OCT-2003
      *PVG INI 9-JUL-1996
       PUT-GDO-QGA SECTION.
       INI-PUT-GDO-QGA.
           IF PGM-STAT-GDG-OKS AND 
              GDG-IND-EGDO IN GDG = 'S'
               MOVE GDG-CAI-GTIA IN GDG TO GDO-CAI-GTIA IN GDO
               MOVE GDG-IIC-GTIA IN GDG TO GDO-IIC-GTIA IN GDO
               MOVE ZEROES              TO GDO-NUM-IGDO IN GDO        
               MOVE FIO-GET-NLS TO FIO-CMND                           
               PERFORM GAR-FIO-GDO                                    
               MOVE FIO-STAT TO PGM-STAT-GDO                          
               IF NOT ( FIO-STAT-OKS AND                              
                       GDG-CAI-GTIA IN GDG = GDO-CAI-GTIA IN GDO AND 
                       GDG-IIC-GTIA IN GDG = GDO-IIC-GTIA IN GDO    )
                   MOVE '23'         TO PGM-STAT-GDO                  
                   MOVE 'GAR'        TO MSG-COD-SIST
                   MOVE 'GDO    NEX' TO MSG-COD-MENS
                   GO TO FIN-PUT-GDO-QGA
               ELSE
                   MOVE '00' TO PGM-STAT-GDO
           ELSE
               MOVE '23' TO PGM-STAT-GDO.

           IF PGM-STAT-GDO-NUL
               GO TO FIN-PUT-GDO-QGA.

           IF NOT PGM-STAT-GDO-OKS
               PERFORM CLR-GDO-QGA
               GO TO FIN-PUT-GDO-QGA.

           MOVE GDO-COD-TIEM IN GDO TO CNE-GDO-COD-TIEM.
           MOVE GDO-COD-INEM IN GDO TO CNE-GDO-COD-INEM.
           MOVE GDO-COD-SIEM IN GDO TO CNE-GDO-COD-SIEM.


      *BUS-TAB Busca codigo de tabla
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE CNE-GDO-COD-TIEM TO TAB-COD-TTAB IN TAB.
           MOVE SPACES TO TAB-COD-CTAB IN TAB.
           MOVE CNE-GDO-COD-INEM TO WSS-CIV-EMI.
           MOVE CNE-GDO-COD-SIEM TO WSS-SIV-EMI.
           MOVE WSS-CIV-SIV TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS NOT > SPACES                    
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-IEMI IN QGA-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-IEMI IN QGA-FLD.

      * Valoriza documentos desde otro sistema
           MOVE SPACES TO INT-TIPT.  
           PERFORM VLR-DAP.          
           IF INT-TIPT > SPACES      
            MOVE GVT-SGV-VCTS IN GVT TO GVT-SGV-VCTS IN QGA-FLD
            MOVE GVT-SGV-LTSN IN GVT TO GVT-SGV-LTSN IN QGA-FLD
            MOVE GVT-SGV-VPND IN GVT TO GVT-SGV-VPND IN QGA-FLD.

       FIN-PUT-GDO-QGA.
           EXIT.

       CLR-GDO-QGA SECTION.
       INI-CLR-GDO-QGA.
           MOVE SPACES TO CNE-GDO-COD-TIEM.
           MOVE SPACES TO CNE-GDO-COD-INEM.
           MOVE SPACES TO CNE-GDO-COD-SIEM.
       FIN-CLR-GDO-QGA.
           EXIT.
      *>>>>
*% END
