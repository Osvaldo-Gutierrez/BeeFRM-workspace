       GAR-PRO-IDP SECTION.
       INI-GAR-PRO-IDP.

      * MHM-INI 22-SEP-2003
      * Busca Deposito en Sistema DAP
           MOVE FRM-CAI-IOPD IN GDG-FLD TO OPD-CAI-IOPD IN OPD.
           MOVE FRM-IIC-IOPD IN GDG-FLD TO OPD-IIC-IOPD IN OPD.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'OPD    NEX'   TO MSG-COD-MENS
               GO TO ERR-GAR-PRO-IDP.
      * MHM-FIN 22-SEP-2003


      *     MOVE GDG-COD-CGTA IN GDG-FLD TO IDP-COD-CGTA IN IDP-VARI.
      * MHM-INI 22-SEP-2003
      *     MOVE GDG-TIP-CGTA IN GDG-FLD TO WSS-TIP-CGTA IN WSS-VARI.
      *     MOVE GDG-STP-CGTA IN GDG-FLD TO WSS-STP-CGTA IN WSS-VARI.
      *     MOVE WSS-COD-CGTA IN WSS-VARI TO IDP-COD-CGTA IN IDP-VARI.
           MOVE GDG-TIP-CGTA IN GDG-FLD TO IDP-COD-TOPE IN IDP-VARI.
           MOVE GDG-STP-CGTA IN GDG-FLD TO IDP-COD-SOPE IN IDP-VARI.
      * MHM-FIN 22-SEP-2003
           MOVE GAR-SGV-PPCT IN CMA-VARI TO IDP-SGV-PPCT IN IDP-VARI.
           MOVE GAR-SGV-PAJU IN CMA-VARI TO IDP-SGV-PAJU IN IDP-VARI.


           MOVE GDG-CAI-GTIA IN GDG-FLD TO IDP-CAI-GTIA IN IDP-VARI.
           MOVE GDG-IIC-GTIA IN GDG-FLD TO IDP-IIC-GTIA IN IDP-VARI.
      *     MOVE FRM-IIC-IOPD IN GDG-FLD TO FRM-IIC-IOPD IN IDP-VARI.
      * MHM-INI 22-SEP-2003
           MOVE FRM-CAI-IOPD IN GDG-FLD TO FRM-CAI-IOPD IN IDP-VARI.
           MOVE FRM-IIC-IOPD IN GDG-FLD TO FRM-IIC-IOPD IN IDP-VARI.
           MOVE FRM-COD-DEUD IN GDG-FLD TO FRM-COD-DEUD IN IDP-VARI.
           MOVE OPD                     TO IDP-ROPD     IN IDP-VARI.
      * MHM-FIN 22-SEP-2003

           MOVE GDG-COD-VCAM IN GDG-FLD TO IDP-COD-VCOC IN IDP-VARI.
           MOVE MSG-COD-SIST            TO IDP-COD-SIST IN IDP-VARI.
           MOVE MSG-COD-MENS            TO IDP-COD-MENS IN IDP-VARI.

           IF CMA-CIC-TGAR IN CMA-VARI = "DOCCBR"
               MOVE "TVAL"                   TO MSC-COD-TMSC IN MSC
                MOVE IDP-MSC-TVOC IN IDP-VARI TO MSC-COD-CMSC IN MSC
               MOVE "TAB"       TO FIO-SIST
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-MSC
               IF NOT FIO-STAT-OKS
                   MOVE "TAB"       TO MSG-COD-SIST
                   MOVE "ERRTIPMON" TO MSG-COD-MENS
                   GO TO ERR-GAR-PRO-IDP
               ELSE
                   IF MSC-CIC-CMSC IN MSC = "0"
                       MOVE "04" TO IDP-TIP-DOCU IN IDP-VARI
                   ELSE
                       MOVE "05" TO IDP-TIP-DOCU IN IDP-VARI
           ELSE
               MOVE CMA-TIP-DOC IN CMA-VARI TO IDP-TIP-DOCU
                                                           IN IDP-VARI.

           MOVE CMA-FEC-FAPE IN CMA-VARI TO IDP-FEC-FCAP IN IDP-VARI.
           MOVE CMA-FEC-FTSN IN CMA-VARI TO IDP-FEC-FTSN IN IDP-VARI.
           MOVE CMA-DOC-SALD IN CMA-VARI TO IDP-VAL-DOCU IN IDP-VARI.
           MOVE SPACES TO MSG-COD-MENS.
           PERFORM GAR-LNK-IDP.
           MOVE IDP-COD-SIST IN IDP-VARI TO MSG-COD-SIST.
           MOVE IDP-COD-MENS IN IDP-VARI TO MSG-COD-MENS.
           IF MSG-COD-MENS NOT > SPACES
               GO TO FIN-GAR-PRO-IDP.


      * MHM-INI 22-SEP-2003
      * Modifica OPD de DAP, marcando en Garantia
           MOVE 'S' TO OPD-COD-GARA IN OPD.

      * FLB: VERSION 'B'ANCO
           IF SCR-IND-V001 = 'B'
               MOVE 'S' TO OPD-COD-CUST IN OPD.

           MOVE FIO-MOD TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'OPD    MOD'   TO MSG-COD-MENS
               GO TO ERR-GAR-PRO-IDP.

           GO TO FIN-GAR-PRO-IDP.


      * MHM-FIN 22-SEP-2003
       ERR-GAR-PRO-IDP.
      * MHM-INI 22-SEP-2003
           MOVE FIO-ULK-REC TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
      * MHM-FIN 22-SEP-2003

      * Despliega mensajes Error y Garantia Completada OK
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE SCR-STAT-CON TO SCR-STAT.
       FIN-GAR-PRO-IDP.
           EXIT.

