*%! NO_TIENE_TIMESTAMP = TRUE
*% FRM = 'GIN'
*% FMT_CHI = TRUE
*% GEN_BCI = TRUE
*%!IF NOT PGM_MCP
*% PGM_PTC = TRUE
*%!END
*% IF NOT PGM_CLB AND NOT PGM_MEX AND PGM_PQ
*%     ! Codigo adicional para Funcion GARPPVCG = PF5 desde GARPAGIN
*%      INCLUDE 'GARSRC:PFALL5.SRC'
*%     ! Codigo adicional programa GARPAGIN
*% END
*% REG = 'GIN'
*% HIJ = 'GDG'
*% SISREG = 'GAR'
*% IF EOF AND PGM_DTC
      *<<<< PGM_DTC
      *MHM-INI 23-OCT-2003
       COPY GNSBGCPT.
      *MHM-FIN 23-OCT-2003
       COPY GNSBGVSM.
       COPY GNSBHVSM.
      *>>>>
*% END
*% IF FIN_SCR_VARI
           03 CMA-VARI.
              05 GAR-CAI-GTIA                  PIC X(04).
              05 GAR-IIC-GTIA                  PIC X(08).
      *MHM-INI 29-OCT-2003
              05 CMA-CIC-UING                  PIC X(12).
      *MHM-FIN 29-OCT-2003
      *>>>>
*% END
*% IF WSS
       01 WSS-VARI.
      *MHM-INI 23-OCT-2003
           03 WSS-GLS-CGTA.
              05 WSS-GLS-TOPE                   PIC X(40).
              05 WSS-GLS-SOPE                   PIC X(40).
           03 WSS-COD-CGTA.
              05 WSS-TIP-CGTA                   PIC X(03).
              05 WSS-STP-CGTA                   PIC X(03).
      *MHM-FIN 23-OCT-2003

      *MHM-INI 23-OCT-2003
       COPY GNSWGCPT.
      *MHM-FIN 23-OCT-2003
       COPY GARBRGDG.
       COPY GARBRTAG.
       COPY GARWGVCG.
*% IF PGM_CLB OR PGM_MEX
       COPY TABBRIVB.
       COPY GARBRGAP.
       COPY GARBRGDD.
       COPY GARBRGDO.
       COPY GARBRGDP.
       COPY GARBRGES.
       COPY GARBRGLE.
       COPY GARBRGMO.
       COPY GARBRGSE.
       COPY GARBRGSI.
       COPY GARBRGTP.
       COPY GARBRGUB.
       COPY GARBRGVT.
       COPY GARBRGIM.
       COPY GARBRGVE.
       COPY GARWGVDO.
       COPY GARWVVCG.
*% END
*% IF PGM_VAX
      *<<<< PGM_VAX
           03 WSS-REG                          PIC X(03).
      *>>>>
*% END
*% IF PGM_DTC
      *<<<< WSS AND PGM_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
      *>>>>
*% END
*% IF PGM_CHI AND PGM_PQ
      *<<<< PGM_CHI AND PGM_PQ
           COPY USPC113.
      *>>>>
*% END
      *>>>>
*% END
*% IF PGM_ARG
*% LARGO_MI_COMMAREA = 15
*% ELSE
*% LARGO_MI_COMMAREA = 24
*% END
*% IF INI_FIO AND PGM_VAX
      *<<<< INI_FIO

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-OFI.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-TAG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-TAG.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GDG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.

      *>>>> INI_FIO
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
*% FIN_BUS_HIJ = TRUE
      *MHM-INI 31-JUL-2003
      * Llama a Subrutina Validacion Consistencia Garantia
           IF FRM-FFLD = FRM-FFLD-PF5
               PERFORM GAR-PRO-VCG
               GO TO FIN-FND-KEY.

      *MHM-FIN 31-JUL-2003
       BUS-GDG.
           MOVE GIN-CAI-GTIA IN GIN-FLD TO GDG-CAI-GTIA IN GDG.
           MOVE GIN-IIC-GTIA IN GIN-FLD TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           MOVE FIO-STAT TO PGM-STAT-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG    NEX' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
*% IF PGM_CHI
      *<<<< PGM_CHI
           IF SCR-CCPP = 'ACC' AND SCR-STAT = SCR-STAT-CON
               GO TO FIN-VAL-OFI-USP-GIN.

           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'OFIUSP'       TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S' )
               GO TO FIN-VAL-OFI-USP-GIN.
           COPY USPC143.
      *MHM-INI 31-JUL-2003
           MOVE 'GARGTUCG/CEN' TO USP-PTA-STR.
           COPY USPC103.
           IF USP-PERMISO = 'P'
               GO TO FIN-VAL-OFI-USP-GIN.
      *MHM-FIN 31-JUL-2003
           IF USP-COD-OFICINA NOT = GDG-COD-OFIC IN GDG 
               MOVE 'USRNODEOFI' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

       FIN-VAL-OFI-USP-GIN.
      *>>>>
*% END
*% IF PGM_PER AND PGM_GVT
      *<<<< PGM_PER AND PGM_GVT
       COPY GARBVUOF.
           IF MSG-COD-MENS > SPACES
               GO TO ERR-FND-KEY.
      *>>>>
*% END

       FIN-BUS-GDG.
*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GDG-TIP-CGTA IN GDG TO GDG-TIP-CGTA IN GIN-FLD.
           MOVE GDG-STP-CGTA IN GDG TO GDG-STP-CGTA IN GIN-FLD.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GDG TO GDG-COD-CGTA IN GIN-FLD.
*% END
*% IF FMT_CHI
      *<<<< FMT_CHI
      *BUS-TAB Busca codigo de tabla
           MOVE 'TAB' TO TAB-COD-SIST.
*% IF GEN_BCI
      *<<<< GEN_BCI
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
      *>>>>
*% ELSE
           MOVE 'GTA' TO TAB-COD-TTAB IN TAB.
*% END
           MOVE SPACES TO TAB-COD-CTAB IN TAB.

           MOVE GDG-TIP-CGTA IN GIN-FLD TO TAG-TIP-AGTA IN TAG.
           MOVE GDG-STP-CGTA IN GIN-FLD TO TAG-STP-AGTA IN TAG.
      *MHM-INI 24-OCT-2003
      *     MOVE TAG-COD-AGTA IN TAG     TO TAB-COD-CTAB IN TAB.
      *     PERFORM BUS-TAB.
      *     IF MSG-COD-MENS = SPACES
      *         MOVE TAB-GLS-DESC IN TAB TO
      *              FRM-GLS-CGTA IN GIN-FLD
      *     ELSE
      *         MOVE SPACES TO FRM-GLS-CGTA IN GIN-FLD.
      *MHM-FIN 24-OCT-2003

      *>>>>
*% END
      * Busca Glosa Tabla Real/no Real
*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GDG-TIP-CGTA IN GIN-FLD TO TAG-TIP-AGTA IN TAG.
           MOVE GDG-STP-CGTA IN GIN-FLD TO TAG-STP-AGTA IN TAG.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GIN-FLD TO TAG-COD-AGTA IN TAG.
*% END
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GAR-FIO-TAG.
           IF NOT FIO-STAT-OKS
                MOVE 'TAG    NEX' TO MSG-COD-MENS
                MOVE 'GAR' TO MSG-COD-SIST
                PERFORM GET-MSG
           ELSE
                MOVE SPACES TO MSG-COD-MENS
                MOVE 'GAR' TO TAB-COD-SIST
                MOVE 'RAL' TO TAB-COD-TTAB IN TAB
                MOVE TAG-IND-TREA IN TAG TO TAB-COD-CTAB IN TAB
                PERFORM BUS-TAB
                IF MSG-COD-MENS = SPACES
                    MOVE TAB-GLS-DESC IN TAB TO 
                         FRM-GLS-TREA IN GIN-FLD
                ELSE
                    MOVE SPACES TO FRM-GLS-TREA IN GIN-FLD.


           MOVE GDG-CAI-GTIA IN GDG TO GAR-CAI-GTIA IN CMA-VARI.
           MOVE GDG-IIC-GTIA IN GDG TO GAR-IIC-GTIA IN CMA-VARI.

           IF SCR-CMND = 'ING'
               PERFORM PUT-GDG-GIN.
      *MHM-INI 28-NOV-2003
      ** Valida Este permitido esta Entidad para Tipo-Subtipo
      *     IF TAG-IND-EGIN IN TAG = 'N'
      *         MOVE 'TAG    NOPGM' TO MSG-COD-MENS
      *         GO TO ERR-FND-KEY.
      * Manda la GDG por sobre la TAG
           IF GDG-IND-INOB IN GDG = 'N'
               MOVE 'GDG    NOPGM' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
      *MHM-INI 28-NOV-2003
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
           IF SCR-CCPP = 'ING'
               PERFORM BUS-COR-GIN
               GO TO CON-FND-KEY.

           IF GIN-NUM-IGIN IN GIN NOT > ZEROES
               PERFORM BUS-COR-GIN.
       CON-FND-KEY.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      * Comando Consulta Error lo trata el GENESIS
           IF SCR-CCPP = 'ACC' AND 
              SCR-STPP = SCR-STAT-CON
              GO TO FIN-FND-KEY.

      * Garantia Alzada
           IF GDG-IND-EST1 IN GDG > '19'
               MOVE 'GDGALZ' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      * Garantia Completa
           IF SCR-CCPP = 'ELI' AND
              GDG-IND-GTAC IN GDG = 'S'
               MOVE 'GAR    CPL' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           GO TO FIN-FND-KEY.
       ERR-FND-KEY.
           MOVE 'GAR' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE SCR-STAT-ABT TO SCR-STAT.
           IF SCR-CCPP = 'ING'
               MOVE '00' TO FIO-STAT
           ELSE
               MOVE FIO-STAT-NEX TO FIO-STAT.

      *>>>>
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
           MOVE SPACES TO GIN-GLS-FLAG IN GIN.
           MOVE SPACES TO GIN-MSC-TACC IN GIN.
           MOVE SPACES TO GIN-CIC-UING IN GIN.
           MOVE 'I'    TO GIN-MSC-STAT IN GIN.

      *>>>>
*% END
*% IF CMN_ING OR CMN_MOD
      *<<<< INI_CMN_ING OR INI_CMN_MOD
           PERFORM GET-FHOY.
           IF SCR-CCPP = 'ING'
              OR SCR-CMND = 'COP'
               MOVE 'I'      TO GIN-MSC-TACC IN GIN
               MOVE HOY-FHOY TO GIN-FEC-FING IN GIN
*% IF PGM_MVS
               MOVE SCR-USER TO GIN-CIC-UING IN GIN
*% END
           ELSE
*% IF PGM_MVS
      *         MOVE SCR-USER TO GIN-CIC-UACT IN GIN
*% END
               MOVE 'M'      TO GIN-MSC-TACC    IN GIN.
*% IF PGM_MVS
*% END
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en la modificacion : informar               
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-MOD.

      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en el ingreso : informar                    
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ING.

           MOVE GIN-CAI-GTIA IN GIN TO GDG-CAI-GTIA IN GDG.
           MOVE GIN-IIC-GTIA IN GIN TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF FIO-STAT-OKS
               MOVE 'S' TO GDG-IND-EGIN IN GDG
               MOVE FIO-MOD TO FIO-CMND
               PERFORM GAR-FIO-GDG.

      *>>>>
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en la eliminacion : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.

           MOVE GIN-CAI-GTIA IN GIN TO GDG-CAI-GTIA IN GDG.
           MOVE GIN-IIC-GTIA IN GIN TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF FIO-STAT-OKS
              MOVE ' ' TO GDG-IND-EGIN IN GDG
              MOVE FIO-MOD TO FIO-CMND
              PERFORM GAR-FIO-GDG.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       BUS-COR-GIN SECTION.
       INI-BUS-COR-GIN.
           MOVE 999 TO GIN-NUM-IGIN IN GIN.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM GAR-FIO-GIN.
           IF NOT ( FIO-STAT-OKS AND
                    GIN-CAI-GTIA IN GIN-FLD = GIN-CAI-GTIA IN GIN AND
                    GIN-IIC-GTIA IN GIN-FLD = GIN-IIC-GTIA IN GIN )
               PERFORM KEY-ALL-GIN
               MOVE ZEROES TO GIN-NUM-IGIN IN GIN.
           IF SCR-CCPP = 'ING'
               ADD 1 TO GIN-NUM-IGIN IN GIN
               MOVE GIN-NUM-IGIN IN GIN TO GIN-NUM-IGIN IN GIN-FLD
           ELSE
               MOVE GIN-NUM-IGIN IN GIN TO GIN-NUM-IGIN IN GIN-FLD.
       FIN-BUS-COR-GIN.
           EXIT.

*% IF PGM_CLB OR PGM_MEX
       COPY TABBFIVB.
       COPY GARBFGAP.
       COPY GARBFGDD.
       COPY GARBFGDO.
       COPY GARBFGDP.
       COPY GARBFGES.
       COPY GARBFGLE.
       COPY GARBFGMO.
       COPY GARBFGSE.
       COPY GARBFGSI.
       COPY GARBFGTP.
       COPY GARBFGUB.
       COPY GARBFGVT.
       COPY GARBFGIM.
       COPY GARBFGVE.
      *
*% END
       COPY GARBFGDG.
       COPY GARBFTAG.

       COPY GARBGVCG.
       COPY GARBKVCG.
      *MHM-INI 31-JUL-2003
      * COPY GARBGVC2.
      * COPY GARBGVDO.
      * COPY GARBVVCG.
       COPY GNSBVCOD.
       COPY GNSBVTAB.
      *MHM-FIN 31-JUL-2003
      *>>>>
*% END
