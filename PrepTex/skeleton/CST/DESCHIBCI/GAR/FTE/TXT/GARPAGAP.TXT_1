*%!IF NOT PGM_MCP
*%    PGM_PTC = TRUE
*% FMT_CHI = TRUE
*% GEN_BCI = TRUE
*%!END
*% FRM = 'GAP'
*% IF NOT PGM_CLB AND NOT PGM_MEX AND PGM_PQ
*%! Codigo adicional para Funcion GARPPVCG = PF5 desde GARPAGAP
*% INCLUDE 'GARSRC:PFALL5.SRC'
*%! Codigo adicional programa GARPAGAP
*% END
*% GRA_GMO = TRUE
*% REG = 'GAP'
*% HIJ = 'GDG'
*% CAIREG = 'GAP-CAI-GTIA'
*% IICREG = 'GAP-IIC-GTIA'
*% CAIFLD = 'GAP-CAI-GTIA'
*% IICFLD = 'GAP-IIC-GTIA'
*% SISREG = 'GAR'
*% IF PGM_ARG
*% LARGO_MI_COMMAREA = 15
*% ELSE
*% LARGO_MI_COMMAREA = 13
*% END
*% LARGO_MI_COMMAREA = 76
*% IF EOF AND PGM_DTC
      *<<<< EOF AND PGM_DTC
       COPY GNSBGVSM.
       COPY GNSBHVSM.
       COPY GNSBGHOY.
      *>>>>
*% END
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
           03 CMA-VARI.
              05 GAR-CAI-GTIA                   PIC X(04).
              05 GAR-IIC-GTIA                   PIC X(08).
              05 GAR-IND-GTAC                   PIC X(01). 
              05 GAR-COD-GGTA                   PIC 9(02).
              05 CNE-GAP-CAI-ICLI               PIC X(04).
              05 CNE-GAP-IIC-ICLI               PIC X(08).
              05 CNE-GAP-GLS-NOMA               PIC X(50).
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       COPY GARBRGDG.
       COPY GARBRTAG.
       COPY GARBRGMO.
       COPY GNSWGHOY.
       COPY GARBRGDD.
       COPY GARBRGES.
       COPY GARBRGSO.
       COPY GARBRGLE.
*% IF PGM_CLB OR PGM_MEX
       COPY GARBRGDD.
       COPY GARBRGDO.
       COPY GARBRGDP.
       COPY GARBRGIN.
       COPY GARBRGSE.
       COPY GARBRGSI.
       COPY GARBRGTP.
       COPY GARBRGUB.
       COPY GARBRGVT.
       COPY GARBRGIM.
       COPY GARBRGVE.
       COPY GARWGVCG.

*% IF PGM_MEX
      * Banamex
       COPY SGCWGICB.
*% END
       COPY GARWGVDO.
       COPY GNSWGUIB.
       COPY GARWVVCG.
*% END
       COPY SGCBRDBC.
*% IF NOT PGM_PU 
      *<<<< NOT PGM_PU
       COPY GARWGVCG.
*% IF PGM_VMS
      *<<<< PGM_VMS
           03 WSS-REG                          PIC X(03).
      *>>>>
*% END
      *>>>>
*% END
       COPY GNSWGCPT.
       COPY GNSWGSTR.
       COPY GNSWGPES.

*% IF PGM_CHI AND PGM_PQ
      *<<<< PGM_CHI AND PGM_PQ
           COPY USPC113.
      *>>>>
*% END
       01  WSS-VARI.
           03 WSS-CPO.
*% IF PGM_MEX
      *<<<< PGM_MEX
              05 DBC-IDC-ICLI                  PIC 9(12).
      *>>>>
*% END
*% IF PGM_ARG
      *<<<< PGM_ARG
              05 DBC-NUM-ICLI                  PIC 9(09).
      *>>>>
*% END
*% IF NOT PGM_ARG AND NOT PGM_MEX
      *<<<< NOT PGM_ARG
              05 DBC-NUM-ICLI                  PIC 9(08).
      *>>>>
*% END
*% IF  NOT PGM_MEX
              05 DBC-VRF-ICLI                  PIC X(01).
              05 DBC-IND-ICLI                  PIC X(01).
*% END
*% IF PGM_ARG
      *<<<< PGM_ARG
              05 DBC-GLS-ICLI                  PIC 9(02).
      *>>>>
*% END
*% IF NOT PGM_ARG AND NOT PGM_MEX
      *<<<< NOT PGM_ARG
              05 DBC-GLS-ICLI                  PIC X(03).
      *>>>>
*% END
           03 WSS-COD-CGTA.
              05 WSS-COD-TOPE                  PIC X(03).
              05 WSS-COD-SOPE                  PIC X(03).

           03 WSS-HOY-ANO.
              05 WSS-SHOY                      PIC 9(02).
              05 WSS-AHOY                      PIC 9(02).
           03 GDG-COD-GGTA VALUE ZEROES        PIC 9(01).
           03 WSS-FHOY.
              05 WSS-ANO                       PIC 9(04).
              05 WSS-AUX                       PIC 9(04).
           03  WSS-MAR-UTIL                    PIC 9(03).
      *MHM-INI 23-OCT-2003
           03 WSS-GLS-CGTA.
              05 WSS-GLS-TOPE                   PIC X(40).
              05 WSS-GLS-SOPE                   PIC X(40).
      *MHM-FIN 23-OCT-2003
*% IF FMT_CHI
      *<<<< FMT_CHI
           03 WSS-IDC-ICLI.
*% IF GEN_BCI
              05 WSS-NUM-ICLI                  PIC 9(08).
*% ELSE
              05 WSS-NUM-ICLI                  PIC X(12).
*% END
              05 WSS-IND-ICLI                  PIC X(01).
              05 WSS-GLS-ICLI                  PIC X(03).
      *>>>>
*% END
*% IF PGM_DTC
      *<<<< PGM_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GMO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GES-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GLE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>>
*% END
      *>>>>
*% END
*% IF INI_FIO AND PGM_VAX
      *<<<< INI_FIO AND PGM_VAX

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-OFI.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-TAG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-TAG.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GDG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GDD.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDD.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GMO.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GMO.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'SGC'        TO FIO-SIST.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-DBC.

      *>>>> INI_FIO
*% END
*% IF PGM_MCP AND FIN_HBL_IKY
      *<<<<
           MOVE FRM-CPIM-AEY TO GAP-IND-ESBA-ATR IN GAP-FLD.
           MOVE FRM-CPIM-AEY TO GAP-IND-ESBA-STP.

           MOVE FRM-CPIM-AEY TO GAP-IND-ESCL-ATR IN GAP-FLD.
           MOVE FRM-CPIM-AEY TO GAP-IND-ESCL-STP.

           MOVE FRM-POS-CURS TO GAP-CAI-GTIA-LEN IN GAP-FLD.
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
      *MHM-INI 5-AUG-2003
      *CGL-INI 05-05-2003 PARA DEJAR GENERABLE VERSION BCI
      * Llama a Subrutina Validacion Consistencia Garantia
           IF FRM-FFLD = FRM-FFLD-PF5
               PERFORM GAR-PRO-VCG
               GO TO FIN-FND-KEY.

      *MHM-FIN 5-AUG-2003
*% FIN_BUS_HIJ = TRUE
       BUS-GDG.
           MOVE GAP-CAI-GTIA IN GAP-FLD TO GDG-CAI-GTIA IN GDG.
           MOVE GAP-IIC-GTIA IN GAP-FLD TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           MOVE FIO-STAT TO PGM-STAT-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG    NEX' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
*% IF PGM_CHI
      *<<<< PGM_CHI
           IF SCR-CCPP = 'ACC' AND SCR-STAT = SCR-STAT-CON
               GO TO FIN-VAL-OFI-USP-GAP.

           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'OFIUSP'       TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S' )
               GO TO FIN-VAL-OFI-USP-GAP.

      *ALD-BCI-INI/07032000
           COPY USPC143.
           MOVE 'GARGTUCG/CEN' TO USP-PTA-STR.
           COPY USPC103.
           IF USP-PERMISO = 'P'
               GO TO FIN-VAL-OFI-USP-GAP.
      *    COPY USPC143.
      *ALD-BCI-FIN/07032000
           IF USP-COD-OFICINA NOT = GDG-COD-OFIC IN GDG 
               MOVE 'USRNODEOFI' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

       FIN-VAL-OFI-USP-GAP.
      *>>>>
*% END
*% IF PGM_PER AND PGM_GVT
      *<<<< PGM_PER AND PGM_GVT
       COPY GARBVUOF.
           IF MSG-COD-MENS > SPACES
               GO TO ERR-FND-KEY.
      *>>>>
*% END

       FIN-BUS-GDG.
*% IF FMT_CHI
      *<<<<
           MOVE GDG-TIP-CGTA IN GDG TO GDG-TIP-CGTA IN GAP-FLD.
           MOVE GDG-STP-CGTA IN GDG TO GDG-STP-CGTA IN GAP-FLD.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GDG TO GDG-COD-CGTA IN GAP-FLD.
*% END

      *BUS-TAB Busca codigo de tabla
           MOVE 'TAB' TO TAB-COD-SIST.
*% IF GEN_BCI
      *<<<< GEN_BCI
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
      *>>>>
*% ELSE
           MOVE 'GTA' TO TAB-COD-TTAB IN TAB.
*% END
           MOVE SPACES TO TAB-COD-CTAB IN TAB.

*% IF FMT_CHI
      *<<<<
           MOVE GDG-TIP-CGTA IN GAP-FLD TO TAG-TIP-AGTA IN TAG.
           MOVE GDG-STP-CGTA IN GAP-FLD TO TAG-STP-AGTA IN TAG.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GAP-FLD TO TAG-COD-AGTA IN TAG.
*% END
      *MHM-INI 24-OCT-2003
      *     MOVE TAG-COD-AGTA IN TAG TO TAB-COD-CTAB IN TAB.
      *     PERFORM BUS-TAB.
      *     IF MSG-COD-MENS = SPACES
      *         MOVE TAB-GLS-DESC IN TAB TO
      *              FRM-GLS-CGTA IN GAP-FLD
      *     ELSE
      *         MOVE SPACES TO FRM-GLS-CGTA IN GAP-FLD.
      *MHM-FIN 24-OCT-2003
           
      * Busca Glosa Tabla Real/no Real
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GAR-FIO-TAG.
           IF NOT FIO-STAT-OKS
                MOVE 'TAG    NEX' TO MSG-COD-MENS
                MOVE 'GAR' TO MSG-COD-SIST
                PERFORM GET-MSG
           ELSE
                PERFORM BUS-IND-TREA.

      * Valida Este permitido esta Entidad para Tipo-Subtipo
           IF TAG-IND-EGAP IN TAG = 'N'
               MOVE 'TAG    NOPGM' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           MOVE GDG-CAI-GTIA IN GDG TO GAR-CAI-GTIA IN CMA-VARI.
           MOVE GDG-IIC-GTIA IN GDG TO GAR-IIC-GTIA IN CMA-VARI.
           MOVE GDG-IND-GTAC IN GDG TO GAR-IND-GTAC IN CMA-VARI.

           IF SCR-CMND = 'ING'
               PERFORM PUT-GDG-GAP.

      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
           IF SCR-CCPP = 'ELI'
              IF NOT FIO-STAT-OKS
                 GO TO FIN-FND-KEY.

      * Comando Consulta Error lo trata el GENESIS
           IF SCR-CCPP = 'ACC' AND
              SCR-STPP = SCR-STAT-CON
              GO TO FIN-FND-KEY.

      * Garantia Alzada
           IF GDG-IND-EST1 IN GDG > '19'
               MOVE 'GDGALZ' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      * Garantia Completa
           IF SCR-CCPP = 'ELI' AND
              GDG-IND-GTAC IN GDG = 'S'
               MOVE 'GAR    CPL' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      * Acreedor tiene GES asociadas
           IF SCR-CCPP = 'ELI'
              PERFORM BUS-GES-GDG
              MOVE '00' TO FIO-STAT
              IF WSS-MAR-UTIL IN WSS-VARI > ZEROES
                 MOVE 'EXI    GES' TO MSG-COD-MENS
                 GO TO ERR-FND-KEY.

           GO TO FIN-FND-KEY.
       ERR-FND-KEY.
           MOVE 'GAR' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE SCR-STAT-ABT TO SCR-STAT.
           IF SCR-CCPP = 'ING'
               MOVE '00' TO FIO-STAT
           ELSE
               MOVE FIO-STAT-NEX TO FIO-STAT.

      *>>>>
*% END
*% IF FIN_SCR_TRL
      *<<<< FIN_SCR_TRL
      *>>>>
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
           MOVE SPACES TO GAP-GLS-FLAG IN GAP.
           MOVE SPACES TO GAP-MSC-TACC IN GAP.
           MOVE SPACES TO GAP-CIC-UING IN GAP.
           MOVE 'I'    TO GAP-MSC-STAT IN GAP.
      *>>>>
*% END
*% IF CMN_ING OR CMN_MOD
      *<<<< INI_CMN_ING OR INI_CMN_MOD
           PERFORM GET-FHOY.
           IF SCR-CCPP = 'ING'
              OR SCR-CMND = 'COP'
               MOVE 'I'      TO GAP-MSC-TACC IN GAP
               MOVE HOY-FHOY TO GAP-FEC-FING IN GAP
*% IF PGM_MVS
               MOVE SCR-USER TO GAP-CIC-UING IN GAP
*% END
           ELSE
*% IF PGM_MVS
*% END
               MOVE 'M'      TO GAP-MSC-TACC IN GAP.
*% IF PGM_MVS
*% END
      *>>>>
*% END
*% IF CMN_MOD
      *<<<< CMN_MOD
      *MHM-INI 5-AUG-2003
           IF GAR-IND-GTAC IN CMA-VARI NOT = 'S'
               MOVE GAP-CAI-GTIA IN GAP TO GSO-CAI-GTIA IN GSO 
               MOVE GAP-IIC-GTIA IN GAP TO GSO-IIC-GTIA IN GSO
               MOVE 'GSO-KEY-IGDG' TO FIO-AKEY
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GAR-FIO-GSO
               IF FIO-STAT-OKS AND GSO-COD-ESGA IN GSO NOT < '06'
                   MOVE 'GSOESGA>06' TO MSG-COD-MENS
                   MOVE 'GAR' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE SCR-STAT-CON TO SCR-STAT
                   GO TO FIN-CMN-MOD.

      *MHM-FIN 5-AUG-2003
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en la modificacion : informar               
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-MOD.
      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en el ingreso : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ING. 

           IF GAR-IND-GTAC IN CMA-VARI NOT = 'S'
               GO TO SIG-CMN-ING.

           MOVE '1' TO GMO-COD-MOVI IN GMO.
           PERFORM ESC-GMO-GAP.
           IF MSG-COD-MENS > SPACES
               MOVE 'GAR' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-CMN-ING.
       SIG-CMN-ING.
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en el ingreso : informar                    
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ING. 

*% IF GEN_BCI
      *<<<< GEN_BCI
      *MHM-INI 30-SEP-2003
      **MHM-INI 5-AUG-2003
      *     IF GAR-IND-GTAC IN CMA-VARI NOT = 'S'
      *         MOVE GAP-CAI-GTIA IN GAP TO GSO-CAI-GTIA IN GSO 
      *         MOVE GAP-IIC-GTIA IN GAP TO GSO-IIC-GTIA IN GSO
      *         MOVE 'GSO-KEY-IGDG' TO FIO-AKEY
      *         MOVE FIO-GET-KEY TO FIO-CMND
      *         PERFORM GAR-FIO-GSO
      *         IF FIO-STAT-OKS
      *             PERFORM MOD-EST-GSO
      *             IF MSG-COD-MENS > SPACES
      *                MOVE 'GAR' TO MSG-COD-SIST
      *                PERFORM GET-MSG
      *                MOVE MSG-GLS-DESC TO FRM-MENS
      *                MOVE SCR-STAT-CON TO SCR-STAT
      *                GO TO FIN-CMN-ING.
      *
      **MHM-FIN 5-AUG-2003
      *MHM-FIN 30-SEP-2003
      *>>>>
*% END
           MOVE GAP-CAI-GTIA IN GAP TO GDG-CAI-GTIA IN GDG.
           MOVE GAP-IIC-GTIA IN GAP TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF FIO-STAT-OKS
      *MHM-INI 30-SEP-2003
               PERFORM MOD-COD-PACR
      *MHM-FIN 30-SEP-2003
               MOVE 'S' TO GDG-IND-EGAP IN GDG
               MOVE FIO-MOD TO FIO-CMND
               PERFORM GAR-FIO-GDG.
      *>>>>
*% END
*% IF CMN_ELI
      *<<<< CMN_ELI
      *MHM-INI 5-AUG-2003
           MOVE GAP-CAI-GTIA IN GAP TO GLE-CAI-GTIA IN GLE.
           MOVE GAP-IIC-GTIA IN GAP TO GLE-IIC-GTIA IN GLE.
           MOVE SPACES              TO GLE-COD-PACR IN GLE.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GAR-FIO-GLE.
           IF FIO-STAT-OKS AND
               GLE-CAI-GTIA IN GLE = GAP-CAI-GTIA IN GAP AND
               GLE-IIC-GTIA IN GLE = GAP-IIC-GTIA IN GAP
                MOVE 'GAP CONGLE' TO MSG-COD-MENS
                MOVE 'GAR' TO MSG-COD-SIST
                PERFORM GET-MSG
                MOVE MSG-GLS-DESC TO FRM-MENS
                MOVE SCR-STAT-CON TO SCR-STAT
                MOVE 'S' TO SCR-IERR
                GO TO FIN-CMN-ELI.

           MOVE GAP-CAI-GTIA IN GAP TO GES-CAI-GTIA IN GES.
           MOVE GAP-IIC-GTIA IN GAP TO GES-IIC-GTIA IN GES.
           MOVE ZEROES              TO GES-NUM-IGES IN GES.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GAR-FIO-GES.
           IF FIO-STAT-OKS AND
               GES-CAI-GTIA IN GES = GAP-CAI-GTIA IN GAP AND
               GES-IIC-GTIA IN GES = GAP-IIC-GTIA IN GAP
                MOVE 'GAP CONGES' TO MSG-COD-MENS
                MOVE 'GAR' TO MSG-COD-SIST
                PERFORM GET-MSG
                MOVE MSG-GLS-DESC TO FRM-MENS
                MOVE SCR-STAT-CON TO SCR-STAT
                MOVE 'S' TO SCR-IERR
                GO TO FIN-CMN-ELI.

      *MHM-FIN 5-AUG-2003
      *>>>>
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en la eliminacion : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.

           IF GAR-IND-GTAC IN CMA-VARI NOT = 'S'
               GO TO SIG-CMN-ELI.

           MOVE '3' TO GMO-COD-MOVI IN GMO.
           PERFORM ESC-GMO-GAP.
           IF MSG-COD-MENS > SPACES
               MOVE 'GAR' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE SCR-STAT-CON TO SCR-STAT
               MOVE 'S' TO SCR-IERR
               GO TO FIN-CMN-ELI.
       SIG-CMN-ELI.

           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en la eliminacion : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.

      * Guarda Llave Padre

      * Para saber si queda o no un hijo y grabar el Indicador en GDG
           MOVE SPACES                   TO GAP-KEY-IGAP IN GAP.
           MOVE GAR-CAI-GTIA IN CMA-VARI TO GAP-CAI-GTIA IN GAP.
           MOVE GAR-IIC-GTIA IN CMA-VARI TO GAP-IIC-GTIA IN GAP.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'GAP-KEY-IGAP' TO FIO-AKEY.
           PERFORM GAR-FIO-GAP.
           IF FIO-STAT-OKS AND
              GAP-CAI-GTIA IN GAP = GAR-CAI-GTIA IN CMA-VARI AND
              GAP-IIC-GTIA IN GAP = GAR-IIC-GTIA IN CMA-VARI
               GO TO FIN-CMN-ELI.

      * No quedo ningun hijo
           MOVE GAR-CAI-GTIA IN CMA-VARI TO GDG-CAI-GTIA IN GDG.
           MOVE GAR-IIC-GTIA IN CMA-VARI TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF FIO-STAT-OKS
               MOVE ' ' TO GDG-IND-EGAP IN GDG
               MOVE FIO-MOD TO FIO-CMND
               PERFORM GAR-FIO-GDG
               IF NOT FIO-STAT-OKS
                   MOVE FIO-MENS TO FRM-MENS
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE FIO-MENS TO FRM-MENS.
      *>>>>
*% END
*% IF FIN_HBL_FLD
      *<<<< FIN_HBL_FLD
*% IF FMT_CHI
      *<<<<
           MOVE GDG-TIP-CGTA IN GAP-FLD TO WSS-COD-TOPE IN WSS-VARI.
           MOVE GDG-STP-CGTA IN GAP-FLD TO WSS-COD-SOPE IN WSS-VARI.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GAP-FLD TO WSS-COD-CGTA IN WSS-VARI.
*% END
      *>>>>
*% END
*% IF EOF AND ( PGM_PU OR PGM_VMS )
      *<<<< EOF AND ( PGM_PU OR PGM_VMS )
       ESC-GMO-GAP SECTION.
       INI-ESC-GMO-GAP.
           MOVE ZEROES   TO GMO-NUM-IMOV IN GMO.
           PERFORM INI-GMO.
           MOVE 'GAP001' TO GMO-COD-CMPO IN GMO.
           MOVE 'N'      TO GMO-IND-VALO IN GMO.
           MOVE 'N'      TO GMO-IND-CLVE IN GMO.
*% IF NOT PGM_MEX
           MOVE DBC-NUM-ICLI IN GAP-FLD TO 
                DBC-NUM-ICLI IN WSS-CPO.
           MOVE DBC-VRF-ICLI IN GAP-FLD TO
                DBC-VRF-ICLI IN WSS-CPO.
           MOVE DBC-IND-ICLI IN GAP-FLD TO
                DBC-IND-ICLI IN WSS-CPO.
           MOVE DBC-GLS-ICLI IN GAP-FLD TO
                DBC-GLS-ICLI IN WSS-CPO.
*% END
*% IF PGM_MEX
           MOVE DBC-IDC-ICLI IN GAP-FLD TO 
                DBC-IDC-ICLI IN WSS-CPO.
*% END
           IF GMO-COD-MOVI IN GMO = '1'
              MOVE WSS-CPO TO GMO-GLS-NCMP IN GMO
           ELSE
           IF GMO-COD-MOVI IN GMO = '3'
              MOVE WSS-CPO TO GMO-GLS-CMPA IN GMO.
               
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
           IF NOT FIO-STAT-OKS
               MOVE 'GMO    PUT' TO MSG-COD-MENS.
       FIN-ESC-GMO-GAP.
           EXIT.   

       INI-GMO SECTION.
       INI-INI-GMO.
               MOVE SPACES TO GMO-GLS-FLAG IN GMO.
               MOVE ZEROES TO GMO-NUM-TASN IN GMO.
               MOVE SPACES TO GMO-COD-CMPO IN GMO.
               MOVE SPACES TO GMO-COD-CLVA IN GMO.
               MOVE SPACES TO GMO-GLS-CMPA IN GMO.
               MOVE ZEROES TO GMO-SGV-CMPA IN GMO.
               MOVE SPACES TO GMO-COD-NCLV IN GMO.
               MOVE SPACES TO GMO-GLS-NCMP IN GMO.
               MOVE ZEROES TO GMO-SGV-NCMP IN GMO.
               MOVE SPACES TO GMO-COD-TMOV IN GMO.
               MOVE SPACES TO GMO-GLS-DISP IN GMO.
               MOVE ZEROES TO GMO-VAL-CCON IN GMO.
               MOVE ZEROES TO GMO-VAL-CCOM IN GMO.
               PERFORM GET-FHOY.
               MOVE HOY-FHOY TO GMO-FEC-FMOV IN GMO.
               MOVE HOY-HHOY TO GMO-HRA-HMOV IN GMO.
*% IF PGM_MVS OR PGM_DOS
      *<<<< PGM_MVS OR PGM_DOS
               MOVE SCR-OTRN TO GMO-TML-TMOV IN GMO.
               MOVE SCR-USER TO GMO-CIC-UING IN GMO.
      *<<<< 
*% ELSE
      *<<<< PGM_VMS
      * FALTA ESCRIBIR TERMINAL Y USUARIO
               MOVE SPACES TO GMO-TML-TMOV IN GMO.
               MOVE SPACES TO GMO-CIC-UING IN GMO.
      *<<<< 
*% END
               MOVE HOY-FHOY                TO GMO-FEC-FING IN GMO.
               MOVE GAP-CAI-GTIA IN GAP     TO GMO-CAI-GTIA IN GMO.
               MOVE GAP-IIC-GTIA IN GAP     TO GMO-IIC-GTIA IN GMO.
               MOVE GDG-COD-OFIC IN GAP-FLD TO GMO-COD-OFMV IN GMO.
               ADD 1                        TO GMO-NUM-IMOV IN GMO.
               MOVE 'S'                     TO GMO-IND-VALO IN GMO.
               MOVE 'N'                     TO GMO-IND-CLVE IN GMO.
       FIN-INI-GMO.
           EXIT.

*% IF GEN_BCI
      *<<<< GEN_BCI
       MOD-EST-GSO SECTION.
       INI-MOD-EST-GSO.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GSO.
           IF FIO-STAT-OKS
              MOVE '02' TO GSO-COD-EST2 IN GSO
              MOVE FIO-MOD TO FIO-CMND
              PERFORM GAR-FIO-GSO
              IF NOT FIO-STAT-OKS
                 MOVE 'GSO  NOMOD' TO MSG-COD-MENS
              ELSE
                 NEXT SENTENCE
           ELSE
                 MOVE 'GSO  NOUPD' TO MSG-COD-MENS.
       FIN-MOD-EST-GSO.
           EXIT.
      *MHM-INI 30-SEP-2003
       MOD-COD-PACR SECTION.
       INI-MOD-COD-PACR.
           IF GAP-IND-ESBA IN GAP-FLD = 'S' AND
              ( GAP-COD-PACR IN GAP-FLD < GDG-COD-GGTA IN GDG OR
                GDG-COD-GGTA IN GDG NOT > SPACES )
               MOVE GAP-COD-PACR IN GAP-FLD TO GDG-COD-GGTA IN GDG.
       FIN-MOD-COD-PACR.
           EXIT.
      *MHM-FIN 30-SEP-2003
      *>>>>
*% END
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       COPY GARBFGDD.
       COPY GARBFGMO.
       COPY GNSBGPES.

       BUS-IND-TREA SECTION.
       INI-BUS-IND-TREA.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE 'GAR'  TO TAB-COD-SIST.
           MOVE 'RAL'  TO TAB-COD-TTAB IN TAB.
           MOVE TAG-IND-TREA IN TAG TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS = SPACES
              MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-TREA IN GAP-FLD
           ELSE
              MOVE SPACES TO FRM-GLS-TREA IN GAP-FLD.
       FIN-BUS-IND-TREA.
           EXIT.

       COPY GNSBVCOD.
       COPY GNSBVTAB.
       COPY GARBFGDG.
       COPY GNSBBMSC.
       COPY GARBFTAG.
       COPY GARBFGES.
       COPY GARBFGSO.
       COPY GARBFGLE.
*% IF PGM_CLB OR PGM_MEX
      *<<<< NOT PGM_MCP
       COPY GARBGVCG.
       COPY GARBGVC2.
       COPY GARBKVCG.
       COPY GARBFGDO.
       COPY GARBFGDP.
       COPY GARBFGIN.
       COPY GARBFGSE.
       COPY GARBFGSI.
       COPY GARBFGTP.
       COPY GARBFGUB.
       COPY GARBFGVT.
       COPY GARBFGIM.
       COPY GARBFGVE.
       COPY GARBGVDO.
       COPY GARBVVCG.
      *>>>>
*% END
*% IF ( NOT PGM_PU) AND ( NOT PGM_CLB) AND (NOT PGM_MEX)
      *<<<< NOT PGM_PU AND NOT PGM_CLB AND NOT PGM_MEX
       COPY GARBGVCG.
       COPY GARBKVCG.
      *>>>>
*% END
       COPY SGCBFDBC.
       COPY GNSBGCPT.
       COPY GNSBGSTR.
*% IF PGM_PQ
      *<<<< PGM_PQ
       BUS-COR-GAP SECTION.
       INI-BUS-COR-GAP.
           MOVE GAP-CAI-GTIA IN GAP-FLD TO GAP-CAI-GTIA IN GAP.
           MOVE GAP-IIC-GTIA IN GAP-FLD TO GAP-IIC-GTIA IN GAP.
           MOVE 99                      TO GAP-COD-PACR IN GAP.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM GAR-FIO-GAP.
           IF NOT ( FIO-STAT-OKS AND
                    GAP-CAI-GTIA IN GAP-FLD = GAP-CAI-GTIA  IN GAP AND
                    GAP-IIC-GTIA IN GAP-FLD = GAP-IIC-GTIA  IN GAP )
               PERFORM KEY-GAP-GAP
               MOVE ZEROES TO GAP-COD-PACR IN GAP.

           IF FIO-STAT-OKS
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM GAR-FIO-GAP.

           IF SCR-CCPP = 'ING' OR 'ACT'
               ADD 1 TO GAP-COD-PACR IN GAP 
               MOVE GAP-COD-PACR IN GAP TO
                    GAP-COD-PACR IN GAP-FLD.
       
       FIN-BUS-COR-GAP.
           EXIT.
       BUS-GES-GDG SECTION.
       INI-BUS-GES-GDG.
      
           MOVE ZEROES                  TO WSS-MAR-UTIL IN WSS-VARI.
           MOVE GAP-CAI-GTIA IN GAP-FLD TO GES-CAI-GTIA IN GES.
           MOVE GAP-IIC-GTIA IN GAP-FLD TO GES-IIC-GTIA IN GES.
           MOVE ZEROES                  TO GES-NUM-IGES IN GES.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GAR-FIO-GES.
       LUP-BUS-GES-GDG.
           IF NOT ( FIO-STAT-OKS AND
                GAP-CAI-GTIA  IN GAP-FLD = GES-CAI-GTIA  IN GES AND
                GAP-IIC-GTIA  IN GAP-FLD = GES-IIC-GTIA  IN GES )
                GO TO FIN-BUS-GES-GDG.
      
           IF GES-COD-PACR IN GES = GAP-COD-PACR  IN GAP-FLD
              ADD  1 TO  WSS-MAR-UTIL IN WSS-VARI
              GO TO FIN-BUS-GES-GDG.
      
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GES.
           GO TO LUP-BUS-GES-GDG.
      
       FIN-BUS-GES-GDG.
           EXIT.
      
      *>>>>
*% END
      *>>>>
*% END
