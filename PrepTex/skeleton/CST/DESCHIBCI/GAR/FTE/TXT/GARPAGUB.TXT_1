*%! NO_TIENE_TIMESTAMP = TRUE
*% PGM_GUB = TRUE
*% FMT_CHI = TRUE
*% GEN_BCI = TRUE
*%! NO_HDR_CST = TRUE
*%! IF PGM_DTC
*%! INCLUDE 'GARSRC:GNSVSIDTC.SRC'
*%! END
*%! HASTA AQUI PARA MANEJAR VSAM EN AMBIENTE DTC
*% FRM = 'GUB'
*% REG = 'GUB'
*% HIJ = 'GDG'
*%! IF NOT PGM_MCP
*% PGM_PTC = TRUE
*%! END
*% IF PGM_PQ
      *<<<< PGM_PQ
*%! Codigo adicional para Funcion GARPPVCG = PF5
*% INCLUDE 'GARSRC:PFALL5.SRC'
      *>>>>
*% END
*% IF EOF AND PGM_DTC
      *<<<< EOF AND PGM_DTC
       COPY GNSBGVSM.
       COPY GNSBHVSM.
      *>>>>
*% END
*% IF FIN_SCR_VARI
           03 CMA-VARI.
               05 GAR-CAI-GTIA                 PIC X(04).
               05 GAR-IIC-GTIA                 PIC X(08).
               05 GAR-IND-OUBI          PIC X(01).
               05 GAR-IND-OCAL          PIC X(01).
               05 GAR-IND-OCAD          PIC X(01).
               05 GAR-COD-LOCU.
                  07 COM-COD-REGI          PIC X(02).
                  07 COM-EXT-CTAB          PIC X(04).
               05 CMA-CIC-TGAR             PIC X(06).
      *RRM-INI 11-SEP-2001
               05 WSS-COD-CTAB.
                  07 WSS-COD-CTAB1         PIC X(04).
                  07 WSS-COD-CTAB2         PIC X(04).
                  07 WSS-COD-CTAB3         PIC X(04).
                  07 WSS-COD-CTAB4         PIC X(04).
      *RRM-FIN 11-SEP-2001
      *MHM-INI 29-OCT-2003
               05 CMA-CIC-UING             PIC X(12).
      *MHM-INI 29-OCT-2003
*% END
*% IF WSS
      *MHM-INI 25-JUL-2003
       COPY GARWXGDG.
       01  WSS-VARI.
           03 WSS-COD-CGTA.
              05 WSS-TIP-CGTA              PIC X(03).
              05 WSS-STP-CGTA              PIC X(03).

      *MHM-INI 23-OCT-2003
           03 WSS-GLS-CGTA.
              05 WSS-GLS-TOPE                   PIC X(40).
              05 WSS-GLS-SOPE                   PIC X(40).
      *MHM-FIN 23-OCT-2003
       COPY USPC113.
      *MHM-FIN 25-JUL-2003
      *MHM-INI 23-OCT-2003
       COPY GNSWGCPT.
      *MHM-FIN 23-OCT-2003
      * COPY TABBREST.
      * COPY TABBRMUN.
      * COPY TABBRCIU.
      * COPY TABBRCPO.
       COPY GARBRGAP.
       COPY GARBRGDG.
       COPY GARBRTAG.
       COPY GARWGVCG.

       COPY TABBRCOM.
*% IF PGM_CLB OR PGM_MEX
*%! IF PGM_MCP
       COPY TABBRIVB.
       COPY GARBRGDD.
       COPY GARBRGDO.
       COPY GARBRGDP.
       COPY GARBRGES.
       COPY GARBRGIN.
       COPY GARBRGLE.
       COPY GARBRGMO.
       COPY GARBRGSE.
       COPY GARBRGSI.
       COPY GARBRGTP.
       COPY GARBRGVT.
       COPY GARBRGIM.
       COPY GARBRGVE.
       COPY GARWGVDO.
       COPY GARWVVCG.
*% END
*% IF PGM_VAX
           03 WSS-REG                          PIC X(03).
      *
*% END
*% IF PGM_DTC
      *<<<< WSS AND PGM_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
      *>>>>
*% END
*% END
*% CMA_USR = TRUE
*% IF CMA AND PGM_MVS
      *MHM-INI 01-DIC-2003
      *     02 FILLER                       PIC X(283).
           02 FILLER                       PIC X(305).
      *MHM-FIN 01-DIC-2003
*% END
*% IF INI_FIO AND PGM_MVS
      *<<<< INI_FIO
      *MHM-INI 01-DIC-2003
      *     MOVE +283 TO SCR-TCMA.
           MOVE +305 TO SCR-TCMA.
      *MHM-FIN 01-DIC-2003
           MOVE TSK-TERM-ALF TO WSX-COD-TERM IN WSX-TSGDG.
      *>>>>
*% END
*% IF SCR_GIKY_VAL_IKY
      *<<<< SCR_GIKY_VAL_IKY
         IF SCR-OFRM-SRV
              MOVE WSX-NOM-TSGDG  TO QUE-COLA
              MOVE WSX-LEN-TSGDG  TO QUE-LITM
              MOVE QUE-GET        TO QUE-CMND
              PERFORM GNS-PRO-QUE
              IF QUE-STAT = QUE-STAT-OKS
                 MOVE QUE-ITEM      TO WSX-TAB-GDG
                 MOVE WSX-CAI-NGAR TO GUB-CAI-GTIA IN GUB-FLD
                 MOVE WSX-IIC-NGAR TO GUB-IIC-GTIA IN GUB-FLD.
      *>>>>
*% END
*% IF INI_FIO AND PGM_VAX
      *<<<< INI_FIO

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-OFI.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GDG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-TAG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-TAG.

      *>>>> INI_FIO
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
*% FIN_BUS_HIJ = TRUE
       BUS-GDG.
      *CGL-INI 06-05-2003
      * Llama a Subrutina Validacion Consistencia Garantia
           IF FRM-FFLD = FRM-FFLD-PF5
               PERFORM GAR-PRO-VCG
               GO TO FIN-FND-KEY.
      
           MOVE GUB-CAI-GTIA IN GUB-FLD TO GDG-CAI-GTIA IN GDG.
           MOVE GUB-IIC-GTIA IN GUB-FLD TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           MOVE FIO-STAT TO PGM-STAT-GDG.
           IF NOT FIO-STAT-OKS
               MOVE 'GDG    NEX' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.
*% IF PGM_CHI
      *<<<< PGM_CHI
           IF SCR-CCPP = 'ACC' AND 
              SCR-STAT = SCR-STAT-CON
              GO TO FIN-VAL-OFI-USP-GUB.

           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'OFIUSP'       TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S' )
               GO TO FIN-VAL-OFI-USP-GUB.

      *ALD-BCI-INI/07032000
           COPY USPC143.
           MOVE 'GARGTUCG/CEN' TO USP-PTA-STR.
           COPY USPC103.
           IF USP-PERMISO = 'P'
               GO TO FIN-VAL-OFI-USP-GUB.
      *    COPY USPC143.
      *ALD-BCI-FIN/07032000
           IF USP-COD-OFICINA NOT = GDG-COD-OFIC IN GDG 
               MOVE 'USRNODEOFI' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

       FIN-VAL-OFI-USP-GUB.
      *>>>>
*% END
*% IF PGM_PER AND PGM_GVT
      *<<<< PGM_PER AND PGM_GVT
       COPY GARBVUOF.
           IF MSG-COD-MENS > SPACES
               GO TO ERR-FND-KEY.
      *>>>>
*% END

       FIN-BUS-GDG.
      *RRM-INI 10-SEP-2001
      *    MOVE GDG-COD-TOPE IN GDG TO GDG-COD-TOPE IN GUB-FLD.
      *    MOVE GDG-COD-SOPE IN GDG TO GDG-COD-SOPE IN GUB-FLD.
*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GDG-TIP-CGTA IN GDG TO GDG-TIP-CGTA IN GUB-FLD.
           MOVE GDG-STP-CGTA IN GDG TO GDG-STP-CGTA IN GUB-FLD.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GDG TO GDG-COD-CGTA IN GUB-FLD.
*% END
      *RRM-FIN 10-SEP-2001
      *BUS-TAB Busca codigo de tabla
           MOVE 'TAB' TO TAB-COD-SIST.
*% IF GEN_BCI
      *<<<< GEN_BCI
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
      *>>>>
*% ELSE
           MOVE 'GTA' TO TAB-COD-TTAB IN TAB.
*% END
           MOVE SPACES TO TAB-COD-CTAB IN TAB.
*% IF FMT_CHI
      *<<<< FMT_CHI
           MOVE GDG-TIP-CGTA IN GUB-FLD TO TAG-TIP-AGTA IN TAG.
           MOVE GDG-STP-CGTA IN GUB-FLD TO TAG-STP-AGTA IN TAG.
      *>>>>
*% ELSE
           MOVE GDG-COD-CGTA IN GUB-FLD TO TAG-COD-AGTA IN TAG.
*% END
           MOVE TAG-COD-AGTA IN TAG     TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS = SPACES
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-CGTA IN GUB-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-CGTA IN GUB-FLD.
      *----------------------------------------------------*
      * Busca Glosa Tabla Real/no Real
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GAR-FIO-TAG.
           IF NOT FIO-STAT-OKS
                MOVE 'TAG    NEX' TO MSG-COD-MENS
                MOVE 'GAR' TO MSG-COD-SIST
                PERFORM GET-MSG
           ELSE
                MOVE SPACES TO MSG-COD-MENS
                MOVE 'GAR' TO TAB-COD-SIST
                MOVE 'RAL' TO TAB-COD-TTAB IN TAB
                MOVE TAG-IND-TREA IN TAG TO 
                     TAB-COD-CTAB IN TAB
                PERFORM BUS-TAB
                IF MSG-COD-MENS = SPACES
                    MOVE TAB-GLS-DESC IN TAB TO 
                         FRM-GLS-TREA IN GUB-FLD
                ELSE
                    MOVE SPACES TO FRM-GLS-TREA IN GUB-FLD.


      * No encontro TAG o Tabla RAL
           IF MSG-COD-MENS > SPACES
               GO TO ERR-FND-KEY.

           MOVE TAG-IND-OUBI IN TAG TO GAR-IND-OUBI IN CMA-VARI.
           MOVE TAG-IND-OCAL IN TAG TO GAR-IND-OCAL IN CMA-VARI.
           MOVE TAG-IND-OCAD IN TAG TO GAR-IND-OCAD IN CMA-VARI.
           MOVE GDG-CAI-GTIA IN GDG TO GAR-CAI-GTIA IN CMA-VARI.
           MOVE GDG-IIC-GTIA IN GDG TO GAR-IIC-GTIA IN CMA-VARI.
           IF SCR-CMND = 'ING'
               PERFORM PUT-GDG-GUB.

      * Valida Este permitido esta Entidad para Tipo-Subtipo
           IF TAG-IND-EGUB IN TAG = 'N'
               MOVE 'TAG    NOPGM' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      * Comando Consulta Error lo trata el GENESIS
           IF SCR-CCPP = 'ACC' AND 
              SCR-STPP = SCR-STAT-CON
              GO TO FIN-FND-KEY.

      * Garantia Alzada
           IF GDG-IND-EST1 IN GDG > '19'
               MOVE 'GDGALZ' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      * Garantia Completa
           IF SCR-CCPP = 'ELI' AND
              GDG-IND-GTAC IN GDG = 'S'
               MOVE 'GAR    CPL' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           GO TO FIN-FND-KEY.
       ERR-FND-KEY.
           MOVE 'GAR' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE SCR-STAT-ABT TO SCR-STAT.
           IF SCR-CCPP = 'ING'
               MOVE '00' TO FIO-STAT
           ELSE
               MOVE FIO-STAT-NEX TO FIO-STAT.

      *>>>>
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
           MOVE SPACES TO GUB-GLS-FLAG IN GUB.
           MOVE SPACES TO GUB-MSC-TACC IN GUB.
           MOVE SPACES TO GUB-CIC-UING IN GUB.
      *    MOVE SPACES TO GUB-CIC-UACT IN GUB.
           MOVE 'I'    TO GUB-MSC-STAT IN GUB.

      *MHM-INI 25-JUL-2003
      *     MOVE SPACES TO GUB-GLS-DIR1 IN GUB.
      *     MOVE SPACES TO GUB-GLS-DIR2 IN GUB.
           MOVE SPACES TO GUB-GLS-CLLE IN GUB.
           MOVE SPACES TO GUB-GLS-NUME IN GUB.
           MOVE SPACES TO GUB-GLS-OTRS IN GUB.
      *MHM-FIN 25-JUL-2003
           MOVE SPACES TO GUB-COD-AADN IN GUB.
           MOVE SPACES TO GUB-COD-IALM IN GUB.
           MOVE ZEROES TO GUB-COD-COMU IN GUB.
           MOVE SPACES TO GUB-COD-UDOC IN GUB.
      *>>>>
*% END
*% IF CMN_ING OR CMN_MOD
      *<<<< INI_CMN_ING OR INI_CMN_MOD
           PERFORM GET-FHOY.
           IF SCR-CCPP = 'ING'
              OR SCR-CMND = 'COP'
               MOVE 'I'      TO GUB-MSC-TACC    IN GUB

               MOVE HOY-FHOY TO GUB-FEC-FING IN GUB
*% IF PGM_MVS
               MOVE SCR-USER TO GUB-CIC-UING IN GUB
*% END
           ELSE
*% IF PGM_MVS
*% END
               MOVE 'M'      TO GUB-MSC-TACC    IN GUB.
*% IF PGM_MVS
*% END
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en la modificacion : informar               
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-MOD.
      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en el ingreso : informar                    
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ING. 

           MOVE GUB-CAI-GTIA IN GUB TO GDG-CAI-GTIA IN GDG.
           MOVE GUB-IIC-GTIA IN GUB TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF FIO-STAT-OKS
               MOVE 'S' TO GDG-IND-EGUB IN GDG
               MOVE FIO-MOD TO FIO-CMND
               PERFORM GAR-FIO-GDG.
      *>>>>
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en la eliminacion : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.

           MOVE GUB-CAI-GTIA IN GUB TO GDG-CAI-GTIA IN GDG.
           MOVE GUB-IIC-GTIA IN GUB TO GDG-IIC-GTIA IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF FIO-STAT-OKS
               MOVE ' ' TO GDG-IND-EGUB IN GDG
               MOVE FIO-MOD TO FIO-CMND
               PERFORM GAR-FIO-GDG.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      *MHM-INI 23-OCT-2003
       COPY GNSBGCPT.
      *MHM-FIN 23-OCT-2003
      *MHM-INI 25-JUL-2003
       COPY GARBGVCG.
       COPY GARBKVCG.
       COPY GNSBVTAB.
      *MHM-FIN 25-JUL-2003
       COPY GARBFGDG.
       COPY GARBFTAG.
*% IF PGM_CLB OR PGM_MEX
*%! IF PGM_MCP
       COPY TABBFEST.
       COPY TABBFMUN.
      * COPY TABBFCIU.
       COPY TABBFCPO.
       COPY TABBFIVB.
       COPY GARBFGAP.
       COPY GARBFGDD.
       COPY GARBFGDO.
       COPY GARBFGDP.
       COPY GARBFGES.
       COPY GARBFGIN.
       COPY GARBFGLE.
       COPY GARBFGMO.
       COPY GARBFGSE.
       COPY GARBFGSI.
       COPY GARBFGTP.
       COPY GARBFGVT.
       COPY GARBFGIM.
       COPY GARBFGVE.
       COPY GARBGVC2.
       COPY GNSBVCOD.
       COPY GNSBVTAB.
       COPY GARBGVDO.
       COPY GARBVVCG.
*% END
       COPY GNSBVCOD.
      *>>>>
*% END
