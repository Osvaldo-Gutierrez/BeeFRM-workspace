       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      LDCPLIRR.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    20-Mar-95 02:18 PM.

      * Programa Listador de Reporte IRR con Sort.



       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
           SELECT GNSSRT         ASSIGN TO 'SYS$DISK:'.
           SELECT RPTIRR	   ASSIGN TO RPTIRR.


       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY LDCRRIRR.

       FD  RPTIRR LABEL RECORDS OMITTED
           REPORT IS RPT-IRR

           .


       WORKING-STORAGE SECTION.
      *-----------------------
       COPY LDCBRCLF.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY LDCRWIRR.

       COPY LDCRNIRR.

       COPY LDCROIRR.

       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).

      *<<<< INI_WSS
       COPY LDCWGCCU.
       COPY TABBROFI.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY TABBRUSR.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY LDCBRLDC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LDC-REQA==.
       COPY LDCBRRDC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY SGCBRDBC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGCPT.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CPT-REQA==.
      *>>>>

       REPORT SECTION.
      *--------------
       COPY LDCRFIRR.

           .
       COPY LDCRTIRR.


       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
      *    09-MAR-95 06:09 PM     ,PAI=CHI ,CLI= ,SOP=MVS
       DEC-OLD-CH-IRR-CLF-COD-OFIC SECTION.
           USE BEFORE REPORTING CH-IRR-CLF-COD-OFIC.
       INI-OLD-CH-IRR-CLF-COD-OFIC.

       FIN-OLD-CH-IRR-CLF-COD-OFIC.
           EXIT.
       DEC-OLD-CH-IRR-CLF-COD-EJEC SECTION.
           USE BEFORE REPORTING CH-IRR-CLF-COD-EJEC.
       INI-OLD-CH-IRR-CLF-COD-EJEC.

       FIN-OLD-CH-IRR-CLF-COD-EJEC.
           EXIT.
       DEC-OLD-PH-IRR SECTION.
           USE BEFORE REPORTING PH-IRR.
       INI-OLD-PH-IRR.

       FIN-OLD-PH-IRR.
           EXIT.

       END DECLARATIVES.

       MAIN SECTION.
      *------------
       INI-MAIN.
           MOVE 'LDCPLIRR' TO FIO-PROG.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           SORT GNSSRT
       COPY LDCRSIRR.

           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.

           IF PGM-STAT-SRT-MAL
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           PERFORM LDC-FIO-CLF.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM LDC-FIO-CLF.
       FST-INP-SRT.

           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM LDC-FIO-CLF.

       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.

      *<<<< INI_LUP_INP
           IF CLF-MSC-STAT IN CLF NOT = 'A'
               GO TO NXT-INP-SRT.

           MOVE CLF-CAI-ICLF IN CLF TO CCU-CAI-ICLF.
           MOVE CLF-IIC-ICLF IN CLF TO CCU-IIC-ICLF.
           MOVE SPACES              TO CCU-CAI-IOPC(1).
           MOVE ZEROES              TO CCU-IIC-IOPC(1).
           MOVE SPACES              TO CCU-CAI-DCAN(1).
           MOVE ZEROES              TO CCU-IIC-DCAN(1).
           MOVE ZEROES              TO CCU-NUM-DCAN(1).
           MOVE SPACES              TO CCU-OPE-INDS.
           MOVE SPACES              TO CCU-CAI-ICLI.
           MOVE ZEROES              TO CCU-IIC-ICLI.
           CALL 'LDCSBCCU' USING CCU-CMMA.
           IF OK-OPCS-ANTIGUAS OR
              OK-CON-MENSAJE-OPCS-ANTIGUAS
               GO TO NXT-INP-SRT.

      *BUSCA NOMBRE CLIENTE
           MOVE CLF-CAI-ICLF IN CLF    TO RDC-CAI-ICLF IN RDC.
           MOVE CLF-IIC-ICLF IN CLF    TO RDC-IIC-ICLF IN RDC.
           MOVE 'RDC-KEY-ICLF' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM LDC-FIO-RDC.
           IF NOT ( FIO-STAT-OKS AND
                    RDC-CIC-ICLF IN RDC = CLF-CIC-ICLF IN CLF )
               DISPLAY 'CLF : ' RDC-CIC-ICLF IN RDC
               MOVE 'DEU'         TO MSG-COD-SIST
               MOVE 'RDC    NEX'  TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC  
           ELSE
               MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC
               MOVE FIO-GET-KEY  TO FIO-CMND
               PERFORM SGC-FIO-DBC
               IF NOT FIO-STAT-OKS
                   DISPLAY 'DBC : ' DBC-CIC-ICLI IN DBC
                   MOVE 'TAB'         TO MSG-COD-SIST
                   MOVE 'CLI    NEX'  TO MSG-COD-MENS
                   PERFORM GET-MSG
                   DISPLAY MSG-GLS-DESC 
               ELSE
                   MOVE DBC-GLS-NOMC IN DBC  TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC.

           MOVE ZEROES TO LDC-NUM-ILDC IN SRT.
           MOVE SPACES TO LDC-GLS-DCOR IN SRT.
           MOVE ZEROES TO WSS-NUM-DVEN IN SRT.
           MOVE ZEROES TO WSS-NUM-MVEN IN SRT.
           MOVE ZEROES TO WSS-NUM-SVEN IN SRT.
           MOVE ZEROES TO WSS-NUM-AVEN IN SRT.
           MOVE ZEROES TO SRT-VAL-EXCE IN SRT.
           MOVE SPACES TO WSS-NUM-NCRE IN SRT.

      * DLC RECHAZADO
           IF CCU-DLC-MALO IN CCU-VARI > SPACES
               MOVE CCU-DLC-MALO IN CCU-VARI TO WSS-NUM-NCRE IN SRT
               IF CCU-COD-MENS = 'OPCNOCLF' OR 'DLCMOROSO'
                   GO TO NXT-INP-SRT.
           
      * ERRORES AL NIVEL DE CLF

      * CLF EXCEDIDA
           IF CCU-VAL-CUTI IN CCU-VARI > CLF-VAL-CMAX IN CLF
               SUBTRACT CCU-VAL-CUTI IN CCU-VARI FROM
                        CLF-VAL-CMAX IN CLF GIVING
                        SRT-VAL-EXCE IN SRT
               GO TO NXT-INP-SRT.

      * CLF VENCIDA
           IF CCU-COD-MENS = 'CLFVENCIDA'
               MOVE CLF-NUM-DVEN IN CLF TO WSS-NUM-DVEN IN SRT
               MOVE CLF-NUM-MVEN IN CLF TO WSS-NUM-MVEN IN SRT
               MOVE CLF-NUM-SVEN IN CLF TO WSS-NUM-SVEN IN SRT
               MOVE CLF-NUM-AVEN IN CLF TO WSS-NUM-AVEN IN SRT
               GO TO NXT-INP-SRT.

      * ERRORES AL NIVEL DE LDC
      * BUSCAR NRO. LDC Y DESCRIPCION
           IF CCU-COD-MENS = 'VTODLC>LDC' OR 
                             'LDCEXCCOL' OR
                             'LDCEXCGAR' OR
                             'ARG    NEX' 
               PERFORM OBT-LDC-MALA
               GO TO NXT-INP-SRT.

      * TODOS LOS ERRORES
           MOVE 'DEU'         TO MSG-COD-SIST.
           MOVE CCU-COD-MENS  TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC  TO WSS-GLS-TERR IN SRT.

           GO TO NXT-INP-SRT.
      *>>>>
       MOV-INP-SRT.
       COPY LDCRMIRR.

           RELEASE SRT.
       NXT-INP-SRT.

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM LDC-FIO-CLF.

           GO TO LUP-INP-SRT.
       FIN-INP-SRT.

           MOVE FIO-CLO TO FIO-CMND.
           PERFORM LDC-FIO-CLF.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.

           OPEN OUTPUT RPTIRR.
      *     MOVE 'LDCPLIRR' TO RPT-NPGM.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-IRR.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           MOVE SRT TO SRT-OLD-IRR.
           MOVE SRT TO SRT-CUR-IRR.
           PERFORM FST-CTL-IRR.

       LUP-OUT-SRT.

      *<<<< INI_LUP_OUT
      *BUS-TAB busca glosa de codigo en tabla
           IF CLF-COD-VCCF IN SRT > SPACES
               MOVE 'TAB'  TO TAB-COD-SIST
               MOVE 'VLR ' TO TAB-COD-TTAB IN TAB
               MOVE CLF-COD-VCCF IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO
                    WSS-GLS-VCCF IN WSS-IRR
           ELSE
               MOVE SPACES TO WSS-GLS-VCCF IN WSS-IRR.
      *>>>>
       GEN-OUT-SRT.
           PERFORM CLR-CTL-IRR.
           PERFORM CHK-CTL-IRR.
           MOVE SRT TO SRT-CUR-IRR.
           MOVE SRT-OLD-IRR TO SRT.
           PERFORM PRO-CTL-CF-IRR.
           MOVE SRT-CUR-IRR TO SRT.
           PERFORM PRO-CTL-CH-IRR.
           GENERATE DL-IRR.

       NXT-OUT-SRT.
           MOVE SRT TO SRT-OLD-IRR.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.

           TERMINATE RPT-IRR.

           CLOSE RPTIRR.
       EXT-OUT-SRT.
           EXIT.
       COPY LDCBFCLF.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY LDCREIRR.
      *    09-MAR-95 06:09 PM     ,PAI=CHI ,CLI= ,SOP=MVS
       DEC-CH-IRR-CLF-COD-OFIC SECTION.
       INI-CH-IRR-CLF-COD-OFIC.

      *<<<< INI_CH_IRR_CLF_COD_OFIC
      *BUS-OFI busca oficina en tablas
           IF CLF-COD-OFIC IN SRT > SPACES
               MOVE CLF-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI 
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFIC
                                        IN WSS-IRR
           ELSE
               MOVE SPACES TO WSS-GLS-OFIC IN WSS-IRR.
      *>>>>
       FIN-CH-IRR-CLF-COD-OFIC.
           EXIT.
       DEC-CH-IRR-CLF-COD-EJEC SECTION.
       INI-CH-IRR-CLF-COD-EJEC.

      *<<<< INI_CH_IRR_CLF_COD_EJEC
      *BUS-USR busca usuario en tablas
           IF CLF-COD-EJEC IN SRT > SPACES
               MOVE CLF-COD-EJEC IN SRT TO USR-COD-USER IN USR
               PERFORM BUS-USR
               MOVE USR-GLS-DESC IN USR TO WSS-GLS-EJEC
                                        IN WSS-IRR
           ELSE
               MOVE SPACES TO WSS-GLS-EJEC IN WSS-IRR.
      *>>>>
       FIN-CH-IRR-CLF-COD-EJEC.
           EXIT.
       DEC-PH-IRR SECTION.
       INI-PH-IRR.

       FIN-PH-IRR.
           EXIT.
       COPY GNSBGABT.


      *<<<< EOF
       OBT-LDC-MALA SECTION.
       INI-OBT-LDC-MALA.
           MOVE ZEROES TO CCU-I.
       LUP-OBT-LDC-MALA.
           ADD 1 TO CCU-I.
           IF CCU-I > CCU-TLCR
               GO TO FIN-OBT-LDC-MALA.
           IF MENS-LCR(CCU-I) > SPACES
               MOVE CLF-KEY-ICLF IN CLF TO LDC-CIC-ICLF IN LDC
               MOVE CCU-I               TO LDC-NUM-ILDC IN LDC
               MOVE FIO-GET-KEY  TO FIO-CMND
               PERFORM LDC-FIO-LDC
               MOVE LDC-NUM-ILDC IN LDC TO LDC-NUM-ILDC IN SRT
               MOVE LDC-GLS-DCOR IN LDC TO LDC-GLS-DCOR IN SRT
               IF CCU-COD-MENS = 'VTODLC>LDC'
                   MOVE LDC-NUM-DVEN IN LDC TO WSS-NUM-DVEN IN SRT
                   MOVE LDC-NUM-MVEN IN LDC TO WSS-NUM-MVEN IN SRT
                   MOVE LDC-NUM-SVEN IN LDC TO WSS-NUM-SVEN IN SRT
                   MOVE LDC-NUM-AVEN IN LDC TO WSS-NUM-AVEN IN SRT
                   GO TO FIN-OBT-LDC-MALA.
           GO TO LUP-OBT-LDC-MALA.
       FIN-OBT-LDC-MALA.
           EXIT.

       COPY LDCBFLDC.
       COPY LDCBFRDC.

       COPY SGCBFDBC.

       COPY TABBBOFI.
       COPY TABBBUSR.
       COPY GNSBBTAB.
       COPY TABBFOFI.
       COPY TABBFUSR.
       COPY GNSBGCPT.
       COPY GNSBBMSG.
      *>>>>
