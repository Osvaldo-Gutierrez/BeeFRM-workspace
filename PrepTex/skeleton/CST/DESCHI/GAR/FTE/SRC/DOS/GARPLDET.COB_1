       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GARPLDET.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    25-Mar-92 12:30 PM.

      * Programa Listador de Reporte DET con Sort.

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
      *DOS SELECT RPTDET         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTDET         ASSIGN TO        UT-S-RPTDET.
           SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT RPTDET         ASSIGN TO        UT-S-RPTDET.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY GARRRDET.
      *<<<< RR
      *
       COPY GARRRDT2 REPLACING ==01  SRT== BY ==02  SRT-GDG==.
       COPY GARRRDT3 REPLACING ==01  SRT== BY ==02  SRT-GDD==.
       COPY GARRRDT4 REPLACING ==01  SRT== BY ==02  SRT-GLE==.
       COPY GARRRDT5 REPLACING ==01  SRT== BY ==02  SRT-GSE==.
       COPY GARRRDT6 REPLACING ==01  SRT== BY ==02  SRT-GVT==.
       COPY GARRRDT7 REPLACING ==01  SRT== BY ==02  SRT-GTP==.
       COPY GARRRDT8 REPLACING ==01  SRT== BY ==02  SRT-GUB==.
       COPY GARRRDT9 REPLACING ==01  SRT== BY ==02  SRT-GAP==.
       COPY GARRRD10 REPLACING ==01  SRT== BY ==02  SRT-GDO==.
      *>>>>
       FD  RPTDET LABEL RECORDS OMITTED
           REPORT IS RPT-DET
           .

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CLV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GARBRCLV.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GARRWDET.
      *<<<< RW
       COPY GARRWDT2.
       COPY GARRWDT3.
       COPY GARRWDT4.
       COPY GARRWDT5.
       COPY GARRWDT6.
       COPY GARRWDT7.
       COPY GARRWDT8.
       COPY GARRWDT9.
       COPY GARRWD10.
      *>>>>
       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
      *Entidades de GNS
       COPY GNSWGCPT.
      *Entidades de TAB
       COPY TABBROFI.
       COPY TABBRUSR.
       COPY TABBRCAM.
      *Entidades de SGC
       COPY SGCBRDBC.
      *Entidades de GAR
       COPY GARBRGDG.
       COPY GARBRGLE.
       COPY GARBRGES.
       COPY GARBRGSE.
       COPY GARBRGDD.
       COPY GARBRGVT.
       COPY GARBRGMO.
       COPY GARBRGUB.
       COPY GARBRGTP.
       COPY GARBRGAP.
       COPY GARBRGDO.

       01  WSS-VARI.
           03 WSS-FEC-FPRO.
               05 WSS-FEC-APRO        VALUE ZEROES PIC 9(04).
               05 WSS-FEC-MPRO        VALUE ZEROES PIC 9(02).
               05 WSS-FEC-DPRO        VALUE ZEROES PIC 9(02).
      *
           03 WSS-FEC-RVL.
               05 WSS-FD-RVL          VALUE ZEROES PIC 9(02).
               05 WSS-FM-RVL          VALUE ZEROES PIC 9(02).
               05 WSS-FA-RVL          VALUE ZEROES PIC 9(04).
      *
           03 WSS-COD-OFIC            VALUE SPACES PIC X(03).
           03 WSS-LINEA1              VALUE SPACES PIC X(01).
           03 WSS-LINEA2              VALUE SPACES PIC X(01).
           03 WSS-LINEA3              VALUE SPACES PIC X(01).
           03 WSS-LINEA4              VALUE SPACES PIC X(01).
           03 WSS-LINEA5              VALUE SPACES PIC X(01).
           03 WSS-LINEA6              VALUE SPACES PIC X(01).
           03 WSS-LINEA7              VALUE SPACES PIC X(01).
           03 WSS-LINEA8              VALUE SPACES PIC X(01).
           03 WSS-LINEA9              VALUE SPACES PIC X(01).
           03 WSS-LINEA10             VALUE SPACES PIC X(01).
      *
           03 WSS-MUL-GES             VALUE SPACES PIC X(01).
           03 WSS-STAT-GES            VALUE ZEROES PIC 9(01).
           03 WSS-MUL-GTP             VALUE SPACES PIC X(01).
           03 WSS-STAT-GTP            VALUE ZEROES PIC 9(01).
           03 WSS-MUL-GAP             VALUE SPACES PIC X(01).
           03 WSS-STAT-GAP            VALUE ZEROES PIC 9(01).
      *
           03 WSS-GLS-DETA.
               05 WSS-GLS1-DETA       VALUE SPACES PIC X(30).
               05 WSS-GLS2-DETA       VALUE SPACES PIC X(31).
      *
           03 WSS-COD-PESO            VALUE SPACES PIC X(06).
           03 WSS-VAL-PESO            VALUE ZEROES PIC 99999999999V9999.
      *
           03 WSS-FEC-FANO.
               05 WSS-FEC-SVLD        VALUE ZEROES PIC 9(02).
               05 WSS-FEC-AVLD        VALUE ZEROES PIC 9(02).
      *
           03 WSS-COD-TIT             VALUE ZEROES PIC 9(02).
      *
      *Variables utilizadas para los totales de control
           03 WSS-REG-LCLV            VALUE ZEROES PIC 9(05).
           03 WSS-REG-LGDG            VALUE ZEROES PIC 9(05).
           03 WSS-REG-ISRT            VALUE ZEROES PIC 9(05).
      *>>>>
      *<<<< WSS_DTC
      *Entidades de TAB
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *Entidades de GAR
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GLE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GTP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GUB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GMO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GES-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GAP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDO-REQA==.
      *Entidades de SGC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *Entidades de USR
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
      *>>>>

       REPORT SECTION.
      *--------------
       COPY GARRFDET.
           .
       COPY GARRTDET.
      *<<<< RT
       COPY GARRTDT2.
       COPY GARRTDT3.
       COPY GARRTDT4.
       COPY GARRTDT5.
       COPY GARRTDT6.
       COPY GARRTDT7.
       COPY GARRTDT8.
       COPY GARRTDT9.
       COPY GARRTD10.
      *>>>>

       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
       DEC-PH-DET SECTION.
           USE BEFORE REPORTING PH-DET.
       INI-PH-DET.
      *<<<< PH_DET
      *BUS-OFI Busca Codigo de Tabla
           IF GDG-COD-OFI IN SRT > SPACES
                MOVE 'TAB' TO TAB-COD-SIST
                MOVE 'OFI' TO TAB-COD-TTAB IN TAB
                MOVE SPACES TO OFI-COD-OFIC IN OFI
                MOVE GDG-COD-OFI IN SRT TO OFI-COD-OFIC IN OFI
                IF OFI-COD-OFIC > SPACES
                    PERFORM BUS-OFI
                    IF OFI-GLS-DESC > SPACES
                        MOVE OFI-GLS-DESC IN OFI TO
                             WSS-GLS-OFI IN WSS-DET
                    ELSE
                        MOVE SPACES TO WSS-GLS-OFI IN WSS-DET.
      *>>>>
       FIN-PH-DET.
           EXIT.
       END DECLARATIVES.

       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'GARPLDET' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      *<<<< INI

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'TAB'   TO FIO-SIST.
           PERFORM TAB-FIO-OFI.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'TAB'   TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-CAM.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'TAB'   TO FIO-SIST.
           PERFORM TAB-FIO-CAM.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GVT.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-GVT.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GDG.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-GDG.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GES.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-GES.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GLE.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-GLE.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GDD.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-GDD.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GMO.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-GMO.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GSE.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-GSE.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GAP.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-GAP.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GTP.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-GTP.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GDO.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-GDO.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GUB.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-GUB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'SGC'        TO FIO-SIST.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'SGC'   TO FIO-SIST.
           PERFORM SGC-FIO-DBC.

      *<<<<
           DISPLAY 'CODIGO DE GARANTIAS A LISTAR  : '.
           ACCEPT WSS-COD-TIT IN WSS-VARI.
           DISPLAY WSS-COD-TIT IN WSS-VARI.
      *BUS-TAB Busca Glosa de Titulo Para el Listado
           IF WSS-COD-TIT IN WSS-VARI > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'MSC' TO TAB-COD-TTAB IN TAB
               MOVE WSS-COD-TIT IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                  MOVE TAB-GLS-DESC IN TAB TO
                       WSS-GLS-TIT IN WSS-DET
               ELSE
                  MOVE SPACES TO WSS-GLS-TIT IN WSS-DET
           ELSE
               MOVE SPACES TO WSS-GLS-TIT IN WSS-DET.

      *Lee Tabla de Fechas de Proceso
           MOVE 'GAR' TO TAB-COD-SIST.
           MOVE 'GAR' TO FIO-SIST.
           MOVE 'TFP' TO TAB-COD-TTAB IN TAB.
           MOVE '01'  TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DAT1 TO WSS-FEC-FPRO IN WSS-VARI.

      *Vuelve Formato Fecha (SSAAMMDD) a Formato (DDMMSSAA)
           MOVE WSS-FEC-DPRO IN WSS-VARI TO WSS-FEC-DPRO IN WSS-DET.
           MOVE WSS-FEC-MPRO IN WSS-VARI TO WSS-FEC-MPRO IN WSS-DET.
           MOVE WSS-FEC-APRO IN WSS-VARI TO WSS-FEC-APRO IN WSS-DET.


      *>>>>
           SORT GNSSRT
       COPY GARRSDET.
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
      *<<<< FIN
           DISPLAY '  TOTALES DE CONTROL'
           DISPLAY '======================'
           DISPLAY 'REG. LEIDOS  CLV     : ' WSS-REG-LCLV.
           DISPLAY 'REG. LEIDOS  GDG     : ' WSS-REG-LGDG.
           DISPLAY 'REG. INGRES. AL SRT  : ' WSS-REG-ISRT.
           DISPLAY '======================'
      *>>>>
           PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<< INI_INP
      *Se salta la apertura del archivo base porque no permite
      *hacerle un FIO-ACC... a un archivo secuencial y tampoco
      *un FIO-GET-FST.
           GO TO FIN-FST-INP.
      *>>>>
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-CLV.
       FST-INP-SRT.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM GAR-FIO-CLV.
      *<<<< FIN_FST_INP
       FIN-FST-INP.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-CLV.

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-CLV.
      *>>>>
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
           ADD 1 TO WSS-REG-LCLV.

      *Busca Llaves del GDG
           MOVE GAR-NUM-SIS IN CLV TO GAR-NUM-SIS IN GDG.
           MOVE GAR-COD-CRR IN CLV TO GAR-COD-CRR IN GDG.
           MOVE 'GAR' TO FIO-SIST.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF NOT FIO-STAT-OKS
               GO TO FIN-INP-SRT
           ELSE
               ADD 1 TO WSS-REG-LGDG.

           ADD 1 TO WSS-REG-ISRT.

      *Busca Registro GLE
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GLE.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GLE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GLE.
           IF NOT FIO-STAT-OKS
                MOVE SPACES TO GLE.

           IF NOT FIO-STAT-OKS
               MOVE ZEROES TO GAR-FEC-PFN IN GLE
                              GAR-NUM-ICR IN GLE
                              GAR-ANO-ICR IN GLE
                              GAR-NUM-PHB IN GLE
                              GAR-ANO-PHB IN GLE.

      *Busca Registro GSE
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GSE.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GSE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GSE.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO GSE.
           IF NOT FIO-STAT-OKS
               MOVE ZEROES TO GAR-FEC-VTO-SEG IN GSE
                              GAR-FEC-VIG-SEG IN GSE
                              GAR-VAL-SEG IN GSE.
      *Busca Registro GVT
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GVT.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GVT.
           MOVE GAR-COD-TSN IN GDG TO GAR-COD-TSN IN GVT.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO GVT.

           IF NOT FIO-STAT-OKS
               MOVE ZEROES TO GAR-VAL-AJT-SUP IN GVT
                              GAR-VAL-CML-TSN IN GVT
                              GAR-VAL-LIQ-TSN IN GVT
                              GAR-PCT-PON IN GVT
                              GAR-VAL-PON IN GVT
                              GAR-FEC-TSN IN GVT
                              GAR-FEC-RVL IN GVT
                              GAR-COD-TSN IN GVT.

      *Busca Llaves del GUB
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GUB.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GUB.
           MOVE 'GAR' TO FIO-SIST.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GUB.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO GUB.

      *Busca Llaves del GDO
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GDO.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GDO.
           MOVE 'GAR' TO FIO-SIST.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GDO.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO GDO.

           IF NOT FIO-STAT-OKS
               MOVE ZEROES TO GAR-FD-CAP IN GDO.
      *>>>>
       MOV-INP-SRT.
       COPY GARRMDET.
      *<<<< RM
       COPY GARRMDT2.
       COPY GARRMDT4.
       COPY GARRMDT5.
       COPY GARRMDT6.
       COPY GARRMDT8.
       COPY GARRMD10.
      *>>>>
           RELEASE SRT.
       NXT-INP-SRT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-CLV.
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-CLV.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
           OPEN OUTPUT RPTDET.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-DET.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
       LUP-OUT-SRT.
      *<<<< LUP_OUT

      *Busca Rut del Dueno
           IF GDG-IIC-ICLI IN SRT > ZEROES
               MOVE SPACES TO DBC
               MOVE GDG-CAI-ICLI IN SRT TO DBC-CAI-ICLI
               MOVE GDG-IIC-ICLI IN SRT TO DBC-IIC-ICLI
               MOVE 'DBC-KEY-IDBC' TO FIO-AKEY
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM SGC-FIO-DBC
               IF FIO-STAT-OKS
                   MOVE DBC-IND-ICLI IN DBC TO WSS-IND-ICLI IN WSS-DET
                   MOVE DBC-GLS-ICLI IN DBC TO WSS-GLS-ICLI IN WSS-DET
                   MOVE DBC-NUM-ICLI IN DBC TO WSS-NUM-ICLI IN WSS-DET
                   MOVE DBC-VRF-ICLI IN DBC TO WSS-VRF-ICLI IN WSS-DET
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN TO WSS-GLS-NOMC IN WSS-DET
               ELSE
                   MOVE SPACES TO WSS-IND-ICLI IN WSS-DET
                                  WSS-GLS-ICLI IN WSS-DET
                   MOVE '0'    TO WSS-VRF-ICLI IN WSS-DET
                   MOVE ZEROES TO WSS-NUM-ICLI IN WSS-DET
                   MOVE SPACES TO WSS-GLS-NOMC IN WSS-DET
           ELSE
               MOVE SPACES TO WSS-IND-ICLI IN WSS-DET
                              WSS-GLS-ICLI IN WSS-DET
               MOVE '0'    TO WSS-VRF-ICLI IN WSS-DET
               MOVE ZEROES TO WSS-NUM-ICLI IN WSS-DET
               MOVE SPACES TO WSS-GLS-NOMC IN WSS-DET.

      *BUS-TAB Busca Glosa de Tabla Tipo de Operacion
           IF GDG-TIP-OPE IN SRT > SPACES
                MOVE 'TAB' TO TAB-COD-SIST
                MOVE 'TIO' TO TAB-COD-TTAB IN TAB
                MOVE SPACES TO TAB-COD-CTAB IN TAB
                MOVE GDG-TIP-OPE IN SRT TO TAB-COD-CTAB IN TAB
                PERFORM BUS-TAB
                IF MSG-COD-MENS = SPACES
                   MOVE TAB-GLS-DESC IN TAB TO
                        WSS-GLS-TIP-OPE IN WSS-DET
                ELSE
                   MOVE SPACES TO WSS-GLS-TIP-OPE IN WSS-DET
            ELSE
                MOVE SPACES TO WSS-GLS-TIP-OPE IN WSS-DET.

      *BUS-TAB Busca Glosa de Subtipo Garantia
           IF GDG-STP-OPE IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'AUX' TO TAB-COD-TTAB IN TAB
               MOVE SPACES TO TAB-COD-CTAB IN TAB
               STRING GDG-TIP-OPE IN SRT, GDG-STP-OPE IN SRT
                      DELIMITED BY SIZE INTO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES AND
                   GDG-STP-OPE IN SRT > SPACES
                      MOVE TAB-GLS-DESC IN TAB TO
                           WSS-GLS-STP-OPE IN WSS-DET
               ELSE
                  MOVE SPACES TO WSS-GLS-STP-OPE IN WSS-DET
           ELSE
               MOVE SPACES TO WSS-GLS-STP-OPE IN WSS-DET.
      *BUS-TAB Busca Glosa de Valor de Cambio
           IF GDG-VCB IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'VLR' TO TAB-COD-TTAB IN TAB
               MOVE SPACES TO TAB-COD-CTAB IN TAB
               MOVE GDG-VCB IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                  MOVE TAB-GLS-DESC IN TAB TO
                       WSS-GLS-VCB IN WSS-DET
               ELSE
                  MOVE SPACES TO WSS-GLS-VCB IN WSS-DET
           ELSE
               MOVE SPACES TO WSS-GLS-VCB IN WSS-DET.

      *BUS-TAB Busca Glosa de Limite de Garantia
           IF GDG-COD-LIM IN SRT > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'LIM' TO TAB-COD-TTAB IN TAB
               MOVE GDG-COD-LIM IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                  MOVE TAB-GLS-DESC IN TAB TO
                       WSS-GLS-LIM IN WSS-DET
               ELSE
                  MOVE SPACES TO WSS-GLS-LIM IN WSS-DET
           ELSE
               MOVE SPACES TO WSS-GLS-LIM IN WSS-DET.

      *BUS-TAB Busca Glosa de Autorizador de Alzamiento
           IF GDG-IIV-AUT-ES1 IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'ALZ' TO TAB-COD-TTAB IN TAB
               MOVE SPACES TO TAB-COD-CTAB IN TAB
               MOVE GDG-IIV-AUT-ES1 IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                   MOVE TAB-GLS-DCOR IN TAB TO
                        WSS-GLS-AUT-ALZ IN WSS-DET
               ELSE
                   MOVE  SPACES TO WSS-GLS-AUT-ALZ IN WSS-DET
           ELSE
               MOVE  SPACES TO WSS-GLS-AUT-ALZ IN WSS-DET.


      *BUS-TAB Busca Glosa de Abogado
           IF GLE-IIV-ABG IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'ABG' TO TAB-COD-TTAB IN TAB
               MOVE GLE-IIV-ABG IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                   MOVE TAB-GLS-DCOR IN TAB TO
                        WSS-GLS-ABG IN WSS-DT4
               ELSE
                   MOVE SPACES TO WSS-GLS-ABG IN WSS-DT4
           ELSE
               MOVE SPACES TO WSS-GLS-ABG IN WSS-DT4.
      *BUS-TAB Busca Nombre del Notario
           IF GLE-IIV-NTR IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'NOT' TO TAB-COD-TTAB IN TAB
               MOVE GLE-IIV-NTR IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                  MOVE TAB-GLS-DCOR IN TAB TO
                       WSS-GLS-NTR IN WSS-DT4
               ELSE
                  MOVE SPACES TO WSS-GLS-NTR IN WSS-DT4
           ELSE
               MOVE SPACES TO WSS-GLS-NTR IN WSS-DT4.


      *Mueve Glosa a campo Instrumento
           IF GLE-IND-PUB-PRV IN SRT > SPACES
               IF GLE-IND-PUB-PRV IN SRT = 'U'
                   MOVE 'PUBLICO' TO WSS-GLS-PUB-PRV IN WSS-DT4
               ELSE
                   IF GLE-IND-PUB-PRV IN SRT = 'V'
                       MOVE 'PRIVADO' TO WSS-GLS-PUB-PRV IN WSS-DT4
                   ELSE
                       MOVE SPACES TO WSS-GLS-PUB-PRV IN WSS-DT4
           ELSE
               MOVE SPACES TO WSS-GLS-PUB-PRV IN WSS-DT4.

      *BUS-TAB Busca Glosa de Compania de Seguros
           IF GSE-IIV-CIA-SEG IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'CSE' TO TAB-COD-TTAB IN TAB
               MOVE GSE-IIV-CIA-SEG IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                  MOVE TAB-GLS-DCOR IN TAB TO
                       WSS-GLS-CIA-SEG IN WSS-DT5
               ELSE
                  MOVE SPACES TO WSS-GLS-CIA-SEG IN WSS-DT5
           ELSE
               MOVE SPACES TO WSS-GLS-CIA-SEG IN WSS-DT5.

      *BUS-TAB Busca Glosa de Responsable de Tomar Seguro
           IF GSE-COD-RPB-SEG IN SRT > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'RPB' TO TAB-COD-TTAB IN TAB
               MOVE GSE-COD-RPB-SEG IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                  MOVE TAB-GLS-DCOR IN TAB TO
                       WSS-GLS-RPB-SEG IN WSS-DT5
               ELSE
                  MOVE SPACES TO WSS-GLS-RPB-SEG IN WSS-DT5
           ELSE
               MOVE SPACES TO WSS-GLS-RPB-SEG IN WSS-DT5.

      *BUS-TAB Busca Glosa de Corredor de Seguros
           IF GSE-IIV-CRD-SEG IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'SEG' TO TAB-COD-TTAB IN TAB
               MOVE GSE-IIV-CRD-SEG IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                  MOVE TAB-GLS-DCOR IN TAB TO
                       WSS-GLS-CRD-SEG IN WSS-DT5
               ELSE
                  MOVE SPACES TO WSS-GLS-CRD-SEG IN WSS-DT5
           ELSE
               MOVE SPACES TO WSS-GLS-CRD-SEG IN WSS-DT5.


      *BUS-TAB Busca Glosa de Valor de Cambio del Seguro
           IF GSE-VCB-SEG IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'VLR' TO TAB-COD-TTAB IN TAB
               MOVE SPACES TO TAB-COD-CTAB IN TAB
               MOVE GSE-VCB-SEG IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                    MOVE TAB-GLS-DCOR IN TAB TO
                         WSS-GLS-VCB-SEG IN WSS-DT5
               ELSE
                    MOVE SPACES TO WSS-GLS-VCB-SEG IN WSS-DT5
           ELSE
               MOVE SPACES TO WSS-GLS-VCB-SEG IN WSS-DT5.

      *BUS-TAB Busca Glosa de Cobertura de Seguro 1
           IF GSE-COD-COB-1 IN SRT > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'CBS' TO TAB-COD-TTAB IN TAB
               MOVE GSE-COD-COB-1 IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                   MOVE TAB-GLS-DCOR IN TAB TO
                        WSS-GLS-COB1 IN WSS-DT5
               ELSE
                   MOVE SPACES TO WSS-GLS-COB1 IN WSS-DT5
           ELSE
               MOVE SPACES TO WSS-GLS-COB1 IN WSS-DT5.

      *BUS-TAB Busca Glosa de Cobertura de Seguro 2
           IF GSE-COD-COB-2 IN SRT > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'CBS' TO TAB-COD-TTAB IN TAB
               MOVE GSE-COD-COB-2 IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                   MOVE TAB-GLS-DCOR IN TAB TO
                        WSS-GLS-COB2 IN WSS-DT5
               ELSE
                   MOVE SPACES TO WSS-GLS-COB2 IN WSS-DT5
           ELSE
               MOVE SPACES TO WSS-GLS-COB2 IN WSS-DT5.

      *BUS-TAB Busca Glosa de Cobertura de Seguro 3
           IF GSE-COD-COB-3 IN SRT > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'CBS' TO TAB-COD-TTAB IN TAB
               MOVE GSE-COD-COB-3 IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                   MOVE TAB-GLS-DCOR IN TAB TO
                        WSS-GLS-COB3 IN WSS-DT5
               ELSE
                   MOVE SPACES TO WSS-GLS-COB3 IN WSS-DT5
           ELSE
               MOVE SPACES TO WSS-GLS-COB3 IN WSS-DT5.

      *BUS-TAB Busca Glosa de Cobertura de Seguro 4
           IF GSE-COD-COB-4 IN SRT > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'CBS' TO TAB-COD-TTAB IN TAB
               MOVE GSE-COD-COB-4 IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                   MOVE TAB-GLS-DCOR IN TAB TO
                        WSS-GLS-COB4 IN WSS-DT5
               ELSE
                   MOVE SPACES TO WSS-GLS-COB4 IN WSS-DT5
           ELSE
               MOVE SPACES TO WSS-GLS-COB4 IN WSS-DT5.

      *BUS-TAB Busca Glosa de Cobertura de Seguro 5
           IF GSE-COD-COB-5 IN SRT > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'CBS' TO TAB-COD-TTAB IN TAB
               MOVE GSE-COD-COB-5 IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                   MOVE TAB-GLS-DCOR IN TAB TO
                        WSS-GLS-COB5 IN WSS-DT5
               ELSE
                   MOVE SPACES TO WSS-GLS-COB5 IN WSS-DT5
           ELSE
               MOVE SPACES TO WSS-GLS-COB5 IN WSS-DT5.

      *BUS-TAB Busca Glosa de Tipo de Construccion
           IF GVT-TIP-CTR IN SRT > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'CTR' TO TAB-COD-TTAB IN TAB
               MOVE GVT-TIP-CTR IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                    MOVE TAB-GLS-DESC IN TAB TO
                         WSS-GLS-TCTR IN WSS-DT6
               ELSE
                    MOVE SPACES TO WSS-GLS-TCTR IN WSS-DT6
           ELSE
               MOVE SPACES TO WSS-GLS-TCTR IN WSS-DT6.

      * CALCULA VALOR ULTIMA CONTABILIZACION
      * Obtiene Codigo Valor de Cambio de Pesos Mediante CIC de la Moned
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
      *     IF NOT FIO-STAT-OKS
      *         MOVE 'TAB'          TO MSG-COD-SIST
      *         MOVE 'CIC0999  NEX' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         MOVE MSG-GLS-DESC TO FRM-MENS
      *         MOVE FRM-SUAR-MAL TO FRM-SUAR.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS-VARI.

       INI-OBT-VAL-CON.
           MOVE GDG-VCB IN SRT TO GAR-VCB IN GDG.
           IF NOT (
              GAR-TIP-VCB IN GDG = '0' AND
              GDG-VCB IN SRT NOT = WSS-COD-PESO IN WSS-VARI
              )
               MOVE GVT-VAL-AJT-SUP IN SRT TO
                    WSS-VAL-ULT-CON IN WSS-DT6
               GO TO FIN-OBT-VAL-CON.

           MOVE GVT-FA-RVL   IN SRT      TO WSS-FEC-FANO.
           MOVE WSS-FEC-SVLD             TO CAM-NUM-SCAM IN CAM(1).
           MOVE WSS-FEC-AVLD             TO CAM-NUM-ACAM IN CAM(1).
           MOVE GVT-FM-RVL   IN SRT      TO CAM-NUM-MCAM IN CAM(1).
           MOVE GVT-FD-RVL   IN SRT      TO CAM-NUM-DCAM IN CAM(1).
           MOVE CAM-FEC-FCAM IN CAM(1)   TO CAM-FEC-FCAM IN CAM(2).
           MOVE GDG-VCB      IN SRT      TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT (
              FIO-STAT-OKS AND CAM-IND-VIGE IN CAM = 'S'
              )
                GO TO FIN-OBT-VAL-CON
      *         MOVE 'TAB'        TO MSG-COD-SIST
      *         MOVE 'CAM    NEX' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         MOVE MSG-GLS-DESC TO FRM-MENS
      *         MOVE FRM-SUAR-MAL TO FRM-SUAR
           ELSE
               MULTIPLY GVT-VAL-AJT-SUP IN SRT
                     BY CAM-SGV-VCAM    IN CAM
                 GIVING WSS-VAL-PESO ROUNDED
               MOVE WSS-VAL-PESO TO WSS-VAL-ULT-CON IN WSS-DT6.
       FIN-OBT-VAL-CON.

      *BUS-TAB Busca Glosa Codigo Supervisor
           IF GVT-IIV-SVS IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'TAS' TO TAB-COD-TTAB IN TAB
               MOVE GVT-IIV-SVS IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                   MOVE TAB-GLS-DCOR IN TAB TO
                        WSS-GLS-SVS IN WSS-DT6
               ELSE
                   MOVE SPACES TO WSS-GLS-SVS IN WSS-DT6
           ELSE
               MOVE SPACES TO WSS-GLS-SVS IN WSS-DT6.


      *BUS-TAB Busca Glosa Codigo de Tasador
           IF GVT-IIV-TSD IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'TAS' TO TAB-COD-TTAB IN TAB
               MOVE GVT-IIV-TSD IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                  MOVE TAB-GLS-DCOR IN TAB TO
                       WSS-GLS-TSD IN WSS-DT6
               ELSE
                  MOVE SPACES TO WSS-GLS-TSD IN WSS-DT6
           ELSE
               MOVE SPACES TO WSS-GLS-TSD IN WSS-DT6.



      *BUS-TAB Busca Glosa de Agente de Aduana
           IF GUB-IIV-AGT-ADN IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'AGT' TO TAB-COD-TTAB IN TAB
               MOVE GUB-IIV-AGT-ADN IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                  MOVE TAB-GLS-DCOR IN TAB TO
                       WSS-GLS-AGT-ADN IN WSS-DT8
              ELSE
                  MOVE SPACES TO WSS-GLS-AGT-ADN IN WSS-DT8
           ELSE
              MOVE SPACES TO WSS-GLS-AGT-ADN IN WSS-DT8.


      *BUS-TAB Busca Glosa de Comuna
           IF GUB-COD-CMN IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'COM' TO TAB-COD-TTAB IN TAB
               MOVE GUB-COD-CMN IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                   MOVE TAB-GLS-DCOR IN TAB TO
                        WSS-GLS-CMN IN WSS-DT8
               ELSE
                   MOVE SPACES TO WSS-GLS-CMN IN WSS-DT8
           ELSE
               MOVE SPACES TO WSS-GLS-CMN IN WSS-DT8.


      *BUS-TAB Busca Glosa de Ubicacion de Documento
           IF GUB-COD-UBI-DOC IN SRT > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'UUR' TO TAB-COD-TTAB IN TAB
               MOVE GUB-COD-UBI-DOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                   MOVE TAB-GLS-DCOR IN TAB TO
                        WSS-GLS-UBI-DOC IN WSS-DT8
               ELSE
                   MOVE SPACES TO WSS-GLS-UBI-DOC IN WSS-DT8
           ELSE
               MOVE SPACES TO WSS-GLS-UBI-DOC IN WSS-DT8.


      *BUS-TAB Busca Glosa de Almacenista
           IF GUB-IIV-ALM IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'ALM' TO TAB-COD-TTAB IN TAB
               MOVE GUB-IIV-ALM IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                  MOVE TAB-GLS-DCOR IN TAB TO
                       WSS-GLS-ALM IN WSS-DT8
               ELSE
                  MOVE SPACES TO WSS-GLS-ALM IN WSS-DT8
           ELSE
               MOVE SPACES TO WSS-GLS-ALM IN WSS-DT8.



      *BUS-TAB Busca Glosa de Tipo de Documento
           IF GDO-TIP-DOC IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'TIO' TO TAB-COD-TTAB IN TAB
               MOVE GDO-TIP-DOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                    MOVE TAB-GLS-DCOR IN TAB TO
                           WSS-GLS-TIP-DOC IN WSS-D10
               ELSE
                    MOVE SPACES TO WSS-GLS-TIP-DOC IN WSS-D10
           ELSE
               MOVE SPACES TO WSS-GLS-TIP-DOC IN WSS-D10.

      *BUS-TAB Busca Glosa de Institucion Emisora
           IF GDO-TIV-EMI IN SRT > SPACES
                MOVE 'TAB' TO TAB-COD-SIST
                MOVE GDO-TIV-EMI IN SRT TO TAB-COD-TTAB IN TAB
                MOVE SPACES TO TAB-COD-CTAB IN TAB
                STRING GDO-CIV-EMI IN SRT
                       GDO-SIV-EMI IN SRT
                       DELIMITED BY SIZE INTO TAB-COD-CTAB IN TAB
                PERFORM BUS-TAB
                IF MSG-COD-MENS = SPACES
                   MOVE TAB-GLS-DESC IN TAB TO
                        WSS-GLS-IIV-EMI IN WSS-D10
                ELSE
                   MOVE SPACES TO WSS-GLS-IIV-EMI IN WSS-D10
            ELSE
                MOVE SPACES TO WSS-GLS-IIV-EMI IN WSS-D10.

      *>>>>
       GEN-OUT-SRT.
           GENERATE DL-DET.
      *<<<< FIN_GEN_OUT
      *
      ***************** I M P R I M E   G D D *********************

           GENERATE HDR-GDD.

           MOVE GDG-NUM-SIS IN SRT TO GAR-NUM-SIS IN GDD.
           MOVE GDG-COD-CRR IN SRT TO GAR-COD-CRR IN GDD.
           MOVE 'GAR-CLV-GDD-2' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GAR-FIO-GDD.
           IF FIO-STAT-OKS AND
              GDG-NUM-SIS IN SRT = GAR-NUM-SIS IN GDD AND
              GDG-COD-CRR IN SRT = GAR-COD-CRR IN GDD
               PERFORM LUP-IMP-GDD
           ELSE
                PERFORM CLEAR-GDD
                MOVE 'NO TIENE DEUDORES ' TO WSS-MSG-DETA IN WSS-DT2
                GENERATE GDD-MSG.

      ***************** I M P R I M E  G E S *********************

           GENERATE HDR-GES.

           MOVE GDG-NUM-SIS IN SRT TO GAR-NUM-SIS IN GES.
           MOVE GDG-COD-CRR IN SRT TO GAR-COD-CRR IN GES.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GAR-FIO-GES.
           IF FIO-STAT-OKS AND
              GDG-NUM-SIS IN SRT = GAR-NUM-SIS IN GES AND
              GDG-COD-CRR IN SRT = GAR-COD-CRR IN GES
               PERFORM LUP-IMP-GES
           ELSE
                PERFORM CLEAR-GES
                MOVE SPACES TO WSS-GLS-DETA IN WSS-VARI
                MOVE 'NO  EXISTEN  DATOS  DE  ESPECI' TO
                     WSS-GLS1-DETA IN WSS-VARI
                MOVE 'FICACION  PARA  ESTA  GARANTIA'  TO
                     WSS-GLS2-DETA IN WSS-VARI
                MOVE WSS-GLS-DETA IN WSS-VARI TO
                     WSS-MSG-DETA IN WSS-DT3
                GENERATE GES-MSG.

       LIS-RESTO-1.
           GENERATE DL-DT4.
           GENERATE DL-DT5.
           GENERATE DL-DT6.

      ***************** I M P R I M E  G T P *********************

           GENERATE HDR-GTP.
           MOVE GDG-NUM-SIS IN SRT TO GAR-NUM-SIS IN GTP.
           MOVE GDG-COD-CRR IN SRT TO GAR-COD-CRR IN GTP.
           MOVE GDG-COD-TSN IN SRT TO GAR-COD-TSN IN GTP.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GAR-FIO-GTP.
           IF FIO-STAT-OKS AND
              GDG-NUM-SIS IN SRT = GAR-NUM-SIS IN GTP AND
              GDG-COD-CRR IN SRT = GAR-COD-CRR IN GTP
               PERFORM LUP-IMP-GTP
           ELSE
               PERFORM CLEAR-GTP
               MOVE SPACES TO WSS-GLS-DETA IN WSS-VARI
               MOVE 'NO  EXISTEN  TASACIONES  PARCI' TO
                    WSS-GLS1-DETA IN WSS-VARI
               MOVE 'ALES  PARA  ESTA  GARANTIA'  TO
                    WSS-GLS2-DETA IN WSS-VARI
               MOVE WSS-GLS-DETA IN WSS-VARI TO
                    WSS-MSG-DETA IN WSS-DT7
               GENERATE GTP-MSG.


       LIS-RESTO-2.
           GENERATE DL-DT8.

      ***************** I M P R I M E  G A P *********************

           GENERATE HDR-GAP.
           MOVE GDG-NUM-SIS IN SRT TO GAR-NUM-SIS IN GAP.
           MOVE GDG-COD-CRR IN SRT TO GAR-COD-CRR IN GAP.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GAR-FIO-GAP.
           IF FIO-STAT-OKS AND
              GDG-NUM-SIS IN SRT = GAR-NUM-SIS IN GAP AND
              GDG-COD-CRR IN SRT = GAR-COD-CRR IN GAP
               PERFORM LUP-IMP-GAP
           ELSE
               PERFORM CLEAR-GAP
               MOVE SPACES TO WSS-GLS-DETA IN WSS-VARI
               MOVE 'NO  EXISTEN  ACREEDORES  PREFE' TO
                    WSS-GLS1-DETA IN WSS-VARI
               MOVE 'RENCIALES  PARA  ESTA  GARANTIA'  TO
                    WSS-GLS2-DETA IN WSS-VARI
               MOVE WSS-GLS-DETA IN WSS-VARI TO
                    WSS-MSG-DETA IN WSS-DT9
               GENERATE GAP-MSG.

       LIS-RESTO-3.
           GENERATE DL-D10.
      *>>>>
       NXT-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
           TERMINATE RPT-DET.
           CLOSE RPTDET.
       EXT-OUT-SRT.
           EXIT.

       COPY GARBFCLV.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.

      *<<<< EOF

      ************************** G D D **************************
       LUP-IMP-GDD SECTION.
       INI-LUP-IMP-GDD.
      *   mueve datos
       COPY GARRMDT2.

      *Busca Rut y Nombre del Deudor
           IF GDD-IIC-ICLI IN SRT > ZEROES
               MOVE GDD-CAI-ICLI IN SRT TO DBC-CAI-ICLI
               MOVE GDD-IIC-ICLI IN SRT TO DBC-IIC-ICLI
               MOVE 'DBC-KEY-IDBC' TO FIO-AKEY
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM SGC-FIO-DBC
               IF FIO-STAT-OKS
                   MOVE DBC-IND-ICLI IN DBC TO WSS-IND-ICLI IN WSS-DT2
                   MOVE DBC-GLS-ICLI IN DBC TO WSS-GLS-ICLI IN WSS-DT2
                   MOVE DBC-NUM-ICLI IN DBC TO WSS-NUM-ICLI IN WSS-DT2
                   MOVE DBC-VRF-ICLI IN DBC TO WSS-VRF-ICLI IN WSS-DT2
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN TO WSS-GLS-NOMC IN WSS-DT2
               ELSE
                   MOVE SPACES TO WSS-IND-ICLI IN WSS-DT2
                                  WSS-GLS-ICLI IN WSS-DT2
                   MOVE '0'    TO WSS-VRF-ICLI IN WSS-DT2
                   MOVE ZEROES TO WSS-NUM-ICLI IN WSS-DT2
                   MOVE SPACES TO WSS-GLS-NOMC IN WSS-DT2
           ELSE
               MOVE SPACES TO WSS-IND-ICLI IN WSS-DT2
                              WSS-GLS-ICLI IN WSS-DT2
               MOVE '0'    TO WSS-VRF-ICLI IN WSS-DT2
               MOVE ZEROES TO WSS-NUM-ICLI IN WSS-DT2
               MOVE SPACES TO WSS-GLS-NOMC IN WSS-DT2.

      * imprime linea con datos de GDD
           GENERATE DL-DT2.

      *   lee siguiente
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GDD.
           IF FIO-STAT-OKS AND
              GDG-NUM-SIS IN SRT = GAR-NUM-SIS IN GDD AND
              GDG-COD-CRR IN SRT = GAR-COD-CRR IN GDD
               GO TO INI-LUP-IMP-GDD.
       FIN-LUP-IMP-GDD.
           EXIT.

       CLEAR-GDD SECTION.
       INI-CLEAR-GDD.
      *Limpia Registros del Reporte
           MOVE SPACES TO GDG-COD-EJE-ORI IN SRT.
           MOVE SPACES TO DBC-COD-EJEC IN SRT.
           MOVE ZEROES TO GDD-VAL-LIM-DDR IN SRT.
           MOVE ZEROES TO GDD-PCT-LIM-DDR IN SRT.
       FIN-CLEAR-GDD.
           EXIT.
      ************************** G E S **************************

       LUP-IMP-GES SECTION.
       INI-LUP-IMP-GES.

      *   mueve datos
       COPY GARRMDT3.

      *BUS-TAB Busca Glosa de Moneda de Credito
           IF GES-VCB-CDT IN SRT > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'VLR' TO TAB-COD-TTAB IN TAB
               MOVE SPACES TO TAB-COD-CTAB IN TAB
               MOVE GES-VCB-CDT IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                  MOVE TAB-GLS-DESC IN TAB TO
                       WSS-GLS-VCB-CDT IN WSS-DT3
               ELSE
                  MOVE SPACES TO WSS-GLS-VCB-CDT IN WSS-DT3
           ELSE
               MOVE SPACES TO WSS-GLS-VCB-CDT IN WSS-DT3.


      * imprime linea con datos de ges
           GENERATE DL-DT3.

      *   lee siguiente
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GES.
           IF FIO-STAT-OKS AND
              GDG-NUM-SIS IN SRT = GAR-NUM-SIS IN GES AND
              GDG-COD-CRR IN SRT = GAR-COD-CRR IN GES
               GO TO INI-LUP-IMP-GES.
       FIN-LUP-IMP-GES.
           EXIT.

       CLEAR-GES SECTION.
       INI-CLEAR-GES.
      *Limpia Registros del Reporte
           MOVE SPACES TO GES-VCB-CDT IN SRT.
           MOVE ZEROES TO GES-COD-ESP IN SRT.
           MOVE SPACES TO GDG-COD-TIP-ESP IN SRT.
           MOVE SPACES TO GES-CIC-IOPC IN SRT.
           MOVE SPACES TO GES-COD-DST-CDT IN SRT.
           MOVE SPACES TO GES-COD-SIS-CDT IN SRT.
           MOVE ZEROES TO GES-FD-VTO-CDT IN SRT.
           MOVE ZEROES TO GES-FM-VTO-CDT IN SRT.
           MOVE ZEROES TO GES-FA-VTO-CDT IN SRT.
           MOVE ZEROES TO GES-VAL-LIM-CDT IN SRT.
           MOVE ZEROES TO GES-PCT-LIM-CDT IN SRT.
       FIN-CLEAR-GES.
           EXIT.

      ************************** G T P **************************

       LUP-IMP-GTP SECTION.
       INI-LUP-IMP-GTP.
      *   mueve datos
       COPY GARRMDT7.

      *BUS-TAB Busca Glosa de Estado de la Garantia
           IF GTP-COD-EST-ITM IN SRT > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'ES1' TO TAB-COD-TTAB IN TAB
               MOVE GTP-COD-EST-ITM IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = SPACES
                  MOVE TAB-GLS-DESC IN TAB TO
                       WSS-GLS-EST-ITM IN WSS-DT7
               ELSE
                  MOVE SPACES TO WSS-GLS-EST-ITM IN WSS-DT7
           ELSE
               MOVE SPACES TO WSS-GLS-EST-ITM IN WSS-DT7.

      * imprime linea con datos de GTP
           GENERATE DL-DT7.

      *   lee siguiente
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GTP.
           IF FIO-STAT-OKS AND
              GDG-NUM-SIS IN SRT = GAR-NUM-SIS IN GTP AND
              GDG-COD-CRR IN SRT = GAR-COD-CRR IN GTP
               GO TO INI-LUP-IMP-GTP.
       FIN-LUP-IMP-GTP.
           EXIT.

       CLEAR-GTP SECTION.
       INI-CLEAR-GTP.
      *Limpia Registros del Reporte
           MOVE SPACES TO GTP-COD-ITM-TSN IN SRT.
           MOVE SPACES TO GTP-IDN-ITM-TSN IN SRT.
           MOVE ZEROES TO GTP-CTD-ITM-TSN IN SRT.
           MOVE ZEROES TO GTP-VAL-UNT-ITM IN SRT.
           MOVE ZEROES TO GTP-FD-CMB-EST IN SRT.
           MOVE ZEROES TO GTP-FM-CMB-EST IN SRT.
           MOVE ZEROES TO GTP-FA-CMB-EST IN SRT.
           MOVE SPACES TO GTP-COD-EST-ITM IN SRT.
       FIN-CLEAR-GTP.
           EXIT.

      ************************** G A P **************************

       LUP-IMP-GAP SECTION.
       INI-LUP-IMP-GAP.
      *   mueve datos
       COPY GARRMDT9.

      *Busca Rut y Nombre del Acreedor Preferente
           IF GAP-IIC-ICLI IN SRT > ZEROES
               MOVE GAP-CAI-ICLI IN SRT TO DBC-CAI-ICLI
               MOVE GAP-IIC-ICLI IN SRT TO DBC-IIC-ICLI
               MOVE 'DBC-KEY-IDBC' TO FIO-AKEY
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM SGC-FIO-DBC
               IF FIO-STAT-OKS
                   MOVE DBC-IND-ICLI IN DBC TO WSS-IND-ICLI IN WSS-DT9
                   MOVE DBC-GLS-ICLI IN DBC TO WSS-GLS-ICLI IN WSS-DT9
                   MOVE DBC-NUM-ICLI IN DBC TO WSS-NUM-ICLI IN WSS-DT9
                   MOVE DBC-VRF-ICLI IN DBC TO WSS-VRF-ICLI IN WSS-DT9
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN TO WSS-GLS-NOMC IN WSS-DT9
               ELSE
                   MOVE SPACES TO WSS-IND-ICLI IN WSS-DT9
                                  WSS-GLS-ICLI IN WSS-DT9
                   MOVE '0'    TO WSS-VRF-ICLI IN WSS-DT9
                   MOVE ZEROES TO WSS-NUM-ICLI IN WSS-DT9
                   MOVE SPACES TO WSS-GLS-NOMC IN WSS-DT9
           ELSE
               MOVE SPACES TO WSS-IND-ICLI IN WSS-DT9
                              WSS-GLS-ICLI IN WSS-DT9
               MOVE '0'    TO WSS-VRF-ICLI IN WSS-DT9
               MOVE ZEROES TO WSS-NUM-ICLI IN WSS-DT9
               MOVE SPACES TO WSS-GLS-NOMC IN WSS-DT9.

      * imprime linea con datos de GAP
           GENERATE DL-DT9.

      *   lee siguiente
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GAP.
           IF FIO-STAT-OKS AND
              GDG-NUM-SIS IN SRT = GAR-NUM-SIS IN GAP AND
              GDG-COD-CRR IN SRT = GAR-COD-CRR IN GAP
               GO TO INI-LUP-IMP-GAP.
       FIN-LUP-IMP-GAP.
           EXIT.

       CLEAR-GAP SECTION.
       INI-CLEAR-GAP.
      *Limpia Registros del Reporte
           MOVE SPACES TO GAP-CAI-ICLI IN SRT.
           MOVE SPACES TO GAP-IIC-ICLI IN SRT.
           MOVE SPACES TO GAP-COD-PRD-ACR IN SRT.
           MOVE SPACES TO GAP-FOJ-ICR-ACR IN SRT.
           MOVE ZEROES TO GAP-NUM-ICR-ACR IN SRT.
           MOVE ZEROES TO GAP-ANO-ICR-ACR IN SRT.
           MOVE ZEROES TO GAP-VAL-ACR-PRF IN SRT.
       FIN-CLEAR-GAP.
           EXIT.
      **************************************************

      *Entidades de SGC
       COPY SGCBFDBC.

      *Entidades de GAR
       COPY GARBFGDG.
       COPY GARBFGDD.
       COPY GARBFGVT.
       COPY GARBFGSE.
       COPY GARBFGES.
       COPY GARBFGLE.
       COPY GARBFGMO.
       COPY GARBFGUB.
       COPY GARBFGAP.
       COPY GARBFGDO.
       COPY GARBFGTP.

      *Entidades de TAB
       COPY TABBFOFI.
       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY TABBBUSR.
       COPY TABBFUSR.
       COPY TABBFCAM.

      *Entidades de GNS
       COPY GNSBBTAB.
       COPY GNSBBMSG.
       COPY GNSBGCPT.
      *>>>>

