       IDENTIFICATION DIVISION.
       PROGRAM-ID.    GARPBEMV.
       AUTHOR.        G. URETA Q.
       DATE-WRITTEN.  OCT 22,1987.
       DATE-COMPILED.

                PGM. COBOL+DATACOM QUE ES UNA
                INTERFASE  DE  GARANTIAS CON
                COMERCIO EXTERIOR (COMEX).

                SON UTILIZADAS LAS TABLAS :

                    + INPUT

                      - EMV

                    + INPUT-OUTPUT

                      - ECL

                    + OUTPUT

                      - GMO
                      - GDG
                      - GDD
                      - GVT
                      - GES

       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
             C01 IS PAGINA
             DECIMAL-POINT IS COMMA.

       DATA DIVISION.

       WORKING-STORAGE SECTION.

       77    WK-CONT-INGR-ACEP         PIC 9(05)  VALUE 0.
       77    WK-CONT-INGR-RECH         PIC 9(05)  VALUE 0.
       77    WK-CONT-EGRE-ACEP         PIC 9(05)  VALUE 0.
       77    WK-CONT-EGRE-RECH         PIC 9(05)  VALUE 0.
       77    WK-CONT-REG-GRAB-RECH     PIC 9(05)  VALUE 0.
       77    WK-CONT-EMV-LEIDOS        PIC 9(05)  VALUE 0.
       77    WK-CONT-MOV-GDG           PIC 9(05)  VALUE 0.
       77    WK-CONT-MOV-GVT           PIC 9(05)  VALUE 0.
       77    WK-CONT-GRB-GVT           PIC 9(05)  VALUE 0.
       77    WK-CONT-MOV-ALZ           PIC 9(05)  VALUE 0.
       77    WK-CONT-CLT-ELIM          PIC 9(05)  VALUE 0.
       77    WK-NUM-TSN                PIC 9(03).
       77    WK-VAL-REDONDEO           PIC S9(11)V999 COMP-3 VALUE +0.
       77    WK-GAR-VAL-CML-N          PIC S9(11)V999        VALUE +0.
       77    WK-GAR-VAL-LIQ-N          PIC S9(11)V999        VALUE +0.
       77    WK-GAR-VAL-PON-N          PIC S9(11)V999        VALUE +0.
       77    WK-GAR-VAL-CML-A          PIC S9(11)V999        VALUE +0.
       77    WK-GAR-VAL-LIQ-A          PIC S9(11)V999        VALUE +0.
       77    WK-GAR-VAL-PON-A          PIC S9(11)V999        VALUE +0.
       77    WK-NUM-CORREL-MVTO        PIC 9(03)             VALUE 0.
       77    CTD-PAG                   PIC 9(02)             VALUE 0.
       77    CTD-LINEAS                PIC 9(02)             VALUE 99.
       01    WK-ALZAM                  PIC X(01)  VALUE SPACES.
       01    WK-COD-MON                PIC X(03)  VALUE SPACES.
       01    WK-IND-MOV                PIC X(01)  VALUE SPACES.

       01  PGM-VAR-ADIC.
           03 PGM-STAT-ADIC.
              05 PGM-STAT-DBC        VALUE '23'   PIC X(02).
                 88 PGM-STAT-DBC-OKS VALUE '00'.
                 88 PGM-STAT-DBC-NUL VALUE '  '.

       01    WK-FEC.
             03 SEP-SS                 PIC X(02).
             03 SEP-AA                 PIC X(02).
             03 SEP-MM                 PIC X(02).
             03 SEP-DD                 PIC X(02).

       01    WK-CODIG-C.
             03 WK-COD-VLR.
                05 WK-TIP-VCB          PIC X(01).
                05 WK-COD-VCB          PIC X(03).
                05 WK-TIP-CMB          PIC X(02).
             03 WK-ENT-DEC             PIC X(01).
             03 WK-COD-MON-CTBLE.
                05 WK-TIP-VCB-CTB      PIC X(01).
                05 WK-COD-VCB-CTB      PIC X(03).
                05 WK-TIP-CMB-CTB      PIC X(02).
             03 WK-COD-TIP             PIC X(03).
             03 WK-COD-STP             PIC X(03).
             03 FILLER                 PIC X(04).

       01    WK-FECHA-CURRENT.
             03 WK-MES                 PIC 9(02).
             03 FILLER                 PIC X(01).
             03 WK-DIA                 PIC 9(02).
             03 FILLER                 PIC X(01).
             03 WK-ANO                 PIC 9(02).

       01    WK-FECHA-SSAAMMDD.
             03 WK-SS                  PIC 9(02)  VALUE 19.
             03 WK-AA                  PIC 9(02).
             03 WK-MM                  PIC 9(02).
             03 WK-DD                  PIC 9(02).

      * Variables para usar PRO-CIC
       01  VAR-CIC-ADI.
           03 FRM-MENS                PIC X(01).
           03 FRM-SUAR-MAL             PIC X(01).
           03 FRM-SUAR                 PIC X(01).

       COPY GNSWVFIO.
       COPY GNSWCFIO.
       COPY GNSWVIDD.
       COPY GNSWGHOY.
      * COPY GNSWGFEC.
       COPY GNSWGSYS.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSBRMSG.
       COPY GNSBRTAB.
       COPY GNSBRERR.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EMV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ECL-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GMO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GES-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RES-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.

       COPY GARBREMV.
       COPY GARBRECL.
       COPY GARBRGDD.
       COPY GARBRGDG.
       COPY GARBRGVT.
       COPY GARBRGMO.
       COPY GARBRGES.
       COPY GARBRTAG.
       COPY GARBRRCH.

       COPY SGCBRDBC.

       COPY GNSWGCIC.
       COPY GNSBRCIC.
       COPY GNSWCVRF.
       COPY GNSWVVRF.

       01   LINEA-TIT1.
            03 FILLER  PIC X(46) VALUE 'BANCO DE CREDITO E INVERSIONES'.
            03 FILLER  PIC X(35) VALUE 'INFORME  DE  RECHAZOS'.
            03 FILLER  PIC X(36) VALUE 'PGM: GARPBEMV'.
            03 FILLER  PIC X(07) VALUE 'FECHA: '.
            03 LT1-FECHA         PIC X(08).

       01   LINEA-TIT2.
            03 FILLER  PIC X(46) VALUE '   SISTEMA  DE  GARANTIAS'.
            03 FILLER  PIC X(35) VALUE '====================='.
            03 FILLER  PIC X(35) VALUE SPACES.
            03 FILLER  PIC X(10) VALUE 'PAGINA:   '.
            03 LT2-PAG PIC Z9.

       01   LINEA-TIT3.
            03 FILLER  PIC X(133) VALUE ALL '-'.

       01   LINEA-TIT4.
            03 FILLER  PIC X(32) VALUE ' R.U.T. DV  MON MOV FECHA MOV'.
            03 FILLER  PIC X(37) VALUE 'OFI FECHA EMIS  COD.CREDITO'.
            03 FILLER  PIC X(16) VALUE 'V A L O R'.
            03 FILLER  PIC X(22) VALUE 'M E N S A J E   D E   '.
            03 FILLER  PIC X(13) VALUE 'R E C H A Z O'.

       01   LINEA-DETALLE.
            03 LD-RUT            PIC X(08).
            03 FILLER            PIC X(01)  VALUE '-'.
            03 LD-VRF            PIC X(01).
            03 FILLER            PIC X(02)  VALUE SPACES.
            03 LD-COD-MON        PIC X(03).
            03 FILLER            PIC X(02)  VALUE SPACES.
            03 LD-COD-MOV        PIC X(01).
            03 FILLER            PIC X(02)  VALUE SPACES.
            03 LD-FD-MOV         PIC X(02).
            03 FILLER            PIC X(01)  VALUE '-'.
            03 LD-FM-MOV         PIC X(02).
            03 FILLER            PIC X(01)  VALUE '-'.
            03 LD-FA-MOV         PIC X(04).
            03 FILLER            PIC X(02)  VALUE SPACES.
            03 LD-COD-OFI        PIC X(03).
            03 FILLER            PIC X(01)  VALUE SPACES.
            03 LD-FD-EMI         PIC X(02).
            03 FILLER            PIC X(01)  VALUE '-'.
            03 LD-FM-EMI         PIC X(02).
            03 FILLER            PIC X(01)  VALUE '-'.
            03 LD-FA-EMI         PIC X(04).
            03 FILLER            PIC X(02)  VALUE SPACES.
            03 LD-COD-CREDITO    PIC X(12)  VALUE SPACES.
            03 FILLER            PIC X(01)  VALUE SPACES.
            03 LD-VAL            PIC ZZ.ZZZ.ZZZ.ZZ9,999.
            03 FILLER            PIC X(02)  VALUE SPACES.
            03 LD-GLOSA          PIC X(50).

       01   WK-GLOSA-ERROR.
            03 WK-GLOSA-ERR      PIC X(30).
            03 FILLER            PIC X(09)  VALUE 'RET.CODE='.
            03 WK-RET-COD        PIC X(02).
            03 WK-MSG            PIC X(09).

       01   LINEA-BLANCOS.
            03 FILLER            PIC X(132) VALUE SPACES.
      *------------------------------------------------------------*
      *                *
      *                   PROGRAMA PRINCIPAL *
      *                *
      *------------------------------------------------------------*

       PROCEDURE DIVISION.
      *-------------------
       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.
           PERFORM INI.
           IF NOT FIO-STAT-OKS
               GO TO FIN-MAIN.


           PERFORM ACTUALIZA UNTIL NOT FIO-STAT-OKS.

       FIN-MAIN.
           PERFORM TERMINAR.
       COPY GNSBGGBK.

       INI SECTION.
       INI-INI.
           MOVE 'GARPBEMV' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
           MOVE ERR-TERR-LGC IN ERR-VARI TO ERR-COD-TERR IN ERR.
           MOVE 'GARPBEMV'               TO ERR-COD-ATRN IN ERR.
           MOVE ERR-TTRN-BAT IN ERR-VARI TO ERR-MSC-TTRN IN ERR.
           MOVE ERR-SVRT-FAT IN ERR-VARI TO ERR-IND-SVRT IN ERR.
           MOVE 'M' TO ERR-MSC-TACC IN ERR.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-EMV.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-TAG.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-CIC.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GNS-FIO-CIC.
           MOVE FIO-UPD TO FIO-CMND.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           PERFORM GAR-FIO-ECL.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDD.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               GO TO FIN-INI.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GES.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.

           MOVE FIO-OUT TO FIO-CMND.
           PERFORM GAR-FIO-RCH.
           IF NOT FIO-STAT-OKS
               PERFORM PRO-ERR
               PERFORM PRG-ABT.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

      * BUS-TAB TABLA DE FECHAS DE PROCESO
           MOVE 'GAR' TO TAB-COD-SIST.
           MOVE 'GAR' TO FIO-SIST.
           MOVE 'TFP' TO TAB-COD-TTAB IN TAB.
           MOVE '01'  TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DAT1 TO WK-FEC
           ELSE
              MOVE 'TABTFPNEX'  TO ERR-COD-MENS IN ERR
              MOVE TAB-COD-CTAB TO ERR-COD-CMPO IN ERR
              MOVE SPACES       TO ADR-REQA
              PERFORM PRO-ERR
              PERFORM PRG-ABT.

           DISPLAY 'GARPBEMV : '.
           DISPLAY ' '.
           DISPLAY 'FECHA PROCESO : ' WK-FEC.

           MOVE SEP-AA           TO WK-ANO.
           MOVE SEP-MM           TO WK-MES.
           MOVE SEP-DD           TO WK-DIA.

           MOVE WK-DIA           TO WK-DD.
           MOVE WK-MES           TO WK-MM.
           MOVE WK-ANO           TO WK-AA.
           MOVE WK-DD            TO WK-MES.
           MOVE WK-MM            TO WK-DIA.
           MOVE WK-FECHA-CURRENT TO LT1-FECHA.

      * POSICIONA EMV.

           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM GAR-FIO-EMV.
           IF NOT FIO-STAT-OKS
               MOVE ERR-SVRT-ADV IN ERR-VARI TO ERR-IND-SVRT IN ERR
               MOVE 'EMV    NEX'    TO ERR-COD-MENS IN ERR
               MOVE SPACES          TO ERR-COD-CMPO IN ERR
               MOVE ADR-EMV-REQA    TO ADR-REQA
               PERFORM PRO-ERR
               PERFORM PRG-ABT
           ELSE
               MOVE ERR-SVRT-REC IN ERR-VARI TO ERR-IND-SVRT IN ERR.
           PERFORM GET-FHOY.
       FIN-INI.
           EXIT.

       ACTUALIZA SECTION.
       INI-ACTUALIZA.
           ADD 1 TO WK-CONT-EMV-LEIDOS.
           IF CEX-COD-MON IN EMV NOT = WK-COD-MON
              PERFORM OBTIENE-VLR
              IF NOT FIO-STAT-OKS
                  GO TO NXT-ACTUALIZA.

       LEE-ECL.
           MOVE FIO-ULK-REC TO FIO-CMND.
           PERFORM GAR-FIO-ECL.
           MOVE CEX-COP-CDT IN EMV TO GAR-COD-CLV-ESP IN ECL.
           MOVE CEX-COD-MON IN EMV TO GAR-COD-MON-CDT IN ECL.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-ECL.

           IF CEX-COD-MOV IN EMV = 'I'
              IF FIO-STAT-OKS
                 PERFORM RETASACION
                 IF FIO-STAT-OKS
                     ADD 1 TO WK-CONT-INGR-ACEP
                 ELSE
                     GO TO NXT-ACTUALIZA
              ELSE
                 IF FIO-STAT = FIO-STAT-NEX
                    PERFORM OBT-CIC
                    PERFORM GRABA-ECL
                    PERFORM BUS-CLI
                    PERFORM GRABA-GDG
                    PERFORM GRABA-GDD
                    PERFORM GRABA-GVT
                    PERFORM GRABA-GES
                    PERFORM GRABA-GMO
                    ADD 1 TO WK-CONT-INGR-ACEP
                 ELSE
                    MOVE EMV TO RCH-PARTE-EMV
                    MOVE 'ERROR AL LEER ECL' TO WK-GLOSA-ERR
                    MOVE FIO-STAT            TO WK-RET-COD
                    MOVE ' REG.IGN'          TO WK-MSG
                    MOVE WK-GLOSA-ERROR      TO LD-GLOSA RCH-MSG-ERR
                    PERFORM GRABA-RECHAZO
                    MOVE ' ' TO WK-IND-MOV
                    PERFORM MUEVE-CAMPOS
                    DISPLAY LINEA-DETALLE
           ELSE
              IF FIO-STAT-OKS
                 PERFORM RETASACION
                 IF FIO-STAT-OKS
                     ADD 1 TO WK-CONT-EGRE-ACEP
                 ELSE
                     GO TO NXT-ACTUALIZA
              ELSE
                 MOVE EMV TO RCH-PARTE-EMV
                 MOVE 'MVTO. DE SALIDA SIN GARANTIA ASOCIADA'
                      TO LD-GLOSA RCH-MSG-ERR
                 PERFORM GRABA-RECHAZO
                 DISPLAY ' '
                 MOVE ' ' TO WK-IND-MOV
                 PERFORM MUEVE-CAMPOS
                 DISPLAY LINEA-DETALLE.

       NXT-ACTUALIZA.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-EMV.

       FIN-ACTUALIZA.
           EXIT.

       OBTIENE-VLR SECTION.
       INI-OBTIENE-VLR.

      * BUS-TAB TABLA DE MONEDAS COBRANZAS / COMEX
           MOVE 'GAR' TO TAB-COD-SIST.
           MOVE 'GAR' TO FIO-SIST.
           MOVE 'TMC'          TO TAB-COD-TTAB IN TAB.
           MOVE SPACES TO TAB-COD-CTAB.
           STRING CEX-COD-MON     IN EMV,
                  CEX-TIP-GAR-SUP IN EMV,
                  CEX-STP-GAR-SUP IN EMV DELIMITED BY SIZE INTO
               TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DATA TO WK-CODIG-C
               MOVE CEX-COD-MON IN EMV TO WK-COD-MON
           ELSE
              MOVE EMV TO RCH-PARTE-EMV
              MOVE 'ERROR AL LEER MONEDA (TMC)' TO WK-GLOSA-ERR
              MOVE WK-GLOSA-ERROR               TO LD-GLOSA RCH-MSG-ERR
              MOVE ' ' TO WK-IND-MOV
              PERFORM GRABA-RECHAZO
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY LINEA-DETALLE.
       FIN-OBTIENE-VLR.
           EXIT.

       RETASACION SECTION.
       INI-RETASACION.
           MOVE GAR-NUM-SIS IN ECL TO GAR-NUM-SIS IN GDG.
           MOVE GAR-COD-CRR IN ECL TO GAR-COD-CRR IN GDG.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF NOT FIO-STAT-OKS
              MOVE EMV TO RCH-PARTE-EMV
              MOVE 'NO ENCONTRO REG. GDG '  TO WK-GLOSA-ERR
              MOVE FIO-STAT                 TO WK-RET-COD
              MOVE ' REG.IGN'               TO WK-MSG
              MOVE WK-GLOSA-ERROR           TO LD-GLOSA RCH-MSG-ERR
              MOVE ' ' TO WK-IND-MOV
              PERFORM GRABA-RECHAZO
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY LINEA-DETALLE
              GO TO FIN-RETASACION.

      *    REVISA SI LA GARANTIA NO FUE ALZADA
           IF GAR-ES1 IN GDG NOT < '20'
              MOVE ' '    TO WK-IND-MOV
              MOVE EMV TO RCH-PARTE-EMV
              MOVE 'GARANTIA ALZADA, REG.IGNORADO' TO RCH-MSG-ERR
              PERFORM GRABA-RECHAZO
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              MOVE 'GARANTIA ALZADA      ' TO WK-GLOSA-ERR
              MOVE FIO-STAT                TO WK-RET-COD
              MOVE ' REG.IGN'              TO WK-MSG
              MOVE WK-GLOSA-ERROR          TO LD-GLOSA
              DISPLAY LINEA-DETALLE
              MOVE FIO-STAT-NEX TO FIO-STAT
              GO TO FIN-RETASACION.

           MOVE GAR-NUM-SIS IN ECL TO GAR-NUM-SIS IN GVT.
           MOVE GAR-COD-CRR IN ECL TO GAR-COD-CRR IN GVT.
           MOVE GAR-COD-TSN IN GDG TO GAR-COD-TSN IN GVT.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           IF NOT FIO-STAT-OKS
              MOVE FIO-ULK-REC TO FIO-CMND
              PERFORM GAR-FIO-GDG
              MOVE EMV TO RCH-PARTE-EMV
              MOVE 'NO ENCONTRO REG. GVT '    TO WK-GLOSA-ERR
              MOVE FIO-STAT                   TO WK-RET-COD
              MOVE ' REG.IGN'                 TO WK-MSG
              MOVE WK-GLOSA-ERROR             TO LD-GLOSA RCH-MSG-ERR
              MOVE ' ' TO WK-IND-MOV
              PERFORM GRABA-RECHAZO
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY LINEA-DETALLE
              GO TO FIN-RETASACION.

           MOVE GAR-VAL-CML-TSN IN GVT TO WK-GAR-VAL-CML-A.
           MOVE GAR-VAL-LIQ-TSN IN GVT TO WK-GAR-VAL-LIQ-A.
           MOVE GAR-VAL-PON     IN GVT TO WK-GAR-VAL-PON-A.
           MOVE GAR-COD-TSN     IN GDG TO WK-NUM-TSN.
           IF CEX-COD-MOV IN EMV = 'I'
              ADD  CEX-VAL-CDT IN EMV TO GAR-VAL-CML-TSN IN GVT
                                         GAR-VAL-LIQ-TSN IN GVT
           ELSE
              SUBTRACT CEX-VAL-CDT IN EMV FROM GAR-VAL-CML-TSN
                                                 IN GVT
              SUBTRACT CEX-VAL-CDT IN EMV FROM GAR-VAL-LIQ-TSN
                                                 IN GVT.

           IF CEX-COD-MOV IN EMV = 'T' AND
              (GAR-VAL-CML-TSN IN GVT NOT =  ZEROES)
                 MOVE ZEROES TO GAR-VAL-CML-TSN IN GVT
                 MOVE EMV TO RCH-PARTE-EMV
                 MOVE '** ERROR : VALOR EGRESO > VALOR COMERCIAL '
                      TO LD-GLOSA RCH-MSG-ERR
                 PERFORM GRABA-RECHAZO
                 DISPLAY ' '
                 PERFORM MUEVE-CAMPOS
                 DISPLAY LINEA-DETALLE.

           IF CEX-COD-MOV IN EMV = 'S' AND
              (GAR-VAL-CML-TSN IN GVT < ZEROES)
                 MOVE ZEROES TO GAR-VAL-CML-TSN IN GVT
                 MOVE EMV TO RCH-PARTE-EMV
                 MOVE '** ERROR : VALOR EGRESO > VALOR COMERCIAL'
                      TO LD-GLOSA RCH-MSG-ERR
                 PERFORM GRABA-RECHAZO
                 DISPLAY ' '
                 PERFORM MUEVE-CAMPOS
                 DISPLAY LINEA-DETALLE.

           IF CEX-COD-MOV IN EMV = 'T' AND
              (GAR-VAL-LIQ-TSN IN GVT NOT =  ZEROES)
                 MOVE ZEROES TO GAR-VAL-LIQ-TSN IN GVT.

           IF CEX-COD-MOV IN EMV = 'S' AND
              (GAR-VAL-LIQ-TSN IN GVT < ZEROES)
                 MOVE ZEROES TO GAR-VAL-LIQ-TSN IN GVT.

           COMPUTE GAR-VAL-PON IN GVT = (GAR-VAL-LIQ-TSN IN GVT *
                     GAR-PCT-PON IN GVT) / 100.

           PERFORM OBTENER-PORC-POND.
           MOVE GAR-PCT-AJT-SUP IN TAG TO GAR-PCT-AJT-SUP IN GVT.
           COMPUTE GAR-VAL-AJT-SUP = GAR-VAL-CML-TSN IN GVT -
                    (GAR-VAL-CML-TSN IN GVT * GAR-PCT-AJT-SUP IN TAG
                     / 100).

           IF WK-ENT-DEC = 'D'
             COMPUTE WK-VAL-REDONDEO ROUNDED = GAR-VAL-CML-TSN IN GVT
             MOVE WK-VAL-REDONDEO TO GAR-VAL-CML-TSN IN GVT
             COMPUTE WK-VAL-REDONDEO ROUNDED = GAR-VAL-LIQ-TSN IN GVT
             MOVE WK-VAL-REDONDEO TO GAR-VAL-LIQ-TSN IN GVT
             COMPUTE WK-VAL-REDONDEO ROUNDED = GAR-VAL-PON     IN GVT
             MOVE WK-VAL-REDONDEO TO GAR-VAL-PON     IN GVT
             COMPUTE WK-VAL-REDONDEO ROUNDED = GAR-VAL-AJT-SUP IN GVT
             MOVE WK-VAL-REDONDEO TO GAR-VAL-AJT-SUP IN GVT.

           MOVE GAR-VAL-CML-TSN IN GVT TO WK-GAR-VAL-CML-N.
           MOVE GAR-VAL-LIQ-TSN IN GVT TO WK-GAR-VAL-LIQ-N.
           MOVE GAR-VAL-PON     IN GVT TO WK-GAR-VAL-PON-N.
           MOVE HOY-FHOY               TO GVT-FEC-ING-SIS IN GVT.
           MOVE ZEROES                 TO GVT-FEC-ULT-ACT IN GVT.
           MOVE HOY-HHOY               TO GVT-HOR-ACT     IN GVT.
           MOVE 'PEMV'                 TO GVT-TML-ACT     IN GVT.
           MOVE SPACES                 TO GVT-IDN-USU-ACT IN GVT.
           MOVE 'PBEMV'                TO GVT-IDN-USU-ING IN GVT.

      * FLB: Siempre se escribe una nueva tasacion
      *     IF GAR-FA-TSN IN GVT = CEX-FA-MOV AND
      *        GAR-FM-TSN IN GVT = CEX-FM-MOV
      *        MOVE 'UPDAT'           TO GVT-COMMAND
      *        MOVE 'PBEMV'           TO GVT-IDN-USU-ACT IN GVT
      *        MOVE HOY-HHOY          TO GVT-HOR-ACT     IN GVT
      *        MOVE HOY-FHOY          TO GVT-FEC-ULT-ACT IN GVT
      *     ELSE
              MOVE FIO-ULK-REC TO FIO-CMND.
              PERFORM GAR-FIO-GVT.

              ADD  1                 TO WK-NUM-TSN.
              MOVE WK-NUM-TSN        TO GAR-COD-TSN IN GVT.
              MOVE CEX-FEC-MOV       TO GAR-FEC-TSN IN GVT.
              MOVE FIO-PUT TO FIO-CMND.
              PERFORM GAR-FIO-GVT.
              IF NOT FIO-STAT-OKS
                 DISPLAY ' '
                 PERFORM MUEVE-CAMPOS
                 DISPLAY 'GARPBEMV. NO PUDO ACTLZAR GVT PARA GTIA. '
                          GAR-CLV-GVT-1 ' RET-COD=' FIO-STAT

                 DISPLAY 'GARPBEMV. PROGRAMA CANCELADO'
                 MOVE 'NO PUDO ACTLZAR REG. GVT '   TO WK-GLOSA-ERR
                 MOVE FIO-STAT                      TO WK-RET-COD
                 MOVE ' PGM.CANC'                   TO WK-MSG
                 MOVE WK-GLOSA-ERROR                TO LD-GLOSA
                 MOVE ' ' TO WK-IND-MOV
                 DISPLAY LINEA-DETALLE
                 PERFORM PRG-ABT.

              MOVE WK-NUM-TSN        TO GAR-COD-TSN   IN GDG.

      ***** SE GENERA MVTO. SOLO PARA CAMPO VALOR COMERCIAL ********
      *    MOVE '2'  TO GAR-COD-MOV IN GMO.
      *    MOVE 'GVT001'               TO GAR-COD-CPO IN GMO.
      *    MOVE WK-GAR-VAL-LIQ-A       TO GAR-VAL-CPO-ANT IN GMO.
      *    MOVE WK-GAR-VAL-LIQ-N       TO GAR-VAL-CPO-NVO IN GMO.
      *    PERFORM ESCRIBIR-MVTO.
           MOVE '2'  TO GAR-COD-MOV IN GMO.
           MOVE 'GVT002'               TO GAR-COD-CPO IN GMO.
           MOVE WK-GAR-VAL-CML-A       TO GAR-VAL-CPO-ANT IN GMO.
           IF CEX-COD-MOV IN EMV = 'T' AND
              WK-GAR-VAL-CML-N > ZEROES
              MOVE ZEROES              TO GAR-VAL-CPO-NVO IN GMO
           ELSE
              MOVE WK-GAR-VAL-CML-N    TO GAR-VAL-CPO-NVO IN GMO.
           PERFORM ESCRIBIR-MVTO.
           ADD 1 TO WK-CONT-MOV-GVT.
      *    MOVE '2'  TO GAR-COD-MOV IN GMO.
      *    MOVE 'GVT003'               TO GAR-COD-CPO IN GMO.
      *    MOVE WK-GAR-VAL-PON-A       TO GAR-VAL-CPO-ANT IN GMO.
      *    MOVE WK-GAR-VAL-PON-N       TO GAR-VAL-CPO-NVO IN GMO.
      *    PERFORM ESCRIBIR-MVTO.
      *
           MOVE 'N' TO WK-ALZAM.
           IF (CEX-COD-MOV IN EMV = 'S' AND
               WK-GAR-VAL-CML-N NOT > ZEROS ) OR
              (CEX-COD-MOV IN EMV = 'T' AND
                 WK-GAR-VAL-CML-N NOT > ZEROS )
              MOVE GAR-ES1 IN GDG TO GAR-EST-ANT IN GDG
              MOVE '20' TO GAR-ES1 IN GDG
              MOVE 'S'  TO WK-ALZAM
              PERFORM FEC-ALZ
              MOVE FIO-DEL TO FIO-CMND
              PERFORM GAR-FIO-ECL
              IF FIO-STAT-OKS
                  ADD 1 TO WK-CONT-CLT-ELIM
              ELSE
                  DISPLAY ' '
                  PERFORM MUEVE-CAMPOS
                  DISPLAY 'GARPBEMV. ERROR AL BORRAR ECL, CLAVE= '
                       GAR-CLV-ECL-1 ' RET-COD = ' FIO-STAT
                  MOVE 'NO PUDO ELIMINAR ECL ' TO WK-GLOSA-ERR
                  MOVE FIO-STAT                TO WK-RET-COD
                  MOVE ' PGM.CANC'             TO WK-MSG
                  MOVE WK-GLOSA-ERROR          TO LD-GLOSA
                  MOVE ' ' TO WK-IND-MOV
                  DISPLAY LINEA-DETALLE
                  PERFORM PRG-ABT
           ELSE
              MOVE FIO-ULK-REC TO FIO-CMND
              PERFORM GAR-FIO-ECL.

           MOVE FIO-MOD TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY 'GARPBEMV. NO PUDO ACTLZAR REG. GDG PARA GTIA. '
                      GAR-CLV-GDG-1 ' RET-COD=' FIO-STAT
              DISPLAY 'GARPBEMV. PROGRAMA CANCELADO'
              MOVE 'NO PUDO ACTLZAR REG. GDG '   TO WK-GLOSA-ERR
              MOVE FIO-STAT                      TO WK-RET-COD
              MOVE ' PGM.CANC'                   TO WK-MSG
              MOVE WK-GLOSA-ERROR                TO LD-GLOSA
              MOVE ' ' TO WK-IND-MOV
              DISPLAY LINEA-DETALLE
              MOVE FIO-ULK-REC TO FIO-CMND
              PERFORM GAR-FIO-GDG
              MOVE FIO-ULK-REC TO FIO-CMND
              PERFORM GAR-FIO-GVT
              PERFORM DESACTUALIZA-GVT
              PERFORM PRG-ABT.

           IF WK-ALZAM = 'S'
              PERFORM GEN-MVTO-ALZAM.
       FIN-RETASACION.
           EXIT.

       ESCRIBIR-MVTO SECTION.
       INI-ESCRIBIR-MVTO.
           MOVE WK-FECHA-SSAAMMDD         TO GAR-FEC-MOV IN GMO.
           MOVE HOY-HHOY                  TO GAR-HOR-MOV IN GMO.
           MOVE 'PEMV'                    TO GAR-TML-MOV IN GMO.
           MOVE 'PBEMV'                   TO GMO-IDN-USU-ING IN GMO.
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GMO.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GMO.
           ADD  1  TO WK-NUM-CORREL-MVTO.
           MOVE WK-NUM-CORREL-MVTO       TO GAR-CRR-MOV IN GMO.
           MOVE 'S'                      TO GAR-IND-VAL IN GMO.
           MOVE 'N'                      TO GAR-IND-CLV IN GMO.
           MOVE SPACES                   TO GAR-COD-CLV-ANT IN GMO
                                            GAR-COD-CLV-NVO IN GMO
                                            GAR-GLS-CPO-ANT IN GMO
                                            GAR-GLS-CPO-NVO IN GMO.
           MOVE CEX-COD-OFI IN EMV       TO GAR-COD-OFI-MOV IN GMO.
           MOVE 'PBEMV'                  TO GMO-IDN-USU-ING IN GMO.
           MOVE HOY-FHOY                 TO GMO-FEC-ING-SIS IN GMO.

           MOVE ADR-GMO-REQA TO ADR-RES-REQA.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
           IF NOT FIO-STAT-OKS
              SUBTRACT 1 FROM WK-CONT-MOV-GVT
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY 'GARPBEMV. NO PUDO GRABAR REG. GMO PARA GTIA. '
                      GAR-CLV-GMO-1 IN GMO ' RET-COD=' FIO-STAT
              MOVE 'NO PUDO GRABAR REG. GMO  '   TO WK-GLOSA-ERR
              MOVE FIO-STAT                      TO WK-RET-COD
              MOVE ' SIGUE-1'                    TO WK-MSG
              MOVE WK-GLOSA-ERROR                TO LD-GLOSA
              MOVE 'M' TO WK-IND-MOV
              DISPLAY LINEA-DETALLE
              MOVE ADR-RES-REQA TO ADR-GMO-REQA.
       FIN-ESCRIBIR-MVTO.
           EXIT.

       DESACTUALIZA-GVT SECTION.
       INI-DESACTUALIZA-GVT.
      *    SE DEBE ELIMINAR EL REGISTRO CREADO.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY 'GARPBEMV. NO ENCONTRO GVT PARA DESACTUALIZAR'
                 GAR-CLV-GVT-1 ' PROG. CANCELADO, RET-COD=' FIO-STAT
              MOVE 'NO LEYO GVT PARA DESACT. '   TO WK-GLOSA-ERR
              MOVE FIO-STAT                      TO WK-RET-COD
              MOVE ' PGM.CANC'                   TO WK-MSG
              MOVE WK-GLOSA-ERROR                TO LD-GLOSA
              MOVE ' ' TO WK-IND-MOV
              DISPLAY LINEA-DETALLE
              PERFORM PRG-ABT.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY 'GARPBEMV. NO PUDO ELIMINAR ACTUALIZACION GVT '
                      GAR-CLV-GVT-1 ' RET-COD=' FIO-STAT
              MOVE 'NO ELIMINO ACTUALIZ. GVT '   TO WK-GLOSA-ERR
              MOVE FIO-STAT                      TO WK-RET-COD
              MOVE ' PGM.CANC'                   TO WK-MSG
              MOVE WK-GLOSA-ERROR                TO LD-GLOSA
              MOVE ' ' TO WK-IND-MOV
              DISPLAY LINEA-DETALLE
              PERFORM PRG-ABT.
       FIN-DESACTUALIZA-GVT.
           EXIT.

       GEN-MVTO-ALZAM SECTION.
       INI-GEN-MVTO-ALZAM.
           MOVE WK-FECHA-SSAAMMDD         TO GAR-FEC-MOV IN GMO.
           PERFORM GET-FHOY.
           MOVE HOY-HHOY                  TO GAR-HOR-MOV IN GMO.
           MOVE 'PEMV'                    TO GAR-TML-MOV IN GMO.
           MOVE 'PBEMV'                   TO GMO-IDN-USU-ING IN GMO.
           MOVE HOY-FHOY                  TO GMO-FEC-ING-SIS IN GMO.
           MOVE GAR-NUM-SIS IN GDG        TO GAR-NUM-SIS IN GMO.
           MOVE GAR-COD-CRR IN GDG        TO GAR-COD-CRR IN GMO.
           MOVE '3'                       TO GAR-COD-MOV IN GMO.
           MOVE GAR-EST-ANT IN GDG  TO GAR-COD-CLV-ANT IN GMO.
           MOVE GAR-ES1     IN GDG  TO GAR-COD-CLV-NVO IN GMO.
           MOVE 'GDG001'            TO GAR-COD-CPO IN GMO.
           MOVE ZEROS               TO GAR-VAL-CPO-ANT IN GMO.
           MOVE ZEROS               TO GAR-VAL-CPO-NVO IN GMO.
           ADD  1                   TO WK-NUM-CORREL-MVTO.
           MOVE WK-NUM-CORREL-MVTO  TO GAR-CRR-MOV IN GMO.
           MOVE 'N'                 TO GAR-IND-VAL IN GMO.
           MOVE 'S'                 TO GAR-IND-CLV IN GMO.
           MOVE SPACES              TO GAR-GLS-CPO-ANT IN GMO.
           MOVE SPACES              TO GAR-GLS-CPO-NVO IN GMO.
           MOVE CEX-COD-OFI IN EMV  TO GAR-COD-OFI-MOV IN GMO.

           MOVE ADR-GMO-REQA TO ADR-RES-REQA.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
           IF FIO-STAT-OKS
              ADD 1 TO WK-CONT-MOV-ALZ
           ELSE
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY 'GARPBEMV. NO PUDO GRABAR REG. GMO PARA GTIA. '
                      GAR-CLV-GMO-1 IN GMO ' RET-COD=' FIO-STAT
              MOVE 'NO PUDO GRABAR REG. GMO  '   TO WK-GLOSA-ERR
              MOVE FIO-STAT                      TO WK-RET-COD
              MOVE ' SIGUE-2'                    TO WK-MSG
              MOVE WK-GLOSA-ERROR                TO LD-GLOSA
              MOVE 'M' TO WK-IND-MOV
              DISPLAY LINEA-DETALLE
              MOVE ADR-RES-REQA TO ADR-GMO-REQA.
       FIN-GEN-MVTO-ALZAM.
           EXIT.

       OBT-CIC SECTION.
       INI-OBT-CIC.

      *GET-CIC Obtener CIC
           MOVE SPACES TO CIC-CAI-ICIC IN CIC.
           MOVE CIC-GET TO CIC-CMND.
           PERFORM PRO-CIC.
           IF CIC-STAT NOT = CIC-STAT-OKS
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY 'GARPBEMV. ERROR AL OBTENER CIC, CLAVE= '
                      CIC-CIC-ICIC ' RET-COD = ' CIC-STAT
              MOVE 'NO PUDO OBTENER CICC'        TO WK-GLOSA-ERR
              MOVE CIC-STAT                      TO WK-RET-COD
              MOVE ' PGM.CANC'                   TO WK-MSG
              MOVE WK-GLOSA-ERROR                TO LD-GLOSA
              MOVE ' ' TO WK-IND-MOV
              DISPLAY LINEA-DETALLE
              PERFORM PRG-ABT.

       FIN-OBT-CIC.
           EXIT.

       GRABA-ECL SECTION.
       INI-GRABA-ECL.
           MOVE CEX-COP-CDT     IN EMV TO GAR-COD-CLV-ESP IN ECL.
           MOVE CEX-COD-MON     IN EMV TO GAR-COD-MON-CDT IN ECL.
           MOVE CEX-VRF-COP-CDT IN EMV TO GAR-VRF-CLV-ESP IN ECL.
           MOVE CIC-CAI-ICIC    IN CIC TO GAR-NUM-SIS     IN ECL.
           MOVE CIC-IIC-ICIC    IN CIC TO GAR-COD-CRR     IN ECL.
           MOVE SPACES                 TO GAR-VRF-CLV     IN ECL.
           MOVE HOY-FHOY               TO ECL-FEC-ING-SIS IN ECL.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GAR-FIO-ECL.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY 'GARPBEMV. ERROR AL GRABAR ECL, CLAVE= '
                       GAR-CLV-ECL-1 ' RET-COD = ' FIO-STAT
              MOVE 'NO PUDO GRABAR ECL'          TO WK-GLOSA-ERR
              MOVE FIO-STAT                      TO WK-RET-COD
              MOVE ' PGM.CANC'                   TO WK-MSG
              MOVE WK-GLOSA-ERROR                TO LD-GLOSA
              MOVE ' ' TO WK-IND-MOV
              DISPLAY LINEA-DETALLE
              PERFORM PRG-ABT.
       FIN-GRABA-ECL.
           EXIT.

       GRABA-GDG SECTION.
       INI-GRABA-GDG.
           MOVE GAR-NUM-SIS IN ECL TO GAR-NUM-SIS IN GDG.
           MOVE GAR-COD-CRR IN ECL TO GAR-COD-CRR IN GDG.
      *     MOVE CEX-ID-DDR  IN EMV TO GAR-ID-DEU-EJE  IN GDG.
      *     MOVE CEX-VRT-DDR IN EMV TO GAR-VRF-DEU-EJE IN GDG.
           MOVE CEX-COD-OFI IN EMV    TO GAR-COD-OFI IN GDG.
           MOVE WK-COD-TIP            TO GAR-TIP-OPE IN GDG.
           MOVE WK-COD-STP            TO GAR-STP-OPE IN GDG.
           MOVE WK-TIP-VCB            TO GAR-TIP-VCB IN GDG.
           MOVE WK-COD-VCB            TO GAR-COD-VCB IN GDG.
           MOVE WK-TIP-CMB            TO GAR-TIP-CMB IN GDG.
           MOVE WK-TIP-VCB-CTB        TO GAR-TIP-VCB-CON IN GDG.
           MOVE WK-COD-VCB-CTB        TO GAR-COD-VCB-CON IN GDG.
           MOVE WK-TIP-CMB-CTB        TO GAR-TIP-CMB-CON IN GDG.
           MOVE CEX-FA-VTO-CDT IN EMV TO GAR-FA-VTO      IN GDG.
           MOVE CEX-FM-VTO-CDT IN EMV TO GAR-FM-VTO      IN GDG.
           MOVE CEX-FD-VTO-CDT IN EMV TO GAR-FD-VTO      IN GDG.
           MOVE '1'                   TO GAR-COD-GRA     IN GDG.
           MOVE CEX-COD-LIM-GAR       TO GAR-COD-LIM     IN GDG.
           MOVE 'NO'                  TO GAR-IND-RST-ALZ IN GDG.
           MOVE 'NO'                  TO GAR-IND-OBL-INS IN GDG.
           MOVE SPACES                TO GDG-CAI-ICLI    IN GDG.
           MOVE '00000000'            TO GDG-IIC-ICLI    IN GDG
                                         GAR-IIV-AUT-ES1 IN GDG
                                         GAR-ES2         IN GDG
                                         GAR-EST-ANT     IN GDG.
           MOVE '10'                  TO GAR-ES1         IN GDG.
           MOVE 'S'                   TO GAR-IND-CPL     IN GDG.
           MOVE 'S'                   TO GAR-IND-EXI-GDG IN GDG.
           MOVE 'S'                   TO GAR-IND-EXI-GDD IN GDG.
           MOVE 'S'                   TO GAR-IND-EXI-GES IN GDG.
           MOVE ' '                   TO GAR-IND-EXI-GLE IN GDG.
           MOVE ' '                   TO GAR-IND-EXI-GDO IN GDG.
           MOVE ' '                   TO GAR-IND-EXI-GSE IN GDG.
           MOVE 'S'                   TO GAR-IND-EXI-GVT IN GDG.
           MOVE ' '                   TO GAR-IND-EXI-GTP IN GDG.
           MOVE ' '                   TO GAR-IND-EXI-GUB IN GDG.
           MOVE ' '                   TO GAR-IND-EXI-GAP IN GDG.
           MOVE ' '                   TO GAR-IND-EXI-GIN IN GDG.
           MOVE ' '                   TO GAR-IND-EXI-GSI IN GDG.
           MOVE ' '                   TO GAR-IND-EXI-GDP IN GDG.
           MOVE HOY-FHOY              TO GDG-FEC-ING-SIS IN GDG.
           MOVE CEX-FEC-CNS-GAR       TO GAR-FEC-SOL-CNS IN GDG
                                         GAR-FEC-ESC-CNS IN GDG.
           MOVE ZEROS                 TO GAR-FA-ALZ      IN GDG
                                         GAR-FM-ALZ      IN GDG
                                         GAR-FD-ALZ      IN GDG
                                         GDG-FA-ULT-ACT  IN GDG
                                         GDG-FM-ULT-ACT  IN GDG
                                         GDG-FD-ULT-ACT  IN GDG.
           MOVE HOY-HHOY              TO GDG-HOR-ACT     IN GDG.
           MOVE 'PEMV'                TO GDG-TML-ACT     IN GDG.
           MOVE 'PBEMV'               TO GDG-IDN-USU-ING IN GDG.
           MOVE SPACES                TO GDG-IDN-USU-ACT IN GDG.
           MOVE '001'                 TO GAR-COD-TSN     IN GDG.
           MOVE 'INTERFACE COMERCIO EXTERIOR (COMEX)'
                                      TO GAR-DES-1       IN GDG.
           MOVE SPACES                TO GAR-DES-2       IN GDG.
           IF CEX-COD-LIM-GAR = 'E'
              MOVE '1'                TO GAR-COD-TIP-ESP IN GDG
           ELSE
              MOVE SPACES             TO GAR-COD-TIP-ESP IN GDG.
           MOVE DBC-COD-EJEC IN DBC   TO GAR-COD-EJE-ORI IN GDG.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY 'GARPBEMV. ERROR AL AGREGAR GDG, CLAVE= '
                       GAR-CLV-GDG-1 ' RET-COD = ' FIO-STAT
              MOVE 'NO PUDO GRABAR GDG'          TO WK-GLOSA-ERR
              MOVE FIO-STAT                      TO WK-RET-COD
              MOVE ' PGM.CANC'                   TO WK-MSG
              MOVE WK-GLOSA-ERROR                TO LD-GLOSA
              MOVE ' ' TO WK-IND-MOV
              DISPLAY LINEA-DETALLE
              PERFORM PRG-ABT.
       FIN-GRABA-GDG.
           EXIT.

       GRABA-GDD SECTION.
       INI-GRABA-GDD.
           IF NOT PGM-STAT-DBC-OKS
              GO TO FIN-GRABA-GDD.

           MOVE GAR-NUM-SIS IN ECL    TO GAR-NUM-SIS IN GDD.
           MOVE GAR-COD-CRR IN ECL    TO GAR-COD-CRR IN GDD.
           MOVE DBC-KEY-IDBC IN DBC   TO GDD-CIC-ICLI    IN GDD.
           MOVE ZEROS                 TO GAR-VAL-LIM-DDR IN GDD.
           MOVE 100                   TO GAR-PCT-LIM-DDR IN GDD.
           MOVE HOY-FHOY              TO GDD-FEC-ING-SIS IN GDD.
           MOVE ZEROS                 TO GDD-FA-ULT-ACT  IN GDD
                                         GDD-FM-ULT-ACT  IN GDD
                                         GDD-FD-ULT-ACT  IN GDD
                                         GDD-HOR-ACT     IN GDD.
           MOVE 'PEMV'                TO GDD-TML-ACT     IN GDD.
           MOVE 'PBEMV'               TO GDD-IDN-USU-ING IN GDD.
           MOVE SPACES                TO GDD-IDN-USU-ACT IN GDD.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GAR-FIO-GDD.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY 'GARPBEMV. ERROR AL GRABAR GDD, CLAVE= '
                       GAR-CLV-GDD-1 ' RET-COD = ' FIO-STAT
              MOVE 'NO PUDO GRABAR GDD'          TO WK-GLOSA-ERR
              MOVE FIO-STAT                      TO WK-RET-COD
              MOVE ' PGM.CANC'                   TO WK-MSG
              MOVE WK-GLOSA-ERROR                TO LD-GLOSA
              MOVE ' ' TO WK-IND-MOV
              DISPLAY LINEA-DETALLE
              PERFORM PRG-ABT.
       FIN-GRABA-GDD.
           EXIT.

       GRABA-GVT SECTION.
       INI-GRABA-GVT.
           MOVE GAR-NUM-SIS IN ECL TO GAR-NUM-SIS IN GVT.
           MOVE GAR-COD-CRR IN ECL TO GAR-COD-CRR IN GVT.
           MOVE '001'              TO GAR-COD-TSN IN GVT.
           MOVE CEX-FEC-CNS-GAR    TO GAR-FEC-TSN IN GVT.
           MOVE CEX-FEC-CNS-GAR    TO GAR-FEC-RVL IN GVT.
           MOVE CEX-VAL-CDT IN EMV TO GAR-VAL-LIQ-TSN IN GVT
                                      GAR-VAL-CML-TSN IN GVT
                                      WK-GAR-VAL-LIQ-N
                                      WK-GAR-VAL-CML-N.
           PERFORM OBTENER-PORC-POND.
           MOVE GAR-PCT-PON     IN TAG TO GAR-PCT-PON     IN GVT.
           MOVE GAR-PCT-AJT-SUP IN TAG TO GAR-PCT-AJT-SUP IN GVT.
           COMPUTE GAR-VAL-PON IN GVT =
             (GAR-VAL-LIQ-TSN IN GVT * GAR-PCT-PON IN GVT) / 100.

           COMPUTE GAR-VAL-AJT-SUP = GAR-VAL-CML-TSN IN GVT -
                    (GAR-VAL-CML-TSN IN GVT * GAR-PCT-AJT-SUP IN TAG
                      / 100).

           MOVE GAR-VAL-PON IN GVT TO WK-GAR-VAL-PON-N.
           MOVE SPACES                TO GAR-IIV-TSD IN GVT
                                         GAR-IIV-SVS IN GVT
                                         GAR-TIP-CTR IN GVT
                                         GAR-M2-CTR  IN GVT
                                         GAR-COD-UMD IN GVT
                                         GAR-TIP-MAQ-EQP IN GVT.
           MOVE HOY-FHOY              TO GVT-FEC-ING-SIS IN GVT.
           MOVE ZEROS                 TO GVT-FA-ULT-ACT  IN GVT
                                         GVT-FM-ULT-ACT  IN GVT
                                         GVT-FD-ULT-ACT  IN GVT
                                         GAR-M2-TRR      IN GVT.
           MOVE HOY-HHOY              TO GVT-HOR-ACT     IN GVT.
           MOVE 'PEMV'                TO GVT-TML-ACT     IN GVT.
           MOVE 'PBEMV'               TO GVT-IDN-USU-ING IN GVT.
           MOVE SPACES                TO GVT-IDN-USU-ACT IN GVT.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY 'GARPBEMV. ERROR AL GRABAR GVT, CLAVE= '
                       GAR-CLV-GVT-1 ' RET-COD = ' FIO-STAT
              MOVE 'NO PUDO GRABAR GVT'          TO WK-GLOSA-ERR
              MOVE FIO-STAT                      TO WK-RET-COD
              MOVE ' PGM.CANC'                   TO WK-MSG
              MOVE WK-GLOSA-ERROR                TO LD-GLOSA
              MOVE ' ' TO WK-IND-MOV
              DISPLAY LINEA-DETALLE
              PERFORM PRG-ABT.

           ADD 1 TO WK-CONT-GRB-GVT.
       FIN-GRABA-GVT.
           EXIT.

       OBTENER-PORC-POND SECTION.
       INI-OBTENER-PORC-POND.
      * Lee Plantilla TAG
           MOVE WK-COD-TIP         TO GAR-TIP-OPE IN TAG.
           MOVE WK-COD-STP         TO GAR-STP-OPE IN TAG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-TAG.
           IF NOT FIO-STAT-OKS
              MOVE 100 TO GAR-PCT-PON     IN TAG
              MOVE 0,0 TO GAR-PCT-AJT-SUP IN TAG
              DISPLAY 'GARPBEMV. ERROR AL BUSCAR TAG, STATUS='
                      FIO-STAT
              DISPLAY 'GARPBEMV. CLAVE LECTURA     = ' CEX-CLV-EMV-1
              DISPLAY 'GARPBEMV. ASUMO AJUSTE SUP. = 0,0'
              DISPLAY 'GARPBEMV. ASUMO PORC. POND. = 100'.
       FIN-OBTENER-PORC-POND.
           EXIT.

       GRABA-GES SECTION.
       INI-GRABA-GES.
           IF CEX-COD-LIM-GAR = 'E'
              MOVE GAR-NUM-SIS IN ECL TO GAR-NUM-SIS     IN GES
              MOVE GAR-COD-CRR IN ECL TO GAR-COD-CRR     IN GES
              MOVE CEX-COP-CDT        TO GAR-CIC-IOPC    IN GES
              MOVE CEX-COD-DST-CDT    TO GAR-COD-DST-CDT IN GES
              MOVE CEX-COD-SIS-CDT    TO GAR-COD-SIS-CDT IN GES
              MOVE CEX-FEC-VTO-CDT    TO GAR-FEC-VTO-CDT IN GES
              MOVE ZEROES             TO GAR-VAL-LIM-CDT IN GES
              MOVE 100,00             TO GAR-PCT-LIM-CDT IN GES
              MOVE GAR-VCB IN GDG     TO GAR-VCB-CDT     IN GES
              MOVE HOY-FHOY           TO GES-FEC-ING-SIS IN GES
              MOVE ZEROS              TO GES-FA-ULT-ACT  IN GES
                                         GES-FM-ULT-ACT  IN GES
                                         GES-FD-ULT-ACT  IN GES
                                         GES-HOR-ACT     IN GES
              MOVE 'PEMV'             TO GES-TML-ACT     IN GES
              MOVE 'PBEMV'            TO GES-IDN-USU-ING IN GES
              MOVE SPACES             TO GES-IDN-USU-ACT IN GES
              MOVE FIO-PUT TO FIO-CMND
              PERFORM GAR-FIO-GES
              IF NOT FIO-STAT-OKS
                 DISPLAY ' '
                 PERFORM MUEVE-CAMPOS
                 DISPLAY 'GARPBEMV. ERROR AL GRABAR GES, CLAVE= '
                          GAR-CLV-GES-1 ' RET-COD = ' FIO-STAT
                 MOVE 'NO PUDO GRABAR GES'          TO WK-GLOSA-ERR
                 MOVE FIO-STAT                      TO WK-RET-COD
                 MOVE ' PGM.CANC'                   TO WK-MSG
                 MOVE WK-GLOSA-ERROR                TO LD-GLOSA
                 MOVE ' ' TO WK-IND-MOV
                 DISPLAY LINEA-DETALLE
                 PERFORM PRG-ABT.
       FIN-GRABA-GES.
           EXIT.

       GRABA-GMO SECTION.
       INI-GRABA-GMO.
           PERFORM GRABA-GMO-GDG.
      *    NO SE GENERA MVTO. GDD ****
      *    PERFORM GRABA-GMO-GDD.
           PERFORM GRABA-GMO-GVT.
       FIN-GRABA-GMO.
           EXIT.

       GRABA-GMO-GDG SECTION.
       INI-GRABA-GMO-GDG.
           MOVE WK-FECHA-SSAAMMDD          TO GAR-FEC-MOV IN GMO.
           MOVE HOY-HHOY                   TO GAR-HOR-MOV IN GMO.
           MOVE 'PEMV'                     TO GAR-TML-MOV IN GMO.
           MOVE 'PBEMV'                    TO GMO-IDN-USU-ING IN GMO.
           MOVE HOY-FHOY                   TO GMO-FEC-ING-SIS IN GMO.
           MOVE GAR-NUM-SIS IN GDG         TO GAR-NUM-SIS IN GMO.
           MOVE GAR-COD-CRR IN GDG         TO GAR-COD-CRR IN GMO.
           MOVE '1'                        TO GAR-COD-MOV IN GMO.
           MOVE SPACES                     TO GAR-COD-CLV-ANT IN GMO.
           MOVE GAR-ES1 IN GDG             TO GAR-COD-CLV-NVO IN GMO.
           MOVE 'GDG001'                   TO GAR-COD-CPO IN GMO.
           MOVE ZEROS                      TO GAR-VAL-CPO-ANT IN GMO.
           MOVE ZEROS                      TO GAR-VAL-CPO-NVO IN GMO.
           ADD  1                          TO WK-NUM-CORREL-MVTO.
           MOVE WK-NUM-CORREL-MVTO         TO GAR-CRR-MOV IN GMO.
           MOVE 'N'                        TO GAR-IND-VAL IN GMO.
           MOVE 'S'                        TO GAR-IND-CLV IN GMO.
           MOVE SPACES                     TO GAR-GLS-CPO-ANT IN GMO.
           MOVE SPACES                     TO GAR-GLS-CPO-NVO IN GMO.
           MOVE CEX-COD-OFI IN EMV         TO GAR-COD-OFI-MOV IN GMO.

           MOVE ADR-GMO-REQA TO ADR-RES-REQA.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
           IF FIO-STAT-OKS
              ADD 1 TO WK-CONT-MOV-GDG
           ELSE
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY 'GARPBEMV. NO PUDO GRABAR REG. GMO PARA GTIA. '
                      GAR-CLV-GMO-1 IN GMO ' RET-COD=' FIO-STAT
              MOVE 'NO PUDO GRABAR REG. GMO  '   TO WK-GLOSA-ERR
              MOVE FIO-STAT                      TO WK-RET-COD
              MOVE ' SIGUE-2'                    TO WK-MSG
              MOVE WK-GLOSA-ERROR                TO LD-GLOSA
              MOVE 'M' TO WK-IND-MOV
              DISPLAY LINEA-DETALLE
              MOVE ADR-RES-REQA TO ADR-GMO-REQA.
       FIN-GRABA-GMO-GDG.
           EXIT.

      *GRABA-GMO-GDD SECTION.
      *INI-GRABA-GMO-GDD.
      *    MOVE WK-FECHA-SSAAMMDD      TO GAR-FEMOV IN GMO.
      *    MOVE HOY-HHOY               TO GAR-HOR-MOV IN GMO.
      *    MOVE 'PEMV'                 TO GAR-TML-MOV IN GMO.
      *    MOVE 'PBEMV'                TO GMO-IDN-USU-ING IN GMO.
      *    MOVE HOY-FHOY               TO GMO-FEC-ING-SIS IN GMO.
      *    MOVE GAR-NUM-SIS IN GDG     TO GAR-NUM-SIS IN GMO.
      *    MOVE GAR-COD-CRR IN GDG     TO GAR-COD-CRR IN GMO.
      *    MOVE '1'                    TO GAR-COD-MOV IN GMO.
      *    MOVE SPACES                 TO GAR-COD-CLV-ANT IN GMO.
      *    MOVE SPACES                 TO GAR-COD-CLV-NVO IN GMO.
      *    MOVE 'GDD001'               TO GAR-COD-CPO IN GMO.
      *    MOVE ZEROS                  TO GAR-VAL-CPO-ANT IN GMO.
      *    MOVE ZEROS                  TO GAR-VAL-CPO-NVO IN GMO.
      *    ADD  1                      TO WK-NUM-CORREL-MVTO
      *    MOVE WK-NUM-CORREL-MVTO     TO GAR-CRR-MOV IN GMO.
      *    MOVE 'N'                    TO GAR-IND-VAL IN GMO.
      *    MOVE 'N'                    TO GAR-IND-CLV IN GMO.
      *    MOVE SPACES                 TO GAR-GLS-CPO-ANT IN GMO.
      *    MOVE GDD-CIC-ICLI IN GDD    TO GAR-GLS-CPO-NVO IN GMO.
      *    MOVE CEX-COD-OFI IN EMV     TO GAR-COD-OFI-MOV IN GMO.
      *
      *     MOVE ADR-GMO-REQA TO ADR-RES-REQA.
      *     MOVE FIO-PUT TO FIO-CMND.
      *     PERFORM GAR-FIO-GMO.
      *     IF NOT FIO-STAT-OKS
      *        DISPLAY ' '
      *        PERFORM MUEVE-CAMPOS
      *        DISPLAY 'GARPBEMV. NO PUDO GRABAR REG. GMO PARA GTIA. '
      *                GAR-CLV-GMO-1 IN GMO ' RET-COD=' FIO-STAT
      *        MOVE 'NO PUDO GRABAR REG. GMO  '   TO WK-GLOSA-ERR
      *        MOVE FIO-STAT                      TO WK-RET-COD
      *        MOVE ' SIGUE-4'                    TO WK-MSG
      *        MOVE WK-GLOSA-ERROR                TO LD-GLOSA
      *        MOVE 'M' TO WK-IND-MOV
      *        PERFORM INF-RECHAZO
      *        DISPLAY LINEA-DETALLE
      *        MOVE ADR-RES-REQA TO ADR-GMO-REQA.
      *FIN-GRABA-GMO-GDD.
      *    EXIT.

       GRABA-GMO-GVT SECTION.
       INI-GRABA-GMO-GVT.
      *   *** SE GENERA MVTO. SOLO PARA EL CAMPO VALOR COMERCIAL ***
      *    MOVE '1'                        TO GAR-COD-MOV IN GMO.
      *    MOVE 'GVT001'                   TO GAR-COD-CPO IN GMO.
      *    MOVE ZEROS                  TO GAR-VAL-CPO-ANT IN GMO.
      *    MOVE WK-GAR-VAL-LIQ-N       TO GAR-VAL-CPO-NVO IN GMO.
      *    PERFORM ESCRIBIR-MVTO.
           MOVE '1'                        TO GAR-COD-MOV IN GMO.
           MOVE 'GVT002'                   TO GAR-COD-CPO IN GMO.
           MOVE ZEROS                  TO GAR-VAL-CPO-ANT IN GMO.
           MOVE WK-GAR-VAL-CML-N       TO GAR-VAL-CPO-NVO IN GMO.
           PERFORM ESCRIBIR-MVTO.
           ADD 1 TO WK-CONT-MOV-GVT.
      *    MOVE '1'                        TO GAR-COD-MOV IN GMO.
      *    MOVE 'GVT003'                   TO GAR-COD-CPO IN GMO.
      *    MOVE ZEROS                  TO GAR-VAL-CPO-ANT IN GMO.
      *    MOVE WK-GAR-VAL-PON-N       TO GAR-VAL-CPO-NVO IN GMO.
      *    PERFORM ESCRIBIR-MVTO.
       FIN-GRABA-GMO-GVT.
           EXIT.

       BUS-CLI SECTION.
       INI-BUS-CLI.
           MOVE CEX-RUT-DDR IN EMV TO DBC-NUM-ICLI IN DBC.
           MOVE SPACES             TO DBC-IND-ICLI IN DBC
                                      DBC-GLS-ICLI IN DBC.
           MOVE FIO-GET-KEY-ALT    TO FIO-CMND.
           MOVE 'DBC-IDC-ICLI'     TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
              MOVE FIO-STAT TO PGM-STAT-DBC
              DISPLAY ' '
              PERFORM MUEVE-CAMPOS
              DISPLAY 'GARPBEMV. ERROR AL LEER DBC, CLAVE= '
                       DBC-IDC-ICLI ' RET-COD = ' FIO-STAT
              MOVE 'NO ENCONTRO CLIENTE '        TO WK-GLOSA-ERR
              MOVE FIO-STAT                      TO WK-RET-COD
              MOVE ' REC.ACEP'                   TO WK-MSG
              MOVE WK-GLOSA-ERROR                TO LD-GLOSA
              MOVE ' ' TO WK-IND-MOV
              DISPLAY LINEA-DETALLE
              MOVE SPACES TO DBC-COD-EJEC IN DBC
              GO TO FIN-BUS-CLI.
       FIN-BUS-CLI.
           EXIT.

       MUEVE-CAMPOS SECTION.
       INI-MUEVE-CAMPOS.
           MOVE CEX-RUT-DDR    IN EMV TO LD-RUT.
           MOVE CEX-VRT-DDR    IN EMV TO LD-VRF.
           MOVE CEX-COD-MON    IN EMV TO LD-COD-MON.
           MOVE CEX-COD-MOV    IN EMV TO LD-COD-MOV.
           MOVE CEX-FD-MOV     IN EMV TO LD-FD-MOV.
           MOVE CEX-FM-MOV     IN EMV TO LD-FM-MOV.
           MOVE CEX-FA-MOV     IN EMV TO LD-FA-MOV.
           MOVE CEX-COD-OFI    IN EMV TO LD-COD-OFI.
           MOVE CEX-FD-CNS-GAR IN EMV TO LD-FD-EMI.
           MOVE CEX-FM-CNS-GAR IN EMV TO LD-FM-EMI.
           MOVE CEX-FA-CNS-GAR IN EMV TO LD-FA-EMI.
           MOVE CEX-COP-CDT    IN EMV TO LD-COD-CREDITO.
           MOVE CEX-VAL-CDT    IN EMV TO LD-VAL.
           IF WK-IND-MOV NOT = 'M'
              IF CEX-COD-MOV IN EMV = 'I'
                 ADD 1 TO WK-CONT-INGR-RECH
              ELSE
                 ADD 1 TO WK-CONT-EGRE-RECH.
       FIN-MUEVE-CAMPOS.
           EXIT.

       GRABA-RECHAZO SECTION.
       INI-GRABA-RECHAZO.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GAR-FIO-RCH.
           IF NOT FIO-STAT-OKS
                 DISPLAY '********************************************'
                 DISPLAY '*** NO GRABA A ARRECH, PGM. CANCELADO ***'
                 DISPLAY '********************************************'
                 PERFORM PRG-ABT.
           ADD 1 TO WK-CONT-REG-GRAB-RECH.
       FIN-GRABA-RECHAZO.
           EXIT.

       FEC-ALZ SECTION.
       INI-FEC-ALZ.
           IF CEX-FEC-ALZ-GAR = ZEROES
              MOVE WK-FECHA-SSAAMMDD TO GAR-FEC-ALZ IN GDG
           ELSE
              MOVE CEX-FEC-ALZ-GAR   TO GAR-FEC-ALZ IN GDG.
       FIN-FEC-ALZ.
           EXIT.

       TERMINAR SECTION.
       ESTADISTICAS.
           DISPLAY '==========================================='.
           DISPLAY '= REGS. LEIDOS EMV .................'
                      WK-CONT-EMV-LEIDOS ' ='.
           DISPLAY '= REGS. INGRESO ACEPTADOS ..........'
                      WK-CONT-INGR-ACEP ' ='.
           DISPLAY '= REGS. INGRESO RECHAZADOS .........'
                      WK-CONT-INGR-RECH ' ='.
           DISPLAY '= REGS. EGRESO ACEPTADOS ...........'
                      WK-CONT-EGRE-ACEP ' ='.
           DISPLAY '= REGS. EGRESO RECHAZADOS ..........'
                      WK-CONT-EGRE-RECH ' ='.
           DISPLAY '= MVTOS. GDG GRABADOS...............'
                      WK-CONT-MOV-GDG   ' ='.
           DISPLAY '= MVTOS. GVT RETASADOS..............'
                      WK-CONT-MOV-GVT   ' ='.
           DISPLAY '= MVTOS. GVT GRABADOS...............'
                      WK-CONT-GRB-GVT   ' ='.
           DISPLAY '= MVTOS. ALZAMIENTO GRABADOS........'
                      WK-CONT-MOV-ALZ   ' ='.
           DISPLAY '= REG. CLIENTES ELIMINADOS..........'
                      WK-CONT-CLT-ELIM  ' ='.
           DISPLAY '= REG. RECHAZADOS GRABADOS..........'
                      WK-CONT-REG-GRAB-RECH ' ='.
           DISPLAY '=                                         ='.
           DISPLAY '==========================================='.

       CHEQUEA-ARCH-RECH.
           IF WK-CONT-REG-GRAB-RECH = 0
              MOVE ALL '0' TO RCH-PARTE-EMV
              MOVE '*** NO SE GENERARON REGISTROS DE RECHAZO ***'
                   TO RCH-MSG-ERR
              MOVE 1 TO WK-CONT-REG-GRAB-RECH
              PERFORM GRABA-RECHAZO.

       CIERRA-ARCH.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-RCH.

       FIN-TERMINAR.
           EXIT.

       COPY GARBFEMV.
       COPY GARBFECL.
       COPY GARBFGDD.
       COPY GARBFGDG.
       COPY GARBFGVT.
       COPY GARBFGMO.
       COPY GARBFGES.
       COPY GARBFTAG.
       COPY GARBFRCH.

       COPY SGCBFDBC.

       COPY GNSBFCIC.
       COPY GNSBGCIC.
       COPY GNSBPVRF.
       COPY GNSBBMSG.
       COPY GNSBFMSG.
       COPY GNSBFTAB.
      *COPY GNSBFERR.
       COPY GNSBGERR REPLACING ==FIO-STAT IN FIO-VARI== BY ==FIO-STAT==.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBGHOY.

