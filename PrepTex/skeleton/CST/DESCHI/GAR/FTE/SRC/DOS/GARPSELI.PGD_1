       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.     GARPSELI.
       AUTHOR.          CONSIST.

      * Subrutina Eimina entidades dependientes de GDG, salvo GDD
      * Si hay un error devuelve MSG-COD-MENS con el codigo del mensaje
      * El error se maneja en programa llamador

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *=============

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSBRTAB.
       COPY GNSBRMSC.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGHOY.
       COPY GNSWGSYS.
       COPY GNSWGPES.
       COPY GNSWGFRM.
       COPY GNSWVIDD.
       01  SCR-VARI.
           03 SCR-SIST             VALUE 'GAR' PIC X(03).
           03 SCR-QIDD                         PIC X(08).
           03 SCR-LIDD                    COMP PIC S9(04).
      * Para utilizar codigo estandar .SRC
           03 SCR-CCPP             VALUE 'ING' PIC X(03).

       COPY GARBRGDG.

       COPY GARBRGAP.
       COPY GARBRGDO.
       COPY GARBRGDP.
       COPY GARBRGES.
       COPY GARBRGIN.
       COPY GARBRGLE.
       COPY GARBRGSE.
       COPY GARBRGSI.
       COPY GARBRGTP.
       COPY GARBRGUB.
       COPY GARBRGVT.

       COPY GARWGELI.

       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GAP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GES-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GIN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GLE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GTP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GUB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.

       LINKAGE SECTION.
      *---------------
       01  DFHCOMMAREA.
           02 FILLER                               PIC X(40).
       COPY GNSLGFIO.

       PROCEDURE DIVISION.
      *===================
       MAIN SECTION.
      *------------
       INI-MAIN.
           PERFORM INI.

           PERFORM ELI-GAP.
           PERFORM ELI-GDO.
           PERFORM ELI-GDP.
           PERFORM ELI-GES.
           PERFORM ELI-GIN.
           PERFORM ELI-GLE.
           PERFORM ELI-GSE.
           PERFORM ELI-GSI.
           PERFORM ELI-GTP.
           PERFORM ELI-GUB.
           PERFORM ELI-GVT.
       EXT-MAIN.
           PERFORM FIN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
       COPY GNSBGEDB.
           MOVE DFHCOMMAREA              TO ELI-CMMA IN ELI-VARI.
           MOVE ELI-PROG             TO FIO-PROG.
      *BUSCAR INDEPENDENCIA DE DATOS
           MOVE ELI-QIDD TO SCR-QIDD.
           MOVE ELI-LIDD TO SCR-LIDD.
           PERFORM GNS-BUS-IDD.
      * LIMPIA VARIABLES DE RETORNO
           MOVE SPACES  TO MSG-COD-SIST
                           MSG-COD-MENS.
      * CARGA
           MOVE GAR-NUM-SIS IN ELI-VARI TO GAR-NUM-SIS IN GDG.
           MOVE GAR-COD-CRR IN ELI-VARI TO GAR-COD-CRR IN GDG.
       FIN-INI.
           EXIT.

       FIN SECTION.
       INI-FIN.
           MOVE MSG-COD-SIST TO ELI-COD-SIST IN ELI-VARI.
           MOVE MSG-COD-MENS TO ELI-COD-MENS IN ELI-VARI.
           MOVE ELI-CMMA IN ELI-VARI TO DFHCOMMAREA.

           GOBACK.
       FIN-FIN.
           EXIT.

       ELI-GAP SECTION.
       INI-ELI-GAP.
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GAP.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GAP.
           MOVE ZEROES             TO GAR-COD-PRD-ACR IN GAP.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-ELI-GAP.
           PERFORM GAR-FIO-GAP.
           IF FIO-STAT-OKS AND
              GAR-NUM-SIS IN GDG = GAR-NUM-SIS IN GAP AND
              GAR-COD-CRR IN GDG = GAR-COD-CRR IN GAP
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM GAR-FIO-GAP
               MOVE FIO-DEL TO FIO-CMND
               PERFORM GAR-FIO-GAP
               MOVE FIO-GET-NLS TO FIO-CMND
               GO TO LUP-ELI-GAP.
       FIN-ELI-GAP.
           EXIT.


       ELI-GDO SECTION.
       INI-ELI-GDO.
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GDO.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GDO.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDO.
           IF FIO-STAT-OKS
               MOVE FIO-DEL TO FIO-CMND
               PERFORM GAR-FIO-GDO.
       FIN-ELI-GDO.
           EXIT.

       ELI-GDP SECTION.
       INI-ELI-GDP.
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GDP.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GDP.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GDP.
           IF FIO-STAT-OKS
               MOVE FIO-DEL TO FIO-CMND
               PERFORM GAR-FIO-GDP.
       FIN-ELI-GDP.
           EXIT.

       ELI-GES SECTION.
       INI-ELI-GES.
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GES.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GES.
           MOVE ZEROES TO GAR-COD-ESP IN GES.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-ELI-GES.
           PERFORM GAR-FIO-GES.
           IF FIO-STAT-OKS AND
              GAR-NUM-SIS IN GDG = GAR-NUM-SIS IN GES AND
              GAR-COD-CRR IN GDG = GAR-COD-CRR IN GES
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM GAR-FIO-GES
               MOVE FIO-DEL TO FIO-CMND
               PERFORM GAR-FIO-GES
               MOVE FIO-GET-NLS TO FIO-CMND
               GO TO LUP-ELI-GES.
       FIN-ELI-GES.
           EXIT.

       ELI-GIN SECTION.
       INI-ELI-GIN.
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GIN.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GIN.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GIN.
           IF FIO-STAT-OKS
               MOVE FIO-DEL TO FIO-CMND
               PERFORM GAR-FIO-GIN.
       FIN-ELI-GIN.
           EXIT.

       ELI-GLE SECTION.
       INI-ELI-GLE.
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GLE.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GLE.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GLE.
           IF FIO-STAT-OKS AND
              GAR-NUM-SIS IN GDG = GAR-NUM-SIS IN GLE AND
              GAR-COD-CRR IN GDG = GAR-COD-CRR IN GLE
               MOVE FIO-DEL TO FIO-CMND
               PERFORM GAR-FIO-GLE.
       FIN-ELI-GLE.
           EXIT.

       ELI-GSE SECTION.
       INI-ELI-GSE.
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GSE.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GSE.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GSE.
           IF FIO-STAT-OKS
               MOVE FIO-DEL TO FIO-CMND
               PERFORM GAR-FIO-GSE.
       FIN-ELI-GSE.
           EXIT.

       ELI-GSI SECTION.
       INI-ELI-GSI.
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GSI.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GSI.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GSI.
           IF FIO-STAT-OKS
               MOVE FIO-DEL TO FIO-CMND
               PERFORM GAR-FIO-GSI.
       FIN-ELI-GSI.
           EXIT.

       ELI-GTP SECTION.
       INI-ELI-GTP.
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GTP.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GTP.
           MOVE ZEROES TO GAR-COD-TSN IN GTP.
           MOVE ZEROES TO GAR-COD-ITM-TSN IN GTP.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-ELI-GTP.
           PERFORM GAR-FIO-GTP.
           IF FIO-STAT-OKS AND
              GAR-NUM-SIS IN GDG = GAR-NUM-SIS IN GTP AND
              GAR-COD-CRR IN GDG = GAR-COD-CRR IN GTP
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM GAR-FIO-GTP
               MOVE FIO-DEL TO FIO-CMND
               PERFORM GAR-FIO-GTP
               MOVE FIO-GET-NLS TO FIO-CMND
               GO TO LUP-ELI-GTP.
       FIN-ELI-GTP.
           EXIT.

       ELI-GUB SECTION.
       INI-ELI-GUB.
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GUB.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GUB.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GUB.
           IF FIO-STAT-OKS
               MOVE FIO-DEL TO FIO-CMND
               PERFORM GAR-FIO-GUB.
       FIN-ELI-GUB.
           EXIT.

       ELI-GVT SECTION.
       INI-ELI-GVT.
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GVT.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GVT.
           MOVE 1                  TO GAR-COD-TSN IN GVT.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           IF FIO-STAT-OKS AND
              GAR-NUM-SIS IN GDG = GAR-NUM-SIS IN GVT AND
              GAR-COD-CRR IN GDG = GAR-COD-CRR IN GVT
               MOVE FIO-DEL TO FIO-CMND
               PERFORM GAR-FIO-GVT.
       FIN-ELI-GVT.
           EXIT.

       COPY GNSBGSYS.
       COPY GNSBGHOY.
       COPY GNSBGPES.
       COPY GNSBBTAB.
       COPY GNSBBIDD.
       COPY GNSBGDTC.
       COPY GNSBGMSG.
       COPY GNSBIABT.
       COPY GNSBGFRM.

       COPY GNSBFTAB.
       COPY GNSBFMSC.
       COPY GNSBFMSG.

           COPY GARBFGAP.
           COPY GARBFGDO.
           COPY GARBFGDP.
           COPY GARBFGES.
           COPY GARBFGIN.
           COPY GARBFGLE.
           COPY GARBFGSE.
           COPY GARBFGSI.
           COPY GARBFGTP.
           COPY GARBFGUB.
           COPY GARBFGVT.

       BCK-OUT SECTION.
       INI-BCK-OUT.
           MOVE FIO-BCK-OUT TO FIO-CMND.
           PERFORM GAR-FIO-GDO.
           IF FIO-STAT-OKS
               MOVE 'GAR'    TO MSG-COD-SIST
               MOVE 'BCKOUT' TO MSG-COD-MENS
               MOVE '49'     TO FIO-STAT.
       FIN-BCK-OUT.
           EXIT.


