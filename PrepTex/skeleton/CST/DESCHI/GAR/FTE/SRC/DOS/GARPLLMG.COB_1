       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GARPLLMG.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    10-Jan-96 06:06 PM.

      * Programa Listador de Reporte LMG con Sort.


       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
      *DOS SELECT RPTLMG         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTLMG         ASSIGN TO        UT-S-RPTLMG.
           SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT RPTLMG         ASSIGN TO        UT-S-RPTLMG.
      *<<<< IOS
           SELECT RPTMCT       ASSIGN TO UT-S-RPTMCT.
      *>>>>

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY GARRRLMG.
      *<<<< RR
      *>>>>
       FD  RPTLMG LABEL RECORDS OMITTED
           REPORT IS RPT-LMG
           .
      *<<<< FLS
       FD  RPTMCT LABEL RECORDS OMITTED
           REPORT IS RPT-MCT.
       01  PASO.
           03 FILLER                              PIC X(01).
      *>>>>

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GMO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GARBRGMO.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSWGGRC.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GARRWLMG.
      *<<<< RW
       COPY TABRWMCT.
      *>>>>
       COPY GARRNLMG.
       COPY GARROLMG.
       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       COPY GARBRGDG.
       COPY GARBRTAG.
       COPY GARBRGVT.
       COPY GARBRGDD.
      *FLB CST  3-MAR-1995
       COPY GARBRMXE.
       COPY TABBRMCX.

       COPY TABBRMCT.
       COPY TABBROFI.
       COPY TABBRCAM.

       COPY GNSBRCIC.
       COPY SGCBRDBC.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGCPT.
       COPY GNSWGCIC.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       01  WSS-VARI.
      * Fecha de Proceso que es leida de tabla TFP
           03 WSS-FEC-FPRO.
              05 WSS-NUM-SPRO                     PIC 9(02).
              05 WSS-NUM-APRO                     PIC 9(02).
              05 WSS-NUM-MPRO                     PIC 9(02).
              05 WSS-NUM-DPRO                     PIC 9(02).
      * Fecha Inicio
      *     03 WSS-FEC-FINI.
      *        05 WSS-NUM-DINI                     PIC 9(02).
      *        05 WSS-NUM-MINI                     PIC 9(02).
      *        05 WSS-NUM-SINI                     PIC 9(02).
      *        05 WSS-NUM-AINI                     PIC 9(02).
      * Fecha Termino
      *     03 WSS-FEC-FTER.
      *        05 WSS-NUM-DTER                     PIC 9(02).
      *        05 WSS-NUM-MTER                     PIC 9(02).
      *        05 WSS-NUM-STER                     PIC 9(02).
      *        05 WSS-NUM-ATER                     PIC 9(02).
      * Fecha Que se mueve a GAR-CLV-GMO-1 en formato SAMD
      *     03 WSS-FEC-FFEC.
      *        05 WSS-NUM-SFEC                     PIC 9(02).
      *        05 WSS-NUM-AFEC                     PIC 9(02).
      *        05 WSS-NUM-MFEC                     PIC 9(02).
      *        05 WSS-NUM-DFEC                     PIC 9(02).
      * Fecha Tope en Formato SAMD
      *     03 WSS-FEC-FFET.
      *        05 WSS-NUM-SFET                     PIC 9(02).
      *        05 WSS-NUM-AFET                     PIC 9(02).
      *        05 WSS-NUM-MFET                     PIC 9(02).
      *        05 WSS-NUM-DFET                     PIC 9(02).
           03 WSS-FEC-FREG.
              05 WSS-NUM-SREG                     PIC 9(02).
              05 WSS-NUM-AREG                     PIC 9(02).
              05 WSS-NUM-MREG                     PIC 9(02).
              05 WSS-NUM-DREG                     PIC 9(02).
      *DAD ini  10-JAN-1995
           03 WSS-NUM-ANAL.
              05 FILLER           VALUE ZEROES    PIC 9(03).
              05 WSS-OFI-ORIG                     PIC X(03).
           03 WSS-GLS-MOVI.
              05 FILLER                           PIC X(22)
                 VALUE 'MOV. GARANTIA / FEC : '.
              05 WSS-DMA-FGLS.
                 07 WSS-NUM-DGLS                  PIC 9(02).
                 07 FILLER        VALUE '-'       PIC X(01).
                 07 WSS-NUM-MGLS                  PIC 9(02).
                 07 FILLER        VALUE '-'       PIC X(01).
                 07 WSS-NUM-AGLS                  PIC 9(02).
           03 WSS-NUM-TRAS        VALUE 6000      PIC 9(05).
           03 WSS-I               VALUE 0         PIC 9(02).
           03 WSS-J                               PIC 9(02).
           03 WSS-IND-MEXT        VALUE 0         PIC 9(01).
           03 WSS-COD-OFIC                        PIC X(03).
           03 WSS-COD-VCAM                        PIC X(06).
           03 WSS-CIC-VCAM-OLD
              05 WSS-CIC-TVAL-OLD                 PIC X(01).
              05 WSS-CIC-REST-OLD                 PIC X(05).
           03 WSS-CIC-VCAM-CUR
              05 WSS-CIC-TVAL-CUR                 PIC X(01).
              05 WSS-CIC-REST-CUR                 PIC X(05).
           03 WSS-IND-MXEG           VALUE 0      PIC 9(06).
           03 WSS-IND-MXEE           VALUE 0      PIC 9(06).
      *DAD fin  10-JAN-1995
           03 WSS-COD-CTA.
              05 WSS-CLA-OPE-SUP                  PIC X(03).
              05 WSS-VCB                          PIC X(06).
           03 WSS-GLS-DATA.
              05 WSS-COD-CTA-DEB                  PIC X(10).
              05 WSS-COD-CTA-HAB                  PIC X(10).
           03 WSS-FEC-CNT                         PIC X(08).
           03 WSS-VAL-CNT         VALUE ZEROES    PIC S9(11)V9(04).
           03 WSS-COD-PESO.
              05 WSS-TIP-VCB-PESO                 PIC X(01).
              05 FILLER                           PIC X(05).
           03 WSS-VAL-PESO                        PIC S9(11).
           03 WSS-IND-NEXT        VALUE ZEROES    PIC 9(01).
           03 WSS-IND-ERRO        VALUE ZEROES    PIC 9(01).
           03 WSS-NUM-TDEB        VALUE ZEROES    PIC 9(03).
           03 WSS-NUM-THAB        VALUE ZEROES    PIC 9(03).
           03 WSS-IND-GET-MSG     VALUE ZEROES    PIC 9(01).
           03 WSS-NO-BUSCA-MSG-ERROR VALUE 1      PIC 9(01).
           03 WSS-BUSCA-MSG-ERROR    VALUE 0      PIC 9(01).
           03 WSS-IND-SORT           VALUE 0      PIC 9(06).
           03 WSS-IND-RCNS           VALUE 0      PIC 9(06).
           03 WSS-IND-RALZ           VALUE 0      PIC 9(06).
           03 WSS-IND-RMOD           VALUE 0      PIC 9(06).
           03 WSS-IND-RPRO           VALUE 0      PIC 9(06).
           03 WSS-IND-RBAD           VALUE 0      PIC 9(06).
           03 WSS-IND-ROKS           VALUE 0      PIC 9(06).
           03 WSS-IND-RERR           VALUE 0      PIC 9(06).
      *RVM:Porque en IBM no funciona STRING a una variable con items
      *    de grupo (frm-mens esta dividido en frm-men1 y frm-men2)
           03 WSS-GLS-MSGE.
              05 WSS-GLS-MSG1        VALUE SPACES PIC X(20).
              05 WSS-GLS-MSG2        VALUE SPACES PIC X(22).
              05 WSS-GLS-MSG3        VALUE SPACES PIC X(08).
              05 WSS-GLS-MSG4        VALUE SPACES PIC X(08).
              05 WSS-GLS-MSG5        VALUE SPACES PIC X(08).
              05 WSS-GLS-MSG6        VALUE SPACES PIC X(13).
              05 WSS-GLS-MSG7        VALUE SPACES PIC X(12).
           03 WSS-SW                 VALUE ZEROES PIC 9(01).
      *JPA INI  31-JAN-1995
           03 WSS-COD-OFIO                        PIC X(03).
           03 WSS-AUX-OFIO                        PIC X(03).
      *JPA FIN  31-JAN-1995
           03 WSS-D-H-TDEB         VALUE ZEROES   PIC S9(13)V9(02).
           03 WSS-D-H-THAB         VALUE ZEROES   PIC S9(13)V9(02).
      *RVM-CST-INI 10.01.1996
      *VARIABLES PARA SER UTILIZADAS DESPUES DEL TERMINATE DE RPT-LMG
           03 WSS-AUX-DEBE-TMT     VALUE ZEROES   PIC 9(11)V9(04).
           03 WSS-AUX-HABE-TMT     VALUE ZEROES   PIC 9(11)V9(04).
      *RVM-CST-FIN 10.01.1996
      *>>>>
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *RVM:
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.
      *>>>>

       REPORT SECTION.
      *--------------
       COPY GARRFLMG.
           .
       COPY GARRTLMG.
      *<<<< RT
       COPY TABRFMCT.
           .
       COPY TABRTMCT.
      *>>>>

       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
      *    02-MAR-95 11:23 PM     ,PAI=CHI ,CLI= ,SOP=MVS
       DEC-OLD-CF-LMG-SRT-COD-OFIC SECTION.
           USE BEFORE REPORTING CF-LMG-SRT-COD-OFIC.
       INI-OLD-CF-LMG-SRT-COD-OFIC.
       FIN-OLD-CF-LMG-SRT-COD-OFIC.
           EXIT.
       DEC-OLD-CF-LMG-SRT-CIC-CCSB SECTION.
           USE BEFORE REPORTING CF-LMG-SRT-CIC-CCSB.
       INI-OLD-CF-LMG-SRT-CIC-CCSB.
       FIN-OLD-CF-LMG-SRT-CIC-CCSB.
           EXIT.
       DEC-OLD-CF-LMG-SRT-COD-VCAM SECTION.
           USE BEFORE REPORTING CF-LMG-SRT-COD-VCAM.
       INI-OLD-CF-LMG-SRT-COD-VCAM.
       FIN-OLD-CF-LMG-SRT-COD-VCAM.
           EXIT.
       DEC-OLD-CF-LMG-SRT-IND-DBHB SECTION.
           USE BEFORE REPORTING CF-LMG-SRT-IND-DBHB.
       INI-OLD-CF-LMG-SRT-IND-DBHB.
       FIN-OLD-CF-LMG-SRT-IND-DBHB.
           EXIT.
       DEC-OLD-CF-LMG-SRT-FEC-FMOV SECTION.
           USE BEFORE REPORTING CF-LMG-SRT-FEC-FMOV.
       INI-OLD-CF-LMG-SRT-FEC-FMOV.
       FIN-OLD-CF-LMG-SRT-FEC-FMOV.
           EXIT.
       DEC-OLD-PH-LMG SECTION.
           USE BEFORE REPORTING PH-LMG.
       INI-OLD-PH-LMG.
      *<<<< OLD_PH_LMG
       PH-VCAM.
      * MEDIANTE BUS-TAB BUSCA TIPO DE MONEDA DE TABLA VLR
           IF SRT-COD-VCAM IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE SRT-COD-VCAM IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-DCOR IN WSS-LMG
               MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-VCAM IN WSS-MCT
           ELSE
               MOVE SPACES TO WSS-GLS-DCOR IN WSS-LMG
               MOVE SPACES TO WSS-GLS-VCAM IN WSS-MCT.

      * MEDIANTE BUS-OFI OBTIENE NOMBRE Y DIRECCION OFICINA DE TABLA OFI
       PH-OFIC.
           IF SRT-COD-OFIC IN SRT > SPACES
               MOVE SRT-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               IF MSG-COD-MENS NOT > SPACES
                   MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-DESO IN WSS-MCT
                   MOVE OFI-GLS-DIRE IN OFI TO WSS-GLS-DIRO IN WSS-MCT
               ELSE
                   MOVE SPACES TO SRT-COD-OFIC IN WSS-MCT
                   MOVE SPACES TO WSS-GLS-DESO IN WSS-MCT
                   MOVE SPACES TO WSS-GLS-DIRO IN WSS-MCT.

       PH-CIC.
      *     MOVE ZEROES TO WSS-NUM-FOLO IN WSS-LMG.
           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
      *CIC-GET OBTENER CIC
           MOVE 'G'                 TO CIC-COD-TCIC IN CIC.
           MOVE SRT-COD-OFIC IN SRT TO CIC-COD-CCIC IN CIC.
           MOVE CIC-GET TO CIC-CMND.
           PERFORM PRO-CIC.
           IF CIC-STAT NOT = CIC-STAT-OKS
               MOVE  1  TO WSS-IND-NEXT IN WSS-VARI
               DISPLAY CIC-MENS     IN CIC-VARI ' EN CODIGO : '
                       CIC-CIC-ICIC IN CIC
               GO TO FIN-OLD-PH-LMG.
           MOVE CIC-NUM-ICIC IN CIC TO WSS-NUM-FOLO IN WSS-LMG.


      *>>>>
       FIN-OLD-PH-LMG.
           EXIT.
       END DECLARATIVES.

       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'GARPLLMG' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           SORT GNSSRT
       COPY GARRSLMG.
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
      *<<<< FIN
      *>>>> FIN
           IF PGM-STAT-SRT-MAL OR SORT-RETURN > 0
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<< INI_INP
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-CIC.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GNS-FIO-CIC.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

      *     DISPLAY 'INICIO CAPTURA DE PARAMETROS'.

      *CAPTURA FECHA DE INICIO
      *     DISPLAY 'FECHA DE INICIO ( DDMMAAAA ) : '.
      *     ACCEPT  WSS-FEC-FINI IN WSS-VARI.
      *     DISPLAY WSS-FEC-FINI IN WSS-VARI.
      *CAPTURA FECHA DE TERMINO
      *     DISPLAY 'FECHA DE TERMINO ( DDMMAAAA ) : '
      *     ACCEPT  WSS-FEC-FTER IN WSS-VARI.
      *     DISPLAY WSS-FEC-FTER IN WSS-VARI.

      *     DISPLAY 'FIN    CAPTURA    DE PARAMETROS'.
      *     DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

      *VAL-FEC VALIDA FECHA DE INICIO
      *     DISPLAY WSS-FEC-FINI IN WSS-VARI.
      *     MOVE WSS-FEC-FINI    IN WSS-VARI TO FEC-FECH.
      *     MOVE FEC-FORM-FEC TO FEC-FORM.
      *     MOVE FEC-FBLK-N   TO FEC-FBLK.
      *     MOVE FEC-CHOY-LE  TO FEC-CHOY.
      *     MOVE FEC-VHBL-N   TO FEC-VHBL.
      *     MOVE FEC-VAL-FEC  TO FEC-CMND.
      *     PERFORM PRO-FEC.
      *     IF NOT FEC-STAT-OKS
      *         DISPLAY FEC-MENS
      *         PERFORM GNS-PRO-END.

      *VAL-FEC VALIDA FECHA DE TERMINO
      *     DISPLAY WSS-FEC-FTER IN WSS-VARI.
      *     MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FECH.
      *     MOVE FEC-FORM-FEC TO FEC-FORM.
      *     MOVE FEC-FBLK-N   TO FEC-FBLK.
      *     MOVE FEC-CHOY-LE  TO FEC-CHOY.
      *     MOVE FEC-VHBL-N   TO FEC-VHBL.
      *     MOVE FEC-VAL-FEC  TO FEC-CMND.
      *     PERFORM PRO-FEC.
      *     IF NOT FEC-STAT-OKS
      *         DISPLAY FEC-MENS
      *         PERFORM GNS-PRO-END.

      *CMP-FEC COMPARA FECHA DE INICIO CON FECHA DE TERMINO
      *     MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FEC1.
      *     MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FEC2.
      *     MOVE FEC-FORM-FEC TO FEC-FORM.
      *     MOVE FEC-CMP-FEC  TO FEC-CMND.
      *     PERFORM PRO-FEC.
      *     IF FEC-STAT-GRT
      *         MOVE 'TAB'         TO MSG-COD-SIST
      *         MOVE 'FECFINIFTER' TO MSG-COD-MENS IN MSG
      *         PERFORM GET-MSG
      *         DISPLAY MSG-GLS-DESC IN MSG
      *         PERFORM GNS-PRO-END.

      *     MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DINI IN WSS-LMG
      *                                      WSS-NUM-DINI IN WSS-MCT
      *                                      WSS-NUM-DFEC IN WSS-VARI.
      *     MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MINI IN WSS-LMG
      *                                      WSS-NUM-MINI IN WSS-MCT
      *                                      WSS-NUM-MFEC IN WSS-VARI.
      *     MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SINI IN WSS-LMG
      *                                      WSS-NUM-SINI IN WSS-MCT
      *                                      WSS-NUM-SFEC IN WSS-VARI.
      *     MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AINI IN WSS-LMG
      *                                      WSS-NUM-AINI IN WSS-MCT
      *                                      WSS-NUM-AFEC IN WSS-VARI.
      *     MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DTER IN WSS-LMG
      *                                      WSS-NUM-DTER IN WSS-MCT
      *                                      WSS-NUM-DFET IN WSS-VARI.
      *     MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MTER IN WSS-LMG
      *                                      WSS-NUM-MTER IN WSS-MCT
      *                                      WSS-NUM-MFET IN WSS-VARI.
      *     MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-STER IN WSS-LMG
      *                                      WSS-NUM-STER IN WSS-MCT
      *                                      WSS-NUM-SFET IN WSS-VARI.
      *     MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-ATER IN WSS-LMG
      *                                      WSS-NUM-ATER IN WSS-MCT
      *                                      WSS-NUM-AFET IN WSS-VARI.

      *     DISPLAY 'FIN VALIDACION DE PARAMETROS'.

      *Lee Tabla de Fechas de Proceso
           MOVE 'GAR' TO TAB-COD-SIST.
           MOVE 'GAR' TO FIO-SIST.
           MOVE 'TFP' TO TAB-COD-TTAB IN TAB.
           MOVE '01'  TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DAT1 TO WSS-FEC-FPRO IN WSS-VARI
               DISPLAY 'FECHA DE PROCESO : ' TAB-GLS-DAT1
           ELSE
              DISPLAY 'ERROR EN LECTURA FECHA DE PROCESO COD 01'.

           MOVE WSS-NUM-DPRO IN WSS-VARI TO WSS-NUM-DINI IN WSS-LMG
                                            WSS-NUM-DINI IN WSS-MCT.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO WSS-NUM-MINI IN WSS-LMG
                                            WSS-NUM-MINI IN WSS-MCT.
           MOVE WSS-NUM-SPRO IN WSS-VARI TO WSS-NUM-SINI IN WSS-LMG
                                            WSS-NUM-SINI IN WSS-MCT.
           MOVE WSS-NUM-APRO IN WSS-VARI TO WSS-NUM-AINI IN WSS-LMG
                                            WSS-NUM-AINI IN WSS-MCT.
      *DAD ini  10-JAN-1995
           MOVE WSS-NUM-DPRO IN WSS-VARI TO WSS-NUM-DGLS IN WSS-VARI.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO WSS-NUM-MGLS IN WSS-VARI.
           MOVE WSS-NUM-APRO IN WSS-VARI TO WSS-NUM-AGLS IN WSS-VARI.
      *DAD fin  10-JAN-1995

       OPE-GDG.
           MOVE 'GAR'        TO FIO-SIST.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-GDG.

       OPE-GVT.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GVT.

       OPE-TAG.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           PERFORM GAR-FIO-TAG.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-TAG.

       OPE-GDD.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           PERFORM GAR-FIO-GDD.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-GDD.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-CAM.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-CAM.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-OFI.

       OPE-SGC.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'SGC'        TO FIO-SIST.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-DBC.


      * OBTIENE CODIGO VALOR DE CAMBIO DE PESOS MEDIANTE CIC DE LA MONED
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
               PERFORM GNS-PRO-END.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS-VARI.

      *>>>>
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
       FST-INP-SRT.
      *<<<< INI_FST_INP
           MOVE SPACES TO GAR-CLV-GMO-1 IN GMO.
      *     MOVE WSS-FEC-FFEC IN WSS-VARI TO GAR-FEC-MOV IN GMO.
           MOVE WSS-FEC-FPRO IN WSS-VARI TO GAR-FEC-MOV IN GMO.
           MOVE 'GAR-CLV-GMO-1' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
           IF NOT FIO-STAT-OKS OR
              GAR-FEC-MOV IN GMO > WSS-FEC-FPRO IN WSS-VARI
      *     IF NOT FIO-STAT-OKS OR
      *        GAR-FEC-MOV IN GMO > WSS-FEC-FFET IN WSS-VARI
      *         DISPLAY 'NO HAY REGISTROS GMO EN RANGO DE FECHAS : '
      *                 'DESDE ' WSS-FEC-FINI IN WSS-VARI ' A '
      *                 WSS-FEC-FTER IN WSS-VARI
               DISPLAY 'NO HAY REGISTROS GMO PARA EL : '
                    WSS-FEC-FPRO IN WSS-VARI
               GO TO FIN-INP-SRT.
           GO TO LUP-INP-SRT.
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
      * PROCESO DE SELECCION A PARTIR DEL REGISTRO GMO

           IF GAR-COD-MOV IN GMO = '1' AND
              GAR-COD-CPO IN GMO = 'GVT005'
      *        GAR-COD-CPO IN GMO = 'GDG001'
               MOVE WSS-BUSCA-MSG-ERROR TO WSS-IND-GET-MSG
               PERFORM BUS-GDG
               PERFORM BUS-TAG
               PERFORM BUS-OFI-CNT
               MOVE GAR-FEC-MOV     IN GMO TO SRT-FEC-FMOV IN SRT
               MOVE GAR-COD-TSN     IN GMO TO SRT-COD-TSN IN SRT

               MOVE GAR-GLS-CPO-NVO IN GMO TO WSS-FEC-CNT
               MOVE GAR-VAL-CPO-NVO IN GMO TO WSS-VAL-CNT
               PERFORM DET-VAL-PESO
               PERFORM ING-CTA-DEB
               PERFORM ING-CTA-HAB
                ADD  1  TO WSS-IND-RCNS IN WSS-VARI
               IF MSG-COD-MENS > SPACES
                   PERFORM ERR-INP
               ELSE
                   ADD  1  TO WSS-IND-RPRO IN WSS-VARI
           ELSE
           IF GAR-COD-MOV IN GMO = '2' AND
              GAR-COD-CPO IN GMO = 'GVT005'
               MOVE GAR-FEC-MOV IN GMO TO SRT-FEC-FMOV IN SRT
               MOVE GAR-COD-TSN IN GMO TO SRT-COD-TSN  IN SRT
               MOVE WSS-BUSCA-MSG-ERROR TO WSS-IND-GET-MSG
               PERFORM BUS-GDG
               PERFORM BUS-TAG
               PERFORM BUS-OFI-CNT
      * LLENA LA PARTE SALIDA DE LA MODIFICACION
               MOVE GAR-GLS-CPO-ANT IN GMO TO WSS-FEC-CNT
               MOVE GAR-VAL-CPO-ANT IN GMO TO WSS-VAL-CNT
               PERFORM DET-VAL-PESO
               PERFORM EGR-CTA-DEB
               PERFORM EGR-CTA-HAB

      * LLENA LA PARTE INGRESO DE LA MODIFICACION
               PERFORM DET-COD-TSN
               MOVE GAR-GLS-CPO-NVO IN GMO TO WSS-FEC-CNT
               MOVE GAR-VAL-CPO-NVO IN GMO TO WSS-VAL-CNT
               PERFORM DET-VAL-PESO
               PERFORM ING-CTA-DEB
               PERFORM ING-CTA-HAB

               ADD  1  TO WSS-IND-RMOD IN WSS-VARI
               IF MSG-COD-MENS > SPACES
                   PERFORM ERR-INP
               ELSE
                   ADD  1  TO WSS-IND-RPRO IN WSS-VARI
           ELSE
           IF GAR-COD-MOV IN GMO = '3' AND
              GAR-COD-CPO IN GMO = 'GDG001'
               MOVE WSS-BUSCA-MSG-ERROR TO WSS-IND-GET-MSG
               PERFORM BUS-GDG
               PERFORM BUS-GVT
               PERFORM BUS-TAG
               PERFORM BUS-OFI-CNT
               MOVE GAR-FEC-MOV     IN GMO TO SRT-FEC-FMOV IN SRT
               MOVE GAR-COD-TSN     IN GVT TO SRT-COD-TSN  IN SRT
               MOVE GAR-FEC-RVL     IN GVT TO WSS-FEC-CNT
               MOVE GAR-VAL-AJT-SUP IN GVT TO WSS-VAL-CNT
               PERFORM DET-VAL-PESO
               PERFORM EGR-CTA-DEB
               PERFORM EGR-CTA-HAB
               ADD  1  TO WSS-IND-RALZ IN WSS-VARI
               IF MSG-COD-MENS > SPACES
                   PERFORM ERR-INP
               ELSE
                   ADD  1  TO WSS-IND-RPRO IN WSS-VARI
           ELSE
      * SE SALTA EL REGISTRO GMO, SOLO ES INFORMATIVO
               GO TO NXT-INP-SRT.

      * SE ENVIARON AL SORT CON PERFORM MOV-INP-SRT
           GO TO NXT-INP-SRT.
      *>>>>
       MOV-INP-SRT.
       COPY GARRMLMG.
      *<<<< RM
           ADD 1 TO WSS-IND-SORT.
      *>>>>
           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
      *<<<< FIN_NXT_INP
      *     IF GAR-FEC-MOV IN GMO > WSS-FEC-FFET IN WSS-VARI
           IF GAR-FEC-MOV IN GMO > WSS-FEC-FPRO IN WSS-VARI
               GO TO FIN-INP-SRT.
      *>>>>
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
      *<<<< FIN_INP
      *>>>>
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GMO.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
      *<<<< INI_OUT
      * EFECTUA LA APERTURA DEL ARCHIVO SAM DE SALIDA
           MOVE FIO-OUT TO FIO-CMND.

      *DAD ini  10-JAN-1995
      * EFECTUA LA APERTURA DEL ARCHIVO SAM DE SALIDA MON. EXT.
      *    PERFORM TAB-FIO-MCX.
           PERFORM GAR-FIO-MXE.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR AL ABRIR ARCHIVO MCX DE OUTPUT' FIO-STAT
               PERFORM GNS-PRO-END.
      *DAD fin  10-JAN-1995
           PERFORM TAB-FIO-MCT.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR AL ABRIR ARCHIVO MCT DE OUTPUT' FIO-STAT
               PERFORM GNS-PRO-END.

      * DESPLIEGA CONTADORES
           DISPLAY 'INGRESOS LEIDOS           : '
                    WSS-IND-RCNS IN WSS-VARI.
           DISPLAY 'CAMBIOS DE VALORES LEIDOS : '
                    WSS-IND-RMOD IN WSS-VARI.
           DISPLAY 'ALZAMIENTOS LEIDOS        : '
                    WSS-IND-RALZ IN WSS-VARI.
           DISPLAY 'REGISTROS PROCESADOS   : ' WSS-IND-RPRO IN WSS-VARI.
           DISPLAY 'REGISTROS RECHAZADOS   : ' WSS-IND-RBAD IN WSS-VARI.
           DISPLAY 'REGISTROS AL SORT      : ' WSS-IND-SORT IN WSS-VARI.
           OPEN OUTPUT RPTMCT.
           INITIATE RPT-MCT.
      *>>>>
           OPEN OUTPUT RPTLMG.
      *     MOVE 'GARPLLMG' TO RPT-NPGM.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-LMG.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           MOVE SRT TO SRT-OLD-LMG.
           MOVE SRT TO SRT-CUR-LMG.
           PERFORM FST-CTL-LMG.
      *<<<< FST_OUT
           PERFORM INI-CF-LMG-SRT-FEC-FMOV.
           PERFORM PH-VCAM.
           MOVE SRT-COD-VCAM IN SRT TO SRT-COD-VCAM IN WSS-MCT.
           PERFORM PH-OFIC.
           MOVE SRT-COD-OFIC IN SRT TO SRT-COD-OFIC IN WSS-MCT.
           MOVE SRT-CIC-CCSB IN SRT TO WSS-CIC-CCSB IN WSS-MCT.
           MOVE SRT-GLS-CCSB IN SRT TO WSS-GLS-CCSB IN WSS-MCT.

      *FLB CST  3-MAR-1995
      *>>>>
       LUP-OUT-SRT.
      *<<<< LUP_OUT
           PERFORM BUS-REG-CLI.
           DISPLAY 'DET SRT : ' SRT.
      *>>>>
       GEN-OUT-SRT.
           PERFORM CLR-CTL-LMG.
           PERFORM CHK-CTL-LMG.
           MOVE SRT TO SRT-CUR-LMG.
           MOVE SRT-OLD-LMG TO SRT.
           PERFORM PRO-CTL-CF-LMG.
           MOVE SRT-CUR-LMG TO SRT.
           PERFORM PRO-CTL-CH-LMG.
           GENERATE DL-LMG.
      *<<<< FIN_GEN_OUT
            IF WSS-SW IN WSS-VARI = 1
                MOVE 0 TO WSS-SW IN WSS-VARI
                IF SRT-FEC-FMOV IN SRT NOT = SRT-FEC-FMOV IN WSS-MCT
                    PERFORM INI-CF-LMG-SRT-FEC-FMOV
                    PERFORM PH-VCAM
                    MOVE SRT-COD-VCAM IN SRT TO SRT-COD-VCAM IN WSS-MCT
                    PERFORM PH-OFIC
                    MOVE SRT-COD-OFIC IN SRT TO SRT-COD-OFIC IN WSS-MCT
                ELSE
                IF SRT-COD-VCAM IN SRT NOT = SRT-COD-VCAM IN WSS-MCT
                    PERFORM PH-VCAM
                    MOVE SRT-COD-VCAM IN SRT TO SRT-COD-VCAM IN WSS-MCT
                    PERFORM PH-OFIC
                    MOVE SRT-COD-OFIC IN SRT TO SRT-COD-OFIC IN WSS-MCT
                ELSE
                IF SRT-COD-OFIC IN SRT NOT = SRT-COD-OFIC IN WSS-MCT
                    MOVE SRT-COD-OFIC IN SRT TO SRT-COD-OFIC IN WSS-MCT
                    PERFORM PH-OFIC.

            IF WSS-IND-NEXT IN WSS-VARI = 1
                DISPLAY 'PROCESO CON ERROR : ABORTO'
      *RVM-CST-INI 15-DEC-1995
                MOVE PGM-SMAL TO PGM-STAT-SRT
      *RVM-CST-FIN 15-DEC-1995
                GO TO FIN-OUT-SRT.
           MOVE SRT-FEC-FMOV IN SRT      TO WSS-FEC-FREG IN WSS-VARI.
           MOVE WSS-NUM-DREG IN WSS-VARI TO WSS-NUM-DMOV IN WSS-LMG.
           MOVE WSS-NUM-MREG IN WSS-VARI TO WSS-NUM-MMOV IN WSS-LMG.
           MOVE WSS-NUM-SREG IN WSS-VARI TO WSS-NUM-SMOV IN WSS-LMG.
           MOVE WSS-NUM-AREG IN WSS-VARI TO WSS-NUM-AMOV IN WSS-LMG.

           IF SRT-VAL-DEBE IN SRT NOT = 0
               ADD SRT-VAL-DEBE IN SRT TO WSS-D-H-TDEB
               ADD 1 TO WSS-NUM-TDEB IN WSS-VARI.
           IF SRT-VAL-HABE IN SRT NOT = 0
               ADD SRT-VAL-HABE IN SRT TO WSS-D-H-THAB
               ADD 1 TO WSS-NUM-THAB IN WSS-VARI.

      *RVM-CST-INI 10.01.1996
           MOVE SUM-VAL-TDEB TO WSS-AUX-DEBE-TMT IN WSS-VARI.
           MOVE SUM-VAL-THAB TO WSS-AUX-HABE-TMT IN WSS-VARI.
      *RVM-CST-FIN 10.01.1996
      *>>>>
       NXT-OUT-SRT.
           MOVE SRT TO SRT-OLD-LMG.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
           TERMINATE RPT-LMG.
      *<<<< FIN_TMT
      *RVM-CST-INI 10.01.1996
           MOVE WSS-AUX-DEBE-TMT IN WSS-VARI TO WSS-MCT-DEBE.
           MOVE WSS-AUX-HABE-TMT IN WSS-VARI TO WSS-MCT-HABE.
      *RVM-CST-FIN 10.01.1996
           MOVE SRT-CIC-CCSB-CUR IN SRT-CUR-LMG TO
                WSS-CIC-CCSB IN WSS-MCT.
           MOVE SRT-GLS-CCSB-CUR IN SRT-CUR-LMG TO
                WSS-GLS-CCSB IN WSS-MCT.
           GENERATE DL-MCT.
           TERMINATE RPT-MCT.
           CLOSE RPTMCT.

      *FLB CST  3-MAR-1995
           PERFORM ESC-REG-MCT.
           DISPLAY 'REGISTROS MCT GRABADOS : ' WSS-IND-ROKS IN WSS-VARI.
           DISPLAY 'REGISTROS NO GRABADOS  : ' WSS-IND-RERR IN WSS-VARI.

           DISPLAY 'REGISTROS MXE GRABADOS : ' WSS-IND-MXEG IN WSS-VARI.
           DISPLAY 'REGISTROS NO GRABADOS  : ' WSS-IND-MXEE IN WSS-VARI.
      *DAD fin  10-JAN-1995
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM TAB-FIO-MCT.
      *FLB CST  3-MAR-1995
      *    PERFORM TAB-FIO-MCX.
           PERFORM GAR-FIO-MXE.
      *DAD fin  10-JAN-1995
      *>>>>
           CLOSE RPTLMG.
       EXT-OUT-SRT.
           EXIT.
       COPY GARBFGMO.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GARRELMG.
      *    02-MAR-95 11:23 PM     ,PAI=CHI ,CLI= ,SOP=MVS
       DEC-CF-LMG-SRT-COD-OFIC SECTION.
       INI-CF-LMG-SRT-COD-OFIC.
      *<<<< CF_LMG_SRT_COD_OFIC
       CF-OFIC.
           MOVE ZEROES TO PAGE-COUNTER IN RPT-LMG.
           MOVE SRT-COD-OFIC-CUR IN SRT-CUR-LMG TO
                WSS-COD-OFIC IN WSS-VARI.
      *>>>>
       FIN-CF-LMG-SRT-COD-OFIC.
           EXIT.
       DEC-CF-LMG-SRT-CIC-CCSB SECTION.
       INI-CF-LMG-SRT-CIC-CCSB.
      *<<<< CF_LMG_SRT_CIC_CCSB
       CF-CCSB.
           MOVE WSS-NUM-TDEB IN WSS-VARI TO WSS-NUM-TDEB IN WSS-LMG.
           MOVE WSS-NUM-THAB IN WSS-VARI TO WSS-NUM-THAB IN WSS-LMG.
           MOVE ZEROES TO WSS-NUM-TDEB IN WSS-VARI
                          WSS-NUM-THAB IN WSS-VARI.

           MOVE SUM-VAL-TDEB TO WSS-MCT-DEBE.
           MOVE SUM-VAL-THAB TO WSS-MCT-HABE.
           MOVE SRT-CIC-CCSB-OLD IN SRT-OLD-LMG TO
                WSS-CIC-CCSB IN WSS-MCT.
           MOVE SRT-GLS-CCSB-OLD IN SRT-OLD-LMG TO
                WSS-GLS-CCSB IN WSS-MCT.
           MOVE 1 TO WSS-SW IN WSS-VARI.
           GENERATE DL-MCT.
      *>>>>
       FIN-CF-LMG-SRT-CIC-CCSB.
           EXIT.
       DEC-CF-LMG-SRT-COD-VCAM SECTION.
       INI-CF-LMG-SRT-COD-VCAM.
      *<<<< CF_LMG_SRT_COD_VCAM
           MOVE SRT-COD-VCAM-CUR IN SRT-CUR-LMG TO
                WSS-COD-VCAM IN WSS-VARI.
      *>>>>
       FIN-CF-LMG-SRT-COD-VCAM.
           EXIT.
       DEC-CF-LMG-SRT-IND-DBHB SECTION.
       INI-CF-LMG-SRT-IND-DBHB.
      *<<<< CF_LMG_SRT_IND_DBHB
           PERFORM ESC-REG-MCT.
      *FLB CST  3-MAR-1995
           MOVE ZEROES TO WSS-D-H-TDEB.
           MOVE ZEROES TO WSS-D-H-THAB.
      *FLB CST  3-MAR-1995 FIN

      *>>>>
       FIN-CF-LMG-SRT-IND-DBHB.
           EXIT.
       DEC-CF-LMG-SRT-FEC-FMOV SECTION.
       INI-CF-LMG-SRT-FEC-FMOV.
      *<<<< CF_LMG_SRT_FEC_FMOV
           MOVE SRT-FEC-FMOV-OLD IN SRT-OLD-LMG TO
                WSS-FEC-FREG IN WSS-VARI.
           MOVE WSS-NUM-DREG IN WSS-VARI TO WSS-NUM-DMOV IN WSS-MCT.
           MOVE WSS-NUM-MREG IN WSS-VARI TO WSS-NUM-MMOV IN WSS-MCT.
           MOVE WSS-NUM-SREG IN WSS-VARI TO WSS-NUM-SMOV IN WSS-MCT.
           MOVE WSS-NUM-AREG IN WSS-VARI TO WSS-NUM-AMOV IN WSS-MCT.
           MOVE SRT-FEC-FMOV-OLD IN SRT-OLD-LMG TO
                SRT-FEC-FMOV IN WSS-MCT.
      *>>>> HECHO A MANO
       FIN-CF-LMG-SRT-FEC-FMOV.
           EXIT.
       DEC-PH-LMG SECTION.
       INI-PH-LMG.
       FIN-PH-LMG.
           EXIT.
       COPY GNSBGABT.

      *<<<< EOF
      ******************************************************************
       BUS-GDG SECTION.
       INI-BUS-GDG.
      * BUSCA LA GARANTIA
           MOVE SPACES TO MSG-COD-MENS.
           MOVE GAR-NUM-SIS IN GMO TO GAR-NUM-SIS IN GDG.
           MOVE GAR-COD-CRR IN GMO TO GAR-COD-CRR IN GDG.
           MOVE 'GAR-CLV-GDG-1' TO FIO-AKEY.
           MOVE FIO-GET-NLS  TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF NOT (
              FIO-STAT-OKS AND
              GAR-NUM-SIS IN GDG = GAR-NUM-SIS IN GMO AND
              GAR-COD-CRR IN GDG = GAR-COD-CRR IN GMO )
               MOVE 'GAR'        TO MSG-COD-SIST
               MOVE 'GDG    NEX' TO MSG-COD-MENS
               GO TO FIN-BUS-GDG.

           IF GAR-IND-CPL IN GDG NOT = 'S'
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'GDG    CPLNO' TO MSG-COD-MENS.
       FIN-BUS-GDG.
           EXIT.

       BUS-GVT SECTION.
       INI-BUS-GVT.
           IF MSG-COD-MENS > SPACES
               GO TO FIN-BUS-GVT.

      * BUSCA EL VALOR CONTABILIZADO EN LA TASACION VIGENTE
           MOVE GAR-NUM-SIS IN GMO TO GAR-NUM-SIS IN GVT.
           MOVE GAR-COD-CRR IN GMO TO GAR-COD-CRR IN GVT.
           MOVE GAR-COD-TSN IN GMO TO GAR-COD-TSN IN GVT
           MOVE 'GAR-CLV-GVT-1' TO FIO-AKEY.
           MOVE FIO-GET-KEY     TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'        TO MSG-COD-SIST
               MOVE 'GVT    NEX' TO MSG-COD-MENS.
       FIN-BUS-GVT.
           EXIT.

       BUS-TAG SECTION.
       INI-BUS-TAG.
           IF MSG-COD-MENS > SPACES
               GO TO FIN-BUS-TAG.

      * Busca Tabla TAG
           MOVE GAR-TIP-OPE IN GDG TO GAR-TIP-OPE IN TAG.
           MOVE GAR-STP-OPE IN GDG TO GAR-STP-OPE IN TAG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-TAG.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'        TO MSG-COD-SIST
               MOVE 'TAG    NEX' TO MSG-COD-MENS
               GO TO FIN-BUS-TAG.

      * Busca Codigo Cuenta Contable en Tabla DCC de GAR
           MOVE 'GAR'                  TO TAB-COD-SIST.
           MOVE 'DCC'                  TO TAB-COD-TTAB IN TAB.
           MOVE GAR-CLA-OPE-SUP IN TAG TO WSS-CLA-OPE-SUP.
           MOVE GAR-VCB         IN GDG TO WSS-VCB.
           MOVE WSS-COD-CTA            TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               MOVE 'GAR'        TO MSG-COD-SIST
               MOVE 'DCC    NEX' TO MSG-COD-MENS
               DISPLAY 'DCC : ' TAB-COD-CTAB IN TAB
               GO TO FIN-BUS-TAG.
           MOVE TAB-GLS-DATA IN TAB      TO WSS-GLS-DATA IN WSS-VARI.

      * Busca Glosa Cuenta Contable en Tabla PCC de TAB
           MOVE 'TAB'           TO TAB-COD-SIST.
           MOVE 'PCC'           TO TAB-COD-TTAB IN TAB.
           MOVE WSS-COD-CTA-DEB TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE 'PCC    NEX' TO MSG-COD-MENS
               DISPLAY 'CUENTA : ' TAB-COD-CTAB IN TAB
               GO TO FIN-BUS-TAG.
           MOVE TAB-GLS-DESC IN TAB TO SRT-GLS-CCSB IN SRT.
       FIN-BUS-TAG.
           EXIT.
      ******************************************************************
       BUS-OFI-CNT SECTION.
       INI-BUS-OFI-CNT.
      * Carga oficina contable en SRT
           IF MSG-COD-MENS > SPACES
               GO TO FIN-BUS-OFI-CNT.

      * OJO: en BCI, en M/N se contabiliza siempre en la oficina de orig
      *              en M/X se contabiliza en oficinas centralizadoras
           IF GAR-TIP-VCB IN GDG = WSS-TIP-VCB-PESO
               MOVE GAR-COD-OFI IN GDG TO SRT-COD-OFIC IN SRT
           ELSE
      *DAD ini  10-JAN-1995
      *JPA INI 31-JAN-1995
               MOVE GAR-COD-OFI-MOV IN GMO TO SRT-COD-OFIO IN SRT
      *        MOVE GAR-COD-OFI-MOV IN GMO TO WSS-AUX-OFIO IN WSS-VARI
      *JPA FIN 31-JAN-1995
      *DAD fin  10-JAN-1995
               MOVE GAR-COD-OFI-MOV IN GMO TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               DISPLAY 'OFIC : ' OFI-COD-OFCO
               DISPLAY 'OFIO : ' SRT-COD-OFIO IN SRT
               MOVE OFI-COD-OFCO IN OFI TO SRT-COD-OFIC IN SRT.
       FIN-BUS-OFI-CNT.
           EXIT.
      ******************************************************************
      * OBTIENE VALOR DE CAMBIO EN PESOS PARA MONEDA NACIONAL
        DET-VAL-PESO SECTION.
        INI-DET-VAL-PESO.
      * OBTIENE VALOR DE CAMBIO EN PESOS A FECHA CONTABILIZACION
           IF MSG-COD-MENS > SPACES
               GO TO FIN-DET-VAL-PESO.

           IF NOT (
              GAR-TIP-VCB IN GDG = '0' AND
              GAR-VCB IN GDG NOT = WSS-COD-PESO IN WSS-VARI
              )
               MOVE GAR-VCB IN GDG TO SRT-COD-VCAM IN SRT
               GO TO FIN-DET-VAL-PESO.

           MOVE WSS-COD-PESO IN WSS-VARI TO SRT-COD-VCAM IN SRT.
           MOVE WSS-FEC-CNT TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-CNT TO CAM-FEC-FCAM IN CAM(2).
           MOVE GAR-VCB     IN GDG       TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT (
              FIO-STAT-OKS AND CAM-IND-VIGE IN CAM = 'S'
              )
               MOVE 'CAM    NEX' TO MSG-COD-MENS
      *RVM:
               MOVE 'VCAM NO EXISTE O NO '   TO WSS-GLS-MSG1
               MOVE 'ESTA VIGTE. A FECHA : ' TO WSS-GLS-MSG2
               MOVE GAR-FEC-MOV IN GMO       TO WSS-GLS-MSG3
               MOVE ' PARA : '               TO WSS-GLS-MSG4
               MOVE GAR-VCB IN GDG           TO WSS-GLS-MSG5
               MOVE ' EN OPERC. : '          TO WSS-GLS-MSG6
               MOVE GAR-CLV-GDG-1 IN GDG     TO WSS-GLS-MSG7
               MOVE WSS-GLS-MSGE IN WSS-VARI TO MSG-GLS-DESC IN MSG
      *
               MOVE WSS-NO-BUSCA-MSG-ERROR TO WSS-IND-GET-MSG
               GO TO FIN-DET-VAL-PESO
           ELSE
               MULTIPLY WSS-VAL-CNT BY CAM-SGV-VCAM IN CAM GIVING
                        WSS-VAL-PESO ROUNDED
               MOVE WSS-VAL-PESO TO WSS-VAL-CNT.
       FIN-DET-VAL-PESO.
           EXIT.
      ******************************************************************
       ING-CTA-DEB SECTION.
       INI-ING-CTA-DEB.
      * Entra la cuenta
           IF MSG-COD-MENS = SPACES
               MOVE WSS-COD-CTA-DEB TO SRT-CIC-CCSB IN SRT
               MOVE 'D'             TO SRT-IND-DBHB IN SRT
               MOVE WSS-VAL-CNT     TO SRT-VAL-DEBE IN SRT
               MOVE ZEROES          TO SRT-VAL-HABE IN SRT
      * JPA INI 31-01-95
      *        MOVE WSS-AUX-OFIO IN WSS-VARI TO SRT-COD-OFIO IN SRT
      * JPA FIN 31-01-95
      *FLB CST  8-FEB-1995
               MOVE SPACES          TO SRT-IND-CTHA IN SRT
      *FLB CST  8-FEB-1995 FIN
               PERFORM MOV-INP-SRT.
       FIN-ING-CTA-DEB.
           EXIT.

       ING-CTA-HAB SECTION.
       INI-ING-CTA-HAB.
      * Entra la contracuenta
           IF MSG-COD-MENS > SPACES
               GO TO FIN-ING-CTA-HAB.

      * Busca Glosa Cuenta Contable en Tabla PCC de TAB
           MOVE 'TAB'           TO TAB-COD-SIST.
           MOVE 'PCC'           TO TAB-COD-TTAB IN TAB.
           MOVE WSS-COD-CTA-HAB TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE 'PCC    NEX' TO MSG-COD-MENS
               DISPLAY 'CUENTA : ' TAB-COD-CTAB IN TAB
               GO TO FIN-ING-CTA-HAB.
           MOVE TAB-GLS-DESC IN TAB TO SRT-GLS-CCSB IN SRT.
           MOVE WSS-COD-CTA-HAB     TO SRT-CIC-CCSB IN SRT.
           MOVE 'H'                 TO SRT-IND-DBHB IN SRT.
           MOVE SRT-VAL-DEBE IN SRT TO SRT-VAL-HABE IN SRT.
           MOVE ZEROES              TO SRT-VAL-DEBE IN SRT.
      *FLB CST  8-FEB-1995
           MOVE 'H'                 TO SRT-IND-CTHA IN SRT.
           PERFORM MOV-INP-SRT.
       FIN-ING-CTA-HAB.
           EXIT.

       EGR-CTA-DEB SECTION.
       INI-EGR-CTA-DEB.
      * Sale la cuenta
           IF MSG-COD-MENS = SPACES
               MOVE WSS-COD-CTA-DEB TO SRT-CIC-CCSB IN SRT
               MOVE 'H'             TO SRT-IND-DBHB IN SRT
               MOVE WSS-VAL-CNT     TO SRT-VAL-HABE IN SRT
               MOVE ZEROES          TO SRT-VAL-DEBE IN SRT
      *FLB CST  8-FEB-1995
               MOVE SPACES          TO SRT-IND-CTHA IN SRT
               PERFORM MOV-INP-SRT.
       FIN-EGR-CTA-DEB.
           EXIT.

       EGR-CTA-HAB SECTION.
       INI-EGR-CTA-HAB.
      * Sale la contracuenta
           IF MSG-COD-MENS > SPACES
               GO TO FIN-EGR-CTA-HAB.

      * Busca Glosa Cuenta Contable en Tabla PCC de TAB
           MOVE 'TAB'           TO TAB-COD-SIST.
           MOVE 'PCC'           TO TAB-COD-TTAB IN TAB.
           MOVE WSS-COD-CTA-HAB TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               MOVE 'TAB'        TO MSG-COD-SIST
               MOVE 'PCC    NEX' TO MSG-COD-MENS
               DISPLAY 'CUENTA : ' TAB-COD-CTAB IN TAB
               GO TO FIN-EGR-CTA-HAB.
           MOVE TAB-GLS-DESC IN TAB TO SRT-GLS-CCSB IN SRT.
           MOVE WSS-COD-CTA-HAB     TO SRT-CIC-CCSB IN SRT.
           MOVE 'D'                 TO SRT-IND-DBHB IN SRT.
           MOVE SRT-VAL-HABE IN SRT TO SRT-VAL-DEBE IN SRT.
           MOVE ZEROES              TO SRT-VAL-HABE IN SRT.
      * JPA INI 31-01-95
      *    MOVE WSS-AUX-OFIO IN WSS-VARI TO SRT-COD-OFIO IN SRT.
      * JPA FIN 31-01-95
      *FLB CST  8-FEB-1995
           MOVE 'H'                 TO SRT-IND-CTHA IN SRT.
           PERFORM MOV-INP-SRT.
       FIN-EGR-CTA-HAB.
           EXIT.
      ******************************************************************
      * Incrementa el COD-TSN para reflejar el nuevo registro GVT
       DET-COD-TSN SECTION.
       INI-DET-COD-TSN.
           IF GAR-TIP-MOV IN GMO = 'R' OR 'V'
               ADD 1, GAR-COD-TSN IN GMO GIVING SRT-COD-TSN  IN SRT.
       FIN-DET-COD-TSN.
           EXIT.
      ******************************************************************
      * Despliega mensaje error en la entrada
       ERR-INP SECTION.
       INI-ERR-INP.
           IF WSS-IND-GET-MSG = WSS-BUSCA-MSG-ERROR
               PERFORM GET-MSG.
           DISPLAY MSG-COD-MENS ' ' MSG-GLS-DESC
                   ' MOV: ' GAR-CLV-GMO-1 IN GMO
           DISPLAY ' CON ID GARANTIA : ' GAR-CLV-GDG-1 IN GDG
                   ' Y TSN : ' GAR-COD-TSN IN GVT.
           ADD 1 TO WSS-IND-RBAD IN WSS-VARI.
       FIN-ERR-INP.
           EXIT.
      ******************************************************************
      * Busca Datos Cliente por Medio del CIC de Operaciones en Registro
       BUS-REG-CLI SECTION.
       INI-BUS-REG-CLI.
      * Busca CIC del Cliente con el CIC de Garantias en GDD
           MOVE GDG-NUM-SIS IN SRT TO GAR-NUM-SIS IN GDD.
           MOVE GDG-COD-CRR IN SRT TO GAR-COD-CRR IN GDD.
           MOVE 'GAR-CLV-GDD-2'     TO FIO-AKEY.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM GAR-FIO-GDD.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'        TO MSG-COD-SIST
               MOVE 'GDD    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC ' ' GAR-ID IN GDD.
      *        GO TO FIN-BUS-REG-CLI.

      *CIC-CLI Busca Datos del Cliente Mediante su CIC
           MOVE GDD-CIC-ICLI IN GDD TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM GET-CLI.
           IF MSG-COD-MENS > SPACES
               MOVE SPACES TO DBC-NUM-ICLI IN DBC
                              DBC-VRF-ICLI IN DBC
                              DBC-IND-ICLI IN DBC
                              WSS-GLS-AUXI IN WSS-LMG
                              DBC-GLS-ICLI IN DBC
           ELSE
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC
               IF DBC-GLS-ICLI IN DBC > SPACES
                   MOVE '-'    TO WSS-GLS-AUXI IN WSS-LMG
               ELSE
                   MOVE SPACES TO WSS-GLS-AUXI IN WSS-LMG.
       FIN-BUS-REG-CLI.
           EXIT.
      ******************************************************************
      * Impresion Linea MCT y Grabacion del Registro MCT
       ESC-REG-MCT SECTION.
       INI-ESC-REG-MCT.
      * Formacion del Registro MCT
           IF SRT-COD-VCAM-OLD IN SRT-OLD-LMG > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE SRT-COD-VCAM-OLD IN SRT-OLD-LMG TO
                    TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               STRING TAB-COD-DAT1 IN TAB(7)
                      TAB-COD-DAT1 IN TAB(8)
                   DELIMITED BY SIZE INTO MCT-COD-MONE IN MCT
                MOVE TAB-CIC-CTAB IN TAB TO
                    WSS-CIC-VCAM-OLD IN WSS-VARI
                IF WSS-CIC-TVAL-OLD IN WSS-VARI NOT = '0'
                    PERFORM ESC-REG-MXE
                    GO TO FIN-ESC-REG-MCT
                ELSE
                    NEXT SENTENCE
           ELSE
               MOVE 'ZZ' TO MCT-COD-MONE IN MCT.

           MOVE SRT-COD-OFIC-OLD IN SRT-OLD-LMG TO
                MCT-COD-OFIC IN MCT.

           MOVE SRT-CIC-CCSB-OLD IN SRT-OLD-LMG TO MCT-GLS-ICTA IN MCT.

           MOVE SPACES              TO MCT-GLS-FILL IN MCT
                                       MCT-GLS-IDOC IN MCT
                                       MCT-GLS-DISP IN MCT.
           IF SRT-IND-DBHB-OLD IN SRT-OLD-LMG = 'D'
               MOVE  1           TO MCT-IND-TDOC IN MCT
               MOVE WSS-D-H-TDEB TO MCT-VAL-MOVI IN MCT
           ELSE
           IF SRT-IND-DBHB-OLD IN SRT-OLD-LMG = 'H'
               MOVE  2           TO MCT-IND-TDOC IN MCT
               MOVE WSS-D-H-THAB TO MCT-VAL-MOVI IN MCT
           ELSE
               MOVE  0     TO MCT-IND-TDOC IN MCT
               MOVE ZEROES TO MCT-VAL-MOVI IN MCT.

      *DAD ini  10-JAN-1995
           MOVE WSS-GLS-MOVI IN WSS-VARI TO MCT-GLS-MOVI IN MCT.

      * Genera el Registro del Archivo MCT.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM TAB-FIO-MCT.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'MCT    NOPUT' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC
               DISPLAY 'REGISTRO MCT : ' MCT
               ADD 1 TO WSS-IND-RERR IN WSS-VARI
           ELSE
               ADD 1 TO WSS-IND-ROKS IN WSS-VARI.

       FIN-ESC-REG-MCT.
           EXIT.
      ******************************************************************
      ******************************************************************
       ESC-REG-MXE SECTION.
       INI-ESC-REG-MXE.
           STRING TAB-COD-DAT1 IN TAB(7)
                  TAB-COD-DAT1 IN TAB(8)
               DELIMITED BY SIZE INTO MXE-COD-MONE IN MXE.

           MOVE WSS-NUM-DPRO IN WSS-VARI TO MXE-NUM-DPRO IN MXE.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO MXE-NUM-MPRO IN MXE.
           MOVE WSS-NUM-APRO IN WSS-VARI TO MXE-NUM-APRO IN MXE.

           MOVE SRT-COD-OFIC-OLD IN SRT-OLD-LMG TO
                MXE-COD-OFIC IN MXE.

           MOVE SRT-CIC-CCSB-OLD IN SRT-OLD-LMG TO MXE-GLS-ICTA IN MXE.

           IF SRT-IND-DBHB-OLD IN SRT-OLD-LMG = 'D'
               MOVE  1           TO MXE-IND-TDOC IN MXE
               MOVE WSS-D-H-TDEB TO MXE-VAL-MOVI IN MXE
           ELSE
           IF SRT-IND-DBHB-OLD IN SRT-OLD-LMG = 'H'
               MOVE  2           TO MXE-IND-TDOC IN MXE
               MOVE WSS-D-H-THAB TO MXE-VAL-MOVI IN MXE
           ELSE
               MOVE  0     TO MXE-IND-TDOC IN MXE
               MOVE ZEROES TO MXE-VAL-MOVI IN MXE.

           MOVE WSS-GLS-MOVI IN WSS-VARI TO MXE-GLS-MOVI IN MXE.

           MOVE ZEROES TO MXE-NUM-VIGE IN MXE.

           MOVE SPACES TO MXE-GLS-FIL2 IN MXE.

           DISPLAY 'CTHA : ' SRT-IND-CTHA-OLD IN SRT-OLD-LMG.

      *FLB CST  03-03-1995
           MOVE SRT-COD-OFIO-OLD IN SRT-OLD-LMG TO
                WSS-OFI-ORIG IN WSS-VARI.
           DISPLAY 'OFI CUR : ' SRT-COD-OFIO-CUR IN SRT-CUR-LMG.
           DISPLAY 'OFI OLD : ' SRT-COD-OFIO-OLD IN SRT-OLD-LMG.
           IF SRT-IND-CTHA-OLD IN SRT-OLD-LMG = 'H'
               MOVE ZEROES TO MXE-NUM-ANAL IN MXE
           ELSE
               MOVE WSS-NUM-ANAL IN WSS-VARI TO
                    MXE-NUM-ANAL IN MXE.

      * Genera el Registro del Archivo MXE.
      *    MOVE MXE TO MCX.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GAR-FIO-MXE.
      *    PERFORM TAB-FIO-MCX.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'MXE    NOPUT' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC
               DISPLAY 'REGISTRO MXE : ' MXE
               ADD 1 TO WSS-IND-MXEE IN WSS-VARI
           ELSE
               ADD 1 TO WSS-IND-MXEG IN WSS-VARI.

       FIN-ESC-REG-MXE.
           EXIT.

      ******************************************************************
       COPY GARBFGDG.
       COPY GARBFTAG.
       COPY GARBFGVT.
       COPY GARBFGDD.

       COPY SGCBFDBC.

       COPY TABBFCAM.

      *FLB CST  3-MAR-1995
       COPY GARBFMXE.
       COPY TABBFMCX.
       COPY TABBFMCT.
       COPY TABBBOFI.
       COPY TABBFOFI.

       COPY GNSBFCIC.
       COPY GNSBGCIC.
       COPY GNSBBMSG.
       COPY GNSBBTAB.

       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBGCPT.
       COPY SGCBGCLI.

       DEC-CF-MCT-SRT-COD-OFIC SECTION.
      *     USE BEFORE REPORTING CF-MCT-SRT-COD-OFIC.
       INI-CF-MCT-SRT-COD-OFIC.
       CF-OFIC.
           MOVE ZEROES TO PAGE-COUNTER IN RPT-MCT.
       FIN-CF-MCT-SRT-COD-OFIC.
           EXIT.

       DEC-CF-MCT-SRT-COD-VCAM SECTION.
      *     USE BEFORE REPORTING CF-MCT-SRT-COD-VCAM.
       INI-CF-MCT-SRT-COD-VCAM.
       FIN-CF-MCT-SRT-COD-VCAM.
           EXIT.

       DEC-CF-MCT-SRT-FEC-FMOV SECTION.
      *     USE BEFORE REPORTING CF-MCT-SRT-FEC-FMOV.
       INI-CF-MCT-SRT-FEC-FMOV.
       FIN-CF-MCT-SRT-FEC-FMOV.
           EXIT.

       DEC-PH-MCT SECTION.
      *     USE BEFORE REPORTING PH-MCT.
       INI-PH-MCT.

       FIN-PH-MCT.
           EXIT.
      *>>>>
