       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      CTBPBBGR.
       AUTHOR.          GUZMAN Y CIA.

      * BALANCE GASTOS REALES

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
      * INPUT-OUTPUT SECTION.
      *--------------------
      * FILE-CONTROL.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY CTBBRSLD.
       COPY CTBBRBGR.

       COPY GNSWCFIO.
       COPY GNSWVFIO.
       01  WSS-VARI.
           03 WSS-FEC-FACC.
              05 WSS-NUM-DACC                             PIC 9(02).
              05 WSS-NUM-MACC                             PIC 9(02).
              05 WSS-NUM-SACC                             PIC 9(02).
              05 WSS-NUM-AACC                             PIC 9(02).

           03 WSS-FEC-FDES.
              05 WSS-NUM-SDES                             PIC 9(02).
              05 WSS-NUM-ADES                             PIC 9(02).
              05 WSS-NUM-MDES                             PIC 9(02).
              05 WSS-NUM-DDES                             PIC 9(02).

           03 WSS-FEC-FHAS.
              05 WSS-NUM-SHAS                             PIC 9(02).
              05 WSS-NUM-AHAS                             PIC 9(02).
              05 WSS-NUM-MHAS                             PIC 9(02).
              05 WSS-NUM-DHAS                             PIC 9(02).

       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
           PERFORM PRO-BGR UNTIL NOT FIO-STAT-OKS.
           PERFORM FIN.
           STOP RUN.
       FIN-MAIN.
           EXIT.

       INI SECTION.
       INI-INI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM CTB-FIO-SLD.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR APERTURA ARCHIVO SLD: ABORTO'
               STOP RUN.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM CTB-FIO-BGR.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR APERTURA ARCHIVO BGR: ABORTO'
               STOP RUN.

           DISPLAY ' FECHA DE INICIO : '.
           ACCEPT WSS-FEC-FACC.
           MOVE WSS-NUM-DACC TO WSS-NUM-DDES.
           MOVE WSS-NUM-MACC TO WSS-NUM-MDES.
           MOVE WSS-NUM-SACC TO WSS-NUM-SDES.
           MOVE WSS-NUM-AACC TO WSS-NUM-ADES.

           DISPLAY ' FECHA DE TERMINO : '.
           ACCEPT WSS-FEC-FACC.
           MOVE WSS-NUM-DACC TO WSS-NUM-DHAS.
           MOVE WSS-NUM-MACC TO WSS-NUM-MHAS.
           MOVE WSS-NUM-SACC TO WSS-NUM-SHAS.
           MOVE WSS-NUM-AACC TO WSS-NUM-AHAS.
      *  OBTENER FST-SLD
           MOVE WSS-FEC-FDES TO SLD-FEC-FSLD.
           MOVE '2' TO SLD-IND-TREG.
           MOVE ZEROES TO SLD-NUM-CDC2.
           MOVE ZEROES TO SLD-NUM-CTB2.
           MOVE SPACES TO SLD-COD-MONE.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM CTB-FIO-SLD.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ARCHIVO SLD VACIO :  ABORTO'
               STOP RUN.
       FIN-INI.
           EXIT.

       PRO-BGR SECTION.
       INI-PRO-BGR.
           IF WSS-FEC-FHAS < SLD-FEC-FSLD
                MOVE '99' TO FIO-STAT
                GO TO FIN-PRO-BGR.
           IF SLD-IND-TREG IN SLD = '2'
                PERFORM PRO-NIV.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM CTB-FIO-SLD.
       FIN-PRO-BGR.
            EXIT.

       PRO-NIV SECTION.
       INI-PRO-NIV.
           MOVE SLD-NUM-CDC2 TO BGR-NUM-CCDC.
           MOVE SLD-NUM-CTB2 TO BGR-NUM-CCTB.
           MOVE SLD-NUM-SSLD TO BGR-NUM-SBGR.
           MOVE SLD-NUM-ASLD TO BGR-NUM-ABGR.
           MOVE SLD-NUM-MSLD TO BGR-NUM-MBGR.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM CTB-FIO-BGR.
           IF FIO-STAT-OKS
               COMPUTE BGR-VAL-VBGR = BGR-VAL-VBGR + SLD-VAL-AHAB
                                                   - SLD-VAL-ADEB 
               MOVE FIO-MOD TO FIO-CMND
               PERFORM CTB-FIO-BGR
           ELSE
               COMPUTE BGR-VAL-VBGR = SLD-VAL-AHAB - SLD-VAL-ADEB
               MOVE FIO-PUT TO FIO-CMND
               PERFORM CTB-FIO-BGR.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR: ARCHIVO BGR FIO-STAT = ' FIO-STAT
               DISPLAY ' BGR = '
               DISPLAY BGR
               IF FIO-CMND = FIO-PUT
                   DISPLAY 'GRABANDO'
               ELSE
                   DISPLAY 'MODIFICANDO'.
       FIN-PRO-NIV.
           EXIT.

       FIN SECTION.
       FIN-INI.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM CTB-FIO-SLD.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM CTB-FIO-BGR.
       FIN-FIN.
           EXIT.

       COPY CTBBFSLD.
       COPY CTBBFBGR.
