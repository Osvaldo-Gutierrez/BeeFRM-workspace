       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      CTBPBBCS.
       AUTHOR.          CONSIST.

      * BALANCE CUENTAS CONTABLES SUPER

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
      * INPUT-OUTPUT SECTION.
      *--------------------
      * FILE-CONTROL.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY CTBBRSLD.
       COPY CTBBRBCS.
       COPY CTBBRCCS.
       COPY CTBBRCTB.
       01  WSS-VARI.
           03 WSS-VAL-SDEU                          PIC 9(12).
           03 WSS-VAL-SACR                          PIC 9(12).

           03 WSS-FEC-FDES.
              05 WSS-NUM-SDES                       PIC 9(02).
              05 WSS-NUM-ADES                       PIC 9(02).
              05 WSS-NUM-MDES                       PIC 9(02).
              05 WSS-NUM-DDES                       PIC 9(02).

           03 WSS-FEC-FHAS.
              05 WSS-NUM-SHAS                       PIC 9(02).
              05 WSS-NUM-AHAS                       PIC 9(02).
              05 WSS-NUM-MHAS                       PIC 9(02).
              05 WSS-NUM-DHAS                       PIC 9(02).

           03 WSS-FEC-FACC.
              05 WSS-NUM-DACC                       PIC 9(02).
              05 WSS-NUM-MACC                       PIC 9(02).
              05 WSS-NUM-SACC                       PIC 9(02).
              05 WSS-NUM-AACC                       PIC 9(02).

           03 WSS-IND-COMO                          PIC X(01).
           03 WSS-IND-NIVE                          PIC X(02).
       COPY GNSWCFIO.
       COPY GNSWVFIO.

       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
           PERFORM FST-SLD.
           PERFORM PRO-CCS UNTIL NOT FIO-STAT-OKS OR
                                 SLD-FEC-FSLD > WSS-FEC-FHAS.
           PERFORM ADD-BCS.
           PERFORM FIN.
           STOP RUN.
       FIN-MAIN.
           EXIT.

       PRO-CCS SECTION.
       INI-PRO-CCS.
           IF SLD-IND-TREG IN SLD NOT = '1'
               GO TO LAB-NXT-SLD.
           MOVE SLD-NUM-CTB1 TO CTB-NUM-CCTB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM CTB-FIO-CTB.
           IF FIO-STAT-OKS
               MOVE CTB-NUM-CCSA TO CCS-NUM-CCSA
               PERFORM PRO-NIV
               MOVE ZEROES TO CCS-NUM-CSA3
      * SE CALCULA EL BALANCE A TODOS LOS NIVEL LO QUE PROVOCA 
      * DISTORSION A NIVEL DE CUENTAS XX.XX0 Y XX.X00
      *         PERFORM PRO-NIV
               MOVE ZEROES TO CCS-NUM-CSA2
      *         PERFORM PRO-NIV
               MOVE ZEROES TO CCS-NUM-CSA1
               PERFORM VLD-NIV
            ELSE
               DISPLAY ' ERROR : CUENTA CONTABLE INEXISTENTE'
               DISPLAY ' CTB = ' CTB-NUM-CCTB
               DISPLAY 'ABORTO'
               STOP RUN.
       LAB-NXT-SLD.
           PERFORM NXT-SLD.
       FIN-PRO-SLD.
            EXIT.

       VLD-NIV SECTION.
       INI-VLD-NIV.
           MOVE CCS-NUM-CCSA IN CCS TO WSS-IND-NIVE.
           IF WSS-IND-NIVE = '11' OR '12' OR '13' OR '14' OR
                             '21' OR '22'
               PERFORM PRO-NIV.
       FIN-VLD-NIV.
           EXIT.
       PRO-NIV SECTION.
       INI-PRO-NIV.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM CTB-FIO-CCS.
           IF NOT FIO-STAT-OKS
                DISPLAY ' CUENTA SUPER INEXISTENTE'
                DISPLAY ' CCS = ' CCS-NUM-CCSA
                DISPLAY ' PARA CUENTA CONTABLE ' CTB-NUM-CCTB
                DISPLAY ' PARA SALDO'
                DISPLAY SLD
                GO TO FIN-PRO-NIV.
           MOVE CCS-NUM-CCSA TO BCS-NUM-CCSA.
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM CTB-FIO-BCS
           IF FIO-STAT-OKS
               ADD  SLD-VAL-ADEB TO BCS-VAL-ADEB
               ADD  SLD-VAL-AHAB TO BCS-VAL-AHAB
               PERFORM CAL-SLD
               MOVE FIO-MOD TO FIO-CMND
               PERFORM CTB-FIO-BCS
           ELSE
               MOVE SLD-VAL-ADEB TO BCS-VAL-ADEB
               MOVE SLD-VAL-AHAB TO BCS-VAL-AHAB
               PERFORM CAL-SLD
               MOVE FIO-PUT TO FIO-CMND
               PERFORM CTB-FIO-BCS.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ACTUALIZACION ERRONEA ARCHIVO BCS'
               DISPLAY 'ABORTO CON FIO-STAT = ' FIO-STAT
               STOP RUN.
       FIN-PRO-NIV.
           EXIT.

       NXT-SLD SECTION.
       INI-NXT-SLD.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM CTB-FIO-SLD.
       FIN-NXT-SLD.
           EXIT.

       INI-WSS SECTION.
       INI-INI-WSS.
           MOVE ZEROES TO WSS-VAL-SDEU.
           MOVE ZEROES TO WSS-VAL-SACR.
       FIN-INI-WSS.
           EXIT.

       ADD-WSS SECTION.
       INI-ADD-WSS.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM CTB-FIO-BCS.
           IF FIO-STAT-OKS
               ADD BCS-VAL-ADEB TO WSS-VAL-SDEU
               ADD BCS-VAL-AHAB TO WSS-VAL-SACR.
       FIN-ADD-WSS.
           EXIT.

       PUT-BCS SECTION.
       INI-PUT-BCS.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM CTB-FIO-BCS.
           IF NOT FIO-STAT-OKS
               MOVE WSS-VAL-SDEU TO BCS-VAL-ADEB
               MOVE WSS-VAL-SACR TO BCS-VAL-AHAB
               PERFORM CAL-SLD
               MOVE FIO-PUT TO FIO-CMND
               PERFORM CTB-FIO-BCS
           ELSE
               ADD  WSS-VAL-SDEU TO BCS-VAL-ADEB
               ADD  WSS-VAL-SACR TO BCS-VAL-AHAB
               PERFORM CAL-SLD
               MOVE FIO-MOD TO FIO-CMND
               PERFORM CTB-FIO-BCS.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR: CUENTA SUPER ESPECIAL'
               DISPLAY 'ERROR: BCS = ' BCS
               DISPLAY 'ERROR: FIO-STAT = ' FIO-STAT
               IF FIO-CMND = FIO-PUT
                   DISPLAY 'ERROR: INGRESANDO'
               ELSE
                   DISPLAY 'ERROR: MODIFICANDO'.
       FIN-PUT-BCS.
           EXIT.

       CAL-SLD SECTION.
       INI-CAL-SLD.
               IF BCS-VAL-ADEB > BCS-VAL-AHAB
                   COMPUTE BCS-VAL-SDEU = BCS-VAL-ADEB - BCS-VAL-AHAB 
                   MOVE ZEROES TO BCS-VAL-SACR
               ELSE
                   COMPUTE BCS-VAL-SACR = BCS-VAL-AHAB - BCS-VAL-ADEB
                   MOVE ZEROES TO BCS-VAL-SDEU.
       FIN-CAL-SLD.
           EXIT.

       ADD-BCS SECTION.
       INI-ADD-BCS.

      *      31200
           PERFORM INI-WSS.
           MOVE '31201' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31202' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31203' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31204' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31205' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31206' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31208' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31209' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31210' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31200' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      * 32000
           PERFORM INI-WSS.
           MOVE '32100' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '32110' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '32120' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '32210' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '32221' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '32222' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '32230' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '32300' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '32000' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      34000
           PERFORM INI-WSS.
           MOVE '30200' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '30500' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '30600' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '34000' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      31110
           PERFORM INI-WSS.
           MOVE '31111' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31112' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31113' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31114' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31110' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      31120
           PERFORM INI-WSS.
           MOVE '31121' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31122' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31123' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31124' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31120' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      31101
           PERFORM INI-WSS.
           MOVE '31110' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31120' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31101' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      31150
           PERFORM INI-WSS.
           MOVE '31151' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31152' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31153' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31154' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31155' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31156' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31157' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31150' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      31160
           PERFORM INI-WSS.
           MOVE '31161' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31162' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31160' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      31170
           PERFORM INI-WSS.
           MOVE '31171' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31172' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31173' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31174' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31175' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31170' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.


      *      31102
           PERFORM INI-WSS.
           MOVE '31150' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31160' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31170' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31180' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31190' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31102' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      31100
           PERFORM INI-WSS.
           MOVE '31101' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31102' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31103' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31104' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31100' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      31000 OJO 31100 FUE CALCULADA EN FORMA ESPECIAL
      *      POR ESO ENTRA A PROCESO DE 31000 SUPONGO QUE NO
      *      TIENE MOVIMIENTOS PROPIOS
           PERFORM INI-WSS.
           MOVE '31100' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31200' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '31000' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      30100
           PERFORM INI-WSS.
           MOVE '31000' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '32000' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '30100' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      30300
           PERFORM INI-WSS.
           MOVE '30100' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '30200' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '30300' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.


      *      30000 OJO 30300 FUE CALCULADA EN FORMA ESPECIAL
      *      POR ESO ENTRA A PROCESO DE 30000
           PERFORM INI-WSS.
           MOVE '30300' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '30500' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '30000' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.


      *      23044
           PERFORM INI-WSS.
           MOVE '30000' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '30600' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '23044' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      23040
           PERFORM INI-WSS.
           MOVE '23041' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '23042' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '23043' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '23044' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '23045' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '23040' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      23000
           PERFORM INI-WSS.
           MOVE '23010' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '23020' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '23030' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '23035' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '23040' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '23000' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      20000
           PERFORM INI-WSS.
           MOVE '21000' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '22000' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '23000' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '20000' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

      *      10000
           PERFORM INI-WSS.
           MOVE '11000' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '12000' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '13000' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '14000' TO BCS-NUM-CCSA.
           PERFORM ADD-WSS.
           MOVE '10000' TO BCS-NUM-CCSA.
           PERFORM PUT-BCS.

       FIN-ADD-BCS.
           EXIT.

       INI SECTION.
       INI-INI.
           DISPLAY ' FECHA DE INICIO : '.
           ACCEPT WSS-FEC-FACC.
           MOVE WSS-NUM-SACC TO WSS-NUM-SDES.
           MOVE WSS-NUM-AACC TO WSS-NUM-ADES.
           MOVE WSS-NUM-MACC TO WSS-NUM-MDES.
           MOVE WSS-NUM-DACC TO WSS-NUM-DDES.
           DISPLAY ' FECHA DE TERMINO : '.
           ACCEPT WSS-FEC-FACC.
           MOVE WSS-NUM-SACC TO WSS-NUM-SHAS.
           MOVE WSS-NUM-AACC TO WSS-NUM-AHAS.
           MOVE WSS-NUM-MACC TO WSS-NUM-MHAS.
           MOVE WSS-NUM-DACC TO WSS-NUM-DHAS.

      *     ACCEPT WSS-IND-COMO.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM CTB-FIO-CTB.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR APERTURA ARCHIVO CTB: ABORTO'
               STOP RUN.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM CTB-FIO-CCS.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR APERTURA ARCHIVO CCS: ABORTO'
               STOP RUN.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM CTB-FIO-SLD.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR APERTURA ARCHIVO SLD: ABORTO'
               STOP RUN.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM CTB-FIO-BCS.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR APERTURA ARCHIVO BCS: ABORTO'
               STOP RUN.
       FIN-INI.
           EXIT.

       FST-SLD SECTION.
       INI-FST-SLD.
      *  OBTENER FST-SLD
           MOVE WSS-FEC-FDES TO SLD-FEC-FSLD.
           MOVE SPACES       TO SLD-IND-TREG.
           MOVE SPACES       TO SLD-COD-CTCC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM CTB-FIO-SLD.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ARCHIVO SALDOS VACIO :  ABORTO'
               STOP RUN.
       FIN-FST-SLD.
           EXIT.

       FIN SECTION.
       FIN-INI.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM CTB-FIO-BCS.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM CTB-FIO-CTB.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM CTB-FIO-CCS.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM CTB-FIO-SLD.
       FIN-FIN.
           EXIT.

       COPY CTBBFBCS.
       COPY CTBBFCCS.
       COPY CTBBFCTB.
       COPY CTBBFSLD.
