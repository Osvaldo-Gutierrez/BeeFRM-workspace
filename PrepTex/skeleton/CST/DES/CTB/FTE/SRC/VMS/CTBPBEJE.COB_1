       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      CTBPBEJE.
       AUTHOR.          CONSIST.

      * CALCULO DE EJERCICIO

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
      * INPUT-OUTPUT SECTION.
      *--------------------
      * FILE-CONTROL.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY CTBBREJE.
       COPY CTBBRBSV.
       COPY CTBBRBSH.

       COPY GNSWCFIO.
       COPY GNSWVFIO.
       01  WSS-VARI.
           03 WSS-IND-SALD                PIC X(07).
           03 WSS-VAL-SDEU                PIC S9(12).
           03 WSS-VAL-SACR                PIC S9(12).

       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
           PERFORM PRO-EJE.
           PERFORM FIN.
           STOP RUN.
       FIN-MAIN.
           EXIT.

       PRO-EJE SECTION.
       INI-PRO-EJE.
           MOVE ZEROES TO WSS-VAL-SDEU.
           MOVE 'DEU-DEU' TO WSS-IND-SALD.

      *    44110
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '11010' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '11020' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '44110' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    44120
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '11030' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '11035' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '44120' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    44130
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '11041' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '11043' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '44130' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    44140
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '11044' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '44140' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    44150
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '11045' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '44150' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    44160
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '11046' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '11050' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '44160' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    44170
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '11060' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '11070' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '11080' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '11090' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '44170' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    44180
           MOVE ZEROES TO EJE-VAL-EJER.

           MOVE '11100' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.

           MOVE '11101' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '44180' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    44190
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '11110' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '44190' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    44000
           MOVE '44000' TO EJE-NUM-CCSA.
           MOVE WSS-VAL-SDEU TO EJE-VAL-EJER.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM CTB-FIO-EJE.

           MOVE ZEROES TO WSS-VAL-SACR.
      *    45110
           MOVE 'ACR-ACR' TO WSS-IND-SALD.
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '21010' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '45110' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    45120
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '21020' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '45120' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    45130
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '21030' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '45130' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    45140
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '21040' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '21050' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '45140' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    45150
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '21060' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '45150' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    45160
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '21070' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '21080' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '21090' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '45160' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.


      *    45170
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '21100' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '45170' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    45180
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '21110' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '45180' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    45190
           MOVE ZEROES TO EJE-VAL-EJER.
           MOVE '21120' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '21130' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '21131' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '21140' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '21150' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '21160' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '21170' TO BSH-NUM-CCSA.
           PERFORM ADD-EJE.
           MOVE '45190' TO EJE-NUM-CCSA.
           PERFORM PUT-EJE.

      *    45000
           MOVE '45000' TO EJE-NUM-CCSA.
           MOVE WSS-VAL-SACR TO EJE-VAL-EJER.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM CTB-FIO-EJE.

      *    43000
           MOVE '43000' TO EJE-NUM-CCSA.
           COMPUTE EJE-VAL-EJER = WSS-VAL-SDEU - WSS-VAL-SACR. 
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM CTB-FIO-EJE.
       FIN-PRO-EJE.
            EXIT.

       ADD-EJE SECTION.
       INI-ADD-EJE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM CTB-FIO-BSH.
           IF NOT FIO-STAT-OKS
               MOVE ZEROES TO BSH-VAL-ADEB
                              BSH-VAL-AHAB
                              BSH-VAL-SDEU
                              BSH-VAL-SACR.
           MOVE BSH-NUM-CCSA TO BSV-NUM-CCSA
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM CTB-FIO-BSV.
           IF NOT FIO-STAT-OKS
               MOVE ZEROES TO BSV-VAL-ADEB
                              BSV-VAL-AHAB
                              BSV-VAL-SDEU
                              BSV-VAL-SACR.
      *           IF WSS-IND-SALD = 'DEU-DEU'
      *               COMPUTE EJE-VAL-EJER = EJE-VAL-EJER + 
      *                                    ( BSV-VAL-SDEU -
      *                                      BSH-VAL-SDEU )
      *               COMPUTE WSS-VAL-SDEU = WSS-VAL-SDEU + 
      *                                    ( BSV-VAL-SDEU -
      *                                      BSH-VAL-SDEU )
      *           ELSE
      *           IF WSS-IND-SALD = 'DEU-ACR'
      *               COMPUTE EJE-VAL-EJER = EJE-VAL-EJER +
      *                                    ( BSV-VAL-SACR -
      *                                      BSH-VAL-SACR )
      *               COMPUTE WSS-VAL-SDEU = WSS-VAL-SDEU +
      *                                    ( BSV-VAL-SACR -
      *                                      BSH-VAL-SACR )
      *           ELSE
      *           IF WSS-IND-SALD = 'ACR-ACR'
      *               COMPUTE EJE-VAL-EJER = EJE-VAL-EJER + 
      *                                    ( BSV-VAL-SACR -
      *                                      BSH-VAL-SACR )
      *               COMPUTE WSS-VAL-SACR = WSS-VAL-SACR + 
      *                                    ( BSV-VAL-SACR -
      *                                      BSH-VAL-SACR ).
           IF WSS-IND-SALD = 'DEU-DEU'
               IF BSV-VAL-SDEU > ZEROES
                  COMPUTE EJE-VAL-EJER = EJE-VAL-EJER + 
                                       ( BSV-VAL-SDEU -
                                         BSH-VAL-SDEU )
                  COMPUTE WSS-VAL-SDEU = WSS-VAL-SDEU + 
                                       ( BSV-VAL-SDEU -
                                         BSH-VAL-SDEU )
               ELSE
                  COMPUTE EJE-VAL-EJER = EJE-VAL-EJER -
                                       ( BSV-VAL-SACR -
                                         BSH-VAL-SACR )
                  COMPUTE WSS-VAL-SDEU = WSS-VAL-SDEU -
                                       ( BSV-VAL-SACR -
                                         BSH-VAL-SACR )
           ELSE
               IF BSV-VAL-SACR > ZEROES
                  COMPUTE EJE-VAL-EJER = EJE-VAL-EJER + 
                                       ( BSV-VAL-SACR -
                                         BSH-VAL-SACR )
                  COMPUTE WSS-VAL-SACR = WSS-VAL-SACR + 
                                       ( BSV-VAL-SACR -
                                         BSH-VAL-SACR )
               ELSE
                  COMPUTE EJE-VAL-EJER = EJE-VAL-EJER -
                                       ( BSV-VAL-SDEU -
                                         BSH-VAL-SDEU )
                  COMPUTE WSS-VAL-SACR = WSS-VAL-SACR -
                                       ( BSV-VAL-SDEU -
                                         BSH-VAL-SDEU ).
       FIN-ADD-EJE.
           EXIT.

       PUT-EJE SECTION.
       INI-PUT-EJE.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM CTB-FIO-EJE.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR EN ACTUALIZACION ARCHIVO EJE FIO-STAT = '
                       FIO-STAT
               DISPLAY 'EJE = '
               DISPLAY EJE.
       FIN-PUT-EJE.
           EXIT.

       INI SECTION.
       INI-INI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM CTB-FIO-BSH.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR APERTURA ARCHIVO BSH: ABORTO ' FIO-STAT
               STOP RUN.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM CTB-FIO-BSV.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR APERTURA ARCHIVO BSV: ABORTO ' FIO-STAT
               STOP RUN.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM CTB-FIO-EJE.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR APERTURA ARCHIVO EJE: ABORTO ' FIO-STAT
               STOP RUN.
       FIN-INI.
           EXIT.

       FIN SECTION.
       FIN-INI.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM CTB-FIO-BSV.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM CTB-FIO-BSH.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM CTB-FIO-BSV.
       FIN-FIN.
           EXIT.

       COPY CTBBFBSV.
       COPY CTBBFBSH.
       COPY CTBBFEJE.
