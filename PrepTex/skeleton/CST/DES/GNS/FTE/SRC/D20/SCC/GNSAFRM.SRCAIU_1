       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   {SIS}A{FRM}.
       AUTHOR.       CONSIST.
       DATE-WRITTEN. {FEC}.

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SOURCE-COMPUTER. T16.
       OBJECT-COMPUTER. T16 TERMINAL IS T16-6530.
       SPECIAL-NAMES.

       COPY GNSCGSPN.

       INPUT-OUTPUT SECTION.
      *====================
       SCREEN-CONTROL.
      *--------------
           ERROR-ENHANCEMENT IS BLINK IN ALL.

       DATA DIVISION.
      *==============
       WORKING-STORAGE SECTION.
      *------------------------
       COPY GNSWCFRM.
       COPY GNSWGSYS.
       COPY {SIS}WI{FRM}.
       01  {FRM}-MAPA.
       COPY GNSWIHDR.
       COPY GNSWITRL.
       01  PGM-MSGI.
           03 PGM-MSGI-COD                 COMP PIC S9(04).
           03 PGM-MSGI-CMA                      PIC X(3500).
           03 PGM-MSGI-FRM                      PIC X(2627).
           03 PGM-MSGI-SYS                      PIC X(55).
       01  PGM-MENS.
           03 PGM-MEN1                          PIC X(24).
           03 PGM-MEN2                          PIC X(12).
           03 PGM-MEN3                          PIC X(32).
           03 PGM-MEN4                          PIC 9(05).
           03 PGM-MEN5                          PIC X(01).
           03 PGM-MEN6                          PIC 9(05).
      *
       LINKAGE SECTION.
      *----------------
       COPY GNSWVSCR.
       COPY GNSWVFRM.

       SCREEN SECTION.
      *--------------
       01  {SIS}F{FRM} BASE SIZE 24, 80 UPSHIFT.

       COPY GNSSGHDR.
      *
           03 SC-{frm}.
% INCLUDE '{SIS}A{FRM}.PTX'
              05 SC-{frm}-GLS-MENS AT 24, 01
                            PIC X(79)
                            FROM {frm}-GLS-MENS IN {frm}-FLD REVERSE.
      *
       COPY GNSSGTRL.

       PROCEDURE DIVISION USING SCR-VARI FRM-VARI.
      *===========================================
       MAIN SECTION.
       INI-MAIN.
           IF SCR-DESDE-CMN
               PERFORM GNS-PRO-PGM
           ELSE
               PERFORM GNS-PRO-FRM.
       FIN-MAIN.
           EXIT PROGRAM.

       GNS-PRO-FRM SECTION.
       INI-GNS-PRO-FRM.
           GO TO PUT-GNS-PRO-FRM GET-GNS-PRO-FRM PUT-GNS-PRO-FRM
                 CLR-GNS-PRO-FRM MSG-GNS-PRO-FRM GET-GNS-PRO-FRM
               DEPENDING ON FRM-CMND.
           GO TO FIN-GNS-PRO-FRM.

       GET-GNS-PRO-FRM.
           MOVE FRM-DFLD TO {FRM}-MAPA.
           DISPLAY BASE {SIS}F{FRM}.
           TURN PROTECTED IN {SIS}F{FRM}.
           TURN UNPROTECTED IN SC-TRL-COD-CACC.
           DISPLAY {SIS}F{FRM}.
           ACCEPT {SIS}F{FRM} UNTIL
               KF1,  KF2,  KF3,  KF4,  KF5,  KF6,  KF7, KF8,
               KF9,  KF10, KF11, KF12.
           MOVE TERMINATION-STATUS      TO FRM-FFLD.
           MOVE TRL-COD-CACC IN TRL-FLD TO FRM-DFLD.                
           GO TO FIN-GNS-PRO-FRM.

       PUT-GNS-PRO-FRM.
           MOVE FRM-DFLD TO {FRM}-MAPA.
           DISPLAY BASE {SIS}F{FRM}.
           DISPLAY {SIS}F{FRM}.
           DELAY 0.
           GO TO FIN-GNS-PRO-FRM.

       CLR-GNS-PRO-FRM.
           RESET {SIS}F{FRM}.
           GO TO FIN-GNS-PRO-FRM.

       MSG-GNS-PRO-FRM.
           MOVE FRM-MENS TO {FRM}-GLS-MENS IN {FRM}-FLD.
           DISPLAY BASE {SIS}F{FRM}.
           DISPLAY SC-{FRM}-GLS-MENS.
           GO TO FIN-GNS-PRO-FRM.

       FIN-GNS-PRO-FRM.
           EXIT.

       GNS-PRO-PGM SECTION.
       INI-GNS-PRO-PGM.
           MOVE FRM-DFLD TO {FRM}-MAPA.
           MOVE SCR-VARI TO SYS-CMMA.
       LUP-GNS-PRO-PGM.
           BEGIN-TRANSACTION.
           MOVE "N" TO SYS-BKOU.

           MOVE SPACES   TO FRM-MENS.
           MOVE SYS-CMMA TO PGM-MSGI-CMA.
           MOVE FRM-VARI TO PGM-MSGI-FRM.
           MOVE SYS-VARI TO PGM-MSGI-SYS.

           SEND PGM-MSGI TO SCR-PROG
                REPLY CODE 0 YIELDS PGM-MSGI
                ON ERROR GO TO ERR-GNS-PRO-PGM.

           MOVE PGM-MSGI-CMA TO SYS-CMMA.
           MOVE PGM-MSGI-FRM TO FRM-VARI.
           MOVE PGM-MSGI-SYS TO SYS-VARI.

           IF SYS-BKOU = "S"
               ABORT-TRANSACTION
           ELSE
               END-TRANSACTION.

           MOVE FRM-DFLD TO {FRM}-FLD.

           IF SYS-CMND = SYS-ABOR
               MOVE SYS-MENS TO {FRM}-GLS-MENS IN {FRM}-FLD
           ELSE
           IF SYS-CMND = SYS-RTRN
               MOVE SYS-CMMA TO SCR-VARI.

           DISPLAY BASE {SIS}F{FRM}.
           TURN PROTECTED IN {SIS}F{FRM}.
           TURN UNPROTECTED IN {SIS}F{FRM} SHADOWED.
           DISPLAY {SIS}F{FRM}.
       ACC-GNS-PRO-PGM.
           ACCEPT {SIS}F{FRM} UNTIL
               KF1,  KF2,  KF3,  KF4,  KF5,  KF6,  KF7, KF8,
               KF9,  KF10, KF11, KF12.
           MOVE TERMINATION-STATUS TO FRM-FFLD.
           MOVE {FRM}-FLD TO FRM-DFLD.
           IF FRM-FFLD = FRM-FFLD-PF3
               GO TO FIN-GNS-PRO-PGM
           ELSE
               GO TO LUP-GNS-PRO-PGM.
       ERR-GNS-PRO-PGM.
           END-TRANSACTION.
           MOVE "%Error SEND a programa: "         TO PGM-MEN1.
           MOVE SCR-PROG                           TO PGM-MEN2.
           MOVE ". TERMINATION-STATUS/SUBSTATUS: " TO PGM-MEN3.
           MOVE TERMINATION-STATUS                 TO PGM-MEN4.
           MOVE "/"                                TO PGM-MEN5.
           MOVE TERMINATION-SUBSTATUS              TO PGM-MEN6.
           MOVE PGM-MENS TO {FRM}-GLS-MENS IN {FRM}-FLD.
           DISPLAY BASE {SIS}F{FRM}.
           DISPLAY SC-{FRM}-GLS-MENS.
           GO TO ACC-GNS-PRO-PGM.
       FIN-GNS-PRO-PGM.
           EXIT.
