IDENTIFICATION DIVISION.
*=======================
PROGRAM-ID.	DESPROPRV.
AUTHOR.		GUZMAN Y CIA.

* Manejo de Privilegios para un Proceso

ENVIRONMENT DIVISION.
*====================

DATA DIVISION.
*=============

WORKING-STORAGE SECTION.
*-----------------------
COPY	'DESREG.PRV'	FROM	DICTIONARY
	REPLACING
	==PRV==		BY	==PRV	EXTERNAL==.
COPY	FIOWSS	IN	DESTXT.
COPY	PRVWSS	IN	DESTXT.
COPY	STRWSS	IN	TXT.
01 WSS-VARI.
	03 WSS-SOKS				PIC X(01)
					VALUE 'S'.
	03 WSS-SMAL				PIC X(01)
					VALUE 'N'.

PROCEDURE DIVISION.
*==================

MAIN SECTION.
*------------
INI-MAIN.
	MOVE WSS-SMAL TO PRV-STAT.
	MOVE FIO-IFNF-PGM TO FIO-IFNF.
	CALL 'DESFIOPRV' USING FIO-FNF.
	CALL 'DESFIOPRV' USING FIO-INP.
	IF NOT FIO-STAT-OKS
		GO TO FIN-MAIN.
LUP-MAIN.
	CALL 'DESFIOPRV' USING FIO-GET-NXT.
	IF NOT FIO-STAT-OKS
		GO TO FIN-MAIN.
	MOVE SPACES TO PRV-NEMO PRV-CMND PRV-STAT.
	UNSTRING PRV DELIMITED BY '/' INTO PRV-USER PRV-OWNE PRV-NEMO
					   PRV-CMND PRV-STAT.
	IF PRV-CMND NOT = SPACES
		GO TO LUP-MAIN.
	MOVE PRV-PROC TO STR-CAND.
	MOVE PRV-NEMO TO STR-PATT.
	PERFORM PRV-MTCH.
	IF NOT STR-MTCH-YES
		GO TO LUP-MAIN.
FIN-MAIN.
	CALL 'DESFIOPRV' USING FIO-CLO.
	EXIT PROGRAM.
	
PRV-MTCH SECTION.
*----------------
INI-PRV-MTCH.
	IF SPACES = STR-PATT OR STR-CAND OR NOT STR-PCHR(STR-ILIM)
		GO TO MTC-PRV-MTCH.
	PERFORM BUS-CHAR VARYING STR-IAST FROM STR-ILIM BY -1
		UNTIL STR-IAST < 1 OR STR-PCHR(STR-IAST) = '*'.
	IF STR-IAST < 1
		GO TO MTC-PRV-MTCH.
	PERFORM BUS-CHAR VARYING STR-IMAX FROM STR-ILIM BY -1 UNTIL
		STR-CCHR(STR-IMAX) NOT = SPACES
	PERFORM BUS-CHAR VARYING STR-INBL FROM STR-ILIM BY -1 UNTIL
		STR-PCHR(STR-INBL) NOT = SPACES.
	IF STR-INBL NOT < STR-IMAX
		GO TO MTC-PRV-MTCH.
	PERFORM MOV-CHAR VARYING STR-ISTR FROM 1 BY 1
		UNTIL STR-ISTR > STR-INBL - STR-IAST.
	PERFORM PUT-ASTE VARYING STR-ISTR FROM 1 BY 1
		UNTIL STR-ISTR > STR-IMAX - STR-INBL.
MTC-PRV-MTCH.
	CALL 'STR$MATCH_WILD'	USING
		BY DESCRIPTOR	STR-CAND
		BY DESCRIPTOR	STR-PATT
		GIVING		STR-MTCH.
FIN-PRV-MTCH.
	EXIT.

BUS-CHAR SECTION.
*----------------
INI-BUS-CHAR.
FIN-BUS-CHAR.
	EXIT.

MOV-CHAR SECTION.
*----------------
INI-MOV-CHAR.
	MOVE STR-PCHR( STR-INBL - STR-ISTR + 1 ) TO
		STR-PCHR( STR-IMAX - STR-ISTR + 1 ).
FIN-MOV-CHAR.
	EXIT.

PUT-ASTE SECTION.
*----------------
INI-PUT-ASTE.
	MOVE '*' TO STR-PCHR( STR-IAST + STR-ISTR ).
FIN-PUT-ASTE.
	EXIT.
