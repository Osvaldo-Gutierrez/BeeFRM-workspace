       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GNSPCRPF.
       AUTHOR.          CONSIST.
      *
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       INPUT-OUTPUT SECTION.
      *---------------------
       FILE-CONTROL.
           SELECT ARCH-RPF ASSIGN TO DISK.
       DATA DIVISION.
      *=============
       FILE SECTION.
      *-------------
       FD  ARCH-RPF
           LABEL RECORD ARE STANDARD
           DATA RECORD IS RPF.
      *        RELACION PROGRAMA - FORMULARIO  VSAM
      *
      *    Nombre Registro : RPF
      *    Clave(s)        : RPF-COD-DPTS(UU)
      *    Largo           : 92
      *    Bloqueo         : 1
      *    Observaciones   :
      *
      *        RELACION PROGRAMA - FORMULARIO
       01  RPF.
      *
      *    Filler Compatibilidad VSAM/MVS
      *    03 RPF-GLS-FLAG                         PIC X(01).
      *
      *        DESCRIPCION PROGRAMA + TIPO REGISTRO (LLAVE)
           03 RPF-COD-DPTR.
      *
      *        DESCRIPCION PROGRAMA
              05 RPF-COD-DPRO                      PIC X(12).
      *
      *        TIPO REGISTRO Y CORRELATIVO
      *          A   =   AUTOR
      *          B   =   ARCHIVO BASE
      *          C   =   COMANDOS
      *          C0  =   COMANDO 0
      *          C1  =   COMANDO 1
      *          .
      *          .
      *          C9  =   COMANDO 9
      *          P1  =   FORMULARIO 1
      *          .
      *          .
      *          P9  =   FORMULARIO 9
      *          F   =   ARCHIVO ANEXO Y LUGAR EN DONDE SE LLENA
      *           0  =   LLAVE
      *           1  =   VARIABLE 1
      *           .
      *           .
      *           9  =   VARIABLE 9
      *
              05 RPF-COD-TRYC.
      *
      *        TIPO REGISTRO
                 07 RPF-COD-TREG                   PIC X(01).
      *
      *        CORRELATIVO
                 07 RPF-COD-CORR                   PIC 9(01).
      *
      *        DESCRIPCION ARCHIVOS
              05 RPF-COD-DARC                      PIC X(08).
      *
           03 RPF-KEY-DPTR REDEFINES RPF-COD-DPTR.
      *
      *        DESCRIPCION PROGRAMA
              05 RPF-KEY-DPRO                      PIC X(12).
      *
      *        TIPO REGISTRO Y CORRELATIVO
      *          A   =   AUTOR
      *          B   =   ARCHIVO BASE
      *          C   =   COMANDOS
      *          C0  =   COMANDO 0
      *          C1  =   COMANDO 1
      *          .
      *          .
      *          C9  =   COMANDO 9
      *          P1  =   FORMULARIO 1
      *          .
      *          .
      *          P9  =   FORMULARIO 9
      *          F   =   ARCHIVO ANEXO Y LUGAR EN DONDE SE LLENA
      *           0  =   LLAVE
      *           1  =   VARIABLE 1
      *           .
      *           .
      *           9  =   VARIABLE 9
      *
              05 RPF-KEY-TRYC.
      *
      *        TIPO REGISTRO
                 07 RPF-KEY-TREG                   PIC X(01).
      *
      *        CORRELATIVO
                 07 RPF-KEY-CORR                   PIC 9(01).
      *
      *        DESCRIPCION ARCHIVOS
              05 RPF-KEY-DARC                      PIC X(08).
      *
      *        DATO ANEXO
           03 RPF-GLS-DATA                         PIC X(70).
      *
           03 RPF-GLS-DAT1 REDEFINES RPF-GLS-DATA.
      *
      *        DESCRIPCION AUTOR
              05 RPF-GLS-DAUT                      PIC X(42).
      *
      *        CODIGO INDEPEDENCIA FISICA DE DATOS
              05 RPF-COD-CIFD                      PIC X(12).
      *
      *        FILLER
              05 RPF-GLS-DIS1                      PIC X(16).
      *
           03 RPF-GLS-DAT2 REDEFINES RPF-GLS-DATA.
      *
      *        ARCHIVO BASE
              05 RPF-GLS-ABAS                      PIC X(08).
      *
      *        FILLER
              05 RPF-GLS-DIS2                      PIC X(62).
      *
           03 RPF-GLS-DAT3 REDEFINES RPF-GLS-DATA.
      *
      *        FILLER
              05 RPF-COD-DIS3                      PIC X(03).
      *
      *        GLOSA COMANDOS
              05 RPF-GLS-DCMN                      PIC X(25).
      *
      *        GLOSA ABORTO
              05 RPF-GLS-ABRT                      PIC X(25).
      *
      *        SUBRUTINA ALTERNATIVA COMANDOS
              05 RPF-GLS-UARA                      PIC X(12).
      *
      *        FILLER
              05 RPF-GLS-DIS3                      PIC X(05).
      *
           03 RPF-GLS-DAT4 REDEFINES RPF-GLS-DATA.
      *
      *        CODIGO COMANDO
              05 RPF-COD-CCMN                      PIC X(03).
      *
      *        GLOSA PROMPT
              05 RPF-GLS-PRMT                      PIC X(25).
      *
      *        GLOSA CONFIRMACION
              05 RPF-GLS-CONF                      PIC X(25).
      *
      *        SUBRUTINA COMANDO
              05 RPF-GLS-UARC                      PIC X(12).
      *
      *        CODIGO COMANDO PARA PROGRAMA
              05 RPF-COD-CCPP                      PIC X(03).
      *
      *        ESTADO COMANDO PARA PROGRAMA
              05 RPF-IND-STPP                      PIC X(01).
      *
      *        FILLER
              05 RPF-GLS-DIS4                      PIC X(01).
      *
           03 RPF-GLS-DAT5 REDEFINES RPF-GLS-DATA.
      *
      *        DESCRIPCION BIBLIOTECA DE FORMULARIO
              05 RPF-GLS-LFRM                      PIC X(06).
      *
      *        DESCRIPCION DE FORMULARIO
              05 RPF-GLS-NFRM                      PIC X(06).
      *
      *        FILLER
              05 RPF-GLS-DIS5                      PIC X(58).
      *
           03 RPF-GLS-DAT6 REDEFINES RPF-GLS-DATA.
      *
      *        LUGAR DEL CODIGO EN PROGRAMA
              05 RPF-KEY-LCEP                      PIC X(02).
      *
      *        FORMULARIO DEL CODIGO EN PROGRAMA
              05 RPF-KEY-FCEP                      PIC X(06).
      *
      *        VARIABLE DEL CODIGO EN PROGRAMA
              05 RPF-KEY-VCEP                      PIC X(32).
      *
      *        FILLER
              05 RPF-GLS-DIS6                      PIC X(30).
      *
           03 RPF-GLS-DAT7 REDEFINES RPF-GLS-DATA.
      *
      *        DESCRIPCION LLAVE
              05 RPF-GLS-DKEY                      PIC X(10).
      *
      *        FILLER
              05 RPF-GLS-DIS7                      PIC X(60).
      *
           03 RPF-GLS-DAT8 REDEFINES RPF-GLS-DATA.
      *
      *        DESCRIPCION VARIABLE PARA FORMAR LLAVE
              05 RPF-GLS-DVAR                      PIC X(32).
      *
      *        FILLER
              05 RPF-GLS-DIS8                      PIC X(38).
       WORKING-STORAGE SECTION.
      *-----------------------
      *<<<< WSS
      *        RELACION PROGRAMA - FORMULARIO
      *
      *    Nombre Registro : RPF
      *    Clave(s)        : RPF-COD-DPTS(UU)
      *    Largo           : 95
      *    Bloqueo         : 1
      *    Observaciones   :
      *
       01  RPO.
      *
      *       Filler Compatibilidad VSAM/MVS
      *    03 RPF-GLS-FLAG                             PIC X(01).
      *
           03 RPF-COD-DPTS.
      *
      *           SISTEMA
               05 RPF-COD-SIST                         PIC X(03).
      *
      *           DESCRIPCION PROGRAMA + TIPO REGISTRO (LLAVE)
               05 RPF-COD-DPTR.
      *
      *              DESCRIPCION PROGRAMA
                  07 RPF-COD-DPRO                      PIC X(12).
      *
      *        TIPO REGISTRO Y CORRELATIVO
      *          A   =   AUTOR
      *          B   =   ARCHIVO BASE
      *          C   =   COMANDOS
      *          C0  =   COMANDO 0
      *          C1  =   COMANDO 1
      *          .
      *          .
      *          C9  =   COMANDO 9
      *          P1  =   FORMULARIO 1
      *          .
      *          .
      *          P9  =   FORMULARIO 9
      *          F   =   ARCHIVO ANEXO Y LUGAR EN DONDE SE LLENA
      *           0  =   LLAVE
      *           1  =   VARIABLE 1
      *           .
      *           .
      *           9  =   VARIABLE 9
      *
                  07 RPF-COD-TRYC.
      *
      *                TIPO REGISTRO
                    09 RPF-COD-TREG                    PIC X(01).
      *
      *                CORRELATIVO
                    09 RPF-COD-CORR                    PIC 9(01).
      *
      *              DESCRIPCION ARCHIVOS
                  07 RPF-COD-DARC                      PIC X(08).
      *
           03 RPF-KEY-DPTS REDEFINES RPF-COD-DPTS.
      *
      *           SISTEMA
               05 RPF-KEY-SIST                         PIC X(03).
      *
               05 RPF-KEY-DPTR.
      *              DESCRIPCION PROGRAMA
                  07 RPF-KEY-DPRO                      PIC X(12).
      *
      *        TIPO REGISTRO Y CORRELATIVO
      *          A   =   AUTOR
      *          B   =   ARCHIVO BASE
      *          C   =   COMANDOS
      *          C0  =   COMANDO 0
      *          C1  =   COMANDO 1
      *          .
      *          .
      *          C9  =   COMANDO 9
      *          P1  =   FORMULARIO 1
      *          .
      *          .
      *          P9  =   FORMULARIO 9
      *          F   =   ARCHIVO ANEXO Y LUGAR EN DONDE SE LLENA
      *           0  =   LLAVE
      *           1  =   VARIABLE 1
      *           .
      *           .
      *           9  =   VARIABLE 9
      *
                  07 RPF-KEY-TRYC.
      *
      *                TIPO REGISTRO
                    09 RPF-KEY-TREG                    PIC X(01).
      *
      *                CORRELATIVO
                    09 RPF-KEY-CORR                    PIC 9(01).
      *
      *              DESCRIPCION ARCHIVOS
                  07 RPF-KEY-DARC                      PIC X(08).
      *
      *       DATO ANEXO
           03 RPF-GLS-DATA                             PIC X(70).
      *
           03 RPF-GLS-DAT1 REDEFINES RPF-GLS-DATA.
      *
      *           DESCRIPCION AUTOR
               05 RPF-GLS-DAUT                         PIC X(42).
      *
      *           CODIGO INDEPEDENCIA FISICA DE DATOS
               05 RPF-COD-CIFD                         PIC X(12).
      *
      *           FILLER
               05 RPF-GLS-DIS1                         PIC X(16).
      *
           03 RPF-GLS-DAT2 REDEFINES RPF-GLS-DATA.
      *
      *           ARCHIVO BASE
               05 RPF-GLS-ABAS                         PIC X(08).
      *
      *           FILLER
               05 RPF-GLS-DIS2                         PIC X(62).
      *
           03 RPF-GLS-DAT3 REDEFINES RPF-GLS-DATA.
      *
      *           FILLER
               05 RPF-COD-DIS3                         PIC X(03).
      *
      *           GLOSA COMANDOS
               05 RPF-GLS-DCMN                         PIC X(25).
      *
      *           GLOSA ABORTO
               05 RPF-GLS-ABRT                         PIC X(25).
      *
      *           SUBRUTINA ALTERNATIVA COMANDOS
               05 RPF-GLS-UARA                         PIC X(12).
      *
      *           FILLER
               05 RPF-GLS-DIS3                         PIC X(05).
      *
           03 RPF-GLS-DAT4 REDEFINES RPF-GLS-DATA.
      *
      *           CODIGO COMANDO
               05 RPF-COD-CCMN                         PIC X(03).
      *
      *           GLOSA PROMPT
               05 RPF-GLS-PRMT                         PIC X(25).
      *
      *           GLOSA CONFIRMACION
               05 RPF-GLS-CONF                         PIC X(25).
      *
      *           SUBRUTINA COMANDO
               05 RPF-GLS-UARC                         PIC X(12).
      *
      *           CODIGO COMANDO PARA PROGRAMA
               05 RPF-COD-CCPP                         PIC X(03).
      *
      *           ESTADO COMANDO PARA PROGRAMA
               05 RPF-IND-STPP                         PIC X(01).
      *
      *           FILLER
               05 RPF-GLS-DIS4                         PIC X(01).
      *
           03 RPF-GLS-DAT5 REDEFINES RPF-GLS-DATA.
      *
      *           DESCRIPCION BIBLIOTECA DE FORMULARIO
               05 RPF-GLS-LFRM                         PIC X(06).
      *
      *           DESCRIPCION DE FORMULARIO
               05 RPF-GLS-NFRM                         PIC X(06).
      *
      *           FILLER
               05 RPF-GLS-DIS5                         PIC X(58).
      *
           03 RPF-GLS-DAT6 REDEFINES RPF-GLS-DATA.
      *
      *           LUGAR DEL CODIGO EN PROGRAMA
               05 RPF-KEY-LCEP                         PIC X(02).
      *
      *           FORMULARIO DEL CODIGO EN PROGRAMA
               05 RPF-KEY-FCEP                         PIC X(06).
      *
      *           VARIABLE DEL CODIGO EN PROGRAMA
               05 RPF-KEY-VCEP                         PIC X(32).
      *
      *           FILLER
               05 RPF-GLS-DIS6                         PIC X(30).
      *
           03 RPF-GLS-DAT7 REDEFINES RPF-GLS-DATA.
      *
      *           DESCRIPCION LLAVE
               05 RPF-GLS-DKEY                         PIC X(10).
      *
      *           FILLER
               05 RPF-GLS-DIS7                         PIC X(60).
      *
           03 RPF-GLS-DAT8 REDEFINES RPF-GLS-DATA.
      *
      *           DESCRIPCION VARIABLE PARA FORMAR LLAVE
               05 RPF-GLS-DVAR                         PIC X(32).
      *
      *           FILLER
               05 RPF-GLS-DIS8                         PIC X(38).

      * WORKING PARA RUTINAS.
       COPY GNSWSFIO.
       COPY GNSWCFIO.
       COPY GNSWVFIO.

       01  WSS-COD-SIST                                   PIC X(03).
       01  WSS-TOT-REG                                    PIC 9(06).
       01  WSS-TOT-REG-RNG                                PIC 9(02).
       01  WSS-TOT-REG-100                                PIC 9(06).

       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
      *------------
       INI-MAIN.

           DISPLAY 'INGRESE SISTEMA '.
           ACCEPT WSS-COD-SIST.

           IF WSS-COD-SIST = 'ELI'
               MOVE ZEROES       TO WSS-TOT-REG
               MOVE '00'         TO FIO-STAT
               PERFORM DEL-RPO UNTIL NOT FIO-STAT-OKS
               STOP RUN.

           PERFORM OPN-FILE.
           PERFORM PRO-FILE.
           PERFORM CLO-FILE.
           STOP RUN.
       FIN-MAIN.
           EXIT.

       OPN-FILE SECTION.
      *------------------
       INI-OPE-FILE.
      *
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-RPF.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR APERTURA ARCHIVO INPUT  GNSRPF FS '
                       FIO-STAT
               DISPLAY 'ABORTO'
               STOP RUN.

           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GNS-FIO-RPO.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR APERTURA TABLA OUTPUT  GNSRPO FS '
                       FIO-STAT
               DISPLAY 'ABORTO'
               STOP RUN.
      *
       FIN-OPN-FILE.
           EXIT.

       PRO-FILE SECTION.
      *----------------------
       INI-PRO-FILE.
           MOVE ZEROES       TO WSS-TOT-REG
                             WSS-TOT-REG-RNG
                             WSS-TOT-REG-100.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM GNS-FIO-RPF.
           IF NOT FIO-STAT-OKS
              DISPLAY ' ERROR FST-RPF '
              STOP RUN.
           PERFORM RPF-TRS-RPO UNTIL NOT FIO-STAT-OKS.
       FIN-PRO-FILE.
           EXIT.

       RPF-TRS-RPO SECTION.
       INI-RPF-TRS-RPO.
      *GRABA RPO DESDE RPF.
      *
           ADD  1   TO WSS-TOT-REG.
           MOVE WSS-TOT-REG TO WSS-TOT-REG-RNG.
           IF WSS-TOT-REG-RNG = ZEROES
               ADD 100 TO WSS-TOT-REG-100
               DISPLAY 'REGISTRO INGRESADO ' WSS-TOT-REG-100.
           MOVE SPACES              TO RPO.

           MOVE RPF-COD-DPTR IN RPF  TO RPF-COD-DPTR IN RPO.
           MOVE RPF-GLS-DATA IN RPF  TO RPF-GLS-DATA IN RPO.
           MOVE WSS-COD-SIST         TO RPF-COD-SIST IN RPO.


           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GNS-FIO-RPO.
           IF NOT FIO-STAT-OKS
               DISPLAY 'STATUS PUT ' FIO-STAT.
      *
           MOVE FIO-GET-NXT TO FIO-CMND
           PERFORM GNS-FIO-RPF.
      *    DISPLAY 'STATUS NXT ' FIO-STAT.
       FIN-RPF-TRS-RPO.
           EXIT.

       CLO-FILE SECTION.
      *------------------
       INI-CLO-FILE.
           DISPLAY 'NRO. REG. TRASPASADOS :' WSS-TOT-REG.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GNS-FIO-RPF.
      *    PERFORM GNS-FIO-RPO.
      *
      *
       FIN-CLO-FILE.
           EXIT.

      * RUTINAS
       GNS-FIO-RPF SECTION.
       INI-GNS-FIO-RPF.
           MOVE '00' TO FIO-STAT.
      *    Abrir archivo secuencial
           IF FIO-CMND = FIO-INP
              OPEN INPUT ARCH-RPF.
      *    Leer primer registro
           IF FIO-CMND = FIO-GET-FST
              READ ARCH-RPF AT END MOVE '23' TO FIO-STAT.
      *    Leer proximo registro
           IF FIO-CMND = FIO-GET-NXT
              READ ARCH-RPF AT END MOVE '23' TO FIO-STAT.
      *    Cerrar archivo secuencial
           IF FIO-CMND = FIO-CLO
              CLOSE ARCH-RPF.
       FIN-GNS-FIO-RPF.
           EXIT.

       GNS-FIO-RPO SECTION.
       INI-GNS-FIO-RPO.
           MOVE SPACES TO FIO-AKEY.
           CALL 'GNSPFRPF IN OBJECT/GNSPFRPF'
                                 USING FIO-VARI RPO.
           MOVE FIO-STAT-LNK TO FIO-STAT.
       FIN-GNS-FIO-RPO.
           EXIT.

       DEL-RPO SECTION.
      *----------------
       INI-DEL-RPO.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM GNS-FIO-RPO.
           IF NOT FIO-STAT-OKS
                DISPLAY 'NRO. REG. BORRADOS :' WSS-TOT-REG
                STOP RUN.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GNS-FIO-RPO
           IF NOT FIO-STAT-OKS
                DISPLAY 'ERROR GRAVE..... ABORTO'
                DISPLAY 'NRO. REG. BORRADOS :' WSS-TOT-REG
                STOP RUN
           ELSE
                MOVE FIO-DEL TO FIO-CMND
                PERFORM GNS-FIO-RPO.
       FIN-DEL-RPO.
           EXIT.
