      $SET LIST
       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GNSPPKYP.
       AUTHOR.          BEE.
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
                DECIMAL-POINT IS COMMA.
      
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT ARCHINP  ASSIGN TO DISK
                 ORGANIZATION IS SEQUENTIAL.
       DATA DIVISION.
      *=============
       FILE SECTION.
       FD  ARCHINP
           LABEL RECORD ARE STANDARD
           VALUE OF FILETYPE IS 7.
       01  WSS-TAB.
           03 WSS-TAB-COD-CTAB.
              05 WSS-TAB-COD-CTAB-1    PIC X(06).
              05 WSS-TAB-COD-CTAB-2    PIC X(06).
           03 WSS-TAB-GLS-DESC         PIC X(40).
           03 WSS-TAB-GLS-DATA         PIC X(60).
       DATA-BASE SECTION.
       DB BDCST.
       01  AUDITAREA.
       01  GNSTAB.
       WORKING-STORAGE SECTION.
      *-----------------------
       77  WSS-TAB-COD-TTAB VALUE SPACES PIC X(03).
       77  WSS-CMT          VALUE SPACES PIC X(01).
       01  WSS-DSP-SEC VALUE "N"   PIC X(01).
       77  WSS-CONT-PUT-2    VALUE ZEROES PIC 9(01).
       77  WSS-CONT-PUT-5    VALUE ZEROES PIC 9(05).
       77  WSS-CONT-PUT-5-EDT             PIC ZZZZ9.
       COPY GNSWCFIO OF GNS.
       COPY GNSWVFIO OF GNS.
       COPY GNSWSFIO OF GNS.
       COPY GNSWGDRC OF GNS.
       COPY GNSBRTAB OF GNS.
       COPY GNSWRTAB OF GNS.
       COPY GNSBRMSG OF GNS.
       COPY GNSWRMSG OF GNS.
      
       PROCEDURE DIVISION.
      *===================
      
       MAIN SECTION.
      *------------
       INI-MAIN.
           MOVE "GNSPPKYP" TO FIO-PROG.
           MOVE "N" TO FIO-BTRN.
           DISPLAY "INICIO PROGRAMA GNSPPKYP  ".
           MOVE FIO-UPD TO FIO-CMND.
           MOVE "GNS" TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
                DISPLAY "ERROR APERTURA ARCHIVO TAB"
                STOP RUN.
           DISPLAY "OPEN OK BASE DE DATOS".
           PERFORM OPEN-FILE.
           DISPLAY "OPEN OK ARCH INPUT".
           MOVE "PHK" TO WSS-TAB-COD-TTAB.
           PERFORM ELI-ALL-KYP.
           DISPLAY "HIZO ELI-ALL-KYP PARA TABLA  " WSS-TAB-COD-TTAB.
           MOVE "PDK" TO WSS-TAB-COD-TTAB.
           PERFORM ELI-ALL-KYP.
           DISPLAY "HIZO ELI-ALL-KYP PARA TABLA  " WSS-TAB-COD-TTAB.
      
       LUP-MAIN.
           READ ARCHINP  RECORD
                 AT END      DISPLAY "FIN DE ARCHIVO "
                             DISPLAY "TERMINO DE PROGRAMA"
                             STOP RUN.
           IF WSS-TAB = "EOF"
               DISPLAY "FIN DE ARCHIVO SIN PROCESAR NADA"
               DISPLAY "TERMINO DE PROGRAMA"
               STOP RUN.
      
           MOVE WSS-TAB-COD-CTAB TO WSS-CMT.
           IF WSS-CMT = "*"
               GO TO LUP-MAIN.
      
           IF WSS-TAB NOT > SPACES
               GO TO LUP-MAIN.
      
           IF WSS-TAB-COD-CTAB-1 NOT = "INITAB"
               DISPLAY "DEBE INFORMAR TABLA A ACTUALIZAR"
               DISPLAY "TERMINO DE PROGRAMA"
               STOP RUN.
      
           MOVE WSS-TAB-COD-CTAB-2 TO WSS-TAB-COD-TTAB.
      
           PERFORM PUT-ALL-KYP.
      
      *    MOVE "GNS" TO FIO-SIST.
      *    MOVE FIO-CLO TO FIO-CMND.
      *    PERFORM GNS-FIO-TAB.
           PERFORM CLOSE-FILE.
           STOP RUN.
       FIN-MAIN.
           EXIT.
      
       OPEN-FILE SECTION.
      *-----------------
       INI-OPEN-FILE.
           OPEN I-O ARCHINP.
       FIN-OPEN-FILE.
           EXIT.
      
      
       ELI-ALL-KYP SECTION.
       INI-ELI-ALL-KYP.
           MOVE FIO-BEG-TRN TO FIO-CMND.
           MOVE "GNS" TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           DISPLAY "FIO-BGN-TRN OK PARA ELI".
       LUP-ELI-ALL-KYP.
           MOVE SPACES TO TAB.
           MOVE "GNS" TO FIO-SIST.
           MOVE WSS-TAB-COD-TTAB TO TAB-COD-TTAB IN TAB.
           MOVE "A     " TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND
                    TAB-COD-TTAB IN TAB = WSS-TAB-COD-TTAB )
                 GO TO FIN-ELI-ALL-KYP.
      *    DISPLAY "REGISTRO A PROCESAR " TAB-COD-TABL IN TAB.
           MOVE "GNS" TO FIO-SIST.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
                DISPLAY "ERROR EN FIO-UPD TAB"
                DISPLAY "TAB-COD-TABL " TAB-COD-TABL IN TAB
                DISPLAY "FIN DE PROGRAMA"
                STOP RUN
           ELSE
                MOVE "GNS" TO FIO-SIST
                DISPLAY "TAB-COD-TABL : " TAB-COD-TABL IN TAB
                MOVE FIO-DEL TO FIO-CMND
                PERFORM GNS-FIO-TAB
                IF NOT FIO-STAT-OKS
                    DISPLAY "ERROR EN FIO-DEL TAB"
                    DISPLAY "TAB-COD-TABL " TAB-COD-TABL IN TAB
                    DISPLAY "FIN DE PROGRAMA"
                    STOP RUN.
      
           GO TO LUP-ELI-ALL-KYP.
      
      
       FIN-ELI-ALL-KYP.
           MOVE FIO-CHK-PNT TO FIO-CMND.
           MOVE "GNS" TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
       END-ELI-ALL-KYP.
           EXIT.
      
       PUT-ALL-KYP SECTION.
       INI-PUT-ALL-KYP.
           DISPLAY "EN INI-PUT-ALL-KYP".
           READ ARCHINP  RECORD
                 AT END      DISPLAY "ERROR EN NEXT  ARCHINP"
                             GO TO FIN-PUT-ALL-KYP.
           MOVE FIO-BEG-TRN TO FIO-CMND.
           MOVE "GNS" TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
       LUP-PUT-ALL-KYP.
      *    DISPLAY "WSS-TAB " WSS-TAB.
           IF WSS-TAB = "EOF"
               GO TO FIN-PUT-ALL-KYP.
           MOVE WSS-TAB-COD-CTAB TO WSS-CMT.
           IF WSS-CMT = "*"
                GO TO NXT-PUT-ALL-KYP.
           IF WSS-TAB NOT > SPACES
               GO TO NXT-PUT-ALL-KYP.
           IF WSS-TAB-COD-CTAB-1 = "INITAB"
               MOVE WSS-TAB-COD-CTAB-2 TO WSS-TAB-COD-TTAB
               GO TO NXT-PUT-ALL-KYP.
      
           MOVE SPACES TO TAB.
           MOVE "GNS" TO FIO-SIST.
           MOVE WSS-TAB-COD-TTAB TO TAB-COD-TTAB IN TAB.
           MOVE WSS-TAB-COD-CTAB TO TAB-COD-CTAB IN TAB.
           MOVE WSS-TAB-COD-CTAB TO TAB-CIC-CTAB IN TAB.
           MOVE WSS-TAB-GLS-DESC TO TAB-GLS-DESC IN TAB.
           MOVE WSS-TAB-GLS-DATA TO TAB-GLS-DATA IN TAB.
           MOVE "S"              TO TAB-IND-VIGE IN TAB.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
                DISPLAY "ERROR EN FIO-PUT TAB"
                GO TO FIN-PUT-ALL-KYP.
           ADD 1 TO WSS-CONT-PUT-2.
           ADD 1 TO WSS-CONT-PUT-5.
           IF WSS-CONT-PUT-2 = ZEROES
               MOVE WSS-CONT-PUT-5 TO WSS-CONT-PUT-5-EDT
               DISPLAY "TABLA " WSS-TAB-COD-TTAB " TOTAL PUT : "
                        WSS-CONT-PUT-5-EDT.
      *    DISPLAY "PUT-ATBL : " TAB-COD-TABL IN TAB.
      *    DISPLAY "DESC :" WSS-TAB-GLS-DESC.
      *    DISPLAY "DATA :" WSS-TAB-GLS-DATA.
      *    DISPLAY "-------------------------------------------".
       NXT-PUT-ALL-KYP.
           READ ARCHINP RECORD
                 AT END GO TO FIN-PUT-ALL-KYP.
      
           GO TO LUP-PUT-ALL-KYP.
      
       FIN-PUT-ALL-KYP.
           MOVE FIO-CHK-PNT TO FIO-CMND.
           MOVE "GNS" TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
       END-PUT-ALL-KYP.
           EXIT.
      
       CLOSE-FILE SECTION.
       INI-CLOSE-FILE.
            CLOSE ARCHINP WITH LOCK.
       FIN-CLOSE-FILE.
           EXIT.
      
       COPY GNSBGDMD OF GNS.
       COPY GNSBFTAB OF GNS.
       COPY GNSBBTAB OF GNS.
       COPY GNSBFMSG OF GNS.
       COPY GNSBBMSG OF GNS.
