      $SET LIST
       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GNSPXICM.
       AUTHOR.          BEE.
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
                DECIMAL-POINT IS COMMA.
      
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT GNSICM  ASSIGN TO DISK
                 ORGANIZATION IS SEQUENTIAL.
       DATA DIVISION.
      *=============
       FILE SECTION.
       FD  GNSICM
           LABEL RECORD ARE STANDARD
           VALUE OF FILETYPE IS 7.
       01  WSS-TAB.
           03 WSS-TAB-COD-CTAB.
              05 WSS-TAB-COD-CTAB-1    PIC X(03).
              05 WSS-TAB-COD-CTAB-2    PIC X(03).
              05 WSS-TAB-COD-CTAB-3    PIC 9(03).
           03 WSS-TAB-GLS-DESC         PIC X(100).
       DATA-BASE SECTION.
       DB BDCST.
       01  AUDITAREA.
       01  GNSTAB.
       WORKING-STORAGE SECTION.
      *-----------------------
      *
       01  WSS-TAB-100.
           03 WSS-TAB-40                      PIC X(40).
           03 WSS-TAB-60                      PIC X(60).
       01  WSS-COD-MSG.
           03 WSS-COD-MSG1    VALUE "&&"      PIC X(02).
           03 WSS-COD-MSG2    VALUE SPACES    PIC X(03).
           03 WSS-COD-MSG3    VALUE SPACES    PIC X(03).
           03 WSS-COD-MSG4    VALUE ZEROES    PIC 9(04).
      
       77  WSS-CMND     VALUE SPACES     PIC X(03).
       77  WSS-EOF                       PIC X(03).
      
       77  WSS-NUM-5                     PIC 9(05).
       77  WSS-CMT          VALUE SPACES PIC X(01).
       01  WSS-DSP-SEC VALUE "N"   PIC X(01).
       77  WSS-CONT-PUT-2    VALUE ZEROES PIC 9(01).
       77  WSS-CONT-PUT-5    VALUE ZEROES PIC 9(05).
       77  WSS-CONT-PUT-5-EDT             PIC ZZZZ9.
       COPY GNSWCFIO OF GNS.
       COPY GNSWVFIO OF GNS.
       COPY GNSWSFIO OF GNS.
       COPY GNSWGDRC OF GNS.
       COPY GNSBRTAB OF GNS.
       COPY GNSWRTAB OF GNS.
       COPY GNSBRMSG OF GNS.
       COPY GNSWRMSG OF GNS.
      
       PROCEDURE DIVISION.
      *===================
      
       MAIN SECTION.
      *------------
       INI-MAIN.
           MOVE "GNSPXICM" TO FIO-PROG.
           MOVE "N" TO FIO-BTRN.
           DISPLAY "INICIO PROGRAMA GNSPXICM  ".
           MOVE FIO-UPD TO FIO-CMND.
           MOVE "GNS" TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
                DISPLAY "ERROR APERTURA ARCHIVO TAB"
                STOP RUN.
           DISPLAY "OPEN OK BASE DE DATOS".
           PERFORM OPEN-FILE.
           DISPLAY "OPEN OK ARCH INPUT".
      
       LUP-MAIN.
           READ GNSICM  RECORD
                 AT END      DISPLAY "FIN DE ARCHIVO GNSICM"
                             DISPLAY "TERMINO DE PROGRAMA"
                             STOP RUN.
           IF WSS-TAB = "EOF"
               DISPLAY "FIN DE ARCHIVO SIN PROCESAR NADA"
               DISPLAY "TERMINO DE PROGRAMA"
               STOP RUN.
      
           MOVE WSS-TAB-COD-CTAB TO WSS-CMT.
           IF WSS-CMT = " "
               GO TO LUP-MAIN.
      
           PERFORM PUT-ALL-ICM.
      
           MOVE "GNS" TO FIO-SIST.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           PERFORM CLOSE-FILE.
           STOP RUN.
       FIN-MAIN.
           EXIT.
      
       OPEN-FILE SECTION.
      *-----------------
       INI-OPEN-FILE.
           OPEN I-O GNSICM.
       FIN-OPEN-FILE.
           EXIT.
      
       PUT-ALL-ICM SECTION.
       INI-PUT-ALL-ICM.
           DISPLAY "EN INI-PUT-ALL-ICM".
           MOVE FIO-BEG-TRN TO FIO-CMND.
           MOVE "GNS" TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
       LUP-PUT-ALL-ICM.
           MOVE WSS-TAB-COD-CTAB TO WSS-CMT.
           IF WSS-CMT = " "
                GO TO NXT-PUT-ALL-ICM.
           MOVE "GNS" TO FIO-SIST.
           MOVE "MSG" TO TAB-COD-TTAB IN TAB.
           MOVE WSS-TAB-COD-CTAB-1 TO WSS-COD-MSG2.
           MOVE WSS-TAB-COD-CTAB-2 TO WSS-COD-MSG3.
           MOVE WSS-TAB-COD-CTAB-3 TO WSS-COD-MSG4.
           MOVE WSS-COD-MSG TO TAB-COD-CTAB IN TAB.
           DISPLAY "ACTUALIZANDO REGISTRO " TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE FIO-MOD TO FIO-CMND
               MOVE "MOD" TO WSS-CMND
               MOVE WSS-TAB-GLS-DESC TO WSS-TAB-100
               MOVE WSS-TAB-40 TO TAB-GLS-DESC IN TAB
               MOVE WSS-TAB-60 TO TAB-GLS-DATA IN TAB
           ELSE
               MOVE "ING" TO WSS-CMND
               MOVE FIO-PUT TO FIO-CMND
               MOVE SPACES TO TAB
               MOVE WSS-COD-MSG TO TAB-COD-CTAB IN TAB
               MOVE "MSG" TO TAB-COD-TTAB IN TAB
               MOVE TAB-COD-CTAB TO TAB-CIC-CTAB IN TAB
               MOVE WSS-TAB-GLS-DESC TO WSS-TAB-100
               MOVE WSS-TAB-40 TO TAB-GLS-DESC IN TAB
               MOVE WSS-TAB-60 TO TAB-GLS-DATA IN TAB
               MOVE "S"              TO TAB-IND-VIGE IN TAB.
      
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
                DISPLAY "ERROR AL ACTUALIZAR TAB COMANDO : " WSS-CMND
                GO TO FIN-PUT-ALL-ICM.
           ADD 1 TO WSS-CONT-PUT-2.
           ADD 1 TO WSS-CONT-PUT-5.
           IF WSS-CONT-PUT-2 = ZEROES
               MOVE WSS-CONT-PUT-5 TO  WSS-CONT-PUT-5-EDT
               DISPLAY "TOTAL PUT : "  WSS-CONT-PUT-5-EDT.
       NXT-PUT-ALL-ICM.
           READ GNSICM RECORD
                 AT END GO TO FIN-PUT-ALL-ICM.
      
           GO TO LUP-PUT-ALL-ICM.
      
       FIN-PUT-ALL-ICM.
           MOVE FIO-CHK-PNT TO FIO-CMND.
           MOVE "GNS" TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
       END-PUT-ALL-ICM.
           EXIT.
       CLOSE-FILE SECTION.
       INI-CLOSE-FILE.
           CLOSE GNSICM WITH LOCK.
       FIN-CLOSE-FILE.
           EXIT.
      
       COPY GNSBGDMD OF GNS.
       COPY GNSBFTAB OF GNS.
       COPY GNSBBTAB OF GNS.
       COPY GNSBFMSG OF GNS.
       COPY GNSBBMSG OF GNS.
