      $FEDLEVEL = 5 SHARING = SHAREDBYALL LINEINFO
       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID. GNSPPBPR.
       AUTHOR. BEE.
       DATE-WRITTEN.       12-SEP-1997 15:34:04.
      *
      * BUSCA PARAMETROS RPF
      *
       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.
      
       DATA DIVISION.
      *==============
      *
       DATA-BASE SECTION.
       DB  BDCST.
       01  AUDITAREA.
       01  GNSRPF.
       01  GNSMNU.
       01  GNSTAB.
      *
       WORKING-STORAGE SECTION.
      *------------------------
      *
       01 WSS-GLS-DESC.
          03 WSS-GLS-DES1                       PIC X(40).
          03 WSS-GLS-DES2                       PIC X(60).
       77  WSS-IND-DABT                         PIC X(01).
       77  WSS-IND-BGTN                         PIC X(01).
      
       77  WSS-COD-CORR   VALUE ZEROES          PIC 9(02).
      * VARIABLE DE MENU EN MEMORIA
       COPY GNSBRRPF OF GNS.
       COPY GNSBRMNU OF GNS.
       COPY GNSBRTAB OF GNS.
       COPY GNSWRTAB OF GNS.
       COPY GNSBRMSG OF GNS.
       COPY GNSWRMSG OF GNS.
       COPY GNSWVFIO OF GNS.
       COPY GNSWCFIO OF GNS.
       COPY GNSWSFIO OF GNS.
      *COPY GNSWGFEC OF GNS.
       COPY GNSWGHOY OF GNS.
       COPY GNSWGSYS OF GNS.
      *COPY GNSWVSCR OF GNS.
      *Variables para GNSSCRHDR
       01  HEA-VARI.
           03 HEA-SIMP              VALUE SPACES.
              05 HEA-GLS-SIMP       OCCURS 31      PIC X(01).
           03 HEA-DOBL              VALUE SPACES.
              05 HEA-GLS-DOBL       OCCURS 61      PIC X(01).
           03 WSS-SIND.
              05 I                                 PIC 9(02).
              05 J                                 PIC 9(02).
              05 K                  VALUE 0        PIC 9(02).
              05 L                  VALUE 0        PIC 9(02).
              05 IMIN               VALUE 0        PIC 9(02).
              05 IMAX               VALUE 0        PIC 9(02).
       77  SW-PRIMERA-VEZ               PIC S9(11) BINARY VALUE 0.
           88 PRIMERA-VEZ               VALUE 0.
       LINKAGE SECTION.
      *---------------
       COPY GNSWGBPR OF GNS.
      
       PROCEDURE DIVISION USING BPR-VARI.
      *=================================
      
       MAIN SECTION.
       INI-MAIN.
      *COPY GNSBICMS OF GNS.
      *    DISPLAY "INICIANDO GNSPPBPR".
           IF PRIMERA-VEZ
              MOVE 1 TO SW-PRIMERA-VEZ
              PERFORM OPN-FILE.
      
           PERFORM GET-FHOY.
           MOVE HOY-DHOY TO BPR-NUM-DHOY.
           MOVE HOY-MHOY TO BPR-NUM-MHOY.
           MOVE HOY-SHOY TO BPR-NUM-SHOY.
           MOVE HOY-AHOY TO BPR-NUM-AHOY.
      
           PERFORM BUS-CMNU.
      
           PERFORM BUS-CRPF.
      
           PERFORM BUS-CMSG.
      *    DISPLAY "FINALIZANDO GNSPPBPR".
       FIN-MAIN.
           EXIT PROGRAM.
      
       BUS-CMNU SECTION.
       INI-BUS-CMNU.
      *    DISPLAY " INICIANDO BUS-CMNU IN GNSPPBPR".
           MOVE SPACES TO HEA-SIMP.
           MOVE SPACES TO HEA-DOBL.
           MOVE SPACES TO MNU.
           MOVE BPR-SIST TO FIO-SIST.
           MOVE BPR-NEMO TO MNU-COD-NEMO IN MNU.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-MNU.
           IF FIO-STAT-OKS
               MOVE MNU-COD-OPCI TO BPR-HDR-GLS-NFRM
               MOVE MNU-GLS-FPRO TO HEA-SIMP
               PERFORM HDR-TITU
               MOVE HEA-DOBL     TO BPR-HDR-GLS-FPRO.
       FIN-BUS-CMNU.
           EXIT.
      
       OPN-FILE SECTION.
       INI-OPN-FILE.
           MOVE BPR-SIST TO FIO-SIST.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-MNU.
           IF NOT FIO-STAT-OKS
               DISPLAY "ERROR EN APERTURA DE BASE : ABORTO"
               STOP RUN.
      
      
       FIN-OPN-FILE.
           EXIT.
      
       BUS-CRPF SECTION.
       INI-BUS-CRPF.
           MOVE SPACES TO RPF.
           MOVE BPR-SIST TO FIO-SIST.
           MOVE BPR-PROG TO RPF-COD-DPRO IN RPF.
           MOVE "C" TO RPF-COD-TREG IN RPF.
           MOVE "0" TO RPF-COD-CORR IN RPF.
           MOVE FIO-GET-NLS TO FIO-CMND.
       CIC-BUS-CRPF.
           PERFORM GNS-FIO-RPF.
           IF FIO-STAT-OKS AND
              BPR-PROG = RPF-COD-DPRO IN RPF AND
              RPF-COD-TREG IN RPF = "C" AND
              RPF-COD-CORR NOT < "0" AND
              RPF-COD-CORR NOT > "9"
                   ADD 1 RPF-COD-CORR GIVING WSS-COD-CORR
                   MOVE RPF-COD-CCMN TO BPR-CCMN( WSS-COD-CORR )
                   MOVE RPF-COD-CCPP TO BPR-CCPP( WSS-COD-CORR )
                   MOVE RPF-IND-STPP TO BPR-STPP( WSS-COD-CORR )
                   MOVE RPF-GLS-PRMT TO BPR-PRMT( WSS-COD-CORR )
                   MOVE RPF-GLS-CONF TO BPR-CONF( WSS-COD-CORR )
                   MOVE FIO-GET-NXT TO FIO-CMND
                   GO TO CIC-BUS-CRPF.
       FIN-BUS-CRPF.
           EXIT.
      
      ******************************************************************
      
       HDR-TITU SECTION.
       INI-HDR-TITU.
           IF HEA-SIMP = SPACES
                      GO TO FIN-HDR-TITU.
           PERFORM BUS-LIMI VARYING IMIN FROM 1 BY 1
                      UNTIL HEA-GLS-SIMP(IMIN) NOT = SPACES.
           PERFORM BUS-LIMI VARYING IMAX FROM 31 BY -1
                      UNTIL HEA-GLS-SIMP(IMAX) NOT = SPACES.
           IF MNU-IND-EXGL IN MNU = "N"
               COMPUTE L = ( 61 - ( IMAX - IMIN + 1 ) ) / 2
               MOVE 1 TO I
           ELSE
               COMPUTE
                  L = ( 61 - ( 2 * ( IMAX - IMIN + 1 ) - 1 ) ) / 2 + 1
               MOVE 2 TO I.
           PERFORM PUT-TITU
                   VARYING K FROM IMIN BY 1 UNTIL K > IMAX.
       FIN-HDR-TITU.
           EXIT.
      
       BUS-LIMI SECTION.
       INI-BUS-LIMI.
       FIN-BUS-LIMI.
           EXIT.
      
       PUT-TITU SECTION.
       INI-PUT-TITU.
           MOVE HEA-GLS-SIMP( K ) TO HEA-GLS-DOBL( L ).
           ADD I TO L.
       FIN-PUT-TITU.
           EXIT.
      
       BUS-CMSG SECTION.
       INI-BUS-CMSG.
           MOVE "GNS" TO MSG-COD-SIST.
           MOVE "GNS" TO FIO-SIST.
           MOVE "PFSCMN" TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO WSS-GLS-DES1.
           MOVE MSG-GLS-DATA TO WSS-GLS-DES2.
           MOVE WSS-GLS-DESC TO BPR-TRL-GLS-TERM.
      
           MOVE "GNS" TO MSG-COD-SIST.
           MOVE "GNS" TO FIO-SIST.
           MOVE "PRMPGI" TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO BPR-TRL-GLS-PRMT.
      
       FIN-BUS-CMSG.
           EXIT.
       GNS-PRO-SYS SECTION.
       INI-GNS-PRO-SYS.
           PERFORM GET-SYS-HORA.
       FIN-GNS-PRO-SYS.
           EXIT.
      
       GET-SYS-HORA SECTION.
       INI-GET-SYS-HORA.
      * OBTIENE FECHA
           ACCEPT SYS-FHOY-2B FROM DATE.
           MOVE SYS-AHOY-2B TO SYS-AHOY.
           MOVE SYS-MHOY-2B TO SYS-MHOY.
           MOVE SYS-DHOY-2B TO SYS-DHOY.
           IF SYS-AHOY < 90
              MOVE 20 TO SYS-SHOY
           ELSE
              MOVE 19 TO SYS-SHOY.
      * OBTIENE HORA
           ACCEPT SYS-HHOY-2B FROM TIME.
           MOVE SYS-HHHY-2B TO SYS-HHHY.
           MOVE SYS-MMHY-2B TO SYS-MMHY.
           MOVE SYS-SSHY-2B TO SYS-SSHY.
      
           MOVE SYS-SHOY TO SYS-SSTP.
           MOVE SYS-AHOY TO SYS-AATS.
           MOVE SYS-MHOY TO SYS-METS.
           MOVE SYS-DHOY TO SYS-DDTS.
      
           MOVE SYS-HHHY TO SYS-HHTS.
           MOVE SYS-MMHY TO SYS-MMTS.
           MOVE SYS-SSHY TO SYS-SSTS.
       FIN-GET-SYS-HORA.
           EXIT.
      
      *COPY GNSBGFEC OF GNS.
       COPY GNSBGHOY OF GNS.
       COPY GNSBBMSG OF GNS.
       COPY GNSBFMNU OF GNS.
       COPY GNSBFRPF OF GNS.
       COPY GNSBFTAB OF GNS.
       COPY GNSBFMSG OF GNS.
       COPY GNSBGDMD OF GNS.
      *COPY GNSBGSYS OF GNS.
      
      
