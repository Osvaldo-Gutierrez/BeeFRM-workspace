      $SET LIST
       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GNSPSPHK.
       AUTHOR.          BEE.
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
                DECIMAL-POINT IS COMMA.
      
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT GNSPHK  ASSIGN TO DISK
                 ORGANIZATION IS SEQUENTIAL.
       DATA DIVISION.
      *=============
       FILE SECTION.
       FD  GNSPHK
           LABEL RECORD ARE STANDARD
           VALUE OF FILETYPE IS 7.
       01  WSS-TAB.
           03 WSS-TAB-COD-CTAB.
              05 WSS-TAB-COD-CTAB-1    PIC X(06).
              05 WSS-TAB-COD-CTAB-2    PIC X(06).
              05 WSS-TAB-COD-CTAB-3    PIC X(06).
           03 WSS-TAB-DATA.
      
              05 WSS-TAB-GLS-DESC         PIC X(40).
              05 WSS-TAB-GLS-DATA         PIC X(60).
       DATA-BASE SECTION.
       DB BDCST.
       01  AUDITAREA.
       01  GNSTAB.
       WORKING-STORAGE SECTION.
      *-----------------------
       77  WSS-EOF                       PIC X(03).
       01  WSS-REG1.
           03 WSS-KEY-TAB-COD-CTAB.
              05  WSS-REG1-KEY              PIC X(12).
              05  WSS-REG1-COR              PIC 9(02).
              05  WSS-REG1-COR-RED REDEFINES
                  WSS-REG1-COR             PIC X(02).
              05  WSS-REG1-H03              PIC 9(04).
              05  WSS-REG1-H03-RED REDEFINES
                  WSS-REG1-H03              PIC X(04).
           03 WSS-FLD-TAB-GLS-DESC.
              05  WSS-REG1-TBL-ATR.
                  07 WSS-REG1-TBL-ATR-OCC OCCURS 20 TIMES.
                     09 WSS-REG1-ATR1       PIC X(01).
                     09 WSS-REG1-ATR2       PIC X(03).
      
       01  WSS-TBL-ATR.
           03 WSS-TBL-ATR-OCC OCCURS 20 TIMES.
              05 WSS-TBL-ATR-ELM    PIC X(01).
       01  WSS-TBL-ATR-RED REDEFINES WSS-TBL-ATR.
           03 WSS-TBL-ATR-RED1      PIC X(12).
           03 WSS-TBL-ATR-RED2      PIC X(12).
      
       77  WSS-NUM-2                     PIC 9(02).
       77  WSS-NUM-4                     PIC 9(04).
       77  WSS-NUM-5                     PIC 9(05).
      
       77  WSS-IDX-ATR                   PIC 9(05).
       01 WSS-TAB-ATR.
           03 WSS-TAB-ATRI.
              05 WSS-TAB-GLS-DCOR      PIC X(12).
              05 WSS-TAB-COD-ATRN      PIC X(12).
           03 WSS-TAB-GLS-ABRV         PIC X(05).
           03 WSS-TAB-EXT-CTAB         PIC X(05).
       77  WSS-TAB-COD-TTAB VALUE SPACES PIC X(03).
       77  WSS-CONT-PUT-2    VALUE ZEROES PIC 9(01).
       77  WSS-CONT-PUT-5    VALUE ZEROES PIC 9(05).
       77  WSS-CONT-PUT-5-EDT             PIC ZZZZ9.
       COPY GNSWCFIO OF GNS.
       COPY GNSWVFIO OF GNS.
       COPY GNSWSFIO OF GNS.
       COPY GNSWGDRC OF GNS.
       COPY GNSBRTAB OF GNS.
       COPY GNSWRTAB OF GNS.
       COPY GNSBRMSG OF GNS.
       COPY GNSWRMSG OF GNS.
      
       PROCEDURE DIVISION.
      *===================
      
       MAIN SECTION.
      *------------
       INI-MAIN.
           MOVE "N" TO FIO-BTRN.
           DISPLAY "INICIO PROGRAMA GNSPSPHK  ".
           MOVE FIO-INP TO FIO-CMND.
           MOVE "GNS" TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
                DISPLAY "ERROR APERTURA ARCHIVO TAB"
                STOP RUN.
           DISPLAY "OPEN OK BASE DE DATOS".
           PERFORM OPEN-FILE.
           DISPLAY "OPEN OK ARCH GNSPHK".
      
       LUP-MAIN.
      
           PERFORM PUT-SEQ-PHK.
      
           MOVE "GNS" TO FIO-SIST.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           PERFORM CLOSE-FILE.
           STOP RUN.
       FIN-MAIN.
           EXIT.
      
       OPEN-FILE SECTION.
      *-----------------
       INI-OPEN-FILE.
           OPEN OUTPUT GNSPHK.
       FIN-OPEN-FILE.
           EXIT.
      
       PUT-SEQ-PHK SECTION.
       INI-PUT-SEQ-PHK.
           DISPLAY "EN INI-PUT-SEQ-PHK".
           MOVE "GNS" TO FIO-SIST.
           MOVE "PHK" TO TAB-COD-TTAB IN TAB.
           MOVE SPACES TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND
              TAB-COD-TTAB IN TAB = "PHK" AND
              TAB-COD-CTAB IN TAB = SPACES
                   MOVE FIO-GET-NXT TO FIO-CMND
                   PERFORM GNS-FIO-TAB.
      
       LUP-PUT-SEQ-PHK.
           IF NOT ( FIO-STAT-OKS AND
                    TAB-COD-TTAB IN TAB = "PHK" )
                DISPLAY "FIN TABLA PHK"
                DISPLAY "TOTAL REGISTROS PROCESADOS :"
                MOVE WSS-CONT-PUT-5 TO WSS-CONT-PUT-5-EDT
                DISPLAY "TOTAL REGISTROS PROCESADOS :"
                         WSS-CONT-PUT-5-EDT
                GO TO FIN-PUT-SEQ-PHK.
           MOVE SPACES TO WSS-REG1.
           MOVE TAB-COD-CTAB IN TAB TO WSS-REG1-KEY.
           IF TAB-GLS-ABRV IN TAB NOT NUMERIC
               DISPLAY "INDICADOR DE CORRELATIVO "
               DISPLAY "PARA POSICIONAMIENTO DE CURSOR ERRONEO"
               DISPLAY "REGISTRO : " WSS-REG1-KEY
               DISPLAY "ABORTO"
               STOP RUN.
           MOVE TAB-GLS-ABRV IN TAB TO WSS-NUM-5.
           MOVE WSS-NUM-5 TO WSS-NUM-2.
           MOVE WSS-NUM-2 TO WSS-REG1-COR.
      
           IF TAB-EXT-CTAB IN TAB NOT NUMERIC
               DISPLAY "INDICADOR DE H03 "
               DISPLAY "PARA POSICIONAMIENTO DE CURSOR ERRONEO"
               DISPLAY "REGISTRO : " WSS-REG1-KEY
               DISPLAY "ABORTO"
               STOP RUN.
      
      
           MOVE TAB-EXT-CTAB IN TAB TO WSS-NUM-5.
           MOVE WSS-NUM-5 TO WSS-NUM-4.
           MOVE WSS-NUM-4 TO WSS-REG1-H03.
      
      
           MOVE WSS-KEY-TAB-COD-CTAB TO WSS-TAB-COD-CTAB.
      
      
           MOVE TAB-GLS-DCOR IN TAB TO WSS-TBL-ATR-RED1.
           MOVE TAB-COD-ATRN IN TAB TO WSS-TBL-ATR-RED2.
           MOVE SPACES              TO WSS-TAB-GLS-DESC.
           MOVE SPACES              TO WSS-TAB-GLS-DATA.
           PERFORM PUT-ATR VARYING WSS-IDX-ATR FROM 1 BY 1 UNTIL
                   WSS-IDX-ATR > 20.
           MOVE WSS-FLD-TAB-GLS-DESC TO WSS-TAB-DATA.
      
           WRITE WSS-TAB
              INVALID KEY DISPLAY "ERROR WRITE PHK-SEQ-1".
           MOVE SPACES TO WSS-TAB-COD-CTAB-3.
           MOVE TAB-GLS-DESC IN TAB TO WSS-TAB-GLS-DESC.
           MOVE TAB-GLS-DATA IN TAB TO WSS-TAB-GLS-DATA.
           WRITE WSS-TAB
              INVALID KEY DISPLAY "ERROR WRITE PHK-SEQ-2".
           ADD 1 TO WSS-CONT-PUT-2.
           ADD 1 TO WSS-CONT-PUT-5.
           IF WSS-CONT-PUT-2 = ZEROES
               MOVE WSS-CONT-PUT-5 TO WSS-CONT-PUT-5-EDT
               DISPLAY "TABLA " WSS-TAB-COD-TTAB " TOTAL PUT : "
                        WSS-CONT-PUT-5-EDT.
      *    DISPLAY "PUT-ATBL : " TAB-COD-TABL IN TAB.
      *    DISPLAY "DESC :" WSS-TAB-GLS-DESC.
      *    DISPLAY "DATA :" WSS-TAB-GLS-DATA.
      *    DISPLAY "-------------------------------------------".
       NXT-PUT-SEQ-PHK.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
      
           GO TO LUP-PUT-SEQ-PHK.
      
       FIN-PUT-SEQ-PHK.
       END-PUT-SEQ-PHK.
           EXIT.
      
       PUT-ATR SECTION.
       INI-PUT-ATR.
           IF WSS-TBL-ATR-ELM(WSS-IDX-ATR) NOT = "I"
               MOVE SPACES TO WSS-TBL-ATR-ELM(WSS-IDX-ATR).
           MOVE  WSS-TBL-ATR-ELM(WSS-IDX-ATR) TO
                 WSS-REG1-ATR1(WSS-IDX-ATR).
           MOVE SPACES TO WSS-REG1-ATR2(WSS-IDX-ATR).
       FIN-PUT-ATR.
           EXIT.
       CLOSE-FILE SECTION.
       INI-CLOSE-FILE.
           CLOSE GNSPHK WITH LOCK.
       FIN-CLOSE-FILE.
           EXIT.
      
       COPY GNSBGDMD OF GNS.
       COPY GNSBFTAB OF GNS.
       COPY GNSBBTAB OF GNS.
       COPY GNSBFMSG OF GNS.
       COPY GNSBBMSG OF GNS.
