      $SET LIST
       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GNSPPAMM.
       AUTHOR.          CONSIST.
      ********************************************************
      * ACTUALIZA MAPAS MASIVAMENTE, EVITA REGENERACION PZ'S *
      * GUARDA LA POSICION DENTRO DEL MAPA DONDE PONER       *
      * CARACTERES QUE POSICIONAN EL CURSOR                  *
      ********************************************************
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
                DECIMAL-POINT IS COMMA.
      
       DATA DIVISION.
      *=============
       FILE SECTION.
       DATA-BASE SECTION.
       DB BDCST.
       01  AUDITAREA.
       01  GNSTSF.
       01  GNSTAB.
       WORKING-STORAGE SECTION.
      *-----------------------
       01  WSS-DSP-SEC VALUE "N"   PIC X(01).
       COPY GNSWGQUE OF GNS.
      
       COPY GNSWCFIO OF GNS.
       COPY GNSWVFIO OF GNS.
       COPY GNSWSFIO OF GNS.
       COPY GNSWGDRC OF GNS.
       COPY GNSBRTAB OF GNS.
       COPY GNSWRTAB OF GNS.
      *INCORPORACION DE CODIGO DE GNSPPH03
       77  WSS-TOT-REG   VALUE ZEROES PIC 9(05).
       01  WSS-TBL.
           03 WSS-TBL-OCC OCCURS 3000 TIMES.
              05 WSS-TBL-ELM       PIC X(01).
      
       01  CMP-COD-IMAP.
           03 CMP-COD-MAPA         PIC X(04) VALUE "MAPA".
           03 CMP-COD-NFRM         PIC X(07).
           03 FILLER               PIC X(19) VALUE SPACES.
      
       77  WSS-IDX-1                       PIC 9(05).
       77  WSS-IDX-1-EDT                   PIC ZZZZ9.
      
      
       PROCEDURE DIVISION.
      *===================
      
       MAIN SECTION.
      *------------
       INI-MAIN.
          MOVE "N" TO FIO-BTRN.
          DISPLAY "INICIO DE PROGRAMA".
          MOVE "GNS" TO FIO-SIST.
          MOVE FIO-UPD TO FIO-CMND.
          PERFORM GNS-FIO-TAB.
          DISPLAY "BASE DE DATOS ABIERTA..".
          MOVE SPACES       TO WSS-COD-NFRM.
          MOVE WSS-COD-IMAP TO QUE-TERM.
          MOVE SPACES       TO QUE-TYPE.
          MOVE 1            TO QUE-NITM.
      
          MOVE QUE-TERM TO TSF-QUE-TERM IN TSF.
          MOVE QUE-TYPE TO TSF-QUE-TYPE IN TSF.
          MOVE QUE-NITM TO TSF-QUE-NITM IN TSF.
      
          MOVE FIO-GET-NLS TO FIO-CMND.
          PERFORM GNS-FIO-TSF.
      
       CIC-MOD-MAPA.
          IF FIO-STAT-OKS
             MOVE TSF-QUE-TERM TO CMP-COD-IMAP
             IF CMP-COD-MAPA = WSS-COD-IMAP
                MOVE FIO-BEG-TRN TO FIO-CMND
                PERFORM GNS-FIO-TSF
                MOVE FIO-GET-KEY-UPD TO FIO-CMND
      * LA SIGUIENTE LINEA SE DEBE ELIMINAR
      *         MOVE FIO-GET-KEY     TO FIO-CMND
                PERFORM GNS-FIO-TSF
                MOVE TSF-QUE-ITEM TO QUE-ITEM
                MOVE QUE-DATA     TO WSS-TBL
                PERFORM BUSCA-H03 VARYING WSS-IDX-1 FROM 1 BY 1
                UNTIL WSS-TBL-ELM(WSS-IDX-1) = @03@ OR
                      WSS-IDX-1 > 3000
                SUBTRACT 4 FROM WSS-IDX-1
                MOVE WSS-IDX-1 TO QUE-LDAT
                MOVE QUE-ITEM TO TSF-QUE-ITEM
                DISPLAY "EL MAPA LEIDO ES : " TSF-QUE-COLA
                DISPLAY "EL WSS-IDX-1 ES  : " WSS-IDX-1
                MOVE FIO-MOD TO FIO-CMND
                PERFORM GNS-FIO-TSF
                MOVE FIO-CHK-PNT TO FIO-CMND
                PERFORM GNS-FIO-TSF
      * LA SIGUIENTE LINEA SE DEBE ELIMINAR
                MOVE FIO-GET-KEY TO FIO-CMND
                PERFORM GNS-FIO-TSF
                IF FIO-STAT-OKS
                   MOVE FIO-GET-NXT TO FIO-CMND
                   PERFORM GNS-FIO-TSF
                   GO TO CIC-MOD-MAPA
                ELSE
                   DISPLAY "ERROR GRAVE"
                   DISPLAY "NO EXISTE AREA LEIDA"
                   STOP RUN.
          DISPLAY "FIN DE ARCHIVO".
          STOP RUN.
       FIN-MAIN.
           EXIT.
      
       BUSCA-H03 SECTION.
       INI-BUSCA-H03.
       FIN-BUSCA-H03.
           EXIT.
      
       COPY GNSBGQUE OF GNS.
       COPY GNSBGDMD OF GNS.
       COPY GNSBFTAB OF GNS.
      
