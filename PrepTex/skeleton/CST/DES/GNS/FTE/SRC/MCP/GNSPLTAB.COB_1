      $SET LIST
       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GNSPLTAB.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    20-Mar-96 04:29 PM.
      
      * Programa Listador de Reporte TAB sin Sort.
      
      
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
               CHANNEL 01 IS SALTO
               DECIMAL-POINT IS COMMA
               DICTIONARY IS "SDFPLUSDICTIONARY".
      *CGL-INI  23-SEP-1997 Eliminación de los copy de XF
      
      *CGL-FIN  23-SEP-1997
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *CAH-INI 18-OCT-1996
       COPY GNSWGAU1 OF GNS.
      *CAH-FIN 18-OCT-1996
           SELECT RPTTAB         ASSIGN TO PRINTER.
      
       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
      *CAH-INI 18-OCT-1996
       COPY GNSWGAU2 OF GNS.
      *CAH-FIN 18-OCT-1996
       FD  RPTTAB LABEL RECORDS OMITTED
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-TAB     PIC X(132).
      
       DATA-BASE SECTION.
       DB BDCST.
      *CGL-INI  23-SEP-1997
       01 AUDITAREA.
       01 GNSTAB.
       01 TABUSR.
       01 GNSMNU.
       01 GNSUSR.
      *CGL-FIN  23-SEP-1997
      
       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSBRTAB OF GNS.
      *GNN-INI 2/4/96
       COPY GNSBRMNU OF GNS.
      *GNN-FIN 2/4/96
       COPY GNSRRTAB OF GNS.
       COPY GNSWCFIO OF GNS.
      *ERB-INI  24-SEP-1997
       COPY GNSWVFIO OF GNS.
      *ERB-FIN  24-SEP-1997
       COPY GNSWSFIO OF GNS.
       COPY GNSWGRPT OF GNS.
       COPY GNSWGGRC OF GNS.
       COPY GNSWRTAB OF GNS.
       COPY GNSBRMSG OF GNS.
       COPY GNSWRMSG OF GNS.
       COPY GNSRWTAB OF GNS.
       COPY GNSRNTAB OF GNS.
       COPY GNSROTAB OF GNS.
       COPY GNSWGSYS OF GNS.
      *GNN-INI 2/4/96
       COPY GNSWGFPI OF GNS.
      *GNN-FIN 2/4/96
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE " " PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE " ".
              88 PGM-STAT-SRT-MAL     VALUE "M".
           03 PGM-SOKS                VALUE " " PIC X(01).
           03 PGM-SMAL                VALUE "M" PIC X(01).
      *<<<<
       COPY TABBRUSR OF TAB.
       01  WSS-COD-TABS                         PIC X(03).
       01  WSS-COD-TABL.
           03 WSS-COD-TTAB                      PIC X(03).
           03 WSS-COD-CTAB                      PIC X(12).
       01  FIO-SIST-AUX                         PIC X(03).
       01  WSS-ACC-TTAB                         PIC X(03).
       01  WSS-IND-VIGE                         PIC X(01).
       01  WSS-DMA-FAUX.
           03 WSS-NUM-DAUX                      PIC X(02).
           03 WSS-NUM-MAUX                      PIC X(02).
           03 WSS-NUM-SAUX                      PIC X(02).
           03 WSS-NUM-AAUX                      PIC X(02).
       01  WSS-DMA-FINI.
           03 WSS-NUM-SINI                      PIC X(02).
           03 WSS-NUM-AINI                      PIC X(02).
           03 WSS-NUM-MINI                      PIC X(02).
           03 WSS-NUM-DINI                      PIC X(02).
       01  WSS-NUM-FFIN.
           03 WSS-NUM-SFIN                      PIC X(02).
           03 WSS-NUM-AFIN                      PIC X(02).
           03 WSS-NUM-MFIN                      PIC X(02).
           03 WSS-NUM-DFIN                      PIC X(02).
      *>>>>
      
      * AQUI EXISTIA LABEL RF INI
      * AQUI EXISTIA LABEL RF FIN
       COPY GNSRTTAB OF GNS.
      *CAH-INI 18-OCT-1996
       01 WSS-REF-SIST  PIC X(03) RECEIVED BY REFERENCE.
       01 WSS-REF-TTAB  PIC X(03) RECEIVED BY REFERENCE.
       01 WSS-REF-FTA1  PIC X(11) RECEIVED BY REFERENCE.
       01 WSS-REF-FTA2  PIC X(11) RECEIVED BY REFERENCE.
       01 WSS-REF-VIGE  PIC X(01) RECEIVED BY REFERENCE.
      *CAH-FIN 18-OCT-1996
      
       LOCAL-STORAGE SECTION.
       LD  LDV-VARI.
      *CGL-INI  23-SEP-1997 Eliminación de los LD correspondientes a los
      *XF eliminados.
      
      *CGL-FIN  23-SEP-1997
      
      *CAH-INI 18-OCT-1996
      *PROCEDURE DIVISION.
       PROCEDURE DIVISION USING WSS-REF-SIST  WSS-REF-TTAB
                                WSS-REF-FTA1  WSS-REF-FTA2
                                WSS-REF-VIGE.
      *CAH-FIN 18-OCT-1996
      *==================
      
      
      * AQUI EXISTIA LABEL FIN_DEC INI
      * AQUI EXISTIA LABEL FIN_DEC FIN
      
       MAIN SECTION.
      *------------
       INI-MAIN.
      *CAH-INI 18-OCT-1996
           MOVE "GNSPLTAB" TO AUD-GLS-NOMP.
       COPY GNSWGAU3 OF GNS.
      *CAH-FIN 18-OCT-1996
           MOVE "GNS" TO RPT-SIST.
           MOVE "GNSPLTAB" TO FIO-PROG.
      
           MOVE FIO-INP      TO FIO-CMND.
           MOVE "GNS"        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
       INI-INP-SRT.
      *<<<<
      *CAH-INI 18-OCT-1996
      *    DISPLAY "INGRESE SISTEMA : ".
      *    ACCEPT FIO-SIST.
           MOVE WSS-REF-SIST TO FIO-SIST.
           DISPLAY "SISTEMA : " FIO-SIST.
      *CAH-FIN 18-OCT-1996
      *CAH-INI 18-OCT-1996
      *    DISPLAY "INGRESE TABLA : ".
      *    ACCEPT WSS-ACC-TTAB.
           MOVE WSS-REF-TTAB TO WSS-ACC-TTAB.
           DISPLAY "TABLA   : " WSS-ACC-TTAB.
      *CAH-FIN 18-OCT-1996
           IF WSS-ACC-TTAB NOT > SPACES
               MOVE "*" TO WSS-ACC-TTAB.
      
      *GNN-INI 02/04/96
      *CAH-INI 18-OCT-1996
      *    DISPLAY "INGRESE FECHA INICIO ( SS/AA/MM/DD ) :".
      *COPY GNSBGFPI OF GNS.
           MOVE WSS-REF-FTA1 TO FPI-FTAR IN FPI-VARI.
       COPY GNSBBFPI OF GNS.
      *CAH-FIN 18-OCT-1996
           MOVE FPI-SPRO IN FPI-VARI TO WSS-NUM-SAUX.
           MOVE FPI-APRO IN FPI-VARI TO WSS-NUM-AAUX.
           MOVE FPI-MPRO IN FPI-VARI TO WSS-NUM-MAUX.
           MOVE FPI-DPRO IN FPI-VARI TO WSS-NUM-DAUX.
      
           DISPLAY "FECHA INICIO ( SS/AA/MM/DD ) :"
                                                 FPI-FTAR IN FPI-VARI.
      *GNN-FIN 02/04/96
           IF WSS-DMA-FAUX = "00002000"
               MOVE ZEROES TO WSS-DMA-FINI
           ELSE
              MOVE WSS-NUM-DAUX TO WSS-NUM-DINI
              MOVE WSS-NUM-MAUX TO WSS-NUM-MINI
              MOVE WSS-NUM-SAUX TO WSS-NUM-SINI
              MOVE WSS-NUM-AAUX TO WSS-NUM-AINI.
      
      *    IF WSS-DMA-FAUX NOT > SPACES OR
      *       WSS-DMA-FAUX = "*"
      *        MOVE LOW-VALUES TO WSS-DMA-FINI
      *    ELSE
      *       MOVE WSS-NUM-DAUX TO WSS-NUM-DINI
      *       MOVE WSS-NUM-MAUX TO WSS-NUM-MINI
      *       MOVE WSS-NUM-SAUX TO WSS-NUM-SINI
      *       MOVE WSS-NUM-AAUX TO WSS-NUM-AINI.
      
      *GNN-INI 02/04/96
      *CAH-INI 18-OCT-1996
      *    DISPLAY "INGRESE FECHA TERMINO ( SS/AA/MM/DD ) :".
      *COPY GNSBGFPI OF GNS.
           MOVE WSS-REF-FTA2 TO FPI-FTAR IN FPI-VARI.
       COPY GNSBBFPI OF GNS.
      *CAH-FIN 18-OCT-1996
           MOVE FPI-SPRO IN FPI-VARI TO WSS-NUM-SAUX.
           MOVE FPI-APRO IN FPI-VARI TO WSS-NUM-AAUX.
           MOVE FPI-MPRO IN FPI-VARI TO WSS-NUM-MAUX.
           MOVE FPI-DPRO IN FPI-VARI TO WSS-NUM-DAUX.
      
           DISPLAY "FECHA TERMINO ( SS/AA/MM/DD ) :"
                                                 FPI-FTAR IN FPI-VARI.
      *GNN-FIN 02/04/96
      
           IF WSS-DMA-FAUX = "00002000"
               MOVE 99999999 TO WSS-NUM-FFIN
           ELSE
              MOVE WSS-NUM-DAUX TO WSS-NUM-DFIN
              MOVE WSS-NUM-MAUX TO WSS-NUM-MFIN
              MOVE WSS-NUM-SAUX TO WSS-NUM-SFIN
              MOVE WSS-NUM-AAUX TO WSS-NUM-AFIN.
      *    IF WSS-DMA-FAUX NOT > SPACES OR
      *       WSS-DMA-FAUX = "*"
      *        MOVE "99999999" TO WSS-NUM-FFIN
      *    ELSE
      *       MOVE WSS-NUM-DAUX TO WSS-NUM-DFIN
      *       MOVE WSS-NUM-MAUX TO WSS-NUM-MFIN
      *       MOVE WSS-NUM-SAUX TO WSS-NUM-SFIN
      *       MOVE WSS-NUM-AAUX TO WSS-NUM-AFIN.
      
      *CAH-INI 18-OCT-1996
      *    DISPLAY "INGRESE VIGENCIA S/N/* : ".
      *    ACCEPT WSS-IND-VIGE.
           MOVE WSS-REF-VIGE TO WSS-IND-VIGE.
           DISPLAY "VIGENCIA  S/N/* : " WSS-IND-VIGE.
      *CAH-FIN 18-OCT-1996
           IF WSS-IND-VIGE NOT > SPACES
               MOVE "*" TO WSS-IND-VIGE.
      
      *>>>>
      *     MOVE "GNSPLTAB" TO RPT-NPGM.
           MOVE FIO-SIST TO FIO-SIST-AUX.
           PERFORM CAL-HDR.
           MOVE FIO-SIST-AUX TO FIO-SIST.
      *GNN-INI 3/4/96
      *    MOVE FIO-INP TO FIO-CMND.
      *    PERFORM GNS-FIO-TAB.
      *GNN-FIN 3/4/96
       FST-INP-SRT.
      *<<<<
           IF WSS-ACC-TTAB = "*"
               MOVE FIO-GET-NLS TO FIO-CMND
           ELSE
               MOVE WSS-ACC-TTAB TO TAB-COD-TTAB IN TAB
               MOVE SPACES       TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM FIO-TAB.
           GO TO INI-OUT-SRT.
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
       INI-OUT-SRT.
       COPY GNSRMTAB OF GNS.
           OPEN OUTPUT RPTTAB.
           PERFORM INITIATE-RPTTAB.
           MOVE SRT TO SRT-OLD-TAB.
           MOVE SRT TO SRT-CUR-TAB.
           PERFORM TAB-FST-PRO-CTL.
       LUP-MAIN.
       LUP-INP-SRT.
      *GNN-INI
      *    PERFORM FIO-TAB.
      *GNN-FIN
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
       MOV-INP-SRT.
       COPY GNSRMTAB OF GNS.
       LUP-OUT-SRT.
      *<<<<
      *GNN-INI 3/4/96
      
           IF FIO-SIST NOT = "*" AND
              FIO-SIST NOT = TAB-COD-TABS IN TAB
               GO TO FIN-MAIN.
      *GNN-FIN 3/4/96
           IF TAB-COD-TTAB IN SRT NOT = TAB-COD-TTAB IN TAB
               MOVE SPACES TO TAB-COD-TTAB IN SRT
                              WSS-GLS-DTAB
                              USR-GLS-DESC.
      *>>>>
           PERFORM TAB-CLR-VAR-CTL.
           PERFORM TAB-CHK-VAR-CTL.
           MOVE SRT TO SRT-CUR-TAB.
           MOVE SRT-OLD-TAB TO SRT.
           PERFORM TAB-PRO-VAR-CTL-CF.
           MOVE SRT-CUR-TAB TO SRT.
           PERFORM TAB-PRO-VAR-CTL-CH.
           PERFORM PRO-DL-TAB.
       NXT-INP-SRT.
       NXT-OUT-SRT.
           MOVE SRT TO SRT-OLD-TAB.
      *<<<<
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM FIO-TAB.
           GO TO LUP-MAIN.
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           GO TO LUP-MAIN.
      *CAH-INI 18-OCT-1996
       COPY GNSWGAU4 OF GNS.
      *CAH-FIN 18-OCT-1996
       FIN-MAIN.
       FIN-INP-SRT.
       FIN-OUT-SRT.
           PERFORM TERMINATE-RPTTAB.
           CLOSE RPTTAB.
           IF PGM-STAT-SRT-MAL
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.
      
       COPY GNSBFBTM OF GNS.
       COPY GNSBBSYS OF GNS.
       COPY GNSBFMSG OF GNS.
       COPY GNSBGEND OF GNS.
       COPY GNSBGIRH OF GNS.
       COPY GNSRETAB OF GNS.
      *    20-MAR-96 04:22 PM     ,PAI=CLB ,CLI=BCQ ,SOP=MCP
       D-CF-TAB-TAB-COD-TTAB SECTION.
       INI-CF-TAB-TAB-COD-TTAB.
      *<<<<
      ***GNN-INI 2/4/96
      ***  MOVE 0 TO PAGE-COUNTER.
      ***GNN-FIN 2/4/96
      *>>>>
       FIN-CF-TAB-TAB-COD-TTAB.
           EXIT.
       D-CF-TAB-WSS-COD-TMSC SECTION.
       INI-CF-TAB-WSS-COD-TMSC.
      *<<<<
      ***GNN-INI 2/4/96
      ***  IF NOT ( TAB-COD-TTAB IN SRT = "MSC"  AND
      ***           TAB-COD-CTAB IN SRT > SPACES AND
      ***           WSS-COD-TMSC IN WSS-TAB > SPACES )
      *        MOVE 1 TO PRINT-SWITCH.
      *** COPY GNSBGSPI OF GNS.
      ***           .
      ***GNN-FIN 2/4/96
      *>>>>
       FIN-CF-TAB-WSS-COD-TMSC.
           EXIT.
       D-CF-TAB-WSS-COD-TMSG SECTION.
       INI-CF-TAB-WSS-COD-TMSG.
      *<<<<
      ***GNN-INI 2/4/96
      ***  IF NOT ( TAB-COD-TTAB IN SRT = "MSG"  AND
      ***           TAB-COD-CTAB IN SRT > SPACES AND
      ***           WSS-COD-TMSG IN WSS-TAB > SPACES )
      *        MOVE 1 TO PRINT-SWITCH.
      *** COPY GNSBGSPI OF GNS.
      ***           .
      ***GNN-FIN 2/4/96
      *>>>>
       FIN-CF-TAB-WSS-COD-TMSG.
           EXIT.
       D-PH-TAB SECTION.
       INI-PH-TAB.
       FIN-PH-TAB.
           EXIT.
       D-DL-TAB SECTION.
       INI-DL-TAB.
       FIN-DL-TAB.
           EXIT.
       COPY GNSBGABT OF GNS.
      
      *<<<<
       FIO-TAB SECTION.
       INI-FIO-TAB.
           PERFORM GNS-FIO-TAB.
           IF FIO-CMND = FIO-INP OR FIO-CMND = FIO-CLO
               GO TO FIN-FIO-TAB.
           IF TAB-COD-TTAB IN TAB NOT = WSS-COD-TTAB
               IF TAB-COD-CTAB IN TAB > SPACES
                   MOVE "TABLA SIN REGISTRO PADRE" TO WSS-GLS-DTAB
               ELSE
                   MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-DTAB.
           MOVE TAB-COD-TABS IN TAB TO WSS-COD-TABS.
           MOVE TAB-COD-TABL IN TAB TO WSS-COD-TABL.
           IF ( WSS-ACC-TTAB < TAB-COD-TTAB IN TAB AND
                WSS-ACC-TTAB NOT = "*" ) OR
              NOT FIO-STAT-OKS
                 STOP RUN.
           IF TAB-COD-CTAB IN TAB NOT > SPACES
               PERFORM BUS-RES
               PERFORM TAB-NXT-TAB
               GO TO FIN-FIO-TAB.
      
           IF NOT ( ( WSS-ACC-TTAB = TAB-COD-TTAB IN TAB     OR
                      WSS-ACC-TTAB = "*"
                    ) AND
                    ( WSS-IND-VIGE = TAB-IND-VIGE IN TAB     OR
                      WSS-IND-VIGE = "*"
                    ) AND
                    ( WSS-DMA-FINI NOT > TAB-FEC-FTRN IN TAB AND
                      WSS-NUM-FFIN NOT < TAB-FEC-FTRN IN TAB
                    )
                  )
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO INI-FIO-TAB.
           IF TAB-COD-TTAB IN TAB = "MSC"
               MOVE TAB-COD-CTAB IN TAB TO WSS-COD-TMSC IN WSS-TAB.
           IF TAB-COD-TTAB IN TAB = "MSG"
               MOVE TAB-COD-CTAB IN TAB TO WSS-COD-TMSG IN WSS-TAB.
       FIN-FIO-TAB.
           EXIT.
      
       BUS-RES SECTION.
       INI-BUS-RES.
           IF TAB-COD-ATRN IN TAB > SPACES
               MOVE TAB-COD-ATRN IN TAB TO USR-COD-USER IN USR
               PERFORM BUS-USR
           ELSE
               MOVE SPACES TO USR-GLS-DESC IN USR.
       FIN-BUS-RES.
           EXIT.
      
       TAB-NXT-TAB SECTION.
       INI-TAB-NXT-TAB.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF TAB-COD-TTAB IN TAB NOT = WSS-COD-TTAB
               MOVE WSS-COD-TABL TO TAB-COD-TABL IN TAB
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-TAB
               MOVE SPACES TO TAB
               MOVE WSS-COD-TABS TO TAB-COD-TABS IN TAB
               MOVE WSS-COD-TABL TO TAB-COD-TABL IN TAB.
       FIN-TAB-NXT-TAB.
           EXIT.
      
       COPY TABBBUSR OF TAB.
       COPY TABBFUSR OF TAB.
      ***GNN-INI 2/4/96
       COPY GNSBFUSR OF GNS.
       COPY GNSBFMNU OF GNS.
      ***GNN-FIN 2/4/96
      
       COPY GNSBBMSG OF GNS.
      *GNN-INI 2/4/96
       COPY GNSBBHDR OF GNS.
      *GNN-FIN 2/4/96
      *CGL-INI  23-SEP-1997
       COPY GNSBGDMD OF GNS.
      *>>>>
