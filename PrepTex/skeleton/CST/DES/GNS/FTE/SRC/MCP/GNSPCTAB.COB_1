       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GNSPCTAB.
       AUTHOR.          CONSIST.
      *
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       INPUT-OUTPUT SECTION.
      *---------------------
       FILE-CONTROL.
           SELECT ARCH-TAB ASSIGN TO DISK.
       DATA DIVISION.
      *=============
       FILE SECTION.
      *-------------
       FD  ARCH-TAB
           LABEL RECORD ARE STANDARD
           DATA RECORD IS TAB.
      *    Registro Generico de Tablas
      *    ---------------------------
      *
      *    Nombre Registro : TAB
      *    Clave(s)        : TAB-COD-TABL(UU), TAB-CIC-TABL(UU),
      *                      TAB-EXT-TABL(DC)
      *    Largo           : 194
      *    Bloqueo         : 2
      *    Observaciones   :
      *
       01  TAB.
      *
      *    Filler Compatibilidad VSAM/MVS
           03  TAB-GLS-FLAG                             PIC X(01).
      *
      *    Clave Primaria Registro
           03  TAB-KEY-IREG.
      *
      *KEY     Tipo + Codigo ( LLave Primaria )
               05  TAB-COD-TABL.
      *
      *            Codigo Tipo Tabla
                   07  TAB-COD-TTAB                     PIC X(03).
      *
      *            Codigo Tabla
                   07  TAB-COD-CTAB                     PIC X(12).
      *
      *        Time Stamp Transaccion
               05  TAB-STP-ITRN.
      *
      *            Fecha Transaccion
                   07  TAB-FEC-FTRN.
                       09  TAB-NUM-STRN                 PIC 9(02).
                       09  TAB-NUM-ATRN                 PIC 9(02).
                       09  TAB-NUM-MTRN                 PIC 9(02).
                       09  TAB-NUM-DTRN                 PIC 9(02).
      *
      *            Hora Transaccion
                   07  TAB-HRA-HRTR.
                       09  TAB-NUM-HHTR                 PIC 9(02).
                       09  TAB-NUM-MMTR                 PIC 9(02).
                       09  TAB-NUM-SSTR                 PIC 9(02).
      *
      *    Indicador Tipo Accion
           03  TAB-MSC-TACC                             PIC X(01).
      *
      *    Indicador Status
           03  TAB-MSC-STAT                             PIC X(01).
      *
      *    Indicador Vigencia                           GNS VIGE
           03  TAB-IND-VIGE  REDEFINES  TAB-MSC-STAT    PIC X(01).
      *
      *    Codigo Origen Transaccion
           03  TAB-COD-OTRN.
      *
      *        Indicador Tipo Origen
               05  TAB-MSC-TTRN                         PIC X(01).
      *
      *        Codigo Tipo Origen
               05  TAB-COD-TTRN                         PIC X(03).
      *
      *    Autor Transaccion
           03  TAB-COD-ATRN                             PIC X(12).
      *
      *KEY Tipo + Codigo ( Interno Computacional )
           03  TAB-CIC-TABL.
      *
      *        Codigo Tipo Tabla
               05  TAB-CIC-TTAB                         PIC X(03).
      *
      *        Codigo Tabla
               05  TAB-CIC-CTAB                         PIC X(12).
      *
      *    Codigo Externo
           03  TAB-EXT-TABL.
      *
      *        Codigo Tipo Tabla
               05  TAB-EXT-TTAB                         PIC X(03).
      *
      *        Codigo Tabla
               05  TAB-EXT-CTAB                         PIC X(05).
      *
      *    Descripcion Corta
           03  TAB-GLS-DCOR                             PIC X(12).
      *
      *    Abreviacion Descripcion
           03  TAB-GLS-ABRV                             PIC X(05).
      *
      *    Descripcion del Codigo
           03  TAB-GLS-DESC                             PIC X(40).
      *
      *    Datos Anexos
           03  TAB-GLS-DATA.
               05  TAB-GLS-DAT1.
                   07  TAB-COD-DAT1     OCCURS 10       PIC X(01).
               05  TAB-GLS-DAT2.
                   07  TAB-COD-DAT2     OCCURS 10       PIC X(02).
               05  TAB-GLS-DAT3.
                   07  TAB-COD-DAT3     OCCURS 10       PIC X(03).
      *
      *    Clave Soundex
           03  TAB-SNX-TABL.
               05  TAB-SNX-TTAB                         PIC X(03).
               05  TAB-SNX-CTAB                         PIC X(03).

       WORKING-STORAGE SECTION.
      *-----------------------
      *    Registro Generico de Tablas
      *    ---------------------------
      *
      *    Nombre Registro : TAB
      *    Clave(s)        : TAB-KY1-TABS(UU),
      *                      TAB-KY2-TABS(UU), TAB-KY3-TABS(DC)
      *    Largo           : 206
      *    Bloqueo         : 2
      *    Observaciones   :
      *
       01  TAO.
      *
      *    Filler Compatibilidad VSAM/MVS
           03  TAB-GLS-FLAG                             PIC X(01).
      *
      *    Clave Primaria Registro
           03  TAB-KEY-IREG.
      *
      *KEY     Tipo + Codigo ( LLave Primaria )
               05  TAB-KY0-TABS.
                   07  TAB-COD-TABS                     PIC X(03).
                   07  TAB-COD-TABL.
      *
      *            Codigo Tipo Tabla
                       09  TAB-COD-TTAB                 PIC X(03).
      *
      *            Codigo Tabla
                       09  TAB-COD-CTAB                 PIC X(12).
      *
      *        Time Stamp Transaccion
               05  TAB-COD-ITRS.
                   07  TAB-STP-ITRS                     PIC X(03).
                   07  TAB-STP-ITRN.
      *
      *            Fecha Transaccion
                       09  TAB-FEC-FTRN.
                           11  TAB-NUM-STRN             PIC 9(02).
                           11  TAB-NUM-ATRN             PIC 9(02).
                           11  TAB-NUM-MTRN             PIC 9(02).
                           11  TAB-NUM-DTRN             PIC 9(02).
      *
      *            Hora Transaccion
                       09  TAB-HRA-HRTR.
                           11  TAB-NUM-HHTR             PIC 9(02).
                           11  TAB-NUM-MMTR             PIC 9(02).
                           11  TAB-NUM-SSTR             PIC 9(02).
      *
      *    Indicador Tipo Accion
           03  TAB-MSC-TACC                             PIC X(01).
      *
      *    Indicador Status
           03  TAB-MSC-STAT                             PIC X(01).
      *
      *    Indicador Vigencia                           GNS VIGE
           03  TAB-IND-VIGE  REDEFINES  TAB-MSC-STAT    PIC X(01).
      *
      *    Codigo Origen Transaccion
           03  TAB-COD-OTRN.
      *
      *        Indicador Tipo Origen
               05  TAB-MSC-TTRN                         PIC X(01).
      *
      *        Codigo Tipo Origen
               05  TAB-COD-TTRN                         PIC X(03).
      *
      *    Autor Transaccion
           03  TAB-COD-ATRN                             PIC X(12).
      *
      *KEY Tipo + Codigo ( Interno Computacional )
           03  TAB-KY1-TABS.
               05  TAB-CIC-TABS                         PIC X(03).
               05  TAB-CIC-TABL.
      *
      *            Codigo Tipo Tabla
                   07  TAB-CIC-TTAB                     PIC X(03).
      *
      *            Codigo Tabla
                   07  TAB-CIC-CTAB                     PIC X(12).
      *
      *    Codigo Externo
           03  TAB-KY2-TABS.
               05  TAB-EXT-TABS                         PIC X(03).
               05  TAB-EXT-TABL.
      *
      *            Codigo Tipo Tabla
                   07  TAB-EXT-TTAB                     PIC X(03).
      *
      *            Codigo Tabla
                   07  TAB-EXT-CTAB                     PIC X(05).
      *
      *    Descripcion Corta
           03  TAB-GLS-DCOR                             PIC X(12).
      *
      *    Abreviacion Descripcion
           03  TAB-GLS-ABRV                             PIC X(05).
      *
      *    Descripcion del Codigo
           03  TAB-GLS-DESC                             PIC X(40).
      *
      *    Datos Anexos
           03  TAB-GLS-DATA.
               05  TAB-GLS-DAT1.
                   07  TAB-COD-DAT1     OCCURS 10       PIC X(01).
               05  TAB-GLS-DAT2.
                   07  TAB-COD-DAT2     OCCURS 10       PIC X(02).
               05  TAB-GLS-DAT3.
                   07  TAB-COD-DAT3     OCCURS 10       PIC X(03).
      *
      *    Clave Soundex
           03  TAB-SNX-TABL.
               05  TAB-SNX-TTAB                         PIC X(03).
               05  TAB-SNX-CTAB                         PIC X(03).
      *
      * WORKING PARA RUTINAS.
       COPY GNSWSFIO.
       COPY GNSWCFIO.
       COPY GNSWVFIO.

       01  WSS-COD-SIST                                   PIC X(03).
       01  WSS-TOT-REG                                    PIC 9(06).
       01  WSS-TOT-REG-RNG                                PIC 9(02).
       01  WSS-TOT-REG-100                                PIC 9(06).

       PROCEDURE DIVISION.
      *==================
       MAIN SECTION.
      *------------
       INI-MAIN.

           DISPLAY 'INGRESE SISTEMA '.
           ACCEPT WSS-COD-SIST.

           IF WSS-COD-SIST = 'ELI'
               MOVE ZEROES       TO WSS-TOT-REG
               MOVE '00'         TO FIO-STAT
               PERFORM DEL-TAO UNTIL NOT FIO-STAT-OKS
               STOP RUN.

           PERFORM OPN-FILE.
           PERFORM PRO-FILE.
           PERFORM CLO-FILE.
           STOP RUN.
       FIN-MAIN.
           EXIT.

       OPN-FILE SECTION.
      *------------------
       INI-OPE-FILE.
      *
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR APERTURA ARCHIVO INPUT  GNSTAB FS '
                       FIO-STAT
               DISPLAY 'ABORTO'
               STOP RUN.

           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GNS-FIO-TAO.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR APERTURA TABLA OUTPUT  GNSTAO FS '
                       FIO-STAT
               DISPLAY 'ABORTO'
               STOP RUN.
      *
       FIN-OPN-FILE.
           EXIT.

       PRO-FILE SECTION.
      *----------------------
       INI-PRO-FILE.
           MOVE ZEROES       TO WSS-TOT-REG
                             WSS-TOT-REG-RNG
                             WSS-TOT-REG-100.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              DISPLAY ' ERROR FST-TAB '
              STOP RUN.
           PERFORM TAB-TRS-TAO UNTIL NOT FIO-STAT-OKS.
       FIN-PRO-FILE.
           EXIT.

       TAB-TRS-TAO SECTION.
       INI-TAB-TRS-TAO.
      *GRABA TAO DESDE TAB.
           ADD  1   TO WSS-TOT-REG.
           MOVE WSS-TOT-REG TO WSS-TOT-REG-RNG.
           IF WSS-TOT-REG-RNG = ZEROES
               ADD 100 TO WSS-TOT-REG-100
               DISPLAY 'REGISTRO INGRESADO ' WSS-TOT-REG-100.
      *        DISPLAY TAO.
      *
           MOVE SPACES              TO TAO.

           MOVE TAB-COD-TTAB  IN TAB TO TAB-COD-TTAB  IN TAO.
           MOVE TAB-COD-CTAB  IN TAB TO TAB-COD-CTAB  IN TAO.
           MOVE TAB-NUM-STRN  IN TAB TO TAB-NUM-STRN  IN TAO.
           MOVE TAB-NUM-ATRN  IN TAB TO TAB-NUM-ATRN  IN TAO.
           MOVE TAB-NUM-MTRN  IN TAB TO TAB-NUM-MTRN  IN TAO.
           MOVE TAB-NUM-DTRN  IN TAB TO TAB-NUM-DTRN  IN TAO.
           MOVE TAB-NUM-HHTR  IN TAB TO TAB-NUM-HHTR  IN TAO.
           MOVE TAB-NUM-MMTR  IN TAB TO TAB-NUM-MMTR  IN TAO.
           MOVE TAB-NUM-SSTR  IN TAB TO TAB-NUM-SSTR  IN TAO.
           MOVE TAB-MSC-TACC  IN TAB TO TAB-MSC-TACC  IN TAO.
           MOVE TAB-MSC-STAT  IN TAB TO TAB-MSC-STAT  IN TAO.
           MOVE TAB-MSC-TTRN  IN TAB TO TAB-MSC-TTRN  IN TAO.
           MOVE TAB-COD-TTRN  IN TAB TO TAB-COD-TTRN  IN TAO.
           MOVE TAB-COD-ATRN  IN TAB TO TAB-COD-ATRN  IN TAO.
           MOVE TAB-CIC-TTAB  IN TAB TO TAB-CIC-TTAB  IN TAO.
           MOVE TAB-CIC-CTAB  IN TAB TO TAB-CIC-CTAB  IN TAO.
           MOVE TAB-EXT-TTAB  IN TAB TO TAB-EXT-TTAB  IN TAO.
           MOVE TAB-EXT-CTAB  IN TAB TO TAB-EXT-CTAB  IN TAO.
           MOVE TAB-GLS-DCOR  IN TAB TO TAB-GLS-DCOR  IN TAO.
           MOVE TAB-GLS-ABRV  IN TAB TO TAB-GLS-ABRV  IN TAO.
           MOVE TAB-GLS-DESC  IN TAB TO TAB-GLS-DESC  IN TAO.
           MOVE TAB-GLS-DATA  IN TAB TO TAB-GLS-DATA  IN TAO.
           MOVE TAB-SNX-TTAB  IN TAB TO TAB-SNX-TTAB  IN TAO.
           MOVE TAB-SNX-CTAB  IN TAB TO TAB-SNX-CTAB  IN TAO.

           MOVE WSS-COD-SIST TO TAB-COD-TABS IN TAO
                                TAB-STP-ITRS IN TAO
                                TAB-CIC-TABS IN TAO
                                TAB-EXT-TABS IN TAO.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GNS-FIO-TAO.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR PUT ' FIO-STAT.
      *
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
      *    IF NOT FIO-STAT-OKS
      *        DISPLAY 'STATUS NXT ' FIO-STAT.
       FIN-TAB-TRS-TAO.
           EXIT.

       CLO-FILE SECTION.
      *------------------
       INI-CLO-FILE.
           DISPLAY 'NRO. REG. TRASPASADOS :' WSS-TOT-REG.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
      *    PERFORM GNS-FIO-TAO.
      *
      *
       FIN-CLO-FILE.
           EXIT.

      * RUTINAS
       GNS-FIO-TAB SECTION.
       INI-GNS-FIO-TAB.
           MOVE '00' TO FIO-STAT.
      *    Abrir archivo secuencial
           IF FIO-CMND = FIO-INP
              OPEN INPUT ARCH-TAB.
      *    Leer primer registro
           IF FIO-CMND = FIO-GET-FST
              READ ARCH-TAB AT END MOVE '23' TO FIO-STAT.
      *    Leer proximo registro
           IF FIO-CMND = FIO-GET-NXT
              READ ARCH-TAB AT END MOVE '23' TO FIO-STAT.
      *    Cerrar archivo secuencial
           IF FIO-CMND = FIO-CLO
              CLOSE ARCH-TAB.
       FIN-GNS-FIO-TAB.
           EXIT.

       GNS-FIO-TAO SECTION.
       INI-GNS-FIO-TAO.
      *    MOVE SPACES TO FIO-AKEY.
           MOVE '00' TO FIO-STAT.
           CALL 'GNSPFTAB IN OBJECT/GNSPFTAB'
                                 USING FIO-VARI TAO.
           MOVE FIO-STAT-LNK TO FIO-STAT.
       FIN-GNS-FIO-TAO.
           EXIT.

       DEL-TAO SECTION.
      *----------------
       INI-DEL-TAO.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAO.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM GNS-FIO-TAO.
           IF NOT FIO-STAT-OKS
                DISPLAY 'NRO. REG. BORRADOS :' WSS-TOT-REG
                STOP RUN.
           DISPLAY 'TAO : ' TAO.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GNS-FIO-TAO.
           STOP RUN.

      *    MOVE FIO-GET-KEY-UPD TO FIO-CMND.
      *    PERFORM GNS-FIO-TAO
      *    IF NOT FIO-STAT-OKS
      *         DISPLAY 'ERROR GRAVE..... ABORTO'
      *         DISPLAY 'NRO. REG. BORRADOS :' WSS-TOT-REG
      *         STOP RUN
      *    ELSE
      *         MOVE FIO-DEL TO FIO-CMND
      *         PERFORM GNS-FIO-TAO.
       FIN-DEL-TAO.
           EXIT.
