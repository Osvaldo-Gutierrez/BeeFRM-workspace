IDENTIFICATION DIVISION.
*=======================
PROGRAM-ID.	DESSCRTRL.
AUTHOR.		GUZMAN Y CIA.

* Subrutina Manejo Trailer

ENVIRONMENT DIVISION.
*====================

DATA DIVISION.
*=============
WORKING-STORAGE SECTION.
*-----------------------
COPY	FRMWSS		IN	DESTXT.
COPY	SCRWSS		IN	DESTXT.
COPY	FRMDATTRL	IN	GEN.

PROCEDURE DIVISION.
*==================

MAIN SECTION.
*------------
INI-MAIN.
	PERFORM SCR-SWKSP.
LEE-CACC.
	MOVE TRL-NOM-PRMT TO FRM-NFLD.
	IF SCR-STAT EQUAL SCR-STAT-ABT
		MOVE SCR-ABRT TO FRM-VFLD
	ELSE
		MOVE SCR-PRMT TO FRM-VFLD.
	CALL 'DESPROFRM' USING FDV-PUT.
	MOVE TRL-NOM-CPRM TO FRM-NFLD.
	MOVE TRL-GLS-CPRM TO FRM-VFLD.
	CALL 'DESPROFRM' USING FDV-PUT.
	MOVE TRL-NOM-CACC TO FRM-NFLD.
	CALL 'DESPROFRM' USING FDV-GET.
	MOVE FRM-VFLD	  TO TRL-COD-CACC.
	MOVE TRL-COD-CACC TO SCR-VFLD.
	MOVE FRM-FFLD	  TO SCR-FFLD.
	PERFORM TRL-LIMP.
	IF SCR-FFLD-BSP
		IF SCR-STAT = SCR-STAT-MOD AND SCR-VFLD = SPACES
			GO TO FIN-MAIN
		ELSE
			MOVE 'Accion NO VALIDA' TO FRM-MENS
			GO TO ERR-MAIN.
	IF SCR-STAT EQUAL SCR-STAT-ABT
		IF SCR-VFLD = SPACES AND ( SCR-FFLD-TAB OR SCR-FFLD-RET )
			GO TO FIN-MAIN
		ELSE
			MOVE 'Accion NO VALIDA' TO FRM-MENS
			GO TO ERR-MAIN.
	IF SCR-VFLD = SPACES
		PERFORM TRL-CONF.
	IF SCR-VFLD = SCR-VFLD-NOT
		GO TO FIN-MAIN.
	IF SCR-VFLD = SCR-VFLD-YES
		IF NOT ( FRM-UARV = SPACES OR LOW-VALUES )
			MOVE FRM-SUAR-OKS TO FRM-SUAR
			CALL FRM-UARV USING FRM-VAL-CON
			IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
				GO TO ERR-MAIN
			ELSE
			IF FRM-SUAR EQUAL FRM-SUAR-WRN
				CALL 'DESPROFRM' USING FRM-MSG
				GO TO FIN-MAIN
			ELSE
				GO TO FIN-MAIN
		ELSE
			GO TO FIN-MAIN.
	IF SCR-STAT EQUAL SCR-STAT-SON OR SCR-FFLD-TAB
		MOVE 'Accion NO VALIDA' TO FRM-MENS
		GO TO ERR-MAIN.
	INSPECT TRL-COD-CACC REPLACING LEADING SPACES BY ZEROES.
	IF TRL-COD-CACC NOT NUMERIC
		MOVE 'Accion NO VALIDA' TO FRM-MENS
		GO TO ERR-MAIN.
	MOVE TRL-COD-CACC TO SCR-VFLD.
	IF FRM-UARV = SPACES OR LOW-VALUES
		MOVE 'Opcion NO IMPLEMENTADA' TO FRM-MENS
		GO TO ERR-MAIN.
	MOVE SCR-VFLD TO FRM-NFIL.
	MOVE FRM-SUAR-OKS TO FRM-SUAR.
	CALL FRM-UARV USING FRM-VAL-ACC.
	IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
		MOVE 'Campo INEXISTENTE o NO PERMITIDO' TO FRM-MENS
		GO TO ERR-MAIN.
	IF FRM-SUAR EQUAL FRM-SUAR-WRN
		CALL 'DESPROFRM' USING FRM-MSG.
	CALL 'DESPROFRM' USING FDV-SWKSP.
	MOVE SCR-MFLD-NOT TO SCR-MFLD.
	IF NOT ( FRM-UARV = SPACES OR LOW-VALUES )
		CALL FRM-UARV USING FRM-VAL-GET.
	IF SCR-MFLD NOT EQUAL SCR-MFLD-YES
		MOVE SCR-MFLD-YES TO SCR-MFLD
		CALL 'DESPROFRM' USING FDV-RETFO
		MOVE FRM-IFLD TO FRM-PIND
				 FRM-UIND
		MOVE FRM-NFLD TO FRM-PFLD
				 FRM-UFLD
		CALL 'DESPROFRM' USING FRM-GET-RNG
		IF FRM-STAT-ABT
			MOVE SCR-STAT-ABT TO SCR-STAT.
	PERFORM SCR-SWKSP.
	GO TO LEE-CACC.
ERR-MAIN.
	CALL 'DESPROFRM' USING FRM-MSG.
	GO TO LEE-CACC.
FIN-MAIN.
	CALL 'DESPROFRM' USING FDV-SWKSP.
	EXIT PROGRAM.

TRL-CONF SECTION.
*----------------
INI-TRL-CONF.
	MOVE SCR-VFLD-YES TO SCR-VFLD.
	IF SCR-CONF = SPACES
		GO TO FIN-TRL-CONF.
	MOVE TRL-NOM-PRMT TO FRM-NFLD.
	MOVE SCR-CONF	  TO FRM-VFLD.
	CALL 'DESPROFRM' USING FDV-PUT.
	MOVE TRL-NOM-CPRM TO FRM-NFLD.
	MOVE TRL-GLS-CPRM TO FRM-VFLD.
	CALL 'DESPROFRM' USING FDV-PUT.
	MOVE TRL-NOM-CACC TO FRM-NFLD.
LEE-TRL-CONF.
	CALL 'DESPROFRM' USING FDV-GET.
	MOVE FRM-VFLD TO SCR-VFLD.
	IF NOT ( SCR-VFLD = SCR-VFLD-YES OR SCR-VFLD-NOT OR SPACES )
		MOVE 'Debe ser S (Si), N o Blancos (No)' TO FRM-MENS
		CALL 'DESPROFRM' USING FRM-MSG-CLR
		GO TO LEE-TRL-CONF.
	IF SCR-VFLD = SPACES
		MOVE SCR-VFLD-NOT TO SCR-VFLD.
	PERFORM TRL-LIMP.
FIN-TRL-CONF.
	EXIT.
	
TRL-LIMP SECTION.
*----------------
INI-TRL-LIMP.
	MOVE TRL-NOM-PRMT TO FRM-NFLD.
	CALL 'DESPROFRM' USING FRM-CLR-FLD.
	MOVE TRL-NOM-CPRM TO FRM-NFLD.
	CALL 'DESPROFRM' USING FRM-CLR-FLD.
	MOVE TRL-NOM-CACC TO FRM-NFLD.
	CALL 'DESPROFRM' USING FRM-CLR-FLD.
FIN-TRL-LIMP.
	EXIT.

SCR-SWKSP SECTION.
*-----------------
INI-SCR-SWKSP.
	CALL 'FDV$SWKSP' USING
		BY DESCRIPTOR SCR-RWSP.
FIN-SCR-SWKSP.
	EXIT.
