       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GNSPLERR.
       AUTHOR.          BEE TEAM.
       DATE-WRITTEN.    12-Mar-97 06:54 PM.

      * Programa Listador de Reporte ERR sin Sort.


       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            C01 IS SALTO
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT RPTERR       ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTERR       ASSIGN TO        UT-S-RPTERR.
           SELECT RPTERR       ASSIGN TO        UT-S-RPTERR.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       FD  RPTERR LABEL RECORDS OMITTED
           RECORD CONTAINS 132 CHARACTERS.
       01  GRC-LINEA-ERR     PIC X(132).

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ERR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRERR.
       COPY GNSRRERR.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSWGGRC.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSRWERR.
       COPY GNSRNERR.
       COPY GNSROERR.
       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       COPY GNSWGFEC.
       COPY GNSWGHOY.

       01  WSS-VARI.
           03  WSS-COD-PRGM                          PIC X(08).
           03  WSS-FEC-FINI.
               05  WSS-NUM-DINI                      PIC 9(02).
               05  WSS-NUM-MINI                      PIC 9(02).
               05  WSS-NUM-SINI                      PIC 9(02).
               05  WSS-NUM-AINI                      PIC 9(02).
           03  WSS-FEC-FTER.
               05  WSS-NUM-DTER                      PIC 9(02).
               05  WSS-NUM-MTER                      PIC 9(02).
               05  WSS-NUM-STER                      PIC 9(02).
               05  WSS-NUM-ATER                      PIC 9(02).
      *DAD ini  03-SEP-1991
           03  WSS-FEC-FFEI.
               05  WSS-NUM-SFEI                      PIC 9(02).
               05  WSS-NUM-AFEI                      PIC 9(02).
               05  WSS-NUM-MFEI                      PIC 9(02).
               05  WSS-NUM-DFEI                      PIC 9(02).
           03  WSS-FEC-FFET.
               05  WSS-NUM-SFET                      PIC 9(02).
               05  WSS-NUM-AFET                      PIC 9(02).
               05  WSS-NUM-MFET                      PIC 9(02).
               05  WSS-NUM-DFET                      PIC 9(02).
      *DAD fin  03-SEP-1991
           03  WSS-FEC-FCMP.
               05  WSS-NUM-SCMP                      PIC 9(02).
               05  WSS-NUM-ACMP                      PIC 9(02).
               05  WSS-NUM-MCMP                      PIC 9(02).
               05  WSS-NUM-DCMP                      PIC 9(02).
           03  WSS-NUM-CEJE                          PIC X(02).
           03  WSS-NUM-CEJE-R REDEFINES WSS-NUM-CEJE PIC 9(02).
           03  WSS-CAS-SEP.
               05  WSS-CAS-PROG     VALUE '*'        PIC X(01).
               05  WSS-CAS-FINI     VALUE '*'        PIC X(01).
               05  WSS-CAS-FTER     VALUE '*'        PIC X(01).
               05  WSS-CAS-CEJE     VALUE '*'        PIC X(01).
           03  WSS-CAS              VALUE SPACES     PIC X(04).
               88 WSS-CAS-01 VALUE '****'.
               88 WSS-CAS-02 VALUE 'P***'.
               88 WSS-CAS-03 VALUE 'PFF*'.
               88 WSS-CAS-04 VALUE 'P*F*'.
               88 WSS-CAS-05 VALUE 'PF**'.
               88 WSS-CAS-06 VALUE '***C'.
               88 WSS-CAS-07 VALUE 'P**C'.
               88 WSS-CAS-08 VALUE 'PFFC'.
               88 WSS-CAS-09 VALUE 'P*FC'.
               88 WSS-CAS-10 VALUE 'PF*C'.
      *DAD ini  03-SEP-1991
               88 WSS-CAS-11 VALUE '*FF*'.
      *DAD fin  03-SEP-1991
      *>>>>

      * AQUI EXISTIA LABEL RF INI
      * AQUI EXISTIA LABEL RF FIN
       COPY GNSRTERR.

       PROCEDURE DIVISION.
      *==================

      * AQUI EXISTIA LABEL FIN_DEC INI
      * AQUI EXISTIA LABEL FIN_DEC FIN

       MAIN SECTION.
      *------------
       INI-MAIN.
           MOVE SYS-MXFL TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       COPY GNSBGEDB.
           MOVE 'GNS' TO RPT-SIST.
           MOVE 'GNSPLERR' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
       INI-INP-SRT.
      *<<<< INI_INP
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.

      *Captura Codigo de Operacion
           DISPLAY 'CODIGO DE PROGRAMA            : '.
           ACCEPT  WSS-COD-PRGM IN WSS-VARI.
           DISPLAY WSS-COD-PRGM IN WSS-VARI.
      *Captura Fecha de Inicio
           DISPLAY 'FECHA DE INICIO  ( DDMMAAAA ) : '.
           ACCEPT  WSS-FEC-FINI IN WSS-VARI.
           DISPLAY WSS-FEC-FINI IN WSS-VARI.
      *Captura Fecha de Termino
           DISPLAY 'FECHA DE TERMINO ( DDMMAAAA ) : '
           ACCEPT  WSS-FEC-FTER IN WSS-VARI.
           DISPLAY WSS-FEC-FTER IN WSS-VARI.
      *Captura Correlativo de ejecucion
           DISPLAY 'CORRELATIVO DE EJECUCION      : '
           ACCEPT  WSS-NUM-CEJE IN WSS-VARI.
           DISPLAY WSS-NUM-CEJE IN WSS-VARI.

           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

           IF WSS-COD-PRGM IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-PRGM IN WSS-VARI
               MOVE '*' TO WSS-CAS-PROG IN WSS-VARI
           ELSE
               IF WSS-COD-PRGM IN WSS-VARI NOT = '*'
                   MOVE 'P' TO WSS-CAS-PROG IN WSS-VARI.
           IF WSS-FEC-FINI IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-FEC-FINI IN WSS-VARI
               MOVE '*' TO WSS-CAS-FINI IN WSS-VARI
           ELSE
               IF WSS-FEC-FINI IN WSS-VARI NOT = '*'
                   MOVE 'F' TO WSS-CAS-FINI IN WSS-VARI.
           IF WSS-FEC-FTER IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-FEC-FTER IN WSS-VARI
               MOVE '*' TO WSS-CAS-FTER IN WSS-VARI
           ELSE
               IF WSS-FEC-FTER IN WSS-VARI NOT = '*'
                   MOVE 'F' TO WSS-CAS-FTER IN WSS-VARI.
           IF WSS-NUM-CEJE IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-NUM-CEJE IN WSS-VARI
               MOVE '*' TO WSS-CAS-CEJE IN WSS-VARI
           ELSE
               IF WSS-NUM-CEJE IN WSS-VARI NOT = '*'
                   MOVE 'C' TO WSS-CAS-CEJE IN WSS-VARI.

           MOVE WSS-CAS-SEP IN WSS-VARI TO WSS-CAS IN WSS-VARI.
      *DAD ini  03-SEP-1991
      *     IF WSS-COD-PRGM IN WSS-VARI = '*'
      *         IF WSS-FEC-FTER IN WSS-VARI NOT = '*'
      *             DISPLAY 'DEBE INGRESAR FECHA = * O ESPACIOS'
      *             MOVE PGM-SMAL TO PGM-STAT-SRT
      *             GO TO FIN-INP-SRT
      *         ELSE
      *             IF WSS-FEC-FINI IN WSS-VARI NOT = '*'
      *                 DISPLAY 'DEBE INGRESAR FECHA = * O ESPACIOS'
      *                 MOVE PGM-SMAL TO PGM-STAT-SRT
      *                 GO TO FIN-INP-SRT.
      *DAD fin  03-SEP-1991
       VAL-FEC-FINI.
           IF WSS-FEC-FINI IN WSS-VARI = '*'
               GO TO VAL-FEC-FTER.
      *VAL-FEC Valida Fecha de Inicio
           DISPLAY WSS-FEC-FINI IN WSS-VARI.
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.
      *VAL-FEC Valida Fecha de Termino
       VAL-FEC-FTER.
           IF WSS-FEC-FTER IN WSS-VARI = '*'
               GO TO NEXT-INP-SRT.
           DISPLAY WSS-FEC-FTER IN WSS-VARI.
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.

      *CMP-FEC Compara Fecha de Inicio con Fecha de Termino
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FEC1.
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-GRT
               MOVE 'TAB'         TO MSG-COD-SIST
               MOVE 'FECFINIFTER' TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.
      *DAD ini  03-SEP-1991
           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DFEI IN WSS-VARI.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MFEI IN WSS-VARI.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SFEI IN WSS-VARI.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AFEI IN WSS-VARI.
           MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DFET IN WSS-VARI.
           MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MFET IN WSS-VARI.
           MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-SFET IN WSS-VARI.
           MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-AFET IN WSS-VARI.
      *DAD fin  03-SEP-1991
       NEXT-INP-SRT.
           IF WSS-NUM-CEJE IN WSS-VARI NOT = '*' AND
              WSS-NUM-CEJE IN WSS-VARI NOT NUMERIC
               DISPLAY 'CORRELATIVO DE EJECUCION DEBE SER NUMERICO'
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.
      *>>>>
      *     MOVE 'GNSPLERR' TO RPT-NPGM.
           CALL 'GNSPLHDR' USING RPT-VARI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-ERR.
       FST-INP-SRT.
      *<<<< INI_FST_INP
           DISPLAY 'WSS-CAS : ' WSS-CAS IN WSS-VARI
      *DAD ini  03-SEP-1991
           IF WSS-CAS-01 OR WSS-CAS-06 OR WSS-CAS-11
      *DAD fin  03-SEP-1991
               GO TO NXT-FST-INP.
           MOVE WSS-COD-PRGM IN WSS-VARI TO ERR-COD-PRGM IN ERR.
           MOVE ZEROES                   TO ERR-FEC-FEJE IN ERR.
           MOVE ZEROES                   TO ERR-NUM-CEJE IN ERR.
           MOVE ZEROES                   TO ERR-NUM-CERR IN ERR.
           IF WSS-CAS-03 OR WSS-CAS-05 OR WSS-CAS-08 OR WSS-CAS-10
               MOVE WSS-NUM-DINI IN WSS-VARI TO ERR-NUM-DEJE IN ERR
               MOVE WSS-NUM-MINI IN WSS-VARI TO ERR-NUM-MEJE IN ERR
               MOVE WSS-NUM-SINI IN WSS-VARI TO ERR-NUM-SEJE IN ERR
               MOVE WSS-NUM-AINI IN WSS-VARI TO ERR-NUM-AEJE IN ERR.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GNS-FIO-ERR.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTEN ERRORES EN START : '
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.
           IF WSS-COD-PRGM IN WSS-VARI NOT = ERR-COD-PRGM IN ERR
               DISPLAY 'NO EXISTEN ERRORES EN LECTURA : '
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.
           IF WSS-CAS-03 OR WSS-CAS-05 OR WSS-CAS-08 OR WSS-CAS-10
               MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DCMP IN WSS-VARI
               MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MCMP IN WSS-VARI
               MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SCMP IN WSS-VARI
               MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-ACMP IN WSS-VARI
               IF ERR-FEC-FEJE IN ERR < WSS-FEC-FCMP IN WSS-VARI
                   DISPLAY 'NO EXISTEN ERRORES EN FECHA INICIO : '
                   MOVE PGM-SMAL TO PGM-STAT-SRT
                   GO TO FIN-INP-SRT.
           IF WSS-CAS-04 OR WSS-CAS-09
               MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DCMP IN WSS-VARI
               MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MCMP IN WSS-VARI
               MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-SCMP IN WSS-VARI
               MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-ACMP IN WSS-VARI
               IF ERR-FEC-FEJE IN ERR > WSS-FEC-FCMP IN WSS-VARI
                   DISPLAY 'NO EXISTEN ERRORES EN FECHA TERMINO : '
                   MOVE PGM-SMAL TO PGM-STAT-SRT
                   GO TO FIN-INP-SRT.
           GO TO LUP-INP-SRT.
       NXT-FST-INP.
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM GNS-FIO-ERR.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
       COPY GNSRMERR.
       INI-OUT-SRT.
           OPEN OUTPUT RPTERR.
           PERFORM INITIATE-RPTERR.
           MOVE SRT TO SRT-OLD-ERR.
           MOVE SRT TO SRT-CUR-ERR.
           PERFORM ERR-FST-PRO-CTL.
       LUP-MAIN.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
      *<<<< LUP_INP
      *DAD ini  03-SEP-1991
           IF WSS-CAS-11
               IF ERR-FEC-FEJE IN ERR < WSS-FEC-FFEI IN WSS-VARI OR
                  ERR-FEC-FEJE IN ERR > WSS-FEC-FFET IN WSS-VARI
                   GO TO NXT-INP-SRT.
      *DAD fin  03-SEP-1991
           IF WSS-CAS-06 OR WSS-CAS-07 OR WSS-CAS-08 OR WSS-CAS-09 OR
              WSS-CAS-10
               IF WSS-NUM-CEJE-R IN WSS-VARI NOT = ERR-NUM-CEJE IN ERR
                   GO TO NXT-INP-SRT.
      *>>>>
       MOV-INP-SRT.
       COPY GNSRMERR.
       LUP-OUT-SRT.
      *<<<< LUP_OUT
      *GET-MSG Busca mensaje en tabla
           IF ERR-COD-MENS IN SRT > SPACES
               MOVE 'COL'               TO MSG-COD-SIST
               MOVE ERR-COD-MENS IN SRT TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO WSS-GLS-MENS IN WSS-ERR
           ELSE
               MOVE SPACES TO WSS-GLS-MENS IN WSS-ERR.

           IF ERR-IND-SVRT IN SRT = 'F'
               MOVE 'FATAL'       TO WSS-GLS-SVRT IN WSS-ERR
           ELSE
           IF ERR-IND-SVRT IN SRT = 'R'
               MOVE 'RECUPERABLE' TO WSS-GLS-SVRT IN WSS-ERR
           ELSE
           IF ERR-IND-SVRT IN SRT = 'A'
               MOVE 'ADVERTENCIA' TO WSS-GLS-SVRT IN WSS-ERR
           ELSE
           IF ERR-IND-SVRT IN SRT = 'I'
               MOVE 'INFORMATIVO' TO WSS-GLS-SVRT IN WSS-ERR
           ELSE
               MOVE SPACES        TO WSS-GLS-SVRT IN WSS-ERR.

           IF ERR-COD-TERR IN SRT = 'L'
               MOVE 'LOGICA'     TO WSS-GLS-TERR IN WSS-ERR
           ELSE
           IF ERR-COD-TERR IN SRT = 'V'
               MOVE 'VALIDACION' TO WSS-GLS-TERR IN WSS-ERR
           ELSE
               MOVE SPACES       TO WSS-GLS-TERR IN WSS-ERR.
      *>>>>
           PERFORM ERR-CLR-VAR-CTL.
           PERFORM ERR-CHK-VAR-CTL.
           MOVE SRT TO SRT-CUR-ERR.
           MOVE SRT-OLD-ERR TO SRT.
           PERFORM ERR-PRO-VAR-CTL-CF.
           MOVE SRT-CUR-ERR TO SRT.
           PERFORM ERR-PRO-VAR-CTL-CH.
           PERFORM PRO-DL-ERR.
       NXT-INP-SRT.
       NXT-OUT-SRT.
           MOVE SRT TO SRT-OLD-ERR.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-ERR.
      *<<<< FIN_NXT_INP
      *DAD ini  03-SEP-1991
           IF WSS-CAS-01 OR WSS-CAS-06 OR WSS-CAS-11
      *DAD fin  03-SEP-1991
               GO TO NXT-FIN-NXT-INP.
           IF WSS-COD-PRGM IN WSS-VARI NOT = ERR-COD-PRGM IN ERR
               GO TO FIN-INP-SRT.
           IF WSS-CAS-03 OR WSS-CAS-04 OR WSS-CAS-08 OR WSS-CAS-09
               MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DCMP IN WSS-VARI
               MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MCMP IN WSS-VARI
               MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-SCMP IN WSS-VARI
               MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-ACMP IN WSS-VARI
               IF ERR-FEC-FEJE IN ERR > WSS-FEC-FCMP IN WSS-VARI
                   GO TO FIN-INP-SRT.
       NXT-FIN-NXT-INP.
      *>>>>
           GO TO LUP-MAIN.
       FIN-MAIN.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GNS-FIO-ERR.
       FIN-OUT-SRT.
           PERFORM TERMINATE-RPTERR.
           CLOSE RPTERR.
           IF PGM-STAT-SRT-MAL
               PERFORM GNS-PRO-ABT
           ELSE
               PERFORM GNS-PRO-END.

       COPY GNSBFERR.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSREERR.
      *    12-MAR-97 06:52 PM     ,PAI= ,CLI= ,SOP=MVS
       D-PH-ERR SECTION.
       INI-PH-ERR.
       FIN-PH-ERR.
           EXIT.
       D-DL-ERR SECTION.
       INI-DL-ERR.
       FIN-DL-ERR.
           EXIT.
       COPY GNSBGABT.

      *<<<< EOF
       COPY GNSBBMSG.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
      *>>>>

