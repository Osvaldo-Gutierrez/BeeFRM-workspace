       IDENTIFICATION DIVISION.      *=======================       PROGRAM-ID.      GNSPBLMT.       AUTHOR.          BEE-TEAM - KATHERINE ALARCON GIADACH.       DATE-WRITTEN     24-SEP-2013.      *-----------------------------------------------------------------      *  MODIFICACIONES:      *  ---------------      *  AUTOR      : KATHERINE ALARCON GIADACH      *  FECHA      : 2013-10-02       *  ETIQUETA   : Cima-INI 02-OCT-2013 LOG MTI      *  PROYECTO   : Log MTI      *  OBJETIVO   : DEPURA TABLA DTC LGM Y PASA REGISTROS       *               A ARCHIVO INDEXADO LGX      *-----------------------------------------------------------------      * ENTRADA    : GNS-LGM-188 (ENTRADA LGM DATACOM)      *              SECUENCIALIZADA EN ARCHIVO LGS      *            --------------------------------------------------      * SALIDA     : GNS-LGX ARCHIVO INDEXADO      * PARAMETROS :      *              LNK-FEC-FINI = FECHA DE INICIO       *              LNK-FEC-FFIN = FECHA DE TERMINO       ENVIRONMENT DIVISION.      *====================       CONFIGURATION SECTION.       SPECIAL-NAMES.      *        DECIMAL-POINT IS COMMA.       DATA DIVISION.      *=============       WORKING-STORAGE SECTION.      *------------------------       77  WSS-TAG-GNSPBLMT PIC X(0125) VALUE           '<IDNPGM NOM=$GNSPBLMT$ VSN=$13.10.22$ GEN=$20-10-13      -    '19:36$ FNC=$LOGMTI$/>'.      *---------------------------------------------------------------*      * ENTIDAD LGM - APLANADO                                        *      *---------------------------------------------------------------*      *---------------------------------------------------------------*      * ENTIDAD LGM                                                   *      *---------------------------------------------------------------*       COPY GNSBRLGM.       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LGM-REQA==.      *---------------------------------------------------------------*      * OTRAS ENTIDADES UTILIZADAS EN EL PROGRAMA                     *      *---------------------------------------------------------------*       COPY GNSBRTAB.       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.       COPY GNSBRMSG.       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.       COPY GNSBRMSC.       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.      *---------------------------------------------------------------*      * OTROS COPYS UTILIZADOS EN EL PROGRAMA                         *      *---------------------------------------------------------------*       COPY GNSWGRQA.       COPY GNSWGUIB.       COPY GNSWGELS.       COPY GNSWVIDD.       COPY GNSWCFIO.       COPY GNSWVFIO.       COPY GNSWGSYS.       COPY GNSWGFEC.       COPY GNSWGHOY.       COPY GNSWGLGM.      *---------------------------------------------------------------*      * VARIABLES AUXILIARES UTILIZADAS EN EL PROGRAMA                *      *---------------------------------------------------------------*       01  WSS-VARIABLES.           05 WSS-NUM-WLGX-OKS          PIC 9(09) VALUE ZEROES.           05 WSS-NUM-WLGX-ERR          PIC 9(09) VALUE ZEROES.                      05 WSS-NUM-DLGM-OKS          PIC 9(09) VALUE ZEROES.           05 WSS-NUM-DLGM-ERR          PIC 9(09) VALUE ZEROES.                      05 WSS-NUM-LLGS              PIC 9(09) VALUE ZEROES.           05 WSS-FEC-FINI.              10 WSS-FEC-DINI           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-MINI           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-SINI           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-AINI           VALUE  ZEROES  PIC 9(02).           05 WSS-FEC-FFIN.              10 WSS-FEC-DFIN           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-MFIN           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-SFIN           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-AFIN           VALUE  ZEROES  PIC 9(02).           05 WSS-HOR-FSIS.              10 WSS-HOR-HSIS           VALUE  ZEROES  PIC 9(02).              10 WSS-GLS-H1SI           VALUE  ZEROES  PIC X(01).              10 WSS-HOR-MSIS           VALUE  ZEROES  PIC 9(02).              10 WSS-GLS-H2SI           VALUE  ZEROES  PIC X(01).              10 WSS-HOR-SSIS           VALUE  ZEROES  PIC 9(02).           05 WSS-FEC-FSIS.              10 WSS-FEC-DSIS           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-MSIS           VALUE  ZEROES  PIC 9(02).              10 WSS-GLS-F1SI           VALUE  ZEROES  PIC X(01).              10 WSS-FEC-SSIS           VALUE  ZEROES  PIC 9(02).              10 WSS-GLS-F2SI           VALUE  ZEROES  PIC X(01).              10 WSS-FEC-ASIS           VALUE  ZEROES  PIC 9(02).           05 WSS-FEC-FAU1.              10 WSS-FEC-SAU1           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-AAU1           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-MAU1           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-DAU1           VALUE  ZEROES  PIC 9(02).           05 WSS-FEC-FAU2.              10 WSS-FEC-SAU2           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-AAU2           VALUE  ZEROES  PIC 9(02).              10 WSS-GLS-1AU2           VALUE  ZEROES  PIC X(01).              10 WSS-FEC-MAU2           VALUE  ZEROES  PIC 9(02).              10 WSS-GLS-2AU2           VALUE  ZEROES  PIC X(01).              10 WSS-FEC-DAU2           VALUE  ZEROES  PIC 9(02).      *---------------------------------------------------------------*      * DEFINICION DE CONSTANTES                                      *      *---------------------------------------------------------------*       01  WSS-CONSTANTES.           05 WCC-1                     PIC 9(01) VALUE 1.           05 WCC-2                     PIC 9(01) VALUE 2.           05 WCC-10                    PIC 9(02) VALUE 10.           05 WCC-S                     PIC X(01) VALUE 'S'.           05 WCC-N                     PIC X(01) VALUE 'N'.           05 WCC-L                     PIC X(01) VALUE 'L'.           05 WCC-GNSPBLMT              PIC X(08) VALUE 'GNSPBLMT'.           05 WCC-FIN-PRMT              PIC X(08) VALUE 'FIN-PRMT'.           05 WCC-DOSPTO                PIC X(01) VALUE ':'.           05 WCC-GUION                 PIC X(01) VALUE '-'.           05 WCC-GNS                   PIC X(03) VALUE 'GNS'.           05 WCC-VDS                   PIC X(03) VALUE 'VDS'.      *---------------------------------------------------------------*      * DEFINICION DE SWITCHS                                         *      *---------------------------------------------------------------*       01  SWT-SWITCHS.           05 SWT-EOF-IGLS        PIC X(01) VALUE 'N'.              88 SI-EOF-ILGS      VALUE 'S'.              88 NO-EOF-ILGS      VALUE 'N'.           05 SWT-ENC-ILGS        PIC X(01) VALUE 'N'.              88 SI-ENC-ILGS      VALUE 'S'.              88 NO-ENC-ILGS      VALUE 'N'.           05 SWT-ENC-ILGM        PIC X(01) VALUE 'N'.              88 SI-ENC-ILGM      VALUE 'S'.              88 NO-ENC-ILGM      VALUE 'N'.           05 SWT-WRT-ILGX        PIC X(01) VALUE 'N'.              88 SI-WRT-ILGX      VALUE 'S'.              88 NO-WRT-ILGX      VALUE 'N'.           05 SWT-DEL-ILGM        PIC X(01) VALUE 'N'.              88 SI-DEL-ILGM      VALUE 'S'.              88 NO-DEL-ILGM      VALUE 'N'.      *---------------------------------------------------------------*      * PARAMETROS DE ENTRADA                                         *      *---------------------------------------------------------------*       01  LNK-ENT-PRMT.           05 LNK-FEC-FINI.              10 LNK-FEC-SINI           PIC  9(02) VALUE ZEROES.              10 LNK-FEC-AINI           PIC  9(02) VALUE ZEROES.              10 LNK-FEC-MINI           PIC  9(02) VALUE ZEROES.              10 LNK-FEC-DINI           PIC  9(02) VALUE ZEROES.           05 LNK-FEC-FFIN.              10 LNK-FEC-SFIN           PIC  9(02) VALUE ZEROES.              10 LNK-FEC-AFIN           PIC  9(02) VALUE ZEROES.              10 LNK-FEC-MFIN           PIC  9(02) VALUE ZEROES.              10 LNK-FEC-DFIN           PIC  9(02) VALUE ZEROES.      *---------------------------------------------------------------*      *                       PROCEDURE DIVISION                      *      *---------------------------------------------------------------*       PROCEDURE DIVISION.      *-------------------       MAIN SECTION.       INI-MAIN.           COPY     GNSBGEDB.           DISPLAY  WSS-TAG-GNSPBLMT.           MOVE     WCC-GNSPBLMT        TO FIO-PROG.           PERFORM  GNS-BUS-IDD.           PERFORM  GET-FHOY.           PERFORM  ACC-FECH.           PERFORM  OPEN-FILE.           PERFORM  LEE-IFST.           PERFORM  PRO-PPAL            UNTIL SI-EOF-ILGS.           PERFORM  ESTADISTILGS.           PERFORM  CLOSE-FILE.           PERFORM  GNS-PRO-END.       FIN-MAIN.           EXIT.      *--------------------------------------------------------------*      *                       PROCEDURE DIVISION                     *      *--------------------------------------------------------------*      *--------------------------------------------------------------*      * ACEPTA PARAMETROS DE ENTRADA                                 *      *--------------------------------------------------------------*       ACC-FECH SECTION.       INI-ACC-FECH.      *-------------           DISPLAY 'INGRESE FECHA DE INICIO '.           ACCEPT LNK-FEC-FINI.                      DISPLAY 'INGRESE FECHA DE FINAL '.           ACCEPT LNK-FEC-FFIN.                      PERFORM VAL-FECH.       FIN-ACC-PARM.           EXIT.      *--------------------------------------------------------------*      * VALIDA PARAMETROS FECHA                                      *      *--------------------------------------------------------------*       VAL-FECH SECTION.       INI-VAL-FECH.      *-------------           DISPLAY '-------------------------------------------------'.           DISPLAY '          INICIO CAPTURA DE PARAMETROS'.           DISPLAY '-------------------------------------------------'.           DISPLAY 'FECHA INICIO   DDMMSSAA!    : ' LNK-FEC-FINI.           DISPLAY 'FECHA FIN      DDMMSSAA!    : ' LNK-FEC-FFIN.           DISPLAY '-------------------------------------------------'.      *--------------------------------------------------------------*      * VALIDA FECHA INICIO                                          *      *--------------------------------------------------------------*           IF  LNK-FEC-FINI NOT > ZEROES OR               LNK-FEC-FINI IS NOT NUMERIC               DISPLAY 'PARAMETRO - FECHA INICIO - NO VALIDO'               DISPLAY '        SE CANCELA EL PROCESO       '               PERFORM GNS-PRO-ABT.           MOVE LNK-FEC-DINI            TO WSS-FEC-DINI.           MOVE LNK-FEC-MINI            TO WSS-FEC-MINI.           MOVE LNK-FEC-SINI            TO WSS-FEC-SINI.           MOVE LNK-FEC-AINI            TO WSS-FEC-AINI.           MOVE WSS-FEC-FINI            TO FEC-FECH.           MOVE FEC-FORM-FEC            TO FEC-FORM.           MOVE FEC-FBLK-S              TO FEC-FBLK.           MOVE FEC-CHOY-N              TO FEC-CHOY.           MOVE FEC-VHBL-N              TO FEC-VHBL.           MOVE FEC-VAL-FEC             TO FEC-CMND.           PERFORM PRO-FEC.           IF  NOT FEC-STAT-OKS               DISPLAY FEC-MENS               DISPLAY 'PARAMETRO - FECHA INICIO - NO VALIDO'               DISPLAY 'SE CANCELA EL PROCESO ' LNK-FEC-FINI               PERFORM GNS-PRO-ABT.      *--------------------------------------------------------------*      * VALIDA FECHA FIN                                             *      *--------------------------------------------------------------*           IF  LNK-FEC-FFIN NOT > ZEROES OR               LNK-FEC-FFIN IS NOT NUMERIC               DISPLAY 'PARAMETRO - FECHA FIN - NO VALIDO'               DISPLAY '        SE CANCELA EL PROCESO       '               PERFORM GNS-PRO-ABT.           MOVE LNK-FEC-DFIN            TO WSS-FEC-DFIN.           MOVE LNK-FEC-MFIN            TO WSS-FEC-MFIN.           MOVE LNK-FEC-SFIN            TO WSS-FEC-SFIN.           MOVE LNK-FEC-AFIN            TO WSS-FEC-AFIN.           MOVE WSS-FEC-FFIN            TO FEC-FECH.           MOVE FEC-FORM-FEC            TO FEC-FORM.           MOVE FEC-FBLK-S              TO FEC-FBLK.           MOVE FEC-CHOY-N              TO FEC-CHOY.           MOVE FEC-VHBL-N              TO FEC-VHBL.           MOVE FEC-VAL-FEC             TO FEC-CMND.           PERFORM PRO-FEC.           IF  NOT FEC-STAT-OKS               DISPLAY FEC-MENS               DISPLAY 'PARAMETRO - FECHA FIN - NO VALIDO'               DISPLAY 'SE CANCELA EL PROCESO ' LNK-FEC-FFIN               PERFORM GNS-PRO-ABT.       FIN-VAL-FECH.           EXIT.      *---------------------------------------------------------------*      * LEE EL PRIMER REGISTRO DE ENTRADA Y VALIDA SI ESTA VACIO      *      *---------------------------------------------------------------*       LEE-IFST SECTION.       INI-LEE-IFST.           MOVE WCC-GNS                 TO FIO-SIST.           MOVE SPACES                  TO LGM.           MOVE FIO-GET-FST             TO FIO-CMND.           PERFORM  GNS-FIO-LGS.           IF  NOT FIO-STAT-OKS AND FIO-STAT = WCC-10               DISPLAY 'ARCHIVO GNSLGS VACIO, STAT : ' FIO-STAT               PERFORM GNS-PRO-ABT.       FIN-LEE-IFST.           EXIT.      *--------------------------------------------------------------*      *                        PROCESO PRINCIPAL                     *      *--------------------------------------------------------------*       PRO-PPAL SECTION.      *-----------------       INI-PRO-PPAL.      *-------------       LUP-PPAL.           IF  FIO-STAT-EOF OR NOT FIO-STAT-OKS                 SET  SI-EOF-ILGS         TO TRUE                 GO TO FIN-PRO-PPAL.           ADD  WCC-1                   TO WSS-NUM-LLGS.           PERFORM PRO-ILGM.       NXT-PPAL.           MOVE  WCC-GNS                TO FIO-SIST.      *     MOVE  SPACES                 TO LGS.           MOVE  FIO-GET-NXT            TO FIO-CMND.           PERFORM  GNS-FIO-LGS.           GO TO LUP-PPAL.       FIN-PRO-PPAL.           EXIT.      *--------------------------------------------------------------*      * PROCESO GERERA ARCHIVO RESPALDO CORTO PLAZO                  *      *--------------------------------------------------------------*       PRO-ILGM SECTION.       INI-PRO-ILGM.      *-------------           PERFORM LEE-ILGM.       FIN-PRO-ILGM.           EXIT.      *--------------------------------------------------------------*      * DELETE REGISTO EN TABLA LGM                                  *      *--------------------------------------------------------------*       LEE-ILGM SECTION.       INI-LEE-ILGM.      *-------------           MOVE WCC-GNS                 TO FIO-SIST.           MOVE FIO-PUT TO FIO-CMND.           PERFORM GNS-FIO-LGX.                      IF NOT FIO-STAT-OKS                ADD WCC-1 TO WSS-NUM-WLGX-ERR                DISPLAY 'ERROR AL GRABAR ARCHIVO INDEXADO GNSLGX : '                    FIO-STAT ' ' FIO-CMND                DISPLAY LGM-KEY-IREG IN LGM                DISPLAY ' '           ELSE                ADD WCC-1 TO WSS-NUM-WLGX-OKS                MOVE FIO-GET-KEY-UPD         TO FIO-CMND                PERFORM  GNS-FIO-LGM                IF NOT FIO-STAT-OKS                                        DISPLAY 'ERROR AL LEER BASE LGM : ' FIO-STAT                    DISPLAY LGM-KEY-IREG IN LGM                    DISPLAY ' '                ELSE                                    MOVE FIO-DEL TO FIO-CMND                    PERFORM GNS-FIO-LGM                    IF FIO-STAT-OKS                         ADD WCC-1 TO WSS-NUM-DLGM-OKS                         PERFORM CHK-PNT                    ELSE                         ADD WCC-1 TO WSS-NUM-DLGM-ERR                         DISPLAY 'LGM BDD ERROR EN ELI>' FIO-STAT                          '+' LGM-KEY-IREG.       FIN-LEE-ILGM.           EXIT.      *--------------------------------------------------------------*      * CHECK POINT A LA BASE DE DATOS                               *      *--------------------------------------------------------------*       CHK-PNT SECTION.       INI-CHK-PNT.           MOVE WCC-GNS                 TO FIO-SIST.           MOVE FIO-CHK-PNT             TO FIO-CMND.           PERFORM  GNS-FIO-LGM.           IF  NOT FIO-STAT-OKS               DISPLAY 'CHECK-POINT ERRONEO'.       FIN-CHK-PNT.           EXIT.      *--------------------------------------------------------------*      * APERTURA DE ARCHIVOS                                         *      *--------------------------------------------------------------*       OPEN-FILE SECTION.       INI-OPEN-FILE.      *--------------           MOVE FIO-UPD                 TO FIO-CMND.           PERFORM  GNS-FIO-LGX.           IF  NOT FIO-STAT-OKS               DISPLAY 'ERROR AL ABRIR GNSLGX, STAT : ' FIO-STAT               PERFORM GNS-PRO-ABT.           MOVE FIO-INP                 TO FIO-CMND.           PERFORM  GNS-FIO-LGS.           IF  NOT FIO-STAT-OKS               DISPLAY 'ERROR AL ABRIR GNSLGS, STAT : ' FIO-STAT               PERFORM GNS-PRO-ABT.       FIN-OPEN-FILE.           EXIT.      *--------------------------------------------------------------*      * CIERRE DE ARCHIVOS                                           *      *--------------------------------------------------------------*       CLOSE-FILE SECTION.       INI-CLOSE-FILE.      *---------------           MOVE WCC-GNS                 TO FIO-SIST.           MOVE FIO-CLO                 TO FIO-CMND.           PERFORM  GNS-FIO-LGS.           MOVE FIO-CLO                 TO FIO-CMND.           PERFORM  GNS-FIO-LGX.       FIN-CLOSE-FILE.           EXIT.      *---------------------------------------------------------------*      *                    ESTADISTILGS DEL PROGRAMA                  *      *---------------------------------------------------------------*       ESTADISTILGS SECTION.       INI-ESTADISTILGS.           MOVE HOY-HHOY(01:02)         TO WSS-HOR-HSIS.           MOVE WCC-DOSPTO              TO WSS-GLS-H1SI.           MOVE HOY-HHOY(03:02)         TO WSS-HOR-MSIS.           MOVE WCC-DOSPTO              TO WSS-GLS-H2SI.           MOVE HOY-HHOY(05:02)         TO WSS-HOR-SSIS.           MOVE HOY-FHOY(01:02)         TO WSS-FEC-DSIS.           MOVE HOY-FHOY(03:02)         TO WSS-FEC-MSIS.           MOVE WCC-GUION               TO WSS-GLS-F1SI.           MOVE HOY-FHOY(05:02)         TO WSS-FEC-SSIS.           MOVE WCC-GUION               TO WSS-GLS-F2SI.           MOVE HOY-FHOY(07:02)         TO WSS-FEC-ASIS.           DISPLAY '-------------------------------------------------'.           DISPLAY '               ESTADISTILGS                    '.           DISPLAY '-------------------------------------------------'.           DISPLAY '  PROGRAMA       :  GNSPBLMT'.           DISPLAY '  VERSION        :  V1.0'.           DISPLAY '  FEC. EJECUCION : ' WSS-FEC-FSIS.           DISPLAY '  HORA EJECUCION : ' WSS-HOR-FSIS.           DISPLAY '-------------------------------------------------'.           DISPLAY ' '.           DISPLAY 'LEIDOS          : ' WSS-NUM-LLGS.           DISPLAY ' '.           DISPLAY 'GRABADOS OKS    : ' WSS-NUM-WLGX-OKS.           DISPLAY 'GRABADOS ERR    : ' WSS-NUM-WLGX-ERR.           DISPLAY ' '.           DISPLAY 'BORRADOS OKS    : ' WSS-NUM-DLGM-OKS.           DISPLAY 'BORRADOS ERR    : ' WSS-NUM-DLGM-ERR.           DISPLAY ' '.           DISPLAY '-------------------------------------------------'.       FIN-ESTADISTILGS.           EXIT.      *---------------------------------------------------------------*      * OTROS COPYS UTILIZADOS EN EL PROGRAMA                         *      *---------------------------------------------------------------*       COPY  GNSBGDTC.       COPY  GNSBGIDD.       COPY  GNSBGEND.       COPY  GNSBGABT.       COPY  GNSBGHOY.       COPY  GNSBGFEC.       COPY  GNSBPFEC.       COPY  GNSBFTAB.       COPY  GNSBFMSC.       COPY  GNSBFMSG.       COPY  GNSBBMSG.       COPY  GNSBBMSC.       COPY  GNSBBTAB.       COPY  GNSBBSYS.       COPY  GNSBTABT.       COPY  GNSBFLGX.       COPY  GNSBFLGM.       COPY  GNSBFLGS.      *---------------------------------------------------------------*      *                        FIN DEL PROGRAMA                       *      *---------------------------------------------------------------*