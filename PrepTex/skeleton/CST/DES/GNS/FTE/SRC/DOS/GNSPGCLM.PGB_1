       IDENTIFICATION DIVISION.      *=======================       PROGRAM-ID.      GNSPGCLM.       AUTHOR.          BEE-TEAM - KATHERINE ALARCON GIADACH.       DATE-WRITTEN     24-SEP-2013.      *-----------------------------------------------------------------      *  MODIFICACIONES:      *  ---------------      *  AUTOR      : KATHERINE ALARCON GIADACH      *  FECHA      : 2013-10-02       *  ETIQUETA   : Cima-INI 02-OCT-2013 LOG MTI      *  PROYECTO   : Log MTI      *  OBJETIVO   : CONFIGURA TABLAS PARAMETROS LOG BATCH      *-----------------------------------------------------------------      * ENTRADA    : REGISTROS DE TABLAS 'VDS' INGRESADAS COMO PARAMETROS      *            --------------------------------------------------      * SALIDA     : TABBLA DTC VDS ACTUALIZADA      *      * PARAMETROS : LNK-FEC-FPRO = FECHA DE PROCESO      *              REGISTRO DE TABLA VDS EN FORMATO      *              LNK-ACC-TAB0 = REGISTRO ENCABEZADO      *              LNK-ACC-TAB1 = REGISTRO TAB ( 001-060 )      *              LNK-ACC-TAB2 = REGISTRO TAB ( 061-120 )       *              LNK-ACC-TAB3 = REGISTRO TAB ( 121-180 )       *              LNK-ACC-TAB4 = REGISTRO TAB ( 181-196 )       *                     *==============================================================       ENVIRONMENT DIVISION.      *====================       CONFIGURATION SECTION.       SPECIAL-NAMES.      *        DECIMAL-POINT IS COMMA.       DATA DIVISION.      *=============       WORKING-STORAGE SECTION.      *------------------------       77  WSS-TAG-GNSPGCLM PIC X(0125) VALUE           '<IDNPGM NOM=$GNSPGCLM$ VSN=$13.10.20$ GEN=$20-10-13      -    '19:36$ FNC=$LOGMTI$/>'.      *---------------------------------------------------------------*      * OTRAS ENTIDADES UTILIZADAS EN EL PROGRAMA                     *      *---------------------------------------------------------------*       COPY GNSBRTAB.       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.       COPY GNSBRMSG.       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.       COPY GNSBRMSC.       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.      *---------------------------------------------------------------*      * OTROS COPYS UTILIZADOS EN EL PROGRAMA                         *      *---------------------------------------------------------------*       COPY GNSWGRQA.       COPY GNSWGUIB.       COPY GNSWGELS.       COPY GNSWVIDD.       COPY GNSWCFIO.       COPY GNSWVFIO.       COPY GNSWCVRF.       COPY GNSWVVRF.       COPY GNSWGSYS.       COPY GNSWGCPT.       COPY GNSWGFEC.       COPY GNSWGHOY.       COPY GNSWGPES.       COPY GNSWGIDC.       COPY GNSWGCVT.       COPY GNSWGCLM.      *---------------------------------------------------------------*      * VARIABLES AUXILIARES UTILIZADAS EN EL PROGRAMA                *      *---------------------------------------------------------------*       01  WSS-VARIABLES.           05 WSS-NUM-WTAB              PIC 9(09) VALUE ZEROES.           05 WSS-NUM-UTAB              PIC 9(09) VALUE ZEROES.           05 WSS-NUM-PRMT              PIC 9(09) VALUE ZEROES.           05 WSS-FEC-FPRO.              10 WSS-FEC-DPRO           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-MPRO           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-SPRO           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-APRO           VALUE  ZEROES  PIC 9(02).           05 WSS-HOR-FSIS.              10 WSS-HOR-HSIS           VALUE  ZEROES  PIC 9(02).              10 WSS-GLS-H1SI           VALUE  ZEROES  PIC X(01).              10 WSS-HOR-MSIS           VALUE  ZEROES  PIC 9(02).              10 WSS-GLS-H2SI           VALUE  ZEROES  PIC X(01).              10 WSS-HOR-SSIS           VALUE  ZEROES  PIC 9(02).           05 WSS-FEC-FSIS.              10 WSS-FEC-DSIS           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-MSIS           VALUE  ZEROES  PIC 9(02).              10 WSS-GLS-F1SI           VALUE  ZEROES  PIC X(01).              10 WSS-FEC-SSIS           VALUE  ZEROES  PIC 9(02).              10 WSS-GLS-F2SI           VALUE  ZEROES  PIC X(01).              10 WSS-FEC-ASIS           VALUE  ZEROES  PIC 9(02).           05 WSS-FEC-FAU1.              10 WSS-FEC-SAU1           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-AAU1           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-MAU1           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-DAU1           VALUE  ZEROES  PIC 9(02).           05 WSS-FEC-FAU2.              10 WSS-FEC-SAU2           VALUE  ZEROES  PIC 9(02).              10 WSS-FEC-AAU2           VALUE  ZEROES  PIC 9(02).              10 WSS-GLS-1AU2           VALUE  ZEROES  PIC X(01).              10 WSS-FEC-MAU2           VALUE  ZEROES  PIC 9(02).              10 WSS-GLS-2AU2           VALUE  ZEROES  PIC X(01).              10 WSS-FEC-DAU2           VALUE  ZEROES  PIC 9(02).           05 WSS-LNK-ITAB.              10 WSS-LNK-TAB1.                 15  WSS-LNK-FLAG       VALUE  SPACES  PIC X(01).                 15  WSS-LNK-TTAB       VALUE  SPACES  PIC X(03).                 15  WSS-LNK-CTAB       VALUE  SPACES  PIC X(12).                 15  WSS-LNK-FI01       VALUE  SPACES  PIC X(15).                 15  WSS-LNK-CVIG       VALUE  SPACES  PIC X(01).                 15  WSS-LNK-FI02       VALUE  SPACES  PIC X(28).              10 WSS-LNK-TAB2.                 15  WSS-LNK-FI03       VALUE  SPACES  PIC X(60).              10 WSS-LNK-TAB3.                 15  WSS-LNK-FI04       VALUE  SPACES  PIC X(09).                 15  WSS-LNK-LGMG       VALUE  SPACES  PIC X(01).                 15  WSS-LNK-LGMV       VALUE  SPACES  PIC X(01).                 15  WSS-LNK-REST       VALUE  SPACES  PIC X(49).              10 WSS-LNK-TAB4.                 15  WSS-LNK-FI05       VALUE  SPACES  PIC X(60).      *---------------------------------------------------------------*      * DEFINICION DE CONSTANTES                                      *      *---------------------------------------------------------------*       01  WSS-CONSTANTES.           05 WCC-1                     PIC 9(01) VALUE 1.           05 WCC-2                     PIC 9(01) VALUE 2.           05 WCC-3                     PIC 9(01) VALUE 3.           05 WCC-S                     PIC X(01) VALUE 'S'.           05 WCC-N                     PIC X(01) VALUE 'N'.           05 WCC-L                     PIC X(01) VALUE 'L'.           05 WCC-GNSPGCLM              PIC X(08) VALUE 'GNSPGCLM'.           05 WCC-FIN-PRMT              PIC X(08) VALUE 'FIN-PRMT'.           05 WCC-DOSPTO                PIC X(01) VALUE ':'.           05 WCC-GUION                 PIC X(01) VALUE '-'.           05 WCC-VDS                   PIC X(03) VALUE 'VDS'.      *---------------------------------------------------------------*      * DEFINICION DE SWITCHS                                         *      *---------------------------------------------------------------*       01  SWT-SWITCHS.           05 SWT-EOF-PRMT        PIC X(01) VALUE 'N'.              88 SI-EOF-PRMT      VALUE 'S'.              88 NO-EOF-PRMT      VALUE 'N'.           05 SWT-ERR-PRMT        PIC X(01) VALUE 'N'.              88 SI-ERR-PRMT      VALUE 'S'.              88 NO-ERR-PRMT      VALUE 'N'.           05 SWT-UPD-ITAB        PIC X(01) VALUE 'N'.              88 SI-UPD-ITAB      VALUE 'S'.              88 NO-UPD-ITAB      VALUE 'N'.           05 SWT-GRB-ITAB        PIC X(01) VALUE 'N'.              88 SI-GRB-ITAB      VALUE 'S'.              88 NO-GRB-ITAB      VALUE 'N'.      *---------------------------------------------------------------*      * PARAMETROS DE ENTRADA                                         *      *---------------------------------------------------------------*       01  LNK-ENT-PRMT.           05 LNK-FEC-FPRO.              10 LNK-FEC-SPRO           PIC  9(02) VALUE ZEROES.              10 LNK-FEC-APRO           PIC  9(02) VALUE ZEROES.              10 LNK-FEC-MPRO           PIC  9(02) VALUE ZEROES.              10 LNK-FEC-DPRO           PIC  9(02) VALUE ZEROES.           05 LNK-REG-ITAB VALUE SPACES.              10 LNK-ACC-TAB1.                 15 LNK-ACC-TAB1-01     PIC  X(01).                 15 LNK-ACC-TAB1-02     PIC  X(01).                 15 LNK-ACC-TAB1-03     PIC  X(01).                 15 LNK-ACC-TAB1-04     PIC  X(57).                               10 LNK-ACC-TAB2           PIC  X(60).              10 LNK-ACC-TAB3           PIC  X(60).              10 LNK-ACC-TAB4           PIC  X(60).       01  LNK-ACC-TAB0                      VALUE SPACES.           05 LNK-ACC-TAB0-REGTAB       PIC  X(06).           05 LNK-ACC-TAB0-SIST         PIC  X(03).       01  LNK-CTE-TAB0-REGTAB    VALUE 'REGTAB'  PIC X(06).      *---------------------------------------------------------------*      *                       PROCEDURE DIVISION                      *      *---------------------------------------------------------------*       PROCEDURE DIVISION.      *-------------------       MAIN SECTION.       INI-MAIN.           COPY     GNSBGEDB.           MOVE     WCC-GNSPGCLM        TO FIO-PROG.           PERFORM  GNS-BUS-IDD.           PERFORM  GET-FHOY.           DISPLAY WSS-TAG-GNSPGCLM.                      PERFORM  ACC-FECH.           PERFORM  PRO-PPAL            UNTIL SI-EOF-PRMT.           PERFORM  ESTADISTICAS.           PERFORM  GNS-PRO-END.       FIN-MAIN.           EXIT.      *--------------------------------------------------------------*      *                       PROCEDURE DIVISION                     *      *--------------------------------------------------------------*      *--------------------------------------------------------------*      *                        PROCESO PRINCIPAL                     *      *--------------------------------------------------------------*       PRO-PPAL SECTION.      *-----------------       INI-PRO-PPAL.      *-------------       LUP-PPAL.           PERFORM  ACC-FMT-TAB.           PERFORM  VAL-PARM.           IF  SI-EOF-PRMT AND SI-EOF-PRMT               GO TO FIN-PRO-PPAL.           ADD WCC-1                    TO WSS-NUM-PRMT.           IF  NO-ERR-PRMT               PERFORM PRO-LMTI.       NXT-PPAL.           GO TO LUP-PPAL.       FIN-PRO-PPAL.           EXIT.      *--------------------------------------------------------------*      * ACEPTA PARAMETROS DE ENTRADA                                 *      *--------------------------------------------------------------*       ACC-FECH SECTION.       INI-ACC-FECH.      *-------------           ACCEPT LNK-FEC-FPRO.           PERFORM VAL-FECH.       FIN-ACC-FECH.           EXIT.      *--------------------------------------------------------------*      * VALIDA PARAMETROS FECHA                                      *      *--------------------------------------------------------------*       VAL-FECH SECTION.       INI-VAL-FECH.      *-------------           DISPLAY '-------------------------------------------------'.           DISPLAY '          INICIO CAPTURA DE PARAMETROS'.           DISPLAY '-------------------------------------------------'.           DISPLAY 'FECHA PROCESO  SSAAMMDD!    : ' LNK-FEC-FPRO.           DISPLAY '-------------------------------------------------'.      *--------------------------------------------------------------*      * VALIDA FECHA PROCESO                                         *      *--------------------------------------------------------------*           IF  LNK-FEC-FPRO NOT > ZEROES OR               LNK-FEC-FPRO IS NOT NUMERIC               DISPLAY 'PARAMETRO - FECHA PROCESO - NO VALIDO'               DISPLAY '        SE CANCELA EL PROCESO       '               PERFORM GNS-PRO-ABT.           MOVE LNK-FEC-DPRO            TO WSS-FEC-DPRO.           MOVE LNK-FEC-MPRO            TO WSS-FEC-MPRO.           MOVE LNK-FEC-SPRO            TO WSS-FEC-SPRO.           MOVE LNK-FEC-APRO            TO WSS-FEC-APRO.           MOVE WSS-FEC-FPRO            TO FEC-FECH.           MOVE FEC-FORM-FEC            TO FEC-FORM.           MOVE FEC-FBLK-S              TO FEC-FBLK.           MOVE FEC-CHOY-N              TO FEC-CHOY.           MOVE FEC-VHBL-N              TO FEC-VHBL.           MOVE FEC-VAL-FEC             TO FEC-CMND.           PERFORM PRO-FEC.           IF  NOT FEC-STAT-OKS               DISPLAY FEC-MENS               DISPLAY 'PARAMETRO - FECHA PROCESO - NO VALIDO'               DISPLAY 'SE CANCELA EL PROCESO ' LNK-FEC-FPRO               PERFORM GNS-PRO-ABT.       FIN-VAL-FECH.           EXIT.      *--------------------------------------------------------------*      * ACEPTA PARAMETROS DE ENTRADA                                 *      *--------------------------------------------------------------*       ACC-FMT-TAB SECTION.       INI-ACC-FMT-TAB.      *-------------           ACCEPT LNK-ACC-TAB0.           IF  LNK-ACC-TAB0 = WCC-FIN-PRMT               SET SI-EOF-PRMT TO TRUE               GO TO FIN-ACC-FMT-TAB.           IF LNK-ACC-TAB0-REGTAB NOT = LNK-CTE-TAB0-REGTAB               DISPLAY 'ERROR EN SECUENCIA REGTAB'               DISPLAY LNK-ACC-TAB0               PERFORM GNS-PRO-ABT.                      ACCEPT LNK-ACC-TAB1.           ACCEPT LNK-ACC-TAB2.           ACCEPT LNK-ACC-TAB3.           ACCEPT LNK-ACC-TAB4.       FIN-ACC-FMT-TAB.           EXIT.      *--------------------------------------------------------------*      * VALIDA PARAMETROS DE ENTRADA                                 *      *--------------------------------------------------------------*       VAL-PARM SECTION.       INI-VAL-PARM.      *-------------           SET  NO-ERR-PRMT             TO TRUE.           MOVE LNK-ACC-TAB1            TO WSS-LNK-TAB1.           MOVE LNK-ACC-TAB2            TO WSS-LNK-TAB2.           MOVE LNK-ACC-TAB3            TO WSS-LNK-TAB3.           MOVE LNK-ACC-TAB4            TO WSS-LNK-TAB4.      *--------------------------------------------------------------*      * VALIDA INDICADOR DE PROCESO / REPROCESO                      *      *--------------------------------------------------------------*           IF  LNK-ACC-TAB1 NOT EQUAL WCC-FIN-PRMT               IF  WSS-LNK-TTAB NOT EQUAL WCC-VDS                   SET  SI-ERR-PRMT     TO TRUE                   DISPLAY '-------------------------------'                   DISPLAY ' LA TABLA SOLO PUEDE SER VDS   '                   DISPLAY '     MODIFICAR PARAMETROS      '                   DISPLAY ' TIPO TABLA   :  ' WSS-LNK-TTAB                   DISPLAY ' CODIGO TABLA :  ' WSS-LNK-CTAB                   DISPLAY '-------------------------------'.           IF  LNK-ACC-TAB1-02 NOT EQUAL WCC-FIN-PRMT               IF  WSS-LNK-LGMG NOT EQUAL SPACES AND                   WSS-LNK-LGMG NOT EQUAL WCC-S  AND                   WSS-LNK-LGMG NOT EQUAL WCC-N  AND                   WSS-LNK-LGMG NOT EQUAL WCC-L                   SET  SI-ERR-PRMT     TO TRUE                   DISPLAY '-------------------------------'                   DISPLAY ' INDICADOR LOG PUEDE SER       '                   DISPLAY '  /S/N/L - FAVOR REVISAR       '                   DISPLAY ' INDICADOR    :  ' WSS-LNK-LGMG                   DISPLAY '-------------------------------'.           IF  LNK-ACC-TAB1-03 NOT EQUAL WCC-FIN-PRMT               IF  WSS-LNK-LGMV NOT EQUAL WCC-S  AND                   WSS-LNK-LGMV NOT EQUAL WCC-N                   SET  SI-ERR-PRMT     TO TRUE                   DISPLAY '-------------------------------'                   DISPLAY ' INDICADOR LOG SND PUEDE SER   '                   DISPLAY '  S/N! - FAVOR REVISAR         '                   DISPLAY ' INDICADOR    :  ' WSS-LNK-LGMV                   DISPLAY '-------------------------------'.       FIN-VAL-PARM.           EXIT.      *--------------------------------------------------------------*      * PROCESA LOG MTI                                              *      *--------------------------------------------------------------*       PRO-LMTI SECTION.       INI-PRO-LMTI.      *-------------           MOVE LNK-ACC-TAB1            TO WSS-LNK-TAB1.           MOVE LNK-ACC-TAB2            TO WSS-LNK-TAB2.           MOVE LNK-ACC-TAB3            TO WSS-LNK-TAB3.           MOVE LNK-ACC-TAB4            TO WSS-LNK-TAB4.           PERFORM LEE-ITAB.           PERFORM CHK-PNT.       FIN-PRO-LMTI.           EXIT.      *--------------------------------------------------------------*      * LEER ENTIDAD TAB                                             *      *--------------------------------------------------------------*       LEE-ITAB SECTION.       INI-LEE-ITAB.      *-------------           MOVE LNK-ACC-TAB0-SIST       TO FIO-SIST.           MOVE FIO-GET-KEY             TO FIO-CMND.           MOVE WCC-VDS                 TO TAB-COD-TTAB.           MOVE WSS-LNK-CTAB            TO TAB-COD-CTAB.           PERFORM GNS-FIO-TAB.           IF  NOT FIO-STAT-OKS               PERFORM GRB-ITAB           ELSE               PERFORM UPD-ITAB.       FIN-LEE-ITAB.           EXIT.      *--------------------------------------------------------------*      * GRABA ENTIDAD TAB                                            *      *--------------------------------------------------------------*       GRB-ITAB SECTION.       INI-GRB-ITAB.      *-------------           MOVE FIO-PUT                 TO FIO-CMND.           MOVE LNK-ACC-TAB0-SIST       TO FIO-SIST.           MOVE LNK-REG-ITAB            TO TAB.           PERFORM GNS-FIO-TAB.           IF  FIO-STAT-OKS               ADD WCC-1 TO WSS-NUM-WTAB               SET SI-GRB-ITAB TO TRUE           ELSE               SET NO-GRB-ITAB TO TRUE               GO TO FIN-GRB-ITAB.       FIN-GRB-ITAB.           EXIT.      *--------------------------------------------------------------*      * UPDATE TABLA VDS EN TAB                                      *      *--------------------------------------------------------------*       UPD-ITAB SECTION.       INI-UPD-ITAB.      *-------------           MOVE LNK-ACC-TAB0-SIST       TO FIO-SIST.           MOVE FIO-GET-KEY-UPD         TO FIO-CMND.           MOVE WCC-VDS                 TO TAB-COD-TTAB.           MOVE WSS-LNK-CTAB            TO TAB-COD-CTAB.           PERFORM GNS-FIO-TAB.           IF  FIO-STAT-OKS               MOVE WSS-LNK-LGMG        TO TAB-COD-DAT1(WCC-2)               MOVE WSS-LNK-LGMV        TO TAB-COD-DAT1(WCC-3)               MOVE LNK-ACC-TAB0-SIST   TO FIO-SIST               MOVE FIO-MOD             TO FIO-CMND               PERFORM GNS-FIO-TAB               IF  FIO-STAT-OKS                   ADD WCC-1            TO WSS-NUM-UTAB                   SET SI-UPD-ITAB      TO TRUE               ELSE                   SET NO-UPD-ITAB      TO TRUE                   GO TO FIN-UPD-ITAB.           IF  NOT FIO-STAT-OKS               GO TO FIN-UPD-ITAB.       FIN-UPD-ITAB.           EXIT.      *--------------------------------------------------------------*      * CHECK POINT A LA BASE DE DATOS                               *      *--------------------------------------------------------------*       CHK-PNT SECTION.       INI-CHK-PNT.           MOVE LNK-ACC-TAB0-SIST       TO FIO-SIST.           MOVE FIO-CHK-PNT             TO FIO-CMND.           PERFORM GNS-FIO-TAB.           IF  NOT FIO-STAT-OKS               DISPLAY 'CHECK-POINT ERRONEO'.       FIN-CHK-PNT.           EXIT.      *---------------------------------------------------------------*      *                    ESTADISTICAS DEL PROGRAMA                  *      *---------------------------------------------------------------*       ESTADISTICAS SECTION.       INI-ESTADISTICAS.           MOVE HOY-HHOY(01:02)         TO WSS-HOR-HSIS.           MOVE WCC-DOSPTO              TO WSS-GLS-H1SI.           MOVE HOY-HHOY(03:02)         TO WSS-HOR-MSIS.           MOVE WCC-DOSPTO              TO WSS-GLS-H2SI.           MOVE HOY-HHOY(05:02)         TO WSS-HOR-SSIS.           MOVE HOY-FHOY(01:02)         TO WSS-FEC-DSIS.           MOVE HOY-FHOY(03:02)         TO WSS-FEC-MSIS.           MOVE WCC-GUION               TO WSS-GLS-F1SI.           MOVE HOY-FHOY(05:02)         TO WSS-FEC-SSIS.           MOVE WCC-GUION               TO WSS-GLS-F2SI.           MOVE HOY-FHOY(07:02)         TO WSS-FEC-ASIS.           DISPLAY '-------------------------------------------------'.           DISPLAY '               ESTADISTICAS                    '.           DISPLAY '-------------------------------------------------'.           DISPLAY '  PROGRAMA       :  GNSPGCLM'.           DISPLAY '  VERSION        :  V1.0'.           DISPLAY '  FEC. EJECUCION : ' WSS-FEC-FSIS.           DISPLAY '  HORA EJECUCION : ' WSS-HOR-FSIS.           DISPLAY '-------------------------------------------------'.           DISPLAY 'GRABADOS        : ' WSS-NUM-WTAB.           DISPLAY 'ACTUALIZADOS    : ' WSS-NUM-UTAB.           DISPLAY '-------------------------------------------------'.       FIN-ESTADISTICAS.           EXIT.      *---------------------------------------------------------------*      * OTROS COPYS UTILIZADOS EN EL PROGRAMA                         *      *---------------------------------------------------------------*       COPY  GNSBGDTC.       COPY  GNSBGIDD.       COPY  GNSBGEND.       COPY  GNSBGABT.       COPY  GNSBGHOY.       COPY  GNSBGFEC.       COPY  GNSBPFEC.       COPY  GNSBGPES.       COPY  GNSBGCPT.       COPY  GNSBFTAB.       COPY  GNSBFMSC.       COPY  GNSBFMSG.       COPY  GNSBBMSG.       COPY  GNSBBMSC.       COPY  GNSBBTAB.       COPY  GNSBBSYS.       COPY  GNSBTABT.      *---------------------------------------------------------------*      *                        FIN DEL PROGRAMA                       *      *---------------------------------------------------------------*