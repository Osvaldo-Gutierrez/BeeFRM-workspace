       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID. HLPPAG02.
       AUTHOR. CONSIST.
       DATE-WRITTEN.     26-MAR-1993 19:04:38 
      *  PROCESO :
      *  26-MAR-1993 
      *
      * ENGANCHA CAMPO A HELP

       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
                     DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *==============

       WORKING-STORAGE SECTION.
      *------------------------
       COPY GNSWVSCR.
       COPY GNSWCSCR.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGHOY.
       COPY GNSWGFRM.
       COPY GNSWGSYS.
       COPY DFHBMSCA.
       01  HLPG02CI.
           02  FILLER PIC X(12).
           02  FECHACL    COMP  PIC  S9(4).
           02  FECHACF    PICTURE X.
           02  FILLER REDEFINES FECHACF.
             03 FECHACA    PICTURE X.
           02  FECHACI  PIC X(10).

           02  NUMBDAL    COMP  PIC  S9(4).
           02  NUMBDAF    PICTURE X.
           02  FILLER REDEFINES NUMBDAF.
             03 NUMBDAA    PICTURE X.
           02  NUMBDAI  PIC X(3).

           02  NOMTABL    COMP  PIC  S9(4).
           02  NOMTABF    PICTURE X.
           02  FILLER REDEFINES NOMTABF.
             03 NOMTABA    PICTURE X.
           02  NOMTABI  PIC X(3).

           02  BUSGENL    COMP  PIC  S9(4).
           02  BUSGENF    PICTURE X.
           02  FILLER REDEFINES BUSGENF.
             03 BUSGENA    PICTURE X.
           02  BUSGENI  PIC X(1).
      *           02  NOMTEXL    COMP  PIC  S9(4).
      *           02  NOMTEXF    PICTURE X.
      *           02  FILLER REDEFINES NOMTEXF.
      *             03 NOMTEXA    PICTURE X.
      *           02  NOMTEXI  PIC X(5).
      *           02  NOMARCL    COMP  PIC  S9(4).
      *           02  NOMARCF    PICTURE X.
      *           02  FILLER REDEFINES NOMARCF.
      *             03 NOMARCA    PICTURE X.
      *           02  NOMARCI  PIC X(7).
      *           02  NOMPGML    COMP  PIC  S9(4).
      *           02  NOMPGMF    PICTURE X.
      *           02  FILLER REDEFINES NOMPGMF.
      *             03 NOMPGMA    PICTURE X.
      *           02  NOMPGMI  PIC X(8).
           02  MSGCL    COMP  PIC  S9(4).
           02  MSGCF    PICTURE X.
           02  FILLER REDEFINES MSGCF.
             03 MSGCA    PICTURE X.
           02  MSGCI  PIC X(60).
       01  HLPG02CO REDEFINES HLPG02CI.
           02  FILLER PIC X(12).
           02  FILLER PICTURE X(3).
           02  FECHACO  PIC X(10).
           02  FILLER PICTURE X(3).
           02  NUMBDAO  PIC X(3).
           02  FILLER PICTURE X(3).
           02  NOMTABO  PIC X(3).
           02  FILLER PICTURE X(3).
           02  BUSGENO  PIC X(1).
      *           02  FILLER PICTURE X(3).
      *           02  NOMTEXO  PIC X(5).
      *           02  FILLER PICTURE X(3).
      *           02  NOMARCO  PIC X(7).
      *           02  FILLER PICTURE X(3).
      *           02  NOMPGMO  PIC X(8).
           02  FILLER PICTURE X(3).
           02  MSGCO  PIC X(60).
       01  HLPG02AI REDEFINES HLPG02CI.
           02  FILLER PIC X(12).
           02  FECHAAL    COMP  PIC  S9(4).
           02  FECHAAF    PICTURE X.
           02  FILLER REDEFINES FECHAAF.
             03 FECHAAA    PICTURE X.
           02  FECHAAI  PIC X(10).

           02  NOMMAPL    COMP  PIC  S9(4).
           02  NOMMAPF    PICTURE X.
           02  FILLER REDEFINES NOMMAPF.
             03 NOMMAPA    PICTURE X.
           02  NOMMAPI  PIC X(7).

           02  NOMSETL    COMP  PIC  S9(4).
           02  NOMSETF    PICTURE X.
           02  FILLER REDEFINES NOMSETF.
             03 NOMSETA    PICTURE X.
           02  NOMSETI  PIC X(7).

           02  TIPHLPL    COMP  PIC  S9(4).
           02  TIPHLPF    PICTURE X.
           02  FILLER REDEFINES TIPHLPF.
             03 TIPHLPA    PICTURE X.
           02  TIPHLPI  PIC X(1).

           02  MSGAL    COMP  PIC  S9(4).
           02  MSGAF    PICTURE X.
           02  FILLER REDEFINES MSGAF.
             03 MSGAA    PICTURE X.
           02  MSGAI  PIC X(60).
       01  HLPG02AO REDEFINES HLPG02AI.
           02  FILLER PIC X(12).
           02  FILLER PICTURE X(3).
           02  FECHAAO  PIC X(10).
           02  FILLER PICTURE X(3).
           02  NOMMAPO  PIC X(7).
           02  FILLER PICTURE X(3).
           02  NOMSETO  PIC X(7).
           02  FILLER PICTURE X(3).
           02  TIPHLPO  PIC X(1).
           02  FILLER PICTURE X(3).
           02  MSGAO  PIC X(60).
       01  HLPG02DI REDEFINES HLPG02CI.
           02  FILLER PIC X(12).
           02  FECHADL    COMP  PIC  S9(4).
           02  FECHADF    PICTURE X.
           02  FILLER REDEFINES FECHADF.
             03 FECHADA    PICTURE X.
           02  FECHADI  PIC X(10).
           02  NOMMISL    COMP  PIC  S9(4).
           02  NOMMISF    PICTURE X.
           02  FILLER REDEFINES NOMMISF.
             03 NOMMISA    PICTURE X.
           02  NOMMISI  PIC X(4).
           02  MSGDL    COMP  PIC  S9(4).
           02  MSGDF    PICTURE X.
           02  FILLER REDEFINES MSGDF.
             03 MSGDA    PICTURE X.
           02  MSGDI  PIC X(60).
       01  HLPG02DO REDEFINES HLPG02DI.
           02  FILLER PIC X(12).
           02  FILLER PICTURE X(3).
           02  FECHADO  PIC X(10).
           02  FILLER PICTURE X(3).
           02  NOMMISO  PIC X(4).
           02  FILLER PICTURE X(3).
           02  MSGDO  PIC X(60).
       01  HLPG02BI REDEFINES HLPG02CI.
           02  FILLER PIC X(12).
           02  MSGBL    COMP  PIC  S9(4).
           02  MSGBF    PICTURE X.
           02  FILLER REDEFINES MSGBF.
             03 MSGBA    PICTURE X.
           02  MSGBI  PIC X(60).
       01  HLPG02BO REDEFINES HLPG02BI.
           02  FILLER PIC X(12).
           02  FILLER PICTURE X(3).
           02  MSGBO  PIC X(60).
       01  WSS-DSP2   VALUE '22222' PIC X(05).
       01  VARIABLES.
           03 WSS-FEC-FHOY.
              05 WSS-NUM-DHOY                PIC 9(02).
              05 FILLER                      PIC X(01) VALUE '/'.
              05 WSS-NUM-MHOY                PIC 9(02).
              05 FILLER                      PIC X(01) VALUE '/'.
              05 WSS-NUM-SHOY                PIC 9(02).
              05 WSS-NUM-AHOY                PIC 9(02).
           02 L-CMAREA         PIC S9(4) COMP VALUE +66.
           02 L-ARC            PIC S9(4) COMP VALUE +54.
           02 L-MEN            PIC S9(4) COMP VALUE +50.
           02 WS-MAPA          PIC X(7).
           02 WS-MSET          PIC X(7).

      *ISP 17-07-90
       01  WSS-VARI.
           03  WSS-CCOD        VALUE SPACES PIC X(05).
               88 WSS-CCOD-APCT    VALUE 'APCT'.
               88 WSS-CCOD-ABM0    VALUE 'ABM0'.

      * VARIABLES MANEJO DE MAPAS Y TRANSACCIONES
      * -----------------------------------------
       01  FRM-VARI.
      * VERSION GNS
      *    02 FRMAMAP      PIC X(07) VALUE 'GNSADDH'.
      *    02 FRMFMAP      PIC X(07) VALUE 'GNSFDDH'.
      *    02 FRMGMAP      PIC X(07) VALUE 'GNSGDDH'.
      *    02 FRMHMAP      PIC X(07) VALUE 'GNSHDDH'.
      *    02 FRMIMAP      PIC X(07) VALUE 'GNSIDDH'.
      *    02 FRMTRAN      PIC X(04) VALUE 'GS60'.
      * VERSION HLP
           02 FRMAMAP      PIC X(07) VALUE 'HLPAG02'.
           02 FRMFMAP      PIC X(07) VALUE 'HLPG02A'.
           02 FRMGMAP      PIC X(07) VALUE 'HLPG02B'.
           02 FRMHMAP      PIC X(07) VALUE 'HLPG02C'.
           02 FRMIMAP      PIC X(07) VALUE 'HLPG02D'.
           02 FRMTRAN      PIC X(04) VALUE 'HL02'.
       01  WSS-DSP3   VALUE '33333' PIC X(05).
       COPY GNSBRHLP.
       01  CMAREA.
           02 SWERROR          PIC X.
           02 ESTADO           PIC 9.
           02 CM-MAPA          PIC X(7).
           02 CM-THLP          PIC X(1).
           02 CM-POSI          PIC 9(4).
           02 CM-NUMBD         PIC X(3).
           02 CM-TABLA         PIC X(3).
           02 CM-MISC          PIC X(4).
           02 CM-PROG          PIC X(8).
           02 CM-CMAPA         PIC X(7).
           02 CM-CMSET         PIC X(7).
           02 CM-GENE          PIC X(1).
           02 CM-NTEX          PIC X(4).
           02 CM-ARCH          PIC X(7).
           02 CM-NPGM          PIC X(8).
       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 FILLER           PIC X(66).
       COPY GNSLGFIO.
       PROCEDURE DIVISION.
      *===================
           MOVE LOW-VALUES TO HLPG02AI
                              HLPG02AO
                              HLPG02BI
                              HLPG02BO
                              HLPG02CI
                              HLPG02CO
                              HLPG02DI
                              HLPG02DO.

           PERFORM GNS-HDL-VSM.
           MOVE 'I' TO NUMBDAA
                       NOMTABA
                       BUSGENA.
      *                 NOMPGMA.
           EXEC CICS HANDLE AID
                               CLEAR(TERMINAR)
                               END-EXEC.
           EXEC CICS HANDLE ABEND
                     LABEL (CMN-ERR-ABN)
           END-EXEC.
           IF EIBCALEN = 0
                PERFORM PRIMERA-VEZ
           ELSE
                MOVE DFHCOMMAREA TO CMAREA
                PERFORM VEZ-SIGUIENTE.

       PRIMERA-VEZ.
      *------------
           MOVE SPACES         TO CM-MISC.
           MOVE LOW-VALUES     TO HLPG02AI.
           MOVE SPACES TO NOMMAPI
                          NOMSETI
                          TIPHLPI.         
           PERFORM PUT-FHOY.
           MOVE -1 TO NOMMAPL.
           MOVE 'INGRESE NOMBRE DEL MAPA, MAPSET Y TIPO AYUDA' TO MSGAI.
           PERFORM INIC-FRM.

       ENVIAR-MAPA-COMPLETO.
      *---------------------
           EXEC CICS SEND      MAP(WS-MAPA)
                               MAPSET(WS-MSET)
                               FROM(HLPG02AI) CURSOR
                               ERASE
           END-EXEC.
       INIC-FRM.
      *--------
           MOVE FRMFMAP        TO WS-MAPA CM-CMAPA.
           MOVE FRMAMAP        TO WS-MSET CM-CMSET.
           MOVE 1              TO ESTADO.
           MOVE SPACES         TO CM-NPGM.
           PERFORM ENVIAR-MAPA-COMPLETO.
           PERFORM AUTO-INVOC.

       ENVIAR-MAPA-DATOS.
      *------------------
           EXEC CICS SEND      MAP(WS-MAPA)
                               MAPSET(WS-MSET)
                               FROM(HLPG02AI) CURSOR
                               DATAONLY
           END-EXEC.
       AUTO-INVOC.
      *-----------
           EXEC CICS RETURN    TRANSID(FRMTRAN)
                               COMMAREA(CMAREA)
                               LENGTH(L-CMAREA)
           END-EXEC.
       RECIBIR-MAPA.
      *-------------
           EXEC CICS RECEIVE   MAP(CM-CMAPA) MAPSET(CM-CMSET)
                               INTO(HLPG02AI)
           END-EXEC.
       VEZ-SIGUIENTE.
      *--------------
           PERFORM RECIBIR-MAPA.
           IF EIBAID = FRM-FFLD-PF3 OR FRM-FFLD-PFC
                PERFORM TERMINAR.
           IF EIBAID = FRM-FFLD-PF12 OR FRM-FFLD-PFL
                PERFORM PRIMERA-VEZ.
           GO TO ID-MAPA ID-CAMPO ID-AYUDA ID-MISC  DEPENDING ON ESTADO.
       ID-MAPA.
      *--------
           MOVE '*'            TO SWERROR.
           MOVE SPACES         TO MSGAI.
           MOVE +3 TO NOMMAPL.
           IF NOMMAPI NOT > SPACES
                MOVE 'INGRESE NOMBRE MAPA' TO MSGAI
                MOVE -1 TO NOMMAPL
                MOVE 'I'       TO SWERROR NOMMAPA
           ELSE
           IF NOMSETI NOT > SPACES
                MOVE 'I'       TO SWERROR NOMSETA
                MOVE -1 TO NOMSETL
                MOVE 'INGRESE NOMBRE MAPSET' TO MSGAI
           ELSE
      *     IF TIPHLPI NOT = '1' AND '2'
           IF TIPHLPI NOT = '1'
                MOVE 'I'       TO SWERROR TIPHLPA
                MOVE -1 TO TIPHLPL
                MOVE 'TIPO DEBE SER SOLO 1' TO MSGAI.

           IF SWERROR NOT = '*'
                MOVE  CM-CMAPA TO WS-MAPA
                MOVE  CM-CMSET TO WS-MSET
                PERFORM ENVIAR-MAPA-DATOS
                        THRU AUTO-INVOC.

           MOVE NOMMAPI        TO WS-MAPA CM-MAPA.
           MOVE TIPHLPI        TO CM-THLP.
           MOVE NOMSETI        TO WS-MSET.
           MOVE LOW-VALUES     TO HLPG02AI.
           MOVE 2              TO ESTADO.
           PERFORM ENVIAR-SOLO-MAPA.
           MOVE 'POSICIONE CURSOR SOBRE EL CAMPO Y ENTER' TO MSGBI.
           MOVE '/' TO MSGBF.
           MOVE  FRMGMAP       TO WS-MAPA CM-CMAPA.
           MOVE  FRMAMAP       TO WS-MSET CM-CMSET.
           PERFORM ENVIAR-MAPA-DATOS THRU AUTO-INVOC.

       ENVIAR-SOLO-MAPA.
      *-----------------
           EXEC CICS SEND      MAP(WS-MAPA)
                               MAPSET(WS-MSET)
                               CURSOR
                               MAPONLY
                               ERASE
           END-EXEC.

       NO-MAPA.
      *--------
           MOVE LOW-VALUES     TO HLPG02AI
           PERFORM PUT-FHOY.
           MOVE -1 TO NOMMAPL.
           MOVE 'NOMBRE DE MAPSET O MAPA INCORRECTOS' TO MSGAI.
           MOVE FRMFMAP      TO WS-MAPA CM-CMAPA.
           MOVE FRMAMAP      TO WS-MSET CM-CMSET.
           MOVE 1              TO ESTADO.
           PERFORM ENVIAR-MAPA-COMPLETO.
           PERFORM AUTO-INVOC.
       LEER-DIR.
      *---------
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-HLP.
       F-LDIR.
      *-------
       ID-CAMPO.
      *---------
           MOVE EIBCPOSN       TO CM-POSI.
           MOVE  FRMHMAP       TO WS-MAPA CM-CMAPA.
           MOVE FRMAMAP      TO WS-MSET CM-CMSET.
           MOVE LOW-VALUES     TO HLPG02AI.
           PERFORM PUT-FHOY.
           MOVE CM-MAPA        TO HLP-COD-MAPA.
           MOVE CM-POSI        TO HLP-NUM-POSI.
           PERFORM LEER-DIR THRU F-LDIR.
           IF FIO-STAT-OKS
                PERFORM MOVER-DATOS-EXISTENTES.
           IF CM-THLP = '1'    MOVE 'COMPLETE DATOS DE TABLAS' TO MSGCI
                               MOVE -1 TO NUMBDAL
      *                         MOVE DFHBMASF  TO NOMTEXA NOMARCA
           ELSE                MOVE 'COMPLETE DATOS DE TEXTO' TO MSGCI
      *                         MOVE -1        TO NOMTEXL
                               MOVE DFHBMASF  TO NUMBDAA NOMTABA
                                                 BUSGENA.
           MOVE 3              TO ESTADO.
           PERFORM ENVIAR-MAPA-COMPLETO.
           PERFORM AUTO-INVOC.
       MOVER-DATOS-EXISTENTES.
      *-----------------------
           MOVE HLP-COD-TABL-MSC TO CM-MISC.
           MOVE HLP-IND-GENE  TO CM-GENE.
           MOVE HLP-IND-GENE  TO BUSGENI.
           MOVE HLP-COD-SIST  TO NUMBDAI.
           MOVE HLP-COD-TABL TO NOMTABI.
      *     MOVE HLP-COD-PROG  TO NOMPGMI.

       ID-AYUDA.
      *---------
           MOVE '*'            TO SWERROR.
           MOVE SPACES         TO MSGCI.
           IF CM-THLP = '1'
               PERFORM VALIDAR-TABLAS
           ELSE
               PERFORM VALIDAR-TEXTO.

           IF SWERROR NOT = '*'
                MOVE FRMHMAP TO WS-MAPA
                MOVE FRMAMAP TO WS-MSET
                PERFORM ENVIAR-MAPA-DATOS THRU AUTO-INVOC.
           PERFORM MOVER-A-CMAREA
           IF CM-THLP = '1' AND NOMTABI = 'MSC'
                               MOVE LOW-VALUES     TO HLPG02AI
                               PERFORM PUT-FHOY
                               MOVE FRMIMAP  TO WS-MAPA CM-CMAPA
                               MOVE FRMAMAP  TO WS-MSET CM-CMSET
                               MOVE 4          TO ESTADO
                               MOVE CM-MISC TO NOMMISI
                               MOVE CM-MISC TO NOMMISO
                               PERFORM ENVIAR-MAPA-COMPLETO
                               PERFORM AUTO-INVOC.
           IF EIBAID = FRM-FFLD-PF10 OR FRM-FFLD-PFJ
                               PERFORM REGISTRAR
                               PERFORM PRIMERA-VEZ.
           MOVE FRMHMAP      TO WS-MAPA.
           MOVE FRMAMAP      TO WS-MSET.
           MOVE -1 TO NUMBDAL.
           MOVE 'PRESIONE PF10 PARA REGISTRAR' TO MSGCI.
           PERFORM ENVIAR-MAPA-DATOS THRU AUTO-INVOC.
       VALIDAR-TABLAS.
      *---------------
      *    IF NUMBDAI NOT NUMERIC
      *                        MOVE 'I' TO NUMBDAA SWERROR
      *                        MOVE 'NUMERO DE BASE NO NUMERICO' TO MSGCI
      *    ELSE
      *        IF NUMBDAI NOT > 0
      *                        MOVE 'I' TO NUMBDAA SWERROR
      *                        MOVE 'NUMERO DE BASE INVALIDO' TO MSGCI.
           MOVE +3 TO NUMBDAL.
           IF NUMBDAI NOT > SPACES
                 MOVE 'I' TO NUMBDAA SWERROR
                 MOVE -1 TO NUMBDAL
                 MOVE 'DEBE INGRESAR SISTEMA' TO MSGCI
           ELSE
           IF NOMTABI NOT > SPACES
                 MOVE 'I' TO NOMTABA SWERROR
                 MOVE -1 TO NOMTABL
                 MOVE 'DEBE INGRESAR NOMBRE TABLA' TO MSGCI
           ELSE
           IF NOMTABI = 'USR' AND
              BUSGENI NOT = 'S'
                 MOVE 'I' TO BUSGENA SWERROR
                 MOVE -1 TO BUSGENL
                 MOVE
                 'BUSQUEDA GENERICA DEBE SER S PARA TABLA USR' TO MSGCI
           ELSE
           IF NOMTABI = 'OFI' AND
              BUSGENI NOT = 'S'
                 MOVE 'I' TO BUSGENA SWERROR
                 MOVE -1 TO BUSGENL
                 MOVE
                 'BUSQUEDA GENERICA DEBE SER S PARA TABLA OFI' TO MSGCI
           ELSE
           IF NOMTABI = 'MSC' AND
              BUSGENI NOT = 'N'
                 MOVE 'I' TO BUSGENA SWERROR
                 MOVE -1 TO BUSGENL
                 MOVE
                 'BUSQUEDA GENERICA DEBE SER N PARA TABLA MSC' TO MSGCI
           ELSE
           IF NOT ( BUSGENI = 'S' OR 'N' )
                 MOVE 'I' TO BUSGENA SWERROR
                 MOVE -1 TO BUSGENL
                 MOVE 'RESPUESTA DEBE SER S O N' TO MSGCI
           ELSE
                 MOVE BUSGENI TO CM-GENE.

       VALIDAR-TEXTO.
      *--------------
      *     IF NOMTEXI NOT > SPACES
      *                         MOVE 'I' TO NOMTEXA SWERROR
      *                         MOVE 'DEBE INGRESAR TEXTO' TO MSGCI.
      *     IF NOMARCI NOT > SPACES
      *                         MOVE 'I' TO NOMARCA SWERROR
      *                 IF MSGCI = SPACES
      *                         MOVE 'DEBE INGRESAR NOMBRE ARCHIVO' TO MSGCI.
       MOVER-A-CMAREA.
      *---------------
           IF CM-THLP = '1'    MOVE NUMBDAI TO CM-NUMBD
                               MOVE NOMTABI TO CM-TABLA
                    IF BUSGENI = 'S' AND (NOMTABI = 'USR' OR 'OFI')
                               MOVE 'GNSPHG07'  TO CM-PROG
                    ELSE
                    IF BUSGENI = 'N' AND (NOMTABI = 'USR' OR 'OFI')
                               MOVE 'GNSPHG01'  TO CM-PROG
                    ELSE
                    IF BUSGENI = 'S' AND (NOMTABI NOT = 'USR' AND 'OFI')
                               MOVE 'HLPPAG03'  TO CM-PROG
      *                         MOVE 'GNSPHG04'  TO CM-PROG
                    ELSE       MOVE 'HLPPAPRI'  TO CM-PROG
      *     ELSE                MOVE NOMTEXI     TO CM-NTEX
      *                         MOVE NOMARCI     TO CM-ARCH
                               MOVE 'GNSPHG05'  TO CM-PROG.
      *     IF NOMPGMI > LOW-VALUES AND SPACES
      *                         MOVE NOMPGMI     TO CM-PROG.
       ID-MISC.
      *--------
           MOVE '*'            TO SWERROR.
           MOVE SPACES         TO MSGDI.
           IF NOMMISI NOT > SPACES
                MOVE 'I' TO SWERROR NOMMISA
                MOVE 'DEBE INGRESAR CODIGO' TO MSGDI
           ELSE
                MOVE -1 TO NUMBDAL
                MOVE 'PRESIONE PF10 PARA GRABAR' TO MSGDI.
           IF ( EIBAID = FRM-FFLD-PF10 OR FRM-FFLD-PFJ ) AND
              SWERROR = '*'
                               MOVE NOMMISI TO CM-MISC
                               PERFORM REGISTRAR
                               PERFORM PRIMERA-VEZ.
           MOVE FRMIMAP       TO WS-MAPA
           MOVE FRMAMAP      TO WS-MSET
           PERFORM ENVIAR-MAPA-DATOS THRU AUTO-INVOC.
       REGISTRAR.
      *----------
           MOVE CM-MAPA        TO HLP-COD-MAPA
           MOVE CM-POSI        TO HLP-NUM-POSI
           PERFORM LEER-POSI THRU F-LPOS
           PERFORM MOVER-DATOS.
           IF FIO-STAT-OKS
                               PERFORM REGRABAR
           ELSE
      *                        EXEC CICS UNLOCK DATASET('HLPMPOS')
      *                                                END-EXEC

                               PERFORM GRABAR.
       LEER-POSI.
      *----------
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GNS-FIO-HLP.
       F-LPOS.
      *-------
       MOVER-DATOS.
      *------------
           MOVE CM-MAPA        TO HLP-COD-MAPA
           MOVE CM-POSI        TO HLP-NUM-POSI
      *    IF CM-THLP = '1'    MOVE CM-NUMBD TO HLP-COD-SIST
                               MOVE CM-GENE  TO HLP-IND-GENE.
                               MOVE CM-NUMBD TO HLP-COD-SIST.
                               MOVE CM-TABLA TO HLP-COD-TABL.
                               MOVE CM-MISC  TO HLP-COD-TABL-MSC.
                               MOVE CM-PROG  TO HLP-COD-PROG.
      *    ELSE
      *                        MOVE CM-PROG  TO HLP-COD-PROG
      *                        MOVE CM-NTEX  TO HLP-COD-TABL-MSC
      *                        MOVE CM-ARCH  TO HLP-COD-FILE.
       REGRABAR.
      *---------
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM GNS-FIO-HLP.
       F-RGRAB.
      *--------
       GRABAR.
      *-------
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GNS-FIO-HLP.
          
       F-GRAB.
      *-------
       REQ-INVALIDO.
      *-------------
       TERMINAR.
      *---------
      *    EXEC CICS XCTL PROGRAM('UTLPP007') END-EXEC
      *    GO TO CANCELAR.
           PERFORM GNS-RET-FUN.
       CANCELAR.
      *---------
           EXEC CICS SEND      FROM(MSGDI) LENGTH(L-MEN) ERASE
                               END-EXEC
       COPY GNSBGGBK.
       CMN-ERR-ABN.
           EXEC CICS ASSIGN
                     ABCODE(WSS-CCOD)
           END-EXEC.
           IF WSS-CCOD-APCT OR WSS-CCOD-ABM0
               IF WSS-CCOD-APCT
                  MOVE 'MAPSET INVALIDO ' TO MSGAI
                  MOVE -1 TO NOMMAPL
               ELSE
                  MOVE -1 TO NOMSETL
                  MOVE 'MAPA   INVALIDO ' TO MSGAI
           ELSE
               MOVE -1 TO NOMMAPL
               MOVE 'ABEND DESCONOCIDO ' TO MSGAI.
           MOVE FRMFMAP      TO WS-MAPA CM-CMAPA.
           MOVE FRMAMAP      TO WS-MSET CM-CMSET.
           MOVE 1              TO ESTADO.
           MOVE SPACES         TO CM-NPGM.
           PERFORM ENVIAR-MAPA-DATOS.
           PERFORM AUTO-INVOC.
       COPY GNSBGHOY.

       PUT-FHOY SECTION.
       INI-PUT-FHOY.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY     TO WSS-NUM-DHOY.
           MOVE HOY-MHOY     TO WSS-NUM-MHOY.
           MOVE HOY-SHOY     TO WSS-NUM-SHOY.
           MOVE HOY-AHOY     TO WSS-NUM-AHOY.
           MOVE WSS-FEC-FHOY TO FECHAAI.
       FIN-PUT-FHOY.
           EXIT.


       COPY GNSBGSYS.
       COPY GNSBIABT.
       COPY GNSBFHLP.
       COPY GNSBGVSM.
       COPY GNSBHVSM.
       COPY GNSBGRFN.
