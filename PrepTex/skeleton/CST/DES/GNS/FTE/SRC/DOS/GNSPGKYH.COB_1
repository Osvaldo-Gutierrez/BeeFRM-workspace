       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GNSPGKYH.
       AUTHOR.          CONSIST.

      * GRABA REGISTROS PARA HELP

       ENVIRONMENT DIVISION.
      *====================
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.

           SELECT  HLPPOS ASSIGN TO HLPPOS
                ORGANIZATION     IS INDEXED
                ACCESS           IS DYNAMIC
                RECORD KEY       IS POS-KEY-IREG
                STATUS           IS WSS-STAT.

       DATA DIVISION.
      *=============
       FILE SECTION.

       FD  HLPPOS
           LABEL RECORDS STANDARD.
       01  POS.
           02 POS-KEY-IREG                     PIC X(11).
           02 FILLER                           PIC X(43).

       WORKING-STORAGE SECTION.
      *-----------------------
       01  WSS-VARI.
           03 WSS-STAT                          PIC X(02).
              88 WSS-STAT-OKS        VALUE '00'.

       01  KYH.
           02 KYH-GLS-MAPA.
              03 KYH-GLS-SIST                  PIC X(03).
              03 KYH-GLS-EFE                   PIC X(01).
              03 KYH-GLS-FORM                  PIC X(03).
           02 KYH-GLS-NOMC                     PIC X(15).
           02 FILLER                           PIC X(01).
           02 KYM-NUM-POSC                     PIC X(04).
           02 FILLER                           PIC X(01).
           02 KYM-NUM-LENC                     PIC X(02).
           02 HLP-GLS-SIST                     PIC X(03).
           02 HLP-GLS-TABL                     PIC X(04).
           02 HLP-NUM-POSC.
              03 HLP-NUM-LINE                  PIC X(02).
              03 HLP-NUM-COLU                  PIC X(02).

       01  WSS-POS.
           02 POS-GLS-MAPA                     PIC X(07).
           02 POS-NUM-LINE                     PIC X(02).
           02 POS-NUM-COLU                     PIC X(02).
           02 POS-GLS-DIS1                     PIC X(05).
      *RVM:
      *    02 POS-NUM-BDAT                     PIC 9(03).
           02 POS-NUM-BDAT                     PIC X(03).
           02 POS-GLS-TABL                     PIC X(03).
           02 POS-GLS-DIS2                     PIC X(12).
           02 POS-GLS-PROG                     PIC X(08).
           02 POS-GLS-DIS3                     PIC X(01).
      *RVM: Se agrega campo BUSCA GENERICA, por default sera 'S'
           02 POS-IND-GENE        VALUE 'S'    PIC X(01).
           02 POS-GLS-DIS4                     PIC X(12).

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
           OPEN I-O   HLPPOS.
           IF NOT WSS-STAT-OKS
               DISPLAY 'ERROR ABRIR I-O ARCHIVO HLP' WSS-STAT
               GO TO FIN-MAIN.

           MOVE SPACES           TO POS-GLS-DIS1, POS-GLS-DIS2.
           MOVE SPACES           TO POS-GLS-DIS3.

           MOVE 'HLPPAG03'       TO POS-GLS-PROG.
           MOVE '      LD TAB'   TO POS-GLS-DIS3.

       LUP-MAIN.
           ACCEPT KYH.
           IF KYH-GLS-MAPA NOT > SPACES
               GO TO CLO-MAIN.

           IF HLP-GLS-SIST = SPACES
               GO TO LUP-MAIN.

           INSPECT KYM-NUM-POSC IN KYH REPLACING ALL SPACES BY ZEROES.
           INSPECT KYM-NUM-LENC IN KYH REPLACING ALL SPACES BY ZEROES.
           INSPECT HLP-NUM-POSC IN KYH REPLACING ALL SPACES BY ZEROES.

           MOVE KYH-GLS-MAPA IN KYH TO POS-GLS-MAPA IN WSS-POS.
           MOVE HLP-NUM-LINE IN KYH TO POS-NUM-LINE IN WSS-POS.
           MOVE HLP-NUM-COLU IN KYH TO POS-NUM-COLU IN WSS-POS.

      * RVM: Ahora pone codigo de sistema y no numero de b. de datos
           IF HLP-GLS-SIST = 'GNS'
      *        MOVE +180 TO POS-NUM-BDAT
               MOVE HLP-GLS-SIST TO POS-NUM-BDAT
           ELSE
           IF HLP-GLS-SIST = 'SGC'
      *        MOVE +190 TO POS-NUM-BDAT
               MOVE HLP-GLS-SIST TO POS-NUM-BDAT
           ELSE
           IF HLP-GLS-SIST = 'COL'
      *        MOVE +210 TO POS-NUM-BDAT
               MOVE HLP-GLS-SIST TO POS-NUM-BDAT
           ELSE
           IF HLP-GLS-SIST = 'DAP'
      *        MOVE +371 TO POS-NUM-BDAT
               MOVE HLP-GLS-SIST TO POS-NUM-BDAT
           ELSE
           IF HLP-GLS-SIST = 'SUP'
      *        MOVE +230 TO POS-NUM-BDAT
               MOVE HLP-GLS-SIST TO POS-NUM-BDAT
           ELSE
           IF HLP-GLS-SIST = 'DAP'
      *        MOVE +371 TO POS-NUM-BDAT
               MOVE HLP-GLS-SIST TO POS-NUM-BDAT
           ELSE
           IF HLP-GLS-SIST = 'TAB'
      *        MOVE +150 TO POS-NUM-BDAT
               MOVE HLP-GLS-SIST TO POS-NUM-BDAT
           ELSE
           IF HLP-GLS-SIST = 'DEU'
      *        MOVE +200 TO POS-NUM-BDAT
               MOVE HLP-GLS-SIST TO POS-NUM-BDAT
           ELSE
           IF HLP-GLS-SIST = 'GAR'
      *        MOVE +111 TO POS-NUM-BDAT
               MOVE HLP-GLS-SIST TO POS-NUM-BDAT
           ELSE
           IF HLP-GLS-SIST = 'CDC'
      *        MOVE +241 TO POS-NUM-BDAT
               MOVE HLP-GLS-SIST TO POS-NUM-BDAT
           ELSE
               MOVE +000 TO POS-NUM-BDAT
               DISPLAY 'SISTEMA Y #BASE DATOS DESCONOCIDOS'
               GO TO CLO-MAIN.

           MOVE HLP-GLS-TABL TO POS-GLS-TABL.

           MOVE WSS-POS TO POS.
           READ HLPPOS.
           MOVE WSS-POS TO POS.
           IF WSS-STAT-OKS
               REWRITE POS
           ELSE
               WRITE POS.
           IF NOT WSS-STAT-OKS
               DISPLAY WSS-STAT ' EN REG : ' POS
           ELSE
               DISPLAY 'OK EN REG : ' POS.

           GO TO LUP-MAIN.

       CLO-MAIN.
           CLOSE HLPPOS.
       FIN-MAIN.
           STOP RUN.
