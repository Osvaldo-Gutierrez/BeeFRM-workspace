       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.    GNSPCTAB.
       AUTHOR.        CONSIST.

      * Carga Tablas de archivo 'GNS$PRY'TAB a EXPTAB

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *----------------------
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSBRMSG.
       COPY GNSBRTAB.

       01  WSS-VARI.
           03 WSS-ITAB.
              05 WSS-ISIS                              PIC X(03).
              05 WSS-INAM        VALUE 'TAB'           PIC X(03).
           03 WSS-TTAB                                 PIC X(03).
           03 WSS-CACC                                 PIC X(03).
              88 WSS-CACC-ING         VALUE 'ING'.
              88 WSS-CACC-ACT         VALUE 'ACT'.
           03 WSS-TAUX                                 PIC X(194).
           03 WSS-TRGL                VALUE 0          PIC 9(04).
           03 WSS-TRGA                VALUE 0          PIC 9(04).
           03 WSS-TRGR                VALUE 0          PIC 9(04).

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
      *SE PUEDE PEDIR LOS NOMBRES LOGICOS DE LOS ARCHIVOS DE INPUT Y OUTPUT
      *Y ASUMIR 'GNS$PRY'TAB A EXPTAB

           DISPLAY 'TABLA A TRASPASAR  : ' WITH NO ADVANCING.
           ACCEPT WSS-TTAB.
           IF WSS-TTAB NOT > SPACES
               GO TO FIN-MAIN.

           DISPLAY 'ACCION (ING,[ACT]) : ' WITH NO ADVANCING.
           ACCEPT WSS-CACC.
           IF WSS-CACC NOT > SPACES
               MOVE 'ACT' TO WSS-CACC.

           CALL 'LIB$GET_SYMBOL' USING BY DESCRIPTOR 'GNS$PRY' WSS-ISIS.

           MOVE WSS-ITAB TO FIO-VOID.
           MOVE FIO-VID  TO FIO-CMND.
      *    MOVE 'GNS'    TO FIO-SIST.
           MOVE 'GNS'    TO TAB-COD-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
      *    MOVE 'GNS'    TO FIO-SIST.
           MOVE 'GNS'    TO TAB-COD-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-INP  TO FIO-CMND.
      *    MOVE 'GNS'    TO FIO-SIST.
           MOVE 'GNS'    TO TAB-COD-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           PERFORM EXP-FIO-TAB.

           MOVE FIO-UPD TO FIO-CMND.
           PERFORM EXP-FIO-TAB.

           MOVE WSS-TTAB TO TAB-COD-TTAB IN TAB.
           MOVE SPACES   TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-MAIN.
      *    MOVE 'GNS'    TO FIO-SIST.
           MOVE 'GNS'    TO TAB-COD-SIST.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND TAB-COD-TTAB IN TAB = WSS-TTAB )
               GO TO MSG-MAIN.
           MOVE TAB TO WSS-TAUX.
           ADD 1    TO WSS-TRGL.
           IF WSS-CACC-ING
               MOVE FIO-PUT TO FIO-CMND
               PERFORM EXP-FIO-TAB
               IF FIO-STAT-OKS
                  ADD 1 TO WSS-TRGA
                  DISPLAY 'GRABO registro    : '
                          TAB-COD-TABL IN TAB TAB-GLS-DESC IN TAB
               ELSE
                  ADD 1 TO WSS-TRGR
                  DISPLAY 'NO GRABO registro : '
                          TAB-COD-TABL IN TAB TAB-GLS-DESC IN TAB.
       NXT-MAIN.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-MAIN.
       MSG-MAIN.
           DISPLAY '------------------------------------'.
           DISPLAY 'TOTAL DE REGISTROS LEIDOS     : ' WSS-TRGL.
           DISPLAY 'TOTAL DE REGISTROS ACEPTADOS  : ' WSS-TRGA.
           DISPLAY 'TOTAL DE REGISTROS RECHAZADOS : ' WSS-TRGR.
       FIN-MAIN.
           STOP RUN.

      *JSS COPY GNSBFTAB.
      * Modulo FIO para archivo GNSTAB
       GNS-FIO-TAB SECTION.
       INI-GNS-FIO-TAB.
      *JSS
      *    MOVE FIO-SIST TO TAB-COD-SIST.
           IF FIO-CMND = FIO-PUT OR FIO-MOD
               MOVE TAB-COD-TTAB IN TAB TO TAB-CIC-TTAB IN TAB
                                           TAB-EXT-TTAB IN TAB
                                           TAB-SNX-TTAB IN TAB.
           CALL TAB-GLS-FTAB USING FIO-CMND TAB.
           MOVE FIO-SIST TO FIO-MENS-SIS.
           MOVE 'TAB'    TO FIO-MENS-REG.
       FIN-GNS-FIO-TAB.
           EXIT.

       COPY EXPBFTAB.
