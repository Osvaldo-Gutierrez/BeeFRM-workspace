       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GNSPLTAB.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    27-Aug-88 08:36 PM.

      * Programa Listador de Reporte TAB sin Sort.

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
           SELECT RPTTAB       ASSIGN TO RPTTAB.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       FD  RPTTAB LABEL RECORD OMITTED
           REPORT IS RPT-TAB
           .

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSBRTAB.
       COPY GNSRRTAB.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSRWTAB.
       COPY GNSWGSYS.
      *<<<<
       COPY TABBRUSR.
       COPY GNSBRMSG.
       01  WSS-COD-TABL.
           03 WSS-COD-TTAB                      PIC X(03).
           03 WSS-COD-CTAB                      PIC X(12).
       01  WSS-ACC-TTAB                         PIC X(03).
       01  WSS-IND-VIGE                         PIC X(01).
       01  WSS-DMA-FAUX.
           03 WSS-NUM-DAUX                      PIC X(02).
           03 WSS-NUM-MAUX                      PIC X(02).
           03 WSS-NUM-SAUX                      PIC X(02).
           03 WSS-NUM-AAUX                      PIC X(02).
       01  WSS-DMA-FINI.
           03 WSS-NUM-SINI                      PIC X(02).
           03 WSS-NUM-AINI                      PIC X(02).
           03 WSS-NUM-MINI                      PIC X(02).
           03 WSS-NUM-DINI                      PIC X(02).
       01  WSS-NUM-FFIN.
           03 WSS-NUM-SFIN                      PIC X(02).
           03 WSS-NUM-AFIN                      PIC X(02).
           03 WSS-NUM-MFIN                      PIC X(02).
           03 WSS-NUM-DFIN                      PIC X(02).
      *>>>>

       REPORT SECTION.
      *--------------
       COPY GNSRFTAB.
           .
       COPY GNSRTTAB.

       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
       DEC-CF-TAB-TAB-COD-TTAB SECTION.
           USE BEFORE REPORTING CF-TAB-TAB-COD-TTAB.
       INI-CF-TAB-TAB-COD-TTAB.
      *<<<<
           MOVE 0 TO PAGE-COUNTER.
      *>>>>
       FIN-CF-TAB-TAB-COD-TTAB.
           EXIT.
       DEC-CF-TAB-WSS-COD-TMSC SECTION.
           USE BEFORE REPORTING CF-TAB-WSS-COD-TMSC.
       INI-CF-TAB-WSS-COD-TMSC.
      *<<<<
           IF NOT ( TAB-COD-TTAB IN SRT = 'MSC'  AND
                    TAB-COD-CTAB IN SRT > SPACES AND
                    WSS-COD-TMSC IN WSS-TAB > SPACES )
      *        MOVE 1 TO PRINT-SWITCH.
       COPY GNSBGSPI.
                    .
      *>>>>
       FIN-CF-TAB-WSS-COD-TMSC.
           EXIT.
       DEC-CF-TAB-WSS-COD-TMSG SECTION.
           USE BEFORE REPORTING CF-TAB-WSS-COD-TMSG.
       INI-CF-TAB-WSS-COD-TMSG.
      *<<<<
           IF NOT ( TAB-COD-TTAB IN SRT = 'MSG'  AND
                    TAB-COD-CTAB IN SRT > SPACES AND
                    WSS-COD-TMSG IN WSS-TAB > SPACES )
      *        MOVE 1 TO PRINT-SWITCH.
       COPY GNSBGSPI.
                    .
      *>>>>
       FIN-CF-TAB-WSS-COD-TMSG.
           EXIT.
       DEC-DL-TAB SECTION.
           USE BEFORE REPORTING DL-TAB.
       INI-DL-TAB.
       FIN-DL-TAB.
           EXIT.
       END DECLARATIVES.

       MAIN SECTION.
      *------------
       INI-MAIN.
           MOVE 'GNSPLTAB' TO FIO-PROG.
       INI-INP-SRT.
      *<<<<
           DISPLAY 'INGRESE SISTEMA : '.
           ACCEPT FIO-SIST.
           DISPLAY 'INGRESE TABLA : '.
           ACCEPT WSS-ACC-TTAB.
           IF WSS-ACC-TTAB NOT > SPACES
               MOVE '*' TO WSS-ACC-TTAB.

           DISPLAY 'INGRESE FECHA INICIO  : '.
           ACCEPT WSS-DMA-FAUX.
           IF WSS-DMA-FAUX NOT > SPACES OR
              WSS-DMA-FAUX = '*'
               MOVE LOW-VALUES TO WSS-DMA-FINI
           ELSE
              MOVE WSS-NUM-DAUX TO WSS-NUM-DINI
              MOVE WSS-NUM-MAUX TO WSS-NUM-MINI
              MOVE WSS-NUM-SAUX TO WSS-NUM-SINI
              MOVE WSS-NUM-AAUX TO WSS-NUM-AINI.

           DISPLAY 'INGRESE FECHA TERMINO : '.
           ACCEPT WSS-DMA-FAUX.
           IF WSS-DMA-FAUX NOT > SPACES OR
              WSS-DMA-FAUX = '*'
               MOVE '99999999' TO WSS-NUM-FFIN
           ELSE
              MOVE WSS-NUM-DAUX TO WSS-NUM-DFIN
              MOVE WSS-NUM-MAUX TO WSS-NUM-MFIN
              MOVE WSS-NUM-SAUX TO WSS-NUM-SFIN
              MOVE WSS-NUM-AAUX TO WSS-NUM-AFIN.

           DISPLAY 'INGRESE VIGENCIA S/N/* : '.
           ACCEPT WSS-IND-VIGE.
           IF WSS-IND-VIGE NOT > SPACES
               MOVE '*' TO WSS-IND-VIGE.
      *>>>>
           CALL 'GNSPLHDR' USING RPT-VARI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
       FST-INP-SRT.
      *<<<<
           IF WSS-ACC-TTAB = '*'
               MOVE FIO-GET-FST TO FIO-CMND
           ELSE
               MOVE WSS-ACC-TTAB TO TAB-COD-TTAB IN TAB
               MOVE SPACES       TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM FIO-TAB.
           GO TO INI-OUT-SRT.
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
       INI-OUT-SRT.
           OPEN OUTPUT RPTTAB.
           INITIATE RPT-TAB.
       LUP-MAIN.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
                GO TO FIN-MAIN.
       MOV-INP-SRT.
       COPY GNSRMTAB.
       LUP-OUT-SRT.
      *<<<<
           IF TAB-COD-TTAB IN SRT NOT = TAB-COD-TTAB IN TAB
               MOVE SPACES TO TAB-COD-TTAB IN SRT
                              WSS-GLS-DTAB
                              USR-GLS-DESC.
      *>>>>
           GENERATE DL-TAB.
       NXT-INP-SRT.
       NXT-OUT-SRT.
      *<<<<
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM FIO-TAB.
           GO TO LUP-MAIN.
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           GO TO LUP-MAIN.
       FIN-MAIN.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
       FIN-OUT-SRT.
           TERMINATE RPT-TAB.
           CLOSE RPTTAB.
           STOP RUN.

      *JSS COPY GNSBFTAB.
      * Modulo FIO para archivo GNSTAB
       GNS-FIO-TAB SECTION.
       INI-GNS-FIO-TAB.
      *JSS
           MOVE FIO-SIST TO TAB-COD-SIST.
           IF FIO-CMND = FIO-PUT OR FIO-MOD
               MOVE TAB-COD-TTAB IN TAB TO TAB-CIC-TTAB IN TAB
                                           TAB-EXT-TTAB IN TAB
                                           TAB-SNX-TTAB IN TAB.
           CALL 'PRYPFTAB' USING FIO-CMND TAB.
           MOVE FIO-SIST TO FIO-MENS-SIS.
           MOVE 'TAB'    TO FIO-MENS-REG.
       FIN-GNS-FIO-TAB.
           EXIT.

       COPY GNSBBSYS.

      *<<<<
       FIO-TAB SECTION.
       INI-FIO-TAB.
           PERFORM GNS-FIO-TAB.
           IF FIO-CMND = FIO-INP OR FIO-CMND = FIO-CLO
               GO TO FIN-FIO-TAB.
           IF TAB-COD-TTAB IN TAB NOT = WSS-COD-TTAB
               IF TAB-COD-CTAB IN TAB > SPACES
                   MOVE 'TABLA SIN REGISTRO PADRE' TO WSS-GLS-DTAB
               ELSE
                   MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-DTAB.
           MOVE TAB-COD-TABL IN TAB TO WSS-COD-TABL.
           IF ( WSS-ACC-TTAB < TAB-COD-TTAB IN TAB AND
                WSS-ACC-TTAB NOT = '*' ) OR
              NOT FIO-STAT-OKS
                 STOP RUN.
           IF TAB-COD-CTAB IN TAB NOT > SPACES
               PERFORM BUS-RES
               PERFORM TAB-NXT-TAB
               GO TO FIN-FIO-TAB.
           IF NOT ( ( WSS-ACC-TTAB = TAB-COD-TTAB IN TAB     OR
                      WSS-ACC-TTAB = '*'
                    ) AND
                    ( WSS-IND-VIGE = TAB-IND-VIGE IN TAB     OR
                      WSS-IND-VIGE = '*'
                    ) AND
                    ( WSS-DMA-FINI NOT > TAB-FEC-FTRN IN TAB AND
                      WSS-NUM-FFIN NOT < TAB-FEC-FTRN IN TAB
                    )
                  )
               GO TO INI-FIO-TAB.
           IF TAB-COD-TTAB IN TAB = 'MSC'
               MOVE TAB-COD-CTAB IN TAB TO WSS-COD-TMSC IN WSS-TAB.
           IF TAB-COD-TTAB IN TAB = 'MSG'
               MOVE TAB-COD-CTAB IN TAB TO WSS-COD-TMSG IN WSS-TAB.
       FIN-FIO-TAB.
           EXIT.

       BUS-RES SECTION.
       INI-BUS-RES.
           IF TAB-COD-ATRN IN TAB > SPACES
               MOVE TAB-COD-ATRN IN TAB TO USR-COD-USER IN USR
               PERFORM BUS-USR
           ELSE
               MOVE SPACES TO USR-GLS-DESC IN USR.
       FIN-BUS-RES.
           EXIT.

       TAB-NXT-TAB SECTION.
       INI-TAB-NXT-TAB.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF TAB-COD-TTAB IN TAB NOT = WSS-COD-TTAB
               MOVE WSS-COD-TABL TO TAB-COD-TABL IN TAB
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-TAB
               MOVE SPACES TO TAB
               MOVE WSS-COD-TABL TO TAB-COD-TABL IN TAB.
       FIN-TAB-NXT-TAB.
           EXIT.

       COPY TABBBUSR.
      *COPY TABBFUSR.
       TAB-FIO-USR SECTION.
       INI-TAB-FIO-USR.
           MOVE ' USUARIO' TO USR-GLS-DESC.
           MOVE  '00' TO FIO-STAT.
       FIN-TAB-FIO-USR.
           EXIT.

       COPY GNSBBMSG.
       COPY GNSBFMSG.
      *>>>>
