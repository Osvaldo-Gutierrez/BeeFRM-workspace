       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.    GNSPPINT.
       AUTHOR.        GUZMAN Y CIA.

      * Prueba calculo tasa de interes a partir de una tasa y periodo dado

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.

       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
       01  WSS-VARI.
           03 WSS-FFEC.
              05 WSS-AFEC                         PIC X(02).
              05 WSS-MFEC                         PIC X(02).
              05 WSS-DFEC                         PIC X(02).
           03 WSS-TIPE                            PIC 9(06)V9(08).
           03 WSS-TIPE-EDT REDEFINES WSS-TIPE     PIC ZZZZ9,99999999.
      *
       01  WSS-VINT.
      *
      *    Opera Como (P,C,D,B)
           03  WSS-OPEC                         PIC X(01).
      *
      *    Tipo Tasa 
           03  WSS-TIPT.
      *
      *            Base Calculo ( Anticipada, Vencida )
               05  WSS-BCTI                     PIC X(01).
      *
      *            Base Calculo ( D,M,A,T,N,C,X,Y,Z )
               05  WSS-PBTI                     PIC X(01).
      *
      *            Modo Calculo bajo Periodo Base ( Simple, Compuesto )
               05  WSS-BPBT                     PIC X(01).
      *
      *            Modo Calculo Sobre Pdo Base ( S, C )
               05  WSS-SPBT                     PIC X(01).
      *
      *            Tipo Valor Tasa Interes
      *            WSS-TVTI = "I"               PIC X(01).
      *
      *            Codigo Valor Tasa Interes ( Tasa Variable )
               05  WSS-CVTI                     PIC X(03).
      *
      *            Tipo Cambio Tasa Interes                   
      *            WSS-TCTI = WSS-PBTI          PIC X(02).
      *
      *            Tipo Fecha Periodo de Repacto ( C, F, A )
               05  WSS-TFPR                     PIC X(01).
      *
      *            Periodo de Repacto
               05  WSS-PREP                     PIC 9(03).
      *
      *            Unidad de Tiempo Periodo Repacto ( D, M, A )
               05  WSS-UTPR                     PIC X(01).
      *
      *    Fecha del Interes
           03  WSS-FINT.
               05  WSS-SDMA                     PIC 9(02).
               05  WSS-ADMA                     PIC 9(02).
               05  WSS-MDMA                     PIC 9(02).
               05  WSS-DDMA                     PIC 9(02).
      *    Indicador analisis de Feriados
           03 WSS-AFER                VALUE 'N' PIC X(01).
              88  WSS-AFER-YES        VALUE 'S'.
      *
      *    Valor de Cambio
           03  WSS-VCAM.
      *            Tipo Valor
               05  CAM-MSC-TVAL                 PIC X(01).
      *            Codigo Valor
               05  CAM-COD-CVAL                 PIC X(03).
      *            Tipo Cambio
               05  CAM-COD-TCAM                 PIC X(02).
      *
      *	   Mensaje
           03  WSS-MENS.
               05  WSS-MEN1                     PIC X(40).
               05  WSS-MEN2                     PIC X(39).
      *
      *    Separacion
           03  WSS-SEPA                         PIC 9(05).
      *
      *    Unidad Separacion ( D,M,A )
           03  WSS-IPER                         PIC X(01).
      *
      *    Modalidad de Calculo Tasa Interes
           03  WSS-MCTI                         PIC X(01).
      *
      *    Separaciones de trabajo
           03  WSS-SDIA                         PIC 9(05).
           03  WSS-S30D                         PIC 9(04).
      *JSS 03  WSS-SMES                         PIC 9(04).
           03  WSS-S360                         PIC 9(04).
      *JSS 03  WSS-SANO                         PIC 9(04).
      *
      *    Tasa Interes Informada
           03  WSS-TINT                         PIC 9(03)V9(07) COMP.
      *
      *    Tasas de trabajo
           03  WSS-TDIA                         PIC 9(01)V9(09) COMP.
           03  WSS-T30D                         PIC 9(01)V9(09) COMP.
      *JSS 03  WSS-TMES                         PIC 9(01)V9(09) COMP.
      *JSS 03  WSS-TANO                         PIC 9(01)V9(09) COMP.
           03  WSS-T360                         PIC 9(01)V9(09) COMP.
      *
           03 WSS-FINI.
              05 WSS-DINI                         PIC 9(02).
              05 WSS-MINI                         PIC 9(02).
              05 WSS-SINI                         PIC 9(02).
              05 WSS-AINI                         PIC 9(02).
           03 WSS-FTER.
              05 WSS-DTER                         PIC 9(02).
              05 WSS-MTER                         PIC 9(02).
              05 WSS-STER                         PIC 9(02).
              05 WSS-ATER                         PIC 9(02).
           03 WSS-IDSP                  VALUE 'S' PIC X(01).
              88 WSS-IDSP-YES           VALUE 'S' ' '.
           03 WSS-CONT                  VALUE 0   PIC 9(03).
      *===================================================================

       COPY GNSWGFEC.
       COPY GNSBRTAB.
       COPY GNSBRMSC.
       COPY GNSBRMSG.
       COPY GNSWGHOY.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
      *
       COPY TABBRCAM.
      *
       COPY GNSWGINT.
       COPY GNSWGCVI.

       PROCEDURE DIVISION.
      *===================

       MAIN SECTION.
       INI-MAIN.
           DISPLAY 'INGRESE INDICADOR DE DISPLAY : ' WITH NO ADVANCING.
           ACCEPT WSS-IDSP.
           MOVE 0 TO WSS-CONT.
           MOVE 0 TO INT-TINT.
       LUP-MAIN.
           IF WSS-IDSP-YES
               DISPLAY '======================================='
               DISPLAY '---------------------INT-TIPT : ' INT-TIPT
               DISPLAY 'Digite Tasa Interes           : '
               DISPLAY 'A D S S XXX X 999 X           : '
               DISPLAY 'V T B B XXX X 999 X           : '
               DISPLAY '  X     XXX X 999 X           : ' WITH
                                                          NO ADVANCING.
           ACCEPT WSS-TIPT.
           IF WSS-TIPT = 'F'
               GO TO FIN-MAIN.
           IF WSS-TIPT > SPACES
               MOVE WSS-TIPT TO INT-TIPT.

           MOVE INT-TINT TO WSS-TIPE.
           MOVE WSS-TIPE TO WSS-TIPE-EDT.
           IF WSS-IDSP-YES
               DISPLAY '---------------------INT-TINT : ' WSS-TIPE
               DISPLAY 'Digite Valor Tasa Informada   : ' WITH
                                                          NO ADVANCING.
           ACCEPT WSS-TINT WITH CONVERSION.
           IF WSS-TINT > ZEROES
               MOVE WSS-TINT TO INT-TINT.

           IF WSS-IDSP-YES
               DISPLAY '---------------------INT-FINI : ' INT-FINI
               DISPLAY 'Digite Fecha Inicial Periodo  : ' WITH
                                                          NO ADVANCING.
           ACCEPT WSS-FINI.
           IF WSS-FINI > SPACES
               MOVE WSS-FINI TO INT-FINI.

           IF WSS-IDSP-YES
               DISPLAY '---------------------INT-SEPA : ' INT-SEPA
               DISPLAY 'Separacion entre Vencimientos : ' WITH
                                                          NO ADVANCING.
           ACCEPT WSS-SEPA WITH CONVERSION.
           IF WSS-SEPA > ZEROES
               MOVE WSS-SEPA TO INT-SEPA.

           IF WSS-IDSP-YES
               DISPLAY '---------------------INT-IPER : ' INT-IPER
               DISPLAY 'Unidad de separacion          : ' WITH
                                                          NO ADVANCING.
           ACCEPT WSS-IPER WITH CONVERSION.
           IF WSS-IPER > SPACES
               MOVE WSS-IPER TO INT-IPER.

           IF WSS-IDSP-YES
               DISPLAY 'Analiza Feriado ?             : ' WITH
                                                          NO ADVANCING.
           ACCEPT WSS-AFER.
           IF WSS-AFER > SPACES
               MOVE WSS-AFER TO INT-AFER.

           IF INT-CVTI > SPACES
               IF WSS-IDSP-YES
                   DISPLAY '---------------------INT-FINT : ' INT-FINT
                   DISPLAY 'Digite Fecha Interes          : '
                                                    WITH  NO ADVANCING
                   ACCEPT WSS-FINT
                   IF WSS-FINT > SPACES
                       MOVE WSS-FINT TO INT-FINT
                   ELSE
                       NEXT SENTENCE
               ELSE
                   ACCEPT WSS-FINT
                   IF WSS-FINT > SPACES
                       MOVE WSS-FINT TO INT-FINT.

           IF INT-CVTI > SPACES
               IF WSS-IDSP-YES
                   DISPLAY '---------------------INT-VCAM : ' INT-VCAM
                   DISPLAY 'Digite Moneda X XXX XX        : '
                           WITH NO ADVANCING
                   ACCEPT WSS-VCAM
                   IF WSS-VCAM > SPACES
                       MOVE WSS-VCAM TO INT-VCAM
                   ELSE
                       NEXT SENTENCE
               ELSE
                   ACCEPT WSS-VCAM
                   IF WSS-VCAM > SPACES
                       MOVE WSS-VCAM TO INT-VCAM.

           MOVE INT-FINI   TO FEC-FECH.
           MOVE FEC-VHBL-N TO FEC-VHBL.
           MOVE FEC-FBLK-N TO FEC-FBLK.
           MOVE FEC-CHOY-N TO FEC-CHOY.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               GO TO LUP-MAIN.

           PERFORM PRO-IPER.
           IF INT-CMSG > SPACES
               GO TO MSG-MAIN.
           MOVE INT-FINI TO FEC-FECH CVI-FFTP.
           PERFORM PRO-AFER.
           IF INT-CMSG > SPACES
               GO TO MSG-MAIN.

           PERFORM OBT-VTIN.

           MOVE INT-TIPE TO WSS-TIPE.
           MOVE WSS-TIPE TO WSS-TIPE-EDT.
           IF WSS-IDSP-YES
               DISPLAY 'Tasa Interes resultado        : ' WSS-TIPE
           ELSE
               MOVE INT-SEPD TO WSS-CONT
               DISPLAY WSS-CONT ') Tasa Interes resultado        : '
                       WSS-TIPE.
           GO TO LUP-MAIN.
       MSG-MAIN.
           MOVE 'GNS' TO MSG-COD-SIST.
           MOVE INT-CMSG TO MSG-COD-MENS.
           PERFORM GET-MSG.
           DISPLAY MSG-GLS-DESC.
           GO TO LUP-MAIN.
       FIN-MAIN.
           STOP RUN.

       COPY GNSBGINT.
       COPY GNSBGCVI.
      *
       COPY GNSBGFEC.

       GET-FHOY SECTION.
       INI-GET-FHOY.
           ACCEPT WSS-FFEC FROM DATE.
           MOVE '19'     TO HOY-SHOY.
           MOVE WSS-AFEC TO HOY-AHOY.
           MOVE WSS-MFEC TO HOY-MHOY.
           MOVE WSS-DFEC TO HOY-DHOY.
       FIN-GET-FHOY.
           EXIT.

       GNS-FIO-TAB SECTION.
       INI-GNS-FIO-TAB.
           MOVE 'N' TO TAB-IND-VIGE IN TAB.
       FIN-GNS-FIO-TAB.
           EXIT.

       GNS-FIO-MSC SECTION.
       INI-GNS-FIO-MSC.
           MOVE MSC-COD-CMSC IN MSC TO MSC-CIC-CMSC IN MSC.
           MOVE '00' TO FIO-STAT.
       FIN-GNS-FIO-MSC.
           EXIT.

       GET-MSG SECTION.
       INI-GET-MSG.
           MOVE MSG-COD-MENS TO MSG-GLS-DESC.
       FIN-GET-MSG.
           EXIT.

       TAB-FIO-CAM SECTION.
       INI-TAB-FIO-CAM.
           MOVE '00' TO FIO-STAT.
           DISPLAY 'INGRESE VALOR DE CAMBIO PARA: ' CAM-KEY-CAMB IN CAM.
           ACCEPT CAM-SGV-VCAM IN CAM WITH CONVERSION.
           IF CAM-SGV-VCAM IN CAM = ZEROES
               MOVE '23' TO FIO-STAT.
       FIN-TAB-FIO-CAM.
           EXIT.
