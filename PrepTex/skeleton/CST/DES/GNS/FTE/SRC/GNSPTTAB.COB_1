       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID. GNSPTTAB.
       AUTHOR.     CONSIST.
      * ACTUALIZA TABLAS EN FORMA BATCH.
       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.
       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *------------------------
       COPY GNSWVFIO.
       COPY GNSWCFIO.
       COPY GNSWGIFD.
      *COPY GNSWGSYS.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBI-REQA==.
       01  WSS-VARI.
           03  WSS-NUM-DBIN                     PIC 9(03).
           03  WSS-NUM-DBOU                     PIC 9(03).
           03  WSS-IDBD                         PIC 9(02).
           03  WSS-COD-TTAB                     PIC X(03).
           03  WSS-TAB-ESTD.
               05  WSS-NUM-RRCH    VALUE ZEROES PIC 9(04).
               05  WSS-NUM-RLEI    VALUE ZEROES PIC 9(04).
               05  WSS-NUM-CREA    VALUE ZEROES PIC 9(04).
               05  WSS-NUM-EXST    VALUE ZEROES PIC 9(04).

       PROCEDURE DIVISION.
      *===================
       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.
           PERFORM INI.
           IF NOT FIO-STAT-OKS
               GO TO FIN-MAIN.
           MOVE WSS-NUM-DBIN IN WSS-VARI TO IFD-GSIS( WSS-IDBD ).
           MOVE SPACES TO TAB-COD-TABL IN TAB.
           MOVE 'TRA' TO TAB-COD-TTAB IN TAB.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND 
                    TAB-COD-TTAB IN TAB = 'TRA' )
               DISPLAY 'TABLA TRA INEXISTENTE'
               GO TO FIN-MAIN.
           IF TAB-COD-CTAB IN TAB NOT > SPACES
               MOVE FIO-GET-NXT TO FIO-CMND
               PERFORM GNS-FIO-TAB.
               IF NOT ( FIO-STAT-OKS AND 
                        TAB-COD-TTAB IN TAB = 'TRA' )
                   DISPLAY 'TABLA TRA VACIA'
                   GO TO FIN-MAIN.
           MOVE ADR-TAB-REQA TO ADR-AUX-REQA.
           MOVE TAB-COD-CTAB IN TAB TO TAB-COD-TTAB IN TAB.
           MOVE SPACES TO TAB-COD-CTAB IN TAB.
           MOVE TAB-COD-TTAB IN TAB TO WSS-COD-TTAB IN WSS-VARI.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND
                    TAB-COD-TTAB IN TAB = WSS-COD-TTAB IN WSS-VARI )
               DISPLAY 'TABLA INEXISTENTE : ' WSS-COD-TTAB IN WSS-VARI
               GO TO GET-NXT-TRA.
       LUP-MAIN.
           ADD 1 TO WSS-NUM-RLEI IN WSS-VARI.
           MOVE ADR-TAB-REQA TO ADR-DBI-REQA.
           MOVE WSS-NUM-DBOU IN WSS-VARI TO IFD-GSIS( WSS-IDBD ).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               ADD 1 TO WSS-NUM-EXST IN WSS-VARI
               GO TO TAB-MAIN.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               ADD 1 TO WSS-NUM-RRCH IN WSS-VARI
               DISPLAY 'REGISTRO ERRONEO : ' TAB
           ELSE
               ADD 1 TO WSS-NUM-CREA IN WSS-VARI.
       TAB-MAIN.
           MOVE ADR-DBI-REQA TO ADR-TAB-REQA.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           MOVE WSS-NUM-DBIN IN WSS-VARI TO IFD-GSIS( WSS-IDBD ).
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-TAB. 
           IF NOT FIO-STAT-OKS
              GO TO FIN-MAIN.
           IF WSS-COD-TTAB IN WSS-VARI = TAB-COD-TTAB IN TAB
               GO TO LUP-MAIN.
       GET-NXT-TRA.
           MOVE ADR-AUX-REQA TO ADR-TAB-REQA.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-TAB. 
           IF NOT FIO-STAT-OKS OR
              TAB-COD-TTAB IN TAB NOT = 'TRA'
              GO TO FIN-MAIN.
           MOVE ADR-TAB-REQA TO ADR-AUX-REQA.
           MOVE TAB-COD-CTAB IN TAB TO TAB-COD-TTAB IN TAB.
           MOVE SPACES TO TAB-COD-CTAB IN TAB.
           MOVE TAB-COD-TTAB IN TAB TO WSS-COD-TTAB IN WSS-VARI.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND
                    TAB-COD-TTAB IN TAB = WSS-COD-TTAB IN WSS-VARI )
               DISPLAY 'TABLA INEXISTENTE : ' WSS-COD-TTAB IN WSS-VARI
               GO TO GET-NXT-TRA.
           GO TO LUP-MAIN.
       FIN-MAIN.
           PERFORM IMP-ESTD.
           PERFORM CLO-FIL.
       COPY GNSBGGBK.

       INI SECTION.
       INI-INI.
           PERFORM BUS-FSIS.
           ACCEPT FIO-SIST.
           DISPLAY FIO-SIST.
           ACCEPT WSS-NUM-DBIN IN WSS-VARI.
           DISPLAY WSS-NUM-DBIN IN WSS-VARI.
           ACCEPT WSS-NUM-DBOU IN WSS-VARI.
           DISPLAY WSS-NUM-DBOU IN WSS-VARI.
           MOVE FIO-SIST TO IFD-SAUX.
           MOVE 'C'      TO IFD-QAUX.
           MOVE 1        TO IFD-IAUX.
           SET IFD-ITBL  TO 1.
           SEARCH IFD-VSIS VARYING IFD-IAUX
               AT END
                   DISPLAY 'SISTEMA INVALIDO : ' IFD-DAUX
                GOBACK   
               WHEN IFD-DSIS( IFD-ITBL ) = IFD-DAUX
                   MOVE IFD-IAUX TO WSS-IDBD.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               GO TO FIN-INI.
           MOVE WSS-NUM-DBOU TO IFD-GSIS( WSS-IDBD ).
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               GO TO FIN-INI.
       FIN-INI.
           EXIT.

       CLO-FIL SECTION.
       INI-CLO-FIL.
           MOVE WSS-NUM-DBIN TO IFD-GSIS( WSS-IDBD ).
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           MOVE WSS-NUM-DBOU TO IFD-GSIS( WSS-IDBD ).
           PERFORM GNS-FIO-TAB.
       FIN-CLO-FIL.
           EXIT.

       IMP-ESTD SECTION.
       INI-IMP-ESTD.
           DISPLAY 'REGISTROS LEIDOS       : ' WSS-NUM-RLEI IN WSS-VARI.
           DISPLAY 'REGISTROS CREADOS      : ' WSS-NUM-CREA IN WSS-VARI.
           DISPLAY 'REGISTROS RECHAZADOS   : ' WSS-NUM-RRCH IN WSS-VARI.
           DISPLAY 'REGISTROS EXISTENTES   : ' WSS-NUM-EXST IN WSS-VARI.
       FIN-IMP-ESTD.
           EXIT.
     
      *COPY GNSBFTAB.
       GNS-FIO-TAB SECTION.
       INI-GNS-FIO-TAB.
           MOVE ADR-TAB-REQA TO ADR-REQA.
           MOVE 'TAB' TO ADR-TABL IN ADR-REQA.
           MOVE IFD-GSIS( WSS-IDBD ) TO ADR-DBID IN ADR-REQA.
           MOVE 'TAB00' TO ADR-ELM1.
           MOVE FIO-PROG TO ADR-PROG.
           IF FIO-KDEF = FIO-KDEF-S
               GO TO CON-GNS-FIO-TAB.
           MOVE FIO-CMND TO FIO-IAKY.
           IF NOT FIO-IAKY-CON AND
              ( FIO-AKEY = 'TAB-COD-TABL' OR FIO-AKEY NOT > SPACES )
               MOVE TAB-COD-TABL IN TAB TO ADR-VKEY IN ADR-REQA
               MOVE 'TAB00' TO ADR-DKEY IN ADR-REQA
           ELSE
           IF FIO-AKEY = 'TAB-STP-ITRN'
               MOVE TAB-STP-ITRN IN TAB TO ADR-VKEY IN ADR-REQA
               MOVE 'TAB01' TO ADR-DKEY IN ADR-REQA
           ELSE
           IF FIO-AKEY = 'TAB-CIC-TABL'
               MOVE TAB-CIC-TABL IN TAB TO ADR-VKEY IN ADR-REQA
               MOVE 'TAB02' TO ADR-DKEY IN ADR-REQA
           ELSE
           IF FIO-AKEY = 'TAB-EXT-TABL'
               MOVE TAB-EXT-TABL IN TAB TO ADR-VKEY IN ADR-REQA
               MOVE 'TAB03' TO ADR-DKEY IN ADR-REQA
           ELSE
               MOVE 'En GNS-FIO-TAB, key' TO FIO-MENS
               MOVE FIO-AKEY   TO FIO-MENS-KEY
               MOVE 'Invalida' TO FIO-MENS-FIL
               GO TO PRG-ABT.
       CON-GNS-FIO-TAB.
           MOVE TAB TO FIO-DFLD.
           PERFORM GNS-FIO-DTC.
           IF FIO-STAT-OKS
               MOVE FIO-DFLD TO TAB
           ELSE
               MOVE 'GNSTAB' TO FIO-MEN2
               IF FIO-STAT-FTL
                   GO TO PRG-ABT.
           MOVE SPACES   TO FIO-AKEY.
           MOVE FIO-KDEF-N TO FIO-KDEF.
           MOVE ADR-REQA TO ADR-TAB-REQA.
       FIN-GNS-FIO-TAB.
           EXIT.

       COPY GNSBGDTC.
       COPY GNSBGIFD.
       COPY GNSBTABT.
      *COPY GNSBBSYS.
