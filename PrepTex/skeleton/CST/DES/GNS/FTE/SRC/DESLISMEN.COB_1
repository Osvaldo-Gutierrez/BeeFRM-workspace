IDENTIFICATION DIVISION.
*=======================
PROGRAM-ID.	DESLISMEN.
AUTHOR. 	GUZMAN Y CIA.

* Programa Listador de Reporte MEN sin Sort.

ENVIRONMENT DIVISION.
*====================
CONFIGURATION SECTION.
*---------------------
SPECIAL-NAMES.
	DECIMAL-POINT IS COMMA.
INPUT-OUTPUT SECTION.
*--------------------
FILE-CONTROL.
	SELECT RPTMEN	ASSIGN TO RPTMEN.

DATA DIVISION.
*=============
FILE SECTION.
*------------
FD RPTMEN
	REPORT IS RPT-MEN.

WORKING-STORAGE SECTION.
*-----------------------
COPY	'DESREG.FUN'	FROM	DICTIONARY
	REPLACING
	==FUN==	BY 	==FUN EXTERNAL==.
COPY	RPTREGMEN	IN	GEN.
COPY	FIOWSS		IN	DESTXT.
COPY	PRVWSS		IN	DESTXT.
COPY	RPTWSS		IN	DESTXT.
COPY	RPTWSSMEN	IN	GEN.
COPY 'FRMDATOPC'	IN	GEN.
01 WSS-VARI.
	03 WSS-KEY-FUNC				PIC X(08).
	03 WSS-KEY-NEMO.
		05 WSS-KEY-CMEN			PIC X(03).
		05 WSS-KEY-CACC			PIC X(03).
		05 WSS-KEY-NREG			PIC X(06).
	03 WSS-MENS				PIC X(80).
	03 WSS-SIND.
		05 I				PIC 9(02).

REPORT SECTION.
*--------------
COPY	RPTRDSMEN	IN	GEN.
.
COPY	RPTDATMEN	IN	GEN.

PROCEDURE DIVISION.
*==================
DECLARATIVES.
DEC-PH-MEN SECTION.
	USE BEFORE REPORTING PH-MEN.
INI-PH-MEN.
FIN-PH-MEN.
	EXIT.
DEC-DL-MEN SECTION.
	USE BEFORE REPORTING DL-MEN.
INI-DL-MEN.
FIN-DL-MEN.
	EXIT.
END DECLARATIVES.

MAIN SECTION.
*------------
INI-MAIN.
	MOVE 'DESLISMEN' TO PRV-PROC.
	CALL 'DESPROPRV'.
	IF NOT PRV-STAT-OKS
		DISPLAY 'NO tiene PRIVILEGIOS para ejecutar programa DESLISMEN'
		STOP RUN.
	MOVE 'DESLISMEN' TO RPT-PROG.
INI-INP-SRT.
	MOVE SPACES TO WSS-KEY-FUNC.
	IF WSS-UARH NOT = SPACES
		CALL WSS-UARH.
	CALL 'DESFIOFUN' USING '<INP>'.
INI-OUT-SRT.
	OPEN OUTPUT RPTMEN.
	INITIATE RPT-MEN.
LUP-INP-SRT.
	CALL 'DESFIOFUN' USING '<GET_NXT>'.
	IF NOT FIO-STAT-OKS
		GO TO FIN-INP-SRT.
LUP-MAIN-FUNC.
	MOVE WSS-KEY-FUNC TO FUN-KEY-FUNC.
	CALL 'DESFIOFUN' USING '<GET_GRT>'.
	MOVE FUN-KEY-FUNC TO WSS-KEY-FUNC.
	IF NOT FIO-STAT-OKS
		GO TO FIN-MAIN.
	IF FUN-COD-TFUN NOT EQUAL 'MEN'
		GO TO LUP-MAIN-FUNC.
	IF FUN-KEY-NIVE( 4 ) NOT EQUAL ZEROES
		MOVE SPACES TO WSS-MENS
		STRING 'FUNCION ' WSS-KEY-FUNC ' no PUEDE ser MENU'
			DELIMITED BY WSS-MENS INTO WSS-MENS
		DISPLAY WSS-MENS
		GO TO LUP-MAIN-FUNC.
	PERFORM BUS-NIVE VARYING I FROM 4 BY -1 UNTIL I < 1 OR
		FUN-KEY-NIVE(I) NOT EQUAL ZEROES.
	ADD 1 TO I.
	MOVE FUN-GLS-FPRO TO WSS-GLS-FPRO IN SRT.
	PERFORM BUS-FUNC.
	STRING OPC-FLD DELIMITED BY SIZE INTO WSS-MEN.
	GENERATE DL-MEN.
	GO TO LUP-MAIN-FUNC.
COPY	RPTMOVMEN	IN	GEN.
LUP-OUT-SRT.
	GENERATE DL-MEN.
	GO TO LUP-INP-SRT.
FIN-INP-SRT.
	CALL 'DESFIOFUN' USING '<CLO>'.
FIN-OUT-SRT.
	TERMINATE RPT-MEN.
	CLOSE RPTMEN.
FIN-MAIN.
	STOP RUN.

BUS-NIVE SECTION.
*----------------
INI-BUS-NIVE.
FIN-BUS-NIVE.
	EXIT.

BUS-FUNC SECTION.
*----------------
INI-BUS-FUNC.
	MOVE SPACES TO OPC-DFLD.
	MOVE FUN-COD-MENU	TO WSS-KEY-CMEN.
	MOVE FUN-COD-MENU	TO FUN-KEY-CMEN.
	MOVE SPACES		TO FUN-KEY-CACC.
	MOVE SPACES		TO FUN-KEY-NREG.
	CALL 'DESFIOFUN' USING '<GET_NLS/FUN-KEY-NEMO>'.
	IF NOT FIO-STAT-OKS OR FUN-KEY-CMEN NOT EQUAL WSS-KEY-CMEN
		MOVE SPACES TO WSS-MENS
		STRING 'NO EXISTE OPCION PARA MENU: ' WSS-KEY-FUNC
			DELIMITED BY WSS-MENS INTO WSS-MENS
		DISPLAY WSS-MENS
		GO TO FIN-BUS-FUNC.
LUP-BUS-FUNC.
	PERFORM ESC-MOPC.
	CALL 'DESFIOFUN' USING '<GET_NXT>'.
	IF FIO-STAT-OKS AND FUN-KEY-CMEN EQUAL WSS-KEY-CMEN
		GO TO LUP-BUS-FUNC.
FIN-BUS-FUNC.
	EXIT.

ESC-MOPC SECTION.
*----------------
INI-ESC-MOPC.
	IF FUN-NUM-FILA < 3 OR FUN-NUM-FILA > 22
		MOVE SPACES TO WSS-MENS
		STRING 'FILA INVALIDA EN OPCION: ' FUN-KEY-FUNC ', PARA MENU: '
			WSS-KEY-FUNC DELIMITED BY WSS-MENS INTO WSS-MENS
		DISPLAY WSS-MENS
		GO TO FIN-ESC-MOPC.
	SUBTRACT 2 FROM FUN-NUM-FILA.
	IF FUN-NUM-COLU = 1
		MOVE FUN-GLS-FMEN    TO OPC-GLS-FMEN(FUN-NUM-FILA , 1)
		MOVE FUN-KEY-NIVE(I) TO	OPC-KEY-NIVE(FUN-NUM-FILA , 1)
	ELSE
	IF FUN-NUM-COLU = 41
		MOVE FUN-GLS-FMEN    TO OPC-GLS-FMEN(FUN-NUM-FILA , 2)
		MOVE FUN-KEY-NIVE(I) TO	OPC-KEY-NIVE(FUN-NUM-FILA , 2)
	ELSE
	IF FUN-NUM-COLU = 24
		MOVE FUN-GLS-FMEN    TO OPC-GLS-FME3(FUN-NUM-FILA)
		MOVE FUN-KEY-NIVE(I) TO OPC-KEY-NIV3(FUN-NUM-FILA)
	ELSE
		MOVE SPACES TO WSS-MENS
		STRING  'COLUMNA INVALIDA EN OPCION: ' FUN-KEY-FUNC
			', PARA MENU: '	WSS-KEY-FUNC
			DELIMITED BY WSS-MENS INTO WSS-MENS
		DISPLAY WSS-MENS.
FIN-ESC-MOPC.
	EXIT.
