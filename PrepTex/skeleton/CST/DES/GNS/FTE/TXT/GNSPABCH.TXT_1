*%! Codigo adicional para programa
*%! Cuando GENERE este programa para el BCI debe hacerlo en ambiente DTC
*%! INCLUDE 'GNSSRC:MANEJO_DTC.SRC'
*% NO_TIENE_TIMESTAMP = TRUE
*% PGM_PTC = TRUE
*% HDR_CST = FALSE
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       COPY TABBROFI.

       01  WSS-VARI.
           03 WSS-CMND                                  PIC 9(02).
           03 WSS-CMNA                                  PIC 9(02).
           03 WSS-SIND.
              05 I                                      PIC 9(02).
              05 J                                      PIC 9(02).
           03 WSS-TMN1                          VALUE 9 PIC 9(01).
           03 WSS-COD-PROC                              PIC X(06).
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           IF SCR-SISG NOT > SPACES
               MOVE SCR-SIST TO SCR-SISG.
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
           MOVE SCR-SISG TO FIO-SIST.
           MOVE SPACES   TO BCH-COD-TRYC.
      *>>>>
*% END
*% IF PUT_SCR
      *<<<< PUT_SCR
           MOVE BCH-COD-PROC IN BCH TO WSS-COD-PROC IN WSS-VARI.
           MOVE BCH-COD-CLVE IN BCH TO FRM-COD-CLVE IN BCH-FLD.
           MOVE BCH-NUM-NEJM IN BCH TO FRM-NUM-NEJM IN BCH-FLD.
           MOVE BCH-IND-IDEL IN BCH TO FRM-IND-IDEL IN BCH-FLD.
           MOVE BCH-IND-IGIA IN BCH TO FRM-IND-IGIA IN BCH-FLD.
           MOVE BCH-COD-DEST IN BCH TO FRM-COD-DEST IN BCH-FLD.
           MOVE BCH-COD-CLSE IN BCH TO FRM-COD-CLSE IN BCH-FLD.
           MOVE BCH-COD-FORM IN BCH TO FRM-COD-FORM IN BCH-FLD.
           MOVE BCH-GLS-NFRM IN BCH TO FRM-GLS-NFRM IN BCH-FLD.
           MOVE BCH-GLS-LFRM IN BCH TO FRM-GLS-LFRM IN BCH-FLD.
           MOVE BCH-IND-IPRV IN BCH TO FRM-IND-IPRV IN BCH-FLD.
           MOVE BCH-VEC-ILEE IN BCH TO FRM-VEC-ILEE IN BCH-FLD.
           MOVE BCH-VEC-PLNT IN BCH TO FRM-VEC-PLNT IN BCH-FLD.

           MOVE 'B'         TO BCH-COD-TRYC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
           IF FIO-STAT-OKS
               MOVE BCH-GLS-GLSA IN BCH TO FRM-GLS-GLSA IN BCH-FLD
               MOVE BCH-GLS-NRPT IN BCH TO FRM-GLS-NRPT IN BCH-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-GLSA IN BCH-FLD
               MOVE SPACES TO FRM-GLS-NRPT IN BCH-FLD.

           MOVE 'C'         TO BCH-COD-TRYC.
           MOVE FIO-FND-NLS TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
           IF FIO-STAT-OKS
               PERFORM LEE-CMN
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM GNS-FIO-BCH.
      *JSS MOVE BCH-DFLD                 TO FRM-DFLD.
           MOVE WSS-COD-PROC IN WSS-VARI TO BCH-COD-PROC IN BCH.
      *>>>>
*% END
*% IF CMN_ING
      *<<<< CMN_ING
           MOVE SCR-SISG TO FIO-SIST.
           MOVE FIO-PUT  TO WSS-CMND.
           PERFORM FIO-BCH.
           GO TO FIN-CMN-ING.
      *>>>>
*% END
*% IF INI_CMN_MOD
      *<<<< INI_CMN_MOD
           PERFORM RET-ALL-BCH.
           MOVE SCR-SISG TO FIO-SIST.
           MOVE FIO-MOD  TO WSS-CMND.
           PERFORM FIO-BCH.
           GO TO FIN-CMN-MOD.
      *>>>>
*% END
*% IF INI_CMN_ELI
      *<<<< INI_CMN_ELI
           PERFORM RET-ALL-BCH.
           MOVE BCH-COD-PROC IN BCH-FLD TO BCH-COD-PROC IN BCH.
           MOVE SPACES                  TO BCH-COD-TRYC IN BCH.
           MOVE SCR-SISG                TO FIO-SIST.
           MOVE FIO-GET-KEY-UPD         TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.

           MOVE 'B'             TO BCH-COD-TRYC.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
           IF FIO-STAT-OKS
               MOVE FIO-DEL TO FIO-CMND
               PERFORM GNS-FIO-BCH.

           PERFORM DEL-CMN VARYING I FROM 0 BY 1 UNTIL I > WSS-TMN1.
           GO TO FIN-CMN-ELI.
      *>>>>
*% END
*% IF FIN_HBL_FLD
      *<<<< FIN_HBL_FLD
           IF SCR-CMND = 'COP'
               PERFORM UNP-IKY-BCH
               PERFORM FST-KEY-BCH.
      *>>>>
*% END
*% IF ABT_CMN_ACC
      *<<<< ABT_CMN_ACC
               IF SCR-CMND = 'COP'
                   MOVE 'GNS'          TO MSG-COD-SIST
                   MOVE 'REG    NOCOP' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC   TO FRM-MENS
                   GO TO FIN-CMN-ACC
               ELSE
      *>>>>
*% END
*% IF INI_CMN_ACC
      *<<<< INI_CMN_ACC
           IF SCR-CMND = 'COP'
               PERFORM CMN-ING
               IF FIO-STAT-OKS
                   MOVE 'GNS'          TO MSG-COD-SIST
                   MOVE 'REG    SICOP' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC   TO FRM-MENS
                   GO TO FIN-CMN-ACC
               ELSE
                   MOVE 'GNS'          TO MSG-COD-SIST
                   MOVE 'REG    ERCOP' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC   TO FRM-MENS
                   GO TO FIN-CMN-ACC.
      *>>>>
*% END
*% IF EOF_PQ
      *<<<< EOF_PQ
       LEE-CMN SECTION.
       INI-LEE-CMN.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
           IF NOT ( FIO-STAT-OKS AND
                    BCH-COD-PROC IN BCH = BCH-COD-PROC IN BCH-FLD AND
                    BCH-COD-TREG = 'C' )
               GO TO FIN-LEE-CMN.
           ADD BCH-NUM-CORR 1 GIVING I.
           MOVE BCH-IND-TCMN IN BCH TO FRM-IND-TCMN IN BCH-FLD( I ).
           MOVE BCH-GLS-CMND IN BCH TO FRM-GLS-CMND IN BCH-FLD( I ).
           GO TO INI-LEE-CMN.
       FIN-LEE-CMN.
           EXIT.

       COPY GNSBBTAB.
       COPY TABBBOFI.
       COPY TABBFOFI.
      *>>>>
*% END
*% IF EOF_PU
      *<<<< EOF_PU
       COPY GNSBVCOD.
       COPY GNSBVTAB.
       COPY GNSBEGLS.

       COPY TABBVOFI.
       COPY TABBFOFI.

       FIO-BCH SECTION.
       INI-FIO-BCH.
           MOVE SPACES TO BCH.
           MOVE BCH-COD-PROC IN BCH-FLD TO BCH-COD-PROC IN BCH.
           MOVE SPACES                  TO BCH-COD-TRYC IN BCH.
           IF WSS-CMND = FIO-MOD
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM GNS-FIO-BCH
               IF NOT FIO-STAT-OKS
                   MOVE FIO-MENS TO FRM-MENS
                   GO TO FIN-FIO-BCH
               ELSE
                   PERFORM RET-ALL-BCH.
           MOVE BCH-COD-PROC IN BCH-FLD TO BCH-COD-PROC IN BCH.
           MOVE FRM-COD-CLVE IN BCH-FLD TO BCH-COD-CLVE IN BCH.
           MOVE FRM-NUM-NEJM IN BCH-FLD TO BCH-NUM-NEJM IN BCH.
           MOVE FRM-IND-IDEL IN BCH-FLD TO BCH-IND-IDEL IN BCH.
           MOVE FRM-IND-IGIA IN BCH-FLD TO BCH-IND-IGIA IN BCH.
           MOVE FRM-COD-DEST IN BCH-FLD TO BCH-COD-DEST IN BCH.
           MOVE FRM-COD-CLSE IN BCH-FLD TO BCH-COD-CLSE IN BCH.
           MOVE FRM-COD-FORM IN BCH-FLD TO BCH-COD-FORM IN BCH.
           MOVE FRM-GLS-NFRM IN BCH-FLD TO BCH-GLS-NFRM IN BCH.
           MOVE FRM-GLS-LFRM IN BCH-FLD TO BCH-GLS-LFRM IN BCH.
           MOVE FRM-IND-IPRV IN BCH-FLD TO BCH-IND-IPRV IN BCH.
           MOVE FRM-VEC-ILEE IN BCH-FLD TO BCH-VEC-ILEE IN BCH.
           MOVE FRM-VEC-PLNT IN BCH-FLD TO BCH-VEC-PLNT IN BCH.
           MOVE WSS-CMND TO FIO-CMND.
           PERFORM GNS-FIO-BCH.

           MOVE 'B' TO BCH-COD-TRYC.
           IF WSS-CMND = FIO-MOD
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM GNS-FIO-BCH
               IF NOT FIO-STAT-OKS
                   MOVE FIO-MENS TO SYS-MENS
                   MOVE SYS-ABOR TO SYS-CMND
                   PERFORM GNS-PRO-FRM.
           MOVE FRM-GLS-GLSA IN BCH-FLD TO BCH-GLS-GLSA IN BCH.
           MOVE FRM-GLS-NRPT IN BCH-FLD TO BCH-GLS-NRPT IN BCH.
           MOVE WSS-CMND TO FIO-CMND.
           PERFORM GNS-FIO-BCH.

           PERFORM WRT-CMN VARYING I FROM 0 BY 1 UNTIL I > WSS-TMN1 OR
                                                 NOT FIO-STAT-OKS.
       FIN-FIO-BCH.
           EXIT.

       WRT-CMN SECTION.
       INI-WRT-CMN.
           MOVE SPACES TO BCH.
           MOVE BCH-COD-PROC IN BCH-FLD TO BCH-COD-PROC IN BCH.
           MOVE 'C'                     TO BCH-COD-TREG IN BCH.
           MOVE I                       TO BCH-NUM-CORR IN BCH.
           ADD I 1 GIVING J.
           IF SCR-CCPP = 'ING' OR ( SCR-CCPP = 'ACT' AND
                                    SCR-ACTU = SCR-ACTU-ING )
               MOVE FIO-PUT TO WSS-CMNA
               GO TO CON-WRT-CMN.

           IF FRM-GLS-CMND IN BCH-FLD( J ) NOT > SPACES
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM GNS-FIO-BCH
               IF FIO-STAT-OKS
                   MOVE FIO-DEL TO FIO-CMND
                   PERFORM GNS-FIO-BCH
                   GO TO FIN-WRT-CMN
               ELSE
                   MOVE '00' TO FIO-STAT
                   GO TO FIN-WRT-CMN.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
           IF NOT FIO-STAT-OKS
               MOVE FIO-PUT TO WSS-CMNA
           ELSE
               PERFORM RET-ALL-BCH
               MOVE FIO-MOD TO WSS-CMNA.
       CON-WRT-CMN.
           MOVE FRM-IND-TCMN IN BCH-FLD( J ) TO BCH-IND-TCMN IN BCH.
           MOVE FRM-GLS-CMND IN BCH-FLD( J ) TO BCH-GLS-CMND IN BCH.
           MOVE WSS-CMNA                     TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
       FIN-WRT-CMN.
           EXIT.

       DEL-CMN SECTION.
       INI-DEL-CMN.
           ADD I 1 GIVING J.
           IF FRM-GLS-CMND IN BCH-FLD( J ) NOT > SPACES
               GO TO FIN-DEL-CMN.
           MOVE BCH-COD-PROC IN BCH-FLD TO BCH-COD-PROC IN BCH.
           MOVE 'C'                     TO BCH-COD-TREG IN BCH.
           MOVE I                       TO BCH-NUM-CORR IN BCH.
           MOVE FIO-GET-KEY-UPD         TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-DEL-CMN.
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
       FIN-DEL-CMN.
           EXIT.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       COPY GNSBGVSM.
      *>>>>
*% END
