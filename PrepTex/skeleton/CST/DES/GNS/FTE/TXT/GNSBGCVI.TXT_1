      *Se debe aceptar
      * 07-MAY-1990 14:55
      * INT-TIPT Tipo Tasa --> X X X X XXX X XXX X
      * INT-TINT Tasa Interes Informada
      * INT-FINT Fecha del Interes
      * INT-FINI Fecha Inicio
      * INT-NVVG Numero Cuotas Iguales
      * INT-SEPA Separacion
      * INT-AFER Indicador Analisis de Feriados
      * INT-IBEG Indicador de comienzo del periodo
      * INT-VCAM Valor de Cambio
      * INT-OPEC Opera Como (P,C,D,B)
      * CVI-VFIN Valor Final ( Cap + Rea + Int ) ( si INT-OPEC = 'D' )
      * CVI-VCAP Valor Capital                   ( si INT-OPEC NOT = 'D' )

       OBT-VMTO SECTION.
       INI-OBT-VMTO.
           PERFORM PRO-IPER.
           IF INT-CMSG > SPACES
               GO TO FIN-OBT-VMTO.

           IF ( INT-SEPV = INT-SEPA ) AND ( INT-USPV = INT-IPER )
               MOVE 'S' TO CVI-S1VC
      **         IF NOT INT-AFER-YES
      ***La rutina PRO-AFER obtiene la diferencia en dias ( INT-SEPD ) y
      ***hace analisis de feriado si corresponde
      **             MOVE INT-FINI TO FEC-FECH CVI-FFTP
      **             PERFORM PRO-AFER
      **             IF INT-CMSG > SPACES
      **                 GO TO FIN-OBT-VMTO
      **             ELSE
      **                 GO TO CON-OBT-VMTO
      **         ELSE
      **             NEXT SENTENCE
           ELSE
               MOVE 'N' TO CVI-S1VC.

       SKP-OBT-VMTO.
           MOVE 0 TO CVI-SUMA CVI-FTOR CVI-SEPD.
           MOVE 1 TO CVI-FOLD CVI-NVVG.
      *JSS Como se introduce en esta caso el factor INT-IBEG.

           MOVE INT-FINI TO CVI-FTPE CVI-FFTP.
       LUP-OBT-VMTO.
           IF CVI-NVVG = 1
               IF CVI-S1VC-NEQ
                   MOVE INT-IPER TO INT-USAX
                   MOVE INT-SEPA TO INT-SPAX
                   MOVE INT-SEPD TO INT-SDAX

                   MOVE INT-SEPV TO INT-SEPA
                   MOVE INT-USPV TO INT-IPER
                   PERFORM PRO-IPER
                   IF INT-CMSG > SPACES
                       GO TO FIN-OBT-VMTO
                   ELSE
                       NEXT SENTENCE
               ELSE
                   NEXT SENTENCE
           ELSE
           IF CVI-NVVG = 2
               IF CVI-S1VC-NEQ
                   MOVE INT-USAX TO INT-IPER
                   MOVE INT-SPAX TO INT-SEPA
                   MOVE INT-SDAX TO INT-SEPD.

           MOVE CVI-FTPE TO CVI-FIPE FEC-FECH.
      *JSS-DSP
      *     DISPLAY '          PERIODO : ' CVI-NVVG.
      *     DISPLAY '                    Fecha Inicio  : ' CVI-FIPE.

           PERFORM PRO-AFER.
           IF INT-CMSG > SPACES
               GO TO FIN-OBT-VMTO.
           ADD CVI-SEPD  TO INT-SEPD.
           MOVE INT-SEPD TO CVI-SEPD.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               GO TO FIN-OBT-VMTO.
           IF INT-CVTI > SPACES AND INT-TFPR = 'F'
               MOVE CVI-DFTP TO INT-DDMA
               MOVE CVI-MFTP TO INT-MDMA
               MOVE CVI-SFTP TO INT-SDMA
               MOVE CVI-AFTP TO INT-ADMA.
           COMPUTE CVI-SUMA = CVI-SUMA + ( 1 + INT-TIPE ) ** CVI-NVVG.

      **     COMPUTE CVI-FTOR = CVI-FTOR +
      **                        1 / ( CVI-FOLD * ( 1 + INT-TIPE ) ).
      **     COMPUTE CVI-FOLD = CVI-FOLD * ( 1 + INT-TIPE ).
      *Esta rutina solo se ocupa en el caso 'FE'
           COMPUTE CVI-FTOR = CVI-FTOR + 1 / ( 1 + INT-TIPE ).
      **

           IF CVI-QTAN = CVI-NVVG
               MOVE INT-TIPE TO CVI-TIQN.

           ADD 1 TO CVI-NVVG.
           IF CVI-NVVG NOT > INT-NVVG
               GO TO LUP-OBT-VMTO.
           IF INT-OPEC = 'D'
               COMPUTE CVI-VCAP ROUNDED = CVI-VFIN / CVI-SUMA
           ELSE
      *JSS     COMPUTE CVI-VFIN ROUNDED = CVI-VCAP * CVI-SUMA.
               COMPUTE CVI-VFIN ROUNDED = CVI-VCAP / CVI-FTOR.
           GO TO FIN-OBT-VMTO.
       CON-OBT-VMTO.
           PERFORM OBT-VTIN.
           IF INT-CMSG > SPACES
               GO TO FIN-OBT-VMTO.
           MOVE INT-TIPE TO CVI-TIQN.
           MOVE INT-NVVG TO CVI-NVVG.
           MOVE INT-IBEG TO CVI-IBEG.
           PERFORM OBT-VCVI.
       FIN-OBT-VMTO.
           EXIT.

       OBT-VCVI SECTION.
       INI-OBT-VCVI.
           ADD 1 INT-TIPE GIVING CVI-TIPE.
           ADD CVI-NVVG CVI-IBEG GIVING CVI-PERI.
           IF INT-OPEC = 'D'
               IF INT-TIPE = 0
                   MULTIPLY CVI-VFIN BY CVI-NVVG GIVING CVI-VCAP
               ELSE
                   IF CVI-NVVG = 1
                       DIVIDE CVI-VFIN BY CVI-TIPE GIVING CVI-VCAP
                           ROUNDED
                   ELSE
                       COMPUTE CVI-VCAP ROUNDED =
                           CVI-VFIN * (CVI-TIPE ** CVI-NVVG - 1 ) /
                           ( INT-TIPE * CVI-TIPE ** CVI-PERI )
           ELSE
               IF INT-TIPE = 0
                   DIVIDE CVI-VCAP BY CVI-NVVG GIVING CVI-VFIN ROUNDED
               ELSE
                   IF CVI-NVVG = 1
                       MULTIPLY CVI-VCAP BY CVI-TIPE GIVING CVI-VFIN
                           ROUNDED
                   ELSE
      **                 COMPUTE CVI-VFIN ROUNDED =
      **                     CVI-VCAP * INT-TIPE * CVI-TIPE **
      **                     CVI-PERI / (CVI-TIPE ** CVI-NVVG - 1 ).
      *Esta rutina solo se ocupa en el caso 'FE'
                       COMPUTE CVI-VFIN ROUNDED =
                           CVI-VCAP * ( 1 + INT-TIPE ) / CVI-NVVG.
      **
       FIN-OBT-VCVI.
           EXIT.

       PRO-AFER SECTION.
       INI-PRO-AFER.
      *La rutina PRO-AFER obtiene la diferencia en dias ( INT-SEPD ) y
      *hace analisis de feriado si corresponde
      *
           MOVE FEC-FECH TO CVI-FIPE.
      *
           IF INT-IPER = 'D'
               MOVE FEC-SUM-DIA TO FEC-CMND
               MOVE INT-SEPA    TO FEC-NDIA
           ELSE
           IF INT-IPER = 'M'
               MOVE FEC-SUM-MES TO FEC-CMND
               MOVE INT-SEPA    TO FEC-NMES
           ELSE
           IF INT-IPER = 'A'
               MOVE FEC-SUM-ANO TO FEC-CMND
               MOVE INT-SEPA    TO FEC-NANO
           ELSE
               MOVE 'INTIPERINV' TO INT-CMSG
               GO TO FIN-PRO-AFER.

           MOVE FEC-FORM-FEC TO FEC-FORM.
      *JSS PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE MSG-COD-MENS TO INT-CMSG
               GO TO FIN-PRO-AFER.

           IF CVI-NVVG > 1
               PERFORM CHK-DIA-VEN.
           MOVE FEC-FECH TO CVI-FTPE.

      *JSS-DSP
      *     DISPLAY '                    Fecha Termino : ' CVI-FTPE.

           IF NOT INT-AFER-YES
               GO TO DIA-PRO-AFER.

           MOVE FEC-FBLK-N  TO FEC-FBLK.
           MOVE FEC-CHOY-N  TO FEC-CHOY.
           MOVE FEC-VHBL-S  TO FEC-VHBL.
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS AND NOT FEC-STAT-FER
               MOVE MSG-COD-MENS TO INT-CMSG
               GO TO FIN-PRO-AFER.

           IF NOT FEC-STAT-FER
               GO TO DIA-PRO-AFER.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-SIG-HBL  TO FEC-CMND.
      *JSS PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE MSG-COD-MENS TO INT-CMSG
               GO TO FIN-PRO-AFER.

      *JSS-DSP
      *     DISPLAY '           SIG-HBL, Fecha Termino : ' FEC-FECH.

       DIA-PRO-AFER.
           MOVE CVI-FFTP     TO FEC-FEC1.
           MOVE FEC-FECH     TO FEC-FEC2 CVI-FFTP.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
      *JSS PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE MSG-COD-MENS TO INT-CMSG
               GO TO FIN-PRO-AFER.
           MOVE FEC-NDIA TO INT-SEPD.

      *JSS-DSP
      *     DISPLAY '           DIF-DIA, Fecha INI/TER : ' INT-SEPD.
       EXT-PRO-AFER.
           MOVE SPACES TO INT-CMSG.
           MOVE SPACES TO MSG-COD-MENS IN MSG.
       FIN-PRO-AFER.
           EXIT.

       CHK-DIA-VEN SECTION.
       INI-CHK-DIA-VEN.
           IF NOT ( ( INT-IPER = 'M' OR 'A' ) AND CVI-DVEN > ZEROES AND
                    FEC-ITM1 < CVI-DVEN )
               GO TO FIN-CHK-DIA-VEN.

           IF CVI-DVEN > FEC-DMES(FEC-ITM2)
               MOVE FEC-DMES(FEC-ITM2) TO FEC-ITM1
           ELSE
               MOVE CVI-DVEN TO FEC-ITM1.

           IF FEC-ITM2 = 2
               DIVIDE FEC-ITM4 BY 4 GIVING FEC-REST REMAINDER FEC-REST
               IF ( FEC-REST NOT = 0 ) AND ( FEC-ITM1 > 28 )
                   MOVE 28 TO FEC-ITM1.
       FIN-CHK-DIA-VEN.
           EXIT.
