*%! Codigo adicional para archivo
*% IF INI_FST_KEY_APU
      *<<<< INI_FST_KEY_APU
           IF WSS-IND-USSP = 'N'
               MOVE FRM-POS-CURS TO FRM-COD-PSWO-LEN IN APU-FLD
               GO TO FIN-FST-KEY-APU.
      *>>>>
*% END
*% IF FIN_UNP_IKY_APU
      *<<<< FIN_UNP_IKY_APU
           IF WSS-IND-USSP = 'N'
              MOVE FRM-CPIM-AEY TO RUP-COD-USER-ATR IN APU-FLD
           ELSE
              MOVE FRM-CPIM-AEY TO FRM-COD-PSWO-ATR IN APU-FLD.
      *>>>>
*% END
*% IF INI_RUP_COD_USER
      *<<<< INI_RUP_COD_USER
           IF WSS-IND-USSP = 'N'
               MOVE SCR-USER TO RUP-COD-USER IN APU-FLD.
      *>>>>
*% END
*% IF RUP_COD_USER
      *<<<< RUP_COD_USER
           MOVE RUP-COD-USER IN APU-FLD TO USR-COD-USER IN USR.
           PERFORM VAL-USR.
           IF MSG-COD-MENS NOT > SPACES
               MOVE '00' TO PGM-STAT-USR
               MOVE USR-GLS-DESC IN USR TO USR-GLS-DESC IN APU-FLD
           ELSE
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               IF MSG-COD-MENS = 'COD    NEX'
                    MOVE SPACES TO USR-GLS-DESC IN APU-FLD.
      *>>>>
*% END
*% IF FIN_VAL_CON_KEY_APU 
      *<<<< FIN_VAL_CON_KEY_APU 
           IF WSS-IND-USSP = 'S'
               GO TO FIN-VAL-CON-KEY-APU.

           MOVE RUP-COD-USER IN APU-FLD TO RUP-COD-USER IN RUP.
           MOVE 99999                   TO RUP-NUM-CORR IN RUP.
           MOVE FIO-GET-LEQ             TO FIO-CMND.

           PERFORM GNS-FIO-RUP.
           IF NOT (FIO-STAT-OKS AND 
                   RUP-COD-USER IN RUP = RUP-COD-USER IN APU-FLD)
               MOVE 'RUP    NEX' TO MSG-COD-MENS
               GO TO ERR-VAL-CON-KEY-APU.
               
           IF RUP-NUM-INTE IN RUP NOT < 3
               MOVE 'INTE>=3     ' TO MSG-COD-MENS
               GO TO ERR-VAL-CON-KEY-APU.

           MOVE FIO-BEG-TRN TO FIO-CMND.
           MOVE "GNS" TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GNS-FIO-RUP.
           IF NOT FIO-STAT-OKS
               MOVE 'RUPUPDERR' TO MSG-COD-MENS
               GO TO ERR-VAL-CON-KEY-APU.
 
           IF RUP-COD-PSWD IN RUP NOT = FRM-COD-PSWO IN APU-FLD
               PERFORM SET-NUM-INTE
               MOVE FIO-MOD TO FIO-CMND
               PERFORM GNS-FIO-RUP
               IF NOT FIO-STAT-OKS
                   MOVE FIO-CHK-PNT TO FIO-CMND
                   MOVE "GNS" TO FIO-SIST
                   PERFORM GNS-FIO-TAB
                   MOVE 'ERR    PMAL' TO MSG-COD-MENS
                   GO TO ERR-VAL-CON-KEY-APU
               ELSE
                   MOVE FIO-CHK-PNT TO FIO-CMND
                   MOVE "GNS" TO FIO-SIST
                   PERFORM GNS-FIO-TAB
                   MOVE 'RUPPSWDERR' TO MSG-COD-MENS
                   GO TO ERR-VAL-CON-KEY-APU
           ELSE
               MOVE ZEROES TO RUP-NUM-INTE IN RUP
               MOVE FIO-MOD TO FIO-CMND
               PERFORM GNS-FIO-RUP
               MOVE FIO-CHK-PNT TO FIO-CMND
               MOVE "GNS" TO FIO-SIST
               PERFORM GNS-FIO-TAB
               IF NOT FIO-STAT-OKS
                   MOVE 'ERR    PMAL' TO MSG-COD-MENS
                   GO TO ERR-VAL-CON-KEY-APU.

           GO TO FIN-VAL-CON-KEY-APU.

       ERR-VAL-CON-KEY-APU.
           MOVE FRM-POS-CURS TO FRM-COD-PSWO-LEN IN APU-FLD.
           MOVE 'S' TO FRM-UCUR.
           MOVE 'GNS' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE FRM-SUAR-MAL  TO FRM-SUAR.

      *>>>>
*% END
*% IF VAL_CON_FLD_APU
      *<<<< VAL_CON_FLD_APU
           IF RUP-COD-PSWD IN APU-FLD NOT = FRM-COD-PSWV IN APU-FLD           
               MOVE 'RUP<>PSW/VER' TO MSG-COD-MENS
               GO TO ERR-VAL-CON-FLD-APU.

           MOVE RUP-COD-USER IN APU-FLD TO RUP-COD-USER IN RUP.
           MOVE 99999                   TO RUP-NUM-CORR IN RUP.
           MOVE FIO-GET-LEQ             TO FIO-CMND.

           PERFORM GNS-FIO-RUP.
           IF NOT (FIO-STAT-OKS AND 
                   RUP-COD-USER IN RUP = RUP-COD-USER IN APU-FLD)
               MOVE SPACES TO RUP
               MOVE RUP-COD-USER IN APU-FLD TO RUP-COD-USER IN RUP
               MOVE 1                       TO RUP-NUM-CORR IN RUP
           ELSE
               ADD 1                        TO RUP-NUM-CORR IN RUP.

           MOVE FIO-BEG-TRN TO FIO-CMND.
           MOVE "GNS" TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           PERFORM RET-HDR-RUP.
           MOVE RUP-COD-PSWD IN APU-FLD TO RUP-COD-PSWD IN RUP.
           MOVE 'I' TO RUP-MSC-TACC IN RUP.
           MOVE 'S' TO RUP-COD-STAT IN RUP.
           MOVE ZEROES TO RUP-NUM-INTE IN RUP.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GNS-FIO-RUP.
           MOVE FIO-CHK-PNT TO FIO-CMND.
           MOVE "GNS" TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'RUPPUTERR' TO MSG-COD-MENS
               GO TO ERR-VAL-CON-FLD-APU.

           IF WSS-IND-USSP = 'N'
               MOVE 'HBLCNFUSSPN' TO MSG-COD-MENS
           ELSE
               MOVE 'HBLCNFUSSPS' TO MSG-COD-MENS.
           MOVE 'GNS' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.

           GO TO FIN-VAL-CON-FLD-APU.

       ERR-VAL-CON-FLD-APU.
           MOVE 'GNS' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE FRM-SUAR-MAL  TO FRM-SUAR.

      *>>>>
*% END
*% IF FIN_SCR_CLRA_APU 
           IF SCR-INST =  SCR-INST-GKY
           IF WSS-IND-USSP = 'N'
               MOVE SCR-USER TO RUP-COD-USER IN APU-FLD
               MOVE RUP-COD-USER IN APU-FLD TO USR-COD-USER IN USR
               PERFORM BUS-USR
               MOVE USR-GLS-DESC IN USR TO USR-GLS-DESC IN APU-FLD.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       SET-NUM-INTE SECTION.
       INI-SET-NUM-INTE.
           ADD 1 TO RUP-NUM-INTE IN RUP.
           IF RUP-NUM-INTE IN RUP NOT < 3
               MOVE 'N' TO RUP-COD-STAT IN RUP.
       FIN-SET-NUM-INTE.
           EXIT.
      *>>>>
*% END
