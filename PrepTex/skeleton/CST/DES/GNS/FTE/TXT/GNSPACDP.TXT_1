*% IF SETTAG
*% FNCPQ = "1710_05"
*% VSNPQ = "01-00"
*% FNCPU = "1710_05"
*% VSNPU = "01-00"
*% END
*% PGM_PTC = TRUE
*% NO_TIENE_TIMESTAMP = TRUE
*% NO_HDR_CST = TRUE
*% INCLUDE 'GNSSRC:MANEJO_VSI.SRC'
*% LARGO_MI_COMMAREA = 12
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
           03  SCR-FRST.
               05  SCR-FRST-TDPU                PIC X(02).
               05  SCR-FRST-SECU                PIC 9(04).
           03  SCR-LAST.
               05  SCR-LAST-TDPU                PIC X(02).
               05  SCR-LAST-SECU                PIC 9(04).
      *>>>> FIN_SCR_VARI
*% END
*% IF WSS
      *<<<< WSS
*% IF NOT PGM_MCP
       COPY GNSWGQUE.
*% END
       01  WSS-VARI.
           03 WSS-CERRAR-PDP         VALUE 'N'       PIC X(01).
           03 WSS-LIMI                VALUE 15       PIC 9(02).
           03 WSS-TBL-TDPU.
              05 WSS-CIC-TDPU        OCCURS 17 TIMES PIC X(02).
      *>>>> WSS
*% END
*% IF PGM_MCP
*% IF INI_FIO
      *<<<< INI_FIO
           MOVE  7 TO WSS-LIMI.
      *>>>> INI_FIO
*% END
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
           MOVE LOW-VALUES TO PDP-KEY-IPDP IN PDP.
      *>>>> INI_FND_KEY
*% END
*% IF FND_KEY
      *<<<< FND_KEY
           IF SCR-CCPP = 'ING'
               MOVE '23' TO FIO-STAT
               GO TO FIN-FND-KEY.

           MOVE ZEROES TO FRM-IFLD.
           MOVE FRM-COD-FST1 IN CDP-FLD TO PDP-COD-TDPU IN PDP.
           MOVE FRM-COD-FST2 IN CDP-FLD TO PDP-NUM-SECU IN PDP.
           MOVE FIO-GET-NLS TO FIO-CMND.
       CIC-FND-KEY.
           PERFORM GNS-FIO-PDP.
           IF NOT FIO-STAT-OKS
               GO TO END-FND-KEY.
           MOVE 'S' TO WSS-CERRAR-PDP.
           IF PDP-COD-GRPO IN CDP-FLD NOT =
              PDP-COD-GRPO IN PDP
               GO TO END-FND-KEY.

           ADD 1 TO FRM-IFLD.
           IF FRM-IFLD = 1
                MOVE PDP-COD-TDPU IN PDP TO SCR-FRST-TDPU
                MOVE PDP-NUM-SECU IN PDP TO SCR-FRST-SECU.
           IF FRM-IFLD > WSS-LIMI
               GO TO FIN-FND-KEY.
      *         MOVE 'GNS' TO MSG-COD-SIST
      *         MOVE 'CDP    >LIMI' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         MOVE MSG-GLS-DESC TO FRM-MENS
      *         MOVE FIO-STAT-NEX TO FIO-STAT
      *         GO TO FIN-FND-KEY.
           MOVE PDP-COD-TDPU IN PDP TO
                FRM-COD-TDPU IN CDP-FLD(FRM-IFLD).
           MOVE PDP-NUM-SECU IN PDP TO
                FRM-NUM-SECU IN CDP-FLD(FRM-IFLD).
           MOVE PDP-COD-SIST IN PDP TO
                FRM-COD-SIST IN CDP-FLD(FRM-IFLD).
           MOVE PDP-COD-NEMO IN PDP TO
                FRM-COD-NEMO IN CDP-FLD(FRM-IFLD).
           MOVE PDP-COD-CMND IN PDP TO
                FRM-COD-CMND IN CDP-FLD(FRM-IFLD).
           MOVE PDP-COD-PROC IN PDP TO
                FRM-COD-PROC IN CDP-FLD(FRM-IFLD).
           MOVE PDP-IND-RESP IN PDP TO
                FRM-IND-RESP IN CDP-FLD(FRM-IFLD).
           MOVE PDP-COD-TDPU IN PDP TO SCR-LAST-TDPU.
           MOVE PDP-NUM-SECU IN PDP TO SCR-LAST-SECU.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO CIC-FND-KEY.
       END-FND-KEY.
           IF WSS-CERRAR-PDP = 'S'
               MOVE 'N' TO WSS-CERRAR-PDP
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM GNS-FIO-PDP.
           IF FRM-IFLD > ZEROES
               MOVE '00' TO FIO-STAT
           ELSE
               MOVE '23' TO FIO-STAT.
           GO TO FIN-FND-KEY.
      *     IF FRM-IFLD > ZEROES
      *        MOVE LOW-VALUES TO PDP-KEY-IPDP IN PDP
      *        PERFORM KEY-ALL-CDP
      *        MOVE FIO-GET-NLS TO FIO-CMND
      *        PERFORM GNS-FIO-PDP
      *        MOVE '00' TO FIO-STAT
      *     ELSE
      *         MOVE '23' TO FIO-STAT.
      *     GO TO FIN-FND-KEY.
      *>>>> FND_KEY
*% END
*% IF INI_CMN_MOD
      *<<<< INI_CMN_MOD
      *     PERFORM CMN-ELI.
           MOVE LOW-VALUES TO PDP.
           MOVE PDP-COD-GRPO IN CDP-FLD TO PDP-COD-GRPO IN PDP.
           MOVE SCR-FRST-TDPU TO PDP-COD-TDPU IN PDP.
           MOVE SCR-FRST-SECU TO PDP-NUM-SECU IN PDP.
       CIC-CMN-ELI-MOD.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GNS-FIO-PDP.
           IF NOT FIO-STAT-OKS
               MOVE '00' TO FIO-STAT
               GO TO CIC-CMN-MOD.

           MOVE FIO-END-BRW TO FIO-CMND.
           PERFORM GNS-FIO-PDP.
           IF PDP-COD-GRPO IN CDP-FLD NOT =
              PDP-COD-GRPO IN PDP
               GO TO CIC-CMN-MOD.
             
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GNS-FIO-PDP.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM GNS-FIO-PDP.

           IF PDP-COD-TDPU IN PDP = SCR-LAST-TDPU AND
              PDP-NUM-SECU IN PDP = SCR-LAST-SECU
               GO TO CIC-CMN-MOD.

           IF FIO-STAT-OKS
               GO TO CIC-CMN-ELI-MOD.
       CIC-CMN-MOD.
           PERFORM CMN-ING.
           MOVE 'GNS' TO MSG-COD-SIST.
           MOVE 'MODYES    ' TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           GO TO FIN-CMN-MOD.
      *>>>> INI_CMN_MOD
*% END
*% IF INI_CMN_ELI
      *<<<< INI_CMN_ELI
           MOVE LOW-VALUES TO PDP.
           PERFORM KEY-ALL-CDP.
       CIC-CMN-ELI.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GNS-FIO-PDP.
           IF NOT FIO-STAT-OKS
               MOVE '00' TO FIO-STAT
               GO TO FIN-CMN-ELI.
           MOVE FIO-END-BRW TO FIO-CMND.
           PERFORM GNS-FIO-PDP.

           IF PDP-COD-GRPO IN CDP-FLD NOT =
              PDP-COD-GRPO IN PDP
               GO TO FIN-CMN-ELI.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GNS-FIO-PDP.
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM GNS-FIO-PDP.
           IF FIO-STAT-OKS
               GO TO CIC-CMN-ELI
           ELSE
               GO TO FIN-CMN-ELI.
      *>>>> CMN_ELI
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
           MOVE ZEROES TO FRM-IFLD.
      *>>>> INI_CMN_ING
*% END
*% IF CMN_ING
      *<<<< CMN_ING
       CIC-CMN-ING.
           ADD 1 TO FRM-IFLD.
           IF FRM-IFLD > WSS-LIMI
               GO TO FIN-CMN-ING.
           IF FRM-COD-TDPU IN CDP-FLD(FRM-IFLD) NOT > SPACES
              GO TO CIC-CMN-ING.
           MOVE FRM-NUM-SECU IN CDP-FLD(FRM-IFLD) TO
                PDP-NUM-SECU IN PDP.
           MOVE FRM-COD-TDPU IN CDP-FLD(FRM-IFLD) TO 
                PDP-COD-TDPU IN PDP.
           MOVE FRM-COD-SIST IN CDP-FLD(FRM-IFLD) TO
                PDP-COD-SIST IN PDP.
           MOVE FRM-COD-NEMO IN CDP-FLD(FRM-IFLD) TO
                PDP-COD-NEMO IN PDP.
           MOVE FRM-COD-CMND IN CDP-FLD(FRM-IFLD) TO
                PDP-COD-CMND IN PDP.
           MOVE FRM-COD-PROC IN CDP-FLD(FRM-IFLD) TO
                PDP-COD-PROC IN PDP.
           MOVE FRM-IND-RESP IN CDP-FLD(FRM-IFLD) TO
                PDP-IND-RESP IN PDP.
      *>>>> CMN_ING
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
      *     IF NOT FIO-STAT-OKS
      *         GO TO FIN-CMN-ING.
           PERFORM ELIM-QUE.
           GO TO CIC-CMN-ING.
      *>>>> FIN_CMN_ING
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
           PERFORM ELIM-QUE.
      *>>>> FIN_CMN_MOD
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI
           PERFORM ELIM-QUE.
      *>>>> FIN_CMN_ELI
*% END
*% IF EOF
      *<<<< EOF

       ELIM-QUE SECTION.
       INI-ELIM-QUE.
           PERFORM GNS-ERR-QUE.
           MOVE EIBTRMID        TO QUE-TERM.
           MOVE 'PRV '          TO QUE-TYPE.
           MOVE 1               TO QUE-NITM.
           MOVE +3007           TO QUE-LITM.
           MOVE QUE-DEL   TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
       FIN-ELIM-QUE.
           EXIT.
*% IF NOT PGM_MCP
       COPY GNSBGQUE.
*% END
      *>>>> EOF
*% END
