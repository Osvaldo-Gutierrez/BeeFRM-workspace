      * Rutina de edicion de registros
       EPT-CARD SECTION.
       INI-EPT-CARD.
           PERFORM EPT-BTKN.
           IF EPT-PRMR = 0
               GO TO CON-EPT-CARD.

           IF EPT-FECH
               PERFORM GET-FHOY
               MOVE HOY-FHOY TO EPT-VRBO
           ELSE
           IF EPT-FDIA
               PERFORM GET-FHOY
               MOVE HOY-DHOY TO EPT-VRBO
           ELSE
           IF EPT-FMES
               PERFORM GET-FHOY
               MOVE HOY-MHOY TO EPT-VRBO
           ELSE
           IF EPT-FSGL
               PERFORM GET-FHOY
               MOVE HOY-SHOY TO EPT-VRBO
           ELSE
           IF EPT-FANO
               PERFORM GET-FHOY
               MOVE HOY-AHOY TO EPT-VRBO
           ELSE
           IF EPT-TIME
               PERFORM GET-FHOY
               MOVE HOY-HHOY TO EPT-VRBO
           ELSE
           IF EPT-HORA
               PERFORM GET-FHOY
               MOVE HOY-HHHY TO EPT-VRBO
           ELSE
           IF EPT-MINU
               PERFORM GET-FHOY
               MOVE HOY-MMHY TO EPT-VRBO
           ELSE
           IF EPT-SEGU
               PERFORM GET-FHOY
               MOVE HOY-SSHY TO EPT-VRBO
           ELSE
               PERFORM GET-VTOK.

           PERFORM BUS-LVRB.
           PERFORM PUT-VRBO.

           GO TO INI-EPT-CARD.
       CON-EPT-CARD.
           MOVE SPACES TO EPT-AUXI.
           MOVE 0 TO EPT-J.
           PERFORM EXT-DLMT VARYING EPT-I FROM 1 BY 1
                            UNTIL EPT-I > EPT-MSTR.
           MOVE EPT-AUXI TO EPT-STRN.
       FIN-EPT-CARD.
           EXIT.

       EPT-BTKN SECTION.
       INI-EPT-BTKN.
           MOVE SPACES TO EPT-TKEN.
           MOVE 0 TO EPT-PRMR EPT-ULTM EPT-PDOI.
           MOVE 1 TO EPT-I EPT-J.
       LUP-EPT-BTKN.
           IF EPT-SCHR(EPT-I) = '{'
               MOVE EPT-I TO EPT-PRMR
           ELSE
           IF EPT-SCHR(EPT-I) = '}'
               MOVE EPT-I TO EPT-ULTM
               GO TO FIN-EPT-BTKN
           ELSE
           IF EPT-SCHR(EPT-I) = '<'
               MOVE EPT-I TO EPT-PDOI
           ELSE
           IF EPT-SCHR(EPT-I) = '>'
               MOVE 0 TO EPT-PDOI.

           IF EPT-PRMR > 0 AND EPT-I > EPT-PRMR AND EPT-J NOT > EPT-MTKN
               MOVE EPT-SCHR(EPT-I) TO EPT-TCHR(EPT-J)
               ADD 1 TO EPT-J.
           ADD 1 TO EPT-I.
           IF EPT-I NOT > EPT-MSTR
               GO TO LUP-EPT-BTKN.
       FIN-EPT-BTKN.
           EXIT.

       BUS-LVRB SECTION.
       INI-BUS-LVRB.
           IF EPT-VRBO NOT > SPACES
               MOVE 0 TO EPT-LVRB
               GO TO FIN-BUS-LVRB.

           MOVE SPACES TO EPT-AUXI.
           MOVE 1 TO EPT-I.
           MOVE 0 TO EPT-J.
       SHF-BUS-LVRB.
           IF EPT-VCHR(EPT-I) > SPACES OR EPT-J > 0
               ADD 1 TO EPT-J
               MOVE EPT-VCHR(EPT-I) TO EPT-ACHR(EPT-J).
           ADD 1 TO EPT-I.
           IF EPT-I NOT > EPT-MVRB
               GO TO SHF-BUS-LVRB.
           MOVE EPT-AUXI TO EPT-VRBO.

           MOVE EPT-MVRB TO EPT-LVRB.
       LUP-BUS-LVRB.
           IF EPT-VCHR( EPT-LVRB ) NOT > SPACES
               SUBTRACT 1 FROM EPT-LVRB
               IF EPT-LVRB > 0
                   GO TO LUP-BUS-LVRB.
       FIN-BUS-LVRB.
           EXIT.

       PUT-VRBO SECTION.
       INI-PUT-VRBO.
           MOVE SPACES TO EPT-AUXI.
           IF EPT-LVRB = 0 AND EPT-PDOI > 0
               MOVE EPT-PDOI TO EPT-PRMR
               PERFORM BUS-PDOD VARYING EPT-I FROM EPT-PRMR BY 1
                                UNTIL EPT-I > EPT-MSTR.

           PERFORM PUT-LFT-VRBO VARYING EPT-I FROM 1 BY 1
                                UNTIL EPT-I = EPT-PRMR.
           PERFORM PUT-MID-VRBO VARYING EPT-I FROM 1 BY 1
                                UNTIL EPT-I > EPT-LVRB.
           IF EPT-ULTM > EPT-PRMR
               ADD 1 TO EPT-ULTM
               PERFORM PUT-RGH-VRBO VARYING EPT-I FROM EPT-ULTM BY 1
                                    UNTIL EPT-I > EPT-MSTR.
           MOVE EPT-AUXI TO EPT-STRN.
       FIN-PUT-VRBO.
           EXIT.

       BUS-PDOD SECTION.
       INI-BUS-PDOD.
           IF EPT-SCHR(EPT-I) = '>'
               MOVE EPT-I TO EPT-ULTM
               ADD 1 EPT-MSTR GIVING EPT-I
           ELSE
           IF EPT-I = EPT-MSTR
               MOVE EPT-PRMR TO EPT-ULTM.
       FIN-BUS-PDOD.
           EXIT.

       PUT-LFT-VRBO SECTION.
       INI-PUT-LFT-VRBO.
           MOVE EPT-SCHR(EPT-I) TO EPT-ACHR(EPT-I).
       FIN-PUT-LFT-VRBO.
           EXIT.

       PUT-MID-VRBO SECTION.
       INI-PUT-MID-VRBO.
           ADD EPT-PRMR EPT-I GIVING EPT-IAUX.
           SUBTRACT 1 FROM EPT-IAUX.
           IF EPT-IAUX > EPT-MSTR
               GO TO FIN-PUT-MID-VRBO.

           MOVE EPT-VCHR(EPT-I) TO EPT-ACHR(EPT-IAUX).
       FIN-PUT-MID-VRBO.
           EXIT.

       PUT-RGH-VRBO SECTION.
       INI-PUT-RGH-VRBO.
           ADD EPT-PRMR EPT-LVRB EPT-I GIVING EPT-IAUX.
           SUBTRACT EPT-ULTM FROM EPT-IAUX.
           IF EPT-IAUX > EPT-MSTR
               GO TO FIN-PUT-RGH-VRBO.

           MOVE EPT-SCHR(EPT-I) TO EPT-ACHR(EPT-IAUX).
       FIN-PUT-RGH-VRBO.
           EXIT.

       EXT-DLMT SECTION.
       INI-EXT-DLMT.
           IF NOT ( EPT-SCHR(EPT-I) = '<' OR '>' )
               ADD 1 TO EPT-J
               MOVE EPT-SCHR(EPT-I) TO EPT-ACHR(EPT-J).
       FIN-EXT-DLMT.
           EXIT.

       GET-VTOK SECTION.
       INI-GET-VTOK.   
           MOVE SPACES TO EPT-VRBO.
           MOVE 1 TO EPT-I.
           SET EPT-ITBL TO 1.
           SEARCH EPT-MTOK VARYING EPT-I
                  WHEN EPT-VTOK (EPT-ITBL) = EPT-TKEN
                  GO TO SET-GET-VTOK.
           GO TO FIN-GET-VTOK.
       SET-GET-VTOK.
           MOVE EPT-GTOK (EPT-ITBL) TO EPT-VRBO.
       FIN-GET-VTOK.
           EXIT.
