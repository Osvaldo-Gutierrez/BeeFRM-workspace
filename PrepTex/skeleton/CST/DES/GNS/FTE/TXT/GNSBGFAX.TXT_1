      * Rutina generica para submitir procesos batch desde 
      * programas de dialogo sistema de banca telefonica
       SBT-PRO-BAT SECTION.
       INI-SBT-PRO-BAT.
           MOVE SPACES TO BCH-CMSG.
           PERFORM KEY-ALL-JES.

           PERFORM GNS-ERR-QUE.
           MOVE 'JCL' TO QUE-TYPE.
           MOVE EIBTRMID TO QUE-TERM.
           IF SCR-SISG NOT > SPACES
               MOVE SCR-SIST TO SCR-SISG.


           MOVE SCR-SISG TO FIO-SIST.
           MOVE SPACES   TO BCH-COD-TRYC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
      *     MOVE FIO-STAT TO PGM-STAT-BCH.
           IF NOT FIO-STAT-OKS
               MOVE 'SERVNODISP' TO BCH-CMSG
               GO TO FIN-SBT-PRO-BAT.

      * PUT_SCR
           MOVE BCH-COD-PROC IN BCH TO BCH-COD-PROC IN JES-FLD.
           MOVE BCH-COD-CLVE IN BCH TO FRM-COD-CLVE IN JES-FLD.
           MOVE BCH-NUM-NEJM IN BCH TO FRM-NUM-NEJM IN JES-FLD.
           MOVE BCH-IND-IDEL IN BCH TO FRM-IND-IDEL IN JES-FLD.
           MOVE BCH-IND-IGIA IN BCH TO FRM-IND-IGIA IN JES-FLD.
           MOVE BCH-COD-DEST IN BCH TO FRM-COD-DEST IN JES-FLD.
           MOVE BCH-COD-CLSE IN BCH TO FRM-COD-CLSE IN JES-FLD.
           MOVE BCH-COD-FORM IN BCH TO FRM-COD-FORM IN JES-FLD.
      *    MOVE BCH-GLS-NFRM IN BCH TO FRM-GLS-NFRM IN JES-FLD.
      *    MOVE BCH-GLS-LFRM IN BCH TO FRM-GLS-LFRM IN JES-FLD.
      *    MOVE BCH-IND-IPRV IN BCH TO FRM-IND-IPRV IN JES-FLD.
           MOVE 1 TO FRM-IFLD.
       LUP-PUT-ILEE.
           MOVE BCH-IND-ILEE IN BCH(FRM-IFLD) TO
                FRM-IND-ILEE IN JES-FLD(FRM-IFLD).
           IF FRM-IFLD NOT > 8
               MOVE BCH-IND-PLNT IN BCH(FRM-IFLD) TO
                    FRM-IND-PLNT IN JES-FLD(FRM-IFLD).
           ADD 1 TO FRM-IFLD.
           IF FRM-IFLD NOT > 20
               GO TO LUP-PUT-ILEE.

           MOVE 'B' TO BCH-COD-TRYC.
           MOVE SCR-SISG    TO FIO-SIST.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
           IF FIO-STAT-OKS
               MOVE BCH-GLS-GLSA IN BCH TO FRM-GLS-GLSA IN JES-FLD
               MOVE BCH-GLS-NRPT IN BCH TO FRM-GLS-NRPT IN JES-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-GLSA IN JES-FLD
               MOVE SPACES TO FRM-GLS-NRPT IN JES-FLD.

      *<<<< FIN_PUT_BCH_JES
      *BUS-TAB busca glosa de codigo en tabla
           IF FRM-IND-IGIA IN JES-FLD > SPACES
               MOVE 'GNS'                   TO TAB-COD-SIST
               MOVE 'GIA'                   TO TAB-COD-TTAB IN TAB
               MOVE FRM-IND-IGIA IN JES-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS NOT > SPACES
                   MOVE TAB-CIC-CTAB IN TAB TO FRM-CIC-IGIA IN JES-FLD
               ELSE
                   MOVE SPACES TO FRM-CIC-IGIA IN JES-FLD
           ELSE
               MOVE SPACES TO FRM-CIC-IGIA IN JES-FLD.

      *BUS-TAB busca glosa de codigo en tabla
           IF FRM-IND-IDEL IN JES-FLD > SPACES
               MOVE 'GNS'                   TO TAB-COD-SIST
               MOVE 'IDL'                   TO TAB-COD-TTAB IN TAB
               MOVE FRM-IND-IDEL IN JES-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS NOT > SPACES
                   MOVE TAB-CIC-CTAB IN TAB TO FRM-CIC-IDEL IN JES-FLD
               ELSE
                   MOVE SPACES TO FRM-CIC-IDEL IN JES-FLD
           ELSE
               MOVE SPACES TO FRM-CIC-IDEL IN JES-FLD.

      *BUS-TAB busca glosa de codigo en tabla
           IF FRM-IND-RRPT IN JES-FLD > SPACES
               MOVE 'GNS'                   TO TAB-COD-SIST
               MOVE 'RRP'                   TO TAB-COD-TTAB IN TAB
               MOVE FRM-IND-RRPT IN JES-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS NOT > SPACES
                   MOVE TAB-CIC-CTAB IN TAB TO FRM-CIC-RRPT IN JES-FLD
               ELSE
                   MOVE SPACES TO FRM-CIC-RRPT IN JES-FLD
           ELSE
               MOVE SPACES TO FRM-CIC-RRPT IN JES-FLD.

      *BUS-TAB busca glosa de codigo en tabla
           IF FRM-COD-DEST IN JES-FLD > SPACES
               MOVE FRM-COD-DEST IN JES-FLD TO BCH-COD-DEST IN BCH
               IF BCH-COD-IDST IN BCH = 'O'
                   MOVE 'GNS'  TO TAB-COD-SIST FIO-SIST
                   MOVE 'DST'  TO TAB-COD-TTAB IN TAB
                   MOVE SPACES TO TAB-COD-CTAB IN TAB
                   PERFORM GNS-FIO-TAB
                   IF FIO-STAT-OKS AND TAB-COD-DAT1 IN TAB( 1 ) = 'O'
                       MOVE BCH-COD-OFIC IN BCH TO OFI-COD-OFIC IN OFI
                       PERFORM BUS-OFI
                       MOVE OFI-GLS-DESC IN OFI TO FRM-GLS-DEST IN
                                                                JES-FLD
                       IF MSG-COD-MENS NOT > SPACES
                           MOVE OFI-CIC-OFIC IN OFI TO FRM-CIC-DEST
                                                       IN JES-FLD
                       ELSE
                           MOVE SPACES TO FRM-CIC-DEST IN JES-FLD
                   ELSE
                       MOVE 'GNS'        TO TAB-COD-SIST
                       MOVE 'DST'        TO TAB-COD-TTAB IN TAB
                       MOVE FRM-COD-DEST IN JES-FLD TO TAB-COD-CTAB IN
                                                                    TAB
                       PERFORM BUS-TAB
                       MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-DEST IN
                                                                JES-FLD
                       IF MSG-COD-MENS NOT > SPACES
                           MOVE TAB-CIC-CTAB IN TAB TO FRM-CIC-DEST
                                                       IN JES-FLD
                       ELSE
                           MOVE SPACES TO FRM-CIC-DEST IN JES-FLD
               ELSE
                   MOVE 'GNS'                   TO TAB-COD-SIST
                   MOVE 'DST'                   TO TAB-COD-TTAB IN TAB
                   MOVE FRM-COD-DEST IN JES-FLD TO TAB-COD-CTAB IN TAB
                   PERFORM BUS-TAB
                   MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-DEST IN JES-FLD
                   IF MSG-COD-MENS NOT > SPACES
                       MOVE TAB-CIC-CTAB IN TAB TO FRM-CIC-DEST
                                                   IN JES-FLD
                   ELSE
                       MOVE SPACES TO FRM-CIC-DEST IN JES-FLD
           ELSE
               MOVE SPACES TO FRM-CIC-DEST IN JES-FLD.

      *BUS-TAB busca glosa de codigo en tabla
           IF FRM-COD-CLSE IN JES-FLD > SPACES
               MOVE 'GNS'                   TO TAB-COD-SIST
               MOVE 'CLS'                   TO TAB-COD-TTAB IN TAB
               MOVE FRM-COD-CLSE IN JES-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-CLSE IN JES-FLD
               IF MSG-COD-MENS NOT > SPACES
                   MOVE TAB-CIC-CTAB IN TAB TO FRM-CIC-CLSE IN JES-FLD
               ELSE
                   MOVE SPACES TO FRM-CIC-CLSE IN JES-FLD
           ELSE
               MOVE SPACES TO FRM-CIC-CLSE IN JES-FLD.

      *BUS-TAB busca glosa de codigo en tabla
           IF FRM-COD-FORM IN JES-FLD > SPACES
               MOVE 'GNS'                   TO TAB-COD-SIST
               MOVE 'FML'                   TO TAB-COD-TTAB IN TAB
               MOVE FRM-COD-FORM IN JES-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-FORM IN JES-FLD
               IF MSG-COD-MENS NOT > SPACES
                   MOVE TAB-CIC-CTAB IN TAB TO FRM-CIC-FORM IN JES-FLD
               ELSE
                   MOVE SPACES TO FRM-CIC-FORM IN JES-FLD
           ELSE
               MOVE SPACES TO FRM-CIC-FORM IN JES-FLD.
      *>>>>

           PERFORM UNP-DATO VARYING FRM-IFLD FROM 1 BY 1 UNTIL
                                                         FRM-IFLD > 20.


           PERFORM GNS-CHK-QUEU.
           IF QUE-STAT = QUE-STAT-NEX
               MOVE 'BATHMVS' TO BIB-BIBL
               MOVE 'GNS'     TO BIB-SIST
               PERFORM GEN-BIB.

           MOVE BCH-COD-PROC IN JES-FLD TO BCH-COD-PROC IN BCH.
           MOVE SPACES TO BCH-COD-TRYC.
           MOVE SCR-SISG    TO FIO-SIST.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
           MOVE BCH-VEC-ILEE TO WSS-VEC-ILEE.

           PERFORM RET-ALL-JES.
           MOVE 'C' TO BCH-COD-TRYC.
           MOVE SCR-SISG    TO FIO-SIST.
           MOVE FIO-FND-NLS TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
           IF FIO-STAT-OKS

               MOVE 'BATHCMM' TO BIB-BIBL
               MOVE 'GNS'     TO BIB-SIST
               PERFORM GEN-BIB

               PERFORM PUT-CMN
               MOVE SCR-SISG    TO FIO-SIST
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM GNS-FIO-BCH

               PERFORM CHK-STEP-ADC

               MOVE 'BATTCMM' TO BIB-BIBL
               MOVE 'GNS'     TO BIB-SIST
               PERFORM GEN-BIB

               MOVE 'BATACC INGOK' TO BCH-CMSG
           ELSE
               MOVE 'BATACC INGNK' TO BCH-CMSG.


           PERFORM GNS-CHK-QUEU.
           IF QUE-STAT = QUE-STAT-NEX
               MOVE 'BATPGM SUBNX' TO BCH-CMSG
               GO TO FIN-SBT-PRO-BAT.

           MOVE 'BATTMVS' TO BIB-BIBL.
           MOVE 'GNS'     TO BIB-SIST.
           PERFORM GEN-BIB.

           MOVE QUE-COLA TO JES-COLA.
           PERFORM LNK-JES.

           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           MOVE JES-STAT  TO JES-COD1.
           MOVE JES-SSTT  TO JES-COD2.
           MOVE 'JESSTAT' TO BCH-7MSG.
           MOVE JES-CODE  TO BCH-5MSG.
       FIN-SBT-PRO-BAT.
           EXIT.

       UNP-DATO SECTION.
       INI-UNP-DATO.
           IF FRM-IND-ILEE IN JES-FLD( FRM-IFLD ) = '0' OR
              FRM-IND-ILEE IN JES-FLD( FRM-IFLD ) NOT > SPACES
               GO TO FIN-UNP-DATO.

           MOVE SCR-SISG TO TAB-COD-SIST FIO-SIST.
           MOVE 'FRM'    TO TAB-COD-TTAB IN TAB.
           MOVE SPACES   TO WSS-COD-CTAB.
           MOVE 'BAT'    TO WSS-COD-CBAT.
           MOVE SCR-SISG TO WSS-COD-SIST.
           MOVE FRM-IFLD TO WSS-NUM-CORR.
           MOVE WSS-COD-CTAB TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF ( FIO-STAT-OKS ) AND ( TAB-MSC-STAT IN TAB NOT = 'N' )
               PERFORM BUS-DAT-DATO
           ELSE
               MOVE SCR-SISG TO TAB-COD-SIST FIO-SIST
               MOVE 'FRM'    TO TAB-COD-TTAB IN TAB
               MOVE SPACES   TO WSS-COD-CTAB
               MOVE 'BAT'    TO WSS-COD-CBAT
               MOVE SPACES   TO WSS-COD-SIST
               MOVE FRM-IFLD TO WSS-NUM-CORR
               MOVE WSS-COD-CTAB TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-TAB
               IF ( FIO-STAT-OKS ) AND ( TAB-MSC-STAT IN TAB NOT = 'N' )
                   PERFORM BUS-DAT-DATO
               ELSE
                   MOVE SPACES TO FRM-DAT-DATO IN JES-FLD( FRM-IFLD ).
       FIN-UNP-DATO.
           EXIT.

       PUT-CMN SECTION.
       INI-PUT-CMN.
           MOVE +80 TO QUE-LITM.
           MOVE SCR-SISG    TO FIO-SIST.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GNS-FIO-BCH.
           IF NOT ( FIO-STAT-OKS AND
                    BCH-COD-PROC IN BCH = BCH-COD-PROC IN JES-FLD AND
                    BCH-COD-TREG = 'C' )
               GO TO FIN-PUT-CMN.

           IF BCH-GLS-CMND IN BCH NOT > SPACES
               GO TO INI-PUT-CMN.

           MOVE BCH-GLS-CMND TO EDT-STRN.
           PERFORM EDT-CARD.
           MOVE EDT-STRN TO QUE-ITEM.

           IF QUE-ITEM NOT > SPACES
               GO TO INI-PUT-CMN.

           IF BCH-IND-TCMN IN BCH = 'G'
               MOVE QUE-ITEM TO BIB-BIBL
               MOVE 'GNS'    TO BIB-SIST
               PERFORM GEN-BIB
               GO TO INI-PUT-CMN.

           IF BCH-IND-TCMN IN BCH = 'B'
               MOVE QUE-ITEM TO BIB-BIBL
               MOVE SCR-SISG TO BIB-SIST
               PERFORM GEN-BIB
               GO TO INI-PUT-CMN.

           MOVE +80 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNS-PRO-QUE.

           IF BCH-IND-TCMN IN BCH = 'D' OR 'M'
              PERFORM PUT-DATA.
           GO TO INI-PUT-CMN.
       FIN-PUT-CMN.
           EXIT.

       CHK-STEP-ADC SECTION.
       INI-CHK-STEP-ADC.
           IF FRM-CIC-CLSE IN JES-FLD NOT > SPACES
               MOVE 'BATASRM' TO BIB-BIBL
               MOVE 'GNS'     TO BIB-SIST
               PERFORM GEN-BIB

               MOVE 'BATSTIM' TO BIB-BIBL
               MOVE 'GNS'     TO BIB-SIST
               PERFORM GEN-BIB.
       FIN-CHK-STEP-ADC.
           EXIT.

       PUT-DATA SECTION.
       INI-PUT-DATA.
           MOVE ZEROES TO WSS-VEC-ORDE.
           PERFORM VER-ORD VARYING WSS-K FROM 1 BY 1 UNTIL WSS-K > 20.
           PERFORM MOV-ORD VARYING WSS-L FROM 1 BY 1 UNTIL WSS-L > 20.
       FIN-PUT-DATA.
           EXIT.

       VER-ORD SECTION.
       INI-VER-ORD.
           IF WSS-ILEE(WSS-K) NOT = '0' AND WSS-ILEE(WSS-K) > SPACES
               PERFORM CON-NUM
               MOVE WSS-K TO WSS-ORDE(WSS-L).
       FIN-VER-ORD.
           EXIT.

       CON-NUM SECTION.
       INI-CON-NUM.
           IF WSS-ILEE(WSS-K) IS NUMERIC
               MOVE WSS-ILEE(WSS-K) TO WSS-L
               GO TO FIN-CON-NUM.
           IF WSS-ILEE(WSS-K) = 'A' MOVE 10 TO WSS-L
           ELSE
           IF WSS-ILEE(WSS-K) = 'B' MOVE 11 TO WSS-L
           ELSE
           IF WSS-ILEE(WSS-K) = 'C' MOVE 12 TO WSS-L
           ELSE
           IF WSS-ILEE(WSS-K) = 'D' MOVE 13 TO WSS-L
           ELSE
           IF WSS-ILEE(WSS-K) = 'E' MOVE 14 TO WSS-L
           ELSE
           IF WSS-ILEE(WSS-K) = 'F' MOVE 15 TO WSS-L
           ELSE
           IF WSS-ILEE(WSS-K) = 'G' MOVE 16 TO WSS-L
           ELSE
           IF WSS-ILEE(WSS-K) = 'H' MOVE 17 TO WSS-L
           ELSE
           IF WSS-ILEE(WSS-K) = 'I' MOVE 18 TO WSS-L
           ELSE
           IF WSS-ILEE(WSS-K) = 'J' MOVE 19 TO WSS-L
           ELSE
           IF WSS-ILEE(WSS-K) = 'K' MOVE 20 TO WSS-L.
       FIN-CON-NUM.
           EXIT.

       MOV-ORD SECTION.
       INI-MOV-ORD.
           IF WSS-ORDE(WSS-L) NOT = 0
               MOVE WSS-ORDE(WSS-L) TO WSS-K
               IF WSS-ILEE(WSS-K) NOT = '0' AND WSS-ILEE(WSS-K) > SPACES
                   MOVE FRM-DAT-DATO(WSS-K) TO QUE-ITEM
                   MOVE +80 TO QUE-LITM
                   MOVE QUE-PUT TO QUE-CMND
                   PERFORM GNS-PRO-QUE.
       FIN-MOV-ORD.
           EXIT.

       LNK-JES SECTION.
       INI-LNK-JES.
           MOVE 'M4SPOOLU' TO FRM-PROG.
           MOVE JES-CMMA   TO FRM-CMMA.
           MOVE JES-TCMA   TO FRM-TCMA.
           MOVE FRM-LNK    TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE FRM-CMMA   TO JES-CMMA.

      *     EXEC CICS LINK
      *               PROGRAM('M4SPOOLU')
      *               COMMAREA(JES-CMMA)
      *               LENGTH(JES-TCMA)
      *     END-EXEC.
       FIN-LNK-JES.
           EXIT.

       BUS-DAT-DATO SECTION.
       INI-BUS-DAT-DATO.
           MOVE TAB-GLS-DATA IN TAB TO BCH-AUXI.
           MOVE 1 TO BCH-INDX.
           SET BCH-ITBL TO 1.
           SEARCH BCH-TABL VARYING BCH-INDX 
               AT END 
                   GO TO FIN-BUS-DAT-DATO
               WHEN BCH-DOMI(BCH-ITBL) = BCH-AUXI
                   MOVE BCH-DATO(BCH-ITBL) TO 
                        FRM-DAT-DATO IN JES-FLD(FRM-IFLD).
       FIN-BUS-DAT-DATO.
           EXIT.

       RET-ALL-JES SECTION.
       INI-RET-ALL-JES.
           PERFORM KEY-ALL-JES.
           PERFORM RET-BAT-JES.
       FIN-RET-ALL-JES.
           EXIT.
       
       RET-BAT-JES SECTION.
       INI-RET-BAT-JES.
       FIN-RET-BAT-JES.
           EXIT.
       
       KEY-ALL-JES SECTION.
       INI-KEY-ALL-JES.
           PERFORM KEY-BAT-JES.
       FIN-KEY-ALL-JES.
           EXIT.
       
       KEY-BAT-JES SECTION.
       INI-KEY-BAT-JES.
           MOVE BCH-COD-PROC IN JES-FLD TO BCH-COD-PROC IN BCH.
       FIN-KEY-BAT-JES.
           EXIT.
