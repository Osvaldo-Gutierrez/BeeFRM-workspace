*%! Codigo adicional
*%! Cuando GENERE este programa para el BCI debe hacerlo en ambiente DTC
*% NO_TIENE_TIMESTAMP = TRUE
*% IF NOT PGM_BES
*% INCLUDE 'GNSSRC:MANEJO_VSI.SRC'
*%! INCLUDE 'GNSSRC:MANEJO_DTC.SRC'
*% END
*%
*% NO_HDR_CST=TRUE
*% IF WSS
      *<<<< WSS
       01  WSS-VARI.
           03 WSS-TAB-ICMD.
              05 WSS-ICMD                 OCCURS 10   PIC X(01).
           03 WSS-CMND                                PIC 9(02).
           03 WSS-CMNA                                PIC 9(02).
           03 WSS-VERS                                PIC X(03).
           03 WSS-SIND.
              05 I                                    PIC 9(02).
              05 J                                    PIC 9(02).
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           IF SCR-SISG NOT > SPACES
               MOVE SCR-SIST TO SCR-SISG.
      *>>>>
*% END
*% IF INI_CMN_ACC OR CMN_PGM
      *<<<< INI_CMN_ACC OR CMN_PGM
           MOVE SCR-SISG TO FIO-SIST.
      *>>>>
*% END
*% IF SCR_RST
      *<<<< SCR_RST
           MOVE SPACES TO WSS-TAB-ICMD.
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
           MOVE SPACES      TO RPF-KEY-TRYC.
           MOVE 'A'         TO RPF-KEY-TREG.
           MOVE SPACES      TO RPF-KEY-DARC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM FIO-RPF.
           GO TO FIN-FND-KEY.
      *>>>>
*% END
*% IF PUT_SCR
      *<<<< PUT_SCR
           MOVE 'A'         TO RPF-KEY-TREG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM FIO-RPF.
           MOVE RPF-GLS-DAUT IN RPF TO FRM-GLS-DAUT IN RPF-FLD.
           MOVE RPF-COD-CIFD IN RPF TO FRM-COD-CIFD IN RPF-FLD.
 
           MOVE 'B'         TO RPF-KEY-TREG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM FIO-RPF.
           MOVE RPF-GLS-ABAS IN RPF TO FRM-GLS-ABAS IN RPF-FLD.
 
           MOVE 'C '        TO RPF-KEY-TRYC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM FIO-RPF.
           MOVE RPF-GLS-DCMN IN RPF TO FRM-GLS-DCMN IN RPF-FLD.
           MOVE RPF-GLS-ABRT IN RPF TO FRM-GLS-ABRT IN RPF-FLD.
           MOVE RPF-GLS-UARA IN RPF TO FRM-GLS-UARA IN RPF-FLD.
 
           MOVE 'C0'        TO RPF-KEY-TRYC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM FIO-RPF.
           IF FIO-STAT-OKS
               PERFORM LEE-CRPF
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM FIO-RPF.
 
           MOVE 'P0'        TO RPF-KEY-TRYC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM FIO-RPF.
           MOVE RPF-GLS-LFRM IN RPF TO FRM-GLS-LFRM IN RPF-FLD.
           MOVE RPF-GLS-NFRM IN RPF TO FRM-GLS-NFRM IN RPF-FLD.
 
      *JSS MOVE RPF-DFLD TO FRM-DFLD.
           MOVE RPF-FLD  TO FRM-DFLD.
           GO TO FIN-PUT-SCR.
      *>>>>
*% END
*% IF CMN_ING
      *<<<< CMN_ING
           MOVE FIO-PUT TO WSS-CMND.
           PERFORM IOF-RPF.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS.
           GO TO FIN-CMN-ING.
      *>>>>
*% END
*% IF INI_CMN_MOD
      *<<<< INI_CMN_MOD
           PERFORM RET-ALL-RPF.
           MOVE FIO-MOD TO WSS-CMND.
           PERFORM IOF-RPF.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS.
           GO TO FIN-CMN-MOD.
      *>>>>
*% END
*% IF INI_CMN_ELI
      *<<<< INI_CMN_ELI
           PERFORM RET-ALL-RPF.
           MOVE RPF-COD-DPRO IN RPF-FLD  TO RPF-COD-DPRO IN RPF.
           MOVE 'A '                     TO RPF-KEY-TRYC.
           MOVE SPACES                   TO RPF-KEY-DARC.
           MOVE FIO-GET-KEY-UPD          TO FIO-CMND.
           PERFORM FIO-RPF.
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM FIO-RPF.
 
           MOVE RPF-COD-DPRO IN RPF-FLD  TO RPF-COD-DPRO IN RPF.
           MOVE 'B '                     TO RPF-KEY-TRYC.
           MOVE SPACES                   TO RPF-KEY-DARC.
           MOVE FIO-GET-KEY-UPD          TO FIO-CMND.
           PERFORM FIO-RPF.
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM FIO-RPF.
 
           MOVE RPF-COD-DPRO IN RPF-FLD  TO RPF-COD-DPRO IN RPF.
           MOVE 'C '                     TO RPF-KEY-TRYC.
           MOVE SPACES                   TO RPF-KEY-DARC.
           MOVE FIO-GET-KEY-UPD          TO FIO-CMND.
           PERFORM FIO-RPF.
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM FIO-RPF.
 
           PERFORM DEL-CRPF VARYING I FROM 0 BY 1 UNTIL I > 9.
 
           MOVE RPF-COD-DPRO IN RPF-FLD  TO RPF-COD-DPRO IN RPF.
           MOVE 'P0'                     TO RPF-KEY-TRYC.
           MOVE SPACES                   TO RPF-KEY-DARC.
           MOVE FIO-GET-KEY-UPD          TO FIO-CMND.
           PERFORM FIO-RPF.
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM FIO-RPF.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS.
           GO TO FIN-CMN-ELI.
      *>>>>
*% END
*% IF FIN_HBL_FLD
      *<<<< FIN_HBL_FLD
           IF SCR-CMND = 'COP'
               PERFORM UNP-IKY-RPF
               PERFORM FST-KEY-RPF.
      *>>>>
*% END
*% IF ABT_CMN_ACC
      *<<<< ABT_CMN_ACC
               IF SCR-CMND = 'COP'
                   MOVE 'GNS'          TO MSG-COD-SIST
                   MOVE 'REG    NOCOP' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC   TO FRM-MENS
                   GO TO FIN-CMN-ACC
               ELSE
      *>>>>
*% END
*% IF INI_CMN_ACC
      *<<<< INI_CMN_ACC
           IF SCR-CMND = 'COP'
               PERFORM CMN-ING
               IF FIO-STAT-OKS
                   MOVE 'GNS'          TO MSG-COD-SIST
                   MOVE 'REG    SICOP' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC   TO FRM-MENS
                   GO TO FIN-CMN-ACC
               ELSE
                   MOVE 'GNS'          TO MSG-COD-SIST
                   MOVE 'REG    ERCOP' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC   TO FRM-MENS
                   GO TO FIN-CMN-ACC.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       LEE-CRPF SECTION.
       INI-LEE-CRPF.
           IF NOT ( FIO-STAT-OKS AND
                    RPF-COD-DPRO IN RPF = RPF-COD-DPRO IN RPF-FLD AND
                    RPF-KEY-TREG = 'C' )
               GO TO FIN-LEE-CRPF.
           MOVE RPF-KEY-CORR TO I.
           ADD 1 I GIVING J.
           MOVE 'S' TO WSS-ICMD( J ).
           MOVE RPF-COD-CCMN IN RPF TO FRM-COD-CCMN IN RPF-FLD( J ).
           MOVE RPF-COD-CCPP IN RPF TO FRM-COD-CCPP IN RPF-FLD( J ).
           MOVE RPF-GLS-PRMT IN RPF TO FRM-GLS-PRMT IN RPF-FLD( J ).
           MOVE RPF-GLS-CONF IN RPF TO FRM-GLS-CONF IN RPF-FLD( J ).
           MOVE RPF-GLS-UARC IN RPF TO FRM-GLS-UARC IN RPF-FLD( J ).
           MOVE RPF-IND-STPP IN RPF TO FRM-IND-STPP IN RPF-FLD( J ).
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM FIO-RPF.
           GO TO INI-LEE-CRPF.
       FIN-LEE-CRPF.
           EXIT.

       IOF-RPF SECTION.
       INI-IOF-RPF.
           MOVE SPACES TO RPF.
           MOVE RPF-COD-DPRO IN RPF-FLD TO RPF-COD-DPRO IN RPF.
           MOVE 'A'                     TO RPF-KEY-TREG.
           IF WSS-CMND = FIO-MOD
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM FIO-RPF.
           MOVE FRM-GLS-DAUT IN RPF-FLD TO RPF-GLS-DAUT IN RPF.
           MOVE FRM-COD-CIFD IN RPF-FLD TO RPF-COD-CIFD IN RPF.
           MOVE WSS-CMND TO FIO-CMND.
           PERFORM FIO-RPF.
           IF NOT FIO-STAT-OKS
               GO TO FIN-IOF-RPF.
 
           MOVE SPACES TO RPF.
           MOVE RPF-COD-DPRO IN RPF-FLD TO RPF-COD-DPRO IN RPF.
           MOVE 'B'                     TO RPF-KEY-TREG.
           IF WSS-CMND = FIO-MOD
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM FIO-RPF.
           MOVE FRM-GLS-ABAS IN RPF-FLD TO RPF-GLS-ABAS IN RPF.
           MOVE WSS-CMND TO FIO-CMND.
           PERFORM FIO-RPF.
           IF NOT FIO-STAT-OKS
               GO TO FIN-IOF-RPF.
 
           MOVE SPACES TO RPF.
           MOVE RPF-COD-DPRO IN RPF-FLD TO RPF-COD-DPRO IN RPF.
           MOVE 'C '                    TO RPF-KEY-TRYC.
           IF WSS-CMND = FIO-MOD
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM FIO-RPF.
           MOVE FRM-GLS-DCMN IN RPF-FLD TO RPF-GLS-DCMN IN RPF.
           MOVE FRM-GLS-ABRT IN RPF-FLD TO RPF-GLS-ABRT IN RPF.
           MOVE FRM-GLS-UARA IN RPF-FLD TO RPF-GLS-UARA IN RPF.
           MOVE WSS-CMND TO FIO-CMND.
           PERFORM FIO-RPF.
           IF NOT FIO-STAT-OKS
               GO TO FIN-IOF-RPF.
 
           PERFORM WRT-CRPF VARYING I FROM 0 BY 1 UNTIL I > 9 OR
                                                  NOT FIO-STAT-OKS.
           IF NOT FIO-STAT-OKS
               GO TO FIN-IOF-RPF.
 
           MOVE SPACES TO RPF.
           MOVE RPF-COD-DPRO IN RPF-FLD TO RPF-COD-DPRO IN RPF.
           MOVE 'P0'                    TO RPF-KEY-TRYC.
           IF WSS-CMND = FIO-MOD
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM FIO-RPF.
           MOVE FRM-GLS-LFRM IN RPF-FLD TO RPF-GLS-LFRM IN RPF.
           MOVE FRM-GLS-NFRM IN RPF-FLD TO RPF-GLS-NFRM IN RPF.
           MOVE WSS-CMND TO FIO-CMND.
           PERFORM FIO-RPF.
       FIN-IOF-RPF.
           EXIT.

       WRT-CRPF SECTION.
       INI-WRT-CRPF.
           MOVE SPACES TO RPF.
           MOVE RPF-COD-DPRO IN RPF-FLD TO RPF-COD-DPRO IN RPF.
           MOVE 'C' TO RPF-KEY-TREG.
           MOVE I   TO RPF-KEY-CORR.
           ADD 1 I GIVING J.
           IF SCR-CCPP = 'ING' OR ( SCR-CCPP = 'ACT' AND
                                    SCR-ACTU = SCR-ACTU-ING )
               IF FRM-COD-CCMN IN RPF-FLD( J ) > SPACES
                   MOVE FIO-PUT TO WSS-CMNA
                   GO TO CON-WRT-CRPF
               ELSE
                   GO TO FIN-WRT-CRPF.
           IF FRM-COD-CCMN IN RPF-FLD( J ) NOT > SPACES
      *        IF WSS-ICMD( J ) = 'S'
                   MOVE FIO-GET-KEY-UPD TO FIO-CMND
                   PERFORM FIO-RPF
                   IF FIO-STAT-OKS
                       MOVE FIO-DEL TO FIO-CMND
                       PERFORM FIO-RPF
                       GO TO FIN-WRT-CRPF
                   ELSE
                       MOVE '00' TO FIO-STAT
                       GO TO FIN-WRT-CRPF.
      *    IF WSS-ICMD( J ) = SPACES OR WSS-ICMD( J ) = LOW-VALUES
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM FIO-RPF.
           IF NOT FIO-STAT-OKS
               MOVE FIO-PUT TO WSS-CMNA
           ELSE
               MOVE FIO-MOD TO WSS-CMNA.
       CON-WRT-CRPF.
           MOVE FRM-COD-CCMN IN RPF-FLD( J ) TO RPF-COD-CCMN IN RPF.
           MOVE FRM-COD-CCPP IN RPF-FLD( J ) TO RPF-COD-CCPP IN RPF.
           MOVE FRM-GLS-PRMT IN RPF-FLD( J ) TO RPF-GLS-PRMT IN RPF.
           MOVE FRM-GLS-CONF IN RPF-FLD( J ) TO RPF-GLS-CONF IN RPF.
           MOVE FRM-GLS-UARC IN RPF-FLD( J ) TO RPF-GLS-UARC IN RPF.
           MOVE FRM-IND-STPP IN RPF-FLD( J ) TO RPF-IND-STPP IN RPF.
           MOVE WSS-CMNA TO FIO-CMND.
           PERFORM FIO-RPF.
       FIN-WRT-CRPF.
           EXIT.

       DEL-CRPF SECTION.
       INI-DEL-CRPF.
           ADD 1 I GIVING J.
           IF FRM-COD-CCMN IN RPF-FLD( J ) NOT > SPACES
               GO TO FIN-DEL-CRPF.
           MOVE RPF-COD-DPRO IN RPF-FLD TO RPF-COD-DPRO IN RPF.
           MOVE 'C'    TO RPF-KEY-TREG.
           MOVE I      TO RPF-KEY-CORR.
           MOVE SPACES TO RPF-KEY-DARC.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM FIO-RPF.
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM FIO-RPF.
       FIN-DEL-CRPF.
           EXIT.

       FIO-RPF SECTION.
       INI-FIO-RPF.
           MOVE SCR-SISG TO FIO-SIST.
           PERFORM GNS-FIO-RPF.
       FIN-FIO-RPF.
           EXIT.

*% IF PGM_VMS
       SIN-CMND SECTION.
       INI-SIN-CMND.
           MOVE 1 TO I.
       LUP-SIN-CMND.
           IF FRM-COD-CCMN IN RPF-FLD( I ) > SPACES
               GO TO FIN-SIN-CMND.
           ADD 1 TO I.
           IF I NOT > 10
               GO TO LUP-SIN-CMND.
           CALL 'LIB$GET_SYMBOL' USING BY DESCRIPTOR 'GNS$VRS' WSS-VERS.
           IF WSS-VERS = 'V31'
               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'RPFCMNDV31OB' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
       FIN-SIN-CMND.
           EXIT.
*% ELSE
       SIN-CMND SECTION.
       INI-SIN-CMND.
       FIN-SIN-CMND.
           EXIT.
*% END

       COPY GNSBVCOD.
       COPY GNSBVTAB.
      *>>>>
*% END
*%! IF EOF_IBM
*%!      *<<<< IF EOF_IBM
*%! INCLUDE 'GNSTXT:GNSCFTAB.TXT'
*%! INCLUDE 'GNSTXT:GNSCFMSG.TXT'
*%!      *>>>>
*%! END
