*% LARGO_TOTAL_COMMAREA = 3000
*% GEN_MFC = TRUE
*% IF PGM_PQ
*% CLRMFC = "MC2ZQSCD"
*% ELSE
*% CLRMFC = "MC2ZUSCD"
*% END
*% PGM_PTC = TRUE
*% IF FIN_SCR_VARI
      *<<<<< FIN_SCR_VARI
           03 SCR-CIC-ICLI               PIC X(12).
           03 SCR-NUM-IDLC               PIC 9(03).
           03 SCR-IND-SEGU               PIC X(01).
      *>>>>>
*% END
*% IF WSS
      *<<<<< WSS
       COPY GNSWGCPT.
       COPY COLBROPC.
       COPY COLBRRDC.
       COPY SGCBRDBC.
       COPY COLBRSCD REPLACING == SCD.== BY == SDX.==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.

       01  WSS-VARI.
           03 WSS-I    VALUE 'I'      PIC X(01).
           03 WSS-L    VALUE 'L'      PIC X(01).
           03 WSS-A    VALUE 'A'      PIC X(01).
           03 WSS-D    VALUE 'D'      PIC X(01).
           03 WSS-O    VALUE 'O'      PIC X(01).
           03 WSS-P    VALUE 'P'      PIC X(01).
           03 WSS-M    VALUE 'M'      PIC X(01).
           03 WSS-V    VALUE 'V'      PIC X(01).
           03 WSS-S    VALUE 'S'      PIC X(01).
           03 WSS-ING  VALUE 'ING'    PIC X(03).
           03 WSS-MOD  VALUE 'MOD'    PIC X(03).
           03 WSS-REN  VALUE 'REN'    PIC X(03).
           03 WSS-EXT  VALUE 'EXT'    PIC X(03).
           03 WSS-INT  VALUE 'INT'    PIC X(03).
           03 WSS-ELI  VALUE 'ELI'    PIC X(03).
           03 WSS-VRF  VALUE 'VRF'    PIC X(03).
           03 WSS-ACA  VALUE 'ACA'    PIC X(03).
           03 WSS-999  VALUE 999      PIC 9(03).
           03 WSS-1    VALUE 1        PIC 9(01).
           03 WSS-COD-CAUX.
              05 WSS-COD-TOOC            PIC X(03).
              05 WSS-COD-AOOC            PIC X(03).
*% IF PGM_PU
           03 WSS-IND-CFAM               PIC X(03).
           03 WSS-IND-CFAA               PIC X(03).
           03 WSS-IND-OBLI               PIC X(01).
           03 WSS-IND-OBLA               PIC X(01).
           03 WSS-IND-DIIN               PIC X(01).
           03 WSS-IND-SEGU               PIC X(01).
           03 WSS-FEC-FINI.
              05 WSS-NUM-SINI            PIC 9(02).
              05 WSS-NUM-AINI            PIC 9(02).
              05 WSS-NUM-MINI            PIC 9(02).
              05 WSS-NUM-DINI            PIC 9(02).
           03 WSS-FEC-FFIN.
              05 WSS-NUM-SFIN            PIC 9(02).
              05 WSS-NUM-AFIN            PIC 9(02).
              05 WSS-NUM-MFIN            PIC 9(02).
              05 WSS-NUM-DFIN            PIC 9(02).
           03 AUX-FEC-FINI               PIC X(08).
*% END
      *>>>>>
*% END
*% IF FIN_FND_KEY
      *<<<<< FIN_FND_KEY
           IF NOT FIO-STAT-OKS
              GO TO FIN-FND-KEY.

           MOVE SCD-CAI-IOPC IN SCD TO OPC-CAI-IOPC IN OPC.
           MOVE SCD-IIC-IOPC IN SCD TO OPC-IIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF FIO-STAT-OKS
              MOVE OPC-COD-TOOC IN OPC TO OPC-COD-TOOC IN SCD-FLD
              MOVE OPC-COD-AOOC IN OPC TO OPC-COD-AOOC IN SCD-FLD.

           MOVE 'TAB'        TO TAB-COD-SIST FIO-SIST.
           MOVE 'TIO'        TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-TOOC IN OPC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY              TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-TOOC IN SCD-FLD.

           MOVE 'COL'                    TO TAB-COD-SIST FIO-SIST.
           MOVE 'AUX'                    TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-TOOC IN OPC      TO WSS-COD-TOOC IN WSS-VARI.
           MOVE OPC-COD-AOOC IN OPC      TO WSS-COD-AOOC IN WSS-VARI.
           MOVE WSS-COD-CAUX IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY              TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-AOOC IN SCD-FLD
           ELSE    
               MOVE SPACES              TO FRM-GLS-AOOC IN SCD-FLD.

           MOVE 'TAB'                    TO TAB-COD-SIST FIO-SIST.
           MOVE 'TSG         '           TO TAB-COD-TTAB IN TAB.
           MOVE SCD-COD-TOOC IN SCD      TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY              TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-TOOS IN SCD-FLD
           ELSE
               MOVE SPACES              TO FRM-GLS-TOOS IN SCD-FLD.

           MOVE 'TAB'                    TO TAB-COD-SIST FIO-SIST.
           MOVE 'TSE         '           TO TAB-COD-TTAB IN TAB.
           MOVE SCD-COD-AOOC IN SCD      TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY              TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-AOOS IN SCD-FLD
           ELSE
               MOVE SPACES              TO FRM-GLS-AOOS IN SCD-FLD.
              
           MOVE SPACES                  TO FRM-COD-TDEU IN SCD-FLD.
           
           IF SCD-CIC-ICLI IN SCD > SPACES
               MOVE SCD-CIC-ICLI IN SCD TO DBC-CIC-ICLI IN DBC
               MOVE SCD-CIC-ICLI IN SCD TO SCR-CIC-ICLI
               MOVE FIO-GET-KEY TO FIO-CMND                             
               PERFORM SGC-FIO-DBC                                      
               MOVE FIO-STAT TO PGM-STAT-DBC
               IF FIO-STAT-OKS                                      
                   MOVE DBC-NUM-ICLI IN DBC
                                 TO DBC-NUM-ICLI IN SCD-FLD      
                   MOVE DBC-IND-ICLI IN DBC
                                 TO DBC-IND-ICLI IN SCD-FLD
                   MOVE DBC-GLS-ICLI IN DBC
                                 TO DBC-GLS-ICLI IN SCD-FLD
                   MOVE DBC-VRF-ICLI IN DBC
                                 TO DBC-VRF-ICLI IN SCD-FLD      
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN                 
                   PERFORM CPT-BLKS                                     
                   MOVE CPT-STRN            TO 
                               DBC-GLS-NOMC IN SCD-FLD.

           IF SCD-CIC-ICLI IN SCD > SPACES
                MOVE WSS-999                 TO SCR-NUM-IDLC
                MOVE SCR-CIC-ICLI            TO RDC-CIC-ICLI IN RDC
                MOVE SCD-CAI-IOPC IN SCD     TO RDC-CAI-IOPC IN RDC
                MOVE SCD-IIC-IOPC IN SCD     TO RDC-IIC-IOPC IN RDC
                MOVE ZEROES                  TO RDC-NUM-IDLC IN RDC
                MOVE FIO-GET-KEY             TO FIO-CMND
                PERFORM COL-FIO-RDC
                IF FIO-STAT-OKS                                         
                   IF RDC-CAI-IOPC IN RDC = SCD-CAI-IOPC IN SCD AND
                      RDC-IIC-IOPC IN RDC = SCD-IIC-IOPC IN SCD 
                       IF RDC-CIC-ICLI IN RDC = SCR-CIC-ICLI
                          MOVE RDC-NUM-IDLC IN RDC TO SCR-NUM-IDLC.

           IF SCD-CIC-ICLI IN SCD > SPACES AND 
                        SCR-NUM-IDLC NOT = WSS-999
               IF SCR-NUM-IDLC = ZEROES
                   MOVE WSS-D TO FRM-COD-TDEU IN SCD-FLD
               ELSE
                   MOVE WSS-I TO FRM-COD-TDEU IN SCD-FLD.

           MOVE 'TAB'                    TO TAB-COD-SIST FIO-SIST.
           MOVE 'VLR'                    TO TAB-COD-TTAB IN TAB.
           MOVE SCD-COD-VCOC IN SCD      TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY              TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS                                         
               MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-VCOC IN SCD-FLD
           ELSE
               MOVE SPACES              TO FRM-GLS-VCOC IN SCD-FLD.
          
           MOVE 'TAB'                    TO TAB-COD-SIST FIO-SIST.
           MOVE 'CSE'                    TO TAB-COD-TTAB IN TAB.
           MOVE SCD-COD-ICCS IN SCD      TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY              TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS                                         
               MOVE TAB-GLS-DESC IN TAB  TO FRM-GLS-ICIA IN SCD-FLD
           ELSE
               MOVE SPACES               TO FRM-GLS-ICIA IN SCD-FLD.

           MOVE '00' TO FIO-STAT.

           IF (SCR-CMND = WSS-MOD OR SCR-CMND = WSS-ELI) 
                AND SCD-MSC-STAT IN SCD = WSS-A
              MOVE 'MC2' TO MSG-COD-SIST
              MOVE 'SCD   NOACA' TO MSG-COD-MENS
              MOVE WSS-S TO SCR-IERR
              MOVE SCR-STAT-CON TO SCR-STAT
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              GO TO FIN-FND-KEY.

           IF SCR-CMND = WSS-VRF AND NOT
              (SCD-MSC-STAT IN SCD = WSS-I OR 
                        SCD-MSC-STAT IN SCD = WSS-M)
              MOVE 'MC2' TO MSG-COD-SIST
              MOVE 'SCD   VRFACA' TO MSG-COD-MENS
              MOVE WSS-S TO SCR-IERR
              MOVE SCR-STAT-CON TO SCR-STAT
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              GO TO FIN-FND-KEY.

           IF SCR-CMND = WSS-ACA AND
              SCD-MSC-STAT IN SCD NOT = WSS-V 
              MOVE 'MC2' TO MSG-COD-SIST
              MOVE 'SCD   VRFACA' TO MSG-COD-MENS
              MOVE WSS-S TO SCR-IERR
              MOVE SCR-STAT-CON TO SCR-STAT
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              GO TO FIN-FND-KEY.

      *>>>>>
*% END
*% IF CMN_ING
      *<<<<< CMN_ING
           IF SCR-CMND = WSS-ING
              MOVE WSS-I TO SCD-MSC-STAT IN SCD.
      *>>>>>
*% END
*% IF CMN_MOD
      *<<<<< CMN_MOD
       IF SCR-CMND = WSS-VRF
          MOVE WSS-V TO SCD-MSC-STAT IN SCD.
       IF SCR-CMND =WSS-ACA
          MOVE WSS-A TO SCD-MSC-STAT IN SCD.
      *>>>>>
*% END
*% IF CMN_ACC
      *<<<<< CMN_ACC
       IF SCR-CMND = WSS-VRF
          MOVE WSS-V TO SCD-MSC-STAT IN SCD
          MOVE FIO-MOD TO FIO-CMND
          PERFORM MC2-FIO-SCD.
      *>>>>>
*% END
*% IF EOF
      *<<<<< EOF
*% IF PGM_PU
       COPY GNSBPFEC.
*% END
       COPY GNSBGCPT.
       COPY COLBFOPC.
       COPY COLBFRDC.
       COPY SGCBFDBC.
       COPY GNSBVCOD.
       COPY GNSBVTAB.
       COPY GNSBBTAB.
      *>>>>>
*% END
