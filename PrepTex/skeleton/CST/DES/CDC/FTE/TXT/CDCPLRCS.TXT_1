*%! Codigo adicional para archivo
*% IF WSS
      *<<<< WSS
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       01  WSS-VARI.
           03 WSS-FEC-FUAS.
              05 WSS-NUM-DUAS                     PIC 9(02).
              05 WSS-NUM-MUAS                     PIC 9(02).
              05 WSS-NUM-SUAS                     PIC 9(02).
              05 WSS-NUM-AUAS                     PIC 9(02).
           03 WSS-FEC-FHOY.
              05 WSS-NUM-DHOY                     PIC 9(02).
              05 WSS-NUM-MHOY                     PIC 9(02).
              05 WSS-NUM-SHOY                     PIC 9(02).
              05 WSS-NUM-AHOY                     PIC 9(02).
           03 WSS-COD-SISA                        PIC X(03).
           03 WSS-IND-NEXT                        PIC 9(01).
           03 WSS-NUM-TOTA      VALUE ZEROES      PIC 9(06).
           03 WSS-NUM-PASO      VALUE ZEROES      PIC 9(01)V9(05).
           03 WSS-NUM-DIFR      VALUE ZEROES      PIC 9(04).
           03 WSS-TAB-RETE.
              05 WSS-NUM-RETE   OCCURS 9          PIC 9(06).
      *>>>>
*% END
*% IF FF_RCS
      *<<<< FF_RCS
      * Calculo de Porcentajes de Linea de Totales Finales
           DIVIDE SUM-NUM-RET1 BY WSS-NUM-TOTA IN WSS-VARI
                               GIVING WSS-NUM-PASO IN WSS-VARI ROUNDED.
           MULTIPLY WSS-NUM-PASO IN WSS-VARI BY 100
                               GIVING WSS-NUM-POR1 IN WSS-RCS ROUNDED.
           DIVIDE SUM-NUM-RET2 BY WSS-NUM-TOTA IN WSS-VARI
                               GIVING WSS-NUM-PASO IN WSS-VARI ROUNDED.
           MULTIPLY WSS-NUM-PASO IN WSS-VARI BY 100
                               GIVING WSS-NUM-POR2 IN WSS-RCS ROUNDED.
           DIVIDE SUM-NUM-RET3 BY WSS-NUM-TOTA IN WSS-VARI
                               GIVING WSS-NUM-PASO IN WSS-VARI ROUNDED.
           MULTIPLY WSS-NUM-PASO IN WSS-VARI BY 100
                               GIVING WSS-NUM-POR3 IN WSS-RCS ROUNDED.
           DIVIDE SUM-NUM-RET4 BY WSS-NUM-TOTA IN WSS-VARI
                               GIVING WSS-NUM-PASO IN WSS-VARI ROUNDED.
           MULTIPLY WSS-NUM-PASO IN WSS-VARI BY 100
                               GIVING WSS-NUM-POR4 IN WSS-RCS ROUNDED.
           DIVIDE SUM-NUM-RET5 BY WSS-NUM-TOTA IN WSS-VARI
                               GIVING WSS-NUM-PASO IN WSS-VARI ROUNDED.
           MULTIPLY WSS-NUM-PASO IN WSS-VARI BY 100
                               GIVING WSS-NUM-POR5 IN WSS-RCS ROUNDED.
           DIVIDE SUM-NUM-RET6 BY WSS-NUM-TOTA IN WSS-VARI
                               GIVING WSS-NUM-PASO IN WSS-VARI ROUNDED.
           MULTIPLY WSS-NUM-PASO IN WSS-VARI BY 100
                               GIVING WSS-NUM-POR6 IN WSS-RCS ROUNDED.
           DIVIDE SUM-NUM-RET7 BY WSS-NUM-TOTA IN WSS-VARI
                               GIVING WSS-NUM-PASO IN WSS-VARI ROUNDED.
           MULTIPLY WSS-NUM-PASO IN WSS-VARI BY 100
                               GIVING WSS-NUM-POR7 IN WSS-RCS ROUNDED.
           DIVIDE SUM-NUM-RET8 BY WSS-NUM-TOTA IN WSS-VARI
                               GIVING WSS-NUM-PASO IN WSS-VARI ROUNDED.
           MULTIPLY WSS-NUM-PASO IN WSS-VARI BY 100
                               GIVING WSS-NUM-POR8 IN WSS-RCS ROUNDED.
           DIVIDE SUM-NUM-RETT BY WSS-NUM-TOTA IN WSS-VARI
                               GIVING WSS-NUM-PASO IN WSS-VARI ROUNDED.
           MULTIPLY WSS-NUM-PASO IN WSS-VARI BY 100
                               GIVING WSS-NUM-PORT IN WSS-RCS ROUNDED.
      *>>>>
*% END
*% IF INI_INP
      *<<<< INI_INP
*% IF PGM_VMS
      * INI SOLO VAX

           MOVE 'CDC'        TO FIO-SIST.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           PERFORM GNS-FIO-TAB.
           MOVE 'CDC'        TO FIO-SIST.
           MOVE FIO-INP      TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

      * FIN SOLO VAX
*% END

      * Inicializa Variables
           MOVE ZEROES TO WSS-TAB-RETE IN WSS-VARI.

           PERFORM GET-FHOY.
      *>>>>
*% END
*% IF LUP_INP
      *<<<< LUP_INP
      * Proceso de Seleccion y Clasificacion a Partir del Registro CIN
           PERFORM BUS-SRT-REG.
      *>>>>
*% END
*% IF FST_OUT
      *<<<< FST_OUT
           MOVE CIN-COD-SISA IN SRT TO WSS-COD-SISA IN WSS-VARI.
      *>>>>
*% END
*% IF LUP_OUT
      *<<<< LUP_OUT
           PERFORM SEL-REG-PRO.
           GO TO NXT-OUT-SRT.
      *>>>>
*% END
*% IF FIN_OUT
      *<<<< FIN_OUT
           PERFORM GEN-LIN-OUT.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      **************************************************************************
      * Formacion y Generacion del Registro SRT al Procesar Registros
       BUS-SRT-REG SECTION.
       INI-BUS-SRT-REG.
      * Complementa Formacion del Registro SRT
           ADD  1  TO WSS-NUM-TOTA IN WSS-VARI.

      * Completa Llenado de Campos y Genera el Registro SRT
      *     COPY COLRMRCS.
      *     RELEASE SRT.
       FIN-BUS-SRT-REG.
           EXIT.
      **************************************************************************
      * Seleccion del Registro para Proceso Mediante Sistema Asignado
       SEL-REG-PRO SECTION.
       INI-SEL-REG-PRO.
           MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.

           IF CIN-COD-SISA IN SRT NOT = WSS-COD-SISA IN WSS-VARI
               PERFORM GEN-LIN-OUT
               MOVE ZEROES              TO WSS-TAB-RETE IN WSS-VARI
               MOVE CIN-COD-SISA IN SRT TO WSS-COD-SISA IN WSS-VARI.
           PERFORM DET-RET-CIN.

           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
       FIN-SEL-REG-PRO.
           EXIT.
      **************************************************************************
      * Calcula Periodo de Retencion a HOY
       DET-RET-CIN SECTION.
       INI-DET-RET-CIN.
           PERFORM DIF-DIA.
           SUBTRACT FEC-NDIA FROM CIN-NUM-DRET IN SRT GIVING
                                            WSS-NUM-DIFR IN WSS-VARI.
           IF WSS-NUM-DIFR < 5
               ADD 1 TO WSS-NUM-RETE IN WSS-VARI(1)
           ELSE
           IF WSS-NUM-DIFR < 10
               ADD 1 TO WSS-NUM-RETE IN WSS-VARI(2)
           ELSE
           IF WSS-NUM-DIFR < 20
               ADD 1 TO WSS-NUM-RETE IN WSS-VARI(3)
           ELSE
           IF WSS-NUM-DIFR < 30
               ADD 1 TO WSS-NUM-RETE IN WSS-VARI(4)
           ELSE
           IF WSS-NUM-DIFR < 60
               ADD 1 TO WSS-NUM-RETE IN WSS-VARI(5)
           ELSE
           IF WSS-NUM-DIFR < 180
               ADD 1 TO WSS-NUM-RETE IN WSS-VARI(6)
           ELSE
           IF WSS-NUM-DIFR < 365
               ADD 1 TO WSS-NUM-RETE IN WSS-VARI(7)
           ELSE
               ADD 1 TO WSS-NUM-RETE IN WSS-VARI(8).
           ADD 1 TO WSS-NUM-RETE IN WSS-VARI(9).
       FIN-DET-RET-CIN.
           EXIT.
      **************************************************************************
      *Compara Fechas en Dias
       DIF-DIA SECTION.
       INI-DIF-DIA.
           MOVE CIN-NUM-DUAS IN SRT      TO WSS-NUM-DUAS IN WSS-VARI.
           MOVE CIN-NUM-MUAS IN SRT      TO WSS-NUM-MUAS IN WSS-VARI.
           MOVE CIN-NUM-SUAS IN SRT      TO WSS-NUM-SUAS IN WSS-VARI.
           MOVE CIN-NUM-AUAS IN SRT      TO WSS-NUM-AUAS IN WSS-VARI.
           MOVE HOY-DHOY     IN HOY-VARI TO WSS-NUM-DHOY IN WSS-VARI.
           MOVE HOY-MHOY     IN HOY-VARI TO WSS-NUM-MHOY IN WSS-VARI.
           MOVE HOY-SHOY     IN HOY-VARI TO WSS-NUM-SHOY IN WSS-VARI.
           MOVE HOY-AHOY     IN HOY-VARI TO WSS-NUM-AHOY IN WSS-VARI.
           MOVE WSS-FEC-FUAS IN WSS-VARI TO FEC-FEC1.
           MOVE WSS-FEC-FHOY IN WSS-VARI TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM PRO-FEC.
       FIN-DIF-DIA.
           EXIT.
      **************************************************************************
      * Genera Lineas de Detalle a Partir de Registro SRT Ordenado
       GEN-LIN-OUT SECTION.
       INI-GEN-LIN-OUT.
      * Mediante BUS-TAB Busca Glosa de Codigo en Tabla SIA
           IF WSS-COD-SISA IN WSS-VARI > SPACES
               MOVE 'CDC'                    TO TAB-COD-SIST
               MOVE 'SIS'                    TO TAB-COD-TTAB IN TAB
               MOVE WSS-COD-SISA IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-SISA IN WSS-RCS
           ELSE
               MOVE SPACES TO WSS-GLS-SISA IN WSS-RCS.

      * Genera Linea Detalle Periodo Retencion a Partir de Totales Almacenados
           MOVE WSS-NUM-RETE IN WSS-VARI(1) TO WSS-NUM-RET1 IN WSS-RCS.
           MOVE WSS-NUM-RETE IN WSS-VARI(2) TO WSS-NUM-RET2 IN WSS-RCS.
           MOVE WSS-NUM-RETE IN WSS-VARI(3) TO WSS-NUM-RET3 IN WSS-RCS.
           MOVE WSS-NUM-RETE IN WSS-VARI(4) TO WSS-NUM-RET4 IN WSS-RCS.
           MOVE WSS-NUM-RETE IN WSS-VARI(5) TO WSS-NUM-RET5 IN WSS-RCS.
           MOVE WSS-NUM-RETE IN WSS-VARI(6) TO WSS-NUM-RET6 IN WSS-RCS.
           MOVE WSS-NUM-RETE IN WSS-VARI(7) TO WSS-NUM-RET7 IN WSS-RCS.
           MOVE WSS-NUM-RETE IN WSS-VARI(8) TO WSS-NUM-RET8 IN WSS-RCS.
           MOVE WSS-NUM-RETE IN WSS-VARI(9) TO WSS-NUM-RETT IN WSS-RCS.
           DIVIDE WSS-NUM-RETT IN WSS-RCS BY WSS-NUM-TOTA IN WSS-VARI
                               GIVING WSS-NUM-PASO IN WSS-VARI ROUNDED.
           MULTIPLY WSS-NUM-PASO IN WSS-VARI BY 100
                               GIVING WSS-NUM-RETP IN WSS-RCS ROUNDED.
           GENERATE DL-RCS.
       FIN-GEN-LIN-OUT.
           EXIT.
      **************************************************************************

       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
      *>>>>
*% END
