       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      CDCPAREP.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.     5-APR-1990 11:21:12.

      * Programa Actualizador de archivo de campos Numero de usos y errores.

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT  CDCUYE ASSIGN TO SYS010-DA-3375-S-CDCUYE
      *MVS SELECT  CDCUYE ASSIGN TO        DA-S-CDCUYE
           SELECT  CDCUYE ASSIGN TO SYS010-UT-3410-S-CDCUYE
                ORGANIZATION         IS SEQUENTIAL
                ACCESS               IS SEQUENTIAL.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       FD  CDCUYE
           LABEL RECORDS STANDARD
           BLOCK CONTAINS 10 RECORDS
           RECORD CONTAINS 120.
       COPY CDCBRUYE.

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY CDCBRCIN.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGIFD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GNSWGSYS.
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
       01  WSS-VARI.
           03  WSS-DSP.
               05  WSS-DSP-LIN1.
                   07  WSS-DSP-ENTI             PIC X(15).
                   07  WSS-DSP-SEPA VALUE ' : ' PIC X(03).
                   07  WSS-DSP-ENTI-VAL         PIC X(30).
               05  WSS-DSP-MENS                 PIC X(40).
           03  WSS-TOT.
               05 WSS-NUM-TDCP     VALUE ZEROES PIC 9(05).
               05 WSS-NUM-TDCO     VALUE ZEROES PIC 9(05).
               05 WSS-NUM-TDCE     VALUE ZEROES PIC 9(05).
           03  WSS-KEY.
               05  WSS-KEY-UYE.
                   07  WSS-KEY-UYE-1            PIC X(03).
                   07  WSS-KEY-UYE-2            PIC X(03).
               05  WSS-KEY-NUM.
                   07  WSS-KEY-NUM-1            PIC X(03).
                   07  WSS-KEY-NUM-0            PIC X(01).
                   07  WSS-KEY-NUM-2            PIC X(03).
               05  WSS-KEY-ALF.
                   07  WSS-KEY-ALF-1            PIC X(03).
                   07  WSS-KEY-ALF-2            PIC X(03).
                   07  WSS-KEY-ALF-B            PIC X(01).

                 
       PROCEDURE DIVISION.
      *==================

       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'CDCPAREP' TO FIO-PROG.
           PERFORM BUS-FSIS.
           PERFORM INI.
       LUP-MAIN.
           IF FIO-STAT-OKS
               PERFORM MOV-UYE-CIN
               GO TO LUP-MAIN.
           PERFORM FIN.
       FIN-MAIN.
           PERFORM GNS-PRO-END.

       INI SECTION.
       INI-INI.
           OPEN INPUT CDCUYE.

           MOVE '00' TO FIO-STAT.
           READ CDCUYE AT END MOVE '10' TO FIO-STAT.
           IF NOT FIO-STAT-OKS
              DISPLAY ' ' FIO-STAT ' ARCHIVO CDCUYE VACIO, ABORTO'
              PERFORM GNS-PRO-END.
       FIN-INI.
           EXIT.

       MOV-UYE-CIN SECTION.
       INI-MOV-UYE-CIN.
           ADD 1 TO WSS-NUM-TDCP.
           MOVE '00' TO FIO-STAT.
           READ CDCUYE AT END MOVE '10' TO FIO-STAT.
           IF NOT FIO-STAT-OKS
               GO TO FIN-MOV-CRG-CIN.

           MOVE UYE-COD-ICIN  TO WSS-KEY-UYE.
           IF WSS-KEY-UYE-2 NOT NUMERIC
               MOVE WSS-KEY-UYE-1 TO WSS-KEY-ALF-1
               MOVE WSS-KEY-UYE-2 TO WSS-KEY-ALF-2
               MOVE ' '           TO WSS-KEY-NUM-B
               MOVE WSS-KEY-ALF   TO CIN-COD-ICIN
           ELSE
               MOVE WSS-KEY-UYE-1 TO WSS-KEY-NUM-1
               MOVE '0'           TO WSS-KEY-NUM-0
               MOVE WSS-KEY-UYE-2 TO WSS-KEY-NUM-2
               MOVE WSS-KEY-NUM   TO CIN-COD-ICIN.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM CDC-FIO-CIN.
           IF NOT FIO-STAT-OKS
               ADD 1 TO WSS-NUM-TDCE
               DISPLAY CIN-COD-ICIN ' : NO EXISTE CINTA'
           ELSE
               ADD 1 TO CIN-NUM-USOS
               PERFORM VAL-NUM-UYE

               MOVE FIO-MOD TO FIO-CMND
               PERFORM CDC-FIO-CIN
               IF NOT FIO-STAT-OKS
                   ADD 1 TO WSS-NUM-TDCE
                   DISPLAY CIN-COD-ICIN ' : ERROR EN ACTUALIZACION '
                                        'DE CINTA : '
               ELSE
                   ADD 1 TO WSS-NUM-TDCO
                   DISPLAY CIN-COD-ICIN ' : ACTUALIZACION DE CINTA '
                                        'OK : '.
                           
           MOVE '00' TO FIO-STAT.
       FIN-MOV-CRG-CIN.
           EXIT.

       VAL-NUM-UYE SECTION.
       INI-VAL-NUM-UYE.
           MOVE UYE-GLS-ERRO TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 4 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           CALL 'GNSPVNUM' USING NUM-VARI.
           IF NUM-STAT-OKS
               ADD NUM-NN9N TO CIN-NUM-ERRO
           ELSE
               DISPLAY ' ERROR EN NUMERO DE ERRORES EN CINTA '
                       UYE-COD-ICIN
               DISPLAY NUM-MENS.
       FIN-VAL-NUM-UYE.
           EXIT.

       DSP-UYE SECTION.
       INI-DSP-UYE.
           DISPLAY 'UYE-IND-COCA = "' UYE-IND-COCA '"'.
           DISPLAY 'UYE-GLS-FECH = "' UYE-GLS-FECH '"'.
           DISPLAY 'UYE-GLS-HORA = "' UYE-GLS-HORA '"'.
           DISPLAY 'UYE-COD-ICIN = "' UYE-COD-ICIN '"'.
           DISPLAY 'UYE-GLS-ERRO = "' UYE-GLS-ERRO '"'.
      *     DISPLAY 'UYE-GLS-DISP = "' UYE-GLS-DISP '"'.
       FIN-DSP-UYE.
           EXIT.

       DSP-ERROR SECTION.
       INI-DSP-ERROR.
           DISPLAY 'ERROR =========================================='.
           DISPLAY ' REGISTRO : ' UYE-COD-ICIN.
           DISPLAY WSS-DSP-LIN1.
           DISPLAY WSS-DSP-MENS.
           DISPLAY ' '.
       FIN-DSP-ERROR.
           EXIT.


       FIN SECTION.
       INI-FIN.
           DISPLAY ' ============================'.
           DISPLAY ' TOTAL DE CINTAS PROCESADAS = ' WSS-NUM-TDCP.
           DISPLAY ' TOTAL DE CINTAS EXITOSAS   = ' WSS-NUM-TDCO.
           DISPLAY ' TOTAL DE CINTAS ERRONEAS   = ' WSS-NUM-TDCE.
           DISPLAY ' ============================'.
       FIN-FIN.
           EXIT.

       COPY CDCBFCIN.
       COPY GNSBGDTC.
       COPY GNSBVTAB.
       COPY GNSBGIFD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.

       COPY GNSBBMSG.
       COPY GNSBBTAB.
