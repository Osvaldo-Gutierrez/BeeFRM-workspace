       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      ADMPLCMA.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    08-Jun-92 01:57 PM.

      * Programa Listador de Reporte CMA con Sort.

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
           SELECT GNSSRT         ASSIGN TO 'SYS$DISK:'.
           SELECT RPTCMA	   ASSIGN TO RPTCMA.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY ADMRRCMA.
       FD  RPTCMA LABEL RECORDS OMITTED
           REPORT IS RPT-CMA
           .

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY ADMBRCMA.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY ADMRWCMA.
       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       01  WSS-VARI.
           03 WSS-OBSE.
              05 WSS-OBS1               PIC X(60).
              05 WSS-OBS2               PIC X(60).
           03 WSS-ISPI          VALUE 0 PIC 9(03).
           03 WSS-FECH.
              05 WSS-FDIA               PIC 9(02).
              05 FILLER       VALUE '-' PIC X(01).
              05 WSS-FMES               PIC 9(02).
              05 FILLER       VALUE '-' PIC X(01).
              05 WSS-FSIG               PIC 9(02).
              05 WSS-FANO               PIC 9(02).
           03 WSS-COD-CLIE              PIC X(03).
           03 WSS-COD-PROY              PIC X(03).
           03 WSS-FEC-FLEE.
              05  WSS-NUM-DLEE          PIC 9(02).
              05  WSS-NUM-MLEE          PIC 9(02).
              05  WSS-NUM-SLEE          PIC 9(02).
              05  WSS-NUM-ALEE          PIC 9(02).
           03 WSS-FEC-FISO.
              05  WSS-NUM-SISO          PIC 9(02).
              05  WSS-NUM-AISO          PIC 9(02).
              05  WSS-NUM-MISO          PIC 9(02).
              05  WSS-NUM-DISO          PIC 9(02).
           03 WSS-FEC-FTSO.
              05  WSS-NUM-STSO          PIC 9(02).
              05  WSS-NUM-ATSO          PIC 9(02).
              05  WSS-NUM-MTSO          PIC 9(02).
              05  WSS-NUM-DTSO          PIC 9(02).
           03 WSS-FEC-FIEN. 
              05  WSS-NUM-SIEN          PIC 9(02).
              05  WSS-NUM-AIEN          PIC 9(02).
              05  WSS-NUM-MIEN          PIC 9(02).
              05  WSS-NUM-DIEN          PIC 9(02).
           03 WSS-FEC-FTEN.
              05  WSS-NUM-STEN          PIC 9(02).
              05  WSS-NUM-ATEN          PIC 9(02).
              05  WSS-NUM-MTEN          PIC 9(02).
              05  WSS-NUM-DTEN          PIC 9(02).
           03 WSS-IND-ACCS              PIC X(01).
           03 WSS-IND-EXIS   VALUE 'N'  PIC X(01).
      *>>>>

       REPORT SECTION.
      *--------------
       COPY ADMRFCMA.
           .
       COPY ADMRTCMA.

       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
       DEC-CH-CMA-CMA-COD-CLIE SECTION.
           USE BEFORE REPORTING CH-CMA-CMA-COD-CLIE.
       INI-CH-CMA-CMA-COD-CLIE.
      *<<<< CH_CMA_CMA_COD_CLIE
           IF CMA-COD-CLIE IN SRT > SPACES
      *BUS-TAB busca glosa de codigo en tabla
               MOVE 'CLI'               TO TAB-COD-TTAB IN TAB
               MOVE CMA-COD-CLIE IN SRT TO TAB-COD-CTAB IN TAB
               MOVE 'ADM'       TO FIO-SIST
               MOVE FIO-GET-KEY TO FIO-CMND
               CALL 'ADMPFTAB' USING FIO-VARI TAB
               IF NOT FIO-STAT-OKS
                   MOVE 'CODIGO INEXISTENTE' TO WSS-GLS-CLIE
               ELSE
                   MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-CLIE
           ELSE
               MOVE SPACES TO WSS-GLS-CLIE.
      *>>>>
       FIN-CH-CMA-CMA-COD-CLIE.
           EXIT.
       DEC-CF-CMA-CMA-COD-CLIE SECTION.
           USE BEFORE REPORTING CF-CMA-CMA-COD-CLIE.
       INI-CF-CMA-CMA-COD-CLIE.
       FIN-CF-CMA-CMA-COD-CLIE.
           EXIT.
       DEC-CH-CMA-CMA-COD-PROY SECTION.
           USE BEFORE REPORTING CH-CMA-CMA-COD-PROY.
       INI-CH-CMA-CMA-COD-PROY.
      *<<<< CH_CMA_CMA_COD_PROY
           IF CMA-COD-PROY IN SRT > SPACES
      *BUS-TAB busca glosa de codigo en tabla
               MOVE 'PRO'               TO TAB-COD-TTAB IN TAB
               MOVE CMA-COD-PROY IN SRT TO TAB-COD-CTAB IN TAB
               MOVE 'ADM'       TO FIO-SIST
               MOVE FIO-GET-KEY TO FIO-CMND
               CALL 'ADMPFTAB' USING FIO-VARI TAB
               IF NOT FIO-STAT-OKS
                   MOVE 'CODIGO INEXISTENTE' TO WSS-GLS-PROY
               ELSE
                   MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-PROY
           ELSE
               MOVE SPACES TO WSS-GLS-PROY.
      *>>>>
       FIN-CH-CMA-CMA-COD-PROY.
           EXIT.
       DEC-CF-CMA-CMA-COD-PROY SECTION.
           USE BEFORE REPORTING CF-CMA-CMA-COD-PROY.
       INI-CF-CMA-CMA-COD-PROY.
       FIN-CF-CMA-CMA-COD-PROY.
           EXIT.
       DEC-CF-CMA-CMA-FEC-FSOL SECTION.
           USE BEFORE REPORTING CF-CMA-CMA-FEC-FSOL.
       INI-CF-CMA-CMA-FEC-FSOL.
       FIN-CF-CMA-CMA-FEC-FSOL.
           EXIT.
       DEC-DL-CMA SECTION.
           USE BEFORE REPORTING DL-CMA.
       INI-DL-CMA.
       FIN-DL-CMA.
           EXIT.
       END DECLARATIVES.

       MAIN SECTION.
      *------------
       INI-MAIN.
           MOVE 'ADMPLCMA' TO FIO-PROG.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
      *<<<< INI
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'ADM'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'ADM'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           DISPLAY 'Cliente : '.
           ACCEPT  WSS-COD-CLIE IN WSS-VARI.
           IF WSS-COD-CLIE NOT > SPACES
               MOVE '*' TO WSS-COD-CLIE.
      *VAL-COD Valida CLIENTE
           IF WSS-COD-CLIE IN WSS-VARI NOT = '*'
               MOVE 'ADM' TO TAB-COD-SIST
               MOVE 'CLI' TO TAB-COD-TTAB IN TAB
               MOVE WSS-COD-CLIE IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = 'COD    NEX'
                   DISPLAY 'Cliente Inexistente'
                   PERFORM GNS-PRO-END.

           DISPLAY 'Proyecto : '.
           ACCEPT  WSS-COD-PROY IN WSS-VARI.
           IF WSS-COD-PROY NOT > SPACES
               MOVE '*' TO WSS-COD-PROY.
      *VAL-COD Valida PROYECTO
           IF WSS-COD-PROY IN WSS-VARI NOT = '*'
               MOVE 'ADM' TO TAB-COD-SIST
               MOVE 'PRO' TO TAB-COD-TTAB IN TAB
               MOVE WSS-COD-PROY IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               IF MSG-COD-MENS = 'COD    NEX'
                   DISPLAY 'Proyecto Inexistente'
                   PERFORM GNS-PRO-END.

           DISPLAY 'Fecha Inicio SOLICITUD DDMMSSAA / * : '.
           ACCEPT  WSS-FEC-FLEE IN WSS-VARI.
           IF WSS-FEC-FLEE IN WSS-VARI NOT > ZEROES OR
              WSS-FEC-FLEE IN WSS-VARI = '*'
               MOVE ZEROES TO WSS-FEC-FISO IN WSS-VARI
               GO TO FIN-VAL-FEC-ISO.
      *VAL-FEC Validar Fecha
           MOVE WSS-FEC-FLEE IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S  TO FEC-FBLK.
           MOVE FEC-CHOY-LE TO FEC-CHOY.
           MOVE FEC-VHBL-N  TO FEC-VHBL.
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY 'Fecha Inicio Solicitud Invalida'
               COPY GNSBGGBK.
           MOVE WSS-NUM-DLEE IN WSS-VARI TO WSS-NUM-DISO IN WSS-VARI.
           MOVE WSS-NUM-MLEE IN WSS-VARI TO WSS-NUM-MISO IN WSS-VARI.
           MOVE WSS-NUM-SLEE IN WSS-VARI TO WSS-NUM-SISO IN WSS-VARI.
           MOVE WSS-NUM-ALEE IN WSS-VARI TO WSS-NUM-AISO IN WSS-VARI.
       FIN-VAL-FEC-ISO.
           DISPLAY 'Fecha Termino SOLICITUD DDMMSSAA / * : '.
           ACCEPT  WSS-FEC-FLEE IN WSS-VARI.
           IF WSS-FEC-FLEE IN WSS-VARI = ZEROES
               NEXT SENTENCE
           ELSE
           IF WSS-FEC-FLEE IN WSS-VARI < ZEROES OR
              WSS-FEC-FLEE IN WSS-VARI = '*'
               MOVE '99999999' TO WSS-FEC-FTSO IN WSS-VARI
               GO TO FIN-VAL-FEC-TSO.
      *VAL-FEC Validar Fecha
           MOVE WSS-FEC-FLEE IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S  TO FEC-FBLK.
           MOVE FEC-CHOY-LE TO FEC-CHOY.
           MOVE FEC-VHBL-N  TO FEC-VHBL.
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY 'Fecha Termino Solicitud Invalida'
               COPY GNSBGGBK.
           MOVE WSS-NUM-DLEE IN WSS-VARI TO WSS-NUM-DTSO IN WSS-VARI.
           MOVE WSS-NUM-MLEE IN WSS-VARI TO WSS-NUM-MTSO IN WSS-VARI.
           MOVE WSS-NUM-SLEE IN WSS-VARI TO WSS-NUM-STSO IN WSS-VARI.
           MOVE WSS-NUM-ALEE IN WSS-VARI TO WSS-NUM-ATSO IN WSS-VARI.
       FIN-VAL-FEC-TSO.
           DISPLAY 'Fecha Inicio ENTREGA DDMMSSAA / * : '.
           ACCEPT  WSS-FEC-FLEE IN WSS-VARI.
           IF WSS-FEC-FLEE IN WSS-VARI NOT > ZEROES OR
              WSS-FEC-FLEE IN WSS-VARI = '*'
               MOVE ZEROES TO WSS-FEC-FIEN IN WSS-VARI
               GO TO FIN-VAL-FEC-IEN.
      *VAL-FEC Validar Fecha
           MOVE WSS-FEC-FLEE IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S  TO FEC-FBLK.
           MOVE FEC-CHOY-LE TO FEC-CHOY.
           MOVE FEC-VHBL-N  TO FEC-VHBL.
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY 'Fecha Inicio Entrega Invalida'
               COPY GNSBGGBK.
           MOVE WSS-NUM-DLEE IN WSS-VARI TO WSS-NUM-DIEN IN WSS-VARI.
           MOVE WSS-NUM-MLEE IN WSS-VARI TO WSS-NUM-MIEN IN WSS-VARI.
           MOVE WSS-NUM-SLEE IN WSS-VARI TO WSS-NUM-SIEN IN WSS-VARI.
           MOVE WSS-NUM-ALEE IN WSS-VARI TO WSS-NUM-AIEN IN WSS-VARI.
       FIN-VAL-FEC-IEN.
           DISPLAY 'Fecha Termino ENTREGA DDMMSSAA / * : '.
           ACCEPT  WSS-FEC-FLEE IN WSS-VARI.
           IF WSS-FEC-FLEE IN WSS-VARI = ZEROES
               NEXT SENTENCE
           ELSE
           IF WSS-FEC-FLEE IN WSS-VARI < ZEROES OR
              WSS-FEC-FLEE IN WSS-VARI = '*'
               MOVE '99999999' TO WSS-FEC-FTEN IN WSS-VARI
               GO TO FIN-VAL-FEC-TEN.
      *VAL-FEC Validar Fecha
           MOVE WSS-FEC-FLEE IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S  TO FEC-FBLK.
           MOVE FEC-CHOY-LE TO FEC-CHOY.
           MOVE FEC-VHBL-N  TO FEC-VHBL.
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY 'Fecha Termino Entrega Invalida'
               COPY GNSBGGBK.
           MOVE WSS-NUM-DLEE IN WSS-VARI TO WSS-NUM-DTEN IN WSS-VARI.
           MOVE WSS-NUM-MLEE IN WSS-VARI TO WSS-NUM-MTEN IN WSS-VARI.
           MOVE WSS-NUM-SLEE IN WSS-VARI TO WSS-NUM-STEN IN WSS-VARI.
           MOVE WSS-NUM-ALEE IN WSS-VARI TO WSS-NUM-ATEN IN WSS-VARI.
       FIN-VAL-FEC-TEN.
           IF WSS-FEC-FISO > WSS-FEC-FTSO
               DISPLAY 'FECHA DE INICIO DE SOLICITUD ES MAYOR '
                       'QUE LA DE TERMINO'
               PERFORM GNS-PRO-END.
           IF WSS-FEC-FIEN > WSS-FEC-FTEN
               DISPLAY 'FECHA DE INICIO DE ENTREGA ES MAYOR '
                       'QUE LA DE TERMINO'
               PERFORM GNS-PRO-END.
           IF WSS-FEC-FIEN > ZEROES OR WSS-FEC-FTEN < '99999999'
               MOVE 'E' TO WSS-IND-ACCS
           ELSE
               MOVE 'S' TO WSS-IND-ACCS.
      *>>>>
           SORT GNSSRT
       COPY ADMRSCMA.
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
           PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           PERFORM ADM-FIO-CMA.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM ADM-FIO-CMA.
       FST-INP-SRT.
      *<<<< FIN_FST_INP
           IF WSS-IND-ACCS = 'E'
               MOVE 'CMA-FEC-FREE' TO FIO-AKEY
               MOVE WSS-FEC-FIEN TO CMA-FEC-FREE IN CMA
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM ADM-FIO-CMA
               IF FIO-STAT-OKS
                   GO TO LUP-INP-SRT
               ELSE
                   DISPLAY 'NO EXISTEN REGISTROS PARA '
                           'PARAMETROS INGRESADOS'
                   PERFORM GNS-PRO-END.
           IF WSS-COD-CLIE NOT = '*'
               MOVE WSS-COD-CLIE TO CMA-COD-CLIE IN CMA
               IF WSS-COD-PROY NOT = '*'
                   MOVE WSS-COD-PROY TO CMA-COD-PROY IN CMA
                   IF WSS-FEC-FISO > ZEROES
                       MOVE WSS-FEC-FISO TO CMA-FEC-FSOL IN CMA.
           IF WSS-COD-CLIE NOT = '*'
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM ADM-FIO-CMA
               IF FIO-STAT-OKS
                   GO TO LUP-INP-SRT
               ELSE
                   DISPLAY 'NO EXISTEN REGISTROS PARA '
                           'PARAMETROS INGRESADOS'
                   PERFORM GNS-PRO-END.
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM ADM-FIO-CMA.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
           IF ( WSS-COD-CLIE NOT = '*' AND
                WSS-COD-CLIE NOT = CMA-COD-CLIE IN CMA ) OR
              ( WSS-COD-PROY NOT = '*' AND
                WSS-COD-PROY NOT = CMA-COD-PROY IN CMA ) OR
                CMA-FEC-FSOL IN CMA < WSS-FEC-FISO OR
                CMA-FEC-FSOL IN CMA > WSS-FEC-FTSO OR
                CMA-FEC-FREE IN CMA < WSS-FEC-FIEN OR
                CMA-FEC-FREE IN CMA > WSS-FEC-FTEN
               GO TO NXT-INP-SRT.
           MOVE CMA-NUM-DSOL IN CMA TO WSS-FDIA.
           MOVE CMA-NUM-MSOL IN CMA TO WSS-FMES.
           MOVE CMA-NUM-SSOL IN CMA TO WSS-FSIG.
           MOVE CMA-NUM-ASOL IN CMA TO WSS-FANO.
           MOVE WSS-FECH TO SRT-GLS-FSOL IN SRT.
      *>>>>
       MOV-INP-SRT.
       COPY ADMRMCMA.
      *<<<< RM
           MOVE 'S' TO WSS-IND-EXIS.
      *>>>>
           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
           IF WSS-IND-ACCS = 'E'
               MOVE 'CMA-FEC-FREE' TO FIO-AKEY.
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM ADM-FIO-CMA.
      *<<<< FIN_NXT_INP
           IF NOT FIO-STAT-OKS
               GO TO FIN-INP-SRT.
           IF WSS-IND-ACCS = 'E' AND
              CMA-FEC-FREE IN CMA < WSS-FEC-FIEN OR
              CMA-FEC-FREE IN CMA > WSS-FEC-FTEN
               GO TO FIN-INP-SRT.
           IF WSS-IND-ACCS = 'S' AND
              WSS-COD-CLIE NOT = '*' AND
              WSS-COD-CLIE NOT = CMA-COD-CLIE IN CMA
               GO TO FIN-INP-SRT.
           IF WSS-IND-ACCS = 'S' AND
              WSS-COD-CLIE NOT = '*' AND
              WSS-COD-PROY NOT = '*' AND
              WSS-COD-PROY NOT = CMA-COD-PROY IN CMA
               GO TO FIN-INP-SRT.
           IF WSS-IND-ACCS = 'S' AND
              WSS-COD-CLIE NOT = '*' AND
              WSS-COD-PROY NOT = '*' AND
              ( CMA-FEC-FSOL IN CMA < WSS-FEC-FISO OR
                CMA-FEC-FSOL IN CMA > WSS-FEC-FTSO )
               GO TO FIN-INP-SRT.
      *>>>>
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
      *<<<< FIN_INP
           IF WSS-IND-EXIS = 'N'
               DISPLAY 'NO EXISTEN REGISTROS PARA PARAMETROS INGRESADOS'
               PERFORM GNS-PRO-END.
      *>>>>
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM ADM-FIO-CMA.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
           OPEN OUTPUT RPTCMA.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-CMA.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
      *<<<< FST_OUT
           IF CMA-COD-CLIE IN SRT > SPACES
      *BUS-TAB busca glosa de codigo en tabla
               MOVE 'ADM' TO TAB-COD-SIST
               MOVE 'CLI' TO TAB-COD-TTAB IN TAB
               MOVE CMA-COD-CLIE IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO
                    WSS-GLS-CLIE
           ELSE
               MOVE SPACES TO WSS-GLS-CLIE.

           IF CMA-COD-PROY IN SRT > SPACES
      *BUS-TAB busca glosa de codigo en tabla
               MOVE 'ADM' TO TAB-COD-SIST
               MOVE 'PRO' TO TAB-COD-TTAB IN TAB
               MOVE CMA-COD-PROY IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO
                    WSS-GLS-PROY
           ELSE
               MOVE SPACES TO WSS-GLS-PROY.
      *>>>>
       LUP-OUT-SRT.
      *<<<< INI
           IF CMA-COD-FNSO IN SRT > SPACES
      *BUS-TAB busca glosa de codigo en tabla
               MOVE 'ADM' TO TAB-COD-SIST
               MOVE 'CLI' TO TAB-COD-TTAB IN TAB
               MOVE CMA-COD-FNSO IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO
                    WSS-GLS-FNSO
           ELSE
               MOVE SPACES TO WSS-GLS-FNSO.

           IF CMA-COD-FUNC IN SRT > SPACES
      *BUS-TAB busca glosa de codigo en tabla
               MOVE 'ADM' TO TAB-COD-SIST
               MOVE 'FUN' TO TAB-COD-TTAB IN TAB
               MOVE CMA-COD-FUNC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO
                    WSS-GLS-FUNC
           ELSE
               MOVE SPACES TO WSS-GLS-FUNC.

           IF CMA-COD-ACTI IN SRT > SPACES
      *BUS-TAB busca glosa de codigo en tabla
               MOVE 'ADM' TO TAB-COD-SIST
               MOVE 'ACT' TO TAB-COD-TTAB IN TAB
               MOVE CMA-COD-ACTI IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO
                    WSS-GLS-ACTI
           ELSE
               MOVE SPACES TO WSS-GLS-ACTI.

           IF CMA-COD-ENTI IN SRT > SPACES
      *BUS-TAB busca glosa de codigo en tabla
               MOVE 'ADM' TO TAB-COD-SIST
               MOVE 'ENT' TO TAB-COD-TTAB IN TAB
               MOVE CMA-COD-ENTI IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO
                    WSS-GLS-ENTI
           ELSE
               MOVE SPACES TO WSS-GLS-ENTI.

           IF CMA-COD-LUGA IN SRT > SPACES
      *BUS-TAB busca glosa de codigo en tabla
               MOVE 'ADM' TO TAB-COD-SIST
               MOVE 'LUG' TO TAB-COD-TTAB IN TAB
               MOVE CMA-COD-LUGA IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO
                    WSS-GLS-LUGA
           ELSE
               MOVE SPACES TO WSS-GLS-LUGA.

           MOVE CMA-GLS-OBSE IN SRT TO WSS-OBSE.
           MOVE WSS-OBS1 TO WSS-GLS-OBS1.
           MOVE WSS-OBS2 TO WSS-GLS-OBS2.
      *>>>>
       GEN-OUT-SRT.
           GENERATE DL-CMA.
       NXT-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
           TERMINATE RPT-CMA.
           CLOSE RPTCMA.
       EXT-OUT-SRT.
           EXIT.

       COPY ADMBFCMA.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.
       COPY GNSBGABT.

      *<<<< EOF
       COPY GNSBBTAB.
       COPY GNSBGMSG.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
      *>>>>
