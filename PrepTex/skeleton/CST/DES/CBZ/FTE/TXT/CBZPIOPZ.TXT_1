*%! Codigo adicional para archivo
*%! INCLUDE DE ELEMENTOS DE C.A. PARA PLATAFORMA COMERCIAL
*% INCLUDE 'GNSTXT:GNSPPPTC.TXT'
*% LARGO_TOTAL_COMMAREA = 937
*%! IF ( PGM_CHI AND PGM_BCI ) OR PGM_PER
*% IF PGM_CHI AND PGM_BCI
*%     PGM_PTC = TRUE
*% END
*% PGM_STAT_POZ = TRUE
*% IF MI_COMMAREA
      *<<<< MI_COMMAREA
       COPY CBZWGENG.
       COPY GNSWGRQA REPLACING ==01  ADR-REQA== BY ==02  SCR-RQA1==.
       COPY GNSWGRQA REPLACING ==01  ADR-REQA== BY ==02  SCR-RQA2==.
           02 SCR-KEY-IRDC                         PIC X(04).
           02 SCR-IND-MRDC                         PIC X(01).
           02 SCR-IND-MITR                         PIC X(01).
           02 SCR-IND-MCOM                         PIC X(01).
           02 SCR-IND-MCYA                         PIC X(01).
           02 SCR-IND-ACAN                         PIC X(03).
           02 SCR-MSC-TCAN                         PIC X(01).
           02 SCR-OPZ-STAT                         PIC X(01).
           02 SCR-CIC-OPEC                         PIC X(01).
           02 SCR-CIC-TCOL                         PIC X(03).
           02 SCR-CIC-TDOC                         PIC X(03).
           02 SCR-IND-OPEE                         PIC X(01).
           02 SCR-OLD-IEST                         PIC X(12).
           02 SCR-NEW-IEST                         PIC X(12).
           02 SCR-IND-PORC                         PIC X(01).
           02 SCR-COD-TINT                         PIC X(12).
           02 SCR-GLS-TIAO                         PIC X(01).
           02 SCR-GLS-CIAO                         PIC X(03).
       01  SCR-VARI-RED REDEFINES SCR-VARI.
           03 SCR-DFH    OCCURS 937      PIC X(01).
      *>>>>
*% END
*% LARGO_MI_COMMAREA = 2750
*% IF WSS
      *<<<< WSS
       COPY CBZBRROZ.
       COPY CBZBRCAZ.
       COPY CBZBRRDZ.
       COPY SGCBRDBC.
       COPY CBZWGPMP.
       COPY GNSWGPES.
       COPY CBZBRCOZ.
       COPY CBZBRCYZ.
       COPY CBZBRAUZ.
       COPY CBZBRPIZ.
       COPY CBZBRPCZ.
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROZ-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAZ-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDZ-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPZ-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOZ-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PCZ-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PIZ-REQA==.
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       COPY TABBRCAM.
       COPY GNSWGCPT.
       COPY CBZBROPZ.
       COPY CBZBRTOZ.
       01  WSS-VARI.
           03 WSS-CAI-ICIC.
              05 WSS-COD-TCIC                     PIC X(01).
              05 WSS-COD-CCIC                     PIC X(03).
           03  WSS-COD-CAUX.
               05  WSS-COD-TOOC                   PIC X(03).
               05  WSS-COD-AOOC                   PIC X(03).
           03  WSS-AUX-GSIS                       PIC X(03).
           03  WSS-AUX-IIDD                       PIC 9(02).
           03  WSS-SGV-RENO       COMP-3          PIC S9(11)V9(04).
      * Variables para conversion de monedas
           03  WSS-COD-PESO                       PIC X(06).
           03  WSS-SGV-RENO-CNV COMP-3            PIC S9(11)V9(04).
           03  WSS-COD-VCOC-CNV                   PIC X(06).
           03  WSS-MSC-TCAN                       PIC X(01).
           03  WSS-CIC-IOPV                       PIC X(12).
           03  RCAN-CAN-KEY-ICAN                  PIC X(15).
           03  WSS-TOT-RCAN                       PIC 9(04).
           03  WSS-CPT-NOMB.
               05  WSS-CPT-DESC                   PIC X(40).
               05  WSS-CPT-IOPV                   PIC X(12).
               05  WSS-CPT-DATA                   PIC X(40).
           03  WSS-CPT-NOMB-R REDEFINES WSS-CPT-NOMB PIC X(92).
      * Para parametrizar validacion de prorrogas
           03  WSS-KEY-CRP1.
               05  WSS-TIO-ANT1                   PIC X(03).
               05  WSS-AUX-ANT1                   PIC X(01).
               05  WSS-TIO-NUE1                   PIC X(03).
               05  WSS-AUX-NUE1                   PIC X(01).
               05  WSS-FILLER                     PIC X(04).
           03  WSS-KEY-CRP2 REDEFINES WSS-KEY-CRP1.
               05  WSS-TIO-ANT2                   PIC X(03).
               05  WSS-AUX-ANT2                   PIC X(03).
               05  WSS-TIO-NUE2                   PIC X(03).
               05  WSS-AUX-NUE2                   PIC X(03).
           03  WSS-COD-TIP-FLA       VALUE SPACES PIC X(03).
           03  WSS-COM-TIP-FLA       VALUE '1'    PIC X(01).
               88  WSS-ES-COM-FLA    VALUE '0'.
           03  WSS-COD-TIP-FLV       VALUE SPACES PIC X(03).
           03  WSS-COM-TIP-FLV       VALUE '1'    PIC X(01).
               88  WSS-ES-COM-FLV    VALUE '0'.
           03  WSS-COD-TIP-INF       VALUE SPACES PIC X(03).
           03  WSS-COM-TIP-INF       VALUE '1'    PIC X(01).
               88  WSS-ES-COM-INF    VALUE '0'.
           03  DCO-I                 VALUE  0     PIC 9(03).
           03  WSS-SGV-TCOM                       PIC 9(03)V9(02).
           03  WSS-FIO-STAT-FLV  VALUE SPACES     PIC X(02).
           03  WSS-COD-CTAB-EAO.
               05 WSS-COD-CTAB-ENT                PIC X(03).
               05 WSS-COD-CTAB-TIO                PIC X(03).
               05 WSS-COD-CTAB-AUX                PIC X(03).
               05 WSS-COD-CTAB-FIL                PIC X(03).
           03  WSS-TAB-GLS-DATA-EAO.
               05 WSS-TAB-GLS-DATA-EAO-1          PIC X(01).
               05 WSS-TAB-GLS-DATA-EAO-2          PIC X(03).
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           IF SCR-DESDE-CMN
               MOVE SPACES TO SCR-RQA1
                              SCR-RQA2
               MOVE 'O'    TO SCR-IND-OOD
               MOVE 1 TO SCR-IPRO
               GO TO FIN-INI-FIO.
           IF SCR-INST-EXT = WSS-INST-FTER-CIC
               MOVE WSS-INST-NULL TO SCR-INST-EXT
               PERFORM ING-FTER-CIC.
       FIN-INI-FIO.
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM CBZ-FIO-OPZ.
           IF ( NOT FIO-STAT-OKS ) AND ( SCR-CCPP = 'ING' )
               MOVE IDD-IENT(IDD-IAUX) TO WSS-AUX-GSIS
               MOVE IDD-IAUX           TO WSS-AUX-IIDD
               MOVE 'CBZ'          TO TAB-COD-SIST FIO-SIST
               MOVE 'VSN'          TO TAB-COD-TTAB IN TAB
               MOVE 'CBZBOPZNOVIG' TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-TAB
               IF FIO-STAT-OKS AND TAB-MSC-STAT IN TAB = 'S'
                   MOVE TAB-GLS-ABRV IN TAB TO IDD-IENT(WSS-AUX-IIDD)
                   MOVE FIO-GET-KEY TO FIO-CMND
                   PERFORM CBZ-FIO-OPZ
                   MOVE WSS-AUX-GSIS TO IDD-IENT(WSS-AUX-IIDD)
                   IF FIO-STAT-OKS
                       MOVE 'CBZ' TO MSG-COD-SIST
                       MOVE 'OPZBNVGYAEXI' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE '00' TO FIO-STAT
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE '23' TO FIO-STAT.
           GO TO FIN-FND-KEY.
      *>>>>
*% END
*% IF FIN_HBL_IKY OR FIN_HBL_KEY
      *<<<< FIN_HBL_IKY OR FIN_HBL_KEY
           MOVE SPACES TO SCR-OPZ-STAT.
           MOVE SPACES TO SCR-CIC-OPEC.
           MOVE SPACES TO SCR-CIC-TCOL.
           MOVE SPACES TO SCR-CIC-TDOC.
           MOVE SPACES TO SCR-IND-OPEE.
           MOVE SPACES TO SCR-OLD-IEST.
           MOVE SPACES TO SCR-NEW-IEST.
           MOVE SPACES TO SCR-IND-PORC.
           MOVE SPACES TO SCR-GLS-TIAO.
           MOVE SPACES TO SCR-GLS-CIAO.
      *>>>>
*% END
*% IF INI_HBL_FLD
      *<<<< INI_HBL_FLD
           PERFORM BUS-GLS-TEAO.
           MOVE OPZ-COD-TOOC IN OPZ-FLD TO OPZ-COD-TOOC IN OPZ.
*% END
*% IF FIN_HBL_FLD
      *<<<< FIN_HBL_FLD
           PERFORM PRO-FLD-BCI.
           IF OPZ-IND-AFER IN OPZ-FLD > SPACES
               MOVE FRM-CPIM-AEY TO OPZ-IND-AFER-ATR IN OPZ-FLD.
           IF OPZ-IND-RENO IN OPZ-FLD > SPACES
               MOVE FRM-CPIM-AEY TO OPZ-IND-RENO-ATR IN OPZ-FLD.
           IF OPZ-COD-PLCO IN OPZ-FLD > SPACES
              MOVE FRM-CPIM-AEY TO OPZ-COD-PLCO-ATR IN OPZ-FLD.
           IF OPZ-COD-PLIM IN OPZ-FLD > SPACES
              MOVE FRM-CPIM-AEY TO OPZ-COD-PLIM-ATR IN OPZ-FLD.
           IF CYZ-IND-TCYA IN OPZ-FLD > SPACES
               MOVE FRM-CPIM-AEY TO CYZ-IND-TCYA-ATR IN OPZ-FLD.
           IF OPZ-IND-RENO IN OPZ-FLD NOT > SPACES
               GO TO NOT-PRO-OPZ.

           MOVE           +3 TO OPZ-COD-OFOC-LEN IN OPZ-FLD.
           MOVE FRM-CPIM-AEY TO OPZ-COD-OFOC-ATR IN OPZ-FLD.
           MOVE FRM-CPIM-AEY TO OPZ-FEC-FCOL-ATR IN OPZ-FLD.
           IF OPZ-IND-RENO IN OPZ-FLD > SPACES
               MOVE FRM-CPIM-AEY TO OPZ-IND-RENO-ATR IN OPZ-FLD.
           IF ROZ-SGV-RENO IN OPZ-FLD > ZEROES
               MOVE FRM-CPIM-AEY TO ROZ-SGV-RENO-ATR IN OPZ-FLD.

           MOVE CAZ-MSC-CANC IN CAZ TO TAB-COD-CTAB IN TAB.

           IF  ( WSS-MSC-TCAN = 'R' AND
                 CAZ-MSC-TCAN NOT = '1' ) OR
                 WSS-MSC-TCAN = 'P' OR
              ( DBC-IND-ICLI IN OPZ-FLD = 'M' )
                 MOVE -1 TO OPZ-VAL-CRED-LEN IN OPZ-FLD
                 MOVE FRM-CPIM-AEY TO DBC-GLS-NOMC-ATR IN OPZ-FLD
                 MOVE FRM-CPIM-AEY TO DBC-NUM-ICLI-ATR IN OPZ-FLD
                 MOVE FRM-CPIM-AEY TO DBC-VRF-ICLI-ATR IN OPZ-FLD
                 MOVE FRM-CPIM-AEY TO DBC-IND-ICLI-ATR IN OPZ-FLD
                 MOVE FRM-CPIM-AEY TO DBC-GLS-ICLI-ATR IN OPZ-FLD
                 MOVE FRM-CPIM-AEY TO RDZ-NUM-DIRE-ATR IN OPZ-FLD
           ELSE
               MOVE -1 TO DBC-NUM-ICLI-LEN IN  OPZ-FLD.
       NOT-PRO-OPZ.
           MOVE OPZ-COD-VCOC IN OPZ-FLD TO POZ-COD-VCOC IN POZ.
           MOVE OPZ-COD-TOOC IN OPZ-FLD TO POZ-COD-TOOC IN POZ.
           MOVE OPZ-COD-AOOC IN OPZ-FLD TO POZ-COD-AOOC IN POZ.
           MOVE ZEROES                  TO POZ-NUM-IPOC IN POZ.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM CBZ-FIO-POZ.
           IF NOT FIO-STAT-OKS
               GO TO FIN-HBL-FLD.
           MOVE POZ-COD-TDOC IN POZ TO SCR-CIC-TDOC.
           PERFORM BUS-CIC-TDOC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-HBL-FLD.
           IF NOT ( SCR-CIC-TDOC = 'LTR' OR 'PAG' )
               MOVE FRM-CPIM-AEY TO OPZ-NUM-NPLA-ATR IN OPZ-FLD.
           IF NOT ( SCR-CIC-TDOC = 'LTR' AND
                    OPZ-IND-VSTR IN OPZ-FLD = 'N' )
               MOVE FRM-CPIM-AEY TO OPZ-NUM-VCOR-ATR IN OPZ-FLD.
           IF POZ-COD-COTO IN POZ = 'LAC'
               MOVE FRM-CPIM-AEY TO CYZ-CAI-ICYA-ATR IN OPZ-FLD
               MOVE FRM-CPIM-AEY TO CYZ-IIC-ICYA-ATR IN OPZ-FLD
               MOVE FRM-CPIM-AEY TO AUZ-CAI-ICYA-ATR IN OPZ-FLD
               MOVE FRM-CPIM-AEY TO AUZ-IIC-ICYA-ATR IN OPZ-FLD.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       BUS-CIC-TDOC SECTION.
       INI-BUS-CIC-TDOC.
           MOVE 'TAB'         TO FIO-SIST.
           MOVE 'DOC'         TO TAB-COD-TTAB IN TAB.
           MOVE SCR-CIC-TDOC  TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY   TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CODTDOCNEX  ' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-COD-MENS   TO FRM-MEN1
               MOVE SCR-CIC-TDOC   TO FRM-MEN2
               MOVE SCR-STAT-CON   TO SCR-STAT
               GO TO FIN-BUS-CIC-TDOC.
           MOVE TAB-CIC-CTAB IN TAB TO SCR-CIC-TDOC.
       FIN-BUS-CIC-TDOC.
           EXIT.

       GET-CUR-RDZ SECTION.
       INI-GET-CUR-RDZ.
           MOVE OPZ-CAI-IOPC IN OPZ TO RDZ-CAI-IOPC IN RDZ.
           MOVE OPZ-IIC-IOPC IN OPZ TO RDZ-IIC-IOPC IN RDZ.
           MOVE ZEROES              TO RDZ-NUM-IDLC IN RDZ.
           MOVE 'RDZ-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM CBZ-FIO-RDZ.
           IF NOT ( FIO-STAT-OKS AND
                    RDZ-CAI-IOPC IN RDZ = OPZ-CAI-IOPC IN OPZ AND
                    RDZ-IIC-IOPC IN RDZ = OPZ-IIC-IOPC IN OPZ AND
                    RDZ-NUM-IDLC IN RDZ = ZEROES )
               MOVE '23' TO FIO-STAT.
       FIN-GET-CUR-RDZ.
           EXIT.

       GET-NXT-RDZ SECTION.
       INI-GET-NXT-RDZ.
           MOVE SPACES TO MSG-COD-SIST.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE 'RDZ-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM CBZ-FIO-RDZ.
           IF FIO-STAT-OKS AND
              OPZ-CAI-IOPC IN OPZ = RDZ-CAI-IOPC IN RDZ AND
              OPZ-IIC-IOPC IN OPZ = RDZ-IIC-IOPC IN RDZ AND
              RDZ-NUM-IDLC IN RDZ = ZEROES
                MOVE 'M' TO SCR-IND-MRDC
                MOVE 'CBZ'          TO MSG-COD-SIST
                MOVE 'OPZ    MDDIR' TO MSG-COD-MENS
                PERFORM GET-MSG
           ELSE
                MOVE SPACES TO SCR-IND-MRDC
                PERFORM GET-CUR-RDZ.
       FIN-GET-NXT-RDZ.
           EXIT.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       BUS-GLS-TEAO SECTION.
       INI-BUS-GLS-TEAO.
           MOVE 'CBZ'                   TO FIO-SIST.
           MOVE 'EAO'                   TO TAB-COD-TTAB IN TAB.
           MOVE 'OPZ'                   TO WSS-COD-CTAB-ENT IN WSS-VARI.
           MOVE OPZ-COD-TOOC IN OPZ-FLD TO WSS-COD-CTAB-TIO IN WSS-VARI.
           MOVE OPZ-COD-AOOC IN OPZ-FLD TO WSS-COD-CTAB-AUX IN WSS-VARI.
           MOVE  SPACES                 TO WSS-COD-CTAB-FIL IN WSS-VARI.
       LUP-BUS-GLS-TEAO.
           MOVE WSS-COD-CTAB-EAO     TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY          TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               IF NOT WSS-COD-CTAB-AUX IN WSS-VARI = '*'
                   MOVE '*'      TO WSS-COD-CTAB-AUX IN WSS-VARI
                   GO TO LUP-BUS-GLS-TEAO
               ELSE 
                   GO TO FIN-BUS-GLS-TEAO.
           IF TAB-IND-VIGE IN TAB = 'N'
               GO TO FIN-BUS-GLS-TEAO.
           MOVE TAB-GLS-DATA IN TAB TO WSS-TAB-GLS-DATA-EAO IN WSS-VARI.
           MOVE WSS-TAB-GLS-DATA-EAO-1 IN WSS-VARI TO SCR-GLS-TIAO.
           MOVE WSS-TAB-GLS-DATA-EAO-2 IN WSS-VARI TO SCR-GLS-CIAO.
       FIN-BUS-GLS-TEAO.
           EXIT.
       COPY GNSBGPES.
       COPY TABBFCAM.
       COPY CBZBFCAZ.
       COPY CBZBFROZ.
       COPY SGCBFDBC.
       COPY CBZBFRDZ.
       COPY CBZBFTOZ.
       COPY CBZBFOPZ.
       COPY GNSBGCPT.
       COPY CBZBFPIZ.
       COPY CBZBFPCZ.
       PRO-FLD-BCI SECTION.
       INI-PRO-FLD-BCI.
           MOVE 'CBZ' TO TAB-COD-SIST FIO-SIST.
           MOVE 'VSN' TO TAB-COD-TTAB IN TAB.
           MOVE 'BCI    PCOPZ' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB
           IF ( NOT FIO-STAT-OKS) OR
              TAB-IND-VIGE IN TAB = 'N' 
               MOVE FRM-CPIM-AEY TO OPZ-IND-RENO-ATR IN OPZ-FLD
               MOVE FRM-CPIM-AEY TO OPZ-VAL-GAST-ATR IN OPZ-FLD
               MOVE FRM-CPIM-AEY TO OPZ-SGV-LIQU-ATR IN OPZ-FLD.
       FIN-PRO-FLD-BCI.
           EXIT.


       ING-FTER-CIC SECTION.
       INI-ING-FTER-CIC.
           PERFORM ING-SETE.
           MOVE SCR-INST-GKY TO SCR-INST.
           PERFORM HBL-IKY.
           PERFORM SCR-CLRA-OPZ.
           PERFORM EDT-KEY-OPZ.
           PERFORM EDT-FLD-OPZ.
           MOVE SCR-MENS-EXT TO OPZ-GLS-MENS.
           MOVE SPACES TO SCR-CIC-IOPC
                          SCR-VEC-ENG
                          SCR-VEC-FST
                          SCR-IND-EOV
                          SCR-INST-EXT
                          SCR-MENS-EXT.
           PERFORM SCR-INIT.
           PERFORM SCR-EXIT.
       FIN-ING-FTER-CIC.
           EXIT.

       ING-SETE SECTION.
       INI-ING-SETE.
           PERFORM CRG-TBL-ENG.
           MOVE WSS-NTRN(SCR-IPRO) TO SCR-NTRN.
           MOVE WSS-PROG(SCR-IPRO) TO SCR-PROG.
           MOVE WSS-NMAP(SCR-IPRO) TO SCR-NMAP.
           MOVE WSS-NLIB(SCR-IPRO) TO SCR-NLIB.

           MOVE WSS-NTRV(SCR-IPRO) TO SCR-NTRV.
           MOVE WSS-PROV(SCR-IPRO) TO SCR-PROV.
       FIN-ING-SETE.
           EXIT.

       SCR-INIT SECTION.
       INI-SCR-INIT.
           MOVE 3  TO FRM-PLIN.
           MOVE 19 TO FRM-NLIN.
           MOVE FRM-CLR-FRM TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE FRM-SINI-DBNF TO FRM-SINI.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE OPZ-FLD TO FRM-DFLD.
           MOVE FRM-INI TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-INIT.
           EXIT.
       COPY CBZBGMPT.
      *>>>>
*% END
