       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      SGCPLDBE.
       AUTHOR.          CONSIST.

      * Programa Listador de Reporte DBE con Sort.

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *DOS SELECT RPTDBE         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTDBE         ASSIGN TO        UT-S-RPTDBE.
           SELECT RPTDBE         ASSIGN TO SYS011-UR-1403-S.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY SGCRRDBE.
       FD  RPTDBE LABEL RECORDS OMITTED
           REPORT IS RPT-DBE
           .

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY SGCBRDBC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGIFD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY SGCRWDBE.
       COPY GNSWGSYS.
      *<<<<
       COPY GNSBRTAB.
       COPY GNSBRMSC.
       COPY GNSBRMSG.
       COPY GNSWGCPT.
       COPY GNSWVPPH.
       COPY TABBROFI.
       COPY TABBRUSR.
       COPY SGCBRDCE.
       COPY SGCBRRCD.
       COPY SGCBRREC.
       COPY SGCRWREC.
       COPY SGCRWDIR.
       COPY SGCWVDBC.
       COPY SGCWVPPU.
      *>>>>
      *<<<<
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-REC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
      *>>>>

       REPORT SECTION.
      *--------------
       COPY SGCRFDBE.
           .
       COPY SGCRTDBE.
      *<<<<
       COPY SGCRTREC.
       COPY SGCRTDIR.
      *>>>>

       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
       DEC-CH-DBE-DBC-NUM-ICLI SECTION.
           USE BEFORE REPORTING CH-DBE-DBC-NUM-ICLI.
       INI-CH-DBE-DBC-NUM-ICLI.
       FIN-CH-DBE-DBC-NUM-ICLI.
           EXIT.
       DEC-PH-DBE SECTION.
           USE BEFORE REPORTING PH-DBE.
       INI-PH-DBE.
      *<<<<
       COPY GNSBGPPH.
      *>>>>
       FIN-PH-DBE.
           EXIT.
       END DECLARATIVES.

       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'SGCPLDBE' TO FIO-PROG.
           PERFORM BUS-FSIS.
           SORT GNSSRT
       COPY SGCRSDBE.
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
       COPY GNSBGGBK.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<<
           PERFORM BUS-PPU.
           IF MSG-COD-MENS > SPACES
               DISPLAY MSG-GLS-DESC
               GOBACK.
           PERFORM CIC-PPU.
           IF MSG-COD-MENS > SPACES
               DISPLAY MSG-GLS-DESC
               GOBACK.

           DISPLAY 'Inicio de Captura de Parametros'.

           PERFORM GET-PAR.
           IF WSS-CIC-SEL1 = 'C' AND DBC-IND-TICL IN DBC NOT = 'E'
      *GET-MSG Busca mensaje en tabla
               MOVE 'SGC'        TO MSG-COD-SIST
               MOVE 'CLI    PER' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC
               GOBACK.

           DISPLAY 'REC-COD-RBCO'.
           MOVE 'SGC' TO TAB-COD-SIST.
           MOVE 'REC' TO TAB-CIC-TTAB IN TAB.
           MOVE 'RB'  TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               DISPLAY MSG-GLS-DESC
               GOBACK.
           MOVE TAB-COD-CTAB TO REC-COD-RBCO IN REC-VARI.

           DISPLAY 'REC-COD-REPR'.
           MOVE 'SGC' TO TAB-COD-SIST.
           MOVE 'REC' TO TAB-CIC-TTAB IN TAB.
           MOVE 'RP'  TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               DISPLAY MSG-GLS-DESC
               GOBACK.
           MOVE TAB-COD-CTAB TO REC-COD-REPR IN REC-VARI.

           DISPLAY 'Fin de Validacion de Parametros'.
      *>>>>
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
       FST-INP-SRT.
      *>>>>
           IF WSS-CIC-SEL1 = 'C'
               GO TO LUP-INP-SRT.
      *<<<<<
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<<
           IF DBC-IND-TICL IN DBC NOT = 'E'
               GO TO NXT-INP-SRT.
           IF WSS-CIC-SEL1 = 'O'
               IF WSS-COD-OFIC NOT = DBC-COD-OFIC IN DBC
                   GO TO NXT-INP-SRT
               ELSE
                   NEXT SENTENCE
           ELSE
           IF WSS-CIC-SEL1 = 'E'
               IF WSS-COD-EJEC NOT = DBC-COD-EJEC IN DBC
                   GO TO NXT-INP-SRT.
      *>>>>
       MOV-INP-SRT.
       COPY SGCRMDBE.
           RELEASE SRT.
       NXT-INP-SRT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
      *<<<<
           IF WSS-CIC-SEL1 = 'C'
               GO TO FIN-INP-SRT.
      *>>>>
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM SGC-FIO-DBC.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           OPEN OUTPUT RPTDBE.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-DBE.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
       LUP-OUT-SRT.
      *<<<<
           PERFORM MOV-DBC.
           MOVE DBC-CAI-ICLI IN SRT TO DCE-CAI-ICLI IN DCE.
           MOVE DBC-IIC-ICLI IN SRT TO DCE-IIC-ICLI IN DCE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DCE.
           IF DBC-GLS-NOMC IN SRT NOT > SPACES
               MOVE ALL '_' TO DBC-GLS-NOMC IN SRT.
      * BUSQUEDA TIPO SOCIEDAD
           IF DCE-COD-TSOC IN DCE > SPACES
               MOVE 'SGC' TO TAB-COD-SIST
               MOVE 'SOC' TO TAB-COD-TTAB IN TAB
               MOVE DCE-COD-TSOC IN DCE TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TSOC
           ELSE
               MOVE ALL '_' TO WSS-GLS-TSOC
               MOVE ALL '_' TO DCE-COD-TSOC IN DCE.
           IF DCE-GLS-NFAN IN DCE NOT > SPACES
               MOVE ALL '_' TO DCE-GLS-NFAN IN DCE.
           MOVE DBC-CAI-ICLI IN SRT TO DBC-CAI-ICLI IN DBC.
           MOVE DBC-IIC-ICLI IN SRT TO DBC-IIC-ICLI IN DBC.
           PERFORM BUS-DOM.
      * BUSQUEDA LUGAR COMUNA/PAIS
           IF RCD-COD-LUGA IN RCD > SPACES
               MOVE RCD-COD-LUGA IN RCD TO WSS-LUGA
               IF WSS-IND-PAIS = 'P'
                   MOVE 'TAB' TO TAB-COD-SIST
                   MOVE 'PAI' TO TAB-COD-TTAB IN TAB
                   MOVE WSS-COD-PAIS TO TAB-COD-CTAB IN TAB
                   PERFORM BUS-TAB
                   MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-LUGA IN WSS-DBE
               ELSE
                   MOVE 'TAB' TO TAB-COD-SIST
                   MOVE 'COM' TO TAB-COD-TTAB IN TAB
                   MOVE WSS-LUGA TO TAB-COD-CTAB IN TAB
                   PERFORM BUS-TAB
                   MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-LUGA IN WSS-DBE
           ELSE
               MOVE ALL '_' TO WSS-GLS-LUGA IN WSS-DBE
               MOVE ALL '_' TO RCD-COD-LUGA IN RCD.
           IF DCE-IND-CATE IN DCE NOT > SPACES
               MOVE ALL '_' TO DCE-IND-CATE IN DCE.
           IF DCE-FEC-FCTT IN DCE NOT > ZEROES
               MOVE ALL '_' TO DCE-FEC-FCTT IN DCE.
           IF DCE-IND-CMOS IN DCE NOT > SPACES
               MOVE ALL '_' TO DCE-IND-CMOS IN DCE.
           IF DCE-IND-TEMP IN DCE NOT > SPACES
               MOVE ALL '_' TO DCE-IND-TEMP IN DCE.
           IF DCE-FEC-FCAD IN DCE NOT > ZEROES
               MOVE ALL '_' TO DCE-FEC-FCAD IN DCE.
           IF DCE-FEC-FUME IN DCE NOT > ZEROES
               MOVE ALL '_' TO DCE-FEC-FUME IN DCE.
           IF DCE-IND-RAUT IN DCE NOT > SPACES
               MOVE ALL '_' TO DCE-IND-RAUT IN DCE.
           MOVE DBC-CAI-ICLI IN SRT TO PPU-CAI-ICLI.
           MOVE DBC-IIC-ICLI IN SRT TO PPU-IIC-ICLI.
           PERFORM BUS-RCU.
           IF TAB-GLS-DCOR > SPACES
               MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-RBCO
           ELSE
               MOVE ALL '_' TO WSS-GLS-RBCO.
      *>>>>
       GEN-OUT-SRT.
           GENERATE DL-DBE.
      *<<<<
           MOVE SPACES TO REC-KEY-IREC IN REC.
           MOVE DBC-CAI-ICLI IN SRT TO REC-CAI-ICLI IN REC.
           MOVE DBC-IIC-ICLI IN SRT TO REC-IIC-ICLI IN REC.
           MOVE REC-COD-REPR TO REC-COD-TREC IN REC.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-BUS-REC.
           PERFORM SGC-FIO-REC.
           IF NOT ( FIO-STAT-OKS AND
                   DBC-CAI-ICLI IN SRT = REC-CAI-ICLI IN REC AND
                   DBC-IIC-ICLI IN SRT = REC-IIC-ICLI IN REC AND
                   REC-COD-TREC IN REC = REC-COD-REPR )
               MOVE SPACES TO REC
               MOVE ZEROES TO REC-SGV-AREC IN REC
           ELSE
           IF REC-IND-VIGE IN REC = 'N'
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-REC.
           PERFORM MOV-REC.

           PERFORM MOV-RCD.
      *>>>>
       NXT-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
           TERMINATE RPT-DBE.
           CLOSE RPTDBE.

       COPY SGCBFDBC.
       COPY GNSBGDTC.
       COPY GNSBGIFD.
       COPY GNSBTABT.
       COPY GNSBBSYS.

      *<<<<
       COPY GNSBBTAB.
       COPY GNSBFTAB.

       COPY GNSBBMSC.
       COPY GNSBVMSC.
       COPY GNSBFMSC.

       COPY GNSBBMSG.
       COPY GNSBFMSG.

       COPY GNSBGCPT.
       COPY GNSBGPPU.

       COPY TABBBUSR.
       COPY TABBVUSR.
       COPY TABBFUSR.

       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY TABBFOFI.

       COPY SGCBGPPU.
       COPY SGCBGRCU.
       COPY SGCBGDOM.
       COPY SGCBPDBC.
       COPY SGCBSDBC.
       COPY SGCBSREC.
       COPY SGCBSRCD.

       COPY SGCBFDCE.
       COPY SGCBFREC.
       COPY SGCBFRCD.
      *>>>>
