       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      SGCPLNDI.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    19-Dec-88 04:47 PM.
      * Programa Listador de Reporte NDI con Sort.
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *DOS SELECT RPTNDI         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTNDI         ASSIGN TO        UT-S-RPTNDI.
           SELECT RPTNDI         ASSIGN TO SYS011-UR-1403-S.
       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY SGCRRNDI.
       FD  RPTNDI LABEL RECORDS OMITTED
           REPORT IS RPT-NDI
           .
       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CHP-REQA==.
       COPY SGCBRCHP.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGIFD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY SGCRWNDI.
       COPY GNSWGSYS.
      *<<<< WSS
       COPY GNSBRMSG.
       COPY GNSBRTAB.
       COPY TABBROFI.
       COPY TABBRCAM.
       COPY SGCBROPE.
       COPY SGCBRRCO.
       COPY SGCBRDBC.
       COPY SGCBRRCD.
       COPY GNSWGMES.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGCPT.
      * COPY GNSWVPPH.
       01  WSS-VARI.
           03 WSS-FEC-FINI.
              05 WSS-NUM-DINI                     PIC 9(02).
              05 WSS-NUM-MINI                     PIC 9(02).
              05 WSS-NUM-SINI                     PIC 9(02).
              05 WSS-NUM-AINI                     PIC 9(02).
           03 WSS-FEC-FTER.
              05 WSS-NUM-DTER                     PIC 9(02).
              05 WSS-NUM-MTER                     PIC 9(02).
              05 WSS-NUM-STER                     PIC 9(02).
              05 WSS-NUM-ATER                     PIC 9(02).
           03 WSS-COD-OFOP                        PIC X(03).
           03 WSS-COD-TDOC                        PIC X(03).
           03 WSS-IND-NEXT                        PIC 9(01).
           03 WSS-FEC-FINP.
              05 WSS-NUM-SINP                     PIC 9(02).
              05 WSS-NUM-AINP                     PIC 9(02).
              05 WSS-NUM-MINP                     PIC 9(02).
              05 WSS-NUM-DINP                     PIC 9(02).
           03 WSS-FEC-FOUT.
              05 WSS-NUM-SOUT                     PIC 9(02).
              05 WSS-NUM-AOUT                     PIC 9(02).
              05 WSS-NUM-MOUT                     PIC 9(02).
              05 WSS-NUM-DOUT                     PIC 9(02).
           03 WSS-NUM-INPG             VALUE 0      PIC 9(01).
           03 WSS-SGV-VCAM      VALUE ZEROES      PIC 9(11)V9(04).
      *>>>>
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCD-REQA==.
      *>>>>
       REPORT SECTION.
      *--------------
       COPY SGCRFNDI.
           .
       COPY SGCRTNDI.
       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
       DEC-CF-NDI-OPE-COD-OFOP SECTION.
           USE BEFORE REPORTING CF-NDI-OPE-COD-OFOP.
       INI-CF-NDI-OPE-COD-OFOP.
      *<<<< CF_NDI_OPE_COD_OFOP
      *>>>>
       FIN-CF-NDI-OPE-COD-OFOP.
           EXIT.
       DEC-CF-NDI-CHP-COD-TDOC SECTION.
           USE BEFORE REPORTING CF-NDI-CHP-COD-TDOC.
       INI-CF-NDI-CHP-COD-TDOC.
      *<<<< CF_NDI_CHP_COD_TDOC
      *>>>>
       FIN-CF-NDI-CHP-COD-TDOC.
           EXIT.
       DEC-PH-NDI SECTION.
           USE BEFORE REPORTING PH-NDI.
       INI-PH-NDI.
      *<<<< PH_NDI
      * COPY GNSBGPPH.
      * Mediante BUS-OFI se Obtiene Nombre de la Oficina de Tabla OFI
           IF OPE-COD-OFOP IN SRT > SPACES
               MOVE OPE-COD-OFOP IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFIC IN WSS-NDI
               MOVE 'TAB'        TO TAB-COD-SIST
               MOVE 'COM'        TO TAB-COD-TTAB IN TAB
               MOVE OFI-COD-COMU TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-COMU IN WSS-NDI
           ELSE
               MOVE SPACES TO WSS-GLS-OFIC IN WSS-NDI
                              WSS-GLS-COMU IN WSS-NDI.
      * Mediante BUS-TAB se Obtiene Nombre del Documento de Tabla DOC
           IF CHP-COD-TDOC IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'DOC'               TO TAB-COD-TTAB IN TAB
               MOVE CHP-COD-TDOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TDOC IN WSS-NDI
           ELSE
               MOVE SPACES              TO WSS-GLS-TDOC IN WSS-NDI.
           IF CHP-COD-TDOC IN SRT = 'CHQ'
               MOVE 'GIRADOR'    TO WSS-GLS-GLO1 IN WSS-NDI
               MOVE SPACES       TO WSS-GLS-GLO2 IN WSS-NDI
               MOVE 'F.PROTESTO' TO WSS-GLS-GLO3 IN WSS-NDI
           ELSE
               MOVE 'ACEPTANTE O SUSCRIPTOR' TO WSS-GLS-GLO1 IN WSS-NDI
               MOVE 'DOMICILIO'              TO WSS-GLS-GLO2 IN WSS-NDI
               MOVE 'F.VENCMNTO'             TO WSS-GLS-GLO3 IN WSS-NDI.
           MOVE SPACES TO WSS-NUM-NOMI IN WSS-NDI.
      *>>>>
       FIN-PH-NDI.
           EXIT.
       END DECLARATIVES.
       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'SGCPLNDI' TO FIO-PROG.
           PERFORM BUS-FSIS.
           SORT GNSSRT
       COPY SGCRSNDI.
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
       COPY GNSBGGBK.
       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<< INI_INP
           DISPLAY 'Inicio Captura de Parametros'.
      *Captura Fecha de Inicio
           DISPLAY 'FECHA DESDE ( DDMMSSAA ) : '.
           ACCEPT  WSS-FEC-FINI IN WSS-VARI.
           DISPLAY WSS-FEC-FINI IN WSS-VARI.

      *Captura Fecha de Termino
           DISPLAY 'FECHA HASTA ( DDMMSSAA ) : '.
           ACCEPT  WSS-FEC-FTER IN WSS-VARI.
           DISPLAY WSS-FEC-FTER IN WSS-VARI.
      *Captura Codigo de Oficina
           DISPLAY 'OFICINA        (*=TODAS) : '.
           ACCEPT  WSS-COD-OFOP IN WSS-VARI.
           DISPLAY WSS-COD-OFOP IN WSS-VARI.
      *Captura Tipo Documento
           DISPLAY 'TIPO DOCUMENTO (*=TODOS) : '.
           ACCEPT  WSS-COD-TDOC IN WSS-VARI.
           DISPLAY WSS-COD-TDOC IN WSS-VARI.
           DISPLAY 'Fin Captura de Parametros'.
           DISPLAY 'Inicio Validacion de Parametros'.
      *VAL-FEC Valida Fecha de Inicio
           DISPLAY WSS-FEC-FINI IN WSS-VARI.
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               COPY GNSBGGBK.
      *VAL-FEC Valida Fecha de Termino
           DISPLAY WSS-FEC-FTER IN WSS-VARI.
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               COPY GNSBGGBK.
      *CMP-FEC Compara Fecha de Inicio con Fecha de Termino
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FEC1.
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-GRT
               MOVE 'TAB'         TO MSG-COD-SIST
               MOVE 'FECFINIFTER' TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG
               COPY GNSBGGBK.
           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DINI IN WSS-NDI
                                            WSS-NUM-DINP IN WSS-VARI.
           MOVE MES-DMES     IN MES-VARI(WSS-NUM-MINI IN WSS-VARI)
                                         TO WSS-GLS-MINI IN WSS-NDI.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MINP IN WSS-VARI.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SINI IN WSS-NDI
                                            WSS-NUM-SINP IN WSS-VARI.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AINI IN WSS-NDI
                                            WSS-NUM-AINP IN WSS-VARI.
           MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DTER IN WSS-NDI
                                            WSS-NUM-DOUT IN WSS-VARI.
           MOVE MES-DMES     IN MES-VARI(WSS-NUM-MTER IN WSS-VARI)
                                         TO WSS-GLS-MTER IN WSS-NDI.
           MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MOUT IN WSS-VARI.
           MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-STER IN WSS-NDI
                                            WSS-NUM-SOUT IN WSS-VARI.
           MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-ATER IN WSS-NDI
                                            WSS-NUM-AOUT IN WSS-VARI.
      *VAL-OFI Valida Codigo de Oficina en TABLAS
           IF WSS-COD-OFOP IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-OFOP IN WSS-VARI.
           IF WSS-COD-OFOP IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-OFOP IN WSS-VARI
               MOVE WSS-COD-OFOP IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   COPY GNSBGGBK.
      *VAL-TAB Valida Tipo de Documento en TABLAS
           IF WSS-COD-TDOC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-TDOC IN WSS-VARI.
           IF WSS-COD-TDOC IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-TDOC IN WSS-VARI
               MOVE 'TAB'                    TO TAB-COD-SIST
               MOVE 'DOC'                    TO TAB-COD-TTAB IN TAB
               MOVE WSS-COD-TDOC IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM VAL-TAB
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   COPY GNSBGGBK.

           DISPLAY 'Fin Validacion de Parametros'.
      *>>>>
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-CHP.
       FST-INP-SRT.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM SGC-FIO-CHP.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
      * Proceso de Seleccion y Clasificacion a Partir del Registro CHP
           PERFORM SEL-REG-PRO.
           IF WSS-IND-NEXT IN WSS-VARI = 1
               GO TO NXT-INP-SRT.
      *     PERFORM BUS-SRT-REG.
      *     GO TO NXT-INP-SRT.
      *>>>>
       MOV-INP-SRT.
       COPY SGCRMNDI.
           RELEASE SRT.
       NXT-INP-SRT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SGC-FIO-CHP.
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM SGC-FIO-CHP.
       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           OPEN OUTPUT RPTNDI.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-NDI.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
      *<<<< FST_OUT
           MOVE RPT-FDMA                 TO WSS-FEC-FINI IN WSS-VARI.
           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DDMA IN WSS-NDI.
           MOVE MES-DMES     IN MES-VARI(WSS-NUM-MINI IN WSS-VARI)
                                         TO WSS-GLS-MDMA IN WSS-NDI.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SDMA IN WSS-NDI.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-ADMA IN WSS-NDI.
      *>>>>
       LUP-OUT-SRT.
      *<<<< LUP_OUT
           PERFORM GEN-LIN-OUT.
           GO TO NXT-OUT-SRT.
      *>>>>
       GEN-OUT-SRT.
           GENERATE DL-NDI.
       NXT-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
           TERMINATE RPT-NDI.
           CLOSE RPTNDI.
       COPY SGCBFCHP.
       COPY GNSBGDTC.
       COPY GNSBGIFD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
      *<<<< EOF
      ******************************************************************
********
      * Seleccion del Registro para Proceso Mediante Rango de Fechas, Of
icina y
      * Tipo Documento del Listado
       SEL-REG-PRO SECTION.
       INI-SEL-REG-PRO.
           MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.
           IF WSS-FEC-FINP IN WSS-VARI > CHP-FEC-FCHP IN CHP OR
              WSS-FEC-FOUT IN WSS-VARI < CHP-FEC-FCHP IN CHP
               GO TO FIN-SEL-REG-PRO.
           IF WSS-COD-TDOC IN WSS-VARI NOT = '*'
               IF WSS-COD-TDOC IN WSS-VARI NOT = CHP-COD-TDOC IN CHP
                   GO TO FIN-SEL-REG-PRO.
           MOVE CHP-CIC-ICCT IN CHP TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF NOT FIO-STAT-OKS
               GO TO FIN-SEL-REG-PRO.
           IF WSS-COD-OFOP IN WSS-VARI NOT = '*'
               IF WSS-COD-OFOP IN WSS-VARI NOT = OPE-COD-OFOP IN OPE
                   GO TO FIN-SEL-REG-PRO.
           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
       FIN-SEL-REG-PRO.
           EXIT.
      ******************************************************************
********
      * Formacion y Generacion del Registro SRT al Procesar Varios Regis
tros
       BUS-SRT-REG SECTION.

       INI-BUS-SRT-REG.
      * Complementa Formacion del Registro SRT
      * Completa Llenado de Campos y Genera el Registro SRT
      *     COPY SGCRMNDI.
      *     RELEASE SRT.
       FIN-BUS-SRT-REG.
           EXIT.
      ******************************************************************
********
      * Genera Lineas de Detalle a Partir de Registro SRT Ordenado
       GEN-LIN-OUT SECTION.
       INI-GEN-LIN-OUT.
           IF OPE-COD-VCOP IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE OPE-COD-VCOP IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-ABRV IN TAB TO WSS-GLS-VCOP IN WSS-NDI
           ELSE
               MOVE SPACES              TO WSS-GLS-VCOP IN WSS-NDI.
      * Busca Datos Cliente por Medio del CIC de Operaciones en Registro
 RCO
           MOVE CHP-CIC-ICCT IN SRT TO RCO-CIC-IOPE IN RCO.
           MOVE FIO-GET-KEY  TO FIO-CMND.
       LUP-GET-RCO.
           MOVE 'RCO-KEY-IOPE' TO FIO-AKEY.
           PERFORM SGC-FIO-RCO.
           IF NOT FIO-STAT-OKS
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'OPE    RCONX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG  CHP-CIC-ICCT IN SRT
               GO TO FIN-GEN-LIN-OUT
           ELSE
               IF CHP-CIC-ICCT IN SRT NOT = RCO-CIC-IOPE IN RCO
                   GO TO FIN-GEN-LIN-OUT.
           PERFORM GET-DBC-RCD.
           GENERATE DL-NDI.
       NXT-GET-RCO.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-GET-RCO.
       GET-DBC-RCD.
      * Busca Datos del Cliente y Mediante BUS-DOM Obtiene Domicilio Cli
ente
           MOVE RCO-CIC-ICLI IN RCO TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF FIO-STAT-OKS
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN     TO DBC-GLS-NOMC IN DBC
               IF CHP-COD-TDOC IN SRT = 'CHQ'
                   MOVE SPACES TO RCD-GLS-DIRE IN RCD
               ELSE
                   PERFORM BUS-DOM
                   IF RCD-GLS-DIRE IN RCD NOT > SPACES
                       MOVE '*'    TO RCD-GLS-DIRE IN RCD
                   ELSE
                       MOVE RCD-GLS-DIRE IN RCD TO CPT-STRN
                       PERFORM CPT-BLKS
                       MOVE CPT-STRN     TO RCD-GLS-DIRE IN RCD
           ELSE
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'RCO    NOCLI' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG  RCO-CIC-ICLI IN RCO.
       FIN-GEN-LIN-OUT.
           EXIT.
      ******************************************************************
********
       COPY GNSBFMSG.
       COPY GNSBFTAB.
       COPY TABBFOFI.
       COPY TABBFCAM.
       COPY SGCBFOPE.
       COPY SGCBFRCO.
       COPY SGCBFDBC.
       COPY SGCBFRCD.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY TABBBOFI.
       COPY GNSBVTAB.
       COPY TABBVOFI.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBGCPT.
       COPY SGCBGDOM.
      *>>>>
