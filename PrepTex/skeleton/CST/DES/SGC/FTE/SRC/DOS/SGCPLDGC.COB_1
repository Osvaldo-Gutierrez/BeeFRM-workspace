       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      SGCPLDGC.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    17-Nov-88 06:40 PM.
      * Programa Listador de Reporte DGC con Sort.
       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *DOS SELECT RPTDGC         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTDGC         ASSIGN TO        UT-S-RPTDGC.
           SELECT RPTDGC         ASSIGN TO SYS011-UR-1403-S.
       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY SGCRRDGC.
       FD  RPTDGC LABEL RECORDS OMITTED
           REPORT IS RPT-DGC
           .
       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY SGCBRDBC.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGIFD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY SGCRWDGC.
       COPY GNSWGSYS.
      *<<<< WSS
       COPY GNSBRMSG.
       COPY GNSBRTAB.
       COPY TABBRUSR.
       COPY TABBROFI.
       COPY SGCBRRCD.
       COPY GNSWGCPT.
       01  WSS-VARI.
           03 WSS-COD-OFIC                        PIC X(03).
           03 WSS-COD-EJEC                        PIC X(12).
           03 WSS-IND-NEXT                        PIC 9(01).
           03 WSS-COD-LUGA.
              05 WSS-COD-COMU                     PIC X(04).
              05 WSS-GLS-PAIS  REDEFINES  WSS-COD-COMU.
                 07 WSS-IND-PAIS                  PIC X(01).
                 07 WSS-COD-PAIS                  PIC X(03).
      *>>>>
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCD-REQA==.
      *>>>>
       REPORT SECTION.
      *--------------
       COPY SGCRFDGC.
           .
       COPY SGCRTDGC.
       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
       DEC-CF-DGC-DBC-COD-OFIC SECTION.
           USE BEFORE REPORTING CF-DGC-DBC-COD-OFIC.
       INI-CF-DGC-DBC-COD-OFIC.
       FIN-CF-DGC-DBC-COD-OFIC.
           EXIT.
       DEC-CF-DGC-DBC-COD-EJEC SECTION.
           USE BEFORE REPORTING CF-DGC-DBC-COD-EJEC.
       INI-CF-DGC-DBC-COD-EJEC.
       FIN-CF-DGC-DBC-COD-EJEC.
           EXIT.
       DEC-PH-DGC SECTION.
           USE BEFORE REPORTING PH-DGC.
       INI-PH-DGC.

      *<<<< PH_DGC
      * Mediante BUS-OFI se Obtiene Nombre de la Oficina de Tabla OFI
           IF DBC-COD-OFIC IN SRT > SPACES
               MOVE DBC-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFIC IN WSS-DGC
           ELSE
               MOVE SPACES TO WSS-GLS-OFIC IN WSS-DGC.
      * Mediante BUS-USR Busca Usuario de Tabla USR
           IF DBC-COD-EJEC IN SRT > SPACES
               MOVE DBC-COD-EJEC IN SRT TO USR-COD-USER IN USR
               PERFORM BUS-USR
               MOVE USR-GLS-DESC IN USR TO WSS-GLS-EJEC IN WSS-DGC
           ELSE
               MOVE SPACES TO WSS-GLS-EJEC IN WSS-DGC.
      *>>>>
       FIN-PH-DGC.
           EXIT.
       END DECLARATIVES.
       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'SGCPLDGC' TO FIO-PROG.
           PERFORM BUS-FSIS.
           SORT GNSSRT
       COPY SGCRSDGC.
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
       COPY GNSBGGBK.
       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<< INI_INP
           DISPLAY 'Inicio de Captura de Parametros'.
      *Captura Codigo de Oficina
           DISPLAY 'OFICINA   (*=TODAS) : '.
           ACCEPT  WSS-COD-OFIC IN WSS-VARI.
           DISPLAY WSS-COD-OFIC IN WSS-VARI.
      *Captura Ejecutivo Operacion Credito
           DISPLAY 'EJECUTIVO (*=TODOS) : '.
           ACCEPT  WSS-COD-EJEC IN WSS-VARI.
           DISPLAY WSS-COD-EJEC IN WSS-VARI.
           DISPLAY 'Fin    de Captura    de Parametros'.
           DISPLAY 'Inicio de Validacion de Parametros'.
      *VAL-OFI Valida Codigo de Oficina en TABLAS
           IF WSS-COD-OFIC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-OFIC IN WSS-VARI.
           IF WSS-COD-OFIC IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-OFIC IN WSS-VARI
               MOVE WSS-COD-OFIC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   COPY GNSBGGBK.
      *VAL-USR Valida Codigo de Usuario en TABLAS
           IF WSS-COD-EJEC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-EJEC IN WSS-VARI.
           IF WSS-COD-EJEC IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-EJEC IN WSS-VARI
               MOVE WSS-COD-EJEC IN WSS-VARI TO USR-COD-USER IN USR
               PERFORM VAL-USR
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   COPY GNSBGGBK.
           DISPLAY 'Fin de Validacion de Parametros'.
      *>>>>
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
       FST-INP-SRT.
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
      * Proceso de Seleccion y Clasificacion a Partir del Registro VEN
           PERFORM SEL-REG-PRO.
           IF WSS-IND-NEXT IN WSS-VARI = 1
               GO TO NXT-INP-SRT.
           PERFORM BUS-SRT-REG.
           GO TO NXT-INP-SRT.
      *>>>>
       MOV-INP-SRT.
       COPY SGCRMDGC.
           RELEASE SRT.
       NXT-INP-SRT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SGC-FIO-DBC.

           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           OPEN OUTPUT RPTDGC.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-DGC.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
       LUP-OUT-SRT.
      *<<<< LUP_OUT
           PERFORM GEN-LIN-OUT.
      *>>>>
       GEN-OUT-SRT.
           GENERATE DL-DGC.
       NXT-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
           TERMINATE RPT-DGC.
           CLOSE RPTDGC.
       COPY SGCBFDBC.
       COPY GNSBGDTC.
       COPY GNSBGIFD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
      *<<<< EOF
      ******************************************************************
********
      * Seleccion del Registro para Proceso Mediante Oficina y Ejecutivo
 del
      * Listado
       SEL-REG-PRO SECTION.
       INI-SEL-REG-PRO.
           MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.
           IF WSS-COD-OFIC IN WSS-VARI NOT = '*'
               IF WSS-COD-OFIC IN WSS-VARI NOT = DBC-COD-OFIC IN DBC
                   GO TO FIN-SEL-REG-PRO.
           IF WSS-COD-EJEC IN WSS-VARI NOT = '*'
               IF WSS-COD-EJEC IN WSS-VARI NOT = DBC-COD-EJEC IN DBC
                   GO TO FIN-SEL-REG-PRO.
           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
       FIN-SEL-REG-PRO.
           EXIT.
      ******************************************************************
********
      * Formacion y Generacion del Registro SRT al Procesar Varios Regis
tros
       BUS-SRT-REG SECTION.
       INI-BUS-SRT-REG.
      * Complementa Formacion del Registro SRT
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN     TO DBC-GLS-NOMC IN DBC.
      * Completa Llenado de Campos y Genera el Registro SRT
           COPY SGCRMDGC.
           RELEASE SRT.
       FIN-BUS-SRT-REG.
           EXIT.
      ******************************************************************
********
      * Genera Lineas de Detalle a Partir de Registro SRT Ordenado
       GEN-LIN-OUT SECTION.
       INI-GEN-LIN-OUT.
           IF DBC-GLS-ICLI IN SRT > SPACES
               MOVE '-'    TO WSS-GLS-AUXI IN WSS-DGC
           ELSE
               MOVE SPACES TO WSS-GLS-AUXI IN WSS-DGC.
      * Mediante BUS-DOM y BUS-TAB Busca Comuna Obteniendo Codigos de Ta
bla COM
           MOVE DBC-CAI-ICLI IN SRT TO DBC-CAI-ICLI IN DBC.
           MOVE DBC-IIC-ICLI IN SRT TO DBC-IIC-ICLI IN DBC.
           PERFORM BUS-DOM.
           IF RCD-GLS-DIRE IN RCD > SPACES
               MOVE RCD-COD-LUGA IN RCD TO WSS-COD-LUGA IN WSS-VARI
               IF WSS-IND-PAIS NOT = 'P'
                   MOVE 'TAB'                    TO TAB-COD-SIST
                   MOVE 'COM'                    TO TAB-COD-TTAB IN TAB
                   MOVE WSS-COD-LUGA IN WSS-VARI TO TAB-COD-CTAB IN TAB
                   PERFORM BUS-TAB
                   MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-COMU IN WSS-DGC
               ELSE
                   MOVE 'TAB'                    TO TAB-COD-SIST
                   MOVE 'PAI'                    TO TAB-COD-TTAB IN TAB
                   MOVE WSS-COD-PAIS IN WSS-VARI TO TAB-COD-CTAB IN TAB
                   PERFORM BUS-TAB
                   MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-COMU IN WSS-DGC
           ELSE
               MOVE '*'    TO RCD-GLS-DIRE IN RCD
               MOVE '*'    TO WSS-GLS-COMU IN WSS-DGC
               MOVE '*'    TO RCD-GLS-FONO IN RCD.
       FIN-GEN-LIN-OUT.

           EXIT.
      ******************************************************************
********
       COPY GNSBFMSG.
       COPY GNSBFTAB.
       COPY TABBFUSR.
       COPY TABBFOFI.
       COPY SGCBFRCD.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY TABBBUSR.
       COPY TABBBOFI.
       COPY GNSBVTAB.
       COPY TABBVUSR.
       COPY TABBVOFI.
       COPY GNSBGCPT.
       COPY SGCBGDOM.
      *>>>>
