       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID. SGCPGDSF.
       AUTHOR.     CONSIST.
      * GENERA ARCHIVO CINTA DEUDA SUPERBANCOS.
       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.
       DATA DIVISION.
      *=============
       WORKING-STORAGE SECTION.
      *------------------------
       COPY SGCBRCDS.
       COPY SGCBRRBS.
       COPY SGCBRDBC.
       COPY SGCBRDSF.
       COPY GNSWVFIO.
       COPY GNSWCFIO.
       COPY GNSWGIFD.
       COPY GNSWGHOY.
       COPY GNSWGSYS.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSBRCIC.
       COPY GNSWGCIC.
       COPY GNSBRMSG.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       COPY GNSWGCPT.
      *ALD
       COPY GNSBRMSC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
      *
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DSF-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RBS-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       01   WSS-VARI.
            03 WSS-IND-TDEU             VALUE 0      PIC 9(08).
            03 WSS-IND-RERR             VALUE 0      PIC 9(08).
            03 WSS-IND-ROKS             VALUE 0      PIC 9(08).
            03 WSS-IND-RTOT             VALUE 0      PIC 9(08).
            03 WSS-RBS-STAT             VALUE 0      PIC 9(01).
               88 WSS-RBS-NO-CREADO     VALUE 1.
               88 WSS-RBS-MODIFICAR     VALUE 2.
               88 WSS-RBS-ASIGNE-CIC    VALUE 3.
            03 WSS-FEC-FDSF.
               05 WSS-NUM-DDSF                       PIC 9(02).
               05 WSS-NUM-MDSF                       PIC 9(02).
               05 WSS-NUM-SDSF                       PIC 9(02).
               05 WSS-NUM-ADSF                       PIC 9(02).
            03 WSS-GLS-NOMC                          PIC X(100).
            03 WSS-GLS-NCLS                          PIC X(100).
       PROCEDURE DIVISION.
      *===================
       MAIN SECTION.
       INI-MAIN.
           ENTRY 'DBMSCBL'.
           PERFORM INI.
       LUP-MAIN.
           IF NOT FIO-STAT-OKS
              GO TO CLO-MAIN.
           ADD 1 TO WSS-IND-RTOT IN WSS-VARI.
           MOVE SPACES TO DSF.
           MOVE ZEROES TO DSF-VAL-DVGN.
           MOVE ZEROES TO DSF-VAL-DVGX.
           MOVE ZEROES TO DSF-VAL-DVCN.
           MOVE ZEROES TO DSF-VAL-DVCX.
           MOVE ZEROES TO DSF-VAL-IVGT.
           MOVE ZEROES TO DSF-VAL-IVCT.
           MOVE ZEROES TO DSF-VAL-PVDT.
           IF CDS-NUM-RUTS IN CDS NOT > ZEROES
               PERFORM BUS-NOM-RBS
           ELSE
               PERFORM BUS-RUT-RBS.
           PERFORM PUT-DSF.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SGC-FIO-CDS.
           GO TO LUP-MAIN.
       CLO-MAIN.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM SGC-FIO-CDS.
           PERFORM SGC-FIO-RBS.
           PERFORM SGC-FIO-DBC.
           PERFORM SGC-FIO-DSF.
           DISPLAY 'TOTAL DEUDORES  CINTA    : ' WSS-IND-TDEU.
           DISPLAY 'TOTAL REGISTROS LEIDOS   : ' WSS-IND-RTOT.
           DISPLAY 'TOTAL REGISTROS GRABADOS : ' WSS-IND-ROKS.
           DISPLAY 'TOTAL REGISTROS ERRONEOS : ' WSS-IND-RERR.
           GOBACK.
       INI SECTION.
       INI-INI.
           PERFORM BUS-FSIS.
           PERFORM GET-FHOY.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-CDS.
           IF NOT FIO-STAT-OKS
               GO TO FIN-INI.
           PERFORM SGC-FIO-RBS.
           PERFORM SGC-FIO-DBC.
           PERFORM SGC-FIO-DSF.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SGC-FIO-CDS.
           IF NOT FIO-STAT-OKS
               GO TO FIN-INI.
           MOVE CDS-NUM-TDEU IN CDS TO WSS-IND-TDEU IN WSS-VARI.
      *ALD
           MOVE 19                  TO WSS-NUM-SDSF IN WSS-VARI.
           MOVE CDS-NUM-AREF IN CDS TO WSS-NUM-ADSF IN WSS-VARI.
           MOVE CDS-NUM-MREF IN CDS TO WSS-NUM-MDSF IN WSS-VARI.
           MOVE ZEROES              TO WSS-NUM-DDSF IN WSS-VARI.
           MOVE 'FISF' TO MSC-COD-TMSC IN MSC.
           MOVE 'FDSF' TO MSC-COD-CMSC IN MSC.
           MOVE 'SGC' TO FIO-SIST
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF FIO-STAT-OKS
               MOVE WSS-FEC-FDSF IN WSS-VARI TO MSC-GLS-DATA IN MSC
               MOVE FIO-MOD TO FIO-CMND
               PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
      *GET-MSG Busca mensaje en tabla
               MOVE 'SGC' TO MSG-COD-SIST
               MOVE 'FECFISFNACT' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC.
      *
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SGC-FIO-CDS.
       FIN-INI.
           EXIT.
       PUT-DSF SECTION.
       INI-PUT-DSF.
           IF WSS-RBS-NO-CREADO
      *GET-MSG Busca mensaje en tabla
               MOVE 'SGC' TO MSG-COD-SIST
               MOVE 'DSF    NACT' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC
               ADD 1 TO WSS-IND-RERR IN WSS-VARI
               GO TO FIN-PUT-DSF.
           MOVE HOY-DHOY IN HOY-VARI TO DSF-NUM-DTRN.
           MOVE HOY-MHOY IN HOY-VARI TO DSF-NUM-MTRN.
           MOVE HOY-AHOY IN HOY-VARI TO DSF-NUM-ATRN.
           MOVE HOY-SHOY IN HOY-VARI TO DSF-NUM-STRN.
           MOVE HOY-HHOY IN HOY-VARI TO DSF-HRA-HRTR.
      *LJV MOVE CDS-COD-REGS IN CDS  TO DSF-COD-REGS.
      *LJV MOVE CDS-COD-ACTS IN CDS  TO DSF-COD-ACTS.
           MOVE CDS-VAL-DVGN IN CDS  TO DSF-VAL-DVGN.
      *LJV no movia CDS-VAL-DVGX
           MOVE CDS-VAL-DVGX IN CDS  TO DSF-VAL-DVGX.
           MOVE CDS-VAL-DVCN IN CDS  TO DSF-VAL-DVCN.
           MOVE CDS-VAL-DVCX IN CDS  TO DSF-VAL-DVCX.
           MOVE CDS-VAL-IVGT IN CDS  TO DSF-VAL-IVGT.
           MOVE CDS-VAL-IVCT IN CDS  TO DSF-VAL-IVCT.
      *LJV MOVE ZEROES               TO DSF-VAL-PVDT.
           MOVE CDS-VAL-PVDT IN CDS  TO DSF-VAL-PVDT.
           MOVE 'SGCPGDSF'           TO DSF-COD-ATRN.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM SGC-FIO-DSF
           IF NOT FIO-STAT-OKS
      *GET-MSG Busca mensaje en tabla
               MOVE 'SGC' TO MSG-COD-SIST
               MOVE 'DSF    NACT' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC
               DISPLAY 'RUT SUPER    : ' CDS-NUM-RUTS
               DISPLAY 'NOMBRE SUPER : ' CDS-GLS-NCLS
               DISPLAY 'DSF-KEY      : ' DSF-KEY-IDSF
               ADD 1 TO WSS-IND-RERR IN WSS-VARI
           ELSE
               ADD 1 TO WSS-IND-ROKS IN WSS-VARI.
       FIN-PUT-DSF.
           EXIT.
       BUS-NOM-RBS SECTION.
       INI-BUS-NOM-RBS.
           MOVE CDS-GLS-NCLS TO RBS-GLS-NCLS.
           MOVE 'RBS-GLS-NCLS' TO FIO-AKEY.
           MOVE FIO-GET-KEY-ALT TO FIO-CMND.
           PERFORM SGC-FIO-RBS.
           IF NOT FIO-STAT-OKS OR
              RBS-NUM-RUTS > ZEROES
               PERFORM CRE-RBS
               GO TO FIN-BUS-NOM-RBS.
           MOVE RBS-CAI-IDEU TO DSF-CAI-IDEU.
           MOVE RBS-IIC-IDEU TO DSF-IIC-IDEU.
           MOVE RBS-CIC-ICLI TO DSF-CIC-ICLI.
       FIN-BUS-NOM-RBS.
           EXIT.

       BUS-RUT-RBS SECTION.
       INI-BUS-RUT-RBS.
           MOVE CDS-NUM-RUTS IN CDS TO RBS-NUM-RUTS IN RBS.
           MOVE CDS-VRF-RUTS IN CDS TO RBS-VRF-RUTS IN RBS.
           MOVE 'RBS-GLS-ICLS' TO FIO-AKEY.
           MOVE FIO-GET-KEY-ALT TO FIO-CMND.
           PERFORM SGC-FIO-RBS.
           IF NOT FIO-STAT-OKS
               PERFORM CRE-RBS
               GO TO FIN-BUS-RUT-RBS.
           MOVE RBS-CAI-IDEU TO DSF-CAI-IDEU.
           MOVE RBS-IIC-IDEU TO DSF-IIC-IDEU.
           IF RBS-CIC-ICLI NOT > SPACES
               MOVE SPACES TO DBC-IDC-ICLI
               MOVE CDS-NUM-RUTS IN CDS TO DBC-NUM-ICLI
               MOVE CDS-VRF-RUTS IN CDS TO DBC-VRF-ICLI
               PERFORM BUS-CIC-DBC
           ELSE
               MOVE RBS-CIC-ICLI TO DSF-CIC-ICLI.
           PERFORM MOD-RBS.
       FIN-BUS-RUT-RBS.
           EXIT.
       BUS-CIC-DBC SECTION.
       INI-BUS-CIC-DBC.
           MOVE 0 TO WSS-RBS-STAT.
           MOVE 'DBC-IDC-ICLI' TO FIO-AKEY.
           MOVE FIO-GET-KEY-ALT TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-BUS-CIC-DBC.
      *Compacta Nombre BANCO
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO WSS-GLS-NOMC.
      *Compacta Nombre SUPER
           MOVE CDS-GLS-NCLS IN CDS TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO WSS-GLS-NCLS.
      *ALD Compactar Nombres
      *    if nombre banco ( dbc ) = nombre super ( cds )
           IF WSS-GLS-NOMC = WSS-GLS-NCLS
               MOVE 'A' TO RBS-IND-TPDC IN RBS
           ELSE
                MOVE 'R' TO RBS-IND-TPDC IN RBS.
      *
           MOVE DBC-CIC-ICLI TO RBS-CIC-ICLI.
           MOVE 3 TO WSS-RBS-STAT.
           MOVE DBC-CIC-ICLI TO DSF-CIC-ICLI.
       FIN-BUS-CIC-DBC.
           EXIT.
       CRE-RBS SECTION.
       INI-CRE-RBS.
           MOVE 0 TO WSS-RBS-STAT.
           MOVE SPACES TO RBS.
           IF CDS-NUM-RUTS  > ZEROES
               MOVE SPACES TO DBC-IDC-ICLI
               MOVE CDS-NUM-RUTS TO DBC-NUM-ICLI
               MOVE CDS-VRF-RUTS TO DBC-VRF-ICLI
               PERFORM BUS-CIC-DBC.
      *ALD
      *    Generar CIC_IDEU, moverlo a RBS y DSF....
      *     MOVE RBS-CIC-ICLI TO RBS-CIC-IDEU.
      *     MOVE RBS-CIC-ICLI TO DSF-CIC-IDEU.
      *
      *GET-CIC Obtener CIC
           MOVE SPACES TO CIC-CAI-ICIC IN CIC.
           MOVE CIC-GET TO CIC-CMND.
           PERFORM PRO-CIC.
           IF CIC-STAT NOT = CIC-STAT-OKS
      *Para Programa Batch
               DISPLAY CIC-MENS
               MOVE 1 TO WSS-RBS-STAT
               GO TO FIN-CRE-RBS.
           MOVE CIC-CIC-ICIC TO RBS-CIC-IDEU.
           MOVE CIC-CIC-ICIC TO DSF-CIC-IDEU.
           PERFORM PUT-RBS.
       FIN-CRE-RBS.
           EXIT.
       MOD-RBS SECTION.
       INI-MOD-RBS.
           IF CDS-NUM-RUTS NOT = RBS-NUM-RUTS OR
              CDS-GLS-NCLS NOT = RBS-GLS-NCLS OR
              WSS-RBS-ASIGNE-CIC
               MOVE 2 TO WSS-RBS-STAT
               PERFORM PUT-RBS.
       FIN-MOD-RBS.
           EXIT.
       PUT-RBS SECTION.
       INI-PUT-RBS.
           IF WSS-RBS-MODIFICAR
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM SGC-FIO-RBS
               IF NOT FIO-STAT-OKS
      *GET-MSG Busca mensaje en tabla
                   MOVE 'SGC' TO MSG-COD-SIST
                   MOVE 'RBS    NACT' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   DISPLAY MSG-GLS-DESC
                   DISPLAY 'RUT SUPER    : ' CDS-NUM-RUTS
                   DISPLAY 'NOMBRE SUPER : ' CDS-GLS-NCLS
                   DISPLAY 'RBS-KEY      : ' RBS-KEY-IRBS
                   MOVE 1 TO WSS-RBS-STAT
                   GO TO FIN-PUT-RBS.
           MOVE HOY-DHOY IN HOY-VARI TO RBS-NUM-DTRN.
           MOVE HOY-MHOY IN HOY-VARI TO RBS-NUM-MTRN.
           MOVE HOY-AHOY IN HOY-VARI TO RBS-NUM-ATRN.
           MOVE HOY-SHOY IN HOY-VARI TO RBS-NUM-STRN.
           MOVE HOY-HHOY IN HOY-VARI TO RBS-HRA-HRTR.
           MOVE CDS-NUM-RUTS         TO RBS-NUM-RUTS.
           MOVE CDS-VRF-RUTS         TO RBS-VRF-RUTS.
           MOVE CDS-GLS-NCLS         TO RBS-GLS-NCLS.
           MOVE 'SGCPGDSF' TO RBS-COD-ATRN.
           IF WSS-RBS-MODIFICAR
               MOVE FIO-MOD TO FIO-CMND
           ELSE
               MOVE FIO-PUT TO FIO-CMND.
           PERFORM SGC-FIO-RBS.
           IF NOT FIO-STAT-OKS
      *GET-MSG Busca mensaje en tabla
               MOVE 'SGC' TO MSG-COD-SIST
               MOVE 'RBS    NACT' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC
               DISPLAY 'RUT SUPER    : ' CDS-NUM-RUTS
               DISPLAY 'NOMBRE SUPER : ' CDS-GLS-NCLS
               DISPLAY 'RBS-KEY      : ' RBS-KEY-IRBS
               MOVE 1 TO WSS-RBS-STAT.
       FIN-PUT-RBS.
           EXIT.
       COPY SGCIOCDS.
       COPY SGCBFRBS.
       COPY SGCBFDSF.
       COPY SGCBFDBC.
       COPY GNSBGDTC.
       COPY GNSBGIFD.
       COPY GNSBTABT.
       COPY GNSBGHOY.
       COPY GNSBBSYS.
       COPY GNSBGCIC.
       COPY GNSBFCIC.
       COPY GNSBFMSG.
       COPY GNSBBMSG.
      *ALD
       COPY GNSBFMSC.
      *
       COPY GNSBGCPT.
