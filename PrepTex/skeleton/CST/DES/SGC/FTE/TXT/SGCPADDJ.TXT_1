*% GEN_MFC = TRUE
*% IF PGM_PQ
*% CLRMFC = "SGCZQDDJ"
*% ELSE
*% CLRMFC = "SGCZUDDJ"
*% END
*% PGM_PTC = TRUE
*% PGM_STAT_REC = TRUE
*% IF WSS
*% IF PGM_PQ
      *<<<<< WSS
       COPY GNSWGCPT.
       COPY SGCBRDBC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       01 VRP-VARI.
          03 VRP-I       VALUE 'I'           PIC X(01).
          03 VRP-C       VALUE 'C'           PIC X(01).
          03 VRP-V       VALUE 'V'           PIC X(01).
          03 VRP-GNS     VALUE 'GNS'         PIC X(03).
          03 VRP-SGC     VALUE 'SGC'         PIC X(03).
          03 VRP-EDJ     VALUE 'EDJ'         PIC X(03).
          03 VRP-SDJ     VALUE 'SDJ'         PIC X(03).
          03 VRP-DJ      VALUE 'DJ'          PIC X(02).
          03 VRP-EST-IFOL                    PIC X(01).
          03 VRP-CIC-FANT.
             05 VRP-CAI-FANT                 PIC X(04).
             05 VRP-IIC-FANT                 PIC X(08).
          03 VRP-CIC-IFOL.
             05 VRP-CAI-IFOL                 PIC X(04).
             05 VRP-IIC-IFOL                 PIC X(08).
          03 VRP-GLS-CMEN.
             05 VRP-GLS-CME1 VALUE 'FOLDDJ-' PIC X(07).
             05 VRP-GLS-CME2                 PIC X(01).
      *>>>>>
*% END
*% IF PGM_PU
      *<<<<< WSS
       COPY GNSWGHOY.
       COPY GNSWGCPT.
       COPY SGCBRDBC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY SGCWGVRP.
      *RGD-INI PENTA 28-04-2015
       COPY LDCWGMRG.
       COPY LDCWGMRR.
      *RGD-FIN PENTA
       01 WSS-VARI.
           03 WSS-QIDD.
              05 WSS-NIDD VALUE 'GIDD'    PIC X(04).
              05 WSS-TIDD                 PIC X(04).
           03 WSS-FORMATO-MENSAJE.
              05 WSS-FORMATO-MENSAJE-NUM  PIC X(02).
              05 WSS-FORMATO-MENSAJE-COD  PIC X(12).
              05 WSS-FORMATO-MENSAJE-NOM  PIC X(04).
              05 WSS-FORMATO-MENSAJE-TAR  PIC 9(08).
              05 WSS-FORMATO-MENSAJE-CAN  PIC 9(03).
              05 WSS-FORMATO-MENSAJE-DIS  PIC X(10).
      *>>>>>
*% END
*% END
*% IF INI_FND_KEY
      *<<<<< INI_FND_KEY
      *>>>>>
*% END
*% IF FIN_FND_KEY
      *<<<<< FIN_FND_KEY
           MOVE FRM-CAI-IFOL IN DDJ-FLD TO VRP-CAI-IFOL.
           MOVE FRM-IIC-IFOL IN DDJ-FLD TO VRP-IIC-IFOL.
           MOVE VRP-SGC                 TO FIO-SIST.
           MOVE VRP-EDJ                 TO TAB-COD-TTAB IN TAB.
           MOVE VRP-CIC-IFOL            TO TAB-COD-CTAB IN TAB.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              MOVE VRP-GNS      TO MSG-COD-SIST
              MOVE 'FIOSTATNEX' TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE SCR-STAT-CON TO SCR-STAT
              GO TO FIN-FND-KEY.

           MOVE TAB-CIC-CTAB IN TAB    TO VRP-CIC-FANT.
           IF VRP-CIC-FANT NOT = VRP-CIC-IFOL
              MOVE VRP-CAI-FANT        TO FRM-CAI-IFOA IN DDJ-FLD
              MOVE VRP-IIC-FANT        TO FRM-IIC-IFOA IN DDJ-FLD.

           MOVE VRP-SGC                 TO FIO-SIST.
           MOVE SPACES                  TO REC-CIC-ICLI IN REC.
           MOVE SPACES                  TO REC-CIC-IREL IN REC.
           MOVE SPACES                  TO REC-COD-TREC IN REC.
           MOVE ZEROES                  TO REC-NUM-TREC IN REC.
           MOVE VRP-CIC-IFOL            TO REC-CIC-IARC IN REC.
           MOVE 'REC-CIC-IARC'          TO FIO-AKEY.
           MOVE FIO-GET-NLS             TO FIO-CMND.
       LOP-FND-KEY.
           PERFORM SGC-FIO-REC.
     
           IF NOT FIO-STAT-OKS OR
              VRP-CIC-IFOL NOT = REC-CIC-IARC IN REC
              MOVE VRP-GNS      TO MSG-COD-SIST
              MOVE 'FIOSTATNEX' TO MSG-COD-MENS
      *        DISPLAY 'RGD DDJ 0002 <' REC-CIC-IARC IN REC '>' 
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MENS
              MOVE SCR-STAT-CON TO SCR-STAT
              GO TO FIN-FND-KEY.

      *    DISPLAY 'REC : ' REC.
      *    DISPLAY ' REC-COD-TREC : ' REC-COD-TREC IN REC.
           IF REC-COD-TREC IN REC NOT = VRP-DJ
               MOVE 'REC-CIC-IARC' TO FIO-AKEY 
              MOVE FIO-GET-NXT TO FIO-CMND
              GO TO LOP-FND-KEY.
              
           MOVE REC-CIC-IREL IN REC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM SGC-FIO-DBC.

           MOVE FIO-STAT TO PGM-STAT-DBC.

           IF NOT FIO-STAT-OKS                                         
               MOVE VRP-SGC      TO MSG-COD-SIST                       
               MOVE 'CLI    NEX' TO MSG-COD-MENS                       
               PERFORM GET-MSG                                         
               MOVE MSG-GLS-DESC TO DBC-GLS-NOMC IN DDJ-FLD            
           ELSE                                                        
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN                    
               PERFORM CPT-BLKS                                        
               MOVE CPT-STRN            TO DBC-GLS-NOMC IN DDJ-FLD     
               MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN DDJ-FLD     
               MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN DDJ-FLD     
               MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN DDJ-FLD     
               MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN DDJ-FLD.    

           MOVE TAB-EXT-CTAB IN TAB    TO FRM-EST-DDJ  IN DDJ-FLD.

           MOVE VRP-SGC                 TO FIO-SIST.
           MOVE VRP-SDJ                 TO TAB-COD-TTAB IN TAB.
           MOVE FRM-EST-DDJ IN DDJ-FLD  TO TAB-COD-CTAB IN TAB.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
              MOVE TAB-GLS-DESC IN TAB  TO FRM-GLS-DDJ IN DDJ-FLD
           ELSE
              MOVE SPACES               TO FRM-GLS-DDJ IN DDJ-FLD.
              
      *>>>>>
*% END
*% IF INI_CMN_ACC
      *<<<<< INI_CMN_ACC
           MOVE FRM-CAI-IFOL IN DDJ-FLD TO VRP-CAI-IFOL.
           MOVE FRM-IIC-IFOL IN DDJ-FLD TO VRP-IIC-IFOL.
      *RGD-INI PENTA 23-12-2014
           IF SCR-CMND = 'CAD'
              PERFORM VRP-CADUCA-RELAC
           ELSE
              IF SCR-CMND = 'ACA'
      *RGD-FIN PENTA
                 PERFORM VRP-PROC-RELAC.

           IF VRP-COD-MENS > SPACES
              MOVE FIO-BCK-OUT TO FIO-CMND
              PERFORM SGC-FIO-REC
              MOVE FRM-SUAR-MAL TO FRM-SUAR
              MOVE VRP-SGC      TO MSG-COD-SIST
              MOVE VRP-COD-MENS TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MEN1
      *RGD-INI PENTA 28-04-2015
      *       MOVE VRP-MSG-MENS TO FRM-MEN2.
              MOVE VRP-MSG-MENS TO FRM-MEN2
           ELSE
              MOVE VRP-CIC-ICLI TO CCU-CIC-ICLI IN CCU-VARI

              MOVE ZEROES TO CCU-NUM-MENS
              MOVE 'I' TO CCU-IND-MONI
              MOVE 'N' TO CCU-TSTO
              PERFORM CCU-POR-MRG

              MOVE CCU-NUM-MENS     TO WSS-FORMATO-MENSAJE-NUM
              MOVE CCU-COD-MENS     TO WSS-FORMATO-MENSAJE-COD
              MOVE 'RMRG'           TO WSS-FORMATO-MENSAJE-NOM
              MOVE TSK-TERM-NUM-TUX TO WSS-FORMATO-MENSAJE-TAR
              MOVE CCU-MOIA         TO WSS-FORMATO-MENSAJE-CAN
              MOVE SPACES           TO WSS-FORMATO-MENSAJE-DIS

              IF CCU-NUM-MENS > ZEROES
                 MOVE 'LDC'        TO MSG-COD-SIST
                 MOVE CCU-COD-MENS TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO FRM-MEN1
      *RGD-INI PENTA 18-06-2015
      *          MOVE WSS-FORMATO-MENSAJE TO FRM-MEN2
      *       ELSE
      *RGD-FIN PENTA 18-06-2015
                 MOVE WSS-FORMATO-MENSAJE TO FRM-MEN2.

      *       IF CCU-NUM-MENS-MAR NOT = ZEROES
      *          MOVE CCU-GLS-MON1-MAR TO FRM-MEN1
      *          MOVE CCU-GLS-MON2-MAR TO FRM-MEN2
      *          GO TO FIN-CMN-ACC.
      *RGD-INI PENTA 28-04-2015

           GO TO FIN-CMN-ACC.
      *>>>>>
*% END
*% IF INI_CMN_ELI
      *<<<<< INI_CMN_ELI
           MOVE FRM-CAI-IFOL IN DDJ-FLD TO VRP-CAI-IFOL.
           MOVE FRM-IIC-IFOL IN DDJ-FLD TO VRP-IIC-IFOL.
           PERFORM PROC-ELI-DDJ.
           IF VRP-COD-MENS > SPACES
              MOVE FIO-BCK-OUT TO FIO-CMND
              PERFORM SGC-FIO-REC
              MOVE FRM-SUAR-MAL TO FRM-SUAR
              MOVE VRP-SGC      TO MSG-COD-SIST
              MOVE VRP-COD-MENS TO MSG-COD-MENS
              PERFORM GET-MSG
              MOVE MSG-GLS-DESC TO FRM-MEN1
              MOVE VRP-MSG-MENS TO FRM-MEN2.
           GO TO FIN-CMN-ELI.
      *>>>>>
*% END
*% IF EOF
      *<<<<< EOF
       COPY GNSBGCPT.
       COPY SGCBFDBC.

      *>>>>>
*% END
*% IF EOF_PU
      *<<<<< EOF_PU
       COPY GNSBGHOY.
       COPY SGCBGVRP.
       COPY LDCBKMRG.
      *>>>>>
*% END
