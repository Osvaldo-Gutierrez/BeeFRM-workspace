*%! Codigo adicional para archivo
*% IF WSS
      *<<<< WSS
       COPY TABBRUSR.
       COPY TABBROFI.
       COPY SGCBRRCD.
       COPY GNSWGCPT.
*% IF PGM_PER
       COPY TABWGLOC.
*% END
       01  WSS-VARI.
           03 WSS-COD-OFIC                        PIC X(03).
           03 WSS-COD-EJEC                        PIC X(12).
           03 WSS-COD-TICL                        PIC X(02).
           03 WSS-IND-NEXT                        PIC 9(01).
*% IF NOT PGM_PER
           03 WSS-COD-LUGA.
              05 WSS-COD-COMU                     PIC X(04).
              05 WSS-GLS-PAIS  REDEFINES  WSS-COD-COMU.
                 07 WSS-IND-PAIS                  PIC X(01).
                 07 WSS-COD-PAIS                  PIC X(03).
*% END
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCD-REQA==.
      *>>>>
*% END
*% IF PH_DGC
      *<<<< PH_DGC
      * Mediante BUS-OFI se Obtiene Nombre de la Oficina de Tabla OFI
           IF DBC-COD-OFIC IN SRT > SPACES
               MOVE DBC-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFIC IN WSS-DGC
           ELSE
               MOVE SPACES TO WSS-GLS-OFIC IN WSS-DGC.

      * Mediante BUS-USR Busca Usuario de Tabla USR
           IF DBC-COD-EJEC IN SRT > SPACES
               MOVE DBC-COD-EJEC IN SRT TO USR-COD-USER IN USR
               PERFORM BUS-USR
               MOVE USR-GLS-DESC IN USR TO WSS-GLS-EJEC IN WSS-DGC
           ELSE
               MOVE SPACES TO WSS-GLS-EJEC IN WSS-DGC.

      * Mediante BUS-TAB se Obtiene Tipo Cliente de Tabla TCL
           IF DBC-COD-TICL IN SRT > SPACES
               MOVE 'SGC'               TO TAB-COD-SIST
               MOVE 'TCL'               TO TAB-COD-TTAB IN TAB
               MOVE DBC-COD-TICL IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TICL IN WSS-DGC
           ELSE
               MOVE SPACES TO WSS-GLS-TICL IN WSS-DGC.
      *>>>>
*% END
*% IF INI_FST_INP
      *<<<< INI_FST_INP
*% IF NOT PGM_PER
           IF NOT FIO-STAT-OKS
              DISPLAY 'ABORTO: ERROR APERTURA ARCHIVO SGCDBC FIO-STAT '
                       FIO-STAT
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-USR.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ABORTO: ERROR APERTURA ARCHIVO TABUSR FIO-STAT '
                       FIO-STAT
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-OFI.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ABORTO: ERROR APERTURA ARCHIVO TABOFI FIO-STAT '
                       FIO-STAT
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-RCD.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ABORTO: ERROR APERTURA ARCHIVO SGCRCD FIO-STAT '
                       FIO-STAT
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.

           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GNS' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ABORTO: ERROR APERTURA ARCHIVO GNSTAB FIO-STAT '
                       FIO-STAT
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.

           MOVE FIO-INP TO FIO-CMND.
           MOVE 'TAB' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ABORTO: ERROR APERTURA ARCHIVO TABTAB FIO-STAT '
                       FIO-STAT
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.

           MOVE FIO-INP TO FIO-CMND.
           MOVE 'SGC' TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ABORTO: ERROR APERTURA ARCHIVO SGCTAB FIO-STAT '
                       FIO-STAT
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.

           DISPLAY 'APERTURA ARCHIVOS ANEXOS OK'.
*% END
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.

      *Captura Codigo de Oficina
           DISPLAY 'OFICINA   (*=TODAS) : '.
           ACCEPT  WSS-COD-OFIC IN WSS-VARI.
           DISPLAY WSS-COD-OFIC IN WSS-VARI.
      *Captura Ejecutivo Operacion Credito
           DISPLAY 'EJECUTIVO (*=TODOS) : '.
           ACCEPT  WSS-COD-EJEC IN WSS-VARI.
           DISPLAY WSS-COD-EJEC IN WSS-VARI.
      *Captura Codigo Tipo de Cliente
           DISPLAY 'TIPO CLIENTE (*=TODOS) : '.
           ACCEPT  WSS-COD-TICL IN WSS-VARI.
           DISPLAY WSS-COD-TICL IN WSS-VARI.

           DISPLAY 'FIN    CAPTURA    DE PARAMETROS'.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

           IF WSS-COD-OFIC IN WSS-VARI NOT > SPACES AND
              WSS-COD-EJEC IN WSS-VARI NOT > SPACES
               DISPLAY 'DEBE EXISTIR OFICINA O EJECUTIVO O * EN AMBOS'
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.

      *VAL-OFI Valida Codigo de Oficina en TABLAS
           IF WSS-COD-OFIC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-OFIC IN WSS-VARI.
           IF WSS-COD-OFIC IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-OFIC IN WSS-VARI
               MOVE WSS-COD-OFIC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   MOVE PGM-SMAL TO PGM-STAT-SRT
                   GO TO FIN-INP-SRT.

      *VAL-USR Valida Codigo de Usuario en TABLAS
           IF WSS-COD-EJEC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-EJEC IN WSS-VARI.
           IF WSS-COD-EJEC IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-EJEC IN WSS-VARI
               MOVE WSS-COD-EJEC IN WSS-VARI TO USR-COD-USER IN USR
               PERFORM VAL-USR
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   MOVE PGM-SMAL TO PGM-STAT-SRT
                   GO TO FIN-INP-SRT.

      *VAL-TAB Valida Tipo de Cliente en TABLAS
           IF WSS-COD-TICL IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-TICL IN WSS-VARI.
           IF WSS-COD-TICL IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-TICL IN WSS-VARI
               MOVE 'SGC'                    TO TAB-COD-SIST
               MOVE 'TCL'                    TO TAB-COD-TTAB IN TAB
               MOVE WSS-COD-TICL IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM VAL-TAB
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   MOVE PGM-SMAL TO PGM-STAT-SRT
                   GO TO FIN-INP-SRT.

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.
      *>>>>
*% END
*% IF LUP_INP
      *<<<< LUP_INP
      * Proceso de Seleccion y Clasificacion a Partir del Registro VEN
           PERFORM SEL-REG-PRO.
           IF WSS-IND-NEXT IN WSS-VARI = 1
               GO TO NXT-INP-SRT.
           PERFORM BUS-SRT-REG.
           GO TO NXT-INP-SRT.
      *>>>>
*% END
*% IF INI_OUT
      *<<<< INI_OUT
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
      *>>>>
*% END
*% IF LUP_OUT
      *<<<< LUP_OUT
      * MOVE de variables DBC al RPT
      * BUSQUEDA OFICINA
           IF DBC-COD-OFIC IN SRT > SPACES
               MOVE DBC-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC TO WSS-GLS-OFIC
           ELSE
               MOVE ALL '_' TO WSS-GLS-OFIC
               MOVE ALL '_' TO DBC-COD-OFIC IN SRT.
      * BUSQUEDA TIPO CLIENTE
           IF DBC-COD-TICL IN SRT > SPACES
               MOVE 'SGC' TO TAB-COD-SIST
               MOVE 'TCL' TO TAB-COD-TTAB IN TAB
               MOVE DBC-COD-TICL IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TICL
           ELSE
               MOVE ALL '_' TO WSS-GLS-TICL
               MOVE ALL '_' TO DBC-COD-TICL IN SRT.
      * BUSQUEDA EJECUTIVO
           IF DBC-COD-EJEC IN SRT > SPACES
               MOVE 'EJC'               TO USR-COD-TTAB IN USR
               MOVE DBC-COD-EJEC IN SRT TO USR-COD-USER IN USR
               PERFORM BUS-USR
               MOVE USR-GLS-DESC TO WSS-GLS-EJEC
           ELSE
               MOVE ALL '_' TO WSS-GLS-EJEC
               MOVE ALL '_' TO DBC-COD-EJEC IN SRT.
      * FIN BUSQUEDA
           PERFORM GEN-LIN-OUT.
           GO TO NXT-OUT-SRT.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      **************************************************************************
      * Seleccion del Registro para Proceso Mediante Oficina y Ejecutivo del
      * Listado
       SEL-REG-PRO SECTION.
       INI-SEL-REG-PRO.
           MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.

           IF WSS-COD-OFIC IN WSS-VARI NOT = '*'
               IF WSS-COD-OFIC IN WSS-VARI NOT = DBC-COD-OFIC IN DBC
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-EJEC IN WSS-VARI NOT = '*'
               IF WSS-COD-EJEC IN WSS-VARI NOT = DBC-COD-EJEC IN DBC
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-TICL IN WSS-VARI NOT = '*'
               IF WSS-COD-TICL IN WSS-VARI NOT = DBC-COD-TICL IN DBC
                   GO TO FIN-SEL-REG-PRO.

           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
       FIN-SEL-REG-PRO.
           EXIT.
      **************************************************************************
      * Formacion y Generacion del Registro SRT al Procesar Varios Registros
       BUS-SRT-REG SECTION.
       INI-BUS-SRT-REG.
      * Complementa Formacion del Registro SRT
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC.

      * Completa Llenado de Campos y Genera el Registro SRT
           COPY SGCRMDGC.
           RELEASE SRT.
       FIN-BUS-SRT-REG.
           EXIT.
      **************************************************************************
      * Genera Lineas de Detalle a Partir de Registro SRT Ordenado
       GEN-LIN-OUT SECTION.
       INI-GEN-LIN-OUT.
           MOVE '-'        TO WSS-GLS-AUX1 IN WSS-DGC.
*% IF PGM_ARG
           MOVE '-'        TO WSS-GLS-AUX2 IN WSS-DGC.
           IF DBC-IND-ICLI IN SRT > SPACES
               MOVE '-'    TO WSS-GLS-AUX3 IN WSS-DGC
           ELSE
               MOVE SPACES TO WSS-GLS-AUX3 IN WSS-DGC.
*% ELSE           
           IF DBC-GLS-ICLI IN SRT > SPACES
               MOVE '-'    TO WSS-GLS-AUX2 IN WSS-DGC
           ELSE
               MOVE SPACES TO WSS-GLS-AUX2 IN WSS-DGC.
*% END
      * Mediante BUS-DOM y BUS-TAB Busca Comuna Obteniendo Codigos de Tabla COM
           MOVE DBC-CAI-ICLI IN SRT TO DBC-CAI-ICLI IN DBC.
           MOVE DBC-IIC-ICLI IN SRT TO DBC-IIC-ICLI IN DBC.
           MOVE DBC-CIC-ICLI IN DBC TO RCD-CIC-ICLI IN RCD.

           MOVE ZEROES      TO RCD-NUM-DIRE IN RCD.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-BUS-DIRE.
           PERFORM SGC-FIO-RCD.
           IF NOT ( FIO-STAT-OKS AND
                    DBC-CIC-ICLI IN DBC = RCD-CIC-ICLI IN RCD )
               GO TO FIN-GEN-LIN-OUT.
*% IF PGM_PER
           IF RCD-GLS-DIRE IN RCD > SPACES
               MOVE RCD-COD-LUGA IN RCD TO LOC-LUGA
               PERFORM TAB-BUS-LOC
               MOVE LOC-DESC TO WSS-GLS-COMU IN WSS-DGC
*% ELSE
           IF RCD-GLS-DIRE IN RCD > SPACES
               MOVE RCD-COD-LUGA IN RCD TO WSS-COD-LUGA IN WSS-VARI
               IF WSS-IND-PAIS NOT = 'P'
                   MOVE 'TAB'                    TO TAB-COD-SIST
                   MOVE 'COM'                    TO TAB-COD-TTAB IN TAB
                   MOVE WSS-COD-LUGA IN WSS-VARI TO TAB-COD-CTAB IN TAB
                   PERFORM BUS-TAB
                   MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-COMU IN WSS-DGC
               ELSE
                   MOVE 'TAB'                    TO TAB-COD-SIST
                   MOVE 'PAI'                    TO TAB-COD-TTAB IN TAB
                   MOVE WSS-COD-PAIS IN WSS-VARI TO TAB-COD-CTAB IN TAB
                   PERFORM BUS-TAB
                   MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-COMU IN WSS-DGC
*% END
           ELSE
               MOVE '*'    TO RCD-GLS-DIRE IN RCD
               MOVE '*'    TO WSS-GLS-COMU IN WSS-DGC
               MOVE '*'    TO RCD-GLS-FONO IN RCD.
           GENERATE DL-DGC.
           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE SPACES TO WSS-GLS-AUX2 IN WSS-DGC.
           MOVE SPACES TO WSS-GLS-AUX1 IN WSS-DGC.
           GO TO LUP-BUS-DIRE.
       FIN-GEN-LIN-OUT.
           EXIT.
      **************************************************************************

       COPY TABBFUSR.
       COPY TABBFOFI.
       COPY SGCBFRCD.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY TABBBUSR.
       COPY TABBBOFI.
       COPY GNSBVTAB.
       COPY TABBVUSR.
       COPY TABBVOFI.
       COPY GNSBGCPT.
       COPY SGCBGDOM.
*% IF PGM_PER
       COPY TABBBLOC.
*% END
      *>>>>
*% END
