*%! Codigo adicional para archivo
*% NO_HDR_CST = TRUE
*% LARGO_MI_COMMAREA = 2220
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
      *ISP ENGANCHE :
      * MODULO PARA ENGANCHE PROGRAMA ICM - RCO. VARIABLES EN COMMAREA
      * LLAVE DE LA OPERACION, INDICADOR SI ESTA ENGANCHADO, ORIGEN,ETC
      * LAS PRIMERAS VARIABLES DE EXTENSION DE COMMAREA DE PROGRAMAS
      * ENGANCHADOS DEBEN SER LAS DEL ENGANCHE.
       COPY SGCWGENG.
      *>>>>
*% END
*%! RVM: 25-06-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
*% RA1 = "DBC"
*% RA2 = "RCO"
*% NRA = 2
*% FRM = "ICM"
*% TCA = 2220
*% INCLUDE 'PFSALLALL'
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-REC-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCD-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==. 
      *DAD ini  22-MAY-1992
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCP-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCE-REQA==. 
      *DAD fin  22-MAY-1992
*% IF NOT PGM_PER
      *DAD ini  20-AGO-1993
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CTL-REQA==.
      *DAD fin  20-AGO-1993
      *DAD ini  02-NOV-1993
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MVO-REQA==.
      *DAD fin  02-NOV-1993
*% END
      *>>>>
*% END
*% IF WSS_IBM
      *<<<< WSS_IBM
      *ALD
       COPY GNSBRJGN.
      *DAD ini  24-ABR-1992
      * COPY SGCBRMCC.
      *DAD fin  24-ABR-1992
       COPY GNSWGBCD.
      *
      *DAD ini  02-MAY-1991
       COPY SGCBRPER.
      *DAD fin  02-MAY-1991
       COPY SGCBRDBC.
       COPY SGCBRRCD.
       COPY SGCBROPE.
       COPY SGCBRRCO.
       COPY SGCBRREC.
      *DAD ini  22-MAY-1992
       COPY SGCBRDCP.
       COPY SGCBRDCE.
      *DAD fin  22-MAY-1992
*% IF NOT PGM_PER
      *DAD ini  20-AGO-1993
       COPY SGCBRCTL.
      *DAD fin  20-AGO-1993
      *DAD ini  02-NOV-1993
       COPY COLBRMVO.
      *DAD fin  02-NOV-1993
*% END
       COPY SGCWGCCT.
       COPY SGCWVPPU.
       COPY TABBRPAI.
      *DAD ini  07-MAR-1991
       COPY GNSWGSTR.
      *DAD fin  07-MAR-1991
       COPY GNSWGCPT.

       01  WSS-VARI.
      *DAD ini  13-DEC-1993 / 02-NOV-1993
           03 WSS-FEC-FTRN.
              05 WSS-NUM-STRN                    PIC 9(02).
              05 WSS-NUM-ATRN                    PIC 9(02).
              05 WSS-NUM-MTRN                    PIC 9(02).
              05 WSS-NUM-DTRN                    PIC 9(02).
           03 WSS-NUM-TERM     VALUE 1100        PIC 9(04).
           03 WSS-NUM-OFOP     VALUE ZEROES      PIC 9(03).
           03 WSS-NUM-CORG     VALUE ZEROES      PIC 9(08).
           03 WSS-HRA-HRTR     VALUE '030000'    PIC X(06).
           03 WSS-MVO-PROG     VALUE 'FREPL020'  PIC X(08).
           03 WSS-NUM-TBCI     VALUE ZEROES      PIC 9(12).
           03 WSS-COD-MENS     VALUE SPACES      PIC X(12).
      *DAD fin  13-DEC-1993 / 02-NOV-1993
           03 WSS-NRO-CCTA                       PIC 9(08).
           03 WSS-NRO-RINF                       PIC 9(08).
           03 WSS-NRO-RSUP                       PIC 9(08).
           03 WSS-NRO-RINI                       PIC 9(08).
           03 WSS-NRO-RSUI                       PIC 9(08).
           03 WSS-RNG-CCTA.
              05 WSS-FIL01                       PIC X(10).
              05 WSS-NUM-RINI                    PIC X(08).
              05 WSS-FIL02                       PIC X(02).
              05 WSS-NUM-RSUI                    PIC X(08).
              05 WSS-FIL03                       PIC X(02).
              05 WSS-NUM-RINF                    PIC X(08).
              05 WSS-FIL04                       PIC X(02).
              05 WSS-NUM-RSUP                    PIC X(08).
              05 WSS-FIL05                       PIC X(12).
           03 WSS-CTA-CCTE.
              05 WSS-NUM-CCTE                    PIC 9(07).
              05 WSS-VRF-CCTE                    PIC 9(01).
           03 WSS-COD-LUGA.
              05  WSS-COD-COMU                   PIC X(04).
              05  WSS-GLS-PAIS REDEFINES WSS-COD-COMU.
                  07  WSS-IND-PAIS                PIC X(01).
                  07  WSS-COD-PAIS                PIC X(03).
           03  WSS-IND-IEDS                       PIC X(01).
           03  WSS-IND-IBAL                       PIC X(01).
           03  WSS-FEC-FHOY.
               05  WSS-NUM-DHOY                   PIC 9(02).
               05  WSS-NUM-MHOY                   PIC 9(02).
               05  WSS-NUM-AHOY                   PIC 9(02).
           03  WSS-AUX                COMP        PIC 9(02).
           03  WSS-DIG                            PIC 9(01).
           03  WSS-AUX-DLIM.
               05  WSS-AUX-DLI1                   PIC X(01).
               05  WSS-AUX-DLI2                   PIC X(01).
           03  WSS-RUT.
               05  WSS-FILLER                     PIC 9(03).
               05  WSS-GLS-RUT.
                   07  WSS-NUM-RUT                PIC X(07).
                   07  WSS-NUM-DIG                PIC X(01).
               05  WSS-NUM-VRF                    PIC X(01).  
           03  WSS-SIN-BRUT.
               05  WSS-FIL1                       PIC 9(03).
               05  WSS-GLS-SINB                   PIC X(07).
           03  WSS-BCD-RUT.
               05  WSS-NUM-BRUT                   PIC X(05).
               05  WSS-VRF-BRUT                   PIC X(01).
           03  WSS-CIC-IOPE.
               05  WSS-NUM-DIGI                   PIC X(02).
               05  WSS-IIC-IOPE                   PIC X(08).
           03  WSS-CIC-MOTC.
               05  WSS-CIC-MOT1                   PIC X(02).
               05  WSS-CIC-MOT2                   PIC X(10).
           03  WSS-CIC-ACTI.
               05  WSS-CIC-ACT1                   PIC X(02).
               05  WSS-CIC-ACT2                   PIC X(09).
      *DAD ini  05-JUN-1992 ( Codigo Incorporado a peticion RM )
      *     03  WSS-COD-OFIC                       PIC X(03).
           03 WSS-IDE-OFCT.
              05  WSS-COD-OFIC                   PIC X(03).
              05  FILLER           VALUE SPACES  PIC X(01).
              05  WSS-TIP-CCTA                   PIC X(02).
              05  FILLER           VALUE SPACES  PIC X(54).
      *DAD fin  05-JUN-1992
      *DAD ini  11-MAR-1991
           03  WSS-CIC-ICLI                       PIC X(12).
      *DAD fin  11-MAR-1991
      *DAD ini  02-MAY-1991
           03  WSS-CTA-CTE                        PIC X(08).
               88 VAL-CCTE-DOLAR   VALUES '11060000' THRU '11209999'.
      *DAD fin  02-MAY-1991
      *DAD ini  22-MAY-1992
           03  WSS-GLS-ERRO.
               05  WSS-GLS-ERR0                   PIC X(03).
               05  WSS-GLS-ERR1                   PIC X(10).
               05  WSS-GLS-ERR2                   PIC X(20).
      *DAD fin  22-MAY-1992
      ************************************************************************
      *DAD ini  23-MAR-1992
           03  WSS-COD-CCTE                       PIC X(12).
      * ---- agregado por odj desde aqui (g)
       01  W-REGISTROS-DE-TRABAJO.
           05 WR-OPE                    PIC X(150).
           05 WR-TIPO-CTAPRI            PIC X(02).
           05 WR-CAMBIA-CTACTE          PIC X(02).
           05 WR-GLS-TCOM               PIC X(07).
           05 WR-GLS-TCOM-NUM REDEFINES WR-GLS-TCOM PIC 9(05)V9(02).
      * ---- agregado por odj hasta aqui (g)
      *DAD fin  23-MAR-1992
      ************************************************************************
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
      *ISP ENGANCHE :
      *    TABLAS DE TRANSACCIONES, PROGRAMAS, MAPAS INVOLUCRADOS
      *    EN EL ENGANCHE
      * 'W'SS, 'I'CC, 'R'CO
       COPY SGCWGPMP.
      *>>>>
*% END
*% IF NOT PGM_PER
*% BLLCELLS_USR = TRUE
*% IF BLLCELLS
      *<<<< BLLCELLS
      *DAD ini  13-DEC-1993 / 02-NOV-1993
      *Para Proceso Genera y Activa con registro MVO (Pro. Linea)
       COPY SGCLGCCT.
      *DAD fin  13-DEC-1993 / 02-NOV-1993
      *>>>>
*% END
*% END
*% IF INI_SCR_ACC AND PGM_PU
      *<<<< INI_SCR_ACC AND PGM_PU
      *DAD ini  23-MAR-1992
      * Para enviar el control al programa PQ sin recibir el Mapa en el PU
           IF FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF8 OR
                         FRM-FFLD-PF5 OR FRM-FFLD-PF6
               PERFORM XCT-PRGP.
      *DAD fin  23-MAR-1992
      *>>>>
*% END
*% IF BRW_SCR_ACC
      *<<<< BRW_SCR_ACC
      *DAD ini  23-MAR-1992
      * Para recibir el Mapa en el PQ
           MOVE SCR-NMAP    TO FRM-NAME.
           MOVE SCR-NLIB    TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES   TO FRM-MENS.
           MOVE FRM-DFLD TO ICM-FLD.
      *DAD fin  23-MAR-1992
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
           PERFORM KEY-ALL-ICM.
           MOVE FRM-GLS-NOMC IN ICM-FLD TO DBC-GLS-NOMC IN DBC.
*%! RVM: 25-06-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
      *<<<< PGM_DTC
           IF FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM LEE-NXT-PRV
               IF FIO-STAT-OKS
                   PERFORM SCR-CLRA-ICM
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN            TO FRM-GLS-NOMC IN ICM-FLD
                   MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN ICM-FLD
                   MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN ICM-FLD
                   MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN ICM-FLD
                   MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN ICM-FLD
                   MOVE DBC-CAI-ICLI IN DBC TO DCC-CAI-ICLI IN ICM-FLD
                   MOVE DBC-IIC-ICLI IN DBC TO DCC-IIC-ICLI IN ICM-FLD
                   GO TO CON-FND-KEY
               ELSE
                   MOVE SPACES TO PGM-STAT
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE 'SGC'          TO MSG-COD-SIST
                       MOVE 'DCC    NOPRV' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE '00'         TO FIO-STAT
                       MOVE SCR-STAT-CON TO SCR-STAT
                       GO TO FIN-FND-KEY
                   ELSE
                       MOVE 'SGC'          TO MSG-COD-SIST
                       MOVE 'DCC    NONXT' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE '00'         TO FIO-STAT
                       MOVE SCR-STAT-CON TO SCR-STAT
                       GO TO FIN-FND-KEY.
      *DAD ini  11-MAR-1991
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6
               IF SCR-RCO-REQA > SPACES
                   PERFORM LEE-NXT-PRV-RCO
               ELSE
                   MOVE 'GNS'    TO MSG-COD-SIST
                   MOVE 'PFSINV' TO MSG-COD-MENS.

           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6
               IF MSG-COD-MENS > SPACES
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE '00'         TO FIO-STAT
                   MOVE SCR-STAT-CON TO SCR-STAT
                   GO TO FIN-FND-KEY
               ELSE
                   GO TO FIN-FND-KEY.
      *DAD fin  11-MAR-1991
      *>>>>
*% END
           IF DBC-NUM-ICLI IN ICM-FLD > ZEROES
      *IDC-CLI Busca Cliente por medio de IdC
               MOVE DBC-NUM-ICLI IN ICM-FLD TO DBC-NUM-ICLI IN DBC
               MOVE DBC-IND-ICLI IN ICM-FLD TO DBC-IND-ICLI IN DBC
               MOVE DBC-GLS-ICLI IN ICM-FLD TO DBC-GLS-ICLI IN DBC
               MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY
               MOVE FIO-GET-KEY-ALT TO FIO-CMND
               PERFORM GET-CLI
               MOVE FIO-STAT TO PGM-STAT-DBC
               IF MSG-COD-MENS > SPACES
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE '00'         TO FIO-STAT
                   MOVE SCR-STAT-CON TO SCR-STAT
                   GO TO FIN-FND-KEY
               ELSE
*%! RVM: 25-06-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
      *<<<< PGM_DTC
                   MOVE ADR-DBC-REQA TO SCR-DBC-REQA
      *>>>>
*% END
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN            TO FRM-GLS-NOMC IN ICM-FLD
                   MOVE DBC-CAI-ICLI IN DBC TO DCC-CAI-ICLI IN ICM-FLD
                   MOVE DBC-IIC-ICLI IN DBC TO DCC-IIC-ICLI IN ICM-FLD
           ELSE
           IF FRM-GLS-NOMC IN ICM-FLD > SPACES
               MOVE SPACES TO DBC-GLS-NOMC IN DBC
      *NOM-CLI Busca Cliente por medio del Nombre
      *DAD ini  07-MAR-1991
               MOVE FRM-GLS-NOMC IN ICM-FLD TO STR-GLS-GSTR
               PERFORM STR-UNS
               MOVE STR-GLS-FUNS IN STR-VARI(1) TO DBC-GLS-APAT IN DBC
               MOVE STR-GLS-FUNS IN STR-VARI(2) TO DBC-GLS-AMAT IN DBC
               MOVE STR-GLS-FUNS IN STR-VARI(3) TO DBC-GLS-NOMB IN DBC
      *DAD fin  07-MAR-1991
               MOVE 'DBC-GLS-NOMC'  TO FIO-AKEY
               MOVE FIO-GET-NLS-ALT TO FIO-CMND
               PERFORM GET-CLI
               MOVE FIO-STAT TO PGM-STAT-DBC
               IF MSG-COD-MENS > SPACES
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE '00'         TO FIO-STAT
                   MOVE SCR-STAT-CON TO SCR-STAT
                   GO TO FIN-FND-KEY
               ELSE
*%! RVM: 25-06-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
      *<<<< PGM_DTC
                   MOVE ADR-DBC-REQA TO SCR-DBC-REQA
      *>>>>
*% END
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN            TO FRM-GLS-NOMC IN ICM-FLD
                   MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN ICM-FLD
                   MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN ICM-FLD
                   MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN ICM-FLD
                   MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN ICM-FLD
                   MOVE DBC-CAI-ICLI IN DBC TO DCC-CAI-ICLI IN ICM-FLD
                   MOVE DBC-IIC-ICLI IN DBC TO DCC-IIC-ICLI IN ICM-FLD.
       CON-FND-KEY.
           PERFORM RET-DBC-ICM.
           PERFORM KEY-DBC-ICM.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
           IF FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF8
               MOVE '00' TO FIO-STAT
               GO TO CON-FIN-FND-KEY.
           IF SCR-CMND = 'ACC'
               MOVE '00' TO FIO-STAT
               GO TO FIN-FND-KEY.
           IF SCR-CMND = 'CCC' 
               MOVE DCC-CAI-ICLI IN ICM-FLD TO DBC-CAI-ICLI IN DBC
               MOVE DCC-IIC-ICLI IN ICM-FLD TO DBC-IIC-ICLI IN DBC
               GO TO BUS-PRES.
       CON-FIN-FND-KEY.
           MOVE DCC-CAI-ICLI IN ICM-FLD TO DBC-CAI-ICLI IN DBC.
           MOVE DCC-IIC-ICLI IN ICM-FLD TO DBC-IIC-ICLI IN DBC.
           PERFORM BUS-OLD-CCT.
           IF (MSG-COD-MENS > SPACES AND
      *DAD ini  23-MAR-1992
               MSG-COD-MENS NOT = 'CLI    NOCCT') OR
              (MSG-COD-MENS = 'CLI    NOCCT' AND SCR-CMND NOT = 'ACC')
      *DAD fin  23-MAR-1992
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
           IF MSG-COD-MENS NOT > SPACES
               MOVE '00' TO PGM-STAT-OPE
               PERFORM BUS-RCO
*%! RVM: 25-06-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
      *<<<< PGM_DTC
      *DAD ini  11-MAR-1991
               MOVE ADR-RCO-REQA TO SCR-RCO-REQA
      *DAD fin  11-MAR-1991
      *>>>>
*% END
           ELSE
               PERFORM BUS-DOM
               PERFORM PUT-RCD
               MOVE SPACES                   TO OPE-COD-OFOP IN OPE
               MOVE SPACES                   TO OPE-IND-MCLI IN OPE
               MOVE SPACES                   TO OPE-CAI-IOPE IN OPE
               MOVE ZEROES                   TO OPE-IIC-IOPE IN OPE
               MOVE SPACES                   TO OPE-FEC-FIOP IN OPE
               MOVE SPACES                   TO OPE-COD-EJOP IN OPE
               MOVE SPACES                   TO OPE-COD-VCOP IN OPE
               MOVE SPACES                   TO OPE-FEC-FTOP IN OPE
               MOVE SPACES                   TO OPE-COD-MOTT IN OPE
      ************************************************************************
      *DAD ini  23-MAR-1992
      * -------- agregado por odj desde aqui (d)
               MOVE SPACES                   TO OPE-CAI-ICAR IN OPE
               MOVE SPACES                   TO OPE-IIC-ICAR IN OPE
               MOVE SPACES                   TO OPE-COD-TCOM IN OPE
      * -------- agregado por odj hasta aqui (d)
      *DAD fin  23-MAR-1992
      ************************************************************************
               MOVE WSS-COD-OFIC IN WSS-VARI TO OPE-COD-OFOP IN OPE
               MOVE '00' TO PGM-STAT-OPE.
       BUS-PRES.
           PERFORM BUS-RCP.
           PERFORM PUT-RCP.
           PERFORM RET-DBC-ICM.
           PERFORM KEY-DBC-ICM.
           MOVE '00' TO FIO-STAT.
           IF SCR-CCPP = 'ING'
               MOVE PGM-STAT-DCC TO FIO-STAT
               GO TO FIN-FND-KEY.
      *>>>>
*% END
*% IF PUT_SCR
      *<<<< PUT_SCR
      *DAD ini  05-JUN-1992 / 22-MAY-1992
      *     IF SCR-CMND = 'ACC'
      *         PERFORM CHK-DBC-TICL.
      *DAD fin  05-JUN-1992 / 22-MAY-1992
      *DAD ini  23-MAR-1992 / 02-MAY-1991
           IF PGM-STAT-OPE-OKS
               MOVE OPE-IIC-IOPE IN OPE TO PER-KEY-IPER IN PER
               PERFORM SGC-FIO-PER
               MOVE FIO-STAT TO PGM-STAT-PER.
      *DAD fin  23-MAR-1992 / 02-MAY-1991
      *>>>>
*% END
*% IF FIN_HBL_KEY
      *<<<< FIN_HBL_KEY
      *DAD ini  23-MAR-1992
           PERFORM PRO-FLD-ICM.
      *DAD fin  23-MAR-1992
      *>>>>
*% END
*% IF FIN_HBL_FLD
      *<<<< FIN_HBL_FLD
      *DAD ini  02-NOV-1993
           IF SCR-CMND = 'ACL'
               PERFORM PRO-MKY-ICM
               PERFORM PRO-FLD-ICM
               MOVE FRM-CPIM-UBY TO FRM-NUM-TBCI-ATR IN ICM-FLD
           ELSE
      *DAD fin  02-NOV-1993
      *DAD ini  02-MAY-1991 / 05-MAR-1991
           IF SCR-CMND = 'MEJ'
               PERFORM PRO-MKY-ICM
               PERFORM PRO-FLD-ICM
               MOVE FRM-CPIM-UBY TO OPE-COD-EJOP-ATR IN ICM-FLD
           ELSE
      *DAD fin  02-MAY-1991 / 05-MAR-1991
           IF SCR-CMND = 'ACC' OR
              SCR-CMND = 'CCC'
               MOVE '0000' TO OPE-CAI-IOPE IN ICM-FLD
               IF SCR-CMND = 'ACC'
                   MOVE FRM-CPIM-AEY TO OPE-FEC-FTOP-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO OPE-COD-MOTT-ATR IN ICM-FLD
               ELSE
                   MOVE FRM-CPIM-AEY TO RCO-NUM-DIRE-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO OPE-COD-OFOP-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO FRM-NUM-ICLP-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO FRM-IND-ICLP-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO FRM-GLS-ICLP-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO FRM-VRF-ICLP-ATR IN ICM-FLD
      *            MOVE FRM-CPIM-AEY TO FRM-GLS-NCLP-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO OPE-FEC-FIOP-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO OPE-COD-EJOP-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO FRM-IND-MCLI-ATR IN ICM-FLD
      *DAD ini  02-MAY-1991
                   MOVE FRM-CPIM-AEY TO PER-GLS-NOM1-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO PER-GLS-NOM2-ATR IN ICM-FLD
      *DAD fin  02-MAY-1991
      ************************************************************************
      *DAD ini  23-MAR-1992 PU
      *----- agregado por odj desde aqui (o)
                   MOVE FRM-CPIM-AEY TO OPE-COD-TCOM-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO OPE-IIC-ICAR-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO OPE-CAI-ICAR-ATR IN ICM-FLD
      *----- agregado por odj hasta aqui (o)
      *DAD fin  23-MAR-1992
      ************************************************************************
      *DAD ini  02-NOV-1993
                   MOVE FRM-CPIM-AEY TO FRM-NUM-TBCI-ATR IN ICM-FLD
      *DAD fin  02-NOV-1993
           ELSE
           IF SCR-CMND = 'MCC'
               PERFORM PRO-FLD-ICM
      *DAD ini  23-MAR-1992
      *         MOVE '0000'       TO OPE-CAI-IOPE     IN ICM-FLD
      *         MOVE FRM-CPIM-UBY TO OPE-CAI-IOPE-ATR IN ICM-FLD
      *         MOVE FRM-CPIM-UBY TO OPE-IIC-IOPE-ATR IN ICM-FLD
               MOVE 0            TO OPE-IIC-IOPE-LEN IN ICM-FLD
               MOVE -1           TO RCO-NUM-DIRE-LEN IN ICM-FLD
      *DAD fin  23-MAR-1992
               MOVE FRM-CPIM-UBY TO RCO-NUM-DIRE-ATR IN ICM-FLD
      *DAD ini  02-MAY-1991
               MOVE FRM-CPIM-UBY TO PER-GLS-NOM1-ATR IN ICM-FLD
               MOVE FRM-CPIM-UBY TO PER-GLS-NOM2-ATR IN ICM-FLD
      *DAD fin  02-MAY-1991
      ************************************************************************
      *DAD ini  23-MAR-1992 PU
      *----- agregado por odj desde aqui (p)
               MOVE FRM-CPIM-UBY TO OPE-COD-TCOM-ATR IN ICM-FLD
               MOVE FRM-CPIM-UBY TO OPE-IIC-ICAR-ATR IN ICM-FLD
               MOVE FRM-CPIM-UBY TO OPE-CAI-ICAR-ATR IN ICM-FLD
      *----- agregado por odj hasta aqui (p)
      *DAD fin  23-MAR-1992
      ************************************************************************
           ELSE
           IF SCR-CMND = 'INS'
               PERFORM PRO-FLD-ICM
               MOVE '0000'       TO OPE-CAI-IOPE     IN ICM-FLD
               MOVE FRM-CPIM-UBY TO OPE-CAI-IOPE-ATR IN ICM-FLD
               MOVE FRM-CPIM-UBY TO OPE-IIC-IOPE-ATR IN ICM-FLD
           ELSE
               MOVE FRM-CPIM-AEY TO RCO-NUM-DIRE-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO OPE-COD-OFOP-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO OPE-FEC-FIOP-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO OPE-FEC-FTOP-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO OPE-CAI-IOPE-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO OPE-IIC-IOPE-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO OPE-COD-MOTT-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO OPE-COD-EJOP-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO FRM-IND-MCLI-ATR IN ICM-FLD
      *DAD ini  02-MAY-1991
               MOVE FRM-CPIM-AEY TO PER-GLS-NOM1-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO PER-GLS-NOM2-ATR IN ICM-FLD
      *DAD fin  02-MAY-1991
      ************************************************************************
      *DAD ini  23-MAR-1992 PU
      *----- agregado por odj desde aqui (p)
               MOVE FRM-CPIM-AEY TO OPE-COD-TCOM-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO OPE-IIC-ICAR-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO OPE-CAI-ICAR-ATR IN ICM-FLD
      *----- agregado por odj hasta aqui (p)
      *DAD fin  23-MAR-1992
      ************************************************************************
      *DAD ini  02-NOV-1993
               MOVE FRM-CPIM-AEY TO FRM-NUM-TBCI-ATR IN ICM-FLD
      *DAD fin  02-NOV-1993
      *         IF SCR-CCPP = 'MOD'
               MOVE FRM-CPIM-AEY TO FRM-NUM-ICLP-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO FRM-IND-ICLP-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO FRM-GLS-ICLP-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO FRM-VRF-ICLP-ATR IN ICM-FLD.

      *         MOVE FRM-CPIM-AEY TO FRM-GLS-NCLP-ATR IN ICM-FLD.
      ************************************************************************
      *DAD ini  23-MAR-1992 PQ
      * ---- agregado por odj desde aqui (e)
           IF SCR-CMND = 'MEJ'
               NEXT SENTENCE
           ELSE
           IF SCR-CMND = 'ACC' OR
              SCR-CMND = 'CCC'
               IF SCR-CMND = 'ACC'
                   NEXT SENTENCE
               ELSE
                   MOVE FRM-CPIM-AEY TO OPE-COD-TCOM-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO OPE-CAI-ICAR-ATR IN ICM-FLD
                   MOVE FRM-CPIM-AEY TO OPE-IIC-ICAR-ATR IN ICM-FLD
           ELSE
           IF SCR-CMND = 'MCC'
               MOVE FRM-CPIM-UBY TO OPE-COD-TCOM-ATR IN ICM-FLD
               MOVE FRM-CPIM-UBY TO OPE-CAI-ICAR-ATR IN ICM-FLD
               MOVE FRM-CPIM-UBY TO OPE-IIC-ICAR-ATR IN ICM-FLD
           ELSE
               MOVE FRM-CPIM-AEY TO OPE-COD-TCOM-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO OPE-CAI-ICAR-ATR IN ICM-FLD
               MOVE FRM-CPIM-AEY TO OPE-IIC-ICAR-ATR IN ICM-FLD.
      * ---- agregado por odj hasta aqui (e)
      *DAD fin  23-MAR-1992
      ************************************************************************
      *>>>>
*% END
*% IF FIN_HBL_FLD
      *<<<< FIN_HBL_FLD
      * ISP EN ESTE ENGANCHE NO ES NECESARIO PROTEGER LOS CAMPOS,
      *     PUES EL INDICADOR DE MULTIPLES ES INDEPENDIENTE A LOS
      *     DATOS DE LOS CLIENTES
*% END
*% IF INI_CMN_ACC
      *<<<< INI_CMN_ACC
      *DAD ini  02-NOV-1993
           IF SCR-CMND = 'ACL' OR 'ACC' 
               IF FRM-NUM-TBCI IN ICM-FLD > ZEROES
                   PERFORM PRO-VAL-TBCI-TNDM.
      *DAD fin  02-NOV-1993
      *DAD ini  02-MAY-1991
           IF SCR-CMND = 'ACC' OR 'MCC' OR 'CCC'
               IF ( PER-GLS-NOM1 IN ICM-FLD NOT > SPACES AND
                    PER-GLS-NOM2 IN ICM-FLD NOT > SPACES ) OR
                  SCR-CMND = 'CCC'
                   PERFORM PRO-DEL-PER
      ************************************************************************
      *DAD ini  23-MAR-1992
      * ---- modificado por odj desde aqui  (A)
      **             IF FRM-MEN1 > SPACES 
      *             IF FRM-MEN2 > SPACES AND
      *                 GO TO FIN-CMN-ACC
      *            ELSE
      *                NEXT SENTENCE
      * ---- modificado por odj hasta aqui  (A)
               ELSE
      *             PERFORM PRO-ACT-PER
                   PERFORM PRO-ACT-PER.
      * ---- modificado por odj desde aqui  (A)
      **             IF FRM-MEN1 > SPACES 
      *            IF FRM-MEN2 > SPACES
      *                GO TO FIN-CMN-ACC.
      * ---- modificado por odj hasta aqui  (A)

      * --------- agregado por odj desde aqui (o)
           IF SCR-CMND = 'ACC' AND
              PER-GLS-NOM1 IN ICM-FLD NOT > SPACES AND
              PER-GLS-NOM2 IN ICM-FLD NOT > SPACES
              MOVE 'PERSONALIZACION NO FUE INGRESADA' TO FRM-MEN2.
      * --------- agregado por odj hasta aqui (o)
      *DAD fin  23-MAR-1992
      ************************************************************************
      *DAD fin  02-MAY-1991
      *DAD ini  05-MAR-1991
           IF SCR-CMND = 'MEJ'
               MOVE OPE-CAI-IOPE IN ICM-FLD TO OPE-CAI-IOPE IN OPE
               MOVE OPE-IIC-IOPE IN ICM-FLD TO OPE-IIC-IOPE IN OPE
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM SGC-FIO-OPE
               IF FIO-STAT-OKS
                   PERFORM GET-FHOY
                   MOVE OPE-COD-EJOP IN ICM-FLD  TO OPE-COD-EJOP IN OPE
                   MOVE HOY-STP-ITRN IN HOY-VARI TO OPE-STP-ITRN IN OPE
                   MOVE FIO-MOD TO FIO-CMND
                   PERFORM SGC-FIO-OPE
                   IF FIO-STAT-OKS
                       MOVE 'GNS'        TO MSG-COD-SIST
                       MOVE 'MODYES    ' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MEN1
                       GO TO FIN-CMN-ACC
                   ELSE
                       MOVE 'GNS'        TO MSG-COD-SIST
                       MOVE 'MODNOT    ' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MEN1
                       GO TO FIN-CMN-ACC
               ELSE
                   MOVE 'SGC'          TO MSG-COD-SIST
                   MOVE 'OPEGKEYUPDNO' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN1
                   GO TO FIN-CMN-ACC
           ELSE
      *DAD fin  05-MAR-1991
           IF SCR-CMND = 'ACC'
               PERFORM UPD-OPE-RCO
               IF FIO-STAT-OKS
                   PERFORM UPD-REC
                   IF FIO-STAT-OKS
                       PERFORM PUT-ACC-JGN
                       MOVE '00' TO FIO-STAT
                       IF FIO-STAT-OKS
                           MOVE 'GNS'        TO MSG-COD-SIST
                           MOVE 'INGYES    ' TO MSG-COD-MENS
      *DAD ini  13-DEC-1993
                           PERFORM PUT-ACC-MSG-ACL
      *DAD fin  13-DEC-1993
                           PERFORM GET-MSG
                           MOVE MSG-GLS-DESC TO FRM-MEN1
      *DAD ini  22-MAY-1992
      *                     GO TO ENG-CMN-ACC
                           GO TO DBC-CMN-ACC
      *DAD fin  22-MAY-1992
                       ELSE
                           PERFORM ERR-OPE-RCO
                           GO TO FIN-CMN-ACC
                   ELSE
                       PERFORM ERR-OPE-RCO
                       GO TO FIN-CMN-ACC
               ELSE
                   PERFORM ERR-OPE-RCO
                   GO TO FIN-CMN-ACC
           ELSE
           IF SCR-CMND = 'CCC'
               PERFORM UPD-OPE
               IF FIO-STAT-OKS
                   PERFORM PUT-CCC-JGN
                   MOVE '00' TO FIO-STAT
                   IF FIO-STAT-OKS
                       MOVE 'GNS'        TO MSG-COD-SIST
                       MOVE 'INGYES    ' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MEN1
                       GO TO FIN-CMN-ACC
                   ELSE
                       PERFORM ERR-OPE-RCO
                       GO TO FIN-CMN-ACC
               ELSE
                   PERFORM ERR-OPE-RCO
                   GO TO FIN-CMN-ACC
           ELSE
           IF SCR-CMND = 'MCC'
               PERFORM UPD-OPE-RCO
               IF NOT FIO-STAT-OKS
                   PERFORM ERR-OPE-RCO
                   GO TO FIN-CMN-ACC
               ELSE
      *DAD ini  24-ABR-1992
      *             PERFORM PUT-ICM-MCC
      *DAD fin  24-ABR-1992
                   MOVE '00' TO FIO-STAT
                   MOVE 'GNS'        TO MSG-COD-SIST
                   MOVE 'MODYES    ' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN1
*% IF PGM_PER
                   GO TO FIN-CMN-ACC
*% ELSE
      *DAD ini  20-AGO-1993
      *             GO TO FIN-CMN-ACC
                   GO TO CTL-CMN-ACC
      *DAD fin  20-AGO-1993
*% END
           ELSE
           IF SCR-CMND = 'INS'
               PERFORM CMN-INS
               MOVE '00' TO FIO-STAT
               IF FIO-STAT-OKS
                   MOVE 'GNS'        TO MSG-COD-SIST
                   MOVE 'INGYES    ' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN1
                   GO TO FIN-CMN-ACC.
      *>>>>
*% END
*% IF CMN_ACC
      *<<<< CMN_ACC
      *DAD ini  22-MAY-1992
       DBC-CMN-ACC.
           MOVE DCC-CAI-ICLI IN ICM-FLD TO DBC-CAI-ICLI IN DBC.
           MOVE DCC-IIC-ICLI IN ICM-FLD TO DBC-IIC-ICLI IN DBC.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF FIO-STAT-OKS AND
              DBC-COD-TICL IN DBC = 'CO' OR 'CA' OR 'PV'
               MOVE 'CL' TO DBC-COD-TICL IN DBC
               MOVE FIO-MOD TO FIO-CMND
               PERFORM SGC-FIO-DBC
               IF NOT FIO-STAT-OKS
                   MOVE 'GNS'        TO MSG-COD-SIST
                   MOVE 'MODERR    ' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC             TO FRM-MEN1
                   MOVE 'DBC : '                 TO WSS-GLS-ERR1
                                                            IN WSS-VARI
                   MOVE DBC-CIC-ICLI IN DBC      TO WSS-GLS-ERR2
                                                            IN WSS-VARI
                   MOVE WSS-GLS-ERRO IN WSS-VARI TO FRM-MEN2
                   PERFORM ERR-OPE-RCO
                   GO TO FIN-CMN-ACC.
      *DAD fin  22-MAY-1992
*% IF NOT PGM_PER
      *DAD ini  20-AGO-1993
       CTL-CMN-ACC.
           MOVE DCC-CAI-ICLI IN ICM-FLD TO RCD-CAI-ICLI IN RCD.
           MOVE DCC-IIC-ICLI IN ICM-FLD TO RCD-IIC-ICLI IN RCD.
           MOVE RCO-NUM-DIRE IN ICM-FLD TO RCD-NUM-DIRE IN RCD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCD.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               GO TO ENG-CMN-ACC.

           MOVE OPE-CAI-IOPE IN ICM-FLD TO CTL-NUM-SIS IN CTL.
           MOVE OPE-IIC-IOPE IN ICM-FLD TO CTL-COD-CRR IN CTL.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           MOVE 'CTL-COP'       TO FIO-AKEY.
           PERFORM SGC-FIO-CTL.
           IF NOT FIO-STAT-OKS
      *DAD ini  13-SEP-1993
               IF FIO-STAT = '23'
                   IF FRM-MEN2 NOT > SPACES
                       MOVE 'SGC'        TO MSG-COD-SIST
                       MOVE 'CTL    NEX' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MEN2
                       MOVE '00'         TO FIO-STAT
                       GO TO ENG-CMN-ACC
                   ELSE
                       MOVE '00' TO FIO-STAT
                       GO TO ENG-CMN-ACC
               ELSE
                   MOVE FIO-MENS TO FRM-MENS
                   MOVE '00'     TO FIO-STAT
      *DAD fin  13-SEP-1993
                   GO TO ENG-CMN-ACC.

           MOVE RCD-MSC-TDIR IN RCD TO CTL-TIP-DIR IN CTL.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM SGC-FIO-CTL.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS    TO FRM-MENS
               MOVE FIO-BCK-OUT TO FIO-CMND
               PERFORM SGC-FIO-RCO
               GO TO FIN-CMN-ACC.
      *DAD fin  20-AGO-1993
*% END
      *ISP ENGANCHE
       ENG-CMN-ACC.
           IF SCR-CMND = 'ACC' AND
              FRM-IND-MCLI IN ICM-FLD = 'S'
               MOVE OPE-CAI-IOPE IN OPE TO SCR-CAI-IOPE
               MOVE OPE-IIC-IOPE IN OPE TO SCR-IIC-IOPE
               MOVE 'S'    TO SCR-IND-ENG IN SCR-VEC-ENG(WSS-IDX-IRCO)
               MOVE 'S'    TO SCR-IND-FST IN SCR-VEC-FST(WSS-IDX-IRCO)
               PERFORM EGR-FPEN-CIC.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      ***********************************************************************
      *DAD ini  20-DEC-1993 / 13-DEC-1993
       PUT-ACC-MSG-ACL SECTION.
       INI-PUT-ACC-MSG-ACL.
           IF WSS-COD-MENS IN WSS-VARI = 'CTALINEOK'
      *        MOVE 'VALIDACION Y CREACION EFECTUADA OK' TO FRM-MEN2
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'INGYES CTAOK' TO MSG-COD-MENS
           ELSE
           IF WSS-COD-MENS IN WSS-VARI = 'CTALINETJNEX'
      *        MOVE 'TARJETA NO EXISTE' TO FRM-MEN2
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'INGYES TJNEX' TO MSG-COD-MENS
           ELSE
           IF WSS-COD-MENS IN WSS-VARI = 'CTALINEYAEXI'
      *        MOVE 'Cta. Cte. YA EXISTE' TO FRM-MEN2
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'INGYES CTAEX' TO MSG-COD-MENS
           ELSE
           IF WSS-COD-MENS IN WSS-VARI = 'CTALINENO='
      *        MOVE 'Cta. Cte. NO CORRESPONDE' TO FRM-MEN2
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'INGYES CTAN=' TO MSG-COD-MENS
           ELSE
           IF WSS-COD-MENS IN WSS-VARI = 'CTALINEERROR'
      *        MOVE 'ERROR GRAVE' TO FRM-MEN2
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'INGYES CTAER' TO MSG-COD-MENS
           ELSE
           IF WSS-COD-MENS IN WSS-VARI = 'CTALINERCH'
      *        MOVE 'RECHAZADA CREACION DE CUENTA LINEA' TO FRM-MEN2
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'INGYES CTARH' TO MSG-COD-MENS
           ELSE
           IF WSS-COD-MENS IN WSS-VARI = 'CTALINEREV'
      *        MOVE 'REVISAR CREACION DE CUENTA LINEA' TO FRM-MEN2.
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'INGYES CTARV' TO MSG-COD-MENS.
       FIN-PUT-ACC-MSG-ACL.
           EXIT.
      *DAD fin  20-DEC-1993 / 13-DEC-1993
      ***********************************************************************
      *DAD ini  20-DEC-1993 / 16-DEC-1993 / 13-DEC-1993 / 02-NOV-1993
       PRO-VAL-TBCI-TNDM SECTION.
       INI-PRO-VAL-TBCI-TNDM.
      * Obtiene direccion de la TWA a utilizar
           EXEC CICS ADDRESS
                     TWA(TWA-PNT0)
           END-EXEC.

      * Inicializa variables para cargar registro MVO
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO WSS-NUM-DTRN IN WSS-VARI.
           MOVE HOY-MHOY IN HOY-VARI TO WSS-NUM-MTRN IN WSS-VARI.
           MOVE HOY-SHOY IN HOY-VARI TO WSS-NUM-STRN IN WSS-VARI.
           MOVE HOY-AHOY IN HOY-VARI TO WSS-NUM-ATRN IN WSS-VARI.

           MOVE SPACES TO WSS-COD-MENS IN WSS-VARI.

           IF OPE-COD-OFOP IN ICM-FLD NUMERIC
               MOVE OPE-COD-OFOP IN ICM-FLD TO WSS-NUM-OFOP IN WSS-VARI
               ADD WSS-NUM-OFOP IN WSS-VARI TO WSS-NUM-TERM IN WSS-VARI.

           IF FRM-NUM-TBCI IN ICM-FLD NUMERIC
               MOVE FRM-NUM-TBCI IN ICM-FLD TO WSS-NUM-TBCI IN WSS-VARI.

      * Valor inicial de Nro. correlativo ( MVO )
           MOVE HOY-HHOY IN HOY-VARI TO WSS-NUM-CORG IN WSS-VARI.
           ADD  1                    TO WSS-NUM-CORG IN WSS-VARI.

      * Llenado de los campos del Archivo MVO ( Movimientos )
      *--------------------------------------------------------------
      * Inicializa registro MVO
           MOVE SPACES TO MVO.
      * Fecha Ingreso del Movimiento
      *     MOVE HOY-FHOY IN HOY-VARI     TO MVO-FEC-FIMV IN MVO.
           MOVE WSS-FEC-FTRN IN WSS-VARI TO MVO-FEC-FIMV IN MVO.
      * Codigo Origen del movimiento
           MOVE 'SGC '                   TO MVO-COD-TORG IN MVO.
      * Indicador Correlativo Por Origen del Movimiento
           MOVE WSS-NUM-CORG IN WSS-VARI TO MVO-NUM-CORG IN MVO.

      * Fecha del Movimiento
      *     MOVE HOY-FHOY IN HOY-VARI     TO MVO-FEC-FMVO IN MVO.
           MOVE WSS-FEC-FTRN IN WSS-VARI TO MVO-FEC-FMVO IN MVO.
      * Numero Unico Operacion
           MOVE ZEROES                   TO MVO-CIC-NUOP IN MVO.
      * Codigo de Ambiente de Generacion
           MOVE 'S'                      TO MVO-COD-AMBT IN MVO.
      * Codigo modalidad
           MOVE 'L'                      TO MVO-COD-MODA IN MVO.
      * Identificacion Terminal Fisico
           MOVE WSS-NUM-TERM IN WSS-VARI TO MVO-COD-TERM IN MVO.
      * Estado de proceso
           MOVE 'I '                     TO MVO-COD-EPRC IN MVO.
      * Tipo Origen Para Cuadratura
           MOVE ZEROES                   TO MVO-COD-TCUA IN MVO.
      * Codigo Sistema de Abono
           MOVE 'CCT'                    TO MVO-COD-SIAB IN MVO.
      * Codigo de Transaccion de Abono
           MOVE '0372 '                  TO MVO-COD-TRAB IN MVO.
      * Indicador Orden Proceso Movimiento
           MOVE '9'                      TO MVO-IND-OPMV IN MVO.
      * Valor del Movimiento
           MOVE ZEROES                   TO MVO-SGV-VMVO IN MVO.
      * Msj. Disconformidad Firma y Forma Cta. Cargo
           MOVE '000'                    TO MVO-IND-DFCR IN MVO.
      * Codigo Operacion de Abono
           MOVE OPE-CAI-IOPE IN ICM-FLD  TO MVO-CAI-OPAB IN MVO.
           MOVE OPE-IIC-IOPE IN ICM-FLD  TO MVO-IIC-OPAB IN MVO.
      * Serial Documento Abono
           MOVE WSS-NUM-TBCI IN WSS-VARI TO MVO-COD-SDAB IN MVO.
      * Indicador Llave Supervisor Transaccion Abono
           MOVE 'S'                      TO MVO-IND-KESA IN MVO.
      * Numero de Lote Cuadratura
           MOVE ZEROES                   TO MVO-NUM-LCUA IN MVO.
      * Hora Ingreso Movimiento
           MOVE WSS-HRA-HRTR IN WSS-VARI TO MVO-HRA-HRMV IN MVO.
      *--------------------------------------------------------------

      * Carga con MVO area de la TWA y Activa con LINK
           MOVE MVO          TO TWA-MVO.
           MOVE SPACES       TO SYS-CMMA.
           MOVE +0           TO SYS-TCMA.
           MOVE WSS-MVO-PROG TO SYS-PROG.
           MOVE SYS-LINK     TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
      *     EXEC CICS LINK
      *               PROGRAM(WSS-MVO-PROG)
      *     END-EXEC.

      * Evalua Proceso efectuado en TANDEM
           IF TWA-COD-RETR = '00'
               MOVE 'CTALINEOK' TO MSG-COD-MENS
      *         MOVE 'VALIDACION Y CREACION EFECTUADA OK' TO FRM-MEN2
           ELSE
           IF TWA-COD-RETR = '01'
               IF TWA-COD-ERRO = '003'
                   MOVE 'CTALINETJNEX' TO MSG-COD-MENS
      *            MOVE 'TARJETA NO EXISTE' TO FRM-MEN2
               ELSE
               IF TWA-COD-ERRO = '008'
                   MOVE 'CTALINEYAEXI' TO MSG-COD-MENS
      *            MOVE 'Cta. Cte. YA EXISTE' TO FRM-MEN2
               ELSE
               IF TWA-COD-ERRO = '223'
                   MOVE 'CTALINENO=' TO MSG-COD-MENS
      *            MOVE 'Cta. Cte. NO CORRESPONDE' TO FRM-MEN2
               ELSE
               IF TWA-COD-ERRO = '238'
                   MOVE 'CTALINEERROR' TO MSG-COD-MENS
      *            MOVE 'ERROR GRAVE' TO FRM-MEN2
               ELSE
                   MOVE 'CTALINERCH' TO MSG-COD-MENS
      *            MOVE 'RECHAZADA CREACION DE CTA CTE LINEA' TO FRM-MEN2
           ELSE
               MOVE 'CTALINEREV' TO MSG-COD-MENS.
      *        MOVE 'REVISAR CREACION DE CTA CTE LINEA' TO FRM-MEN2.

           MOVE 'SGC' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MEN1.
           MOVE MSG-COD-MENS TO WSS-COD-MENS IN WSS-VARI.
       FIN-PRO-VAL-TBCI-TNDM.
           EXIT.
      *DAD fin  20-DEC-1993 / 16-DEC-1993 / 13-DEC-1993 / 02-NOV-1993
      ***********************************************************************
      *DAD ini  05-JUN-1992 / 22-MAY-1992
       CHK-DBC-TICL SECTION.
       INI-CHK-DBC-TICL.
      * Usa DBC leido anteriormente
           IF DBC-COD-EJEC IN DBC NOT > SPACES OR
              DBC-COD-OFIC IN DBC NOT > SPACES OR
              DBC-IND-OOFI IN DBC NOT > SPACES OR
              DBC-COD-ODSE IN DBC NOT > SPACES OR
              DBC-COD-ACTI IN DBC NOT > SPACES
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'DBCTICLOBLIG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE MSG-GLS-MENS TO FRM-MEN2
               MOVE FRM-SUAR-MAL TO FRM-SUAR
      *         MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-CHK-DBC-TICL.

      * Usa RCD leido anteriormente
           IF RCD-GLS-DIRE IN RCD NOT > SPACES OR
              RCD-COD-LUGA IN RCD NOT > SPACES OR
              RCD-GLS-FONO IN RCD NOT > SPACES
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'DBCTICLOBLIG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE MSG-GLS-MENS TO FRM-MEN2
               MOVE FRM-SUAR-MAL TO FRM-SUAR
      *         MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-CHK-DBC-TICL.
 
           IF DBC-IND-TICL IN DBC = 'P'
               PERFORM CHK-DCP-TICL
           ELSE
               PERFORM CHK-DCE-TICL.
       FIN-CHK-DBC-TICL.
           EXIT.
      *DAD fin  05-JUN-1992 / 22-MAY-1992

      *DAD ini  05-JUN-1992 / 22-MAY-1992
       CHK-DCP-TICL SECTION.
       INI-CHK-DCP-TICL.
           MOVE DBC-CIC-ICLI IN DBC TO DCP-CIC-ICLI IN DCP.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DCP.
           IF NOT FIO-STAT-OKS
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'DBCTICLOBLIG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE MSG-GLS-MENS TO FRM-MEN2
               MOVE FRM-SUAR-MAL TO FRM-SUAR
      *         MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-CHK-DCP-TICL.

           IF DCP-FEC-FNAC IN DCP NOT > ZEROES OR
              DCP-IND-SEXO IN DCP NOT > SPACES OR
              DCP-IND-ECIV IN DCP NOT > SPACES OR
*% IF PGM_PER
              DCP-COD-PNAC IN DCP NOT > SPACES 
*% ELSE
              DCP-COD-PNAC IN DCP NOT > SPACES OR
              DCP-COD-TBAN IN DCP NOT > SPACES
*% END
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'DBCTICLOBLIG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE MSG-GLS-MENS TO FRM-MEN2
               MOVE FRM-SUAR-MAL TO FRM-SUAR
      *         MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-CHK-DCP-TICL.
       FIN-CHK-DCP-TICL.
           EXIT.
      *DAD fin  05-JUN-1992 / 22-MAY-1992

      *DAD ini  17-JUL-1992 / 05-JUN-1992 / 22-MAY-1992
       CHK-DCE-TICL SECTION.
       INI-CHK-DCE-TICL.
           MOVE DBC-CIC-ICLI IN DBC TO DCE-CIC-ICLI IN DCE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DCE.
           IF NOT FIO-STAT-OKS
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'DBCTICLOBLIG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE MSG-GLS-MENS TO FRM-MEN2
               MOVE FRM-SUAR-MAL TO FRM-SUAR
      *         MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-CHK-DCE-TICL.

           IF DCE-IND-CATE IN DCE NOT > SPACES OR
              DCE-IND-CMOS IN DCE NOT > SPACES OR
*% IF PGM_PER
              DCE-IND-TEMP IN DCE NOT > SPACES 
*% ELSE
              DCE-IND-TEMP IN DCE NOT > SPACES OR
              DCE-COD-TBAN IN DCE NOT > SPACES
*% END
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'DBCTICLOBLIG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE MSG-GLS-MENS TO FRM-MEN2
               MOVE FRM-SUAR-MAL TO FRM-SUAR
      *         MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-CHK-DCE-TICL.
       FIN-CHK-DCE-TICL.
           EXIT.
      *DAD fin  17-JUL-1992 / 05-JUN-1992 / 22-MAY-1992
      ***********************************************************************
       BUS-RCO SECTION.
       INI-BUS-RCO.
           MOVE OPE-CIC-IOPE IN OPE TO RCO-CIC-IOPE IN RCO.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-BUS-RCO.
           MOVE 'RCO-KEY-IOPE' TO FIO-AKEY.
           PERFORM SGC-FIO-RCO.
           IF NOT ( FIO-STAT-OKS AND
              OPE-CIC-IOPE IN OPE = RCO-CIC-IOPE IN RCO )
               MOVE RCO-CIC-ICLI TO DBC-CIC-ICLI IN DBC
               PERFORM BUS-DOM
               PERFORM PUT-RCD
               GO TO FIN-BUS-RCO.
           IF NOT (DCC-CAI-ICLI IN ICM-FLD = RCO-CAI-ICLI IN RCO AND
              DCC-IIC-ICLI IN ICM-FLD = RCO-IIC-ICLI IN RCO )
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-RCO.
      *DAD ini  23-MAR-1992
      * Para guardar REQA del RCO con REDKY y la Llave Principal
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
      *DAD fin  23-MAR-1992
           MOVE RCO-CAI-ICLI IN RCO TO RCD-CAI-ICLI IN RCD.
           MOVE RCO-IIC-ICLI IN RCO TO RCD-IIC-ICLI IN RCD.
           MOVE RCO-NUM-DIRE IN RCO TO RCD-NUM-DIRE IN RCD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCD.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO RCD-GLS-DIRE IN RCD.
            PERFORM PUT-RCD.               
            MOVE '00' TO PGM-STAT-RCO.
       FIN-BUS-RCO.
           EXIT.

       PUT-ACC-JGN SECTION.
       INI-PUT-ACC-JGN.
      *     MOVE 'TAB'    TO FIO-SIST.
      *     MOVE 'VLR'    TO TAB-CIC-TTAB.
      *     MOVE '0999  ' TO TAB-CIC-CTAB.
      *     MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
      *     MOVE FIO-GET-KEY    TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      *     IF TAB-COD-CTAB IN TAB NOT = OPE-COD-VCOP IN ICM-FLD
      *         GO TO FIN-PUT-ACC-JGN.
      *    Codigo de Transaccion
           MOVE 9001                 TO BCD-DAT2-INT IN BCD-VARI.
           MOVE BCD-DAT2 IN BCD-VARI TO JGN-COD-TRAN IN JGN.
      *    Sucursal
           MOVE DCC-CAI-ICLI IN ICM-FLD TO DBC-CAI-ICLI IN DBC.
           MOVE DCC-IIC-ICLI IN ICM-FLD TO DBC-IIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           MOVE OPE-COD-OFOP IN ICM-FLD TO JGN-COD-SUCU IN JGN.
      *    MOVE DBC-COD-OFIC IN DBC     TO JGN-COD-SUCU IN JGN.
      *    Filler
           MOVE SPACES TO JGN-GLS-FIL1 IN JGN.
      *    Largo de Datos
           MOVE 77     TO JGN-GLS-LDAT IN JGN.
      *    Filler
           MOVE SPACES TO JGN-GLS-FIL2 IN JGN.
      *    Fecha
           PERFORM GET-FHOY.
           MOVE HOY-AHOY      IN HOY-VARI TO WSS-NUM-AHOY  IN WSS-VARI.
           MOVE HOY-MHOY      IN HOY-VARI TO WSS-NUM-MHOY  IN WSS-VARI.
           MOVE HOY-DHOY      IN HOY-VARI TO WSS-NUM-DHOY  IN WSS-VARI.
           MOVE WSS-FEC-FHOY  IN WSS-VARI TO BCD-DAT3-EBCD IN BCD-VARI.
           MOVE BCD-DAT3-EBCD IN BCD-VARI TO BCD-DAT3-INT  IN BCD-VARI.
           MOVE BCD-DAT3      IN BCD-VARI TO JGN-FEC-FHOY  IN JGN.
      *    Rut
           MOVE DBC-NUM-ICLI IN DBC TO WSS-GLS-RUT IN WSS-VARI.
           IF DBC-VRF-ICLI IN DBC NOT = 'K'
               MOVE ZEROES              TO WSS-FILLER    IN WSS-VARI
               MOVE DBC-VRF-ICLI IN DBC TO WSS-NUM-VRF   IN WSS-VARI
               MOVE WSS-RUT IN WSS-VARI TO BCD-DAT6-EBCD IN BCD-VARI
               MOVE BCD-DAT6-EBCD IN BCD-VARI TO BCD-DAT6-INT IN
                                                        BCD-VARI
               MOVE BCD-DAT6 IN BCD-VARI TO JGN-GLS-RUT IN JGN
           ELSE
               MOVE ZEROES                   TO WSS-FIL1 IN WSS-VARI
               MOVE WSS-NUM-RUT  IN WSS-VARI TO WSS-GLS-SINB IN WSS-VARI
               MOVE WSS-SIN-BRUT IN WSS-VARI TO BCD-DAT5-EBCD IN 
                                                        BCD-VARI
               MOVE BCD-DAT5-EBCD IN BCD-VARI TO BCD-DAT5-INT IN 
                                                        BCD-VARI
               MOVE BCD-DAT5    IN BCD-VARI TO WSS-NUM-BRUT IN WSS-VARI
               MOVE WSS-NUM-DIG IN WSS-VARI TO WSS-DIG IN WSS-VARI
               MOVE WSS-DIG     IN WSS-VARI TO WSS-AUX IN WSS-VARI
               MULTIPLY WSS-AUX IN WSS-VARI BY 16 GIVING
                        WSS-AUX IN WSS-VARI
               ADD 11 TO WSS-AUX IN WSS-VARI
               MOVE WSS-AUX IN WSS-VARI TO WSS-AUX-DLIM IN WSS-VARI
               MOVE WSS-AUX-DLI2        TO WSS-VRF-BRUT IN WSS-VARI
               MOVE WSS-BCD-RUT IN WSS-VARI TO JGN-GLS-RUT IN JGN.
      *    Delimitador
           MOVE ZEROES TO WSS-AUX IN WSS-VARI.
           ADD 15 TO WSS-AUX IN WSS-VARI.
           MULTIPLY WSS-AUX IN WSS-VARI BY 16 GIVING 
                                 WSS-AUX IN WSS-VARI.
           ADD 13 TO WSS-AUX IN WSS-VARI.
           MOVE WSS-AUX IN WSS-VARI TO WSS-AUX-DLIM IN WSS-VARI.
           MOVE WSS-AUX-DLI2        TO JGN-GLS-DLI1 IN JGN.
      *    Nombre
           MOVE FRM-GLS-NOMC IN ICM-FLD TO JGN-GLS-NOMB IN JGN.
      *    Delimitador
           MOVE WSS-AUX-DLI2 TO JGN-GLS-DLI2 IN JGN.
      *    Cuenta Corriente Apertura
           MOVE '09'                      TO WSS-NUM-DIGI IN WSS-VARI.
           MOVE OPE-IIC-IOPE  IN ICM-FLD  TO WSS-IIC-IOPE IN WSS-VARI.
           MOVE WSS-CIC-IOPE  IN WSS-VARI TO BCD-DAT5-EBCD IN BCD-VARI.
           MOVE BCD-DAT5-EBCD IN BCD-VARI TO BCD-DAT5-INT IN BCD-VARI.
           MOVE BCD-DAT5      IN BCD-VARI TO JGN-IIC-ACCT IN JGN.
      *    Delimitador
           MOVE WSS-AUX-DLI2 TO JGN-GLS-DLI3 IN JGN.
      *    Direccion
           MOVE RCD-GLS-DIRE IN ICM-FLD TO JGN-GLS-DIRE IN JGN.
      *    Delimitador
           MOVE WSS-AUX-DLI2 TO JGN-GLS-DLI4 IN JGN.
      *    Actividad
           IF DBC-COD-ACTI IN DBC > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'ACT'               TO TAB-COD-TTAB IN TAB
               MOVE DBC-COD-ACTI IN DBC TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-CIC-CTAB TO WSS-CIC-ACTI IN WSS-VARI
               MOVE WSS-CIC-ACT1 TO BCD-DAT1-EBCD IN BCD-VARI
               MOVE BCD-DAT1-EBCD IN BCD-VARI TO BCD-DAT1-INT IN
                                                        BCD-VARI
               MOVE BCD-DAT1 IN BCD-VARI TO JGN-COD-ACTI IN JGN.
      *    Delimitador
           MOVE WSS-AUX-DLI2 TO JGN-GLS-DLI5 IN JGN.
      *    Filler
           MOVE SPACES TO JGN-GLS-FIL3 IN JGN.
      *    Filler
           MOVE SPACES TO JGN-GLS-FIL5 IN JGN.
      *DAD ini  08-MAR-1991
      *    PONE VALORES EN VARIABLES 'FIO' PARA QUE EN CASO DE FALLAR
      *    EL WRITE, LAS DECLARATIVAS ENTREGEN INFORMACION CORRECTA.
      *    NO SE USA FIO, PUES ARCHIVO SAM ==> CLAUSULA 'RBA'
           MOVE FIO-PUT  TO FIO-CMND.
           MOVE 'AMCCNC' TO FIO-VOID.
           MOVE JGN      TO FIO-DFLD.
           MOVE 200      TO FIO-RLEN.
      *DAD fin  08-MAR-1991
           EXEC CICS WRITE
                       DATASET('AMCCNC')
                       FROM(JGN)
                       LENGTH(200)
                       RIDFLD(JGN-COD-TRAN)
                       RBA
           END-EXEC.
       FIN-PUT-ACC-JGN.
           EXIT.

       PUT-CCC-JGN SECTION.
       INI-PUT-CCC-JGN.
      *     MOVE 'TAB'    TO FIO-SIST.
      *     MOVE 'VLR'    TO TAB-CIC-TTAB.
      *     MOVE '0999  ' TO TAB-CIC-CTAB.
      *     MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
      *     MOVE FIO-GET-KEY    TO FIO-CMND.
      *     PERFORM GNS-FIO-TAB.
      *     IF TAB-COD-CTAB IN TAB NOT = OPE-COD-VCOP IN ICM-FLD
      *         GO TO FIN-PUT-CCC-JGN.
      *    Codigo de Transaccion
           MOVE 9003                 TO BCD-DAT2-INT IN BCD-VARI.
           MOVE BCD-DAT2 IN BCD-VARI TO JGN-COD-TRAN IN JGN.
      *    Sucursal
           MOVE DCC-CAI-ICLI IN ICM-FLD TO DBC-CAI-ICLI IN DBC.
           MOVE DCC-IIC-ICLI IN ICM-FLD TO DBC-IIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           MOVE OPE-COD-OFOP IN ICM-FLD TO JGN-COD-SUCU IN JGN.
      *    MOVE DBC-COD-OFIC IN DBC     TO JGN-COD-SUCU IN JGN.
      *    Filler
           MOVE SPACES TO JGN-GLS-FIL1 IN JGN.
      *    Largo de Datos
           MOVE 8 TO JGN-GLS-LDAT IN JGN.
      *    Filler
           MOVE SPACES TO JGN-GLS-FIL2 IN JGN.
      *    Fecha
           PERFORM GET-FHOY.
           MOVE HOY-AHOY      IN HOY-VARI TO WSS-NUM-AHOY IN WSS-VARI.
           MOVE HOY-MHOY      IN HOY-VARI TO WSS-NUM-MHOY IN WSS-VARI.
           MOVE HOY-DHOY      IN HOY-VARI TO WSS-NUM-DHOY IN WSS-VARI.
           MOVE WSS-FEC-FHOY  IN WSS-VARI TO BCD-DAT3-EBCD IN BCD-VARI.
           MOVE BCD-DAT3-EBCD IN BCD-VARI TO BCD-DAT3-INT IN BCD-VARI.
           MOVE BCD-DAT3 IN BCD-VARI TO JGN-FEC-FHOY IN JGN.
      *    Cuenta Corriente Cierre
           MOVE '09'                     TO WSS-NUM-DIGI IN WSS-VARI.
           MOVE OPE-IIC-IOPE IN ICM-FLD  TO WSS-IIC-IOPE IN WSS-VARI.
           MOVE WSS-CIC-IOPE IN WSS-VARI TO BCD-DAT5-EBCD IN BCD-VARI.
           MOVE BCD-DAT5-EBCD IN BCD-VARI TO BCD-DAT5-INT IN BCD-VARI.
           MOVE BCD-DAT5 IN BCD-VARI TO JGN-IIC-CCCT IN JGN.
      *    Delimitador
           MOVE ZEROES TO WSS-AUX IN WSS-VARI.
           ADD 15 TO WSS-AUX IN WSS-VARI.
           MULTIPLY WSS-AUX IN WSS-VARI BY 16 GIVING
                    WSS-AUX IN WSS-VARI.
           ADD 13 TO WSS-AUX IN WSS-VARI.
           MOVE WSS-AUX IN WSS-VARI TO WSS-AUX-DLIM IN WSS-VARI.
           MOVE WSS-AUX-DLI2 TO JGN-GLS-DLI6 IN JGN.
      *    Motivo de Cierre
           IF OPE-COD-MOTT IN ICM-FLD > SPACES
               MOVE 'TAB'                   TO TAB-COD-SIST
               MOVE 'MTO'                   TO TAB-COD-TTAB IN TAB
               MOVE OPE-COD-MOTT IN ICM-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-CIC-CTAB TO WSS-CIC-MOTC IN WSS-VARI
               MOVE WSS-CIC-MOT1 TO BCD-DAT1-EBCD IN BCD-VARI
               MOVE BCD-DAT1-EBCD IN BCD-VARI TO BCD-DAT1-INT IN 
                                                        BCD-VARI
               MOVE BCD-DAT1 IN BCD-VARI TO JGN-COD-MOTC IN JGN.
      *    Delimitador
           MOVE WSS-AUX-DLI2 TO JGN-GLS-DLI7 IN JGN.
      *    Filler
           MOVE SPACES TO JGN-GLS-FIL4 IN JGN.
      *    Filler
           MOVE SPACES TO JGN-GLS-FIL5 IN JGN.
      *DAD ini  08-MAR-1991
      *    PONE VALORES EN VARIABLES 'FIO' PARA QUE EN CASO DE FALLAR
      *    EL WRITE, LAS DECLARATIVAS ENTREGEN INFORMACION CORRECTA.
      *    NO SE USA FIO, PUES ARCHIVO SAM ==> CLAUSULA 'RBA'
           MOVE FIO-PUT  TO FIO-CMND.
           MOVE 'AMCCNC' TO FIO-VOID.
           MOVE JGN      TO FIO-DFLD.
           MOVE 200      TO FIO-RLEN.
      *DAD fin  08-MAR-1991
           EXEC CICS WRITE
                       DATASET('AMCCNC')
                       FROM(JGN)
                       LENGTH(200)
                       RIDFLD(JGN-COD-TRAN)
                       RBA
           END-EXEC.
       FIN-PUT-CCC-JGN.
           EXIT.

*%! RVM: 25-06-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
      *<<<< PGM_DTC
       LEE-NXT-PRV SECTION.
       INI-LEE-NXT-PRV.
           IF SCR-DBC-REQA > SPACES
               PERFORM LEE-NXT-PRV-DBC
           ELSE
               PERFORM LEE-NXT-PRV-NOM.
       FIN-LEE-NXT-PRV.
           EXIT.

       LEE-NXT-PRV-DBC SECTION.
       INI-LEE-NXT-PRV-DBC.
           MOVE SCR-DBC-REQA TO ADR-DBC-REQA.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           IF FRM-FFLD = FRM-FFLD-PF7
               MOVE FIO-GET-PRV TO FIO-CMND
           ELSE
               MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE 'DBC-GLS-NOMC' TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
           IF FIO-STAT-OKS
      *DAD ini  23-MAR-1992
               MOVE SPACES       TO SCR-RCO-REQA
      *DAD fin  23-MAR-1992
               MOVE ADR-DBC-REQA TO SCR-DBC-REQA.
       FIN-LEE-NXT-PRV-DBC.
           EXIT.

       LEE-NXT-PRV-NOM SECTION.
       INI-LEE-NXT-PRV-NOM.
           IF DBC-GLS-NOMC IN DBC > SPACES
               MOVE FIO-GET-KEY    TO FIO-CMND
               MOVE 'DBC-GLS-NOMC' TO FIO-AKEY
               PERFORM SGC-FIO-DBC
               IF FIO-STAT-OKS
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE FIO-GET-PRV TO FIO-CMND
                   ELSE
                       MOVE FIO-GET-NXT TO FIO-CMND
               ELSE
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE FIO-GET-LEQ TO FIO-CMND
                   ELSE
                       MOVE FIO-GET-NLS TO FIO-CMND
           ELSE
               IF FRM-FFLD = FRM-FFLD-PF7
                   MOVE FIO-GET-LEQ TO FIO-CMND
               ELSE
                   MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'DBC-GLS-NOMC' TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
           IF FIO-STAT-OKS
      *DAD ini  23-MAR-1992
               MOVE SPACES       TO SCR-RCO-REQA
      *DAD fin  23-MAR-1992
               MOVE ADR-DBC-REQA TO SCR-DBC-REQA.
       FIN-LEE-NXT-PRV-NOM.
           EXIT.

      *DAD ini  11-MAR-1991
       LEE-NXT-PRV-RCO SECTION.
       INI-LEE-NXT-PRV-RCO.
      * A partir del RCO en REQA se leera este RCO
           MOVE SCR-RCO-REQA TO ADR-RCO-REQA.
           MOVE FIO-KDEF-S  TO FIO-KDEF.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCO.

      * Lee DBC con el RCO leido anteriormente, guardando CIC del Cliente
           MOVE RCO-CIC-ICLI IN RCO TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           MOVE DBC-CIC-ICLI IN DBC TO WSS-CIC-ICLI IN WSS-VARI.
      *DAD ini  23-MAR-1992
           MOVE FIO-STAT TO PGM-STAT-DBC.
      *DAD fin  23-MAR-1992

      * Lee TAB para obtener CIC de Cta. Cte.
           MOVE 'TAB' TO FIO-SIST.
           MOVE 'AUX' TO TAB-CIC-TTAB IN TAB.
           MOVE 'CTE' TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'SGC'        TO MSG-COD-SIST
               MOVE 'CICCTACNEX' TO MSG-COD-MENS
               GO TO FIN-LEE-NXT-PRV-RCO.
      *DAD ini  23-MAR-1992
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-CCTE IN WSS-VARI.
      *DAD fin  23-MAR-1992

      * A partir del RCO leido anteriormente, se leera otro RCO
       LUP-LEE-NXT-PRV-RCO.
      * Lee RCO anterior o siguiente segun PFS
           IF FRM-FFLD = FRM-FFLD-PF5
               MOVE FIO-GET-PRV TO FIO-CMND
           ELSE
               MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF NOT FIO-STAT-OKS
      *DAD ini  23-MAR-1992
               MOVE SPACES TO PGM-STAT
      *DAD fin  23-MAR-1992
               MOVE 'SGC'    TO MSG-COD-SIST
               IF FRM-FFLD = FRM-FFLD-PF5
                   MOVE 'CCT    NOPRV' TO MSG-COD-MENS
                   GO TO FIN-LEE-NXT-PRV-RCO
               ELSE
                   MOVE 'CCT    NONXT' TO MSG-COD-MENS
                   GO TO FIN-LEE-NXT-PRV-RCO.

      *DAD ini  23-MAR-1992
      * Con DBC y el RCO leido anteriormente, se chequea si es el Cliente OK
           IF WSS-CIC-ICLI IN WSS-VARI NOT = RCO-CIC-ICLI IN RCO
               MOVE SPACES TO PGM-STAT
      *DAD fin  23-MAR-1992
               MOVE 'SGC'    TO MSG-COD-SIST
               IF FRM-FFLD = FRM-FFLD-PF5
                   MOVE 'CCT    NOPRV' TO MSG-COD-MENS
                   GO TO FIN-LEE-NXT-PRV-RCO
               ELSE
                   MOVE 'CCT    NONXT' TO MSG-COD-MENS
                   GO TO FIN-LEE-NXT-PRV-RCO.
           MOVE PGM-SOKS TO PGM-STAT-RCO.

      * Lee OPE con el RCO leido anteriormente, chequeando si este es Cta. Cte.
           MOVE RCO-CIC-IOPE IN RCO TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF NOT FIO-STAT-OKS OR
              OPE-COD-COPR IN OPE NOT = WSS-COD-CCTE IN WSS-VARI
               GO TO LUP-LEE-NXT-PRV-RCO
           ELSE
               MOVE FIO-STAT TO PGM-STAT-OPE
               MOVE ADR-RCO-REQA TO SCR-RCO-REQA.

      * Lee RCD con el RCO leido anteriormente
           MOVE RCO-CIC-ICLI IN RCO TO RCD-CIC-ICLI IN RCD.
           MOVE RCO-NUM-DIRE IN RCO TO RCD-NUM-DIRE IN RCD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCD.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO RCD-GLS-DIRE IN RCD.
           MOVE PGM-SOKS TO PGM-STAT-RCD.
       FIN-LEE-NXT-PRV-RCO.
           EXIT.
      *DAD fin  11-MAR-1991
      *>>>>
*% END
       PUT-RCP SECTION.
       INI-PUT-RCP.
           IF MSG-COD-MENS > SPACES
               MOVE SPACES TO FRM-GLS-NCLP IN ICM-FLD
               MOVE ZEROES TO FRM-NUM-ICLP IN ICM-FLD
               MOVE SPACES TO FRM-VRF-ICLP IN ICM-FLD
               MOVE SPACES TO FRM-IND-ICLP IN ICM-FLD
               MOVE SPACES TO FRM-GLS-ICLP IN ICM-FLD
               GO TO FIN-PUT-RCP.
           MOVE REC-CIC-IREL IN REC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO FRM-GLS-NCLP IN ICM-FLD
               MOVE ZEROES TO FRM-NUM-ICLP IN ICM-FLD
               MOVE SPACES TO FRM-VRF-ICLP IN ICM-FLD
               MOVE SPACES TO FRM-IND-ICLP IN ICM-FLD
               MOVE SPACES TO FRM-GLS-ICLP IN ICM-FLD
               GO TO FIN-PUT-RCP.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO FRM-GLS-NCLP IN ICM-FLD.
           MOVE DBC-NUM-ICLI IN DBC TO FRM-NUM-ICLP IN ICM-FLD.
           MOVE DBC-VRF-ICLI IN DBC TO FRM-VRF-ICLP IN ICM-FLD.
           MOVE DBC-IND-ICLI IN DBC TO FRM-IND-ICLP IN ICM-FLD.
           MOVE DBC-GLS-ICLI IN DBC TO FRM-GLS-ICLP IN ICM-FLD.
       FIN-PUT-RCP.
           EXIT.

       PUT-RCD SECTION.
       INI-PUT-RCD.
           MOVE RCD-GLS-DIRE IN RCD TO RCD-GLS-DIRE IN ICM-FLD.
           MOVE '00' TO PGM-STAT-RCD.
           MOVE '00' TO PGM-STAT-RCO.
           MOVE RCD-NUM-DIRE IN RCD TO RCO-NUM-DIRE IN RCO.
       FIN-PUT-RCD.
           EXIT.

       UPD-OPE SECTION.
       INI-UPD-OPE.
           PERFORM GET-FHOY.
           PERFORM RET-ALL-ICM.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           PERFORM RET-ALL-ICM.
           MOVE HOY-STP-ITRN IN HOY-VARI TO OPE-STP-ITRN IN OPE.
           MOVE 'D'                      TO OPE-MSC-STAT IN OPE.
           MOVE 'ELI'                    TO OPE-COD-STAT IN OPE.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF FIO-STAT-OKS
               PERFORM UPD-RCO.
       FIN-UPD-OPE.
           EXIT.

       UPD-RCO SECTION.
       INI-UPD-RCO.
           MOVE OPE-CIC-IOPE IN OPE TO RCO-CIC-IOPE IN RCO.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-UPD-RCO.
           MOVE 'RCO-KEY-IOPE' TO FIO-AKEY.
           PERFORM SGC-FIO-RCO.
*%! RVM: 25-06-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
      *<<<< PGM_DTC
           MOVE ADR-RCO-REQA TO ADR-AUX-REQA.
      *>>>>
*% END
           IF NOT ( FIO-STAT-OKS AND
              OPE-CIC-IOPE IN OPE = RCO-CIC-IOPE IN RCO )
               MOVE '00' TO FIO-STAT
               GO TO FIN-UPD-RCO.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
*% IF NOT PGM_PER
      *DAD ini  10-AUG-1992
           MOVE HOY-STP-ITRN IN HOY-VARI TO RCO-STP-ITRN IN RCO.
      *DAD fin  10-AUG-1992
*% END
           MOVE 'D'                      TO RCO-MSC-STAT IN RCO.
           MOVE 'ELI'                    TO RCO-COD-STAT IN RCO.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF NOT FIO-STAT-OKS
               GO TO FIN-UPD-RCO.
*%! RVM: 25-06-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
      *<<<< PGM_DTC
           MOVE ADR-AUX-REQA TO ADR-RCO-REQA.
      *>>>>
*% END
           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           GO TO LUP-UPD-RCO.         
       FIN-UPD-RCO.
           EXIT.

       UPD-OPE-RCO SECTION.
       INI-UPD-OPE-RCO.
           PERFORM GET-FHOY.
           PERFORM RET-ALL-ICM.
           MOVE DCC-CAI-ICLI IN DCC TO DBC-CAI-ICLI IN DBC.
           MOVE DCC-IIC-ICLI IN DCC TO DBC-IIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF FIO-STAT-OKS
               PERFORM RET-ALL-ICM
               MOVE FIO-MOD TO FIO-CMND
           ELSE
               PERFORM INI-REG-OPE
               MOVE FIO-PUT TO FIO-CMND.
           MOVE HOY-STP-ITRN IN HOY-VARI TO OPE-STP-ITRN IN OPE.
      *DAD ini  02-MAY-1991
           IF SCR-CMND = 'ACC'
               MOVE OPE-IIC-IOPE IN ICM-FLD TO WSS-CTA-CTE IN WSS-VARI
               IF VAL-CCTE-DOLAR
                   MOVE '101301' TO OPE-COD-VCOP IN OPE
               ELSE
                   MOVE '0999  ' TO OPE-COD-VCOP IN OPE.
      *DAD fin  02-MAY-1991
           PERFORM SGC-FIO-OPE.
           IF NOT FIO-STAT-OKS
               GO TO FIN-UPD-OPE-RCO.
           MOVE OPE-CIC-IOPE IN OPE TO RCO-CIC-IOPE IN RCO.
           MOVE DCC-CAI-ICLI IN DCC TO RCO-CAI-ICLI IN RCO.
           MOVE DCC-IIC-ICLI IN DCC TO RCO-IIC-ICLI IN RCO.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF FIO-STAT-OKS
               PERFORM RET-RCO-ICM
               MOVE FIO-MOD TO FIO-CMND
           ELSE
               PERFORM INI-REG-RCO
               MOVE FIO-PUT TO FIO-CMND.
*% IF PGM_PER
           MOVE HOY-STP-ITRN IN HOY-VARI TO OPE-STP-ITRN IN OPE.
*% ELSE
           MOVE HOY-STP-ITRN IN HOY-VARI TO OPE-STP-ITRN IN OPE
      *DAD ini  10-AUG-1992
                                            RCO-STP-ITRN IN RCO.
      *DAD fin  10-AUG-1992
*% END
           PERFORM SGC-FIO-RCO.
       FIN-UPD-OPE-RCO.
           EXIT.

       INI-REG-OPE SECTION.
       INI-INI-REG-OPE.
           MOVE ZEROES TO OPE-FEC-FROP IN OPE.
           MOVE SPACES TO OPE-GLS-FLAG IN OPE.
           MOVE SPACES TO OPE-MSC-TACC IN OPE.
      *ALD MOVE SPACES TO OPE-MSC-STAT IN OPE.
           MOVE 'I'    TO OPE-MSC-STAT IN OPE.
           MOVE SPACES TO OPE-COD-OTRN IN OPE.
           MOVE SPACES TO OPE-COD-ATRN IN OPE.
      *ALD MOVE SPACES TO OPE-COD-STAT IN OPE.
           MOVE 'VIG'  TO OPE-COD-STAT IN OPE.
           MOVE 'TAB' TO FIO-SIST.
           MOVE 'AUX' TO TAB-CIC-TTAB IN TAB.
           MOVE 'CTE' TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO OPE-COD-TOPR IN OPE
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO OPE-COD-TOPR IN OPE.
           MOVE SPACES TO OPE-COD-AOPR IN OPE.
      *     MOVE DBC-COD-OFIC IN DBC TO OPE-COD-OFOP IN OPE.
      ************************************************************************
      *DAD ini  23-MAR-1992
      * ---- modificado por odj desde aqui (k)
      *     MOVE SPACES TO OPE-GLS-DISP IN OPE.
      * ---- modificado por odj hasta aqui (k)
      *DAD fin  23-MAR-1992
      ************************************************************************
       FIN-INI-REG-OPE.
           EXIT.

       INI-REG-RCO SECTION.
       INI-INI-REG-RCO.
           MOVE SPACES TO RCO-GLS-FLAG IN RCO.
           MOVE SPACES TO RCO-MSC-TACC IN RCO.
      *ALD MOVE SPACES TO RCO-MSC-STAT IN RCO.
           MOVE 'I'    TO RCO-MSC-STAT IN RCO.
           MOVE SPACES TO RCO-COD-OTRN IN RCO.
           MOVE SPACES TO RCO-COD-ATRN IN RCO.
      *ALD MOVE SPACES TO RCO-COD-STAT IN RCO.
           MOVE 'VIG'  TO RCO-COD-STAT IN RCO.
           MOVE SPACES TO RCO-COD-RCOP IN RCO.
      *     PERFORM BUS-DOM
      *     IF RCD-GLS-DIRE IN RCD NOT > SPACES
      *         MOVE 1 TO RCO-NUM-DIRE IN RCO
      *     ELSE
      *         MOVE RCD-NUM-DIRE IN RCD TO RCO-NUM-DIRE IN RCO.
           MOVE 100   TO RCO-VAL-PRCO IN RCO.
           MOVE 'TAB' TO FIO-SIST.
           MOVE 'AUX' TO TAB-CIC-TTAB IN TAB.
           MOVE 'CTE' TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO RCO-COD-TOPR IN RCO
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO RCO-COD-TOPR IN RCO.
           MOVE SPACES TO RCO-COD-AOPR IN RCO.
           MOVE SPACES TO RCO-GLS-DISP IN RCO.
       FIN-INI-REG-RCO.
           EXIT.

       UPD-REC SECTION.
       INI-UPD-REC.
           IF FRM-NUM-ICLP IN ICM-FLD NOT > ZEROES
               MOVE '00' TO FIO-STAT
               GO TO FIN-UPD-REC.
           MOVE FRM-NUM-ICLP IN ICM-FLD TO DBC-NUM-ICLI IN DBC.
           MOVE FRM-IND-ICLP IN ICM-FLD TO DBC-IND-ICLI IN DBC.
           MOVE FRM-GLS-ICLP IN ICM-FLD TO DBC-GLS-ICLI IN DBC.
           MOVE 'DBC-IDC-ICLI' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           MOVE DCC-CAI-ICLI IN ICM-FLD  TO REC-CAI-ICLI IN REC.
           MOVE DCC-IIC-ICLI IN ICM-FLD  TO REC-IIC-ICLI IN REC.
           MOVE DBC-CIC-ICLI IN DBC      TO REC-CIC-IREL IN REC.
           MOVE REC-COD-PRES IN REC-VARI TO REC-COD-TREC IN REC.
           MOVE ZEROES                   TO REC-NUM-TREC IN REC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM SGC-FIO-REC.
           IF FIO-STAT-OKS AND
              REC-CAI-ICLI IN REC = DCC-CAI-ICLI IN ICM-FLD AND
              REC-IIC-ICLI IN REC = DCC-IIC-ICLI IN ICM-FLD AND
              REC-CIC-IREL IN REC = DBC-CIC-ICLI IN DBC     AND
              REC-COD-TREC IN REC = REC-COD-PRES IN REC-VARI
               GO TO FIN-UPD-REC.
           MOVE DCC-CAI-ICLI IN ICM-FLD TO REC-CAI-ICLI IN REC 
           MOVE DCC-IIC-ICLI IN ICM-FLD TO REC-IIC-ICLI IN REC 
           MOVE DBC-CIC-ICLI IN DBC     TO REC-CIC-IREL IN REC 
           PERFORM INI-REG-REC.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM SGC-FIO-REC.
       FIN-UPD-REC.
           EXIT.

       INI-REG-REC SECTION.
       INI-INI-REG-REC.
           PERFORM GET-FHOY.
           MOVE HOY-STP-ITRN IN HOY-VARI TO REC-STP-ITRN IN REC.
           MOVE SPACES                   TO REC-GLS-FLAG IN REC.
           MOVE 1                        TO REC-NUM-TREC IN REC.
           MOVE REC-COD-PRES IN REC-VARI TO REC-COD-TREC IN REC.
           MOVE SPACES                   TO REC-MSC-TACC IN REC.
           MOVE SPACES                   TO REC-COD-OTRN IN REC.
           MOVE SPACES                   TO REC-COD-ATRN IN REC.
           MOVE 'S'                      TO REC-IND-VIGE IN REC.
           MOVE REC-FEC-FTRN IN REC      TO REC-FEC-FINI IN REC.
           MOVE ZEROES                   TO REC-FEC-FINP IN REC.
           MOVE ZEROES                   TO REC-FEC-FTER IN REC.
           MOVE ZEROES                   TO REC-FEC-FOUT IN REC.
           MOVE SPACES                   TO REC-COD-AREC IN REC.
           MOVE ZEROES                   TO REC-SGV-AREC IN REC.
           MOVE SPACES                   TO REC-COD-VCAM IN REC.
           MOVE ZEROES                   TO REC-FEC-FVAL IN REC.
           MOVE ZEROES                   TO REC-FEC-FVRF IN REC.
           MOVE SPACES                   TO REC-GLS-DISP IN REC.
       FIN-INI-REG-REC.
           EXIT.

      *DAD ini  02-MAY-1991
       PRO-DEL-PER SECTION.
       INI-PRO-DEL-PER.
           MOVE SPACES TO FRM-MENS.
           MOVE OPE-IIC-IOPE IN ICM-FLD TO PER-KEY-IPER IN PER.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM SGC-FIO-PER.
           IF FIO-STAT-OKS
               MOVE FIO-DEL TO FIO-CMND
               PERFORM SGC-FIO-PER
               IF FIO-STAT-OKS
                   MOVE 'SGC'          TO MSG-COD-SIST
                   MOVE 'PER    DELOK' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN2
                   GO TO FIN-PRO-DEL-PER.
           MOVE 'SGC'          TO MSG-COD-SIST.
           MOVE 'PER    DELNO' TO MSG-COD-MENS.
           PERFORM GET-MSG.
      ************************************************************************
      *DAD ini  23-MAR-1992
      * ---- modificado por odj desde aqui  (A)
      *     MOVE MSG-GLS-DESC TO FRM-MEN1.
           IF SCR-CMND NOT = 'ACC'
               MOVE MSG-GLS-DESC TO FRM-MEN2.
      * ---- modificado por odj hasta aqui  (A)
      *DAD fin  23-MAR-1992
      ************************************************************************
       FIN-PRO-DEL-PER.
           EXIT.
      *DAD fin  02-MAY-1991

      *DAD ini  02-MAY-1991
       PRO-ACT-PER SECTION.
       INI-PRO-ACT-PER.
           MOVE SPACES TO FRM-MENS.
           MOVE OPE-IIC-IOPE IN ICM-FLD TO PER-KEY-IPER IN PER.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM SGC-FIO-PER.
           IF FIO-STAT-OKS
               MOVE 'PER    MODOK' TO MSG-COD-MENS
               MOVE FIO-MOD TO FIO-CMND
           ELSE
               MOVE 'PER    PUTOK' TO MSG-COD-MENS
               MOVE FIO-PUT TO FIO-CMND.
           PERFORM GET-FHOY.
           MOVE HOY-STP-ITRN IN HOY-VARI TO PER-FEC-FPER IN PER.
           MOVE '1'                      TO PER-IND-PERS IN PER.
           MOVE SPACES                   TO PER-GLS-DISP IN PER.
           PERFORM RET-PER-ICM.
           PERFORM SGC-FIO-PER.
           IF FIO-STAT-OKS
               MOVE 'SGC' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2
           ELSE
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'PER    ACTNO' TO MSG-COD-MENS
               PERFORM GET-MSG
      ************************************************************************
      *DAD ini  23-MAR-1992
      * ---- modificado por odj desde aqui  (A)
      *         MOVE MSG-GLS-DESC TO FRM-MEN1.
               MOVE MSG-GLS-DESC TO FRM-MEN2.
      * ---- modificado por odj hasta aqui  (A)
      *DAD fin  23-MAR-1992
      ************************************************************************
       FIN-PRO-ACT-PER.
           EXIT.
      *DAD fin  02-MAY-1991
      *>>>>
*% END
*% IF INI_FIO AND PGM_DTC AND PGM_V31
      *<<<< INI_FIO AND PGM_DTC AND PGM_V31
      *DAD ini  02-MAY-1991
           PERFORM GNS-HDL-VSM.
      *DAD fin  02-MAY-1991
      *>>>>
*% END
*% IF EOF AND PGM_DTC AND PGM_V31
      *<<<< EOF AND PGM_DTC AND PGM_V31
      *DAD ini  02-MAY-1991
       COPY GNSBGVSM.
       COPY GNSBHVSM.
      *DAD fin  02-MAY-1991
      *>>>>
*% END
*% IF EOF_IBM
      *<<<< EOF_IBM
      *DAD ini  02-MAY-1991
       COPY SGCBFPER.
      *DAD fin  02-MAY-1991
       COPY SGCBFDBC.
       COPY SGCBFRCD.
       COPY SGCBFOPE.
       COPY SGCBFRCO.
       COPY SGCBFREC.
      *DAD ini  22-MAY-1992
       COPY SGCBFDCP.
       COPY SGCBFDCE.
      *DAD fin  22-MAY-1992
*% IF NOT PGM_PER
      *DAD ini  20-AGO-1993
       COPY SGCBFCTL.
      *DAD fin  20-AGO-1993
*% END
       COPY SGCBGCLI.
       COPY SGCBGDOM.
       COPY SGCBGCCT.
       COPY SGCBGRCP.
       COPY SGCBGPPU.
       COPY SGCBGRCU.
       COPY SGCBGDCM.
       COPY TABBVUSR.
       COPY GNSBEGLS.
      *DAD ini  07-MAR-1991
       COPY GNSBGSTR.
      *DAD fin  07-MAR-1991
       COPY GNSBGCPT.
       COPY GNSBGPPU.
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
      *ISP ENGANCHE :
           IF SCR-DESDE-CMN
      * MARCA PARA RCO QUE INGRESO POR 'O'PE O IC'M'
               MOVE 'M'    TO SCR-IND-OOD
               MOVE 1      TO SCR-IPRO
               GO TO FIN-INI-FIO.
           IF SCR-INST-EXT = WSS-INST-FTER-CIC
               MOVE WSS-INST-NULL TO SCR-INST-EXT
               PERFORM ING-FTER-CIC.
       FIN-INI-FIO.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      * ISP INICIO SECCTIONS PARA ENGANCHE PROGRAMAS
       CMN-INS SECTION.
       INI-CMN-INS.
           PERFORM RET-ALL-ICM.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF OPE-MSC-STAT IN OPE = 'D' OR 
              OPE-COD-STAT IN OPE = 'ELI'
               PERFORM PUT-CCC-JGN
           ELSE
               PERFORM PUT-ACC-JGN.
       FIN-CMN-INS.
           EXIT.

      *DAD ini  24-ABR-1992
      * PUT-ICM-MCC SECTION.
      * INI-PUT-ICM-MCC.
      *     MOVE DCC-CAI-ICLI IN ICM-FLD TO DBC-CAI-ICLI IN DBC.
      *     MOVE DCC-IIC-ICLI IN ICM-FLD TO DBC-IIC-ICLI IN DBC.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM SGC-FIO-DBC.
      **        Tipo de registro
      *     MOVE      2                  TO MCC-NUM-TREG IN MCC.
      **        Numero de cta cte
      *     MOVE OPE-IIC-IOPE IN ICM-FLD TO MCC-IIC-IOPE IN MCC.
      **        Imputacion
      *     MOVE      9                  TO MCC-NUM-IMPT IN MCC.
      **        Nombre
      *     MOVE FRM-GLS-NOMC IN ICM-FLD TO MCC-GLS-NOMC IN MCC.
      **        Direccion
      *     MOVE RCD-GLS-DIRE IN ICM-FLD TO MCC-GLS-DIRE IN MCC.
      **        Fecha apertura cta cte
      *     MOVE OPE-NUM-DIOP IN ICM-FLD TO MCC-NUM-DACC IN MCC.
      *     MOVE OPE-NUM-MIOP IN ICM-FLD TO MCC-NUM-MACC IN MCC.
      *     MOVE OPE-NUM-AIOP IN ICM-FLD TO MCC-NUM-AACC IN MCC.
      **        Espacios
      *     MOVE SPACES                  TO MCC-GLS-FILR IN MCC.
      **        codigo de actividad
      *     IF DBC-COD-ACTI IN DBC > SPACES
      *         MOVE 'TAB'               TO TAB-COD-SIST
      *         MOVE 'ACT'               TO TAB-COD-TTAB IN TAB
      *         MOVE DBC-COD-ACTI IN DBC TO TAB-COD-CTAB IN TAB
      *         PERFORM BUS-TAB
      *         MOVE TAB-CIC-CTAB TO WSS-CIC-ACTI IN WSS-VARI
      *         MOVE WSS-CIC-ACT1 TO MCC-COD-ACTI IN MCC.
      **        Espacios
      *     MOVE SPACES                   TO MCC-GLS-DISP IN MCC.
      **DAD ini  08-MAR-1991
      **    PONE VALORES EN VARIABLES 'FIO' PARA QUE EN CASO DE FALLAR
      **    EL WRITE, LAS DECLARATIVAS ENTREGEN INFORMACION CORRECTA.
      **    NO SE USA FIO, PUES ARCHIVO SAM ==> CLAUSULA 'RBA'
      *     MOVE FIO-PUT   TO FIO-CMND.
      *     MOVE 'SGCMVTO' TO FIO-VOID.
      *     MOVE MCC       TO FIO-DFLD.
      *     MOVE 80        TO FIO-RLEN.
      **DAD fin  08-MAR-1991
      *     EXEC CICS WRITE
      *                 DATASET('SGCMVTO')
      *                 FROM(MCC)
      *                 LENGTH(80)
      *                 RIDFLD(MCC-IIC-IOPE)
      *                 RBA
      *     END-EXEC.
      * FIN-PUT-ICM-MCC.
      *     EXIT.
      *DAD fin  24-ABR-1992

       ING-FTER-CIC SECTION.
       INI-ING-FTER-CIC.
           PERFORM ING-SETE.
           MOVE SCR-INST-GKY TO SCR-INST.
           PERFORM HBL-KEY.
           PERFORM SCR-CLRA-ICM.
           PERFORM EDT-KEY-ICM.
           PERFORM EDT-FLD-ICM.
           MOVE SCR-MENS-EXT TO ICM-GLS-MENS.
           MOVE SPACES TO SCR-CIC-IOPE
                          SCR-VEC-ENG
                          SCR-VEC-FST
                          SCR-INST-EXT
                          SCR-MENS-EXT.
           PERFORM SCR-INIT.
           PERFORM SCR-EXIT.
       FIN-ING-FTER-CIC.
           EXIT.

       ING-FTER-CMN SECTION.
       INI-ING-FTER-CMN.
           PERFORM ING-SETE.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-ICM.
           MOVE SCR-MENS-EXT TO ICM-GLS-MENS.
           PERFORM SCR-INIT.
       FIN-ING-FTER-CMN.
           EXIT.

       ING-SETE SECTION.
       INI-ING-SETE.
           PERFORM CRG-TBL-ENG.
           MOVE WSS-NTRN(SCR-IPRO) TO SCR-NTRN.
           MOVE WSS-PROG(SCR-IPRO) TO SCR-PROG.
           MOVE WSS-NMAP(SCR-IPRO) TO SCR-NMAP.
           MOVE WSS-NLIB(SCR-IPRO) TO SCR-NLIB.
       FIN-ING-SETE.
           EXIT.

       SCR-INIT SECTION.
       INI-SCR-INIT.
           MOVE 3           TO FRM-PLIN.
           MOVE 19          TO FRM-NLIN.
           MOVE FRM-CLR-FRM TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE FRM-SINI-DBNF TO FRM-SINI.
           MOVE SCR-NMAP      TO FRM-NAME.
           MOVE SCR-NLIB      TO FRM-NLIB.
           MOVE ICM-FLD       TO FRM-DFLD.
           MOVE FRM-INI       TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-INIT.
           EXIT.
      * ISP CARGA LAS TABLAS DE MODULO SGCWGWIR.
       COPY SGCBGMPT.
      *
      *>>>>
*% END
*% IF EOF_V31
      *<<<< EOF_V31
      *DAD ini  07-MAR-1991 (el siguiente modulo display error en comandos ACC)
       ERR-OPE-RCO SECTION.
       INI-ERR-OPE-RCO.
           MOVE FIO-BCK-OUT TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF FIO-STAT-OKS
               MOVE '99' TO FIO-STAT
               MOVE 'ERROR : TRANSACCION BACK OUT, OK' TO SYS-MENS
           ELSE
               MOVE SYS-ABOR TO SYS-CMND
               MOVE 'ERROR : TRANSACCION BACK OUT, ABORTO' TO SYS-MENS
               PERFORM GNS-PRO-SYS.
       FIN-ERR-OPE-RCO.
           EXIT.
      *DAD fin  07-MAR-1991 

      *DAD ini  07-MAR-1991 (los siguientes 3 modulos son para el enganche)
       EGR-FPEN-CIC SECTION.
       INI-EGR-FPEN-CIC.
           PERFORM CRG-TBL-ENG.
           ADD 1 TO SCR-IPRO.
           IF SCR-IND-ENG IN SCR-VEC-ENG(SCR-IPRO) = SPACES
               GO TO INI-EGR-FPEN-CIC.
           MOVE WSS-INST-FPEN-CIC TO SCR-INST-EXT.
           MOVE WSS-PROG(SCR-IPRO) TO SYS-PROG.
           MOVE SCR-VARI           TO SYS-CMMA.
           MOVE SCR-TCMA           TO SYS-TCMA.
           MOVE SYS-XCTL           TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-EGR-FPEN-CIC.
           EXIT.

       EGR-FTER-CIC SECTION.
       INI-EGR-FTER-CIC.
           PERFORM CRG-TBL-ENG.
           MOVE 1 TO SCR-IPRO.
           MOVE WSS-INST-FTER-CIC TO SCR-INST-EXT.
           MOVE WSS-PROG(SCR-IPRO) TO SYS-PROG.
           MOVE SCR-VARI           TO SYS-CMMA.
           MOVE SCR-TCMA           TO SYS-TCMA.
           MOVE SYS-XCTL           TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-EGR-FTER-CIC.
           EXIT.

       EGR-FTER-CMN SECTION.
       INI-EGR-FTER-CMN.
           PERFORM CRG-TBL-ENG.
           MOVE 1 TO SCR-IPRO.
           MOVE WSS-INST-FTER-CMN TO SCR-INST-EXT.
           MOVE WSS-PROG(SCR-IPRO) TO SYS-PROG.
           MOVE SCR-VARI           TO SYS-CMMA.
           MOVE SCR-TCMA           TO SYS-TCMA.
           MOVE SYS-XCTL           TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
       FIN-EGR-FTER-CMN.
           EXIT.
      *DAD fin  07-MAR-1991 
      *>>>>
*% END
*% IF EOF_PQ
      *<<<< EOF_PQ
       RET-ALL-ICM SECTION.
       INI-RET-ALL-ICM.
           PERFORM KEY-ALL-ICM.
           PERFORM RET-DCC-ICM.
           PERFORM RET-DBC-ICM.
           PERFORM RET-OPE-ICM.
           PERFORM RET-RCO-ICM.
           PERFORM RET-RCD-ICM.
           PERFORM RET-PER-ICM.
       FIN-RET-ALL-ICM.
           EXIT.

       RET-DCC-ICM SECTION.
       INI-RET-DCC-ICM.
       FIN-RET-DCC-ICM.
           EXIT.

       RET-DBC-ICM SECTION.
       INI-RET-DBC-ICM.
       FIN-RET-DBC-ICM.
           EXIT.

       RET-OPE-ICM SECTION.
       INI-RET-OPE-ICM.
      *<<<< INI_RET_OPE_ICM
      *>>>>
           MOVE OPE-CAI-IOPE IN ICM-FLD TO OPE-CAI-IOPE IN OPE.
           MOVE OPE-IIC-IOPE IN ICM-FLD TO OPE-IIC-IOPE IN OPE.
           MOVE OPE-NUM-DIOP IN ICM-FLD TO OPE-NUM-DIOP IN OPE.
           MOVE OPE-NUM-MIOP IN ICM-FLD TO OPE-NUM-MIOP IN OPE.
           MOVE OPE-NUM-SIOP IN ICM-FLD TO OPE-NUM-SIOP IN OPE.
           MOVE OPE-NUM-AIOP IN ICM-FLD TO OPE-NUM-AIOP IN OPE.
           MOVE OPE-COD-OFOP IN ICM-FLD TO OPE-COD-OFOP IN OPE.
           MOVE OPE-IND-MCLI IN ICM-FLD TO OPE-IND-MCLI IN OPE.
           MOVE OPE-COD-VCOP IN ICM-FLD TO OPE-COD-VCOP IN OPE.
           MOVE OPE-COD-TCOM IN ICM-FLD TO OPE-COD-TCOM IN OPE.
           MOVE OPE-CAI-ICAR IN ICM-FLD TO OPE-CAI-ICAR IN OPE.
           MOVE OPE-IIC-ICAR IN ICM-FLD TO OPE-IIC-ICAR IN OPE.
           MOVE OPE-COD-EJOP IN ICM-FLD TO OPE-COD-EJOP IN OPE.
           MOVE OPE-NUM-DTOP IN ICM-FLD TO OPE-NUM-DTOP IN OPE.
           MOVE OPE-NUM-MTOP IN ICM-FLD TO OPE-NUM-MTOP IN OPE.
           MOVE OPE-NUM-STOP IN ICM-FLD TO OPE-NUM-STOP IN OPE.
           MOVE OPE-NUM-ATOP IN ICM-FLD TO OPE-NUM-ATOP IN OPE.
           MOVE OPE-COD-MOTT IN ICM-FLD TO OPE-COD-MOTT IN OPE.
      *<<<< FIN_RET_OPE_ICM
      *>>>>
       FIN-RET-OPE-ICM.
           EXIT.

       RET-RCO-ICM SECTION.
       INI-RET-RCO-ICM.
           MOVE RCO-NUM-DIRE IN ICM-FLD TO RCO-NUM-DIRE IN RCO.
       FIN-RET-RCO-ICM.
           EXIT.

       RET-RCD-ICM SECTION.
       INI-RET-RCD-ICM.
           MOVE RCD-GLS-DIRE IN ICM-FLD TO RCD-GLS-DIRE IN RCD.
       FIN-RET-RCD-ICM.
           EXIT.

       RET-PER-ICM SECTION.
       INI-RET-PER-ICM.
           MOVE PER-GLS-NOM1 IN ICM-FLD TO PER-GLS-NOM1 IN PER.
           MOVE PER-GLS-NOM2 IN ICM-FLD TO PER-GLS-NOM2 IN PER.
       FIN-RET-PER-ICM.
           EXIT.

       PRO-FLD-ICM SECTION.
       INI-PRO-FLD-ICM.
           MOVE FRM-CPIM-AEY TO FRM-IND-MCLI-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO FRM-IND-ICLP-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO FRM-GLS-ICLP-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO FRM-NUM-ICLP-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO FRM-VRF-ICLP-ATR IN ICM-FLD.
      *DAD ini  02-NOV-1993
           MOVE FRM-CPIM-AEY TO FRM-NUM-TBCI-ATR IN ICM-FLD.
      *DAD fin  02-NOV-1993
           PERFORM PRO-DCC-ICM.
           PERFORM PRO-DBC-ICM.
           PERFORM PRO-OPE-ICM.
           PERFORM PRO-RCO-ICM.
           PERFORM PRO-RCD-ICM.
           PERFORM PRO-PER-ICM.
       FIN-PRO-FLD-ICM.
           EXIT.

       PRO-DCC-ICM SECTION.
       INI-PRO-DCC-ICM.
       FIN-PRO-DCC-ICM.
           EXIT.

       PRO-DBC-ICM SECTION.
       INI-PRO-DBC-ICM.
       FIN-PRO-DBC-ICM.
           EXIT.

       PRO-OPE-ICM SECTION.
       INI-PRO-OPE-ICM.
      *<<<< INI_PRO_OPE_ICM
      *>>>>
           MOVE FRM-CPIM-AEY TO OPE-CAI-IOPE-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO OPE-IIC-IOPE-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO OPE-FEC-FIOP-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO OPE-COD-OFOP-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO OPE-COD-TCOM-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO OPE-CAI-ICAR-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO OPE-IIC-ICAR-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO OPE-COD-EJOP-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO OPE-FEC-FTOP-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO OPE-COD-MOTT-ATR IN ICM-FLD.
      *<<<< FIN_PRO_OPE_ICM
      *>>>>
       FIN-PRO-OPE-ICM.
           EXIT.

       PRO-RCO-ICM SECTION.
       INI-PRO-RCO-ICM.
           MOVE FRM-CPIM-AEY TO RCO-NUM-DIRE-ATR IN ICM-FLD.
       FIN-PRO-RCO-ICM.
           EXIT.

       PRO-RCD-ICM SECTION.
       INI-PRO-RCD-ICM.
       FIN-PRO-RCD-ICM.
           EXIT.

       PRO-PER-ICM SECTION.
       INI-PRO-PER-ICM.
           MOVE FRM-CPIM-AEY TO PER-GLS-NOM1-ATR IN ICM-FLD.
           MOVE FRM-CPIM-AEY TO PER-GLS-NOM2-ATR IN ICM-FLD.
       FIN-PRO-PER-ICM.
           EXIT.
      *>>>>
*% END
*% IF EOF_PU
      *<<<< EOF_PU
       PUT-RCO-ICM SECTION.
       INI-PUT-RCO-ICM.
           IF PGM-STAT-RCO-NUL
               GO TO FIN-PUT-RCO-ICM.
           IF NOT PGM-STAT-RCO-OKS
               PERFORM CLR-RCO-ICM
               GO TO FIN-PUT-RCO-ICM.
           MOVE RCO-NUM-DIRE IN RCO TO RCO-NUM-DIRE IN ICM-FLD.
       FIN-PUT-RCO-ICM.
           EXIT.

       PUT-OPE-ICM SECTION.
       INI-PUT-OPE-ICM.
      *<<<< INI_PUT_OPE_ICM
      *>>>>
           IF PGM-STAT-OPE-NUL
               GO TO FIN-PUT-OPE-ICM.
           IF NOT PGM-STAT-OPE-OKS
               PERFORM CLR-OPE-ICM
               GO TO FIN-PUT-OPE-ICM.
           MOVE OPE-CAI-IOPE IN OPE TO OPE-CAI-IOPE IN ICM-FLD.
           MOVE OPE-IIC-IOPE IN OPE TO OPE-IIC-IOPE IN ICM-FLD.
           MOVE OPE-NUM-DIOP IN OPE TO OPE-NUM-DIOP IN ICM-FLD.
           MOVE OPE-NUM-MIOP IN OPE TO OPE-NUM-MIOP IN ICM-FLD.
           MOVE OPE-NUM-SIOP IN OPE TO OPE-NUM-SIOP IN ICM-FLD.
           MOVE OPE-NUM-AIOP IN OPE TO OPE-NUM-AIOP IN ICM-FLD.
           MOVE OPE-COD-OFOP IN OPE TO OPE-COD-OFOP IN ICM-FLD.
           MOVE OPE-IND-MCLI IN OPE TO OPE-IND-MCLI IN ICM-FLD.
           MOVE OPE-COD-VCOP IN OPE TO OPE-COD-VCOP IN ICM-FLD.
           MOVE OPE-COD-TCOM IN OPE TO OPE-COD-TCOM IN ICM-FLD.
           MOVE OPE-CAI-ICAR IN OPE TO OPE-CAI-ICAR IN ICM-FLD.
           MOVE OPE-IIC-ICAR IN OPE TO OPE-IIC-ICAR IN ICM-FLD.
           MOVE OPE-COD-EJOP IN OPE TO OPE-COD-EJOP IN ICM-FLD.
           MOVE OPE-NUM-DTOP IN OPE TO OPE-NUM-DTOP IN ICM-FLD.
           MOVE OPE-NUM-MTOP IN OPE TO OPE-NUM-MTOP IN ICM-FLD.
           MOVE OPE-NUM-STOP IN OPE TO OPE-NUM-STOP IN ICM-FLD.
           MOVE OPE-NUM-ATOP IN OPE TO OPE-NUM-ATOP IN ICM-FLD.
           MOVE OPE-COD-MOTT IN OPE TO OPE-COD-MOTT IN ICM-FLD.
      *BUS-OFI busca oficina en tablas
           IF OPE-COD-OFOP IN ICM-FLD > SPACES
               MOVE OPE-COD-OFOP IN ICM-FLD TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC IN OFI TO FRM-GLS-OFOP IN ICM-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-OFOP IN ICM-FLD.
      *BUS-USR busca usuario en tablas
           IF OPE-COD-EJOP IN ICM-FLD > SPACES
               MOVE OPE-COD-EJOP IN ICM-FLD TO USR-COD-USER IN USR
               PERFORM BUS-USR
               MOVE USR-GLS-DESC IN USR TO FRM-GLS-EJOP IN ICM-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-EJOP IN ICM-FLD.
      *BUS-TAB busca glosa de codigo en tabla
           IF OPE-COD-MOTT IN ICM-FLD > SPACES
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'MTO' TO TAB-COD-TTAB IN TAB
               MOVE OPE-COD-MOTT IN ICM-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO
                    FRM-GLS-MOTT IN ICM-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-MOTT IN ICM-FLD.
      *<<<< FIN_PUT_OPE_ICM
           IF OPE-IND-MCLI IN ICM-FLD > SPACES
               MOVE 'S' TO FRM-IND-MCLI IN ICM-FLD
           ELSE
               MOVE 'N' TO FRM-IND-MCLI IN ICM-FLD.
      ************************************************************************
      *DAD ini  23-MAR-1992
      *---- agregado por odj desde aqui (a)
           IF (OPE-IIC-IOPE IN ICM-FLD = FRM-GLS-IANT)
               MOVE OPE-IIC-ICAR IN ICM-FLD TO OPE-IIC-ICAR IN OPE
               MOVE OPE-CAI-ICAR IN ICM-FLD TO OPE-CAI-ICAR IN OPE
               MOVE OPE-COD-TCOM IN ICM-FLD TO OPE-COD-TCOM IN OPE
               MOVE 'NO'                    TO WR-CAMBIA-CTACTE
               GO TO CON-PUT-OPE-ICM.

           MOVE 'SI' TO WR-CAMBIA-CTACTE.
           IF (OPE-COD-SOPE IN OPE = '99' AND
               OPE-COD-TCOM IN OPE NOT > SPACES)
               MOVE ZEROES TO OPE-COD-TCOM IN OPE.

           IF (OPE-COD-TCOM IN OPE NOT > SPACES)
*% IF PGM_PER
               MOVE ZEROES              TO FRM-GLS-TCOM 
*% ELSE
      *DAD ini  26-AUG-1992
               MOVE SPACES              TO FRM-GLS-TCOM IN ICM-FLD
      *DAD fin  26-AUG-1992
*% END
               MOVE SPACES              TO OPE-COD-TCOM IN ICM-FLD
               MOVE SPACES              TO OPE-CAI-ICAR IN ICM-FLD
               MOVE SPACES              TO OPE-IIC-ICAR IN ICM-FLD
           ELSE
               MOVE OPE-COD-TCOM IN OPE TO OPE-COD-TCOM IN ICM-FLD
               MOVE OPE-CAI-ICAR IN OPE TO OPE-CAI-ICAR IN ICM-FLD
               MOVE OPE-IIC-ICAR IN OPE TO OPE-IIC-ICAR IN ICM-FLD.

           MOVE OPE-IIC-IOPE IN OPE TO PER-KEY-IPER IN PER.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-PER.
           IF FIO-STAT-OKS
               MOVE PER-GLS-NOM1 IN PER TO PER-GLS-NOM1 IN ICM-FLD
               MOVE PER-GLS-NOM2 IN PER TO PER-GLS-NOM2 IN ICM-FLD
           ELSE
               MOVE SPACES              TO PER-GLS-NOM1 IN ICM-FLD
               MOVE SPACES              TO PER-GLS-NOM2 IN ICM-FLD.

       CON-PUT-OPE-ICM.
           MOVE OPE-IIC-IOPE IN ICM-FLD TO FRM-GLS-IANT.
      *---- agregado por odj hasta aqui (a)
      *DAD fin  23-MAR-1992
      ************************************************************************
      *>>>>
       FIN-PUT-OPE-ICM.
           EXIT.
      *>>>>
*% END
