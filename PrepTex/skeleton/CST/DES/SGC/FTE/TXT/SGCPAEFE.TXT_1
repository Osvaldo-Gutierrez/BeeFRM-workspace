*%! Codigo adicional para archivo
*%! RVM: 27-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% NO_HDR_CST = TRUE
*% IF PGM_ARG
*% FRM = "EFE"
*% PADRE = "DBC"
*% KEY_PADRE = "DBC-GLS-NOMC"
*% LARGO_KEY_PADRE = 75
*% RELACION_PADRE_HIJO = "DBC-CIC-ICLI"
*% LARGO_RELACION_PADRE_HIJO = 12
*% FIO_PADRE = "SGC-FIO-DBC"
*% SIST_PADRE = "SGC"
*% KEY_BROWSE_PADRE = "DBC-GLS-NOMC"
*% YO_LEO_EL_PRIMER_HIJO = TRUE 
*% ORG_PADRE_VSI = TRUE
*% HIJO = "EFE"
*% KEY_HIJO = "EFE-KEY-IEFE" 
*% LARGO_KEY_HIJO = 20
*% RELACION_HIJO_PADRE = "EFE-CIC-ICLI" 
*% FIO_HIJO = "SGC-FIO-EFE"
*% SIST_HIJO = "SGC" 
*% KEY_BROWSE_HIJO = "EFE-KEY-IEFE" 
*% ORG_HIJO_VSI = TRUE 
*% 
*% ACEPTE_PF5 = TRUE
*% ACEPTE_PF6 = TRUE
*% ACEPTE_PF7 = TRUE
*% ACEPTE_PF8 = TRUE
*% 
*% INICIALIZAR_VARIABLES = FALSE 
*% COLAR_HIJOS = FALSE 
*% LEER_TODOS_LOS_HIJOS = FALSE 
*% NUMERO_LINEAS_TABLA = 1 
*% 
*% INCLUDE 'GNSSRC:PFSCONIDX.SRC' 
*% END
*% IF PGM_DTC
*% RA1 = "DBC"
*% RA2 = "EFE"
*% NRA = 2
*% FRM = "EFE"
*% INCLUDE 'PFSALLALL'
*% END
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
      *     02 SCR-KEY-IDBC                         PIC X(03).
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AEP-REQA==.
      *>>>>
*% END
*% IF WSS_IBM
      *<<<< WSS_IBM
       COPY GNSWGSTR.
       COPY GNSWGCPT.
       COPY SGCBRDBC.
       COPY SGCBRAEP.
       01  WSS-VARI.
           03  WSS-VAL-PCPL            COMP              PIC  9(11).
           03  WSS-SGV-PAUT            COMP              PIC S9(11).
           03  WSS-VAL-VENP            COMP              PIC  9(11).
           03  WSS-SGV-PATR            COMP              PIC S9(11).
           03  WSS-VAL-TACT                              PIC S9(09).
           03  WSS-VAL-TPAS                              PIC S9(09).
           03  WSS-ILST                          VALUE 0 PIC  9(01).
               88 ING-SOBRE-EL-ULTIMO            VALUE 1.
           03  WSS-CIC-ICLI                      PIC X(12).
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
*%! RVM: 27-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
           PERFORM KEY-ALL-EFE.
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6
               PERFORM LEE-NXT-PRV-ANT
               IF MSG-COD-MENS = 'EFESI'
                   PERFORM SCR-CLRA-EFE
                   GO TO CON-FND-KEY
               ELSE
                   MOVE SPACES TO PGM-STAT
                   IF FRM-FFLD = FRM-FFLD-PF5
                       MOVE 'SGC' TO MSG-COD-SIST
                       MOVE 'EFE    NOPRV' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE '00' TO FIO-STAT
                       MOVE SCR-STAT-CON TO SCR-STAT
                       GO TO FIN-FND-KEY
                   ELSE
                       MOVE 'SGC' TO MSG-COD-SIST
                       MOVE 'EFE    NONXT' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE '00' TO FIO-STAT
                       MOVE SCR-STAT-CON TO SCR-STAT
                       GO TO FIN-FND-KEY.

           IF FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM LEE-NXT-PRV
               IF FIO-STAT-OKS
                   PERFORM SCR-CLRA-EFE
                   PERFORM BUS-EFE
                   IF NOT FIO-STAT-OKS
                       MOVE 'SGC'        TO MSG-COD-SIST
                       MOVE 'EFE    NEX' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MEN1
                       MOVE DBC-CAI-ICLI IN DBC TO 
                                     EFE-CAI-ICLI IN EFE-FLD
                       MOVE DBC-IIC-ICLI IN DBC TO
                                     EFE-IIC-ICLI IN EFE-FLD
                       PERFORM LEE-REG-AEP
                       IF FIO-STAT-OKS
                           MOVE 'SGC'        TO MSG-COD-SIST
                           MOVE 'AEP    EXT' TO MSG-COD-MENS
                           PERFORM GET-MSG
                           MOVE MSG-GLS-DESC TO FRM-MEN2
                           MOVE '00' TO FIO-STAT
                           MOVE SCR-STAT-CON TO SCR-STAT
                           GO TO FIN-FND-KEY
                       ELSE
                           MOVE '00' TO FIO-STAT
                           MOVE SCR-STAT-CON TO SCR-STAT
                           GO TO FIN-FND-KEY
                   ELSE
                       GO TO CON-FND-KEY
               ELSE
                   MOVE SPACES TO PGM-STAT
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE 'SGC' TO MSG-COD-SIST
                       MOVE 'DBC    NOPRV' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE '00' TO FIO-STAT
                       MOVE SCR-STAT-CON TO SCR-STAT
                       GO TO FIN-FND-KEY
                   ELSE
                       MOVE 'SGC' TO MSG-COD-SIST
                       MOVE 'DBC    NONXT' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE '00' TO FIO-STAT
                       MOVE SCR-STAT-CON TO SCR-STAT
                       GO TO FIN-FND-KEY.
*% END

           IF DBC-NUM-ICLI IN EFE-FLD NOT = ZEROES
      *IDC-CLI Busca Cliente por medio de IdC
               MOVE DBC-NUM-ICLI IN EFE-FLD TO DBC-NUM-ICLI IN DBC
               MOVE DBC-IND-ICLI IN EFE-FLD TO DBC-IND-ICLI IN DBC
               MOVE DBC-GLS-ICLI IN EFE-FLD TO DBC-GLS-ICLI IN DBC
               MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY
*%! RVM: 27-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
               MOVE 'IDC' TO SCR-KEY-IDBC
*% END
               MOVE FIO-GET-KEY-ALT TO FIO-CMND
               PERFORM GET-CLI
               
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN EFE-FLD
               
      *        MOVE DBC-GLS-NOMC IN DBC TO DBC-GLS-NOMC IN EFE-FLD
               IF MSG-COD-MENS > SPACES
                   MOVE FIO-STAT-NEX TO FIO-STAT
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-FND-KEY
               ELSE
               MOVE '00' TO PGM-STAT-DBC
      *         IF DBC-IND-TICL IN DBC NOT = 'E'
      *             MOVE 'SGC'        TO MSG-COD-SIST
      *             MOVE 'CLI    PER' TO MSG-COD-MENS
      *             PERFORM GET-MSG
      *             MOVE FIO-STAT-NEX TO FIO-STAT
      *             MOVE MSG-GLS-DESC TO FRM-MENS
      *             PERFORM PUT-DBC-EFE
      *             GO TO FIN-FND-KEY
      *         ELSE
*%! RVM: 27-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
                   MOVE ADR-DBC-REQA TO SCR-DBC-REQA
*% END
                   MOVE DBC-CAI-ICLI IN DBC TO EFE-CAI-ICLI IN EFE-FLD
                   MOVE DBC-IIC-ICLI IN DBC TO EFE-IIC-ICLI IN EFE-FLD
           ELSE
      *NOM-CLI Busca Cliente por medio del Nombre

               MOVE DBC-GLS-NOMC IN EFE-FLD TO STR-GLS-GSTR
               PERFORM STR-UNS 
               MOVE STR-GLS-FUNS IN STR-VARI(1) TO DBC-GLS-APAT IN DBC
               MOVE STR-GLS-FUNS IN STR-VARI(2) TO DBC-GLS-AMAT IN DBC
               MOVE STR-GLS-FUNS IN STR-VARI(3) TO DBC-GLS-NOMB IN DBC

               MOVE 'DBC-GLS-NOMC'  TO FIO-AKEY
*%! RVM: 27-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
               MOVE 'NOM' TO SCR-KEY-IDBC
*% END
               PERFORM BUS-CLI-EMP
               IF NOT FIO-STAT-OKS
                   MOVE FIO-STAT-NEX TO FIO-STAT
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-FND-KEY
               ELSE
*%! RVM: 27-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
                   MOVE ADR-DBC-REQA TO SCR-DBC-REQA
*% END
                   MOVE '00' TO PGM-STAT-DBC
                   
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN TO DBC-GLS-NOMC IN EFE-FLD
                   
                   MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN EFE-FLD
                   MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN EFE-FLD
                   MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN EFE-FLD
                   MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN EFE-FLD
                   MOVE DBC-CAI-ICLI IN DBC TO EFE-CAI-ICLI IN EFE-FLD
                   MOVE DBC-IIC-ICLI IN DBC TO EFE-IIC-ICLI IN EFE-FLD.
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
           IF EFE-FEC-FEFE IN EFE-FLD NOT > ZEROES 
               MOVE '99999999' TO EFE-FEC-FEFE IN EFE
               MOVE FIO-GET-LEQ TO FIO-CMND
               PERFORM SGC-FIO-EFE
               IF FIO-STAT-OKS AND 
                  EFE-CAI-ICLI IN EFE = EFE-CAI-ICLI IN EFE-FLD AND
                  EFE-IIC-ICLI IN EFE = EFE-IIC-ICLI IN EFE-FLD
                   MOVE '00' TO PGM-STAT-EFE
*%! RVM: 27-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
                   MOVE ADR-EFE-REQA TO SCR-EFE-REQA
*% END
                   MOVE EFE-STP-ITRN IN EFE TO SCR-UMOD
                   GO TO FIN-FND-KEY
               ELSE
                   MOVE 'SGC'        TO MSG-COD-SIST
                   MOVE 'EFE    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN1
                   PERFORM LEE-REG-AEP
                   IF FIO-STAT-OKS
      *GET-MSG Busca mensaje en tabla
                       MOVE 'SGC'        TO MSG-COD-SIST
                       MOVE 'AEP    EXT' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MEN2
                       MOVE FIO-STAT-NEX TO FIO-STAT
                       GO TO FIN-FND-KEY
                   ELSE
                       MOVE FIO-STAT-NEX TO FIO-STAT
                       GO TO FIN-FND-KEY.

           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-EFE.
           IF FIO-STAT-OKS
               MOVE '00' TO PGM-STAT-EFE
               MOVE EFE-STP-ITRN IN EFE TO SCR-UMOD
*%! RVM: 27-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
               MOVE ADR-EFE-REQA TO SCR-EFE-REQA
*% END
               GO TO FIN-FND-KEY.
           PERFORM KEY-ALL-EFE.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM SGC-FIO-EFE.
           IF FIO-STAT-OKS AND 
              EFE-CAI-ICLI IN EFE = EFE-CAI-ICLI IN EFE-FLD AND
              EFE-IIC-ICLI IN EFE = EFE-IIC-ICLI IN EFE-FLD
               MOVE '00' TO PGM-STAT-EFE
               IF SCR-CCPP = 'ACT' OR 'ING'
                   PERFORM KEY-ALL-EFE
                   PERFORM PUT-ALL-EFE
                   MOVE 1 TO WSS-ILST
                   MOVE '23' TO FIO-STAT
               ELSE
                   MOVE 0 TO WSS-ILST
                   MOVE '00' TO FIO-STAT
                   MOVE EFE-STP-ITRN IN EFE TO SCR-UMOD
*%! RVM: 27-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
                   MOVE ADR-EFE-REQA TO SCR-EFE-REQA
*% END
           ELSE
               PERFORM LEE-REG-AEP
               IF FIO-STAT-OKS
                   MOVE 'SGC'        TO MSG-COD-SIST
                   MOVE 'AEP    EXT' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN2
                   PERFORM KEY-ALL-EFE
                   MOVE 0 TO WSS-ILST
                   MOVE '23' TO FIO-STAT
                   GO TO FIN-FND-KEY
               ELSE
                   PERFORM KEY-ALL-EFE
                   MOVE 0 TO WSS-ILST
                   MOVE '23' TO FIO-STAT.
           GO TO FIN-FND-KEY.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
       CON-FND-KEY.
           IF FIO-STAT-OKS
               MOVE EFE-STP-ITRN IN EFE TO SCR-UMOD
*%! RVM: 27-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
               MOVE ADR-EFE-REQA TO SCR-EFE-REQA.
*% END
      *>>>>
*% END
*% IF CMN_MOD
      *<<<< CMN_MOD
           IF EFE-STP-ITRN IN EFE NOT = SCR-UMOD
      *GET-MSG Busca mensaje en tabla
               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'UPD    SIMUL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-MOD.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO EFE-NUM-DTRN IN EFE.
           MOVE HOY-MHOY IN HOY-VARI TO EFE-NUM-MTRN IN EFE.
           MOVE HOY-AHOY IN HOY-VARI TO EFE-NUM-ATRN IN EFE.
           MOVE HOY-SHOY IN HOY-VARI TO EFE-NUM-STRN IN EFE.
           MOVE HOY-HHOY IN HOY-VARI TO EFE-HRA-HRTR IN EFE.
           PERFORM RET-HDR-EFE.
      *>>>>
*% END
*% IF CMN_ING
      *<<<< CMN_ING
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO EFE-NUM-DTRN IN EFE.
           MOVE HOY-MHOY IN HOY-VARI TO EFE-NUM-MTRN IN EFE.
           MOVE HOY-AHOY IN HOY-VARI TO EFE-NUM-ATRN IN EFE.
           MOVE HOY-SHOY IN HOY-VARI TO EFE-NUM-STRN IN EFE.
           MOVE HOY-HHOY IN HOY-VARI TO EFE-HRA-HRTR IN EFE.
           PERFORM RET-HDR-EFE.
      *>>>>
*% END
*% IF CMN_ELI
      *<<<< CMN_ELI
           IF EFE-STP-ITRN IN EFE NOT = SCR-UMOD
      *GET-MSG Busca mensaje en tabla
               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'UPD    SIMUL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-ELI.
      *>>>>
*% END
*% IF FIN_SCR_TRL
      *<<<< FIN_SCR_TRL
           IF ( SCR-CCPP = 'ACT' OR 'ING' ) AND ING-SOBRE-EL-ULTIMO
               MOVE 'SGC' TO MSG-COD-SIST
               MOVE 'ING    LSTRG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS.
      *>>>>
*% END

*% IF PUT_SCR
      *<<<< PUT_SCR
      *>>>> PUT_SCR
*% END

*% IF EOF_PQ
*% IF PGM_ARG
       CARGAR-TABLA SECTION.
       INI-CARGAR-TABLA.
           MOVE PGM-SOKS TO PGM-STAT-EFE.

           IF NOT (FRM-FFLD = FRM-FFLD-PF5 OR
              FRM-FFLD = FRM-FFLD-PF6)
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM SGC-FIO-DBC
           IF NOT  FIO-STAT-OKS 
               MOVE SPACES TO SCR-KEY-IDBC-ACTU 
           ELSE
              MOVE DBC-GLS-NOMC IN DBC TO SCR-KEY-IDBC-ACTU.

           MOVE EFE-CAI-ICLI IN EFE TO EFE-CAI-ICLI IN EFE-FLD.
           MOVE EFE-IIC-ICLI IN EFE TO EFE-IIC-ICLI IN EFE-FLD.
           MOVE EFE-IND-ESBL IN EFE TO EFE-IND-ESBL IN EFE-FLD.
           MOVE EFE-NUM-DEFE IN EFE TO EFE-NUM-DEFE IN EFE-FLD.
           MOVE EFE-NUM-MEFE IN EFE TO EFE-NUM-MEFE IN EFE-FLD.
           MOVE EFE-NUM-SEFE IN EFE TO EFE-NUM-SEFE IN EFE-FLD.
           MOVE EFE-NUM-AEFE IN EFE TO EFE-NUM-AEFE IN EFE-FLD.
           MOVE EFE-COD-VCEF IN EFE TO EFE-COD-VCEF IN EFE-FLD.
           MOVE EFE-VAL-ACIR IN EFE TO EFE-VAL-ACIR IN EFE-FLD.
           MOVE EFE-VAL-PCIR IN EFE TO EFE-VAL-PCIR IN EFE-FLD.
           MOVE EFE-VAL-AFIJ IN EFE TO EFE-VAL-AFIJ IN EFE-FLD.
           MOVE EFE-VAL-PLPZ IN EFE TO EFE-VAL-PLPZ IN EFE-FLD.
           MOVE EFE-VAL-OACT IN EFE TO EFE-VAL-OACT IN EFE-FLD.
           MOVE EFE-SGV-PATR IN EFE TO EFE-SGV-PATR IN EFE-FLD.
           MOVE EFE-SGV-UTIL IN EFE TO EFE-SGV-UTIL IN EFE-FLD.
           MOVE EFE-VAL-AVAL IN EFE TO EFE-VAL-AVAL IN EFE-FLD.
           MOVE EFE-SGV-LACI IN EFE TO EFE-SGV-LACI IN EFE-FLD.
           MOVE EFE-SGV-VENE IN EFE TO EFE-SGV-VENE IN EFE-FLD.
           MOVE EFE-VAL-VENP IN EFE TO EFE-VAL-VENP IN EFE-FLD.
           MOVE EFE-SGV-RESO IN EFE TO EFE-SGV-RESO IN EFE-FLD.
           MOVE EFE-SGV-GOBR IN EFE TO EFE-SGV-GOBR IN EFE-FLD.
           MOVE EFE-NUM-PROM IN EFE TO EFE-NUM-PROM IN EFE-FLD.
           MOVE EFE-SGV-SOLV IN EFE TO EFE-SGV-SOLV IN EFE-FLD.
           MOVE EFE-NUM-ROTA IN EFE TO EFE-NUM-ROTA IN EFE-FLD.
      *BUS-TAB busca glosa de codigo en tabla
           IF EFE-COD-VCEF IN EFE-FLD > SPACES
              MOVE 'TAB' TO TAB-COD-SIST
              MOVE 'VLR ' TO TAB-COD-TTAB IN TAB
              MOVE EFE-COD-VCEF IN EFE-FLD TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              MOVE TAB-GLS-ABRV IN TAB TO
                   FRM-GLS-VCEF IN EFE-FLD
           ELSE
              MOVE SPACES TO FRM-GLS-VCEF IN EFE-FLD.

           ADD EFE-VAL-ACIR IN EFE-FLD
               EFE-VAL-AFIJ IN EFE-FLD
               EFE-VAL-OACT IN EFE-FLD
               GIVING FRM-VAL-TACT IN EFE-FLD.

           ADD EFE-VAL-PCIR IN EFE-FLD
               EFE-VAL-PLPZ IN EFE-FLD
               EFE-SGV-PATR IN EFE-FLD
               EFE-SGV-UTIL IN EFE-FLD
               GIVING FRM-VAL-TPAS IN EFE-FLD.

           IF EFE-VAL-PCIR IN EFE-FLD > ZEROES
              DIVIDE EFE-VAL-ACIR IN EFE-FLD BY
              EFE-VAL-PCIR IN EFE-FLD
              GIVING FRM-SGV-LCOR IN EFE-FLD ROUNDED
           ELSE
              IF EFE-VAL-ACIR IN EFE-FLD > ZEROES
                 MOVE 9999999,99 TO FRM-SGV-LCOR IN EFE-FLD
              ELSE
                 MOVE ZEROES TO FRM-SGV-LCOR IN EFE-FLD.

           ADD EFE-VAL-PCIR IN EFE-FLD
               EFE-VAL-PLPZ IN EFE-FLD
               GIVING WSS-VAL-PCPL IN WSS-VARI.

           ADD EFE-SGV-PATR IN EFE-FLD
               EFE-SGV-UTIL IN EFE-FLD
               GIVING WSS-SGV-PAUT IN WSS-VARI.

           IF WSS-SGV-PAUT IN WSS-VARI NOT = ZEROES
              DIVIDE WSS-VAL-PCPL IN WSS-VARI BY
              WSS-SGV-PAUT IN WSS-VARI
              GIVING FRM-SGV-LEVE IN EFE-FLD ROUNDED
           ELSE
              IF WSS-VAL-PCPL IN WSS-VARI > ZEROES
                 MOVE 9999999,99 TO FRM-SGV-LEVE IN EFE-FLD
              ELSE
                 MOVE ZEROES TO FRM-SGV-LEVE IN EFE-FLD.

           IF EFE-VAL-VENP IN EFE-FLD > ZEROES
              MULTIPLY EFE-SGV-UTIL IN EFE-FLD BY 100
              GIVING WSS-SGV-PATR IN WSS-VARI
              DIVIDE WSS-SGV-PATR IN WSS-VARI BY
              EFE-VAL-VENP IN EFE-FLD
              GIVING FRM-SGV-RVEN IN EFE-FLD ROUNDED
           ELSE
              IF EFE-SGV-UTIL IN EFE-FLD NOT = ZEROES
                 MOVE 9999999,99 TO FRM-SGV-RVEN IN EFE-FLD
              ELSE
                 MOVE ZEROES TO FRM-SGV-RVEN IN EFE-FLD.

           IF EFE-SGV-PATR IN EFE-FLD NOT =  ZEROES
              MULTIPLY EFE-SGV-UTIL IN EFE-FLD BY 100
              GIVING WSS-SGV-PATR IN WSS-VARI
              DIVIDE WSS-SGV-PATR IN WSS-VARI BY
              EFE-SGV-PATR IN EFE-FLD
              GIVING FRM-SGV-RPAT IN EFE-FLD ROUNDED
           ELSE
              IF EFE-SGV-UTIL IN EFE-FLD NOT = ZEROES
                 MOVE 9999999,99 TO FRM-SGV-RPAT IN EFE-FLD
              ELSE
                MOVE ZEROES TO FRM-SGV-RPAT IN EFE-FLD.
       FIN-CARGAR-TABLA.
           EXIT.
       LIMPIAR-TABLA SECTION.
       INI-LIMPIAR-TABLA.
           PERFORM CLR-EFE-EFE
           PERFORM CLR-FRM-EFE
       FIN-LIMPIAR-TABLA.
           EXIT.
       INIT-VARI SECTION.
       INI-INIT-VARI.

       FIN-INIT-VARI.
           EXIT.
       PROCESO-CADA-HIJO SECTION.
       INI-PROCESO-CADA-HIJO.

       FIN-PROCESO-CADA-HIJO.
           EXIT.
*% END
*% END
*% IF EOF
      *<<<< EOF
       RET-HDR-EFE SECTION.
       INI-RET-HDR-EFE.
           PERFORM GET-FHOY.
      *    Fecha Transaccion
           MOVE HOY-FHOY TO EFE-FEC-FTRN IN EFE.
      *    Hora Transaccion
           MOVE HOY-HHOY TO EFE-HRA-HRTR IN EFE.
      *    Codigo Origen transaccion
           MOVE SCR-OTRN TO EFE-COD-OTRN IN EFE.
      *    Autor Transaccion
           MOVE SCR-USER TO EFE-COD-ATRN IN EFE.
           IF SCR-CCPP = 'ING'
               MOVE 'I' TO EFE-MSC-TACC IN EFE
               MOVE 'I' TO EFE-MSC-STAT IN EFE
           ELSE
           IF SCR-CCPP = 'MOD'
               MOVE 'M' TO EFE-MSC-TACC IN EFE
               MOVE 'M' TO EFE-MSC-STAT IN EFE.
       FIN-RET-HDR-EFE.
           EXIT.

*%! RVM: 27-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
       LEE-NXT-PRV-ANT SECTION.
       INI-LEE-NXT-PRV-ANT.
           MOVE SPACES TO MSG-COD-MENS.
           IF SCR-EFE-REQA > SPACES
               PERFORM LEE-NXT-PRV-EFE
           ELSE
               MOVE 'EFENO' TO MSG-COD-MENS.
       FIN-LEE-NXT-PRV-ANT.
           EXIT.

       LEE-NXT-PRV SECTION.
       INI-LEE-NXT-PRV.
           MOVE SPACES TO MSG-COD-MENS.
           IF SCR-DBC-REQA > SPACES
               PERFORM LEE-NXT-PRV-DBC
           ELSE
               PERFORM LEE-NXT-PRV-NOM.
       FIN-LEE-NXT-PRV.
           EXIT.

       LEE-NXT-PRV-DBC SECTION.
       INI-LEE-NXT-PRV-DBC.
           MOVE SCR-DBC-REQA TO ADR-DBC-REQA.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           IF FRM-FFLD = FRM-FFLD-PF7
               MOVE FIO-GET-PRV TO FIO-CMND
           ELSE
               MOVE FIO-GET-NXT TO FIO-CMND.
       LUP-LEE-NXT-PRV-DBC.
           IF SCR-KEY-IDBC = 'NOM'
               MOVE 'DBC-GLS-NOMC' TO FIO-AKEY
           ELSE
               MOVE 'DBC-IDC-ICLI' TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
      *     IF FIO-STAT-OKS AND DBC-IND-TICL NOT = 'E'
      *         IF FRM-FFLD = FRM-FFLD-PF7
      *             MOVE FIO-GET-PRV TO FIO-CMND
      *             GO TO LUP-LEE-NXT-PRV-DBC
      *         ELSE
      *             MOVE FIO-GET-NXT TO FIO-CMND
      *             GO TO LUP-LEE-NXT-PRV-DBC.
           IF FIO-STAT-OKS
               MOVE ADR-DBC-REQA TO SCR-DBC-REQA.
       FIN-LEE-NXT-PRV-DBC.
           EXIT.

       LEE-NXT-PRV-NOM SECTION.
       INI-LEE-NXT-PRV-NOM.
           MOVE 'NOM' TO SCR-KEY-IDBC.
           IF DBC-GLS-NOMC IN DBC > SPACES
               MOVE FIO-GET-KEY    TO FIO-CMND
               MOVE 'DBC-GLS-NOMC' TO FIO-AKEY
               PERFORM SGC-FIO-DBC
               IF FIO-STAT-OKS
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE FIO-GET-PRV TO FIO-CMND
                   ELSE
                       MOVE FIO-GET-NXT TO FIO-CMND
               ELSE
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE FIO-GET-LEQ TO FIO-CMND
                   ELSE
                       MOVE FIO-GET-NLS TO FIO-CMND
           ELSE
               IF FRM-FFLD = FRM-FFLD-PF7
                   MOVE FIO-GET-LEQ TO FIO-CMND
               ELSE
                   MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-LEE-NXT-PRV-NOM.
           MOVE 'DBC-GLS-NOMC'  TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
      *     IF FIO-STAT-OKS AND DBC-IND-TICL NOT = 'E'
      *         IF FRM-FFLD = FRM-FFLD-PF7
      *             MOVE FIO-GET-PRV TO FIO-CMND
      *             GO TO LUP-LEE-NXT-PRV-NOM
      *         ELSE
      *             MOVE FIO-GET-NXT TO FIO-CMND
      *             GO TO LUP-LEE-NXT-PRV-NOM.
           IF FIO-STAT-OKS
               MOVE ADR-DBC-REQA TO SCR-DBC-REQA.
       FIN-LEE-NXT-PRV-NOM.
           EXIT.

       LEE-NXT-PRV-EFE SECTION.
       INI-LEE-NXT-PRV-EFE.
           MOVE SCR-EFE-REQA TO ADR-EFE-REQA.
           MOVE ADR-VKEY IN ADR-EFE-REQA TO WSS-CIC-ICLI IN WSS-VARI.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           IF FRM-FFLD = FRM-FFLD-PF5
               MOVE FIO-GET-PRV TO FIO-CMND
           ELSE
               MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SGC-FIO-EFE.
           IF FIO-STAT-OKS AND
              EFE-CIC-ICLI IN EFE = WSS-CIC-ICLI IN WSS-VARI
               MOVE '00' TO PGM-STAT-DBC
               MOVE '00' TO PGM-STAT-EFE
               MOVE ADR-EFE-REQA TO SCR-EFE-REQA
               MOVE 'EFESI' TO MSG-COD-MENS
               GO TO FIN-LEE-NXT-PRV-EFE.
           MOVE 'EFENO' TO MSG-COD-MENS.
       FIN-LEE-NXT-PRV-EFE.
           EXIT.

       BUS-EFE SECTION.
       INI-BUS-EFE.
           MOVE DBC-CAI-ICLI IN DBC TO EFE-CAI-ICLI IN EFE.
           MOVE DBC-IIC-ICLI IN DBC TO EFE-IIC-ICLI IN EFE.
           MOVE SPACES              TO EFE-FEC-FEFE IN EFE.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           IF FRM-FFLD = FRM-FFLD-PF7
               MOVE '999999999' TO EFE-FEC-FEFE IN EFE
               MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM SGC-FIO-EFE.
           IF FIO-STAT-OKS AND 
              EFE-CIC-ICLI IN EFE = DBC-CIC-ICLI IN DBC
               MOVE '00' TO PGM-STAT-EFE
*%! RVM: 27-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
               MOVE ADR-EFE-REQA TO SCR-EFE-REQA
*% END
               GO TO FIN-BUS-EFE.
           MOVE SPACES TO SCR-EFE-REQA.
           MOVE FIO-STAT-NEX TO FIO-STAT.
       FIN-BUS-EFE.
           EXIT.
*% END

       BUS-CLI-EMP SECTION.
       INI-BUS-CLI-EMP.
           MOVE FIO-GET-NLS-ALT TO FIO-CMND.
       LUP-BUS-CLI-EMP.
           MOVE 'DBC-GLS-NOMC' TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.
           MOVE SPACES TO FIO-AKEY.
      *     IF FIO-STAT-OKS AND DBC-IND-TICL IN DBC NOT = 'E'
      *         MOVE FIO-GET-NXT-ALT TO FIO-CMND
      *         GO TO LUP-BUS-CLI-EMP.
       FIN-BUS-CLI-EMP.
           EXIT.

       LEE-REG-AEP SECTION.
       INI-LEE-REG-AEP.
           MOVE EFE-CAI-ICLI IN EFE-FLD TO AEP-CAI-ICLI IN AEP.
           MOVE EFE-IIC-ICLI IN EFE-FLD TO AEP-IIC-ICLI IN AEP.
           MOVE '99999999' TO AEP-FEC-FAEP IN AEP.
           MOVE FIO-GET-LEQ TO FIO-CMND
           PERFORM SGC-FIO-AEP
           IF FIO-STAT-OKS AND 
              AEP-CAI-ICLI IN AEP = EFE-CAI-ICLI IN EFE-FLD AND
              AEP-IIC-ICLI IN AEP = EFE-IIC-ICLI IN EFE-FLD
               MOVE '00' TO FIO-STAT
           ELSE
               MOVE '23' TO FIO-STAT.
       FIN-LEE-REG-AEP.
           EXIT.

       COPY SGCBFDBC.
       COPY SGCBFAEP.
       COPY SGCBGCLI.
       COPY GNSBGSTR.
       COPY GNSBGCPT.
      *>>>>
*% END
