*%! Codigo adicional para archivo

*%! RVM: 30-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% NO_HDR_CST = TRUE
*% IF PGM_ARG
*% FRM = "AEP"
*% PADRE = "DBC"
*% KEY_PADRE = "DBC-GLS-NOMC"
*% LARGO_KEY_PADRE = 75
*% RELACION_PADRE_HIJO = "DBC-CIC-ICLI"
*% LARGO_RELACION_PADRE_HIJO = 12
*% FIO_PADRE = "SGC-FIO-DBC"
*% SIST_PADRE = "SGC"
*% KEY_BROWSE_PADRE = "DBC-GLS-NOMC"
*% ORG_PADRE_VSI = TRUE
*% HIJO = "AEP"
*% KEY_HIJO = "AEP-KEY-IAEP" 
*% LARGO_KEY_HIJO = 20
*% RELACION_HIJO_PADRE = "AEP-CIC-ICLI" 
*% FIO_HIJO = "SGC-FIO-AEP"
*% SIST_HIJO = "SGC" 
*% KEY_BROWSE_HIJO = "AEP-KEY-IAEP" 
*% YO_LEO_EL_PRIMER_HIJO = TRUE 
*% ORG_HIJO_VSI = TRUE 
*% 
*% ACEPTE_PF5 = TRUE
*% ACEPTE_PF6 = TRUE
*% ACEPTE_PF7 = TRUE
*% ACEPTE_PF8 = TRUE
*% 
*% INICIALIZAR_VARIABLES = FALSE 
*% COLAR_HIJOS = FALSE 
*% LEER_TODOS_LOS_HIJOS = FALSE 
*% NUMERO_LINEAS_TABLA = 1 
*% 
*% INCLUDE 'GNSSRC:PFSCONIDX.SRC' 
*% END
*% IF PGM_DTC
*% RA1 = "DBC"
*% RA2 = "AEP"
*% NRA = 2
*% FRM = "AEP"
*% INCLUDE 'PFSALLALL'
*% END
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
      *     02 SCR-KEY-IDBC                         PIC X(03).
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EFE-REQA==.
      *>>>>
*% END
*% IF WSS_IBM
      *<<<< WSS_IBM
       COPY SGCBRDBC.
       COPY SGCBREFE.
       COPY GNSWGSTR.
       COPY GNSWGCPT.
       01  WSS-VARI.
           03  WSS-VAL-TING                      PIC S9(09).
           03  WSS-VAL-TEGR                      PIC S9(09).
           03  WSS-VAL-TACT                      PIC S9(09).
           03  WSS-VAL-TPAS                      PIC S9(09).
           03  WSS-ILST                  VALUE 0 PIC  9(01).
               88 ING-SOBRE-EL-ULTIMO    VALUE 1.
           03  WSS-CIC-ICLI                      PIC X(12).
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
*%! RVM: 30-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
           PERFORM KEY-ALL-AEP.
           IF FRM-FFLD = FRM-FFLD-PF5 OR FRM-FFLD-PF6
               PERFORM LEE-NXT-PRV-ANT
               IF MSG-COD-MENS = 'AEPSI'
                   PERFORM SCR-CLRA-AEP
                   GO TO CON-FND-KEY
               ELSE
                   MOVE SPACES TO PGM-STAT
                   IF FRM-FFLD = FRM-FFLD-PF5
                       MOVE 'SGC' TO MSG-COD-SIST
                       MOVE 'AEP    NOPRV' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE '00' TO FIO-STAT
                       MOVE SCR-STAT-CON TO SCR-STAT
                       GO TO FIN-FND-KEY
                   ELSE
                       MOVE 'SGC' TO MSG-COD-SIST
                       MOVE 'AEP    NONXT' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE '00' TO FIO-STAT
                       MOVE SCR-STAT-CON TO SCR-STAT
                       GO TO FIN-FND-KEY.

           IF FRM-FFLD = FRM-FFLD-PF7 OR FRM-FFLD-PF8
               PERFORM LEE-NXT-PRV
               IF FIO-STAT-OKS
                   PERFORM SCR-CLRA-AEP
                   PERFORM BUS-AEP
                   IF NOT FIO-STAT-OKS
                       MOVE 'SGC'        TO MSG-COD-SIST
                       MOVE 'AEP    NEX' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MEN1
                       MOVE DBC-CAI-ICLI IN DBC TO 
                                     AEP-CAI-ICLI IN AEP-FLD
                       MOVE DBC-IIC-ICLI IN DBC TO
                                     AEP-IIC-ICLI IN AEP-FLD
                       PERFORM LEE-REG-EFE
                       IF FIO-STAT-OKS
                           MOVE 'SGC'        TO MSG-COD-SIST
                           MOVE 'EFE    EXT' TO MSG-COD-MENS
                           PERFORM GET-MSG
                           MOVE MSG-GLS-DESC TO FRM-MEN2
                           MOVE '00' TO FIO-STAT
                           MOVE SCR-STAT-CON TO SCR-STAT
                           GO TO FIN-FND-KEY
                       ELSE
                           MOVE '00' TO FIO-STAT
                           MOVE SCR-STAT-CON TO SCR-STAT
                           GO TO FIN-FND-KEY
                   ELSE
                       GO TO CON-FND-KEY
               ELSE
                   MOVE SPACES TO PGM-STAT
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE 'SGC' TO MSG-COD-SIST
                       MOVE 'DBC    NOPRV' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE '00' TO FIO-STAT
                       MOVE SCR-STAT-CON TO SCR-STAT
                       GO TO FIN-FND-KEY
                   ELSE
                       MOVE 'SGC' TO MSG-COD-SIST
                       MOVE 'DBC    NONXT' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE '00' TO FIO-STAT
                       MOVE SCR-STAT-CON TO SCR-STAT
                       GO TO FIN-FND-KEY.
*% END

           IF DBC-NUM-ICLI IN AEP-FLD NOT = ZEROES
      *IDC-CLI Busca Cliente por medio de IdC
               MOVE DBC-NUM-ICLI IN AEP-FLD TO DBC-NUM-ICLI IN DBC
               MOVE DBC-IND-ICLI IN AEP-FLD TO DBC-IND-ICLI IN DBC
               MOVE DBC-GLS-ICLI IN AEP-FLD TO DBC-GLS-ICLI IN DBC
               MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY
*%! RVM: 30-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
               MOVE 'IDC' TO SCR-KEY-IDBC
*% END
               MOVE FIO-GET-KEY-ALT TO FIO-CMND
               PERFORM GET-CLI

               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN AEP-FLD

      *        MOVE DBC-GLS-NOMC IN DBC TO DBC-GLS-NOMC IN AEP-FLD
               IF MSG-COD-MENS > SPACES
                   MOVE FIO-STAT-NEX TO FIO-STAT
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-FND-KEY
               ELSE
               MOVE '00' TO PGM-STAT-DBC
      *         IF DBC-IND-TICL IN DBC NOT = 'P'
      *             MOVE 'SGC'        TO MSG-COD-SIST
      *             MOVE 'CLI    EMP' TO MSG-COD-MENS
      *             PERFORM GET-MSG
      *             MOVE FIO-STAT-NEX TO FIO-STAT
      *             MOVE MSG-GLS-DESC TO FRM-MENS
      *             PERFORM PUT-DBC-AEP
      *             GO TO FIN-FND-KEY
      *         ELSE
*%! RVM: 30-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
                   MOVE ADR-DBC-REQA TO SCR-DBC-REQA
*% END
                   MOVE DBC-CAI-ICLI IN DBC TO AEP-CAI-ICLI IN AEP-FLD
                   MOVE DBC-IIC-ICLI IN DBC TO AEP-IIC-ICLI IN AEP-FLD
           ELSE
      *NOM-CLI Busca Cliente por medio del Nombre

               MOVE DBC-GLS-NOMC IN AEP-FLD TO STR-GLS-GSTR
               PERFORM STR-UNS
               MOVE STR-GLS-FUNS IN STR-VARI (1) TO DBC-GLS-APAT IN DBC
               MOVE STR-GLS-FUNS IN STR-VARI (2) TO DBC-GLS-AMAT IN DBC
               MOVE STR-GLS-FUNS IN STR-VARI (3) TO DBC-GLS-NOMB IN DBC

               MOVE 'DBC-GLS-NOMC'  TO FIO-AKEY
*%! RVM: 30-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
               MOVE 'NOM' TO SCR-KEY-IDBC
*% END
               PERFORM BUS-CLI-PER
               IF NOT FIO-STAT-OKS
                   MOVE FIO-STAT-NEX TO FIO-STAT
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-FND-KEY
               ELSE
*%! RVM: 30-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
                   MOVE ADR-DBC-REQA TO SCR-DBC-REQA
*% END
                   MOVE '00' TO PGM-STAT-DBC

                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN TO DBC-GLS-NOMC IN AEP-FLD

      *            MOVE DBC-GLS-NOMC IN DBC TO DBC-GLS-NOMC IN AEP-FLD
                   MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN AEP-FLD
                   MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN AEP-FLD
                   MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN AEP-FLD
                   MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN AEP-FLD
                   MOVE DBC-CAI-ICLI IN DBC TO AEP-CAI-ICLI IN AEP-FLD
                   MOVE DBC-IIC-ICLI IN DBC TO AEP-IIC-ICLI IN AEP-FLD.
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
           IF AEP-FEC-FAEP IN AEP-FLD NOT > ZEROES
               MOVE '99999999' TO AEP-FEC-FAEP IN AEP
               MOVE FIO-GET-LEQ TO FIO-CMND
               PERFORM SGC-FIO-AEP
               IF FIO-STAT-OKS AND 
                  AEP-CAI-ICLI IN AEP = AEP-CAI-ICLI IN AEP-FLD AND
                  AEP-IIC-ICLI IN AEP = AEP-IIC-ICLI IN AEP-FLD
                   MOVE '00' TO PGM-STAT-AEP
*%! RVM: 30-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
                   MOVE ADR-AEP-REQA TO SCR-AEP-REQA
*% END
                   MOVE AEP-STP-ITRN IN AEP TO SCR-UMOD
                   GO TO FIN-FND-KEY
               ELSE
                   MOVE 'SGC'        TO MSG-COD-SIST
                   MOVE 'AEP    NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN1
                   PERFORM LEE-REG-EFE
                   IF FIO-STAT-OKS
      *GET-MSG Busca mensaje en tabla
                       MOVE 'SGC'        TO MSG-COD-SIST
                       MOVE 'EFE    EXT' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MEN2
                       MOVE FIO-STAT-NEX TO FIO-STAT
                       GO TO FIN-FND-KEY
                   ELSE
                       MOVE FIO-STAT-NEX TO FIO-STAT
                       GO TO FIN-FND-KEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-AEP.
           IF FIO-STAT-OKS
               MOVE '00' TO PGM-STAT-AEP
               MOVE AEP-STP-ITRN IN AEP TO SCR-UMOD
*%! RVM: 30-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
               MOVE ADR-AEP-REQA TO SCR-AEP-REQA
*% END
               GO TO FIN-FND-KEY.
           PERFORM KEY-ALL-AEP.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM SGC-FIO-AEP.
           IF FIO-STAT-OKS AND
              AEP-CAI-ICLI IN AEP = AEP-CAI-ICLI IN AEP-FLD AND
               AEP-IIC-ICLI IN AEP = AEP-IIC-ICLI IN AEP-FLD
               MOVE '00' TO PGM-STAT-AEP
               IF SCR-CCPP = 'ACT' OR 'ING'
                   PERFORM KEY-ALL-AEP
                   PERFORM PUT-ALL-AEP
                   MOVE 1 TO WSS-ILST
                   MOVE '23' TO FIO-STAT
               ELSE
                   MOVE 0 TO WSS-ILST
                   MOVE '00' TO FIO-STAT
                   MOVE AEP-STP-ITRN IN AEP TO SCR-UMOD
*%! RVM: 30-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
                   MOVE ADR-AEP-REQA TO SCR-AEP-REQA
*% END
           ELSE
               PERFORM LEE-REG-EFE
               IF FIO-STAT-OKS
                   MOVE 'SGC'        TO MSG-COD-SIST
                   MOVE 'EFE    EXT' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN2
                   PERFORM KEY-ALL-AEP
                   MOVE 0 TO WSS-ILST
                   MOVE '23' TO FIO-STAT
                   GO TO FIN-FND-KEY
               ELSE
                   PERFORM KEY-ALL-AEP
                   MOVE 0 TO WSS-ILST
                   MOVE '23' TO FIO-STAT.
           GO TO FIN-FND-KEY.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
       CON-FND-KEY.
           IF FIO-STAT-OKS
               MOVE AEP-STP-ITRN IN AEP TO SCR-UMOD
*%! RVM: 30-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
               MOVE ADR-AEP-REQA TO SCR-AEP-REQA.
*% END
      *>>>>
*% END
*% IF PUT_SCR
      *<<<< PUT_SCR
      *>>>> PUT_SCR
*% END
*% IF CMN_MOD
      *<<<< CMN_MOD
           IF AEP-STP-ITRN IN AEP NOT = SCR-UMOD
      *GET-MSG Busca mensaje en tabla
               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'UPD    SIMUL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-MOD.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO AEP-NUM-DTRN IN AEP.
           MOVE HOY-MHOY IN HOY-VARI TO AEP-NUM-MTRN IN AEP.
           MOVE HOY-AHOY IN HOY-VARI TO AEP-NUM-ATRN IN AEP.
           MOVE HOY-SHOY IN HOY-VARI TO AEP-NUM-STRN IN AEP.
           MOVE HOY-HHOY IN HOY-VARI TO AEP-HRA-HRTR IN AEP.
           PERFORM RET-HDR-AEP.
      *>>>>
*% END
*% IF CMN_ING
      *<<<< CMN_ING
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI TO AEP-NUM-DTRN IN AEP.
           MOVE HOY-MHOY IN HOY-VARI TO AEP-NUM-MTRN IN AEP.
           MOVE HOY-AHOY IN HOY-VARI TO AEP-NUM-ATRN IN AEP.
           MOVE HOY-SHOY IN HOY-VARI TO AEP-NUM-STRN IN AEP.
           MOVE HOY-HHOY IN HOY-VARI TO AEP-HRA-HRTR IN AEP.
           PERFORM RET-HDR-AEP.
      *>>>>
*% END
*% IF CMN_ELI
      *<<<< CMN_ELI
           IF AEP-STP-ITRN IN AEP NOT = SCR-UMOD
      *GET-MSG Busca mensaje en tabla
               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'UPD    SIMUL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-ELI.
      *>>>>
*% END
*% IF FIN_SCR_TRL
      *<<<< FIN_SCR_TRL
           IF ( SCR-CCPP = 'ACT' OR 'ING' ) AND ING-SOBRE-EL-ULTIMO
               MOVE 'SGC' TO MSG-COD-SIST
               MOVE 'ING    LSTRG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS.
      *>>>>
*% END
*% IF EOF_PQ
*% IF PGM_ARG
       CARGAR-TABLA SECTION.
       INI-CARGAR-TABLA.
           MOVE PGM-SOKS TO PGM-STAT-AEP.
           IF NOT (FRM-FFLD = FRM-FFLD-PF5 OR
              FRM-FFLD = FRM-FFLD-PF6)
           MOVE FIO-GET-KEY TO FIO-CMND
           PERFORM SGC-FIO-DBC
           IF NOT  FIO-STAT-OKS 
               MOVE SPACES TO SCR-KEY-IDBC-ACTU 
           ELSE
              MOVE DBC-GLS-NOMC IN DBC TO SCR-KEY-IDBC-ACTU.
           MOVE AEP-CAI-ICLI IN AEP TO AEP-CAI-ICLI IN AEP-FLD.
           MOVE AEP-IIC-ICLI IN AEP TO AEP-IIC-ICLI IN AEP-FLD.
           MOVE AEP-NUM-DAEP IN AEP TO AEP-NUM-DAEP IN AEP-FLD.
           MOVE AEP-NUM-MAEP IN AEP TO AEP-NUM-MAEP IN AEP-FLD.
           MOVE AEP-NUM-SAEP IN AEP TO AEP-NUM-SAEP IN AEP-FLD.
           MOVE AEP-NUM-AAEP IN AEP TO AEP-NUM-AAEP IN AEP-FLD.
           MOVE AEP-NUM-DVRF IN AEP TO AEP-NUM-DVRF IN AEP-FLD.
           MOVE AEP-NUM-MVRF IN AEP TO AEP-NUM-MVRF IN AEP-FLD.
           MOVE AEP-NUM-SVRF IN AEP TO AEP-NUM-SVRF IN AEP-FLD.
           MOVE AEP-NUM-AVRF IN AEP TO AEP-NUM-AVRF IN AEP-FLD.
           MOVE AEP-COD-VCAE IN AEP TO AEP-COD-VCAE IN AEP-FLD.
           MOVE AEP-VAL-RLCL IN AEP TO AEP-VAL-RLCL IN AEP-FLD.
           MOVE AEP-VAL-DMEN IN AEP TO AEP-VAL-DMEN IN AEP-FLD.
           MOVE AEP-VAL-RLCJ IN AEP TO AEP-VAL-RLCJ IN AEP-FLD.
           MOVE AEP-VAL-ARRD IN AEP TO AEP-VAL-ARRD IN AEP-FLD.
           MOVE AEP-VAL-OING IN AEP TO AEP-VAL-OING IN AEP-FLD.
           MOVE AEP-VAL-OEGR IN AEP TO AEP-VAL-OEGR IN AEP-FLD.
           MOVE AEP-VAL-DPZO IN AEP TO AEP-VAL-DPZO IN AEP-FLD.
           MOVE AEP-VAL-DBYC IN AEP TO AEP-VAL-DBYC IN AEP-FLD.
           MOVE AEP-VAL-ACBO IN AEP TO AEP-VAL-ACBO IN AEP-FLD.
           MOVE AEP-VAL-DHIP IN AEP TO AEP-VAL-DHIP IN AEP-FLD.
           MOVE AEP-VAL-BIRA IN AEP TO AEP-VAL-BIRA IN AEP-FLD.
           MOVE AEP-VAL-OPAS IN AEP TO AEP-VAL-OPAS IN AEP-FLD.
           MOVE AEP-VAL-VEHI IN AEP TO AEP-VAL-VEHI IN AEP-FLD.
           MOVE AEP-VAL-ASOC IN AEP TO AEP-VAL-ASOC IN AEP-FLD.
           MOVE AEP-VAL-OACT IN AEP TO AEP-VAL-OACT IN AEP-FLD.
           MOVE AEP-VAL-AVAL IN AEP TO AEP-VAL-AVAL IN AEP-FLD.

           IF AEP-COD-VCAE IN AEP-FLD > SPACES
              MOVE 'TAB' TO TAB-COD-SIST
              MOVE 'VLR ' TO TAB-COD-TTAB IN TAB
              MOVE AEP-COD-VCAE IN AEP-FLD TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              MOVE TAB-GLS-ABRV IN TAB TO
                   FRM-GLS-VCAE IN AEP-FLD
           ELSE
              MOVE SPACES TO FRM-GLS-VCAE IN AEP-FLD.

           ADD AEP-VAL-RLCL IN AEP-FLD
               AEP-VAL-RLCJ IN AEP-FLD
               AEP-VAL-OING IN AEP-FLD
               GIVING FRM-VAL-TING IN AEP-FLD.

           ADD AEP-VAL-DMEN IN AEP-FLD
               AEP-VAL-ARRD IN AEP-FLD
               AEP-VAL-OEGR IN AEP-FLD
               GIVING FRM-VAL-TEGR IN AEP-FLD.

           ADD AEP-VAL-DPZO IN AEP-FLD
               AEP-VAL-ACBO IN AEP-FLD
               AEP-VAL-BIRA IN AEP-FLD
               AEP-VAL-VEHI IN AEP-FLD
               AEP-VAL-ASOC IN AEP-FLD
               AEP-VAL-OACT IN AEP-FLD
               GIVING FRM-VAL-TACT IN AEP-FLD.

           ADD AEP-VAL-DBYC IN AEP-FLD
               AEP-VAL-DHIP IN AEP-FLD
               AEP-VAL-OPAS IN AEP-FLD
               GIVING FRM-VAL-TPAS IN AEP-FLD.

           SUBTRACT FRM-VAL-TPAS IN AEP-FLD
                    FROM FRM-VAL-TACT IN AEP-FLD
                    GIVING FRM-VAL-PATR IN AEP-FLD.

           SUBTRACT FRM-VAL-TEGR IN AEP-FLD
                    FROM FRM-VAL-TING IN AEP-FLD
                    GIVING FRM-VAL-IDIS IN AEP-FLD.
       FIN-CARGAR-TABLA.
           EXIT.
       LIMPIAR-TABLA SECTION.
       INI-LIMPIAR-TABLA.
           PERFORM CLR-AEP-AEP
           PERFORM CLR-FRM-AEP
       FIN-LIMPIAR-TABLA.
           EXIT.
       INIT-VARI SECTION.
       INI-INIT-VARI.
       FIN-INIT-VARI.
           EXIT.
       PROCESO-CADA-HIJO SECTION.
       INI-PROCESO-CADA-HIJO.
       FIN-PROCESO-CADA-HIJO.
           EXIT.
*% END
*% END
*% IF EOF
      *<<<< EOF
*%! RVM: 30-03-92 VSI NO MANEJA PFS DEPENDIENTES DE DTC
*% IF PGM_DTC
       LEE-NXT-PRV-ANT SECTION.
       INI-LEE-NXT-PRV-ANT.
           MOVE SPACES TO MSG-COD-MENS.
           IF SCR-AEP-REQA > SPACES
               PERFORM LEE-NXT-PRV-AEP
           ELSE
               MOVE 'AEPNO' TO MSG-COD-MENS.
       FIN-LEE-NXT-PRV-ANT.
           EXIT.

       LEE-NXT-PRV SECTION.
       INI-LEE-NXT-PRV.
           MOVE SPACES TO MSG-COD-MENS.
           IF SCR-DBC-REQA > SPACES
               PERFORM LEE-NXT-PRV-DBC
           ELSE
               PERFORM LEE-NXT-PRV-NOM.
       FIN-LEE-NXT-PRV.
           EXIT.

       LEE-NXT-PRV-DBC SECTION.
       INI-LEE-NXT-PRV-DBC.
           MOVE SCR-DBC-REQA TO ADR-DBC-REQA.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           IF FRM-FFLD = FRM-FFLD-PF7
               MOVE FIO-GET-PRV TO FIO-CMND
           ELSE
               MOVE FIO-GET-NXT TO FIO-CMND.
       LUP-LEE-NXT-PRV-DBC.
           IF SCR-KEY-IDBC = 'NOM'
               MOVE 'DBC-GLS-NOMC' TO FIO-AKEY
           ELSE
               MOVE 'DBC-IDC-ICLI' TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
      *     IF FIO-STAT-OKS AND DBC-IND-TICL NOT = 'P'
      *         IF FRM-FFLD = FRM-FFLD-PF7
      *             MOVE FIO-GET-PRV TO FIO-CMND
      *             GO TO LUP-LEE-NXT-PRV-DBC
      *         ELSE
      *             MOVE FIO-GET-NXT TO FIO-CMND
      *             GO TO LUP-LEE-NXT-PRV-DBC.
           IF FIO-STAT-OKS
               MOVE ADR-DBC-REQA TO SCR-DBC-REQA.
       FIN-LEE-NXT-PRV-DBC.
           EXIT.

       LEE-NXT-PRV-NOM SECTION.
       INI-LEE-NXT-PRV-NOM.
           MOVE 'NOM' TO SCR-KEY-IDBC.
           IF DBC-GLS-NOMC IN DBC > SPACES
               MOVE FIO-GET-KEY    TO FIO-CMND
               MOVE 'DBC-GLS-NOMC' TO FIO-AKEY
               PERFORM SGC-FIO-DBC
               IF FIO-STAT-OKS
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE FIO-GET-PRV TO FIO-CMND
                   ELSE
                       MOVE FIO-GET-NXT TO FIO-CMND
               ELSE
                   IF FRM-FFLD = FRM-FFLD-PF7
                       MOVE FIO-GET-LEQ TO FIO-CMND
                   ELSE
                       MOVE FIO-GET-NLS TO FIO-CMND
           ELSE
               IF FRM-FFLD = FRM-FFLD-PF7
                   MOVE FIO-GET-LEQ TO FIO-CMND
               ELSE
                   MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-LEE-NXT-PRV-NOM.
           MOVE 'DBC-GLS-NOMC'  TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
      *     IF FIO-STAT-OKS AND DBC-IND-TICL NOT = 'P'
      *         IF FRM-FFLD = FRM-FFLD-PF7
      *             MOVE FIO-GET-PRV TO FIO-CMND
      *             GO TO LUP-LEE-NXT-PRV-NOM
      *         ELSE
      *             MOVE FIO-GET-NXT TO FIO-CMND
      *             GO TO LUP-LEE-NXT-PRV-NOM.
           IF FIO-STAT-OKS
               MOVE ADR-DBC-REQA TO SCR-DBC-REQA.
       FIN-LEE-NXT-PRV-NOM.
           EXIT.

       LEE-NXT-PRV-AEP SECTION.
       INI-LEE-NXT-PRV-AEP.
           MOVE SCR-AEP-REQA TO ADR-AEP-REQA.
           MOVE ADR-VKEY IN ADR-AEP-REQA TO WSS-CIC-ICLI IN WSS-VARI.
           MOVE FIO-KDEF-S TO FIO-KDEF.
           IF FRM-FFLD = FRM-FFLD-PF5
               MOVE FIO-GET-PRV TO FIO-CMND
           ELSE
               MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM SGC-FIO-AEP.
           IF FIO-STAT-OKS AND
              AEP-CIC-ICLI IN AEP = WSS-CIC-ICLI IN WSS-VARI
               MOVE '00' TO PGM-STAT-DBC
               MOVE '00' TO PGM-STAT-AEP
               MOVE ADR-AEP-REQA TO SCR-AEP-REQA
               MOVE 'AEPSI' TO MSG-COD-MENS
               GO TO FIN-LEE-NXT-PRV-AEP.
           MOVE 'AEPNO' TO MSG-COD-MENS.
       FIN-LEE-NXT-PRV-AEP.
           EXIT.

       BUS-AEP SECTION.
       INI-BUS-AEP.
           MOVE DBC-CAI-ICLI IN DBC TO AEP-CAI-ICLI IN AEP.
           MOVE DBC-IIC-ICLI IN DBC TO AEP-IIC-ICLI IN AEP.
           MOVE SPACES              TO AEP-FEC-FAEP IN AEP.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           IF FRM-FFLD = FRM-FFLD-PF7
               MOVE '999999999' TO AEP-FEC-FAEP IN AEP
               MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM SGC-FIO-AEP.
           IF FIO-STAT-OKS AND 
              AEP-CIC-ICLI IN AEP = DBC-CIC-ICLI IN DBC
               MOVE '00' TO PGM-STAT-AEP
               MOVE ADR-AEP-REQA TO SCR-AEP-REQA
               GO TO FIN-BUS-AEP.
           MOVE SPACES TO SCR-AEP-REQA.
           MOVE FIO-STAT-NEX TO FIO-STAT.
       FIN-BUS-AEP.
           EXIT.
*% END

       BUS-CLI-PER SECTION.
       INI-BUS-CLI-PER.
           MOVE FIO-GET-NLS-ALT TO FIO-CMND.
       LUP-BUS-CLI-PER.
           MOVE 'DBC-GLS-NOMC' TO FIO-AKEY.
           PERFORM SGC-FIO-DBC.
           MOVE SPACES TO FIO-AKEY.
      *     IF FIO-STAT-OKS AND DBC-IND-TICL IN DBC NOT = 'P'
      *         MOVE FIO-GET-NXT-ALT TO FIO-CMND
      *         GO TO LUP-BUS-CLI-PER.
       FIN-BUS-CLI-PER.
           EXIT.

       LEE-REG-EFE SECTION.
       INI-LEE-REG-EFE.
           MOVE AEP-CAI-ICLI IN AEP-FLD TO EFE-CAI-ICLI IN EFE.
           MOVE AEP-IIC-ICLI IN AEP-FLD TO EFE-IIC-ICLI IN EFE.
           MOVE '99999999' TO EFE-FEC-FEFE IN EFE.
           MOVE FIO-GET-LEQ TO FIO-CMND
           PERFORM SGC-FIO-EFE
           IF FIO-STAT-OKS AND 
              EFE-CAI-ICLI IN EFE = AEP-CAI-ICLI IN AEP-FLD AND
              EFE-IIC-ICLI IN EFE = AEP-IIC-ICLI IN AEP-FLD
               MOVE '00' TO FIO-STAT
           ELSE
               MOVE '23' TO FIO-STAT.
       FIN-LEE-REG-EFE.
           EXIT.

       COPY GNSBGCPT.
       COPY GNSBGSTR.
       COPY SGCBFDBC.
       COPY SGCBFEFE.
       COPY SGCBGCLI.
      *>>>>
*% END
*% IF EOF_PU
      *<<<< EOF_PU
       RET-HDR-AEP SECTION.
       INI-RET-HDR-AEP.
           PERFORM GET-FHOY.
      *    Fecha Transaccion
           MOVE HOY-FHOY TO AEP-FEC-FTRN IN AEP.
      *    Hora Transaccion
           MOVE HOY-HHOY TO AEP-HRA-HRTR IN AEP.
      *    Codigo Origen transaccion
           MOVE SCR-OTRN TO AEP-COD-OTRN IN AEP.
      *    Autor Transaccion
           MOVE SCR-USER TO AEP-COD-ATRN IN AEP.
           IF SCR-CCPP = 'ING'
               MOVE 'I' TO AEP-MSC-TACC IN AEP
               MOVE 'I' TO AEP-MSC-STAT IN AEP
           ELSE
           IF SCR-CCPP = 'MOD'
               MOVE 'M' TO AEP-MSC-TACC IN AEP
               MOVE 'M' TO AEP-MSC-STAT IN AEP.
       FIN-RET-HDR-AEP.
           EXIT.
      *>>>>
*% END
