*%! Codigo adicional para archivo
*% IF WSS
      *<<<< WSS
       COPY GNSBRRCE.
       COPY GNSBRCMT.
       COPY TABBRUSR.
       COPY TABBROFI.
       COPY SGCBROPE.
       COPY SGCBRRCO.
       COPY SGCBRDBC.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGCPT.
       01  WSS-VARI.
           03 WSS-FEC-FPRO.
              05 WSS-NUM-DPRO                     PIC 9(02).
              05 WSS-NUM-MPRO                     PIC 9(02).
              05 WSS-NUM-SPRO                     PIC 9(02).
              05 WSS-NUM-APRO                     PIC 9(02).
           03 WSS-FEC-FFEP.
              05 WSS-NUM-SFEP                     PIC 9(02).
              05 WSS-NUM-AFEP                     PIC 9(02).
              05 WSS-NUM-MFEP                     PIC 9(02).
              05 WSS-NUM-DFEP                     PIC 9(02).
           03 WSS-COD-OFOP                        PIC X(03).
           03 WSS-COD-EJOP                        PIC X(12).
           03 WSS-IND-NEXT                        PIC 9(01).
           03 WSS-CIC-ICCT                        PIC X(12).
           03 WSS-GLS-IENT.
              05 WSS-CIC-IOPE                     PIC X(12).
              05 FILLER      VALUE SPACES         PIC X(18).
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CMT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>>
*% END
*% IF PH_CCP
      *<<<< PH_CCP
      * Mediante BUS-OFI se Obtiene Nombre de la Oficina de Tabla OFI
           IF OPE-COD-OFOP IN SRT > SPACES
               MOVE OPE-COD-OFOP IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFOP IN WSS-CCP
           ELSE
               MOVE SPACES TO WSS-GLS-OFOP IN WSS-CCP.

      * Mediante BUS-USR Busca Usuario de Tabla USR
           IF OPE-COD-EJOP IN SRT > SPACES
               MOVE OPE-COD-EJOP IN SRT TO USR-COD-USER IN USR
               PERFORM BUS-USR
               MOVE USR-GLS-DESC IN USR TO WSS-GLS-EJOP IN WSS-CCP
           ELSE
               MOVE SPACES TO WSS-GLS-EJOP IN WSS-CCP.
      *>>>>
*% END
*% IF INI_INP
      *<<<< INI_INP
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.

      *Captura Fecha de Proceso
           DISPLAY 'FECHA PROCESO ( DDMMSSAA ) : '.
           ACCEPT  WSS-FEC-FPRO IN WSS-VARI.
           DISPLAY WSS-FEC-FPRO IN WSS-VARI.
      *Captura Codigo de Oficina
           DISPLAY 'OFICINA        (*=TODAS) : '.
           ACCEPT  WSS-COD-OFOP IN WSS-VARI.
           DISPLAY WSS-COD-OFOP IN WSS-VARI.
      *Captura Ejecutivo Operacion Credito
           DISPLAY 'EJECUTIVO      (*=TODOS) : '.
           ACCEPT  WSS-COD-EJOP IN WSS-VARI.
           DISPLAY WSS-COD-EJOP IN WSS-VARI.

           DISPLAY 'FIN    CAPTURA    DE PARAMETROS'.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

      *VAL-FEC Valida Fecha de Proceso
           DISPLAY WSS-FEC-FPRO IN WSS-VARI.
           MOVE WSS-FEC-FPRO IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-END.
      *         MOVE PGM-SMAL TO PGM-STAT-SRT
      *         GO TO FIN-INP-SRT.

           MOVE WSS-NUM-DPRO IN WSS-VARI TO WSS-NUM-DPRO IN WSS-CCP
                                            WSS-NUM-DFEP IN WSS-VARI.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO WSS-NUM-MPRO IN WSS-CCP
                                            WSS-NUM-MFEP IN WSS-VARI.
           MOVE WSS-NUM-SPRO IN WSS-VARI TO WSS-NUM-SPRO IN WSS-CCP
                                            WSS-NUM-SFEP IN WSS-VARI.
           MOVE WSS-NUM-APRO IN WSS-VARI TO WSS-NUM-APRO IN WSS-CCP
                                            WSS-NUM-AFEP IN WSS-VARI.
 
      *VAL-OFI Valida Codigo de Oficina en TABLAS
           IF WSS-COD-OFOP IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-OFOP IN WSS-VARI.
           IF WSS-COD-OFOP IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-OFOP IN WSS-VARI
               MOVE WSS-COD-OFOP IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   PERFORM GNS-PRO-END.
      *             MOVE PGM-SMAL TO PGM-STAT-SRT
      *             GO TO FIN-INP-SRT.

      *VAL-USR Valida Codigo de Usuario en TABLAS
           IF WSS-COD-EJOP IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-EJOP IN WSS-VARI.
           IF WSS-COD-EJOP IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-EJOP IN WSS-VARI
               MOVE WSS-COD-EJOP IN WSS-VARI TO USR-COD-USER IN USR
               PERFORM VAL-USR
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   PERFORM GNS-PRO-END.
      *             MOVE PGM-SMAL TO PGM-STAT-SRT
      *             GO TO FIN-INP-SRT.

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.

           MOVE SPACES TO WSS-CIC-ICCT IN WSS-VARI.
      *>>>>
*% END
*% IF LUP_INP
      *<<<< LUP_INP
      * Proceso de Seleccion y Clasificacion a Partir del Registro CHP
           PERFORM SEL-REG-PRO.
           IF WSS-IND-NEXT IN WSS-VARI = 1
               GO TO NXT-INP-SRT.
           PERFORM BUS-SRT-REG.
           GO TO NXT-INP-SRT.
      *>>>>
*% END
*% IF LUP_OUT
      *<<<< LUP_OUT
           PERFORM GEN-LIN-OUT.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      **************************************************************************
      * Seleccion del Registro para Proceso Mediante Fecha, Oficina y Ejecutivo
      * del Listado
       SEL-REG-PRO SECTION.
       INI-SEL-REG-PRO.
           MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.

           IF CHP-CIC-ICCT IN CHP = WSS-CIC-ICCT IN WSS-VARI
               GO TO FIN-SEL-REG-PRO.
           MOVE CHP-CIC-ICCT IN CHP TO WSS-CIC-ICCT IN WSS-VARI.

           IF CHP-FEC-FCHP IN CHP > WSS-FEC-FFEP IN WSS-VARI
               GO TO FIN-SEL-REG-PRO.

           IF CHP-COD-TDOC IN CHP NOT = 'CHQ'
               GO TO FIN-SEL-REG-PRO.

           MOVE CHP-CIC-ICCT IN CHP TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF NOT FIO-STAT-OKS
               GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-OFOP IN WSS-VARI NOT = '*'
               IF WSS-COD-OFOP IN WSS-VARI NOT = OPE-COD-OFOP IN OPE
                   GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-EJOP IN WSS-VARI NOT = '*'
               IF WSS-COD-EJOP IN WSS-VARI NOT = OPE-COD-EJOP IN OPE
                   GO TO FIN-SEL-REG-PRO.

           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
       FIN-SEL-REG-PRO.
           EXIT.
      **************************************************************************
      * Formacion y Generacion del Registro SRT al Procesar Varios Registros
       BUS-SRT-REG SECTION.
       INI-BUS-SRT-REG.
      * Busca Datos Cliente por Medio del CIC de Operaciones en Registro RCO
           MOVE CHP-CIC-ICCT IN CHP TO RCO-CIC-IOPE IN RCO.
           MOVE 'RCO-KEY-IOPE' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF NOT FIO-STAT-OKS
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'CHP    RCONX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG  CHP-CIC-ICCT IN CHP
               GO TO FIN-BUS-SRT-REG.
       LUP-GET-RCO.
           IF CHP-CIC-ICCT IN CHP NOT = RCO-CIC-IOPE IN RCO
               GO TO FIN-BUS-SRT-REG.
      * Busca Datos del Cliente
           MOVE RCO-CIC-ICLI IN RCO TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF FIO-STAT-OKS
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC
           ELSE
               MOVE 'SGC'          TO MSG-COD-SIST
               MOVE 'RCO    NOCLI' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG  RCO-CIC-ICLI IN RCO.
      * Completa Llenado de Campos y Genera el Registro SRT
           COPY SGCRMCCP.
           RELEASE SRT.
       NXT-GET-RCO.
           MOVE 'RCO-KEY-IOPE' TO FIO-AKEY.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           GO TO LUP-GET-RCO.
       FIN-BUS-SRT-REG.
           EXIT.
      **************************************************************************
      * Genera Lineas de Detalle a Partir de Registro SRT Ordenado
       GEN-LIN-OUT SECTION.
       INI-GEN-LIN-OUT.
           MOVE SPACES TO WSS-GLS-CMNT IN WSS-CCP.
           PERFORM BUS-WSS-GLS-MSG.
       FIN-GEN-LIN-OUT.
           EXIT.
      **************************************************************************
      * Obtiene Comentario asociado a la entidad OPE
       BUS-WSS-GLS-MSG SECTION.
       INI-BUS-WSS-GLS-MSG.
           MOVE SPACES TO WSS-GLS-IENT IN WSS-VARI.
           MOVE CHP-CIC-ICCT IN SRT      TO WSS-CIC-IOPE IN WSS-VARI.
           MOVE 'SGC'                    TO RCE-COD-SIST IN RCE.
           MOVE 'OPE'                    TO RCE-COD-ENTI IN RCE.
           MOVE WSS-GLS-IENT IN WSS-VARI TO RCE-GLS-IENT IN RCE.
           MOVE SPACES                   TO RCE-COD-SENT IN RCE.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           MOVE 'RCE-KEY-IENT' TO FIO-AKEY.
           PERFORM GNS-FIO-RCE.
           IF NOT FIO-STAT-OKS
               GO TO FIN-BUS-WSS-GLS-MSG.

           MOVE RCE-CIC-IENT IN RCE TO CMT-CIC-IENT IN CMT.
           MOVE SPACES              TO CMT-FEC-FCMT IN CMT.
           MOVE ZEROES              TO CMT-NUM-ICMT IN CMT.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GNS-FIO-CMT.
           IF NOT ( FIO-STAT-OKS AND
                    RCE-CIC-IENT IN RCE = CMT-CIC-IENT IN CMT )
               GO TO FIN-BUS-WSS-GLS-MSG.
           MOVE CMT-GLS-REFE IN CMT TO WSS-GLS-CMNT IN WSS-CCP.

      *     MOVE CMT-GLS-REFE IN CMT TO WSS-GLS-REF1 IN WSS-CCP.
      *     MOVE CMT-GLS-FILL IN CMT TO WSS-GLS-REF2 IN WSS-CCP.
      *
      *     MOVE FIO-GET-NXT TO FIO-CMND.
      *     PERFORM GNS-FIO-CMT.
      *     IF NOT ( FIO-STAT-OKS AND
      *              RCE-CIC-IENT IN RCE = CMT-CIC-IENT IN CMT )
      *         GO TO FIN-BUS-WSS-GLS-MSG.
      *     MOVE CMT-GLS-CMTR IN CMT(1) TO WSS-GLS-OBS1 IN WSS-CCP.
      *     MOVE CMT-GLS-CMTR IN CMT(2) TO WSS-GLS-OBS2 IN WSS-CCP.
      *
      * HAY 2 LECTURAS + DEL REGISTRO CMT PARA COMPLETAR TODOS LOS COMENTARIOS
      * QUE EN LA PANTALLA CMT SE PUEDEN INGRESAR (SON 4 LECTURAS).
      *
       FIN-BUS-WSS-GLS-MSG.
           EXIT.
      **************************************************************************

       COPY GNSBFRCE.
       COPY GNSBFCMT.
       COPY TABBFUSR.
       COPY TABBFOFI.
       COPY SGCBFOPE.
       COPY SGCBFRCO.
       COPY SGCBFDBC.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY TABBBUSR.
       COPY TABBBOFI.
       COPY TABBVUSR.
       COPY TABBVOFI.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBGCPT.
      *>>>>
*% END
