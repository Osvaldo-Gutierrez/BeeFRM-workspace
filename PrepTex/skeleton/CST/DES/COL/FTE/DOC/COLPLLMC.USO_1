			LIBRO MAYOR OPERACIONES DE CREDITO			----------------------------------PROGRAMA     :  COLPLLMC lista reporte segun formato ( 132 columnas).ARCHIVO BASE :  OPC (Operacion Credito)          en DATACOM.		CAN (Cancelaciones)              en DATACOM.		CCT (Cambios Situacion Contable) en DATACOM.		CCB (Cambios Situacion Cobranza) en DATACOM.TABLAS       :  - Tablas y Parametros Bancarios.		  Extraccion de Direccion Oficina    en tabla OFI.		  Descripcion de la Oficina          en tabla OFI.		  Descripcion de la Moneda           en tabla VLR.		  Descripcion de la Cuenta Contable  en tabla PCC.		  Extraccion del Codigo de la Moneda mediante CIC de		  Pesos Chilenos '0999' en tabla VLR.		  Mediante Codigo de Monedas se extraen Valores de Cambios		  en tabla CAM.		- Colocaciones.		  Extraccion del Indicador de Participacion en Contabilidad		  en tabla AUX.		  Extraccion de la Cuenta Contable             en tabla DCC.		  Extraccion del Vector de Asientos Contables  en tabla CPP.PARAMETROS   :  - Fecha de Inicio  (DDMMSSAA) : Rango Inicial para Seleccion y						Emision Informe.		- Fecha de Termino (DDMMSSAA) : Rango Final   para Seleccion y						Emision Informe.ORDENAMIENTO :  - Oficina Contable, Moneda, Fecha Contable, Cuenta Contable,		  Indicador Debe Haber, Operacion.ALGORITMO    :  - Proceso :		Se valida que fechas de parametros, sean menores o igual a Hoy.		Se valida la consistencia en el rango de fechas del parametro.		Se obtiene el Codigo para Pesos mediante su CIC en VLR.		Se realiza apertura del archivo SAM de salida. 		Se realiza PROCESO OPC mientras Fecha Curse Contable de los		registros esten en el rango de las Fechas del Parametro y		Estado del Credito Activado.		Se realiza PROCESO CAN mientras Fecha Cancelacion Contable de		los registros esten en el rango de las Fechas del Parametro y		Estado de la Cancelacion Activada.		Se realiza PROCESO CCT mientras Fecha Cambio Situacion Contable		de los registros esten en el rango de las Fechas del Parametro		y Estado del Credito Activado.		Se realiza PROCESO CCB mientras Fecha Cambio Contable de los		registros esten en el rango de las Fechas del Parametro y		Estado del Credito Activado.		Los registros que cumplan las restricciones impuestas por los		parametros se ordenan para su proceso.		Se despliegan los contadores del Proceso Selectivo.		Para cada registro seleccionado se extraen las glosas, mediante		los codigos, en las tablas respectivas.		Con el CIC de la Operacion del registro seleccionado se obtiene		el CIC del Deudor Directo en RDC.		Con el CIC del Cliente en RDC se obtienen los Datos del Cliente		en DBC.		Las cantidades distintas a codigos de Cargo y/o Abono y los		montos de Debe y Haber se acumulan, y al producirse un cambio		en la Cuenta Contable, estos se imprimen en el listado de		detalle.		Los montos acumulados de Debe y Haber de cada Cuenta Contable,		se imprimen en el listado de resumen.		Los montos del Debe y Haber se acumulan, y al producirse un		cambio de la Fecha Contable, estos se imprimen en el listado		de resumen.		Se produce un corte en el listado de detalle con cambio de		pagina, cuando hay un cambio de Oficina, Moneda, Fecha Contable		o Cuenta Contable.		El Numero de Folio de la oficina se obtiene del correlativo en		la entidad CIC (datacom) de Genesis, el cual se incrementa cada		vez que hay un cambio de pagina.		Se produce un corte en el listado de resumen con cambio de		pagina, cuando hay un cambio de Oficina o Moneda.		Se produce renumeracion de la pagina en los listados de detalle		y de resumen cuando hay cambio de Oficina.		- Proceso OPC :		  Selecciona Operaciones con :		    Fecha de Curse Contable ( OPC-FEC-FING ) en el rango de las		    Fechas del Parametro.                    Estado del Credito Activado ( OPC-MSC-STAT ).		  Mover 'CUR' al Codigo de Movimiento ( CPP-COD-MVTO ).		  Mover Fecha Curse Contable a Fecha Contable en registro Sort.		  Mover Oficina de Operacion Credito a Oficina en registro Sort.		  Se incrementa contador de Registros OPC Leidos por cada		  registro OPC seleccionado.		  Con el CIC de la Operacion en OPC se obtienen los Documentos		  de Credito asociados a la operacion en DLC.		  La primera vez que se realice el siguiente proceso generico,		  se activara un indicador y se desactivara luego de realizado		  este proceso correctamente, permaneciendo asi durante los		  siguientes procesos a los documentos de la misma operacion.		  Proceso Generico de Formar y Generar un registro SRT con la		  informacion de los registros leidos :		    Se incrementa contador de Registros Procesados luego de la		    lectura satisfactoria del registro DLC correspondiente.		    Mediante Campos en OPC y DLC, se extrae Vector de Asientos		    Contables en CPP.		    Si la Moneda del Credito es Moneda Nacional, pero distinta		    de pesos, se obtiene el Valor de Cambio a la Fecha de		    Colocacion de la operacion en CAM.		    Se inicializa el Vector de Montos previo a su llenado.		    Se llena Vector de Montos en un Proceso Generico de Llenado,		    segun el Vector de Asientos Contables leido.		    La llave COD-CCTB de DCC, se forma con campos de OPC y DLC.		    Con el Codigo Clase Operacion Credito se obtiene Estado del		    Indicador de Participacion en Contabilidad en AUX, si este		    es 'S', al campo Codigo Auxiliar de llave COD-CCTB se mueve		    el Codigo Auxiliar Operacion, en caso contrario se mueven		    Espacios.		    Se forma y genera registro Sort en un Proceso Generico de		    Generacion, segun el Vector de Montos, el Vector de Asientos		    Contables, datos de la Operacion y Documento Legal leidos.		    Se incrementa contador de Registros Rechazados si se produce		    algun problema durante este Proceso Generico de Formar y		    Generar un registro SRT, excluyendo la Operacion.		- Proceso CAN :		  Selecciona Cancelaciones con :		    Fecha de Cancelacion Contable ( CAN-FEC-FEGR ) en el rango		    de las Fechas del Parametro.                    Estado de la Cancelacion Activada ( CAN-MSC-STAT ).		  Mover 'CAN' al Codigo de Movimiento ( CPP-COD-MVTO ).		  Mover Fecha Cancelacion Contable a Fecha Contable en registro		  Sort.		  Mover Oficina de Cancelacion a Oficina en Registro Sort.		  Se incrementa contador de Registros CAN Leidos por cada		  registro CAN seleccionado.		  Con la Identificacion de la Cancelacion en CAN se obtienen los		  Datos de los Vencimientos Asociados en RCV.		  Con el CIC de la Operacion de Credito en RCV se obtienen los		  Datos de la Operacion de Credito en OPC.		  Si la Oficina de Cancelacion es distinta a la Oficina de la		  Operacion Credito, se asocia esta ultima a la Oficina en el		  registro Sort.		  Con la Identificacion Documento Asociado en RCV se obtienen		  los Datos del Documento Legal de Credito en DLC.		  La primera vez que se realice el siguiente proceso generico,		  se activara un indicador y se desactivara luego de realizado		  este proceso correctamente, permaneciendo asi durante los		  siguientes procesos a los vencimientos asociados a la misma		  cancelacion.		  Proceso Generico de Formar y Generar un registro SRT con la		  informacion de los registros leidos :		    Se incrementa contador de Registros Procesados luego de la		    lectura satisfactoria de los registros RCV, OPC y DLC		    correspondientes.		    Mediante Campos en OPC, DLC y RCV se extrae el Vector de		    Asientos Contables en CPP.		    Si la Moneda del Credito es Moneda Nacional, pero distinta		    de pesos, se obtiene el Valor de Cambio a la Fecha de		    Colocacion y el Valor de Cambio a la Fecha de Cancelacion		    Real de la operacion en CAM.		    Se inicializa el Vector de Montos previo a su llenado.		    Se llena Vector de Montos en un Proceso Generico de Llenado,		    segun el Vector de Asientos Contables leido.		    La llave COD-CCTB de DCC, es formada por campos de OPC, DLC		    y RCV.		    Con el Codigo Clase Operacion Credito se obtiene Estado del		    Indicador de Participacion en Contabilidad en AUX, si este		    es 'S', al campo Codigo Auxiliar de llave COD-CCTB se mueve		    el Codigo Auxiliar Operacion, en caso contrario se mueven		    Espacios.		    Se forma y genera registro Sort en un Proceso Generico de		    Generacion, segun el Vector de Montos, el Vector de Asientos		    Contables, datos de la Cancelacion, de la Operacion y del		    Documento Legal leidos.		    Se incrementa contador de Registros Rechazados si se produce		    algun problema durante este Proceso Generico de Formar y		    Generar un registro SRT, excluyendo la Cancelacion.		- Proceso CCT :		  Selecciona Situacion Contable con :		    Fecha de Cambio Situacion Contable ( CCT-FEC-FCCT ) en el		    rango de las Fechas del Parametro.		  Mover 'TCT' al Codigo de Movimiento ( CPP-COD-MVTO ).		  Mover Fecha Cambio Situacion Contable a Fecha Contable en		  registro Sort.		  Se incrementa contador de Registros CCT Leidos por cada		  registro CCT seleccionado.		  Con el CIC de la Operacion de Credito de la Identificacion del		  Cambio Situacion Contable en CCT se obtienen los Datos de la		  Operacion de Credito en OPC.                  Si Operacion obtenida esta con Estado del Credito Activado se		  procesa y mueve Oficina de Operacion Credito a Oficina en		  Registro Sort.		  Con la Identificacion del Documento Legal en CCT se obtienen		  los Datos del Documento Legal de Credito en DLC.		  Con la Identificacion del Vencimiento en CCT se obtienen los		  Datos del Vencimiento en VEN.		  Se activa un indicador como si fuera la primera vez que se		  realiza el siguiente proceso generico.		  Proceso Generico de Formar y Generar un registro SRT con la		  informacion de los registros leidos :		    Se incrementa contador de Registros Procesados luego de la		    lectura satisfactoria de los registros OPC, DLC y VEN		    correspondientes.		    Mediante Campos en OPC, DLC y CCT se extrae el Vector de		    Asientos Contables en CPP.		    Si la Moneda del Credito es Moneda Nacional, pero distinta		    de pesos, se obtiene el Valor de Cambio a la Fecha de		    Colocacion y el Valor de Cambio a la Fecha de Vencimiento		    de la operacion en CAM.		    Se inicializa el Vector de Montos previo a su llenado.		    Se llena Vector de Montos en un Proceso Generico de Llenado,		    segun el Vector de Asientos Contables leido.		    La llave COD-CCTB de DCC, es formada por campos de OPC, DLC		    y CCT.		    Con el Codigo Clase Operacion Credito se obtiene Estado del		    Indicador de Participacion en Contabilidad en AUX, si este		    es 'S', al campo Codigo Auxiliar de llave COD-CCTB se mueve		    el Codigo Auxiliar Operacion, en caso contrario se mueven		    Espacios.		    Se forma y genera registro Sort en un Proceso Generico de		    Generacion, segun el Vector de Montos, el Vector de Asientos		    Contables, datos de la Situacion Contable, de la Operacion,		    del Documento Legal y del Vencimiento leidos.		    Se incrementa contador de Registros Rechazados si se produce		    algun problema durante este Proceso Generico de Formar y		    Generar un registro SRT, excluyendo el Cambio de Situacion		    Contable.		- Proceso CCB :		  Selecciona Situacion Cobranza con :		    Fecha de Cambio Contable ( CCB-FEC-FING ) en el rango de		    las Fechas del Parametro.		  Mover 'TCB' al Codigo de Movimiento ( CPP-COD-MVTO ).		  Mover Fecha Cambio Contable a Fecha Contable en registro Sort.		  Se incrementa contador de Registros CCB Leidos por cada		  registro CCB seleccionado.		  Con el CIC de la Operacion de Credito de la Identificacion del		  Cambio Situacion Cobranza en CCB se obtienen los Datos de la		  Operacion de Credito en OPC.                  Si Operacion obtenida esta con Estado del Credito Activado se		  procesa y mueve Oficina de Operacion Credito a Oficina en		  Registro Sort.		  Con la Identificacion del Documento Legal en CCB se obtienen		  los Datos del Documento Legal de Credito en DLC.		  Con la Identificacion del Vencimiento en CCB se obtienen los		  Datos del Vencimiento en VEN.		  Se activa un indicador como si fuera la primera vez que se		  realiza el siguiente proceso generico.		  Proceso Generico de Formar y Generar un registro SRT con la		  informacion de los registros leidos :		    Se incrementa contador de Registros Procesados luego de la		    lectura satisfactoria de los registros OPC, DLC y VEN		    correspondientes.		    Mediante Campos en OPC y DLC se extrae Vector de Asientos		    Contables en CPP.		    Si la Moneda del Credito es Moneda Nacional, pero distinta		    de pesos, se obtiene el Valor de Cambio a la Fecha de		    Colocacion y el Valor de Cambio a la Fecha de Vencimiento		    de la operacion en CAM.		    Se inicializa el Vector de Montos previo a su llenado.		    Se llena Vector de Montos en un Proceso Generico de Llenado,		    segun el Vector de Asientos Contables leido.		    La llave COD-CCTB de DCC, es formada por campos de OPC, DLC		    y CCB.		    Con el Codigo Clase Operacion Credito se obtiene Estado del		    Indicador de Participacion en Contabilidad en AUX, si este		    es 'S', al campo Codigo Auxiliar de llave COD-CCTB se mueve		    el Codigo Auxiliar Operacion, en caso contrario se mueven		    Espacios.		    Se forma y genera registro Sort en un Proceso Generico de		    Generacion, segun el Vector de Montos, el Vector de Asientos		    Contables, datos de la Situacion Cobranza, de la Operacion,		    del Documento Legal y del Vencimiento leidos.		    Se incrementa contador de Registros Rechazados si se produce		    algun problema durante este Proceso Generico de Formar y		    Generar un registro SRT, excluyendo el Cambio de Situacion		    Cobranza.		- Proceso Generico para Llenar Vector de Montos :		  Se procesan aquellas ocurrencias que en el Vector de Asientos		  Contables tengan informacion.		  Se llena el Vector de Montos de acuerdo al Indicador del Tipo		  de Algoritmo, de cada uno de los Asientos Contables de la		  Tabla de Contabilizacion Parametrica por Productos ( CPP ).		  Cuando la Moneda del Credito es Moneda Nacional pero no esta		  expresado en pesos, y el monto del campo no esta en pesos, se		  convierte a pesos dicho monto.		  Para calcular el Monto del Capital Pagado se recurre a una		  Rutina Generica de Calculo.		  Para calcular el Monto del Interes Pagado se recurre a una		  Rutina Generica de Calculo.		  Para calcular el Monto del Reajuste Pagado se recurre a una		  Rutina Generica de Calculo.		  Segun el Tipo de Algoritmo y el Codigo de Movimiento, se mueve		  el monto del campo del registro que corresponda o el valor		  determinado mediante alguna rutina generica de calculo al		  Vector de Montos.		- Proceso Generico para Calcular Monto Capital Pagado :		  Cuando se trata de una Cancelacion, el Capital se obtiene del		  Valor Capital Cancelado.		  Cuando se trata de un Traspaso, el Capital se obtiene del		  Saldo Valor Capital Vencimiento.		  Para Credito en Moneda Nacional pero distinto de Pesos, el 		  Capital, se expresa en Pesos a la fecha de la Colocacion.		- Proceso Generico para Calcular Monto Interes Pagado :		  Cuando se trata de un Traspaso, el Interes Devengado se		  obtiene como la diferencia entre el Saldo Valor Final		  Vencimiento y el Saldo Valor Capital Vencimiento.		  Para Credito en Moneda Nacional pero distinto de Pesos, los 		  Intereses Devengados, se expresan en Pesos a la fecha del		  Vencimiento.		  Cuando se trata de una Cancelacion, el Interes Devengado se		  obtiene como la diferencia entre el Valor Final Cancelado y		  el Valor Capital Cancelado.		  Cuando se trata de una Cancelacion, el Interes de Mora se		  obtiene como la diferencia entre el Valor Total Pagado y el		  Valor Final Cancelado.		  Para una Cancelacion, ambos Intereses calculados se acumulan.		  Para Credito en Moneda Nacional pero distinto de Pesos, los 		  Intereses Devengados y los de Mora, se expresan en Pesos a		  la fecha de la Cancelacion Real.		  Cuando se trata de una Cancelacion, el Valor Diferencia de		  una Cancelacion se resta del Total de Intereses Calculados.		- Proceso Generico para Calcular Monto Reajuste Pagado :		  Cuando se trata de una Cancelacion, el Reajuste Devengado se 		  obtiene del Valor Reajustes Cancelados.		  Cuando se trata de un Traspaso, el Reajuste Devengado se		  obtiene de la diferencia entre los Valores de Cambio de la		  moneda en Pesos a las Fechas de Vencimiento y Colocacion por		  el Saldo Valor Capital del Vencimiento.		- Proceso Generico para Generacion registros :		  Se procesan las ocurrencias que en el Vector de Montos tengan		  Informacion.		  Se mueve la ocurrencia del Identificador Tipo Cuenta Contable		  del Vector de Asientos Contables en CPP al Identificador Tipo		  Cuenta Contable en la llave COD-CCTB en DCC.		  Cuando se trata de un Traspaso, si el Indicador Debe o Haber		  del Vector de Asientos Contables en CPP es Haber, se mueve el		  indicador de la Situacion Anterior del Traspaso al indicador		  de la Situacion Correspondiente en la llave COD-CCTB en DCC,		  en caso contrario se mueve el indicador de la Situacion del		  Traspaso.		  Mediante la llave COD-CCTB formada previamente se obtiene la		  Cuenta Contable en DCC que se mueve al registro SRT.		  Cuando se trata de una Cancelacion y el Valor Total Pagado		  es menor que Cero, se mueve el valor inverso del Indicador		  de Debe o Haber del Vector de Asientos Contables en CPP,		  en caso contrario se mueve el indicador correspondiente al		  registro SRT.		  Se mueve el Monto de la ocurrencia en el Vector de Montos al		  Debe o Haber, segun el Indicador de Debe o Haber del Vector		  de Asientos Contables en CPP al registro SRT.		  Se mueve el Numero de Identificacion del Vencimiento si		  existe al registro SRT.		  Se completan los demas campos del registro SRT (Sort), con		  la informacion procedente de OPC y DLC leidos.		  Para los impuestos en moneda nacional la moneda es pesos,		  para otro tipo de moneda es dicha moneda.		  Se genera un registro SRT, por cada ocurrencia procesada		  correctamente.		  Por cada registro procesado correctamente, se llenan los		  campos y se graba un registro en el archivo MCT tipo SAM,		  segun documento adjunto (registro).		  Se incrementa contador de Registros MCT Grabados si grabacion		  de MCT es exitosa, en caso contrario se incrementa contador		  de Registros No Grabados.      *    Movimientos Contabilidad      *    ------------------------      *    Nombre Registro : MCT      *    Largo           : 080      *    Bloqueo         : 12 ( Bloque = 960 )      *       01  MCT.       *      *    ( 1 = DEBE, 2 = HABER )      *    Tipo Documento           03  MCT-IND-TDOC                             PIC X(01).      *      *    ( OPC-COD-OFOC o CAN-COD-OFCA )      *    Oficina           03  MCT-COD-OFIC                             PIC X(03).      *      *    ( DCC-GLS-CCSB )      *    Cuenta Contable           03  MCT-GLS-ICTA                             PIC X(09).      *      *    ( 00 MCH )      *    Codigo Moneda           03  MCT-COD-MONE                             PIC X(02).      *      *    ( SPACES )      *    Filler           03  MCT-GLS-FILL                             PIC X(01).      *      *    ( DLC-VAL-NDLC o RCV-SGV-CAPI )      *    Valor Movimiento           03  MCT-VAL-MOVI                             PIC 9(13)V9(02).      *      *    ( SPACES )      *    Identificacion Documento           03  MCT-GLS-IDOC                             PIC X(06).      *      *    ( SPACES )      *    Glosa Movimiento           03  MCT-GLS-MOVI                             PIC X(30).      *      *    ( SPACES )      *    Glosa Disponible           03  MCT-GLS-DISP                             PIC X(13).