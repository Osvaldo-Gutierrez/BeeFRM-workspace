			GENERADOR CARGA BATCH REGISTRO D00			----------------------------------PROGRAMA     :  COLPGD00 generador Batch de Archivo D00 tipo VSAM.		D00 (Circular 5), es generado desde la base de Colocaciones		mediante este programa de carga, segun explicacion adjunta.ARCHIVO BASE :  OPC (Operaciones de Credito) en DATACOM.TABLAS       :  - Tablas y Parametros Bancarios.		  Extraccion mediante el CIC '0999' del Codigo de la Moneda		  Pesos Chilenos en tabla VLR.		  Mediante Codigo de Monedas se extraen Valores de Cambios		  en tabla CAM.		  Mediante Codigo Tipo Operacion se extrae Codigo Sistema		  que lo Maneja en tabla TIO.		  Mediante Codigo de Moneda se extrae Codigo Externo		  en tabla VLR.		- Colocaciones.		  Mediante Codigo Tipo Operacion se obtiene 'Opera Como'		  en tabla TOC.		  Mediante Codigo Clase Operacion Credito se obtiene Estado del		  Indicador de Participacion en Contabilidad en tabla AUX.		  Extraccion de la Cuenta Contable en tabla DCC.		  Mediante Codigo Clase Operacion se extrae el Indicador		  para la Exclusion de la posicion 46 de los Datos Adicionales		  en tabla AUX.		  Mediante Codigo Destino Operacion se extrae Codigo Externo		  en tabla DES.		  Mediante Codigo Tipo Tasa Interes se extrae Codigo Externo		  en tabla INT.		  Mediante Codigo Clase Operacion se extrae Codigo Externo		  en tabla AUX.		  Mediante Indicador de Situacion Cartera se extrae Codigo		  Externo con codigo miscelaneo 'SCRT' en tabla MSC.		  Mediante Indicador de Situacion Contable se extrae Codigo		  Externo con codigo miscelaneo 'SCTB' en tabla MSC.PARAMETROS   :  - Fecha de Proceso (DDMMSSAA) : Fecha Proceso de Generacion						del Archivo.ALGORITMO    :  - Proceso :		  Se captura parametro para procesar programa.		  Se valida que fecha del parametro, sea menor o igual a Hoy.		  Se obtiene el Codigo para Pesos mediante su CIC en VLR.		  Selecciona Operaciones con :		    Fecha de Colocacion ( OPC-FEC-FCOL ) menor o igual a		    la Fecha del Parametro.		    Estado del Credito Activado ( OPC-MSC-STAT ) = 'A'.		    Codigo Sistema que lo Maneja ( TIO-GLS-SIST ) = 'COL'.		  Por cada registro OPC seleccionado se incrementa un contador.		  Con el Codigo Tipo Operacion ( OPC-COD-TOOC ) se obtiene el		  Indicador Opera Como en TOC.		  Si la Moneda del Credito es distinta de pesos, se obtiene el		  Valor de Cambio a pesos a la Fecha de Colocacion.		  Si la Moneda del Credito es distinta de pesos, se convierte		  a pesos con el Valor de Cambio a la Fecha de Colocacion,		  el Monto Credito y el Saldo Valor Credito.		  Si la Moneda del Credito es distinta de pesos, se obtiene el		  Valor de Cambio a pesos a la Fecha de Proceso.		  Se inicializa tabla de Deudores previo a su llenado.		  Se llena la tabla de Deudores en un Proceso Generico de		  llenado, primero con los Directos y luego los Indirectos,		  buscando a su vez la Clasificacion de Riesgo del primer		  Deudor Directo.		  Proceso para Deudores de la Operacion :		    Con el CIC de la Operacion del registro seleccionado se		    obtiene el CIC del Deudor en RDC.		    Con el CIC del Deudor en RDC se obtiene el RUT del Deudor		    en DBC.		    Se indica el Tipo de Deudor, ya sea Directo o Indirecto.		    Para el primer Deudor Directo se obtiene la Clasificacion		    de Riesgo (ultima).		    Si la Moneda del Credito es distinta de pesos, se obtiene		    el Valor de Cambio a pesos a la Fecha de Clasificacion.		    Por cada registro RDC leido se incrementa un contador.		  Con el CIC de la Operacion en OPC y el correlativo # 4 se		  obtiene el Documento de Credito Nro. 4 en DLC asociado a la		  operacion, el cual contiene el Saldo Reprogramado para un		  Credito Hipotecario.		  Si la Moneda del Credito es distinta de pesos, se convierte		  a pesos con el Valor de Cambio a la Fecha de Proceso,		  el Valor Saldo Documento Legal.		  Se procesan los Documentos de la Operacion mediante un		  Proceso Generico y por cada documento correctamente procesado		  se obtiene la informacion necesaria para llenar los campos y		  generar un registro D00.		  Proceso para Documentos Legales Credito :		    Con el CIC de la Operacion en OPC se obtiene el Documento		    de Credito asociado a la operacion en DLC.		    Por cada registro DLC leido se incrementa un contador.		    Se inicializan variables para proceso de los Documentos.		    Si la Moneda del Credito es Moneda Extranjera, se convierte		    a pesos con el Valor de Cambio a la Fecha de Proceso,		    el Valor Intereses Devengados Documento Legal y el Valor		    Reajustes Devengados Documento Legal.		    Se busca el ultimo interes pagado y la fecha de este pago		    en el mes de proceso		    Se busca informacion del registro DCC necesaria para llenar		    campos del D00.		    Por cada registro DCC procesado se incrementa un contador.		    Se busca Ultima informacion Vigente sobre intereses de la		    operacion en registro ICG a la fecha de Proceso, segun		    indicador 'Opera Como', para llenar campos del D00.		    Por cada registro ICG procesado se incrementa un contador.		    Se Convierte la Tasa de Interes a Base Mensual o Anual		    segun el Tipo de Moneda Nacional.		    Se inicializan variables para proceso de los Vencimientos.		    Se procesan los Vencimientos de la Operacion mediante un		    Proceso Generico y por cada vencimiento correctamente		    procesado se obtiene la informacion necesaria para llenar		    los campos del registro D00.		    Proceso para Vencimientos :		      Con el CIC de la Operacion en OPC se obtiene el		      Vencimiento asociado a la operacion en VEN.		      Por cada registro VEN leido se incrementa un contador.		      Si la Moneda del Credito es distinta de pesos, se obtiene		      el Valor de Cambio a pesos a la Fecha del Vencimiento.		      Si la Moneda del Credito es distinta de pesos, se		      convierte a pesos con el Valor de Cambio a la Fecha del		      Vencimiento, el Valor Capital Vencimiento, el Saldo Valor		      Capital Vencimiento, el Valor Final Vencimiento, el Saldo		      Valor Final Vencimiento y los Intereses Devengados no		      incluidos en valor final vencimiento.		      Se determina morosidad de vencimientos y el numero de		      vencimientos impagos.		      Se determina saldo en cartera vencida.		      Se efectua el calculo preliminar para determinar el		      Promedio Ponderado Residual.		      Se determina numero de vencimientos de amortizacion por		      vencer.		      Se determina monto vencimientos del mes.		      Se determina intereses por cobrar vencidos, intereses por		      cobrar riesgosos y reajustes devengados riesgosos.		      Se determina monto pagado y/o renovado en el mes.		      Se guarda la fecha y el valor de cambio del vencimiento		      anteriormente leido.		    Se obtienen los Interes por Cobrar.		    Se obtienen los Reajustes Devengados.		    Se completa el calculo del Promedio Ponderado Residual.		    Se llenan los campos del registro D00 con la informacion		    obtenida y se graba un registro nuevo del Archivo D00.		    Por cada registro D00 Grabado se incrementa un contador,		    en caso contrario se incrementa un contador de registros		    No Grabados.      * Registro D00      * ------------      * Nombre       : D00      * Clave        : D00-COD-ID00      * Largo        : 360      *      * -------------------------------------------------------------      *       01  D00.01.-  *    Llave del registro           03 D00-COD-ID00.      *      *       Se obtiene de primera letra de OPC-CAI-IOPC      *       OPC-COD-TOPC02.-  *       Codigo de Sistema              05 D00-COD-SIST                      PIC X(02).      *      *       ( OPC-CIC-IOPC + SPACES )03.-  *       Numero Interno Identificador              05 D00-COD-NIID                      PIC X(21).      *      *    OPC-COD-TOOC04.-  *    Tipo de operacion           03 D00-COD-TOPE                         PIC X(03).      *      *    EXT(DLC-IND-SCRT)05.-  *    Situacion de la operacion           03 D00-IND-SOPE                         PIC X(01).      *      *    OPC-COD-OFOC06.-  *    Oficina otorgante del credito           03 D00-COD-OFIC                         PIC X(05).      *      *    DCC-EXT-CTAB Tipo Operacion segun Super de DCC07.-  *    Tipo Credito Cartera Origen           03 D00-COD-TCCO                         PIC X(04).      *      *    EXT(DLC-IND-SCTB)08.-  *    Estado del credito           03 D00-IND-ESTC                         PIC X(01).      *      *    EXT(OPC-COD-CDOC)09.-  *    Actividad destino del credito           03 D00-COD-ACTD                         PIC X(02).      *      *    OPC-FEC-FCOL10.-  *    Fecha Otorgamiento           03 D00-AMD-FOTO.               05 D00-NUM-AOTO                     PIC 9(02).               05 D00-NUM-MOTO                     PIC 9(02).               05 D00-NUM-DOTO                     PIC 9(02).      *      *    EXT(OPC-COD-VCOC)11.-  *    Codigo de moneda y/o reajustabilidad           03 D00-COD-MONE                         PIC X(03).      *      *    OPC-VAL-CRED12.-  *    Monto Original Operacion           03 D00-VAL-MOOP                         PIC 9(13) COMP-3..      *      *    OPC-VAL-SCRE13.-  *    Saldo Contable           03 D00-VAL-SCON                         PIC 9(13) COMP-3.      *      *    SUM(VEN-VAL-CAPI), morosidad <= 3014.-  *    Saldo Moroso 1           03 D00-VAL-SMO1                         PIC 9(13) COMP-3.      *      *    SUM(VEN-VAL-CAPI), morosidad > 3015.-  *    Saldo Moroso 2           03 D00-VAL-SMO2                         PIC 9(13) COMP-3.      *      *    SUM(VEN-VAL-CAPI),VEN-IND-SCTB='VCD'16.-  *    Saldo Cartera Vencida           03 D00-VAL-SCVC                         PIC 9(13) COMP-3.      *      *    DLC #4 Para Hipotecario17.-  *    Saldo Reprogramado solo para C.Hip.           03 D00-VAL-SREP                         PIC 9(13) COMP-3.      *      *    '0'18.-  *    Tipo de garantia           03 D00-COD-TGAR                         PIC X(01).      *      *    VEN-FEC-FVEN19.-  *    Fecha Proximo Vencimiento           03 D00-AMD-FPVC.               05 D00-NUM-APVC                     PIC 9(02).               05 D00-NUM-MPVC                     PIC 9(02).               05 D00-NUM-DPVC                     PIC 9(02).      *      *    CAN-FEC-FCAN(MES) Ultimo20.-  *    Fecha Ultimo Pago de Intereses           03 D00-AMD-FUPI.               05 D00-NUM-AUPI                     PIC 9(02).               05 D00-NUM-MUPI                     PIC 9(02).               05 D00-NUM-DUPI                     PIC 9(02).      *      *    DLC-FEC-FMAV21.-  *    Fecha de Extincion           03 D00-AMD-FEXT.               05 D00-NUM-AEXT                     PIC 9(02).               05 D00-NUM-MEXT                     PIC 9(02).               05 D00-NUM-DEXT                     PIC 9(02).      *      *    SUM(VEN-VAL-SCAP * DIF(FPRO,VEN-FEC-FVEN > FPRO)) / SUM(VEN-VAL-SCAP)22.-  *    Plazo Promedio Ponderado Residual           03 D00-NUM-PPPR                         PIC 9(04).      *      *    SUM(VEN),VEN-VAL-CAPI > 0,VEN-VAL-SFIN > 0,VEN-FEC-FIMV > FPRO23.-  *    Numero de cuotas amortiz. por vencer           03 D00-NUM-CAPV                         PIC 9(03).      *      *    EXT(ICG-COD-TINT)24.-  *    Base Calculo de Tasa de Interes           03 D00-IND-BCTI                         PIC X(03).      *      *    ICG-SGV-TINT( Equivalente en Base 30 dias o Anual )25.-  *    Tasa de Interes           03 D00-VAL-TINT                         PIC 9(03)V9(04).      *      *    DIF(DLC-VAL-INTD,Interes de Riesgo)26.-  *    Intereses por cobrar           03 D00-VAL-IPCO                         PIC 9(13) COMP-3.      *      *    VEN-VAL-SFIN,VEN-IND-SCTB = 'VCD',VEN-VAL-SCAP = 027.-  *    Intereses por cobrar vencidos           03 D00-VAL-IPCV                         PIC 9(13) COMP-3.      *      *    DIF(VEN-VAL-SFIN,VEN-VAL-SCAP),CRI-IND-CRSS(Ultimo)28.-  *    Intereses por cobrar riesgosos           03 D00-VAL-IPCR                         PIC 9(13) COMP-3.      *      *    DIF(DLC-VAL-READ,Reajustes de Riesgo)29.-  *    Reajustes Devengados           03 D00-VAL-RDEV                         PIC 9(13) COMP-3.      *      *    DIF(Valor de cambio de periodos) * VEN-VAL-SCAP,CRI-IND-CRSS(Ultimo)30.-  *    Reajustes Devengados riesgosos           03 D00-VAL-RDER                         PIC 9(13) COMP-3.      *      *    EXT(OPC-COD-COOC)31.-  *    Tipo de Credito           03 D00-IND-TCRE                         PIC X(02).      *      *    SUM(VEN), Morosos32.-  *    Numero de Vencimientos Impagos           03 D00-NUM-VCIM                         PIC 9(02).      *      *    (RCV-SGV-FINA + RCV-SGV-INTE),VEN-FEC-FVEN(MES)33.-  *    Monto Pagado en el Mes           03 D00-VAL-PMES                         PIC 9(13) COMP-3.      *      *    SUM(VEN-VAL-FINA),VEN-FEC-FVEN(MES)34.-  *    Vencimientos del Mes           03 D00-VAL-VMES                         PIC 9(13) COMP-3.      *      *    ROV-SGV-RENO,VEN-FEC-FVEN(MES),VEN-VAL-SFIN = 035.-  *    Monto Renovado en el mes           03 D00-VAL-RMES                         PIC 9(13) COMP-3.      *      *    DIF(RCV-SGV-FINA,RCV-SGV-CAPI) + RCV-SGV-INTE,CAN-FEC-FCAN(MES)Ultimo36.-  *    Ultimo interes pagado           03 D00-VAL-UINP                         PIC 9(13) COMP-3.      *      *    DCC-GLS-CCSB37.-  *    Cuenta contable           03 D00-COD-CCTB                         PIC X(10).      *      *    OPC-NUM-VCOR38.-  *    Numero de cuotas originales           03 D00-NUM-CORI                         PIC 9(03).      *      *    'S'39.-  *    Indicador si operacion esta afecta a      *    margenes Art. 84 L.G.B.           03 D00-IND-ALGB                         PIC X(01).      *      *    Fecha Parametro40.-  *    Informacion Referida a esta fecha de cierre           03 D00-AMD-FCIE.               05 D00-NUM-ACIE                     PIC 9(02).               05 D00-NUM-MCIE                     PIC 9(02).               05 D00-NUM-DCIE                     PIC 9(02).      *      *    Fecha Parametro41.-  *    Fecha Creacion del Registro           03 D00-AMD-FCRG.               05 D00-NUM-ACRG                     PIC 9(02).               05 D00-NUM-MCRG                     PIC 9(02).               05 D00-NUM-DCRG                     PIC 9(02).      *      *    SPACES42.-  *    Autor creacion del registro           03 D00-COD-ACRG                         PIC X(12).      *      *    SPACES43.-  *    Autor Ultima Modificacion del registro           03 D00-COD-AUMO                         PIC X(12).      *      *    ZEROES44.-  *    Fecha Ultima Modificacion del registro           03 D00-AMD-FUMO.               05 D00-NUM-AUMO                     PIC 9(02).               05 D00-NUM-MUMO                     PIC 9(02).               05 D00-NUM-DUMO                     PIC 9(02).      *      *    OPC-COD-COOC (Marca en Pos. 46 Datos Adic. tabla AUX)45.-  *    Indicador Exclusion Operacion           03 D00-IND-EXCL                         PIC X(01).      *      *    SPACES46.-  *    Disponible           03 D00-GLS-DISP                         PIC X(12).      *47.-  *    Arreglo con R.U.T. de deudores directos e indirectos.           03 D00-VEC-RUTD OCCURS 9.      *       DBC-NUM-ICLI48.-  *       Rol Unico Tribut.              05 D00-COD-RUTD                      PIC X(09).              05 D00-NUM-RUTD REDEFINES D00-COD-RUTD                                                   PIC X(09).      *       DBC-VRF-ICLI49.-  *       Digito Verificador              05 D00-VRF-RUTD                      PIC X(01).      *      *       RDC-COD-TRDC50.-  *       Indicador deudor directo/indirecto              05 D00-IND-TDEU                      PIC X(01).      * ------------------------------------------------------------------------      *      *  NOTAS :      *      *      *  - EXT : Por Codigo Externo del campo (xxx-xxx-xxxx)      *                  en la Tabla (yyy) o Miscelaneo (yyyy) segun corresponda      *                  del Sistema (zzz).      *      *  - SUM : De la Sumatoria del campo (xxx-xxx-xxxx) o del registro (yyy).      *      *  - DIF : De la Diferencia entre los campos (xxx-xxx-xxxx,yyy-yyy-yyyy).      *      * ------------------------------------------------------------------------      *      * Registro D00      *01.-  *    La Llave del registro se conforma con los campos  02. y 03.      *02.-  *      El Codigo de Sistema se obtiene de primera letra de OPC-CAI-IOPC      *      ( OPC-COD-TOPC )      *03.-  *      El Numero Interno Identificador se obtiene de la union de campos      *      ( OPC-CIC-IOPC + SPACES )      *04.-  *    El Tipo de operacion se obtiene del campo      *    ( OPC-COD-TOOC ) Codigo Tipo Operacion Credito      *05.-  *    Situacion de la operacion se obtiene de      *    EXT(DLC-IND-SCRT) SCRT COL      *06.-  *    Oficina otorgante del credito se obtiene del campo      *    ( OPC-COD-OFOC )      *07.-  *    Tipo Credito Cartera Origen se obtiene del campo      *    ( DCC-EXT-CTAB ) Tipo Operacion segun Super      *08.-  *    Estado del credito se obtiene de      *    EXT(DLC-IND-SCTB) SCTB COL      *09.-  *    Actividad destino del credito se obtiene de      *    EXT(OPC-COD-CDOC) DES COL      *10.-  *    Fecha Otorgamiento se obtiene del campo      *    ( OPC-FEC-FCOL )      *11.-  *    Codigo de moneda y/o reajustabilidad se obtiene de      *    EXT(OPC-COD-VCOC) VLR TAB      *12.-  *    Monto Original Operacion se obtiene del campo      *    ( OPC-VAL-CRED )      *13.-  *    Saldo Contable se obtiene del campo      *    ( OPC-VAL-SCRE )      *14.-  *    Saldo Moroso 1 se obtiene de      *    SUM(VEN-VAL-CAPI), con morosidad <= 30      *15.-  *    Saldo Moroso 2 se obtiene de      *    SUM(VEN-VAL-CAPI), con morosidad > 30      *16.-  *    Saldo Cartera Vencida se obtiene de      *    SUM(VEN-VAL-CAPI), con VEN-IND-SCTB='VCD'      *17.-  *    Saldo Reprogramado solo para C.Hip. se obtiene del campo      *    ( DLC-VAL-SDLC ) del Registro DLC #4      *18.-  *    Tipo de garantia se obtiene de mover      *    ( '0' )      *19.-  *    Fecha Proximo Vencimiento se obtiene del campo      *    ( VEN-FEC-FVEN )      *20.-  *    Fecha Ultimo Pago de Intereses se obtiene del campo      *    ( CAN-FEC-FCAN ), la Ultima del MES de Proceso      *21.-  *    Fecha de Extincion se obtiene del campo      *    ( DLC-FEC-FMAV )      *22.-  *    Plazo Promedio Ponderado Residual se obtiene de      *    SUM(DIF(F.Proceso,VEN-FEC-FVEN) * VEN-VAL-SCAP ) / SUM(VEN-VAL-SCAP)      *23.-  *    Numero de cuotas amortiz. por vencer se obtiene de      *    SUM(VEN), con VEN-VAL-CAPI > 0, VEN-VAL-SFIN > 0 y      *       VEN-FEC-FIMV > F.Proceso      *24.-  *    Base Calculo de Tasa de Interes se obtiene de      *    EXT(ICG-COD-TINT) INT COL      *25.-  *    Tasa de Interes se obtiene del campo      *    ( ICG-SGV-TINT ) pero Equivalente en Base 30 dias o Anual      *26.-  *    Intereses por cobrar se obtiene de      *    DIF(DLC-VAL-INTD,Intereses Cobrar Riesgosos)      *27.-  *    Intereses por cobrar vencidos se obtiene del campo      *    ( VEN-VAL-SFIN ), con VEN-IND-SCTB = 'VCD' y VEN-VAL-SCAP = 0      *28.-  *    Intereses por cobrar riesgosos se obtiene de      *    DIF(VEN-VAL-SFIN,VEN-VAL-SCAP), con CRI-IND-CRSS(Ultimo)=C o D      *29.-  *    Reajustes Devengados se obtiene de      *    DIF(DLC-VAL-READ,Reajustes Devengados Riesgosos)      *30.-  *    Reajustes Devengados riesgosos se obtiene de      *    DIF(Valor de cambio del periodo) * VEN-VAL-SCAP, con      *       CRI-IND-CRSS(Ultimo)=C o D      *31.-  *    Tipo de Credito se obtiene de      *    EXT(OPC-COD-COOC) AUX COL      *32.-  *    Numero de Vencimientos Impagos se obtiene de      *    SUM(VEN), Morosos      *33.-  *    Monto Pagado en el Mes se obtiene de los campos      *    ( RCV-SGV-FINA + RCV-SGV-INTE ), con VEN-FEC-FVEN(MES)      *34.-  *    Vencimientos del Mes se obtiene de      *    SUM(VEN-VAL-FINA), con VEN-FEC-FVEN(MES)      *35.-  *    Monto Renovado en el mes se obtiene del campo      *    ( ROV-SGV-RENO ), con VEN-FEC-FVEN(MES) y VEN-VAL-SFIN = 0      *36.-  *    Ultimo interes pagado se obtiene de      *    DIF(RCV-SGV-FINA,RCV-SGV-CAPI) + RCV-SGV-INTE), para Ultimo      *       CAN-FEC-FCAN(MES)      *37.-  *    Cuenta contable se obtiene del campo      *    ( DCC-GLS-CCSB )      *38.-  *    Numero de cuotas originales se obtiene del campo      *    ( OPC-NUM-VCOR )      *39.-  *    Indicador si operacion esta afecta a margenes Art. 84 L.G.B. se      *    obtiene de mover      *    ( 'S' )      *40.-  *    Informacion Referida a esta fecha de cierre se obtiene del parametro      *    ( Fecha Proceso )      *41.-  *    Fecha Creacion del Registro se obtiene del parametro      *    ( Fecha Proceso )      *42.-  *    Autor creacion del registro se obtiene de mover      *    ( SPACES )      *43.-  *    Autor Ultima Modificacion del registro se obtiene de mover      *    ( SPACES )      *44.-  *    Fecha Ultima Modificacion del registro se obtiene de mover      *    ( ZEROES )      *45.-  *    Indicador Exclusion Operacion se obtiene de      *    (OPC-COD-COOC) AUX COL, con Marca 'X' en Pos. 46 Datos Adic.      *46.-  *    Disponible se obtiene de mover      *    ( SPACES )      *47.-  *    Arreglo con R.U.T. de deudores directos e indirectos.      *    se conforma de campos  47. , 48. y 49.      *48.-  *      Rol Unico Tribut. se obtiene del campo      *      ( DBC-NUM-ICLI )      *49.-  *      Digito Verificador se obtiene del campo      *      ( DBC-VRF-ICLI )      *50.-  *      Indicador deudor directo/indirecto se obtiene de mover      *      'D' si es deudor Directo  o  'I' si es deudor Indirecto      *      * ------------------------------------------------------------------------