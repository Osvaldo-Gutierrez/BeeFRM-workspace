      *Recibe MVO-FPRO, MVO-ORIG = 'O','C' ( registro OPC, registro CAN )
       COL-GEN-MVO SECTION.
       INI-COL-GEN-MVO.
      * Limpia registro MVO
           MOVE SPACES TO MVO  MVO-CMSG IN MVO-VARI
                               MVO-MENS IN MVO-VARI
      *DAD ini  16-FEB-1993   (Memo.27-01-93)
                               MVO-OPEC IN MVO-VARI.
      *DAD fin  16-FEB-1993
      * Llena registro MVO
           MOVE MVO-FPRO IN MVO-VARI     TO MVO-FEC-FIMV IN MVO.
           MOVE 'COL '                   TO MVO-COD-TORG IN MVO.

           MOVE 'CCT'                TO FIO-SIST.
           MOVE '010'                TO TAB-COD-TTAB IN TAB.
           MOVE 'COL '               TO MVO-PFJO.
           MOVE MVO-CTAB IN MVO-VARI TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY-UPD      TO FIO-CMND.
      *JSS PERFORM GNS-FIO-TAB.
           PERFORM COL-ACC-TCT.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DATA IN TAB  TO MVO-AUXI     IN MVO-VARI
               MOVE MVO-CORR IN MVO-VARI TO MVO-NUM-CORG IN MVO
               ADD 1                     TO MVO-CORR     IN MVO-VARI
               MOVE MVO-AUXI IN MVO-VARI TO TAB-GLS-DATA IN TAB
               MOVE FIO-MOD TO FIO-CMND
           ELSE
               MOVE 1                    TO MVO-NUM-CORG IN MVO
               MOVE 2                    TO MVO-CORR     IN MVO-VARI
               MOVE MVO-AUXI IN MVO-VARI TO TAB-GLS-DATA IN TAB
               MOVE FIO-PUT TO FIO-CMND.

      *JSS PERFORM GNS-FIO-TAB.
           PERFORM COL-ACC-TCT.
           IF NOT FIO-STAT-OKS
               MOVE 'TABCCT NOACT'      TO MVO-CMSG IN MVO-VARI
               MOVE TAB-COD-TABL IN TAB TO MVO-MEN2 IN MVO-VARI
               GO TO FIN-COL-GEN-MVO.

      * Busca nro. de operacion ( considera novacion prorroga o renovacion )
           IF MVO-ORIG IN MVO-VARI = 'O'
               MOVE '000' TO MVO-COD-TAUT IN MVO
               IF OPC-IND-RENO IN OPC NOT = 'NOV'
                   MOVE OPC-CIC-IOPC IN OPC TO MVO-CIC-NUOP IN MVO
                   MOVE SPACES              TO MVO-GLS-TAB1 IN MVO
               ELSE
                   MOVE OPC-CIC-IOPC IN OPC TO ROV-CIC-IOPC IN ROV
                   MOVE SPACES              TO ROV-KEY-IVCT IN ROV
                   MOVE FIO-GET-NLS         TO FIO-CMND
                   PERFORM COL-FIO-ROV
                   IF FIO-STAT-OKS AND
                      ROV-CIC-IOPC IN ROV = OPC-CIC-IOPC IN OPC
                       MOVE ROV-CIC-IOPV IN ROV TO MVO-CIC-NUOP IN MVO
                       MOVE ROV-CIC-IOPC IN ROV TO MVO-GLS-TAB1 IN MVO
                   ELSE
                       MOVE 'ROVIOPCNEX' TO MVO-CMSG IN MVO-VARI
                       MOVE OPC-CIC-IOPC IN OPC TO MVO-MEN2
                       GO TO FIN-COL-GEN-MVO
           ELSE
               IF NOT (CAN-MSC-TCAN IN CAN = 'R' OR 'P')
                   MOVE CAN-CIC-IOPC IN CAN TO MVO-CIC-NUOP IN MVO
                   MOVE SPACES              TO MVO-GLS-TAB1 IN MVO
                   MOVE CAN-NUM-ICAN IN CAN TO MVO-COD-TAUT IN MVO
               ELSE
                   MOVE 'ROV-KEY-IVCT'      TO FIO-AKEY
                   MOVE FIO-GET-NLS         TO FIO-CMND
                   MOVE CAN-CIC-IOPC IN CAN TO ROV-CIC-IOPV IN ROV
                   MOVE CAN-NUM-ICAN IN CAN TO ROV-NUM-IVCT IN ROV
                   PERFORM COL-FIO-ROV
                   IF FIO-STAT-OKS AND
                      ROV-CIC-IOPV IN ROV = CAN-CIC-IOPC IN CAN AND
                      ROV-NUM-IVCT IN ROV = CAN-NUM-ICAN IN CAN
                       MOVE ROV-CIC-IOPC IN ROV TO MVO-CIC-NUOP IN MVO
                       MOVE CAN-CIC-IOPC IN CAN TO MVO-GLS-TAB1 IN MVO
                       MOVE CAN-NUM-ICAN IN CAN TO MVO-COD-TAUT IN MVO
                   ELSE
                       MOVE 'ROVICANNEX' TO MVO-CMSG IN MVO-VARI
                       MOVE CAN-KEY-ICAN IN CAN TO MVO-MEN2
                       GO TO FIN-COL-GEN-MVO.

           MOVE 'S'                      TO MVO-COD-AMBT IN MVO.
           MOVE 'L'                      TO MVO-COD-MODA IN MVO.
           IF MVO-ORIG = 'O'
               MOVE OPC-COD-OFOC IN OPC TO MVO-OFIC
           ELSE
               MOVE CAN-COD-OFCA IN CAN TO MVO-OFIC.
      *     CALL 'RTNU2120' USING MVO-OFIC MVO-TERM.
           MOVE MVO-TERM                 TO MVO-COD-TERM IN MVO.
           MOVE 'I '                     TO MVO-COD-EPRC IN MVO.
           MOVE 'RCH'                    TO MVO-COD-SIAL IN MVO.
           IF CYA-SGV-LIQU IN CYA < ZEROES
               MULTIPLY CYA-SGV-LIQU IN CYA BY -1 GIVING
                                            MVO-SGV-VMVO IN MVO
               IF MVO-ORIG = 'O'
                   MOVE 'C' TO MVO-CCAA
               ELSE
                   MOVE 'A' TO MVO-CCAA
           ELSE
               MOVE CYA-SGV-LIQU IN CYA  TO MVO-SGV-VMVO IN MVO
               IF MVO-ORIG = 'O'
                   MOVE 'A' TO MVO-CCAA
               ELSE
                   MOVE 'C' TO MVO-CCAA.
           MOVE '0'                      TO MVO-IND-CAIF IN MVO.
           MOVE MVO-OFIC IN MVO-VARI     TO MVO-COD-OFRE IN MVO.
           MOVE ZEROES                   TO MVO-NUM-LCUA IN MVO.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY IN HOY-VARI     TO MVO-NUM-DMVO IN MVO.
           MOVE HOY-MHOY IN HOY-VARI     TO MVO-NUM-MMVO IN MVO.
           MOVE HOY-SHOY IN HOY-VARI     TO MVO-NUM-SMVO IN MVO.
           MOVE HOY-AHOY IN HOY-VARI     TO MVO-NUM-AMVO IN MVO.
      *DAD ini  23-FEB-1993   (Memo.22-02-93 Pto.2)
      *         16-FEB-1993   (Memo.28-01-93)
      *     MOVE HOY-HHOY IN HOY-VARI     TO MVO-HRA-HRMV IN MVO.
      * Se obtiene de tabla la Hora Ingreso Movimiento
           IF MVO-HRMV IN MVO-VARI > SPACES
               MOVE MVO-HRMV IN MVO-VARI TO MVO-HRA-HRMV IN MVO
           ELSE
               MOVE 'TAB'    TO FIO-SIST
               MOVE 'PRM'    TO TAB-CIC-TTAB IN TAB
               MOVE 'MVOCOL' TO TAB-CIC-CTAB IN TAB
               MOVE 'TAB-CIC-TABL' TO FIO-AKEY
               MOVE FIO-GET-KEY    TO FIO-CMND
               PERFORM GNS-FIO-TAB
               IF FIO-STAT-OKS
                   MOVE TAB-GLS-DAT1 IN TAB  TO MVO-HRMV IN MVO-VARI
                   MOVE MVO-HRMV IN MVO-VARI TO MVO-HRA-HRMV IN MVO
               ELSE
                   MOVE 'COD    NEX'        TO MVO-CMSG IN MVO-VARI
                   MOVE TAB-CIC-TABL IN TAB TO MVO-MEN2 IN MVO-VARI
                   GO TO FIN-COL-GEN-MVO.
      *DAD fin  23-FEB-1993 / 16-FEB-1993

      *Busca oficina para cuenta corriente
           MOVE CYA-CIC-ICYA IN CYA TO OPE-KEY-IOPE IN OPE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF NOT FIO-STAT-OKS
               MOVE 'OPEIOPENEX'        TO MVO-CMSG
               MOVE OPE-KEY-IOPE IN OPE TO MVO-MEN2
               GO TO FIN-COL-GEN-MVO.
           MOVE OPE-COD-OFOP IN OPE TO MVO-COD-OFCR IN MVO.
           MOVE '000'               TO MVO-IND-DFCR IN MVO.
      *
           MOVE 'N' TO MVO-IND-KESC IN MVO.
           MOVE 'N' TO MVO-IND-KESA IN MVO.
           IF MVO-CCAA IN MVO-VARI = 'A'
               MOVE 'CCT'                    TO MVO-COD-SIAB IN MVO
               MOVE '0770 '                  TO MVO-COD-TRAB IN MVO
               MOVE '4'                      TO MVO-IND-OPMV IN MVO
               MOVE 4                        TO MVO-COD-TMOV IN MVO
               MOVE 'ABONO COLOC.'           TO MVO-CIC-OPCR IN MVO
               MOVE OPE-COD-OFOP IN OPE      TO MVO-COD-OFAB IN MVO
               MOVE CYA-CIC-ICYA IN CYA      TO MVO-CIC-OPAB IN MVO
               MOVE 'ABO'                    TO MVO-COD-TDAB IN MVO
               MOVE '         05F'           TO MVO-COD-SDAB IN MVO
               MOVE '2'                      TO MVO-IND-DHAB IN MVO
           ELSE
               MOVE 'CCT'                    TO MVO-COD-SICR IN MVO
               MOVE '0670 '                  TO MVO-COD-TRCR IN MVO
               MOVE '3'                      TO MVO-IND-OPMV IN MVO
               MOVE 3                        TO MVO-COD-TMOV IN MVO
               MOVE CYA-CIC-ICYA IN CYA      TO MVO-CIC-OPCR IN MVO
               MOVE 'CAR'                    TO MVO-COD-TDCR IN MVO
               MOVE '         07I'           TO MVO-COD-SDCR IN MVO
               PERFORM BUS-COM-OPE
               IF MVO-CMSG IN MVO-VARI > SPACES
                   GO TO FIN-COL-GEN-MVO
               ELSE
                   MOVE 'CARGO COLOC.'       TO MVO-CIC-OPAB IN MVO
                   MOVE '1'                  TO MVO-IND-DHCR IN MVO.

      *DAD ini  16-FEB-1993   (Memo.27-01-93)
      * Se determina si el Cargo en Cta. Cte. es de Otro o Mismo Cliente
           MOVE 'TAB'               TO FIO-SIST.
           MOVE 'TCYA'              TO MSC-COD-TMSC IN MSC.
           MOVE CYA-IND-TCYA IN CYA TO MSC-COD-CMSC IN MSC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-MSC.
           IF NOT FIO-STAT-OKS
               MOVE 'MSC    NEX'        TO MVO-CMSG IN MVO-VARI
               MOVE MSC-COD-TABL IN MSC TO MVO-MEN2 IN MVO-VARI
               GO TO FIN-COL-GEN-MVO.

      * Se procesan Cargos en Cta. Cte. segun Indicador Mismo u Otro Cliente
      * y Origen de Boletas de garantia
           IF MVO-CCAA IN MVO-VARI = 'C'
               IF MSC-COD-DAT1 IN MSC(3) = 'O'
                   MOVE '         07U'     TO MVO-COD-SDCR IN MVO
               ELSE
                   IF MVO-OPEC IN MVO-VARI = 'B'
                       IF MVO-ORIG IN MVO-VARI = 'O'
                           MOVE '         07Y' TO MVO-COD-SDCR IN MVO
                       ELSE
                           MOVE '         07Z' TO MVO-COD-SDCR IN MVO.
      *DAD fin  16-FEB-1993

      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Proceso Genera y Activa con registro MVO (Pro. Linea)
           IF MVO-LINE IN MVO-VARI = 'S'
               GO TO CTE-COL-GEN-MVO.
      *DAD fin  17-MAY-1993

      *Proceso Genera y Graba un registro MVO (Pro. Batch)
           MOVE FIO-PUT TO FIO-CMND.
      *     PERFORM COL-FIO-MVO.
      *     IF NOT FIO-STAT-OKS
      *         MOVE 'MVO    NOPUT' TO MVO-CMSG IN MVO-VARI.
      *DAD ini  28-MAY-1993 / 27-MAY-1993 / 17-MAY-1993   (Memo.12-05-93)
           GO TO FIN-COL-GEN-MVO.
      *Proceso Genera y Activa registro MVO
       CTE-COL-GEN-MVO.
      * Para Activacion en Linea los Cargos/Abonos son sin codigo Supervisor
           MOVE 'N'                 TO MVO-IND-KESC IN MVO.
           MOVE MVO                 TO TWA-MVO.
           MOVE MVO-IND-OPMV IN MVO TO TWA-IND-OPMV.
           MOVE SPACES   TO SYS-CMMA.
           MOVE +0       TO SYS-TCMA.
           MOVE MVO-PROG TO SYS-PROG.
           MOVE SYS-LINK TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
      *     EXEC CICS LINK
      *               PROGRAM(MVO-PROG)
      *     END-EXEC.

           IF TWA-COD-RETR = '00'
               NEXT SENTENCE
           ELSE
           IF TWA-COD-RETR = '01'
               MOVE 'MVONO CTAERR' TO MVO-CMSG IN MVO-VARI
      *DAD ini  09-JUN-1993   (Memo.08-06-93 Pto.2)
           ELSE
               MOVE 'MVONO CHKCTA' TO MVO-CMSG IN MVO-VARI.
      *     IF TWA-COD-RETR = '04' OR '05'
      *         MOVE 'MVONO CHKCTA' TO MVO-CMSG IN MVO-VARI
      *     ELSE
      *         MOVE 'MVONO COMERR' TO MVO-CMSG IN MVO-VARI.
      *DAD fin  09-JUN-1993
           MOVE 'N' TO MVO-LINE IN MVO-VARI.
      *DAD fin  28-MAY-1993 / 27-MAY-1993 / 17-MAY-1993
       FIN-COL-GEN-MVO.
      *DAD ini  18-FEB-1993   (Memo.07-09-92)
      * Se limpia valor cargado desde PPCAN
           MOVE SPACES TO MVO-KESC IN MVO-VARI.
       EXT-COL-GEN-MVO.
      *DAD fin  18-FEB-1993
           EXIT.

      * Busca con Clase el Como Opera de la OPC
       BUS-COM-OPE SECTION.
       INI-BUS-COM-OPE.
           IF MVO-ORIG IN MVO-VARI = 'C'
               MOVE CAN-CIC-IOPC IN CAN TO OPC-CIC-IOPC IN OPC
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM COL-FIO-OPC
               IF NOT FIO-STAT-OKS
                   MOVE 'OPC    NEX'        TO MVO-CMSG IN MVO-VARI
                   MOVE OPC-CIC-IOPC IN OPC TO MVO-MEN2 IN MVO-VARI
                   GO TO FIN-BUS-COM-OPE.

           MOVE SPACES              TO MVO-OPEC IN MVO-VARI.
           MOVE OPC-COD-TOOC IN OPC TO TOC-COD-TOCR IN TOC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-TOC.
           IF NOT FIO-STAT-OKS
               MOVE 'OPCTOOCNEX'        TO MVO-CMSG IN MVO-VARI
               MOVE TOC-COD-TOCR IN TOC TO MVO-MEN2 IN MVO-VARI
               GO TO FIN-BUS-COM-OPE
           ELSE
               MOVE 'COL'               TO MSC-COD-SIST FIO-SIST
               MOVE 'OPEC'              TO MSC-COD-TMSC IN MSC
               MOVE TOC-MSC-OPEC IN TOC TO MSC-COD-CMSC IN MSC
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-MSC
               IF NOT FIO-STAT-OKS
                   MOVE 'TOCOPECNEX'        TO MSG-COD-MENS
                   GO TO FIN-BUS-COM-OPE
               ELSE
                   MOVE MSC-CIC-CMSC IN MSC TO MVO-OPEC IN MVO-VARI.

      *DAD ini  21-AUG-1992   (Memo.12-08-92)
      * Si es Curse se marca siempre con 'S' el campo MVO-IND-KESC
      * (El cargo de un curse se procesa siempre con codigo Supervisor)
           IF MVO-ORIG IN MVO-VARI = 'O'
               MOVE 'S' TO MVO-IND-KESC IN MVO
               GO TO CHK-BUS-COM-OPE.
      *DAD fin  21-AUG-1992

      * Valida que si la OPC es Boleta de garantia, se marca con 'S' el
      * campo MVO-IND-KESC
           IF MVO-OPEC IN MVO-VARI = 'B'
               MOVE 'S' TO MVO-IND-KESC IN MVO
           ELSE
               MOVE 'N' TO MVO-IND-KESC IN MVO.

      *DAD ini  18-FEB-1993   (Memo.07-09-92)
      * Para Cancelaciones 'CCMA' se marca siempre con 'S' el campo
      * MVO-IND-KESC (viene cargado valor desde PPCAN)
           IF MVO-KESC IN MVO-VARI > SPACES
               MOVE MVO-KESC IN MVO-VARI TO MVO-IND-KESC IN MVO.
      *DAD fin  18-FEB-1993

      *DAD ini  20-ABR-1993   (Memo.19-04-93)
      **DAD ini  02-ABR-1993   (Memo.29-03-93)
       CHK-BUS-COM-OPE.
      ** Los Cargos con codigo de Supervisor, se marcan siempre con '2'
      ** en el campo MVO-COD-TMOV, ===> se procesan por el BATCH del MVO
      ** si NO son procesados en LINEA
      *     IF MVO-CCAA IN MVO-VARI = 'C' AND
      *        MVO-IND-KESC IN MVO = 'S'
      *         MOVE 2 TO MVO-COD-TMOV IN MVO.
      **DAD fin  02-ABR-1993
      *DAD fin  20-ABR-1993
       FIN-BUS-COM-OPE.
           EXIT.
