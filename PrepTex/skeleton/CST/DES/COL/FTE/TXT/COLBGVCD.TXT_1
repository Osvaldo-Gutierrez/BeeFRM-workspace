       PRO-CAL-VCD SECTION.
       INI-PRO-CAL-VCD.
      *
      *RUTINA QUE CALCULA SEGURO DE VIDA VENCIDO, SEGURO DE PRENDA
      *VENCIDO Y COMISION VENCIDA.
      *
      *ENTRADA : NECESITA VEN LEIDO ( CON ESTRUCTURA ).
      *
      *SALIDA  : VALORES EN VEN-VAL-SEGD
      *          VALORES EN VEN-VAL-SEGP
      *          VALORES EN VEN-VAL-MCOM RESPECTIVAMENTE
      *
           MOVE SPACES TO VCD-COD-MENS IN VCD-VARI.
           IF VEN-STAT-CUR
               GO TO FIN-PRO-CAL-VCD.
      *
      *LECTURA REGISTRO OPC
      *
           MOVE VEN-CIC-IOPC IN VEN TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               MOVE 'OPC    NEX' TO VCD-COD-MENS IN VCD-VARI
               GO TO FIN-PRO-CAL-VCD.
      *
      *OBTENER CLIENTE ASOCIADO A OPERACION
      *
           MOVE OPC-CAI-IOPC IN OPC     TO RDC-CAI-IOPC IN RDC.
           MOVE OPC-IIC-IOPC IN OPC     TO RDC-IIC-IOPC IN RDC.
           MOVE ZEROES                  TO RDC-NUM-IDLC IN RDC.
      *-------------- INICIO INCORPORADO 08-06-1993 ------------
      * DSP COMPATIBILIDAD VSAM-DTC PERFORM COL-SEQ-RDC-IDLC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RDC.
      * DSP COMPATIBILIDAD VSAM-DTC
           IF FIO-STAT-OKS AND
              (OPC-CAI-IOPC IN OPC = RDC-CAI-IOPC IN RDC) AND
              (OPC-IIC-IOPC IN OPC = RDC-IIC-IOPC IN RDC) AND
              (RDC-NUM-IDLC IN RDC = ZEROES)
               NEXT SENTENCE
           ELSE
               MOVE '23' TO FIO-STAT.           
      *-------------- FIN INCORPORADO 08-06-1993 ------------
           IF FIO-STAT-OKS AND
              (OPC-CAI-IOPC IN OPC = RDC-CAI-IOPC IN RDC) AND
              (OPC-IIC-IOPC IN OPC = RDC-IIC-IOPC IN RDC) AND
              (RDC-NUM-IDLC IN RDC = ZEROES)
              MOVE RDC-IIC-ICLI IN RDC  TO DBC-IIC-ICLI IN DBC
              MOVE FIO-GET-KEY          TO FIO-CMND
              PERFORM SGC-FIO-DBC
              IF NOT FIO-STAT-OKS
                  MOVE 'CLIOPCNEX' TO VCD-COD-MENS IN VCD-VARI
                  GO TO FIN-PRO-CAL-VCD
              ELSE
                  NEXT SENTENCE
           ELSE
               MOVE 'CLIOPCNEX' TO VCD-COD-MENS IN VCD-VARI
               GO TO FIN-PRO-CAL-VCD.
      *
      * LECTURA REGISTRO DLC
      *
           MOVE VEN-CIC-IOPC IN VEN TO DLC-CIC-IOPC IN DLC.
           MOVE VEN-NUM-IDLC IN VEN TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS
               MOVE 'DLC    NEX' TO VCD-COD-MENS IN VCD-VARI
               GO TO FIN-PRO-CAL-VCD.
      *
      *LECTURA REGISTRO COM
      *
           MOVE OPC-CAI-IOPC IN OPC TO VIN-CAI-IOPC IN VIN-VARI.
           MOVE OPC-IIC-IOPC IN OPC TO VIN-IIC-IOPC IN VIN-VARI.
           MOVE ZEROES              TO VIN-NUM-IDLC IN VIN-VARI.
           PERFORM BUS-COM.
      *    DISPLAY FIO-STAT.
      * ISP
      *    IF NOT FIO-STAT-OKS
      *        MOVE ZEROES TO VEN-VAL-MCOM IN VEN
      *        GO TO CON-PRO-CAL-VCD.
      *
      *CALCULA COMISION VENCIDA
      *
      *    DISPLAY COM-COD-TINT IN COM.
           IF COM-COD-TINT IN COM     > SPACES
               MOVE 'COL' TO TAB-COD-SIST FIO-SIST
               MOVE 'COM' TO TAB-COD-TTAB IN TAB
               MOVE COM-COD-TINT IN COM     TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-TAB
               MOVE TAB-CIC-CTAB IN TAB TO VCD-CIC-CTAB IN VCD-VARI
               IF VCD-CIC-FLVC IN VCD-VARI = 'VCD'
                   PERFORM CAL-COM-VCDA
                   IF VCD-COD-MENS IN VCD-VARI > SPACES
                       GO TO FIN-PRO-CAL-VCD.
       CON-PRO-CAL-VCD.
      *ISP
      *    IF OPC-COD-SEGP IN OPC NOT > SPACES
      *        MOVE ZEROES TO VEN-VAL-SEGP IN VEN
      *        GO TO CON-CAL-PRO-SEV.
      *    MOVE 'COL' TO TAB-COD-SIST FIO-SIST.
      *    MOVE 'SDP' TO TAB-COD-TTAB IN TAB.
      *    MOVE OPC-COD-SEGP IN OPC TO TAB-COD-CTAB IN TAB.
      *    MOVE FIO-GET-KEY TO FIO-CMND.
      *    PERFORM GNS-FIO-TAB.
      *    IF NOT FIO-STAT-OKS
      *        MOVE 'CODSDPNEX' TO VCD-COD-MENS IN VCD-VARI
      *        GO TO FIN-PRO-CAL-VCD.
      *    MOVE TAB-CIC-CTAB IN TAB TO VCD-CIC-CTAB IN VCD-VARI.
      *    IF VCD-CIC-FLVC IN VCD-VARI = 'VCD' AND
      *       OPC-NUM-VCOR IN OPC = VEN-NUM-IVCT IN VEN
      *         MOVE ZEROES TO VEN-VAL-SEGP IN VEN.
      *CON-CAL-PRO-SEV.
      *    IF OPC-COD-SEGD IN OPC NOT > SPACES OR
      *       DBC-IND-ICLI IN DBC     = '0' OR
      *       DBC-IND-ICLI IN DBC     = '9'
      *        MOVE ZEROES TO VEN-VAL-SEGD IN VEN
      *        GO TO FIN-PRO-CAL-VCD.
      *    MOVE 'COL' TO TAB-COD-SIST FIO-SIST.
      *    MOVE 'SDG' TO TAB-COD-TTAB IN TAB.
      *    MOVE OPC-COD-SEGD IN OPC     TO TAB-COD-CTAB IN TAB.
      *    MOVE FIO-GET-KEY TO FIO-CMND.
      *    PERFORM GNS-FIO-TAB.
      *    IF NOT FIO-STAT-OKS
      *        MOVE 'CODSDGNEX' TO VCD-COD-MENS IN VCD-VARI
      *        GO TO FIN-PRO-CAL-VCD.
      *    MOVE TAB-CIC-CTAB IN TAB TO VCD-CIC-CTAB IN VCD-VARI.
      *    IF VCD-CIC-FLVC IN VCD-VARI NOT = 'VCD'
      *        MOVE ZEROES TO VEN-VAL-SEGD IN VEN
      *        GO TO FIN-PRO-CAL-VCD.
      *    MOVE 01                      TO CAM-NUM-DCAM IN CAM(1).
      *    MOVE OPC-NUM-MCOL IN OPC     TO CAM-NUM-MCAM IN CAM(1).
      *    MOVE OPC-NUM-SCOL IN OPC     TO CAM-NUM-SCAM IN CAM(1).
      *    MOVE OPC-NUM-ACOL IN OPC     TO CAM-NUM-ACAM IN CAM(1).
      *    MOVE CAM-FEC-FCAM IN CAM(1)  TO CAM-FEC-FCAM IN CAM(2).
      *    MOVE OPC-COD-COOC IN OPC      TO CAM-COD-VCAM IN CAM(1).
      *    MOVE DLC-COD-PLZO IN DLC      TO VCD-COD-PLAZ IN VCD-VARI.
      *    MOVE 'SDG'                    TO VCD-COD-SEVP IN VCD-VARI.
      *    MOVE VCD-COD-VCAM IN VCD-VARI TO CAM-COD-VCAM IN CAM(2).
      *    MOVE FIO-GET-KEY TO FIO-CMND.
      *    PERFORM TAB-FIO-CAM.
      *    IF NOT FIO-STAT-OKS
      *        MOVE 'CODSDGCAMNEX' TO VCD-COD-MENS IN VCD-VARI
      *        GO TO FIN-PRO-CAL-VCD.
      *    DISPLAY 'CAM-SDG : ' CAM-SGV-VCAM IN CAM.
      *    DISPLAY 'SCPASDG : ' DLC-SCPA(VEN-NUM-IDLC IN VEN).
      *    ADD  DLC-SCPA(VEN-NUM-IDLC IN VEN)
      *         VEN-VAL-CAPI IN VEN GIVING
      *         VEN-VAL-SEGD IN VEN.
      *    MULTIPLY VEN-VAL-SEGD IN VEN
      *                                     BY CAM-SGV-VCAM IN CAM
      *             GIVING VEN-VAL-SEGD IN VEN.
      *    DIVIDE VEN-VAL-SEGD IN VEN BY 100
      *                              GIVING VEN-VAL-SEGD IN VEN.
      *    MOVE VEN-VAL-SEGD IN VEN TO PES-SGV-DECI IN PES-VARI.
      *    PERFORM PES-SCTV.
      *    MOVE PES-SGV-ENTE IN PES-VARI TO VEN-VAL-SEGD IN VEN.
       FIN-PRO-CAL-VCD.
           EXIT.

       CAL-COM-VCDA SECTION.
       INI-CAL-COM-VCDA.
      *    MOVE DLC-DAMT(VEN-NUM-IDLC IN VEN) TO FEC-DEC1 IN FEC-VARI.
      *    MOVE DLC-MAMT(VEN-NUM-IDLC IN VEN) TO FEC-MEC1 IN FEC-VARI.
      *    MOVE DLC-SAMT(VEN-NUM-IDLC IN VEN) TO FEC-SEC1 IN FEC-VARI.
      *    MOVE DLC-AAMT(VEN-NUM-IDLC IN VEN) TO FEC-AEC1 IN FEC-VARI.
      *    MOVE VEN-NUM-DVEN IN VEN     TO FEC-DEC2 IN FEC-VARI.
      *    MOVE VEN-NUM-MVEN IN VEN     TO FEC-MEC2 IN FEC-VARI.
      *    MOVE VEN-NUM-SVEN IN VEN     TO FEC-SEC2 IN FEC-VARI.
      *    MOVE VEN-NUM-AVEN IN VEN     TO FEC-AEC2 IN FEC-VARI.
      *COMPARACION EN DIAS ENTRE FECHA UNO Y FECHA DOS
      *    MOVE FEC-FORM-FEC TO FEC-FORM.
      *    MOVE FEC-DIF-DIA  TO FEC-CMND.
      *    PERFORM CAL-FEC.
      *    IF NOT FEC-STAT-OKS
      *        MOVE FEC-MENS TO VCD-COD-MENS IN VCD-VARI
      *        GO TO FIN-CAL-COM-VCDA.
      *    DISPLAY 'DIA ' FEC-NDIA.
      *    MOVE FEC-NDIA TO INT-SEPD.
      *    DISPLAY 'SEPD : ' INT-SEPD.
           MOVE COM-COD-TINT IN COM     TO INT-TIPT.
           IF INT-CVTI > SPACES
               MOVE INT-IBTV-UNA-VEZ        TO INT-IBTV
               MOVE OPC-COD-VCOC IN OPC     TO INT-VCAM
               MOVE COM-SGV-TINT IN COM     TO INT-TINT
      *        EN EL INGRESO COM-FEC-FINI = ZEROES
      *        IF COM-FEC-FINI IN COM > ZEROES
      *            MOVE COM-FEC-FINI IN COM TO INT-FINT
      *        ELSE
                   MOVE OPC-FEC-FCOL IN OPC TO INT-FINT
           ELSE
               MOVE COM-SGV-TINT IN COM     TO INT-TINT.
           PERFORM OBT-VTIN.
      *    DISPLAY 'INT-CMSG' INT-CMSG.
           IF INT-CMSG > SPACES
               MOVE INT-CMSG TO VCD-COD-MENS IN VCD-VARI
               GO TO FIN-CAL-COM-VCDA.
      * CALCULA COMISION DEVENGADA EN EL PERIODO
      *    DISPLAY 'TIPE ' INT-TIPE.
      *    DISPLAY  DLC-SCPA(VEN-NUM-IDLC IN VEN).
      *    ADD  DLC-SCPA(VEN-NUM-IDLC IN VEN)
      *         VEN-VAL-CAPI IN VEN GIVING
      *         VEN-VAL-MCOM IN VEN.
      *    MULTIPLY INT-TIPE BY VEN-VAL-MCOM IN VEN GIVING
      *                         VEN-VAL-MCOM IN VEN.
      *    MOVE VEN-VAL-MCOM IN VEN TO PES-SGV-DECI IN PES-VARI.
      *    PERFORM PES-SCTV.
      *    MOVE PES-SGV-ENTE IN PES-VARI TO VEN-VAL-MCOM IN VEN.
       FIN-CAL-COM-VCDA.
           EXIT.
