*%! Codigo adicional para archivo
*% IF WSS
      *<<<< WSS
       COPY TABBRUSR.
       COPY TABBROFI.
       COPY TABBRCAM.
       COPY TABBRTIO.
       COPY COLBRDLC.
       COPY COLBRDCC.
       COPY COLBRAUX.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       01  WSS-VARI.
           03 WSS-FEC-FINI.
              05 WSS-NUM-DINI                     PIC 9(02).
              05 WSS-NUM-MINI                     PIC 9(02).
              05 WSS-NUM-SINI                     PIC 9(02).
              05 WSS-NUM-AINI                     PIC 9(02).
           03 WSS-FEC-FTER.
              05 WSS-NUM-DTER                     PIC 9(02).
              05 WSS-NUM-MTER                     PIC 9(02).
              05 WSS-NUM-STER                     PIC 9(02).
              05 WSS-NUM-ATER                     PIC 9(02).
           03 WSS-FEC-FFEC.
              05 WSS-NUM-SFEC                     PIC 9(02).
              05 WSS-NUM-AFEC                     PIC 9(02).
              05 WSS-NUM-MFEC                     PIC 9(02).
              05 WSS-NUM-DFEC                     PIC 9(02).
           03 WSS-FEC-FFET.
              05 WSS-NUM-SFET                     PIC 9(02).
              05 WSS-NUM-AFET                     PIC 9(02).
              05 WSS-NUM-MFET                     PIC 9(02).
              05 WSS-NUM-DFET                     PIC 9(02).
           03 WSS-FEC-FREG.
              05 WSS-NUM-SREG                     PIC 9(02).
              05 WSS-NUM-AREG                     PIC 9(02).
              05 WSS-NUM-MREG                     PIC 9(02).
              05 WSS-NUM-DREG                     PIC 9(02).
           03 WSS-IND-NEXT                        PIC 9(01). 
           03 WSS-COD-PESO                        PIC X(06).
           03 WSS-VAL-NDLC                        PIC 9(11).
           03 WSS-VAL-TIMP                        PIC 9(03)V9(01).
           03 WSS-VAL-VIMP                        PIC 9(09)V9(09).
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCC-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==. 
      *>>>>
*% END
*% IF CF_TET_OPC_COD_OFOC
      *<<<< CF_TET_OPC_COD_OFOC
      * Mediante BUS-TAB Busca Tipo de Moneda de Tabla VLR
           IF OPC-COD-VCOC IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-VCOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-VCOC IN WSS-TET
           ELSE
               MOVE SPACES TO WSS-GLS-VCOC IN WSS-TET.

      * Mediante BUS-OFI Busca Direccion Oficina de Tabla OFI
           IF OPC-COD-OFOC IN SRT > SPACES
               MOVE OPC-COD-OFOC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI.
      *>>>>
*% END
*% IF INI_INP
      *<<<< INI_INP
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.

      *Captura Fecha de Inicio
           DISPLAY 'FECHA DE INICIO ( DDMMAAAA ) : '.
           ACCEPT  WSS-FEC-FINI IN WSS-VARI.
           DISPLAY WSS-FEC-FINI IN WSS-VARI.
      *Captura Fecha de Termino
           DISPLAY 'FECHA DE TERMINO ( DDMMAAAA ) : '.
           ACCEPT  WSS-FEC-FTER IN WSS-VARI.
           DISPLAY WSS-FEC-FTER IN WSS-VARI.

           DISPLAY 'FIN    CAPTURA DE PARAMETROS'.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

      *VAL-FEC Valida Fecha de Inicio
           DISPLAY WSS-FEC-FINI IN WSS-VARI.
           MOVE WSS-FEC-FINI    IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-END.

      *VAL-FEC Valida Fecha de Termino
           DISPLAY WSS-FEC-FTER IN WSS-VARI.
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-END.

      *CMP-FEC Compara Fecha de Inicio con Fecha de Termino
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FEC1.
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-GRT
               MOVE 'TAB'         TO MSG-COD-SIST
               MOVE 'FECFINIFTER' TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG
               PERFORM GNS-PRO-END.

           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DINI IN WSS-TET
                                            WSS-NUM-DFEC IN WSS-VARI.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MINI IN WSS-TET
                                            WSS-NUM-MFEC IN WSS-VARI.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SINI IN WSS-TET
                                            WSS-NUM-SFEC IN WSS-VARI.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AINI IN WSS-TET
                                            WSS-NUM-AFEC IN WSS-VARI.
           MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DTER IN WSS-TET
                                            WSS-NUM-DFET IN WSS-VARI.
           MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MTER IN WSS-TET
                                            WSS-NUM-MFET IN WSS-VARI.
           MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-STER IN WSS-TET
                                            WSS-NUM-SFET IN WSS-VARI.
           MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-ATER IN WSS-TET
                                            WSS-NUM-AFET IN WSS-VARI.

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.

      * Obtiene Codigo Valor de Cambio de Pesos Mediante CIC de la Moneda '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
               PERFORM GNS-PRO-END.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS-VARI.

      *BUS-USR busca usuario en tablas
           MOVE 'USR' TO USR-COD-USER IN USR.
           PERFORM BUS-USR.
      *>>>>
*% END
*% IF INI_FST_INP
      *<<<< INI_FST_INP
           MOVE WSS-FEC-FFEC IN WSS-VARI TO OPC-FEC-FING IN OPC.
           MOVE 'OPC-FEC-FING' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS OR
              OPC-FEC-FING IN OPC > WSS-FEC-FFET IN WSS-VARI
               DISPLAY 'NO HAY REGISTROS PARA RANGO DE FECHAS : DESDE '
                       WSS-FEC-FINI IN WSS-VARI ' A '
                       WSS-FEC-FTER IN WSS-VARI
               GO TO FIN-INP-SRT.
           GO TO LUP-INP-SRT.
      *>>>>
*% END
*% IF LUP_INP
      *<<<< LUP_INP
      * Proceso de Seleccion y Clasificacion a Partir del Registro OPC
           PERFORM SEL-REG-PRO.
           IF WSS-IND-NEXT IN WSS-VARI = 1
               GO TO NXT-INP-SRT.

      * Busca los Documentos de Credito para Operacion Determinada
           MOVE SPACES              TO DLC-KEY-IDLC IN DLC.
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE FIO-GET-NLS  TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS OR
              DLC-CIC-IOPC IN DLC NOT = OPC-CIC-IOPC IN OPC
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'OPC    DLCNX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   OPC-KEY-IOPC IN OPC
               GO TO NXT-INP-SRT.
       LUP-BUS-OPC-DLC.
           PERFORM BUS-SRT-REG.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS OR
              DLC-CIC-IOPC IN DLC NOT = OPC-CIC-IOPC IN OPC
               GO TO NXT-INP-SRT.
           GO TO LUP-BUS-OPC-DLC.
      *>>>>
*% END
*% IF INI_NXT_INP
      *<<<< INI_NXT_INP
           MOVE 'OPC-FEC-FING' TO FIO-AKEY.
      *>>>>
*% END
*% IF FIN_NXT_INP
      *<<<< FIN_NXT_INP
           IF OPC-FEC-FING IN OPC > WSS-FEC-FFET IN WSS-VARI
               GO TO FIN-INP-SRT.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      **************************************************************************
      * Seleccion del Registro OPC para Proceso del Listado
       SEL-REG-PRO SECTION.
       INI-SEL-REG-PRO.
           MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.

           IF OPC-MSC-STAT IN OPC NOT = 'A'
               GO TO FIN-SEL-REG-PRO.

      * Mediante BUS-TAB Busca Sistema Valido en Tabla TIO para Operacion
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'TIO'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-TOOC IN OPC TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS = 'COD    NEX'
               DISPLAY MSG-GLS-DESC ' : ' TAB-COD-TABL
               GO TO FIN-SEL-REG-PRO.

      * Obtiene Sistema Valido de la Operacion de Credito
           MOVE TAB TO TIO.
           IF TIO-GLS-SIST IN TIO NOT = 'COL'
               GO TO FIN-SEL-REG-PRO.

           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
       FIN-SEL-REG-PRO.
           EXIT.
      **************************************************************************
      * Formacion y Generacion del Registro SRT al Procesar Varios Registros
       BUS-SRT-REG SECTION.
       INI-BUS-SRT-REG.
      * Forma Llave COD-CCTB para Leer DCC
           MOVE 'CAP'               TO DCC-MSC-TCCT IN DCC.
           MOVE OPC-COD-VCOC IN OPC TO DCC-COD-VCAM IN DCC.
           MOVE OPC-COD-TOOC IN OPC TO DCC-COD-TOCR IN DCC.
           MOVE DLC-IND-SCRT IN DLC TO DCC-IND-SCRT IN DCC.
           MOVE DLC-IND-SCBZ IN DLC TO DCC-IND-SCBZ IN DCC.
           MOVE SPACES              TO DCC-IND-SCTB IN DCC.
      *     IF DLC-COD-PLZO IN DLC = '-1' OR
      *        DLC-COD-PLZO IN DLC = '+1'
      *         MOVE DLC-COD-PLZO IN DLC TO DCC-COD-PLZO IN DCC
      *     ELSE
      *         IF DLC-MSC-TPZO IN DLC = 'C'
      *             MOVE '-1' TO DCC-COD-PLZO IN DCC
      *         ELSE
      *             MOVE '+1' TO DCC-COD-PLZO IN DCC.
           MOVE DLC-COD-PLZO IN DLC TO DCC-COD-PLZO IN DCC.

      * Con BUS-TAB Busca Estado de IND-PCTB de Tabla AUX para Completar Llave
           MOVE 'COL'               TO TAB-COD-SIST.
           MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
           MOVE OPC-COD-COOC IN OPC TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               DISPLAY MSG-GLS-DESC ' : ' TAB-COD-TABL IN TAB
                       ' AL BUSCAR IND-PCTB CON CLASE OPERACION DE : '
                       OPC-CIC-IOPC IN OPC
               GO TO FIN-BUS-SRT-REG.
           MOVE TAB TO AUX.
           IF AUX-IND-PCTB NOT = 'N'
               MOVE OPC-COD-AOOC IN OPC TO DCC-COD-AOCR IN DCC
           ELSE
               MOVE SPACES TO DCC-COD-AOCR IN DCC.

      * Obtiene Cuenta Contable al Leer DCC por Llave COD-CCTB Formada
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM COL-FIO-DCC.
           IF NOT FIO-STAT-OKS
               MOVE 'GNS'        TO MSG-COD-SIST
               MOVE 'COD    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC ' : ' DCC-COD-TABL IN DCC
                       ' PARA DOCUMENTO : ' DLC-KEY-IDLC IN DLC
               GO TO FIN-BUS-SRT-REG.

      * Obtiene Tasa de Impuestos
           IF DLC-VAL-IMPU IN DLC > ZEROES
               PERFORM BUS-VAL-TIMP
               IF WSS-IND-NEXT IN WSS-VARI = 1
                   GO TO FIN-BUS-SRT-REG.

      * Completa Llenado de Campos y Genera el Registro SRT
           COPY COLRMTET.
           RELEASE SRT.
       FIN-BUS-SRT-REG.
           EXIT.
      **************************************************************************
      * Para Moneda Nacional distinta de pesos se transforma a pesos y obtiene
      * Tasa de Impuestos
       BUS-VAL-TIMP SECTION.
       INI-BUS-VAL-TIMP.
           MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.

      * Obtiene Valor de Cambio a Fecha de Colocacion para Moneda Nacional
      * distinta de pesos
           IF OPC-MSC-TVOC IN OPC = '0' AND
              OPC-COD-VCOC IN OPC NOT = WSS-COD-PESO IN WSS-VARI
               MOVE OPC-FEC-FCOL IN OPC      TO CAM-FEC-FCAM IN CAM(1)
               MOVE OPC-FEC-FCOL IN OPC      TO CAM-FEC-FCAM IN CAM(2)
               MOVE OPC-COD-VCOC IN OPC      TO CAM-COD-VCAM IN CAM(1)
               MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2)
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM TAB-FIO-CAM
               IF NOT FIO-STAT-OKS
                   DISPLAY 'NO EXISTE VALOR DE CAMBIO A FECHA : '
                            OPC-FEC-FCOL IN OPC ' PARA : '
                            OPC-COD-VCOC IN OPC ' EN OPERACION : '
                            OPC-CIC-IOPC IN OPC
                   GO TO FIN-BUS-VAL-TIMP
               ELSE
                   IF CAM-IND-VIGE NOT = 'S'
                      DISPLAY 'NO EXISTE VALOR DE CAMBIO A FECHA : '
                               OPC-FEC-FCOL IN OPC ' PARA : '
                               OPC-COD-VCOC IN OPC ' EN OPERACION : '
                               OPC-CIC-IOPC IN OPC
                      GO TO FIN-BUS-VAL-TIMP
                   ELSE
                       MULTIPLY CAM-SGV-VCAM IN CAM BY DLC-VAL-NDLC
                       IN DLC GIVING WSS-VAL-NDLC IN WSS-VARI ROUNDED
           ELSE
               MOVE DLC-VAL-NDLC IN DLC TO WSS-VAL-NDLC IN WSS-VARI.

      * Obtiene Tasa de Impuestos
           DIVIDE DLC-VAL-IMPU IN DLC BY WSS-VAL-NDLC IN WSS-VARI
                            GIVING WSS-VAL-VIMP IN WSS-VARI ROUNDED.

           MULTIPLY WSS-VAL-VIMP IN WSS-VARI BY 100
                            GIVING WSS-VAL-TIMP IN WSS-VARI ROUNDED.

           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
       FIN-BUS-VAL-TIMP.
           EXIT.
      **************************************************************************

       COPY TABBFUSR.
       COPY TABBFOFI.
       COPY TABBFCAM.
       COPY COLBFDLC.
       COPY COLBFDCC.
       COPY COLBFAUX.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY TABBBUSR.
       COPY TABBBOFI.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
      *>>>>
*% END
