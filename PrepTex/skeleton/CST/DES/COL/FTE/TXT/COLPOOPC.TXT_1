*%! Codigo adicional para archivo
*% IF PGM_CHI AND PGM_BCI
*%     PGM_PTC = TRUE
*% END
*% IF MI_COMMAREA
      *<<<< MI_COMMAREA
       COPY COLWGENG.
       COPY GNSWGRQA REPLACING ==01  ADR-REQA== BY ==02  SCR-RQA1==.
       COPY GNSWGRQA REPLACING ==01  ADR-REQA== BY ==02  SCR-RQA2==.
           02 SCR-KEY-IRDC                         PIC X(04).
           02 SCR-IND-MRDC                         PIC X(01).
           02 SCR-IND-MITR                         PIC X(01).
           02 SCR-IND-MCOM                         PIC X(01).
           02 SCR-IND-MCYA                         PIC X(01).
           02 SCR-IND-ACAN                         PIC X(03).
           02 SCR-MSC-TCAN                         PIC X(01).
           02 SCR-OPC-STAT                         PIC X(01).
      *>>>>
*% END
*% LARGO_MI_COMMAREA = 2750
*% IF WSS
      *<<<< WSS
*% IF PGM_PTC
       COPY GNSWGQUE.
*% END
       COPY GNSWGPES.
       COPY GNSBRCIC.
       COPY SGCBRDBC.
       COPY COLBRRDC.
       COPY COLBRITR.
       COPY COLBRCOM.
       COPY COLBRCYA.
       COPY COLBRDLC.
       COPY COLBREVC.
       COPY COLBRVEN.
       COPY COLBRPOC.
      *Registros incorporados para cambio de entidades por prorrogas
       COPY COLBRCCB.
       COPY COLBRCCR.
       COPY COLBRCCT.
       COPY COLBRCUF.
       COPY COLBRICG.
       COPY COLBRRCE.
       COPY COLBRRCV.
       COPY COLBRRDT.
      *
       COPY COLWGSTO.

       COPY COLBRROV.
       COPY COLBRAUT.
       COPY COLBRCAN.
       COPY COLBRMVO.
       COPY COLBRTOC.
       COPY COLWGMVO.
       COPY GNSWGCPT.
       COPY GNSWGSTR.
       COPY SGCBRRCO.
       COPY SGCBROPE.
       COPY SGCBRRCD.
       COPY COLBRICC.
       COPY TABBRCAM.
      *ALD/8-AUG-1988
       COPY DEUBRDBD.
      *HPM                           COPY COLWGRNO.
       COPY COLWGCEO.
      *
      *DAD ini  21-JUL-1992
       COPY COLWGLAV.
      *DAD fin  21-JUL-1992

       01  WSS-VARI.
      *DAD ini  21-JUL-1992
           03 WSS-CIC-ILDC.
              05 WSS-CAI-ILDC                          PIC X(04).
              05 WSS-IIC-ILDC                          PIC 9(08).
      *DAD fin  21-JUL-1992
      *HPM ini
           03 WSS-STAT                                 PIC X(02).
               88 WSS-STAT-OKS    VALUE 'SI'.
      *HPM fin
           03  BUS-POR-KEYS       VALUE SPACES         PIC X(01).
           03  BUS-POR-CLTE       VALUE 'C'            PIC X(01).
           03  WSS-GLS-DAT1       VALUE SPACES         PIC X(01).
           03  WSS-COD-CAUX.
               05  WSS-COD-TOOC                        PIC X(03).
               05  WSS-COD-AOOC                        PIC X(03).
           03  WSS-OPC-LNBT                            PIC X(01).
      *ISP RENOVACIONES 
           03  WSS-VLR.    
               05  WSS-CIC-VCAM.
      *
      *            Tipo Valor
                   07  WSS-CIC-TVAL                     PIC X(01).
      *
      *            Codigo Valor
                   07  WSS-CIC-CVAL                     PIC X(03).
      *
      *            Tipo Cambio
                   07  WSS-CIC-TCAM                     PIC X(08).
      *
           03  WSS-PCAN                             PIC X(08).
      *

      ************** esto viene del colpuopc ********* desde *****
      *DAD ini  15-MAR-1993   (Memo.14-10-92 Pto.1)
           03  WSS-FEC-FCTB.
               05  WSS-NUM-SCTB                       PIC 9(02).
               05  WSS-NUM-ACTB                       PIC 9(02).
               05  WSS-NUM-MCTB                       PIC 9(02).
               05  WSS-NUM-DCTB                       PIC 9(02).
           03  WSS-FEC-FAUX.
               05  WSS-NUM-SAUX                       PIC 9(02).
               05  WSS-NUM-AAUX                       PIC 9(02).
               05  WSS-NUM-MAUX                       PIC 9(02).
               05  WSS-NUM-DAUX                       PIC 9(02).
      *DAD fin  15-MAR-1993
      *DAD ini  21-JUL-1992
           03 WSS-IND-ILDC                             PIC X(01).
      *DAD fin  21-JUL-1992
      *DAD ini  22-MAR-1991 
           03  WSS-VAL-PESO                            PIC 9(11).
      *DAD fin  22-MAR-1991 
           03  WSS-NUM-DIGT                       PIC 9(02).
           03  WSS-COD-DIGT                       PIC X(02).
           03  WSS-I                              PIC 9(02).
           03  PGM-STAT-POC          VALUE '23'   PIC X(02).
               88 PGM-STAT-POC-OKS   VALUE '00'.
               88 PGM-STAT-POC-NUL   VALUE '  '.
           03  BUS-POR-KEYS          VALUE SPACES PIC X(01).
           03  BUS-POR-CLTE          VALUE 'C'    PIC X(01).
      *ALD
           03  WSS-MEN2.
               05  FILLER            VALUE SPACES PIC X(01).
               05  WSS-SGV-VAL1-EDT  PIC --------------,---.
               05  WSS-GLS-GUI1                    PIC X(01).
               05  WSS-SGV-VAL2-EDT  PIC --------------,---.
           03  NOV-SGV-DIFE          COMP-3        PIC S9(11)V9(4).
           03  NOV-SGV-SNOV          COMP-3        PIC S9(11)V9(4).
           03  WSS-VAL-SVEN          COMP-3        PIC S9(11)V9(4).

      ************** esto viene del colpuopc ********* hasta *****

       COPY COLWGADO.


      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUX-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-COM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-EVC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-POC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CCB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CCR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CCT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CUF-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-AUT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MVO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *ALD/8-AUG-1988
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBD-REQA==.
      *
      *>>>>
*% END
*% BLLCELLS_USR = TRUE
*% IF BLLCELLS
      *<<<< BLLCELLS
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Para Proceso Genera y Activa con registro MVO (Pro. Linea)
      * COPY GNSLGFIO.
       COPY COLLGCCT.
      *DAD fin  17-MAY-1993
      *>>>>
*% END
*% IF INI_STP_EXIT
      *<<<< INI_STP_EXIT
           MOVE 'COLPQOPC' TO SCR-PROV.
           MOVE 'KO40'     TO SCR-NTRV.
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
*% IF PGM_PTC
           PERFORM GNS-ERR-QUE.
*% END
           IF SCR-DESDE-CMN
                MOVE SPACES TO SCR-KEY-IRDC
                MOVE SPACES TO SCR-IND-MRDC
                MOVE SPACES TO SCR-IND-MITR
                MOVE SPACES TO SCR-IND-MCOM
                MOVE SPACES TO SCR-IND-MCYA
                MOVE SPACES TO SCR-IND-ACAN
                MOVE SPACES TO SCR-MSC-TCAN.
      *JSS 9-APR-1991 18:37:24
           MOVE 'COL'    TO FIO-SIST.
           MOVE 'VSN'    TO TAB-COD-TTAB IN TAB.
           MOVE 'PGMCAN' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS AND ( TAB-MSC-STAT IN TAB = 'S' )
               MOVE TAB-GLS-DCOR IN TAB TO WSS-PCAN
           ELSE
               MOVE 'COLPOCAN'          TO WSS-PCAN.
      *>>>>
*% END
*% IF INI_CMN_ACC
      *<<<< INI_CMN_ACC
           IF NOT ( SCR-CMND = 'ACA' OR
                    SCR-CMND = 'ACO' )
               MOVE 'GNS' TO MSG-COD-SIST
               MOVE 'CMDINV' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-ACC.

           IF SCR-MSC-TCAN = 'N'
               PERFORM GET-CAN-FRM.
      *ALD
           PERFORM KEY-ALL-OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-ACC.
           GO TO NOV-CMN-ACC.
      *>>>>
*% END
*% IF CMN_ACC_RET
      *<<<< CMN_ACC_RET
       NOV-CMN-ACC.
      *JSS 17-MAY-1991 11:38:41 ( para manejo de cuenta corriente )
      *Determina ( WSS-OPC-LNBT ) si es con cargo en cuenta corriente
      *y si es en Linea(S), BATCH(N) o Manual(M)
           PERFORM BUS-TCYA-LOB.
           IF MSG-COD-MENS > SPACES
               PERFORM BCK-OUT
               GO TO MSG-CMN-ACC.
           IF SCR-IND-ACAN = 'NOV'
                MOVE 'O' TO ADO-IND-ORIG
                PERFORM PRO-NOV-OPC
                MOVE ADO-MSC-MOPC TO ADO-MSC-TCAN
                MOVE CAN-KEY-ICAN IN CAN TO ADO-KEY-ICAN
                MOVE IDD-FSIS IN IDD-VARI TO ADO-FIDD
                MOVE ADO-CMMA TO SYS-CMMA
                MOVE SYS-LINK TO SYS-CMND
                MOVE WSS-PCAN TO SYS-PROG
                MOVE ADO-TCMA TO SYS-TCMA
                PERFORM GNS-PRO-SYS
                MOVE SYS-CMMA TO ADO-CMMA
                IF ADO-GLS-MENS > SPACES
                    MOVE ADO-GLS-MENS TO MSG-GLS-DESC FRM-MENS
                    GO TO FIN-CMN-ACC
                ELSE
                    NEXT SENTENCE
           ELSE
           IF SCR-IND-ACAN = 'REN' OR 'PRO'
                MOVE 'O' TO ADO-IND-ORIG
                MOVE CAN-KEY-ICAN IN CAN TO ADO-KEY-ICAN
                MOVE OPC-CIC-IOPC IN OPC TO ADO-KEY-IOPC
                MOVE ADO-MSC-MCAN TO ADO-MSC-TCAN
                MOVE IDD-FSIS IN IDD-VARI TO ADO-FIDD
                MOVE ADO-CMMA TO SYS-CMMA
                MOVE SYS-LINK TO SYS-CMND
                MOVE WSS-PCAN TO SYS-PROG
                MOVE ADO-TCMA TO SYS-TCMA
                PERFORM GNS-PRO-SYS
                MOVE SYS-CMMA TO ADO-CMMA
                IF ADO-GLS-MENS > SPACES
                    MOVE ADO-GLS-MENS TO MSG-GLS-DESC FRM-MENS
                    GO TO FIN-CMN-ACC.

           IF SCR-MSC-TCAN = 'N'
               PERFORM ACT-OPC-ROV.

           PERFORM PRO-OPC-CYA.
           IF MSG-COD-MENS > SPACES
                GO TO FIN-CMN-ACC.
      *ALD
           GO TO CON-CMN-ACC.
      *>>>>
*% END
*% IF CMN_ACC
      *<<<< CMN_ACC
       CON-CMN-ACC.
           PERFORM KEY-ALL-OPC.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-ACC.
      *DAD ini  21-JUL-1992
      * Enganche con Rutina que Revisa Linea de Avance, si corresponde
           IF OPC-CAI-ILDC IN OPC-FLD NOT > SPACES AND
              OPC-IIC-ILDC IN OPC-FLD NOT > ZEROES
               GO TO CON-CMN-ACC-LDA-FIN.

           MOVE 'COL'          TO FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'BCI    LAVAN' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND
                    TAB-MSC-STAT IN TAB = 'S' )
               GO TO CON-CMN-ACC-LDA-FIN.

      * Inicializacion de Variables para rutina Linea de Avance
           MOVE SPACES                   TO MSG-COD-MENS.
           MOVE SPACES                   TO WSS-CAI-ILDC IN WSS-VARI.
           MOVE ZEROES                   TO WSS-IIC-ILDC IN WSS-VARI.
           MOVE WSS-CIC-ILDC IN WSS-VARI TO LAV-IOPC IN LAV-VARI(1)
                                            LAV-IOPC IN LAV-VARI(2)
                                            LAV-AOPC IN LAV-VARI(1)
                                            LAV-AOPC IN LAV-VARI(2).

      * Carga Deudor y Operacion del Credito a Activar para rutina LAv
           MOVE RDC-CIC-ICLI IN RDC TO LAV-ICLI IN LAV-VARI.
           MOVE OPC-CIC-IOPC IN OPC TO LAV-IOPC IN LAV-VARI(1).

      * Considera Credito si es Prorroga de Credito Cancelado para rutina LAv
           IF ( CAN-CAI-IOPC IN OPC-FLD NOT > SPACES AND
                CAN-IIC-IOPC IN OPC-FLD NOT > ZEROES ) OR
              OPC-IND-RENO IN OPC-FLD NOT = 'PRO'
               MOVE ZEROES TO LAV-SCRE IN LAV-VARI(1)
               GO TO CON-CMN-ACC-LDA-PRO.

      * Para dejar con KEY's de la Pantalla el registro CAN y leer la CAN
      *     PERFORM KEY-CAN-OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'        TO MSG-COD-SIST
               MOVE 'CANPRO NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC        TO FRM-MEN1
               MOVE CAN-KEY-ICAN IN CAN TO FRM-MEN2
               MOVE FIO-BCK-OUT         TO FIO-CMND
               PERFORM COL-FIO-OPC
               GO TO FIN-CMN-ACC.

      * Carga el Credito de la Cancelacion solo si es 'PTT' para rutina LAv
           IF CAN-MSC-CANC IN CAN = 'PTT'
               MOVE CAN-CIC-IOPC IN CAN TO LAV-AOPC IN LAV-VARI(1).
           MOVE ZEROES TO LAV-SCRE IN LAV-VARI(1).
       CON-CMN-ACC-LDA-PRO.
           MOVE 'ACA'                TO LAV-CMND IN LAV-VARI.
           MOVE IDD-FSIS IN IDD-VARI TO LAV-VIDD IN LAV-VARI.
           MOVE LAV-CMMA IN LAV-VARI TO SYS-CMMA.
           MOVE LAV-TCMA IN LAV-VARI TO SYS-TCMA.
           MOVE 'COLPPLAV'           TO SYS-PROG.
           MOVE SYS-LINK             TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA TO LAV-CMMA IN LAV-VARI.
           IF LAV-CMSG IN LAV-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE LAV-CMSG IN LAV-VARI TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC         TO FRM-MEN1
               MOVE LAV-MENS IN LAV-VARI TO FRM-MEN2
               MOVE FIO-BCK-OUT          TO FIO-CMND
               PERFORM COL-FIO-OPC
               GO TO FIN-CMN-ACC.
       CON-CMN-ACC-LDA-FIN.
      *DAD fin  21-JUL-1992
           MOVE OPC-NUM-DINP IN OPC-FLD TO OPC-NUM-DINP IN OPC.
           MOVE OPC-NUM-MINP IN OPC-FLD TO OPC-NUM-MINP IN OPC.
           MOVE OPC-NUM-SINP IN OPC-FLD TO OPC-NUM-SINP IN OPC.
           MOVE OPC-NUM-AINP IN OPC-FLD TO OPC-NUM-AINP IN OPC.
           IF SCR-IND-ACAN = 'NOV' OR 'REN' OR  'PRO'
      *JSS 20-MAY-1991 16:32:18 ( para manejo cuenta corriente )
               IF WSS-OPC-LNBT = 'S' OR 'N'
      *DAD ini  21-AUG-1992   (Memo.12-08-92)
      *             MOVE 'G' TO OPC-MSC-STAT IN OPC
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Por ahora solo se procesan PTT de PRO con LAV con Abono en Cta.Cte.
      *El Abono con Cta.Cte. se activa con 'A' y activa MVO de cta cte
                   MOVE 'S' TO MVO-LINE IN MVO-VARI
      *DAD fin  17-MAY-1993
                   PERFORM GEN-REG-MVO
                   IF MVO-CMSG NOT > SPACES
      *                MOVE 'A' TO OPC-MSC-STAT IN OPC
                       MOVE STO-ACTIVADA IN STO-VARI
                                         TO OPC-MSC-STAT IN OPC
                   ELSE
                       PERFORM BCK-OUT
                       MOVE MVO-CMSG TO MSG-COD-MENS
                       GO TO MSG-CMN-ACC
      *DAD fin  21-AUG-1992
               ELSE
      *
      *        MOVE 'A' TO OPC-MSC-STAT IN OPC
               MOVE STO-ACTIVADA IN STO-VARI TO OPC-MSC-STAT IN OPC
           ELSE
           IF SCR-MSC-TCAN = 'N'
      *        MOVE 'S' TO OPC-MSC-STAT IN OPC
               MOVE STO-SUSPENDIDA IN STO-VARI TO OPC-MSC-STAT IN OPC
           ELSE
      *JSS 17-MAY-1991 11:38:41 ( para manejo de cuenta corriente )
      *Si el abono es con cuenta corriente en linea debe activar con 'A' y
      *generar MVO para cuenta corriente
      *si es con cuenta corriente en batch ( diferido ) debe activar con 'B'
               IF WSS-OPC-LNBT = 'N'
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *El Abono con Cta.Cte. en Batch se activa con 'A' y genera MVO de cta cte
      *             MOVE 'B' TO OPC-MSC-STAT IN OPC
                   PERFORM GEN-REG-MVO
                   IF MVO-CMSG NOT > SPACES
      *                MOVE 'A' TO OPC-MSC-STAT IN OPC
                       MOVE STO-ACTIVADA IN STO-VARI
                                         TO OPC-MSC-STAT IN OPC
                   ELSE
                       PERFORM BCK-OUT
                       MOVE MVO-CMSG TO MSG-COD-MENS
                       GO TO MSG-CMN-ACC
      *DAD fin  17-MAY-1993
               ELSE
               IF WSS-OPC-LNBT = 'S'
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *El Abono con Cta.Cte. en Linea se activa con 'A' y activa MVO de cta cte
                   MOVE 'S' TO MVO-LINE IN MVO-VARI
      *DAD fin  17-MAY-1993
                   PERFORM GEN-REG-MVO
                   IF MVO-CMSG NOT > SPACES
      *                MOVE 'A' TO OPC-MSC-STAT IN OPC
                       MOVE STO-ACTIVADA IN STO-VARI
                                         TO OPC-MSC-STAT IN OPC
                   ELSE
                       PERFORM BCK-OUT
                       MOVE MVO-CMSG TO MSG-COD-MENS
                       GO TO MSG-CMN-ACC
               ELSE
      *
      *        MOVE 'A' TO OPC-MSC-STAT IN OPC.
               MOVE STO-ACTIVADA IN STO-VARI
                                 TO OPC-MSC-STAT IN OPC.
      *HPM ini Rutina VRF-DEL-VEN verifica condiciones para eliminar VEN
           MOVE 'SI' TO WSS-STAT
           PERFORM VRF-DEL-VEN.     
           IF NOT WSS-STAT-OKS
               PERFORM BCK-OUT
               GO TO FIN-CMN-ACC.
      *HPM fin
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               PERFORM BCK-OUT
               GO TO FIN-CMN-ACC.
      *Operacion activada, carga el codigo de mensaje correspondiente
      *ALD/8-AUG-1988
      *    IF OPC-MSC-STAT IN OPC = 'S'
           IF OPC-SUSPENDIDA
               MOVE 'OPC    SUSOK' TO MSG-COD-MENS
           ELSE
      *    IF OPC-MSC-STAT IN OPC = 'A'
           IF OPC-ACTIVADA
               PERFORM UPD-DBR-COPE
               IF FIO-STAT-OKS
                   IF SCR-IND-ACAN = 'NOV'
                       MOVE 'OPC    NOVOK' TO MSG-COD-MENS
                   ELSE
                   IF SCR-IND-ACAN = 'REN'
                       MOVE 'OPC    RENOK' TO MSG-COD-MENS
                   ELSE
                   IF SCR-IND-ACAN = 'PRO'
                       MOVE 'OPC    PROOK' TO MSG-COD-MENS
                   ELSE
                       MOVE 'OPC    ACAOK' TO MSG-COD-MENS
               ELSE
                   GO TO FIN-CMN-ACC
           ELSE
               MOVE 'OPCSTT'            TO MSG-COD-TMSG
               MOVE OPC-MSC-STAT IN OPC TO MSG-COD-CMSG.
      *Llama a parrafo para cambiar operaciones en caso de prorrogas
      *totales ( cancelar totalmente un credito ), SOLO en caso de
      *operaciones activadas con 'A' ( no suspendidas ni en espera )
           IF ( OPC-IND-RENO IN OPC-FLD = 'PRO' ) AND
      *       ( OPC-MSC-STAT IN OPC = 'A' )
              ( OPC-ACTIVADA )
               MOVE OPC-CAI-IOPC IN OPC-FLD TO CEO-CAI-IOPC-PRO
               MOVE OPC-IIC-IOPC IN OPC-FLD TO CEO-IIC-IOPC-PRO
               MOVE EIBTRMID                TO CEO-CAI-IOPC-PSO
               MOVE OPC-IIC-IOPC IN OPC-FLD TO CEO-IIC-IOPC-PSO
               PERFORM CAM-ENT-OPC
               IF CEO-CMSG > SPACES
                   PERFORM BCK-OUT
                   MOVE CEO-CMSG TO MSG-COD-MENS
                   MOVE CEO-MEN2 TO FRM-MEN2
      *DAD ini  21-JUL-1992
                   GO TO MSG-CMN-ACC.

      * Enganche con Rutina que Revisa Linea de Avance, si corresponde
           IF OPC-CAI-ILDC IN OPC-FLD NOT > SPACES AND
              OPC-IIC-ILDC IN OPC-FLD NOT > ZEROES
               GO TO CON-CMN-ACC-RLO-FIN.

           MOVE 'COL'          TO FIO-SIST.
           MOVE 'VSN'          TO TAB-COD-TTAB IN TAB.
           MOVE 'BCI    LAVAN' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT ( FIO-STAT-OKS AND
                    TAB-MSC-STAT IN TAB = 'S' )
               GO TO CON-CMN-ACC-RLO-FIN.

      * Inicializacion de Variables para rutina Linea de Avance
           MOVE SPACES                   TO WSS-CAI-ILDC IN WSS-VARI.
           MOVE ZEROES                   TO WSS-IIC-ILDC IN WSS-VARI.
           MOVE WSS-CIC-ILDC IN WSS-VARI TO LAV-IOPC IN LAV-VARI(1)
                                            LAV-IOPC IN LAV-VARI(2)
                                            LAV-AOPC IN LAV-VARI(1)
                                            LAV-AOPC IN LAV-VARI(2).

      * Cuando es Prorroga Carga el Credito de la Cancelacion y el Credito
      * Activado, para invertir si existe y grabar RLO en rutina LAv
           IF OPC-IND-RENO IN OPC-FLD NOT = 'PRO'
               GO TO CON-CMN-ACC-RLO-PRO.

           MOVE CAN-CAI-IOPC IN OPC-FLD  TO WSS-CAI-ILDC IN WSS-VARI.
           MOVE CAN-IIC-IOPC IN OPC-FLD  TO WSS-IIC-ILDC IN WSS-VARI.
           MOVE WSS-CIC-ILDC IN WSS-VARI TO LAV-IOPC IN LAV-VARI(1).
           MOVE OPC-CAI-IOPC IN OPC-FLD  TO WSS-CAI-ILDC IN WSS-VARI.
           MOVE OPC-IIC-IOPC IN OPC-FLD  TO WSS-IIC-ILDC IN WSS-VARI.
           MOVE WSS-CIC-ILDC IN WSS-VARI TO LAV-AOPC IN LAV-VARI(1).
           MOVE 'PRO'                    TO LAV-CMND IN LAV-VARI.
           MOVE IDD-FSIS IN IDD-VARI     TO LAV-VIDD IN LAV-VARI.
           MOVE LAV-CMMA IN LAV-VARI     TO SYS-CMMA.
           MOVE LAV-TCMA IN LAV-VARI     TO SYS-TCMA.
           MOVE 'COLPPLAV'               TO SYS-PROG.
           MOVE SYS-LINK                 TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA TO LAV-CMMA IN LAV-VARI.
           IF LAV-CMSG IN LAV-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE LAV-CMSG IN LAV-VARI TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC         TO FRM-MEN1
               MOVE LAV-MENS IN LAV-VARI TO FRM-MEN2
               MOVE FIO-BCK-OUT          TO FIO-CMND
               PERFORM COL-FIO-OPC
               GO TO FIN-CMN-ACC.
           GO TO CON-CMN-ACC-RLO-FIN.
       CON-CMN-ACC-RLO-PRO.
      * Carga el Credito de la Cancelacion cuando es Prorroga o el Credito
      * Activado en otros casos para rutina L. Avances
           IF OPC-IND-RENO IN OPC-FLD NOT = 'PRO'
               MOVE OPC-CAI-IOPC IN OPC-FLD  TO WSS-CAI-ILDC IN WSS-VARI
               MOVE OPC-IIC-IOPC IN OPC-FLD  TO WSS-IIC-ILDC IN WSS-VARI
               MOVE WSS-CIC-ILDC IN WSS-VARI TO LAV-IOPC IN LAV-VARI(1)
           ELSE
      *     IF OPC-IND-RENO IN OPC-FLD = 'PRO'
      *         MOVE CAN-CAI-IOPC IN OPC-FLD  TO WSS-CAI-ILDC IN WSS-VARI
      *         MOVE CAN-IIC-IOPC IN OPC-FLD  TO WSS-IIC-ILDC IN WSS-VARI
      *         MOVE WSS-CIC-ILDC IN WSS-VARI TO LAV-IOPC IN LAV-VARI(1)
               GO TO CON-CMN-ACC-RLO-FIN.
           MOVE 'GRA'                TO LAV-CMND IN LAV-VARI.
           MOVE IDD-FSIS IN IDD-VARI TO LAV-VIDD IN LAV-VARI.
           MOVE LAV-CMMA IN LAV-VARI TO SYS-CMMA.
           MOVE LAV-TCMA IN LAV-VARI TO SYS-TCMA.
           MOVE 'COLPPLAV'           TO SYS-PROG.
           MOVE SYS-LINK             TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA TO LAV-CMMA IN LAV-VARI.
           IF LAV-CMSG IN LAV-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE LAV-CMSG IN LAV-VARI TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC         TO FRM-MEN1
               MOVE LAV-MENS IN LAV-VARI TO FRM-MEN2
               MOVE FIO-BCK-OUT          TO FIO-CMND
               PERFORM COL-FIO-OPC
               GO TO FIN-CMN-ACC.
       CON-CMN-ACC-RLO-FIN.
      *DAD fin  21-JUL-1992
       MSG-CMN-ACC.
           MOVE 'COL' TO MSG-COD-SIST.
           PERFORM GET-MSG
           MOVE MSG-GLS-DESC TO FRM-MEN1.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       GEN-REG-MVO SECTION.
       INI-GEN-REG-MVO.
           MOVE SPACES TO MVO-CMSG.
           MOVE OPC-CIC-IOPC IN OPC TO CYA-CIC-IOPC IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICAN IN CYA.
           MOVE 1                   TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-GEN-REG-MVO.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS AND
                    CYA-CIC-IOPC IN CYA = OPC-CIC-IOPC IN OPC AND
                    CYA-NUM-ICAN IN CYA = ZEROES )
               GO TO FIN-GEN-REG-MVO.
      *DAD ini  29-NOV-1991   (Memo.22-11-91)
           IF CYA-SGV-LIQU IN CYA = ZEROES
               GO TO NXT-GEN-REG-MVO.
      *DAD fin  29-NOV-1991
           PERFORM GET-FHOY.
           MOVE HOY-DHOY TO MVO-DPRO.
           MOVE HOY-MHOY TO MVO-MPRO.
           MOVE HOY-SHOY TO MVO-SPRO.
           MOVE HOY-AHOY TO MVO-APRO.
           MOVE 'O'      TO MVO-ORIG.
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Para Proceso Genera y Activa con registro MVO (Pro. Linea)
           EXEC CICS ADDRESS
                     TWA(TWA-PNT0)
           END-EXEC.
      *DAD fin  17-MAY-1993
           PERFORM COL-GEN-MVO.
           IF MVO-CMSG > SPACES
               MOVE MVO-MEN2 TO FRM-MEN2
               GO TO FIN-GEN-REG-MVO.
       NXT-GEN-REG-MVO.
           MOVE FIO-GET-NXT TO FIO-CMND.
           GO TO LUP-GEN-REG-MVO.
       FIN-GEN-REG-MVO.
           EXIT.

       GET-CAN-FRM SECTION.
       INI-GET-CAN-FRM.
           MOVE CAN-CAI-IOPC IN OPC-FLD TO CAN-CAI-IOPC IN CAN.
           MOVE CAN-IIC-IOPC IN OPC-FLD TO CAN-IIC-IOPC IN CAN.
           MOVE CAN-NUM-ICAN IN OPC-FLD TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           MOVE FIO-STAT TO PGM-STAT-CAN.
       FIN-GET-CAN-FRM.
           EXIT.

       PRO-NOV-OPC SECTION.
       INI-PRO-NOV-OPC.
           MOVE SPACES TO MSG-COD-MENS.
      * RECUPERA POR ROV LAS LLAVES LAS OPERACIONES ASOCIADAS
      * A LA CANCELACION QUE ESTA EN LA PANTALLA
           MOVE CAN-CAI-IOPC IN OPC-FLD TO ROV-CAI-IOPV IN ROV.
           MOVE CAN-IIC-IOPC IN OPC-FLD TO ROV-IIC-IOPV IN ROV.
           MOVE CAN-NUM-ICAN IN OPC-FLD TO ROV-NUM-IVCT IN ROV.
           MOVE 'ROV-KEY-IVCT' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
       CIC-PRO-NOV-OPC.
           PERFORM COL-FIO-ROV.
           IF FIO-STAT-OKS AND
              CAN-CAI-IOPC IN OPC-FLD = ROV-CAI-IOPV IN ROV AND
              CAN-IIC-IOPC IN OPC-FLD = ROV-IIC-IOPV IN ROV
                PERFORM PRO-OPC-ROV
                IF MSG-COD-MENS NOT > SPACES
                      MOVE 'ROV-KEY-IVCT' TO FIO-AKEY
                      MOVE FIO-GET-NXT TO FIO-CMND
                      GO TO CIC-PRO-NOV-OPC.
           MOVE 'COL' TO MSG-COD-SIST.
           MOVE 'OPC    NOVOK' TO MSG-COD-MENS.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
       FIN-PRO-NOV-OPC.
           EXIT.

       PRO-OPC-ROV SECTION.
       INI-PRO-OPC-ROV.
           IF ROV-MSC-STAT IN ROV NOT = 'S'
                GO TO FIN-PRO-OPC-ROV.
           MOVE ROV-CIC-IOPC IN ROV TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-OPC.
      *    IF OPC-MSC-STAT = 'S'
           IF OPC-SUSPENDIDA
               PERFORM MOD-ROV
               PERFORM PRO-OPC-CYA.
           PERFORM ACT-OPC-OPC.
           PERFORM UPD-DBR-COPE.
       FIN-PRO-OPC-ROV.
           EXIT.

       ACT-OPC-ROV SECTION.
       INI-ACT-OPC-ROV.
           PERFORM KEY-ALL-OPC.
           MOVE OPC-CIC-IOPC IN OPC TO ROV-CIC-IOPC IN ROV.
           MOVE CAN-KEY-ICAN IN CAN TO ROV-KEY-IVCT IN ROV.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-ROV.

           IF SCR-IND-ACAN = 'NOV'
      *         MOVE ROV-SGV-RENO IN OPC-FLD TO ROV-SGV-RENO IN ROV
               MOVE 'A' TO ROV-MSC-STAT
           ELSE
               MOVE 'S' TO ROV-MSC-STAT.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-ROV.
      *ALD
      *     MOVE FIO-GET-KEY-UPD TO FIO-CMND.
      *     PERFORM COL-FIO-OPC.
       FIN-ACT-OPC-ROV.
           EXIT.

      *HPM ini
       VRF-DEL-VEN SECTION.
       INI-VRF-DEL-VEN.
      *Busca primer DLC para conocer Tipo de Docto. asociado
           MOVE OPC-CAI-IOPC IN OPC TO DLC-CAI-IOPC IN DLC.
           MOVE OPC-IIC-IOPC IN OPC TO DLC-IIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT ( FIO-STAT-OKS AND
                    DLC-CIC-IOPC IN DLC = OPC-CIC-IOPC IN OPC )
               MOVE 'COL'               TO MSG-COD-SIST
               MOVE 'DLC    NEX  '      TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC IN MSG TO FRM-MEN1
               MOVE DLC-KEY-IDLC IN DLC TO FRM-MEN2
               MOVE 'NO' TO WSS-STAT
               GO TO FIN-VRF-DEL-VEN.
      *Busca codigo computacional del codigo tipo de documento del DLC
           MOVE 'TAB'               TO FIO-SIST.
           MOVE 'DOC'               TO TAB-COD-TTAB IN TAB.
           MOVE DLC-COD-TDOC IN DLC TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'               TO MSG-COD-SIST
               MOVE 'CICTDOCNEX  '      TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC IN MSG TO FRM-MEN1
               MOVE DLC-COD-TDOC IN DLC TO FRM-MEN2
               MOVE 'NO' TO WSS-STAT
               GO TO FIN-VRF-DEL-VEN.
           IF TAB-CIC-CTAB IN TAB = 'LTR' AND
              OPC-IND-VSTR IN OPC = 'N'
               PERFORM DEL-VEN.
       FIN-VRF-DEL-VEN.
           EXIT.
       DEL-VEN SECTION.
       INI-DEL-VEN.
           MOVE OPC-CAI-IOPC IN OPC TO DLC-CAI-IOPC IN DLC.
           MOVE OPC-IIC-IOPC IN OPC TO DLC-IIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS         TO FIO-CMND.
       LUP-DEL-VEN.
           PERFORM COL-FIO-DLC.
           IF NOT ( FIO-STAT-OKS AND
                    DLC-CIC-IOPC IN DLC = OPC-CIC-IOPC IN OPC )
               GO TO FIN-DEL-VEN.
           IF DLC-MSC-STAT IN DLC NOT = 'R'
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-DEL-VEN.
           MOVE DLC-CAI-IOPC IN DLC TO VEN-CAI-IOPC IN VEN.
           MOVE DLC-IIC-IOPC IN DLC TO VEN-IIC-IOPC IN VEN.
           MOVE DLC-NUM-IDLC IN DLC TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY-UPD     TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'               TO MSG-COD-SIST
               MOVE 'VEN    NEX  '      TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC IN MSG TO FRM-MEN1
               MOVE VEN-KEY-IVEN IN VEN TO FRM-MEN2
               MOVE 'NO' TO WSS-STAT
               GO TO FIN-DEL-VEN.
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM COL-FIO-VEN.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               MOVE 'NO' TO WSS-STAT
               GO TO FIN-DEL-VEN.
           MOVE FIO-GET-NXT  TO FIO-CMND.
           GO TO LUP-DEL-VEN.
       FIN-DEL-VEN.
           EXIT.
      *HPM fin

       MOD-ROV SECTION.
       INI-MOD-ROV.
      *Debe hacerse por llave principal
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           IF SCR-IND-ACAN = 'NOV'
               MOVE 'A' TO ROV-MSC-STAT
           ELSE
               MOVE 'S' TO ROV-MSC-STAT.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-ROV.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ROV.
       FIN-MOD-ROV.
           EXIT.

       PRO-OPC-CYA SECTION.
       INI-PRO-OPC-CYA.
           MOVE SPACES TO MSG-COD-MENS.
           PERFORM GET-CUR-CYA.
           PERFORM CRG-SAF.
           IF NOT FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'SAFE   ERR' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
           ELSE
               MOVE SPACES TO MSG-COD-MENS.
       FIN-PRO-OPC-CYA.
           EXIT.

       ACT-OPC-OPC SECTION.
       INI-ACT-OPC-OPC.
           MOVE OPC-NUM-DINP IN OPC-FLD TO OPC-NUM-DINP IN OPC.
           MOVE OPC-NUM-MINP IN OPC-FLD TO OPC-NUM-MINP IN OPC.
           MOVE OPC-NUM-SINP IN OPC-FLD TO OPC-NUM-SINP IN OPC.
           MOVE OPC-NUM-AINP IN OPC-FLD TO OPC-NUM-AINP IN OPC.
      *JSS 17-MAY-1991 11:38:41 ( para manejo de cuenta corriente )
           IF WSS-OPC-LNBT = 'S' OR 'N'
      *        MOVE 'G' TO OPC-MSC-STAT IN OPC
               MOVE STO-ESPERA-ENVIO-ABONO IN STO-VARI
                                           TO OPC-MSC-STAT IN OPC
      *DAD ini  17-MAY-1993   (Memo.12-05-93)
      *Por ahora no se procesan NOV con Abono en Cta.Cte., por lo que NO
      *se Incorporo manejo del Abono/Cargo en Cta.Cte. ( Linea / Batch )
      *y de la MVO de Cta.Cte. ( Activar / Generar ).
      *DAD fin  17-MAY-1993
           ELSE
      *
      *    MOVE 'A' TO OPC-MSC-STAT IN OPC.
           MOVE STO-ACTIVADA IN STO-VARI TO OPC-MSC-STAT IN OPC.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-OPC.
       FIN-ACT-OPC-OPC.
           EXIT.

      *ALD/8-AUG-1988
       UPD-DBR-COPE SECTION.
       INI-UPD-DBR-COPE.
           MOVE SYS-GET-DATE TO SYS-CMND.
           PERFORM GNS-PRO-SYS.

      *ISP NO ACTUALIZA DBD PARA VERSION BCI.
           MOVE 'COL' TO TAB-COD-SIST.
           MOVE 'VSN' TO TAB-COD-TTAB IN TAB.
           MOVE 'BCI    ADBD' TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS NOT > SPACES
               PERFORM GET-UPD-DBD
               IF NOT FIO-STAT-OKS
                   GO TO FIN-UPD-DBR-COPE
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE SPACES TO MSG-COD-MENS.
      
      *ISP NO ACTUALIZA RCO PARA VERSION BCI.
           MOVE 'COL' TO TAB-COD-SIST.
           MOVE 'VSN' TO TAB-COD-TTAB IN TAB.
           MOVE 'BCI    ARCO' TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS NOT > SPACES
              PERFORM GET-UPD-RCO
              IF NOT FIO-STAT-OKS
                  GO TO FIN-UPD-DBR-COPE
              ELSE
                  NEXT SENTENCE
            ELSE
                MOVE SPACES TO MSG-COD-MENS.
      *ISP NO ACTUALIZA OPE PARA VERSION BCI.
           MOVE 'COL' TO TAB-COD-SIST.
           MOVE 'VSN' TO TAB-COD-TTAB IN TAB.
           MOVE 'BCI    AOPE' TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS NOT > SPACES
               PERFORM GET-UPD-OPE
               IF FIO-STAT-OKS
                   PERFORM BCK-OUT
                   MOVE 'COL' TO MSG-COD-SIST
                   MOVE 'OPE    YAEXI' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FIO-STAT-NEX TO FIO-STAT
                   GO TO FIN-UPD-DBR-COPE
               ELSE
                   PERFORM PUT-OPE
           ELSE
               MOVE SPACES TO MSG-COD-MENS.
       FIN-UPD-DBR-COPE.
           EXIT.

       GET-UPD-DBD SECTION.
       INI-GET-UPD-DBD.
           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC'      TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = RDC-CIC-IOPC IN RDC )
               MOVE '00' TO FIO-STAT
               GO TO FIN-GET-UPD-DBD.
       LUP-GET-UPD-DBD.
           IF RDC-NUM-IDLC IN RDC > ZEROES
               GO TO NXT-GET-RDC-DBD.
           MOVE RDC-CIC-ICLI IN RDC TO DBD-CIC-ICLI IN DBD.
           MOVE OPC-STP-ITRN IN OPC TO DBD-STP-ITRN IN DBD.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DEU-FIO-DBD.
           IF NOT FIO-STAT-OKS
               GO TO ING-DBD.
           ADD OPC-NUM-VCVG IN OPC TO DBD-NUM-VCVG IN DBD.
           ADD 1 TO DBD-NUM-OCTD IN DBD.
           ADD 1 TO DBD-NUM-OCVG IN DBD.
           IF OPC-FEC-FCOL IN OPC     < DBD-FEC-FPCR IN DBD OR
              DBD-FEC-FPCR IN DBD NOT > ZEROES
               MOVE OPC-FEC-FCOL IN OPC TO DBD-FEC-FPCR IN DBD.
           IF OPC-FEC-FCOL IN OPC > DBD-FEC-FUCR IN DBD
               MOVE OPC-FEC-FCOL IN OPC TO DBD-FEC-FUCR IN DBD.
       MOD-DBD.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM DEU-FIO-DBD.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-GET-UPD-DBD.
           GO TO NXT-GET-RDC-DBD.
       ING-DBD.
           MOVE OPC-NUM-VCVG IN OPC TO DBD-NUM-VCVG IN DBD.
           PERFORM INI-REG-DBD.
           MOVE 1 TO DBD-NUM-OCTD IN DBD.
           MOVE 1 TO DBD-NUM-OCVG IN DBD.
           MOVE OPC-FEC-FCOL IN OPC TO DBD-FEC-FPCR IN DBD.
           MOVE OPC-FEC-FCOL IN OPC TO DBD-FEC-FUCR IN DBD.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DEU-FIO-DBD.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT
               GO TO FIN-GET-UPD-DBD.
       NXT-GET-RDC-DBD.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = RDC-CIC-IOPC IN RDC )
               MOVE '00' TO FIO-STAT
               GO TO FIN-GET-UPD-DBD.
           GO TO LUP-GET-UPD-DBD.
       FIN-GET-UPD-DBD.
           EXIT.

       GET-UPD-RCO SECTION.
       INI-GET-UPD-RCO.
           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC.
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC'      TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = RDC-CIC-IOPC IN RDC )
               MOVE '00' TO FIO-STAT
               GO TO FIN-GET-UPD-RCO.
       LUP-GET-UPD-RCO.
           MOVE RDC-CIC-ICLI IN RDC TO RCO-CIC-ICLI IN RCO.
           MOVE OPC-CIC-IOPC IN OPC TO RCO-CIC-IOPE IN RCO.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF FIO-STAT-OKS
               GO TO NXT-GET-RDC-RCO.
           PERFORM PUT-RCO.
           IF NOT FIO-STAT-OKS
               GO TO FIN-GET-UPD-RCO.
       NXT-GET-RDC-RCO.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT ( FIO-STAT-OKS AND
                    OPC-CIC-IOPC IN OPC = RDC-CIC-IOPC IN RDC )
               MOVE '00' TO FIO-STAT
               GO TO FIN-GET-UPD-RCO.
           GO TO LUP-GET-UPD-RCO.
       FIN-GET-UPD-RCO.
           EXIT.

       GET-UPD-OPE SECTION.
       INI-GET-UPD-OPE.
           MOVE OPC-CIC-IOPC IN OPC TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
       FIN-GET-UPD-OPE.
           EXIT.

       PUT-RCO SECTION.
       INI-PUT-RCO.
           MOVE SYS-TSTP TO RCO-STP-ITRN IN RCO.
           PERFORM INI-REG-RCO.
           MOVE RDC-CIC-ICLI IN RDC TO RCO-CIC-ICLI IN RCO.
           MOVE OPC-CIC-IOPC IN OPC TO RCO-CIC-IOPE IN RCO.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT.
       FIN-PUT-RCO.
           EXIT.
         
       PUT-OPE SECTION.
       INI-PUT-OPE.
           MOVE SYS-TSTP TO OPE-STP-ITRN IN OPE.
           PERFORM INI-REG-OPE.
           MOVE OPC-CIC-IOPC IN OPC TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               PERFORM BCK-OUT.
       FIN-PUT-OPE.
           EXIT.
         
       BCK-OUT SECTION.
       INI-BCK-OUT.
           MOVE FIO-BCK-OUT TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF FIO-STAT-OKS
               MOVE '49' TO FIO-STAT.
       FIN-BCK-OUT.
           EXIT.

       INI-REG-DBD SECTION.
       INI-INI-REG-DBD.
           MOVE SPACES                     TO DBD-GLS-FLAG IN DBD.
           MOVE SPACES                     TO DBD-MSC-TACC IN DBD.
           MOVE SPACES                     TO DBD-COD-OTRN IN DBD.
           MOVE SPACES                     TO DBD-COD-ATRN IN DBD.
           MOVE ZEROES                     TO DBD-SAM-PIVA IN DBD.
           MOVE SPACES                     TO DBD-IND-CASB IN DBD.
           MOVE SPACES                     TO DBD-IND-DVCB IN DBD.
           MOVE SPACES                     TO DBD-IND-DVDB IN DBD.
           MOVE SPACES                     TO DBD-IND-GARV IN DBD.
           MOVE SPACES                     TO DBD-IND-DLDC IN DBD.
           MOVE ZEROES                     TO DBD-NUM-SOLR IN DBD.
           MOVE ZEROES                     TO DBD-NUM-VCCO IN DBD.
           MOVE ZEROES                     TO DBD-NUM-VCCA IN DBD.
           MOVE ZEROES                     TO DBD-NUM-VCCP IN DBD.
           MOVE ZEROES                     TO DBD-NUM-VCCR IN DBD.
           MOVE ZEROES                     TO DBD-FEC-FUCA IN DBD.
           MOVE ZEROES                     TO DBD-FEC-FEMA IN DBD.
           MOVE ZEROES                     TO DBD-VAL-EMUF IN DBD.
           MOVE ZEROES                     TO DBD-VAL-EPUF IN DBD.
           MOVE SPACES                     TO DBD-IND-CRCB IN DBD.
           MOVE ZEROES                     TO DBD-FEC-FCRI IN DBD.
           MOVE SPACES                     TO DBD-IND-CRVB IN DBD.
           MOVE SPACES                     TO DBD-IND-CRCS IN DBD.
           MOVE SPACES                     TO DBD-IND-CRVS IN DBD.
           MOVE SPACES                     TO DBD-GLS-DISP IN DBD.
       FIN-INI-REG-DBD.
           EXIT.

       INI-REG-RCO SECTION.
       INI-INI-REG-RCO.
           MOVE SPACES                     TO RCO-GLS-FLAG IN RCO.
           MOVE SPACES                     TO RCO-MSC-TACC IN RCO.
           MOVE SPACES                     TO RCO-MSC-STAT IN RCO.
           MOVE SPACES                     TO RCO-COD-OTRN IN RCO.
           MOVE SPACES                     TO RCO-COD-ATRN IN RCO.
           MOVE SPACES                     TO RCO-COD-STAT IN RCO.
           MOVE 'TAB'                      TO FIO-SIST.
           MOVE 'RCO'                      TO TAB-CIC-TTAB IN TAB.
           IF RDC-NUM-IDLC IN RDC NOT > ZEROES
               MOVE 'DIR' TO TAB-CIC-CTAB IN TAB
           ELSE
               MOVE 'IND' TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL'  TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           MOVE TAB-COD-CTAB IN TAB TO RCO-COD-RCOP IN RCO.
           MOVE RDC-NUM-DIRE IN RDC TO RCO-NUM-DIRE IN RCO.
           MOVE RDC-VAL-LIMD IN RDC TO RCO-VAL-PRCO IN RCO.
           MOVE OPC-COD-COOC IN OPC TO RCO-COD-COPR IN RCO.
           MOVE SPACES              TO RCO-GLS-DISP IN RCO.
       FIN-INI-REG-RCO.
           EXIT.

       INI-REG-OPE SECTION.
       INI-INI-REG-OPE.
           MOVE SPACES                     TO OPE-GLS-FLAG IN OPE.
           MOVE SPACES                     TO OPE-MSC-TACC IN OPE.
           MOVE SPACES                     TO OPE-MSC-STAT IN OPE.
           MOVE SPACES                     TO OPE-COD-OTRN IN OPE.
           MOVE SPACES                     TO OPE-COD-ATRN IN OPE.
           MOVE SPACES                     TO OPE-COD-STAT IN OPE.
           MOVE OPC-COD-VCOC IN OPC        TO OPE-COD-VCOP IN OPE.
           MOVE OPC-COD-COOC IN OPC        TO OPE-COD-COPR IN OPE.
           MOVE OPC-COD-OFOC IN OPC        TO OPE-COD-OFOP IN OPE.
           MOVE OPC-COD-RMOC IN OPC        TO OPE-COD-EJOP IN OPE.
           MOVE OPC-FEC-FCOL IN OPC        TO OPE-FEC-FIOP IN OPE.
           MOVE ZEROES                     TO OPE-FEC-FTOP IN OPE.
           MOVE SPACES                     TO OPE-COD-MOTT IN OPE.
           MOVE ZEROES                     TO OPE-FEC-FROP IN OPE.
           MOVE SPACES                     TO OPE-IND-MCLI IN OPE.
      *    MOVE SPACES                     TO OPE-GLS-DISP IN OPE.
       FIN-INI-REG-OPE.
           EXIT.
      *
               
       CRG-SAF SECTION.
       INI-CRG-SAF.
           IF CYA-IND-MAUT IN CYA NOT = 'S'
               GO TO NXT-GET-CYA.

           IF CYA-SGV-LIQU IN CYA NOT > ZEROES
               MOVE '0670'          TO ICC-COD-TRAN IN ICC
           ELSE
               MOVE '0770'          TO ICC-COD-TRAN IN ICC.
           MOVE '01'                TO ICC-IND-INDI IN ICC.
           MOVE CYA-CIC-ICYA IN CYA TO ICC-COD-CCTE IN ICC.
           IF CYA-SGV-LIQU IN CYA NOT > ZEROES
               MOVE  '000000000072' TO ICC-COD-SERI IN ICC
           ELSE
               MOVE  '000000000052' TO ICC-COD-SERI IN ICC.
           MOVE ZEROES              TO ICC-SGV-VPE2 IN ICC.
           MOVE CYA-SGV-LIQU IN CYA TO ICC-SGV-VPE2 IN ICC.
           MOVE '0'                 TO ICC-IND-TCAM IN ICC.
           MOVE 1                   TO ICC-SGV-VCON IN ICC.
           MOVE OPC-COD-OFOC IN OPC TO ICC-COD-OFOC IN ICC.
           MOVE SPACES              TO ICC-COD-UBIC IN ICC.
           MOVE SPACES              TO ICC-COD-ITRE IN ICC.
           MOVE SPACES              TO ICC-GLS-DISP IN ICC.

      *ISP PONE VALORES EN VARIABLES FIO PARA QUE EN CASO DE FALLAR
      *    EL WRITE, LAS DECLARATIVAS ENTREGEN INFORMACION CORRECTA
      *    NO SE USA FIO, PUES ARCHIVO SAM ==> CLAUSULA 'RBA'

           MOVE FIO-PUT TO FIO-CMND.
           MOVE 'COLVSAF' TO FIO-VOID.
           MOVE ICC TO FIO-DFLD.
           MOVE 100 TO FIO-RLEN.

      *     EXEC CICS WRITE
      *                 DATASET('COLVSAF')
      *                 FROM(ICC)
      *                 LENGTH(100)
      *                 RIDFLD(SAF-COD-TRN)
      *                 RBA
      *     END-EXEC.
           MOVE '00' TO FIO-STAT.
      *
           IF NOT FIO-STAT-OKS
               GO TO FIN-CRG-SAF.
        
       NXT-GET-CYA.
           PERFORM GET-NXT-CYA.
           IF MSG-COD-MENS = 'OPC    MCYA'
               GO TO INI-CRG-SAF.
       FIN-CRG-SAF.
           EXIT.

       GET-CUR-CYA SECTION.
       INI-GET-CUR-CYA.
           MOVE 'CYA-KEY-ICYA' TO FIO-AKEY.
           MOVE OPC-CIC-IOPC IN OPC TO CYA-CIC-IOPC IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICAN IN CYA.
           MOVE 1                   TO CYA-NUM-ICYA IN CYA.
      *DSP COMPATIBILIDAD VSAM-DTC FIO-GET-KEY TO FIO-CMND.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF FIO-STAT-OKS AND      
              CYA-CIC-IOPC IN CYA = OPC-CIC-IOPC IN OPC AND
              CYA-NUM-ICAN IN CYA = ZEROES AND
              CYA-NUM-ICYA IN CYA = 1
               NEXT SENTENCE
           ELSE
               MOVE '23' TO FIO-STAT.
      *DSP COMPATIBILIDAD VSAM-DTC
       FIN-GET-CUR-CYA.
           EXIT.

       GET-NXT-CYA SECTION.
       INI-GET-NXT-CYA.
           MOVE SPACES TO MSG-COD-SIST.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE 'CYA-KEY-ICYA' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF FIO-STAT-OKS                              AND
              OPC-CIC-IOPC IN OPC = CYA-CIC-IOPC IN CYA AND
              CYA-NUM-ICAN IN CYA = ZEROES
               MOVE 'M' TO SCR-IND-MCYA
               MOVE 'COL'         TO MSG-COD-SIST
               MOVE 'OPC    MCYA' TO MSG-COD-MENS
               PERFORM GET-MSG
           ELSE
               MOVE SPACES TO SCR-IND-MCYA
               PERFORM GET-CUR-CYA.
       FIN-GET-NXT-CYA.
           EXIT.

      *Revisa el primer CYA asociado a la OPC para ver si tiene cargo en
      *cuenta corriente y si es linea o batch
       BUS-TCYA-LOB SECTION.
       INI-BUS-TCYA-LOB.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE SPACES TO WSS-OPC-LNBT IN WSS-VARI.
           MOVE OPC-CIC-IOPC IN OPC TO CYA-CIC-IOPC IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICAN IN CYA.
           MOVE 1                   TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF NOT FIO-STAT-OKS
               MOVE 'CYA    NEX' TO MSG-COD-MENS
               MOVE CYA-KEY-ICYA IN CYA TO FRM-MEN2
               GO TO FIN-BUS-TCYA-LOB.
           IF CYA-IND-TCYA IN CYA > SPACES
               MOVE 'TCYA'              TO MSC-COD-TMSC IN MSC
               MOVE CYA-IND-TCYA IN CYA TO MSC-COD-CMSC IN MSC
               MOVE 'TAB'       TO FIO-SIST
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-MSC
               IF FIO-STAT-OKS
                   IF MSC-CIC-CMSC IN MSC = 'CC'
                       IF MSC-COD-DAT1(2) = 'S' OR 'N' OR 'M'
                           MOVE MSC-COD-DAT1(2) TO WSS-OPC-LNBT
                       ELSE
                           MOVE 'MSCTCYACCLB?' TO MSG-COD-MENS
                           MOVE MSC-COD-TABL IN MSC TO FRM-MEN2
                   ELSE
                       NEXT SENTENCE
               ELSE
                   MOVE 'MSC    NEX' TO MSG-COD-MENS
                   MOVE MSC-COD-TABL IN MSC TO FRM-MEN2.
       FIN-BUS-TCYA-LOB.
           EXIT.

       BUS-FAM SECTION.
       INI-BUS-FAM.
       FIN-BUS-FAM.
           EXIT.

       COPY GNSBPFEC.
       COPY COLBFDLC.
       COPY COLBFEVC.
       COPY COLBFVEN.
       COPY COLBFPOC.
       COPY COLBFCCB.
       COPY COLBFCCR.
       COPY COLBFCCT.
       COPY COLBFCUF.
       COPY COLBFICG.
       COPY COLBFRCE.
       COPY COLBFRCV.
       COPY COLBFRDT.
       COPY COLBFRDC.
       COPY SGCBFDBC.
       COPY COLBFCYA.
       COPY COLBFROV.
       COPY COLBFCAN.
       COPY COLBFTOC.
       COPY COLBGMVO.

       COPY SGCBGDOM.
       COPY GNSBGCPT.
       COPY GNSBGSTR.
       COPY SGCBFRCO.
       COPY SGCBFOPE.
       COPY SGCBFRCD.
      *ALD/8-AUG-1988
       COPY DEUBFDBD.
      *
       COPY GNSBGPES.
      *
       COPY GNSBGCAM.
       COPY TABBFCAM.
      *ISP VAL-COD Y VAL-TAB NECESARIOS SOLO MIENTRAS SE MANTENGA
      *    MANEJO DE VERSIONES BCI
       COPY COLBGTCT.
       COPY COLBGCEO.
      *>>>>
*% END
