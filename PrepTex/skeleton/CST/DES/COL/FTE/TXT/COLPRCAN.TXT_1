*%! Codigo adicional para archivo
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
       COPY COLWGENG.
       COPY COLW1CAN.
       COPY GNSWGRQA REPLACING ==01  ADR-REQA== BY
                           ==02  SCR-CAN-REQA==.
      *>>>>
*% END
*% CMA_USR = TRUE
*% TCA = 3000
*% IF CMA
      *<<<< CMA
           02 FILLER                      PIC X(3000).
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CYA-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ICG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ITR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ROV-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VLR-REQA==.
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       COPY COLBRCYA.
       COPY COLBRICG.
       COPY COLBRITR.
       COPY COLBROPC.
       COPY COLBRRCV.
       COPY COLBRROV.
       COPY COLBRVEN.
       COPY COLBRRDC.
       COPY SGCBRDBC.
       COPY SGCBRRCO.
       COPY SGCBROPE.
       COPY GNSWGCPT.
       COPY GNSWGCIC.
       COPY GNSBRCIC.
       COPY TABBRCAM.
       COPY TABBRVLR.

       COPY COLW2CAN.

      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           IF SCR-DESDE-CMN
               MOVE SPACES TO SCR-COD-TICG
                              SCR-COD-TITR
                              SCR-COD-VCOC
                              SCR-IND-MCYA.
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           MOVE +3000 TO SCR-TCMA.
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
       COPY COLB1CAN.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
       COPY COLB2CAN.
      *>>>>
*% END
*% IF INI_CMN_ACC
      *<<<< INI_CMN_ACC
      *     IF SCR-CMND NOT = 'REV'
      *         MOVE 'GNS' TO MSG-COD-SIST
      *         MOVE 'CMDINV' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         MOVE MSG-GLS-DESC TO FRM-MENS
      *         GO TO FIN-CMN-ACC.
      *>>>>
*% END
*% IF CMN_ACC_RET
      *<<<< CMN_ACC_RET
           MOVE 'R' TO CAN-MSC-STAT IN CAN.
      *ISP NO HACE RET-ALL DEL ESQUELETO
           GO TO NOT-RET-ALL.
      *>>>>
*% END
*% IF CMN_ACC
      *<<<< CMN_ACC

       NOT-RET-ALL.
      * REGRABA CANCELACION CON STATUS 'R'
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM COL-FIO-CAN.
      * ISP ASUMO QUE NO PIERDO LOS DATOS DEL REGISTRO CAN

           MOVE CAN-NUM-ICAN IN CAN TO WSS-NUM-ICAN-OLD.

           MOVE 1 TO WSS-NUM-ICAN.
           PERFORM BUS-NEW-CAN.
           MOVE CAN-NUM-ICAN IN CAN TO WSS-NUM-ICAN-NEW.

           SUBTRACT CAN-SGV-GAST IN CAN FROM 0 GIVING
                    CAN-SGV-GAST IN CAN.
           SUBTRACT CAN-SGV-TPAG IN CAN FROM 0 GIVING
                    CAN-SGV-TPAG IN CAN.
           SUBTRACT CAN-SGV-TREN IN CAN FROM 0 GIVING
                    CAN-SGV-TREN IN CAN.
           SUBTRACT CAN-NUM-TVCC IN CAN FROM 0 GIVING
                    CAN-NUM-TVCC.

      * TOMA EL PRIMER CYA 
           MOVE 1 TO WSS-NUM-ICYA.
           PERFORM PRO-CYA.
           PERFORM PRO-RCV.
           PERFORM PRO-ITR.
           IF NOT FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CAN    ITRNO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-CMN-ACC.
           MOVE 'E' TO CAN-MSC-STAT IN CAN.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF FIO-STAT-OKS
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CAN    REVOK' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
           ELSE
               MOVE 'COL' TO MSG-COD-SIST
               MOVE 'CAN    REVNO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF

       COPY COLB3CAN.

       PRO-CYA SECTION.
       INI-PRO-CYA.
           MOVE CAN-CIC-IOPC IN CAN TO CYA-CIC-IOPC IN CYA.
           MOVE WSS-NUM-ICAN-OLD    TO CYA-NUM-ICAN IN CYA.
           MOVE WSS-NUM-ICYA        TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF NOT ( FIO-STAT-OKS AND
                    CAN-CIC-IOPC IN CAN = CYA-CIC-IOPC IN CYA AND
                    WSS-NUM-ICAN-OLD    = CYA-NUM-ICAN IN CYA )
               GO TO FIN-PRO-CYA.

           SUBTRACT CYA-SGV-LIQU IN CYA FROM 0 GIVING
                    CYA-SGV-LIQU IN CYA.
           MOVE WSS-NUM-ICAN-NEW TO CYA-NUM-ICAN IN CYA.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF FIO-STAT-OKS
               ADD 1 TO WSS-NUM-ICYA
               GO TO INI-PRO-CYA.
       FIN-PRO-CYA.
           EXIT.

       PRO-RCV SECTION.
       INI-PRO-RCV.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPC IN RCV.
           MOVE CAN-CIC-IOPC IN CAN TO RCV-CIC-IOPV IN RCV.
           MOVE VEN-NUM-IVEN IN CAN-FLD TO RCV-NUM-IVCT IN RCV.
           MOVE WSS-NUM-ICAN-OLD TO RCV-NUM-ICAN IN RCV.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-RCV.
           IF NOT FIO-STAT-OKS
               GO TO FIN-PRO-RCV.
           
           MOVE WSS-NUM-ICAN-NEW TO RCV-NUM-ICAN IN RCV.
           SUBTRACT RCV-SGV-CAPI IN RCV FROM 0 GIVING
                    RCV-SGV-CAPI IN RCV.
           SUBTRACT RCV-SGV-FINA IN RCV FROM 0 GIVING
                    RCV-SGV-FINA IN RCV.
           SUBTRACT RCV-SGV-REAJ IN RCV FROM 0 GIVING
                    RCV-SGV-REAJ IN RCV.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM COL-FIO-RCV.
       FIN-PRO-RCV.
           EXIT.
           
       PRO-ITR SECTION.
       INI-PRO-ITR.
           MOVE 'ITR-KEY-IICG' TO FIO-AKEY.
           MOVE CAN-CIC-IOPC IN CAN     TO ITR-CIC-IOPC IN ITR.
           MOVE WSS-NUM-ICAN-OLD        TO ITR-NUM-ICAN IN ITR.
           MOVE CAN-CIC-IOPC IN CAN     TO ITR-CIC-IOPV IN ITR.
           MOVE ZEROES                  TO ITR-NUM-IVCT IN ITR.
           MOVE 'INT'                   TO ITR-IND-TTAS IN ITR.
           MOVE ZEROES                  TO ITR-FEC-FINI IN ITR.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-ITR.
           IF FIO-STAT-OKS
                MOVE WSS-NUM-ICAN-NEW TO
                     ITR-NUM-ICAN IN ITR
                MOVE FIO-PUT TO FIO-CMND
                PERFORM COL-FIO-ITR
            ELSE
      *ISP SI NO EXISTE TASA NO IMPLICA ERROR
                MOVE '00' TO FIO-STAT.
       FIN-PRO-ITR.
           EXIT.

       GET-CUR-CYA SECTION.
       INI-GET-CUR-CYA.
           MOVE 'CYA-KEY-ICYA' TO FIO-AKEY.
           MOVE OPC-CIC-IOPC IN OPC TO CYA-CIC-IOPC IN CYA.
           MOVE ZEROES              TO CYA-NUM-ICAN IN CYA.
           MOVE 1                   TO CYA-NUM-ICYA IN CYA.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-CYA.
       FIN-GET-CUR-CYA.
           EXIT.

       GET-NXT-CYA SECTION.
       INI-GET-NXT-CYA.
           MOVE SPACES TO MSG-COD-SIST.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE 'CYA-KEY-ICYA' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-CYA.
           IF FIO-STAT-OKS                              AND
              OPC-CIC-IOPC IN OPC = CYA-CIC-IOPC IN CYA AND
              CYA-NUM-ICAN IN CYA = ZEROES
               MOVE 'M' TO SCR-IND-MCYA
               MOVE 'COL'         TO MSG-COD-SIST
               MOVE 'OPC    MCYA' TO MSG-COD-MENS
               PERFORM GET-MSG
           ELSE
               MOVE SPACES TO SCR-IND-MCYA
               PERFORM GET-CUR-CYA.
       FIN-GET-NXT-CYA.
           EXIT.

       BUS-NEW-CAN SECTION.
       INI-BUS-NEW-CAN.
           MOVE 999 TO CAN-NUM-ICAN IN CAN.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM COL-FIO-CAN.
           IF NOT ( FIO-STAT-OKS AND
                    CAN-CAI-IOPC IN CAN-FLD = CAN-CAI-IOPC IN CAN AND
                    CAN-IIC-IOPC IN CAN-FLD = CAN-IIC-IOPC IN CAN )
               PERFORM KEY-ALL-CAN
               MOVE ZEROES TO CAN-NUM-ICAN IN CAN.
           IF WSS-NUM-ICAN = 1
               ADD 1 TO CAN-NUM-ICAN IN CAN
               MOVE CAN-NUM-ICAN IN CAN TO CAN-NUM-ICAN IN CAN-FLD.
           MOVE 1 TO WSS-ICOR.
       FIN-BUS-NEW-CAN.
           EXIT.

       COPY COLBFCYA.
       COPY COLBFICG.
       COPY COLBFITR.
       COPY COLBFOPC.
       COPY COLBFRCV.
       COPY COLBFROV.
       COPY COLBFVEN.
       COPY COLBFRDC.
       COPY SGCBFDBC.
       COPY SGCBFRCO.
       COPY SGCBFOPE.
       COPY GNSBGCPT.
       COPY COLBGCLI.
       COPY GNSBGCIC.
       COPY GNSBFCIC.
       COPY TABBFCAM.
       COPY TABBFVLR.
       COPY GNSBGCAM.
      *>>>>
*% END
