*%! Codigo adicional para archivo
*% IF WSS
      *<<<< WSS
       COPY TABBROFI.
       COPY TABBRTIO.
       COPY COLBRDLC.
       COPY COLBRTOC.
       COPY COLBRRDC.
       COPY SGCBRDBC.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGCPT.
       COPY COLWGCTO.

       01  WSS-VARI.
           03 WSS-FEC-FPRO.
              05 WSS-NUM-DPRO                     PIC 9(02).
              05 WSS-NUM-MPRO                     PIC 9(02).
              05 WSS-NUM-SPRO                     PIC 9(02).
              05 WSS-NUM-APRO                     PIC 9(02).
           03 WSS-FEC-FFEC.
              05 WSS-NUM-SFEC                     PIC 9(02).
              05 WSS-NUM-AFEC                     PIC 9(02).
              05 WSS-NUM-MFEC                     PIC 9(02).
              05 WSS-NUM-DFEC                     PIC 9(02).
           03 WSS-COD-PLZA.
              05 WSS-IND-PLZA                     PIC X(01).
              05 WSS-RES-PLZA                     PIC X(03).
           03 WSS-COD-OFOC                        PIC X(03).
           03 WSS-COD-COOC                        PIC X(06).
           03 WSS-IND-NEXT                        PIC 9(01). 
           03 WSS-NUM-IDLC                        PIC 9(03).
           03 WSS-GLS-DATA.
              05 WSS-GLS-TIO                      PIC X(40).
              05 WSS-GLS-AUX                      PIC X(40).
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DLC-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TOC-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==. 
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>>
*% END
*% IF CF_DLV_OPC_COD_OFOC
      *<<<< CF_DLV_OPC_COD_OFOC
           MOVE ZEROES TO PAGE-COUNTER.
      *>>>>
*% END
*% IF PH_DLV
      *<<<< PH_DLV
      * Mediante BUS-OFI se Obtiene Nombre de la Oficina de Tabla OFI
           IF SRT-COD-OFOC IN SRT > SPACES
               MOVE SRT-COD-OFOC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI.

      * Mediante BUS-TAB Busca Tipo de Operacion Credito de Tabla TIO
           IF OPC-COD-TOOC IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'TIO'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-TOOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TIO IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-TIO IN WSS-VARI.
      * Mediante BUS-TAB Busca Clase de Operacion Credito de Tabla AUX
           IF OPC-COD-COOC IN SRT > SPACES
               MOVE 'COL'               TO TAB-COD-SIST
               MOVE 'AUX'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-COOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-AUX IN WSS-VARI
           ELSE
               MOVE SPACES TO WSS-GLS-AUX IN WSS-VARI.
      * Se concatenan las glosas de TIO y de AUX
           MOVE WSS-GLS-DATA IN WSS-VARI TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO WSS-GLS-DATA IN WSS-DLV.
      *>>>>
*% END
*% IF INI_INP
      *<<<< INI_INP
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.

      * Captura Fecha de Proceso
           DISPLAY 'FECHA DE PROCESO ( DDMMAAAA ) : '.
           ACCEPT  WSS-FEC-FPRO IN WSS-VARI.
           DISPLAY WSS-FEC-FPRO IN WSS-VARI.
      * Captura Codigo de Oficina
           DISPLAY 'OFICINA (*=TODAS) : '.
           ACCEPT  WSS-COD-OFOC IN WSS-VARI.
           DISPLAY WSS-COD-OFOC IN WSS-VARI.
      * Captura Codigo Clase Operacion
           DISPLAY 'CLASE OPERACION (*=TODAS) : '.
           ACCEPT  WSS-COD-COOC IN WSS-VARI.
           DISPLAY WSS-COD-COOC IN WSS-VARI.

           DISPLAY 'FIN    CAPTURA    DE PARAMETROS'.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

      *VAL-FEC Valida Fecha de Proceso
           DISPLAY WSS-FEC-FPRO IN WSS-VARI.
           MOVE WSS-FEC-FPRO    IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-END.
 
           MOVE WSS-NUM-DPRO IN WSS-VARI TO WSS-NUM-DPRO IN WSS-DLV
                                            WSS-NUM-DFEC IN WSS-VARI.
           MOVE WSS-NUM-MPRO IN WSS-VARI TO WSS-NUM-MPRO IN WSS-DLV
                                            WSS-NUM-MFEC IN WSS-VARI.
           MOVE WSS-NUM-SPRO IN WSS-VARI TO WSS-NUM-SPRO IN WSS-DLV
                                            WSS-NUM-SFEC IN WSS-VARI.
           MOVE WSS-NUM-APRO IN WSS-VARI TO WSS-NUM-APRO IN WSS-DLV
                                            WSS-NUM-AFEC IN WSS-VARI.

      *VAL-OFI Valida codigo de Oficina en TABLAS
           IF WSS-COD-OFOC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-OFOC IN WSS-VARI.
           IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-OFOC IN WSS-VARI
               MOVE WSS-COD-OFOC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   PERFORM GNS-PRO-END.

      *VAL-TAB Valida Clase de Operacion en TABLAS
           IF WSS-COD-COOC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-COOC IN WSS-VARI.
           IF WSS-COD-COOC IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-COOC IN WSS-VARI
               MOVE 'COL'                    TO TAB-COD-SIST
               MOVE 'AUX'                    TO TAB-COD-TTAB IN TAB
               MOVE WSS-COD-COOC IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM VAL-TAB
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   PERFORM GNS-PRO-END.

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.

      * Proceso para Cargar las tablas  TAB/TIO  y  COL/TOC  en Memoria
           PERFORM COL-CRG-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
               PERFORM GNS-PRO-END.
      *>>>>
*% END
*% IF INI_FST_INP
      *<<<< INI_FST_INP
      *DAD  ini  16-MAY-1991 
      *     MOVE ZEROES TO OPC-FEC-FCOL IN OPC.
      *     MOVE 'OPC-FEC-FCOL' TO FIO-AKEY.
      *     MOVE FIO-GET-NLS    TO FIO-CMND.
      *     PERFORM COL-FIO-OPC.
      *     IF NOT FIO-STAT-OKS OR
      *        OPC-FEC-FCOL IN OPC > WSS-FEC-FFEC IN WSS-VARI
      *         DISPLAY 'NO HAY REGISTRO HASTA FECHA DE PROCESO : '
      *                 WSS-FEC-FPRO IN WSS-VARI
      *         GO TO FIN-INP-SRT.
      *     GO TO LUP-INP-SRT.
      *DAD  fin  16-MAY-1991 
      *>>>>
*% END
*% IF LUP_INP
      *<<<< LUP_INP
      * Proceso de Seleccion y Clasificacion a Partir del Registro OPC
           PERFORM SEL-REG-PRO.
           IF WSS-IND-NEXT IN WSS-VARI = 1
               GO TO NXT-INP-SRT.

      * Busca los Documentos de Credito para Operacion Determinada
           MOVE OPC-CIC-IOPC IN OPC TO DLC-CIC-IOPC IN DLC.
           MOVE ZEROES              TO DLC-NUM-IDLC IN DLC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS OR
              DLC-CIC-IOPC IN DLC NOT = OPC-CIC-IOPC IN OPC
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'OPC    DLCNX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   OPC-KEY-IOPC IN OPC
               GO TO NXT-INP-SRT.
       LUP-BUS-OPC-DLC.
           PERFORM BUS-SRT-REG.
           IF WSS-IND-NEXT IN WSS-VARI = 1
               GO TO NXT-INP-SRT.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-DLC.
           IF NOT FIO-STAT-OKS OR
              DLC-CIC-IOPC IN DLC NOT = OPC-CIC-IOPC IN OPC
               GO TO NXT-INP-SRT.
           GO TO LUP-BUS-OPC-DLC.
      *>>>>
*% END
*% IF INI_NXT_INP
      *<<<< INI_NXT_INP
      *DAD  ini  16-MAY-1991 
      *     MOVE 'OPC-FEC-FCOL' TO FIO-AKEY.
      *DAD  fin  16-MAY-1991 
      *>>>>
*% END
*% IF FIN_NXT_INP
      *<<<< FIN_NXT_INP
      *DAD  ini  16-MAY-1991 
      *     IF OPC-FEC-FCOL IN OPC > WSS-FEC-FFEC IN WSS-VARI
      *         GO TO FIN-INP-SRT.
      *DAD  fin  16-MAY-1991 
      *>>>>
*% END
*% IF LUP_OUT
      *<<<< LUP_OUT
           PERFORM GEN-LIN-OUT.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      **************************************************************************
      * Seleccion del Registro para Proceso Mediante Fecha y Oficina del Listado
       SEL-REG-PRO SECTION.
       INI-SEL-REG-PRO.
           MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.

      *DAD  ini  16-MAY-1991 
           IF OPC-FEC-FCOL IN OPC > WSS-FEC-FFEC IN WSS-VARI
               GO TO FIN-SEL-REG-PRO.
      *DAD  fin  16-MAY-1991 

      * Se omite la Operacion de Credito que NO este Activada
           IF OPC-MSC-STAT IN OPC NOT = 'A'
               GO TO FIN-SEL-REG-PRO.

      * Se omite la Operacion de Credito que este Cancelada
           IF OPC-VAL-SCRE IN OPC NOT > ZEROES
               GO TO FIN-SEL-REG-PRO.

           IF WSS-COD-COOC IN WSS-VARI NOT = '*'
               IF WSS-COD-COOC IN WSS-VARI NOT = OPC-COD-COOC IN OPC
                   GO TO FIN-SEL-REG-PRO.

      * Se omite la Operacion de Credito en Moneda Extranjera
           IF OPC-MSC-TVOC IN OPC = '1'
               GO TO FIN-SEL-REG-PRO.

      * Busca con el Codigo Tipo Operacion en la Tabla cargada en Memoria el
      * 'Sistema que lo Maneja' y 'Opera Como'
           MOVE OPC-COD-TOOC IN OPC TO CTO-TOOC IN CTO-VARI.
           PERFORM COL-BUS-CTO.
           IF CTO-CMSG IN CTO-VARI > SPACES
               MOVE 'COL'                TO MSG-COD-SIST
               MOVE CTO-CMSG IN CTO-VARI TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG CTO-MEN2 IN CTO-VARI
                       'CON CODIGO : '     CTO-TOOC IN CTO-VARI
               GO TO FIN-SEL-REG-PRO.

      * Valida el 'Sistema que lo Maneja' de la Operacion de Credito
           IF CTO-SIST IN CTO-VARI NOT = 'COL'
               GO TO FIN-SEL-REG-PRO.

      * Valida el 'Opera Como' de la Operacion de Credito
           IF CTO-OPEC IN CTO-VARI = 'H' OR
              CTO-OPEC IN CTO-VARI = 'T'
               GO TO FIN-SEL-REG-PRO.

      * Obtiene 'Opera Como'
           MOVE SPACES               TO TOC.
           MOVE CTO-OPEC IN CTO-VARI TO TOC-MSC-OPEC IN TOC.

           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
       FIN-SEL-REG-PRO.
           EXIT.
      **************************************************************************
      * Formacion y Generacion del Registro SRT al Procesar Registros
       BUS-SRT-REG SECTION.
       INI-BUS-SRT-REG.
           MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.
      * Busca oficina a ocupar en sort
           IF DLC-COD-UBFD IN DLC NOT > SPACES
               MOVE OPC-COD-OFOC IN OPC TO SRT-COD-OFOC IN SRT
               MOVE 1                   TO SRT-IND-OFOC IN SRT
           ELSE
               IF DLC-COD-IUBF IN DLC = 'OFI'
                   MOVE DLC-COD-CUBF IN DLC TO SRT-COD-OFOC IN SRT
                   MOVE 1                   TO SRT-IND-OFOC IN SRT
               ELSE
                   IF DLC-COD-PLZA IN DLC > SPACES
                       MOVE DLC-COD-PLZA IN DLC TO
                                              WSS-COD-PLZA IN WSS-VARI
                       MOVE WSS-RES-PLZA IN WSS-VARI TO
                                                   SRT-COD-OFOC IN SRT
                       MOVE 2                   TO SRT-IND-OFOC IN SRT
                   ELSE
                       MOVE OPC-COD-OFOC IN OPC TO SRT-COD-OFOC IN SRT
                       MOVE 2                   TO SRT-IND-OFOC IN SRT.

           IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
               IF WSS-COD-OFOC IN WSS-VARI NOT = SRT-COD-OFOC IN SRT
                   GO TO FIN-BUS-SRT-REG.

           IF SRT-IND-OFOC IN SRT = 1
               MOVE SPACES TO DLC-COD-IUBF IN DLC
               MOVE SPACES TO DLC-COD-CUBF IN DLC.
                      
      * Segun Como Opera Buscara Datos Deudor Indirecto o Deudor Directo
           IF TOC-MSC-OPEC IN TOC = 'D'
               MOVE DLC-NUM-IDLC IN DLC TO WSS-NUM-IDLC IN WSS-VARI
           ELSE
               MOVE ZEROES TO WSS-NUM-IDLC IN WSS-VARI.

      * Busca CIC del Cliente con el CIC de Operaciones de Creditos en RDC
      * RDC-NUM-IDLC > 0 ====> DEU.IND.
      * RDC-NUM-IDLC = 0 ====> DEU.DIR.
           MOVE DLC-CAI-IOPC IN DLC      TO RDC-CAI-IOPC IN RDC.
           MOVE DLC-IIC-IOPC IN DLC      TO RDC-IIC-IOPC IN RDC.
           MOVE WSS-NUM-IDLC IN WSS-VARI TO RDC-NUM-IDLC IN RDC.
           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           IF NOT FIO-STAT-OKS
               MOVE 'COL'          TO MSG-COD-SIST
               MOVE 'DLC    RDCNX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   RDC-KEY-IDLC IN RDC
               GO TO FIN-BUS-SRT-REG.

      *CIC-CLI Busca Datos del Cliente Mediante su CIC
           MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GET-CLI.
           IF MSG-COD-MENS > SPACES
               MOVE SPACES TO DBC-NUM-ICLI IN DBC
                              DBC-VRF-ICLI IN DBC
                              DBC-IND-ICLI IN DBC
                              DBC-GLS-ICLI IN DBC
           ELSE
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC.

           MOVE 'RDC-KEY-IDLC' TO FIO-AKEY.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM COL-FIO-RDC.
           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
           IF NOT FIO-STAT-OKS OR
              RDC-CAI-IOPC IN RDC NOT = DLC-CAI-IOPC IN DLC OR
              RDC-IIC-IOPC IN RDC NOT = DLC-IIC-IOPC IN DLC
               MOVE  1  TO WSS-IND-NEXT IN WSS-VARI.

           IF TOC-MSC-OPEC IN TOC = 'D'
               IF RDC-NUM-IDLC IN RDC NOT > ZEROES OR
                  WSS-IND-NEXT IN WSS-VARI = 1
                   MOVE SPACES TO SRT-IND-MULD IN SRT
               ELSE
                   MOVE 'M'    TO SRT-IND-MULD IN SRT
           ELSE
               IF RDC-NUM-IDLC IN RDC NOT = ZEROES OR
                  WSS-IND-NEXT IN WSS-VARI = 1
                   MOVE SPACES TO SRT-IND-MULD IN SRT
               ELSE
                   MOVE 'M'    TO SRT-IND-MULD IN SRT.

      * Completa Llenado de Campos y Genera el Registro SRT
           MOVE  1  TO SRT-NUM-DLCV IN SRT.
           COPY COLRMDLV.
           RELEASE SRT.
           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
       FIN-BUS-SRT-REG.
           EXIT.
      **************************************************************************
      * Genera Lineas de Detalle a Partir de Registro SRT Ordenado
       GEN-LIN-OUT SECTION.
       INI-GEN-LIN-OUT.
      * Mediante BUS-TAB Busca Tipo de Moneda de Tabla VLR
           IF OPC-COD-VCOC IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE OPC-COD-VCOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-ABRV IN TAB TO WSS-GLS-VCOC IN WSS-DLV
           ELSE
               MOVE SPACES TO WSS-GLS-VCOC IN WSS-DLV.

      * Mediante BUS-TAB Busca Tipo de Documento de Tabla DOC
           IF DLC-COD-TDOC IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'DOC'               TO TAB-COD-TTAB IN TAB
               MOVE DLC-COD-TDOC IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-ABRV IN TAB TO WSS-GLS-TDOC IN WSS-DLV
           ELSE
               MOVE SPACES TO WSS-GLS-TDOC IN WSS-DLV.

           IF DBC-GLS-ICLI IN SRT > SPACES
               MOVE '-'    TO WSS-GLS-AUXI IN WSS-DLV
           ELSE
               MOVE SPACES TO WSS-GLS-AUXI IN WSS-DLV.
       FIN-GEN-LIN-OUT.
           EXIT.
      **************************************************************************

       COPY TABBFOFI.
       COPY COLBFDLC.
       COPY COLBFTOC.
       COPY COLBFRDC.
       COPY SGCBFDBC.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY GNSBVTAB.
       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBGCPT.
       COPY SGCBGCLI.
       COPY COLBGCTO.
      *>>>>
*% END
