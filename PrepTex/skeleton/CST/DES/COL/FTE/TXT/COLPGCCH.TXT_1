*%! Codigo adicional para archivo
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       01  WSS-VARI.
           03 WSS-FEC-FVEN.
              05 WSS-NUM-AVEN       VALUE ZEROS   PIC 9(02).
              05 WSS-NUM-MVEN       VALUE ZEROS   PIC 9(02).
           03 WSS-FEC-FPRO.
              05 WSS-NUM-MPRO       VALUE ZEROS   PIC 9(02).
              05 WSS-NUM-APRO       VALUE ZEROS   PIC 9(02).
           03 WSS-FEC-FVAM.
              05 WSS-NUM-AVAM       VALUE ZEROS   PIC 9(02).
              05 WSS-NUM-MVAM       VALUE ZEROS   PIC 9(02).
           03 WSS-COD-COOC          VALUE SPACES  PIC X(06).
           03 WSS-COD-OFOC          VALUE SPACES  PIC X(03).
           03 WSS-SUM-VDES          VALUE ZEROS   PIC 9(09)V99.
           03 WSS-NUM-RLEI          VALUE ZEROS   PIC 9(09).
           03 WSS-NUM-RERR          VALUE ZEROS   PIC 9(09).
           03 WSS-NUM-RPRO          VALUE ZEROS   PIC 9(09).

       COPY GNSWGFEC.
       COPY GNSWGCPT.
       COPY GNSWGHOY.
       COPY COLBROPC.
       COPY COLBRRDC.
       COPY SGCBRDBC.
       COPY TABBROFI.
       COPY COLBRCCH.
      *>>>>
*% END
*% IF INI_INP
      *<<<< INI_INP
      * Abrir Archivos input sort
           MOVE FIO-INP TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           PERFORM COL-FIO-RDC.
           PERFORM SGC-FIO-DBC.
      * Rutina para Capturar y Validar Parametros
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.
      *Captura Fecha de vencimiento
           ACCEPT WSS-FEC-FPRO IN WSS-VARI.
           DISPLAY 'FECHA INICIO (MMAA) : ' WSS-FEC-FPRO IN WSS-VARI.
      *Captura Clase Operacion
           ACCEPT WSS-COD-COOC IN WSS-VARI.
           DISPLAY 'CLASE OPERACION     : ' WSS-COD-COOC IN WSS-VARI.
      *Captura Oficina
           ACCEPT WSS-COD-OFOC IN WSS-VARI.
           DISPLAY 'OFICINA             : ' WSS-COD-OFOC IN WSS-VARI.

           DISPLAY 'FIN CAPTURA DE PARAMETROS'.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

      *VAL-FEC Valida Fecha de vencimiento
           MOVE WSS-FEC-FPRO IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FMA             TO FEC-FORM.
           MOVE FEC-FBLK-N               TO FEC-FBLK.
           MOVE FEC-CHOY-GE              TO FEC-CHOY.
           MOVE FEC-VHBL-N               TO FEC-VHBL.
           MOVE FEC-VAL-FEC              TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY 'FECHA DE VENCIMIENTO ' FEC-MENS
                PERFORM GNS-PRO-END.

           MOVE WSS-NUM-MPRO IN WSS-VARI TO WSS-NUM-MVEN IN WSS-VARI
                                            WSS-NUM-MVEN IN WSS-CCH.
           MOVE WSS-NUM-APRO IN WSS-VARI TO WSS-NUM-AVEN IN WSS-VARI
                                            WSS-NUM-AVEN IN WSS-CCH.

      *VAL-TAB Valida Clase de Operacion en TABLAS
           IF WSS-COD-COOC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-COOC IN WSS-VARI.
           IF WSS-COD-COOC IN WSS-VARI NOT = '*'
               MOVE 'COL'                    TO TAB-COD-SIST
               MOVE 'AUX'                    TO TAB-COD-TTAB IN TAB
               MOVE WSS-COD-COOC IN WSS-VARI TO TAB-COD-CTAB IN TAB
               PERFORM VAL-TAB
               IF MSG-COD-MENS > SPACES
                   DISPLAY 'CLASE DE OPERACION ' WSS-COD-COOC
                           ' ' MSG-GLS-DESC IN MSG
                   PERFORM GNS-PRO-END.

      *VAL-OFI Valida codigo de Oficina en TABLAS
           IF WSS-COD-OFOC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-OFOC IN WSS-VARI.
           IF WSS-COD-OFOC IN WSS-VARI NOT = '*'
               MOVE WSS-COD-OFOC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY 'CODIGO OFICINA ' WSS-COD-OFOC
                           ' ' MSG-GLS-DESC IN MSG
                   PERFORM GNS-PRO-END.

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.
      *>>>>
*% END
*% IF FIN_FST_INP
      *<<<< FIN_FST_INP
           PERFORM GET-FHOY.
           MOVE HOY-SHOY IN HOY-VARI     TO VEN-NUM-SVEN IN VEN
           MOVE WSS-NUM-AVEN IN WSS-VARI TO VEN-NUM-AVEN IN VEN
           MOVE WSS-NUM-MVEN IN WSS-VARI TO VEN-NUM-MVEN IN VEN
           MOVE ZEROS                    TO VEN-NUM-DVEN IN VEN
           MOVE 'VEN-FEC-FVEN'           TO FIO-AKEY
           MOVE FIO-GET-NLS              TO FIO-CMND
           PERFORM COL-FIO-VEN
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTEN VENCIMIENTOS PARA FECHA : '
                                               WSS-FEC-FPRO IN WSS-VARI
               PERFORM GNS-PRO-END.
      *>>>>
*% END
*% IF LUP_INP
      *<<<< LUP_INP
      * Obtencion y seleccion de registros a procesar
           MOVE VEN-NUM-AVEN IN VEN TO WSS-NUM-AVAM IN WSS-VARI
           MOVE VEN-NUM-MVEN IN VEN TO WSS-NUM-MVAM IN WSS-VARI
      * Valida que VEN este en el mes y anno de parametro
           IF WSS-FEC-FVAM IN WSS-VARI > WSS-FEC-FVEN IN WSS-VARI
              GO TO FIN-INP-SRT.

           ADD 1 TO WSS-NUM-RLEI IN WSS-VARI.

      * Busca VEN en OPC
           MOVE VEN-CIC-IOPC IN VEN TO OPC-CIC-IOPC IN OPC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTE REGISTRO VEN EN OPC : ' VEN-CIC-IOPC
                                                                IN VEN
               ADD 1 TO WSS-NUM-RERR IN WSS-VARI
               GO TO NXT-INP-SRT.

      * Valida que OPC este activada. Valida que el credito no este cancelado
           IF (OPC-MSC-STAT IN OPC NOT = 'A') OR
              (OPC-VAL-SCRE IN OPC NOT > ZEROS)
               GO TO NXT-INP-SRT.

      * Valida que clase de operacion corresponda a la de parametro
           IF WSS-COD-COOC IN WSS-VARI NOT = '*' AND
              WSS-COD-COOC IN WSS-VARI NOT = SPACES
               IF OPC-COD-COOC IN OPC NOT = WSS-COD-COOC IN WSS-VARI
                   GO TO NXT-INP-SRT.

      * Valida que oficina corresponda a la de parametro
           IF WSS-COD-OFOC IN WSS-VARI NOT = '*' AND
              WSS-COD-OFOC IN WSS-VARI NOT = SPACES
               IF OPC-COD-OFOC IN OPC NOT = WSS-COD-OFOC IN WSS-VARI
                   GO TO NXT-INP-SRT.

      * Busca OPC en RDC para obtener rut cliente
           MOVE OPC-CIC-IOPC IN OPC TO RDC-CIC-IOPC IN RDC
           MOVE ZEROES              TO RDC-NUM-IDLC IN RDC
           MOVE 'RDC-KEY-IDLC'      TO FIO-AKEY
           MOVE FIO-GET-KEY         TO FIO-CMND
           PERFORM COL-FIO-RDC
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTE REGISTRO OPC EN RDC : ' RDC-KEY-IDLC
                                                                IN RDC
               ADD 1 TO WSS-NUM-RERR IN WSS-VARI
               GO TO NXT-INP-SRT
           ELSE
      * Busca con RDC cliente en DBC
               MOVE RDC-CIC-ICLI IN RDC TO DBC-CIC-ICLI IN DBC
               MOVE FIO-GET-KEY         TO FIO-CMND
               PERFORM SGC-FIO-DBC
               IF NOT FIO-STAT-OKS
                   DISPLAY 'NO EXISTE CLIENTE EN DBC : '
                                                     DBC-CIC-ICLI IN DBC
                   ADD 1 TO WSS-NUM-RERR IN WSS-VARI
                   GO TO NXT-INP-SRT.

           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
           PERFORM CPT-BLKS
           MOVE CPT-STRN TO SRT-GLS-NOMC IN SRT

           ADD  VEN-VAL-SFIN IN VEN TO WSS-SUM-VDES IN WSS-VARI.

           IF OPC-IND-VSTR IN OPC = 'S'
               MOVE VEN-NUM-IVCT IN VEN TO SRT-NUM-NCUO IN SRT
           ELSE
               MOVE VEN-NUM-IVEN IN VEN TO SRT-NUM-NCUO IN SRT.

           MOVE 1                   TO SRT-NUM-NUNO IN SRT.
      *>>>>
*% END
*% IF INI_NXT_INP
      *<<<< INI_NXT_INP
           MOVE 'VEN-FEC-FVEN' TO FIO-AKEY.
      *>>>>
*% END
*% IF FIN_INP
      *<<<< FIN_INP
      * Cerrar Archivos input sort
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-OPC.
           PERFORM COL-FIO-RDC.
           PERFORM SGC-FIO-DBC.
      *>>>>
*% END
*% IF INI_OUT
      *<<<< INI_OUT
      * Abrir Archivos de salida y grabar
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM COL-FIO-CCH.
      *>>>>
*% END
*% IF LUP_OUT
      *<<<< LUP_OUT
      * Obtencion de registros SORT
           MOVE DBC-NUM-ICLI IN SRT TO CCH-NUM-ICLI IN CCH.
           MOVE DBC-VRF-ICLI IN SRT TO CCH-VRF-ICLI IN CCH.

           IF OPC-COD-OFOC IN SRT NOT NUMERIC
               MOVE ZEROS TO CCH-COD-OFOC IN CCH
           ELSE
               MOVE OPC-COD-OFOC IN SRT TO CCH-COD-OFOC IN CCH.

           MOVE OPC-CAI-IOPC IN SRT TO CCH-CAI-IOPC IN CCH.
           MOVE OPC-IIC-IOPC IN SRT TO CCH-IIC-IOPC IN CCH.
           MOVE SRT-NUM-NCUO IN SRT TO CCH-NUM-IVEN IN CCH.
           MOVE VEN-VAL-SCAP IN SRT TO CCH-VAL-SCAP IN CCH.
           SUBTRACT VEN-VAL-SFIN IN SRT FROM
                    VEN-VAL-SCAP IN SRT GIVING
                    CCH-VAL-INTE IN CCH.
      *DAD ini  20-AUG-1991
           MOVE OPC-VAL-SEGD IN SRT TO CCH-VAL-SEGD IN CCH.
      *DAD fin  20-AUG-1991
           MOVE VEN-NUM-DVEN IN SRT TO CCH-NUM-DVEN IN CCH.
           MOVE VEN-NUM-MVEN IN SRT TO CCH-NUM-MVEN IN CCH.
           MOVE VEN-NUM-AVEN IN SRT TO CCH-NUM-AVEN IN CCH.
      *DAD ini  09-JUL-1993   (Memo.08-07-93)
           MOVE OPC-VAL-SCRE IN SRT TO CCH-VAL-SCRE IN CCH.
      *DAD fin  09-JUL-1993

           MOVE FIO-PUT TO FIO-CMND
           PERFORM COL-FIO-CCH
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR AL GRABAR CCH : ' CCH
               ADD 1 TO WSS-NUM-RERR IN WSS-VARI
               GO TO NXT-OUT-SRT.
           ADD 1 TO WSS-NUM-RPRO IN WSS-VARI.
      *>>>>
*% END
*% IF FIN_OUT
      *<<<< FIN_OUT
      * Cerrar Archivos de salida
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM COL-FIO-CCH.
           DISPLAY 'ESTADISTICAS DE PROCESO'.
           DISPLAY '============ == ======='.
           DISPLAY 'REGISTROS LEIDOS     : ' WSS-NUM-RLEI IN WSS-VARI.
           DISPLAY 'REGISTROS PROCESADOS : ' WSS-NUM-RPRO IN WSS-VARI.
           DISPLAY 'REGISTROS ERRONEOS   : ' WSS-NUM-RERR IN WSS-VARI.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBGCPT.
       COPY GNSBBMSG.
       COPY GNSBVTAB.
       COPY TABBVOFI.
       COPY COLBFOPC.
       COPY COLBFRDC.
       COPY SGCBFDBC.
       COPY TABBFOFI.
       COPY COLBFCCH.
      *>>>>
*% END
