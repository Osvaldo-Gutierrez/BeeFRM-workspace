      * RUTINA QUE OBTIENE VALOR DE TASA O OFICINA CENTRALIZADORA
      * DE CONTABILIZACION.
      * PARAMETROS DE ENTRADA EN PTI-VARI :
      *     03 PTI-COD-OFOC                          PIC X(03).
      *     03 PTI-COD-VCOC                          PIC X(06).
      *     03 PTI-COD-COOC.
      *        05 PTI-COD-TOOC                       PIC X(03).
      *        05 PTI-COD-AOOC                       PIC X(03).
      *     03 PTI-STP-ITRN.
      *        05 PTI-FEC-FTRN.
      *           07 PTI-NUM-STRN                    PIC 9(02).
      *           07 PTI-NUM-ATRN                    PIC 9(02).
      *           07 PTI-NUM-MTRN                    PIC 9(02).
      *           07 PTI-NUM-DTRN                    PIC 9(02).
      *        05 PTI-HRA-HRTR.
      *           07 PTI-NUM-HHTR                    PIC 9(02).
      *           07 PTI-NUM-MMTR                    PIC 9(02).
      *
      *     PARA OBTENER OFICINA CENTRALIZADORA :
      *      PTI-STP-ITRN = ZEROES
      *     PARA OBTENER TASA SE DEBE INFORMAR YA SEA :
      *      PTI-SGV-MNTO      MONTO PARA OBTENER TASA
      *      PTI-NUM-NDIA      PLZO  PARA OBTENER TASA
      *
      *      PARA OBTENER LA TASA DE ACUERDO A FECHA DE INGRESO Y
      *      HORA REALIZA LO SIGUIENTES :
      *       - SI NO EXISTE REGISTRO A LA FECHA LO RECHAZA.
      *       - SI PARA HORA SOLICITADA NO EXISTE REGISTRO
      *         TOMA EL MENOR A LA HORA PEDIDA.
      *
      * PARAMETROS DE SALIDA :
      *  SI PROCESO SALIO MAL :
      *     PTI-COD-MENS IN PTI-VARI > SPACES
      *  EN OTRO CASO :
      *     OFICINA CENTRALIZADORA : PTI-COD-OFCB IN PTI-VARI.
      *     VALOR TASA             : PTI-VAL-TASA IN PTI-VARI.
      *     VALOR TASA MAXIMA      : PTI-VAL-TMAX IN PTI-VARI.
      *
       BUS-PTI SECTION.
       INI-BUS-PTI.
           MOVE SPACES TO PTI-COD-MENS IN PTI-VARI.
           PERFORM CLR-1 VARYING PTI-I FROM 1 BY 1
                         UNTIL PTI-I > PTI-IMAX.
           MOVE PTI-COD-OFOC IN PTI-VARI TO PTI-COD-OFOC IN PTI.
           MOVE PTI-COD-VCOC IN PTI-VARI TO PTI-COD-VCOC IN PTI.
           MOVE PTI-COD-TOOC IN PTI-VARI TO PTI-COD-TOOC IN PTI.
           MOVE PTI-COD-AOOC IN PTI-VARI TO PTI-COD-AOOC IN PTI.
           MOVE PTI-NUM-DTRN IN PTI-VARI TO PTI-NUM-DTRN IN PTI.
           MOVE PTI-NUM-MTRN IN PTI-VARI TO PTI-NUM-MTRN IN PTI.
           MOVE PTI-NUM-STRN IN PTI-VARI TO PTI-NUM-STRN IN PTI.
           MOVE PTI-NUM-ATRN IN PTI-VARI TO PTI-NUM-ATRN IN PTI.
           MOVE PTI-HRA-HRTR IN PTI-VARI TO PTI-HRA-HRTR IN PTI.
           PERFORM PRO-ARC-PTI.
           IF NOT FIO-STAT-OKS
               MOVE 'PTI    NEX' TO PTI-COD-MENS IN PTI-VARI
               GO TO FIN-BUS-PTI.
           PERFORM PRO-VAL-PTI.
       FIN-BUS-PTI.
           EXIT.

       CLR-1 SECTION.
       INI-CLR-1.
           PERFORM CLR-2 VARYING PTI-J FROM 1 BY 1
                         UNTIL PTI-J > PTI-JMAX.
       FIN-CLR-1.
           EXIT.
       CLR-2 SECTION.
       INI-CLR-2.
           MOVE ZEROES TO PTI-SGV-TASA IN PTI-VARI( PTI-I, PTI-J).
       FIN-CLR-2.
           EXIT.
       PRO-ARC-PTI SECTION.
       INI-PRO-ARC-PTI.
      *    HORA DE INGRESO COMPLETA
           IF PTI-HRA-HRTR IN PTI-VARI > ZEROES
               MOVE 0 TO PTI-NUM-IPTI IN PTI
               PERFORM OBT-ULT-FTRN
               MOVE 0 TO PTI-NUM-IPTI IN PTI
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM COL-FIO-PTI
               IF FIO-STAT-OKS AND
                  PTI-COD-OFOC IN PTI-VARI = PTI-COD-OFOC IN PTI AND
                  PTI-COD-VCOC IN PTI-VARI = PTI-COD-VCOC IN PTI AND
                  PTI-COD-TOOC IN PTI-VARI = PTI-COD-TOOC IN PTI AND
                  PTI-COD-AOOC IN PTI-VARI = PTI-COD-AOOC IN PTI AND
                  PTI-NUM-STRN IN PTI-VARI = PTI-NUM-STRN IN PTI AND
                  PTI-NUM-ATRN IN PTI-VARI = PTI-NUM-ATRN IN PTI AND
                  PTI-NUM-MTRN IN PTI-VARI = PTI-NUM-MTRN IN PTI AND
                  PTI-NUM-DTRN IN PTI-VARI = PTI-NUM-DTRN IN PTI AND
                  PTI-NUM-IPTI IN PTI     = 1
                   MOVE FIO-STAT TO PTI-STAT
                   PERFORM LLE-TAB-PTI
               ELSE
                   IF FIO-STAT-OKS
                       MOVE FIO-END-BRW TO FIO-CMND
                       PERFORM COL-FIO-PTI
                       MOVE '23' TO FIO-STAT
                       MOVE FIO-STAT TO PTI-STAT
                       GO TO SET-PTI-STAT
                   ELSE
                       MOVE '23' TO FIO-STAT
                       MOVE FIO-STAT TO PTI-STAT
                       GO TO SET-PTI-STAT
           ELSE
      *        OBTENER PRIMER REGISTRO DE ESA FECHA
               MOVE ZEROES TO PTI-HRA-HRTR IN PTI
               MOVE ZEROES TO PTI-NUM-IPTI IN PTI
               IF PTI-FEC-FTRN IN PTI-VARI NOT > ZEROES
                   MOVE FIO-GET-KEY TO FIO-CMND
                   PERFORM COL-FIO-PTI
                   MOVE FIO-STAT TO PTI-STAT
                   IF FIO-STAT-OKS
                       MOVE PTI-COD-OFCB IN PTI
                                      TO PTI-COD-OFCB IN PTI-VARI
                       GO TO SET-PTI-STAT
                   ELSE
                       GO TO SET-PTI-STAT
               ELSE
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM COL-FIO-PTI
               IF FIO-STAT-OKS AND
                  PTI-COD-OFOC IN PTI-VARI = PTI-COD-OFOC IN PTI AND
                  PTI-COD-VCOC IN PTI-VARI = PTI-COD-VCOC IN PTI AND
                  PTI-COD-TOOC IN PTI-VARI = PTI-COD-TOOC IN PTI AND
                  PTI-COD-AOOC IN PTI-VARI = PTI-COD-AOOC IN PTI AND
                  PTI-NUM-STRN IN PTI-VARI = PTI-NUM-STRN IN PTI AND
                  PTI-NUM-ATRN IN PTI-VARI = PTI-NUM-ATRN IN PTI AND
                  PTI-NUM-MTRN IN PTI-VARI = PTI-NUM-MTRN IN PTI AND
                  PTI-NUM-DTRN IN PTI-VARI = PTI-NUM-DTRN IN PTI
                   MOVE FIO-STAT TO PTI-STAT
                   PERFORM LLE-TAB-PTI
               ELSE
                   IF FIO-STAT-OKS
                       MOVE FIO-END-BRW TO FIO-CMND
                       PERFORM COL-FIO-PTI
                       MOVE '23' TO FIO-STAT
                       MOVE FIO-STAT TO PTI-STAT
                   ELSE
                       MOVE '23' TO FIO-STAT
                       MOVE FIO-STAT TO PTI-STAT.
       SET-PTI-STAT.
           MOVE PTI-STAT TO FIO-STAT.
       FIN-PRO-ARC-PTI.
           EXIT.

       PRO-MNTO-PTI SECTION.
       INI-PRO-MNTO-PTI.
           MOVE 1 TO PTI-J.
       LOOP-PRO-MNTO-PTI.
           IF PTI-VEC-MNTO IN PTI-VARI (PTI-J) NOT > ZEROES AND
              PTI-J > 1
               SUBTRACT 1 FROM PTI-J
               GO TO FIN-PRO-MNTO-PTI.
           IF PTI-SGV-MNTO IN PTI-VARI NOT > PTI-VEC-MNTO
                                              IN PTI-VARI (PTI-J)
               GO TO FIN-PRO-MNTO-PTI.
           ADD 1 TO PTI-J.
           IF PTI-J > PTI-JMAX
               MOVE PTI-JMAX TO PTI-J
               GO TO FIN-PRO-MNTO-PTI.
           GO TO LOOP-PRO-MNTO-PTI.
       FIN-PRO-MNTO-PTI.
           EXIT.
       PRO-NDIA-PTI SECTION.
       INI-PRO-NDIA-PTI.
           MOVE 1 TO PTI-I.
       LOOP-PRO-NDIA-PTI.
           IF PTI-VEC-NDIA IN PTI-VARI (PTI-I) NOT > ZEROES AND
              PTI-I > 1
               SUBTRACT 1 FROM PTI-I
               GO TO FIN-PRO-NDIA-PTI.
           IF PTI-NUM-NDIA IN PTI-VARI NOT > PTI-VEC-NDIA
                                              IN PTI-VARI (PTI-I)
               GO TO FIN-PRO-NDIA-PTI.
           ADD 1 TO PTI-I.
           IF PTI-I > PTI-IMAX
               MOVE PTI-IMAX TO PTI-I
               GO TO FIN-PRO-NDIA-PTI.
           GO TO LOOP-PRO-NDIA-PTI.
       FIN-PRO-NDIA-PTI.
           EXIT.
       LLE-TAB-PTI SECTION.
       INI-LLE-TAB-PTI.
      *
      * MUEVE MONTOS DE PRIMERA PTI (CORRELATIVO 1)
      *
           MOVE PTI-SGV-MTO1 IN PTI TO PTI-VEC-MNTO IN PTI-VARI(1)
           MOVE PTI-SGV-MTO2 IN PTI TO PTI-VEC-MNTO IN PTI-VARI(2)
           MOVE PTI-SGV-MTO3 IN PTI TO PTI-VEC-MNTO IN PTI-VARI(3)
           MOVE PTI-SGV-MTO4 IN PTI TO PTI-VEC-MNTO IN PTI-VARI(4)
           PERFORM LEE-TAB-PTI VARYING PTI-I FROM 1 BY 1
                   UNTIL PTI-I > PTI-IMAX.
           IF FIO-STAT-OKS
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM COL-FIO-PTI.
       FIN-LLE-TAB-PTI.
           EXIT.
       LEE-TAB-PTI SECTION.
       INI-LEE-TAB-PTI.
      *
      * MUEVE VALORES A TABLA EN PANTALLA DESPUES DE LEER PTI(N)
      *
           MOVE PTI-NUM-NDIA IN PTI TO PTI-VEC-NDIA
                                            IN PTI-VARI(PTI-I).
           MOVE PTI-SGV-INT1 IN PTI TO PTI-SGV-TASA
                                          IN PTI-VARI(PTI-I, 1).
           MOVE PTI-SGV-INT2 IN PTI TO PTI-SGV-TASA
                                          IN PTI-VARI(PTI-I, 2).
           MOVE PTI-SGV-INT3 IN PTI TO PTI-SGV-TASA
                                          IN PTI-VARI(PTI-I, 3).
           MOVE PTI-SGV-INT4 IN PTI TO PTI-SGV-TASA
                                          IN PTI-VARI(PTI-I, 4).
           MOVE PTI-SGV-INTM IN PTI TO PTI-VEC-INTM IN PTI-VARI(PTI-I).
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM COL-FIO-PTI.
      *    IF NOT (FIO-STAT-OKS AND
      *       PTI-COD-OFOC IN PTI-VARI = PTI-COD-OFOC IN PTI AND
      *       PTI-COD-VCOC IN PTI-VARI = PTI-COD-VCOC IN PTI AND
      *       PTI-COD-TOOC IN PTI-VARI = PTI-COD-TOOC IN PTI AND
      *       PTI-COD-AOOC IN PTI-VARI = PTI-COD-AOOC IN PTI AND
      *       PTI-NUM-STRN IN PTI-VARI = PTI-NUM-STRN IN PTI AND
      *       PTI-NUM-ATRN IN PTI-VARI = PTI-NUM-ATRN IN PTI AND
      *       PTI-NUM-MTRN IN PTI-VARI = PTI-NUM-MTRN IN PTI AND
      *       PTI-NUM-DTRN IN PTI-VARI = PTI-NUM-DTRN IN PTI AND
      *       PTI-HRA-HRTR IN PTI-VARI = PTI-HRA-HRTR IN PTI )
      *        MOVE '23' TO FIO-STAT.
       FIN-LEE-TAB-PTI.
           EXIT.
       PRO-VAL-PTI SECTION.
       INI-PRO-VAL-PTI.
           IF PTI-FEC-FTRN IN PTI-VARI NOT > ZEROES
               MOVE PTI-COD-OFCB IN PTI TO PTI-COD-OFCB IN PTI-VARI
               GO TO FIN-PRO-VAL-PTI.
           IF PTI-NUM-NDIA IN PTI-VARI NOT > ZEROES AND
              PTI-SGV-MNTO IN PTI-VARI NOT > ZEROES
               MOVE PTI-SGV-TASA IN PTI-VARI (1, 1) TO PTI-VAL-TASA
                                                    IN PTI-VARI
               MOVE PTI-VEC-INTM IN PTI-VARI (1)    TO PTI-VAL-TMAX
                                                    IN PTI-VARI
               GO TO FIN-PRO-VAL-PTI.
           IF PTI-NUM-NDIA IN PTI-VARI NOT > ZEROES
               PERFORM PRO-MNTO-PTI
               MOVE PTI-SGV-TASA IN PTI-VARI (1, PTI-J) TO PTI-VAL-TASA
                                                    IN PTI-VARI
               MOVE PTI-VEC-INTM IN PTI-VARI (1)        TO PTI-VAL-TMAX
                                                    IN PTI-VARI
               GO TO FIN-PRO-VAL-PTI.
           IF PTI-SGV-MNTO IN PTI-VARI NOT > ZEROES
               PERFORM PRO-NDIA-PTI
               MOVE PTI-SGV-TASA IN PTI-VARI (PTI-I, 1) TO PTI-VAL-TASA
                                                    IN PTI-VARI
               MOVE PTI-VEC-INTM IN PTI-VARI (PTI-I)    TO PTI-VAL-TMAX
                                                    IN PTI-VARI
               GO TO FIN-PRO-VAL-PTI.
           PERFORM PRO-MNTO-PTI.
           PERFORM PRO-NDIA-PTI.
           MOVE PTI-SGV-TASA IN PTI-VARI (PTI-I, PTI-J) TO PTI-VAL-TASA
                                                    IN PTI-VARI.
           MOVE PTI-VEC-INTM IN PTI-VARI (PTI-I)        TO PTI-VAL-TMAX
                                                    IN PTI-VARI.
       FIN-PRO-VAL-PTI.
           EXIT.
       OBT-ULT-FTRN SECTION.
       INI-OBT-ULT-FTRN.
           MOVE PTI-HRA-HRTR IN PTI-VARI TO PTI-HRA-HRAU IN PTI-VARI.
           MOVE ZEROES TO PTI-HRA-HRTR IN PTI.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-OBT-ULT-FTRN.
           PERFORM COL-FIO-PTI.
           IF FIO-STAT-OKS AND
               PTI-COD-OFOC IN PTI-VARI = PTI-COD-OFOC IN PTI AND
               PTI-COD-VCOC IN PTI-VARI = PTI-COD-VCOC IN PTI AND
               PTI-COD-TOOC IN PTI-VARI = PTI-COD-TOOC IN PTI AND
               PTI-COD-AOOC IN PTI-VARI = PTI-COD-AOOC IN PTI AND
               PTI-NUM-STRN IN PTI-VARI = PTI-NUM-STRN IN PTI AND
               PTI-NUM-ATRN IN PTI-VARI = PTI-NUM-ATRN IN PTI AND
               PTI-NUM-MTRN IN PTI-VARI = PTI-NUM-MTRN IN PTI AND
               PTI-NUM-DTRN IN PTI-VARI = PTI-NUM-DTRN IN PTI
                IF PTI-HRA-HRTR IN PTI > PTI-HRA-HRTR IN PTI-VARI
                    MOVE PTI-HRA-HRAU IN PTI-VARI TO PTI-HRA-HRTR
                                                     IN PTI
                    MOVE FIO-END-BRW TO FIO-CMND
                    PERFORM COL-FIO-PTI
                    GO TO FIN-OBT-ULT-FTRN
                ELSE
                    MOVE PTI-HRA-HRTR IN PTI TO
                                         PTI-HRA-HRAU IN PTI-VARI
                    MOVE FIO-GET-NXT TO FIO-CMND
                    GO TO LUP-OBT-ULT-FTRN.
           IF FIO-STAT-OKS
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM COL-FIO-PTI.
           MOVE PTI-COD-OFOC IN PTI-VARI TO PTI-COD-OFOC IN PTI.
           MOVE PTI-COD-VCOC IN PTI-VARI TO PTI-COD-VCOC IN PTI.
           MOVE PTI-COD-TOOC IN PTI-VARI TO PTI-COD-TOOC IN PTI.
           MOVE PTI-COD-AOOC IN PTI-VARI TO PTI-COD-AOOC IN PTI.
           MOVE PTI-NUM-STRN IN PTI-VARI TO PTI-NUM-STRN IN PTI.
           MOVE PTI-NUM-ATRN IN PTI-VARI TO PTI-NUM-ATRN IN PTI.
           MOVE PTI-NUM-MTRN IN PTI-VARI TO PTI-NUM-MTRN IN PTI.
           MOVE PTI-NUM-DTRN IN PTI-VARI TO PTI-NUM-DTRN IN PTI.
           MOVE PTI-HRA-HRAU IN PTI-VARI TO PTI-HRA-HRTR IN PTI.
       FIN-OBT-ULT-FTRN.
           EXIT.

