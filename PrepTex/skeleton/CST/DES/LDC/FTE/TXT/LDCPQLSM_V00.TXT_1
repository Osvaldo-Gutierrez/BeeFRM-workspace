*%! Codigo adicional para archivo LDCPQLM
*% IF SETTAG
*% VSNPQ = "01-00"
*% FNCPQ = "1608_07"
*% VSNPU = "01-00"
*% FNCPU = "1608_07"
*% END
*% PGM_PTC = TRUE
*% LARGO_MI_COMMAREA = 4
*%! BLLCELLS_USR = TRUE
*%! IF PGM_DTC
*%! INCLUDE 'GNSSRC:MANEJO_VSI.SRC'
*%! END
*%! REG = 'CLF'
*% IF CMT_ID 
*% END
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
           03 SCR-DISP-RED REDEFINES
              SCR-DISP.
              05 SCR-FRM-NUM-CORR    PIC 9(04).
              05 SCR-FRM-GLS-DISP    PIC X(15).
      *>>>> FIN_SCR_VARI
*% END
*% IF WSS
      *<<<< WSS
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RDC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CLF-REQA==.
       COPY SGCBRDBC.
       COPY COLBRRDC.
       COPY LDCBRCLF. 
       COPY GNSWGCPT.
       COPY LDCWGCCU.
       COPY LDCWGCEG.

      * CLAVE EMULACION
       01  WSS-KEY-EMUL.
      * IDENTIFICACION DE OPERACION
           03  WSS-KEY-EM01                        PIC 9(08).
      * CORRELATIVO ERROR
           03  WSS-KEY-EM02                        PIC 9(02).
      * CORRELATIVO DENTRO DEL ERROR ( LINEA OCURRENCIA )
           03  WSS-KEY-EM03                        PIC 9(02).

      * CLAVE EMULACION
       01  CMP-WSS-KEY-EMUL.
      * IDENTIFICACION DE OPERACION
           03  CMP-WSS-KEY-EM01                        PIC 9(08).
      * CORRELATIVO ERROR
           03  CMP-WSS-KEY-EM02                        PIC 9(02).
      * CORRELATIVO DENTRO DEL ERROR ( LINEA OCURRENCIA )
           03  CMP-WSS-KEY-EM03                        PIC 9(02).


       77  WSS-NUM-INDX    VALUE  ZEROES           PIC 9(03).

       01  WSS-TAB.
           03 WSS-TAB-GLS-DESC                     PIC X(40).
           03 WSS-TAB-GLS-DATA                     PIC X(60).

       01  WSS-LOG-QUE  VALUE 'N'                  PIC X(01).
       01  WSS-CTE-SI   VALUE 'S'                  PIC X(01).
           
      *>>>> WSS
*% END
*% IF INI_FIO
      *<<<< INI_FIO

           IF SCR-INST = 'GAB' AND
              ( FRM-FFLD = FRM-FFLD-PF8 OR
                FRM-FFLD = FRM-FFLD-PF7 )
                  MOVE 'GKY' TO SCR-INST.

           MOVE 'DEU' TO FIO-SIST.
           MOVE 'DEU' TO TAB-COD-SIST.
           MOVE 'VSN' TO       TAB-COD-TTAB IN TAB.
           MOVE 'LOGQUELSM' TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
                MOVE TAB-MSC-STAT IN TAB TO WSS-LOG-QUE.
      *>>>> INI_FIO
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY


           MOVE 'KEYLSMA' TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNX-PRO-QUE.


           MOVE 'KEYLSMA' TO QUE-COLA.
           MOVE LSM-FLD TO QUE-ITEM.
           MOVE +2000 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNX-PRO-QUE.

           IF FRM-NUM-CORR IN LSM-FLD = ZEROES
               MOVE 1 TO FRM-NUM-CORR IN LSM-FLD.

           IF SCR-CMND = 'CON'

              MOVE FRM-NUM-CORR IN LSM-FLD TO SCR-FRM-NUM-CORR

              MOVE 'KEYCORR' TO QUE-COLA
              MOVE QUE-DEL TO QUE-CMND
              PERFORM GNX-PRO-QUE


              MOVE 'KEYCORR' TO QUE-COLA
              MOVE SCR-FRM-NUM-CORR TO QUE-ITEM
              MOVE +4 TO QUE-LITM
              MOVE QUE-PUT TO QUE-CMND
              PERFORM GNX-PRO-QUE

              IF FRM-FFLD = FRM-FFLD-PF8
                    ADD 1 TO FRM-NUM-CORR IN LSM-FLD
                    MOVE FRM-NUM-CORR IN LSM-FLD TO SCR-FRM-NUM-CORR
              ELSE
                 IF FRM-FFLD = FRM-FFLD-PF7
                    SUBTRACT 1 FROM FRM-NUM-CORR IN LSM-FLD
                    MOVE FRM-NUM-CORR IN LSM-FLD TO SCR-FRM-NUM-CORR.


           MOVE 'SCRVARI' TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNX-PRO-QUE.


           MOVE 'SCRVARI' TO QUE-COLA.
           MOVE SCR-VARI TO QUE-ITEM.
           MOVE +2000 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNX-PRO-QUE.




           MOVE 'KEYLSMD' TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNX-PRO-QUE.


           MOVE 'KEYLSMD' TO QUE-COLA.
           MOVE LSM-FLD TO QUE-ITEM.
           MOVE +2000 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNX-PRO-QUE.


      *>>>> INI_FND_KEY
*% END
*% IF FIN_FND_KEY
      *>>>> FIN_FND_KEY



           MOVE 'IDDVARI1' TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNX-PRO-QUE.



           MOVE 'IDDVARI1' TO QUE-COLA.
           MOVE IDD-VARI TO QUE-ITEM.
           MOVE +2000 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNX-PRO-QUE.


           MOVE OPC-IIC-IOPC IN LSM-FLD TO WSS-KEY-EM01.
           MOVE 1                       TO WSS-KEY-EM02.

           IF FRM-FFLD = FRM-FFLD-PF8 OR
              FRM-FFLD = FRM-FFLD-PF7
                  MOVE SCR-FRM-NUM-CORR TO WSS-KEY-EM02.

           MOVE 1                       TO WSS-KEY-EM03.

           MOVE 'COL' TO FIO-SIST.
           MOVE 'COL' TO TAB-COD-SIST.
           MOVE 'EML' TO TAB-COD-TTAB IN TAB.
           MOVE WSS-KEY-EMUL TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.


           MOVE 'EMULKEY' TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNX-PRO-QUE.

           MOVE 'EMULKEY' TO QUE-COLA.
           MOVE TAB-COD-CTAB IN TAB TO QUE-ITEM.
           MOVE +12 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNX-PRO-QUE.



           PERFORM GNS-FIO-TAB.

           MOVE FIO-STAT TO PGM-STAT-OPC.

           IF NOT FIO-STAT-OKS
                GO TO FIN-FND-KEY.

           MOVE TAB-GLS-ABRV IN TAB TO FRM-COD-RESP IN LSM-FLD.
           MOVE TAB-GLS-DCOR IN TAB TO FRM-CIC-RESP IN LSM-FLD.
           IF NOT ( FRM-FFLD = FRM-FFLD-PF8 OR
                    FRM-FFLD = FRM-FFLD-PF7 )
               MOVE 1     TO FRM-NUM-CORR IN LSM-FLD.

           MOVE ZEROES TO WSS-NUM-INDX.

       CIC-FND-KEY.    

           ADD 1 TO WSS-NUM-INDX.
           MOVE TAB-GLS-DESC TO WSS-TAB-GLS-DESC.
           MOVE TAB-GLS-DATA TO WSS-TAB-GLS-DATA.
           MOVE WSS-TAB TO FRM-GLS-DMSG IN LSM-FLD(WSS-NUM-INDX).
           MOVE FIO-GET-NXT TO FIO-CMND.

           MOVE TAB-COD-CTAB IN TAB TO WSS-KEY-EMUL.
           MOVE WSS-KEY-EM02 TO FRM-NUM-CORR IN LSM-FLD.
           MOVE WSS-KEY-EM03 TO FRM-NUM-NLIN IN LSM-FLD(WSS-NUM-INDX).

           MOVE 'IDDVARI2' TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNX-PRO-QUE.


           MOVE 'IDDVARI2' TO QUE-COLA.
           MOVE IDD-VARI TO QUE-ITEM.
           MOVE +2000 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNX-PRO-QUE.

           PERFORM GNS-FIO-TAB.
           MOVE TAB-COD-CTAB IN TAB TO CMP-WSS-KEY-EMUL.

           MOVE 'LOG01' TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNX-PRO-QUE.

           MOVE 'LOG01' TO QUE-COLA.
           MOVE FIO-STAT TO QUE-ITEM.
           MOVE +200 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNX-PRO-QUE.


           MOVE 'LOG02' TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNX-PRO-QUE.

           MOVE 'LOG02' TO QUE-COLA.
           MOVE TAB-COD-TTAB TO QUE-ITEM.
           MOVE +200 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNX-PRO-QUE.


           IF NOT FIO-STAT-OKS
               MOVE FIO-STAT TO PGM-STAT-OPC
               GO TO FIN-FND-KEY.

           MOVE 'LOG03' TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNX-PRO-QUE.

           MOVE 'LOG03' TO QUE-COLA.
           MOVE WSS-KEY-EM01 TO QUE-ITEM.
           MOVE +200 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNX-PRO-QUE.

           MOVE 'LOG04' TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNX-PRO-QUE.

           MOVE 'LOG04' TO QUE-COLA.
           MOVE OPC-IIC-IOPC IN LSM-FLD TO QUE-ITEM.
           MOVE +200 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNX-PRO-QUE.

           MOVE 'LOG05' TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNX-PRO-QUE.

           MOVE 'LOG05' TO QUE-COLA.
           MOVE WSS-KEY-EM02 TO QUE-ITEM.
           MOVE +200 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNX-PRO-QUE.


           MOVE 'LOG06' TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNX-PRO-QUE.

           MOVE 'LOG06' TO QUE-COLA.
           MOVE CMP-WSS-KEY-EM02 TO QUE-ITEM.
           MOVE +200 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNX-PRO-QUE.


           IF TAB-COD-TTAB IN TAB NOT = 'EML' 
               GO TO FIN-FND-KEY.

           IF WSS-KEY-EM01 = OPC-IIC-IOPC IN LSM-FLD AND
              WSS-KEY-EM02 = CMP-WSS-KEY-EM02
                GO TO CIC-FND-KEY.
                
      *>>>> FIN_FND_KEY
*% END
*% IF INI_SCR_DMSG
      *<<<< INI_SCR_DMSG
      * Con este codigo logramos que una vez terminada la consulta
      * las claves no se borren de la pantalla
           IF SCR-CMND = 'CON' AND
              SCR-INST = SCR-INST-GKY AND
              FRM-FFLD NOT = FRM-FFLD-RET
                  MOVE PGM-NO-LIMPIAR-NADA TO PGM-ICLR.
      *<<<< desde INI_SCR_PUTA


           MOVE 'SCRPUTA' TO QUE-COLA.
           MOVE QUE-DEL TO QUE-CMND.
           PERFORM GNX-PRO-QUE.


           MOVE 'SCRPUTA' TO QUE-COLA.
           MOVE SCR-VARI TO QUE-ITEM.
           MOVE +2000 TO QUE-LITM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNX-PRO-QUE.



      *>>>> desde INI_SCR_PUTA


      *>>>> INI_SCR_DMSG
*% END
*% IF PFS_GET_CON OR PFS_GET_ACC OR PFS_SCR_GKEY
      *<<<< PFS_GET_CON OR PFS_GET_ACC OR PFS_SCR_GKEY
           IF NOT ( FRM-FFLD = FRM-FFLD-PF8 OR FRM-FFLD = FRM-FFLD-PF7 )
      *>>>>
*% END
*% IF PFS_SCR_ACC
      *<<<< PFS_SCR_ACC
           IF FRM-FFLD = FRM-FFLD-PF8 OR FRM-FFLD-PF7
               NEXT SENTENCE.
      *>>>>
*% END
*% IF FND_KEY
      *<<<<< FND_KEY
           IF OPC-CAI-IOPC IN LSM-FLD > SPACES AND 
              OPC-IIC-IOPC IN LSM-FLD > SPACES
              MOVE OPC-CAI-IOPC IN LSM-FLD TO CCU-CAI-IOPC(1) 
              MOVE OPC-IIC-IOPC IN LSM-FLD TO CCU-IIC-IOPC(1) 
              MOVE SPACES                  TO CCU-CIC-ICLI
           ELSE
              MOVE SPACES                  TO CCU-CAI-IOPC(1) 
              MOVE SPACES                  TO CCU-IIC-IOPC(1) 
              MOVE DBC-CAI-ICLI IN DBC     TO CCU-CAI-ICLI
              MOVE DBC-IIC-ICLI IN DBC     TO CCU-IIC-ICLI.

      *temp        PERFORM LDC-PRO-CCU.
      *temp        MOVE CCU-NUM-MENS TO FRM-COD-RESP IN LSM-FLD.
      *temp        MOVE CCU-MENS     TO FRM-GLS-DES1 IN LSM-FLD.


      *        IF CCU-NUM-MENS < CCU-NUM-CALC AND
      *           CCU-NUM-MENS > ZEROES
      *             MOVE CCU-MENS TO FRM-MENS
      *             GO TO ERR-FND-KEY.
*% END
*% IF INI_HBL_KEY
      *<<<< INI_HBL_KEY

           IF SCR-DESDE-CMN
               MOVE ZEROES TO SCR-FRM-NUM-CORR
               MOVE 'TTTTTTTTTTTTTTT' TO SCR-FRM-GLS-DISP

               MOVE 'DESDE1' TO QUE-COLA
               MOVE QUE-DEL TO QUE-CMND
               PERFORM GNX-PRO-QUE

               MOVE 'DESDE1' TO QUE-COLA
               MOVE SCR-FRM-NUM-CORR TO QUE-ITEM
               MOVE +4 TO QUE-LITM
               MOVE QUE-PUT TO QUE-CMND
               PERFORM GNX-PRO-QUE
               
               MOVE 'DESDE2' TO QUE-COLA
               MOVE QUE-DEL TO QUE-CMND
               PERFORM GNX-PRO-QUE

               MOVE 'DESDE2' TO QUE-COLA
               MOVE SCR-VARI TO QUE-ITEM
               MOVE +2000 TO QUE-LITM
               MOVE QUE-PUT TO QUE-CMND
               PERFORM GNX-PRO-QUE.

      *>>>> INI_HBL_KEY
*% END
*% IF EOF
      *<<<< EOF
       COPY SGCBFDBC.
       COPY COLBFRDC.
       COPY GNSBGCPT.
       COPY LDCBGCCU.
       COPY LDCBFCLF.
       COPY LDCBKCCU.
       COPY LDCBKCEG.

       GNX-PRO-QUE SECTION.
       INI-GNX-PRO-QUE.

           IF WSS-LOG-QUE = WSS-CTE-SI
               PERFORM GNX-PRO-QUE.
       FIN-GNX-PRO-QUE.
           EXIT.
      *>>>> EOF
*% END
