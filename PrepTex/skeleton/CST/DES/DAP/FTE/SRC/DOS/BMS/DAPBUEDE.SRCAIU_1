      *
      * DAPBUOPD
      * Version 3.0.1 Nov-2005
      * 29-Mar-19 02:57 PM
      *
       SET-TAG-DAPBUOPD SECTION.
       INI-SET-TAG-DAPBUOPD.
           MOVE
           '<IDNMOD NOM=$DAPBUOPD$ VSN=$01-13$ VGM=$3.0.1$
      -    'GEN=$29-Mar-19 02:57 PM$ FNC=$110334$/>'
               TO WSS-CVT-ITEM.
       FIN-SET-TAG-DAPBUOPD.
           EXIT.
           
       RET-ALL-OPD SECTION.
       INI-RET-ALL-OPD.
           PERFORM KEY-ALL-OPD.
           PERFORM RET-OPD-OPD.
           PERFORM RET-RCC-OPD.
           PERFORM RET-CAD-OPD.
           PERFORM RET-DBC-OPD.
           PERFORM RET-RCD-OPD.
       FIN-RET-ALL-OPD.
           EXIT.
       
       RET-OPD-OPD SECTION.
       INI-RET-OPD-OPD.
      * FEC-INI --> BMCHIBCI002210.SRCAIU RET-ALL Y KEY-ALL
           MOVE OPD-NUM-DCMP IN OPD-FLD TO OPD-NUM-DCMP IN OPD.
           MOVE OPD-NUM-MCMP IN OPD-FLD TO OPD-NUM-MCMP IN OPD.
           MOVE OPD-NUM-SCMP IN OPD-FLD TO OPD-NUM-SCMP IN OPD.
           MOVE OPD-NUM-ACMP IN OPD-FLD TO OPD-NUM-ACMP IN OPD.
      * FEC-FIN --> BMCHIBCI002210.SRCAIU RET-ALL Y KEY-ALL
      * FEC-INI --> BMCHIBCI002210.SRCAIU RET-ALL Y KEY-ALL
           MOVE OPD-NUM-DREA IN OPD-FLD TO OPD-NUM-DREA IN OPD.
           MOVE OPD-NUM-MREA IN OPD-FLD TO OPD-NUM-MREA IN OPD.
           MOVE OPD-NUM-SREA IN OPD-FLD TO OPD-NUM-SREA IN OPD.
           MOVE OPD-NUM-AREA IN OPD-FLD TO OPD-NUM-AREA IN OPD.
      * FEC-FIN --> BMCHIBCI002210.SRCAIU RET-ALL Y KEY-ALL
      * FEC-INI --> BMCHIBCI002210.SRCAIU RET-ALL Y KEY-ALL
           MOVE OPD-NUM-DCTB IN OPD-FLD TO OPD-NUM-DCTB IN OPD.
           MOVE OPD-NUM-MCTB IN OPD-FLD TO OPD-NUM-MCTB IN OPD.
           MOVE OPD-NUM-SCTB IN OPD-FLD TO OPD-NUM-SCTB IN OPD.
           MOVE OPD-NUM-ACTB IN OPD-FLD TO OPD-NUM-ACTB IN OPD.
      * FEC-FIN --> BMCHIBCI002210.SRCAIU RET-ALL Y KEY-ALL
           MOVE OPD-COD-VCAM IN OPD-FLD TO OPD-COD-VCAM IN OPD.
           MOVE OPD-COD-TOPD IN OPD-FLD TO OPD-COD-TOPD IN OPD.
           MOVE OPD-COD-AOPD IN OPD-FLD TO OPD-COD-AOPD IN OPD.
           MOVE OPD-COD-OFIC IN OPD-FLD TO OPD-COD-OFIC IN OPD.
      * FEC-INI --> BMCHIBCI002210.SRCAIU RET-ALL Y KEY-ALL
           MOVE OPD-NUM-DPVC IN OPD-FLD TO OPD-NUM-DPVC IN OPD.
           MOVE OPD-NUM-MPVC IN OPD-FLD TO OPD-NUM-MPVC IN OPD.
           MOVE OPD-NUM-SPVC IN OPD-FLD TO OPD-NUM-SPVC IN OPD.
           MOVE OPD-NUM-APVC IN OPD-FLD TO OPD-NUM-APVC IN OPD.
      * FEC-FIN --> BMCHIBCI002210.SRCAIU RET-ALL Y KEY-ALL
      * FEC-INI --> BMCHIBCI002210.SRCAIU RET-ALL Y KEY-ALL
           MOVE OPD-NUM-DTER IN OPD-FLD TO OPD-NUM-DTER IN OPD.
           MOVE OPD-NUM-MTER IN OPD-FLD TO OPD-NUM-MTER IN OPD.
           MOVE OPD-NUM-STER IN OPD-FLD TO OPD-NUM-STER IN OPD.
           MOVE OPD-NUM-ATER IN OPD-FLD TO OPD-NUM-ATER IN OPD.
      * FEC-FIN --> BMCHIBCI002210.SRCAIU RET-ALL Y KEY-ALL
           MOVE OPD-NUM-PVEN IN OPD-FLD TO OPD-NUM-PVEN IN OPD.
           MOVE OPD-VAL-CAPT IN OPD-FLD TO OPD-VAL-CAPT IN OPD.
           MOVE OPD-COD-EATE IN OPD-FLD TO OPD-COD-EATE IN OPD.
           MOVE OPD-SGV-TINT IN OPD-FLD TO OPD-SGV-TINT IN OPD.
           MOVE OPD-COD-MORE IN OPD-FLD TO OPD-COD-MORE IN OPD.
           MOVE OPD-IND-PVEN IN OPD-FLD TO OPD-IND-PVEN IN OPD.
           MOVE OPD-COD-GARA IN OPD-FLD TO OPD-COD-GARA IN OPD.
           MOVE OPD-COD-CUST IN OPD-FLD TO OPD-COD-CUST IN OPD.
           MOVE OPD-COD-IONP IN OPD-FLD TO OPD-COD-IONP IN OPD.
           MOVE OPD-NUM-DURV IN OPD-FLD TO OPD-NUM-DURV IN OPD.
           MOVE OPD-IND-DURV IN OPD-FLD TO OPD-IND-DURV IN OPD.
           MOVE OPD-NUM-SEVE IN OPD-FLD TO OPD-NUM-SEVE IN OPD.
           MOVE OPD-IND-SEVE IN OPD-FLD TO OPD-IND-SEVE IN OPD.
           MOVE OPD-SGV-MPRE IN OPD-FLD TO OPD-SGV-MPRE IN OPD.
           MOVE OPD-NUM-RETD IN OPD-FLD TO OPD-NUM-RETD IN OPD.
           MOVE OPD-IND-RETD IN OPD-FLD TO OPD-IND-RETD IN OPD.
           MOVE OPD-COD-UBFD IN OPD-FLD TO OPD-COD-UBFD IN OPD.
           MOVE OPD-COD-DEVL IN OPD-FLD TO OPD-COD-DEVL IN OPD.
           MOVE OPD-COD-AFER IN OPD-FLD TO OPD-COD-AFER IN OPD.
           MOVE OPD-COD-STAT IN OPD-FLD TO OPD-COD-STAT IN OPD.
           MOVE OPD-COD-SCTB IN OPD-FLD TO OPD-COD-SCTB IN OPD.
           MOVE OPD-COD-EJEC IN OPD-FLD TO OPD-COD-EJEC IN OPD.
      *LRH ini 10-OCT-1994
           IF FRM-VAL-IPES IN OPD-FLD > ZEROES
               MOVE FRM-VAL-IPES IN OPD-FLD TO OPD-VAL-IPES IN OPD
           ELSE
           IF OPD-VAL-CAPT IN OPD-FLD > ZEROES
               MOVE OPD-VAL-CAPT IN OPD-FLD TO OPD-VAL-IPES IN OPD.
      *LRH fin 10-OCT-1994
       FIN-RET-OPD-OPD.
           EXIT.
       
       RET-RCC-OPD SECTION.
       INI-RET-RCC-OPD.
           MOVE RCC-NUM-DIRE IN OPD-FLD TO RCC-NUM-DIRE IN RCC.
       FIN-RET-RCC-OPD.
           EXIT.
       
       RET-CAD-OPD SECTION.
       INI-RET-CAD-OPD.
           MOVE CAD-IND-TCAD IN OPD-FLD TO CAD-IND-TCAD IN CAD.
           MOVE CAD-CAI-ICAD IN OPD-FLD TO CAD-CAI-ICAD IN CAD.
           MOVE CAD-IIC-ICAD IN OPD-FLD TO CAD-IIC-ICAD IN CAD.
       FIN-RET-CAD-OPD.
           EXIT.
       
       RET-DBC-OPD SECTION.
       INI-RET-DBC-OPD.
       FIN-RET-DBC-OPD.
           EXIT.
       
       RET-RCD-OPD SECTION.
       INI-RET-RCD-OPD.
           MOVE RCD-GLS-DIRE IN OPD-FLD TO RCD-GLS-DIRE IN RCD.
       FIN-RET-RCD-OPD.
           EXIT.
       
       KEY-ALL-OPD SECTION.
       INI-KEY-ALL-OPD.
           PERFORM KEY-OPD-OPD.
           PERFORM KEY-RCC-OPD.
           PERFORM KEY-CAD-OPD.
           PERFORM KEY-DBC-OPD.
           PERFORM KEY-RCD-OPD.
       FIN-KEY-ALL-OPD.
           EXIT.
       
       KEY-OPD-OPD SECTION.
       INI-KEY-OPD-OPD.
           MOVE OPD-CAI-IOPD IN OPD-FLD TO OPD-CAI-IOPD IN OPD.
           MOVE OPD-IIC-IOPD IN OPD-FLD TO OPD-IIC-IOPD IN OPD.
           MOVE OPD-CAI-ISER IN OPD-FLD TO OPD-CAI-ISER IN OPD.
           MOVE OPD-IIC-ISER IN OPD-FLD TO OPD-IIC-ISER IN OPD.
       FIN-KEY-OPD-OPD.
           EXIT.
       
       KEY-RCC-OPD SECTION.
       INI-KEY-RCC-OPD.
       FIN-KEY-RCC-OPD.
           EXIT.
       
       KEY-CAD-OPD SECTION.
       INI-KEY-CAD-OPD.
       FIN-KEY-CAD-OPD.
           EXIT.
       
       KEY-DBC-OPD SECTION.
       INI-KEY-DBC-OPD.
           MOVE DBC-GLS-NOMC IN OPD-FLD TO DBC-GLS-NOMC IN DBC.
      * IDC-INI --> BMCHIBCI002210.SRCAIU RET-ALL Y KEY-ALL
           MOVE DBC-NUM-ICLI IN OPD-FLD TO DBC-NUM-ICLI IN DBC.
           MOVE DBC-VRF-ICLI IN OPD-FLD TO DBC-VRF-ICLI IN DBC.
           MOVE DBC-IND-ICLI IN OPD-FLD TO DBC-IND-ICLI IN DBC.
           MOVE DBC-GLS-ICLI IN OPD-FLD TO DBC-GLS-ICLI IN DBC.
      * IDC-FIN --> BMCHIBCI002210.SRCAIU RET-ALL Y KEY-ALL
       FIN-KEY-DBC-OPD.
           EXIT.
       
       KEY-RCD-OPD SECTION.
       INI-KEY-RCD-OPD.
       FIN-KEY-RCD-OPD.
           EXIT.
       
       SCR-CLRA-OPD SECTION.
       INI-SCR-CLRA-OPD.
           PERFORM CLR-KEY-OPD.
           PERFORM CLR-FLD-OPD.
       FIN-SCR-CLRA-OPD.
           EXIT.
       
       CLR-KEY-OPD SECTION.
       INI-CLR-KEY-OPD.
           MOVE SPACES TO OPD-CAI-IOPD IN OPD-FLD.
           MOVE ZEROES TO OPD-IIC-IOPD IN OPD-FLD.
           MOVE SPACES TO OPD-CAI-ISER IN OPD-FLD.
           MOVE ZEROES TO OPD-IIC-ISER IN OPD-FLD.
           MOVE SPACES TO DBC-GLS-NOMC IN OPD-FLD.
      * IDC-INI --> BMCHIBCI003.SRCAIU CLR ( KEY Y FLD )
           MOVE ZEROES TO DBC-NUM-ICLI IN OPD-FLD.
           MOVE SPACES TO DBC-VRF-ICLI IN OPD-FLD.
           MOVE SPACES TO DBC-IND-ICLI IN OPD-FLD.
           MOVE SPACES TO DBC-GLS-ICLI IN OPD-FLD.
      * IDC-FIN --> BMCHIBCI003.SRCAIU CLR ( KEY Y FLD )
      *<<<< FIN_CLR_KEY_OPD
           MOVE SCR-NEMO TO FRM-COD-OPCI IN OPD-FLD.
           IF SCR-IND-V001 = 'B'
                IF SCR-CMND = 'ODL'
                    MOVE '0710' TO OPD-CAI-IOPD IN OPD-FLD
                ELSE
                  IF SCR-CMND = 'ODB'
                     MOVE '0711' TO OPD-CAI-IOPD IN OPD-FLD.
      *>>>> END
       FIN-CLR-KEY-OPD.
           EXIT.
       
       CLR-FLD-OPD SECTION.
       INI-CLR-FLD-OPD.
           MOVE SPACES TO FRM-GLS-VCAM IN OPD-FLD.
           MOVE SPACES TO FRM-GLS-TOPD IN OPD-FLD.
           MOVE SPACES TO FRM-GLS-AOPD IN OPD-FLD.
           MOVE SPACES TO FRM-GLS-OFIC IN OPD-FLD.
           MOVE ZEROES TO FRM-VAL-IPES IN OPD-FLD.
           MOVE SPACES TO FRM-COD-EATE IN OPD-FLD.
           MOVE SPACES TO FRM-GLS-TINT IN OPD-FLD.
           MOVE SPACES TO FRM-GLS-PVEN IN OPD-FLD.
           MOVE SPACES TO FRM-GLS-EJEC IN OPD-FLD.
           MOVE ZEROES TO FRM-VAL-FORI IN OPD-FLD.
           MOVE SPACES TO FRM-GLS-DURV IN OPD-FLD.
           MOVE ZEROES TO FRM-NUM-TVEN IN OPD-FLD.
           MOVE SPACES TO FRM-GLS-SEVE IN OPD-FLD.
           MOVE SPACES TO FRM-GLS-MORE IN OPD-FLD.
           MOVE SPACES TO FRM-GLS-RETD IN OPD-FLD.
           MOVE SPACES TO FRM-GLS-UBFD IN OPD-FLD.
           MOVE SPACES TO FRM-CAI-ICAD IN OPD-FLD.
           MOVE ZEROES TO FRM-IIC-ICAD IN OPD-FLD.
           MOVE ZEROES TO FRM-NUM-TOPE IN OPD-FLD.
           MOVE SPACES TO FRM-COD-OPCI IN OPD-FLD.
           PERFORM CLR-OPD-OPD.
           PERFORM CLR-RCC-OPD.
           PERFORM CLR-CAD-OPD.
           PERFORM CLR-DBC-OPD.
           PERFORM CLR-RCD-OPD.
      *<<<< FIN_CLR_FLD_OPD
           MOVE SCR-NEMO TO FRM-COD-OPCI IN OPD-FLD.
      *>>>> END
       FIN-CLR-FLD-OPD.
           EXIT.
       
       CLR-OPD-OPD SECTION.
       INI-CLR-OPD-OPD.
      * FEC-INI --> BMCHIBCI003.SRCAIU CLR ( KEY Y FLD )
           MOVE ZEROES TO OPD-FEC-FCMP IN OPD-FLD.
      * FEC-FIN --> BMCHIBCI003.SRCAIU CLR ( KEY Y FLD )
      * FEC-INI --> BMCHIBCI003.SRCAIU CLR ( KEY Y FLD )
           MOVE ZEROES TO OPD-FEC-FREA IN OPD-FLD.
      * FEC-FIN --> BMCHIBCI003.SRCAIU CLR ( KEY Y FLD )
      * FEC-INI --> BMCHIBCI003.SRCAIU CLR ( KEY Y FLD )
           MOVE ZEROES TO OPD-FEC-FCTB IN OPD-FLD.
      * FEC-FIN --> BMCHIBCI003.SRCAIU CLR ( KEY Y FLD )
           MOVE SPACES TO OPD-COD-VCAM IN OPD-FLD.
           MOVE SPACES TO OPD-COD-TOPD IN OPD-FLD.
           MOVE SPACES TO OPD-COD-AOPD IN OPD-FLD.
           MOVE SPACES TO OPD-COD-OFIC IN OPD-FLD.
      * FEC-INI --> BMCHIBCI003.SRCAIU CLR ( KEY Y FLD )
           MOVE ZEROES TO OPD-FEC-FPVC IN OPD-FLD.
      * FEC-FIN --> BMCHIBCI003.SRCAIU CLR ( KEY Y FLD )
      * FEC-INI --> BMCHIBCI003.SRCAIU CLR ( KEY Y FLD )
           MOVE ZEROES TO OPD-FEC-FTER IN OPD-FLD.
      * FEC-FIN --> BMCHIBCI003.SRCAIU CLR ( KEY Y FLD )
           MOVE ZEROES TO OPD-NUM-PVEN IN OPD-FLD.
           MOVE ZEROES TO OPD-VAL-CAPT IN OPD-FLD.
           MOVE SPACES TO OPD-COD-EATE IN OPD-FLD.
           MOVE ZEROES TO OPD-SGV-TINT IN OPD-FLD.
           MOVE SPACES TO OPD-COD-MORE IN OPD-FLD.
           MOVE SPACES TO OPD-IND-PVEN IN OPD-FLD.
           MOVE SPACES TO OPD-COD-GARA IN OPD-FLD.
           MOVE SPACES TO OPD-COD-CUST IN OPD-FLD.
           MOVE SPACES TO OPD-COD-IONP IN OPD-FLD.
           MOVE ZEROES TO OPD-NUM-DURV IN OPD-FLD.
           MOVE SPACES TO OPD-IND-DURV IN OPD-FLD.
           MOVE ZEROES TO OPD-NUM-SEVE IN OPD-FLD.
           MOVE SPACES TO OPD-IND-SEVE IN OPD-FLD.
           MOVE ZEROES TO OPD-SGV-MPRE IN OPD-FLD.
           MOVE ZEROES TO OPD-NUM-RETD IN OPD-FLD.
           MOVE SPACES TO OPD-IND-RETD IN OPD-FLD.
           MOVE SPACES TO OPD-COD-UBFD IN OPD-FLD.
           MOVE SPACES TO OPD-COD-DEVL IN OPD-FLD.
           MOVE SPACES TO OPD-COD-AFER IN OPD-FLD.
           MOVE SPACES TO OPD-COD-STAT IN OPD-FLD.
           MOVE SPACES TO OPD-COD-SCTB IN OPD-FLD.
           MOVE SPACES TO OPD-COD-EJEC IN OPD-FLD.
       FIN-CLR-OPD-OPD.
           EXIT.
       
       CLR-RCC-OPD SECTION.
       INI-CLR-RCC-OPD.
           MOVE ZEROES TO RCC-NUM-DIRE IN OPD-FLD.
       FIN-CLR-RCC-OPD.
           EXIT.
       
       CLR-CAD-OPD SECTION.
       INI-CLR-CAD-OPD.
           MOVE SPACES TO CAD-IND-TCAD IN OPD-FLD.
           MOVE SPACES TO CAD-CAI-ICAD IN OPD-FLD.
           MOVE ZEROES TO CAD-IIC-ICAD IN OPD-FLD.
       FIN-CLR-CAD-OPD.
           EXIT.
       
       CLR-DBC-OPD SECTION.
       INI-CLR-DBC-OPD.
       FIN-CLR-DBC-OPD.
           EXIT.
       
       CLR-RCD-OPD SECTION.
       INI-CLR-RCD-OPD.
           MOVE SPACES TO RCD-GLS-DIRE IN OPD-FLD.
       FIN-CLR-RCD-OPD.
           EXIT.
       
       FST-KEY-OPD SECTION.
       INI-FST-KEY-OPD.
      *<<<< INI_FST_KEY_OPD 
           IF SCR-CCPP = 'ING'
                MOVE -1 TO OPD-COD-VCAM-LEN IN OPD-FLD
                GO TO FIN-FST-KEY-OPD.
      *     IF SCR-CMND = 'RDL'
      *          MOVE -1 TO OPD-CAI-ISER-LEN IN OPD-FLD
      *          GO TO FIN-FST-KEY-OPD.
      *>>>> INI_FST_KEY_OPD 
           MOVE -1 TO OPD-CAI-IOPD-LEN IN OPD-FLD.
       FIN-FST-KEY-OPD.
           EXIT.
       
       FST-FLD-OPD SECTION.
       INI-FST-FLD-OPD.
      *<<<< INI_FST_FLD_OPD 
           IF SCR-CMND = 'MDA'
                MOVE -1 TO RCC-NUM-DIRE-LEN IN OPD-FLD
                GO TO FIN-FST-FLD-OPD.
           IF SCR-CMND = 'RLR'
                PERFORM FST-MSG
                GO TO FIN-FST-FLD-OPD.
           IF SCR-CMND = 'RDL'
                MOVE -1 TO OPD-COD-EATE-LEN IN OPD-FLD
                GO TO FIN-FST-FLD-OPD.
           MOVE -1 TO OPD-COD-VCAM-LEN IN OPD-FLD.
           GO TO FIN-FST-FLD-OPD.
      *>>>> INI_FST_KEY_OPD 
           MOVE FRM-POS-CURS TO OPD-FEC-FREA-LEN IN OPD-FLD.
       FIN-FST-FLD-OPD.
           EXIT.
       
       PRO-KEY-OPD SECTION.
       INI-PRO-KEY-OPD.
           PERFORM PRO-MKY-OPD.
       FIN-PRO-KEY-OPD.
           EXIT.
       
       PRO-MKY-OPD SECTION.
       INI-PRO-MKY-OPD.
           MOVE FRM-CPIM-AEY TO OPD-CAI-ISER-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-IIC-ISER-ATR IN OPD-FLD.
      * IDC-INI --> BMCHIBCI005.SRCAIU PRO ( KEY Y FLD )
           MOVE FRM-CPIM-AEY TO DBC-NUM-ICLI-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO DBC-VRF-ICLI-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO DBC-IND-ICLI-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO DBC-GLS-ICLI-ATR IN OPD-FLD.
      * IDC-FIN --> BMCHIBCI005.SRCAIU PRO ( KEY Y FLD )
       FIN-PRO-MKY-OPD.
           EXIT.
       
       PRO-FLD-OPD SECTION.
       INI-PRO-FLD-OPD.
           MOVE FRM-CPIM-AEY TO FRM-VAL-IPES-ATR IN OPD-FLD.
           MOVE FRM-CPIM-ANY TO FRM-COD-EATE-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO FRM-NUM-TVEN-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO FRM-CAI-ICAD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO FRM-IIC-ICAD-ATR IN OPD-FLD.
           PERFORM PRO-OPD-OPD.
           PERFORM PRO-RCC-OPD.
           PERFORM PRO-CAD-OPD.
           PERFORM PRO-DBC-OPD.
           PERFORM PRO-RCD-OPD.
       FIN-PRO-FLD-OPD.
           EXIT.
       
       PRO-OPD-OPD SECTION.
       INI-PRO-OPD-OPD.
           MOVE FRM-CPIM-AEY TO OPD-FEC-FREA-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-FEC-FCTB-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-COD-VCAM-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-COD-TOPD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-COD-AOPD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-COD-OFIC-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-FEC-FPVC-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-FEC-FTER-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-NUM-PVEN-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-VAL-CAPT-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-COD-EATE-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-SGV-TINT-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-COD-MORE-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-IND-PVEN-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-COD-GARA-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-COD-CUST-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-NUM-DURV-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-IND-DURV-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-NUM-SEVE-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-IND-SEVE-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-SGV-MPRE-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-NUM-RETD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-IND-RETD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-COD-UBFD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-COD-DEVL-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO OPD-COD-EJEC-ATR IN OPD-FLD.
       FIN-PRO-OPD-OPD.
           EXIT.
       
       PRO-RCC-OPD SECTION.
       INI-PRO-RCC-OPD.
           MOVE FRM-CPIM-AEY TO RCC-NUM-DIRE-ATR IN OPD-FLD.
       FIN-PRO-RCC-OPD.
           EXIT.
       
       PRO-CAD-OPD SECTION.
       INI-PRO-CAD-OPD.
           MOVE FRM-CPIM-AEY TO CAD-IND-TCAD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO CAD-CAI-ICAD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-AEY TO CAD-IIC-ICAD-ATR IN OPD-FLD.
       FIN-PRO-CAD-OPD.
           EXIT.
       
       PRO-DBC-OPD SECTION.
       INI-PRO-DBC-OPD.
       FIN-PRO-DBC-OPD.
           EXIT.
       
       PRO-RCD-OPD SECTION.
       INI-PRO-RCD-OPD.
       FIN-PRO-RCD-OPD.
           EXIT.
       
       UNP-KEY-OPD SECTION.
       INI-UNP-KEY-OPD.
           PERFORM UNP-IKY-OPD.
           PERFORM UNP-AKY-OPD.
           PERFORM UNP-MKY-OPD.
       FIN-UNP-KEY-OPD.
           EXIT.
       
       UNP-IKY-OPD SECTION.
       INI-UNP-IKY-OPD.
           MOVE FRM-CPIM-UBY TO OPD-CAI-IOPD-ATR.
           MOVE FRM-CPIM-UBY TO OPD-IIC-IOPD-ATR.
      *<<<< FIN_UNP_IKY_OPD
           IF SCR-IND-V001 = 'B'
                MOVE '1' TO FRM-CPIM-AEY
                IF SCR-CMND = 'ODL' OR 'ODB'
                    MOVE FRM-CPIM-AEY TO OPD-CAI-IOPD-ATR
                    IF SCR-CMND = 'ODL'
                        MOVE FRM-CPIM-AEY TO OPD-IIC-IOPD-ATR.
      *>>>> END
       FIN-UNP-IKY-OPD.
           EXIT.
       
       UNP-MKY-OPD SECTION.
       INI-UNP-MKY-OPD.
           MOVE FRM-CPIM-UBY TO OPD-CAI-ISER-ATR.
           MOVE FRM-CPIM-UBY TO OPD-IIC-ISER-ATR.
      * IDC-INI --> BMCHIBCI006.SRCAIU UNP ( KEY Y FLD )
           MOVE FRM-CPIM-UBY TO DBC-NUM-ICLI-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO DBC-VRF-ICLI-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO DBC-IND-ICLI-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO DBC-GLS-ICLI-ATR IN OPD-FLD.
      * IDC-FIN --> BMCHIBCI006.SRCAIU UNP ( KEY Y FLD )
      *<<<< FIN_UNP_MKY_OPD
           IF SCR-IND-V001 = 'B'
                MOVE '1' TO FRM-CPIM-AEY
                IF SCR-CMND = 'ODL'
                    MOVE FRM-CPIM-AEY TO OPD-CAI-ISER-ATR
                                         OPD-IIC-ISER-ATR.
      *>>>> END
       FIN-UNP-MKY-OPD.
           EXIT.
       
       UNP-AKY-OPD SECTION.
       INI-UNP-AKY-OPD.
           MOVE FRM-CPIM-UBY TO DBC-GLS-NOMC-ATR.
       FIN-UNP-AKY-OPD.
           EXIT.
       
       UNP-FLD-OPD SECTION.
       INI-UNP-FLD-OPD.
           MOVE FRM-CPIM-UBY TO FRM-VAL-IPES-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UNY TO FRM-COD-EATE-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO FRM-NUM-TVEN-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO FRM-CAI-ICAD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO FRM-IIC-ICAD-ATR IN OPD-FLD.
           PERFORM UNP-OPD-OPD.
           PERFORM UNP-RCC-OPD.
           PERFORM UNP-CAD-OPD.
           PERFORM UNP-DBC-OPD.
           PERFORM UNP-RCD-OPD.
      *<<<< FIN_UNP_FLD_OPD
           MOVE '1' TO FRM-CPIM-AEY.
           MOVE FRM-CPIM-AEY TO OPD-COD-GARA-ATR IN OPD-FLD.
           IF SCR-CNAL = '100' OR
              SCR-CNAL = '110'
                GO TO FIN-UNP-FLD-OPD.

      *JSS-INI 28-JUN-2002
      *Si el usuario es centralizador no se puede proteger
      *el campo oficina
           MOVE WSS-IDN-SIST            TO USP-SISTEMA.
           MOVE SPACES                  TO USP-PERMISO.
           MOVE 'DAP'                   TO USP-GRUPO.
           MOVE SCR-USER                TO USP-USUARIO.
           MOVE 'DAPUSERS/CEN'          TO USP-STRING.
           PERFORM USPC107.
           IF USP-PERMISO = 'P'
               NEXT SENTENCE
           ELSE
      *JSS-FIN 28-JUN-2002
           MOVE FRM-CPIM-AEY TO OPD-COD-OFIC-ATR IN OPD-FLD.
           IF SCR-IND-V001 = 'B'
               MOVE FRM-CPIM-AEY TO OPD-FEC-FCTB-ATR IN OPD-FLD
               IF SCR-CMND = 'ODL'
                   MOVE FRM-CPIM-AEY TO OPD-FEC-FREA-ATR IN OPD-FLD.
      *>>>> 
       FIN-UNP-FLD-OPD.
           EXIT.
       
       UNP-OPD-OPD SECTION.
       INI-UNP-OPD-OPD.
           MOVE FRM-CPIM-UBY TO OPD-FEC-FREA-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-FEC-FCTB-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-COD-VCAM-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-COD-TOPD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-COD-AOPD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-COD-OFIC-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-FEC-FPVC-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-FEC-FTER-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-NUM-PVEN-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-VAL-CAPT-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-COD-EATE-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-SGV-TINT-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-COD-MORE-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-IND-PVEN-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-COD-GARA-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-COD-CUST-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-NUM-DURV-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-IND-DURV-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-NUM-SEVE-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-IND-SEVE-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-SGV-MPRE-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-NUM-RETD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-IND-RETD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-COD-UBFD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-COD-DEVL-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO OPD-COD-EJEC-ATR IN OPD-FLD.
      *<<<< FIN_UNP_OPD_OPD
      *CIMA-INI 26-ENE-2015 CUSTODIA DAP - IMPRESION
           MOVE FRM-CPIM-AEY TO OPD-COD-UBFD-ATR IN OPD-FLD.
      *CIMA-FIN 26-ENE-2015 CUSTODIA DAP - IMPRESION
      *>>>> FIN_UNP_OPD_OPD
       FIN-UNP-OPD-OPD.
           EXIT.
       
       UNP-RCC-OPD SECTION.
       INI-UNP-RCC-OPD.
           MOVE FRM-CPIM-UBY TO RCC-NUM-DIRE-ATR IN OPD-FLD.
       FIN-UNP-RCC-OPD.
           EXIT.
       
       UNP-CAD-OPD SECTION.
       INI-UNP-CAD-OPD.
           MOVE FRM-CPIM-UBY TO CAD-IND-TCAD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO CAD-CAI-ICAD-ATR IN OPD-FLD.
           MOVE FRM-CPIM-UBY TO CAD-IIC-ICAD-ATR IN OPD-FLD.
       FIN-UNP-CAD-OPD.
           EXIT.
       
       UNP-DBC-OPD SECTION.
       INI-UNP-DBC-OPD.
       FIN-UNP-DBC-OPD.
           EXIT.
       
       UNP-RCD-OPD SECTION.
       INI-UNP-RCD-OPD.
       FIN-UNP-RCD-OPD.
           EXIT.
       
       VAL-MKY-OPD SECTION.
       INI-VAL-MKY-OPD.
      *<<<< INI_VAL_MKY_OPD
           PERFORM VAL-OPD-CAI-ISER.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE -1 TO OPD-CAI-ISER-LEN IN OPD-FLD
                GO TO FIN-VAL-MKY-OPD.
           PERFORM VAL-OPD-IIC-ISER.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE -1 TO OPD-IIC-ISER-LEN IN OPD-FLD
                GO TO FIN-VAL-MKY-OPD.
           PERFORM VAL-DBC-IND-ICLI.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE -1 TO DBC-IND-ICLI-LEN IN OPD-FLD
                GO TO FIN-VAL-MKY-OPD.
           PERFORM VAL-DBC-GLS-ICLI.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE -1 TO DBC-GLS-ICLI-LEN IN OPD-FLD
                GO TO FIN-VAL-MKY-OPD.
           PERFORM VAL-DBC-NUM-ICLI.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE -1 TO DBC-NUM-ICLI-LEN IN OPD-FLD
                GO TO FIN-VAL-MKY-OPD.
           PERFORM VAL-DBC-VRF-ICLI.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE -1 TO DBC-VRF-ICLI-LEN IN OPD-FLD
                GO TO FIN-VAL-MKY-OPD.
      *>>>> INI_VAL_MKY_OPD
       FIN-VAL-MKY-OPD.
           EXIT.
       
       VAL-FLD-OPD SECTION.
       INI-VAL-FLD-OPD.
      *<<<< INI_VAL_FLD_OPD 
           IF SCR-CMND NOT = 'MDA'
               MOVE ZEROES TO OPD-FEC-FTER IN OPD-FLD.

      *    acceso a pod
           MOVE OPD-COD-VCAM IN OPD-FLD TO POD-COD-VCAM IN POD.
           MOVE OPD-COD-TOPD IN OPD-FLD TO POD-COD-TOPD IN POD.
           MOVE OPD-COD-AOPD IN OPD-FLD TO POD-COD-AOPD IN POD.
           MOVE ZEROES                  TO POD-NUM-IPOD IN POD.
      * ISP: DAPBG001
           PERFORM GET-POD.
           IF MSG-COD-MENS > SPACES
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               PERFORM FST-FLD-OPD
               GO TO FIN-VAL-FLD-OPD.
      * ISP: DAPBG003
           PERFORM MOV-POD.
           IF FRM-NUM-TVEN IN OPD-FLD = 1
               MOVE OPD-NUM-PVEN IN OPD-FLD TO OPD-NUM-DURV IN OPD-FLD
               MOVE OPD-IND-PVEN IN OPD-FLD TO OPD-IND-DURV IN OPD-FLD.
      *>>>>
      * FEC-INI --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
           PERFORM VAL-OPD-FEC-FCMP.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO
                OPD-FEC-FCMP-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
      * FEC-FIN --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
      * FEC-INI --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
           PERFORM VAL-OPD-FEC-FREA.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO
                OPD-FEC-FREA-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
      * FEC-FIN --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
      * FEC-INI --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
           PERFORM VAL-OPD-FEC-FCTB.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO
                OPD-FEC-FCTB-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
      * FEC-FIN --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
           PERFORM VAL-OPD-COD-VCAM.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-VCAM-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-GLS-VCAM.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-GLS-VCAM-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-TOPD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-TOPD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-GLS-TOPD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-GLS-TOPD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-AOPD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-AOPD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-GLS-AOPD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-GLS-AOPD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-OFIC.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-OFIC-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-GLS-OFIC.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-GLS-OFIC-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-VAL-IPES.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-VAL-IPES-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
      * FEC-INI --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
           PERFORM VAL-OPD-FEC-FPVC.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO
                OPD-FEC-FPVC-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
      * FEC-FIN --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
      * FEC-INI --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
           PERFORM VAL-OPD-FEC-FTER.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO
                OPD-FEC-FTER-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
      * FEC-FIN --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
           PERFORM VAL-OPD-NUM-PVEN.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-NUM-PVEN-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-VAL-CAPT.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-VAL-CAPT-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-EATE.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-EATE-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-COD-EATE.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-COD-EATE-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-SGV-TINT.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-SGV-TINT-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-GLS-TINT.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-GLS-TINT-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-MORE.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-MORE-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-IND-PVEN.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-IND-PVEN-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-GLS-PVEN.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-GLS-PVEN-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-GLS-EJEC.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-GLS-EJEC-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-VAL-FORI.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-VAL-FORI-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-GARA.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-GARA-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-CUST.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-CUST-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-IONP.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-IONP-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-NUM-DURV.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-NUM-DURV-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-IND-DURV.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-IND-DURV-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-GLS-DURV.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-GLS-DURV-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-NUM-TVEN.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-NUM-TVEN-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-NUM-SEVE.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-NUM-SEVE-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-IND-SEVE.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-IND-SEVE-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-GLS-SEVE.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-GLS-SEVE-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-SGV-MPRE.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-SGV-MPRE-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-GLS-MORE.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-GLS-MORE-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-NUM-RETD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-NUM-RETD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-IND-RETD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-IND-RETD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-GLS-RETD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-GLS-RETD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-UBFD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-UBFD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-DEVL.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-DEVL-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-GLS-UBFD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-GLS-UBFD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-AFER.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-AFER-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-STAT.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-STAT-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-SCTB.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-SCTB-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-COD-EJEC.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-COD-EJEC-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-RCC-NUM-DIRE.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO RCC-NUM-DIRE-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-CAD-IND-TCAD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO CAD-IND-TCAD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-CAD-CAI-ICAD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO CAD-CAI-ICAD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-CAD-IIC-ICAD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO CAD-IIC-ICAD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-CAI-ICAD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-CAI-ICAD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-IIC-ICAD.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-IIC-ICAD-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-FRM-NUM-TOPE.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-NUM-TOPE-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-CAI-ISER.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-CAI-ISER-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-OPD-IIC-ISER.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO OPD-IIC-ISER-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
      * VRF-INI --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
      * VRF-FIN --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
      * IDC-INI --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
           PERFORM VAL-DBC-IND-ICLI.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO
                DBC-IND-ICLI-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-DBC-GLS-ICLI.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO
                DBC-GLS-ICLI-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-DBC-NUM-ICLI.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO
                DBC-NUM-ICLI-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-DBC-VRF-ICLI.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO
                DBC-VRF-ICLI-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
      * IDC-FIN --> BMCHIBCI007.SRCAIU PERFORM VAL-[FLD]
           PERFORM VAL-FRM-COD-OPCI.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO FRM-COD-OPCI-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
           PERFORM VAL-RCD-GLS-DIRE.
           IF FRM-SUAR = FRM-SUAR-MAL OR FRM-SUAR = FRM-SUAR-CLR
                MOVE FRM-IND-ERRO TO RCD-GLS-DIRE-LEN IN OPD-FLD
                GO TO FIN-VAL-FLD-OPD.
       FIN-VAL-FLD-OPD.
           EXIT.
      * FEC-INI --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION
       VAL-OPD-FEC-FCMP SECTION.
       INI-VAL-OPD-FEC-FCMP.
           IF OPD-FEC-FCMP IN OPD-FLD  NOT > ZEROES
              MOVE ZEROES TO OPD-FEC-FCMP IN OPD-FLD.
      *<<<< INI_OPD_FEC_FCMP
           IF SCR-CMND = 'RDL' OR 'RLR' OR 'MDA'
                MOVE FEC-VHBL-N TO FEC-VHBL.
      *>>>> INI_OPD_FEC_FCMP
      *<<<< OPD_FEC_FCMP
           IF SCR-CMND NOT = 'MDA' AND
              SCR-CMND NOT = 'RDL' AND
              SCR-CMND NOT = 'RLR'
               PERFORM GET-FHOY
               MOVE HOY-DHOY TO OPD-NUM-DCMP IN OPD-FLD
               MOVE HOY-MHOY TO OPD-NUM-MCMP IN OPD-FLD
               MOVE HOY-SHOY TO OPD-NUM-SCMP IN OPD-FLD
               MOVE HOY-AHOY TO OPD-NUM-ACMP IN OPD-FLD
               MOVE OPD-FEC-FCMP IN OPD-FLD TO FEC-FECH
               MOVE FEC-FORM-FEC TO FEC-FORM
               MOVE FEC-FBLK-S  TO FEC-FBLK
               MOVE FEC-CHOY-LE TO FEC-CHOY
               MOVE FEC-VHBL-S TO FEC-VHBL
               MOVE FEC-VAL-FEC TO FEC-CMND
               PERFORM PRO-FEC
               IF HOY-HHHY NOT < 16 AND
                  ( SCR-CNAL = '100'
                         OR
                    SCR-CNAL = '110' )
                    PERFORM SIG-HBL-FCMP
               ELSE
               IF SCR-MODO = 'T'
                    PERFORM SIG-HBL-FCMP
               ELSE
               IF ( SCR-CNAL = '100'
                         OR
                    SCR-CNAL = '110' )
                     IF NOT FEC-STAT-HBL
                        PERFORM SIG-HBL-FCMP.
      *>>>> OPD_FEC_FCMP
       FIN-VAL-OPD-FEC-FCMP.
           EXIT.
      * FEC-FIN --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION
      * FEC-INI --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION
       VAL-OPD-FEC-FREA SECTION.
       INI-VAL-OPD-FEC-FREA.
           IF OPD-FEC-FREA IN OPD-FLD  NOT > ZEROES
              MOVE ZEROES TO OPD-FEC-FREA IN OPD-FLD.
      *VAL-FEC Validar Fecha
           MOVE OPD-FEC-FREA IN OPD-FLD TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S  TO FEC-FBLK.
           MOVE FEC-CHOY-LE TO FEC-CHOY.
           MOVE FEC-VHBL-S TO FEC-VHBL.
      *<<<< INI_OPD_FEC_FREA
           IF OPD-FEC-FREA IN OPD-FLD NOT > ZEROES
                MOVE OPD-FEC-FCMP IN OPD-FLD TO
                     OPD-FEC-FREA IN OPD-FLD.
           IF SCR-CMND = 'MDA' OR 'RDL' OR 'RLR'
               GO TO FIN-VAL-OPD-FEC-FREA.
      *>>>> INI_OPD_FEC_FREA
           IF SCR-CNAL = '100' OR
              SCR-CNAL = '110'
               MOVE FEC-VHBL-N TO FEC-VHBL.

           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-OKS
               MOVE FEC-FECH TO OPD-FEC-FREA IN OPD-FLD
           ELSE
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE FEC-MENS     TO FRM-MENS
               GO TO FIN-VAL-OPD-FEC-FREA.
      *<<<< OPD_FEC_FREA
           IF SCR-CMND = 'ODL' AND
              SCR-CNAL NOT = '100' AND
              SCR-CNAL NOT = '110' AND
              OPD-FEC-FREA IN OPD-FLD NOT = OPD-FEC-FCMP IN OPD-FLD
                MOVE 'FREA<>FCMP' TO MSG-COD-MENS
                MOVE 'DAP' TO MSG-COD-SIST
                PERFORM GET-MSG
                MOVE MSG-GLS-DESC TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                GO TO FIN-VAL-OPD-FEC-FREA.
      *>>>> OPD_FEC_FREA
       FIN-VAL-OPD-FEC-FREA.
           EXIT.
      * FEC-FIN --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION
      * FEC-INI --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION
       VAL-OPD-FEC-FCTB SECTION.
       INI-VAL-OPD-FEC-FCTB.
           IF OPD-FEC-FCTB IN OPD-FLD  NOT > ZEROES
              MOVE ZEROES TO OPD-FEC-FCTB IN OPD-FLD.
      *VAL-FEC Validar Fecha
           MOVE OPD-FEC-FCTB IN OPD-FLD TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S  TO FEC-FBLK.
           MOVE FEC-CHOY-LE TO FEC-CHOY.
           MOVE FEC-VHBL-S TO FEC-VHBL.
      *<<<< INI_OPD_FEC_FCTB
           MOVE FEC-CHOY-N TO FEC-CHOY.
           IF SCR-IND-V001 = 'B'
      *DAPR0027-INI(RRM) 31-MAY-2000
      *       MOVE OPD-FEC-FREA IN OPD-FLD TO
              MOVE OPD-FEC-FCMP IN OPD-FLD TO
      *DAPR0027-FIN(RRM) 31-MAY-2000
                            OPD-FEC-FCTB IN OPD-FLD
      *        IF NOT ( SCR-CNAL = '100' OR
      *                 SCR-CNAL = '110' )
               GO TO FIN-VAL-OPD-FEC-FCTB.

           IF OPD-FEC-FCTB IN OPD-FLD NOT > ZEROES
      *DAPR0027-INI(RRM) 31-MAY-2000
      *         MOVE OPD-FEC-FREA IN OPD-FLD TO
                MOVE OPD-FEC-FCMP IN OPD-FLD TO
      *DAPR0027-FIN(RRM) 31-MAY-2000
                     OPD-FEC-FCTB IN OPD-FLD.
      *>>>> INI_OPD_FEC_FCTB
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF HOY-HHHY NOT < 16 AND
                  ( SCR-CNAL = '100'
                         OR
                    SCR-CNAL = '110' )
                 PERFORM SIG-HBL-FCTB
           ELSE
           IF SCR-MODO = 'T'
               PERFORM SIG-HBL-FCTB
           ELSE
           IF ( SCR-CNAL = '100'
                     OR
                SCR-CNAL = '110' )
                IF NOT FEC-STAT-HBL
                     PERFORM SIG-HBL-FCTB.
           IF NOT FEC-STAT-OKS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE FEC-MENS     TO FRM-MENS
               GO TO FIN-VAL-OPD-FEC-FCTB.
      *<<<< OPD_FEC_FCTB
      *DAPR0027-INI(RRM) 31-MAY-2000
      *CMP-FEC
      *    MOVE OPD-FEC-FCTB IN OPD-FLD TO FEC-FEC1.
      *    MOVE OPD-FEC-FREA IN OPD-FLD TO FEC-FEC2.
      *    MOVE FEC-FORM-FEC TO FEC-FORM.
      *    MOVE FEC-CMP-FEC  TO FEC-CMND.
      *    PERFORM PRO-FEC.
      *    IF FEC-STAT-GRT
      **       FREA debe ser <= FCMP
      *        MOVE 'DAP' TO MSG-COD-SIST
      *        MOVE 'FCTB>FREA' TO MSG-COD-MENS
      *        PERFORM GET-MSG
      *        MOVE MSG-GLS-DESC TO FRM-MENS
      *        MOVE FRM-SUAR-MAL TO FRM-SUAR
      *        GO TO FIN-VAL-OPD-FEC-FCTB.
           IF NOT ( SCR-CNAL = '100' OR '110' )
           IF OPD-FEC-FCTB IN OPD-FLD NOT = OPD-FEC-FCMP IN OPD-FLD
      *       FCTB debe ser = FCMP
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'FCTB<>FCMP' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-OPD-FEC-FCTB.
      *DAPR0027-FIN(RRM) 31-MAY-2000
      *>>>> OPD_FEC_FCTB
      * ISP   14-01-2015 DEBE SALTARSE ESTE CODIGO, PUES 
      *       VERSION DE PRODUCCION AL 14-01-2015 NO
      *       LO INCLUYE
      *       GO TO EQUIVALE A CODIGO INEXISTENTE
           GO TO FIN-VAL-OPD-FEC-FCTB.
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-OKS
               MOVE FEC-FECH TO OPD-FEC-FCTB IN OPD-FLD
           ELSE
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE FEC-MENS     TO FRM-MENS
               GO TO FIN-VAL-OPD-FEC-FCTB.
       FIN-VAL-OPD-FEC-FCTB.
           EXIT.
      * FEC-FIN --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION
       
       VAL-OPD-COD-VCAM SECTION.
       INI-VAL-OPD-COD-VCAM.
           IF OPD-COD-VCAM IN OPD-FLD NOT > SPACES
                PERFORM ERR-GLS
                GO TO FIN-VAL-OPD-COD-VCAM.
      *VAL-COD Valida codigo de tabla
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'VLR ' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-VCAM IN OPD-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX' OR
              OPD-COD-VCAM IN OPD-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-VCAM IN OPD-FLD
           ELSE
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-VCAM IN OPD-FLD.
       FIN-VAL-OPD-COD-VCAM.
           EXIT.
       
       VAL-FRM-GLS-VCAM SECTION.
       INI-VAL-FRM-GLS-VCAM.
       FIN-VAL-FRM-GLS-VCAM.
           EXIT.
       
       VAL-OPD-COD-TOPD SECTION.
       INI-VAL-OPD-COD-TOPD.
           IF OPD-COD-TOPD IN OPD-FLD NOT > SPACES
                PERFORM ERR-GLS
                GO TO FIN-VAL-OPD-COD-TOPD.
      *<<<< OPD_COD_TOPD
      * DESPUES DE VALIDAR LA MONEDA RESCATA EL CIC
           MOVE TAB-CIC-CTAB IN TAB TO SCR-CIC-VCAM.
      *    SI DAP EN MONEDA CHILENA REAJUSTABLE,
      *    ENTONCES CONVERTIR A PESOS
      *    BUSCA VALOR DE CAMBIO
      *     IF SCR-SGV-VCAM NOT = 1
           MOVE 1 TO SCR-SGV-VCAM.
           IF SCR-CIC-TVAL = PDB-CIC-MNAC AND 
               SCR-CIC-VCAM NOT = PDB-CIC-0999
               PERFORM LEE-VCAM
               IF MSG-COD-MENS > SPACES
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   MOVE 'DAP' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
      *>>>> 
      *<<<< OPD_COD_TOPD
      *>>>> OPD_COD_TOPD
      *VAL-COD Valida codigo de tabla
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'TIO ' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-TOPD IN OPD-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX' OR
              OPD-COD-TOPD IN OPD-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-TOPD IN OPD-FLD
           ELSE
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-TOPD IN OPD-FLD.
       FIN-VAL-OPD-COD-TOPD.
           EXIT.
       
       VAL-FRM-GLS-TOPD SECTION.
       INI-VAL-FRM-GLS-TOPD.
       FIN-VAL-FRM-GLS-TOPD.
           EXIT.
       
       VAL-OPD-COD-AOPD SECTION.
       INI-VAL-OPD-COD-AOPD.
           IF OPD-COD-AOPD IN OPD-FLD NOT > SPACES
                PERFORM ERR-GLS
                GO TO FIN-VAL-OPD-COD-AOPD.
       FIN-VAL-OPD-COD-AOPD.
           EXIT.
       
       VAL-FRM-GLS-AOPD SECTION.
       INI-VAL-FRM-GLS-AOPD.
       FIN-VAL-FRM-GLS-AOPD.
           EXIT.
       
       VAL-OPD-COD-OFIC SECTION.
       INI-VAL-OPD-COD-OFIC.
           IF OPD-COD-OFIC IN OPD-FLD NOT > SPACES
              MOVE SPACES TO OPD-COD-OFIC IN OPD-FLD.
      *<<<< OPD_COD_OFIC 
      *RVM-CST-INI 26-AUG-1996
           IF VERSION-BCI  = 'S'   AND
              SCR-CMND NOT = 'ODL' AND
              SCR-CMND NOT = 'ODB' AND
              OPD-COD-EJEC IN OPD-FLD NOT > SPACES
               MOVE OPD-COD-OFIC IN OPD-FLD TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS = SPACES
                   IF OFI-COD-JFOF IN OFI > SPACES
                       MOVE OFI-COD-JFOF IN OFI TO
                       OPD-COD-EJEC IN OPD-FLD
                   ELSE
                       MOVE -1 TO OPD-COD-EJEC-LEN IN OPD-FLD
                       MOVE 'DAP'        TO MSG-COD-SIST
                       MOVE 'CODJFOFNOASU' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO FRM-MENS
                       MOVE FRM-SUAR-MAL TO FRM-SUAR
                       GO TO FIN-VAL-OPD-COD-OFIC
               ELSE
                   MOVE -1 TO OPD-COD-EJEC-LEN IN OPD-FLD
                   MOVE 'DAP'        TO MSG-COD-SIST
                   MOVE 'CODJFOFNOASU' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-OPD-COD-OFIC.
      *RVM-CST-FIN 26-AUG-1996

           IF OPD-COD-OFIC IN OPD-FLD NOT > SPACES
                PERFORM ERR-GLS
                GO TO FIN-VAL-OPD-COD-OFIC.

      *     IF OPD-COD-OFIC IN OPD-FLD NOT > SPACES
      *         este move debe eliminarse puesto que el 
      *         genfrm lo inserta automaticamente
      *          MOVE SPACES TO OPD-COD-OFIC IN OPD-FLD
      *          GO TO FIN-VAL-OPD-COD-OFIC.
      *>>>> OPD_COD_OFIC 
      *VAL-OFI Valida codigo de Oficina en TABLAS
           MOVE OPD-COD-OFIC IN OPD-FLD TO OFI-COD-OFIC IN OFI.
           PERFORM VAL-OFI.
           IF MSG-COD-MENS NOT = SPACES
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
           IF MSG-COD-MENS = 'COD    NEX'
               MOVE SPACES TO FRM-GLS-OFIC IN OPD-FLD
           ELSE
               MOVE OFI-GLS-ABRV IN OFI TO FRM-GLS-OFIC IN OPD-FLD.
       FIN-VAL-OPD-COD-OFIC.
           EXIT.
       
       VAL-FRM-GLS-OFIC SECTION.
       INI-VAL-FRM-GLS-OFIC.
       FIN-VAL-FRM-GLS-OFIC.
           EXIT.
       
       VAL-FRM-VAL-IPES SECTION.
       INI-VAL-FRM-VAL-IPES.
      *<<<< FRM_VAL_IPES
           MOVE FRM-VAL-IPES IN OPD-FLD TO PES-SGV-DECI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE TO FRM-VAL-IPES IN OPD-FLD.
      *>>>> FRM_VAL_IPES
       FIN-VAL-FRM-VAL-IPES.
           EXIT.
      * FEC-INI --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION
       VAL-OPD-FEC-FPVC SECTION.
       INI-VAL-OPD-FEC-FPVC.
           IF OPD-FEC-FPVC IN OPD-FLD  NOT > ZEROES
              MOVE ZEROES TO OPD-FEC-FPVC IN OPD-FLD.
      *VAL-FEC Validar Fecha
           MOVE OPD-FEC-FPVC IN OPD-FLD TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S  TO FEC-FBLK.
           MOVE FEC-CHOY-LE TO FEC-CHOY.
           MOVE FEC-VHBL-S TO FEC-VHBL.
      *<<<< INI_OPD_FEC_FPVC
           MOVE FEC-CHOY-N TO FEC-CHOY.
           MOVE FEC-VHBL-N TO FEC-VHBL.
      *>>>> INI_OPD_FEC_FPVC
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-OKS
               MOVE FEC-FECH TO OPD-FEC-FPVC IN OPD-FLD
           ELSE
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE FEC-MENS     TO FRM-MENS
               GO TO FIN-VAL-OPD-FEC-FPVC.
       FIN-VAL-OPD-FEC-FPVC.
           EXIT.
      * FEC-FIN --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION
      * FEC-INI --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION
       VAL-OPD-FEC-FTER SECTION.
       INI-VAL-OPD-FEC-FTER.
           IF OPD-FEC-FTER IN OPD-FLD  NOT > ZEROES
              MOVE ZEROES TO OPD-FEC-FTER IN OPD-FLD.
      *VAL-FEC Validar Fecha
           MOVE OPD-FEC-FTER IN OPD-FLD TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-S  TO FEC-FBLK.
           MOVE FEC-CHOY-LE TO FEC-CHOY.
           MOVE FEC-VHBL-S TO FEC-VHBL.
      *<<<< INI_OPD_FEC_FTER
           MOVE FEC-CHOY-N TO FEC-CHOY.
           MOVE FEC-VHBL-N TO FEC-VHBL.
      *>>>> INI_OPD_FEC_FTER
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-OKS
               MOVE FEC-FECH TO OPD-FEC-FTER IN OPD-FLD
           ELSE
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE FEC-MENS     TO FRM-MENS
               GO TO FIN-VAL-OPD-FEC-FTER.
       FIN-VAL-OPD-FEC-FTER.
           EXIT.
      * FEC-FIN --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION
       
       VAL-OPD-NUM-PVEN SECTION.
       INI-VAL-OPD-NUM-PVEN.
      *<<<< OPD_NUM_PVEN 
           IF SCR-CMND = 'MDA'
               GO TO FIN-VAL-OPD-NUM-PVEN.

           IF SCR-CMND = 'RDL' OR 'RLR'
               GO TO FIN-VAL-OPD-NUM-PVEN.

           IF ( OPD-NUM-PVEN IN OPD-FLD > ZEROES AND
              OPD-IND-PVEN IN OPD-FLD NOT > SPACES ) OR
              ( OPD-NUM-PVEN IN OPD-FLD NOT > ZEROES AND
              OPD-IND-PVEN IN OPD-FLD > SPACES )
      *        PVEN inconsistente (ambos llenos/vacios)
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'PVEN    MALO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-OPD-NUM-PVEN.

           IF OPD-COD-MORE IN OPD-FLD = 'N' AND
              OPD-FEC-FTER IN OPD-FLD NOT > ZEROES AND
              OPD-NUM-PVEN IN OPD-FLD NOT > ZEROES AND
              OPD-FEC-FPVC IN OPD-FLD NOT > ZEROES
                 MOVE 'DAP' TO MSG-COD-SIST
                 MOVE 'FTERMDRN' TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO WSS-GLS-PZO1
                 MOVE POD-NUM-PMIN IN POD TO WSS-GLS-PZO2
                 MOVE POD-IND-PMIN IN POD TO WSS-GLS-PZO3
                 MOVE POD-NUM-PMAX IN POD TO WSS-GLS-PZO4
                 MOVE POD-IND-PMAX IN POD TO WSS-GLS-PZO5
                 MOVE WSS-GLS-PZO         TO FRM-MENS
                 MOVE FRM-SUAR-MAL TO FRM-SUAR
                 GO TO FIN-VAL-OPD-NUM-PVEN.

           IF OPD-COD-MORE IN OPD-FLD = 'N'
               IF OPD-FEC-FPVC IN OPD-FLD NOT > ZEROES
                   MOVE OPD-FEC-FTER IN OPD-FLD TO
                        OPD-FEC-FPVC IN OPD-FLD.

           IF OPD-NUM-PVEN IN OPD-FLD NOT > ZEROES AND
              OPD-FEC-FPVC IN OPD-FLD NOT > ZEROES
                 MOVE 'DAP' TO MSG-COD-SIST
                 MOVE 'FPVC NOPER' TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO WSS-GLS-PZO1
                 MOVE POD-NUM-PMIN IN POD TO WSS-GLS-PZO2
                 MOVE POD-IND-PMIN IN POD TO WSS-GLS-PZO3
                 MOVE POD-NUM-PMAX IN POD TO WSS-GLS-PZO4
                 MOVE POD-IND-PMAX IN POD TO WSS-GLS-PZO5
                 MOVE WSS-GLS-PZO         TO FRM-MENS
                 MOVE FRM-SUAR-MAL TO FRM-SUAR
                 GO TO FIN-VAL-OPD-NUM-PVEN.

           IF OPD-NUM-PVEN IN OPD-FLD > ZEROES
               MOVE SPACES TO WSS-IND-PVEN
               MOVE OPD-IND-PVEN IN OPD-FLD TO MSC-COD-CMSC IN MSC
               PERFORM OBT-CIC-PER
      * ISP : RESPALDA EL CIC DEL PERIODO PRIMER VCTO PARA USO POSTERIOR
               MOVE WSS-CIC-PER TO WSS-IND-PVEN

               MOVE OPD-FEC-FREA IN OPD-FLD TO FEC-FECH
               MOVE OPD-NUM-PVEN IN OPD-FLD TO WSS-NUM-PER
               PERFORM SEL-PER
               MOVE FEC-FECH TO WSS-FEC-FPVC
               PERFORM FPVC-RET
               IF OPD-FEC-FPVC IN OPD-FLD = ZEROES
                   MOVE WSS-FEC-FPVC TO OPD-FEC-FPVC IN OPD-FLD
               ELSE
                   IF OPD-FEC-FPVC IN OPD-FLD NOT = WSS-FEC-FPVC
      *                periodo primer vcto  (pven) inconsistente
      *                con fecha primer vcto (fpvc)
                       MOVE 'DAP' TO MSG-COD-SIST
                       MOVE 'PVENFPVC INC' TO MSG-COD-MENS
                       PERFORM GET-MSG
                       MOVE MSG-GLS-DESC TO CPT-STR1
                       MOVE MSG-GLS-DATA TO CPT-STR2
                       PERFORM CPT-BLKS
                       MOVE CPT-STRN     TO FRM-MENS
                       MOVE FRM-SUAR-MAL TO FRM-SUAR
                       GO TO FIN-VAL-OPD-NUM-PVEN
                   ELSE
                       NEXT SENTENCE
           ELSE
               PERFORM OBT-NUM-PVEN.

           IF POD-COD-AFER IN POD = SCR-SON-S
               MOVE OPD-FEC-FPVC IN OPD-FLD TO FEC-FECH
               MOVE FEC-FORM-FEC TO FEC-FORM
               MOVE FEC-FBLK-N   TO FEC-FBLK
               MOVE FEC-CHOY-N   TO FEC-CHOY
               MOVE FEC-VHBL-S TO FEC-VHBL
               MOVE FEC-VAL-FEC TO FEC-CMND
               PERFORM PRO-FEC
               IF NOT FEC-STAT-OKS
      *CIMA-INI 12-JUN-2015 MEJORAS SERVICIOS DAP
               IF  SCR-CNAL = WSS-CT-100 OR
                   SCR-CNAL = WSS-CT-110
                   PERFORM SIG-HBL-FPVC
               ELSE
      *CIMA-FIN 12-JUN-2015 MEJORAS SERVICIOS DAP
                   MOVE 'DAP' TO MSG-COD-SIST
                   MOVE 'FPVC   AFER' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-OPD-NUM-PVEN.

           IF OPD-COD-MORE IN OPD-FLD = 'N'
               IF OPD-FEC-FTER IN OPD-FLD NOT > ZEROES
                   MOVE OPD-FEC-FPVC IN OPD-FLD TO
                        OPD-FEC-FTER IN OPD-FLD
               ELSE
               IF OPD-FEC-FTER IN OPD-FLD NOT =
                  OPD-FEC-FPVC IN OPD-FLD
                     MOVE 'DAP' TO MSG-COD-SIST
                     MOVE 'FPVCFTER<>' TO MSG-COD-MENS
                     PERFORM GET-MSG
                     MOVE MSG-GLS-DESC TO FRM-MENS
                     MOVE FRM-SUAR-MAL TO FRM-SUAR
                     GO TO FIN-VAL-OPD-NUM-PVEN.

      * DAPR0005-INI(ISP) 11-10-1999
           PERFORM BUS-RVI.
           IF RVI-COD-STAT = RVI-STAT-OKS
               MOVE OPD-NUM-DPVC IN OPD-FLD TO RVI-NUM-DCMP
               MOVE OPD-NUM-MPVC IN OPD-FLD TO RVI-NUM-MCMP
               MOVE OPD-NUM-SPVC IN OPD-FLD TO RVI-NUM-SCMP
               MOVE OPD-NUM-APVC IN OPD-FLD TO RVI-NUM-ACMP
               IF RVI-FEC-FCMP NOT < RVI-FEC-FINR AND
                  RVI-FEC-FCMP NOT > RVI-FEC-FFIR
                    MOVE ZEROES TO OPD-NUM-PVEN IN OPD-FLD
                    MOVE SPACES TO OPD-IND-PVEN IN OPD-FLD
                    MOVE ZEROES TO OPD-FEC-FTER IN OPD-FLD
                    MOVE RVI-FEC-FOKT TO OPD-FEC-FPVC IN OPD-FLD
                    MOVE 'DAP' TO MSG-COD-SIST
                    MOVE 'RVIFPVCVMOD' TO MSG-COD-MENS
                    PERFORM GET-MSG
                    MOVE MSG-GLS-DESC TO FRM-GLS-UBFD IN OPD-FLD
                    GO TO INI-VAL-OPD-NUM-PVEN.

      * DAPR0005-FIN(ISP) 11-10-1999

      * DAPR0005-INI(ISP) 11-10-1999 SE REEMPLAZA LA PREGUNTA
           IF OPD-COD-MORE IN OPD-FLD = 'N'
      *     IF SCR-CIC-MORE = 'N'
      * DAPR0005-FIN(ISP) 11-10-1999
               PERFORM VAL-DURV-PMIN
               IF MSG-COD-MENS > SPACES
                   GO TO FIN-VAL-OPD-NUM-PVEN.

      * DAPR0005-INI(ISP) 11-10-1999 VALIDA ANTES RANGO PLAZO POD
           IF OPD-COD-MORE IN OPD-FLD = 'N'
               MOVE OPD-NUM-PVEN IN OPD-FLD TO OPD-NUM-DURV IN OPD-FLD
               MOVE OPD-IND-PVEN IN OPD-FLD TO OPD-IND-DURV IN OPD-FLD.

           PERFORM VAL-DURV-POD.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC        TO WSS-GLS-1RNG IN WSS-VARI
               MOVE WSS-NUM-PMIN        TO WSS-GLS-2RNG IN WSS-VARI
               MOVE WSS-NUM-PMAX        TO WSS-GLS-4RNG IN WSS-VARI
               MOVE WSS-GLS-MRNG IN WSS-VARI TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-OPD-NUM-PVEN.
      * DAPR0005-FIN(ISP) 11-10-1999

      *>>>> OPD_NUM_PVEN 
       FIN-VAL-OPD-NUM-PVEN.
           EXIT.
       
       VAL-OPD-VAL-CAPT SECTION.
       INI-VAL-OPD-VAL-CAPT.
      *<<<< OPD_VAL_CAPT

           IF SCR-CMND = 'MDA'
               GO TO FIN-VAL-OPD-VAL-CAPT.

           MOVE OPD-VAL-CAPT IN OPD-FLD TO PES-SGV-DECI.
           MOVE SCR-CIC-VCAM TO PES-CIC-VCAM.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE TO OPD-VAL-CAPT IN OPD-FLD.

           MOVE ZEROES TO FRM-VAL-FORI IN OPD-FLD.
      *CIMA-INI 17-ABR-2014 CORRECCION INCIDENDTES DAP HITO 3
           IF SCR-CMND = WSS-CTE-RDL AND
              OPD-COD-RENO IN OPD NOT = SCR-SON-S
              IF (WSS-SW-RRDL = WSS-CTE-TODO OR
                  OPD-SGV-MPRE IN OPD = WSS-SGV-RDL-TODO)
                  MOVE WSS-CTE-DAP TO MSG-COD-SIST
      * RDL Total originado en RDF NO permitido para DPF
      * --- -                  --- --                ---
                  MOVE WSS-GLS-RDLO TO MSG-COD-MENS
                  PERFORM GET-MSG
                  MOVE MSG-GLS-DESC TO FRM-MENS
                  MOVE FRM-SUAR-MAL TO FRM-SUAR
                  GO TO FIN-VAL-OPD-VAL-CAPT
              ELSE
                  IF OPD-FEC-FREA IN OPD NOT = HOY-FHOY
                     MOVE WSS-CTE-DAP  TO MSG-COD-SIST
      * RDL Negociacion tasa originado en RDF Solo en Fecha
      * --- -                             ---         -
                     MOVE WSS-GLS-RDLV TO MSG-COD-MENS
                     PERFORM GET-MSG
                     MOVE MSG-GLS-DESC TO FRM-MENS
                     MOVE FRM-SUAR-MAL TO FRM-SUAR
                     GO TO FIN-VAL-OPD-VAL-CAPT.
      *CIMA-FIN 17-ABR-2014 CORRECCION INCIDENDTES DAP HITO 3

           IF SCR-CMND NOT = 'RDL' AND
              SCR-CMND NOT = 'RLR'
               MOVE ZEROES TO WSS-SGV-RDL-INTE
               MOVE ZEROES TO WSS-SGV-RDL-TODO
               MOVE ZEROES TO SCR-SGV-MPRE
           ELSE
               MULTIPLY WSS-SGV-RDL-INTE BY
                  SCR-SGV-VCAM GIVING
                  WSS-SGV-RDL-INTE-PESO
               PERFORM AJUSTA-INTE

               MULTIPLY WSS-SGV-RDL-TODO BY
                  SCR-SGV-VCAM GIVING
                  WSS-SGV-RDL-TODO-PESO
               PERFORM AJUSTA-TODO

      *ADA-INI 02-JUL-2002
      *         IF WSS-SW-RRDL = 'INTE' OR
      *            OPD-SGV-MPRE IN OPD-FLD = WSS-SGV-RDL-INTE-PESO
                IF WSS-SW-RRDL = 'INTE' OR
                 ( OPD-SGV-MPRE IN OPD-FLD = WSS-SGV-RDL-INTE-PESO
               AND OPD-SGV-MPRE IN OPD-FLD NOT = 0 )
      *ADA-FIN 02-JUL-2002
                    MOVE WSS-SGV-RDL-INTE TO SCR-SGV-MPRE
                    MOVE WSS-SGV-RDL-INTE-PESO TO
                         OPD-SGV-MPRE IN OPD-FLD
                ELSE
                IF WSS-SW-RRDL = 'TODO' OR
                   OPD-SGV-MPRE IN OPD-FLD = WSS-SGV-RDL-TODO-PESO
                    MOVE WSS-SGV-RDL-TODO TO SCR-SGV-MPRE
                    MOVE WSS-SGV-RDL-TODO-PESO TO
                         OPD-SGV-MPRE IN OPD-FLD
                ELSE
                    IF OPD-SGV-MPRE IN OPD-FLD > WSS-SGV-RDL-INTE-PESO
                                      AND
                       OPD-SGV-MPRE IN OPD-FLD NOT =
                       WSS-SGV-RDL-TODO-PESO
      *ADA-INI 26-SEP-2001
      *El interes puede ser negativo y MPRE puede ser 0, por lo tanto
      *es causa de error solo cuando MPRE <> 0
                       AND OPD-SGV-MPRE IN OPD-FLD NOT = 0
      *ADA-INI 26-SEP-2001
                            MOVE WSS-SGV-RDL-TODO TO
                                 OPD-VAL-CAPT IN OPD-FLD
                             PERFORM BUS-VPES
                             MOVE FRM-SUAR-MAL TO FRM-SUAR
                             MOVE 'DAP' TO MSG-COD-SIST
                             MOVE 'RETINTE>100%' TO MSG-COD-MENS
                             PERFORM GET-MSG
                             MOVE MSG-GLS-DESC TO FRM-MENS
                             GO TO FIN-VAL-OPD-VAL-CAPT
                    ELSE
                       DIVIDE OPD-SGV-MPRE IN OPD-FLD BY
                           SCR-SGV-VCAM GIVING
                           SCR-SGV-MPRE ROUNDED
      *LRH INI 30-AGO-1994
                       MOVE SCR-SGV-MPRE TO WSS-INI-PESO
                       PERFORM VAL-CAP-UFP-PESO
                       IF WSS-FIN-PESO NOT = OPD-SGV-MPRE IN OPD-FLD
      *LRH INI 20-SEP-1994
      *                    MOVE WSS-FIN-PESO TO OPD-SGV-MPRE IN OPD-FLD
                           IF SCR-CIC-TVAL = PDB-CIC-MNAC AND
                              SCR-CIC-VCAM NOT = PDB-CIC-0999 AND
                              SCR-CMND = 'RDL'
      *LRH FIN 20-SEP-1994
                               MOVE 'DAP' TO MSG-COD-SIST
                               MOVE 'DIFCONV UF$1' TO MSG-COD-MENS
                               PERFORM GET-MSG
                               MOVE MSG-GLS-DESC TO FRM-MEN2.
      *LRH FIN 30-AGO-1994

           IF SCR-CMND = 'RDL'
      *        IF FRM-VAL-IPES IN OPD-FLD > ZEROES
      *            SUBTRACT OPD-SGV-MPRE IN OPD-FLD FROM
      *               WSS-SGV-RDL-TODO-PESO GIVING
      *               FRM-VAL-IPES IN OPD-FLD
      *            MOVE ZEROES TO OPD-VAL-CAPT IN OPD-FLD
      *        ELSE
                   SUBTRACT SCR-SGV-MPRE FROM
                       OPD-VAL-CAPT IN OPD GIVING
                       OPD-VAL-CAPT IN OPD-FLD
                       MOVE ZEROES TO FRM-VAL-IPES IN OPD-FLD.


           MOVE SPACES TO MSG-COD-MENS.

       OPD-VAL-CAPT-MEXT.
      *    moneda extranjera
           IF SCR-CIC-TVAL = PDB-CIC-MNAC
               GO TO OPD-VAL-CAPT-MNAC.

           IF FRM-VAL-IPES IN OPD-FLD NOT = ZEROES
      *        moneda extranjera => valor en pesos debe ser cero
               MOVE 'IPES=ZERO' TO MSG-COD-MENS
               GO TO ERR-VAL-CAPT.

           IF OPD-VAL-CAPT IN OPD-FLD = ZEROES AND
              SCR-CMND NOT = 'RDL' AND
              SCR-CMND NOT = 'RLR'
      *        moneda extranjera =>
      *        valor inic moneda origen debe ser <> cero
               MOVE 'CAPT<>ZERO' TO MSG-COD-MENS
               GO TO ERR-VAL-CAPT.

           GO TO OPD-VAL-CAPT-RNGO.

       OPD-VAL-CAPT-MNAC.
      *    moneda chilena
           IF SCR-CMND NOT = 'RDL' AND
              SCR-CMND NOT = 'RLR' AND
              FRM-VAL-IPES IN OPD-FLD NOT > ZEROES AND
              OPD-VAL-CAPT IN OPD-FLD NOT > ZEROES
      *        valor inicial pesos y valor inicial moneda original
      *        no pueden ser cero ambos
               MOVE 'IPESCAPT  NZ' TO MSG-COD-MENS
               GO TO ERR-VAL-CAPT.

       VRF-MON-NAC.

           MULTIPLY OPD-VAL-CAPT IN OPD-FLD BY
               SCR-SGV-VCAM GIVING
               WSS-VAL-IPES IN WSS-VARI ROUNDED.
      * ISP: REDONDEA PESOS Y QUITA DECIMALES
           MOVE WSS-VAL-IPES IN WSS-VARI TO PES-SGV-DECI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE TO WSS-VAL-IPES IN WSS-VARI.

           IF OPD-VAL-CAPT IN OPD-FLD NOT > ZEROES
               DIVIDE FRM-VAL-IPES IN OPD-FLD BY
                  SCR-SGV-VCAM GIVING
                  OPD-VAL-CAPT IN OPD-FLD ROUNDED.
      *LRH INI 30-AGO-1994
      *           MOVE OPD-VAL-CAPT IN OPD-FLD TO WSS-INI-PESO
      *           PERFORM VAL-CAP-UFP-PESO
      *           IF WSS-FIN-PESO NOT = FRM-VAL-IPES IN OPD-FLD
      *               MOVE WSS-FIN-PESO TO FRM-VAL-IPES IN OPD-FLD
      *               MOVE 'DAP' TO MSG-COD-SIST
      *               MOVE 'DIFCONV UF$1' TO MSG-COD-MENS
      *               PERFORM GET-MSG
      *               MOVE MSG-GLS-DESC TO FRM-MEN2.
      *LRH FIN 30-AGO-1994

           IF FRM-VAL-IPES IN OPD-FLD NOT > ZEROES
              MOVE WSS-VAL-IPES IN WSS-VARI TO FRM-VAL-IPES IN OPD-FLD.

           IF WSS-VAL-IPES IN WSS-VARI NOT > ZEROES
               MOVE FRM-VAL-IPES IN OPD-FLD TO WSS-VAL-IPES IN WSS-VARI.

           IF WSS-VAL-IPES IN WSS-VARI NOT = FRM-VAL-IPES IN OPD-FLD
      *        valor captacion inconsistente
               MOVE 'VALCAPT  INC' TO MSG-COD-MENS
               GO TO ERR-VAL-CAPT.

       OPD-VAL-CAPT-RNGO.

           IF SCR-CMND NOT = 'RDL' AND
              SCR-CMND NOT = 'RLR' AND
              POD-VAL-CMIN IN POD > ZEROES AND
              OPD-VAL-CAPT IN OPD-FLD < POD-VAL-CMIN IN POD
                   MOVE 'CAPT    FRNG' TO MSG-COD-MENS
                   GO TO ERR-VAL-CAPT.

           IF SCR-CMND NOT = 'RDL' AND
              SCR-CMND NOT = 'RLR' AND
              OPD-VAL-CAPT IN OPD-FLD > ZEROES AND
              OPD-VAL-CAPT IN OPD-FLD > POD-VAL-CMAX IN POD
      *       OPD-VAL-CAPT fuera de rango definido en POD
                   MOVE 'CAPT    FRNG' TO MSG-COD-MENS
                   GO TO ERR-VAL-CAPT.

           GO TO FIN-VAL-OPD-VAL-CAPT.

       ERR-VAL-CAPT.
           IF SCR-CIC-TVAL = PDB-CIC-MNAC
               MOVE -1 TO FRM-VAL-IPES-LEN IN OPD-FLD.
           MOVE FRM-SUAR-MAL TO FRM-SUAR.
           MOVE 'DAP' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           IF MSG-COD-MENS = 'CAPT    FRNG'
               MOVE MSG-GLS-DESC        TO WSS-GLS-1RNG IN WSS-VARI
               MOVE POD-VAL-CMIN IN POD TO WSS-GLS-2RNG IN WSS-VARI
               MOVE POD-VAL-CMAX IN POD TO WSS-GLS-4RNG IN WSS-VARI
               MOVE WSS-GLS-MRNG IN WSS-VARI TO FRM-MENS
           ELSE
               MOVE MSG-GLS-DESC TO FRM-MENS.
      *>>>> OPD_VAL_CAPT
       FIN-VAL-OPD-VAL-CAPT.
           EXIT.
       
       VAL-OPD-COD-EATE SECTION.
       INI-VAL-OPD-COD-EATE.
           IF OPD-COD-EATE IN OPD-FLD NOT > SPACES
              MOVE SPACES TO OPD-COD-EATE IN OPD-FLD.
      *<<<< OPD_COD_EATE
           IF SCR-CMND = 'MDA' OR 'RLR' OR
              SCR-CNAL = '100' OR SCR-CNAL = '110'
               GO TO FIN-VAL-OPD-COD-EATE.
           MOVE SPACES TO MSG-COD-MENS.
         
      * EN 'RDL' PIDE PASSWORD PARA RENOVACIONES CON TASA
      * ASIGNADA EN OPD POR BGEN EN DIAS DISTINTOS AL DEL
      * VENCIMIENTO
           IF SCR-CMND = 'RDL' AND
      * NO PIDE PASSWORD PARA RDL TOTAL
              WSS-SW-RRDL NOT = 'TODO' AND
              OPD-SGV-TINT IN OPD     NOT = ZEROES AND
              OPD-SGV-TINT IN OPD     NOT = OPD-SGV-TINT IN OPD-FLD AND
              OPD-COD-EATE IN OPD-FLD NOT > SPACES
                MOVE 'RDLEATEOBL' TO MSG-COD-MENS
                GO TO ERR-VAL-OPD-COD-EATE.

           IF OPD-COD-EATE IN OPD-FLD     > SPACES AND
              FRM-COD-EATE IN OPD-FLD NOT > SPACES
               MOVE 'PASS    OBL' TO MSG-COD-MENS
               GO TO ERR-VAL-OPD-COD-EATE
           ELSE              
           IF OPD-COD-EATE IN OPD-FLD NOT > SPACES AND
              FRM-COD-EATE IN OPD-FLD > SPACES
               MOVE 'EATE    OBL' TO MSG-COD-MENS
               GO TO ERR-VAL-OPD-COD-EATE.

           IF OPD-COD-EATE IN OPD-FLD NOT > SPACES
               GO TO FIN-VAL-OPD-COD-EATE.

           MOVE OPD-COD-EATE IN OPD-FLD TO ATE-OPD-COD-EATE.
           MOVE FRM-COD-EATE IN OPD-FLD TO ATE-FRM-COD-EATE.
           MOVE SPACES                  TO ATE-COD-STAT.

      *ISP: VERSION CST
           IF VERSION-CST = 'S'
               MOVE FRM-COD-EATE IN OPD-FLD TO ATE-COD-STAT
               GO TO CST-PSWD.
      *ISP: PARA EL BANCO VERSION-CST DEBE SER 'N'


           MOVE 'N' TO ATE-IND-ATEE.
           MOVE 'CICSRACF' TO SYS-PROG.
           MOVE ATE-VARI   TO SYS-CMMA.
           MOVE ATE-TCMA   TO SYS-TCMA.
           MOVE SYS-LINK   TO SYS-CMND.
           PERFORM GNS-PRO-SYS.
           MOVE SYS-CMMA TO ATE-VARI.

       CST-PSWD.

           IF NOT ( ATE-COD-STAT = '0C' OR '00' OR
                                   '04' OR '08' OR '1C' )
               MOVE 'XX' TO ATE-COD-STAT.

           IF ATE-COD-STAT = '00'
               MOVE 'S' TO ATE-IND-ATEE
           ELSE
               MOVE 'PSWD   '    TO ATE-COD-TMSG
               MOVE ATE-COD-STAT TO ATE-COD-CMSG
               MOVE ATE-COD-MENS TO MSG-COD-MENS IN MSG
               GO TO ERR-VAL-OPD-COD-EATE.

      *LRH ini 28-JUN-1994
      *ISP: VERSION CST
           MOVE 'N' TO STE-PERMISO.
           IF VERSION-CST = 'S'
               MOVE OPD-COD-EJEC IN OPD-FLD TO USP-PERMISO
               GO TO CST-STE.
      *ISP: PARA EL BANCO VERSION-CST DEBE SER 'N'

           MOVE WSS-IDN-SIST            TO USP-SISTEMA.
           MOVE SPACES                  TO USP-PERMISO.
           MOVE 'DAP'                   TO USP-GRUPO.
           MOVE OPD-COD-EATE IN OPD-FLD TO USP-USUARIO.
           MOVE 'DAPPUOPD/STE'          TO USP-STRING.
           PERFORM USPC107.

       CST-STE.

           IF USP-PERMISO = 'P'
               MOVE 'S' TO STE-PERMISO
           ELSE
           IF USP-PERMISO NOT = 'N'
               MOVE 'PMSOSTENEX'     TO MSG-COD-MENS IN MSG
               GO TO ERR-VAL-OPD-COD-EATE.
      *LRH fin 28-JUN-1994 
      *ISP: VERSION CST
           IF VERSION-CST = 'S'
               MOVE OPD-COD-EATE IN OPD-FLD TO USP-PERMISO
               GO TO CST-PMSO.
      *ISP: PARA EL BANCO VERSION-CST DEBE SER 'N'

           MOVE WSS-IDN-SIST            TO USP-SISTEMA.
           MOVE SPACES                  TO USP-PERMISO.
           MOVE 'DAP'                   TO USP-GRUPO.
           MOVE OPD-COD-EATE IN OPD-FLD TO USP-USUARIO.
           MOVE 'DAPPUOPD/ATE'          TO USP-STRING.
           PERFORM USPC107.

       CST-PMSO.
      * ISP 16-05-2007 REQ BCI PARA EVITAR PROBLEMA DE SISTEMA PRV
           IF SCR-CNAL = '150'
               MOVE 'P' TO USP-PERMISO.

           IF USP-PERMISO = 'N'
               MOVE 'PMSO N'     TO MSG-COD-MENS IN MSG
           ELSE
           IF USP-PERMISO NOT = 'P'
               MOVE 'PMSO X'     TO MSG-COD-MENS IN MSG.
           
       ERR-VAL-OPD-COD-EATE.

           IF MSG-COD-MENS > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>> OPD_COD_EATE
       FIN-VAL-OPD-COD-EATE.
           EXIT.
       
       VAL-FRM-COD-EATE SECTION.
       INI-VAL-FRM-COD-EATE.
           IF FRM-COD-EATE IN OPD-FLD NOT > SPACES
              MOVE SPACES TO FRM-COD-EATE IN OPD-FLD.
       FIN-VAL-FRM-COD-EATE.
           EXIT.
       
       VAL-OPD-SGV-TINT SECTION.
       INI-VAL-OPD-SGV-TINT.
           IF ( SCR-CNAL = '100' OR
                SCR-CNAL = '110' ) AND
                SCR-CMND = 'ODL'
                  MOVE ZEROES TO OPD-SGV-TINT IN OPD-FLD.
      *ADA-INI 18-AGO-2000 DAPR0051
           MOVE SPACES TO SCR-KEY-ISTA.
      *ADA-FIN 18-AGO-2000 DAPR0051
      *    acceso a ptd con VCAM de la pantalla
           IF SCR-CMND = 'MDA'
               GO TO FIN-VAL-OPD-SGV-TINT.
           PERFORM GET-FHOY.
           IF SCR-CMND = 'RLR'
               MOVE ZEROES TO OPD-SGV-TINT IN OPD-FLD
               IF HOY-FHOY = OPD-FEC-FREA IN OPD
                   GO TO FIN-VAL-OPD-SGV-TINT.

           MOVE SPACES TO MSG-COD-MENS.

      * EN 'RDL' RESPETA LA TASA ASIGNADA POR EL SISTEMA
           IF SCR-CMND = 'RDL'
              IF OPD-SGV-TINT IN OPD-FLD NOT = ZEROES
                  IF OPD-SGV-TINT IN OPD-FLD = OPD-SGV-TINT IN OPD
                       GO TO EXT-VAL-OPD-SGV-TINT.

      *ADA-INI 24-SEP-2001, LA TASA PUEDE SER NEGATIVA O CERO
      ** SI OPCION 'EXC' Y PASSWORD, ==> TASA INFORMADA
      *     IF SCR-CMND = 'ODB' AND
      *        ATE-IND-ATEE = 'S'
      *         IF OPD-SGV-TINT IN OPD-FLD NOT > ZEROES
      **        TASA OBLIGATORIA
      *         MOVE 'DAP' TO MSG-COD-SIST
      *         MOVE 'SGVTINTOBL' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         MOVE MSG-GLS-DESC TO FRM-MENS
      *         MOVE FRM-SUAR-MAL TO FRM-SUAR
      *         GO TO FIN-VAL-OPD-SGV-TINT.
      **ADA-INI 24-SEP-2001, LA TASA PUEDE SER NEGATIVA O CERO

      *ADA-INI 25-JUL-2000 DAPR0050
      *       DEPOSITOS RETROACTIVOS
      *       SE VALIDARAN SIEMPRE CONTRA LA PLANTILLA PTD
      *       AUTORIZACION DE SOBRETASA SE HARA POR MEDIO DE STA
      ** SI OPCION 'EXC' Y PASSWORD, NO VALIDA CONTRA PLANTILLA
      *     IF SCR-CMND = 'ODB' AND
      *        ATE-IND-ATEE = 'S'
      *          GO TO EXT-VAL-OPD-SGV-TINT.
      *ADA-FIN 25-JUL-2000

      * PARA RDL TOTAL DEJA TASA DE OPERACION EN PANTALLA
           IF SCR-CMND = 'RDL' AND
              (
              WSS-SW-RRDL = 'TODO' OR
              OPD-VAL-CAPT IN OPD-FLD = ZEROES
              )
                MOVE OPD-SGV-TINT IN OPD TO OPD-SGV-TINT IN OPD-FLD.

      *PCL-INI 08-AGO-2000
      *       RENOVACIONES
      *       SE VALIDARAN SIEMPRE CONTRA LA PLANTILLA PTD
      **LRH INI 28-JUN-1994
      ** SI COMANDO 'RDL' Y STE-PERMISO = 'S' ,
      ** NO VALIDA CONTRA PLANTILLA
      *     IF SCR-CMND = 'RDL' AND
      *        STE-PERMISO = 'S'
      *          GO TO EXT-VAL-OPD-SGV-TINT.
      **LRH FIN 28-JUN-1994
      *PCL-FIN 08-AGO-2000
           PERFORM BUS-PTD.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-OPD-SGV-TINT.

       OPD-SGV-TINT-01.
      *VAL-FEC diferencia de fechas para calcular valor final
           MOVE OPD-FEC-FREA IN OPD-FLD TO FEC-FEC1.
           MOVE OPD-FEC-FPVC IN OPD-FLD TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA TO FEC-CMND.
           PERFORM CAL-FEC.
           IF FEC-STAT-OKS
               MOVE FEC-NDIA TO WSS-NDIA IN WSS-VARI
           ELSE
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE FEC-MENS     TO FRM-MENS
               GO TO FIN-VAL-OPD-SGV-TINT.

           MOVE 10 TO WSS-TRM-DIA.
           MOVE 5  TO WSS-TRM-MTO.

           MOVE 'N' TO WSS-IND-TDIA.
           PERFORM BUS-TRM-DIA VARYING FRM-IFLD FROM 1 BY 1 UNTIL
                   FRM-IFLD > 10 OR WSS-IND-TDIA = 'S'.
           IF WSS-IND-TDIA = 'N'
      *        tramo dia no especificado
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'TDIA NOESPEC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-OPD-SGV-TINT.

           MOVE 'N' TO WSS-IND-TMTO.
           PERFORM BUS-TRM-MTO VARYING FRM-IFLD FROM 5 BY -1 UNTIL
                   FRM-IFLD < 1 OR WSS-IND-TMTO = 'S'.

           IF WSS-IND-TMTO = 'N'
                MOVE 1 TO WSS-TRM-MTO.

      *     IF WSS-IND-TMTO = 'N'
      *        tramo monto no especificado
      *         MOVE 'DAP' TO MSG-COD-SIST
      *         MOVE 'TMTO NOESPEC' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         MOVE MSG-GLS-DESC TO FRM-MENS
      *         MOVE FRM-SUAR-MAL TO FRM-SUAR
      *         GO TO FIN-VAL-OPD-SGV-TINT.

           MULTIPLY WSS-TRM-DIA BY 5 GIVING WSS-IDX-INT.
           SUBTRACT 5 FROM WSS-IDX-INT.
           ADD WSS-TRM-MTO TO WSS-IDX-INT.
      *     COMPUTE WSS-IDX-INT = 5 * WSS-TRM-DIA + WSS-TRM-MTO - 5.

           IF WSS-IND-TMTO = 'N'
               MOVE PTD-SGV-TMIN IN PTD(WSS-IDX-INT) TO
               PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
               MOVE ZEROES TO PTD-SGV-TADC IN PTD(WSS-TRM-MTO).

      * ISP  12-AUG-1998 12:17:18
      * MODIFICACION PARA EMISION REPORTE STA

      * PARA RDL TOTAL O TASA EN RANGO
      * DEJA USUARIO QUE AUTORIZA Y PSWD VACIO
           IF ( SCR-CMND = 'RDL' AND
                    (
                    OPD-VAL-CAPT IN OPD-FLD = ZEROES OR
                    WSS-SW-RRDL = 'TODO'
                    )
              )

                OR

               OPD-SGV-TINT IN OPD-FLD NOT >
               PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
                   IF SCR-CNAL NOT = '100' AND
                      SCR-CNAL NOT = '110'
                   MOVE SPACES TO OPD-COD-EATE IN OPD-FLD
                   MOVE SPACES TO FRM-COD-EATE IN OPD-FLD
                   MOVE 'N' TO ATE-IND-ATEE.

      *    simulacion asignacion tasa especial

           IF ATE-IND-ATEE = 'S' OR
              SCR-CNAL = '100' OR
              SCR-CNAL = '110'

               IF PTD-COD-TACO IN PTD > SPACES
                   IF PTD-COD-TACO IN PTD = SCR-TAD-M
                        ADD PTD-SGV-TADC IN PTD(WSS-TRM-MTO) TO
                            PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
                   ELSE
                        IF PTD-SGV-TADC IN PTD(WSS-TRM-MTO) >
                           PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
                             MOVE PTD-SGV-TADC IN PTD(WSS-TRM-MTO) TO
                                  PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
                        END-IF
               ELSE
               IF PTD-COD-TAFI IN PTD > SPACES
                   IF PTD-COD-TAFI IN PTD = SCR-TAD-M
                        ADD PTD-SGV-TAFI IN PTD(WSS-TRM-DIA) TO
                              PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
                   ELSE
                        IF PTD-SGV-TAFI IN PTD(WSS-TRM-DIA) >
                           PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
                             MOVE PTD-SGV-TAFI IN PTD(WSS-TRM-DIA) TO
                              PTD-SGV-TMAX IN PTD(WSS-IDX-INT).

      *ADA-INI 24-SEP-2001
      *     IF OPD-SGV-TINT IN OPD-FLD NOT > ZEROES
      *         MOVE PTD-SGV-TMIN IN PTD(WSS-IDX-INT) TO
      *              OPD-SGV-TINT IN OPD-FLD.
      *ADA-FIN 24-SEP-2001

      * PARA RDL TOTAL NO VALIDA TASA
      * RDL TOTAL ==> 'T' EN OPD-SGV-MPRE OR MONTO CAPTACION = ZEROES
           IF NOT ( SCR-CMND = 'RDL' AND
                    (
                    OPD-VAL-CAPT IN OPD-FLD = ZEROES OR
                    WSS-SW-RRDL = 'TODO'
                    )
                  )
               IF OPD-SGV-TINT IN OPD-FLD <
                  PTD-SGV-TMIN IN PTD(WSS-IDX-INT) OR
                  OPD-SGV-TINT IN OPD-FLD >
                  PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
      *ADA-INI 16-AGO-2000 DAPR0051
      *                    Solo en caso que haya digitado password y
      *                    la tasa digitada se haya excedido se debe
      *                    buscar si existe sobretasa y validar
      *                    contra esta
                   IF ATE-IND-ATEE = 'S' AND
                      OPD-SGV-TINT IN OPD-FLD >
                      PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
                       PERFORM VALIDA-CON-STA
                       IF FRM-SUAR = FRM-SUAR-MAL
                           GO TO FIN-VAL-OPD-SGV-TINT
                       ELSE
                           NEXT SENTENCE
                   ELSE
      *ADA-FIN 16-AGO-2000
      *ADA-INI 24-SEP-2001
      * SI LA TASA INGRESADA ES CERO, SE ENVIA MENSAJE ASUMIENDO
      * LA TASA DE PIZARRA.
                    IF OPD-SGV-TINT IN OPD-FLD = ZEROES
                       PERFORM ASS-TASA
                       IF SCR-CMND = 'RLR' OR 'MDA'
                           MOVE SPACES TO MSG-COD-MENS
                       ELSE
                            IF NOT ( SCR-OFRM-SRV OR
                                     SCR-CNAL = '100' OR
                                     SCR-CNAL = '110' )
                               MOVE 'TINTZEROAPIZ' TO MSG-COD-MENS
                            END-IF
                       END-IF
                    ELSE
      *                MOVE 'TINT    FRNG' TO MSG-COD-MENS
                       PERFORM SET-MSG-RNG
                    END-IF
      *ADA-FIN 24-SEP-2001
                    IF MSG-COD-MENS > SPACES
                        MOVE 'DAP' TO MSG-COD-SIST
                        PERFORM GET-MSG
                        MOVE MSG-GLS-DESC TO WSS-GLS-1RNG IN WSS-VARI
                        MOVE PTD-SGV-TMIN IN PTD(WSS-IDX-INT) TO
                           WSS-GLS-2RNG IN WSS-VARI
      * ISP  12-AUG-1998 12:17:18
      * MODIFICACION PARA EMISION REPORTE STA
                        IF VERSION-CST = 'S'
                             MOVE PTD-SGV-TMAX IN PTD(WSS-IDX-INT) TO
                                  WSS-GLS-4RNG IN WSS-VARI
                        ELSE
                             MOVE SPACES TO WSS-GLS-3RNG
                             MOVE ZEROES TO WSS-GLS-4RNG
                        END-IF

                        MOVE WSS-GLS-MRNG IN WSS-VARI TO FRM-MENS
                        MOVE FRM-SUAR-MAL TO FRM-SUAR.
       EXT-VAL-OPD-SGV-TINT.
      *>>>> OPD_SGV_TINT
       FIN-VAL-OPD-SGV-TINT.
           EXIT.
       
       VAL-FRM-GLS-TINT SECTION.
       INI-VAL-FRM-GLS-TINT.
       FIN-VAL-FRM-GLS-TINT.
           EXIT.
       
       VAL-OPD-COD-MORE SECTION.
       INI-VAL-OPD-COD-MORE.
           IF OPD-COD-MORE IN OPD-FLD NOT > SPACES
                PERFORM ERR-GLS
                GO TO FIN-VAL-OPD-COD-MORE.
      *<<<< OPD_COD_MORE
      *    CIC modalidad de retiro
      * ISP:
      * BUSCA AQUI EL CODIGO INTERNO COMPUTACIONAL OPD-COD-MORE
      *VAL-COD Valida codigo de tabla
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'MDR' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-MORE IN OPD-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX' OR
              OPD-COD-MORE IN OPD-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-MORE IN OPD-FLD
           ELSE
               MOVE TAB-CIC-CTAB IN TAB TO SCR-CIC-MORE
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-MORE IN OPD-FLD.

           IF SCR-CIC-MORE = 'FO' AND
              POD-COD-CVTI IN POD > SPACES
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'MDRFOERRTV' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-VAL-OPD-COD-MORE.

           GO TO FIN-VAL-OPD-COD-MORE.
      *<<<< OPD_COD_MORE
      *VAL-COD Valida codigo de tabla
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'MDR ' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-MORE IN OPD-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX' OR
              OPD-COD-MORE IN OPD-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-MORE IN OPD-FLD
           ELSE
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-MORE IN OPD-FLD.
       FIN-VAL-OPD-COD-MORE.
           EXIT.
       
       VAL-OPD-IND-PVEN SECTION.
       INI-VAL-OPD-IND-PVEN.
           IF OPD-IND-PVEN IN OPD-FLD NOT > SPACES
              MOVE SPACES TO OPD-IND-PVEN IN OPD-FLD.
       FIN-VAL-OPD-IND-PVEN.
           EXIT.
       
       VAL-FRM-GLS-PVEN SECTION.
       INI-VAL-FRM-GLS-PVEN.
       FIN-VAL-FRM-GLS-PVEN.
           EXIT.
       
       VAL-FRM-GLS-EJEC SECTION.
       INI-VAL-FRM-GLS-EJEC.
       FIN-VAL-FRM-GLS-EJEC.
           EXIT.
       
       VAL-FRM-VAL-FORI SECTION.
       INI-VAL-FRM-VAL-FORI.
      *<<<< FRM_VAL_FORI 
           IF SCR-CMND NOT = 'ODL'
               GO TO FIN-PRO-TED.

           IF SCR-CNAL NOT = '110' AND
              SCR-CNAL NOT = '100'
               GO TO FIN-PRO-TED.

           MOVE OPD-FEC-FREA IN OPD-FLD TO FEC-FEC1.
           MOVE OPD-FEC-FPVC IN OPD-FLD TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA TO FEC-CMND.
           PERFORM CAL-FEC.
           IF FEC-STAT-OKS
              MOVE FEC-NDIA TO WSS-TED-PLZO
           ELSE
               GO TO FIN-PRO-TED.

           MOVE 'DAP' TO FIO-SIST.
      * TASA EQUILIBRIO DAP
           MOVE 'TED' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-VCAM IN OPD-FLD TO WSS-TED-VCAM.
           MOVE WSS-TED-CTAB TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           IF NOT ( FIO-STAT-OKS AND
                    TAB-COD-TTAB IN TAB = 'TED' AND
                    TAB-IND-VIGE = 'S'  )
               GO TO FIN-PRO-TED.

           MOVE TAB-GLS-DATA IN TAB TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 03 TO NUM-NENT.
           MOVE 04 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NOT NUM-STAT-OKS
               GO TO FIN-PRO-TED.

           IF NUM-NS9V < OPD-SGV-TINT IN OPD-FLD
               MOVE NUM-NS9V TO OPD-SGV-TINT IN OPD-FLD.
               
       FIN-PRO-TED.


           IF SCR-CMND = 'MDA'
               GO TO FIN-VAL-FRM-VAL-FORI.
      *     IF POD-COD-CVTI IN POD > SPACES
      *           GO TO FIN-VAL-FRM-VAL-FORI.

      *ISP CALCULA VALOR FINAL DE LA OPERACION
           MOVE OPD-FEC-FREA IN OPD-FLD TO INT-FUNO.
           MOVE OPD-FEC-FPVC IN OPD-FLD TO INT-FDOS.
           MOVE OPD-COD-VCAM IN OPD-FLD TO INT-VCAM.
           MOVE OPD-FEC-FREA IN OPD-FLD TO INT-FCOL.
           MOVE OPD-FEC-FREA IN OPD-FLD TO INT-FBTV.
           MOVE OPD-SGV-TINT IN OPD-FLD TO INT-TINT.
           MOVE POD-COD-TINT IN POD     TO INT-TIPT.
           PERFORM GNS-CAL-INT.
           IF INT-CMSG > SPACES
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE INT-CMSG TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-VAL-FRM-VAL-FORI.

      *     IF SCR-CIC-TVAL = PDB-CIC-MNAC
      *         MOVE FRM-VAL-IPES IN OPD-FLD TO WSS-VAL-CAPI
      *     ELSE
               MOVE OPD-VAL-CAPT IN OPD-FLD TO WSS-VAL-CAPI.

           MOVE SPACES TO MSG-COD-MENS.
           MOVE ZEROES TO SCR-CAPI SCR-INTE.
      * ISP: CALCULA CAPITAL E INTERESES
           PERFORM CAL-CAP-INT.
           IF MSG-COD-MENS > SPACES
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE 'DAP' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-VAL-FRM-VAL-FORI.
           MOVE ZEROES TO WSS-VAL-FORI.
           ADD SCR-INTE TO WSS-VAL-FORI.
           ADD SCR-CAPI TO WSS-VAL-FORI.
             
      * JVM: Mantencion 11/06/1992
           MULTIPLY INT-TIPE BY 100 GIVING SCR-SGV-TPER.
      * JVM: Fin

      *ISP : ELI  1-APR-1992 20:20:37 
      *    aproximacion ultimo decimal de cantidades en pesos
      *     MULTIPLY WSS-VAL-FORI BY 1 
      *         GIVING FRM-VAL-FORI IN OPD-FLD ROUNDED.
            MOVE WSS-VAL-FORI TO FRM-VAL-FORI IN OPD-FLD.

      *     IF SCR-CIC-TVAL = PDB-CIC-MNAC
      *     IF SCR-CIC-VCAM = PDB-CIC-0999
      *    aproximaciones de cantidades en pesos
            MOVE FRM-VAL-FORI IN OPD-FLD TO PES-SGV-DECI.
            MOVE SCR-CIC-VCAM TO PES-CIC-VCAM.
            PERFORM PES-SCTV.
            MOVE PES-SGV-ENTE TO FRM-VAL-FORI IN OPD-FLD.

            MOVE OPD-SGV-MPRE IN OPD-FLD TO PES-SGV-DECI.
            MOVE SCR-CIC-VCAM TO PES-CIC-VCAM.
            PERFORM PES-SCTV.
            MOVE PES-SGV-ENTE TO OPD-SGV-MPRE IN OPD-FLD.

            MOVE SCR-IDNI TO PES-SGV-DECI.
            MOVE SCR-CIC-VCAM TO PES-CIC-VCAM.
            PERFORM PES-SCTV.
            MOVE PES-SGV-ENTE TO SCR-IDNI.
      *>>>>
       FIN-VAL-FRM-VAL-FORI.
           EXIT.
       
       VAL-OPD-COD-GARA SECTION.
       INI-VAL-OPD-COD-GARA.
           IF OPD-COD-GARA IN OPD-FLD NOT > SPACES
              MOVE SPACES TO OPD-COD-GARA IN OPD-FLD.
      *VAL-COD Valida codigo de tabla
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'GAR ' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-GARA IN OPD-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
      *<<<< FIN_OPD_COD_GARA
           IF FRM-SUAR = FRM-SUAR-MAL
               GO TO FIN-VAL-OPD-COD-GARA.

           IF SCR-CMND = 'MDA'
               GO TO FIN-VAL-OPD-COD-GARA.

           IF SCR-CMND = 'MDA' AND
              OPD-COD-GARA IN OPD = OPD-COD-GARA IN OPD-FLD
                GO TO OK-GARA-MDA.

           IF SCR-CMND = 'MDA'
                MOVE 'DAP' TO TAB-COD-SIST
                MOVE 'GAR' TO TAB-COD-TTAB IN TAB
                MOVE OPD-COD-GARA IN OPD TO TAB-COD-CTAB IN TAB
                PERFORM VAL-COD
                MOVE TAB-GLS-DATA IN TAB TO WSS-OPD-COD-GARA-MDA-OPD
                IF WSS-OPD-COD-GARA-MDA-OPD NOT > SPACES
                    MOVE FRM-SUAR-MAL TO FRM-SUAR
                    MOVE 'DAP' TO MSG-COD-SIST
                    MOVE 'CODGARAMDANC' TO MSG-COD-MENS
                    PERFORM GET-MSG
                    MOVE MSG-GLS-DESC IN MSG TO FRM-MENS
                    GO TO FIN-VAL-OPD-COD-GARA
                ELSE
                IF WSS-OPD-COD-GARA-MDA-OPD NOT =
                   OPD-COD-GARA IN OPD-FLD
                    MOVE FRM-SUAR-MAL TO FRM-SUAR
                    MOVE 'DAP' TO MSG-COD-SIST
                    MOVE 'CODGARAMDACE' TO MSG-COD-MENS
                    PERFORM GET-MSG
                    MOVE MSG-GLS-DESC IN MSG TO CPT-STR1
                    MOVE WSS-OPD-COD-GARA-MDA-OPD TO CPT-STR2
                    PERFORM CPT-BLKS
                    MOVE CPT-STRN     TO FRM-MENS
                    MOVE FRM-SUAR-MAL TO FRM-SUAR
                    GO TO FIN-VAL-OPD-COD-GARA.
       OK-GARA-MDA.
      *>>>> FIN_OPD_COD_GARA
       FIN-VAL-OPD-COD-GARA.
           EXIT.
       
       VAL-OPD-COD-CUST SECTION.
       INI-VAL-OPD-COD-CUST.
           IF OPD-COD-CUST IN OPD-FLD NOT > SPACES
              MOVE SPACES TO OPD-COD-CUST IN OPD-FLD.
      *<<<< OPD_COD_CUST
           IF    SCR-CNAL = '100'
              OR SCR-CNAL = '110'
                 MOVE SCR-COD-CUST-E TO OPD-COD-CUST IN OPD-FLD.
           IF OPD-COD-CUST IN OPD-FLD NOT > SPACES AND
             (
               OPD-COD-VCAM IN OPD-FLD = '0999' AND
               OPD-COD-TOPD IN OPD-FLD = 'DPF'  AND
               ( OPD-COD-AOPD IN OPD-FLD = 'NRN' OR
                 OPD-COD-AOPD IN OPD-FLD = 'NRS' OR
                 OPD-COD-AOPD IN OPD-FLD = 'ERN'
               )
             )
             MOVE SCR-COD-CUST-E TO OPD-COD-CUST IN OPD-FLD.
           IF OPD-COD-CUST IN OPD-FLD NOT > SPACES
                MOVE SCR-SON-N TO OPD-COD-CUST IN OPD-FLD.
      *>>>> OPD_COD_CUST
      *VAL-COD Valida codigo de tabla
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'CUS ' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-CUST IN OPD-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
      *<<<<  FIN_OPD_COD_CUST
      * DAPR0016-INI(ISP)   22-MAR-2000 09:59:00
      *     IF OPD-COD-CUST IN OPD-FLD = SCR-COD-CUST-E AND
      *        POD-COD-RENO IN POD NOT = SCR-SON-S
      *          MOVE 'DAP' TO MSG-COD-SIST
      *          MOVE 'CUSESOLOREN' TO MSG-COD-MENS
      *          PERFORM GET-MSG
      *          MOVE MSG-GLS-DESC TO FRM-MENS
      *          MOVE FRM-SUAR-MAL TO FRM-SUAR
      *          GO TO FIN-VAL-OPD-COD-CUST.
      * DAPR0016-FIN(ISP)   22-MAR-2000 09:59:00
      *ADA-INI 03-NOV-2000 No permite custodia electronica para
      *captacion retroactiva
           IF OPD-COD-CUST IN OPD-FLD = SCR-COD-CUST-E AND
              SCR-CMND = 'ODB'
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'OPDODBCUSE<>' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-OPD-COD-CUST.
      *ADA-FIN 03-NOV-2000
      *HZF-INI 17-05-2002
           IF OPD-COD-CUST IN OPD-FLD = SCR-COD-CUST-E AND
              SCR-CMND = 'MDA' AND
              OPD-COD-CUST IN OPD NOT = SCR-COD-CUST-E
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'OPDMDACUSE<>' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-OPD-COD-CUST.
      *HZF-FIN 17-05-2002
      *>>>> OPD_COD_CUST
       FIN-VAL-OPD-COD-CUST.
           EXIT.
       
       VAL-OPD-COD-IONP SECTION.
       INI-VAL-OPD-COD-IONP.
       FIN-VAL-OPD-COD-IONP.
           EXIT.
       
       VAL-OPD-NUM-DURV SECTION.
       INI-VAL-OPD-NUM-DURV.
       FIN-VAL-OPD-NUM-DURV.
           EXIT.
       
       VAL-OPD-IND-DURV SECTION.
       INI-VAL-OPD-IND-DURV.
           IF OPD-IND-DURV IN OPD-FLD NOT > SPACES
              MOVE SPACES TO OPD-IND-DURV IN OPD-FLD.
      *>>>> OPD_IND_DURV
           IF SCR-CMND = 'MDA'
               GO TO FIN-VAL-OPD-IND-DURV.
           IF ( OPD-NUM-DURV IN OPD-FLD > ZEROES AND
              OPD-IND-DURV IN OPD-FLD NOT > SPACES ) OR
              ( OPD-NUM-DURV IN OPD-FLD NOT > ZEROES AND
              OPD-IND-DURV IN OPD-FLD > SPACES )
      *        DURV ambos llenos/vacios
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'DURV    MALO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-OPD-IND-DURV.

      *     IF POD-NUM-VMAX IN POD = 1 AND 
      *        ( OPD-NUM-DURV IN OPD-FLD NOT > ZEROES OR
      *          OPD-IND-DURV IN OPD-FLD NOT > SPACES )
      *         MOVE OPD-NUM-PVEN IN OPD-FLD TO OPD-NUM-DURV IN OPD-FLD
      *         MOVE OPD-IND-PVEN IN OPD-FLD TO OPD-IND-DURV IN OPD-FLD.

      *     IF POD-NUM-VMAX IN POD = 1 AND 
      *        ( OPD-NUM-PVEN IN OPD-FLD NOT = OPD-NUM-DURV IN OPD-FLD
      *                                 OR
      *          OPD-IND-PVEN IN OPD-FLD NOT = OPD-IND-DURV IN OPD-FLD )
      *        DURV debe ser igual PVEN pues VMAX IN POD = 1
      *         MOVE 'DAP' TO MSG-COD-SIST
      *         MOVE 'DURV<>PVEN' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         MOVE MSG-GLS-DESC TO FRM-MENS
      *         MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *<<<< OPD_IND_DURV 
      *VAL-IND Valida miscelaneo de tabla
           MOVE 'TAB' TO MSC-COD-SIST.
           MOVE 'IPER' TO MSC-COD-TMSC IN MSC.
           MOVE OPD-IND-DURV IN OPD-FLD TO MSC-COD-CMSC IN MSC.
           PERFORM VAL-IND.
           IF MSG-COD-MENS = 'COD    NEX' OR
              OPD-IND-DURV IN OPD-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-DURV IN OPD-FLD
           ELSE
               MOVE MSC-GLS-DCOR IN MSC TO
                    FRM-GLS-DURV IN OPD-FLD.
       FIN-VAL-OPD-IND-DURV.
           EXIT.
       
       VAL-FRM-GLS-DURV SECTION.
       INI-VAL-FRM-GLS-DURV.
       FIN-VAL-FRM-GLS-DURV.
           EXIT.
       
       VAL-FRM-NUM-TVEN SECTION.
       INI-VAL-FRM-NUM-TVEN.
      *<<<< FRM_NUM_TVEN 
           IF SCR-CMND = 'MDA'
               GO TO FIN-VAL-FRM-NUM-TVEN.

           IF FRM-NUM-TVEN IN OPD-FLD NOT > ZEROES
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'TVEN<>CERO' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-FRM-NUM-TVEN.

           IF POD-NUM-VMAX IN POD = 1 AND
              FRM-NUM-TVEN IN OPD-FLD NOT > ZEROES
              MOVE 1 TO FRM-NUM-TVEN IN OPD-FLD.

      *     IF POD-NUM-VMAX IN POD = 1 AND
      *        FRM-NUM-TVEN IN OPD-FLD NOT = 1
      *        NUM-TVEN debe ser = NUM-VMAX IN POD 
      *        pues NUM-VMAX IN POD = 1
      *         MOVE 'DAP' TO MSG-COD-SIST
      *         MOVE 'TVEN<>VMAX' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         MOVE MSG-GLS-DESC TO FRM-MENS
      *         MOVE FRM-SUAR-MAL TO FRM-SUAR
      *         GO TO FIN-VAL-FRM-NUM-TVEN.

      *     IF POD-NUM-VMAX IN POD > 1 AND
      *        FRM-NUM-TVEN IN OPD-FLD NOT > ZEROES
      *         PERFORM ERR-GLS
      *         GO TO FIN-VAL-FRM-NUM-TVEN.

           IF FRM-NUM-TVEN IN OPD-FLD < POD-NUM-VMIN IN POD OR
              FRM-NUM-TVEN IN OPD-FLD > POD-NUM-VMAX IN POD
      *        total vctos. fuera de rango
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'TVEN    FRNG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC        TO WSS-GLS-1RNG IN WSS-VARI
               MOVE POD-NUM-VMIN IN POD TO WSS-GLS-2RNG IN WSS-VARI
               MOVE POD-NUM-VMAX IN POD TO WSS-GLS-4RNG IN WSS-VARI
               MOVE WSS-GLS-MRNG IN WSS-VARI TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *<<<< FRM_NUM_TVEN 
       FIN-VAL-FRM-NUM-TVEN.
           EXIT.
       
       VAL-OPD-NUM-SEVE SECTION.
       INI-VAL-OPD-NUM-SEVE.
       FIN-VAL-OPD-NUM-SEVE.
           EXIT.
       
       VAL-OPD-IND-SEVE SECTION.
       INI-VAL-OPD-IND-SEVE.
           IF OPD-IND-SEVE IN OPD-FLD NOT > SPACES
              MOVE SPACES TO OPD-IND-SEVE IN OPD-FLD.
      *<<<< OPD_IND_SEVE 
           IF SCR-CMND = 'MDA'
               GO TO FIN-VAL-OPD-IND-SEVE.
           MOVE SPACES TO MSG-COD-MENS.
           IF ( OPD-NUM-SEVE IN OPD-FLD > ZEROES AND
              OPD-IND-SEVE IN OPD-FLD NOT > SPACES ) OR
              ( OPD-NUM-SEVE IN OPD-FLD NOT > ZEROES AND
              OPD-IND-SEVE IN OPD-FLD  > SPACES )
      *        SEVE, ambos llenos/vacios
               MOVE 'SEVE    MALO' TO MSG-COD-MENS
               GO TO ERR-OPD-IND-SEVE.

           IF FRM-NUM-TVEN IN OPD-FLD > 1 AND 
              ( OPD-NUM-SEVE IN OPD-FLD NOT > ZEROES OR
                OPD-IND-SEVE IN OPD-FLD NOT > SPACES )
      *        SEVE obligatorio pues TVEN > 1
               MOVE 'SEVE    OBL' TO MSG-COD-MENS
               GO TO ERR-OPD-IND-SEVE.

      *     IF OPD-COD-MORE IN OPD-FLD NOT = 'N'
           PERFORM VAL-CLD-VEN.

       ERR-OPD-IND-SEVE.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *<<<< OPD_IND_SEVE 
      *VAL-IND Valida miscelaneo de tabla
           MOVE 'TAB' TO MSC-COD-SIST.
           MOVE 'IPER' TO MSC-COD-TMSC IN MSC.
           MOVE OPD-IND-SEVE IN OPD-FLD TO MSC-COD-CMSC IN MSC.
           PERFORM VAL-IND.
           IF MSG-COD-MENS = 'COD    NEX' OR
              OPD-IND-SEVE IN OPD-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-SEVE IN OPD-FLD
           ELSE
               MOVE MSC-GLS-DCOR IN MSC TO
                    FRM-GLS-SEVE IN OPD-FLD.
       FIN-VAL-OPD-IND-SEVE.
           EXIT.
       
       VAL-FRM-GLS-SEVE SECTION.
       INI-VAL-FRM-GLS-SEVE.
      *<<<< FRM_GLS_SEVE 
           IF SCR-CMND = 'MDA'
               GO TO FIN-VAL-FRM-GLS-SEVE.
           IF OPD-NUM-SEVE IN OPD-FLD NOT > SPACES
                GO TO ERR-VAL-FRM-GLS-SEVE.

           MOVE SPACES TO MSG-COD-MENS.

      * ICU : 01011991 + SEP MIN VCTOS DE POD
           MOVE POD-IND-SMNV IN POD TO MSC-COD-CMSC IN MSC.
           PERFORM OBT-CIC-PER.

           MOVE '01011991' TO FEC-FECH.
           MOVE POD-NUM-SMNV IN POD TO WSS-NUM-PER
           PERFORM SEL-PER.
           MOVE FEC-ITM1 TO WSS-NUM-DUNO.
           MOVE FEC-ITM2 TO WSS-NUM-MUNO.
           MOVE FEC-ITM3 TO WSS-NUM-SUNO.
           MOVE FEC-ITM4 TO WSS-NUM-AUNO.

      * ICU : 01011991 + SEP MIN VCTOS EN POD

           MOVE OPD-IND-SEVE IN OPD-FLD TO MSC-COD-CMSC IN MSC.
           PERFORM OBT-CIC-PER.

           MOVE '01011991' TO FEC-FECH.
           MOVE OPD-NUM-SEVE IN OPD-FLD TO WSS-NUM-PER
           PERFORM SEL-PER.
           MOVE FEC-ITM1 TO WSS-NUM-DDOS.
           MOVE FEC-ITM2 TO WSS-NUM-MDOS.
           MOVE FEC-ITM3 TO WSS-NUM-SDOS.
           MOVE FEC-ITM4 TO WSS-NUM-ADOS.

           IF WSS-FEC-FUNO > WSS-FEC-FDOS
      *         SEP VCTOS EN OPD < SEP MIN VCTOS EN POD
                MOVE 'SEVE<SMNVPOD' TO MSG-COD-MENS
                GO TO ERR-VAL-FRM-GLS-SEVE.

      * ICU : 01011991 + SEP MAX VCTOS DE POD
           MOVE POD-IND-SMXV IN POD TO MSC-COD-CMSC IN MSC.
           PERFORM OBT-CIC-PER.

           MOVE '01011991' TO FEC-FECH.
           MOVE POD-NUM-SMXV IN POD TO WSS-NUM-PER
           PERFORM SEL-PER.
           MOVE FEC-ITM1 TO WSS-NUM-DUNO.
           MOVE FEC-ITM2 TO WSS-NUM-MUNO.
           MOVE FEC-ITM3 TO WSS-NUM-SUNO.
           MOVE FEC-ITM4 TO WSS-NUM-AUNO.

           IF WSS-FEC-FUNO < WSS-FEC-FDOS
      *         SEP VCTOS EN OPD > SEP MAX VCTOS EN POD
                MOVE 'SEVE>SMXVPOD' TO MSG-COD-MENS
                GO TO ERR-VAL-FRM-GLS-SEVE.

       ERR-VAL-FRM-GLS-SEVE.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE -1 TO OPD-NUM-SEVE-LEN IN OPD-FLD.
      *<<<< FRM_GLS_SEVE 
       FIN-VAL-FRM-GLS-SEVE.
           EXIT.
       
       VAL-OPD-SGV-MPRE SECTION.
       INI-VAL-OPD-SGV-MPRE.
      *<<<< OPD_SGV_MPRE 
           MOVE SPACES TO MSG-COD-MENS.

           IF SCR-CMND = 'RDL'
               IF OPD-SGV-MPRE IN OPD-FLD > ZEROES AND
                  OPD-COD-GARA IN OPD NOT = SCR-COD-GARA-N
                    MOVE 'RDLINVGARA' TO MSG-COD-MENS
                    GO TO ERR-VAL-OPD-SGV-MPRE.

           IF SCR-CMND = 'RDL'
               IF OPD-SGV-MPRE IN OPD-FLD > ZEROES AND
                  OPD-COD-IONP IN OPD-FLD = 'S'
                    MOVE 'RDLINVIONP' TO MSG-COD-MENS
                    GO TO ERR-VAL-OPD-SGV-MPRE.
      *JUS-INI 4-JAN-1996 OJO: ESTE CODIGO FUE ANULADO TEMPORALMENTE
      *JUS-INI 6-NOV-1995
      *     IF SCR-CMND = 'RDL'
      *         IF OPD-SGV-MPRE IN OPD-FLD > ZEROES AND
      *            OPD-COD-CUST IN OPD-FLD = 'S'
      *              MOVE 'RDLINVCUST' TO MSG-COD-MENS
      *              GO TO ERR-VAL-OPD-SGV-MPRE.
      *JUS-FIN
      *JUS-FIN 4-JAN-1996 10:49:21 
           IF ( SCR-CIC-MORE = 'PC' OR 'MC' ) AND
              OPD-SGV-MPRE IN OPD-FLD NOT > ZEROES
               MOVE 'SGVMPREAOBL' TO MSG-COD-MENS
               GO TO ERR-VAL-OPD-SGV-MPRE.
      * ISP:
      * VALIDA QUE EL MONTO PARA AQUELLOS RETIROS QUE 
      * IMPLICAN PORCENTAJE
      * ESTEN EN EL RANGO 0 < MPRE <= 100

           IF ( SCR-CIC-MORE = 'PI' OR 'PC' ) AND
      *        ( OPD-SGV-MPRE IN OPD-FLD NOT > ZEROES OR
                OPD-SGV-MPRE IN OPD-FLD > 100
      *        )
      *        DEBE SER : 0 < MONTO PORCENTAJE RETIRO <= 100
               MOVE '0<MPRE<=100' TO MSG-COD-MENS
               GO TO ERR-VAL-OPD-SGV-MPRE.

           IF SCR-CIC-MORE =  'PC'
               MULTIPLY OPD-SGV-MPRE IN OPD-FLD BY 
                  FRM-NUM-TVEN IN OPD-FLD GIVING WSS-SGV-TSPC ROUNDED
                  IF WSS-SGV-TSPC > 100
      * ISP: SUMATORIA PORCENTAJE K DEBE SER < = K
                     MOVE 'SUMPC<=100' TO MSG-COD-MENS
                     GO TO ERR-VAL-OPD-SGV-MPRE.

           DIVIDE OPD-VAL-CAPT IN OPD-FLD BY 
               FRM-NUM-TVEN IN OPD-FLD GIVING WSS-SGV-MPRE ROUNDED.

           IF SCR-CIC-MORE = 'MC'
               IF OPD-SGV-MPRE IN OPD-FLD NOT > ZEROES 
      *            DEBE SER : MONTO PORCENTAJE RETIRO > 0
                   MOVE 'MPRE>0' TO MSG-COD-MENS
                   GO TO ERR-VAL-OPD-SGV-MPRE
               ELSE
               IF OPD-SGV-MPRE IN OPD-FLD > WSS-SGV-MPRE
      *            MPRE > VAL-CAPT / NUM-TVEN
                   MOVE 'MPRE>VC/TV' TO MSG-COD-MENS
                   GO TO ERR-VAL-OPD-SGV-MPRE.

           IF SCR-CIC-MORE = 'CO'
              IF OPD-SGV-MPRE IN OPD-FLD NOT > ZEROES
                  MOVE WSS-SGV-MPRE TO OPD-SGV-MPRE IN OPD-FLD
              ELSE
                  IF OPD-SGV-MPRE IN OPD-FLD NOT = WSS-SGV-MPRE
      *               MPRE <> VAL-CAPT / NUM-TVEN
                      MOVE 'MPRE<>CALC' TO MSG-COD-MENS
                      GO TO ERR-VAL-OPD-SGV-MPRE.

      *ADA-INI 25-SEP-2001
           IF OPD-SGV-MPRE IN OPD-FLD < 0
               MOVE 'OPDMPRE<ZERO' TO MSG-COD-MENS
               GO TO ERR-VAL-OPD-SGV-MPRE.
      *ADA-FIN 25-SEP-2001
       ERR-VAL-OPD-SGV-MPRE.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>> 
       FIN-VAL-OPD-SGV-MPRE.
           EXIT.
       
       VAL-FRM-GLS-MORE SECTION.
       INI-VAL-FRM-GLS-MORE.
       FIN-VAL-FRM-GLS-MORE.
           EXIT.
       
       VAL-OPD-NUM-RETD SECTION.
       INI-VAL-OPD-NUM-RETD.
       FIN-VAL-OPD-NUM-RETD.
           EXIT.
       
       VAL-OPD-IND-RETD SECTION.
       INI-VAL-OPD-IND-RETD.
           IF OPD-IND-RETD IN OPD-FLD NOT > SPACES
              MOVE SPACES TO OPD-IND-RETD IN OPD-FLD.
      *<<<< OPD_IND_RETD
           IF ( OPD-NUM-RETD IN OPD-FLD > ZEROES AND
              OPD-IND-RETD IN OPD-FLD NOT > SPACES ) OR
              ( OPD-NUM-RETD IN OPD-FLD NOT > ZEROES AND
              OPD-IND-RETD IN OPD-FLD > SPACES )
      *        RETD inconsistente
               MOVE 'RETD   INC' TO MSG-COD-MENS
               GO TO ERR-OPD-IND-RETD.

      * ISP: FIJO 'D' POR EL MOMENTO
      * JVM: Mantencion 11/06/1992
      *      RETD no puede ser mayor a 3 dias
           IF NOT ( OPD-IND-RETD IN OPD-FLD = 'D' OR
                    OPD-IND-RETD IN OPD-FLD = SPACES ) OR
                  ( OPD-NUM-RETD IN OPD-FLD > 3 )
               MOVE 'RETDNO>3DIAS' TO MSG-COD-MENS
               GO TO ERR-OPD-IND-RETD.
      * JVM: Fin

           GO TO FIN-VAL-OPD-IND-RETD.

       ERR-OPD-IND-RETD.
      *GET-MSG Busca mensaje en tabla
           MOVE 'DAP' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>> OPD_IND_RETD
      *VAL-IND Valida miscelaneo de tabla
           MOVE 'TAB' TO MSC-COD-SIST.
           MOVE 'IPER' TO MSC-COD-TMSC IN MSC.
           MOVE OPD-IND-RETD IN OPD-FLD TO MSC-COD-CMSC IN MSC.
           PERFORM VAL-IND.
           IF MSG-COD-MENS = 'COD    NEX' OR
              OPD-IND-RETD IN OPD-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-RETD IN OPD-FLD
           ELSE
               MOVE MSC-GLS-DCOR IN MSC TO
                    FRM-GLS-RETD IN OPD-FLD.
       FIN-VAL-OPD-IND-RETD.
           EXIT.
       
       VAL-FRM-GLS-RETD SECTION.
       INI-VAL-FRM-GLS-RETD.
       FIN-VAL-FRM-GLS-RETD.
           EXIT.
       
       VAL-OPD-COD-UBFD SECTION.
       INI-VAL-OPD-COD-UBFD.
           IF OPD-COD-UBFD IN OPD-FLD NOT > SPACES
              MOVE SPACES TO OPD-COD-UBFD IN OPD-FLD.
      *<<<< OPD_COD_UBFD
           IF OPD-COD-UBFD IN OPD-FLD NOT > SPACES
               GO TO FIN-VAL-OPD-COD-UBFD.
*CIMA-INI 26-ENE-2015 CUSTODIA DAP - IMPRESION
           MOVE WSS-CTE-DAP TO TAB-COD-SIST.
           MOVE WSS-CT-CDE TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-UBFD IN OPD-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = WSS-CT-MNEX
                   MOVE SPACES TO FRM-GLS-UBFD IN OPD-FLD               
               ELSE                                                     
                   MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-UBFD IN OPD-FLD.
                   
      *    MOVE OPD-COD-UBFD IN OPD-FLD TO WSS-ENT-UBFD.
      *    IF NOT ( WSS-TBL-UBFD IN WSS-VARI = 'OFI' OR
      *             WSS-TBL-UBFD IN WSS-VARI = 'UBI' )
      *        MOVE 'DAP' TO MSG-COD-SIST
      *        MOVE 'TBLUBFDERR' TO MSG-COD-MENS
      *        PERFORM GET-MSG
      *        MOVE MSG-GLS-DESC TO FRM-MENS
      *        MOVE FRM-SUAR-MAL TO FRM-SUAR
      *        GO TO FIN-VAL-OPD-COD-UBFD.
      *    IF WSS-TBL-UBFD IN WSS-VARI = 'OFI'
      *        MOVE WSS-COD-UBFD TO OFI-COD-OFIC IN OFI
      *        PERFORM VAL-OFI
      *        IF MSG-COD-MENS NOT = SPACES
      *            MOVE MSG-GLS-DESC TO FRM-MENS
      *            MOVE FRM-SUAR-MAL TO FRM-SUAR
      *            IF MSG-COD-MENS = 'COD    NEX'
      *                MOVE SPACES TO FRM-GLS-UBFD IN OPD-FLD
      *            ELSE
      *                MOVE OFI-GLS-DESC IN OFI TO
      *                     FRM-GLS-UBFD IN OPD-FLD
      *         ELSE
      *                MOVE OFI-GLS-DESC IN OFI TO
      *                     FRM-GLS-UBFD IN OPD-FLD
      *    ELSE
      *        MOVE 'TAB' TO TAB-COD-SIST
      *        MOVE 'UBI' TO TAB-COD-TTAB IN TAB
      *        MOVE WSS-COD-UBFD TO TAB-COD-CTAB IN TAB
      *        PERFORM VAL-COD
      *        IF MSG-COD-MENS = 'COD    NEX'
      *            MOVE SPACES TO FRM-GLS-UBFD IN OPD-FLD
      *        ELSE
      *            MOVE TAB-GLS-DESC IN TAB TO FRM-GLS-UBFD IN OPD-FLD.
      *CIMA-FIN 26-ENE-2015 CUSTODIA DAP - IMPRESION
      *>>>>
       FIN-VAL-OPD-COD-UBFD.
           EXIT.
       
       VAL-OPD-COD-DEVL SECTION.
       INI-VAL-OPD-COD-DEVL.
           IF OPD-COD-DEVL IN OPD-FLD NOT > SPACES
              MOVE SPACES TO OPD-COD-DEVL IN OPD-FLD.
      *VAL-COD Valida codigo de tabla
           MOVE 'GNS' TO TAB-COD-SIST.
           MOVE 'SON ' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-DEVL IN OPD-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
       FIN-VAL-OPD-COD-DEVL.
           EXIT.
       
       VAL-FRM-GLS-UBFD SECTION.
       INI-VAL-FRM-GLS-UBFD.
       FIN-VAL-FRM-GLS-UBFD.
           EXIT.
       
       VAL-OPD-COD-AFER SECTION.
       INI-VAL-OPD-COD-AFER.
       FIN-VAL-OPD-COD-AFER.
           EXIT.
       
       VAL-OPD-COD-STAT SECTION.
       INI-VAL-OPD-COD-STAT.
       FIN-VAL-OPD-COD-STAT.
           EXIT.
       
       VAL-OPD-COD-SCTB SECTION.
       INI-VAL-OPD-COD-SCTB.
       FIN-VAL-OPD-COD-SCTB.
           EXIT.
       
       VAL-OPD-COD-EJEC SECTION.
       INI-VAL-OPD-COD-EJEC.
           IF OPD-COD-EJEC IN OPD-FLD NOT > SPACES
                PERFORM ERR-GLS
                GO TO FIN-VAL-OPD-COD-EJEC.
      *<<<< OPD_COD_EJEC
           IF SCR-OFRM-SRV AND SCR-CMND = 'RDL'
               GO TO FIN-VAL-OPD-COD-EJEC.
      *VAL-USR Valida Usuario
           MOVE OPD-COD-EJEC IN OPD-FLD TO USR-COD-USER IN USR.
           PERFORM VAL-USR.
           IF MSG-COD-MENS > SPACES
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
           IF MSG-COD-MENS NOT = 'COD    NEX'
               MOVE USR-GLS-DESC IN USR TO FRM-GLS-EJEC IN OPD-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-EJEC IN OPD-FLD.
           IF FRM-SUAR = FRM-SUAR-MAL
               GO TO FIN-VAL-OPD-COD-EJEC.

           IF SCR-CMND = 'ODL' OR 'RDB' OR
                         'ELI' OR 'MOD' OR 'VRF'

      *JSS-INI 28-JUN-2002
      *Si el cliente tiene Permiso no debe validar que
      *la oficina del usuario sea igual a la oficina del DAP
      *La mantencion esta orientada para que el usuario
      *centralizador pueda captar DAP y asignarlos a cualquier
      *oficina
           MOVE WSS-IDN-SIST            TO USP-SISTEMA
           MOVE SPACES                  TO USP-PERMISO
           MOVE 'DAP'                   TO USP-GRUPO
           MOVE SCR-USER                TO USP-USUARIO
           MOVE 'DAPUSERS/CEN'          TO USP-STRING
           PERFORM USPC107
           IF USP-PERMISO = 'P'
               NEXT SENTENCE
           ELSE
      *JSS-FIN 28-JUN-2002
           IF NOT SCR-OFRM-SRV
           IF USR-COD-OFUS IN USR NOT = OPD-COD-OFIC IN OPD-FLD
           IF NOT ( SCR-CNAL = '100' OR '110' )
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'OFIEJECERR' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-OPD-COD-EJEC.

      *RVM-CST-INI 28-AUG-1996
           IF SCR-CMND = 'ODB' AND
              VERSION-BCI = 'S'
               IF USR-COD-OFUS IN USR NOT = WSS-CAI-ISER-2 IN WSS-VARI
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'OFIEJEC<>SER' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE -1 TO OPD-CAI-ISER-LEN IN OPD-FLD
               GO TO FIN-VAL-OPD-COD-EJEC.
      *RVM-CST-FIN 28-AUG-1996
      *>>>> OPD_COD_EJEC
      *VAL-USR Valida Usuario
           MOVE OPD-COD-EJEC IN OPD-FLD TO USR-COD-USER IN USR.
           PERFORM VAL-USR.
           IF MSG-COD-MENS > SPACES
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
           IF MSG-COD-MENS NOT = 'COD    NEX'
               MOVE USR-GLS-DESC IN USR TO FRM-GLS-EJEC IN OPD-FLD
           ELSE
               MOVE SPACES TO FRM-GLS-EJEC IN OPD-FLD.
       FIN-VAL-OPD-COD-EJEC.
           EXIT.
       
       VAL-RCC-NUM-DIRE SECTION.
       INI-VAL-RCC-NUM-DIRE.
      *<<<< RCC_NUM_DIRE
           IF DBC-IND-ICLI IN OPD-FLD = 'M'
               MOVE ZEROES TO RCC-NUM-DIRE IN OPD-FLD
               GO TO FIN-VAL-RCC-NUM-DIRE.
      * VALIDA DIRECCION UNA VEZ VALIDADO EL CLIENTE
           IF DBC-NUM-ICLI IN OPD-FLD NOT > ZEROES
               GO TO FIN-VAL-RCC-NUM-DIRE.
           IF RCC-NUM-DIRE IN OPD-FLD > ZEROES
               MOVE DBC-CIC-ICLI IN DBC     TO RCD-CIC-ICLI IN RCD
               MOVE RCC-NUM-DIRE IN OPD-FLD TO RCD-NUM-DIRE IN RCD
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM SGC-FIO-RCD
               MOVE FIO-STAT TO PGM-STAT-RCD
               IF NOT FIO-STAT-OKS
                   MOVE SPACES TO RCD-GLS-DIRE IN OPD-FLD
      *
      *PARA COMPLETAR DATOS SIEMPRE SE PARA EN EL RUT DEL CLIENTE
      *LRH             MOVE -1  TO DBC-NUM-ICLI-LEN IN OPD-FLD 
                   MOVE 'DAP'        TO MSG-COD-SIST
                   MOVE 'DIR    OBL' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-RCC-NUM-DIRE
               ELSE
                   MOVE RCD-GLS-DIRE IN RCD TO
                        RCD-GLS-DIRE IN OPD-FLD
                   IF RCD-MSC-TDIR IN RCD = '7'
      *                         AND
      *                ( SCR-CNAL = '100' OR
      *                  SCR-CNAL = '110' OR
      *                  SCR-CNAL = '150'  )
                        GO TO FIN-VAL-RCC-NUM-DIRE
                   ELSE
                       NEXT SENTENCE
           ELSE
      *JFH-INI 21-Oct-2009
               MOVE 'DAP' TO FIO-SIST
               MOVE 'VSN' TO TAB-COD-TTAB IN TAB
               MOVE 'BCE' TO TAB-COD-CTAB IN TAB
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM GNS-FIO-TAB
               IF FIO-STAT-OKS AND TAB-IND-VIGE IN TAB = 'S'
                   PERFORM BUS-BCE
                   IF RCD-GLS-DIRE IN RCD NOT > SPACES
                       PERFORM BUS-DOM
                   END-IF
               ELSE
                   PERFORM BUS-DOM
               END-IF
      *JFH-FIN 21-Oct-2009

               MOVE RCD-GLS-DIRE IN RCD TO RCD-GLS-DIRE IN OPD-FLD
               IF RCD-GLS-DIRE IN RCD > SPACES
                   MOVE RCD-NUM-DIRE IN RCD TO RCC-NUM-DIRE IN OPD-FLD
               ELSE
      *PARA COMPLETAR DATOS SIEMPRE SE PARA EN EL RUT DEL CLIENTE
                   MOVE -1 TO DBC-NUM-ICLI-LEN IN OPD-FLD
                   MOVE 'DAP'        TO MSG-COD-SIST
                   MOVE 'DOM    OBL' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-RCC-NUM-DIRE.

      *     IF ( SCR-CNAL = '100' OR
      *          SCR-CNAL = '110' OR
      *          SCR-CNAL = '150'  )
                   GO TO FIN-VAL-RCC-NUM-DIRE.

           IF RCD-COD-LUGA NOT > SPACES
      *PARA COMPLETAR DATOS SIEMPRE SE PARA EN EL RUT DEL CLIENTE
               MOVE -1 TO DBC-NUM-ICLI-LEN IN OPD-FLD
               MOVE 'DAP'        TO MSG-COD-SIST
               MOVE 'COM    OBL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-RCC-NUM-DIRE.

           IF RCD-GLS-FONO NOT > SPACES
      *PARA COMPLETAR DATOS SIEMPRE SE PARA EN EL RUT DEL CLIENTE
               MOVE -1 TO DBC-NUM-ICLI-LEN IN OPD-FLD
               MOVE 'DAP'        TO MSG-COD-SIST
               MOVE 'FON    OBL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-RCC-NUM-DIRE.
      *>>>> RCC_NUM_DIRE
       FIN-VAL-RCC-NUM-DIRE.
           EXIT.
       
       VAL-CAD-IND-TCAD SECTION.
       INI-VAL-CAD-IND-TCAD.
           IF CAD-IND-TCAD IN OPD-FLD NOT > SPACES
                PERFORM ERR-GLS
                GO TO FIN-VAL-CAD-IND-TCAD.
      *<<<< CAD_IND_TCAD
           IF SCR-CMND = 'MDA'
               GO TO FIN-VAL-CAD-IND-TCAD.
           IF CAD-IND-TCAD IN OPD-FLD = 'M'
             GO TO FIN-VAL-CAD-IND-TCAD.
      *>>>> 
      *VAL-IND Valida miscelaneo de tabla
           MOVE 'TAB' TO MSC-COD-SIST.
           MOVE 'TCYA' TO MSC-COD-TMSC IN MSC.
           MOVE CAD-IND-TCAD IN OPD-FLD TO MSC-COD-CMSC IN MSC.
           PERFORM VAL-IND.
      *<<<< FIN_CAD_IND_TCAD
           MOVE MSC-COD-CMSC IN MSC TO WSS-COD-CMSC-CHOBC.
           MOVE MSC-GLS-DATA IN MSC TO WSS-GLS-DATA-CHOBC.
      *>>>> 
       FIN-VAL-CAD-IND-TCAD.
           EXIT.
       
       VAL-CAD-CAI-ICAD SECTION.
       INI-VAL-CAD-CAI-ICAD.
           IF CAD-CAI-ICAD IN OPD-FLD NOT > SPACES
              MOVE SPACES TO CAD-CAI-ICAD IN OPD-FLD.
      *<<<< CAD_CAI_ICAD 
           IF SCR-CMND = 'MDA'
               GO TO FIN-VAL-CAD-CAI-ICAD.
           IF CAD-IND-TCAD IN OPD-FLD = 'M'
               MOVE SPACES TO WSS-IND-CTA
               MOVE SPACES TO WSS-IND-MUOC
               GO TO FIN-VAL-CAD-CAI-ICAD.

           MOVE MSC-COD-DAT1(1) TO WSS-IND-CTA.
           MOVE MSC-COD-DAT1(3) TO WSS-IND-MUOC.

      * LO SGTE. ESTA REFERIDO AL CAMPO CAD-IND-TCAD Y SE MANEJA AQUI
      * PUES NO ES POSIBLE INSERTAR CODIGO ADIC 
      * DESPUES DE LA VALIDACION AUT
           MOVE MSC-COD-DAT2 IN MSC(5) TO WSS-IND-GCAD.

           IF WSS-IND-GCAD NOT > SPACES
      *        tcad no pertenece a dap
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'TCADNODAP' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE -1 TO CAD-IND-TCAD-LEN IN OPD-FLD
               GO TO FIN-VAL-CAD-CAI-ICAD.

           IF WSS-IND-GCAD NOT = 'M' AND
              SCR-CMND = 'ODB'
      *
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'SOLOMNLODB' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE -1 TO CAD-IND-TCAD-LEN IN OPD-FLD
               GO TO FIN-VAL-CAD-CAI-ICAD.
      *>>>> CAD_CAI_ICAD
       FIN-VAL-CAD-CAI-ICAD.
           EXIT.
       
       VAL-CAD-IIC-ICAD SECTION.
       INI-VAL-CAD-IIC-ICAD.
       FIN-VAL-CAD-IIC-ICAD.
           EXIT.
       
       VAL-FRM-CAI-ICAD SECTION.
       INI-VAL-FRM-CAI-ICAD.
           IF FRM-CAI-ICAD IN OPD-FLD NOT > SPACES
              MOVE SPACES TO FRM-CAI-ICAD IN OPD-FLD.
       FIN-VAL-FRM-CAI-ICAD.
           EXIT.
       
       VAL-FRM-IIC-ICAD SECTION.
       INI-VAL-FRM-IIC-ICAD.
      *<<<< FRM_IIC_ICAD
           IF SCR-CMND = 'MDA'
               GO TO FIN-VAL-FRM-IIC-ICAD.
           IF ( FRM-CAI-ICAD IN OPD-FLD > SPACES AND
              FRM-IIC-ICAD IN OPD-FLD NOT > ZEROES ) OR
              ( FRM-CAI-ICAD IN OPD-FLD NOT > SPACES AND
              FRM-IIC-ICAD IN OPD-FLD > ZEROES )
      * ISP: CIC-ICAD inconsistente (ambos llenos/vacios)
               MOVE 'ICAD    MALO' TO MSG-COD-MENS
               GO TO ERR-FRM-IIC-ICAD.



           IF SCR-OFRM-SRV
      *         DISPLAY 'DAPBUOPD : LEYENDO COLA SIMULACION '
               MOVE TSK-TERM-ALF  TO QUE-TERM
               MOVE PTC-SIMD-TYPE TO QUE-TYPE
               MOVE PTC-SIMD-LENG TO QUE-LITM
               MOVE 1 TO QUE-NITM
               MOVE QUE-GET TO QUE-CMND
               PERFORM GNS-PRO-QUE
               IF QUE-STAT = QUE-STAT-OKS
                   MOVE 'S' TO WSS-DSIM-S.


           IF SCR-CIC-MORE = 'PI'
                IF WSS-DSIM-S = 'N'
                IF NOT ( FRM-CAI-ICAD IN OPD-FLD > SPACES AND
                         FRM-IIC-ICAD IN OPD-FLD > ZEROES )
                       MOVE CAD-CAI-ICAD IN OPD-FLD TO
                            FRM-CAI-ICAD IN OPD-FLD
                       MOVE CAD-IIC-ICAD IN OPD-FLD TO
                            FRM-IIC-ICAD IN OPD-FLD.

           IF SCR-CIC-MORE = 'PI'
                IF WSS-DSIM-S = 'N'
                IF ( OPD-COD-VCAM IN OPD-FLD = '0999' AND
                     OPD-COD-TOPD IN OPD-FLD = 'DPF'  AND
                    (OPD-COD-AOPD IN OPD-FLD = 'FRS' OR
                     OPD-COD-AOPD IN OPD-FLD = 'NRS')
                   )
                IF NOT ( FRM-CAI-ICAD IN OPD-FLD > SPACES AND
                         FRM-IIC-ICAD IN OPD-FLD > ZEROES )
                       MOVE 'PISOLOCTACTE' TO MSG-COD-MENS
                       GO TO ERR-FRM-IIC-ICAD.

           IF FRM-CAI-ICAD IN OPD-FLD NOT > SPACES AND
              FRM-IIC-ICAD IN OPD-FLD NOT > ZEROES
               GO TO FIN-VAL-FRM-IIC-ICAD.
           IF SCR-CMND NOT = 'RDL'
               IF SCR-SON-S NOT = 'S'
                     MOVE 'SCRSONN' TO MSG-COD-MENS
                     GO TO ERR-FRM-IIC-ICAD
               ELSE
               IF SCR-SON-S NOT = POD-COD-AACC IN POD
                     MOVE 'FRMICADERR' TO MSG-COD-MENS
                     GO TO ERR-FRM-IIC-ICAD
               ELSE
                     NEXT SENTENCE
           ELSE
      * ISP: NO PUEDE EXISTIR ABONO CUANDO RENUEVA TODO
                IF ( FRM-CAI-ICAD IN OPD-FLD > SPACES OR
                     FRM-IIC-ICAD IN OPD-FLD > ZEROES ) AND
                     SCR-CMND = 'RDL' AND
                     OPD-SGV-MPRE IN OPD-FLD NOT > ZEROES
                       MOVE 'FRMICADMPRE0' TO MSG-COD-MENS
                       GO TO ERR-FRM-IIC-ICAD.

           IF FRM-CAI-ICAD IN OPD-FLD = '"'
               MOVE CAD-CAI-ICAD IN OPD-FLD TO FRM-CAI-ICAD IN OPD-FLD
               MOVE CAD-IIC-ICAD IN OPD-FLD TO FRM-IIC-ICAD IN OPD-FLD
               GO TO FIN-VAL-FRM-IIC-ICAD.

           IF DBC-IND-ICLI IN OPD-FLD = 'M'
               GO TO FIN-VAL-FRM-IIC-ICAD.

           MOVE DBC-CIC-ICLI IN DBC     TO RCO-CIC-ICLI IN RCO.
           MOVE FRM-CAI-ICAD IN OPD-FLD TO RCO-CAI-IOPE IN RCO.
           MOVE FRM-IIC-ICAD IN OPD-FLD TO RCO-IIC-IOPE IN RCO.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF FIO-STAT-OKS
      *        cuenta de abono es del mismo cliente
               GO TO CER-VAL-FRM-IIC-ICAD.

           MOVE FRM-CAI-ICAD IN OPD-FLD TO RCO-CAI-IOPE IN RCO.
           MOVE FRM-IIC-ICAD IN OPD-FLD TO RCO-IIC-IOPE IN RCO.
           MOVE 'RCO-KEY-IOPE' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF NOT FIO-STAT-OKS
      *        cuenta de abono inexistente
               MOVE 'CICIFRMNEX' TO MSG-COD-MENS
               GO TO ERR-FRM-IIC-ICAD.

           IF FIO-STAT-OKS
      *        cuenta de abono es de otro cliente
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'CICIFRMNICLI' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN2
               MOVE FRM-SUAR-MAL TO FRM-SUAR.

       CER-VAL-FRM-IIC-ICAD.
           MOVE RCO-CIC-IOPE IN RCO TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF OPE-FEC-FTOP IN OPE > ZEROES AND
              OPE-FEC-FTOP IN OPE > OPE-FEC-FROP IN OPE
      *        FTOP > FROP, cuenta de abono cerrada
               MOVE 'CICIFRMCCCLO' TO MSG-COD-MENS
               GO TO ERR-FRM-IIC-ICAD.

           GO TO FIN-VAL-FRM-IIC-ICAD.

       ERR-FRM-IIC-ICAD.
      *GET-MSG Busca mensaje en tabla
           MOVE 'DAP' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>> FRM_IIC_ICAD
       FIN-VAL-FRM-IIC-ICAD.
           EXIT.
       
       VAL-FRM-NUM-TOPE SECTION.
       INI-VAL-FRM-NUM-TOPE.
       FIN-VAL-FRM-NUM-TOPE.
           EXIT.
       
       VAL-OPD-CAI-ISER SECTION.
       INI-VAL-OPD-CAI-ISER.
           IF OPD-CAI-ISER IN OPD-FLD NOT > SPACES
              MOVE SPACES TO OPD-CAI-ISER IN OPD-FLD.
      *<<<< OPD_CAI_ISER
           MOVE OPD-CAI-ISER IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 4 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
               MOVE NUM-NN9N TO WSS-OPD-CAI-ISER
               MOVE WSS-OPD-CAI-ISER TO OPD-CAI-ISER IN OPD-FLD
           ELSE
               MOVE NUM-MENS     TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-OPD-CAI-ISER.

      *RVM-CST-INI 26-AUG-1996   
      *OGB-INI 18-DIC-2014 OFICINA 817 ERRONEA - SD 939250
      *    IF VERSION-BCI = 'S' AND                                     
      *       SCR-CMND = 'ODB'                                          
      *        IF OPD-CAI-ISER IN OPD-FLD > SPACES AND                  
      *           OPD-CAI-ISER IN OPD-FLD > '0499'                      
      *            MOVE 'DAP' TO MSG-COD-SIST                           
      *            MOVE 'NOISER>0499' TO MSG-COD-MENS                   
      *            PERFORM GET-MSG                                      
      *            MOVE MSG-GLS-DESC TO FRM-MENS                        
      *            MOVE FRM-SUAR-MAL TO FRM-SUAR                        
      *            GO TO FIN-VAL-OPD-CAI-ISER.                          
      *OGB-FIN 18-DIC-2014 OFICINA 817 ERRONEA - SD 939250
           IF VERSION-BCI = 'S' AND
              SCR-CMND = 'ODB'
               MOVE OPD-CAI-ISER IN OPD-FLD TO WSS-CAI-ISER IN WSS-VARI
               MOVE WSS-CAI-ISER-2 IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS NOT = SPACES
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-OPD-CAI-ISER.
      *RVM-CST-FIN 26-AUG-1996   

           IF SCR-CMND = 'ODB'   AND
              OPD-CAI-ISER IN OPD-FLD NOT > ZEROES
                 MOVE 'DAP' TO MSG-COD-SIST
                 MOVE 'CAIISEROBODB' TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO FRM-MENS
                 MOVE FRM-SUAR-MAL TO FRM-SUAR
                 GO TO FIN-VAL-OPD-CAI-ISER.

      *>>>> OPD_CAI_ISER
       FIN-VAL-OPD-CAI-ISER.
           EXIT.
       
       VAL-OPD-IIC-ISER SECTION.
       INI-VAL-OPD-IIC-ISER.
      *<<<< OPD_IIC_ISER
           IF SCR-IND-V001 = 'B' AND
              SCR-CMND = 'ODB'   AND
              OPD-IIC-ISER IN OPD-FLD NOT > ZEROES
                 MOVE 'DAP' TO MSG-COD-SIST
                 MOVE 'IICISEROBODB' TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO FRM-MENS
                 MOVE FRM-SUAR-MAL TO FRM-SUAR
                 GO TO FIN-VAL-OPD-IIC-ISER.
           IF OPD-IIC-ISER IN OPD-FLD > ZEROES
           IF SCR-CMND = 'ODB'
                MOVE OPD-CAI-ISER IN OPD-FLD TO
                     OPD-CAI-ISER IN OPD
                MOVE OPD-IIC-ISER IN OPD-FLD TO
                     OPD-IIC-ISER IN OPD
                MOVE 'OPD-CIC-ISER' TO FIO-AKEY
                MOVE FIO-GET-KEY TO FIO-CMND
                PERFORM DAP-FIO-OPD
                IF FIO-STAT-OKS
                    MOVE 'DAP' TO MSG-COD-SIST
                    MOVE 'CICISEREXODB' TO MSG-COD-MENS
                    PERFORM GET-MSG
                    MOVE MSG-GLS-DESC TO FRM-MENS
                    MOVE FRM-SUAR-MAL TO FRM-SUAR
                    GO TO FIN-VAL-OPD-IIC-ISER.
      *>>>> OPD_IIC_ISER
       FIN-VAL-OPD-IIC-ISER.
           EXIT.
      * VRF-INI --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION
      * VRF-FIN --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION
      * IDC-INI --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION

       VAL-DBC-NUM-ICLI SECTION.
       INI-VAL-DBC-NUM-ICLI.
      *<<<< DBC_NUM_ICLI 
           IF DBC-IND-ICLI IN OPD-FLD = 'M'
               GO TO FIN-VAL-DBC-NUM-ICLI.

           IF DBC-NUM-ICLI IN OPD-FLD > ZEROES
               PERFORM VAL-ICLI
               IF ( SCR-CNAL = '100' OR
                    SCR-CNAL = '110' ) AND
                    FRM-SUAR-MAL NOT = FRM-SUAR
                      PERFORM PRM-WEB.

      *>>>> DBC_NUM_ICLI 
       FIN-VAL-DBC-NUM-ICLI.
           EXIT.

       VAL-DBC-VRF-ICLI SECTION.
       INI-VAL-DBC-VRF-ICLI.
           IF DBC-VRF-ICLI IN OPD-FLD NOT > SPACES
              MOVE SPACES TO DBC-VRF-ICLI IN OPD-FLD.
      *VAL-RUT Valida Rut para campo IDC
           MOVE IDC-ZERO-S TO IDC-ZERO.
           MOVE DBC-NUM-ICLI IN OPD-FLD TO IDC-NUM-RUTV.
           MOVE DBC-VRF-ICLI IN OPD-FLD TO IDC-VRF-RUTV.
           PERFORM VAL-RUT.
       FIN-VAL-DBC-VRF-ICLI.
           EXIT.
       VAL-DBC-IND-ICLI SECTION.
       INI-VAL-DBC-IND-ICLI.
           IF DBC-IND-ICLI IN OPD-FLD NOT > SPACES
              MOVE SPACES TO DBC-IND-ICLI IN OPD-FLD.
      *VAL-IDC Valida identificador
           MOVE DBC-IND-ICLI IN OPD-FLD TO IDC-IND-RUTV.
           PERFORM VAL-IDC.
           MOVE IDC-IND-RUTV TO DBC-IND-ICLI IN OPD-FLD.
      *<<<< DBC_IND_ICLI 
           IF DBC-IND-ICLI IN OPD-FLD = 'M'
               MOVE 'M' TO SCR-IND-MCLI
           ELSE
               MOVE ' ' TO SCR-IND-MCLI.
      *>>>> DBC_IND_ICLI 
       FIN-VAL-DBC-IND-ICLI.
           EXIT.

       VAL-DBC-GLS-ICLI SECTION.
       INI-VAL-DBC-GLS-ICLI.
           IF DBC-GLS-ICLI IN OPD-FLD NOT > IDC-INIC-GLS 
              MOVE IDC-INIC-GLS TO DBC-GLS-ICLI IN OPD-FLD.
      *VAL-GLS para IDC valida glosa ( extension ) de identificador
           MOVE DBC-GLS-ICLI IN OPD-FLD TO IDC-GLS-RUTV.
           PERFORM VAL-GLS.
           MOVE IDC-GLS-RUTV TO DBC-GLS-ICLI IN OPD-FLD.
       FIN-VAL-DBC-GLS-ICLI.
           EXIT.

      * IDC-FIN --> BMCHIBCI008.SRCAIU VAL-[FLD] SECTION
       
       VAL-FRM-COD-OPCI SECTION.
       INI-VAL-FRM-COD-OPCI.
       FIN-VAL-FRM-COD-OPCI.
           EXIT.
       
       VAL-RCD-GLS-DIRE SECTION.
       INI-VAL-RCD-GLS-DIRE.
       FIN-VAL-RCD-GLS-DIRE.
           EXIT.
       
       VAL-CON-FLD-OPD SECTION.
       INI-VAL-CON-FLD-OPD.
      *<<<< VAL_CON_FLD_OPD


           IF WSS-COD-CMSC-CHOBC = 'CHOBC'
               MOVE WSS-GLS-DATA-CHOBC-NUM-RETD TO
                                         OPD-NUM-RETD-ALF IN OPD-FLD
               MOVE WSS-GLS-DATA-CHOBC-IND-RETD TO
                                         OPD-IND-RETD     IN OPD-FLD
           ELSE
               MOVE ZEROES                      TO
                                         OPD-NUM-RETD-ALF IN OPD-FLD
               MOVE SPACES                      TO
                                         OPD-IND-RETD     IN OPD-FLD.
           IF SCR-CIC-MORE = 'PI'
                PERFORM BUS-TCAS
                IF MSG-COD-MENS > SPACES
                    MOVE FRM-SUAR-MAL TO FRM-SUAR
                    GO TO FIN-VAL-CON-FLD-OPD.

           IF SCR-CMND = 'RDL' AND
      *DAPR0030-INI(RRM) 30-MAY-2000
      *       ( WSS-SW-RRDL  = 'TODO'  OR
      *         OPD-VAL-CAPT IN OPD-FLD NOT > ZEROES ) AND
              OPD-SGV-MPRE IN OPD-FLD > ZEROES         AND
              OPD-COD-CUST IN OPD-FLD = SCR-COD-CUST-E
      *ADA-INI 04-JUL-2002
      *Se permite liquidar en custodia electronica
      *siempre que el usuario tenga la puerta necesaria y
      *se liquide todo el deposito
               MOVE WSS-IDN-SIST            TO USP-SISTEMA
               MOVE SPACES                  TO USP-PERMISO
               MOVE 'DAP'                   TO USP-GRUPO
               MOVE SCR-USER                TO USP-USUARIO
               MOVE 'DAPUSERS/CEN'          TO USP-STRING
               PERFORM USPC107
               IF USP-PERMISO = 'P' AND WSS-SW-RRDL = 'TODO'
                   NEXT SENTENCE
               ELSE
      *ADA-FIN 04-JUL-2002
      *DAPR0030-FIN(RRM) 30-MAY-2000
      * ESTA VARIABLE NO ESTA DEFINIDA AUN EN BCI
      *         MOVE FRM-POS-CURS TO OPD-COD-CUST-LEN IN OPD-FLD
               MOVE -1            TO OPD-COD-CUST-LEN IN OPD-FLD
               MOVE 'S' TO FRM-UCUR
               MOVE 'DAP' TO MSG-COD-SIST
      * LIQUIDACION PARCIAL O TOTAL ERRONEA PARA CUSTODIA ELECTRONICA
      *DAPR0030-INI(RRM) 30-MAY-2000
      *        MOVE 'LIQTOTERRCUE' TO MSG-COD-MENS
               IF NOT ( SCR-CNAL = '100' OR
                        SCR-CNAL = '110' OR
                        SCR-CNAL = '150' )
                   MOVE 'LIQPOTERRCUE' TO MSG-COD-MENS
      *DAPR0030-FIN(RRM) 30-MAY-2000
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-CON-FLD-OPD.

      *CMP-FEC
           MOVE OPD-FEC-FCMP IN OPD-FLD TO FEC-FEC1.
           MOVE OPD-FEC-FTER IN OPD-FLD TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-LES
      *        FCMP debe ser < FTER
               MOVE -1 TO OPD-FEC-FTER-LEN IN OPD-FLD
               MOVE 'S' TO FRM-UCUR
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'FCMP>FTER' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-CON-FLD-OPD.

           PERFORM VAL-ICLI.
           IF FRM-SUAR = FRM-SUAR-MAL
               GO TO FIN-VAL-CON-FLD-OPD.

           PERFORM VAL-CTA.
           IF FRM-SUAR = FRM-SUAR-MAL
              GO TO FIN-VAL-CON-FLD-OPD.

               PERFORM ASG-OFI-BCS.

           IF OPD-COD-MORE IN OPD-FLD = 'N'
               MOVE OPD-NUM-PVEN IN OPD-FLD TO OPD-NUM-DURV IN OPD-FLD
               MOVE OPD-IND-PVEN IN OPD-FLD TO OPD-IND-DURV IN OPD-FLD.

           IF OPD-COD-OFIC IN OPD-FLD NOT > SPACES
               PERFORM ERR-GLS
               MOVE -1 TO OPD-COD-OFIC-LEN IN OPD-FLD
               MOVE 'S' TO FRM-UCUR
               GO TO FIN-VAL-CON-FLD-OPD.

           PERFORM VAL-DURV-POD.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC        TO WSS-GLS-1RNG IN WSS-VARI
               MOVE WSS-NUM-PMIN        TO WSS-GLS-2RNG IN WSS-VARI
               MOVE WSS-NUM-PMAX        TO WSS-GLS-4RNG IN WSS-VARI
               MOVE WSS-GLS-MRNG IN WSS-VARI TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE -1 TO OPD-NUM-DURV-LEN IN OPD-FLD
               MOVE 'S' TO FRM-UCUR
               GO TO FIN-VAL-CON-FLD-OPD.

           IF SCR-CMND = 'ODL' OR 'ODB' OR 'MDA'
               IF ( FRM-CAI-ICAD IN OPD-FLD > SPACES OR
                    FRM-IIC-ICAD IN OPD-FLD > ZEROES ) AND
                    OPD-COD-CUST IN OPD-FLD = SCR-SON-N
                    MOVE 'DAP'          TO MSG-COD-SIST
                    MOVE 'CODCUSTABONO' TO MSG-COD-MENS
                    PERFORM GET-MSG
                    MOVE MSG-GLS-DESC TO FRM-MENS
                    MOVE FRM-SUAR-MAL TO FRM-SUAR
                    GO TO FIN-VAL-CON-FLD-OPD.

      *JCT-INI 09-JUL-2012 DPM FUNCIONALIDAD DOF OPERACIONES>450UF

           PERFORM VAL-FUN-DOF.

      *JCT-FIN 09-JUL-2012
       FIN-VAL-CON-FLD-OPD.
           EXIT.
       
       VAL-CON-OPD SECTION.
       INI-VAL-CON-OPD.
       FIN-VAL-CON-OPD.
           EXIT.
       
       VAL-NUM-KEY-OPD SECTION.
       INI-VAL-NUM-KEY-OPD.
           PERFORM VAL-NUM-IKY-OPD.
           PERFORM VAL-NUM-MKY-OPD.
           PERFORM VAL-NUM-AKY-OPD.
       FIN-VAL-NUM-KEY-OPD.
           EXIT.
       
       VAL-NUM-IKY-OPD SECTION.
       INI-VAL-NUM-IKY-OPD.
       VAL-NUM-OPD-IIC-IOPD.
           MOVE OPD-IIC-IOPD-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 8 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9N TO OPD-IIC-IOPD IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO OPD-IIC-IOPD-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-IKY-OPD.
       FIN-VAL-NUM-IKY-OPD.
           EXIT.
       
       VAL-NUM-MKY-OPD SECTION.
       INI-VAL-NUM-MKY-OPD.
       VAL-NUM-OPD-IIC-ISER.
           MOVE OPD-IIC-ISER-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 8 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9N TO OPD-IIC-ISER IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO OPD-IIC-ISER-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-MKY-OPD.
      * IDC-INI --> BMCHIBCI010.SRCAIU VALIDACION NUMERICA
       VAL-NUM-DBC-NUM-ICLI.
           MOVE DBC-NUM-ICLI-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 8 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9N TO DBC-NUM-ICLI IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO DBC-NUM-ICLI-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-MKY-OPD.
      * IDC-FIN --> BMCHIBCI010.SRCAIU VALIDACION NUMERICA
       FIN-VAL-NUM-MKY-OPD.
           EXIT.
       
       VAL-NUM-AKY-OPD SECTION.
       INI-VAL-NUM-AKY-OPD.
       FIN-VAL-NUM-AKY-OPD.
           EXIT.
       
       VAL-NUM-FLD-OPD SECTION.
       INI-VAL-NUM-FLD-OPD.
      *<<<< INI_VAL_NUM_FLD_OPD
      * ISP: ASUME RENUEVA TODO
           MOVE 'NADA' TO WSS-SW-RRDL.
           IF SCR-CMND = 'RDL' OR 'RLR'
      *         IF OPD-COD-RENO IN OPD NOT = SCR-SON-S
      *             MOVE SPACES TO OPD-SGV-MPRE-ALF IN OPD-FLD
      *             MOVE 'TODO' TO WSS-SW-RRDL
      *         ELSE
               IF OPD-SGV-MPRE-ALF IN OPD-FLD = 'I'
                   MOVE SPACES TO OPD-SGV-MPRE-ALF IN OPD-FLD
                   MOVE 'INTE' TO WSS-SW-RRDL
               ELSE
               IF OPD-SGV-MPRE-ALF IN OPD-FLD = 'T'
                   MOVE SPACES TO OPD-SGV-MPRE-ALF IN OPD-FLD
                   MOVE 'TODO' TO WSS-SW-RRDL.
      *>>>> INI_VAL_NUM_FLD_OPD
       VAL-NUM-FRM-VAL-IPES.
           MOVE FRM-VAL-IPES-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 11 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9N TO FRM-VAL-IPES IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO FRM-VAL-IPES-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       VAL-NUM-OPD-NUM-PVEN.
           MOVE OPD-NUM-PVEN-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 4 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9N TO OPD-NUM-PVEN IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO OPD-NUM-PVEN-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       VAL-NUM-OPD-VAL-CAPT.
           MOVE OPD-VAL-CAPT-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 11 TO NUM-NENT.
           MOVE 4 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9V TO OPD-VAL-CAPT IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO OPD-VAL-CAPT-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       VAL-NUM-OPD-SGV-TINT.
           MOVE OPD-SGV-TINT-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-S TO NUM-SGNO.
           MOVE 2 TO NUM-NENT.
           MOVE 4 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NS9V TO OPD-SGV-TINT IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO OPD-SGV-TINT-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       VAL-NUM-FRM-VAL-FORI.
           MOVE FRM-VAL-FORI-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 11 TO NUM-NENT.
           MOVE 4 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9V TO FRM-VAL-FORI IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO FRM-VAL-FORI-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       VAL-NUM-OPD-NUM-DURV.
           MOVE OPD-NUM-DURV-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 4 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9N TO OPD-NUM-DURV IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO OPD-NUM-DURV-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       VAL-NUM-FRM-NUM-TVEN.
           MOVE FRM-NUM-TVEN-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 3 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9N TO FRM-NUM-TVEN IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO FRM-NUM-TVEN-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       VAL-NUM-OPD-NUM-SEVE.
           MOVE OPD-NUM-SEVE-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 3 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9N TO OPD-NUM-SEVE IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO OPD-NUM-SEVE-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       VAL-NUM-OPD-SGV-MPRE.
           MOVE OPD-SGV-MPRE-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-S TO NUM-SGNO.
           MOVE 11 TO NUM-NENT.
           MOVE 4 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NS9V TO OPD-SGV-MPRE IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO OPD-SGV-MPRE-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       VAL-NUM-OPD-NUM-RETD.
           MOVE OPD-NUM-RETD-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 2 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9N TO OPD-NUM-RETD IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO OPD-NUM-RETD-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       VAL-NUM-RCC-NUM-DIRE.
           MOVE RCC-NUM-DIRE-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 4 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9N TO RCC-NUM-DIRE IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO RCC-NUM-DIRE-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       VAL-NUM-CAD-IIC-ICAD.
           MOVE CAD-IIC-ICAD-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 8 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9N TO CAD-IIC-ICAD IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO CAD-IIC-ICAD-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       VAL-NUM-FRM-IIC-ICAD.
           MOVE FRM-IIC-ICAD-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 8 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9N TO FRM-IIC-ICAD IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO FRM-IIC-ICAD-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       VAL-NUM-FRM-NUM-TOPE.
           MOVE FRM-NUM-TOPE-ALF IN OPD-FLD TO NUM-NUME.
           MOVE NUM-ZERO-S TO NUM-ZERO.
           MOVE NUM-SGNO-N TO NUM-SGNO.
           MOVE 3 TO NUM-NENT.
           MOVE 0 TO NUM-NDCM.
           PERFORM VAL-NUM.
           IF NUM-STAT-OKS
                MOVE NUM-NN9N TO FRM-NUM-TOPE IN OPD-FLD
           ELSE
                MOVE NUM-MENS     TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR
                MOVE -9 TO FRM-NUM-TOPE-LEN IN OPD-FLD
                GO TO FIN-VAL-NUM-FLD-OPD.
       FIN-VAL-NUM-FLD-OPD.
           EXIT.
       
       EDT-KEY-OPD SECTION.
       INI-EDT-KEY-OPD.
           PERFORM EDT-IKY-OPD.
           PERFORM EDT-MKY-OPD.
           PERFORM EDT-AKY-OPD.
       FIN-EDT-KEY-OPD.
           EXIT.
       
       EDT-IKY-OPD SECTION.
       INI-EDT-IKY-OPD.
           IF OPD-IIC-IOPD-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO OPD-IIC-IOPD-LEN IN OPD-FLD
                GO TO FIN-EDT-IKY-OPD.
           MOVE OPD-IIC-IOPD IN OPD-FLD TO OPD-IIC-IOPD-EDT IN OPD-EDT.
           MOVE OPD-IIC-IOPD-EDT IN OPD-EDT TO 
                OPD-IIC-IOPD-ALF IN OPD-FLD.
       FIN-EDT-IKY-OPD.
           EXIT.
       
       EDT-MKY-OPD SECTION.
       INI-EDT-MKY-OPD.
           IF OPD-IIC-ISER-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO OPD-IIC-ISER-LEN IN OPD-FLD
                GO TO FIN-EDT-MKY-OPD.
           MOVE OPD-IIC-ISER IN OPD-FLD TO OPD-IIC-ISER-EDT IN OPD-EDT.
           MOVE OPD-IIC-ISER-EDT IN OPD-EDT TO 
                OPD-IIC-ISER-ALF IN OPD-FLD.
      * IDC-INI --> BMCHIBCI011.SRCAIU EDICION NUMERICA
           IF DBC-NUM-ICLI-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO DBC-NUM-ICLI-LEN IN OPD-FLD
                GO TO FIN-EDT-MKY-OPD.
           MOVE DBC-NUM-ICLI IN OPD-FLD TO
                DBC-NUM-ICLI-EDT IN OPD-EDT.
           MOVE DBC-NUM-ICLI-EDT IN OPD-EDT TO
                DBC-NUM-ICLI-ALF IN OPD-FLD.
      * IDC-FIN --> BMCHIBCI011.SRCAIU EDICION NUMERICA
       FIN-EDT-MKY-OPD.
           EXIT.
       
       EDT-AKY-OPD SECTION.
       INI-EDT-AKY-OPD.
       FIN-EDT-AKY-OPD.
           EXIT.
       
       EDT-FLD-OPD SECTION.
       INI-EDT-FLD-OPD.
           IF FRM-VAL-IPES-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO FRM-VAL-IPES-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE FRM-VAL-IPES IN OPD-FLD TO FRM-VAL-IPES-EDT IN OPD-EDT.
           MOVE FRM-VAL-IPES-EDT IN OPD-EDT TO 
                FRM-VAL-IPES-ALF IN OPD-FLD.
           IF OPD-NUM-PVEN-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO OPD-NUM-PVEN-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE OPD-NUM-PVEN IN OPD-FLD TO OPD-NUM-PVEN-EDT IN OPD-EDT.
           MOVE OPD-NUM-PVEN-EDT IN OPD-EDT TO 
                OPD-NUM-PVEN-ALF IN OPD-FLD.
           IF OPD-VAL-CAPT-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO OPD-VAL-CAPT-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE OPD-VAL-CAPT IN OPD-FLD TO OPD-VAL-CAPT-EDT IN OPD-EDT.
           MOVE OPD-VAL-CAPT-EDT IN OPD-EDT TO 
                OPD-VAL-CAPT-ALF IN OPD-FLD.
           IF OPD-SGV-TINT-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO OPD-SGV-TINT-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE OPD-SGV-TINT IN OPD-FLD TO OPD-SGV-TINT-EDT IN OPD-EDT.
           MOVE OPD-SGV-TINT-EDT IN OPD-EDT TO 
                OPD-SGV-TINT-ALF IN OPD-FLD.
           IF FRM-VAL-FORI-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO FRM-VAL-FORI-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE FRM-VAL-FORI IN OPD-FLD TO FRM-VAL-FORI-EDT IN OPD-EDT.
           MOVE FRM-VAL-FORI-EDT IN OPD-EDT TO 
                FRM-VAL-FORI-ALF IN OPD-FLD.
           IF OPD-NUM-DURV-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO OPD-NUM-DURV-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE OPD-NUM-DURV IN OPD-FLD TO OPD-NUM-DURV-EDT IN OPD-EDT.
           MOVE OPD-NUM-DURV-EDT IN OPD-EDT TO 
                OPD-NUM-DURV-ALF IN OPD-FLD.
           IF FRM-NUM-TVEN-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO FRM-NUM-TVEN-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE FRM-NUM-TVEN IN OPD-FLD TO FRM-NUM-TVEN-EDT IN OPD-EDT.
           MOVE FRM-NUM-TVEN-EDT IN OPD-EDT TO 
                FRM-NUM-TVEN-ALF IN OPD-FLD.
           IF OPD-NUM-SEVE-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO OPD-NUM-SEVE-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE OPD-NUM-SEVE IN OPD-FLD TO OPD-NUM-SEVE-EDT IN OPD-EDT.
           MOVE OPD-NUM-SEVE-EDT IN OPD-EDT TO 
                OPD-NUM-SEVE-ALF IN OPD-FLD.
           IF OPD-SGV-MPRE-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO OPD-SGV-MPRE-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE OPD-SGV-MPRE IN OPD-FLD TO OPD-SGV-MPRE-EDT IN OPD-EDT.
           MOVE OPD-SGV-MPRE-EDT IN OPD-EDT TO 
                OPD-SGV-MPRE-ALF IN OPD-FLD.
           IF OPD-NUM-RETD-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO OPD-NUM-RETD-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE OPD-NUM-RETD IN OPD-FLD TO OPD-NUM-RETD-EDT IN OPD-EDT.
           MOVE OPD-NUM-RETD-EDT IN OPD-EDT TO 
                OPD-NUM-RETD-ALF IN OPD-FLD.
           IF RCC-NUM-DIRE-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO RCC-NUM-DIRE-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE RCC-NUM-DIRE IN OPD-FLD TO RCC-NUM-DIRE-EDT IN OPD-EDT.
           MOVE RCC-NUM-DIRE-EDT IN OPD-EDT TO 
                RCC-NUM-DIRE-ALF IN OPD-FLD.
           IF CAD-IIC-ICAD-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO CAD-IIC-ICAD-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE CAD-IIC-ICAD IN OPD-FLD TO CAD-IIC-ICAD-EDT IN OPD-EDT.
           MOVE CAD-IIC-ICAD-EDT IN OPD-EDT TO 
                CAD-IIC-ICAD-ALF IN OPD-FLD.
           IF FRM-IIC-ICAD-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO FRM-IIC-ICAD-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE FRM-IIC-ICAD IN OPD-FLD TO FRM-IIC-ICAD-EDT IN OPD-EDT.
           MOVE FRM-IIC-ICAD-EDT IN OPD-EDT TO 
                FRM-IIC-ICAD-ALF IN OPD-FLD.
           IF FRM-NUM-TOPE-LEN IN OPD-FLD = FRM-ERR-NUME
                MOVE FRM-IND-ERRO TO FRM-NUM-TOPE-LEN IN OPD-FLD
                GO TO FIN-EDT-FLD-OPD.
           MOVE FRM-NUM-TOPE IN OPD-FLD TO FRM-NUM-TOPE-EDT IN OPD-EDT.
           MOVE FRM-NUM-TOPE-EDT IN OPD-EDT TO 
                FRM-NUM-TOPE-ALF IN OPD-FLD.
       FIN-EDT-FLD-OPD.
           EXIT.
      *<<<< EOF_BU
       AJUSTA-INTE SECTION.
       INI-AJUSTA-INTE.
           IF SCR-CIC-TVAL = PDB-CIC-MEXT
              MOVE SCR-CIC-VCAM TO PES-CIC-VCAM.
           MOVE WSS-SGV-RDL-INTE-PESO TO PES-SGV-DECI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE TO WSS-SGV-RDL-INTE-PESO.
       FIN-AJUSTA-INTE.
           EXIT.

       AJUSTA-TODO SECTION.
       INI-AJUSTA-TODO.
           IF SCR-CIC-TVAL = PDB-CIC-MEXT
              MOVE SCR-CIC-VCAM TO PES-CIC-VCAM.
           MOVE WSS-SGV-RDL-TODO-PESO TO PES-SGV-DECI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE TO WSS-SGV-RDL-TODO-PESO.
       FIN-AJUSTA-TODO.
           EXIT.

       VAL-DURV-PMIN SECTION.
       INI-VAL-DURV-PMIN.

           MOVE SPACES TO MSG-COD-MENS.
      * ISP : 01011991 + PERIODO DE POD
           MOVE POD-IND-PMIN IN POD TO MSC-COD-CMSC IN MSC.
           PERFORM OBT-CIC-PER.

           MOVE '01011991' TO FEC-FECH.
           MOVE POD-NUM-PMIN IN POD TO WSS-NUM-PER
           PERFORM SEL-PER.
           MOVE FEC-ITM1 TO WSS-NUM-DUNO.
           MOVE FEC-ITM2 TO WSS-NUM-MUNO.
           MOVE FEC-ITM3 TO WSS-NUM-SUNO.
           MOVE FEC-ITM4 TO WSS-NUM-AUNO.

      * ISP : 01011991 + PERIODO PRIMER VENCIMIENTO OPD
      *       ( TAL VEZ WSS-IND-PVEN LO OBTUBO
           IF WSS-IND-PVEN > SPACES
               MOVE WSS-IND-PVEN TO WSS-CIC-PER
           ELSE
               MOVE OPD-IND-PVEN IN OPD-FLD TO MSC-COD-CMSC IN MSC
               PERFORM OBT-CIC-PER.

           MOVE '01011991' TO FEC-FECH.
           MOVE OPD-NUM-PVEN IN OPD-FLD TO WSS-NUM-PER.
           PERFORM SEL-PER.
           MOVE FEC-ITM1 TO WSS-NUM-DDOS.
           MOVE FEC-ITM2 TO WSS-NUM-MDOS.
           MOVE FEC-ITM3 TO WSS-NUM-SDOS.
           MOVE FEC-ITM4 TO WSS-NUM-ADOS.

           IF WSS-FEC-FUNO > WSS-FEC-FDOS
                MOVE 'DAP' TO MSG-COD-SIST
                MOVE 'FPVC< PERPOD' TO MSG-COD-MENS
                PERFORM GET-MSG
                MOVE MSG-GLS-DESC TO FRM-MENS
                MOVE FRM-SUAR-MAL TO FRM-SUAR.
       FIN-VAL-DURV-PMIN.
           EXIT.

      * validacion calendario de vencimientos
       VAL-CLD-VEN SECTION.
       INI-VAL-CLD-VEN.
           MOVE SPACES TO MSG-COD-MENS.
           PERFORM CAL-FEC-FTER.
           IF MSG-COD-MENS > SPACES
               GO TO FIN-VAL-CLD-VEN.
           IF SCR-CMND NOT = 'RDL' AND
              SCR-CMND NOT = 'RLR'
               PERFORM CAL-PER-DURV
               IF MSG-COD-MENS > SPACES
                   GO TO FIN-VAL-CLD-VEN.
       FIN-VAL-CLD-VEN.
           EXIT.

      * calcula fecha termino
       CAL-FEC-FTER SECTION.
       INI-CAL-FEC-FTER.
      *    FEC-FTER = SEVE * ( TVEN - 1 ) + FEC-PVEN
           SUBTRACT 1 FROM FRM-NUM-TVEN IN OPD-FLD GIVING WSS-TVEN-1.
           MULTIPLY WSS-TVEN-1 BY OPD-NUM-SEVE IN OPD-FLD 
               GIVING WSS-DURV-1.
           MOVE OPD-IND-SEVE IN OPD-FLD TO MSC-COD-CMSC IN MSC.
           PERFORM OBT-CIC-PER.
      *    EN WSS-CIC-PER.
           MOVE WSS-DURV-1 TO WSS-NUM-PER.
           MOVE OPD-FEC-FPVC IN OPD-FLD TO FEC-FECH.
           PERFORM SEL-PER.

       CIC-FTER-HABIL.
           IF SCR-CIC-MORE = 'PI'
               MOVE FEC-FORM-FEC TO FEC-FORM
               MOVE FEC-FBLK-N   TO FEC-FBLK
               MOVE FEC-CHOY-N   TO FEC-CHOY
               MOVE FEC-VHBL-S   TO FEC-VHBL
               MOVE FEC-VAL-FEC  TO FEC-CMND
               PERFORM PRO-FEC
               IF NOT FEC-STAT-HBL
                   MOVE FEC-FORM-FEC TO FEC-FORM
                   MOVE FEC-SUM-DIA  TO FEC-CMND
                   MOVE 1            TO FEC-NDIA
                   PERFORM CAL-FEC
                   GO TO CIC-FTER-HABIL.


           MOVE FEC-ITM1 TO WSS-NUM-DTER.
           MOVE FEC-ITM2 TO WSS-NUM-MTER.
           MOVE FEC-ITM3 TO WSS-NUM-STER.
           MOVE FEC-ITM4 TO WSS-NUM-ATER.
           IF OPD-FEC-FTER IN OPD-FLD NOT > ZEROES
               MOVE WSS-FEC-FTER TO OPD-FEC-FTER IN OPD-FLD
           ELSE
           IF OPD-FEC-FTER IN OPD-FLD NOT = WSS-FEC-FTER
      * ICU :  INCONSISTENCIA ENTRE
      *        PER SEP VCTOS / TOTAL VCTOS / FEC PRIMER VCTO /
      *        FECHA TERMINO 
               MOVE 'SV TV FPV FT' TO MSG-COD-MENS.
       FIN-CAL-FEC-FTER.
           EXIT.

      * calcula periodo duracion vctos en dias
       CAL-PER-DURV SECTION.
       INI-CAL-PER-DURV.
      *    PER-DURV (DIAS) = FEC-FREA - FEC-FTER 
           IF OPD-NUM-DURV IN OPD-FLD > ZEROES
               MOVE OPD-IND-DURV IN OPD-FLD TO MSC-COD-CMSC IN MSC
               PERFORM OBT-CIC-PER
      *        EN WSS-CIC-PER
               MOVE OPD-NUM-DURV IN OPD-FLD TO WSS-NUM-PER
               MOVE OPD-FEC-FREA IN OPD-FLD TO FEC-FECH
               PERFORM SEL-PER
               MOVE FEC-ITM1 TO WSS-NUM-DTER
               MOVE FEC-ITM2 TO WSS-NUM-MTER
               MOVE FEC-ITM3 TO WSS-NUM-STER
               MOVE FEC-ITM4 TO WSS-NUM-ATER
               IF WSS-FEC-FTER NOT = OPD-FEC-FTER IN OPD-FLD
      * ICU :      INCONSISTENCIA ENTRE 
      *            FEC EMISION / FEC TERMINO / PER DURACION VCTOS 
                   MOVE 'FRE FTE DV' TO MSG-COD-MENS
                   GO TO FIN-CAL-PER-DURV.

      * DURV = OPD-FEC-FTER - OPD-FEC-FREA
      * OBTIENE PERIODO TOTAL VENCIMIENTOS A PARTIR DE 
      * FECHA EMISION Y FECHA TERMINO
           MOVE FEC-DIF-DIA             TO FEC-CMND.
           MOVE FEC-FORM-FEC            TO FEC-FORM.
           MOVE OPD-FEC-FREA IN OPD-FLD TO FEC-FEC1.
           MOVE OPD-FEC-FTER IN OPD-FLD TO FEC-FEC2.
           PERFORM CAL-FEC.
           MOVE FEC-NDIA TO OPD-NUM-DURV IN OPD-FLD.
           MOVE 'D' TO OPD-IND-DURV IN OPD-FLD.
       FIN-CAL-PER-DURV.
           EXIT.

      * validacion plazo total vctos contra pod
      * todos los periodos (PMIN, PMAX, DURV) en dias
       VAL-DURV-POD SECTION.
       INI-VAL-DURV-POD.
           MOVE SPACES TO MSG-COD-MENS.

           MOVE POD-IND-PMIN IN POD TO MSC-COD-CMSC.
           PERFORM OBT-CIC-PER.
           MOVE WSS-CIC-PER TO WSS-IND-PMIN.

           MOVE POD-IND-PMAX IN POD TO MSC-COD-CMSC.
           PERFORM OBT-CIC-PER.
           MOVE WSS-CIC-PER TO WSS-IND-PMAX.

           MOVE OPD-IND-DURV IN OPD-FLD TO MSC-COD-CMSC.
           PERFORM OBT-CIC-PER.
           MOVE WSS-CIC-PER TO WSS-IND-DURV.

           IF ( WSS-IND-PMIN = 'D' OR 'M' OR 'A' ) AND
              ( WSS-IND-PMAX = 'D' OR 'M' OR 'A' ) AND
              ( WSS-IND-DURV = 'D' OR 'M' OR 'A' )
               NEXT SENTENCE
           ELSE
               GO TO FIN-VAL-DURV-POD.
           
           IF WSS-IND-PMIN = 'M'
               MOVE 30 TO WSS-FACT
           ELSE
           IF WSS-IND-PMIN = 'A'
               MOVE 365 TO WSS-FACT
           ELSE
               MOVE 1 TO WSS-FACT.
           MULTIPLY POD-NUM-PMIN IN POD BY WSS-FACT 
               GIVING WSS-NUM-PMIN.

           IF WSS-IND-PMAX = 'M'
               MOVE 30 TO WSS-FACT
           ELSE
           IF WSS-IND-PMAX = 'A'
               MOVE 365 TO WSS-FACT
           ELSE
               MOVE 1 TO WSS-FACT.
           MULTIPLY POD-NUM-PMAX IN POD BY WSS-FACT 
               GIVING WSS-NUM-PMAX.

           IF WSS-IND-DURV = 'M'
               MOVE 30 TO WSS-FACT
           ELSE
           IF WSS-IND-DURV = 'A'
               MOVE 365 TO WSS-FACT
           ELSE
               MOVE 1 TO WSS-FACT.
           MULTIPLY OPD-NUM-DURV IN OPD-FLD BY WSS-FACT 
               GIVING WSS-NUM-DURV.


            IF SCR-CMND NOT = 'RDL' AND
               SCR-CMND NOT = 'RLR'

           IF WSS-NUM-DURV < WSS-NUM-PMIN OR
              WSS-NUM-DURV > WSS-NUM-PMAX
      *        plazo total vctos. fuera de rango
               MOVE 'DURV    FRNG' TO MSG-COD-MENS.
       FIN-VAL-DURV-POD.
           EXIT.

       CAL-CAP-INT SECTION.
       INI-CAL-CAP-INT.

           MOVE ZEROES TO SCR-IDNI.
           MOVE SPACES TO MSG-COD-MENS.

           IF SCR-CIC-MORE = 'N'
               MOVE WSS-VAL-CAPI TO SCR-CAPI
               MULTIPLY WSS-VAL-CAPI BY INT-TIPE GIVING SCR-INTE
                        ROUNDED
           ELSE
           IF SCR-CIC-MORE = 'PI'
               MOVE ZEROES TO SCR-CAPI
      * ISP: CALCULO 100% INTERESES
               MULTIPLY WSS-VAL-CAPI BY INT-TIPE GIVING SCR-INTE
                        ROUNDED
               MOVE SCR-INTE TO SCR-IDNI
               MULTIPLY SCR-INTE BY OPD-SGV-MPRE IN OPD-FLD 
                   GIVING SCR-INTE ROUNDED

               DIVIDE SCR-INTE BY 100 GIVING SCR-INTE ROUNDED
               SUBTRACT SCR-INTE FROM SCR-IDNI GIVING
                                      SCR-IDNI
           ELSE
           IF SCR-CIC-MORE = 'PC'
               MULTIPLY WSS-VAL-CAPI BY INT-TIPE GIVING SCR-INTE
                        ROUNDED
               MULTIPLY WSS-VAL-CAPI BY OPD-SGV-MPRE IN OPD-FLD 
                   GIVING SCR-CAPI ROUNDED
               DIVIDE SCR-CAPI BY 100 GIVING SCR-CAPI ROUNDED
           ELSE
           IF SCR-CIC-MORE = 'MC'
               MULTIPLY WSS-VAL-CAPI BY INT-TIPE GIVING SCR-INTE
                     ROUNDED
               MOVE OPD-SGV-MPRE IN OPD-FLD TO SCR-CAPI
           ELSE
           IF SCR-CIC-MORE = 'CO'
               IF FRM-NUM-TVEN IN OPD-FLD NOT > ZEROES
                   MOVE 'NUMTVENNOZER' TO MSG-COD-MENS
                   GO TO FIN-CAL-CAP-INT
               ELSE
                   MULTIPLY WSS-VAL-CAPI BY INT-TIPE GIVING SCR-INTE
                    ROUNDED
                   DIVIDE   WSS-VAL-CAPI BY FRM-NUM-TVEN IN OPD-FLD 
                      GIVING SCR-CAPI ROUNDED
                   DIVIDE   WSS-VAL-CAPI BY FRM-NUM-TVEN IN OPD-FLD 
                      GIVING OPD-SGV-MPRE IN OPD-FLD ROUNDED
           ELSE
           IF SCR-CIC-MORE = 'FO'
               IF FRM-NUM-TVEN IN OPD-FLD NOT > ZEROES
                   MOVE 'TVEN<>CERO' TO MSG-COD-MENS
                   GO TO FIN-CAL-CAP-INT
               ELSE
                   PERFORM PRO-VFIN-FO
                   IF INT-CMSG > SPACES
                       GO TO FIN-CAL-CAP-INT
                   ELSE
                       MOVE CVI-VCAP TO SCR-CAPI
                       SUBTRACT CVI-VCAP FROM CVI-VFIN GIVING
                                SCR-INTE
                       MOVE CVI-VFIN TO OPD-SGV-MPRE IN OPD-FLD.
       FIN-CAL-CAP-INT.
           EXIT.

       BUS-TRM-DIA SECTION.
       INI-BUS-TRM-DIA.
           IF WSS-NDIA IN WSS-VARI NOT > 
              PTD-NUM-DIAS IN PTD(FRM-IFLD)
               MOVE FRM-IFLD TO WSS-TRM-DIA
               MOVE 'S' TO WSS-IND-TDIA.
       FIN-BUS-TRM-DIA.
           EXIT.

       BUS-TRM-MTO SECTION.
       INI-BUS-TRM-MTO.
           IF PTD-VAL-MNTO IN PTD(FRM-IFLD) > ZEROES
               IF OPD-VAL-CAPT IN OPD-FLD NOT <
                   PTD-VAL-MNTO IN PTD(FRM-IFLD)
                   MOVE FRM-IFLD TO WSS-TRM-MTO
                   MOVE 'S' TO WSS-IND-TMTO.
       FIN-BUS-TRM-MTO.
           EXIT.

       OBT-NUM-PVEN SECTION.
       INI-OBT-NUM-PVEN.
      * ISP: OBTIENE PERIODO PRIMER VENCIMIENTO A PARTIR DE FECHA
      *      PRIMER VENCIMIENTO
      *ISP : CUANDO OCURRE LA SGTE CONDICION EL PERIDOD
      *      PRIMER VCTO YA FUE FIJADO
           IF POD-NUM-SMNV IN POD = POD-NUM-SMXV IN POD AND
              POD-IND-SMNV IN POD = POD-IND-SMXV IN POD AND
              POD-NUM-SMNV IN POD NOT = ZEROES
                 GO TO FIN-OBT-NUM-PVEN.


           MOVE FEC-DIF-DIA             TO FEC-CMND.
           MOVE FEC-FORM-FEC            TO FEC-FORM.
           MOVE OPD-FEC-FREA IN OPD-FLD TO FEC-FEC1.
           MOVE OPD-FEC-FPVC IN OPD-FLD TO FEC-FEC2.
           PERFORM CAL-FEC.
           MOVE FEC-NDIA TO OPD-NUM-PVEN IN OPD-FLD.
           IF OPD-NUM-PVEN IN OPD-FLD NOT > ZEROES
               MOVE SPACES TO OPD-IND-PVEN IN OPD-FLD
               GO TO FIN-OBT-NUM-PVEN.
           MOVE 'D' TO OPD-IND-PVEN IN OPD-FLD.
      * ISP: ULTIMO VCTO ASUME PRIMER VCTO
      * ISP:  5-SEP-1991 SE PUSO COMENTARIOS 5-SEP-1991
      *     MOVE OPD-NUM-PVEN IN OPD-FLD TO
      *          OPD-NUM-DURV IN OPD-FLD.
      *     MOVE OPD-IND-PVEN IN OPD-FLD TO
      *          OPD-IND-DURV IN OPD-FLD.
           PERFORM VAL-OPD-IND-PVEN.
       FIN-OBT-NUM-PVEN.
           EXIT.

       OBT-CIC-PER SECTION.
       INI-OBT-CIC-PER.
      * ISP: OBTIENE CIC DE UN CODIGO DE PERIODO CARGADO EN MSC-COD-CMSC
      *      Y LO ENTREGA EN WSS-CIC-PER
           MOVE 'TAB'                   TO MSC-COD-SIST.
           MOVE 'IPER'                  TO MSC-COD-TMSC IN MSC.
           PERFORM BUS-MSC.
           MOVE MSC-CIC-CMSC IN MSC     TO WSS-CIC-PER.
       FIN-OBT-CIC-PER.
           EXIT.

       SEL-PER SECTION.
       INI-SEL-PER.
      * ISP: OBTIENE EN FEC-FECH LA SUMA DE UNA FECHA
      * ISP: CARGADA EN FEC-FECH
      *      + UN PERIODO ( WSS-CIC-PER Y WSS-NUM-PER )
           IF WSS-CIC-PER = 'D'
               MOVE FEC-SUM-DIA TO FEC-CMND
               MOVE WSS-NUM-PER TO FEC-NDIA
           ELSE
           IF WSS-CIC-PER = 'M'
               MOVE FEC-SUM-MES TO FEC-CMND
               MOVE WSS-NUM-PER TO FEC-NMES
           ELSE
           IF WSS-CIC-PER = 'A'
               MOVE FEC-SUM-ANO TO FEC-CMND
               MOVE WSS-NUM-PER TO FEC-NANO.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           PERFORM CAL-FEC.
       FIN-SEL-PER.
           EXIT.

       BUS-PTD SECTION.
       INI-BUS-PTD.
      *    obtener ptd mas actual y vigente
      *    acceso a ptd con VCAM de la pantalla
      * ISP: PARA OPERACIONES ANTERIORES LAS BUSCA CON LLAVE PTD
      *      FREA + HORA ( COMPUTACIONAL O 235959 )
           MOVE OPD-COD-VCAM IN OPD-FLD TO PTD-COD-VCAM IN PTD.
           MOVE SPACES                  TO PTD-COD-OFIC IN PTD.
           MOVE SPACES                  TO PTD-COD-TOPD IN PTD.
           MOVE SPACES                  TO PTD-COD-AOPD IN PTD.

           IF SCR-CMND = 'RDL'
               MOVE HOY-FHOY TO PTD-FEC-FPTD IN PTD
               MOVE HOY-HHOY TO PTD-HRA-HRPT IN PTD
           ELSE
               MOVE OPD-NUM-DREA IN OPD-FLD TO PTD-NUM-DPTD IN PTD
               MOVE OPD-NUM-MREA IN OPD-FLD TO PTD-NUM-MPTD IN PTD
               MOVE OPD-NUM-SREA IN OPD-FLD TO PTD-NUM-SPTD IN PTD
               MOVE OPD-NUM-AREA IN OPD-FLD TO PTD-NUM-APTD IN PTD
               IF OPD-FEC-FREA IN OPD-FLD = OPD-FEC-FCMP IN OPD-FLD
                        OR SCR-CNAL = '100'
                        OR SCR-CNAL = '110'
                   MOVE HOY-HHOY TO PTD-HRA-HRPT IN PTD
                ELSE
                   MOVE '140000' TO PTD-HRA-HRPT IN PTD.
      * ISP: DAPBG004
           PERFORM CMP-FEC-PTD.

           MOVE FIO-GET-NLS TO FIO-CMND.

       LUP-BUS-PTD.
           PERFORM DAP-FIO-PTD.
           IF NOT ( FIO-STAT-OKS AND
                    OPD-COD-VCAM IN OPD-FLD = PTD-COD-VCAM IN PTD )
      *        ptd inexistente
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'PTD    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-BUS-PTD.
           IF OPD-COD-MORE IN OPD-FLD = 'PI'
               IF NOT ( PTD-COD-STAT IN PTD = 'S'
                               AND
                        PTD-COD-TOPD IN PTD = OPD-COD-TOPD IN OPD-FLD
                               AND
                        PTD-COD-AOPD IN PTD = OPD-COD-AOPD IN OPD-FLD
                               AND
                        (
                        PTD-COD-OFIC IN PTD = OPD-COD-OFIC IN OPD-FLD
                                       OR
                        PTD-COD-OFIC IN PTD = '*'
                        )
                      )
                  MOVE FIO-GET-NXT TO FIO-CMND
                  GO TO LUP-BUS-PTD
               ELSE
                  NEXT SENTENCE
           ELSE
           IF NOT ( ( PTD-COD-STAT IN PTD = 'S' )
                    AND
                    ( PTD-COD-TOPD IN PTD = '*' OR
                      PTD-COD-TOPD IN PTD = OPD-COD-TOPD IN OPD-FLD )
                    AND
                    ( PTD-COD-AOPD IN PTD = '*' OR
                      PTD-COD-AOPD IN PTD = OPD-COD-AOPD IN OPD-FLD )
                    AND
                    ( PTD-COD-OFIC IN PTD = '*' OR
                      PTD-COD-OFIC IN PTD = OPD-COD-OFIC IN OPD-FLD ) )
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-BUS-PTD.

           PERFORM CMP-FEC-PTD.
           IF NOT ( SCR-CNAL = '100' OR '110' )
           IF ( SCR-CMND = 'RDL' OR 'ODL' ) AND
                HOY-FHOY NOT = PTD-FEC-FPTD IN PTD
                  MOVE 'DAP'        TO MSG-COD-SIST
                  MOVE 'PTD  NODIA' TO MSG-COD-MENS
                  PERFORM GET-MSG
                  MOVE MSG-GLS-DESC TO FRM-MENS
                  MOVE FRM-SUAR-MAL TO FRM-SUAR
                  IF OPD-COD-VCAM IN OPD-FLD = '0999' AND
                     OPD-COD-TOPD IN OPD-FLD = 'DPF'  AND
                    (OPD-COD-AOPD IN OPD-FLD = 'FRS' OR
                     OPD-COD-AOPD IN OPD-FLD = 'NRS')
                       MOVE 'PTDNRSNODIA' TO MSG-COD-MENS
                  ELSE
                  IF OPD-COD-VCAM IN OPD-FLD = '0999' AND
                     OPD-COD-TOPD IN OPD-FLD = 'DPF'  AND
                    (OPD-COD-AOPD IN OPD-FLD = 'FRN' OR
                     OPD-COD-AOPD IN OPD-FLD = 'NRN')
                       MOVE 'PTDNRNNODIA' TO MSG-COD-MENS
                  ELSE
                  IF OPD-COD-VCAM IN OPD-FLD = '0999' AND
                     OPD-COD-TOPD IN OPD-FLD = 'DPF'  AND
                     OPD-COD-AOPD IN OPD-FLD = 'ERN'
                       MOVE 'PTDERNNODIA' TO MSG-COD-MENS.

      *    ELSE
      *    IF ( SCR-CMND = 'RDL' OR 'ODL' ) AND
      *         OPD-COD-VCAM IN OPD-FLD = '0999' AND
      *         OPD-COD-TOPD IN OPD-FLD = 'DPF' AND
      *         OPD-COD-AOPD IN OPD-FLD = 'FRS' AND
      *         NOT
      *         (
      *         OPD-COD-VCAM IN OPD-FLD = PTD-COD-VCAM IN PTD AND
      *         OPD-COD-TOPD IN OPD-FLD = PTD-COD-TOPD IN PTD AND
      *         OPD-COD-AOPD IN OPD-FLD = PTD-COD-AOPD IN PTD
      *         )
      *           MOVE 'DAP'        TO MSG-COD-SIST
      *           MOVE 'PTDFRSNODIA' TO MSG-COD-MENS
      *           PERFORM GET-MSG
      *           MOVE MSG-GLS-DESC TO FRM-MENS
      *           MOVE FRM-SUAR-MAL TO FRM-SUAR
      *
      *    ELSE
      *    IF ( SCR-CMND = 'RDL' OR 'ODL' ) AND
      *         OPD-COD-VCAM IN OPD-FLD = '0999' AND
      *         OPD-COD-TOPD IN OPD-FLD = 'DPF' AND
      *         OPD-COD-AOPD IN OPD-FLD = 'FRN' AND
      *         NOT
      *         (
      *         OPD-COD-VCAM IN OPD-FLD = PTD-COD-VCAM IN PTD AND
      *         OPD-COD-TOPD IN OPD-FLD = PTD-COD-TOPD IN PTD AND
      *         OPD-COD-AOPD IN OPD-FLD = PTD-COD-AOPD IN PTD
      *         )
      *           MOVE 'DAP'        TO MSG-COD-SIST
      *           MOVE 'PTDFRNNODIA' TO MSG-COD-MENS
      *           PERFORM GET-MSG
      *           MOVE MSG-GLS-DESC TO FRM-MENS
      *           MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *

           PERFORM CMP-FEC-PTD.
       FIN-BUS-PTD.
           EXIT.

       PUT-DBC-OPD SECTION.
       INI-PUT-DBC-OPD.
      *<<<< INI_PUT_DBC_OPD
           IF SCR-IND-MCLI = 'M'
               MOVE ZEROES TO RCC-NUM-DIRE IN OPD-FLD
               MOVE ZEROES TO DBC-NUM-ICLI IN OPD-FLD
               MOVE SPACES TO DBC-VRF-ICLI IN OPD-FLD
               MOVE SPACES TO DBC-GLS-ICLI IN OPD-FLD
      *        OPD con multiples clientes
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'OPD    MCLI' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE 'M' TO DBC-IND-ICLI IN OPD-FLD 
               MOVE MSG-GLS-DESC TO DBC-GLS-NOMC IN OPD-FLD
               GO TO FIN-PUT-DBC-OPD.

           IF SCR-IND-MCLI NOT = 'M'
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC.
      *>>>>
           IF PGM-STAT-DBC-NUL
               GO TO FIN-PUT-DBC-OPD.
           IF NOT PGM-STAT-DBC-OKS
               PERFORM CLR-DBC-OPD
               GO TO FIN-PUT-DBC-OPD.
           MOVE DBC-GLS-NOMC IN DBC TO DBC-GLS-NOMC IN OPD-FLD.
           MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN OPD-FLD.
           MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN OPD-FLD.
           MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN OPD-FLD.
           MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN OPD-FLD.
       FIN-PUT-DBC-OPD.
           EXIT.
       
       VAL-CTA SECTION.
       INI-VAL-CTA.
      * OPTIMIZAR CON MANEJO DE STATUS A TRAVES DE MSG-COD-MENS
           IF WSS-IND-CTA NOT > SPACES
               MOVE SPACES TO CAD-CAI-ICAD IN OPD-FLD
               MOVE ZEROES TO CAD-IIC-ICAD IN OPD-FLD
               GO TO FIN-VAL-CTA.

      * ISP: NO PUEDE HABER CARGO CTA SI MONEX
           IF SCR-CIC-TVAL NOT = PDB-CIC-MNAC
               MOVE 'DAP'          TO MSG-COD-SIST
               MOVE 'CADCCTEMEXT' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE -1 TO CAD-CAI-ICAD-LEN IN OPD-FLD 
               MOVE 'S' TO FRM-UCUR
               GO TO FIN-VAL-CTA.

           IF CAD-IIC-ICAD IN OPD-FLD NOT > ZEROES
               MOVE 'DAP'            TO MSG-COD-SIST
               MOVE 'IICICADCCOBL'   TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE -1 TO CAD-CAI-ICAD-LEN IN OPD-FLD 
               MOVE 'S' TO FRM-UCUR
               GO TO FIN-VAL-CTA.

           IF DBC-IND-ICLI IN OPD-FLD = 'M'
               GO TO FIN-VAL-CTA.

           MOVE DBC-CIC-ICLI IN DBC     TO RCO-CIC-ICLI IN RCO.
           MOVE CAD-CAI-ICAD IN OPD-FLD TO RCO-CAI-IOPE IN RCO.
           MOVE CAD-IIC-ICAD IN OPD-FLD TO RCO-IIC-IOPE IN RCO.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF FIO-STAT-OKS
               IF WSS-IND-MUOC = 'O'
                   MOVE 'DAP'          TO MSG-COD-SIST
                   MOVE 'CICICADMICLI' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   MOVE -1 TO CAD-CAI-ICAD-LEN IN OPD-FLD 
                   MOVE 'S' TO FRM-UCUR
                   GO TO FIN-VAL-CTA
               ELSE
                   GO TO CER-VAL-CAD-CAI-ICAD.

           MOVE CAD-CAI-ICAD IN OPD-FLD TO RCO-CAI-IOPE IN RCO.
           MOVE CAD-IIC-ICAD IN OPD-FLD TO RCO-IIC-IOPE IN RCO.
           MOVE 'RCO-KEY-IOPE' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM SGC-FIO-RCO.
           IF NOT FIO-STAT-OKS
               MOVE 'DAP'        TO MSG-COD-SIST
               MOVE 'CICICADNEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE -1 TO CAD-CAI-ICAD-LEN IN OPD-FLD 
               MOVE 'S' TO FRM-UCUR
               GO TO FIN-VAL-CTA
           ELSE
               IF WSS-IND-MUOC = 'M'
                   MOVE 'DAP'          TO MSG-COD-SIST
                   MOVE 'CICICADOTCLI' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   MOVE -1 TO CAD-CAI-ICAD-LEN IN OPD-FLD 
                   MOVE 'S' TO FRM-UCUR
                   GO TO FIN-VAL-CTA.
       CER-VAL-CAD-CAI-ICAD.
           MOVE RCO-CIC-IOPE IN RCO TO OPE-CIC-IOPE IN OPE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF OPE-FEC-FTOP IN OPE > ZEROES
               IF OPE-FEC-FTOP IN OPE > OPE-FEC-FROP IN OPE
                   MOVE 'DAP'          TO MSG-COD-SIST
                   MOVE 'FECFTOPICYA>' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MEN1
                   MOVE -1 TO CAD-CAI-ICAD-LEN IN OPD-FLD 
                   MOVE 'S' TO FRM-UCUR
                   MOVE FRM-SUAR-MAL TO FRM-SUAR.
       FIN-VAL-CTA.
           EXIT.

      *>>>> EOF_BU
      *<<<< EOF
       VAL-ICLI SECTION.
       INI-VAL-ICLI.
           IF DBC-IND-ICLI IN OPD-FLD = 'M'
               MOVE ZEROES TO DBC-NUM-ICLI IN OPD-FLD
               MOVE SPACES TO DBC-VRF-ICLI IN OPD-FLD
               MOVE SPACES TO DBC-GLS-ICLI IN OPD-FLD
      *        OPD con multiples clientes
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'OPD    MCLI' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO DBC-GLS-NOMC IN OPD-FLD
               GO TO FIN-VAL-ICLI.

           IF SCR-INST = SCR-INST-GKY
               MOVE IDC-ZERO-S TO IDC-ZERO
           ELSE
               MOVE IDC-ZERO-N TO IDC-ZERO
               IF DBC-NUM-ICLI IN OPD-FLD NOT > ZEROES AND
                  SCR-IND-MCLI NOT = 'M'
      * ISP: Cliente Obligatorio
                   MOVE 'CLI    OBL' TO MSG-COD-MENS
                   MOVE -1 TO DBC-NUM-ICLI-LEN IN OPD-FLD 
                   MOVE 'S' TO FRM-UCUR
                   GO TO ERR-VAL-ICLI.

      *VAL-RUT Valida Rut
           MOVE DBC-NUM-ICLI IN OPD-FLD TO IDC-NUM-RUTV.
           MOVE DBC-VRF-ICLI IN OPD-FLD TO IDC-VRF-RUTV.
           PERFORM VAL-RUT.
           IF MSG-COD-MENS > SPACES
               GO TO ERR-VAL-ICLI.
      
      *     IF DBC-NUM-ICLI IN OPD-FLD > ZEROES
           MOVE DBC-NUM-ICLI IN OPD-FLD TO DBC-NUM-ICLI IN DBC.
           MOVE DBC-IND-ICLI IN OPD-FLD TO DBC-IND-ICLI IN DBC.
           MOVE DBC-GLS-ICLI IN OPD-FLD TO DBC-GLS-ICLI IN DBC.
           MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
           IF NOT FIO-STAT-OKS
      *        cliente inexistente
               MOVE 'CLI    NEX' TO MSG-COD-MENS
               MOVE SPACES       TO DBC-GLS-NOMC IN OPD-FLD
               GO TO ERR-VAL-ICLI.

           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN TO DBC-GLS-NOMC IN OPD-FLD.

           IF SCR-CCPP = 'ING'
               MOVE DBC-CIC-ICLI IN DBC TO DCC-CIC-ICLI IN DCC
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM SGC-FIO-DCC
               IF NOT FIO-STAT-OKS
                     MOVE PGM-STAT-DBC TO FIO-STAT
      *              MOVE 'DCC    NEX' TO MSG-COD-MENS
      *              GO TO ERR-VAL-ICLI
               ELSE
                   MOVE 'SGC' TO TAB-COD-SIST
                   MOVE 'RCC' TO TAB-CIC-TTAB IN TAB
                   MOVE 'I'   TO TAB-CIC-CTAB IN TAB
                   MOVE 'TAB-CIC-TABL' TO FIO-AKEY
                   PERFORM VAL-COD
                   IF MSG-COD-MENS > SPACES
                      MOVE 'DCCRCH NEX' TO MSG-COD-MENS
                      GO TO ERR-VAL-ICLI
                   ELSE
                      IF DCC-COD-RCHZ IN DCC = TAB-COD-CTAB IN TAB
                          MOVE 'DCCRCH ERR' TO MSG-COD-MENS
                          GO TO ERR-VAL-ICLI.

      *     IF ( SCR-CNAL = '100' OR
      *          SCR-CNAL = '110' OR
      *          SCR-CNAL = '150'  )
                   GO TO SIG-VAL-ICLI.
                   
           IF DBC-GLS-NOMC IN DBC NOT > SPACES
               MOVE 'CLINOMCOBL' TO MSG-COD-MENS
               GO TO ERR-VAL-ICLI.

           IF DBC-COD-TICL IN DBC NOT > SPACES
               MOVE 'CODTICLOBL' TO MSG-COD-MENS
               GO TO ERR-VAL-ICLI.

           IF DBC-COD-EJEC IN DBC NOT > SPACES
               MOVE 'CODEJECOBL' TO MSG-COD-MENS
               GO TO ERR-VAL-ICLI.

           IF DBC-COD-OFIC IN DBC NOT > SPACES
               MOVE 'CODOFICOBL' TO MSG-COD-MENS
               GO TO ERR-VAL-ICLI.

           IF VERSION-BCP = 'N'
           IF DBC-COD-ODSE IN DBC NOT > SPACES
               MOVE 'CODODSEOBL' TO MSG-COD-MENS
               GO TO ERR-VAL-ICLI.
           IF DBC-IND-TICL IN DBC = 'P'
               MOVE DBC-CIC-ICLI IN DBC TO DCP-CIC-ICLI IN DCP
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM SGC-FIO-DCP
               IF FIO-STAT-OKS
                   IF DCP-IND-SEXO IN DCP > SPACES
                       NEXT SENTENCE
                   ELSE
                       MOVE 'CODTICLOBL' TO MSG-COD-MENS
                       GO TO ERR-VAL-ICLI
               ELSE
                   MOVE 'CODTICLOBL' TO MSG-COD-MENS
                   GO TO ERR-VAL-ICLI.
       SIG-VAL-ICLI.
           PERFORM PUT-DBC-OPD.
      *     IF SCR-OPD-VIGE NOT = 'S'
      *         PERFORM BUS-OPD-VIG.
           GO TO FIN-VAL-ICLI.
       ERR-VAL-ICLI.
           MOVE 'DAP' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE FRM-SUAR-MAL TO FRM-SUAR.
       FIN-VAL-ICLI.
           EXIT.

       BUS-OPD-VIG SECTION.
       INI-BUS-OPD-VIG.
      ** BUSCA Y CUENTA EL NUMERO DE OPERACIONES VIGENTES DEL CLIENTE
      *     MOVE 'S' TO SCR-OPD-VIGE.
      *     MOVE ZEROES TO WSS-OPDV.
      *     MOVE DBC-CIC-ICLI IN DBC TO RCC-CIC-ICLI IN RCC.
      *     MOVE SPACES              TO RCC-CIC-IOPD IN RCC.
      *     MOVE FIO-GET-NLS TO FIO-CMND.
      * LUP-BUS-OPD-VIG.
      *     PERFORM DAP-FIO-RCC.
      *     IF NOT FIO-STAT-OKS
      *         GO TO EXT-BUS-OPD-VIG.
      *     IF DBC-CIC-ICLI IN DBC NOT = RCC-CIC-ICLI IN RCC
      *         GO TO EXT-BUS-OPD-VIG.
      *     MOVE RCC-CIC-IOPD IN RCC TO OPD-CIC-IOPD IN OPD.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM DAP-FIO-OPD.
      *     IF FIO-STAT-OKS AND
      *        OPD-COD-STAT IN OPD = 'A' OR 'G'
      *         ADD 1 TO WSS-OPDV.
      *     MOVE FIO-GET-NXT TO FIO-CMND.
      *     GO TO LUP-BUS-OPD-VIG.
      * EXT-BUS-OPD-VIG.
      *     MOVE WSS-OPDV TO FRM-NUM-TOPE IN OPD-FLD.
      ** ISP: RECUPERA LA OPERACION VIGENTE
      *     MOVE OPD-CAI-IOPD IN OPD-FLD TO OPD-CAI-IOPD IN OPD.
      *     MOVE OPD-IIC-IOPD IN OPD-FLD TO OPD-IIC-IOPD IN OPD.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM DAP-FIO-OPD.
      * FIN-BUS-OPD-VIG.
      *     EXIT.
      *>>>>
      *<<<< EOF 
       VAL-CAP-UFP-PESO SECTION.
           MULTIPLY WSS-INI-PESO BY
               SCR-SGV-VCAM GIVING
               PES-SGV-DECI
           PERFORM PES-SCTV
           MOVE PES-SGV-ENTE TO WSS-FIN-PESO.
       FIN-VAL-CAP-UFP-PESO.

       BUS-VPES SECTION.
       INI-BUS-VPES.

      *SE ACCESA DE NUEVO LA BDD, PUES ES NECESARIO OBTENER
      *EL CIC DE OPD-COD-VCAM
      *BUS-TAB busca glosa de codigo en tabla
           IF OPD-COD-VCAM IN OPD-FLD NOT > SPACES
               GO TO FIN-BUS-VPES.

           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'VLR' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-VCAM IN OPD-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO SCR-CIC-VCAM.

      *    moneda extranjera
           IF SCR-CIC-TVAL NOT = PDB-CIC-MNAC
                GO TO FIN-BUS-VPES.
      *    moneda chilena y pesos
           IF SCR-CIC-VCAM = PDB-CIC-0999
                MOVE OPD-VAL-CAPT IN OPD-FLD TO FRM-VAL-IPES IN OPD-FLD
                GO TO FIN-BUS-VPES.

      *LRH ini 10-OCT-1994
      *     PERFORM LEE-VCAM.

      *     MULTIPLY OPD-VAL-CAPT IN OPD-FLD BY 
      *         SCR-SGV-VCAM GIVING 
      *         WSS-VAL-IPES IN WSS-VARI ROUNDED.

      *     MOVE WSS-VAL-IPES IN WSS-VARI TO PES-SGV-DECI.
      *     PERFORM PES-SCTV.
      *     MOVE PES-SGV-ENTE TO FRM-VAL-IPES IN OPD-FLD.

           MOVE OPD-VAL-IPES IN OPD TO FRM-VAL-IPES IN OPD-FLD.

      *LRH fin 10-OCT-1994

       FIN-BUS-VPES.
           EXIT.

       LEE-VCAM SECTION.
       INI-LEE-VCAM.
      *    moneda reajustable, chilena y no pesos ; convertir a pesos
           MOVE PDB-CIC-0999            TO TAB-CIC-CTAB IN TAB.
           MOVE OPD-COD-VCAM IN OPD-FLD TO TAB-COD-CTAB IN TAB.
           MOVE OPD-NUM-DREA IN OPD-FLD TO TAB-NUM-DTRN IN TAB.
           MOVE OPD-NUM-MREA IN OPD-FLD TO TAB-NUM-MTRN IN TAB.
           MOVE OPD-NUM-SREA IN OPD-FLD TO TAB-NUM-STRN IN TAB.
           MOVE OPD-NUM-AREA IN OPD-FLD TO TAB-NUM-ATRN IN TAB.
           PERFORM GET-VCAM.
           IF MSG-COD-MENS = SPACES
               MOVE CAM-SGV-VCAM IN CAM TO SCR-SGV-VCAM.
       FIN-LEE-VCAM.
           EXIT.

      *ADA-INI 16-AGO-2000 DAPR0051
       VALIDA-CON-STA SECTION.
       INI-VALIDA-CON-STA.
           IF SCR-CNAL = '100' OR
              SCR-CNAL = '110'
               GO TO EXT-VALIDA-CON-STA.

           MOVE 'STA    NOFND' TO MSG-COD-MENS.

           IF OPD-IIC-IOPD IN OPD-FLD > ZEROES
               MOVE OPD-CAI-IOPD IN OPD-FLD TO RCC-CAI-IOPD IN RCC
               MOVE OPD-IIC-IOPD IN OPD-FLD TO RCC-IIC-IOPD IN RCC
               MOVE 'RCC-KEY-IOPD' TO FIO-AKEY
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM DAP-FIO-RCC
               IF FIO-STAT-OKS AND
                  RCC-CAI-IOPD IN RCC = OPD-CAI-IOPD IN OPD-FLD AND
                  RCC-IIC-IOPD IN RCC = OPD-IIC-IOPD IN OPD-FLD
                   PERFORM PROC-STA-CON-RCC
                   GO TO FIN-VALIDA-CON-STA.

           IF DBC-NUM-ICLI IN OPD-FLD NOT > ZEROES
               MOVE 'CLIOBLIXSTA' TO MSG-COD-MENS
               GO TO FIN-VALIDA-CON-STA.
           MOVE DBC-NUM-ICLI IN OPD-FLD TO DBC-NUM-ICLI IN DBC.
           MOVE DBC-IND-ICLI IN OPD-FLD TO DBC-IND-ICLI IN DBC.
           MOVE DBC-GLS-ICLI IN OPD-FLD TO DBC-GLS-ICLI IN DBC.
           MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC
           IF NOT FIO-STAT-OKS
               MOVE 'CLI    NEX' TO MSG-COD-MENS
           ELSE
               MOVE DBC-CIC-ICLI IN DBC TO RCC-CIC-ICLI IN RCC
               PERFORM LEER-STA.
       FIN-VALIDA-CON-STA.
      *Los unicos mensajes diferentes deben ser:
      *Fuera de Rango de STA y Debe ingresar cliente para revisar STA
           IF MSG-COD-MENS > SPACES AND
              MSG-COD-MENS NOT = 'TINTFRNG STA' AND
              MSG-COD-MENS NOT = 'CLIOBLIXSTA'
               PERFORM SET-MSG-RNG.
      *        MOVE 'TINT    FRNG' TO MSG-COD-MENS.
           IF MSG-COD-MENS > SPACES
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE 'DAP' TO MSG-COD-SIST
               PERFORM GET-MSG
               IF MSG-COD-MENS = 'TINT    FRNG' OR 'TINTFRNG STA' OR
                  MSG-COD-MENS = 'TINTEATEFRNG'
                   MOVE MSG-GLS-DESC TO WSS-GLS-1RNG IN WSS-VARI
                   MOVE PTD-SGV-TMIN IN PTD(WSS-IDX-INT) TO
                                  WSS-GLS-2RNG IN WSS-VARI
                   IF VERSION-CST = 'S'
                        MOVE PTD-SGV-TMAX IN PTD(WSS-IDX-INT) TO
                             WSS-GLS-4RNG IN WSS-VARI
                   ELSE
                        MOVE SPACES TO WSS-GLS-3RNG
                        MOVE ZEROES TO WSS-GLS-4RNG
                   END-IF
                   MOVE WSS-GLS-MRNG IN WSS-VARI TO FRM-MENS
               ELSE
                   MOVE MSG-GLS-DESC IN MSG TO FRM-MEN1
                   MOVE MSG-GLS-DATA IN MSG TO FRM-MEN2.
       EXT-VALIDA-CON-STA.
           EXIT.

       PROC-STA-CON-RCC SECTION.
       INI-PROC-STA-CON-RCC.
           PERFORM LEER-STA.
           IF MSG-COD-MENS = 'STA    NOFND'
               MOVE 'RCC-KEY-IOPD' TO FIO-AKEY
               MOVE FIO-GET-NXT TO FIO-CMND
               PERFORM DAP-FIO-RCC
               IF FIO-STAT-OKS AND
                  RCC-CAI-IOPD IN RCC = OPD-CAI-IOPD IN OPD-FLD AND
                  RCC-IIC-IOPD IN RCC = OPD-IIC-IOPD IN OPD-FLD
                   GO TO INI-PROC-STA-CON-RCC.
       FIN-PROC-STA-CON-RCC.
           EXIT.

       LEER-STA SECTION.
       INI-LEER-STA.
           MOVE OPD-COD-EATE IN OPD-FLD TO STA-COD-USER IN STA.
           MOVE RCC-CIC-ICLI IN RCC     TO STA-CIC-ICLI.
           MOVE OPD-NUM-DREA IN OPD-FLD TO STA-NUM-DSTA IN STA.
           MOVE OPD-NUM-MREA IN OPD-FLD TO STA-NUM-MSTA IN STA.
           MOVE OPD-NUM-SREA IN OPD-FLD TO STA-NUM-SSTA IN STA.
           MOVE OPD-NUM-AREA IN OPD-FLD TO STA-NUM-ASTA IN STA.
           MOVE OPD-COD-VCAM IN OPD-FLD TO STA-COD-VCAM IN STA.
           MOVE 99                      TO STA-NUM-ICOR IN STA.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM DAP-FIO-STA.
           IF FIO-STAT-OKS AND
              STA-COD-USER IN STA = OPD-COD-EATE IN OPD-FLD AND
              STA-CIC-ICLI IN STA = RCC-CIC-ICLI IN RCC     AND
              STA-NUM-DSTA IN STA = OPD-NUM-DREA IN OPD-FLD AND
              STA-NUM-MSTA IN STA = OPD-NUM-MREA IN OPD-FLD AND
              STA-NUM-SSTA IN STA = OPD-NUM-SREA IN OPD-FLD AND
              STA-NUM-ASTA IN STA = OPD-NUM-AREA IN OPD-FLD AND
              STA-COD-VCAM IN STA = OPD-COD-VCAM IN OPD-FLD
               PERFORM CHK-CON-STA
           ELSE
               MOVE 'STA    NOFND' TO MSG-COD-MENS.
       FIN-LEER-STA.
           EXIT.

       CHK-CON-STA SECTION.
       INI-CHK-CON-STA.
      *Toma el registro con control exclusivo para que no lo 'tome'
      *nadie mas
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-STA.
           IF NOT FIO-STAT-OKS
               MOVE 'STA    NOGKU' TO MSG-COD-MENS
               GO TO FIN-CHK-CON-STA.
      *Sabemos que el registro STA esta utilizado si es que esta lleno
      *y con una operacion diferente a la operacion en curse. Este
      *caso lo tratamos igual a que si no existiera sobretasa STA
           IF STA-IIC-IOPD IN STA > ZEROES AND
              ( STA-CAI-IOPD IN STA NOT = OPD-CAI-IOPD IN OPD-FLD OR
                STA-IIC-IOPD IN STA NOT = OPD-IIC-IOPD IN OPD-FLD )
               MOVE 'STA    NOFND' TO MSG-COD-MENS
               MOVE FIO-ULK-REC TO FIO-CMND
               PERFORM DAP-FIO-STA
               GO TO FIN-CHK-CON-STA.

           IF STA-VAL-STAA IN STA > 0
               MOVE STA-VAL-STAA IN STA TO
                    PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
           ELSE
               ADD STA-VAL-PSTM IN STA TO
                    PTD-SGV-TMAX IN PTD(WSS-IDX-INT).

           IF OPD-SGV-TINT IN OPD-FLD >
              PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
               MOVE 'TINTFRNG STA' TO MSG-COD-MENS
               MOVE FIO-ULK-REC TO FIO-CMND
               PERFORM DAP-FIO-STA
               GO TO FIN-CHK-CON-STA.

      *Al llegar aca implica que la tasa ingresada por el Usuario
      *es ACEPTADA
           MOVE STA-KEY-ISTA IN STA TO SCR-KEY-ISTA.

      *Aprovecha de poner timestamp al registro STA para control
           PERFORM GET-FHOY.
           MOVE HOY-STP-ITRN TO STA-STP-ITRN IN STA.
           MOVE 'M'          TO STA-MSC-TACC IN STA.
           MOVE 'V'          TO STA-MSC-STAT IN STA.
           MOVE SCR-OTRN     TO STA-COD-OTRN IN STA.
           MOVE SCR-USER     TO STA-COD-ATRN IN STA.

           MOVE FIO-MOD TO FIO-CMND.
           PERFORM DAP-FIO-STA.
           IF FIO-STAT-OKS
               MOVE SPACES TO MSG-COD-MENS
           ELSE
               MOVE 'STA    NOMOD' TO MSG-COD-MENS.
       FIN-CHK-CON-STA.
           EXIT.
      *ADA-FIN 16-AGO-2000

       FPVC-RET SECTION.
       INI-FPVC-RET.

           IF NOT
             (
               POD-COD-AFER IN POD = SCR-SON-S  AND
               OPD-COD-VCAM IN OPD-FLD = '0999' AND
               OPD-COD-TOPD IN OPD-FLD = 'DPF'  AND
               ( OPD-COD-AOPD IN OPD-FLD = 'NRN' OR
                 OPD-COD-AOPD IN OPD-FLD = 'NRS' OR
                 OPD-COD-AOPD IN OPD-FLD = 'ERN'
               )
             )
                GO TO FIN-FPVC-RET.
       CIC-FPVC-RET.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-HBL
                MOVE FEC-FORM-FEC TO FEC-FORM
                MOVE FEC-SUM-DIA  TO FEC-CMND
                MOVE 1            TO FEC-NDIA
                PERFORM CAL-FEC
                MOVE FEC-FECH TO WSS-FEC-FPVC
                GO TO CIC-FPVC-RET.
       FIN-FPVC-RET.
           EXIT.

       SIG-HBL-FCTB SECTION.
       INI-SIG-HBL-FCTB.
           MOVE OPD-FEC-FCTB IN OPD-FLD TO FEC-FECH.

       CIC-SIG-HBL-FCTB.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-SUM-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
           PERFORM CAL-FEC.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-HBL
                GO TO CIC-SIG-HBL-FCTB.

           MOVE FEC-ITM1 TO OPD-NUM-DCTB IN OPD-FLD.
           MOVE FEC-ITM2 TO OPD-NUM-MCTB IN OPD-FLD.
           MOVE FEC-ITM3 TO OPD-NUM-SCTB IN OPD-FLD.
           MOVE FEC-ITM4 TO OPD-NUM-ACTB IN OPD-FLD.

       FIN-SIG-HBL-FCTB.
           EXIT.


       SIG-HBL-FCMP SECTION.
       INI-SIG-HBL-FCMP.
           MOVE OPD-FEC-FCMP IN OPD-FLD TO FEC-FECH.

       CIC-SIG-HBL-FCMP.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-SUM-DIA  TO FEC-CMND.
           MOVE 1            TO FEC-NDIA.
           PERFORM CAL-FEC.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-HBL
                GO TO CIC-SIG-HBL-FCMP.

           MOVE FEC-ITM1 TO OPD-NUM-DCMP IN OPD-FLD.
           MOVE FEC-ITM2 TO OPD-NUM-MCMP IN OPD-FLD.
           MOVE FEC-ITM3 TO OPD-NUM-SCMP IN OPD-FLD.
           MOVE FEC-ITM4 TO OPD-NUM-ACMP IN OPD-FLD.

       FIN-SIG-HBL-FCMP.
           EXIT.

       ASS-TASA SECTION.
       INI-ASS-TASA.


           IF SCR-CNAL = '100' OR
              SCR-CNAL = '110'
               MOVE PTD-SGV-TMAX IN PTD(WSS-IDX-INT) TO
                                OPD-SGV-TINT IN OPD-FLD
               PERFORM TAS-DESC
           ELSE
               MOVE PTD-SGV-TMIN IN PTD(WSS-IDX-INT) TO
                                OPD-SGV-TINT IN OPD-FLD.
       FIN-ASS-TASA.
           EXIT.

       TAS-DESC SECTION.
       INI-TAS-DESC.

           IF POD-COD-VCAM IN POD = '0994  '
                MOVE '001' TO WSS-GLS-PROD-1
           ELSE
           IF POD-COD-VCAM IN POD = '0998  '
                MOVE '002' TO WSS-GLS-PROD-1
           ELSE
           IF POD-COD-VCAM IN POD = '0999  '
                MOVE '003' TO WSS-GLS-PROD-1
           ELSE
           IF POD-COD-VCAM IN POD = '1013  '
                MOVE '004' TO WSS-GLS-PROD-1
           ELSE
           IF POD-COD-VCAM IN POD = '1142  '
                MOVE '005' TO WSS-GLS-PROD-1.

           MOVE POD-COD-TOPD IN POD TO WSS-GLS-PROD-2.
           MOVE POD-COD-AOPD IN POD TO WSS-GLS-PROD-3.
           MOVE SCR-CNAL            TO WSS-GLS-PROD-4.
           MOVE 'DAP' TO FIO-SIST.
      * DESCUENTO POR CANAL
           MOVE 'DXC' TO TAB-COD-TTAB IN TAB.
           MOVE WSS-GLS-PROD TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB




           IF NOT ( FIO-STAT-OKS AND
                    TAB-IND-VIGE = 'S'  )
                GO TO FIN-TAS-DESC.

                MOVE TAB-GLS-DATA IN TAB TO NUM-NUME
                MOVE NUM-ZERO-S TO NUM-ZERO
                MOVE NUM-SGNO-N TO NUM-SGNO
                MOVE 11 TO NUM-NENT
                MOVE  0 TO NUM-NDCM
                PERFORM VAL-NUM
                IF NOT NUM-STAT-OKS



                    MOVE PTD-SGV-TMAX IN PTD(WSS-IDX-INT) TO
                         OPD-SGV-TINT IN OPD-FLD
                ELSE
                   MOVE NUM-NS9V TO WSS-SGV-CORT
                   MOVE TAB-GLS-DCOR IN TAB TO WSS-COD-DCTO
                   MOVE WSS-COD-DCTO-NUM-D1 TO NUM-NUME
                   MOVE NUM-ZERO-S TO NUM-ZERO
                   MOVE NUM-SGNO-N TO NUM-SGNO
                   MOVE 2 TO NUM-NENT
                   MOVE 2 TO NUM-NDCM
                   PERFORM VAL-NUM
                   IF NOT NUM-STAT-OKS
                       MOVE PTD-SGV-TMAX IN PTD(WSS-IDX-INT) TO
                                         OPD-SGV-TINT IN OPD-FLD
                ELSE
                    MOVE NUM-NS9V TO WSS-SGV-DESC
                    MOVE WSS-COD-DCTO-NUM-D2 TO NUM-NUME
                    MOVE NUM-ZERO-S TO NUM-ZERO
                    MOVE NUM-SGNO-N TO NUM-SGNO
                    MOVE 2 TO NUM-NENT
                    MOVE 2 TO NUM-NDCM
                    PERFORM VAL-NUM
                    IF NOT NUM-STAT-OKS
                       MOVE PTD-SGV-TMAX IN PTD(WSS-IDX-INT) TO
                                         OPD-SGV-TINT IN OPD-FLD
                    ELSE
                       PERFORM SET-TAS-DESC
                       IF OPD-SGV-TINT IN OPD-FLD <
                          PTD-SGV-TMIN IN PTD(WSS-IDX-INT)
                            MOVE PTD-SGV-TMIN IN PTD(WSS-IDX-INT) TO
                                 OPD-SGV-TINT IN OPD-FLD.
       FIN-TAS-DESC.
           EXIT.

       SET-TAS-DESC SECTION.
       INI-SET-TAS-DESC.
           IF OPD-VAL-CAPT IN OPD-FLD NOT < WSS-SGV-CORT
                    MOVE NUM-NS9V TO WSS-SGV-DESC.

           IF WSS-COD-DCTO-MOD = 'P'
               COMPUTE OPD-SGV-TINT IN OPD-FLD =
                  PTD-SGV-TMAX IN PTD(WSS-IDX-INT) *
                  WSS-SGV-DESC / 100
           ELSE
           IF WSS-COD-DCTO-MOD = 'M'
                  COMPUTE OPD-SGV-TINT IN OPD-FLD =
                  PTD-SGV-TMAX IN PTD(WSS-IDX-INT) -
                  WSS-SGV-DESC
           ELSE
               MOVE PTD-SGV-TMAX IN PTD(WSS-IDX-INT) TO
                                OPD-SGV-TINT IN OPD-FLD.
       FIN-SET-TAS-DESC.
           EXIT.

       PRM-WEB SECTION.
       INI-PRM-WEB.
           MOVE CAD-CAI-ICAD IN OPD-FLD TO OPE-CAI-IOPE IN OPE.
           MOVE CAD-IIC-ICAD IN OPD-FLD TO OPE-IIC-IOPE IN OPE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-OPE.
           IF FIO-STAT-OKS
                MOVE OPE-COD-OFOP IN OPE TO OPD-COD-OFIC IN OPD-FLD
                MOVE 'BCINET'            TO OPD-COD-EJEC IN OPD-FLD
                MOVE 'BCINET'            TO OPD-COD-EATE IN OPD-FLD
                IF FRM-IIC-ICAD IN OPD-FLD NOT > ZEROES
                    MOVE CAD-CAI-ICAD IN OPD-FLD TO
                         FRM-CAI-ICAD IN OPD-FLD
                    MOVE CAD-IIC-ICAD IN OPD-FLD TO
                         FRM-IIC-ICAD IN OPD-FLD.

       FIN-PRM-WEB.
           EXIT.
      *>>>>
       SET-MSG-RNG SECTION.
       INI-SET-MSG-RNG.
           MOVE 'TINT    FRNG' TO MSG-COD-MENS.
           IF SCR-CNAL = '150'
                IF OPD-COD-EATE IN OPD-FLD > SPACES
                    MOVE 'TINT    FRNG' TO MSG-COD-MENS
                ELSE
                    MOVE 'TINTEATEFRNG' TO MSG-COD-MENS.
       FIN-SET-MSG-RNG.
           EXIT.


       ASG-OFI-BCS SECTION.
       INI-ASG-OFI-BCS.
      *     IF DBC-IND-TICL IN DBC = 'P'
      *        MOVE DBC-CIC-ICLI IN DBC TO DCP-CIC-ICLI IN DCP
      *        MOVE FIO-GET-KEY TO FIO-CMND
      *        PERFORM SGC-FIO-DCP
      *        IF FIO-STAT-OKS
      *           IF DCP-COD-TBAN IN DCP = 'PBM'
      *              GO TO CLIENTE-NOVA
      *           ELSE
      **             es un cliente Bci validar si es de oficina D
      *              PERFORM ASG-OFI-D
      *              GO TO FIN-ASG-OFI-BCS
      *        ELSE
      *           GO TO FIN-ASG-OFI-BCS.
      * CLIENTE-NOVA.
      **....debiera venir numero de cuenta en pantalla (via Web)
           IF CAD-IIC-ICAD IN OPD-FLD NOT > ZEROES
              GO TO FIN-ASG-OFI-BCS.
      *     MOVE CAD-CAI-ICAD IN OPD-FLD TO OPE-CAI-IOPE IN OPE
      *     MOVE CAD-IIC-ICAD IN OPD-FLD TO OPE-IIC-IOPE IN OPE
      *     MOVE FIO-GET-KEY TO FIO-CMND
      *     PERFORM SGC-FIO-OPE
      *     IF OPE-COD-TOPR = 'CCT'
      **.......flujo normal asignara oficina asociada a esta cta-cte
      *        GO TO FIN-ASG-OFI-BCS.
      **    se asume que es una cuenta prima

           MOVE OPD-COD-OFIC IN OPD-FLD TO OFI-COD-OFIC IN OFI.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-OFI.
           IF NOT FIO-STAT-OKS
               GO TO FIN-ASG-OFI-BCS
           ELSE
           IF OFI-COD-MODL IN OFI NOT = '8'
               GO TO FIN-ASG-OFI-BCS.


      *+     MOVE SPACES TO RCO.
      *+     MOVE DBC-CIC-ICLI IN DBC TO RCO-CIC-ICLI IN RCO.
      *+     MOVE FIO-GET-NLS  TO FIO-CMND.
      *+ LUP-ASG-OFI-BCS.
      *+*    buscar si tiene cuentas corriente
      *+     PERFORM SGC-FIO-RCO.
      *+     IF FIO-STAT-OKS
      *+        IF DBC-CIC-ICLI IN DBC = RCO-CIC-ICLI IN RCO
      *+           MOVE RCO-CIC-IOPE IN RCO TO OPE-CIC-IOPE IN OPE
      *+           MOVE FIO-GET-KEY   TO FIO-CMND
      *+           PERFORM SGC-FIO-OPE
      *+           IF FIO-STAT-OKS AND
      *+              OPE-COD-TOPR IN OPE = 'CCT' AND
      *+              OPE-FEC-FTOP IN OPE NOT > ZEROES
      *+              MOVE OPE-COD-OFOP TO OPD-COD-OFIC IN OPD-FLD
      *+              GO TO FIN-ASG-OFI-BCS
      *+           ELSE
      *+              MOVE FIO-GET-NXT  TO FIO-CMND
      *+              GO TO LUP-ASG-OFI-BCS.

      *    validar como cuenta prima, no tiene cuenta corriente
      *     MOVE CAD-CAI-ICAD IN OPD-FLD TO OPE-CAI-IOPE IN OPE
      *     MOVE CAD-IIC-ICAD IN OPD-FLD TO OPE-IIC-IOPE IN OPE
      *     MOVE FIO-GET-KEY TO FIO-CMND
      *     PERFORM SGC-FIO-OPE
      *     IF OPE-COD-TOPR NOT = 'CPR'
      *        GO TO FIN-ASG-OFI-BCS.
      *    es cuenta prima
      *     MOVE OPE-COD-OFOP IN OPE TO OFI-COD-OFIC IN OFI.
      *     PERFORM VAL-OFI.
      *     IF MSG-COD-MENS = SPACES
      *       asigna oficina operacional
      *        MOVE OFI-COD-OFCO IN OFI TO OPD-COD-OFIC IN OPD-FLD
      *     ELSE
      **       MOVE -1             TO OPD-COD-EJEC-LEN IN OPD-FLD
      *        MOVE 'DAP'          TO MSG-COD-SIST
      *        MOVE 'CODOFICLNOVA' TO MSG-COD-MENS
      *        PERFORM GET-MSG
      *        MOVE MSG-GLS-DESC   TO FRM-MENS
      *        MOVE FRM-SUAR-MAL   TO FRM-SUAR.


      *    asigna oficina operacional
      *    MOVE OFI-COD-OFCO IN OFI TO OPD-COD-OFIC IN OPD-FLD.
           MOVE '090'               TO OPD-COD-OFIC IN OPD-FLD.

       FIN-ASG-OFI-BCS.
           EXIT.


      *+ ASG-OFI-D SECTION.
      *+ INI-ASG-OFI-D.
      *+     GO TO FIN-ASG-OFI-D.
      *+* ver si oficina asignada (en pantalla) existe en tabla ROD
      *+     MOVE 'DAP'                   TO FIO-SIST.
      *+     MOVE 'ROD'                   TO TAB-COD-TTAB IN TAB.
      *+     MOVE OPD-COD-OFIC IN OPD-FLD TO TAB-COD-CTAB IN TAB.
      *+     MOVE FIO-GET-KEY             TO FIO-CMND.
      *+     PERFORM GNS-FIO-TAB.
      *+     IF FIO-STAT-OKS
      *+*       asignar oficina nucleo
      *+        MOVE TAB-GLS-ABRV IN TAB  TO OPD-COD-OFIC IN OPD-FLD
      *+                                     OPE-COD-OFOP IN OPE.
      *+ FIN-ASG-OFI-D.
      *+     EXIT.

      *CIMA-INI 12-JUN-2015 MEJORAS SERVICIOS DAP
       SIG-HBL-FPVC SECTION.
       INI-SIG-HBL-FPVC.
           MOVE OPD-FEC-FPVC IN OPD-FLD TO FEC-FECH.

       CIC-SIG-HBL-FPVC.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-SUM-DIA  TO FEC-CMND.
           MOVE WSS-CT-1     TO FEC-NDIA.
           PERFORM CAL-FEC.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-HBL
                GO TO CIC-SIG-HBL-FPVC.

           MOVE FEC-ITM1 TO OPD-NUM-DPVC IN OPD-FLD.
           MOVE FEC-ITM2 TO OPD-NUM-MPVC IN OPD-FLD.
           MOVE FEC-ITM3 TO OPD-NUM-SPVC IN OPD-FLD.
           MOVE FEC-ITM4 TO OPD-NUM-APVC IN OPD-FLD.

           MOVE ZEROES TO OPD-NUM-PVEN IN OPD-FLD.
           PERFORM  OBT-NUM-PVEN.

       FIN-SIG-HBL-FPVC.
           EXIT.
      *CIMA-FIN 12-JUN-2015 MEJORAS SERVICIOS DAP
