       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      DAPPLFDC.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    02-Apr-92 08:02 PM.

      * Programa Listador de Reporte FDC con Sort.

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
      *DOS SELECT GNSSRT         ASSIGN TO SYS001-DA-3330-S-SORTWK1.
      *MVS SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
      *DOS SELECT RPTFDC         ASSIGN TO SYS011-UR-1403-S.
      *MVS SELECT RPTFDC         ASSIGN TO        UT-S-RPTFDC.
           SELECT GNSSRT         ASSIGN TO        DA-S-SORTWK1.
           SELECT RPTFDC         ASSIGN TO        UT-S-RPTFDC.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY DAPRRFDC.
       FD  RPTFDC LABEL RECORDS OMITTED
           REPORT IS RPT-FDC
           .

       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY DAPBRVEN.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWVIDD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY DAPRWFDC.
       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
      *Entidades de TAB
       COPY TABBROFI.
       COPY TABBRCAM.
      *Entidades de GNS
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGCPT.
      *Entidades de DAP
       COPY DAPWGPDB.
       COPY DAPBROPD.
       01  WSS-VARI.
           03 WSS-FEC-FINI.
              05 WSS-NUM-DINI                     PIC 9(02).
              05 WSS-NUM-MINI                     PIC 9(02).
              05 WSS-NUM-SINI                     PIC 9(02).
              05 WSS-NUM-AINI                     PIC 9(02).
           03 WSS-FEC-FFIN.
              05 WSS-NUM-DFIN                     PIC 9(02).
              05 WSS-NUM-MFIN                     PIC 9(02).
              05 WSS-NUM-SFIN                     PIC 9(02).
              05 WSS-NUM-AFIN                     PIC 9(02).
           03 WSS-FEC-FPRI.
              05 WSS-NUM-SPRI                     PIC 9(02).
              05 WSS-NUM-APRI                     PIC 9(02).
              05 WSS-NUM-MPRI                     PIC 9(02).
              05 WSS-NUM-DPRI                     PIC 9(02).
           03 WSS-FEC-FTER.
              05 WSS-NUM-STER                     PIC 9(02).
              05 WSS-NUM-ATER                     PIC 9(02).
              05 WSS-NUM-MTER                     PIC 9(02).
              05 WSS-NUM-DTER                     PIC 9(02).
           03 WSS-FEC-FREG.
              05 WSS-NUM-SREG                     PIC 9(02).
              05 WSS-NUM-AREG                     PIC 9(02).
              05 WSS-NUM-MREG                     PIC 9(02).
              05 WSS-NUM-DREG                     PIC 9(02).
           03 WSS-COD-OFIC                        PIC X(03).
           03 WSS-COD-VCAM                        PIC X(06).
           03 WSS-COD-PESO                        PIC X(06).
           03 WSS-IND-NEXT                        PIC 9(02).
           03 WSS-GLS-DEST.
              05  WSS-GLS-DES1                    PIC X(20).
              05  WSS-GLS-DES2                    PIC X(20).
      *>>>>
      *<<<< WSS_DTC
      *Entidades de TAB
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *Entidades de DAP
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPD-REQA==.
      *>>>>

       REPORT SECTION.
      *--------------
       COPY DAPRFFDC.
           .
       COPY DAPRTFDC.

       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
       DEC-CF-FDC-OPD-COD-OFIC SECTION.
           USE BEFORE REPORTING CF-FDC-OPD-COD-OFIC.
       INI-CF-FDC-OPD-COD-OFIC.
      *<<<< CF_FDC_OPD_COD_OFIC
      *>>>>
       FIN-CF-FDC-OPD-COD-OFIC.
           EXIT.
       DEC-CF-FDC-OPD-COD-VCAM SECTION.
           USE BEFORE REPORTING CF-FDC-OPD-COD-VCAM.
       INI-CF-FDC-OPD-COD-VCAM.
      *<<<< CF_FDC_OPD_COD_VCAM
      *>>>>
       FIN-CF-FDC-OPD-COD-VCAM.
           EXIT.
       DEC-CF-FDC-VEN-FEC-FVEN SECTION.
           USE BEFORE REPORTING CF-FDC-VEN-FEC-FVEN.
       INI-CF-FDC-VEN-FEC-FVEN.
      *<<<< CF_FDC_VEN_FEC_FVEN
      * Fecha Vencimiento
           MOVE VEN-FEC-FVEN IN SRT      TO WSS-FEC-FREG IN WSS-VARI.
           MOVE WSS-NUM-DREG IN WSS-VARI TO WSS-NUM-DVEN IN WSS-FDC.
           MOVE WSS-NUM-MREG IN WSS-VARI TO WSS-NUM-MVEN IN WSS-FDC.
           MOVE WSS-NUM-SREG IN WSS-VARI TO WSS-NUM-SVEN IN WSS-FDC.
           MOVE WSS-NUM-AREG IN WSS-VARI TO WSS-NUM-AVEN IN WSS-FDC.
      *>>>>
       FIN-CF-FDC-VEN-FEC-FVEN.
           EXIT.
       DEC-PH-FDC SECTION.
           USE BEFORE REPORTING PH-FDC.
       INI-PH-FDC.
      *<<<< PH_FDC
      * Mediante BUS-OFI se Obtiene Nombre de la Oficina de Tabla OFI
           IF OPD-COD-OFIC IN SRT > SPACES
               MOVE OPD-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI.

      * Mediante BUS-TAB se Obtiene descripcion de la moneda
           IF OPD-COD-VCAM IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE OPD-COD-VCAM IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-ABRV IN TAB TO WSS-GLS-VCAM IN WSS-FDC
           ELSE
               MOVE SPACES TO WSS-GLS-VCAM IN WSS-FDC.
      *>>>>
       FIN-PH-FDC.
           EXIT.
       END DECLARATIVES.

       MAIN SECTION.
      *------------
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'DAPPLFDC' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      *<<<< INI
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.
      *Captura Fecha de Inicio
           DISPLAY 'FECHA INICIAL   ( DDMMSSAA )  : '.
           ACCEPT  WSS-FEC-FINI IN WSS-VARI.
           DISPLAY WSS-FEC-FINI IN WSS-VARI.
      *Captura Fecha de Termino
           DISPLAY 'FECHA FINAL      ( DDMMSSAA ) : '
           ACCEPT  WSS-FEC-FFIN IN WSS-VARI.
           DISPLAY WSS-FEC-FFIN IN WSS-VARI.
      *Captura Codigo de Oficina
           DISPLAY 'COD. DE OFICINA  (XXX/*)      : '.
           ACCEPT  WSS-COD-OFIC IN WSS-VARI.
           DISPLAY WSS-COD-OFIC IN WSS-VARI.
      *Captura Codigo de Moneda
           DISPLAY 'COD. DE MONEDA   (X(06)/*)    : '.
           ACCEPT  WSS-COD-VCAM IN WSS-VARI.
           DISPLAY WSS-COD-VCAM IN WSS-VARI.

           DISPLAY 'FIN    CAPTURA    DE PARAMETROS'.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

      *VAL-FEC Valida Fecha de Inicio
           DISPLAY WSS-FEC-FINI IN WSS-VARI.
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-END.

      *VAL-FEC Valida Fecha de Termino
           DISPLAY WSS-FEC-FFIN IN WSS-VARI.
           MOVE WSS-FEC-FFIN IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-END.

      *CMP-FEC Compara Fecha de Inicio con Fecha de Termino
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FEC1.
           MOVE WSS-FEC-FFIN IN WSS-VARI TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-GRT
               MOVE 'TAB'         TO MSG-COD-SIST
               MOVE 'FECFINIFTER' TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG
               PERFORM GNS-PRO-END.

      *VAL-OFI Valida codigo de Oficina en TABLAS
           IF WSS-COD-OFIC IN WSS-VARI NOT > SPACES
               MOVE '*' TO WSS-COD-OFIC IN WSS-VARI.
           IF WSS-COD-OFIC IN WSS-VARI NOT = '*'
               DISPLAY WSS-COD-OFIC IN WSS-VARI
               MOVE WSS-COD-OFIC IN WSS-VARI TO OFI-COD-OFIC IN OFI
               PERFORM VAL-OFI
               IF MSG-COD-MENS > SPACES
                   DISPLAY MSG-GLS-DESC IN MSG
                   PERFORM GNS-PRO-END.

      *VAL-TAB Valida Codigo de moneda
           IF WSS-COD-VCAM IN WSS-VARI > SPACES AND
              WSS-COD-VCAM IN WSS-VARI NOT = '*'
              DISPLAY WSS-COD-VCAM IN WSS-VARI
              MOVE 'TAB'               TO TAB-COD-SIST
              MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
              MOVE WSS-COD-VCAM IN WSS-VARI TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              IF MSG-GLS-MENS = 'COD    NEX'
                 DISPLAY MSG-GLS-MENS
                 MOVE PGM-SMAL TO PGM-STAT-SRT
                 PERFORM GNS-PRO-END.

           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DINI IN WSS-FDC
                                            WSS-NUM-DPRI IN WSS-VARI.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MINI IN WSS-FDC
                                            WSS-NUM-MPRI IN WSS-VARI.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SINI IN WSS-FDC
                                            WSS-NUM-SPRI IN WSS-VARI.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AINI IN WSS-FDC
                                            WSS-NUM-APRI IN WSS-VARI.
           MOVE WSS-NUM-DFIN IN WSS-VARI TO WSS-NUM-DFIN IN WSS-FDC
                                            WSS-NUM-DTER IN WSS-VARI.
           MOVE WSS-NUM-MFIN IN WSS-VARI TO WSS-NUM-MFIN IN WSS-FDC
                                            WSS-NUM-MTER IN WSS-VARI.
           MOVE WSS-NUM-SFIN IN WSS-VARI TO WSS-NUM-SFIN IN WSS-FDC
                                            WSS-NUM-STER IN WSS-VARI.
           MOVE WSS-NUM-AFIN IN WSS-VARI TO WSS-NUM-AFIN IN WSS-FDC
                                            WSS-NUM-ATER IN WSS-VARI.

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.

      * Obtiene el Codigo Valor de Cambio de Pesos mediante el CIC de la moneda
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE PDB-CIC-0999   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
               PERFORM GNS-PRO-END.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS-VARI.
      *>>>>
           SORT GNSSRT
       COPY DAPRSFDC.
           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.
           PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
       FST-INP-SRT.
      *<<<< INI_FST_INP
      * Inicio de Ciclo Proceso para Registro VEN
      *Proceso normal de generacion de Sort.
           MOVE WSS-FEC-FPRI IN WSS-VARI TO VEN-FEC-FVEN IN VEN.
           MOVE 'VEN-FEC-FVEN' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR EN ACCESO A VEN ' FIO-STAT
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.
           IF VEN-FEC-FVEN IN VEN > WSS-FEC-FTER IN WSS-VARI
               DISPLAY 'NO EXISTEN REG. A FECHA DE PROCESO '
                                    WSS-FEC-FTER IN WSS-VARI
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT
           ELSE
               GO TO LUP-INP-SRT.
      *>>>>
           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
      * Proceso de Seleccion y Clasificacion a Partir del Registro OPD
      * Controla vigencia OPD
           IF VEN-VAL-SFIN = ZEROES
               GO TO NXT-INP-SRT.

           MOVE VEN-CIC-IOPD IN VEN TO OPD-CIC-IOPD IN OPD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
               DISPLAY 'NO EXISTE OPD PARA VEN ' FIO-STAT
                       'CIC ' OPD-CIC-IOPD IN OPD
               GO TO NXT-INP-SRT.

           IF WSS-COD-OFIC IN WSS-VARI NOT = '*'
               IF WSS-COD-OFIC IN WSS-VARI NOT = OPD-COD-OFIC IN OPD
                  GO TO NXT-INP-SRT.
 
           IF WSS-COD-VCAM IN WSS-VARI > SPACES AND
              WSS-COD-VCAM IN WSS-VARI NOT = '*'
              IF WSS-COD-VCAM IN WSS-VARI NOT = OPD-COD-VCAM IN OPD
                 GO TO NXT-INP-SRT.

           IF OPD-COD-STAT IN OPD NOT = 'G'
              GO TO NXT-INP-SRT.

      * Llena monto del campo Monto Final y Capital del reporte
           MOVE VEN-VAL-SCAP IN VEN TO SRT-VAL-SCAP IN SRT.
           MOVE VEN-VAL-SFIN IN VEN TO SRT-VAL-SFIN IN SRT.
      *>>>>
       MOV-INP-SRT.
       COPY DAPRMFDC.
           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
           MOVE 'VEN-FEC-FVEN' TO FIO-AKEY.
      *>>>>
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
      *<<<< FIN_NXT_INP
           IF VEN-FEC-FVEN IN VEN > WSS-FEC-FTER IN WSS-VARI
               GO TO FIN-INP-SRT.
      *>>>>
           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM DAP-FIO-VEN.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
           OPEN OUTPUT RPTFDC.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-FDC.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
      *<<<< FST_OUT
      *>>>>
       LUP-OUT-SRT.
      *<<<< LUP_OUT
      * Mediante BUS-TAB busca la glosa de la Clase de Operacion Deposito en la
      * tabla AUX
      *Recupera glosa de operacion
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'TIO' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-TOPD IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-DES1 IN WSS-VARI.
      *
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-COPD IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-DES2 IN WSS-VARI.
           MOVE WSS-GLS-DEST IN WSS-VARI TO
                                        WSS-GLS-COPD IN WSS-FDC.
      *>>>>
       GEN-OUT-SRT.
           GENERATE DL-FDC.
      *<<<< FIN_GEN_OUT
      *>>>>
       NXT-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.
           TERMINATE RPT-FDC.
           CLOSE RPTFDC.
       EXT-OUT-SRT.
           EXIT.

       COPY DAPBFVEN.
       COPY GNSBGDTC.
       COPY GNSBGIDD.
       COPY GNSBTABT.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.
       COPY GNSBGEND.

      *<<<< EOF
      *Entidades de TAB
       COPY TABBFCAM.
       COPY TABBFOFI.
       COPY TABBBOFI.
       COPY TABBVOFI.
      *Entidades de GNS
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBGCPT.
      *Entidades de OPD
       COPY DAPBFOPD.
      *>>>>
