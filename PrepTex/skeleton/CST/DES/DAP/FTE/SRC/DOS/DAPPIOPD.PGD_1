       IDENTIFICATION DIVISION.
      *========================
       PROGRAM-ID.   DAPPIOPD.
       AUTHOR.       CONSIST.
       DATE-WRITTEN. 21-Mar-00 01:04 PM.
      
      * NOMBRE PROGRAMA                   DAPPIOPD
      * VERSION                           3.1
      * OPCION                            CON
      * ARCHIVO BASE                      DAPOPD
      * PANTALLA                          DAPOPD
      * INP/OUT                           DATACOM
      * TAMANO COMMAREA                   250
      
      
       ENVIRONMENT DIVISION.
      *=====================
       CONFIGURATION SECTION.
      *----------------------
       SPECIAL-NAMES.
               DECIMAL-POINT IS COMMA.
      
       DATA DIVISION.
      *==============
      
       WORKING-STORAGE SECTION.
      *------------------------
      * COPY GNSWGSCR.
       COPY GNSWCSCR.
      * PTC-INI-AUT
      * COPY GNSWVSCR.
       COPY GNSWV3CR.
      * PTC-FIN-AUT
      *<<<< FIN_SCR_VARI
      * ISP: VARIABLES EN CMMA, COMUNES PARA ENGANCHE PROGRAMAS OPD-RCC-
       COPY DAPWGENG.
      * ISP: VARIABLES EN CMMA, COMUNES PARA PROGRAMAS PI,PQ,PU ( OPD )
       COPY DAPWG005.
      *>>>>
       COPY DAPWIOPD.
      
       COPY DAPBROPD.
      
       COPY GNSWVIDD.
       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSBRMSC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
      * PTC-INI-AUT
      * COPY GNSWGFRM.
       COPY GNSWG3CF.
       COPY GNSWGQUE.
       COPY GNSWGTSK.
      * PTC-FIN-AUT
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       COPY GNSWGIDC.
       COPY GNSWGSYS.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY TABBROFI.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY TABBRUSR.
      
      *<<<< WSS
      *JSS-INI 28-JUN-2002
       COPY DAPWG006.
       COPY USPC117.
      *JSS-FIN 28-JUN-2002
       COPY DAPBRMSC.
       COPY DAPBRPOD.
       COPY DAPBRCAD.
       COPY DAPBRRCC.
       COPY SGCBRDBC.
       COPY SGCBRRCD.
       COPY SGCBROPE.
       COPY DAPWGPMP.
       COPY GNSWGCPT.
       COPY GNSWGSTR.
       COPY GNSWGPES.
      
       77  WSS-CIC-CTAB-AUX          VALUE SPACES PIC X(06).
      
       01  WSS-VARI.
      * TRANSACCION A ENGANCHARSE PARA INGRESO
           03 WSS-ITRN        VALUE 'PU09'        PIC X(04).
           03 WSS-IPGM        VALUE 'DAPPUOPD'    PIC X(08).
      *>>>> END WSS
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-POD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPE-REQA==.
      *>>>> END WSS_DTC
       01  PGM-VARI.
           03 PGM-ICLR                  VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-TODO          VALUE ' '       PIC X(01).
           03 PGM-LIMPIAR-LLAVES        VALUE 'K'       PIC X(01).
           03 PGM-LIMPIAR-CAMPOS        VALUE 'F'       PIC X(01).
           03 PGM-NO-LIMPIAR-NADA       VALUE 'N'       PIC X(01).
           03 PGM-PROG                                  PIC X(08).
           03 PGM-NTRN                                  PIC X(04).
           03 PGM-STAT.
              05 PGM-STAT-OPD.
                 88 PGM-STAT-OPD-NUL    VALUE '  '.
                 07 PGM-STT1-OPD        VALUE '2' PIC X(01).
                    88 PGM-STAT-OPD-OKS VALUE '0'.
                 07 PGM-STT2-OPD        VALUE '3' PIC X(01).
              05 PGM-STAT-RCC.
                 88 PGM-STAT-RCC-NUL    VALUE '  '.
                 07 PGM-STT1-RCC        VALUE '2' PIC X(01).
                    88 PGM-STAT-RCC-OKS VALUE '0'.
                 07 PGM-STT2-RCC        VALUE '3' PIC X(01).
              05 PGM-STAT-CAD.
                 88 PGM-STAT-CAD-NUL    VALUE '  '.
                 07 PGM-STT1-CAD        VALUE '2' PIC X(01).
                    88 PGM-STAT-CAD-OKS VALUE '0'.
                 07 PGM-STT2-CAD        VALUE '3' PIC X(01).
              05 PGM-STAT-DBC.
                 88 PGM-STAT-DBC-NUL    VALUE '  '.
                 07 PGM-STT1-DBC        VALUE '2' PIC X(01).
                    88 PGM-STAT-DBC-OKS VALUE '0'.
                 07 PGM-STT2-DBC        VALUE '3' PIC X(01).
              05 PGM-STAT-RCD.
                 88 PGM-STAT-RCD-NUL    VALUE '  '.
                 07 PGM-STT1-RCD        VALUE '2' PIC X(01).
                    88 PGM-STAT-RCD-OKS VALUE '0'.
                 07 PGM-STT2-RCD        VALUE '3' PIC X(01).
           03 PGM-SRNF                  VALUE '23'      PIC X(02).
           03 PGM-SOKS                  VALUE '00'      PIC X(02).
           03 PGM-SNUL                  VALUE '  '      PIC X(02).
           03 PGM-SUAR                  VALUE SPACES    PIC X(15).
      
       LINKAGE SECTION.
      *----------------
       01  DFHCOMMAREA.
           02 FILLER                    PIC X(750).
      * DAPR0021-INI(ISP)  1-FEB-2000
      *<<<< BLLCELLS
       COPY DAPLGCCL.
      *>>>> BLLCELLS
      * DAPR0021-FIN(ISP)  1-FEB-2000
      
       PROCEDURE DIVISION.
      *===================
      
       MAIN SECTION.
       INI-MAIN.
           PERFORM INI.
       LUP-MAIN.
           IF SCR-INST = SCR-INST-HCM
                 PERFORM SCR-COM.
           IF SCR-CCPP = 'ING'
                 PERFORM SCR-ING
           ELSE
                 MOVE SCR-INST-HCM TO SCR-INST.
           GO TO LUP-MAIN.
       FIN-MAIN.
           EXIT.
      
       INI SECTION.
       INI-INI.
       COPY GNSBGEIB.
       COPY GNSBGEDB.
           MOVE LOW-VALUES TO OPD-FLD.
           MOVE LOW-VALUES TO OPD-EDT.
           PERFORM GNS-PRO-RCK.
      * PTC-INI-AUT
           PERFORM GNS-ERR-QUE.
           PERFORM GET-TSK-TERM.
      * PTC-FIN-AUT
           PERFORM GNS-BUS-VCA.
           MOVE +750 TO SCR-TCMA.
           PERFORM GNS-HDL-SYS.
           PERFORM GNS-HDL-FRM.
           MOVE 'DAPPIOPD' TO FIO-PROG.
           PERFORM GNS-BUS-IDD.
      *<<<< INI_FIO
      *     IF SCR-INST = SCR-INST-HKY
      *          PERFORM BUS-OFI-CSSN.
      
      * ASUME QUE VALOR DE CAMBIO VALE 1, PARA PODER MULTIPLICAR/DIVIDIR
      * SIN PREOCUPARSE DE LA MONEDA
           IF SCR-DESDE-CMN
               PERFORM GET-V001
               PERFORM BUS-OFI-CSSN
               PERFORM GET-SON
               PERFORM GET-TAD
               PERFORM GET-GARA-N
               PERFORM GET-CUST-E
               MOVE 1 TO SCR-SGV-VCAM
               MOVE SPACES TO SCR-OPD-VIGE
                              SCR-CIC-VCAM.
      
      * NO SE TOMAN LOS DATOS DESDE ARCHIVO RPF
           MOVE WSS-IPGM TO SCR-PROV.
           MOVE WSS-ITRN TO SCR-NTRV.
      
           IF SCR-DESDE-CMN
               MOVE 'O' TO SCR-IND-OOD
               MOVE 1 TO SCR-IPRO
           ELSE
               MOVE SCR-NEMO TO FRM-COD-OPCI IN OPD-FLD.
      *     ELSE
      *     IF SCR-INST-EXT = WSS-INST-FTER-CIC
      *         MOVE WSS-INST-NULL TO SCR-INST-EXT
      *         PERFORM ING-FTER-CIC.
       FIN-INI-FIO.
      *>>>> END INI_FIO
       FIN-INI.
           EXIT.
      
       COPY GNSBHSYS.
       COPY GNSBHFRM.
       COPY GNSBPRCK.
       COPY GNSBBVCA.
       COPY GNSBBIDD.
      
       SCR-COM SECTION.
       INI-SCR-COM.
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-CLRA-OPD.
           PERFORM EDT-KEY-OPD.
           PERFORM EDT-FLD-OPD.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-HCM TO SCR-INST.
           MOVE SCR-CMNP     TO SYS-PROG.
           MOVE SCR-VARI     TO SYS-CMMA.
           MOVE SCR-TCMA     TO SYS-TCMA.
           MOVE SYS-XCTL     TO SYS-CMND.
      * PTC-INI-AUT
           IF NOT SCR-OFRM-SRV
      * PTC-FIN-AUT
           PERFORM GNS-PRO-SYS.
       XCT-ERR.
           MOVE 'XCTERR    ' TO MSG-COD-MENS.
           MOVE 'GNS'        TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO SYS-MEN1.
           MOVE SYS-PROG     TO SYS-MEN2.
           MOVE SYS-ABOR     TO SYS-CMND.
      * PTC-INI-AUT
           IF NOT SCR-OFRM-SRV
      * PTC-FIN-AUT
           PERFORM GNS-PRO-SYS.
       COPY GNSBGGBK.
       FIN-SCR-COM.
           EXIT.
      
      
       SCR-ING SECTION.
       INI-SCR-ING.
           IF SCR-INST = SCR-INST-HKY
               PERFORM HBL-IKY
               MOVE SCR-INST-GKY TO SCR-INST
      * PTC-INI-AUT
               IF NOT SCR-OFRM-SRV
                   PERFORM SCR-DMSG
               ELSE
                   PERFORM SCR-PUTA
      * PTC-FIN-AUT
           ELSE
           IF SCR-INST = SCR-INST-GKY
                PERFORM SCR-RST
                PERFORM GET-IKY
                IF NOT FRM-STAT-ABT
                        MOVE SPACES TO FRM-MENS
                        PERFORM FND-KEY
                        IF NOT FIO-STAT-OKS AND
                           FIO-STAT NOT = FIO-STAT-NEX
      *JSS                  PERFORM CLR-FLD-OPD
                            MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
                            PERFORM SCR-TRL
                        ELSE
      * PTC-INI-AUT
                       MOVE 'S' TO SCR-IERR
      * PTC-FIN-AUT
                        MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR
                        IF FRM-MENS NOT > SPACES
                            MOVE 'REGEXI    ' TO MSG-COD-MENS
                            MOVE 'GNS' TO MSG-COD-SIST
                            PERFORM GET-MSG
                            MOVE MSG-GLS-DESC TO FRM-MENS
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-ING
                        ELSE
                            PERFORM SCR-MSSG
                            MOVE SCR-STAT-ABT TO SCR-STAT
                            PERFORM DESSCRTRL
                            GO TO FIN-SCR-ING
                ELSE
                        MOVE SPACES TO FRM-MENS
                        PERFORM SCR-MSSG
                        PERFORM DESSCRTRL
                        GO TO FIN-SCR-ING
           ELSE
           IF SCR-INST = SCR-INST-GAB
                PERFORM GET-CON.
           PERFORM DESSCRTRL.
       MSG-SCR-ING.
           MOVE SPACES TO FRM-MENS.
           PERFORM SCR-MSSG.
       FIN-SCR-ING.
           EXIT.
      
      
      
      
      
       SCR-DMSG SECTION.
       INI-SCR-DMSG.
           IF PGM-ICLR = PGM-NO-LIMPIAR-NADA
               NEXT SENTENCE
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-TODO
               PERFORM SCR-CLRA-OPD
               PERFORM EDT-KEY-OPD
               PERFORM EDT-FLD-OPD
           ELSE
           IF PGM-ICLR = PGM-LIMPIAR-LLAVES
               PERFORM CLR-KEY-OPD
               PERFORM EDT-KEY-OPD
           ELSE
               PERFORM CLR-FLD-OPD
               PERFORM EDT-FLD-OPD.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-DMSG.
           EXIT.
      
       SCR-KEY SECTION.
       INI-SCR-KEY.
           PERFORM SCR-RST.
           PERFORM GET-KEY.
           IF FRM-STAT-ABT
                   MOVE SPACES TO FRM-MENS
                   PERFORM SCR-MSSG
                   GO TO FIN-SCR-KEY.
       FND-SCR-KEY.
           MOVE SPACES TO FRM-MENS.
           PERFORM FND-KEY.
           IF FIO-STAT-OKS
               PERFORM PUT-SCR
               MOVE PGM-LIMPIAR-TODO TO PGM-ICLR
               GO TO FIN-SCR-KEY.
      *JSS ELSE
      *        PERFORM CLR-FLD-OPD.
       ERR-SCR-KEY.
      * PTC-INI-AUT
           MOVE 'S' TO SCR-IERR
      * PTC-FIN-AUT
           MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR.
           IF FRM-MENS NOT > SPACES
               IF FIO-STAT-EOF
                   MOVE 'REGEOF    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
               IF FIO-STAT = FIO-STAT-NEX
                   MOVE 'REGNEX    ' TO MSG-COD-MENS
                   MOVE 'GNS' TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
                   MOVE 'FIOSTAT' TO MSG-COD-TMSG
                   MOVE FIO-STAT  TO MSG-COD-CMSG
                   MOVE 'GNS'     TO MSG-COD-SIST
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
           MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-SCR-KEY.
           EXIT.
      
       SCR-RST SECTION.
       INI-SCR-RST.
           MOVE SPACES       TO PGM-ICLR.
           MOVE SPACES       TO SCR-ACTU.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
           MOVE LOW-VALUES   TO OPD-FLD.
       FIN-SCR-RST.
           EXIT.
      
       GET-KEY SECTION.
       INI-GET-KEY.
           PERFORM SCR-GKEY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-KEY.
           EXIT.
      
       GET-IKY SECTION.
       INI-GET-IKY.
           PERFORM SCR-GIKY.
           IF FRM-STAT-ABT
               MOVE SCR-STAT-ABT TO SCR-STAT.
       FIN-GET-IKY.
           EXIT.
      
       FND-KEY SECTION.
       INI-FND-KEY.
           PERFORM KEY-ALL-OPD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF FIO-STAT-OKS
               MOVE OPD-STP-ITRN IN OPD TO SCR-UMOD.
           MOVE FIO-STAT TO PGM-STAT-OPD.
       FIN-FND-KEY.
      * PTC-INI-AUT
           IF FIO-STAT = FIO-STAT-NEX
               MOVE 'S' TO SCR-IERR
      * PTC-FIN-AUT
           EXIT.
      
       PUT-SCR SECTION.
       INI-PUT-SCR.
           IF PGM-STAT-OPD-OKS
               MOVE OPD-STP-ITRN IN OPD TO SCR-UMOD.
           PERFORM PUT-ALL-OPD.
       FIN-PUT-SCR.
           EXIT.
      
       STP-EXIT SECTION.
       INI-STP-EXIT.
           MOVE SCR-PROG TO PGM-PROG.
           MOVE SCR-NTRN TO PGM-NTRN.
      
           MOVE SCR-PROV TO SCR-PROG.
           MOVE SCR-NTRV TO SCR-NTRN.
      
           MOVE PGM-PROG TO SCR-PROV
           MOVE PGM-NTRN TO SCR-NTRV.
       FIN-STP-EXIT.
           EXIT.
      
       SCR-EXIT SECTION.
       INI-SCR-EXIT.
           MOVE 'P'      TO SCR-ICMN.
           MOVE SCR-NTRN TO SYS-NTRN.
           MOVE SCR-VARI TO SYS-CMMA.
           MOVE SCR-TCMA TO SYS-TCMA.
           MOVE SYS-RTRN TO SYS-CMND.
      * PTC-INI-AUT
           IF NOT SCR-OFRM-SRV
      * PTC-FIN-AUT
           PERFORM GNS-PRO-SYS.
       FIN-SCR-EXIT.
           EXIT.
      
       SCR-PUTA SECTION.
       INI-SCR-PUTA.
      * PTC-INI-AUT
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               MOVE 'S' TO SCR-IERR.
      * PTC-FIN-AUT
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE OPD-FLD TO FRM-DFLD.
           MOVE FRM-PUT-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
       FIN-SCR-PUTA.
           EXIT.
      
       SCR-MSSG SECTION.
       INI-SCR-MSSG.
           IF FRM-MEN1 NOT > SPACES
               MOVE SPACES TO FRM-MEN1.
           IF FRM-MEN2 NOT > SPACES
               MOVE SPACES TO FRM-MEN2.
           MOVE FRM-MENS TO OPD-GLS-MENS.
       FIN-SCR-MSSG.
           EXIT.
      
       SCR-GKEY SECTION.
       INI-SCR-GKEY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-OPD
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO OPD-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GKEY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-OPD.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-OPD
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-OPD.
           PERFORM VAL-IKY-OPD.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-MKY-OPD.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-AKY-OPD.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GKEY.
           PERFORM VAL-CON-KEY-OPD.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GKEY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-OPD.
       ERR-SCR-GKEY.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-OPD.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GKEY.
           PERFORM SCR-MSSG.
      
       SCR-GIKY SECTION.
       INI-SCR-GIKY.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           MOVE SPACES TO FRM-MENS.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               PERFORM FST-KEY-OPD
               PERFORM SCR-MSSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO OPD-FLD.
           IF FRM-STAT-ABT
               GO TO FIN-SCR-GIKY.
           MOVE FRM-SUAR-OKS TO FRM-SUAR.
           PERFORM VAL-NUM-KEY-OPD.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               PERFORM SCR-MSSG
               PERFORM EDT-IKY-OPD
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
      *JSS
           PERFORM CLR-FLD-OPD.
           PERFORM VAL-IKY-OPD.
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR
               GO TO ERR-SCR-GIKY.
           PERFORM VAL-CON-IKY-OPD.
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )
               GO TO FIN-SCR-GIKY.
           IF FRM-UCUR NOT > SPACES
               PERFORM FST-KEY-OPD.
       ERR-SCR-GIKY.
           PERFORM SCR-MSSG.
           PERFORM EDT-IKY-OPD.
           PERFORM SCR-PUTA.
           PERFORM SCR-EXIT.
       FIN-SCR-GIKY.
           PERFORM SCR-MSSG.
      
       GET-CON SECTION.
       INI-GET-CON.
           MOVE SCR-NMAP TO FRM-NAME.
           MOVE SCR-NLIB TO FRM-NLIB.
           MOVE FRM-GET-ALL TO FRM-CMND.
           PERFORM GNS-PRO-FRM.
           IF NOT ( FRM-FFLD = FRM-FFLD-RET  OR FRM-FFLD-PF10 OR
                               FRM-FFLD-PF12 OR FRM-FFLD-PF3 )
               MOVE 'PFSINV    ' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO OPD-GLS-MEN2
               MOVE SCR-PRMT     TO OPD-GLS-MEN1
               PERFORM FST-MSG
               PERFORM SCR-PUTA
               PERFORM SCR-EXIT.
           MOVE FRM-DFLD TO OPD-FLD.
       FIN-GET-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.
      
       CLR-MSG SECTION.
       INI-CLR-MSG.
           MOVE SPACES TO OPD-GLS-MENS.
       FIN-CLR-MSG.
           EXIT.
      
       HBL-IKY SECTION.
       INI-HBL-IKY.
      *<<<< INI_HBL_IKY OR INI_HBL_KEY
           MOVE SPACES TO SCR-CIC-VCAM
                          SCR-IND-MCLI
                          SCR-IND-MCAD.
           MOVE 1      TO SCR-SGV-VCAM.
      *>>>>
      * PTC-INI-AUT
           IF NOT SCR-OFRM-SRV
      * PTC-FIN-AUT
           IF SCR-DESDE-CMN
               MOVE OPD-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO OPD-FLD
      * FLB  7-NOV-1994
               PERFORM CLR-KEY-OPD
      
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO OPD-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO OPD-GLS-MENS.
           PERFORM PRO-MKY-OPD.
           PERFORM PRO-AKY-OPD.
           PERFORM UNP-IKY-OPD.
           PERFORM FST-KEY-OPD.
       FIN-HBL-IKY.
           EXIT.
      
       HBL-KEY SECTION.
       INI-HBL-KEY.
      *<<<< INI_HBL_IKY OR INI_HBL_KEY
           MOVE SPACES TO SCR-CIC-VCAM
                          SCR-IND-MCLI
                          SCR-IND-MCAD.
           MOVE 1      TO SCR-SGV-VCAM.
      *>>>>
      * PTC-INI-AUT
           IF NOT SCR-OFRM-SRV
      * PTC-FIN-AUT
           IF SCR-DESDE-CMN
               MOVE OPD-GLS-MENS TO FRM-MENS
               MOVE LOW-VALUES TO OPD-FLD
               IF FRM-MENS < SPACES
                   MOVE LOW-VALUES TO OPD-GLS-MENS
               ELSE
                   MOVE FRM-MENS TO OPD-GLS-MENS.
           PERFORM UNP-KEY-OPD.
           PERFORM FST-KEY-OPD.
       FIN-HBL-KEY.
           EXIT.
      
       HBL-FLD SECTION.
       INI-HBL-FLD.
           PERFORM PRO-IKY-OPD.
           PERFORM PRO-AKY-OPD.
           PERFORM UNP-MKY-OPD.
           PERFORM UNP-FLD-OPD.
           PERFORM FST-FLD-OPD.
      *<<<< FIN_HBL_FLD
      * ISP: DAPBG003
           PERFORM MOV-POD.
      
           MOVE OPD-FEC-FCMP IN OPD-FLD TO OPD-FEC-FREA IN OPD-FLD.
           MOVE OPD-FEC-FCMP IN OPD-FLD TO OPD-FEC-FCTB IN OPD-FLD.
      
      * ISP: DAPBG002
           PERFORM PRO-OPD-POD.
           MOVE FRM-CPIM-UBY TO OPD-COD-TOPD-ATR IN OPD-FLD
                                OPD-COD-AOPD-ATR IN OPD-FLD
                                OPD-COD-VCAM-ATR IN OPD-FLD.
           MOVE 'N'   TO OPD-COD-IONP IN OPD-FLD.
      * JVM: Mantencion 11/06/1992
           IF OPD-NUM-RETD IN OPD-FLD > ZEROES
              MOVE 'D'   TO OPD-IND-RETD IN OPD-FLD.
      * JVM: Fin
      
      *JSS-INI 28-JUN-2002
      *Para el usuario centralizador no asumir oficina
      *    MOVE SCR-COD-OFIC TO OPD-COD-OFIC     IN OPD-FLD.
      *    MOVE FRM-CPIM-AEY TO OPD-COD-OFIC-ATR IN OPD-FLD.
           MOVE WSS-IDN-SIST            TO USP-SISTEMA.
           MOVE SPACES                  TO USP-PERMISO.
           MOVE 'DAP'                   TO USP-GRUPO.
           MOVE SCR-USER                TO USP-USUARIO.
           MOVE 'DAPUSERS/CEN'          TO USP-STRING.
           PERFORM USPC107.
           IF USP-PERMISO = 'P'
               MOVE SPACES       TO OPD-COD-OFIC     IN OPD-FLD
               MOVE FRM-CPIM-UBY TO OPD-COD-OFIC-ATR IN OPD-FLD
           ELSE
               MOVE SCR-COD-OFIC TO OPD-COD-OFIC     IN OPD-FLD
               MOVE FRM-CPIM-AEY TO OPD-COD-OFIC-ATR IN OPD-FLD.
      *JSS-FIN 28-JUN-2002
      *<<<< END FIN_HBL_FLD
       FIN-HBL-FLD.
           EXIT.
      
       FST-MSG SECTION.
       INI-FST-MSG.
           MOVE -1 TO OPD-GLS-MENS-LEN.
       FIN-FST-MSG.
           EXIT.
      
       PRO-ALL SECTION.
       INI-PRO-ALL.
           PERFORM PRO-KEY-OPD.
           PERFORM FST-MSG.
       FIN-PRO-ALL.
           EXIT.
      
       SCR-TRL SECTION.
       INI-SCR-TRL.
      * PTC-INI-AUT
           IF SCR-STAT NOT = SCR-STPP
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
      * PTC-FIN-AUT
           IF FRM-MEN1 NOT > SPACES
               MOVE SCR-PRMT TO FRM-MEN1.
           IF SCR-STAT = SCR-STAT-MOD
               PERFORM HBL-FLD
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-OPD
               PERFORM EDT-FLD-OPD
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GFL TO SCR-INST
               PERFORM SCR-EXIT.
           IF SCR-STAT = SCR-STAT-SON
               PERFORM PRO-ALL
               PERFORM SCR-MSSG
               PERFORM EDT-KEY-OPD
               PERFORM EDT-FLD-OPD
               PERFORM SCR-PUTA
               PERFORM STP-EXIT
               MOVE SCR-INST-GCS TO SCR-INST
               PERFORM SCR-EXIT.
      *ASUME SCR-STAT-CON.
           MOVE SCR-STAT-CON TO SCR-STAT.
      *    MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.
           PERFORM PRO-ALL.
           PERFORM SCR-MSSG.
           PERFORM EDT-KEY-OPD.
           PERFORM EDT-FLD-OPD.
           PERFORM SCR-PUTA.
           MOVE SCR-INST-GAB TO SCR-INST.
           PERFORM SCR-EXIT.
       FIN-SCR-TRL.
           EXIT.
      
       DESSCRTRL SECTION.
       INI-DESSCRTRL.
           MOVE SCR-VFLD-NOT TO SCR-VFLD.
           MOVE FRM-FFLD TO SCR-FFLD.
       FIN-DESSCRTRL.
           IF SCR-FFLD-PF10 OR SCR-FFLD-PF3
                 MOVE SCR-INST-HCM TO SCR-INST
           ELSE
                 MOVE SCR-INST-HKY TO SCR-INST.
       EXT-DESSCRTRL.
           EXIT.
      
      * PGM-EBR-ALL SECTION.
      * INI-PGM-EBR-ALL.
      *    MOVE FIO-EBR-ALL TO FIO-CMND.
      *    PERFORM DAP-FIO-OPD.
      *FIN-PGM-EBR-ALL.
      *    EXIT.
      
       COPY DAPBWOPD.
       COPY GNSBVNUM.
       COPY DAPBFOPD.
       COPY GNSBFMSG.
       COPY GNSBGSYS.
       COPY GNSBGDTC.
      * PTC-INI-AUT
      * COPY GNSBGFRM.
       COPY GNSBG3CF.
       COPY GNSBGQUE.
       COPY GNSBGTSK.
      * PTC-FIN-AUT
       COPY GNSBGMSG.
       COPY GNSBEKEY.
       COPY GNSBIABT.
       COPY GNSBBTAB.
       COPY GNSBVCOD.
       COPY GNSBVTAB.
       COPY GNSBFTAB.
       COPY GNSBBMSC.
       COPY GNSBVIND.
       COPY GNSBVMSC.
       COPY GNSBFMSC.
       COPY GNSBVIDC.
       COPY GNSBPVRF.
       COPY GNSBEGLS.
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY TABBFOFI.
       COPY TABBBUSR.
       COPY TABBVUSR.
       COPY TABBFUSR.
      
      *<<<< EOF
      
       BUS-OFI-CSSN SECTION.
       INI-BUS-OFI-CSSN.
      *ISP: ELIMINAR ESTE CODIGO AL ENTREGAR AL BANCO, SOLO PARA DESARRO
      *     IF SCR-IND-V001 = 'C'
                IF SCR-USER NOT > SPACES
                     MOVE 'RJUNCO' TO SCR-USER.
      
           MOVE SCR-USER TO USR-COD-USER IN USR.
           PERFORM VAL-USR.
           IF MSG-COD-MENS > SPACES
               MOVE 'USRCSSNNEX' TO MSG-COD-MENS
               PERFORM GOTO-CMN
           ELSE
               MOVE USR-COD-OFUS IN USR TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI
               IF MSG-COD-MENS > SPACES
                   MOVE 'OFICSSNNEX' TO MSG-COD-MENS
                   PERFORM GOTO-CMN
               ELSE
                   MOVE USR-COD-OFUS IN USR TO SCR-COD-OFIC.
       FIN-BUS-OFI-CSSN.
           EXIT.
      
       GET-SON SECTION.
       INI-GET-SON.
           MOVE 'GNS' TO TAB-COD-SIST.
           MOVE 'SON' TO TAB-CIC-TTAB IN TAB.
           MOVE 'S'   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               MOVE 'GNSSONSNEX' TO MSG-COD-MENS
               PERFORM GOTO-CMN
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO SCR-SON-S.
      
           MOVE 'GNS' TO TAB-COD-SIST.
           MOVE 'SON' TO TAB-CIC-TTAB IN TAB.
           MOVE 'N'   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               MOVE 'GNSSONNNEX' TO MSG-COD-MENS
               PERFORM GOTO-CMN
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO SCR-SON-N.
       FIN-GET-SON.
           EXIT.
      
       GET-TAD SECTION.
       INI-GET-TAD.
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'TAD' TO TAB-CIC-TTAB IN TAB.
           MOVE 'M'   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAPTADMNEX' TO MSG-COD-MENS
               PERFORM GOTO-CMN
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO SCR-TAD-M.
      
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'TAD' TO TAB-CIC-TTAB IN TAB.
           MOVE 'T'   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAPTADTNEX' TO MSG-COD-MENS
               PERFORM GOTO-CMN
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO SCR-TAD-T.
       FIN-GET-TAD.
           EXIT.
      
       GET-V001 SECTION.
       INI-GET-V001.
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'VSN' TO TAB-COD-TTAB IN TAB.
           MOVE '001' TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
      * ISP: VERSION 'B'ANCO
                MOVE 'B' TO SCR-IND-V001
           ELSE
      * ISP: VERSION 'C'ONSIST
                MOVE 'C' TO SCR-IND-V001.
      
       FIN-GET-V001.
           EXIT.
      
       GET-GARA-N SECTION.
       INI-GET-GARA-N.
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'GAR' TO TAB-CIC-TTAB IN TAB.
           MOVE 'N'   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAPGARN' TO MSG-COD-MENS
               PERFORM GOTO-CMN
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO SCR-COD-GARA-N.
       FIN-GET-GARA-N.
           EXIT.
      
       GET-CUST-E SECTION.
       INI-GET-CUST-E.
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'CUS' TO TAB-CIC-TTAB IN TAB.
           MOVE 'E'   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               MOVE 'CICCUSENEX' TO MSG-COD-MENS
               PERFORM GOTO-CMN
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO SCR-COD-CUST-E.
       FIN-GET-CUST-E.
           EXIT.
      
       GOTO-CMN SECTION.
       INI-GOTO-CMN.
           MOVE 'DAP' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           PERFORM SCR-MSSG.
           MOVE SCR-INST-HCM TO SCR-INST.
           PERFORM SCR-COM.
       FIN-GOTO-CMN.
           EXIT.
      
       COPY DAPBG001.
       COPY DAPBG002.
       COPY DAPBG003.
       COPY DAPBGMPT.
       COPY DAPBFPOD.
       COPY DAPBFCAD.
       COPY DAPBFRCC.
       COPY SGCBFDBC.
       COPY SGCBFRCD.
       COPY SGCBFOPE.
      *JSS-INI 28-JUN-2002
       USPC107 SECTION.
       INI-USPC107.
           COPY USPC107.
       FIN-USPC107.
           EXIT.
      *JSS-FIN 28-JUN-2002
      *>>>> END EOF
       COPY GNSBGVSM.
