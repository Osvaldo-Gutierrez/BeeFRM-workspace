       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      DAPPBGEN.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.      15-APR-1993 11:53:07

      * PROGRAMA GENERADOR DE RENOVACIONES SIN SORT.
      *  26-APR-1993 08:26:11 ONP MALA PARA OPERACIONES QUE
      * SON RENOVADAS POR BGEN
      * ==>> 28-JUL-1993 JVM: SE ELIMINAN DISPLAY INFORMATIVOS

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.

       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------

       WORKING-STORAGE SECTION.
      *-----------------------

       COPY GNSWGRQA.
       COPY GNSWGUIB.
       COPY GNSWGELS.
       COPY GNSWGIFD.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGSYS.
       COPY GNSWVNUM.
       COPY GNSWCNUM.
       COPY GNSWGPES.
       COPY GNSWGCPT.

      * Entidades de GNS
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAB-REQA==.
       COPY GNSBRTAB.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSG-REQA==.
       COPY GNSBRMSG.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSBRMSC.

       COPY GNSBRCIC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CIC-REQA==.
       COPY GNSWGCIC.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGINT.

      * Entidades de DAP
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPD-REQA==.
       COPY DAPBROPD.
       COPY DAPWIOPD.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCC-REQA==.
       COPY DAPBRRCC.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAD-REQA==.
       COPY DAPBRCAD.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PTD-REQA==.
       COPY DAPBRPTD.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==AUX-VEN-REQA==.
       COPY DAPBRVEN.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LIQ-REQA==.
       COPY DAPBRLIQ.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-ONP-REQA==.
       COPY DAPBRONP.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LIC-REQA==.
       COPY DAPBRLIC.

       COPY DAPBRMVO.
       COPY DAPBRGAR.
       COPY DAPBRIPA.
       COPY DAPWG004.
       COPY DAPWGATE.

      * Entidades de TAB
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
       COPY TABBRCAM.

      * Entidades de SGC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY SGCBRDBC.

       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCD-REQA==.
       COPY SGCBRRCD.

       01  SCR-VARI.
           02 SCR-CMND    VALUE 'ODL'   PIC X(03).
           02 SCR-CIC-VCAM.
              04 SCR-CIC-TVAL           PIC X(01).
              04 SCR-CIC-CVAL           PIC X(03).
              04 SCR-CIC-TCAM           PIC X(08).
           02 SCR-CIC-MORE              PIC X(02).
           02 SCR-CAPI   VALUE ZEROES   PIC S9(11)V9(05).
           02 SCR-INTE   VALUE ZEROES   PIC S9(11)V9(05).
           02 SCR-IDNI   VALUE ZEROES   PIC S9(11)V9(05).
           02 SCR-CSON-S  VALUE SPACES   PIC X(01).
           02 SCR-CGAR-N  VALUE SPACES   PIC X(01).
           02 SCR-CIC-CTBL VALUE SPACES PIC X(05).
           02 SCR-VAL-CAPI VALUE ZEROES PIC S9(11)V9(05).
           02 SCR-VAL-REAJ VALUE ZEROES PIC S9(11)V9(05).
           02 SCR-TAD-M    VALUE SPACES   PIC X(01).
           02 SCR-TAD-T    VALUE SPACES   PIC X(01).
           02 SCR-SGV-TPER VALUES ZEROES  PIC 9(03)V9(04).

       01  FRM-VARI.
           03 FRM-IFLD                PIC 9(05).
           03 FRM-MENS                PIC X(79).
           03 FRM-MENS-RED REDEFINES  FRM-MENS.
              05 FRM-MEN1             PIC X(40).
              05 FRM-MEN2             PIC X(39).
           03 FRM-SUAR                PIC X(03).
           03 FRM-SUAR-MAL            PIC X(3) VALUE 'MAL'.
           03 FRM-SUAR-WRN            PIC X(3) VALUE 'WRN'.
           03 FRM-SUAR-CLR            PIC X(3) VALUE 'CLR'.
           03 FRM-SUAR-OKS            PIC X(3) VALUE 'OKS'.

       01  POD.
      * ISP: TRUCO PARA NO MODIFICAR CODIGO DE PROGRAMA INTERACTIVO
           03 POD-COD-TINT                            PIC X(12).
       01  WSS-VARI.
           03 WSS-PROG                                PIC X(12).
           03 WSS-IND-TRC VALUE 'S'                   PIC X(001).
           03 TRC-GLS-MEN1                            PIC X(80).
           03 TRC-GLS-MEN2                            PIC X(80).
           03 WSS-CAI-ICIC.
              05 WSS-COD-TCIC                         PIC X(01).
              05 WSS-COD-CCIC                         PIC X(03).
           03 NEW-OPD-CIC-IOPD.
              05 NEW-OPD-CAI-IOPD                     PIC X(04).
              05 NEW-OPD-IIC-IOPD                     PIC X(08).
           03 NEW-OPD-CIC-ISER.
              05 NEW-OPD-CAI-ISER                     PIC X(04).
              05 NEW-OPD-IIC-ISER                     PIC X(08).
           03 BKP-KEY-IRCC      VALUE SPACES          PIC X(24).
           03 BKP-OPD-CIC-IOPD                        PIC X(12).
           03 WSS-VAL-FORI                            PIC S9(11)V9(05).
           03 WSS-VAL-CAPI      VALUE ZEROES          PIC S9(11)V9(04).
           03 WSS-VEN-VAL-CAPI                        PIC S9(11)V9(04).
           03 WSS-TRM-DIA                             PIC 9(04).
           03 WSS-TRM-MTO                             PIC 9(04).
           03 WSS-IND-TDIA                            PIC X(01).
           03 WSS-IND-TMTO                            PIC X(01).
           03 WSS-IDX-INT                             PIC 9(04).
           03 WSS-GLS-SECC                            PIC X(40).
           03 WSS-GLS-MEN1                            PIC X(80).
           03 WSS-GLS-MEN2                            PIC X(80).
           03 WSS-MOD-SERI                            PIC X(01).
           03 DSP-FIO-STAT          VALUE 'N'         PIC X(01).
              88 DESPLIEGA-FIO-STAT VALUE 'S'.
           03  WSS-STAT-VCAM        VALUE ZEROES     PIC 9(01).
           03  WSS-GEN-IPA          VALUE SPACES     PIC X(01).
           03  WSS-COD-IONP                          PIC X(01).
           03  WSS-NUM-DURV VALUE ZEROES             PIC 9(05).
           03  WSS-NUM-IVEN VALUE ZEROES             PIC 9(03).
           03  WSS-VAL-REAJ      VALUE ZEROES        PIC S9(11)V9(05).
           03  WSS-SGV-REAJ-1    VALUE ZEROES        PIC S9(11)V9(05).
           03  WSS-SGV-REAJ-2    VALUE ZEROES        PIC S9(11)V9(05).
      * ISP: VALOR DE CAMBIO FECHA SOLICITUD ANTICIPADA
           03 WSS-SGV-VCAM-FSLA  VALUE ZEROES        PIC S9(11)V9(05).
      * ISP: VALOR DE CAMBIO FECHA CAPTACION
           03 WSS-SGV-VCAM-FCAP  VALUE ZEROES        PIC S9(11)V9(05).
      * ISP: VALOR DE CAMBIO FECHA VENCIMIENTO
           03 WSS-SGV-VCAM-FVEN  VALUE ZEROES        PIC S9(11)V9(05).

      *
           03  WSS-COD-TPRO                          PIC X(03).
      *
      *FECHA INICIAL DE RANGO DE BUSQUEDA VENCIMIENTOS
           03  WSS-FEC-FINI.
               05  WSS-NUM-SINI                      PIC 9(02).
               05  WSS-NUM-AINI                      PIC 9(02).
               05  WSS-NUM-MINI                      PIC 9(02).
               05  WSS-NUM-DINI                      PIC 9(02).
      *FECHA FINAL DE RANGO DE BUSQUEDA BUSQUEDA ( FINI + TODOS
      *DIAS NO HABILES CONSECUTIVOS
           03  WSS-FEC-FTER.
               05  WSS-NUM-STER                      PIC 9(02).
               05  WSS-NUM-ATER                      PIC 9(02).
               05  WSS-NUM-MTER                      PIC 9(02).
               05  WSS-NUM-DTER                      PIC 9(02).

      *FECHA DE PROCESO VARIABLE SEGUN PRO-VEN
           03  WSS-FEC-FPRO.
               05  WSS-NUM-DPRO                      PIC 9(02).
               05  WSS-NUM-MPRO                      PIC 9(02).
               05  WSS-NUM-SPRO                      PIC 9(02).
               05  WSS-NUM-APRO                      PIC 9(02).

      *FECHA UNICA INGRESADA COMO PARAMETRO POR EL USUARIO ( DDMMSSAA )
           03  WSS-FEC-FBEG.
               05  WSS-NUM-DBEG                      PIC 9(02).
               05  WSS-NUM-MBEG                      PIC 9(02).
               05  WSS-NUM-SBEG                      PIC 9(02).
               05  WSS-NUM-ABEG                      PIC 9(02).

      * FOTO AL MOMENTO DE ACCEPT DE WSS-FEC-FBEG EN FORMATO
      * DE COMPARACION ( QUEDA FIJA ); SOLO COMPLETA VENCIMIENTOS
      * CON CONDICION VEN-FEC-FVEN <= WSS-FEC-FFIJ
           03  WSS-FEC-FFIJ.
               05  WSS-NUM-SFIJ                      PIC 9(02).
               05  WSS-NUM-AFIJ                      PIC 9(02).
               05  WSS-NUM-MFIJ                      PIC 9(02).
               05  WSS-NUM-DFIJ                      PIC 9(02).

      *FECHA PARA DESPLIEGUE
           03  WSS-FEC-FDSP.
               05  WSS-NUM-DDSP                      PIC 9(02).
               05  WSS-NUM-MDSP                      PIC 9(02).
               05  WSS-NUM-SDSP                      PIC 9(02).
               05  WSS-NUM-ADSP                      PIC 9(02).

      *FECHA INGRESADA COMO PARAMETRO ( SSAAMMDD )
      *     03  WSS-FEC-FTRA.
      *         05  WSS-NUM-STRA                      PIC 9(02).
      *         05  WSS-NUM-ATRA                      PIC 9(02).
      *         05  WSS-NUM-MTRA                      PIC 9(02).
      *         05  WSS-NUM-DTRA                      PIC 9(02).

      *FECHA TRABAJO
           03  WSS-FEC-FMOV.
               05  WSS-NUM-SMOV                      PIC 9(02).
               05  WSS-NUM-AMOV                      PIC 9(02).
               05  WSS-NUM-MMOV                      PIC 9(02).
               05  WSS-NUM-DMOV                      PIC 9(02).
           03  WSS-DMA-FMVO.
               05  WSS-NUM-DMVO                      PIC 9(02).
               05  WSS-NUM-MMVO                      PIC 9(02).
               05  WSS-NUM-AMVO.
                   07  WSS-NUM-AMVO-1                PIC 9(01).
                   07  WSS-NUM-AMVO-2                PIC 9(01).
           03  WSS-FEC-FMVO REDEFINES WSS-DMA-FMVO PIC 9(06).
           03  WSS-FEC-FREA                          PIC X(08).
           03  WSS-FEC-FVEN                          PIC X(08).
           03  WSS-FEC-FPCO                          PIC X(08).
           03  WSS-FEC-FCTB                          PIC X(08).
           03  WSS-FEC-FCMP                          PIC X(08).
           03  WSS-CIC-ISER                          PIC X(12).
           03  WSS-CIC-PER                           PIC X(01).
           03  WSS-DIA-HBL                           PIC 9(05).
           03  WSS-NUM-PER                           PIC 9(05).
           03  WSS-NDIA                              PIC 9(04).
           03 WSS-TVEN-1                             PIC 9(04).
      *    duracion vctos - 1o.
           03 WSS-DURV-1                             PIC 9(04).
           03 WSS-GLS-MRNG.
              05 WSS-GLS-1RNG                PIC X(30).
              05 WSS-GLS-2RNG                PIC ---.---.---.--9,9999.
              05 WSS-GLS-3RNG VALUE ' <--> ' PIC X(06).
              05 WSS-GLS-4RNG                PIC ---.---.---.--9,9999.
           03 WSS-COD-LIQ             VALUE ZEROES   PIC 9(01).
           03 WSS-STAT-REN            VALUE ZEROES   PIC 9(01).
           03 WSS-IOPD-X     VALUE '071099999999'    PIC X(12).
           03 WSS-IOPD-N              VALUE SPACES   PIC X(12).
           03 WSS-IOPD-A              VALUE SPACES   PIC X(12).
           03 WSS-IOPD-NEW            VALUE SPACES   PIC X(12).
           03 WSS-STAT-NEW            VALUE SPACES   PIC X(01).
           03 WSS-IOPD-ANT            VALUE SPACES   PIC X(12).
           03 WSS-STAT-ANT            VALUE SPACES   PIC X(01).
           03 WSS-STAT-RCC            VALUE ZEROES   PIC 9(01).
           03 WSS-IND-MCLI            VALUE SPACES   PIC X(01).
           03 WSS-GLS-COMU            VALUE SPACES   PIC X(20).
           03 WSS-CAD                                PIC X(96).
           03 WSS-RCC                                PIC X(92).
           03 WSS-BKP-OPD                            PIC X(12).
           03 WSS-BKP-VEN                            PIC X(15).
           03 WSS-BKP-CAD                            PIC X(16).
           03 WSS-BKP-RCC                            PIC X(24).
           03  WSS-COD-LUGA.
               05 WSS-IND-LUGA                       PIC 9(03).
               05 WSS-COD-PAIS                       PIC X(01).
           03  WSS-NUM-LUGA REDEFINES WSS-COD-LUGA PIC 9(04).
           03  WSS-COD-MONE.
               05 WSS-MSC-TVAL                       PIC X(01).
               05 WSS-COD-CVAL                       PIC X(03).
           03  WSS-NUM-MONE REDEFINES WSS-COD-MONE PIC 9(04).
           03 WSS-LEI-OPD             VALUE ZEROS    PIC 9(06).
           03 WSS-GEN-VEN             VALUE ZEROS    PIC 9(06).
           03 WSS-LIQ-FIJ             VALUE ZEROS    PIC 9(06).
           03 WSS-GEN-LIQ             VALUE ZEROS    PIC 9(06).
           03 WSS-GEN-CAD             VALUE ZEROS    PIC 9(06).
           03 WSS-VAL-IPES                          PIC S9(11).
           03 WSS-ICOR                VALUE 0        PIC 9(01).
              88 NO-ASIGNE-CORRELATIVO VALUE 0.
           03 WSS-LLAVE-ONP                         PIC X(12).
           03 WSS-CORRE-ONP                         PIC 9(03).
           03 WSS-CAMBIO-ONP                        PIC X(01).

       COPY GNSWGCVI.

       PROCEDURE DIVISION.
      *==================

       MAIN SECTION.
       INI-MAIN.
       COPY GNSBGEDB.
           MOVE 'DAPPBGEN' TO FIO-PROG
                              WSS-PROG.
           PERFORM BUS-FSIS.
       INI-INP-SRT.
           DISPLAY ' '.
           DISPLAY 'INICIO CAPTURA PARAMETROS '.
           PERFORM ELI-FICTICIA
           PERFORM GET-FHOY.
           PERFORM GET-CSON.
           PERFORM GET-CGAR.
           PERFORM GET-CTBL.
           PERFORM ACC-FBEG.
           DISPLAY ' '.
           DISPLAY 'FIN CAPTURA PARAMETROS '.

           MOVE FIO-UPD TO FIO-CMND.
           PERFORM DAP-FIO-OPD.

           MOVE FIO-UPD TO FIO-CMND.
           PERFORM DAP-FIO-VEN.

           MOVE FIO-UPD TO FIO-CMND.
           PERFORM DAP-FIO-LIQ.

           MOVE FIO-UPD TO FIO-CMND.
           PERFORM DAP-FIO-CAD.

           MOVE FIO-UPD TO FIO-CMND.
           PERFORM DAP-FIO-RCC.

           MOVE FIO-UPD TO FIO-CMND.
           PERFORM DAP-FIO-LIC.

           MOVE FIO-UPD TO FIO-CMND.
           PERFORM DAP-FIO-IPA.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO '
              DISPLAY ' ERROR EN APERTURA DAPIPA : ABORTO'
                                                 FIO-STAT
              PERFORM DAP-PRO-ABT.

           MOVE FIO-OUT TO FIO-CMND.
           PERFORM DAP-FIO-MVO.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO '
              DISPLAY ' ERROR EN APERTURA DAPMVO : ABORTO'
                                                FIO-STAT
              PERFORM DAP-PRO-ABT.

           MOVE FIO-OUT TO FIO-CMND.
           PERFORM DAP-FIO-GAR.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO '
              DISPLAY ' ERROR EN APERTURA DAPGAR : ABORTO'
                                                FIO-STAT
              PERFORM DAP-PRO-ABT.

       LUP-MAIN.
      *Proceso PRINCIPAL para controlar ejecucion DIARIA o
      *FESTIVOS y FIN DE SEMANA
           MOVE WSS-NUM-DINI TO VEN-NUM-DVEN IN VEN.
           MOVE WSS-NUM-MINI TO VEN-NUM-MVEN IN VEN.
           MOVE WSS-NUM-SINI TO VEN-NUM-SVEN IN VEN.
           MOVE WSS-NUM-AINI TO VEN-NUM-AVEN IN VEN.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'VEN-FEC-FVEN' TO FIO-AKEY.
           PERFORM DAP-FIO-VEN.
           PERFORM PRO-VEN  UNTIL
                    ( NOT FIO-STAT-OKS ) OR
                    ( VEN-FEC-FVEN IN VEN > WSS-FEC-FTER ).
       FIN-MAIN.
           DISPLAY ' FIN PROCESO '.
           DISPLAY ' '.
           DISPLAY '     '.
           DISPLAY 'TOTALES DE CONTROL DAPPBGEN '.
           DISPLAY '--------------------------- '.
           DISPLAY '     '.
           DISPLAY 'TOTAL OPERACIONES LEIDAS         : ' WSS-LEI-OPD.
           DISPLAY 'TOTAL VENCIMIENTOS GENERADOS     : ' WSS-GEN-VEN.
           DISPLAY 'TOTAL LIQUIDACIONES DAP FIJOS    : ' WSS-LIQ-FIJ.
           DISPLAY '     '.
           DISPLAY 'TOTAL LIQUIDACIONES GRABADAS     : ' WSS-GEN-LIQ.
           DISPLAY 'TOTAL CARGOS-ABONOS GRABADOS     : ' WSS-GEN-CAD.
           DISPLAY '     '.
           DISPLAY '     '.

           MOVE FIO-CLO TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM DAP-FIO-IPA.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM DAP-FIO-MVO.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM DAP-FIO-GAR.
           PERFORM GNS-PRO-END.

       PRO-VEN SECTION.
       INI-PRO-VEN.

      * ISP:  11-JAN-1993 18:25:44
           MOVE FIO-CHK-PNT TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           MOVE 'N' TO WSS-GEN-IPA.
           MOVE ADR-VEN-REQA TO AUX-VEN-REQA.

           MOVE VEN-FEC-FVEN IN VEN TO WSS-FEC-FVEN IN WSS-VARI.
           MOVE VEN-KEY-IVEN IN VEN TO WSS-BKP-VEN IN WSS-VARI.
           MOVE VEN-CIC-IOPD IN VEN TO OPD-CIC-IOPD IN OPD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO '
              DISPLAY ' ERROR AL LEER OPD (PRO-VEN) '
                        OPD-CIC-IOPD IN OPD ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.

           ADD 1 TO WSS-LEI-OPD IN WSS-VARI.

           IF OPD-COD-STAT IN OPD NOT = 'G'
               GO TO END-PRO-VEN.

           MOVE OPD-KEY-IOPD IN OPD TO WSS-BKP-OPD IN WSS-VARI.

           IF OPD-VAL-SCAP IN OPD = ZEROES
               GO TO END-PRO-VEN.


      * Carga interfaz de intereses ganados o pagados
           MOVE 'S' TO WSS-GEN-IPA.
           IF VEN-COD-STAT IN VEN NOT = 'N'
               PERFORM PRO-IPA.

           PERFORM GET-COD-CIC-OPD.


      *ISP DETECTA TIPO DE OPERACION A PROCESAR FIJA C/R, FIJA S/R,
      *    RENOVABLES
           IF OPD-COD-RENO IN OPD NOT = SCR-CSON-S
              IF OPD-FEC-FTER IN OPD NOT = VEN-FEC-FVEN IN VEN
                 PERFORM PRO-FICR
              ELSE
                 PERFORM PRO-FISR
           ELSE
               PERFORM PRO-REN.
       END-PRO-VEN.
           MOVE AUX-VEN-REQA   TO ADR-VEN-REQA.
           MOVE FIO-KDEF-S     TO FIO-KDEF.
           MOVE 'VEN-FEC-FVEN' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
       FIN-PRO-VEN.
           EXIT.

       PRO-FICR SECTION.
       INI-PRO-FICR.
      *     DISPLAY ' '.
      *     DISPLAY '>> OPD SELECCIONADA (FIJA C/R) : '
      *        OPD-CAI-IOPD IN OPD ' - ' OPD-IIC-IOPD IN OPD.
      *     DISPLAY ' '.

      *LEE DE UPD VEN Y OPD
           MOVE WSS-BKP-VEN IN WSS-VARI TO VEN-KEY-IVEN IN VEN.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN PRO-FICR '
              DISPLAY ' ERROR NO EXISTE VENCIMIENTO YA SELECCIONADO '
                        VEN-KEY-IVEN IN VEN ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.

           MOVE WSS-BKP-OPD IN WSS-VARI TO OPD-KEY-IOPD IN OPD.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN PRO-FICR '
              DISPLAY ' ERROR NO EXISTE OPERACION YA SELECCIONADA '
                        OPD-KEY-IOPD IN OPD ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.

      * OBTENER VALOR DE CAMBIO
      * SOLO PARA MONEDA REAJUSTABLE, CHILENA Y NO PESOS
           IF ( SCR-CIC-TVAL = PDB-CIC-MNAC AND
                SCR-CIC-VCAM NOT = PDB-CIC-0999 )
                 PERFORM LIQ-OBT-VCAM
           ELSE
                MOVE ZEROES TO WSS-STAT-VCAM.

           IF WSS-STAT-VCAM > ZEROES
              MOVE 'T' TO LIQ-COD-STAT IN LIQ
              GO TO GEN-RTR.

           IF ( OPD-COD-IONP IN OPD = SCR-CSON-S OR
                OPD-COD-GARA IN OPD NOT = SCR-CGAR-N OR
      *JUS 6-NOV-1995
                OPD-COD-CUST IN OPD = 'S' )
              MOVE 'T' TO LIQ-COD-STAT IN LIQ
              GO TO GEN-RTR.

           PERFORM GET-CUR-AUT.
           IF FIO-STAT-OKS
              MOVE 'A' TO LIQ-COD-STAT IN LIQ
           ELSE
              MOVE 'S' TO LIQ-COD-STAT IN LIQ.

       GEN-RTR.
      *GENERA LIQ ASOCIADA A VENCIMIENTO
           IF VEN-VAL-SFIN IN VEN > ZEROES OR
              VEN-VAL-IDNI IN VEN > ZEROES
              MOVE 'LR' TO LIQ-COD-LIQU IN LIQ
              PERFORM PUT-CMN-LIQ
              PERFORM GEN-CAD-LIQ
      * DETERMINAR FORMA DE ABONO
              IF LIQ-COD-STAT IN LIQ = 'A'
                 PERFORM PUT-MVO
              ELSE
      * GENERA LIC ASOCIADA A VENCIMIENTO
              IF LIQ-COD-STAT IN LIQ = 'S'
                  PERFORM GEN-LIC.

      *LIQUIDA VENCIMIENTO ACTUAL
           MOVE ZEROES  TO VEN-VAL-SCAP IN VEN
                           VEN-VAL-SFIN IN VEN.

           IF OPD-NUM-VNLQ IN OPD = 1
              MOVE 'L' TO OPD-COD-STAT IN OPD
              MOVE ZEROES TO OPD-VAL-SCAP IN OPD
              PERFORM PRO-LOAD-IPA
              GO TO GEN-VEN.

           COMPUTE OPD-VAL-SCAP IN OPD =
                      OPD-VAL-SCAP IN OPD - VEN-VAL-CAPI IN VEN
                    + VEN-VAL-IDNI IN VEN.

           PERFORM PRO-LOAD-IPA.

           SUBTRACT 1 FROM OPD-NUM-VNLQ IN OPD.
           ADD      1   TO OPD-NUM-VSLQ IN OPD.
           ADD      1   TO OPD-NUM-IVEN IN OPD.
      *GENERA PROXIMO VENCIMIENTO
           PERFORM GEN-PRX-RTR.

       GEN-VEN.
      *ACTUALIZA VEN Y OPD
           PERFORM PRO-ACT.
       FIN-PRO-FICR.
           EXIT.

       PRO-FISR SECTION.
       INI-PRO-FISR.
      *     DISPLAY ' '.
      *     DISPLAY '++ OPD A LIQUIDAR             : '
      *        OPD-CAI-IOPD IN OPD ' - ' OPD-IIC-IOPD IN OPD.

      *LEE DE UPD VEN Y OPD
           MOVE WSS-BKP-VEN IN WSS-VARI TO VEN-KEY-IVEN IN VEN.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN PRO-FISR '
              DISPLAY ' ERROR NO EXISTE VENCIMIENTO YA SELECCIONADO '
                        VEN-KEY-IVEN IN VEN ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.

           MOVE WSS-BKP-OPD IN WSS-VARI TO OPD-KEY-IOPD IN OPD.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN PRO-FISR '
              DISPLAY ' ERROR NO EXISTE OPERACION YA SELECCIONADA '
                        OPD-KEY-IOPD IN OPD ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.

      * OBTENER VALOR DE CAMBIO
      * SOLO PARA MONEDA REAJUSTABLE, CHILENA Y NO PESOS
           IF ( SCR-CIC-TVAL = PDB-CIC-MNAC AND
                SCR-CIC-VCAM NOT = PDB-CIC-0999 )
                 PERFORM LIQ-OBT-VCAM
           ELSE
                MOVE ZEROES TO WSS-STAT-VCAM.

           IF WSS-STAT-VCAM > ZEROES
              MOVE 'T' TO LIQ-COD-STAT IN LIQ
              GO TO GEN-FIJ.

           IF ( OPD-COD-IONP IN OPD = SCR-CSON-S OR
                OPD-COD-GARA IN OPD NOT = SCR-CGAR-N OR
      *JUS 6-NOV-1995
                OPD-COD-CUST IN OPD = 'S' )
              MOVE 'T' TO LIQ-COD-STAT IN LIQ
              GO TO GEN-FIJ.

           PERFORM GET-CUR-AUT.
           IF FIO-STAT-OKS
              MOVE 'A' TO LIQ-COD-STAT IN LIQ
           ELSE
              MOVE 'S' TO LIQ-COD-STAT IN LIQ.

       GEN-FIJ.
      *GENERA LIQ ASOCIADA A VENCIMIENTO
           IF VEN-VAL-SFIN IN VEN > ZEROES
              MOVE 'LT' TO LIQ-COD-LIQU IN LIQ
              PERFORM PUT-CMN-LIQ
              PERFORM GEN-CAD-LIQ
      * DETERMINAR FORMA DE ABONO
              IF LIQ-COD-STAT IN LIQ = 'A'
                 PERFORM PUT-MVO
              ELSE
      * GENERA LIC ASOCIADA A VENCIMIENTO
              IF LIQ-COD-STAT IN LIQ = 'S'
                 PERFORM GEN-LIC.

      *ACTUALIZA VEN Y OPD
           SUBTRACT 1 FROM OPD-NUM-VNLQ IN OPD.
           ADD      1   TO OPD-NUM-VSLQ IN OPD.
           ADD      1   TO OPD-NUM-IVEN IN OPD.
           MOVE 'L'     TO OPD-COD-STAT IN OPD.
           MOVE ZEROES  TO OPD-VAL-SCAP IN OPD.
           PERFORM PRO-LOAD-IPA.
           MOVE ZEROES  TO VEN-VAL-SCAP IN VEN
                           VEN-VAL-SFIN IN VEN.

      *ACTUALIZA VEN Y OPD
           PERFORM PRO-ACT.
      *     DISPLAY '++ OPD LIQUIDADA OK           : '.
       FIN-PRO-FISR.
           EXIT.

       PRO-REN SECTION.
       INI-PRO-REN.
      * JVM: VERIFICA SI OPERACION GENERADA ESTA INCOMPLETA
      * JVM: CANDIDATO A COMPLETARSE
           IF VEN-COD-STAT IN VEN = 'N'
      * ISP: ANTIGUA MODALIDAD
      *         IF VEN-FEC-FVEN IN VEN = WSS-FEC-FTRA
               IF VEN-FEC-FVEN IN VEN NOT > WSS-FEC-FFIJ
                   PERFORM CPL-VEN
                   GO TO FIN-PRO-REN
               ELSE
                   GO TO FIN-PRO-REN.

      *     DISPLAY ' '.
      *     DISPLAY '>> OPD A RENOVAR              : '
      *        OPD-CAI-IOPD IN OPD ' - ' OPD-IIC-IOPD IN OPD.

      * ISP: RESPALDA OPERACION PARA RESTAURAR DESPUES DE GRABAR
      *      NUEVA
           MOVE OPD-CIC-IOPD IN OPD TO BKP-OPD-CIC-IOPD.
           MOVE OPD-CIC-IOPD IN OPD TO WSS-IOPD-A.

      *GET-CIC Obtener CIC PARA CENTRO DE ASIGNACION NUMERO OPD
           MOVE OPD-CAI-IOPD IN OPD TO WSS-CAI-ICIC.
           MOVE '1'                 TO WSS-COD-TCIC.
           MOVE WSS-CAI-ICIC        TO CIC-CAI-ICIC IN CIC.
           MOVE CIC-GET TO CIC-CMND.
           PERFORM PRO-CIC.
           IF CIC-STAT NOT = CIC-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN PRO-REN '
              DISPLAY ' ERROR OBTENCION DE CIC PARA RENOVACION: '
                        CIC-CAI-ICIC
              PERFORM DAP-PRO-ABT
           ELSE
               MOVE CIC-CIC-ICIC TO NEW-OPD-CIC-IOPD
               MOVE CIC-CIC-ICIC TO WSS-IOPD-N.

      *     DISPLAY '>> OPD DE RESPALDO            : '
      *        NEW-OPD-CAI-IOPD ' - ' NEW-OPD-IIC-IOPD.

      *GET-CIC Obtener CIC PARA CENTRO ASIGNACION SERIAL
           MOVE OPD-CAI-IOPD IN OPD TO WSS-CAI-ICIC.
           MOVE '1'                 TO WSS-COD-TCIC.
           MOVE WSS-CAI-ICIC        TO CIC-CAI-ICIC IN CIC.
           MOVE CIC-GET TO CIC-CMND.
           PERFORM PRO-CIC.
           IF CIC-STAT NOT = CIC-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN PRO-REN '
              DISPLAY ' ERROR OBTENCION DE CIC DE SERIAL PARA'
                      ' RENOVACION: ' CIC-CAI-ICIC
              PERFORM DAP-PRO-ABT
           ELSE
               MOVE CIC-CIC-ICIC TO NEW-OPD-CIC-ISER.

      * JVM: Efectua proceso de Renovacion con BACKOUT en caso de error
           PERFORM PRO-REN-BCK.
           IF WSS-GLS-MEN1 > SPACES
               PERFORM DSP-MENS
               MOVE FIO-BCK-OUT TO FIO-CMND
               PERFORM DAP-FIO-OPD
               PERFORM ELI-FICTICIA
               PERFORM DAP-PRO-ABT
           ELSE
               MOVE FIO-CHK-PNT TO FIO-CMND
               PERFORM DAP-FIO-OPD.
       FIN-PRO-REN.
           EXIT.

       PRO-REN-BCK SECTION.
       INI-PRO-REN-BCK.
           MOVE 'N' TO WSS-MOD-SERI.
           MOVE SPACES TO WSS-GLS-MEN1  WSS-GLS-MEN2.

           MOVE 'I'          TO OPD-COD-TACC IN OPD.
           MOVE 'B'          TO OPD-COD-OTRN IN OPD.
           MOVE WSS-PROG     TO OPD-COD-ATRN IN OPD.
           MOVE HOY-STP-ITRN TO OPD-STP-ITRN IN OPD.

           MOVE NEW-OPD-CIC-IOPD    TO OPD-CIC-IOPD IN OPD.
           MOVE 'G'                 TO OPD-COD-STAT IN OPD.

           MOVE ZEROES TO OPD-NUM-VSLQ IN OPD.

           MOVE ZEROES              TO OPD-NUM-VSLQ IN OPD.
           IF OPD-NUM-VNLQ IN OPD = 1
               MOVE OPD-IND-DURV IN OPD TO MSC-COD-CMSC IN MSC
               PERFORM OBT-CIC-PER
               MOVE OPD-NUM-DURV IN OPD TO WSS-NUM-DURV.

       CIC-BUS-VEN.
           MOVE WSS-NUM-DURV        TO WSS-NUM-PER.
           MOVE OPD-NUM-DTER IN OPD TO FEC-ITM1.
           MOVE OPD-NUM-MTER IN OPD TO FEC-ITM2.
           MOVE OPD-NUM-STER IN OPD TO FEC-ITM3.
           MOVE OPD-NUM-ATER IN OPD TO FEC-ITM4.
           PERFORM SEL-PER.
      *     DISPLAY 'FECHA VENCIMIENTO PARA RENOVAR : ' FEC-FECH.
      *     DISPLAY ' '.

           IF OPD-COD-AFER IN OPD = SCR-CSON-S
      *VAL-FEC Validar Fecha ( SI ANALISIS DE FERIADO, BUSCA PROXIMO HAB
               MOVE FEC-FORM-FEC TO FEC-FORM
               MOVE FEC-FBLK-N   TO FEC-FBLK
               MOVE FEC-CHOY-N   TO FEC-CHOY
               MOVE FEC-VHBL-S   TO FEC-VHBL
               MOVE FEC-VAL-FEC  TO FEC-CMND
               PERFORM PRO-FEC
               IF NOT FEC-STAT-HBL
                    ADD 1 TO WSS-NUM-DURV
                    GO TO CIC-BUS-VEN.

           MOVE FEC-ITM1 TO OPD-NUM-DPVC IN OPD.
           MOVE FEC-ITM2 TO OPD-NUM-MPVC IN OPD.
           MOVE FEC-ITM3 TO OPD-NUM-SPVC IN OPD.
           MOVE FEC-ITM4 TO OPD-NUM-APVC IN OPD.
           MOVE OPD-FEC-FPVC IN OPD TO OPD-FEC-FTER IN OPD.

      * ISP: FECHA CAPTACION = FECHA OPD QUE VENCE
           MOVE VEN-FEC-FVEN IN VEN TO OPD-FEC-FCMP IN OPD
                                       OPD-FEC-FREA IN OPD
                                       OPD-FEC-FCTB IN OPD.

           MOVE VEN-VAL-SFIN IN VEN TO OPD-VAL-CAPT IN OPD
                                       OPD-VAL-SCAP IN OPD.
      *LRH ini 27-OCT-1994
           IF SCR-CIC-TVAL = PDB-CIC-MNAC AND
              SCR-CIC-VCAM NOT = PDB-CIC-0999
               PERFORM VCAM-FVEN
               IF WSS-STAT-VCAM NOT = 1
                   MULTIPLY OPD-VAL-CAPT IN OPD BY
                            WSS-SGV-VCAM-FVEN   GIVING
                            WSS-VAL-IPES        ROUNDED
                   MOVE WSS-VAL-IPES TO OPD-VAL-IPES IN OPD
               ELSE
                   DISPLAY 'NO SE ENCONTRO VALOR DE CAMBIO'
           ELSE
               MOVE OPD-VAL-CAPT IN OPD TO OPD-VAL-IPES IN OPD.
      *LRH fin 27-OCT-1994

           MOVE NEW-OPD-CAI-IOPD TO OPD-CAI-GREN.
           MOVE NEW-OPD-IIC-IOPD TO OPD-IIC-GREN.

           MOVE 1                   TO OPD-NUM-IVEN IN OPD.

           MOVE ZEROES              TO OPD-SGV-SPRD IN OPD
                                       OPD-SGV-TINT IN OPD
                                       OPD-SGV-MPRE IN OPD
                                       OPD-VAL-INTD IN OPD
                                       OPD-VAL-SINT IN OPD.

           MOVE OPD-FEC-FPCO IN OPD TO WSS-FEC-FPCO IN WSS-VARI.
           PERFORM PUT-OPD-OPD.
           MOVE OPD-CAI-ISER IN OPD-FLD TO OPD-CAI-ISER IN OPD.
           MOVE OPD-IIC-ISER IN OPD-FLD TO OPD-IIC-ISER IN OPD.
           MOVE WSS-FEC-FPCO IN WSS-VARI TO OPD-FEC-FPCO IN OPD.
      *
      * BCI  (CPZ 16.07.93) MUEVE ESPACIOS A USUARIO TASA ESPECIAL
      * EN RENOVACION
           MOVE SPACES                  TO OPD-COD-EATE IN OPD.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
               MOVE 'ERROR AL GENERAR OPERACION A RENOVAR'
                     TO WSS-GLS-MEN1
               MOVE OPD-KEY-IOPD IN OPD TO WSS-GLS-MEN2
               GO TO FIN-PRO-REN-BCK.

           PERFORM PRO-LOAD-IPA.

           MOVE NEW-OPD-CIC-IOPD    TO VEN-CIC-IOPD IN VEN.
           MOVE 1                   TO VEN-NUM-IVEN IN VEN.
           MOVE HOY-STP-ITRN        TO VEN-STP-ITRN IN VEN.
           MOVE 'I'                 TO VEN-COD-TACC IN VEN.
           MOVE 'B'                 TO VEN-COD-OTRN IN VEN.
           MOVE 'N'                 TO VEN-COD-STAT IN VEN.
           MOVE WSS-PROG            TO VEN-COD-ATRN IN VEN.
           MOVE WSS-FEC-FVEN        TO VEN-FEC-FVEN IN VEN.
           MOVE OPD-VAL-CAPT IN OPD TO VEN-VAL-CAPI IN VEN.
           MOVE OPD-VAL-CAPT IN OPD TO VEN-VAL-SCAP IN VEN.
           MOVE ZEROES              TO VEN-VAL-IDNI IN VEN.

           MOVE ZEROES TO VEN-VAL-FINA IN VEN
                          VEN-VAL-SFIN IN VEN.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
               MOVE 'ERROR AL GENERAR VENCIMIENTO A RENOVAR'
                       TO WSS-GLS-MEN1
               MOVE VEN-KEY-IVEN IN VEN TO WSS-GLS-MEN2
               GO TO FIN-PRO-REN-BCK.
           ADD 1 TO WSS-GEN-VEN.

           PERFORM CREA-CAD.
           IF WSS-GLS-MEN1 > SPACES
              GO TO FIN-PRO-REN-BCK.
           PERFORM CREA-RCC.
           IF WSS-GLS-MEN1 > SPACES
              GO TO FIN-PRO-REN-BCK.
           IF OPD-COD-IONP IN OPD = SCR-CSON-S
              PERFORM CREA-ONP
              IF WSS-GLS-MEN1 > SPACES
                 GO TO FIN-PRO-REN-BCK.

      *JVM Informa Cambios de Capital a Sistema Garantias
           PERFORM PUT-GAR.
           IF WSS-GLS-MEN1 > SPACES
              GO TO FIN-PRO-REN-BCK.

      *JVM INVIERTE N. OPER DE TODAS LAS ENTIDADES ASOCIADAS
      * Copia (OPD,CAD,RCC,VEN)(ANT)(G) --> (OPD,CAD,RCC,VEN)(PASO)(G) y
      * elimina (OPD,CAD,RCC,VEN)(ANT)(G)
           MOVE WSS-IOPD-X IN WSS-VARI TO WSS-IOPD-NEW IN WSS-VARI.
           MOVE 'G'                    TO WSS-STAT-NEW IN WSS-VARI.
           MOVE WSS-IOPD-A IN WSS-VARI TO WSS-IOPD-ANT IN WSS-VARI.
           MOVE 'G'                    TO WSS-STAT-ANT IN WSS-VARI.
           MOVE 'S' TO WSS-MOD-SERI.
           PERFORM ACT-OPD-REN.
           MOVE 'N' TO WSS-MOD-SERI.
           IF WSS-STAT-REN IN WSS-VARI NOT = 0
              MOVE ' ERROR EN RUTINA RENOVACION OPD '
                     TO WSS-GLS-MEN1
              GO TO FIN-PRO-REN-BCK.

      *JVM Copia (OPD,CAD,RCC,VEN)(NEW)(G) --> (OPD,CAD,RCC,VEN)(ANT)(G)
      *    elimina (OPD,CAD,RCC,VEN)(NEW)(G)
           MOVE WSS-IOPD-A IN WSS-VARI TO WSS-IOPD-NEW IN WSS-VARI.
           MOVE 'G'                    TO WSS-STAT-NEW IN WSS-VARI.
           MOVE WSS-IOPD-N IN WSS-VARI TO WSS-IOPD-ANT IN WSS-VARI.
           MOVE 'G'                    TO WSS-STAT-ANT IN WSS-VARI.
           PERFORM ACT-OPD-REN.
           IF WSS-STAT-REN IN WSS-VARI NOT = 0
              MOVE ' ERROR EN RUTINA RENOVACION OPD '
                     TO WSS-GLS-MEN1
              GO TO FIN-PRO-REN-BCK.

      *JVM Copia (OPD,CAD,RCC,VEN)(PASO)(G) --> (OPD,CAD,RCC,VEN)(NEW)(L
      *    elimina (OPD,CAD,RCC,VEN)(PASO)(G)
           MOVE WSS-IOPD-N IN WSS-VARI TO WSS-IOPD-NEW IN WSS-VARI.
           MOVE 'L'                    TO WSS-STAT-NEW IN WSS-VARI.
           MOVE WSS-IOPD-X IN WSS-VARI TO WSS-IOPD-ANT IN WSS-VARI.
           MOVE 'G'                    TO WSS-STAT-ANT IN WSS-VARI.
           PERFORM ACT-OPD-REN.
           IF WSS-STAT-REN IN WSS-VARI NOT = 0
              MOVE ' ERROR EN RUTINA RENOVACION OPD '
                     TO WSS-GLS-MEN1.
      *     ELSE
      *        DISPLAY '>> OPD RENOVADA OK'.
       FIN-PRO-REN-BCK.
           EXIT.

       CPL-VEN SECTION.
       INI-CPL-VEN.
      *LEE DE UPD VEN Y OPD
           MOVE WSS-BKP-VEN IN WSS-VARI TO VEN-KEY-IVEN IN VEN.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN CPL-VEN '
              DISPLAY ' ERROR NO EXISTE VENCIMIENTO YA SELECCIONADO: '
                        VEN-KEY-IVEN IN VEN ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.

      *     DISPLAY ' '.
      *     DISPLAY '$$ OPD A COMPLETAR            : '
      *        VEN-CAI-IOPD IN VEN ' - ' VEN-IIC-IOPD IN VEN.

           MOVE WSS-BKP-OPD IN WSS-VARI TO OPD-KEY-IOPD IN OPD.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN CPL-VEN '
              DISPLAY ' ERROR NO EXISTE OPERACION YA SELECCIONADA: '
                        OPD-KEY-IOPD IN OPD ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.

           PERFORM PUT-OPD-OPD.

      * ISP: PARA NO MODIFICAR CODIGO DE PROGRAMA INTERACTIVO
           MOVE OPD-COD-TINT IN OPD TO POD-COD-TINT IN POD.

      * ISP: SIEMPRE RESPETA LA TASA
           IF OPD-SGV-TINT IN OPD NOT > ZEROES
               PERFORM VAL-OPD-SGV-TINT
               IF FRM-SUAR = FRM-SUAR-MAL
                   DISPLAY ' '
                   DISPLAY ' PROCESO CANCELADO EN CPL-VEN '
                   DISPLAY ' ERROR EN VALIDACION OPD-SGV-TINT '
                                                     FRM-MENS
                   PERFORM DAP-PRO-ABT
               ELSE
                   MOVE OPD-SGV-TINT IN OPD-FLD TO
                   OPD-SGV-TINT IN OPD.

           MOVE OPD-NUM-DREA IN OPD TO INT-DUNO.
           MOVE OPD-NUM-MREA IN OPD TO INT-MUNO.
           MOVE OPD-NUM-SREA IN OPD TO INT-SUNO.
           MOVE OPD-NUM-AREA IN OPD TO INT-AUNO.

           MOVE OPD-NUM-DPVC IN OPD TO INT-DDOS.
           MOVE OPD-NUM-MPVC IN OPD TO INT-MDOS.
           MOVE OPD-NUM-SPVC IN OPD TO INT-SDOS.
           MOVE OPD-NUM-APVC IN OPD TO INT-ADOS.

           MOVE OPD-COD-VCAM IN OPD TO INT-VCAM.

           MOVE OPD-NUM-DREA IN OPD TO INT-DCOL.
           MOVE OPD-NUM-MREA IN OPD TO INT-MCOL.
           MOVE OPD-NUM-SREA IN OPD TO INT-SCOL.
           MOVE OPD-NUM-AREA IN OPD TO INT-ACOL.

           MOVE OPD-NUM-DREA IN OPD TO INT-DBTV.
           MOVE OPD-NUM-MREA IN OPD TO INT-MBTV.
           MOVE OPD-NUM-SREA IN OPD TO INT-SBTV.
           MOVE OPD-NUM-AREA IN OPD TO INT-ABTV.

           MOVE OPD-SGV-TINT IN OPD TO INT-TINT.

           MOVE OPD-COD-TINT IN OPD TO INT-TIPT.

           PERFORM GNS-CAL-INT.
           IF INT-CMSG > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE INT-CMSG TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO EN CPL-VEN '
               DISPLAY ' ERROR EN RUTINA OBTENCION TASA PERIODO '
                                                   MSG-GLS-DESC
               PERFORM DAP-PRO-ABT.

           MOVE OPD-VAL-SCAP IN OPD TO WSS-VAL-CAPI.

           MOVE SPACES TO MSG-COD-MENS.
           MOVE ZEROES TO SCR-CAPI
                          SCR-INTE.

      * ISP: CALCULA CAPITAL E INTERESES
           PERFORM CAL-CAP-INT.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               PERFORM GET-MSG
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO EN CPL-VEN '
               DISPLAY ' ERROR EN RUTINA CALCULO INTERESES '
                                              MSG-GLS-DESC
               PERFORM DAP-PRO-ABT.

           MOVE ZEROES TO WSS-VAL-FORI.

      * JVM: Mantencion 11/06/1992
           MULTIPLY INT-TIPE BY 100 GIVING SCR-SGV-TPER.
      * JVM: Fin
           ADD SCR-INTE TO WSS-VAL-FORI.
           ADD SCR-CAPI TO WSS-VAL-FORI.
      * JVM: Mantencion 11/06/1992
           MOVE SCR-SGV-TPER TO OPD-VAL-SINT IN OPD.
      * JVM: Fin
      *    aproximacion ultimo decimal de cantidades en pesos
      *     MULTIPLY WSS-VAL-FORI BY 1
      *         GIVING VEN-VAL-FINA IN VEN ROUNDED.

      *     IF SCR-CIC-VCAM = PDB-CIC-0999

            MOVE WSS-VAL-FORI TO VEN-VAL-FINA IN VEN.
      *    aproximaciones de cantidades en pesos
            MOVE VEN-VAL-FINA IN VEN TO PES-SGV-DECI.
            MOVE SCR-CIC-VCAM TO PES-CIC-VCAM.
            PERFORM PES-SCTV.
            MOVE PES-SGV-ENTE TO VEN-VAL-FINA IN VEN.

           MOVE 'I'                 TO VEN-COD-STAT IN VEN.
           MOVE VEN-VAL-FINA IN VEN TO VEN-VAL-SFIN IN VEN.
           MOVE OPD-FEC-FPVC IN OPD TO VEN-FEC-FVEN IN VEN.
      *ISP-INI  31-OCT-1995 09:48:34
           MOVE OPD-VAL-CAPT IN OPD TO VEN-VAL-CAPI IN VEN.
           MOVE OPD-VAL-CAPT IN OPD TO VEN-VAL-SCAP IN VEN.
      *ISP-FIN  31-OCT-1995 09:48:34

           MOVE FIO-MOD TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO EN CPL-VEN '
               DISPLAY ' ERROR AL GENERAR VEN A COMPLETAR: '
                         VEN-KEY-IVEN IN VEN ' FS: ' FIO-STAT
               PERFORM DAP-PRO-ABT.

      * ISP  12-NOV-1992 ACTUALIZA FECHA DEVENGO AL COMPLETAR OPERACION
      *      Y NO AL GENERAR VEN CON STAT = 'N'
           MOVE OPD-FEC-FREA IN OPD TO OPD-FEC-FDEV IN OPD.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO EN CPL-VEN '
               DISPLAY ' ERROR AL GENERAR OPD: '
                         OPD-KEY-IOPD IN OPD ' STATUS : ' FIO-STAT
               PERFORM DAP-PRO-ABT.
      *     DISPLAY '$$ OPD COMPLETADA OK          : '.
       FIN-CPL-VEN.
           EXIT.

       GET-CUR-AUT SECTION.
       INI-GET-CUR-AUT.
           MOVE OPD-CIC-IOPD IN OPD TO CAD-CIC-IOPD IN CAD.
           MOVE 'AUT'               TO CAD-NUM-ILIQ IN CAD.
           MOVE 1                   TO CAD-NUM-ICAD IN CAD.
           MOVE 'CAD-KEY-ICAD' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
       FIN-GET-CUR-AUT.
           EXIT.

       PUT-CMN-LIQ SECTION.
       INI-PUT-CMN-LIQ.
           MOVE OPD-NUM-IVEN IN OPD TO LIQ-NUM-ILIQ IN LIQ.
           MOVE VEN-FEC-FVEN IN VEN TO LIQ-FEC-FREA IN LIQ
                                       LIQ-FEC-FCTB IN LIQ
                                       LIQ-FEC-FCMP IN LIQ.

           MOVE SPACES              TO LIQ-GLS-FLAG IN LIQ.
           MOVE VEN-CIC-IOPD IN VEN TO LIQ-CIC-IOPD IN LIQ.
           MOVE HOY-STP-ITRN        TO LIQ-STP-ITRN IN LIQ.
           MOVE 'I'                 TO LIQ-COD-TACC IN LIQ.
           MOVE 'B'                 TO LIQ-COD-OTRN IN LIQ.
           MOVE WSS-PROG            TO LIQ-COD-ATRN IN LIQ.
           MOVE OPD-COD-OFIC IN OPD TO LIQ-COD-OFIC IN LIQ.
           MOVE OPD-COD-EJEC IN OPD TO LIQ-COD-EJEC IN LIQ.
           MOVE ZEROES              TO LIQ-SGV-GAST IN LIQ.
           MOVE ZEROES              TO LIQ-SGV-REAJ IN LIQ.
           MOVE ZEROES              TO LIQ-SGV-PESO IN LIQ.
           PERFORM OBT-LIQ.
           MOVE SPACES              TO LIQ-GLS-DISP IN LIQ.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-LIQ.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN PUT-CMN-LIQ '
              DISPLAY ' ERROR AL GRABAR LIQUIDACION '
                        LIQ-KEY-ILIQ IN LIQ ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.
           ADD 1 TO WSS-GEN-LIQ.
       FIN-PUT-CMN-LIQ.
           EXIT.

       OBT-LIQ SECTION.
       INI-OBT-LIQ.
           MOVE VEN-VAL-FINA IN VEN TO LIQ-SGV-TPAG IN LIQ.
           COMPUTE LIQ-SGV-CAPI IN LIQ =
                 VEN-VAL-CAPI IN VEN - VEN-VAL-IDNI IN VEN.
           MOVE LIQ-SGV-CAPI IN LIQ TO WSS-VAL-CAPI IN WSS-VARI
                                       SCR-VAL-CAPI IN SCR-VARI.
           IF ( SCR-CIC-TVAL = PDB-CIC-MNAC AND
                SCR-CIC-VCAM NOT = PDB-CIC-0999 )
                 IF WSS-STAT-VCAM > ZEROES
                    GO TO FIN-OBT-LIQ
                 ELSE
                    MULTIPLY WSS-VAL-CAPI BY
                               WSS-SGV-VCAM-FCAP GIVING
                               WSS-SGV-REAJ-1
                    MULTIPLY WSS-VAL-CAPI BY
                               WSS-SGV-VCAM-FVEN GIVING
                               WSS-SGV-REAJ-2
                    SUBTRACT WSS-SGV-REAJ-1 FROM
                               WSS-SGV-REAJ-2 GIVING
                               LIQ-SGV-REAJ IN LIQ
                    MOVE LIQ-SGV-REAJ IN LIQ TO PES-SGV-DECI
                    PERFORM PES-SCTV
                    MOVE PES-SGV-ENTE TO LIQ-SGV-REAJ IN LIQ

                    MULTIPLY LIQ-SGV-TPAG IN LIQ BY
                           WSS-SGV-VCAM-FVEN GIVING
                           LIQ-SGV-PESO IN LIQ ROUNDED
                    MOVE LIQ-SGV-PESO IN LIQ TO PES-SGV-DECI
                    PERFORM PES-SCTV
                    MOVE PES-SGV-ENTE TO LIQ-SGV-PESO IN LIQ

           ELSE
           IF SCR-CIC-VCAM = PDB-CIC-0999
                 MOVE LIQ-SGV-TPAG IN LIQ TO
                      LIQ-SGV-PESO IN LIQ
           ELSE
                 MOVE ZEROES TO
                      LIQ-SGV-PESO IN LIQ.
       FIN-OBT-LIQ.
           EXIT.

       LIQ-OBT-VCAM SECTION.
       INI-LIQ-OBT-VCAM.
           MOVE ZEROES TO WSS-STAT-VCAM.
           PERFORM VCAM-FCAP.
           PERFORM VCAM-FVEN.
       FIN-LIQ-OBT-VCAM.
           EXIT.

       VCAM-FCAP SECTION.
       INI-VCAM-FCAP.
      *VALOR DEL CAMBIO A FECHA CAPTACION
           MOVE ZEROES TO WSS-SGV-VCAM-FCAP.
           MOVE PDB-CIC-0999        TO TAB-CIC-CTAB IN TAB.
           MOVE OPD-COD-VCAM IN OPD TO TAB-COD-CTAB IN TAB.
           MOVE OPD-NUM-DREA IN OPD TO TAB-NUM-DTRN IN TAB.
           MOVE OPD-NUM-MREA IN OPD TO TAB-NUM-MTRN IN TAB.
           MOVE OPD-NUM-SREA IN OPD TO TAB-NUM-STRN IN TAB.
           MOVE OPD-NUM-AREA IN OPD TO TAB-NUM-ATRN IN TAB.
           PERFORM GET-VCAM.
           IF MSG-COD-MENS = SPACES
               MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-VCAM-FCAP
           ELSE
               MOVE 1 TO WSS-STAT-VCAM
               DISPLAY 'NO EXISTE VCAM A F CAPT. REAL: '
            OPD-FEC-FREA IN OPD ' Y MONEDA: ' OPD-COD-VCAM IN OPD
               DISPLAY 'SE GENERA LIQ CON ESTADO T '
                                              VEN-KEY-IVEN IN VEN
               DISPLAY ' '.
       FIN-VCAM-FCAP.
           EXIT.

       VCAM-FVEN SECTION.
       INI-VCAM-FVEN.
      *VALOR DEL SALDO DE CAPITAL EN PESOS A FECHA DE TERMINO
      *O VENCIMIENTO.
           MOVE ZEROES TO WSS-SGV-VCAM-FVEN.
           MOVE PDB-CIC-0999        TO TAB-CIC-CTAB IN TAB.
           MOVE OPD-COD-VCAM IN OPD TO TAB-COD-CTAB IN TAB.
           MOVE VEN-NUM-DVEN IN VEN TO TAB-NUM-DTRN IN TAB.
           MOVE VEN-NUM-MVEN IN VEN TO TAB-NUM-MTRN IN TAB.
           MOVE VEN-NUM-SVEN IN VEN TO TAB-NUM-STRN IN TAB.
           MOVE VEN-NUM-AVEN IN VEN TO TAB-NUM-ATRN IN TAB.
           PERFORM GET-VCAM.
           IF MSG-COD-MENS = SPACES
               MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-VCAM-FVEN
           ELSE
               MOVE 1 TO WSS-STAT-VCAM
               DISPLAY 'NO EXISTE VCAM A F VENCTO. : '
            VEN-FEC-FVEN IN VEN ' Y MONEDA: ' OPD-COD-VCAM IN OPD
               DISPLAY 'SE GENERA LIQ CON ESTADO T '
                                              VEN-KEY-IVEN IN VEN
               DISPLAY ' '.
       FIN-VCAM-FVEN.
           EXIT.

       GEN-CAD-LIQ SECTION.
       INI-GEN-CAD-LIQ.
      * Determina forma de abono para cargar a cta cte si oks
           MOVE SPACES                  TO CAD-CAI-ICAD IN CAD.
           MOVE SPACES                  TO CAD-IIC-ICAD IN CAD.
           PERFORM GET-CUR-AUT.
           IF FIO-STAT-OKS
      *        DISPLAY 'ABONO AUTOMATICO PARA '
      *                'OPERACION : ' CAD-CIC-IOPD IN CAD
              DISPLAY ' '.

           MOVE SPACES   TO CAD-GLS-FLAG IN CAD.
           MOVE HOY-FHOY TO CAD-FEC-FTRN IN CAD.
           MOVE HOY-HHOY TO CAD-HRA-HRTR IN CAD.
           MOVE 'I'      TO CAD-COD-TACC IN CAD.
           MOVE 'B'      TO CAD-COD-OTRN IN CAD.
           MOVE WSS-PROG TO CAD-COD-ATRN IN CAD.
           MOVE SPACES   TO CAD-GLS-DISP IN CAD.
           MOVE LIQ-CIC-IOPD IN LIQ TO CAD-CIC-IOPD IN CAD.
           MOVE LIQ-NUM-ILIQ IN LIQ TO CAD-NUM-ILIQ IN CAD.
           MOVE 1                   TO CAD-NUM-ICAD IN CAD.
      *ISP: DEBEN PONERSE CICS, SE PONE FIJO MIENTRAS NO SE
      *     SOLUCIONE PROBLEMA DE CODIGO 'TCYA'
      * BCI CPZ 16.07.1993 MUEVE CCMA A CODIGO ABONO AUT.
           IF LIQ-COD-STAT IN LIQ = 'A'
               MOVE 'CCMA '  TO CAD-IND-TCAD IN CAD
               MOVE 'S' TO CAD-IND-MAUT IN CAD
           ELSE
               MOVE 'N' TO CAD-IND-MAUT IN CAD
               MOVE 'CAJA'  TO MSC-CIC-CMSC IN MSC
               MOVE 'TAB'  TO MSC-COD-SIST
               MOVE 'TCYA' TO MSC-CIC-TMSC IN MSC
               MOVE 'MSC-CIC-TABL' TO FIO-AKEY
               PERFORM BUS-MSC
               IF MSG-COD-MENS = SPACES
                  MOVE MSC-COD-CMSC IN MSC TO CAD-IND-TCAD IN CAD
               ELSE
                  MOVE SPACES TO CAD-IND-TCAD IN CAD.

           MOVE LIQ-SGV-PESO IN LIQ     TO CAD-SGV-LIQU IN CAD.
           IF  SCR-CIC-TVAL = '1'
                MOVE LIQ-SGV-TPAG IN LIQ  TO CAD-SGV-LIQU IN CAD.

           MOVE OPD-COD-OFIC IN OPD     TO CAD-COD-OFIC IN CAD.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN GEN-CAD-LIQ '
              DISPLAY ' ERROR AL GRABAR CAD: '
                        CAD-KEY-ICAD IN CAD ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.
           ADD 1 TO WSS-GEN-CAD.
       FIN-GEN-CAD-LIQ.
           EXIT.

       PUT-MVO SECTION.
       INI-PUT-MVO.
           MOVE 5                   TO MVO-COD-TIPO IN MVO.
           MOVE CAD-IIC-ICAD IN CAD TO MVO-NUM-CCTE IN MVO.
           MOVE 9                   TO MVO-COD-IMPU IN MVO.
           MOVE SPACES              TO MVO-GLS-DIS1 IN MVO.
           MOVE CAD-SGV-LIQU IN CAD TO MVO-VAL-MONT IN MVO.
           MOVE 'E'                 TO MVO-COD-MVTO IN MVO.
           MOVE 00                  TO MVO-COD-CBCO IN MVO.
           MOVE SPACES              TO MVO-GLS-DIS2 IN MVO.

           MOVE VEN-FEC-FVEN IN VEN TO WSS-FEC-FMOV IN WSS-VARI.
           MOVE WSS-NUM-DMOV IN WSS-VARI   TO WSS-NUM-DMVO IN WSS-VARI.
           MOVE WSS-NUM-MMOV IN WSS-VARI   TO WSS-NUM-MMVO IN WSS-VARI.
           MOVE WSS-NUM-AMOV IN WSS-VARI   TO WSS-NUM-AMVO IN WSS-VARI.
           MOVE WSS-NUM-DMVO IN WSS-VARI   TO MVO-NUM-DMOV IN MVO.
           MOVE WSS-NUM-MMVO IN WSS-VARI   TO MVO-NUM-MMOV IN MVO.
           MOVE WSS-NUM-AMVO-2 IN WSS-VARI TO MVO-NUM-AMOV IN MVO.

           MOVE SPACES              TO MVO-GLS-DIS3 IN MVO.
           MOVE OPD-COD-OFIC IN OPD TO MVO-COD-SMOV IN MVO.
           MOVE SPACES              TO MVO-GLS-DIS4 IN MVO.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-MVO.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN PUT-MVO '
              DISPLAY ' ERROR AL GRABAR MVO: '
                        MVO ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.
       FIN-PUT-MVO.
           EXIT.

       PUT-GAR SECTION.
       INI-PUT-GAR.
           MOVE OPD-CIC-IOPD IN OPD TO GAR-CIC-IOPD IN GAR.
           MOVE OPD-FEC-FTRN IN OPD TO GAR-FEC-FNCP IN GAR.
           MOVE OPD-VAL-CAPT IN OPD TO GAR-VAL-NCAP IN GAR.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-GAR.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN PUT-GAR '
              DISPLAY ' ERROR AL GRABAR GAR '
                        GAR ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.
       FIN-PUT-GAR.
           EXIT.

       GEN-LIC SECTION.
       INI-GEN-LIC.
           MOVE OPD-CIC-ISER IN OPD TO LIC-CIC-ISER IN LIC.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-LIC.
           IF NOT FIO-STAT-OKS
              MOVE SPACES              TO LIC-GLS-FLAG IN LIC
              MOVE ZEROES              TO LIC-FEC-FLIQ IN LIC
              MOVE 'S'                 TO LIC-COD-STAT IN LIC
              MOVE SPACES              TO LIC-COD-OFIC IN LIC
              MOVE OPD-COD-VCAM IN OPD TO LIC-COD-VCAM IN LIC
              MOVE OPD-CIC-IOPD IN OPD TO LIC-CIC-IOPD IN LIC
              MOVE SPACES              TO LIC-GLS-DISP IN LIC
              MOVE FIO-PUT TO FIO-CMND
              IF SCR-CIC-TVAL = PDB-CIC-MNAC
                   MOVE LIQ-SGV-PESO IN LIQ TO LIC-SGV-TPAG IN LIC
              ELSE
                   MOVE LIQ-SGV-TPAG IN LIQ TO LIC-SGV-TPAG IN LIC
           ELSE
              MOVE FIO-MOD TO FIO-CMND
              IF SCR-CIC-TVAL = PDB-CIC-MNAC
                   ADD LIQ-SGV-PESO IN LIQ TO LIC-SGV-TPAG IN LIC
              ELSE
                   ADD LIQ-SGV-TPAG IN LIQ TO LIC-SGV-TPAG IN LIC.

           IF LIC-SGV-TPAG IN LIC > ZEROES
               PERFORM DAP-FIO-LIC.
               IF NOT FIO-STAT-OKS
                   DISPLAY ' '
                   DISPLAY ' PROCESO CANCELADO EN GEN-LIC '
                   DISPLAY ' ERROR AL GRABAR LIQUIDACION EN CAJA: '
                          LIC ' FS: ' FIO-STAT
                   PERFORM DAP-PRO-ABT.
       FIN-GEN-LIC.
           EXIT.

       PRO-ACT SECTION.
       INI-PRO-ACT.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN PRO-ACT '
              DISPLAY ' ERROR EN ACTUALIZACION VEN: '
                        VEN-KEY-IVEN IN VEN ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.

      * JVM : Mantencion 11/06/1992
      * BCI CPZ 16.07.1993 MUEVE CAN A SITUACION CONTABLE EN CASO DE
      * ABONO A CTA CTE.
      *     MOVE SPACES  TO OPD-COD-SCTB IN OPD.
           IF LIQ-COD-STAT = 'A'
              MOVE 'CAN' TO OPD-COD-SCTB IN OPD
           ELSE
              MOVE 'VCD' TO OPD-COD-SCTB IN OPD.
      * JVM : Fin

           MOVE FIO-MOD TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN PRO-ACT '
              DISPLAY ' ERROR EN ACTUALIZACION OPD: '
                       OPD-KEY-IOPD IN OPD ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.
       FIN-PRO-ACT.
           EXIT.

       CREA-CAD SECTION.
       INI-CREA-CAD.
           MOVE NEW-OPD-CIC-IOPD    TO CAD-CIC-IOPD IN CAD.
           MOVE ZEROES              TO CAD-NUM-ILIQ IN CAD.
           MOVE 1                   TO CAD-NUM-ICAD IN CAD.
           MOVE 'I'                 TO CAD-COD-TACC IN CAD.
           MOVE 'B'                 TO CAD-COD-OTRN IN CAD.
           MOVE WSS-PROG            TO CAD-COD-ATRN IN CAD.
           MOVE HOY-STP-ITRN        TO CAD-STP-ITRN IN CAD.
           MOVE SCR-CIC-CTBL        TO CAD-IND-TCAD IN CAD.
           MOVE SPACES              TO CAD-CIC-ICAD.
           MOVE OPD-VAL-CAPT IN OPD TO CAD-SGV-LIQU IN CAD.

           IF  SCR-CIC-TVAL = PDB-CIC-MEXT
      *         MOVE CAD-SGV-LIQU IN CAD TO PES-SGV-DECI
      *         PERFORM PES-SCTV
      *         MOVE PES-SGV-ENTE TO CAD-SGV-LIQU IN CAD
               GO TO GRABA-CAD.

           IF ( SCR-CIC-TVAL = PDB-CIC-MNAC AND
                SCR-CIC-VCAM NOT = PDB-CIC-0999 )
                PERFORM VCAM-FCAP
                MULTIPLY OPD-VAL-CAPT IN OPD BY
                                WSS-SGV-VCAM-FCAP   GIVING
                                CAD-SGV-LIQU IN CAD ROUNDED.
           MOVE CAD-SGV-LIQU IN CAD TO PES-SGV-DECI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE TO CAD-SGV-LIQU IN CAD.

       GRABA-CAD.
           MOVE SCR-CSON-S           TO CAD-IND-MAUT IN CAD.
           MOVE OPD-COD-OFIC IN OPD TO CAD-COD-OFIC IN CAD.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN CREA-CAD '
              DISPLAY ' ERROR AL GENERAR CARGO A RENOVAR: '
                        CAD-KEY-ICAD IN CAD ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.
           ADD 1 TO WSS-GEN-CAD.
       FIN-CREA-CAD.
           EXIT.

       CREA-RCC SECTION.
       INI-CREA-RCC.
           MOVE BKP-OPD-CIC-IOPD TO RCC-CIC-IOPD IN RCC.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT ( FIO-STAT-OKS AND
              BKP-OPD-CIC-IOPD = RCC-CIC-IOPD IN RCC )
              GO TO FIN-CREA-RCC.
           MOVE RCC-KEY-IRCC IN RCC TO BKP-KEY-IRCC.

       CIC-CREA-RCC.
           MOVE NEW-OPD-CIC-IOPD TO RCC-CIC-IOPD IN RCC.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN CREA-RCC '
              DISPLAY ' ERROR AL GENERAR RCC A RENOVAR: '
                        RCC-KEY-IRCC IN RCC ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.

           MOVE BKP-KEY-IRCC TO RCC-KEY-IRCC IN RCC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN CREA-RCC '
              DISPLAY ' ERROR AL LEER RCC A RENOVAR: '
                       RCC-KEY-IRCC IN RCC ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.

           MOVE FIO-GET-NXT TO FIO-CMND
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           PERFORM DAP-FIO-RCC.
           IF ( FIO-STAT-OKS AND
              BKP-OPD-CIC-IOPD = RCC-CIC-IOPD IN RCC )
              MOVE RCC-KEY-IRCC IN RCC TO BKP-KEY-IRCC
              GO TO CIC-CREA-RCC.
       FIN-CREA-RCC.
           EXIT.

       CREA-ONP SECTION.
       INI-CREA-ONP.
           MOVE BKP-OPD-CIC-IOPD TO ONP-CIC-IOPD IN ONP
                                    WSS-LLAVE-ONP IN WSS-VARI.
      *JUS 12.01.95
           PERFORM BUS-COR-ONP.
      *JUS 12.01.95
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-ONP.
           IF NOT FIO-STAT-OKS
      *         DISPLAY BKP-OPD-CIC-IOPD
      *                 ' ERROR: ENTIDAD ONP NO ENCONTRADA PARA '
      *                 ' OPD CON INDICADOR ONP = "S"'
               GO TO FIN-CREA-ONP.
           MOVE NEW-OPD-CIC-IOPD    TO ONP-CIC-IOPD IN ONP.
           MOVE FIO-PUT TO FIO-CMND.

           PERFORM DAP-FIO-ONP.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY ' PROCESO CANCELADO EN CREA-ONP '
              DISPLAY ' ERROR AL GENERAR ONP A RENOVAR: '
                        ONP-KEY-IONP IN ONP ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.
       FIN-CREA-ONP.
           EXIT.

       GEN-PRX-RTR SECTION.
       INI-GEN-PRX-RTR.
      * ISP: VENCIMIENTO A GENERAR ES EL ULTIMO ?
           IF OPD-NUM-VNLQ IN OPD = 1
              MOVE VEN-FEC-FVEN IN VEN TO OPD-FEC-FDEV IN OPD
              MOVE OPD-FEC-FTER IN OPD TO VEN-FEC-FVEN IN VEN
              GO TO BUS-TINT.

           MOVE VEN-FEC-FVEN IN VEN TO OPD-FEC-FDEV IN OPD.

           MOVE OPD-VAL-SCAP IN OPD TO WSS-VAL-CAPI.

      *    FEC-FVEN(I+1) = SEVE * ( TVEN - 1 ) + FEC-PVEN

           MOVE OPD-NUM-DREA IN OPD TO FEC-ITM1.
           MOVE OPD-NUM-MREA IN OPD TO FEC-ITM2.
           MOVE OPD-NUM-SREA IN OPD TO FEC-ITM3.
           MOVE OPD-NUM-AREA IN OPD TO FEC-ITM4.
           MOVE OPD-IND-PVEN IN OPD TO MSC-COD-CMSC IN MSC.
           PERFORM OBT-CIC-PER.
           MOVE OPD-NUM-PVEN IN OPD TO WSS-NUM-PER.
           PERFORM SEL-PER.

      * ISP: EN ESTE PUNTO TENEMOS FECHA PRIMER VCTO EN FEC-FECH

           SUBTRACT 1 FROM OPD-NUM-IVEN IN OPD GIVING WSS-TVEN-1.
           MULTIPLY WSS-TVEN-1 BY OPD-NUM-SEVE IN OPD
                                               GIVING WSS-DURV-1.

           MOVE OPD-IND-SEVE IN OPD TO MSC-COD-CMSC IN MSC.
           PERFORM OBT-CIC-PER.
           MOVE WSS-DURV-1          TO WSS-NUM-PER.
           PERFORM SEL-PER.

           IF OPD-COD-AFER IN OPD NOT = SCR-CSON-S
              GO TO OBT-FVEN.

      *VAL-FEC Validar Fecha ( HABIL )
       CIC-GEN-PRX-RTR.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-HBL
               MOVE FEC-FORM-FEC TO FEC-FORM
               MOVE FEC-SUM-DIA  TO FEC-CMND
               MOVE 1            TO FEC-NDIA
               PERFORM CAL-FEC
               GO TO CIC-GEN-PRX-RTR.

       OBT-FVEN.
           MOVE FEC-ITM1 TO VEN-NUM-DVEN IN VEN.
           MOVE FEC-ITM2 TO VEN-NUM-MVEN IN VEN.
           MOVE FEC-ITM3 TO VEN-NUM-SVEN IN VEN.
           MOVE FEC-ITM4 TO VEN-NUM-AVEN IN VEN.

       BUS-TINT.
           MOVE VEN-FEC-FVEN IN VEN TO OPD-FEC-FPVC IN OPD.

           PERFORM PUT-OPD-OPD.

           MOVE OPD-NUM-DDEV IN OPD TO INT-DUNO.
           MOVE OPD-NUM-MDEV IN OPD TO INT-MUNO.
           MOVE OPD-NUM-SDEV IN OPD TO INT-SUNO.
           MOVE OPD-NUM-ADEV IN OPD TO INT-AUNO.

           MOVE OPD-NUM-DPVC IN OPD TO INT-DDOS.
           MOVE OPD-NUM-MPVC IN OPD TO INT-MDOS.
           MOVE OPD-NUM-SPVC IN OPD TO INT-SDOS.
           MOVE OPD-NUM-APVC IN OPD TO INT-ADOS.

           MOVE OPD-COD-VCAM IN OPD TO INT-VCAM.

           MOVE OPD-NUM-DDEV IN OPD TO INT-DCOL.
           MOVE OPD-NUM-MDEV IN OPD TO INT-MCOL.
           MOVE OPD-NUM-SDEV IN OPD TO INT-SCOL.
           MOVE OPD-NUM-ADEV IN OPD TO INT-ACOL.

           MOVE OPD-NUM-DDEV IN OPD TO INT-DBTV.
           MOVE OPD-NUM-MDEV IN OPD TO INT-MBTV.
           MOVE OPD-NUM-SDEV IN OPD TO INT-SBTV.
           MOVE OPD-NUM-ADEV IN OPD TO INT-ABTV.

           MOVE OPD-SGV-TINT IN OPD TO INT-TINT.

           MOVE OPD-COD-TINT IN OPD TO INT-TIPT.

           PERFORM GNS-CAL-INT.
           IF INT-CMSG > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE INT-CMSG TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY 'ERROR EN RUTINA CALCULO TASA PERIODO '
                                               MSG-GLS-DESC
               GO TO FIN-GEN-PRX-RTR.

           MOVE SPACES TO MSG-COD-MENS.
           MOVE ZEROES TO SCR-CAPI
                          SCR-INTE
                          SCR-IDNI.

      * ISP: VENCIMIENTO A GENERAR ES EL ULTIMO ?
           IF OPD-NUM-VNLQ IN OPD = 1
              MOVE OPD-VAL-SCAP IN OPD TO SCR-CAPI
                                          WSS-VAL-CAPI
              MULTIPLY WSS-VAL-CAPI BY INT-TIPE
                                GIVING SCR-INTE ROUNDED
              GO TO BUS-VFIN.

      * ISP: CALCULA CAPITAL E INTERESES
           PERFORM CAL-CAP-INT.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               PERFORM GET-MSG
               DISPLAY 'ERROR EN RUTINA CALCULO CAPITAL E INTERESES '
                                                   MSG-GLS-DESC
               GO TO FIN-PRO-REN.

       BUS-VFIN.
           MOVE ZEROES TO WSS-VAL-FORI.
           MOVE SCR-CAPI TO VEN-VAL-CAPI IN VEN
                            VEN-VAL-SCAP IN VEN.
           MOVE SCR-IDNI TO VEN-VAL-IDNI IN VEN.
      *
           ADD SCR-INTE TO WSS-VAL-FORI.
           ADD SCR-CAPI TO WSS-VAL-FORI.
           MOVE WSS-VAL-FORI TO VEN-VAL-FINA IN VEN.

      *    aproximacion ultimo decimal de cantidades en pesos
      *     MULTIPLY WSS-VAL-FORI BY 1
      *               GIVING VEN-VAL-FINA IN VEN ROUNDED.

      *     IF SCR-CIC-VCAM = PDB-CIC-0999

            MOVE WSS-VAL-FORI TO VEN-VAL-FINA IN VEN.
      *    aproximaciones de cantidades en pesos
            MOVE VEN-VAL-FINA IN VEN TO PES-SGV-DECI.
            MOVE SCR-CIC-VCAM TO PES-CIC-VCAM.
            PERFORM PES-SCTV.
            MOVE PES-SGV-ENTE TO VEN-VAL-FINA IN VEN.

           MOVE VEN-VAL-FINA IN VEN TO VEN-VAL-SFIN IN VEN.
       FIN-GEN-PRX-RTR.
           EXIT.

       COPY TABBFCAM.
       COPY DAPBFOPD.
       COPY DAPBFRCC.
       COPY DAPBFCAD.
       COPY DAPBFPTD.
       COPY DAPBFVEN.
       COPY DAPBFONP.
       COPY DAPBFLIQ.
       COPY DAPBFLIC.
       COPY DAPBFMVO.
       COPY DAPBFGAR.
       COPY DAPBFIPA.
       COPY SGCBFDBC.
       COPY SGCBFRCD.
       COPY DAPBG004.
       COPY GNSBGDTC.
       COPY GNSBGIFD.
       COPY GNSBTABT.
       COPY GNSBGABT.
       COPY GNSBBSYS.
       COPY GNSBVTAB.
       COPY GNSBBTAB.
       COPY GNSBFTAB.
       COPY GNSBFCIC.
       COPY GNSBGCIC.
       COPY GNSBGCAM.
       COPY GNSBFMSG.
       COPY GNSBFMSC.
       COPY GNSBBMSC.
       COPY GNSBGEND.

      *<<<< EOF
      *Entidades  de GNS
       COPY GNSBGINT.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
       COPY GNSBGHOY.
       COPY GNSBGPES.
       COPY GNSBBMSG.
       COPY GNSBGCPT.

       ACT-OPD-REN SECTION.
       INI-ACT-OPD-REN.
           MOVE ZEROES TO WSS-STAT-REN IN WSS-VARI.
           MOVE WSS-IOPD-ANT IN WSS-VARI TO OPD-CIC-IOPD IN OPD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL LEER OPD ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

       PUT-OPD.
           MOVE OPD-COD-IONP IN OPD TO WSS-COD-IONP IN WSS-VARI.
           MOVE WSS-IOPD-NEW IN WSS-VARI TO OPD-CIC-IOPD IN OPD.
           MOVE WSS-STAT-NEW IN WSS-VARI TO OPD-COD-STAT IN OPD.
           IF WSS-MOD-SERI = 'S'
               MOVE NEW-OPD-CIC-ISER TO OPD-CIC-ISER IN OPD.

           IF WSS-STAT-NEW = 'L'
              MOVE ZEROES TO OPD-VAL-SCAP IN OPD.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL GRABAR OPD ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

       PUT-CAD.
           MOVE WSS-IOPD-ANT IN WSS-VARI TO CAD-CIC-IOPD IN CAD.
           MOVE ZEROES                   TO CAD-NUM-ILIQ IN CAD.
           MOVE SPACES                   TO CAD-NUM-ICAD IN CAD.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF NOT ( FIO-STAT-OKS AND
              WSS-IOPD-ANT IN WSS-VARI = CAD-CIC-IOPD IN CAD )
              MOVE ' ERROR AL LEER CAD ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

       LUP-PUT-CAD.
           MOVE ZEROES TO WSS-STAT-REN.
           MOVE CAD                 TO WSS-CAD.
           MOVE CAD-KEY-ICAD IN CAD TO WSS-BKP-CAD.
           PERFORM GEN-CAD.
           IF WSS-STAT-REN = 1
              GO TO FIN-ACT-OPD-REN.

           MOVE WSS-BKP-CAD TO CAD-KEY-ICAD IN CAD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL LEER CAD YA SELECCIONADO ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF ( FIO-STAT-OKS AND
                WSS-IOPD-ANT IN WSS-VARI = CAD-CIC-IOPD IN CAD )
              GO TO LUP-PUT-CAD.

       PUT-RCC.
           MOVE WSS-IOPD-ANT IN WSS-VARI TO RCC-CIC-IOPD IN RCC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           PERFORM DAP-FIO-RCC.
           IF NOT ( FIO-STAT-OKS AND
              WSS-IOPD-ANT IN WSS-VARI = RCC-CIC-IOPD IN RCC )
              MOVE ' ERROR AL LEER RCC ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

       LUP-PUT-RCC.
           MOVE ZEROES TO WSS-STAT-REN.
           MOVE RCC                 TO WSS-RCC.
           MOVE RCC-KEY-IRCC IN RCC TO WSS-BKP-RCC.
           PERFORM GEN-RCC.
           IF WSS-STAT-REN = 1
              GO TO FIN-ACT-OPD-REN.

           MOVE WSS-BKP-RCC TO RCC-KEY-IRCC IN RCC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL LEER RCC YA SELECCIONADO ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.
           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           PERFORM DAP-FIO-RCC.
           IF ( FIO-STAT-OKS AND
                WSS-IOPD-ANT IN WSS-VARI = RCC-CIC-IOPD IN RCC )
              GO TO LUP-PUT-RCC.

       PUT-VEN.
           MOVE WSS-IOPD-ANT IN WSS-VARI TO VEN-CIC-IOPD IN VEN.
           MOVE '001'                    TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL LEER VEN ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

           MOVE WSS-IOPD-NEW IN WSS-VARI TO VEN-CIC-IOPD IN VEN.
           IF WSS-STAT-NEW = 'L'
              MOVE ZEROES TO VEN-VAL-SCAP IN VEN
                             VEN-VAL-SFIN IN VEN.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL GRABAR VEN ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

       PUT-ONP.
           IF WSS-COD-IONP IN WSS-VARI NOT = SCR-CSON-S
              GO TO ELI-OPD.
           MOVE WSS-IOPD-ANT IN WSS-VARI TO ONP-CIC-IOPD IN ONP
                                    WSS-LLAVE-ONP IN WSS-VARI.
           MOVE 0 TO ONP-NUM-CORR IN ONP.
           MOVE 'N' TO WSS-CAMBIO-ONP IN WSS-VARI.
           PERFORM GRABA-ONP.
           IF WSS-CAMBIO-ONP IN WSS-VARI NOT = 'S'
              GO TO FIN-ACT-OPD-REN.

       ELI-OPD.
      * eliminacion OPD existente
           MOVE WSS-IOPD-ANT IN WSS-VARI TO OPD-CIC-IOPD IN OPD.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR EN UPDATE OPD ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL ELIMINAR OPD ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

       ELI-CAD.
       LUP-ELI-MUL-CAD.
      * eliminacion de multiples cargos asociados a la opd
           MOVE WSS-IOPD-ANT IN WSS-VARI TO CAD-CIC-IOPD IN CAD.
           MOVE SPACES                   TO CAD-NUM-ILIQ IN CAD.
           MOVE SPACES                   TO CAD-NUM-ICAD IN CAD.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF NOT ( FIO-STAT-OKS AND
              WSS-IOPD-ANT IN WSS-VARI = CAD-CIC-IOPD IN CAD )
              GO TO ELI-RCC.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR EN UPDATE A CAD ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL ELIMINAR CAD ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

           IF FIO-STAT-OKS
              GO TO LUP-ELI-MUL-CAD.

       ELI-RCC.
       LUP-ELI-MUL-RCC.
      * eliminacion de multiples RCC asociados a la opd
           MOVE WSS-IOPD-ANT IN WSS-VARI TO RCC-CIC-IOPD IN RCC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           PERFORM DAP-FIO-RCC.
           IF NOT ( FIO-STAT-OKS AND
                    WSS-IOPD-ANT IN WSS-VARI = RCC-CIC-IOPD IN RCC )
              GO TO ELI-VEN.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR EN UPDATE A RCC ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL ELIMINAR RCC ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

           IF FIO-STAT-OKS
              GO TO LUP-ELI-MUL-RCC.

       ELI-VEN.
      * eliminacion VEN asociado a la operacion.
           MOVE WSS-IOPD-ANT IN WSS-VARI TO VEN-CIC-IOPD IN VEN.
           MOVE '001'                    TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL LEER VEN ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL ELIMINAR VEN ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-ACT-OPD-REN.

       ELI-ONP.
           IF WSS-COD-IONP IN WSS-VARI NOT = SCR-CSON-S
              GO TO FIN-ACT-OPD-REN.
      * eliminacion ONP asociado a la operacion.
           MOVE WSS-IOPD-ANT IN WSS-VARI TO ONP-CIC-IOPD IN ONP
                                    WSS-LLAVE-ONP IN WSS-VARI.
           MOVE 1 TO ONP-NUM-CORR IN ONP.
           MOVE 'N' TO WSS-CAMBIO-ONP IN WSS-VARI.
      *JUS 13.01.95
           PERFORM ELIMI-ONP.
           IF WSS-CAMBIO-ONP IN WSS-VARI NOT = 'S'
              GO TO FIN-ACT-OPD-REN.
      *JUS 13.01.95
       FIN-ACT-OPD-REN.
           EXIT.

       GEN-CAD SECTION.
       INI-GEN-CAD.
           MOVE WSS-CAD                  TO CAD.
           MOVE WSS-IOPD-NEW IN WSS-VARI TO CAD-CIC-IOPD IN CAD.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL GRABAR CAD ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN.
       FIN-GEN-CAD.
           EXIT.

       GEN-RCC SECTION.
       INI-GEN-RCC.
           MOVE WSS-RCC                  TO RCC.
           MOVE WSS-IOPD-NEW IN WSS-VARI TO RCC-CIC-IOPD IN RCC.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL GRABAR RCC ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN.
       FIN-GEN-RCC.
           EXIT.

       ELI-FICTICIA SECTION.
       INI-ELI-FICTICIA.
       ELI-FIC-OPD.
      * eliminacion OPD ficticia si existe
           MOVE WSS-IOPD-X IN WSS-VARI TO OPD-CIC-IOPD IN OPD.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
              GO TO ELI-FIC-CAD.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
              DISPLAY ' ERROR AL ELIMINAR OPD FICTICIA ' .

       ELI-FIC-CAD.
       LUP-ELI-FIC-CAD.
      * eliminacion de multiples cargos asociados a opd ficticia
           MOVE WSS-IOPD-X IN WSS-VARI TO CAD-CIC-IOPD IN CAD.
           MOVE SPACES                   TO CAD-NUM-ILIQ IN CAD.
           MOVE SPACES                   TO CAD-NUM-ICAD IN CAD.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF NOT ( FIO-STAT-OKS AND
              WSS-IOPD-X IN WSS-VARI = CAD-CIC-IOPD IN CAD )
              GO TO ELI-FIC-RCC.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF NOT FIO-STAT-OKS
              DISPLAY ' ERROR EN UPDATE A CAD FICTICIA '
              GO TO ELI-FIC-RCC.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF NOT FIO-STAT-OKS
              DISPLAY ' ERROR AL ELIMINAR CAD FICTICIA '
              GO TO ELI-FIC-RCC.
           GO TO LUP-ELI-FIC-CAD.

       ELI-FIC-RCC.
       LUP-ELI-FIC-RCC.
      * eliminacion de multiples RCC asociados a opd ficticia
           MOVE WSS-IOPD-X IN WSS-VARI TO RCC-CIC-IOPD IN RCC.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           PERFORM DAP-FIO-RCC.
           IF NOT ( FIO-STAT-OKS AND
                    WSS-IOPD-X IN WSS-VARI = RCC-CIC-IOPD IN RCC )
              GO TO ELI-FIC-VEN.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT FIO-STAT-OKS
              DISPLAY ' ERROR EN UPDATE A RCC FICTICIA '
              GO TO ELI-FIC-VEN.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT FIO-STAT-OKS
              DISPLAY ' ERROR AL ELIMINAR RCC FICTICIA '
              GO TO ELI-FIC-VEN.
           GO TO LUP-ELI-FIC-RCC.

       ELI-FIC-VEN.
      * eliminacion VEN asociado a la opd ficticia
           MOVE WSS-IOPD-X IN WSS-VARI TO VEN-CIC-IOPD IN VEN.
           MOVE '001'                  TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
              GO TO ELI-FIC-ONP.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
              DISPLAY ' ERROR AL ELIMINAR VEN FICTICIA '.

       ELI-FIC-ONP.
           IF WSS-COD-IONP IN WSS-VARI NOT = SCR-CSON-S
              GO TO FIN-ELI-FICTICIA.
      * eliminacion ONP asociado a la OPD ficticia
           MOVE WSS-IOPD-X IN WSS-VARI TO ONP-CIC-IOPD IN ONP
                                    WSS-LLAVE-ONP IN WSS-VARI.
      *JUS 12.01.95
           PERFORM BUS-COR-ONP.
      *JUS 12.01.95
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-ONP.
           IF NOT FIO-STAT-OKS
              DISPLAY ' ERROR AL LEER ONP FICTICIA '
              GO TO FIN-ELI-FICTICIA.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM DAP-FIO-ONP.
           IF NOT FIO-STAT-OKS
              DISPLAY ' ERROR AL ELIMINAR ONP FICTICIA '.
       FIN-ELI-FICTICIA.
           EXIT.

       GET-COD-CIC-OPD SECTION.
       INI-GET-COD-CIC-OPD.
      *    OBTIENE VALOR VALOR DE CAMBIO PARA POSIBLE MONEDA REAJUSTABLE
      *    ES DECIR, CHILENA Y NO PESOS
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'VLR'               TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-VCAM IN OPD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-TAB.
      *SE DEBE VERIFICAR QUE BUSQUEDA DE CODIGO DE MONEDA SEA EXITOSO
      *EXISTENTE Y VIGENTE
           IF MSG-COD-MENS > SPACES
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO EN GET-COD-CIC-OPD '
               DISPLAY ' NO EXISTE MONEDA PARA OPERACION '
                                              MSG-COD-MENS
               PERFORM DAP-PRO-ABT.

           MOVE TAB-CIC-CTAB IN TAB TO SCR-CIC-VCAM.

           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'MDR' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-MORE IN OPD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-TAB.
           IF MSG-COD-MENS > SPACES
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO EN GET-COD-CIC-OPD '
               DISPLAY ' NO EXISTE MODALIDAD DE RETIRO'
                                       OPD-COD-MORE IN OPD
               PERFORM DAP-PRO-ABT.

           MOVE TAB-CIC-CTAB IN TAB TO SCR-CIC-MORE.
       FIN-GET-COD-CIC-OPD.
           EXIT.

       ACC-FPRO SECTION.
       INI-ACC-FPRO.
      * ISP: ACEPTA COMO PARAMETRO LA FECHA DE PROCESO,

      *     DISPLAY '  '.
      *     DISPLAY 'INGRESE FECHA DE PROCESO (DDMMSSAA) : '.
      *     ACCEPT  WSS-FEC-FPRO IN WSS-VARI.

      **VAL-FEC Valida Fecha de proceso
      *     MOVE WSS-FEC-FPRO IN WSS-VARI TO FEC-FECH.
      *     MOVE FEC-FORM-FEC TO FEC-FORM.
      *     MOVE FEC-FBLK-N   TO FEC-FBLK.
      *     MOVE FEC-CHOY-LE  TO FEC-CHOY.
      *     MOVE FEC-VHBL-N   TO FEC-VHBL.
      *     MOVE FEC-VAL-FEC  TO FEC-CMND.
      *     PERFORM PRO-FEC.
      *     IF NOT FEC-STAT-OKS
      *         DISPLAY ' '
      *         DISPLAY ' PROCESO CANCELADO EN ACC-FPRO '
      *         DISPLAY ' ERROR EN VALIDACION DE FECHA DE PROCESO'
      *                                           WSS-FEC-FPRO
      *         PERFORM DAP-PRO-ABT
      *     ELSE
      *         MOVE WSS-NUM-DPRO TO WSS-NUM-DTRA
      *         MOVE WSS-NUM-MPRO TO WSS-NUM-MTRA
      *         MOVE WSS-NUM-SPRO TO WSS-NUM-STRA
      *         MOVE WSS-NUM-APRO TO WSS-NUM-ATRA
      ** ISP: OBTIENE FECHA DE MANANA ( YA ESTA CARGADO FEC-FECH )
      *         MOVE FEC-SUM-DIA  TO FEC-CMND
      *         MOVE 1            TO FEC-NDIA
      *         MOVE FEC-FORM-FEC TO FEC-FORM
      *         PERFORM CAL-FEC
      *         IF NOT FEC-STAT-OKS
      *              DISPLAY ' '
      *              DISPLAY ' PROCESO CANCELADO EN ACC-FPRO '
      *              DISPLAY ' ERROR EN OBTENCION FECHA MANANA '
      *                                              FEC-STAT
      *              PERFORM DAP-PRO-ABT
      *         ELSE
      *              MOVE FEC-ITM1    TO WSS-NUM-DINI
      *              MOVE FEC-ITM2    TO WSS-NUM-MINI
      *              MOVE FEC-ITM3    TO WSS-NUM-SINI
      *              MOVE FEC-ITM4    TO WSS-NUM-AINI.

      * CIC-ACC-FPRO.
      ** ISP: YA ESTA CARGADO FEC-FECH
      *              MOVE FEC-FORM-FEC TO FEC-FORM
      *              MOVE FEC-FBLK-N  TO FEC-FBLK
      *              MOVE FEC-CHOY-N  TO FEC-CHOY
      *              MOVE FEC-VHBL-S  TO FEC-VHBL
      *              MOVE FEC-VAL-FEC TO FEC-CMND
      *              PERFORM PRO-FEC
      *              IF NOT FEC-STAT-HBL
      *                  MOVE FEC-SUM-DIA  TO FEC-CMND
      *                  MOVE 1            TO FEC-NDIA
      *                  MOVE FEC-FORM-FEC TO FEC-FORM
      *                  PERFORM CAL-FEC
      *                  IF NOT FEC-STAT-OKS
      *                     DISPLAY ' '
      *                     DISPLAY ' PROCESO CANCELADO EN ACC-FPRO '
      *                     DISPLAY ' ERROR EN OBTENCION FECHA MANANA '
      *                                                  FEC-STAT
      *                     PERFORM DAP-PRO-ABT
      *                  ELSE
      *                     GO TO CIC-ACC-FPRO
      *              ELSE
      *                  MOVE FEC-ITM1    TO WSS-NUM-DFIN
      *                  MOVE FEC-ITM2    TO WSS-NUM-MFIN
      *                  MOVE FEC-ITM3    TO WSS-NUM-SFIN
      *                  MOVE FEC-ITM4    TO WSS-NUM-AFIN.

      *     DISPLAY 'FECHA DE PROCESO           : ' WSS-FEC-FPRO.
      *     MOVE WSS-NUM-SINI TO WSS-NUM-SDSP.
      *     MOVE WSS-NUM-AINI TO WSS-NUM-ADSP.
      *     MOVE WSS-NUM-MINI TO WSS-NUM-MDSP.
      *     MOVE WSS-NUM-DINI TO WSS-NUM-DDSP.
      *     DISPLAY 'FECHA INICIO SELECCION     : ' WSS-FEC-FDSP.
      *     MOVE WSS-NUM-SFIN TO WSS-NUM-SDSP.
      *     MOVE WSS-NUM-AFIN TO WSS-NUM-ADSP.
      *     MOVE WSS-NUM-MFIN TO WSS-NUM-MDSP.
      *     MOVE WSS-NUM-DFIN TO WSS-NUM-DDSP.
      *     DISPLAY 'FECHA TERMINO DE SELECCION : ' WSS-FEC-FDSP.
      *     DISPLAY '  '.
       FIN-ACC-FPRO.
           EXIT.

       ACC-FBEG SECTION.
       INI-ACC-FBEG.
      * ISP: ACEPTA COMO PARAMETRO LA FECHA DE INICIO DEL PROCESO,
      *      (WSS-FEC-FBEG) Y LA VALIDA
           DISPLAY 'INGRESE FECHA DE PARAMETRO (DDMMSSAA) : '.
           ACCEPT  WSS-FEC-FBEG IN WSS-VARI.
           DISPLAY ' FECHA DE PARAMETRO: ' WSS-FEC-FBEG IN WSS-VARI.

           MOVE WSS-FEC-FBEG IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO EN ACC-FBEG '
               DISPLAY ' ERROR EN VALIDACION FECHA DE PROCESO '
                                                 WSS-FEC-FBEG
               DISPLAY FEC-MENS
               PERFORM DAP-PRO-ABT
           ELSE
               MOVE WSS-NUM-DBEG TO WSS-NUM-DFIJ
               MOVE WSS-NUM-MBEG TO WSS-NUM-MFIJ
               MOVE WSS-NUM-SBEG TO WSS-NUM-SFIJ
               MOVE WSS-NUM-ABEG TO WSS-NUM-AFIJ.

      * ISP: ACEPTA COMO PARAMETRO EL TIPO DE PROCESO
      *
      * CPL = SOLO COMPLETA, EN RANGO :
      *            FECHA DE INICIO = FECHA DE PROCESO SI ESTA ES HABIL O
      *                              PRIMER DIA HABIL ANTERIOR + 1
      *                              ( ES DECIR PRIMER DIA INHABIL
      *                                EN EL RANGO DE DIAS INHABILES
      *                                CONTIGUOS ANTERIORES
      *                                EJ : DIA SABADO PARA PROCESO DEL
      *           FECHA DE TERMINO = FECHA DE PROCESO
      *
      * GEN = SOLO GENERA ( LIQUIDA FIJOS Y DEJA RENOVABLES
      *                          INCOMPLETOS RENOVABLES ) EN RANGO :
      *      DETERMINA EL RANGO DE BUSQUEDA PARA GENERAR RENOVACIONES Y
      *      LIQUIDACIONES COMO :
      *      FECHA DE INICIO  = FECHA DE PROCESO + 1
      *      FECHA DE TERMINO = PROXIMO DIA HABIL A FECHA DE PROCESO
      *
      * TOD = COMPLETA Y GENERA

           DISPLAY 'INGRESE TIPO DE PROCESO CPL,GEN O TOD'
           ACCEPT WSS-COD-TPRO.
           DISPLAY ' '.
           DISPLAY ' ================================='
                   '=================================='.
           DISPLAY ' TIPO DE PROCESO : ' WSS-COD-TPRO.

           IF NOT ( WSS-COD-TPRO = 'CPL' OR 'GEN' OR 'TOD' )
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO'
               DISPLAY ' ERROR EN VALIDACION TIPO DE PROCESO '
               DISPLAY ' DEBE SER CPL, GEN O TOD '
               PERFORM DAP-PRO-ABT.

           PERFORM OBT-FEC-FINI.

           PERFORM OBT-FEC-FTER.

       FIN-ACC-FBEG.
           EXIT.

       OBT-FEC-FINI SECTION.
       INI-OBT-FEC-FINI.
      * BUSCA FECHA DE INICIO
           MOVE WSS-NUM-DBEG TO WSS-NUM-DINI.
           MOVE WSS-NUM-MBEG TO WSS-NUM-MINI.
           MOVE WSS-NUM-SBEG TO WSS-NUM-SINI.
           MOVE WSS-NUM-ABEG TO WSS-NUM-AINI.

           MOVE WSS-NUM-DINI TO FEC-ITM1.
           MOVE WSS-NUM-MINI TO FEC-ITM2.
           MOVE WSS-NUM-SINI TO FEC-ITM3.
           MOVE WSS-NUM-AINI TO FEC-ITM4.

       CIC-OBT-FEC-FINI.

           IF WSS-COD-TPRO = 'CPL' OR 'TOD'
               MOVE FEC-RST-DIA  TO FEC-CMND
               MOVE 1            TO FEC-NDIA
               MOVE FEC-FORM-FEC TO FEC-FORM
               PERFORM CAL-FEC
               IF NOT FEC-STAT-OKS
                   DISPLAY ' '
                   DISPLAY ' PROCESO CANCELADO EN ACC-FINI '
                   DISPLAY ' ERROR EN OBTENCION FECHA AYER '
                                                   FEC-STAT
                   PERFORM DAP-PRO-ABT
               ELSE
      *ISP YA ESTA CARGADO FEC-FECH
                   MOVE FEC-FORM-FEC TO FEC-FORM
                   MOVE FEC-FBLK-N   TO FEC-FBLK
                   MOVE FEC-CHOY-N   TO FEC-CHOY
                   MOVE FEC-VHBL-S   TO FEC-VHBL
                   MOVE FEC-VAL-FEC  TO FEC-CMND
                   PERFORM PRO-FEC
                   IF NOT FEC-STAT-OKS
      *ISP DIA NO HABIL
                       MOVE FEC-ITM1 TO WSS-NUM-DINI
                       MOVE FEC-ITM2 TO WSS-NUM-MINI
                       MOVE FEC-ITM3 TO WSS-NUM-SINI
                       MOVE FEC-ITM4 TO WSS-NUM-AINI
                       GO TO CIC-OBT-FEC-FINI.

           IF WSS-COD-TPRO = 'GEN'
      * ISP: OBTIENE FECHA DE MANANA ( YA ESTA CARGADO FEC-FECH )
               MOVE FEC-SUM-DIA  TO FEC-CMND
               MOVE 1            TO FEC-NDIA
               MOVE FEC-FORM-FEC TO FEC-FORM
               PERFORM CAL-FEC
               IF NOT FEC-STAT-OKS
                    DISPLAY ' '
                    DISPLAY ' PROCESO CANCELADO EN ACC-FINI '
                    DISPLAY ' ERROR EN OBTENCION FECHA MANANA '
                                                    FEC-STAT
                    PERFORM DAP-PRO-ABT
               ELSE
                    MOVE FEC-ITM1    TO WSS-NUM-DINI
                    MOVE FEC-ITM2    TO WSS-NUM-MINI
                    MOVE FEC-ITM3    TO WSS-NUM-SINI
                    MOVE FEC-ITM4    TO WSS-NUM-AINI.
           DISPLAY ' FECHA INICIAL PARA BUSQUEDA VENCIMIENTOS '
                   WSS-NUM-DINI
                   WSS-NUM-MINI
                   WSS-NUM-SINI
                   WSS-NUM-AINI.
       FIN-OBT-FEC-FINI.
           EXIT.

       OBT-FEC-FTER SECTION.
       INI-OBT-FEC-FTER.

           MOVE WSS-NUM-DBEG TO WSS-NUM-DTER.
           MOVE WSS-NUM-MBEG TO WSS-NUM-MTER.
           MOVE WSS-NUM-SBEG TO WSS-NUM-STER.
           MOVE WSS-NUM-ABEG TO WSS-NUM-ATER.

           MOVE WSS-NUM-DBEG TO FEC-ITM1.
           MOVE WSS-NUM-MBEG TO FEC-ITM2.
           MOVE WSS-NUM-SBEG TO FEC-ITM3.
           MOVE WSS-NUM-ABEG TO FEC-ITM4.


       CIC-OBT-FEC-FTER.
           IF WSS-COD-TPRO = 'GEN' OR 'TOD'
                        MOVE FEC-SUM-DIA  TO FEC-CMND
                        MOVE 1            TO FEC-NDIA
                        MOVE FEC-FORM-FEC TO FEC-FORM
                        PERFORM CAL-FEC
                        IF NOT FEC-STAT-OKS
                           DISPLAY ' '
                           DISPLAY ' PROCESO CANCELADO EN ACC-FTER '
                           DISPLAY ' ERROR EN OBTENCION FECHA MANANA '
                                                        FEC-STAT
                           PERFORM DAP-PRO-ABT
                        ELSE
                           MOVE FEC-ITM1    TO WSS-NUM-DTER
                           MOVE FEC-ITM2    TO WSS-NUM-MTER
                           MOVE FEC-ITM3    TO WSS-NUM-STER
                           MOVE FEC-ITM4    TO WSS-NUM-ATER

                           MOVE FEC-FORM-FEC TO FEC-FORM
                           MOVE FEC-FBLK-N  TO FEC-FBLK
                           MOVE FEC-CHOY-N  TO FEC-CHOY
                           MOVE FEC-VHBL-S  TO FEC-VHBL
                           MOVE FEC-VAL-FEC TO FEC-CMND
                           PERFORM PRO-FEC
                           IF NOT FEC-STAT-HBL
                               GO TO CIC-OBT-FEC-FTER.

           DISPLAY ' FECHA FINAL   PARA BUSQUEDA VENCIMIENTOS '
                   WSS-NUM-DTER
                   WSS-NUM-MTER
                   WSS-NUM-STER
                   WSS-NUM-ATER.
           IF WSS-COD-TPRO = 'CPL'
               DISPLAY ' SOLO COMPLETARA '.
           IF WSS-COD-TPRO = 'GEN'
               DISPLAY ' SOLO GENERARA '.
           IF WSS-COD-TPRO = 'TOD'
               DISPLAY ' COMPLETARA Y GENERARA'.
           DISPLAY ' ================================='
                   '=================================='.
       FIN-OBT-FEC-FTER.
           EXIT.

       GET-CSON SECTION.
       INI-GET-CSON.
           MOVE 'GNS' TO TAB-COD-SIST.
           MOVE 'SON' TO TAB-CIC-TTAB IN TAB.
           MOVE 'S'   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM VAL-TAB.
           IF MSG-COD-MENS > SPACES
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR VALIDACION EN GET-CSON '
                                                 MSG-COD-MENS
               PERFORM DAP-PRO-ABT
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO SCR-CSON-S
               DISPLAY ' '.
               DISPLAY ' INDICADOR AFIRMATIVO : '
                                           TAB-COD-CTAB IN TAB.
       FIN-GET-CSON.
           EXIT.

       GET-CGAR SECTION.
       INI-GET-CGAR.
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'GAR' TO TAB-CIC-TTAB IN TAB.
           MOVE 'N'   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM VAL-TAB.
           IF MSG-COD-MENS > SPACES
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR VALIDACION EN GET-CGAR '
                                             MSG-COD-MENS
               PERFORM DAP-PRO-ABT
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO SCR-CGAR-N
               DISPLAY ' '.
               DISPLAY ' INDICADOR NEGATIVO   : '
                                           TAB-COD-CTAB IN TAB.
       FIN-GET-CGAR.
           EXIT.

       GET-CTBL SECTION.
       INI-GET-CTBL.
           MOVE 'TAB'  TO MSC-COD-SIST.
           MOVE 'TCYA' TO MSC-CIC-TMSC IN MSC.
           MOVE 'CTBL'  TO MSC-CIC-CMSC IN MSC
           MOVE 'MSC-CIC-TABL' TO FIO-AKEY.
           PERFORM BUS-MSC.
           IF MSG-COD-MENS > SPACES
               DISPLAY ' '
               DISPLAY 'PROCESO CANCELADO EN GET-CTBL '
               DISPLAY 'ERROR EN OBTENCION COD. CONTABLE '
                                       MSG-COD-MENS
               PERFORM DAP-PRO-ABT
           ELSE
               MOVE MSC-COD-CMSC IN MSC TO SCR-CIC-CTBL
               DISPLAY ' '.
               DISPLAY ' CODIGO CONTABLE      : '
                                           MSC-COD-CMSC IN MSC
               DISPLAY ' '.
       FIN-GET-CTBL.
           EXIT.

       GET-TAD SECTION.
       INI-GET-TAD.
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'TAD' TO TAB-CIC-TTAB IN TAB.
           MOVE 'M'   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               DISPLAY ' '
               DISPLAY 'PROCESO CANCELADO '
               DISPLAY 'ERROR EN OBTENCION COD. DE MARGEN: '
                                       MSG-COD-MENS
               PERFORM DAP-PRO-ABT
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO SCR-TAD-M
               DISPLAY ' '.
               DISPLAY ' CODIGO MARGEN : ' TAB-COD-CTAB IN TAB.

           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'TAD' TO TAB-CIC-TTAB IN TAB.
           MOVE 'T'   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               DISPLAY ' '
               DISPLAY 'PROCESO CANCELADO '
               DISPLAY 'ERROR EN OBTENCION COD. DE TOPE: '
                                       MSG-COD-MENS
               PERFORM DAP-PRO-ABT
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO SCR-TAD-T
               DISPLAY ' '.
               DISPLAY ' CODIGO TOPE : ' TAB-COD-CTAB IN TAB.
       FIN-GET-TAD.
           EXIT.

       VAL-OPD-SGV-TINT SECTION.
       INI-VAL-OPD-SGV-TINT.
      *<<<< OPD_SGV_TINT
      *    acceso a PTD con VCAM de la pantalla
           IF SCR-CMND = 'MDA'
               GO TO FIN-VAL-OPD-SGV-TINT.
           PERFORM GET-FHOY.
           IF SCR-CMND = 'RLR'
               MOVE ZEROES TO OPD-SGV-TINT IN OPD-FLD
               IF HOY-FHOY = OPD-FEC-FREA IN OPD
                   GO TO FIN-VAL-OPD-SGV-TINT.

           MOVE SPACES TO MSG-COD-MENS.
           PERFORM GET-TINT.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-OPD-SGV-TINT.

       OPD-SGV-TINT-01.
      *VAL-FEC diferencia de fechas para calcular valor final
           MOVE OPD-FEC-FREA IN OPD-FLD TO FEC-FEC1.
           MOVE OPD-FEC-FPVC IN OPD-FLD TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA TO FEC-CMND.
           PERFORM CAL-FEC.
           IF FEC-STAT-OKS
               MOVE FEC-NDIA TO WSS-NDIA IN WSS-VARI
           ELSE
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               MOVE FEC-MENS     TO FRM-MENS
               GO TO FIN-VAL-OPD-SGV-TINT.

           MOVE 10 TO WSS-TRM-DIA.
           MOVE 5  TO WSS-TRM-MTO.

           MOVE 'N' TO WSS-IND-TDIA.
           PERFORM BUS-TRM-DIA VARYING FRM-IFLD FROM 1 BY 1 UNTIL
                   FRM-IFLD > 10 OR WSS-IND-TDIA = 'S'.
           IF WSS-IND-TDIA = 'N'
      *        tramo dia no especificado
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'TDIA NOESPEC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-OPD-SGV-TINT.

           MOVE 'N' TO WSS-IND-TMTO.
           PERFORM BUS-TRM-MTO VARYING FRM-IFLD FROM 5 BY -1 UNTIL
                   FRM-IFLD < 1 OR WSS-IND-TMTO = 'S'.

           IF WSS-IND-TMTO = 'N'
                MOVE 1 TO WSS-TRM-MTO.

      *     IF WSS-IND-TMTO = 'N'
      *        tramo monto no especificado
      *         MOVE 'DAP' TO MSG-COD-SIST
      *         MOVE 'TMTO NOESPEC' TO MSG-COD-MENS
      *         PERFORM GET-MSG
      *         MOVE MSG-GLS-DESC TO FRM-MENS
      *         MOVE FRM-SUAR-MAL TO FRM-SUAR
      *         GO TO FIN-VAL-OPD-SGV-TINT.

           MULTIPLY WSS-TRM-DIA BY 5 GIVING WSS-IDX-INT.
           SUBTRACT 5 FROM WSS-IDX-INT.
           ADD WSS-TRM-MTO TO WSS-IDX-INT.
      *     COMPUTE WSS-IDX-INT = 5 * WSS-TRM-DIA + WSS-TRM-MTO - 5.

           IF WSS-IND-TMTO = 'N'
               MOVE PTD-SGV-TMIN IN PTD(WSS-IDX-INT) TO
               PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
               MOVE ZEROES TO PTD-SGV-TADC IN PTD(WSS-TRM-MTO).

      *    simulacion asignacion tasa especial

           IF ATE-IND-ATEE = 'S'
               IF PTD-COD-TACO IN PTD > SPACES
                   IF PTD-COD-TACO IN PTD = SCR-TAD-M
                        ADD PTD-SGV-TADC IN PTD(WSS-TRM-MTO) TO
                            PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
                   ELSE
                        MOVE PTD-SGV-TADC IN PTD(WSS-TRM-MTO) TO
                              PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
               ELSE
               IF PTD-COD-TAFI IN PTD > SPACES
                   IF PTD-COD-TAFI IN PTD = SCR-TAD-M
                        ADD PTD-SGV-TAFI IN PTD(WSS-TRM-DIA) TO
                              PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
                   ELSE
                         MOVE PTD-SGV-TAFI IN PTD(WSS-TRM-DIA) TO
                              PTD-SGV-TMAX IN PTD(WSS-IDX-INT).

           IF OPD-SGV-TINT IN OPD-FLD NOT > ZEROES
               MOVE PTD-SGV-TMIN IN PTD(WSS-IDX-INT) TO
                    OPD-SGV-TINT IN OPD-FLD.

           IF OPD-SGV-TINT IN OPD-FLD <
              PTD-SGV-TMIN IN PTD(WSS-IDX-INT) OR
              OPD-SGV-TINT IN OPD-FLD >
              PTD-SGV-TMAX IN PTD(WSS-IDX-INT)
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'TINT    FRNG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO WSS-GLS-1RNG IN WSS-VARI
               MOVE PTD-SGV-TMIN IN PTD(WSS-IDX-INT) TO
                    WSS-GLS-2RNG IN WSS-VARI
               MOVE PTD-SGV-TMAX IN PTD(WSS-IDX-INT) TO
                    WSS-GLS-4RNG IN WSS-VARI
               MOVE WSS-GLS-MRNG IN WSS-VARI TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>> OPD_SGV_TINT
       FIN-VAL-OPD-SGV-TINT.
           EXIT.

       CAL-CAP-INT SECTION.
       INI-CAL-CAP-INT.
           MOVE ZEROES TO SCR-IDNI.
      *     IF SCR-CIC-MORE = 'N'
      *         MOVE WSS-VAL-CAPI TO SCR-CAPI
      *         MULTIPLY WSS-VAL-CAPI BY INT-TIPE
      *                               GIVING SCR-INTE ROUNDED
      *     ELSE
      * ISP:  25-OCT-1991 05:36:48
      *       NO COMPLETO CORRECTAMENTE VALOR VEN

           MOVE WSS-VAL-CAPI TO SCR-CAPI.
      * ISP: FIN
           MULTIPLY WSS-VAL-CAPI BY INT-TIPE GIVING SCR-INTE ROUNDED.
           IF SCR-CIC-MORE = 'PI'
               MOVE ZEROES TO SCR-CAPI
      * ISP: CALCULO 100% INTERESES
               MOVE SCR-INTE TO SCR-IDNI
               MULTIPLY SCR-INTE BY OPD-SGV-MPRE IN OPD-FLD
                   GIVING SCR-INTE ROUNDED
               DIVIDE SCR-INTE BY 100 GIVING SCR-INTE
               SUBTRACT SCR-INTE FROM SCR-IDNI GIVING
                                      SCR-IDNI
               IF SCR-CIC-VCAM = PDB-CIC-0999
      *    aproximaciones de cantidades en pesos
                  MOVE SCR-IDNI TO PES-SGV-DECI
                  PERFORM PES-SCTV
                  MOVE PES-SGV-ENTE TO SCR-IDNI
               ELSE
                  NEXT SENTENCE
           ELSE
           IF SCR-CIC-MORE = 'PC'
               MOVE VEN-VAL-CAPI IN VEN TO SCR-CAPI
           ELSE
           IF SCR-CIC-MORE = 'MC'
               MOVE VEN-VAL-CAPI IN VEN TO SCR-CAPI
           ELSE
           IF SCR-CIC-MORE = 'CO'
               MOVE VEN-VAL-CAPI IN VEN TO SCR-CAPI
           ELSE
           IF SCR-CIC-MORE = 'FO'
               SUBTRACT SCR-INTE FROM VEN-VAL-FINA IN VEN
                        GIVING SCR-CAPI.
       FIN-CAL-CAP-INT.
           EXIT.

       BUS-TRM-DIA SECTION.
       INI-BUS-TRM-DIA.
           IF WSS-NDIA IN WSS-VARI NOT >
              PTD-NUM-DIAS IN PTD(FRM-IFLD)
               MOVE FRM-IFLD TO WSS-TRM-DIA
               MOVE 'S' TO WSS-IND-TDIA.
       FIN-BUS-TRM-DIA.
           EXIT.

       BUS-TRM-MTO SECTION.
       INI-BUS-TRM-MTO.
           IF PTD-VAL-MNTO IN PTD(FRM-IFLD) > ZEROES
               IF OPD-VAL-CAPT IN OPD-FLD NOT <
                   PTD-VAL-MNTO IN PTD(FRM-IFLD)
                   MOVE FRM-IFLD TO WSS-TRM-MTO
                   MOVE 'S' TO WSS-IND-TMTO.
       FIN-BUS-TRM-MTO.
           EXIT.

       OBT-CIC-PER SECTION.
       INI-OBT-CIC-PER.
      * ISP: OBTIENE CIC DE UN CODIGO DE PERIODO CARGADO EN MSC-COD-CMSC
      *      Y LO ENTREGA EN WSS-CIC-PER
           MOVE 'TAB'                   TO MSC-COD-SIST.
           MOVE 'IPER'                  TO MSC-COD-TMSC IN MSC.
           PERFORM BUS-MSC.
           MOVE MSC-CIC-CMSC IN MSC     TO WSS-CIC-PER.
       FIN-OBT-CIC-PER.
           EXIT.

       SEL-PER SECTION.
       INI-SEL-PER.
      * ISP: OBTIENE EN FEC-FECH LA SUMA DE UNA FECHA CARGADA EN FEC-FEC
      *      + UN PERIODO ( WSS-CIC-PER Y WSS-NUM-PER )
           IF WSS-CIC-PER = 'D'
               MOVE FEC-SUM-DIA TO FEC-CMND
               MOVE WSS-NUM-PER TO FEC-NDIA
           ELSE
           IF WSS-CIC-PER = 'M'
               MOVE FEC-SUM-MES TO FEC-CMND
               MOVE WSS-NUM-PER TO FEC-NMES
           ELSE
           IF WSS-CIC-PER = 'A'
               MOVE FEC-SUM-ANO TO FEC-CMND
               MOVE WSS-NUM-PER TO FEC-NANO.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           PERFORM CAL-FEC.
       FIN-SEL-PER.
           EXIT.

       GET-TINT SECTION.
       INI-GET-TINT.
      *    obtener PTD mas actual y vigente
      *    acceso a PTD con VCAM de la pantalla
      * ISP: PARA OPERACIONES ANTERIORES LAS BUSCA CON LLAVE PTD
      *      FREA + HORA ( COMPUTACIONAL O 235959 )
           MOVE OPD-COD-VCAM IN OPD-FLD TO PTD-COD-VCAM IN PTD.
           MOVE SPACES                  TO PTD-COD-OFIC IN PTD.
           MOVE SPACES                  TO PTD-COD-TOPD IN PTD.
           MOVE SPACES                  TO PTD-COD-AOPD IN PTD.
           PERFORM GET-FHOY.
           MOVE HOY-DHOY TO PTD-NUM-DPTD IN PTD.
           MOVE HOY-MHOY TO PTD-NUM-MPTD IN PTD.
           MOVE HOY-SHOY TO PTD-NUM-SPTD IN PTD.
           MOVE HOY-AHOY TO PTD-NUM-APTD IN PTD.

      *     IF OPD-FEC-FREA IN OPD-FLD = OPD-FEC-FCMP IN OPD-FLD
      *           MOVE HOY-HHOY TO PTD-HRA-HRPT IN PTD
      *     ELSE
                 MOVE '235959' TO PTD-HRA-HRPT IN PTD.
      * ISP: DAPBG004
           PERFORM CMP-FEC-PTD.

           MOVE FIO-GET-NLS TO FIO-CMND.

       LUP-GET-TINT.
           PERFORM DAP-FIO-PTD.
           IF NOT ( FIO-STAT-OKS AND
                    OPD-COD-VCAM IN OPD-FLD = PTD-COD-VCAM IN PTD )
      *        PTD inexistente
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'PTD    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-GET-TINT.

           IF NOT ( ( PTD-COD-STAT IN PTD = 'S' )
                    AND
                    ( PTD-COD-TOPD IN PTD = '*' OR
                      PTD-COD-TOPD IN PTD = OPD-COD-TOPD IN OPD-FLD )
                    AND
                    ( PTD-COD-AOPD IN PTD = '*' OR
                      PTD-COD-AOPD IN PTD = OPD-COD-AOPD IN OPD-FLD )
                    AND
                    ( PTD-COD-OFIC IN PTD = '*' OR
                      PTD-COD-OFIC IN PTD = OPD-COD-OFIC IN OPD-FLD ) )
               MOVE FIO-GET-NXT TO FIO-CMND
               GO TO LUP-GET-TINT.

       FIN-GET-TINT.
           EXIT.

       PUT-OPD-OPD SECTION.
       INI-PUT-OPD-OPD.
           MOVE OPD-NUM-DCMP IN OPD TO OPD-NUM-DCMP IN OPD-FLD.
           MOVE OPD-NUM-MCMP IN OPD TO OPD-NUM-MCMP IN OPD-FLD.
           MOVE OPD-NUM-SCMP IN OPD TO OPD-NUM-SCMP IN OPD-FLD.
           MOVE OPD-NUM-ACMP IN OPD TO OPD-NUM-ACMP IN OPD-FLD.
           MOVE OPD-NUM-DREA IN OPD TO OPD-NUM-DREA IN OPD-FLD.
           MOVE OPD-NUM-MREA IN OPD TO OPD-NUM-MREA IN OPD-FLD.
           MOVE OPD-NUM-SREA IN OPD TO OPD-NUM-SREA IN OPD-FLD.
           MOVE OPD-NUM-AREA IN OPD TO OPD-NUM-AREA IN OPD-FLD.
           MOVE OPD-NUM-DCTB IN OPD TO OPD-NUM-DCTB IN OPD-FLD.
           MOVE OPD-NUM-MCTB IN OPD TO OPD-NUM-MCTB IN OPD-FLD.
           MOVE OPD-NUM-SCTB IN OPD TO OPD-NUM-SCTB IN OPD-FLD.
           MOVE OPD-NUM-ACTB IN OPD TO OPD-NUM-ACTB IN OPD-FLD.
           MOVE OPD-COD-VCAM IN OPD TO OPD-COD-VCAM IN OPD-FLD.
           MOVE OPD-COD-TOPD IN OPD TO OPD-COD-TOPD IN OPD-FLD.
           MOVE OPD-COD-AOPD IN OPD TO OPD-COD-AOPD IN OPD-FLD.
           MOVE OPD-COD-OFIC IN OPD TO OPD-COD-OFIC IN OPD-FLD.
           MOVE OPD-NUM-DPVC IN OPD TO OPD-NUM-DPVC IN OPD-FLD.
           MOVE OPD-NUM-MPVC IN OPD TO OPD-NUM-MPVC IN OPD-FLD.
           MOVE OPD-NUM-SPVC IN OPD TO OPD-NUM-SPVC IN OPD-FLD.
           MOVE OPD-NUM-APVC IN OPD TO OPD-NUM-APVC IN OPD-FLD.
           MOVE OPD-NUM-DTER IN OPD TO OPD-NUM-DTER IN OPD-FLD.
           MOVE OPD-NUM-MTER IN OPD TO OPD-NUM-MTER IN OPD-FLD.
           MOVE OPD-NUM-STER IN OPD TO OPD-NUM-STER IN OPD-FLD.
           MOVE OPD-NUM-ATER IN OPD TO OPD-NUM-ATER IN OPD-FLD.
           MOVE OPD-VAL-CAPT IN OPD TO OPD-VAL-CAPT IN OPD-FLD.
           MOVE OPD-COD-EATE IN OPD TO OPD-COD-EATE IN OPD-FLD.
           MOVE OPD-SGV-TINT IN OPD TO OPD-SGV-TINT IN OPD-FLD.
           MOVE OPD-COD-MORE IN OPD TO OPD-COD-MORE IN OPD-FLD.
           MOVE OPD-COD-GARA IN OPD TO OPD-COD-GARA IN OPD-FLD.
           MOVE OPD-COD-CUST IN OPD TO OPD-COD-CUST IN OPD-FLD.
           MOVE OPD-COD-IONP IN OPD TO OPD-COD-IONP IN OPD-FLD.
           MOVE OPD-NUM-DURV IN OPD TO OPD-NUM-DURV IN OPD-FLD.
           MOVE OPD-IND-DURV IN OPD TO OPD-IND-DURV IN OPD-FLD.
           MOVE OPD-NUM-SEVE IN OPD TO OPD-NUM-SEVE IN OPD-FLD.
           MOVE OPD-IND-SEVE IN OPD TO OPD-IND-SEVE IN OPD-FLD.
           MOVE OPD-SGV-MPRE IN OPD TO OPD-SGV-MPRE IN OPD-FLD.
           MOVE OPD-NUM-RETD IN OPD TO OPD-NUM-RETD IN OPD-FLD.
           MOVE OPD-IND-RETD IN OPD TO OPD-IND-RETD IN OPD-FLD.
           MOVE OPD-COD-UBFD IN OPD TO OPD-COD-UBFD IN OPD-FLD.
           MOVE OPD-COD-DEVL IN OPD TO OPD-COD-DEVL IN OPD-FLD.
           MOVE OPD-COD-AFER IN OPD TO OPD-COD-AFER IN OPD-FLD.
           MOVE OPD-COD-STAT IN OPD TO OPD-COD-STAT IN OPD-FLD.
           MOVE OPD-COD-SCTB IN OPD TO OPD-COD-SCTB IN OPD-FLD.
           MOVE OPD-COD-EJEC IN OPD TO OPD-COD-EJEC IN OPD-FLD.
           MOVE OPD-CAI-IOPD IN OPD TO OPD-CAI-IOPD IN OPD-FLD.
           MOVE OPD-IIC-IOPD IN OPD TO OPD-IIC-IOPD IN OPD-FLD.
           MOVE OPD-CAI-ISER IN OPD TO OPD-CAI-ISER IN OPD-FLD.
           MOVE OPD-IIC-ISER IN OPD TO OPD-IIC-ISER IN OPD-FLD.
       FIN-PUT-OPD-OPD.
           EXIT.

       PRO-IPA SECTION.
       INI-PRO-IPA.
      *     MOVE WSS-BKP-OPD IN WSS-VARI TO OPD-CIC-IOPD IN OPD.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM DAP-FIO-OPD.
      *     IF NOT FIO-STAT-OKS
      *         DISPLAY ' '
      *         DISPLAY ' PROCESO CANCELADO '
      *         DISPLAY ' OPD INEXISTENTE EN PRO-IPA : CIC='
      *                                  OPD-CIC-IOPD IN OPD
      *         PERFORM DAP-PRO-ABT.

      *     MOVE WSS-BKP-OPD IN WSS-VARI TO VEN-CIC-IOPD IN VEN.
      *     MOVE 1                       TO VEN-NUM-IVEN IN VEN.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM DAP-FIO-VEN.
      *     IF NOT FIO-STAT-OKS
      *         DISPLAY ' '
      *         DISPLAY ' PROCESO CANCELADO '
      *         DISPLAY 'VEN INEXISTENTE EN PRO-IPA : CIC='
      *                  VEN-CIC-IOPD IN VEN
      *         PERFORM DAP-PRO-ABT.

      *    IPA Registro
           MOVE ZEROES TO IPA.
      *
      *    SERIAL de la operacion captacion
           MOVE OPD-CIC-ISER IN OPD TO IPA-CIC-ISER IN IPA.
      *
      *    Fecha de Vencimiento
           MOVE VEN-FEC-FVEN IN VEN TO IPA-FEC-FVEN IN IPA.
      *
      *    Clase de Operacion
           MOVE OPD-COD-COPD IN OPD TO IPA-COD-COPD IN IPA.
      *
      *    Monto de la Captacion
      *    TOMA DIFERENTES VALORES DEPENDIENDO DEL TIPO DE PRODUCTO
           MOVE OPD-VAL-CAPT IN OPD TO IPA-VAL-CAPT IN IPA.
      *
      *    Monto Capatacion Original
           MOVE OPD-VAL-READ IN OPD TO IPA-VAL-CAIN IN IPA.
      *
      *    Monto Intereses Periodo
           COMPUTE IPA-VAL-INTS IN IPA =
                      VEN-VAL-SFIN IN VEN - VEN-VAL-SCAP IN VEN
                    + VEN-VAL-IDNI IN VEN.
      *     IF ( SCR-CIC-TVAL = PDB-CIC-MNAC AND
      *          SCR-CIC-VCAM NOT = PDB-CIC-0999 )
      *          MULTIPLY IPA-VAL-INTS IN IPA BY WSS-SGV-VCAM-FVEN
      *                    GIVING IPA-VAL-INTS IN IPA.
      * ISP LOS INTERESES ESTAN CALCULADOS CON LOS DECIMALES ADECUADOS
      *     MOVE IPA-VAL-INTS IN IPA TO PES-SGV-DECI.
      *     MOVE SCR-CIC-VCAM TO PES-CIC-VCAM.
      *     PERFORM PES-SCTV.
      *     MOVE PES-SGV-ENTE TO IPA-VAL-INTS IN IPA.

      *    Monto Liquidado
           MOVE ZEROES TO IPA-VAL-MLIQ IN IPA.

      *    Oficina de Liquidacion
           MOVE ZEROES TO IPA-COD-OFLI IN IPA.

      *    Fecha de liquidacion
           MOVE ZEROES TO IPA-NUM-SLIQ IN IPA
                          IPA-NUM-ALIQ IN IPA
                          IPA-NUM-MLIQ IN IPA
                          IPA-NUM-DLIQ IN IPA.

      *    Calcula Diferencia en Dias
           MOVE OPD-NUM-DDEV IN OPD TO FEC-DEC1.
           MOVE OPD-NUM-MDEV IN OPD TO FEC-MEC1.
           MOVE OPD-NUM-SDEV IN OPD TO FEC-SEC1.
           MOVE OPD-NUM-ADEV IN OPD TO FEC-AEC1.
           MOVE OPD-NUM-DPVC IN OPD TO FEC-DEC2.
           MOVE OPD-NUM-MPVC IN OPD TO FEC-MEC2.
           MOVE OPD-NUM-SPVC IN OPD TO FEC-SEC2.
           MOVE OPD-NUM-APVC IN OPD TO FEC-AEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
              DISPLAY 'ERROR CAL-FEC PRO-IPA ' FEC-MENS
              MOVE ZEROES TO FEC-NDIA.
      *    Plazo en Dias
           MOVE FEC-NDIA TO IPA-NUM-PLZO IN IPA.

      *    Codigo de Moneda
           MOVE OPD-MSC-TVAL IN OPD TO WSS-MSC-TVAL IN WSS-VARI.
           MOVE OPD-COD-CVAL IN OPD TO WSS-COD-CVAL IN WSS-VARI.
           MOVE WSS-NUM-MONE IN WSS-VARI TO IPA-NUM-TVAL IN IPA.

      *    Valor Tasa
           MOVE OPD-VAL-SINT IN OPD TO IPA-SGV-TINT IN IPA.

      *    Fecha de Captacion
           MOVE OPD-FEC-FDEV IN OPD TO IPA-FEC-FCAP IN IPA.

      *    Obtiene datos de clientes
           PERFORM GET-CUR-RCC.
           IF WSS-STAT-RCC IN WSS-VARI = 0
              PERFORM GET-RCC-DBC
              MOVE DBC-NUM-ICLI IN DBC TO IPA-NUM-CLI1 IN IPA
              MOVE DBC-VRF-ICLI IN DBC TO IPA-VRF-CLI1 IN IPA
              MOVE DBC-GLS-NOMC IN DBC TO IPA-GLS-NOM1 IN IPA
              PERFORM GET-RCC-RCD
              MOVE RCD-GLS-DIRE IN RCD TO IPA-GLS-DIR1 IN IPA
              MOVE WSS-IND-LUGA        TO IPA-COD-CIU1 IN IPA
              PERFORM GET-NXT-RCC
              IF WSS-IND-MCLI IN WSS-VARI = 'M'
                 PERFORM GET-RCC-DBC
                 MOVE DBC-NUM-ICLI IN DBC TO IPA-NUM-CLI2 IN IPA
                 MOVE DBC-VRF-ICLI IN DBC TO IPA-VRF-CLI2 IN IPA
                 MOVE DBC-GLS-NOMC IN DBC TO IPA-GLS-NOM2 IN IPA
                 PERFORM GET-RCC-RCD
                 MOVE RCD-GLS-DIRE IN RCD TO IPA-GLS-DIR2 IN IPA
                 MOVE WSS-IND-LUGA        TO IPA-COD-CIU2 IN IPA
              ELSE
                 MOVE ZEROES TO IPA-NUM-CLI2 IN IPA
                 MOVE ZEROES TO IPA-VRF-CLI2 IN IPA
                 MOVE SPACES TO IPA-GLS-NOM2 IN IPA
                 MOVE SPACES TO IPA-GLS-DIR2 IN IPA
                 MOVE ZEROES TO IPA-COD-CIU2 IN IPA
           ELSE
              MOVE ZEROES TO IPA-NUM-CLI1 IN IPA
              MOVE ZEROES TO IPA-VRF-CLI1 IN IPA
              MOVE SPACES TO IPA-GLS-NOM1 IN IPA
              MOVE SPACES TO IPA-GLS-DIR1 IN IPA
              MOVE ZEROES TO IPA-COD-CIU1 IN IPA
              MOVE ZEROES TO IPA-NUM-CLI2 IN IPA
              MOVE ZEROES TO IPA-VRF-CLI2 IN IPA
              MOVE SPACES TO IPA-GLS-NOM2 IN IPA
              MOVE SPACES TO IPA-GLS-DIR2 IN IPA
              MOVE ZEROES TO IPA-COD-CIU2 IN IPA.
       FIN-PRO-IPA.
           EXIT.

       PRO-LOAD-IPA SECTION.
       INI-PRO-LOAD-IPA.
      *
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-IPA.
           IF NOT FIO-STAT-OKS
              DISPLAY ' '
              DISPLAY 'PROCESO CANCELADO EN PRO-LOAD-IPA '
              DISPLAY 'ERROR FIO-PUT IPA: ' IPA ' FS: ' FIO-STAT
              PERFORM DAP-PRO-ABT.
       FIN-PRO-LOAD-IPA.
           EXIT.

       GET-CUR-RCC SECTION.
       INI-GET-CUR-RCC.
           MOVE 0  TO WSS-STAT-RCC IN WSS-VARI.
           MOVE OPD-CAI-IOPD IN OPD TO RCC-CAI-IOPD IN RCC.
           MOVE OPD-IIC-IOPD IN OPD TO RCC-IIC-IOPD IN RCC.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT FIO-STAT-OKS
              MOVE 1 TO WSS-STAT-RCC IN WSS-VARI.
       FIN-GET-CUR-RCC.
           EXIT.

       GET-NXT-RCC SECTION.
       INI-GET-NXT-RCC.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF FIO-STAT-OKS AND
              OPD-CAI-IOPD IN OPD = RCC-CAI-IOPD IN RCC AND
              OPD-IIC-IOPD IN OPD = RCC-IIC-IOPD IN RCC
                MOVE 'M'    TO WSS-IND-MCLI IN WSS-VARI
           ELSE
                MOVE SPACES TO WSS-IND-MCLI IN WSS-VARI.
       FIN-GET-NXT-RCC.
           EXIT.

      * Lee con CIC CLIENTE archivo DBC
       GET-RCC-DBC SECTION.
       INI-GET-RCC-DBC.
           MOVE RCC-CIC-ICLI IN RCC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
              PERFORM RST-DBC.
       FIN-GET-RCC-DBC.
           EXIT.

      * Limpia datos cliente desde DBC
       RST-DBC SECTION.
       INI-RST-DBC.
           MOVE SPACES TO DBC-GLS-NOMC IN DBC.
           MOVE SPACES TO DBC-NUM-ICLI IN DBC.
           MOVE SPACES TO DBC-VRF-ICLI IN DBC.
       FIN-RST-DBC.
           EXIT.

      * Lee con CIC CLIENTE archivo RCD
       GET-RCC-RCD SECTION.
       INI-GET-RCC-RCD.
           MOVE RCC-CIC-ICLI IN RCC TO RCD-CIC-ICLI IN RCD.
           MOVE RCC-NUM-DIRE IN RCC TO RCD-NUM-DIRE IN RCD.
           MOVE 'RCD-KEY-IRCD' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCD.
           IF NOT FIO-STAT-OKS
              PERFORM RST-RCD
           ELSE
              MOVE RCD-COD-LUGA IN RCD TO WSS-COD-LUGA IN WSS-VARI.
       FIN-GET-RCC-RCD.
           EXIT.

      * Limpia datos cliente desde RCD
       RST-RCD SECTION.
       INI-RST-RCD.
           MOVE SPACES TO RCD-GLS-DIRE IN RCD.
           MOVE SPACES TO RCD-COD-LUGA IN RCD.
           MOVE ZEROES TO WSS-NUM-LUGA IN WSS-VARI.
       FIN-RST-RCD.
           EXIT.

       DSP-MENS SECTION.
       INI-DSP-MENS.
           DISPLAY ' '.
           DISPLAY ' >> PROCESO CANCELADO << '.
           DISPLAY ' >> EN OPERACION  : ' OPD-CIC-IOPD IN OPD.
           DISPLAY ' '.
           DISPLAY WSS-GLS-MEN1.
           DISPLAY WSS-GLS-MEN2.
           IF DESPLIEGA-FIO-STAT
                DISPLAY ' FIO-STAT = ' FIO-STAT
                DISPLAY ' '.
           MOVE 'N' TO DSP-FIO-STAT.
           MOVE SPACES TO WSS-GLS-MEN1
                          WSS-GLS-MEN2
                          WSS-GLS-SECC.
       FIN-DSP-MENS.
           EXIT.

       DAP-PRO-ABT SECTION.
       INI-DAP-PRO-ABT.
           MOVE FIO-BCK-OUT TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           PERFORM GNS-PRO-ABT.
       FIN-DAP-PRO-ABT.
           EXIT.

       BUS-COR-ONP SECTION.
       INI-BUS-COR-ONP.
           MOVE 99 TO ONP-NUM-CORR IN ONP.
           MOVE FIO-GET-LEQ TO FIO-CMND.
           PERFORM DAP-FIO-ONP.
           IF NOT (FIO-STAT-OKS AND WSS-LLAVE-ONP = ONP-CIC-IOPD IN ONP)
              MOVE 1 TO ONP-NUM-CORR IN ONP.
           MOVE 1 TO WSS-ICOR.
       FIN-BUS-COR-ONP.
           EXIT.
       GRABA-ONP SECTION.
       INI-GRABA-ONP.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-ONP.
           IF ONP-CIC-IOPD IN ONP NOT = WSS-LLAVE-ONP IN WSS-VARI
              OR NOT FIO-STAT-OKS
              MOVE 'S' TO WSS-CAMBIO-ONP
              GO TO FIN-GRABA-ONP.
           MOVE WSS-IOPD-NEW IN WSS-VARI TO ONP-CIC-IOPD IN ONP.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-ONP.
           IF NOT FIO-STAT-OKS
              DISPLAY 'ERROR GRABA ONP: ' ONP-CIC-IOPD IN ONP ' CORR '
                      ONP-NUM-CORR IN ONP ' ABORTO EN PUT-ONP SECTION'
                      'ONP ANTIGUA    : ' WSS-LLAVE-ONP IN WSS-VARI
              MOVE ' ERROR AL GRABAR ONP ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              GO TO FIN-GRABA-ONP.
           ADD 1 TO ONP-NUM-CORR IN ONP.
           MOVE WSS-LLAVE-ONP IN WSS-VARI TO ONP-CIC-IOPD IN ONP.
           GO TO INI-GRABA-ONP.
       FIN-GRABA-ONP.
           EXIT.
       ELIMI-ONP SECTION.
       INI-ELIMI-ONP.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-ONP.
           IF NOT (FIO-STAT-OKS AND
              ONP-CIC-IOPD IN ONP = WSS-LLAVE-ONP IN WSS-VARI)
              MOVE ' ERROR AL LEER ONP ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              DISPLAY 'ERROR LEER ONP: ' ONP-CIC-IOPD IN ONP ' CORR '
                      ONP-NUM-CORR IN ONP ' ABORTO EN ELI-ONP SECTIO 1 '
                      WSS-LLAVE-ONP IN WSS-VARI ' <== LLAVE BUSCADA ST:'
                      FIO-STAT
              GO TO FIN-ELIMI-ONP.
       SIGUE-ELIMI-ONP.
           MOVE ONP-NUM-CORR IN ONP TO WSS-CORRE-ONP IN WSS-VARI.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-ONP.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL LEER ONP ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              DISPLAY 'ERROR LEER ONP: ' ONP-CIC-IOPD IN ONP ' CORR '
                      ONP-NUM-CORR IN ONP ' ABORTO EN ELI-ONP SECTION 2'
              GO TO FIN-ELIMI-ONP.
           MOVE FIO-DEL TO FIO-CMND.
           PERFORM DAP-FIO-ONP.
           IF NOT FIO-STAT-OKS
              MOVE ' ERROR AL ELIM ONP ' TO WSS-GLS-MEN2
              MOVE 1 TO WSS-STAT-REN
              DISPLAY 'ERROR BORRAR ONP: ' ONP-CIC-IOPD IN ONP ' CORR '
                      ONP-NUM-CORR IN ONP ' ABORTO EN ELI-ONP SECTION'
              GO TO FIN-ELIMI-ONP.
           MOVE WSS-LLAVE-ONP IN WSS-VARI TO ONP-CIC-IOPD.
           MOVE WSS-CORRE-ONP IN WSS-VARI TO ONP-NUM-CORR.
           ADD 1 TO ONP-NUM-CORR IN ONP.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-ONP.
           IF NOT (FIO-STAT-OKS AND
              ONP-CIC-IOPD IN ONP = WSS-LLAVE-ONP IN WSS-VARI)
              MOVE 'S' TO WSS-CAMBIO-ONP
              GO TO FIN-ELIMI-ONP.
           GO TO SIGUE-ELIMI-ONP.
       FIN-ELIMI-ONP.
           EXIT.


