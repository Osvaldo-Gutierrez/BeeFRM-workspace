*%! Codigo adicional programa DAPPAIPA
*% INCLUDE 'GNSSRC:MANEJO_VSI.SRC'
*% NO_HDR_CST = TRUE
*% NO_TIENE_TIMESTAMP = TRUE
*% IF SETTAG
*% FNCPQ = "091208"
*% VSNPQ = "10.01.05"
*% FNCPU = "091208"
*% VSNPU = "10.01.05"
*% END
*% IF WSS
      *<<<< WSS
       COPY GNSBRMSC.
       COPY GNSWGIDC.
      *JCT-INI 10-NOV-2011 CERTIFICADOS TRIBUTARIOS
       COPY DAPBRIPB.
       01  WSS-VARI.
           03 WSS-CT-DIPB     VALUE 'DTCIPB'      PIC X(06).
      *JCT-FIN 10-NOV-2011
      *MPB-INI ENE-2018 - CORR DE PROC QUE ELI REGS EN DAP
           03 WSS-ENT-LAD                     PIC X(03).
           03 WSS-UNO        VALUE 1          PIC 9(01).
           03 WSS-IPA     VALUE 'IPA'         PIC X(03).
           03 WSS-IPB     VALUE 'IPB'         PIC X(03).
           03 WSS-ELI     VALUE 'ELI'         PIC X(03).
           03 WSS-E       VALUE 'E'           PIC X(01).
           03 WSS-NA      VALUE 'N/A'         PIC X(03).
           03 WSS-1PT0    VALUE '1.0'         PIC X(03).
           03 WSS-LIQ     VALUE 'LIQ'         PIC X(03).
           03 WSS-CAD     VALUE 'CAD'         PIC X(03).
           03 WSS-S       VALUE 'S'           PIC X(01).
           03 WSS-23      VALUE '23'          PIC X(02).
           03 WSS-00      VALUE '00'          PIC X(02).
           03 WSS-RCCKEYIOPD VALUE 'RCC-KEY-IOPD' PIC X(12).
           03 WSS-OPDCICISER VALUE 'OPD-CIC-ISER' PIC X(12).
           03 WSS-CMT-LAD-B                        PIC X(35)
                  VALUE 'ELIMINACION VIA PANTALLA IP2 (IPB)'. 
           03 WSS-CMT-LAD-A                        PIC X(35)
                  VALUE 'ELIMINACION VIA PANTALLA IP2 (IPA)'.       
           03 WSS-DAP        VALUE 'DAP'         PIC X(03).               
      *MPB-FIN
      *MPB-INI 23-AGO-2018 - CORRECCION REGISTRO IPB (DAP) HITO IPA
           03 WSS-ARCHIPANEX VALUE 'ARCHIPANEX'  PIC X(10).
           03 WSS-CIC-IOPD   VALUE SPACES        PIC X(12).
           03 WSS-CMND       VALUE ZEROES        PIC 9(04).
           03 WSS-CIC-IOPD-IPB VALUE SPACES      PIC X(12).
      *MPB-FIN
      *>>>> END WSS
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
      *JCT-INI 10-NOV-2011 CERTIFICADOS TRIBUTARIOS
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-IPB-REQA==.
      *JCT-FIN 10-NOV-2011
*% IF PGM_PU
      *MPB-INI ENE-2018 - CORR DE PROC QUE ELI REGS EN DAP
       COPY DAPBROPD.                                           
       COPY DAPBRLAD.
       COPY DAPBRRCC.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LAD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCC-REQA==.      
      *MPB-FIN
*% END
      *>>>> END WSS_DTC
*% END
*% IF FIN_PGM_STAT
      *%<<<< FIN_PGM_STAT
*% IF PGM_PU
      *MPB-INI ENE-2018 - CORR DE PROC QUE ELI REGS EN DAP
              05 PGM-STAT-LAD.
                 88 PGM-STAT-LAD-NUL    VALUE '  '.
                 07 PGM-STT1-LAD        VALUE '2' PIC X(01).
                    88 PGM-STAT-LAD-OKS VALUE '0'.
                 07 PGM-STT2-LAD        VALUE '3' PIC X(01).
              05 PGM-STAT-RCC.
                 88 PGM-STAT-RCC-NUL    VALUE '  '.
                 07 PGM-STT1-RCC        VALUE '2' PIC X(01).
                    88 PGM-STAT-RCC-OKS VALUE '0'.
                 07 PGM-STT2-RCC        VALUE '3' PIC X(01).
      *MPB-FIN
*% END
      *>>>> END FIN_PGM_STAT
*% END
*% IF CMN_ELI
      *%<<<< CMN_ELI
*% IF PGM_PU
      *MPB-INI ENE-2018 - CORR DE PROC QUE ELI REGS EN DAP
           PERFORM OBT-OPD.
           PERFORM PRO-ELI-REG-LAD.

      *MPB-FIN      
*% END
      *>>>> END CMN_ELI
*% END
*% IF EOF
      *<<<< EOF
      *NOTA DAPIOIPA REEMPLAZA A DAPBFIPA
       COPY DAPIOIPA.      
       COPY GNSBPFEC.
       COPY GNSBVIDC.
       COPY GNSBVIND.
       COPY GNSBVMSC.
       COPY GNSBFMSC.
      *JCT-INI 10-NOV-2011 CERTIFICADOS TRIBUTARIOS
       COPY DAPBFIPB.
      *JCT-FIN 10-NOV-2011
*% IF PGM_PU
      *MPB-INI ENE-2018 - CORR DE PROC QUE ELI REGS EN DAP
       COPY DAPBFOPD.                                      
       COPY DAPBFLAD.
       COPY DAPBFRCC.      
 
       GET-CUR-RCC SECTION.
       INI-GET-CUR-RCC.
           MOVE OPD-CIC-IOPD IN OPD TO RCC-CIC-IOPD IN RCC.
           MOVE WSS-RCCKEYIOPD TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT (FIO-STAT-OKS AND
                  OPD-CIC-IOPD IN OPD = RCC-CIC-IOPD IN RCC)
                  MOVE WSS-23 TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-RCC.
       FIN-GET-CUR-RCC.
           EXIT.

       GET-NXT-RCC SECTION.
       INI-GET-NXT-RCC.
           MOVE SPACES TO MSG-COD-SIST.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE WSS-RCCKEYIOPD TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT ( FIO-STAT-OKS AND
                     OPD-CIC-IOPD IN OPD = RCC-CIC-IOPD IN RCC  )
               MOVE WSS-23 TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-RCC.
       FIN-GET-NXT-RCC.
           EXIT.
 
       PRO-ELI-REG-LAD  SECTION.
       INI-ELI-REG-LAD.
      *-------------------------
           MOVE   SPACES                  TO  LAD.
           MOVE   WSS-ELI                 TO  LAD-COD-EVEN IN LAD.
           MOVE   WSS-E                   TO  LAD-COD-TACC IN LAD
                                              LAD-COD-STAT IN LAD.
           MOVE   WSS-NA                  TO  LAD-COD-INST IN LAD.

           MOVE   WSS-UNO                 TO  LAD-NUM-CLAD IN LAD
                                              LAD-NUM-COPD IN LAD
                                              LAD-NUM-CCLI IN LAD
                                              LAD-NUM-CAUT IN LAD.
           PERFORM PRO-GRABA-REG-LAD.
       FIN-ELI-REG-LAD.
           EXIT. 

       PRO-GRABA-REG-LAD  SECTION.
      *---------------------------
       INI-GRABA-REG-LAD.
           MOVE   WSS-1PT0                TO  LAD-COD-VERS IN LAD.
           
           
           IF FRM-COD-VOID = WSS-CT-DIPB
               PERFORM OBT-IPB
               MOVE IPA    TO IPB
               MOVE WSS-CIC-IOPD-IPB      TO  IPB-CIC-IOPD IN IPB
               MOVE   WSS-IPB             TO  LAD-COD-ENTF IN LAD
                                              LAD-COD-ENTO IN LAD
                                              LAD-COD-ENTC IN LAD
                                              LAD-COD-ENTA IN LAD
                                              LAD-COD-ENTI IN LAD
           ELSE                                   
               MOVE   WSS-IPA             TO  LAD-COD-ENTF IN LAD
                                              LAD-COD-ENTO IN LAD
                                              LAD-COD-ENTC IN LAD
                                              LAD-COD-ENTA IN LAD
                                              LAD-COD-ENTI IN LAD.
           PERFORM GET-FHOY.
           MOVE    HOY-FHOY               TO  LAD-FEC-FTRN IN LAD
                                              LAD-FEC-FLAD IN LAD
                                              LAD-FEC-FOPD IN LAD
                                              LAD-FEC-FCLI IN LAD
                                              LAD-FEC-FAUT IN LAD.

           MOVE    HOY-HHOY               TO  LAD-HRA-HRTR IN LAD
                                              LAD-HRA-HLAD IN LAD
                                              LAD-HRA-HOPD IN LAD
                                              LAD-HRA-HCLI IN LAD
                                              LAD-HRA-HAUT IN LAD.

           MOVE  OPD-CIC-IOPD IN OPD      TO  LAD-CIC-IOPD IN LAD.

           MOVE  EIBTRMID                 TO  LAD-COD-OTRN IN LAD.
           MOVE  SCR-USER                 TO  LAD-COD-ATRN IN LAD
                                              LAD-COD-AUTO IN LAD.
           MOVE  EIBTRNID                 TO  LAD-COD-TCIC IN LAD.
           MOVE  SCR-CMND                 TO  LAD-COD-CMND IN LAD.
           
           IF FRM-COD-VOID = WSS-CT-DIPB
               MOVE WSS-CMT-LAD-B 
               TO  LAD-COD-COME IN LAD
               MOVE  IPB                  TO  LAD-COD-CONT IN LAD
           ELSE
               MOVE WSS-CMT-LAD-A 
               TO  LAD-COD-COME IN LAD
               MOVE  IPA                  TO  LAD-COD-CONT IN LAD.

           PERFORM GET-CUR-RCC.
           IF PGM-STAT-RCC-OKS
                MOVE    RCC-CIC-ICLI IN RCC    TO  LAD-CIC-ICLI IN LAD.
    
           MOVE    FIO-PUT                TO  FIO-CMND.
           PERFORM DAP-FIO-LAD.

           IF PGM-STAT-RCC-OKS
               PERFORM GET-NXT-RCC
               IF PGM-STAT-RCC-OKS
                   ADD    WSS-UNO    TO    LAD-NUM-CLAD IN LAD
                                           LAD-NUM-COPD IN LAD
                                           LAD-NUM-CCLI IN LAD
                                           LAD-NUM-CAUT IN LAD
                    MOVE    RCC-CIC-ICLI IN RCC TO
                                           LAD-CIC-ICLI IN LAD
                    MOVE    FIO-PUT   TO    FIO-CMND
                    PERFORM DAP-FIO-LAD.
           IF NOT PGM-STAT-RCC-OKS
               MOVE   SPACES  TO  FIO-STAT.
       FIN-GRABA-REG-LAD.
           EXIT.   

       OBT-OPD  SECTION.
       INI-OBT-OPD.
      *-------------------------

           MOVE IPA-CAI-ISER IN IPA-FLD TO OPD-CAI-ISER IN OPD.      
           MOVE IPA-IIC-ISER IN IPA-FLD TO OPD-IIC-ISER IN OPD.      
           MOVE WSS-OPDCICISER TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.                              
           PERFORM DAP-FIO-OPD.                                       

           IF NOT FIO-STAT-OKS                                        
               GO TO FIN-OBT-OPD.                

       FIN-OBT-OPD.
           EXIT. 

       OBT-IPB  SECTION.
       INI-OBT-IPB.
      *-------------------------
      *OBTIENE IPB-CIC-IOPD GRABADO EN IPB PARA GUARDARLO EN LOG LAD
           MOVE IPA-CAI-ISER IN IPA TO IPB-CAI-ISER IN IPB.
           MOVE IPA-IIC-ISER IN IPA TO IPB-IIC-ISER IN IPB.
           MOVE IPA-NUM-DVEN IN IPA TO IPB-NUM-DVEN IN IPB.
           MOVE IPA-NUM-MVEN IN IPA TO IPB-NUM-MVEN IN IPB.
           MOVE IPA-NUM-SVEN IN IPA TO IPB-NUM-SVEN IN IPB.
           MOVE IPA-NUM-AVEN IN IPA TO IPB-NUM-AVEN IN IPB.
           MOVE FIO-GET-KEY TO FIO-CMND.                              
           PERFORM DAP-FIO-IPB.                                       

           IF FIO-STAT-OKS
               MOVE IPB-CIC-IOPD IN IPB TO WSS-CIC-IOPD-IPB
               MOVE SPACES TO IPB.
 
           IF NOT FIO-STAT-OKS                          
               MOVE SPACES TO WSS-CIC-IOPD-IPB
               MOVE SPACES TO IPB               
               GO TO FIN-OBT-IPB.                

       FIN-OBT-IPB.
           EXIT. 
           
      *MPB-FIN
*% END
      *>>>> END EOF
*% END
