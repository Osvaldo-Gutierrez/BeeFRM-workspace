*%! Codigo adicional para archivo DAPPLOPD (ROI)
*% IF WSS
      *<<<< WSS
      *Entidades de GNS
       COPY GNSBRMSC.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGCPT.
       COPY GNSWGPDB.
       COPY GNSWGPES.

      *Entidades de TAB
       COPY TABBROFI.
       COPY TABBRUSR.
       COPY TABBRVLR.
       COPY TABBRCAM.

      *Entidades de DAP
       COPY DAPBRRCC.
       COPY DAPBRPTD.
       COPY DAPBRCAD.
       COPY DAPBRVEN.

      *Entidades de SGC
       COPY SGCBRDBC.
       COPY SGCBRRCD.

       01  WSS-VARI.
           03 PGM-STAT-RCC            VALUE ' '      PIC X(01).
              88 PGM-STAT-RCC-OKS     VALUE ' '.
              88 PGM-STAT-RCC-MAL     VALUE 'M'.
           03  WSS-FEC-FINI.
               05  WSS-NUM-DINI                      PIC 9(02).
               05  WSS-NUM-MINI                      PIC 9(02).
               05  WSS-NUM-SINI                      PIC 9(02).
               05  WSS-NUM-AINI                      PIC 9(02).
           03  WSS-FEC-FFIN.
               05  WSS-NUM-DFIN                      PIC 9(02).
               05  WSS-NUM-MFIN                      PIC 9(02).
               05  WSS-NUM-SFIN                      PIC 9(02).
               05  WSS-NUM-AFIN                      PIC 9(02).
           03  WSS-FEC-FPRI.
               05  WSS-NUM-SPRI                      PIC 9(02).
               05  WSS-NUM-APRI                      PIC 9(02).
               05  WSS-NUM-MPRI                      PIC 9(02).
               05  WSS-NUM-DPRI                      PIC 9(02).
           03  WSS-FEC-FTER.
               05  WSS-NUM-STER                      PIC 9(02).
               05  WSS-NUM-ATER                      PIC 9(02).
               05  WSS-NUM-MTER                      PIC 9(02).
               05  WSS-NUM-DTER                      PIC 9(02).
           03  WSS-COD-OFIC                          PIC X(03).
           03 WSS-ENT-UBFD.
              05  WSS-TBL-UBFD                       PIC X(03).
              05  WSS-COD-UBFD                       PIC X(06).
           03  WSS-COD-COPD.
               05  WSS-COD-TOPD                      PIC X(03).
               05  WSS-COD-AOPD                      PIC X(03).
           03  WSS-COD-IPER.
               05  WSS-IND-IPE1                      PIC X(04).
               05  WSS-IND-IPE2                      PIC X(08).
           03  WSS-STAT-RCC           VALUE ZEROES   PIC 9(01).
           03  WSS-SWI-CAD            VALUE ZEROES   PIC 9(01).
           03  WSS-SWI-CAD0           VALUE ZEROES   PIC 9(01).
           03  WSS-SWI-TCR            VALUE ZEROES   PIC 9(01).
           03  WSS-NUM-TOTI           VALUE ZEROES   PIC 9(05).
           03  WSS-NUM-TOTA           VALUE ZEROES   PIC 9(05).
           03  WSS-NUM-TOTE           VALUE ZEROES   PIC 9(05).
           03  WSS-NUM-TOTS           VALUE ZEROES   PIC 9(05).
           03  WSS-NUM-TOTX           VALUE ZEROES   PIC 9(05).
           03  WSS-IND-MCLI           VALUE SPACES   PIC X(01).
           03  WSS-IND-MCAD           VALUE SPACES   PIC X(01).
           03  WSS-VAL-IPES                          PIC 9(11)V9(04).
           03  WSS-CAPT                              PIC 9(11)V9(04).
           03  WSS-SGV-VCAM                          PIC 9(11)V9(04).
           03  WSS-GLS-ABRV           VALUE SPACES   PIC X(05).
           03  WSS-CIC-VCAM.
              05  WSS-CIC-TVAL                       PIC X(01).
              05  WSS-CIC-CVAL                       PIC X(03).
              05  WSS-CIC-TCAM                       PIC X(08).
           03 WSS-COD-LUGA.
              05 WSS-IND-LUGA                            PIC X(01).
              05 WSS-COD-PAIS                            PIC X(03).
      *Variables para emitir totales de control.
           03  WSS-FEC-FCMP.
               05  WSS-NUM-SCMP                      PIC 9(02).
               05  WSS-NUM-ACMP                      PIC 9(02).
               05  WSS-NUM-MCMP                      PIC 9(02).
               05  WSS-NUM-DCMP                      PIC 9(02).
           03  WSS-COD-OFIA                          PIC X(03).
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
      *Entidades de TAB
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *Entidades de DAP
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-PTD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
      *Entidades de SGC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>>
*% END
*% IF RW
      *<<<< RW
       COPY DAPRWRCC.
       COPY DAPRWCAD.
       COPY DAPRWTCR.
      *>>>>
*% END
*% IF RR
      *<<<<
       COPY DAPRRRCC REPLACING ==01  SRT== BY ==02  SRT-RCC==.
       COPY DAPRRCAD REPLACING ==01  SRT== BY ==02  SRT-CAD==.
       COPY DAPRRTCR REPLACING ==01  SRT== BY ==02  SRT-TCR==.
      *>>>>
*% END
*% IF RT
      *<<<< RT
       COPY DAPRTRCC.
       COPY DAPRTCAD.
       COPY DAPRTTCR.
      *>>>>
*% END
*% IF INI
      *<<<< INI
           DISPLAY ' '.
           DISPLAY 'INICIO CAPTURA PARAMETROS'.
           DISPLAY ' '.
      * Captura codigo de oficina y fechas parametro
           DISPLAY 'INGRESE FECHA INICIO (ddmmssaa) : '.
           ACCEPT WSS-FEC-FINI IN WSS-VARI.
           DISPLAY WSS-FEC-FINI IN WSS-VARI.

           DISPLAY 'INGRESE FECHA TERMINO (ddmmssaa) : '.
           ACCEPT WSS-FEC-FFIN IN WSS-VARI.
           DISPLAY WSS-FEC-FFIN IN WSS-VARI.

           DISPLAY 'INGRESE COD. OFICINA (XXX/*) : '.
           ACCEPT  WSS-COD-OFIC IN WSS-VARI.
           DISPLAY WSS-COD-OFIC IN WSS-VARI.
           DISPLAY ' '.
           DISPLAY 'FIN CAPTURA PARAMETROS'.
           DISPLAY ' '.

      *VAL-FEC Valida Fecha de Inicio
           DISPLAY WSS-FEC-FINI IN WSS-VARI.
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N TO FEC-FBLK.
           MOVE FEC-CHOY-N TO FEC-CHOY.
           MOVE FEC-VHBL-N TO FEC-VHBL.
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR VALIDACION EN FECHA DE INICIO: '
                         WSS-FEC-FINI '  ' FEC-MENS
               PERFORM GNS-PRO-ABT.
 
      *VAL-FEC Valida Fecha de Termino
           DISPLAY WSS-FEC-FFIN IN WSS-VARI.
           MOVE WSS-FEC-FFIN IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N TO FEC-FBLK.
           MOVE FEC-CHOY-N TO FEC-CHOY.
           MOVE FEC-VHBL-N TO FEC-VHBL.
           MOVE FEC-VAL-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR VALIDACION EN FECHA DE TERMINO: '
                         WSS-FEC-FINI '  ' FEC-MENS
               PERFORM GNS-PRO-ABT.

      *CMP-FEC Compara Fecha de Inicio con Fecha de Termino
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FEC1.
           MOVE WSS-FEC-FFIN IN WSS-VARI TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-GRT
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' FECHA INICIO > FECHA TERMINO: '
                         WSS-FEC-FINI ' > ' WSS-FEC-FFIN
               PERFORM GNS-PRO-ABT.

      *VAL-OFI Valida Codigo de oficina
           IF WSS-COD-OFIC IN WSS-VARI > SPACES AND
              WSS-COD-OFIC IN WSS-VARI NOT = '*'
              DISPLAY WSS-COD-OFIC IN WSS-VARI
              MOVE WSS-COD-OFIC IN WSS-VARI TO OFI-COD-OFIC IN OFI
              PERFORM VAL-OFI
               IF MSG-GLS-MENS = 'COD    NEX'
                  DISPLAY ' '
                  DISPLAY ' PROCESO CANCELADO '
                  DISPLAY ' ERROR VALIDACION OFICINA: ' 
                                          WSS-COD-OFIC IN WSS-VARI
                  PERFORM GNS-PRO-ABT.

           DISPLAY ' '.
           DISPLAY 'FECHA INICIO  DE SELECCION : ' WSS-FEC-FINI.
           DISPLAY 'FECHA TERMINO DE SELECCION : ' WSS-FEC-FFIN.
           DISPLAY 'OFICINA A SELECCIONAR      : ' 
                                       WSS-COD-OFIC IN WSS-VARI.
           DISPLAY ' '.

           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DINI IN WSS-OPD.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MINI IN WSS-OPD.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SINI IN WSS-OPD.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AINI IN WSS-OPD.
           MOVE WSS-NUM-DFIN IN WSS-VARI TO WSS-NUM-DFIN IN WSS-OPD.
           MOVE WSS-NUM-MFIN IN WSS-VARI TO WSS-NUM-MFIN IN WSS-OPD.
           MOVE WSS-NUM-SFIN IN WSS-VARI TO WSS-NUM-SFIN IN WSS-OPD.
           MOVE WSS-NUM-AFIN IN WSS-VARI TO WSS-NUM-AFIN IN WSS-OPD.
           DISPLAY 'FIN VALIDACION PARAMETROS'.
      *>>>>
*% END
*% IF INI_FST_INP
      *<<<< INI_FST_INP
      *JVM: Abre otros archivos VSAM
           MOVE FIO-INP TO FIO-CMND.
           PERFORM DAP-FIO-RCC.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM DAP-FIO-PTD.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM DAP-FIO-CAD.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-DBC.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-RCD.

           MOVE WSS-NUM-DINI IN WSS-VARI TO OPD-NUM-DCMP IN OPD.
           MOVE WSS-NUM-MINI IN WSS-VARI TO OPD-NUM-MCMP IN OPD.
           MOVE WSS-NUM-SINI IN WSS-VARI TO OPD-NUM-SCMP IN OPD.
           MOVE WSS-NUM-AINI IN WSS-VARI TO OPD-NUM-ACMP IN OPD.
           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DPRI IN WSS-VARI.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MPRI IN WSS-VARI.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SPRI IN WSS-VARI.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-APRI IN WSS-VARI.
           MOVE WSS-NUM-DFIN IN WSS-VARI TO WSS-NUM-DTER IN WSS-VARI.
           MOVE WSS-NUM-MFIN IN WSS-VARI TO WSS-NUM-MTER IN WSS-VARI.
           MOVE WSS-NUM-SFIN IN WSS-VARI TO WSS-NUM-STER IN WSS-VARI.
           MOVE WSS-NUM-AFIN IN WSS-VARI TO WSS-NUM-ATER IN WSS-VARI.

      *JVM: Busqueda por llave alternativa
           MOVE 'OPD-FEC-FCMP' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR AL ACCESAR OPD POR OPD-FEC-FCMP : '
                                                     FIO-STAT
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.
           IF OPD-FEC-FCMP IN OPD > WSS-FEC-FTER IN WSS-VARI
               DISPLAY 'NO HAY REGISTROS OPD EN RANGO DE FECHAS : '
                       'DESDE ' WSS-FEC-FINI IN WSS-VARI 
                       ' A    ' WSS-FEC-FFIN IN WSS-VARI
               GO TO FIN-INP-SRT
           ELSE
               GO TO LUP-INP-SRT.
      *>>>>
*% END
*% IF LUP_INP
      *<<<< LUP_INP
           IF WSS-COD-OFIC IN WSS-VARI > SPACES AND
              WSS-COD-OFIC IN WSS-VARI NOT = '*'
              IF WSS-COD-OFIC IN WSS-VARI NOT = OPD-COD-OFIC IN OPD
                 GO TO NXT-INP-SRT.

           IF OPD-FEC-FREA IN OPD NOT = OPD-FEC-FPCO IN OPD
               GO TO NXT-INP-SRT.

           IF OPD-COD-STAT IN OPD = 'I' OR 'A' OR 'S' OR 'G'
               NEXT SENTENCE
           ELSE
               GO TO NXT-INP-SRT.

           IF OPD-COD-STAT IN OPD = 'I'
              MOVE 1 TO SRT-IND-STAT IN SRT
           ELSE
           IF OPD-COD-STAT IN OPD = 'A'
              MOVE 2 TO SRT-IND-STAT IN SRT
           ELSE
           IF OPD-COD-STAT IN OPD = 'S'
              MOVE 3 TO SRT-IND-STAT IN SRT
           ELSE
           IF OPD-COD-STAT IN OPD = 'G'
              MOVE 4 TO SRT-IND-STAT IN SRT
           ELSE
              MOVE 5 TO SRT-IND-STAT IN SRT.

      *>>>>
*% END
*% IF INI_NXT_INP
      *<<<< INI_NXT_INP
      *Ubica registro en OPD por fecha
           MOVE 'OPD-FEC-FCMP' TO FIO-AKEY.
      *>>>>
*% END
*% IF FIN_NXT_INP
      *<<<< FIN_NXT_INP
      *Controla ingreso de registros por fecha termino
           IF OPD-FEC-FCMP IN OPD > WSS-FEC-FTER IN WSS-VARI
              GO TO FIN-INP-SRT.
      *>>>>
*% END
*% IF FST_OUT
      *<<<< FST_OUT
      *Mueve datos de primer reg. sort para corte control
           MOVE OPD-COD-OFIC IN SRT TO WSS-COD-OFIA IN WSS-VARI
           MOVE OPD-NUM-DCMP IN SRT TO WSS-NUM-DCMP IN WSS-VARI
           MOVE OPD-NUM-MCMP IN SRT TO WSS-NUM-MCMP IN WSS-VARI
           MOVE OPD-NUM-SCMP IN SRT TO WSS-NUM-SCMP IN WSS-VARI
           MOVE OPD-NUM-ACMP IN SRT TO WSS-NUM-ACMP IN WSS-VARI.
      *>>>>
*% END
*% IF LUP_OUT
      *<<<< LUP_OUT
      *JVM: Limpia FIO-AKEY 
           MOVE SPACES TO FIO-AKEY.
      *Genera glosas,datos de clientes.
           PERFORM GET-CUR-RCC.
           IF WSS-STAT-RCC IN WSS-VARI = 0
               PERFORM GET-NXT-RCC
               IF WSS-IND-MCLI IN WSS-VARI = 'M'
                   MOVE ZEROES TO RCC-NUM-DIRE IN RCC
                   MOVE ZEROES TO DBC-NUM-ICLI IN DBC
                   MOVE SPACES TO DBC-VRF-ICLI IN DBC
                   MOVE SPACES TO DBC-GLS-ICLI IN DBC
                   MOVE 'DAP' TO MSG-COD-SIST
                   MOVE 'OPD    MCLI' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE 'M' TO DBC-IND-ICLI IN DBC
                   MOVE MSG-GLS-DESC TO DBC-GLS-NOMC IN DBC
               ELSE
                   PERFORM GET-CUR-RCC
                   PERFORM GET-RCC-DBC
                   PERFORM GET-RCC-RCD
           ELSE
              PERFORM RST-DBC
              PERFORM RST-RCD. 
           MOVE SPACES TO FIO-AKEY.

      *Controla multiples cargos.
           PERFORM REV-CAD.
      *Genera primer CAD solo si no existen multiples Csrgos.
           IF WSS-IND-MCAD IN WSS-VARI = SPACES
              MOVE OPD-CAI-IOPD IN SRT TO CAD-CAI-IOPD IN CAD
              MOVE OPD-IIC-IOPD IN SRT TO CAD-IIC-IOPD IN CAD
              MOVE ZEROES              TO CAD-NUM-ILIQ IN CAD
              MOVE ZEROES              TO CAD-NUM-ICAD IN CAD
              MOVE FIO-GET-NLS TO FIO-CMND
              PERFORM DAP-FIO-CAD
              IF NOT ( FIO-STAT-OKS AND
                 OPD-CAI-IOPD IN SRT = CAD-CAI-IOPD IN CAD AND
                 OPD-IIC-IOPD IN SRT = CAD-IIC-IOPD IN CAD AND
                 CAD-NUM-ILIQ IN CAD = ZEROES )
                 MOVE SPACES TO CAD-CAI-IOPD IN CAD
                 MOVE SPACES TO CAD-IIC-IOPD IN CAD.

           MOVE SPACES TO FIO-AKEY.
      *Recupera tipo tasa de interes desde INT
           MOVE SPACES TO WSS-GLS-TINT IN WSS-OPD.
           MOVE 'TAB'        TO TAB-COD-SIST.
           MOVE 'INT'        TO TAB-COD-TTAB IN TAB.            
           MOVE OPD-COD-TINT IN SRT  TO TAB-COD-CTAB IN TAB.            
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TINT IN WSS-OPD.
      *Recupera glosa oficina
           MOVE SPACES TO WSS-GLS-OFIC IN WSS-OPD.
           MOVE OPD-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI
           PERFORM BUS-OFI
           MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFIC IN WSS-OPD.
      *Recupera glosa ejecutivo
           MOVE SPACES TO WSS-GLS-EJEC IN WSS-OPD.
           IF OPD-COD-EJEC IN SRT > SPACES
              MOVE OPD-COD-EJEC IN SRT TO USR-COD-USER IN USR
              PERFORM BUS-USR
              MOVE USR-GLS-DESC IN USR TO WSS-GLS-EJEC IN WSS-OPD.
      *Recupera glosa separacion entre vencimientos
           MOVE SPACES TO WSS-GLS-SEVE IN WSS-OPD.
           IF OPD-IND-SEVE IN SRT > SPACES
              MOVE 'TAB' TO TAB-COD-SIST
              MOVE 'MSC' TO TAB-COD-TTAB IN TAB
              MOVE 'IPER'              TO WSS-IND-IPE1 IN WSS-VARI
              MOVE OPD-IND-SEVE IN SRT TO WSS-IND-IPE2 IN WSS-VARI 
              MOVE WSS-COD-IPER IN WSS-VARI TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB 
              MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-SEVE IN WSS-OPD.
      *Recupera glosa retencion de documentos
           MOVE SPACES TO WSS-GLS-RETD IN WSS-OPD.
           IF OPD-IND-RETD IN SRT > SPACES
              MOVE 'TAB' TO TAB-COD-SIST
              MOVE 'MSC' TO TAB-COD-TTAB IN TAB
              MOVE 'IPER'              TO WSS-IND-IPE1 IN WSS-VARI
              MOVE OPD-IND-RETD IN SRT TO WSS-IND-IPE2 IN WSS-VARI 
              MOVE WSS-COD-IPER IN WSS-VARI TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB 
              MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-RETD IN WSS-OPD.
      *Recupera glosa modalidad de retiro
           MOVE SPACES TO WSS-GLS-MORE IN WSS-OPD.
           IF OPD-COD-MORE IN SRT > SPACES
              MOVE 'DAP' TO TAB-COD-SIST
              MOVE 'MDR' TO TAB-COD-TTAB IN TAB
              MOVE OPD-COD-MORE IN SRT TO TAB-COD-CTAB IN TAB 
              PERFORM BUS-TAB 
              MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-MORE IN WSS-OPD.
      *Recupera glosa ubicacion fisica
           MOVE SPACES TO WSS-GLS-UBFD IN WSS-OPD.
           IF OPD-COD-UBFD IN SRT > SPACES
              MOVE OPD-COD-UBFD IN SRT TO WSS-ENT-UBFD
              IF WSS-TBL-UBFD IN WSS-VARI = 'OFI'
                 MOVE WSS-COD-UBFD TO OFI-COD-OFIC IN OFI
                 PERFORM VAL-OFI
                 IF MSG-COD-MENS NOT = SPACES
                    IF MSG-COD-MENS = 'COD    NEX'
                       MOVE SPACES TO WSS-GLS-UBFD IN WSS-OPD
                    ELSE
                       MOVE OFI-GLS-DESC IN OFI TO
                            WSS-GLS-UBFD IN WSS-OPD
                 ELSE
                       MOVE OFI-GLS-DESC IN OFI TO
                            WSS-GLS-UBFD IN WSS-OPD
              ELSE
                 MOVE 'TAB' TO TAB-COD-SIST
                 MOVE 'UBI' TO TAB-COD-TTAB IN TAB
                 MOVE WSS-COD-UBFD TO TAB-COD-CTAB IN TAB
                 PERFORM BUS-TAB
                 IF MSG-COD-MENS = 'COD    NEX'
                    MOVE SPACES TO WSS-GLS-UBFD IN WSS-OPD
                 ELSE
                    MOVE TAB-GLS-DESC IN TAB TO 
                                     WSS-GLS-UBFD IN WSS-OPD.
           MOVE OPD-NUM-VNLQ IN SRT TO WSS-NUM-TVEN IN WSS-OPD.

      *Genera Valor Inicial Pesos.
           PERFORM BUS-VPES.

      *Genera Valor Final Moneda Orig
           MOVE OPD-CAI-IOPD IN SRT TO VEN-CAI-IOPD IN VEN.
           MOVE OPD-IIC-IOPD IN SRT TO VEN-IIC-IOPD IN VEN.
           MOVE '001'               TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
              DISPLAY 'NO EXISTE VENCIMIENTO ' VEN-KEY-IVEN
              MOVE ZEROES TO WSS-VAL-FINA IN WSS-OPD
           ELSE
              MOVE VEN-VAL-FINA IN VEN TO
                                   WSS-VAL-FINA IN WSS-OPD.

           PERFORM GEN-TIT-OPD.

           MOVE 0 TO WSS-SWI-TCR IN WSS-VARI.
           IF NOT ( OPD-COD-OFIC IN SRT = WSS-COD-OFIA IN WSS-VARI )
             PERFORM GEN-TCR
             MOVE 1 TO WSS-SWI-TCR IN WSS-VARI
             MOVE OPD-COD-OFIC IN SRT TO WSS-COD-OFIA IN WSS-VARI.
      *
           IF NOT ( OPD-FEC-FCMP IN SRT = WSS-FEC-FCMP IN WSS-VARI )
             IF WSS-SWI-TCR IN WSS-VARI = 0
                PERFORM GEN-TCR
                MOVE OPD-NUM-DCMP IN SRT TO WSS-NUM-DCMP IN WSS-VARI
                MOVE OPD-NUM-MCMP IN SRT TO WSS-NUM-MCMP IN WSS-VARI
                MOVE OPD-NUM-SCMP IN SRT TO WSS-NUM-SCMP IN WSS-VARI
                MOVE OPD-NUM-ACMP IN SRT TO WSS-NUM-ACMP IN WSS-VARI.
      *>>>>
*% END
*% IF FIN_GEN_OUT
      *<<<< FIN_GEN_OUT
      *Carga Totales de Control.
           IF SRT-IND-STAT IN SRT = 1
              ADD 1 TO WSS-NUM-TOTI IN WSS-VARI
           ELSE
           IF SRT-IND-STAT IN SRT = 2
              ADD 1 TO WSS-NUM-TOTA IN WSS-VARI
           ELSE
           IF SRT-IND-STAT IN SRT = 3
              ADD 1 TO WSS-NUM-TOTS IN WSS-VARI
           ELSE
           IF SRT-IND-STAT IN SRT = 4
              ADD 1 TO WSS-NUM-TOTE IN WSS-VARI
           ELSE
           IF SRT-IND-STAT IN SRT = 5
              ADD 1 TO WSS-NUM-TOTX IN WSS-VARI.
      *
           MOVE 'CLIENTES' TO WSS-GLS-TRCC IN WSS-RCC.
      *JVM: Limpia FIO-AKEY 
           MOVE SPACES TO FIO-AKEY.

           PERFORM GET-CUR-RCC.
           IF WSS-STAT-RCC IN WSS-VARI = 1
              GO TO INI-GEN-CAD
           ELSE
              IF WSS-IND-MCLI IN WSS-VARI = 'M'
                 PERFORM GET-RCC-DBC
                 PERFORM GET-RCC-RCD
                 GENERATE HDR-RCC
                 GENERATE DL-RCC.
           
       CIC-RCC.
           PERFORM GET-NXT-RCC
           IF WSS-IND-MCLI IN WSS-VARI = 'M'
              PERFORM GET-RCC-DBC
              PERFORM GET-RCC-RCD
              GENERATE DL-RCC
              GO TO CIC-RCC.
               
       INI-GEN-CAD.
           MOVE SPACES TO FIO-AKEY.
           MOVE ZEROES TO WSS-SWI-CAD  IN WSS-VARI.
           MOVE ZEROES TO WSS-SWI-CAD0 IN WSS-VARI.
           MOVE OPD-CAI-IOPD IN SRT TO CAD-CAI-IOPD IN CAD.
           MOVE OPD-IIC-IOPD IN SRT TO CAD-IIC-IOPD IN CAD.
           MOVE ZEROES              TO CAD-NUM-ILIQ IN CAD.
           MOVE ZEROES              TO CAD-NUM-ICAD IN CAD.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF NOT ( FIO-STAT-OKS AND
              OPD-CAI-IOPD IN SRT = CAD-CAI-IOPD IN CAD AND
              OPD-IIC-IOPD IN SRT = CAD-IIC-IOPD IN CAD AND
              CAD-NUM-ILIQ IN CAD = ZEROES )
              GO TO NXT-OUT-SRT.

           IF WSS-SWI-CAD0 IN WSS-VARI = 0
              MOVE 1 TO WSS-SWI-CAD0 IN WSS-VARI
              MOVE WSS-GLS-ABRV IN WSS-VARI TO
                                         WSS-GLS-VCAM IN WSS-CAD
              GENERATE HDR-CAD
              MOVE 'TAB'               TO MSC-COD-SIST
              MOVE 'TCYA'              TO MSC-COD-TMSC IN MSC
              MOVE CAD-IND-TCAD IN CAD TO MSC-COD-CMSC IN MSC
              PERFORM BUS-MSC
              MOVE MSC-GLS-DESC IN MSC TO WSS-GLS-ICAD IN WSS-CAD
              PERFORM BUS-VPES-CAD
              GENERATE DL-CAD.

       GEN-CAD.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF FIO-STAT-OKS AND
              OPD-CAI-IOPD IN SRT = CAD-CAI-IOPD IN CAD AND
              OPD-IIC-IOPD IN SRT = CAD-IIC-IOPD IN CAD AND
              CAD-NUM-ILIQ IN CAD = ZEROES
              MOVE 'TAB'               TO MSC-COD-SIST
              MOVE 'TCYA'              TO MSC-COD-TMSC IN MSC
              MOVE CAD-IND-TCAD IN CAD TO MSC-COD-CMSC IN MSC
              PERFORM BUS-MSC
              MOVE MSC-GLS-DESC IN MSC TO WSS-GLS-ICAD IN WSS-CAD
              PERFORM BUS-VPES-CAD
              GENERATE DL-CAD
              GO TO GEN-CAD.
      *>>>> FIN_GEN_OUT
*% END
*% IF FIN_OUT
      *<<<< FIN_OUT
           PERFORM GEN-TCR.
      *>>>> FIN_OUT
*% END
*% IF EOF
      *<<<< EOF
       GET-CUR-RCC SECTION.
       INI-GET-CUR-RCC.
           MOVE 0  TO WSS-STAT-RCC IN WSS-VARI.
           MOVE OPD-CAI-IOPD IN SRT TO RCC-CAI-IOPD IN RCC.
           MOVE OPD-IIC-IOPD IN SRT TO RCC-IIC-IOPD IN RCC.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT FIO-STAT-OKS
              MOVE 1 TO WSS-STAT-RCC IN WSS-VARI.
       FIN-GET-CUR-RCC.
           EXIT.

       GET-NXT-RCC SECTION.
       INI-GET-NXT-RCC.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF FIO-STAT-OKS AND
              OPD-CAI-IOPD IN SRT = RCC-CAI-IOPD IN RCC AND
              OPD-IIC-IOPD IN SRT = RCC-IIC-IOPD IN RCC
                MOVE 'M'    TO WSS-IND-MCLI IN WSS-VARI
           ELSE
                MOVE SPACES TO WSS-IND-MCLI IN WSS-VARI.
       FIN-GET-NXT-RCC.
           EXIT.

       GEN-TIT-OPD SECTION.
       INI-GEN-TIT-OPD.
      *Recupera glosa de moneda
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'VLR' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-VCAM IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-VCAM IN WSS-OPD.
           MOVE TAB-GLS-ABRV IN TAB TO WSS-GLS-ABRV IN WSS-VARI.
      *Recupera glosa tipo operacion
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'TIO' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-TOPD IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TOPD IN WSS-OPD.
      *Recupera glosa cod. auxiliar
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-TOPD IN SRT TO WSS-COD-TOPD IN WSS-VARI.
           MOVE OPD-COD-AOPD IN SRT TO WSS-COD-AOPD IN WSS-VARI.
           MOVE WSS-COD-COPD IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-AOPD IN WSS-OPD.
       FIN-GEN-TIT-OPD.
           EXIT.

       REV-CAD SECTION.
       INI-REV-CAD.
           MOVE SPACES TO WSS-IND-MCAD IN WSS-VARI.
           MOVE OPD-CAI-IOPD IN SRT TO CAD-CAI-IOPD IN CAD.
           MOVE OPD-IIC-IOPD IN SRT TO CAD-IIC-IOPD IN CAD.
           MOVE ZEROES              TO CAD-NUM-ILIQ IN CAD.
           MOVE ZEROES              TO CAD-NUM-ICAD IN CAD.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF NOT (FIO-STAT-OKS AND
              OPD-CAI-IOPD IN SRT = CAD-CAI-IOPD IN CAD AND
              OPD-IIC-IOPD IN SRT = CAD-IIC-IOPD IN CAD AND
              CAD-NUM-ILIQ IN CAD = ZEROES )
              MOVE SPACES TO CAD-IND-TCAD IN CAD
              MOVE SPACES TO CAD-CAI-ICAD IN CAD
              MOVE SPACES TO CAD-IIC-ICAD IN CAD
              GO TO FIN-REV-CAD.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-CAD.
           IF FIO-STAT-OKS AND
              OPD-CAI-IOPD IN SRT = CAD-CAI-IOPD IN CAD AND
              OPD-IIC-IOPD IN SRT = CAD-IIC-IOPD IN CAD AND
              CAD-NUM-ILIQ IN CAD = ZEROES
              MOVE 'M' TO WSS-IND-MCAD IN WSS-VARI
              MOVE 'M' TO CAD-IND-TCAD IN CAD
              MOVE SPACES TO CAD-CAI-ICAD IN CAD
              MOVE SPACES TO CAD-IIC-ICAD IN CAD.
       FIN-REV-CAD.
           EXIT.

       GEN-HDR-CAD SECTION.
       INI-GEN-HDR-CAD.
           IF WSS-SWI-CAD IN WSS-VARI = ZEROES
              MOVE 1 TO WSS-SWI-CAD IN WSS-VARI
              MOVE 'PESOS' TO WSS-GLS-VCAM IN WSS-CAD
              GENERATE HDR-CAD.
       FIN-GEN-HDR-CAD.
           EXIT.

      * Lee con CIC CLIENTE archivo DBC
       GET-RCC-DBC SECTION.
       INI-GET-RCC-DBC.
           MOVE RCC-CIC-ICLI IN RCC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
              PERFORM RST-DBC
           ELSE
              MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
              PERFORM CPT-BLKS
              MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC. 
       FIN-GET-RCC-DBC.
           EXIT.

      * Limpia datos cliente desde DBC
       RST-DBC SECTION.
       INI-RST-DBC.
           MOVE 'CLIENTE INEXISTENTE' TO DBC-GLS-NOMC IN DBC.
           MOVE SPACES TO DBC-NUM-ICLI IN DBC.
           MOVE SPACES TO DBC-VRF-ICLI IN DBC.
           MOVE SPACES TO DBC-IND-ICLI IN DBC.
           MOVE SPACES TO DBC-GLS-ICLI IN DBC.
       FIN-RST-DBC.
           EXIT.

      * Lee con CIC CLIENTE archivo RCD
       GET-RCC-RCD SECTION.
       INI-GET-RCC-RCD.
           MOVE RCC-CIC-ICLI IN RCC TO RCD-CIC-ICLI IN RCD.
           MOVE RCC-NUM-DIRE IN RCC TO RCD-NUM-DIRE IN RCD.
           MOVE 'RCD-KEY-IRCD' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-RCD.
           IF NOT FIO-STAT-OKS
              PERFORM RST-RCD
           ELSE 
              PERFORM VAL-LUGA.
       FIN-GET-RCC-RCD.
           EXIT.

      * Limpia datos cliente desde RCD
       RST-RCD SECTION.
       INI-RST-RCD.
           MOVE '000'  TO RCD-NUM-DIRE IN RCD.
           MOVE SPACES TO RCD-GLS-DIRE IN RCD.
           MOVE SPACES TO RCD-GLS-FONO IN RCD.
           MOVE SPACES TO WSS-GLS-COMU IN WSS-RCC.
       FIN-RST-RCD.
           EXIT.

       VAL-LUGA SECTION.
       INI-VAL-LUGA.
           MOVE RCD-COD-LUGA IN RCD TO WSS-COD-LUGA IN WSS-VARI.
           IF WSS-IND-LUGA IN WSS-VARI = 'P'
               MOVE 'PAI' TO TAB-COD-TTAB
               MOVE WSS-COD-PAIS IN WSS-VARI TO TAB-COD-CTAB IN TAB
           ELSE
               MOVE 'COM' TO TAB-COD-TTAB
               MOVE WSS-COD-LUGA IN WSS-VARI TO TAB-COD-CTAB IN TAB.
           MOVE 'TAB' TO TAB-COD-SIST.
           PERFORM VAL-TAB.
           IF MSG-COD-MENS NOT = 'COD    NEX' AND
              RCD-COD-LUGA IN RCD > SPACES
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-COMU IN WSS-RCC
           ELSE
               MOVE SPACES TO WSS-GLS-COMU IN WSS-RCC.
       FIN-VAL-LUGA.
           EXIT.

      * Genera Totales de Control
       GEN-TCR SECTION.
       INI-GEN-TCR.
           MOVE WSS-COD-OFIA IN WSS-VARI TO 
                                        WSS-COD-OFIC IN WSS-TCR.
           MOVE WSS-COD-OFIA IN WSS-VARI TO OFI-COD-OFIC IN OFI.
           PERFORM BUS-OFI.
           MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFIC IN WSS-TCR.
           MOVE WSS-NUM-DCMP IN WSS-VARI TO WSS-NUM-DEMI IN WSS-TCR.
           MOVE WSS-NUM-MCMP IN WSS-VARI TO WSS-NUM-MEMI IN WSS-TCR.
           MOVE WSS-NUM-SCMP IN WSS-VARI TO WSS-NUM-SEMI IN WSS-TCR.
           MOVE WSS-NUM-ACMP IN WSS-VARI TO WSS-NUM-AEMI IN WSS-TCR.
           MOVE WSS-NUM-TOTI IN WSS-VARI TO WSS-NUM-TOTI IN WSS-TCR.
           MOVE WSS-NUM-TOTA IN WSS-VARI TO WSS-NUM-TOTA IN WSS-TCR.
           MOVE WSS-NUM-TOTE IN WSS-VARI TO WSS-NUM-TOTE IN WSS-TCR.
           MOVE WSS-NUM-TOTS IN WSS-VARI TO WSS-NUM-TOTS IN WSS-TCR.
           MOVE WSS-NUM-TOTX IN WSS-VARI TO WSS-NUM-TOTX IN WSS-TCR.
           MOVE '67' TO LINE-COUNTER.
           GENERATE DL-TCR.
           MOVE '67' TO LINE-COUNTER.
           MOVE ZEROES TO  WSS-NUM-TOTI IN WSS-VARI
                           WSS-NUM-TOTA IN WSS-VARI        
                           WSS-NUM-TOTE IN WSS-VARI  
                           WSS-NUM-TOTS IN WSS-VARI
                           WSS-NUM-TOTX IN WSS-VARI.        
       FIN-GEN-TCR.
           EXIT.

       BUS-VPES SECTION.
       INI-BUS-VPES.
      *SE ACCESA LA BDD, PUES ES NECESARIO OBTENER
      *EL CIC DE OPD-COD-VCAM
      *BUS-TAB busca glosa de codigo en tabla
           IF OPD-COD-VCAM IN SRT NOT > SPACES
               DISPLAY 'ERROR : OPERACION SIN MONEDA ' 
                       OPD-CAI-IOPD IN SRT 
                       OPD-IIC-IOPD IN SRT 
               GO TO FIN-BUS-VPES.

           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'VLR' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-VCAM IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-CIC-CTAB IN TAB TO WSS-CIC-VCAM.

      *    moneda extranjera
           IF WSS-CIC-TVAL NOT = PDB-CIC-MNAC
                MOVE ZEROES TO WSS-VAL-IPES IN WSS-OPD
                GO TO FIN-BUS-VPES.
      *    moneda chilena y pesos
           IF WSS-CIC-VCAM = PDB-CIC-0999
                MOVE OPD-VAL-CAPT IN SRT TO WSS-VAL-IPES IN WSS-OPD
                GO TO FIN-BUS-VPES.

      *    moneda reajustable, chilena y no pesos ; convertir a pesos
           MOVE PDB-CIC-0999        TO TAB-CIC-CTAB IN TAB.
           MOVE OPD-COD-VCAM IN SRT TO TAB-COD-CTAB IN TAB.
           MOVE OPD-NUM-DREA IN SRT TO TAB-NUM-DTRN IN TAB.
           MOVE OPD-NUM-MREA IN SRT TO TAB-NUM-MTRN IN TAB.
           MOVE OPD-NUM-SREA IN SRT TO TAB-NUM-STRN IN TAB.
           MOVE OPD-NUM-AREA IN SRT TO TAB-NUM-ATRN IN TAB.
           PERFORM GET-VCAM.
           IF MSG-COD-MENS = SPACES
               MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-VCAM IN WSS-VARI
           ELSE
               MOVE ZEROES TO WSS-SGV-VCAM IN WSS-VARI.

           MULTIPLY OPD-VAL-CAPT IN SRT BY
               WSS-SGV-VCAM IN WSS-VARI GIVING
               WSS-VAL-IPES IN WSS-VARI.

           MOVE WSS-VAL-IPES IN WSS-VARI TO PES-SGV-DECI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE TO WSS-VAL-IPES IN WSS-OPD.

       FIN-BUS-VPES.
           EXIT.

       BUS-VPES-CAD SECTION.
       INI-BUS-VPES-CAD.
           MOVE ZEROES TO WSS-VAL-VPES IN WSS-CAD.
      *    moneda extranjera
           IF WSS-CIC-TVAL NOT = PDB-CIC-MNAC
                GO TO FIN-BUS-VPES-CAD.
      *    moneda chilena y pesos
           IF WSS-CIC-VCAM = PDB-CIC-0999
                MOVE CAD-SGV-LIQU IN CAD TO WSS-VAL-VPES IN WSS-CAD
                GO TO FIN-BUS-VPES-CAD.

      *    moneda reajustable, chilena y no pesos ; convertir a pesos
           MOVE PDB-CIC-0999        TO TAB-CIC-CTAB IN TAB.
           MOVE OPD-COD-VCAM IN SRT TO TAB-COD-CTAB IN TAB.
           MOVE OPD-NUM-DREA IN SRT TO TAB-NUM-DTRN IN TAB.
           MOVE OPD-NUM-MREA IN SRT TO TAB-NUM-MTRN IN TAB.
           MOVE OPD-NUM-SREA IN SRT TO TAB-NUM-STRN IN TAB.
           MOVE OPD-NUM-AREA IN SRT TO TAB-NUM-ATRN IN TAB.
           PERFORM GET-VCAM.
           IF MSG-COD-MENS = SPACES
               MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-VCAM IN WSS-VARI
           ELSE
               MOVE ZEROES TO WSS-SGV-VCAM IN WSS-VARI.

           MOVE CAD-SGV-LIQU IN CAD TO WSS-VAL-VPES IN WSS-CAD.
           MOVE WSS-VAL-VPES IN WSS-CAD TO PES-SGV-DECI.
           PERFORM PES-SCTV.
           MOVE PES-SGV-ENTE TO WSS-VAL-VPES IN WSS-CAD.

           DIVIDE CAD-SGV-LIQU IN CAD BY 
               WSS-SGV-VCAM IN WSS-VARI GIVING
               CAD-SGV-LIQU IN CAD ROUNDED.

       FIN-BUS-VPES-CAD.
           EXIT.

      *Entidades  de GNS
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBBMSG.
       COPY GNSBBTAB.
       COPY GNSBVTAB.
       COPY GNSBFMSC.
       COPY GNSBVMSC.
       COPY GNSBBMSC.
       COPY GNSBGCPT.
       COPY GNSBGCAM.
       COPY GNSBGPES.

      *Entidades  de TAB
       COPY TABBFOFI.
       COPY TABBBOFI.
       COPY TABBVOFI.
       COPY TABBFUSR.
       COPY TABBBUSR.
       COPY TABBVUSR.
       COPY TABBFCAM.

      *Entidades  de DAP
       COPY DAPBFRCC.
       COPY DAPBFPTD.
       COPY DAPBFCAD.
       COPY DAPBFVEN.

      *Entidades  de SGC
       COPY SGCBFDBC.
       COPY SGCBFRCD.
      *>>>>
*% END
