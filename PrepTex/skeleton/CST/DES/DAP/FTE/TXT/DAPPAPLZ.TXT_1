*%! FRM = 'RIN'
*% FMT_CHI = TRUE
*% NO_HDR_CST = TRUE
*% NO_TIENE_TIMESTAMP = TRUE
*% NO_INC_TAB = TRUE
*%! IF SETTAG
*%! FNCPQ = "080905"
*%! VSNPQ = "08.10.20"
*%! FNCPU = "080905"
*%! VSNPU = "08.10.20"
*%! END
*% IF WSS
      *<<<< WSS
       COPY TABBRUSR.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-USR-REQA==.
       COPY GNSWGHOY.
       01  WSS-COMP.
*% IF PGM_PQ
           03 WSS-VAL-CNN            PIC X(03).
*% END
           03 WSS-COD-CTAB.
              05 WSS-COD-VCAM        PIC X(06).
              05 WSS-COD-CNL         PIC X(03).
              05 WSS-COD-PLZ         PIC 9(03).
*% IF PGM_PQ
           03 WSS-GLS-VALI.
              05 WSS-VEC-VALI OCCURS 11 TIMES.
                 07 WSS-VAL-REG      PIC X(01).
*% END
*% IF PGM_PU
           03 WSS-GLS-VALI.
              05 WSS-VEC-VALI OCCURS 13 TIMES.
                 07 WSS-VAL-REG      PIC X(01).
*% END
           03 WSS-GLS-DATOS.
              05 WSS-NUM-OPC1        PIC 9(04).
              05 FILLER              PIC X(01).
              05 WSS-NUM-OPC2        PIC 9(04).
              05 FILLER              PIC X(01).
              05 WSS-NUM-OPC3        PIC 9(04).
              05 FILLER              PIC X(01).
              05 WSS-NUM-OPC4        PIC 9(04).
              05 FILLER              PIC X(01).
              05 WSS-NUM-OPC5        PIC 9(04).
              05 FILLER              PIC X(01).
              05 WSS-NUM-OPC6        PIC 9(04).
           03 WSS-I                  PIC 9(02).
           03 WSS-NSD VALUE 'NSD'    PIC X(03).
           03 WSS-S    VALUE 'S'     PIC X(01).
           03 WSS-UNO  VALUE 1       PIC 9(01).
           03 WSS-MAX-REGS VALUE 13  PIC 9(02).
           03 WSS-AST VALUE '*  '    PIC X(03).
           03 WSS-TODOS VALUE 'TODOS' PIC X(05).
*% IF PGM_PQ
           03 WSS-COD-USER VALUE 'USR-COD-USER' PIC X(12).
*% END
      *>>>>
*% END
*% IF FND_KEY
           MOVE 'DAP'        TO FIO-SIST.
           MOVE 'DAP'        TO TAB-COD-SIST.
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
           MOVE 'DAP'        TO FIO-SIST.
           MOVE 'DAP'        TO TAB-COD-SIST.
           MOVE WSS-NSD      TO TAB-COD-TTAB IN TAB.
           MOVE SPACES       TO WSS-COD-CTAB.
           MOVE FRM-COD-VCAM IN PLZ-FLD TO WSS-COD-VCAM.
           MOVE FRM-COD-CNL  IN PLZ-FLD TO WSS-COD-CNL.
           MOVE ZEROES       TO WSS-COD-PLZ.
           MOVE WSS-COD-CTAB TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-NLS  TO FIO-CMND.
           MOVE ZEROES       TO WSS-I.
       LUP-FND-KEY.

           PERFORM GNS-FIO-TAB.

           IF NOT (FIO-STAT-OKS AND
              TAB-COD-CTAB(1:9) = WSS-COD-CTAB(1:9))
              IF WSS-I = ZEROES
                 MOVE PGM-SRNF TO FIO-STAT
                 GO TO FIN-FND-KEY
              ELSE
                 MOVE PGM-SOKS TO FIO-STAT
                 GO TO FIN-FND-KEY.

           MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-DATOS.
           ADD WSS-UNO TO WSS-I.

           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-CTAB.

           MOVE WSS-COD-PLZ  TO FRM-NUM-DIAS IN PLZ-FLD(WSS-I).
           MOVE WSS-NUM-OPC1 TO FRM-NUM-OPC1 IN PLZ-FLD(WSS-I).
           MOVE WSS-NUM-OPC2 TO FRM-NUM-OPC2 IN PLZ-FLD(WSS-I).
           MOVE WSS-NUM-OPC3 TO FRM-NUM-OPC3 IN PLZ-FLD(WSS-I).
           MOVE WSS-NUM-OPC4 TO FRM-NUM-OPC4 IN PLZ-FLD(WSS-I).
           MOVE WSS-NUM-OPC5 TO FRM-NUM-OPC5 IN PLZ-FLD(WSS-I).
           MOVE WSS-NUM-OPC6 TO FRM-NUM-OPC6 IN PLZ-FLD(WSS-I).

           MOVE TAB-COD-ATRN IN TAB TO FRM-COD-EJEC IN PLZ-FLD.

           IF WSS-I = WSS-UNO
              MOVE WSS-COD-USER        TO FIO-AKEY
              MOVE FIO-GET-KEY         TO FIO-CMND
              MOVE 'TAB'               TO FIO-SIST
              MOVE TAB-COD-ATRN IN TAB TO USR-COD-USER IN USR
              PERFORM TAB-FIO-USR
              IF FIO-STAT-OKS
                 MOVE USR-GLS-DESC IN USR TO FRM-GLS-EJEC IN PLZ-FLD
              ELSE
                 MOVE SPACES TO FRM-GLS-EJEC IN PLZ-FLD.

           MOVE FIO-GET-NXT TO FIO-CMND.
           MOVE 'DAP' TO FIO-SIST.
           GO TO LUP-FND-KEY.
      *>>>> FIN_FND_KEY
*% END
*% IF INI_CMN_MOD
           PERFORM VALIDA-DATOS.

           PERFORM ELIMINA-PLZS.
           IF NOT FIO-STAT-OKS
              MOVE FIO-BCK-OUT  TO FIO-CMND
              PERFORM GNS-FIO-TAB
              GO TO FIN-CMN-MOD.

           PERFORM GRABA-PLZS.
           IF NOT FIO-STAT-OKS
              MOVE FIO-BCK-OUT  TO FIO-CMND
              PERFORM GNS-FIO-TAB
              GO TO FIN-CMN-MOD.

           IF WSS-GLS-VALI > SPACES
             MOVE 'DAP'          TO MSG-COD-SIST
             MOVE 'PLZS    MALO' TO MSG-COD-MENS
             PERFORM GET-MSG
             MOVE MSG-GLS-DESC TO FRM-MENS.

           GO TO FIN-CMN-MOD.

*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
           GO TO CON-CMN-ING.
      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
       CON-CMN-ING.
           PERFORM VALIDA-DATOS.

           PERFORM GRABA-PLZS.
           IF NOT FIO-STAT-OKS
              MOVE FIO-BCK-OUT  TO FIO-CMND
              PERFORM GNS-FIO-TAB
              GO TO FIN-CMN-ING.

           IF WSS-GLS-VALI > SPACES
             MOVE 'DAP'          TO MSG-COD-SIST
             MOVE 'PLZS    MALO' TO MSG-COD-MENS
             PERFORM GET-MSG
             MOVE MSG-GLS-DESC TO FRM-MENS.

           GO TO FIN-CMN-ING.
      *>>>>
*% END
*% IF INI_CMN_ELI
           PERFORM ELIMINA-PLZS.
           IF NOT FIO-STAT-OKS
              MOVE FIO-BCK-OUT  TO FIO-CMND
              PERFORM GNS-FIO-TAB.

           GO TO FIN-CMN-ELI.

*% END
*% IF EOF
      *<<<< EOF
       COPY GNSBGVSM.
       COPY GNSBGHOY.
       COPY TABBFUSR.
*% IF PGM_PU

       ELIMINA-PLZS SECTION.
       INI-ELIMINA-PLZS.
       LUP-ELIMINA-PLZS.

           MOVE 'DAP'        TO FIO-SIST.
           MOVE 'DAP'        TO TAB-COD-SIST.
           MOVE WSS-NSD      TO TAB-COD-TTAB IN TAB.
           MOVE SPACES       TO WSS-COD-CTAB.
           MOVE FRM-COD-VCAM IN PLZ-FLD TO WSS-COD-VCAM.
           MOVE FRM-COD-CNL  IN PLZ-FLD TO WSS-COD-CNL.
           MOVE ZEROES       TO WSS-COD-PLZ.
           MOVE WSS-COD-CTAB TO TAB-COD-CTAB IN TAB.

           MOVE FIO-GET-NLS  TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           IF NOT (FIO-STAT-OKS AND
              TAB-COD-CTAB(1:9) = WSS-COD-CTAB(1:9))
              MOVE '00' TO FIO-STAT
              GO TO FIN-ELIMINA-PLZS.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.

           PERFORM GNS-FIO-TAB.

           IF NOT FIO-STAT-OKS
              IF SCR-CCPP = 'MOD'
                 MOVE '00' TO FIO-STAT
                 GO TO LUP-ELIMINA-PLZS
              ELSE
                 GO TO FIN-ELIMINA-PLZS.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
              GO TO FIN-ELIMINA-PLZS.

           GO TO LUP-ELIMINA-PLZS.
       FIN-ELIMINA-PLZS.
           EXIT.

       GRABA-PLZS SECTION.
       INI-GRABA-PLZS.
           MOVE ZEROES       TO WSS-I.
       LUP-GRABA-PLZS.
           ADD WSS-UNO       TO WSS-I.

           IF WSS-I > WSS-MAX-REGS
              GO TO FIN-GRABA-PLZS.

           IF FRM-NUM-DIAS IN PLZ-FLD(WSS-I) NOT > ZEROES
              GO TO LUP-GRABA-PLZS.

           IF WSS-VAL-REG(WSS-I) > SPACES
              GO TO LUP-GRABA-PLZS.

           MOVE SPACES        TO TAB.
           MOVE 'DAP'         TO FIO-SIST.
           MOVE 'DAP'         TO TAB-COD-SIST.
           MOVE WSS-NSD       TO TAB-COD-TTAB IN TAB.
           MOVE SPACES        TO WSS-COD-CTAB.
           MOVE FRM-COD-VCAM  IN PLZ-FLD TO WSS-COD-VCAM.
           MOVE FRM-COD-CNL   IN PLZ-FLD TO WSS-COD-CNL.
           MOVE FRM-NUM-DIAS  IN PLZ-FLD(WSS-I) TO WSS-COD-PLZ.
           MOVE WSS-COD-CTAB  TO TAB-COD-CTAB IN TAB.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE SPACES        TO WSS-GLS-DATOS.
           MOVE FRM-NUM-OPC1  IN PLZ-FLD(WSS-I) TO WSS-NUM-OPC1.
           MOVE FRM-NUM-OPC2  IN PLZ-FLD(WSS-I) TO WSS-NUM-OPC2.
           MOVE FRM-NUM-OPC3  IN PLZ-FLD(WSS-I) TO WSS-NUM-OPC3.
           MOVE FRM-NUM-OPC4  IN PLZ-FLD(WSS-I) TO WSS-NUM-OPC4.
           MOVE FRM-NUM-OPC5  IN PLZ-FLD(WSS-I) TO WSS-NUM-OPC5.
           MOVE FRM-NUM-OPC6  IN PLZ-FLD(WSS-I) TO WSS-NUM-OPC6.
           MOVE SPACES        TO TAB-GLS-DATA IN TAB.
           MOVE WSS-GLS-DATOS TO TAB-GLS-DATA IN TAB.
           MOVE WSS-S         TO TAB-IND-VIGE IN TAB.
           MOVE SCR-USER      TO TAB-COD-ATRN IN TAB.
           IF FIO-STAT-OKS
              MOVE FIO-MOD       TO FIO-CMND
           ELSE
              MOVE FIO-PUT       TO FIO-CMND.

           PERFORM GNS-FIO-TAB.

           IF NOT FIO-STAT-OKS
              GO TO FIN-GRABA-PLZS.

           GO TO LUP-GRABA-PLZS.
       FIN-GRABA-PLZS.
           EXIT.

       VALIDA-DATOS SECTION.
       INI-VALIDA-DATOS.
           MOVE SPACES TO WSS-GLS-VALI.
           MOVE ZEROES TO WSS-I.
       LUP-VALIDA-DATOS.
           ADD WSS-UNO   TO WSS-I.

           IF WSS-I > WSS-MAX-REGS
              GO TO FIN-VALIDA-DATOS.

           IF FRM-NUM-DIAS IN PLZ-FLD(WSS-I) > ZEROES AND
              FRM-NUM-OPC1 IN PLZ-FLD(WSS-I) NOT > ZEROES AND
              FRM-NUM-OPC2 IN PLZ-FLD(WSS-I) NOT > ZEROES AND
              FRM-NUM-OPC3 IN PLZ-FLD(WSS-I) NOT > ZEROES AND
              FRM-NUM-OPC4 IN PLZ-FLD(WSS-I) NOT > ZEROES AND
              FRM-NUM-OPC5 IN PLZ-FLD(WSS-I) NOT > ZEROES AND
              FRM-NUM-OPC6 IN PLZ-FLD(WSS-I) NOT > ZEROES
                 MOVE WSS-S TO WSS-VAL-REG(WSS-I).

           IF FRM-NUM-DIAS IN PLZ-FLD(WSS-I) = ZEROES AND
             (FRM-NUM-OPC1 IN PLZ-FLD(WSS-I) > ZEROES OR
              FRM-NUM-OPC2 IN PLZ-FLD(WSS-I) > ZEROES OR
              FRM-NUM-OPC3 IN PLZ-FLD(WSS-I) > ZEROES OR
              FRM-NUM-OPC4 IN PLZ-FLD(WSS-I) > ZEROES OR
              FRM-NUM-OPC5 IN PLZ-FLD(WSS-I) > ZEROES OR
              FRM-NUM-OPC6 IN PLZ-FLD(WSS-I) > ZEROES)
                 MOVE WSS-S TO WSS-VAL-REG(WSS-I).

              GO TO LUP-VALIDA-DATOS.

       FIN-VALIDA-DATOS.
           EXIT.
*% END
      *>>>>
*% END
