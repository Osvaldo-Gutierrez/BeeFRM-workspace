*%! Codigo adicional para DAPPAORD
*% PGM_MSX = TRUE
*% IF SETTAG
*% FNCPQ = "080311"
*% VSNPQ = "08.09.03"
*% FNCPU = "080311"
*% VSNPU = "08.09.03"
*% END
*% NO_TIENE_TIMESTAMP = TRUE
*% NO_HDR_CST = TRUE
*% PGM_PTC = TRUE
*% INCLUDE 'GNSSRC:MANEJO_VSI.SRC'
*% IF WSS
      *<<<< WSS
       COPY SGCBRDBC.
       COPY GNSWGCPT.
       COPY GNSWGSTR.
       COPY DAPWXORD.
       77  WSS-ORD-NUM-CORR VALUE ZEROES PIC 9(05).

      *>>>> WSS
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
      *Entidades de SGC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>> WSS_DTC
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           MOVE TSK-TERM-ALF    TO ORX-COD-TERM.
      *>>>> INI_FIO
*% END
*% IF FND_KEY
      *<<<< FND_KEY
           IF SCR-CMND = 'CON' AND
              ( SCR-OFRM-SRV OR
                FRM-IND-FMTI = 'S' )
                  MOVE FIO-GET-NLS TO FIO-CMND
                  PERFORM DAP-FIO-ORD
                  IF NOT ( FIO-STAT-OKS AND
                           ORD-NUM-RUTC IN ORD-FLD =
                           ORD-NUM-RUTC IN ORD AND
                           ORD-IND-RUTC IN ORD-FLD =
                           ORD-IND-RUTC IN ORD AND
                           ORD-GLS-RUTC IN ORD-FLD =
                           ORD-GLS-RUTC IN ORD AND
                           ORD-NUM-SPRO IN ORD-FLD =
                           ORD-NUM-SPRO IN ORD AND
                           ORD-NUM-APRO IN ORD-FLD =
                           ORD-NUM-APRO IN ORD
                         )
                         MOVE '23' TO FIO-STAT
                         MOVE FIO-STAT TO PGM-STAT-ORD
                         GO TO FIN-FND-KEY.

      *>>>> FND_KEY
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      *>>>> FIN_FND_KEY
*% END
*% IF FIN_PUT_SCR
      *<<<< FIN_PUT_SCR

           IF SCR-CMND NOT = 'CON'
                GO TO END-PUT-SCR.

           MOVE 'N' TO FRM-COD-HMAS IN ORD-FLD.

           IF NOT ( SCR-OFRM-SRV OR
                    FRM-IND-FMTI = 'S' )
                    GO TO END-PUT-SCR.

      * BUSCA EL PRIMER REGISTRO EN SOLICITUD
      * DE HAY MAS
           IF ( SCR-OFRM-SRV OR
                FRM-IND-FMTI = 'S' )
                  IF WSS-ORD-NUM-CORR NOT > ZEROES
                      PERFORM PRO-ORD
                  ELSE
                      MOVE FIO-GET-NXT TO FIO-CMND
                      PERFORM DAP-FIO-ORD
                      IF NOT FIO-STAT-OKS
                          MOVE 'DAP' TO MSG-COD-SIST
                          MOVE 'ORDNONXT' TO MSG-COD-MENS
                          PERFORM GET-MSG
                          MOVE MSG-GLS-DESC TO FRM-MENS
                          MOVE FRM-SUAR-MAL TO FRM-SUAR
                          MOVE 'S' TO SCR-IERR
                          GO TO FIN-PUT-SCR
                      ELSE
                          PERFORM PRO-ORD.

       CIC-PUT-SCR.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-ORD.
           IF FIO-STAT-OKS AND
              ORD-NUM-RUTC IN ORD-FLD = ORD-NUM-RUTC IN ORD AND
              ORD-IND-RUTC IN ORD-FLD = ORD-IND-RUTC IN ORD AND
              ORD-GLS-RUTC IN ORD-FLD = ORD-GLS-RUTC IN ORD AND
              ORD-NUM-SPRO IN ORD-FLD = ORD-NUM-SPRO IN ORD AND
              ORD-NUM-APRO IN ORD-FLD = ORD-NUM-APRO IN ORD
                 PERFORM PRO-ORD
                 IF ORX-IDX-ORX-OCC = ORX-TOT-ORX-OCC
                     PERFORM PRO-ULT-ORD
                 ELSE
                     GO TO CIC-PUT-SCR.

           MOVE ORX-IDX-ORX-OCC TO FRM-NUM-TOCC IN ORD-FLD.
           IF ORX-PUT-QUE = 'S'
               PERFORM PUT-TS-ORX.
       END-PUT-SCR.

      *>>>> FIN_PUT_SCR
*% END
*% IF FIOSTAT
      *<<<< FIOSTAT
                   IF MSG-COD-MENS = 'FIOSTAT23'
                       MOVE 'DAP' TO MSG-COD-SIST
                       MOVE 'CLIORDNEX' TO MSG-COD-MENS
                   END-IF
      *>>>> FIOSTAT
*% END
*% IF EOF
      *<<<< EOF
       PRO-ULT-ORD SECTION.
       INI-PRO-ULT-ORD.

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-ORD.
           IF FIO-STAT-OKS AND
              ORD-NUM-RUTC IN ORD-FLD = ORD-NUM-RUTC IN ORD AND
              ORD-IND-RUTC IN ORD-FLD = ORD-IND-RUTC IN ORD AND
              ORD-GLS-RUTC IN ORD-FLD = ORD-GLS-RUTC IN ORD AND
              ORD-NUM-SPRO IN ORD-FLD = ORD-NUM-SPRO IN ORD AND
              ORD-NUM-APRO IN ORD-FLD = ORD-NUM-APRO IN ORD
                 MOVE ORD-CIC-IOPD IN ORD TO FRM-GLS-UOM1 IN ORD-FLD
                 MOVE 'S' TO FRM-COD-HMAS IN ORD-FLD.
       FIN-PRO-ULT-ORD.
           EXIT.

       PRO-ORD SECTION.
       INI-PRO-ORD.
           ADD 1 TO ORX-IDX-ORX-TSQ.
           ADD 1 TO ORX-IDX-ORX-OCC.
           MOVE ORD-CIC-IOPD IN ORD TO FRM-GLS-UOPD IN ORD-FLD.

           IF ORX-IDX-ORX-TSQ > ORX-TOT-ORX-TSQ
                MOVE 1 TO ORX-IDX-ORX-TSQ
                PERFORM PUT-TS-ORX.

           MOVE 'S' TO ORX-PUT-QUE.

           MOVE ORD-NUM-CORR IN ORD
             TO ORX-NUM-CORR-EDT.
           MOVE ORX-NUM-CORR-EDT
             TO ORX-NUM-CORR-ALF IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-GLS-OPER IN ORD
             TO ORX-GLS-OPER IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-GLS-MONE IN ORD
             TO ORX-GLS-MONE IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-CAI-IOPD IN ORD
             TO ORX-CAI-IOPD IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-IIC-IOPD IN ORD
             TO ORX-IIC-IOPD-EDT.
           MOVE ORX-IIC-IOPD-EDT
             TO ORX-IIC-IOPD-ALF IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-NUM-DREA IN ORD
             TO ORX-NUM-DREA IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-NUM-MREA IN ORD
             TO ORX-NUM-MREA IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-NUM-SREA IN ORD
             TO ORX-NUM-SREA IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-NUM-AREA IN ORD
             TO ORX-NUM-AREA IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-NUM-DVEN IN ORD
             TO ORX-NUM-DVEN IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-NUM-MVEN IN ORD
             TO ORX-NUM-MVEN IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-NUM-SVEN IN ORD
             TO ORX-NUM-SVEN IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-NUM-AVEN IN ORD
             TO ORX-NUM-AVEN IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-VAL-CAPI IN ORD
             TO ORX-VAL-CAPI-EDT.
           MOVE ORX-VAL-CAPI-EDT
             TO ORX-VAL-CAPI-ALF IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-VAL-PERC IN ORD
             TO ORX-VAL-PERC-EDT.
           MOVE ORX-VAL-PERC-EDT
             TO ORX-VAL-PERC-ALF IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-VAL-INTN IN ORD
             TO ORX-VAL-INTN-EDT.
           MOVE ORX-VAL-INTN-EDT
             TO ORX-VAL-INTN-ALF IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

           MOVE ORD-VAL-INTR IN ORD
             TO ORX-VAL-INTR-EDT.
           MOVE ORX-VAL-INTR-EDT
             TO ORX-VAL-INTR-ALF IN
                ORX-MTI-VARI ( ORX-IDX-ORX-TSQ ).

       FIN-PRO-ORD.
           EXIT.

       PUT-TS-ORX SECTION.
       INI-PUT-TS-ORX.
           MOVE ORX-TSORD TO QUE-COLA.
           MOVE ORX-LEN-TSORX  TO QUE-LITM.
           MOVE ORX-MTI-VARI   TO QUE-ITEM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           MOVE SPACES TO ORX-MTI-VARI.
           MOVE 'N' TO ORX-PUT-QUE.
       FIN-PUT-TS-ORX.
           EXIT.

       COPY SGCBFDBC.
       LEE-CLI SECTION.
       INI-LEE-CLI.
           MOVE ORD-NUM-RUTC IN ORD-FLD TO DBC-NUM-ICLI IN DBC.
           MOVE ORD-IND-RUTC IN ORD-FLD TO DBC-IND-ICLI IN DBC.
           MOVE ORD-GLS-RUTC IN ORD-FLD TO DBC-GLS-ICLI IN DBC.
           MOVE 'DBC-IDC-ICLI' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF FIO-STAT-OKS
               MOVE FIO-STAT TO PGM-STAT-DBC
               PERFORM CPT-NOMB.
       FIN-LEE-CLI.
           EXIT.

       COPY GNSBGCPT.
       COPY GNSBGSTR.

       CPT-NOMB SECTION.
       INI-CPT-NOMB.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN            TO DBC-GLS-NOMC IN DBC.
       FIN-CPT-NOMB.
           EXIT.
      *>>>> EOF
*% END
