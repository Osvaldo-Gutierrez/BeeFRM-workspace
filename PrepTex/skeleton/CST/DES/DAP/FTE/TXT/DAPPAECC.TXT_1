*%! Codigo adicional para ECC
*% IF SETTAG
*% VSNPQ = "01-00"
*% FNCPQ = "1603_02"
*% VSNPU = "01-00"
*% FNCPU = "1603_02"
*% END
*% IF WSS
      *<<<< WSS
      *Entidades de GNS
       COPY GNSWGCPT.
       COPY GNSWGSTR.
*% IF PGM_PU
       COPY GNSWGHOY.
*% END

      *Entidades de SGC
       COPY SGCBRDBC.
      *Entidades de DAP
       COPY DAPBROPD.
       01  WSS-VARI.
              05 PGM-STAT-OPD.
                 88 PGM-STAT-OPD-NUL    VALUE '  '.
                 07 PGM-STT1-OPD        VALUE '2' PIC X(01).
                    88 PGM-STAT-OPD-OKS VALUE '0'.
                 07 PGM-STT2-OPD        VALUE '3' PIC X(01).
      *>>>> WSS
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
      *Entidades de SGC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *Entidades de DAP
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPD-REQA==.
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
*% IF PGM_PU
       COPY GNSBGHOY.
*% END
      *>>>> EOF
*% END
*% IF PFS_GET_CON
      *<<<< PFS_GET_CON
      *>>>>
*% END
*% IF PFS_SCR_ACC
      *<<<< PFS_SCR_ACC
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      *>>>>
*% END
*%!-----------------------------------------------------------------
*% IF FIN_SCR_GIKY OR FIN_SCR_GCNF OR FIN_SCR_GFLD
      *<<<< FIN_SCR_GIKY OR FIN_SCR_GCNF OR FIN_SCR_GFLD
      *>>>>
*% END
*% IF SCR_GIKY_VAL_CON_IKY OR FIN_CMN_ING
      *<<<< SCR_GIKY_VAL_CON_IKY OR FIN_CMN_ING
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
       FIN-INI-FIO.
      *>>>>
*% END
*% IF FIN_HBL_IKY
      *<<<< FIN_HBL_IKY
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
      *>>>>
*% END
*% IF PUT_SCR
      *<<<< PUT_SCR
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       BUS-OPD-CON-RCC SECTION.
       INI-BUS-OPD-CON-RCC.
           MOVE RCC-CAI-IOPD IN RCC TO OPD-CAI-IOPD IN OPD.
           MOVE RCC-IIC-IOPD IN RCC TO OPD-IIC-IOPD IN OPD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           MOVE FIO-STAT TO PGM-STAT-OPD.
           IF NOT FIO-STAT-OKS
               MOVE 'DAP'        TO MSG-COD-SIST
               MOVE 'OPD    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT.
       FIN-BUS-OPD-CON-RCC.
           EXIT.

       BUS-POR-OPD SECTION.
       INI-BUS-POR-OPD.
           MOVE RCC-CAI-IOPD IN ECC-FLD TO OPD-CAI-IOPD IN OPD.
           MOVE RCC-IIC-IOPD IN ECC-FLD TO OPD-IIC-IOPD IN OPD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           MOVE FIO-STAT TO PGM-STAT-OPD.
           IF NOT FIO-STAT-OKS
               MOVE 'DAP'        TO MSG-COD-SIST
               MOVE 'OPD    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT
               GO TO FIN-BUS-POR-OPD.
           PERFORM BUS-RCC-CON-OPD.
           IF FIO-STAT = FIO-STAT-NEX
               GO TO FIN-BUS-POR-OPD.
           PERFORM BUS-CLI-CON-RCC.
       FIN-BUS-POR-OPD.
           EXIT.

       BUS-RCC-CON-OPD SECTION.
       INI-BUS-RCC-CON-OPD.
           MOVE OPD-CAI-IOPD IN OPD TO RCC-CAI-IOPD IN RCC.
           MOVE OPD-IIC-IOPD IN OPD TO RCC-IIC-IOPD IN RCC.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT ( FIO-STAT-OKS AND
                    RCC-CAI-IOPD IN RCC = OPD-CAI-IOPD IN OPD AND
                    RCC-IIC-IOPD IN RCC = OPD-IIC-IOPD IN OPD )
               MOVE 'DAP'        TO MSG-COD-SIST
               MOVE 'RCC    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT
           ELSE
               MOVE FIO-STAT TO PGM-STAT-RCC.
       FIN-BUS-RCC-CON-OPD.
           EXIT.

       BUS-CLI-CON-RCC SECTION.
       INI-BUS-CLI-CON-RCC.
           MOVE RCC-CAI-ICLI IN RCC TO DBC-CAI-ICLI IN DBC.
           MOVE RCC-IIC-ICLI IN RCC TO DBC-IIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
           IF NOT FIO-STAT-OKS
               MOVE 'SGC'        TO MSG-COD-SIST
               MOVE 'CLI    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT
           ELSE
               MOVE '00'  TO PGM-STAT-DBC
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN ECC-FLD
                                DBC-GLS-NOMC IN DBC
               MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN ECC-FLD
               MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN ECC-FLD
               MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN ECC-FLD
               MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN ECC-FLD
               MOVE DBC-CAI-ICLI IN DBC TO RCC-CAI-ICLI IN ECC-FLD
               MOVE DBC-IIC-ICLI IN DBC TO RCC-IIC-ICLI IN ECC-FLD.
       FIN-BUS-CLI-CON-RCC.
           EXIT.
      *>>>> EOF
*% END
*% IF FND_KEY_NO
      *<<<< FND_KEY
           MOVE 'N' TO WSS-IND-IOPD.
           IF RCC-IIC-ICLI IN ECC-FLD NOT > SPACES
               MOVE 'S' TO WSS-IND-IOPD
               MOVE 'RCC-KEY-IOPD' TO FIO-AKEY
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM DAP-FIO-RCC
               MOVE FIO-STAT TO PGM-STAT-RCC
               IF FIO-STAT-OKS
                   IF NOT (
                       RCC-CAI-IOPD IN ECC-FLD = RCC-CAI-IOPD IN RCC AND
                       RCC-IIC-IOPD IN ECC-FLD = RCC-IIC-IOPD IN RCC )
                        MOVE '23' TO FIO-STAT
                        MOVE '23' TO PGM-STAT-RCC
                   ELSE
                       MOVE RCC-CIC-ICLI IN RCC TO DBC-CIC-ICLI IN DBC
                       MOVE FIO-GET-KEY TO FIO-CMND
                       PERFORM SGC-FIO-DBC
                       MOVE FIO-STAT TO PGM-STAT-DBC
                       IF PGM-STAT-DBC-OKS
                           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                           PERFORM CPT-BLKS
                           MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC
                                            DBC-GLS-NOMC IN ECC-FLD.
           IF WSS-IND-IOPD = 'S' 
               GO TO END-FND-KEY.
               
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      *Entidades de GNS
       COPY GNSBVCOD.
       COPY GNSBVTAB.
       COPY GNSBGCPT.
       COPY GNSBGSTR.
      *Entidades de SGC
       COPY SGCBFDBC.
       COPY SGCBGCLI.
      *Entidades de DAP
       COPY DAPBFOPD.


      *>>>>
*% END
*% IF EOF_PU
      *<<<< EOF_PU
      *>>>>
*% END
