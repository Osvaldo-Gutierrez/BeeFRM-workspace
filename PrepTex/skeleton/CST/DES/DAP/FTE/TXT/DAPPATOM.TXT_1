*%! Codigo adicional para DAPPATOM
*% GEN_MFC = TRUE
*% IF PGM_PQ
*% CLRMFC = "DAPZQTOM"
*% END
*% IF SETTAG
*% FNCPQ = "MK2FLT"
*% VSNPQ = "08.01.10"
*% FNCPU = "MK2FLT"
*% VSNPU = "08.01.10"
*% END
*% NO_HDR_CST = TRUE
*% PGM_PTC = TRUE
*% IF INI_FIO
      *<<<< INI_FIO
      ***  PERFORM GET-FHOY.
      *>>>> INI_FIO
*% END INI_FIO
*% IF WSS
      *<<<< WSS
LFZ    COPY GNSWGPES.
LFZ    COPY GNSWGCPT.
LFZ    COPY GNSWGSTR.
       77  WSS-CIC-TFPR   VALUE SPACES        PIC X(01).
       77  WSS-IFLD       VALUE ZEROES        PIC 9(02).
       77  WSS-IMAX       VALUE 12            PIC 9(02).

       01  WSS-FEC-FTOD.
           03  WSS-NUM-DTOD                   PIC X(02) VALUE SPACES.
           03  WSS-FILLER                     PIC X(01) VALUE '-'.
           03  WSS-NUM-MTOD                   PIC X(02) VALUE SPACES.
           03  WSS-FILLER                     PIC X(01) VALUE '-'.
           03  WSS-NUM-STOD                   PIC X(02) VALUE SPACES.
           03  WSS-NUM-ATOD                   PIC X(02) VALUE SPACES.

       COPY DAPBROPD.
       COPY DAPBRRCC.
       COPY SGCBRDBC.
      *>>>> WSS
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
           MOVE TOD-CAI-IOPD IN TOM-FLD TO OPD-CAI-IOPD IN OPD.
           MOVE TOD-IIC-IOPD IN TOM-FLD TO OPD-IIC-IOPD IN OPD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           IF NOT FIO-STAT-OKS
               MOVE 'DAP'        TO MSG-COD-SIST
               MOVE 'OPD    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.

LFZ        MOVE '00' TO PGM-STAT-OPD.

           MOVE TOD-CAI-IOPD IN TOM-FLD TO TOD-CAI-IOPD IN TOD.
           MOVE TOD-IIC-IOPD IN TOM-FLD TO TOD-IIC-IOPD IN TOD.
           MOVE ZEROES                  TO TOD-NUM-IOPD IN TOD.
           MOVE TOD-CAI-IOPD IN TOM-FLD TO TOD-CAI-IOPV IN TOD.
           MOVE TOD-IIC-IOPD IN TOM-FLD TO TOD-IIC-IOPV IN TOD.
           MOVE 1                       TO TOD-NUM-IVCT IN TOD.
           MOVE 'INT'                   TO TOD-IND-TTAS IN TOD.
           GO TO LEE-ALL-TOD.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY

       LEE-ALL-TOD.
           MOVE FIO-GET-NLS TO FIO-CMND.

       LEE-TOM.
           PERFORM DAP-FIO-TOD.
           IF FIO-STAT-OKS AND
               TOD-CAI-IOPD IN TOM-FLD = TOD-CAI-IOPD IN TOD AND
               TOD-IIC-IOPD IN TOM-FLD = TOD-IIC-IOPD IN TOD
                  GO TO CARGA-TOM
           ELSE
           IF NOT FIO-STAT-OKS
               MOVE '00' TO FIO-STAT
               GO TO FIN-FND-KEY.

       CARGA-TOM.
LFZ        PERFORM GET-CUR-RCC.
LFZ        PERFORM LEE-CLI.

LFZ******  MOVE DBC-NUM-ICLI IN DBC     TO DBC-NUM-ICLI-ALF IN TOM-FLD
LFZ******  MOVE DBC-VRF-ICLI IN DBC     TO DBC-VRF-ICLI     IN TOM-FLD
LFZ******  MOVE DBC-GLS-NOMC IN DBC     TO DBC-GLS-NOMC     IN TOM-FLD.
LFZ******  MOVE OPD-VAL-CAPT IN OPD     TO OPD-VAL-CAPT     IN TOM-FLD.
LFZ******  MOVE OPD-VAL-SCAP IN OPD     TO OPD-VAL-SCAP     IN TOM-FLD.

           MOVE SPACES TO MSG-COD-MENS.
           MOVE ZEROES TO WSS-IFLD.
           PERFORM PUT-PAN-TOM.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE SPACES TO FIO-AKEY
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00' TO FIO-STAT
               GO TO FIN-FND-KEY.
      *>>>>
*% END
*% IF FIN_SCR_TRL
      *<<<< FIN_SCR_TRL
      *>>>> FIN_SCR_TRL
*% END
*% IF EOF_PQ
      *<<<< EOF_PQ
       PUT-PAN-TOM SECTION.
       INI-PUT-PAN-TOM.
           ADD 1 TO WSS-IFLD.
           IF WSS-IFLD > WSS-IMAX
              GO TO FIN-PUT-PAN-TOM.

           MOVE TOD-NUM-DINI IN TOD TO WSS-NUM-DTOD.
           MOVE TOD-NUM-MINI IN TOD TO WSS-NUM-MTOD.
           MOVE TOD-NUM-SINI IN TOD TO WSS-NUM-STOD.
           MOVE TOD-NUM-AINI IN TOD TO WSS-NUM-ATOD.

           MOVE WSS-FEC-FTOD TO
                FRM-GLS-FINI IN TOM-FLD(WSS-IFLD).

           MOVE TOD-NUM-DTER IN TOD TO WSS-NUM-DTOD.
           MOVE TOD-NUM-MTER IN TOD TO WSS-NUM-MTOD.
           MOVE TOD-NUM-STER IN TOD TO WSS-NUM-STOD.
           MOVE TOD-NUM-ATER IN TOD TO WSS-NUM-ATOD.

           MOVE WSS-FEC-FTOD TO
                FRM-GLS-FFIN IN TOM-FLD(WSS-IFLD).

           MOVE TOD-COD-TINT IN TOD TO
                FRM-COD-TINT IN TOM-FLD(WSS-IFLD).

           MOVE TOD-SGV-SPRD IN TOD TO
                FRM-SGV-SPRD IN TOM-FLD(WSS-IFLD).

           MOVE TOD-SGV-TINT IN TOD TO
                FRM-SGV-TINT IN TOM-FLD(WSS-IFLD).

           MOVE TOD-SGV-MNTO IN TOD TO
                FRM-SGV-MNTO IN TOM-FLD(WSS-IFLD).

       NXT-PUT-PAN-TOM.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM DAP-FIO-TOD.
           IF FIO-STAT-OKS AND
               TOD-CAI-IOPD IN TOM-FLD = TOD-CAI-IOPD IN TOD AND
               TOD-IIC-IOPD IN TOM-FLD = TOD-IIC-IOPD IN TOD
                  GO TO INI-PUT-PAN-TOM
           ELSE
               IF FIO-STAT-RNF
                   MOVE '00' TO FIO-STAT.
       FIN-PUT-PAN-TOM.
           EXIT.

LFZ    GET-CUR-RCC SECTION.
LFZ    INI-GET-CUR-RCC.
LFZ        MOVE OPD-CIC-IOPD IN OPD TO RCC-CIC-IOPD IN RCC.
LFZ        MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
LFZ        MOVE FIO-GET-NLS    TO FIO-CMND.
LFZ        PERFORM DAP-FIO-RCC.
LFZ    FIN-GET-CUR-RCC.
LFZ        EXIT.
LFZ
LFZ    LEE-CLI SECTION.
LFZ    INI-LEE-CLI.
LFZ        MOVE RCC-CIC-ICLI IN RCC TO DBC-CIC-ICLI IN DBC.
LFZ        MOVE FIO-GET-KEY TO FIO-CMND.
LFZ        PERFORM SGC-FIO-DBC.
LFZ        IF FIO-STAT-OKS
LFZ            MOVE '00' TO PGM-STAT-DBC
LFZ            MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
LFZ            PERFORM CPT-BLKS
LFZ            MOVE CPT-STRN            TO DBC-GLS-NOMC IN DBC
LFZ        ELSE
LFZ            MOVE ZEROES              TO DBC-NUM-ICLI IN DBC
LFZ            MOVE SPACES              TO DBC-VRF-ICLI IN DBC
LFZ            MOVE SPACES              TO DBC-GLS-NOMC IN DBC.
LFZ    FIN-LEE-CLI.
LFZ        EXIT.

LFZ    COPY GNSBGCPT.
LFZ    COPY GNSBGSTR.
      *>>>> EOF_PQ
*% END
*% IF EOF
      *<<<< EOF
      *Entidades de DAP
       COPY DAPBFOPD.
       COPY DAPBFRCC.
       COPY SGCBFDBC.
      *>>>>
*% END
