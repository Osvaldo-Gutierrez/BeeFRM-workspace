*%! Codigo adicional para DAPPATPD
*% IF SETTAG
*% FNCPQ = "MK2MT1"
*% VSNPQ = "08.01.10"
*% FNCPU = "MK2MT1"
*% VSNPU = "08.01.10"
*% END
*% NO_HDR_CST = TRUE
*% PGM_PTC = TRUE
*% INCLUDE 'GNSSRC:MANEJO_VSI.SRC'
*% IF INI_FIO
      *<<<< INI_FIO
           PERFORM GET-FHOY.
           MOVE SPACES TO TPD.
      *>>>> INI_FIO
*% END INI_FIO
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       77  WSS-CIC-TFPR   VALUE SPACES        PIC X(01).
       77  WSS-IFLD       VALUE ZEROES        PIC 9(02).
       77  WSS-IMAX       VALUE 5             PIC 9(02).
       77  WSS-LEE-CLI    VALUE 'S'           PIC X(01).
       77  FRM-IFLD-M1    VALUE ZEROES        PIC 9(03).
       77  WSS-NUM-INEG   VALUE ZEROES        PIC 9(03).
       77  WSS-COD-STAT   VALUE SPACES        PIC X(01).
      *       auxiliar para validacion de TPD-COD-CVTI
       01  WSS-VARI.
      *       auxiliar para validacion de POD-COD-CVTI
           03 WSS-CVTI.
              05 WSS-GLS-CVTI              PIC X(01).
              05 WSS-COD-CVTI              PIC X(03).
              05 WSS-COD-PBTI              PIC X(01).
      *       auxiliar para validacion sobre TAB-INT
           03 WSS-INTE.
              05 WSS-INT-COD-BCTI          PIC X(01).
              05 WSS-INT-COD-PBTI          PIC X(01).
              05 WSS-INT-COD-BPBT          PIC X(01).
              05 WSS-INT-COD-SPBT          PIC X(01).
              05 WSS-INT-COD-CVTI          PIC X(03).
              05 WSS-INT-COD-TFPR          PIC X(01).
              05 WSS-INT-NUM-PREP          PIC 9(03).
              05 WSS-INT-IND-PREP          PIC X(01).

           03 WSS-FEC-FUNO.
              05 WSS-NUM-SUNO                     PIC 9(02).
              05 WSS-NUM-AUNO                     PIC 9(02).
              05 WSS-NUM-MUNO                     PIC 9(02).
              05 WSS-NUM-DUNO                     PIC 9(02).

           03 WSS-FEC-FDOS.
              05 WSS-NUM-SDOS                     PIC 9(02).
              05 WSS-NUM-ADOS                     PIC 9(02).
              05 WSS-NUM-MDOS                     PIC 9(02).
              05 WSS-NUM-DDOS                     PIC 9(02).

       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY SGCBRDBC.
       COPY DAPBRPOD.
       COPY GNSWGCPT.
       COPY GNSWGSTR.
      *>>>> WSS
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-POD-REQA==.
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY

           MOVE 'I' TO WSS-COD-STAT.
           MOVE ZEROES TO WSS-NUM-INEG.

           MOVE TPD-COD-VCAM IN TPD-FLD TO POD-COD-VCAM IN POD.
           MOVE TPD-COD-TOPD IN TPD-FLD TO POD-COD-TOPD IN POD.
           MOVE TPD-COD-AOPD IN TPD-FLD TO POD-COD-AOPD IN POD.
           MOVE ZEROES                  TO POD-NUM-IPOD IN POD. 
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-POD.
           IF NOT FIO-STAT-OKS
               MOVE 'DAP'        TO MSG-COD-SIST
               MOVE 'POD    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FIO-STAT-NEX TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.

           GO TO LEE-ALL-TPD.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY

       LEE-ALL-TPD.
           PERFORM KEYS-TPD.
           IF DBC-NUM-ICLI IN TPD-FLD NOT > ZEROES
                MOVE ZEROES TO WSS-NUM-INEG
           ELSE
                MOVE 999 TO TPD-NUM-INEG IN TPD
                MOVE FIO-GET-LEQ TO FIO-CMND
                PERFORM DAP-FIO-TPD
                IF FIO-STAT-OKS AND
                   TPD-CIC-ICLI IN TPD = DBC-CIC-ICLI IN DBC AND
                   TPD-COD-VCAM IN TPD = TPD-COD-VCAM IN TPD AND
                   TPD-COD-TOPD IN TPD = TPD-COD-TOPD IN TPD AND
                   TPD-COD-AOPD IN TPD = TPD-COD-AOPD IN TPD
                       IF TPD-COD-STAT IN TPD = 'A'
                           MOVE 'A' TO WSS-COD-STAT
                           MOVE TPD-NUM-INEG IN TPD TO WSS-NUM-INEG
                       ELSE
                           MOVE TPD-NUM-INEG IN TPD TO WSS-NUM-INEG
                 ELSE
                       MOVE 1 TO WSS-NUM-INEG.

           PERFORM KEYS-TPD.
           MOVE WSS-NUM-INEG TO TPD-NUM-INEG IN TPD.
           MOVE WSS-NUM-INEG TO TPD-NUM-INEG IN TPD-FLD.

           MOVE FIO-GET-NLS TO FIO-CMND.

       LEE-TPD.
           PERFORM DAP-FIO-TPD.
           IF FIO-STAT-OKS AND
               TPD-COD-VCAM IN TPD-FLD = TPD-COD-VCAM IN TPD AND
               TPD-COD-TOPD IN TPD-FLD = TPD-COD-TOPD IN TPD AND
               TPD-COD-AOPD IN TPD-FLD = TPD-COD-AOPD IN TPD AND
               TPD-NUM-INEG IN TPD-FLD = TPD-NUM-INEG IN TPD 
                  GO TO CARGA-TPD
           ELSE
                MOVE '23' TO FIO-STAT
                GO TO FIN-FND-KEY.

       CARGA-TPD.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE ZEROES TO WSS-IFLD.
           PERFORM PUT-PAN-TPD.
           IF MSG-COD-MENS > SPACES
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE SPACES TO FIO-AKEY
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00' TO FIO-STAT
               GO TO FIN-FND-KEY.

            IF WSS-COD-STAT = 'A'
                ADD 1 TO TPD-NUM-INEG IN TPD-FLD.

      *>>>>
*% END
*% IF FIN_SCR_TRL
      *<<<< FIN_SCR_TRL
      *>>>> FIN_SCR_TRL
*% END
*% IF FIN_HBL_FLD
      *<<<< FIN_HBL_FLD
      *>>>> FIN_HBL_FLD
*% END
*% IF SCR_GFLD_VAL_FLD
      *<<<< SCR_GFLD_VAL_FLD

      *>>>>
*% END
*% IF CMN_ING
      *<<<< CMN_ING

      *>>>> CMN_ING
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
      *>>>> FIN_CMN_ING
*% END
*% IF INI_CMN_MOD
      *<<<< INI_CMN_MOD
           PERFORM DEL-TPDS.
           GO TO MOD-TPDS.
      *>>>> INI_CMN_MOD
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
           PERFORM DEL-TPDS.
           GO TO ING-TPDS.
      *>>>> INI_CMN_ING
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
       MOD-TPDS.
           MOVE SPACES TO TPD.
           PERFORM KEYS-TPD.
           PERFORM PUT-FTRN.
           PERFORM PUT-BDD-TPD VARYING WSS-IFLD FROM 1 BY 1 UNTIL
                                    WSS-IFLD > WSS-IMAX.
      *>>>> FIN_CMN_MOD
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
       ING-TPDS.
           MOVE SPACES TO TPD.
           PERFORM KEYS-TPD.
           PERFORM PUT-FTRN.
           PERFORM PUT-BDD-TPD VARYING WSS-IFLD FROM 1 BY 1 UNTIL
                                    WSS-IFLD > WSS-IMAX.
      *>>>> FIN_CMN_ING
*% END
*% IF CMN_MOD_RET
      *<<<< CMN_MOD_RET
      *>>>> CMN_MOD_RET
*% END
*% IF CMN_ELI
      *<<<< CMN_ELI
      *>>>> CMN_ELI
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI
      *>>>> FIN_CMN_ELI
*% END
*% IF CMN_ACC
      *<<<< CMN_ACC
      *>>>> CMN_ACC
*% END
*% IF EOF_PQ
      *<<<< EOF_PQ
       PUT-PAN-TPD SECTION.
       INI-PUT-PAN-TPD.
           ADD 1 TO WSS-IFLD.
           IF WSS-IFLD > WSS-IMAX
              GO TO FIN-PUT-PAN-TPD.

           MOVE TPD-NUM-ITPD IN TPD TO
                FRM-NUM-ITPD IN TPD-FLD(WSS-IFLD).

           MOVE TPD-COD-BCTI IN TPD TO
                FRM-COD-BCTI IN TPD-FLD(WSS-IFLD).

           MOVE TPD-COD-PBTI IN TPD TO
                FRM-COD-PBTI IN TPD-FLD(WSS-IFLD).

           MOVE TPD-COD-BPBT IN TPD TO
                FRM-COD-BPBT IN TPD-FLD(WSS-IFLD).

           MOVE TPD-COD-SPBT IN TPD TO
                FRM-COD-SPBT IN TPD-FLD(WSS-IFLD).

           MOVE TPD-COD-CVTI IN TPD TO
                FRM-COD-CVTI IN TPD-FLD(WSS-IFLD).

           PERFORM BUS-GLS-CVTI.

           MOVE TPD-COD-TFPR IN TPD TO
                FRM-COD-TFPR IN TPD-FLD(WSS-IFLD).

           MOVE TPD-NUM-PREP IN TPD TO
                FRM-NUM-PREP IN TPD-FLD(WSS-IFLD).

           MOVE TPD-IND-PREP IN TPD TO
                FRM-IND-PREP IN TPD-FLD(WSS-IFLD).

           MOVE TPD-NUM-SMNV IN TPD TO
                FRM-NUM-SMNV IN TPD-FLD(WSS-IFLD).

           MOVE TPD-IND-SMNV IN TPD TO
                FRM-IND-SMNV IN TPD-FLD(WSS-IFLD).

           MOVE TPD-NUM-SMXV IN TPD TO
                FRM-NUM-SMXV IN TPD-FLD(WSS-IFLD).

           MOVE TPD-IND-SMXV IN TPD TO
                FRM-IND-SMXV IN TPD-FLD(WSS-IFLD).

           MOVE TPD-IND-OBGT IN TPD TO
                FRM-IND-OBGT IN TPD-FLD(WSS-IFLD).

           MOVE TPD-COD-ITIF IN TPD TO
                FRM-COD-ITIF IN TPD-FLD(WSS-IFLD).

           MOVE TPD-COD-ITIK IN TPD TO
                FRM-COD-ITIK IN TPD-FLD(WSS-IFLD).

           MOVE TPD-COD-ITIC IN TPD TO
                FRM-COD-ITIC IN TPD-FLD(WSS-IFLD).

       NXT-PUT-PAN-TPD.
           MOVE FIO-GET-NXT    TO FIO-CMND.
           PERFORM DAP-FIO-TPD.
           IF FIO-STAT-OKS AND
              TPD-COD-VCAM IN TPD = TPD-COD-VCAM IN TPD-FLD AND
              TPD-COD-TOPD IN TPD = TPD-COD-TOPD IN TPD-FLD AND
              TPD-COD-AOPD IN TPD = TPD-COD-AOPD IN TPD-FLD AND
              TPD-NUM-INEG IN TPD = TPD-NUM-INEG IN TPD-FLD 
              GO TO INI-PUT-PAN-TPD.

           IF FIO-STAT-OKS
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM DAP-FIO-TPD.
       FIN-PUT-PAN-TPD.
           EXIT.

       BUS-GLS-CVTI SECTION.
       INI-BUS-GLS-CVTI.
           MOVE SPACES TO FRM-GLS-CVTI IN TPD-FLD(WSS-IFLD).

           IF TPD-COD-CVTI IN TPD > SPACES
               MOVE 'I'                     TO WSS-GLS-CVTI IN WSS-VARI
               MOVE TPD-COD-CVTI IN TPD     TO WSS-COD-CVTI IN WSS-VARI
               MOVE TPD-COD-PBTI IN TPD     TO WSS-COD-PBTI IN WSS-VARI
               MOVE WSS-CVTI IN WSS-VARI    TO TAB-COD-CTAB IN TAB
               MOVE 'TAB' TO TAB-COD-SIST
               MOVE 'VLR' TO TAB-COD-TTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO
                    FRM-GLS-CVTI IN TPD-FLD(WSS-IFLD).
       FIN-BUS-GLS-CVTI.
           EXIT.

      *>>>> EOF_PQ
*% END
*% IF EOF_PU
      *<<<< EOF_PU

       DEL-TPDS SECTION.
       INI-DEL-TPDS.
           PERFORM KEYS-TPD.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-TPD.
           IF FIO-STAT-OKS
              MOVE FIO-END-BRW TO FIO-CMND
              PERFORM DAP-FIO-TPD.

           IF NOT ( FIO-STAT-OKS AND
              TPD-COD-VCAM IN TPD-FLD = TPD-COD-VCAM IN TPD AND
              TPD-COD-TOPD IN TPD-FLD = TPD-COD-TOPD IN TPD AND
              TPD-COD-AOPD IN TPD-FLD = TPD-COD-AOPD IN TPD )
              MOVE '00' TO FIO-STAT
              GO TO FIN-DEL-TPDS.

           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM DAP-FIO-TPD.
           IF NOT FIO-STAT-OKS
              GO TO FIN-DEL-TPDS.

           MOVE FIO-DEL TO FIO-CMND.
           PERFORM DAP-FIO-TPD.
           IF NOT FIO-STAT-OKS
               MOVE 'DAP'        TO MSG-COD-SIST
               MOVE 'TPD    DEL' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               GO TO FIN-DEL-TPDS.

           GO TO INI-DEL-TPDS.
       FIN-DEL-TPDS.
           EXIT.

       PUT-BDD-TPD SECTION.
       INI-PUT-BDD-TPD.

           IF FRM-COD-BCTI IN TPD-FLD(WSS-IFLD) NOT > SPACES
               ADD 1 TO WSS-IMAX GIVING WSS-IFLD
               GO TO FIN-PUT-BDD-TPD.

           MOVE WSS-IFLD TO
                TPD-NUM-ITPD IN TPD.

           MOVE FRM-COD-BCTI IN TPD-FLD(WSS-IFLD) TO
                TPD-COD-BCTI IN TPD.

           MOVE FRM-COD-PBTI IN TPD-FLD(WSS-IFLD) TO
                TPD-COD-PBTI IN TPD.

           MOVE FRM-COD-BPBT IN TPD-FLD(WSS-IFLD) TO
                TPD-COD-BPBT IN TPD.

           MOVE FRM-COD-SPBT IN TPD-FLD(WSS-IFLD) TO
                TPD-COD-SPBT IN TPD.

           MOVE FRM-COD-CVTI IN TPD-FLD(WSS-IFLD) TO
                TPD-COD-CVTI IN TPD.

           MOVE FRM-COD-TFPR IN TPD-FLD(WSS-IFLD) TO
                TPD-COD-TFPR IN TPD.

           MOVE FRM-NUM-PREP IN TPD-FLD(WSS-IFLD) TO
                TPD-NUM-PREP IN TPD.

           MOVE FRM-IND-PREP IN TPD-FLD(WSS-IFLD) TO
                TPD-IND-PREP IN TPD.

           MOVE FRM-NUM-SMNV IN TPD-FLD(WSS-IFLD) TO
                TPD-NUM-SMNV IN TPD.

           MOVE FRM-IND-SMNV IN TPD-FLD(WSS-IFLD) TO
                TPD-IND-SMNV IN TPD.

           MOVE FRM-NUM-SMXV IN TPD-FLD(WSS-IFLD) TO
                TPD-NUM-SMXV IN TPD.

           MOVE FRM-IND-SMXV IN TPD-FLD(WSS-IFLD) TO
                TPD-IND-SMXV IN TPD.

           MOVE FRM-IND-OBGT IN TPD-FLD(WSS-IFLD) TO
                TPD-IND-OBGT IN TPD.

           MOVE FRM-COD-ITIF IN TPD-FLD(WSS-IFLD) TO
                TPD-COD-ITIF IN TPD.

           MOVE FRM-COD-ITIK IN TPD-FLD(WSS-IFLD) TO
                TPD-COD-ITIK IN TPD.

           MOVE FRM-COD-ITIC IN TPD-FLD(WSS-IFLD) TO
                TPD-COD-ITIC IN TPD.

           MOVE 'I' TO TPD-COD-STAT IN TPD.

           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-TPD.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               ADD 1 TO WSS-IMAX GIVING WSS-IFLD.
       FIN-PUT-BDD-TPD.
           EXIT.

      *>>>> EOF_PU
*% END
*% IF EOF
      *<<<< EOF
      *Entidades de DAP
       COPY GNSBGCPT.
       COPY GNSBGSTR.
       COPY GNSBGHOY.
       COPY SGCBFDBC.
       COPY DAPBFPOD.
       COPY GNSBPFEC.
       COPY GNSBGFEC.

       KEYS-TPD SECTION.
       INI-KEYS-TPD.
           IF DBC-NUM-ICLI IN TPD-FLD NOT > ZEROES
               MOVE 'ITPD'              TO TPD-CIC-ICLI IN TPD
           ELSE
              IF WSS-LEE-CLI = 'S'
                  PERFORM LEE-CLI
                  MOVE DBC-CIC-ICLI IN DBC  TO TPD-CIC-ICLI IN TPD
              ELSE
                  MOVE DBC-CIC-ICLI IN DBC  TO TPD-CIC-ICLI IN TPD.

           MOVE TPD-NUM-INEG IN TPD-FLD TO TPD-NUM-INEG IN TPD.
           MOVE TPD-COD-VCAM IN TPD-FLD TO TPD-COD-VCAM IN TPD.
           MOVE TPD-COD-TOPD IN TPD-FLD TO TPD-COD-TOPD IN TPD.
           MOVE TPD-COD-AOPD IN TPD-FLD TO TPD-COD-AOPD IN TPD.
           MOVE ZEROES                  TO TPD-NUM-IPOD IN TPD.
           MOVE ZEROES                  TO TPD-NUM-ITPD IN TPD.
       FIN-KEYS-TPD.
           EXIT.

       LEE-CLI SECTION.
       INI-LEE-CLI.
           IF DBC-NUM-ICLI IN TPD-FLD NOT > ZEROES
               GO TO FIN-LEE-CLI.

           MOVE DBC-NUM-ICLI IN TPD-FLD TO DBC-NUM-ICLI IN DBC.
           MOVE DBC-IND-ICLI IN TPD-FLD TO DBC-IND-ICLI IN DBC.
           MOVE DBC-GLS-ICLI IN TPD-FLD TO DBC-GLS-ICLI IN DBC.
           MOVE 'DBC-IDC-ICLI'  TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
           IF FIO-STAT-OKS
               MOVE 'N' TO WSS-LEE-CLI
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC
           ELSE 
               MOVE 'CLI    NEX' TO MSG-COD-MENS
               MOVE SPACES       TO DBC-GLS-NOMC IN TPD-FLD.
       FIN-LEE-CLI.
           EXIT.

       PUT-FTRN SECTION.
       INI-PUT-FTRN.
           MOVE HOY-DHOY TO TPD-NUM-DTRN IN TPD.
           MOVE HOY-MHOY TO TPD-NUM-MTRN IN TPD.
           MOVE HOY-SHOY TO TPD-NUM-STRN IN TPD.
           MOVE HOY-AHOY TO TPD-NUM-ATRN IN TPD.
           MOVE HOY-HHOY TO TPD-HRA-HRTR IN TPD.
       FIN-PUT-FTRN.
           EXIT.

       BCK-OUT SECTION.
       INI-BCK-OUT.
           MOVE 'DAP' TO FIO-SIST.
           MOVE FIO-BCK-OUT TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
      *        Para informar que el backout se realizo con exito
               MOVE '49' TO FIO-STAT.
       FIN-BCK-OUT.
           EXIT.
      *>>>>
*% END
