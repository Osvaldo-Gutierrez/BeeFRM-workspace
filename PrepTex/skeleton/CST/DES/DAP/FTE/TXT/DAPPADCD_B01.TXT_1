*%! Codigo adicional para DAPPADCD
*% IF SETTAG
*% FNCPQ = "DAPNVA"
*% VSNPQ = "07.11.22"
*% FNCPU = "DAPNVA"
*% VSNPU = "07.11.22"
*% END
*% NO_HDR_CST = TRUE
*% PGM_PTC = TRUE
*% INCLUDE 'GNSSRC:MANEJO_VSI.SRC'
*% IF WSS
      *<<<< WSS
      *Entidades de DAP
       COPY DAPBROPD.
      *>>>> WSS
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
      *Entidades de DAP
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPD-REQA==.
      *>>>>
*% END
*% IF FND_KEY
      *<<<< FND_KEY
           IF DCD-CAI-IOPD IN DCD-FLD > SPACES OR
              DCD-IIC-IOPD IN DCD-FLD > ZEROES
               PERFORM GET-FRM-OPD
           ELSE
           IF OPD-CAI-ISER IN DCD-FLD > SPACES OR
              OPD-IIC-ISER IN DCD-FLD > ZEROES
               PERFORM GET-SER-OPD
           ELSE
               PERFORM GET-DCD-OPD.

           IF NOT PGM-STAT-OPD-OKS
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'OPD    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00' TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
      *LRH fin 8-sep-1994
      *>>>>
*% END
*% IF FIN_SCR_TRL
      *<<<< FIN_SCR_TRL

           IF SCR-CMND = 'DDE'
           IF OPD-COD-STAT IN OPD NOT = 'I'
      *        opd no activada
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'OPDDDENOI' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE SCR-STAT-CON TO SCR-STAT.

           IF SCR-CMND = 'DDE'
               MOVE 'DAP' TO TAB-COD-SIST
               MOVE 'DOE' TO TAB-CIC-TTAB
               MOVE 'D'   TO TAB-CIC-CTAB
               MOVE 'TAB-CIC-TABL' TO FIO-AKEY
               PERFORM BUS-TAB
               IF MSG-COD-MENS > SPACES
                   MOVE 'DOED   NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   MOVE SCR-STAT-CON TO SCR-STAT
               ELSE
                   MOVE TAB-COD-CTAB IN TAB TO 
                        DCD-COD-DOEF IN DCD-FLD.

      *>>>>
*% END
*% IF FIN_HBL_FLD
      *<<<< FIN_HBL_FLD

           IF SCR-CMND = 'DDE'
               MOVE FRM-CPIM-AEY TO
                  DCD-COD-A57B-ATR
               MOVE FRM-CPIM-AEY TO
                  DCD-COD-DOEF-ATR.

           IF SCR-CMND = 'A57'
               MOVE FRM-CPIM-AEY TO
                  DCD-COD-DOEF-ATR.

      *>>>> FIN_HBL_FLD
*% END
*% IF EOF
      *<<<< EOF
      *Entidades de DAP

       COPY DAPBFOPD.


       GET-FRM-OPD SECTION.
       INI-GET-FRM-OPD.
           MOVE DCD-CAI-IOPD IN DCD-FLD TO OPD-CAI-IOPD IN OPD.
           MOVE DCD-IIC-IOPD IN DCD-FLD TO OPD-IIC-IOPD IN OPD.
           PERFORM GET-OPD.
       FIN-GET-FRM-OPD.
           EXIT.

       GET-SER-OPD SECTION.
       INI-GET-SER-OPD.
           MOVE OPD-CAI-ISER IN DCD-FLD TO OPD-CAI-ISER IN OPD.
           MOVE OPD-IIC-ISER IN DCD-FLD TO OPD-IIC-ISER IN OPD.
           MOVE 'OPD-CIC-ISER' TO FIO-AKEY.
           PERFORM GET-OPD.
           IF PGM-STAT-OPD-OKS
               MOVE OPD-CAI-IOPD IN OPD TO
                    DCD-CAI-IOPD IN DCD-FLD
               MOVE OPD-IIC-IOPD IN OPD TO
                    DCD-IIC-IOPD IN DCD-FLD
               MOVE OPD-CIC-IOPD IN OPD TO
                    DCD-CIC-IOPD IN DCD.
       FIN-GET-SER-OPD.
           EXIT.

       GET-DCD-OPD SECTION.
       INI-GET-DCD-OPD.
           MOVE 'DCD-KEY-NOVA' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-DCD.
           IF FIO-STAT-OKS
               MOVE DCD-CIC-IOPD IN DCD TO OPD-CIC-IOPD IN OPD.
           PERFORM GET-OPD.
           IF PGM-STAT-OPD-OKS
               MOVE OPD-CAI-IOPD IN OPD TO
                    DCD-CAI-IOPD IN DCD-FLD
               MOVE OPD-IIC-IOPD IN OPD TO
                    DCD-IIC-IOPD IN DCD-FLD
               MOVE OPD-CIC-IOPD IN OPD TO
                    DCD-CIC-IOPD IN DCD.
       FIN-GET-DCD-OPD.
           EXIT.

       GET-OPD SECTION.
       INI-GET-OPD.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-OPD.
           MOVE FIO-STAT TO PGM-STAT-OPD.
       FIN-GET-OPD.
           EXIT.


      * GET-SER-OPD SECTION.
      * INI-GET-SER-OPD.
      ** ISP: FND-KEY YA PUSO LAS LLAVES DEL SERIAL EN OPD
      *     MOVE FIO-GET-NLS TO FIO-CMND.
      * CIC-GET-SER-OPD.
      *     MOVE 'OPD-CIC-ISER' TO FIO-AKEY.
      *     PERFORM DAP-FIO-OPD.
      *     MOVE '23' TO PGM-STAT-OPD.
      *     IF FIO-STAT-OKS
      *         IF OPD-CAI-ISER IN DCD-FLD =
      *            OPD-CAI-ISER IN OPD        AND
      *            OPD-IIC-ISER IN DCD-FLD =
      *            OPD-IIC-ISER IN OPD
      *              IF OPD-COD-STAT IN OPD = 'G'
      *                  MOVE '00' TO PGM-STAT-OPD
      *                  MOVE OPD-CAI-IOPD IN OPD TO
      *                       DCD-CAI-IOPD IN DCD-FLD
      *                  MOVE DCD-CAI-IOPD IN DCD-FLD TO
      *                       DCD-CAI-IOPD IN DCD
      *                  MOVE OPD-IIC-IOPD IN OPD TO
      *                       DCD-IIC-IOPD IN DCD-FLD
      *                  MOVE DCD-IIC-IOPD IN DCD-FLD TO
      *                       DCD-IIC-IOPD IN DCD
      *              ELSE
      *                  MOVE FIO-GET-NXT TO FIO-CMND
      *                  GO TO CIC-GET-SER-OPD.
      * FIN-GET-SER-OPD.
      *     EXIT.

      *>>>> EOF
*% END
