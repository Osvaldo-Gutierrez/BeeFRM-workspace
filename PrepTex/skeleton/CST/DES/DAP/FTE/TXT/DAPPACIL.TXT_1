*%! Codigo adicional para DAPPACIL
*% GEN_MFC = TRUE
*% IF PGM_PQ
*% CLRMFC = "DAPZQCIL"
*% ELSE
*% CLRMFC = "DAPZUCIL"
*% END
*% IF SETTAG
*% FNCPQ = "081102"
*% VSNPQ = "09.01.14"
*% FNCPU = "081102"
*% VSNPU = "09.01.14"
*% END
*% NO_TIENE_TIMESTAMP = TRUE
*% NO_HDR_CST = TRUE
*% PGM_PTC = TRUE
*% INCLUDE 'GNSSRC:MANEJO_VSI.SRC'
*% IF WSS
      *<<<< WSS
       COPY SGCBRDBC.
       COPY DAPBRRCC.
       COPY DAPBRDCL.
       COPY DAPBROPD.
       COPY DAPBRVEN.
       COPY GNSWGCPT.
       COPY GNSWGSTR.
       COPY TABBROFI.

       01  WSS-FEC-FDMA.
           03 WSS-NUM-DDMA                  PIC X(02).
           03 WSS-COD-DMA1                  PIC X(01).
           03 WSS-NUM-MDMA                  PIC X(02).
           03 WSS-COD-DMA2                  PIC X(01).
           03 WSS-NUM-SDMA                  PIC X(02).
           03 WSS-NUM-ADMA                  PIC X(02).
           
       01  WSS-KEY-ILIQ.
           03 WSS-CAI-ILIQ                  PIC X(04).
           03 WSS-IIC-ILIQ                  PIC X(08).
           03 WSS-NUM-ILIQ                  PIC X(03).

       77  WSS-IND-MCLI   VALUE 'N' PIC X(01).
       77  WSS-IDX-I VALUE ZEROES PIC 9(03).

       77  WSS-CIL-NUM-CORR VALUE ZEROES PIC 9(05).
       77  WSS-AKEY  VALUE 'KEY-NUL'        PIC X(32).
       77  WSS-OFIO  VALUE SPACES           PIC X(03).
       77  WSS-FST-LEC VALUE 'N'            PIC X(01).
      *>>>> WSS
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DCL-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OPD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
      *>>>> WSS_DTC
*% END
*% IF FIN_PGM_STAT
      *<<<< FIN_PGM_STAT
              05 PGM-STAT-DCL.
                 88 PGM-STAT-DCL-NUL    VALUE '  '.
                 07 PGM-STT1-DCL        VALUE '2' PIC X(01).
                    88 PGM-STAT-DCL-OKS VALUE '0'.
                 07 PGM-STT2-DCL        VALUE '3' PIC X(01).
              05 PGM-STAT-RCC.
                 88 PGM-STAT-RCC-NUL    VALUE '  '.
                 07 PGM-STT1-RCC        VALUE '2' PIC X(01).
                    88 PGM-STAT-RCC-OKS VALUE '0'.
                 07 PGM-STT2-RCC        VALUE '3' PIC X(01).
      *<<<< FIN_PGM_STAT
*% END
*% IF INI_FIO
      *<<<< INI_FIO
      *     IF SCR-OFRM-SRV
      *          MOVE TSK-TERM-ALF    TO VX2-COD-TERM
      *     ELSE
      *          MOVE EIBTRMID        TO VX2-COD-TERM.

      *>>>> INI_FIO
*% END
*% IF SCR_GKEY_VAL_IKY OR SCR_GIKY_VAL_IKY OR FIN_GET_CON OR SCR_GFLD_VAL_MKY OR FIN_GET_ACC OR FIN_GET_CON OR FIN_SCR_GCNF
*% END
*% IF INI_SCR_DMSG
*% IF PGM_PQ
      *<<<< INI_SCR_DMSG
           IF SCR-CMND = 'CON' AND
              SCR-INST = SCR-INST-GKY
                  MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR.
      *>>>> INI_SCR_DMSG
*% END
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY

           IF NOT FIO-STAT-OKS
               GO TO FIN-FND-KEY.

           MOVE LIQ-KEY-ILIQ IN LIQ TO WSS-KEY-ILIQ.

           MOVE LIQ-CIC-IOPD IN LIQ TO OPD-CIC-IOPD IN OPD.
           PERFORM GET-CUR-RCC.
           IF NOT FIO-STAT-OKS
      *        OPD no tiene cliente asociado
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'OPD    NORCC' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
      
           MOVE RCC-CIC-ICLI IN RCC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-STAT TO PGM-STAT-DBC.
           IF NOT FIO-STAT-OKS
      *        cliente inexistente
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'CLI    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE '00'         TO FIO-STAT
               MOVE SCR-STAT-CON TO SCR-STAT
               GO TO FIN-FND-KEY.
      
           PERFORM GET-NXT-RCC.

           PERFORM ZER-FLD-CIL.

           MOVE 1 TO FRM-IFLD.

           MOVE LIQ-CIC-IOPD IN LIQ TO OPD-CIC-IOPD IN OPD.
           PERFORM DAP-FIO-OPD.
           MOVE FIO-STAT TO PGM-STAT-OPD.

           MOVE LIQ-CIC-IOPD IN LIQ TO VEN-CIC-IOPD IN VEN.
           MOVE '001' TO VEN-NUM-IVEN.
           PERFORM DAP-FIO-VEN.
           MOVE FIO-STAT TO PGM-STAT-VEN.

           MOVE LIQ-KEY-ILIQ IN LIQ TO DCL-KEY-ILIQ IN DCL.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-DCL.
           MOVE FIO-STAT TO PGM-STAT-DCL.

           PERFORM SET-FLD-CIL.

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-LIQ.
           IF NOT ( FIO-STAT-OKS AND
                    LIQ-CAI-IOPD IN LIQ = LIQ-CAI-IOPD IN CIL-FLD AND
                    LIQ-IIC-IOPD IN LIQ = LIQ-IIC-IOPD IN CIL-FLD )

                 MOVE WSS-KEY-ILIQ TO LIQ-KEY-ILIQ IN LIQ
                 MOVE FIO-GET-KEY TO FIO-CMND
                 PERFORM DAP-FIO-LIQ

                 MOVE '00' TO FIO-STAT
                 GO TO FIN-FND-KEY.

           MOVE 2 TO FRM-IFLD.

           MOVE LIQ-KEY-ILIQ IN LIQ TO DCL-KEY-ILIQ IN DCL.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-DCL.
           MOVE FIO-STAT TO PGM-STAT-DCL.

           PERFORM SET-FLD-CIL.

      *>>>> FND_KEY
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      *>>>> FIN_FND_KEY
*% END
*% IF FIN_PUT_SCR
      *<<<< FIN_PUT_SCR

            
            

       END-PUT-SCR.

      *>>>> FIN_PUT_SCR
*% END
*% IF FIO
      *<<<< FIO
      *>>>> FIO
*% END
*% IF EOF
      *<<<< EOF

       GET-CUR-RCC SECTION.
       INI-GET-CUR-RCC.
           MOVE OPD-CIC-IOPD IN OPD TO RCC-CIC-IOPD IN RCC.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT ( FIO-STAT-OKS AND
                    OPD-CIC-IOPD IN OPD = RCC-CIC-IOPD IN RCC)
              MOVE '23' TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-RCC.
       FIN-GET-CUR-RCC.
           EXIT.
      
       GET-NXT-RCC SECTION.
       INI-GET-NXT-RCC.
           MOVE SPACES TO MSG-COD-SIST.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF FIO-STAT-OKS AND
              OPD-CIC-IOPD IN OPD = RCC-CIC-IOPD IN RCC
                MOVE 'M' TO WSS-IND-MCLI
                MOVE 'DAP'          TO MSG-COD-SIST
                MOVE 'OPD    MCLI' TO MSG-COD-MENS
                PERFORM GET-MSG
           ELSE
                MOVE SPACES TO WSS-IND-MCLI
                PERFORM GET-CUR-RCC.
       FIN-GET-NXT-RCC.
           EXIT.

       ZER-FLD-CIL SECTION.
       INI-ZER-FLD-CIL.
      * FEC-INI --> BMCHIBCI003.SRCAIU CLR ( KEY Y FLD )


           MOVE SPACES TO  FRM-COD-FREA  IN CIL-FLD(1).
           MOVE SPACES TO  FRM-COD-FREA  IN CIL-FLD(2).

           MOVE SPACES TO  FRM-COD-LIQU  IN CIL-FLD(1).
           MOVE SPACES TO  FRM-COD-LIQU  IN CIL-FLD(2).

           MOVE SPACES TO  FRM-COD-STAT  IN CIL-FLD(1).
           MOVE SPACES TO  FRM-COD-STAT  IN CIL-FLD(2).

           MOVE ZEROES TO  FRM-SGV-TLVP  IN CIL-FLD(1).
           MOVE ZEROES TO  FRM-SGV-TLVP  IN CIL-FLD(2).

           MOVE SPACES TO  FRM-COD-OFIC  IN CIL-FLD(1).
           MOVE SPACES TO  FRM-COD-OFIC  IN CIL-FLD(2).

           MOVE SPACES TO  FRM-COD-EJEC  IN CIL-FLD(1).
           MOVE SPACES TO  FRM-COD-EJEC  IN CIL-FLD(2).

           MOVE ZEROES TO  FRM-SGV-RESC  IN CIL-FLD(1).
           MOVE ZEROES TO  FRM-SGV-RESC  IN CIL-FLD(2).

           MOVE ZEROES TO  FRM-SGV-CAPI  IN CIL-FLD(1).
           MOVE ZEROES TO  FRM-SGV-CAPI  IN CIL-FLD(2).

           MOVE ZEROES TO  FRM-SGV-INTE  IN CIL-FLD(1).
           MOVE ZEROES TO  FRM-SGV-INTE  IN CIL-FLD(2).

           MOVE ZEROES TO  FRM-SGV-TPAG  IN CIL-FLD(1).
           MOVE ZEROES TO  FRM-SGV-TPAG  IN CIL-FLD(2).

           MOVE ZEROES TO  FRM-SGV-PESO  IN CIL-FLD(1).
           MOVE ZEROES TO  FRM-SGV-PESO  IN CIL-FLD(2).

           MOVE ZEROES TO  FRM-SGV-IPAG  IN CIL-FLD(1).
           MOVE ZEROES TO  FRM-SGV-IPAG  IN CIL-FLD(2).

           MOVE ZEROES TO  FRM-SGV-INTD  IN CIL-FLD(1).
           MOVE ZEROES TO  FRM-SGV-INTD  IN CIL-FLD(2).

           MOVE ZEROES TO  FRM-SGV-PEGA  IN CIL-FLD(1).
           MOVE ZEROES TO  FRM-SGV-PEGA  IN CIL-FLD(2).
       FIN-ZER-FLD-CIL.
           EXIT.

       SET-FLD-CIL SECTION.
       INI-SET-FLD-CIL.

           MOVE LIQ-NUM-ILIQ IN LIQ
             TO FRM-NUM-ILIQ IN CIL-FLD(FRM-IFLD).

           MOVE LIQ-NUM-DREA IN LIQ
             TO WSS-NUM-DDMA.
           MOVE '/'
             TO WSS-COD-DMA1.
           MOVE LIQ-NUM-MREA IN LIQ
             TO WSS-NUM-MDMA.
           MOVE '/'
             TO WSS-COD-DMA2.
           MOVE LIQ-NUM-SREA IN LIQ
             TO WSS-NUM-SDMA.
           MOVE LIQ-NUM-AREA IN LIQ
             TO WSS-NUM-ADMA.
           MOVE WSS-FEC-FDMA
             TO FRM-COD-FREA IN CIL-FLD(FRM-IFLD).

           MOVE LIQ-COD-LIQU IN LIQ
             TO FRM-COD-LIQU IN CIL-FLD(FRM-IFLD).

           MOVE LIQ-COD-STAT IN LIQ
             TO FRM-COD-STAT IN CIL-FLD(FRM-IFLD).

           MOVE LIQ-SGV-TLVP IN LIQ
             TO FRM-SGV-TLVP IN CIL-FLD(FRM-IFLD).

           MOVE LIQ-COD-OFIC IN LIQ
             TO FRM-COD-OFIC IN CIL-FLD(FRM-IFLD).

           MOVE LIQ-COD-EJEC IN LIQ
             TO FRM-COD-EJEC IN CIL-FLD(FRM-IFLD).

           IF PGM-STAT-DCL-OKS
               MOVE DCL-SGV-RESC IN DCL
             TO FRM-SGV-RESC IN CIL-FLD(FRM-IFLD).

           MOVE LIQ-SGV-CAPI IN LIQ
             TO FRM-SGV-CAPI IN CIL-FLD(FRM-IFLD).

           IF PGM-STAT-DCL-OKS
           COMPUTE FRM-SGV-INTE IN CIL-FLD(FRM-IFLD) =
                   DCL-SGV-RESC IN DCL - LIQ-SGV-CAPI IN LIQ.

           MOVE LIQ-SGV-TPAG IN LIQ
             TO FRM-SGV-TPAG IN CIL-FLD(FRM-IFLD).

           MOVE LIQ-SGV-PESO IN LIQ
             TO FRM-SGV-PESO IN CIL-FLD(FRM-IFLD).

           COMPUTE FRM-SGV-IPAG IN CIL-FLD(FRM-IFLD) =
                   LIQ-SGV-TPAG IN LIQ - LIQ-SGV-CAPI IN LIQ.

           IF PGM-STAT-DCL-OKS
               MOVE DCL-SGV-INTD IN DCL
                 TO FRM-SGV-INTD IN CIL-FLD(FRM-IFLD).

           IF PGM-STAT-DCL-OKS
               MOVE DCL-SGV-PEGA IN DCL
                 TO FRM-SGV-PEGA IN CIL-FLD(FRM-IFLD).

       FIN-SET-FLD-CIL.
           EXIT.
      *>>>> EOF
*% END
*% IF EOF_PQ
      *<<<< EOF_PQ
       COPY GNSBGCPT.
       COPY GNSBGSTR.
       COPY TABBBOFI.
       COPY SGCBFDBC.
       COPY DAPBFRCC.
       COPY DAPBFDCL.
       COPY DAPBFOPD.
       COPY DAPBFVEN.
       COPY TABBVOFI.
       COPY TABBFOFI.

       GNX-PRO-QUE SECTION.
       INI-GNX-PRO-QUE.
           PERFORM GNS-PRO-QUE.
       FIN-GNX-PRO-QUE.
           EXIT.

      *>>>> EOF_PQ
*% END
*% IF CMN_MOD
      *<<<< CMN_MOD
      *>>>> CMN_MOD
*% END
