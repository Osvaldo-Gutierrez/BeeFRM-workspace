*%! codigo adicional DAPBMVD3
*% IF SETTAG
*% FNCBQ = "080804"
*% VSNBQ = "08.11.24"
*% FNCBU = "080804"
*% VSNBU = "08.11.24"
*% END
*% IF INI_PUT_DBC_VD3
      *<<<< INI_PUT_DBC_VD3
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN            TO DBC-GLS-NOMC IN DBC.
      *>>>> INI_PUT_DBC_VD3
*% END
*% IF DBC_VRF_ICLI
      *<<<< DBC_VRF_ICLI
           IF FRM-SUAR = FRM-SUAR-MAL
                 GO TO FIN-VAL-DBC-VRF-ICLI.   
           IF DBC-NUM-ICLI IN VD3-FLD > ZEROES
      *IDC-CLI Busca Cliente por medio de IdC
               MOVE DBC-NUM-ICLI IN VD3-FLD TO DBC-NUM-ICLI IN DBC
               MOVE DBC-IND-ICLI IN VD3-FLD TO DBC-IND-ICLI IN DBC
               MOVE DBC-GLS-ICLI IN VD3-FLD TO DBC-GLS-ICLI IN DBC
               MOVE 'DBC-IDC-ICLI' TO FIO-AKEY
               MOVE FIO-GET-KEY    TO FIO-CMND
               PERFORM SGC-FIO-DBC
               MOVE FIO-STAT         TO PGM-STAT-DBC
               IF NOT FIO-STAT-OKS
                   MOVE 'DAP'        TO MSG-COD-SIST
                   MOVE 'CLIVD3 NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC IN MSG TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
               ELSE
                   MOVE SPACES TO MSG-COD-MENS
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN            TO DBC-GLS-NOMC IN DBC.

           IF FRM-SUAR NOT = FRM-SUAR-MAL
           IF DBC-NUM-ICLI IN VD3-FLD > ZEROES
               MOVE VX2-TSVD2 TO QUE-COLA
               MOVE VX2-LEN-TSVX2  TO QUE-LITM
               MOVE 1 TO QUE-NITM
               MOVE QUE-GET TO QUE-CMND
               PERFORM GNS-PRO-QUE
               IF QUE-STAT = QUE-STAT-OKS
                   MOVE QUE-ITEM TO VX2-MTI-VARI
                     IF NOT 
                       (
                        DBC-NUM-ICLI IN VD3-FLD = VX2-MTI-NUM-ICLI AND
                        DBC-IND-ICLI IN VD3-FLD = VX2-MTI-IND-ICLI AND
                        DBC-GLS-ICLI IN VD3-FLD = VX2-MTI-GLS-ICLI
                       )
                           MOVE 'DAP'        TO MSG-COD-SIST
                           MOVE 'CLIVD3 NEX' TO MSG-COD-MENS
                           PERFORM GET-MSG
                           MOVE MSG-GLS-DESC IN MSG TO FRM-MENS
                           MOVE FRM-SUAR-MAL TO FRM-SUAR.

           IF FRM-SUAR = FRM-SUAR-MAL
                 GO TO FIN-VAL-DBC-VRF-ICLI.   

*% END
*% IF DBC_GLS_ICLI
      *<<<< DBC_GLS_ICLI
           IF DBC-NUM-ICLI IN VD3-FLD NOT > ZEROES
           IF DBC-GLS-NOMC IN VD3-FLD > SPACES
      *NOM-CLI Busca Cliente por medio del Nombre
               MOVE DBC-GLS-NOMC IN VD3-FLD TO STR-GLS-GSTR
               PERFORM STR-UNS
               MOVE STR-GLS-FUNS IN STR-VARI(1) TO DBC-GLS-APAT IN DBC
               MOVE STR-GLS-FUNS IN STR-VARI(2) TO DBC-GLS-AMAT IN DBC
               MOVE STR-GLS-FUNS IN STR-VARI(3) TO DBC-GLS-NOMB IN DBC
               MOVE 'DBC-GLS-NOMC' TO FIO-AKEY
               MOVE FIO-GET-NLS    TO FIO-CMND
               PERFORM SGC-FIO-DBC
               IF NOT FIO-STAT-OKS
                   MOVE 'DAP'        TO MSG-COD-SIST
                   MOVE 'CLIVD3 NEX' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC IN MSG TO FRM-MENS
                   MOVE ZEROES       TO DBC-NUM-ICLI IN VD3-FLD
                   MOVE SPACES       TO DBC-VRF-ICLI IN VD3-FLD
                   MOVE SPACES       TO DBC-IND-ICLI IN VD3-FLD
                   MOVE SPACES       TO DBC-GLS-ICLI IN VD3-FLD
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
               ELSE
                   MOVE DBC-NUM-ICLI IN DBC TO DBC-NUM-ICLI IN VD3-FLD
                   MOVE DBC-VRF-ICLI IN DBC TO DBC-VRF-ICLI IN VD3-FLD
                   MOVE DBC-IND-ICLI IN DBC TO DBC-IND-ICLI IN VD3-FLD
                   MOVE DBC-GLS-ICLI IN DBC TO DBC-GLS-ICLI IN VD3-FLD

                   MOVE SPACES TO MSG-COD-MENS
                   MOVE '00'         TO PGM-STAT-DBC
                   MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
                   PERFORM CPT-BLKS
                   MOVE CPT-STRN            TO DBC-GLS-NOMC IN DBC.

           IF FRM-SUAR = FRM-SUAR-MAL
                 GO TO FIN-VAL-DBC-GLS-ICLI.   

*% END
*% IF FRM_COD_SGAN
      *<<<< FRM_COD_SGAN

           IF FRM-COD-SGAN IN VD3-FLD NOT > SPACES AND
              FRM-NUM-NINI IN VD3-FLD = ZEROES
                MOVE '+' TO FRM-COD-SGAN IN VD3-FLD.

           IF NOT (
                FRM-COD-SGAN IN VD3-FLD = ' ' OR
                FRM-COD-SGAN IN VD3-FLD = '-' OR
                FRM-COD-SGAN IN VD3-FLD = '+' )
                   MOVE 'DAP'        TO MSG-COD-SIST
                   MOVE 'SGANINV'    TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC IN MSG TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-FRM-COD-SGAN.

      *     IF FRM-NUM-NINI IN VD3-FLD = ZEROES
      *          MOVE 1 TO FRM-NUM-NINI IN VD3-FLD.

           IF FRM-COD-SGAN IN VD3-FLD = '-' AND
              FRM-NUM-NINI IN VD3-FLD = 1
                   MOVE 'DAP'    TO MSG-COD-SIST
                   MOVE 'NIN1-'  TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC IN MSG TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-FRM-COD-SGAN.

           IF FRM-COD-SGAN IN VD3-FLD = '-'
                SUBTRACT 1 FROM FRM-NUM-NINI IN VD3-FLD
           ELSE
                ADD 1 TO FRM-NUM-NINI IN VD3-FLD.

            MOVE VX2-TSVD2 TO QUE-COLA.
            MOVE VX2-LEN-TSVX2  TO QUE-LITM.
            MOVE FRM-NUM-NINI IN VD3-FLD TO QUE-NITM.
            MOVE QUE-GET TO QUE-CMND.
            PERFORM GNS-PRO-QUE.
            IF QUE-STAT = QUE-STAT-OKS
                   MOVE QUE-ITEM TO VX2-MTI-VARI
            ELSE
                   MOVE 'DAP'        TO MSG-COD-SIST
                   MOVE 'SGANERR'    TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC IN MSG TO FRM-MENS
                   MOVE FRM-SUAR-MAL TO FRM-SUAR
                   GO TO FIN-VAL-FRM-COD-SGAN.
              
      *>>>> FRM_COD_SGAN
*% END
