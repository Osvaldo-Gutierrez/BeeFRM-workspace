*%! Codigo adicional para programa ODC
*% IF SETTAG
*% VSNPQ = "09.02.13"
*% FNCPQ = "090201"
*% VSNPU = "09.02.13"
*% FNCPU = "090201"
*% END
*% NO_HDR_CST = TRUE
*% PGM_PTC = TRUE
*%
*% IF PGM_PQ
*%  FRM = "ODC"
*%  PADRE = "OPD"
*%  KEY_PADRE = "OPD-KEY-IOPD"
*%  LARGO_KEY_PADRE = 12
*%  FIO_PADRE = "DAP-FIO-OPD"
*%  SIST_PADRE = "DAP"
*%  KEY_BROWSE_PADRE = "OPD-KEY-IOPD"
*%
*%  ACEPTE_PF7 = TRUE
*%  ACEPTE_PF8 = TRUE
*% INCLUDE 'GNSSRC:PFSCONENT.SRC'
*%
*%!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LAD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCC-REQA==.
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       COPY  DAPBRLAD.
       COPY  DAPBRRCC.
       01  WSS-VARI.
           03  WSS-FEC-FTRN                             PIC 9(08).
           03  WSS-FEC-FTRN-R REDEFINES WSS-FEC-FTRN.
               05 WSS-NUM-STRN                          PIC 9(02).
               05 WSS-NUM-ATRN                          PIC 9(02).
               05 WSS-NUM-MTRN                          PIC 9(02).
               05 WSS-NUM-DTRN                          PIC 9(02).
      *>>>>
*% END
*% IF FIN_PGM_STAT
      *<<<< FIN_PGM_STAT
              05 PGM-STAT-RCC.
                 88 PGM-STAT-RCC-NUL    VALUE '  '.
                 07 PGM-STT1-RCC        VALUE '2' PIC X(01).
                    88 PGM-STAT-RCC-OKS VALUE '0'.
                 07 PGM-STT2-RCC        VALUE '3' PIC X(01).
      *>>>> FIN_PGM_STAT
*% END
*% IF INI_FIO_IBM
      *<<<< INI_FIO
           PERFORM GET-FHOY.
      *>>>> INI_FIO
*% END
*% IF INI_SCR_PUTA
      *<<<< INI_SCR_PUTA
           IF SCR-CMND = 'CON'
                MOVE FRM-CPIM-UBY TO FRM-COD-FTMA-ATR IN ODC-FLD
                MOVE -1           TO FRM-COD-FTMA-LEN IN ODC-FLD.

      *>>>> INI_SCR_PUTA
*% END
*% IF FND_KEY
      *<<<< FND_KEY
      *>>>>
*% END
*% IF INI_SCR_DMSG
*% IF PGM_PQ
      *<<<< INI_SCR_DMSG
      *<<<< INI_SCR_DMSG                                                        
      *    MOVE 'SCRDMSG1' TO QUE-COLA.                                         
      *    MOVE SCR-CMND TO QUE-ITEM.                                           
      *    MOVE +100 TO QUE-LITM.                                               
      *    MOVE QUE-PUT TO QUE-CMND.                                            
      *    PERFORM GNS-PRO-QUE.                                                 
                                                                                
      *    MOVE 'SCRDMSG2' TO QUE-COLA.                                         
      *    MOVE SCR-INST TO QUE-ITEM.                                           
      *    MOVE +100 TO QUE-LITM.                                               
      *    MOVE QUE-PUT TO QUE-CMND.                                            
      *    PERFORM GNS-PRO-QUE.                                                 
                                                                                
      *    MOVE 'SCRDMSG3' TO QUE-COLA.                                         
      *    MOVE ODC-FLD TO QUE-ITEM.                                            
      *    MOVE +2000 TO QUE-LITM.                                              
      *    MOVE QUE-PUT TO QUE-CMND.                                            
      *    PERFORM GNS-PRO-QUE.                                                 
                                                                                
           IF FRM-FFLD NOT = FRM-FFLD-PF12
           IF SCR-CMND = 'CON' AND                                              
              SCR-INST = SCR-INST-GKY AND                                       
              FRM-COD-FTMA IN ODC-FLD = 'S'                                     
                                                                                
                 MOVE OPD-CAI-GREN IN ODC-FLD TO                                
                      OPD-CAI-IOPD IN ODC-FLD                                   
                 MOVE OPD-IIC-GREN IN ODC-FLD TO                                
                      OPD-IIC-IOPD IN ODC-FLD                                   
                 MOVE SPACES TO                                                 
                      OPD-CAI-ISER IN ODC-FLD                                   
                 MOVE ZEROES TO                                                 
                      OPD-IIC-ISER IN ODC-FLD                                   
                                                                                
                 MOVE PGM-LIMPIAR-CAMPOS TO PGM-ICLR                            
                 PERFORM CLR-FLD-ODC                                            
                 PERFORM EDT-FLD-ODC                                            
                 MOVE 'S' TO FRM-COD-FTMA IN ODC-FLD                            
                 PERFORM SCR-PUTA                                               
                 PERFORM SCR-EXIT.                                              
      *>>>> INI_SCR_DMSG
*% END
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      *>>>>
*% END
*% IF CMN_ING
      *<<<< CMN_ING
           MOVE SPACES TO OPD-GLS-FLAG IN OPD.
      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING LAD ODC XON-INI
            PERFORM PRO-ING-REG-LAD.
      *>>>> FIN_CMN_ING LAD ODC XON-FIN
*% END
*% IF FIN_CMN_ELI 
      *<<<< FIN_CMN_ELI LAD ODC XON-INI
            PERFORM PRO-ELI-REG-LAD.
      *>>>> FIN_CMN_ELI LAD ODC XON-FIN
*% END
*% IF CMN_MOD_RET
      *<<<< CMN_MOD_RET LAD ODC XON-INI
            PERFORM PRO-MOD-ANT-REG-LAD.
      *>>>> CMN_MOD_RET LAD ODC XON-FIN
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD LAD ODC XON-INI
            PERFORM PRO-MOD-DES-REG-LAD.
      *>>>> FIN_CMN_MOD LAD ODC XON-FIN
*% END
*% IF EOF
      *<<<< EOF
       COPY DAPBFLAD.
       COPY DAPBFRCC.
       GET-CUR-RCC SECTION.
       INI-GET-CUR-RCC.
           MOVE OPD-CIC-IOPD IN OPD TO RCC-CIC-IOPD IN RCC.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT (FIO-STAT-OKS AND
                  OPD-CIC-IOPD IN OPD = RCC-CIC-IOPD IN RCC)          
                  MOVE '23' TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-RCC.
       FIN-GET-CUR-RCC.
           EXIT.

       GET-NXT-RCC SECTION.
       INI-GET-NXT-RCC.
           MOVE SPACES TO MSG-COD-SIST.
           MOVE SPACES TO MSG-COD-MENS.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF NOT ( FIO-STAT-OKS AND
                     OPD-CIC-IOPD IN OPD = RCC-CIC-IOPD IN RCC  )
               MOVE '23' TO FIO-STAT.
           MOVE FIO-STAT TO PGM-STAT-RCC.
       FIN-GET-NXT-RCC.
           EXIT.
       
*% IF PGM_PU
       PRO-MOD-ANT-REG-LAD  SECTION.
       INI-MOD-ANT-REG-LAD.
      *-----------------------------
           MOVE   SPACES                  TO  LAD.
           MOVE   'MOD'                   TO  LAD-COD-EVEN IN LAD.
           MOVE   'M'                     TO  LAD-COD-TACC IN LAD
                                              LAD-COD-STAT IN LAD.
           MOVE   'ANT'                   TO  LAD-COD-INST IN LAD.
           MOVE     1                     TO  LAD-NUM-CLAD IN LAD
                                              LAD-NUM-COPD IN LAD
                                              LAD-NUM-CCLI IN LAD
                                              LAD-NUM-CAUT IN LAD.
           PERFORM PRO-GRABA-REG-LAD.
       FIN-MOD-ANT-REG-LAD.
            EXIT.
       
       PRO-MOD-DES-REG-LAD  SECTION.
       INI-MOD-DES-REG-LAD.
      *-----------------------------
           MOVE   SPACES                  TO  LAD.
           MOVE   'MOD'                   TO  LAD-COD-EVEN IN LAD.
           MOVE   'M'                     TO  LAD-COD-TACC IN LAD
                                              LAD-COD-STAT IN LAD.
           MOVE   'DES'                   TO  LAD-COD-INST IN LAD.
           MOVE     2                     TO  LAD-NUM-CLAD IN LAD
                                              LAD-NUM-COPD IN LAD
                                              LAD-NUM-CCLI IN LAD
                                              LAD-NUM-CAUT IN LAD.
           PERFORM PRO-GRABA-REG-LAD.
       FIN-MOD-DES-REG-LAD.
           EXIT.
      *
       PRO-ING-REG-LAD  SECTION.                                                
       INI-ING-REG-LAD.                                                         
      *-------------------------                                                
           MOVE   SPACES                  TO  LAD.                              
           MOVE   'ING'                   TO  LAD-COD-EVEN IN LAD.              
           MOVE   'I'                     TO  LAD-COD-TACC IN LAD               
                                              LAD-COD-STAT IN LAD.              
           MOVE   'N/A'                   TO  LAD-COD-INST IN LAD.              
                                                                                
           MOVE     1                     TO  LAD-NUM-CLAD IN LAD               
                                              LAD-NUM-COPD IN LAD               
                                              LAD-NUM-CCLI IN LAD               
                                              LAD-NUM-CAUT IN LAD.              
                                                                                
           PERFORM PRO-GRABA-REG-LAD.                                           
       FIN-ING-REG-LAD.                                                         
           EXIT.                                                                
      *                                                                         
       PRO-ELI-REG-LAD  SECTION.                                                
       INI-ELI-REG-LAD.                                                         
      *-------------------------                                                
           MOVE   SPACES                  TO  LAD.                              
           MOVE   'ELI'                   TO  LAD-COD-EVEN IN LAD.              
           MOVE   'E'                     TO  LAD-COD-TACC IN LAD               
                                              LAD-COD-STAT IN LAD.              
           MOVE   'N/A'                   TO  LAD-COD-INST IN LAD.              
                                                                                
           MOVE     1                     TO  LAD-NUM-CLAD IN LAD               
                                              LAD-NUM-COPD IN LAD               
                                              LAD-NUM-CCLI IN LAD               
                                              LAD-NUM-CAUT IN LAD.              
           PERFORM PRO-GRABA-REG-LAD.                                           
       FIN-ELI-REG-LAD.                                                         
           EXIT.       
      *
       PRO-GRABA-REG-LAD  SECTION.
      *---------------------------
       INI-GRABA-REG-LAD.
           MOVE   '1.0'                   TO  LAD-COD-VERS IN LAD.
           MOVE   'OPD'                   TO  LAD-COD-ENTF IN LAD
                                              LAD-COD-ENTO IN LAD
                                              LAD-COD-ENTC IN LAD
                                              LAD-COD-ENTA IN LAD
                                              LAD-COD-ENTI IN LAD.

           MOVE    HOY-FHOY               TO  LAD-FEC-FTRN IN LAD
                                              LAD-FEC-FLAD IN LAD
                                              LAD-FEC-FOPD IN LAD
                                              LAD-FEC-FCLI IN LAD
                                              LAD-FEC-FAUT IN LAD.

           MOVE    HOY-HHOY               TO  LAD-HRA-HRTR IN LAD
                                              LAD-HRA-HLAD IN LAD
                                              LAD-HRA-HOPD IN LAD
                                              LAD-HRA-HCLI IN LAD
                                              LAD-HRA-HAUT IN LAD.

           MOVE  OPD-CIC-IOPD IN OPD      TO  LAD-CIC-IOPD IN LAD.

           MOVE  EIBTRMID                 TO  LAD-COD-OTRN IN LAD.
           MOVE  SCR-USER                 TO  LAD-COD-ATRN IN LAD
                                              LAD-COD-AUTO IN LAD.
           MOVE  EIBTRNID                 TO  LAD-COD-TCIC IN LAD.
           MOVE  SCR-CMND                 TO  LAD-COD-CMND IN LAD.
           MOVE  LAD-COD-COME IN ODC-FLD  TO  LAD-COD-COME IN LAD.
           MOVE  OPD                      TO  LAD-COD-CONT IN LAD.

           PERFORM GET-CUR-RCC.
           IF PGM-STAT-RCC-OKS
                MOVE    RCC-CIC-ICLI IN RCC    TO  LAD-CIC-ICLI IN LAD.
           MOVE    FIO-PUT                TO  FIO-CMND.
           PERFORM DAP-FIO-LAD.

           IF PGM-STAT-RCC-OKS
               PERFORM GET-NXT-RCC
               IF PGM-STAT-RCC-OKS
                   ADD          1    TO    LAD-NUM-CLAD IN LAD
                                           LAD-NUM-COPD IN LAD
                                           LAD-NUM-CCLI IN LAD
                                           LAD-NUM-CAUT IN LAD
                    MOVE    RCC-CIC-ICLI IN RCC TO
                                           LAD-CIC-ICLI IN LAD
                    MOVE    FIO-PUT   TO    FIO-CMND
                    PERFORM DAP-FIO-LAD.
           IF NOT PGM-STAT-RCC-OKS
               MOVE   SPACES  TO  FIO-STAT.
       FIN-GRABA-REG-LAD.
           EXIT.  
*% END
      *>>>>
*% END
