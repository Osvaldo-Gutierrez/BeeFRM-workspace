      *<<<< INI_BM_FO

      * calcula valores finales por operacion (FO)
      * A = monto retiro
      * VP= valor presente ( monto captacion)
      * i = tasa de interes / 100
      * n = numero de retiros (cantidad de vctos)
      * +--------------------+
      * |    VP*(i*(1+i)^n)  |
      * |A = --------------  |
      * |    (1+i)^n - 1)    |
      * +--------------------+
       PRO-VFIN-FO SECTION.
       INI-PRO-VFIN-FO.

           MOVE 0  TO WSS-VAL-TEVC
                      WSS-VAL-SCYA.

      *     MOVE 'LIQCVC NEX' TO MSG-COD-MENS.
      *     MOVE WSS-MSC-TCVE IN WSS-VARI TO FRM-MEN2.

      *JSS-TRC.
      *     MOVE 'INI-PRO-VFIN-FO' TO DSP-GLS-MENS.
      *     PERFORM GNS-DSP-MENS.

      *     PERFORM CHK-SUM-EVC.
      *     IF INT-CMSG > SPACES
      *         GO TO FIN-PRO-VFIN-FO.

      *COL     SUBTRACT WSS-VAL-TEVC FROM OPC-VAL-CRED IN OPC GIVING
      *COL              CVI-VCAP.
      *COL     SUBTRACT WSS-VAL-TEVC FROM OPD-VAL-CAPT IN OPD-FLD GIVING
      *COL              CVI-VCAP.
           MOVE OPD-VAL-CAPT IN OPD-FLD TO CVI-VCAP.

      *JSS-TRC.
      *     MOVE 'CAPITAL CON EL QUE TRABAJARA FO :' TO DSP-GLS-MEN1.
      *     MOVE CVI-VCAP                            TO DSP-SV1-13V4.
      *     PERFORM GNS-DSP-MENS.

           PERFORM BUS-VPER-EVC.
           IF INT-CMSG > SPACES
               GO TO FIN-PRO-VFIN-FO.

           MOVE 1 TO CVI-QTAN.

           MOVE 0 TO CVI-SUMA CVI-FTOR.
           MOVE 1 TO CVI-FOLD CVI-NVVG.
      *COL           MOVE OPC-FEC-FCOL IN OPC TO WSS-FAVC.
           MOVE OPD-NUM-DREA IN OPD-FLD TO WSS-DAVC.
           MOVE OPD-NUM-MREA IN OPD-FLD TO WSS-MAVC.
           MOVE OPD-NUM-SREA IN OPD-FLD TO WSS-SAVC.
           MOVE OPD-NUM-AREA IN OPD-FLD TO WSS-AAVC.

           MOVE OPD-COD-AFER IN OPD-FLD TO INT-AFER.
           IF INT-AFER-YES
               PERFORM CHK-AFER-EVC
               IF INT-CMSG > SPACES
                   GO TO FIN-PRO-VFIN-FO.
       LUP-PRO-VFIN-FO.

      *JSS-TRC.
      *     MOVE 'LUP-PRO-VFIN-FO' TO DSP-GLS-MENS.
      *     PERFORM GNS-DSP-MENS.

           PERFORM BUS-MEVC.
           IF WSS-IMVC = ZEROES
      *JSS    Se acabaron los vencimientos
               GO TO CAL-PRO-VFIN-FO.
           SUBTRACT 1 FROM WSS-VIGU(WSS-IMVC).

      *JSS CALCULAR ENTRE WSS-FAVC y WSS-FMVC.

           MOVE WSS-DAVC TO FEC-DEC1.
           MOVE WSS-MAVC TO FEC-MEC1.
           MOVE WSS-SAVC TO FEC-SEC1.
           MOVE WSS-AAVC TO FEC-AEC1.

           MOVE WSS-DMVC TO FEC-DEC2.
           MOVE WSS-MMVC TO FEC-MEC2.
           MOVE WSS-SMVC TO FEC-SEC2.
           MOVE WSS-AMVC TO FEC-AEC2.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-DIF-DIA  TO FEC-CMND.
      *COL PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE MSG-COD-MENS TO INT-CMSG
               GO TO FIN-PRO-VFIN-FO.

           MOVE FEC-NDIA TO INT-SEPD.

      *JSS-TRC.
      *     MOVE 'FECHAS/EVC' TO DSP-GLS-MENS.
      *     MOVE WSS-FAVC     TO DSP-GLS-MENB.
      *     MOVE WSS-FMVC     TO DSP-GLS-MENC.
      *     MOVE WSS-IMVC     TO DSP-SV2-13V4.
      *     PERFORM GNS-DSP-MENS.

           MOVE WSS-DAVC TO INT-DUNO.
           MOVE WSS-MAVC TO INT-MUNO.
           MOVE WSS-SAVC TO INT-SUNO.
           MOVE WSS-AAVC TO INT-AUNO.
           MOVE WSS-DMVC TO INT-DDOS.
           MOVE WSS-MMVC TO INT-MDOS.
           MOVE WSS-SMVC TO INT-SDOS.
           MOVE WSS-AMVC TO INT-ADOS.
      *COL     MOVE OPC-FEC-FCOL IN OPC-FLD TO INT-FBTV.
           MOVE OPD-FEC-FREA IN OPD-FLD TO INT-FBTV
                                           INT-FCOL.
           MOVE POD-COD-TINT IN POD     TO INT-TIPT.
           MOVE OPD-SGV-TINT IN OPD-FLD TO INT-TINT.
           MOVE OPD-COD-VCAM IN OPD-FLD TO INT-VCAM.

      *    PERFORM OBT-VTIN.
           PERFORM GNS-CAL-INT.
           IF INT-IETB > SPACES AND CVI-NVVG = 1
               MOVE INT-IETB TO WSS-IETB.
      *     IF INT-CVTI > SPACES AND INT-TFPR = 'F'
      *         MOVE WSS-DMVC TO INT-DDMA
      *         MOVE WSS-MMVC TO INT-MDMA
      *         MOVE WSS-SMVC TO INT-SDMA
      *         MOVE WSS-AMVC TO INT-ADMA.

      *JSS-TRC.
      *     MOVE 'DIAS SEPA./T.INTERES :' TO DSP-GLS-MENS.
      *     MOVE FEC-NDIA                 TO DSP-SV1-13V4.
      *     MOVE INT-TIPE                 TO DSP-SV2-13V4.
      *     PERFORM GNS-DSP-MENS.

           IF INT-CMSG > SPACES
               MOVE FRM-SUAR-MAL TO FRM-SUAR
      *GET-MSG Busca mensaje en tabla
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE INT-CMSG TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MEN1
               MOVE INT-MEN2 TO FRM-MEN2
               GO TO FIN-PRO-VFIN-FO.

           COMPUTE CVI-SUMA = CVI-SUMA + ( 1 + INT-TIPE ) ** CVI-NVVG.

           COMPUTE CVI-FTOR = CVI-FTOR +
                              1 / ( CVI-FOLD * ( 1 + INT-TIPE ) ).
           COMPUTE CVI-FOLD = CVI-FOLD * ( 1 + INT-TIPE ).

           IF CVI-QTAN = CVI-NVVG
               MOVE INT-TIPE TO CVI-TIQN.

           ADD 1 TO CVI-NVVG.

      *    MOVE WSS-FFPV TO WSS-FAVC.
           MOVE WSS-DFPV(WSS-IMVC) TO WSS-DAVC.
           MOVE WSS-MFPV(WSS-IMVC) TO WSS-MAVC.
           MOVE WSS-SFPV(WSS-IMVC) TO WSS-SAVC.
           MOVE WSS-AFPV(WSS-IMVC) TO WSS-AAVC.

           IF WSS-VIGU(WSS-IMVC) = ZEROES
               GO TO LUP-PRO-VFIN-FO.

      *JSS Desplazar WSS-FPVC(WSS-IMVC) en WSS-SEVE(WSS-IMVC) segun
      *                                    WSS-UTSV(WSS-IMVC)
      *    Considerando analisis de feriado si corresponde.

           IF WSS-UTSV(WSS-IMVC) = 'D'
               MOVE FEC-SUM-DIA        TO FEC-CMND
               MOVE WSS-SEVE(WSS-IMVC) TO FEC-NDIA
           ELSE
           IF WSS-UTSV(WSS-IMVC) = 'M'
               MOVE FEC-SUM-MES        TO FEC-CMND
               MOVE WSS-SEVE(WSS-IMVC) TO FEC-NMES
           ELSE
           IF WSS-UTSV(WSS-IMVC) = 'A'
               MOVE FEC-SUM-ANO        TO FEC-CMND
               MOVE WSS-SEVE(WSS-IMVC) TO FEC-NANO
           ELSE
               MOVE 'INTIPERINV' TO INT-CMSG
               GO TO FIN-PRO-VFIN-FO.

           MOVE WSS-DPVC(WSS-IMVC) TO FEC-ITM1.
           MOVE WSS-MPVC(WSS-IMVC) TO FEC-ITM2.
           MOVE WSS-SPVC(WSS-IMVC) TO FEC-ITM3.
           MOVE WSS-APVC(WSS-IMVC) TO FEC-ITM4.

           MOVE FEC-FORM-FEC TO FEC-FORM.
      *JSS PERFORM CAL-FEC
      *COL     PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS

               MOVE MSG-COD-MENS TO INT-CMSG
               GO TO FIN-PRO-VFIN-FO.

           MOVE WSS-DVEN(WSS-IMVC) TO CVI-DVEN.
           IF NOT ( ( WSS-UTSV(WSS-IMVC) = 'M' OR 'A' ) AND
              CVI-DVEN > ZEROES AND FEC-ITM1 < CVI-DVEN )
               GO TO FER-PRO-VFIN-FO.
           IF CVI-DVEN > FEC-DMES(FEC-ITM2)
               MOVE FEC-DMES(FEC-ITM2) TO FEC-ITM1
           ELSE
               MOVE CVI-DVEN TO FEC-ITM1.
           IF FEC-ITM2 = 2
               DIVIDE FEC-ITM4 BY 4 GIVING FEC-REST REMAINDER FEC-REST
               IF ( FEC-REST NOT = 0 ) AND ( FEC-ITM1 > 28 )
                   MOVE 28 TO FEC-ITM1.
       FER-PRO-VFIN-FO.

           MOVE FEC-ITM1 TO WSS-DPVC(WSS-IMVC).
           MOVE FEC-ITM2 TO WSS-MPVC(WSS-IMVC).
           MOVE FEC-ITM3 TO WSS-SPVC(WSS-IMVC).
           MOVE FEC-ITM4 TO WSS-APVC(WSS-IMVC).

           IF NOT INT-AFER-YES
               GO TO FPV-PRO-VFIN-FO.

           MOVE FEC-FBLK-N  TO FEC-FBLK.
           MOVE FEC-CHOY-N  TO FEC-CHOY.
           MOVE FEC-VHBL-S  TO FEC-VHBL.
           MOVE FEC-VAL-FEC TO FEC-CMND.
      *JSS PERFORM CAL-FEC.
      *COL     PERFORM PRO-FEC.
      *ISP
      *     PERFORM CAL-FEC.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS AND NOT FEC-STAT-FER
               MOVE MSG-COD-MENS TO INT-CMSG
               GO TO FIN-PRO-VFIN-FO.

           IF NOT FEC-STAT-FER
               GO TO FPV-PRO-VFIN-FO.

           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-SIG-HBL  TO FEC-CMND.
      *JSS PERFORM CAL-FEC.
      *COL     PERFORM PRO-FEC.
           PERFORM CAL-FEC.
           IF NOT FEC-STAT-OKS
               MOVE MSG-COD-MENS TO INT-CMSG
               GO TO FIN-PRO-VFIN-FO.
       FPV-PRO-VFIN-FO.

      *JSS-TRC.
      *     MOVE 'FPV-PRO-VFIN-FO' TO DSP-GLS-MENS.
      *     PERFORM GNS-DSP-MENS.

           MOVE FEC-ITM1 TO WSS-DFPV(WSS-IMVC).
           MOVE FEC-ITM2 TO WSS-MFPV(WSS-IMVC).
           MOVE FEC-ITM3 TO WSS-SFPV(WSS-IMVC).
           MOVE FEC-ITM4 TO WSS-AFPV(WSS-IMVC).
           GO TO LUP-PRO-VFIN-FO.

       CAL-PRO-VFIN-FO.

      *JSS-TRC.
      *     MOVE 'CAL-PRO-VFIN-FO' TO DSP-GLS-MENS.
      *     PERFORM GNS-DSP-MENS.

      *JSS
           MOVE 'P' TO INT-OPEC.

           IF INT-OPEC = 'D'
      *JSS     COMPUTE CVI-VCAP ROUNDED = CVI-VFIN / CVI-SUMA
               DIVIDE CVI-VFIN BY CVI-SUMA GIVING CVI-VCAP ROUNDED
           ELSE
      *JSS     COMPUTE CVI-VFIN ROUNDED = CVI-VCAP * CVI-SUMA.
      *JSS     COMPUTE CVI-VFIN ROUNDED = CVI-VCAP / CVI-FTOR.
               DIVIDE CVI-VCAP BY CVI-FTOR GIVING CVI-VFIN ROUNDED.

      *Se redondea y se deja sin decimales el valor final
           IF SCR-CIC-TVAL = '0'
             MOVE 'S' TO WSS-PESO
           ELSE
             MOVE 'N' TO WSS-PESO.

           IF WSS-PESO-SI
               MOVE CVI-VFIN TO PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO CVI-VFIN.
      *

      *CALCULO DE INTERES SOBRE EL VALOR CAPITAL
      *     MULTIPLY CVI-VCAP BY CVI-TIQN GIVING CVI-VCAP.
      *RESTA EL SALDO YA AMORTIZADO PARA EL CALCULO DE LOS INTERESES
      *COL     SUBTRACT WSS-VAL-SCYA FROM OPC-VAL-CRED IN OPC
      *COL              GIVING WSS-CVI-TCAP.
      *COL     SUBTRACT WSS-VAL-SCYA FROM OPD-VAL-CAPT IN OPD-FLD
      *COL              GIVING WSS-CVI-TCAP.
      *COL     MULTIPLY WSS-CVI-TCAP BY CVI-TIQN GIVING CVI-VCAP ROUNDED.
           MULTIPLY OPD-VAL-CAPT IN OPD-FLD BY CVI-TIQN GIVING
                    CVI-VCAP ROUNDED.
           IF CVI-VCAP NOT > CVI-VFIN
               SUBTRACT CVI-VCAP FROM CVI-VFIN GIVING CVI-VCAP
           ELSE
               ADD CVI-VCAP      TO   WSS-CVI-IDNI
               SUBTRACT CVI-VFIN FROM WSS-CVI-IDNI
               MOVE 0 TO CVI-VCAP.
       FIN-PRO-VFIN-FO.
           EXIT.

       BUS-VPER-EVC SECTION.
       INI-BUS-VPER-EVC.
      *JSS-TRC.
      *     MOVE 'INI-BUS-VPER-EVC' TO DSP-GLS-MENS.
      *     PERFORM GNS-DSP-MENS.

           MOVE 0 TO WSS-I.
       LUP-BUS-VPER-EVC.

      *JSS-TRC.
      *     MOVE 'LUP-BUS-VPER-EVC' TO DSP-GLS-MENS.
      *     PERFORM GNS-DSP-MENS.

           ADD 1 TO WSS-I.
           IF WSS-I > WSS-MEFO
               GO TO FIN-BUS-VPER-EVC.

      *COL     MOVE WSS-REVC(WSS-I) TO EVC.

      *COL     MOVE EVC-IND-UTSV IN EVC TO INT-IPER.
           MOVE OPD-IND-SEVE IN OPD-FLD TO INT-IPER.

      *COL     MOVE EVC-NUM-DPVE IN EVC TO CVI-DVEN.
           MOVE 0 TO CVI-DVEN.

           PERFORM PRO-IPER.
           IF INT-CMSG > SPACES
               GO TO FIN-BUS-VPER-EVC.
      *COL     MOVE EVC-NUM-SEVE IN EVC TO WSS-SEVE(WSS-I).
           MOVE OPD-NUM-SEVE IN OPD-FLD TO WSS-SEVE(WSS-I).

           MOVE INT-IPER            TO WSS-UTSV(WSS-I).
      *COL     MOVE EVC-NUM-VIGU IN EVC TO WSS-VIGU(WSS-I).
           MOVE FRM-NUM-TVEN IN OPD-FLD TO WSS-VIGU(WSS-I).

      *COL     MOVE EVC-NUM-DPVC IN EVC TO WSS-DPVC(WSS-I).
      *COL     MOVE EVC-NUM-MPVC IN EVC TO WSS-MPVC(WSS-I).
      *COL     MOVE EVC-NUM-SPVC IN EVC TO WSS-SPVC(WSS-I).
      *COL     MOVE EVC-NUM-APVC IN EVC TO WSS-APVC(WSS-I).
           MOVE OPD-NUM-DPVC IN OPD-FLD TO WSS-DPVC(WSS-I).
           MOVE OPD-NUM-MPVC IN OPD-FLD TO WSS-MPVC(WSS-I).
           MOVE OPD-NUM-SPVC IN OPD-FLD TO WSS-SPVC(WSS-I).
           MOVE OPD-NUM-APVC IN OPD-FLD TO WSS-APVC(WSS-I).
           MOVE WSS-FPVC(WSS-I) TO WSS-FFPV(WSS-I).

           MOVE CVI-DVEN            TO WSS-DVEN(WSS-I).

      *Diferencia en dias entre Fecha Colocacion y EVC-FEC-FPVC
      *     MOVE OPC-NUM-DCOL IN OPC TO FEC-DEC1.
      *     MOVE OPC-NUM-MCOL IN OPC TO FEC-MEC1.
      *     MOVE OPC-NUM-SCOL IN OPC TO FEC-SEC1.
      *     MOVE OPC-NUM-ACOL IN OPC TO FEC-AEC1.
      *     MOVE EVC-NUM-DPVC IN EVC TO FEC-DEC2.
      *     MOVE EVC-NUM-MPVC IN EVC TO FEC-MEC2.
      *     MOVE EVC-NUM-SPVC IN EVC TO FEC-SEC2.
      *     MOVE EVC-NUM-APVC IN EVC TO FEC-AEC2.
      *     MOVE FEC-FORM-FEC TO FEC-FORM.
      *     MOVE FEC-DIF-DIA  TO FEC-CMND.
      *     PERFORM PRO-FEC.
      *     IF NOT FEC-STAT-OKS
      *         MOVE MSG-COD-MENS TO INT-CMSG
      *         GO TO FIN-BUS-VPER-EVC.
      *     MOVE FEC-NDIA            TO WSS-SPVE(WSS-I).
      *     MOVE 'D'                 TO WSS-UTPV(WSS-I).
           GO TO LUP-BUS-VPER-EVC.
       FIN-BUS-VPER-EVC.
           EXIT.

       CHK-AFER-EVC SECTION.
       INI-CHK-AFER-EVC.
           MOVE 0 TO WSS-I.
       LUP-CHK-AFER-EVC.
           ADD 1 TO WSS-I.
           IF WSS-I > WSS-MEFO
               GO TO FIN-CHK-AFER-EVC.

           MOVE WSS-DPVC(WSS-I) TO FEC-ITM1.
           MOVE WSS-MPVC(WSS-I) TO FEC-ITM2.
           MOVE WSS-SPVC(WSS-I) TO FEC-ITM3.
           MOVE WSS-APVC(WSS-I) TO FEC-ITM4.

           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF ( NOT FEC-STAT-OKS ) AND ( NOT FEC-STAT-FER )
               MOVE MSG-COD-MENS TO INT-CMSG
               GO TO FIN-CHK-AFER-EVC.
           IF FEC-STAT-FER
               MOVE FEC-FORM-FEC TO FEC-FORM
               MOVE FEC-SIG-HBL  TO FEC-CMND
      *               PERFORM PRO-FEC
               PERFORM CAL-FEC
               IF FEC-STAT-OKS
                   MOVE FEC-ITM1 TO WSS-DFPV(WSS-I)
                   MOVE FEC-ITM2 TO WSS-MFPV(WSS-I)
                   MOVE FEC-ITM3 TO WSS-SFPV(WSS-I)
                   MOVE FEC-ITM4 TO WSS-AFPV(WSS-I)
               ELSE
                   MOVE MSG-COD-MENS TO INT-CMSG
                   GO TO FIN-CHK-AFER-EVC.
           GO TO LUP-CHK-AFER-EVC.
       FIN-CHK-AFER-EVC.
           EXIT.

       BUS-MEVC SECTION.
       INI-BUS-MEVC.
      *JSS-TRC.
      *     MOVE 'INI-BUS-MEVC' TO DSP-GLS-MENS.
      *     PERFORM GNS-DSP-MENS.

           MOVE ZEROES TO WSS-FMVC.
           MOVE ZEROES TO WSS-IMVC.
           MOVE 0 TO WSS-I.
       LUP-BUS-MEVC.

      *JSS-TRC.
      *     MOVE 'LUP-BUS-MEVC' TO DSP-GLS-MENS.
      *     PERFORM GNS-DSP-MENS.

           ADD 1 TO WSS-I.
           IF WSS-I > WSS-MEFO
               GO TO FIN-BUS-MEVC.

      *NO SE CONSIDERAN ESTOS TIPOS YA QUE LA RUTINA DE PROYECCION
      *NO AMORTIZA PARA ELLOS Y SE LOS SALTA PARA EL CALCULO DE INTERESES
      *COL     IF WSS-VCVC(WSS-I) = 'IC' OR 'IN' OR 'IF' OR 'FE'
      *COL         GO TO LUP-BUS-MEVC.

           IF ( WSS-FFPV(WSS-I) < WSS-FMVC OR WSS-FMVC = ZEROES ) AND
              WSS-VIGU(WSS-I) > ZEROES
               MOVE WSS-FFPV(WSS-I) TO WSS-FMVC
               MOVE WSS-I           TO WSS-IMVC.
           GO TO LUP-BUS-MEVC.
       FIN-BUS-MEVC.
           EXIT.

      *<<<< FIN_BM_FO
