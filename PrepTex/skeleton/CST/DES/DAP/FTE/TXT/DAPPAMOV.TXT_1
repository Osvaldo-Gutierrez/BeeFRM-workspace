*%! Codigo adicional para DAPPAMOV
*% PGM_MSX = TRUE
*% IF SETTAG
*% FNCPQ = "081009"
*% VSNPQ = "09.04.02"
*% FNCPU = "081009"
*% VSNPU = "09.04.02"
*% END
*% NO_TIENE_TIMESTAMP = TRUE
*% NO_HDR_CST = TRUE
*% PGM_PTC = TRUE
*% INCLUDE 'GNSSRC:MANEJO_VSI.SRC'
*% IF WSS
      *<<<< WSS
       COPY SGCBRDBC.
       COPY GNSWGCPT.
       COPY GNSWGSTR.
       COPY DAPWXMOV.
       77  WSS-MOV-NUM-CORR VALUE ZEROES PIC 9(05).

      *>>>> WSS
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
      *Entidades de SGC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>> WSS_DTC
*% END
*% IF FIN_PGM_STAT
      *<<<< FIN_PGM_STAT
              05 PGM-STAT-DBC.
                 88 PGM-STAT-DBC-NUL    VALUE '  '.
                 07 PGM-STT1-DBC        VALUE '2' PIC X(01).
                    88 PGM-STAT-DBC-OKS VALUE '0'.
                 07 PGM-STT2-DBC        VALUE '3' PIC X(01).
      *<<<< FIN_PGM_STAT
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           MOVE TSK-TERM-ALF    TO MOX-COD-TERM.
      *>>>> INI_FIO
*% END
*% IF FND_KEY
      *<<<< FND_KEY
           IF SCR-CMND = 'CON' AND
              ( SCR-OFRM-SRV OR
                FRM-IND-FMTI = 'S' )
                  MOVE FIO-GET-NLS TO FIO-CMND
                  PERFORM DAP-FIO-MOV
                  IF NOT ( FIO-STAT-OKS AND
                           MOV-NUM-RUTC IN MOV-FLD =
                           MOV-NUM-RUTC IN MOV AND
                           MOV-IND-RUTC IN MOV-FLD =
                           MOV-IND-RUTC IN MOV AND
                           MOV-GLS-RUTC IN MOV-FLD =
                           MOV-GLS-RUTC IN MOV AND
                           MOV-NUM-SPRO IN MOV-FLD =
                           MOV-NUM-SPRO IN MOV AND
                           MOV-NUM-APRO IN MOV-FLD =
                           MOV-NUM-APRO IN MOV
                         )
                         MOVE '23' TO FIO-STAT
                         MOVE FIO-STAT TO PGM-STAT-MOV
                         GO TO FIN-FND-KEY.

      *>>>> FND_KEY
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
           IF PGM-STAT-MOV-OKS
               MOVE FIO-GET-NLS TO FIO-CMND
               PERFORM DAP-FIO-MOV.
      *>>>> FIN_FND_KEY
*% END
*% IF FIN_PUT_SCR
      *<<<< FIN_PUT_SCR

           IF SCR-CMND NOT = 'CON'
                GO TO END-PUT-SCR.

           MOVE 'N' TO FRM-COD-HMAS IN MOV-FLD.

           IF NOT ( SCR-OFRM-SRV OR
                    FRM-IND-FMTI = 'S' )
                    GO TO END-PUT-SCR.

      * BUSCA EL PRIMER REGISTRO EN SOLICITUD
      * DE HAY MAS
           IF ( SCR-OFRM-SRV OR
                FRM-IND-FMTI = 'S' )
                  IF WSS-MOV-NUM-CORR NOT > ZEROES
                      PERFORM PRO-MOV
                  ELSE
                      MOVE FIO-GET-NXT TO FIO-CMND
                      PERFORM DAP-FIO-MOV
                      IF NOT FIO-STAT-OKS
                          MOVE 'DAP' TO MSG-COD-SIST
                          MOVE 'MOVNONXT' TO MSG-COD-MENS
                          PERFORM GET-MSG
                          MOVE MSG-GLS-DESC TO FRM-MENS
                          MOVE FRM-SUAR-MAL TO FRM-SUAR
                          MOVE 'S' TO SCR-IERR
                          GO TO FIN-PUT-SCR
                      ELSE
                          PERFORM PRO-MOV.

       CIC-PUT-SCR.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-MOV.
           IF FIO-STAT-OKS AND
              MOV-NUM-RUTC IN MOV-FLD = MOV-NUM-RUTC IN MOV AND
              MOV-IND-RUTC IN MOV-FLD = MOV-IND-RUTC IN MOV AND
              MOV-GLS-RUTC IN MOV-FLD = MOV-GLS-RUTC IN MOV AND
              MOV-NUM-SPRO IN MOV-FLD = MOV-NUM-SPRO IN MOV AND
              MOV-NUM-APRO IN MOV-FLD = MOV-NUM-APRO IN MOV
                 PERFORM PRO-MOV
                 IF MOX-IDX-MOX-OCC = MOX-TOT-MOX-OCC
                     PERFORM PRO-ULT-MOV
                 ELSE
                     GO TO CIC-PUT-SCR.

           MOVE MOX-IDX-MOX-OCC TO FRM-NUM-TOCC IN MOV-FLD.
           IF MOX-PUT-QUE = 'S'
               PERFORM PUT-TS-MOX.
       END-PUT-SCR.

      *>>>> FIN_PUT_SCR
*% END
*% IF FIOSTAT
      *<<<< FIOSTAT
                   IF MSG-COD-MENS = 'FIOSTAT23'
                       MOVE 'DAP' TO MSG-COD-SIST
                       MOVE 'CLIMOVNEX' TO MSG-COD-MENS
                   END-IF
      *>>>> FIOSTAT
*% END
*% IF EOF_PQ
      *<<<< EOF_PQ
       PRO-ULT-MOV SECTION.
       INI-PRO-ULT-MOV.

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM DAP-FIO-MOV.
           IF FIO-STAT-OKS AND
              MOV-NUM-RUTC IN MOV-FLD = MOV-NUM-RUTC IN MOV AND
              MOV-IND-RUTC IN MOV-FLD = MOV-IND-RUTC IN MOV AND
              MOV-GLS-RUTC IN MOV-FLD = MOV-GLS-RUTC IN MOV AND
              MOV-NUM-SPRO IN MOV-FLD = MOV-NUM-SPRO IN MOV AND
              MOV-NUM-APRO IN MOV-FLD = MOV-NUM-APRO IN MOV
                 MOVE MOV-CIC-IOPD IN MOV TO FRM-GLS-UOM1 IN MOV-FLD
                 MOVE 'S' TO FRM-COD-HMAS IN MOV-FLD.
       FIN-PRO-ULT-MOV.
           EXIT.

       PRO-MOV SECTION.
       INI-PRO-MOV.
           ADD 1 TO MOX-IDX-MOX-TSQ.
           ADD 1 TO MOX-IDX-MOX-OCC.
           MOVE MOV-CIC-IOPD IN MOV TO FRM-GLS-UOPD IN MOV-FLD.

           IF MOX-IDX-MOX-TSQ > MOX-TOT-MOX-TSQ
                MOVE 1 TO MOX-IDX-MOX-TSQ
                PERFORM PUT-TS-MOX.

           MOVE 'S' TO MOX-PUT-QUE.

           MOVE MOV-NUM-CORR IN MOV
             TO MOX-NUM-CORR-EDT.
           MOVE MOX-NUM-CORR-EDT
             TO MOX-NUM-CORR-ALF IN
                MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).
      ***---
           MOVE MOV-NUM-CORR IN MOV TO MOX-NUM-CORR-EDT.
           MOVE MOX-NUM-CORR-EDT
             TO MOX-NUM-CORR-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-COD-OFIC IN MOV
             TO MOX-COD-OFIC     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-NUM-PAGI IN MOV TO MOX-NUM-PAGI-EDT.
           MOVE MOX-NUM-PAGI-EDT
             TO MOX-NUM-PAGI-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-IIC-IOPD IN MOV TO MOX-IIC-IOPD-EDT.
           MOVE MOX-IIC-IOPD-EDT
             TO MOX-IIC-IOPD-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-NUM-TMON IN MOV TO MOV-NUM-TMON-EDT.
           MOVE MOV-NUM-TMON-EDT
             TO MOX-NUM-TMON-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-NUM-TCLI IN MOV TO MOV-NUM-TCLI-EDT.
           MOVE MOV-NUM-TCLI-EDT
             TO MOX-NUM-TCLI-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-COD-TREG IN MOV
             TO MOX-COD-TREG     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-GLS-OFIC IN MOV
             TO MOX-GLS-OFIC     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-CAI-IOPD IN MOV
             TO MOX-CAI-IOPD     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-COD-COPD IN MOV
             TO MOX-COD-COPD     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-GLS-COPD IN MOV
             TO MOX-GLS-COPD     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-COD-VCAM IN MOV
             TO MOX-COD-VCAM     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-GLS-VCAM IN MOV
             TO MOX-GLS-VCAM     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-NUM-DREA IN MOV
             TO MOX-NUM-DREA     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-NUM-MREA IN MOV
             TO MOX-NUM-MREA     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-NUM-SREA IN MOV
             TO MOX-NUM-SREA     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-NUM-AREA IN MOV
             TO MOX-NUM-AREA     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-NUM-DVEN IN MOV
             TO MOX-NUM-DVEN     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-NUM-MVEN IN MOV
             TO MOX-NUM-MVEN     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-NUM-SVEN IN MOV
             TO MOX-NUM-SVEN     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-NUM-AVEN IN MOV
             TO MOX-NUM-AVEN     IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-SGV-TINT IN MOV TO MOX-SGV-TINT-EDT.
           MOVE MOX-SGV-TINT-EDT
             TO MOX-SGV-TINT-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-VAL-CAPT IN MOV TO MOX-VAL-CAPT-EDT.
           MOVE MOX-VAL-CAPT-EDT
             TO MOX-VAL-CAPT-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-TOT-CAPT IN MOV TO MOX-TOT-CAPT-EDT.
           MOVE MOX-TOT-CAPT-EDT
             TO MOX-TOT-CAPT-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-TOT-TCAP IN MOV TO MOX-TOT-TCAP-EDT.
           MOVE MOX-TOT-TCAP-EDT
             TO MOX-TOT-TCAP-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-SGV-INTS IN MOV TO MOX-SGV-INTS-EDT.
           MOVE MOX-SGV-INTS-EDT
             TO MOX-SGV-INTS-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-TOT-INTS IN MOV TO MOX-TOT-INTS-EDT.
           MOVE MOX-TOT-INTS-EDT
             TO MOX-TOT-INTS-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-TOT-TINT IN MOV TO MOX-TOT-TINT-EDT.
           MOVE MOX-TOT-TINT-EDT
             TO MOX-TOT-TINT-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-VAL-FINA IN MOV TO MOX-VAL-FINA-EDT.
           MOVE MOX-VAL-FINA-EDT
             TO MOX-VAL-FINA-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-TOT-FINA IN MOV TO MOX-TOT-FINA-EDT.
           MOVE MOX-TOT-FINA-EDT
             TO MOX-TOT-FINA-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).

           MOVE MOV-TOT-TFIN IN MOV TO MOX-TOT-TFIN-EDT.
           MOVE MOX-TOT-TFIN-EDT
             TO MOX-TOT-TFIN-ALF IN MOX-MTI-VARI ( MOX-IDX-MOX-TSQ ).
      ***---
       FIN-PRO-MOV.
           EXIT.

       PUT-TS-MOX SECTION.
       INI-PUT-TS-MOX.
           MOVE MOX-TSMOX TO QUE-COLA.
           MOVE MOX-LEN-TSMOX  TO QUE-LITM.
           MOVE MOX-MTI-VARI   TO QUE-ITEM.
           MOVE QUE-PUT TO QUE-CMND.
           PERFORM GNS-PRO-QUE.
           MOVE SPACES TO MOX-MTI-VARI.
           MOVE 'N' TO MOX-PUT-QUE.
       FIN-PUT-TS-MOX.
           EXIT.

       COPY SGCBFDBC.
       LEE-CLI SECTION.
       INI-LEE-CLI.
           MOVE MOV-NUM-RUTC IN MOV-FLD TO DBC-NUM-ICLI IN DBC.
           MOVE MOV-IND-RUTC IN MOV-FLD TO DBC-IND-ICLI IN DBC.
           MOVE MOV-GLS-RUTC IN MOV-FLD TO DBC-GLS-ICLI IN DBC.
           MOVE 'DBC-IDC-ICLI' TO FIO-AKEY.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF FIO-STAT-OKS
               MOVE FIO-STAT TO PGM-STAT-DBC
               PERFORM CPT-NOMB.
       FIN-LEE-CLI.
           EXIT.

       COPY GNSBGCPT.
       COPY GNSBGSTR.

       CPT-NOMB SECTION.
       INI-CPT-NOMB.
           MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN.
           PERFORM CPT-BLKS.
           MOVE CPT-STRN            TO DBC-GLS-NOMC IN DBC.
       FIN-CPT-NOMB.
           EXIT.
      *>>>> EOF_PQ
*% END
