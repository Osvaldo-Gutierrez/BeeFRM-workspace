*%! Codigo adicional para archivo
*% NO_TIENE_TIMESTAMP = TRUE
*% MI_COMMAREA = 70
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI

           02 CMA-VARI.
              05  WSS-POS-ACT            COMP-3       PIC S9(5).
              05  WSS-IND-ACUM          VALUE 0      PIC 9(01).
                  88 DESPLIEGA           VALUE 0.
                  88 ACUMULA             VALUE 0.
                  88 SOLO-ACUMULA        VALUE 1.
                  88 YA-ACUMULO          VALUE 1.
              05  WSS-CLV-INI.
                  07 CMR-KEY-IPAD-INI                 PIC X(17).
                  07 CMR-COD-COPD-INI                 PIC X(06).
              05  WSS-CLV-FIN.
                  07 CMR-KEY-IPAD                     PIC X(17).
                  07 CMR-COD-COPD-FIN                 PIC X(06).
      *>>>>
*% END
*% IF WSS
      *<<<< WSS

      * Define 01  WSS-VARI de PGM1ANIDX
       01  WSS-VARI.
           03  WSS-IMAX               VALUE 13     PIC 9(02).
           03  CMR-KEY-ICMR.
               05 CMR-KEY-IPAD                        PIC X(17).
               05 CMR-COD-COPD                        PIC X(06).
      * PARA USAR GARSRC:ERRFNDKEY.SRC
           03  WSS-IBUS                               PIC 9(01).
           03  WSS-IBUS-CMR                           PIC 9(01).
           03  WSS-YA-ACUMULO         VALUE 1         PIC 9(01).
           03  WSS-GLS-COPD.
               05  WSS-GLS-ABR1             PIC X(12) VALUE SPACES.
               05  WSS-GLS-BLCO             PIC X(01) VALUE SPACES.
               05  WSS-GLS-ABR2             PIC X(12) VALUE SPACES.
      *>>>>
*% END
*% IF INI_FIO
      *<<<< INI_FIO
           MOVE +320 TO SCR-TCMA.
           PERFORM GNS-HDL-VSM.
      *>>>>
*% END
*% IF PGM_INI 
      *<<<<
       COPY GNSBGEDB.
       GO TO CNT-INI.
      *>>>>
*% END
*% IF PGM_POS_EDB
      *<<<<
       CNT-INI.
      *>>>>
*% END
*% IF PFS_SCR_MOD
      *<<<< PFS_SCR_MOD
           IF ( FRM-FFLD = FRM-FFLD-PF6
                      OR   FRM-FFLD-PF5
              ) AND
              SCR-STAT = SCR-STAT-CON
               PERFORM VAL-NUM-KEY-CMR
               PERFORM VAL-NUM-FLD-CMR.
           IF FRM-FFLD = FRM-FFLD-PF6
                    OR   FRM-FFLD-PF5
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-MOD.
      *>>>>
*% END
*% IF PFS_SCR_ACC
      *<<<< PFS_SCR_ACC
           IF FRM-FFLD = FRM-FFLD-PF6
                    OR   FRM-FFLD-PF5
               PERFORM VAL-NUM-KEY-CMR
               PERFORM VAL-NUM-FLD-CMR
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-ACC.
      *>>>>
*% END
*% IF PFS_SCR_ELI
      *<<<< PFS_SCR_ELI
           IF FRM-FFLD = FRM-FFLD-PF6
                    OR   FRM-FFLD-PF5
               PERFORM VAL-NUM-KEY-CMR
               PERFORM VAL-NUM-FLD-CMR
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-ELI.
      *>>>>
*% END
*% IF PFS_SCR_ACT
      *<<<< PFS_SCR_ACT
           IF ( FRM-FFLD = FRM-FFLD-PF6
                      OR   FRM-FFLD-PF5
              ) AND
              SCR-STAT = SCR-STAT-CON
               PERFORM VAL-NUM-KEY-CMR
               PERFORM VAL-NUM-FLD-CMR.
           IF FRM-FFLD = FRM-FFLD-PF6
                    OR   FRM-FFLD-PF5
               PERFORM RST-STAT
               PERFORM FND-SCR-KEY THRU FIN-SCR-KEY
               IF SCR-STAT NOT = SCR-STAT-ABT
                   PERFORM SCR-TRL
               ELSE
                   PERFORM DESSCRTRL
                   GO TO FIN-SCR-ACT.
      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
      * WSS-POS-ACT CONTIENE LA POSICION ALCANZADA AL LLENAR LA PANTALLA

      * ASUME MENSAJE DEL SISTEMA DEL HIJO EN ERRFNDKEY.SRC
           MOVE 1 TO WSS-IBUS, WSS-IBUS-CMR.

           IF FRM-FFLD = FRM-FFLD-PF5
               MOVE WSS-CLV-INI TO CMR-KEY-ICMR IN CMR
               MOVE FIO-GET-NLS TO FIO-CMND
               MOVE 'CMR-KEY-ICMR' TO FIO-AKEY
               PERFORM DAP-FIO-CMR
               IF NOT FIO-STAT-OKS
                   MOVE 'PGM    ERR' TO MSG-COD-MENS
                   GO TO ERR-FND-KEY
               ELSE
                   MOVE 'CMR-KEY-ICMR' TO FIO-AKEY
                   MOVE FIO-GET-PRV TO FIO-CMND
                   PERFORM DAP-FIO-CMR
                   MOVE FIO-GET-PRV TO FIO-CMND
                   MOVE 'CMR-KEY-ICMR' TO FIO-AKEY
                   GO TO LEE-CMR
           ELSE
           IF FRM-FFLD = FRM-FFLD-PF6
               IF WSS-POS-ACT < WSS-IMAX
                   MOVE 'CMR    NONXT' TO MSG-COD-MENS
                   GO TO ERR-FND-KEY
               ELSE
                   MOVE WSS-CLV-FIN TO CMR-KEY-ICMR IN CMR
                   MOVE FIO-GET-NLS TO FIO-CMND
                   MOVE 'CMR-KEY-ICMR' TO FIO-AKEY
                   PERFORM DAP-FIO-CMR
                   MOVE FIO-GET-NXT TO FIO-CMND
                   GO TO LEE-CMR.

      * INICIALIZA POSICION DE PUNTERO Y LLAVES
           MOVE ZEROES TO WSS-POS-ACT, WSS-IND-ACUM.
           MOVE SPACES TO WSS-CLV-INI, WSS-CLV-FIN.
           MOVE FRM-FFLD-PF6 TO FRM-FFLD.

           GO TO LEE-PAD-CMR.
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
       LEE-PAD-CMR.
      *<<< LEEPAD
           MOVE CMR-NUM-DCMR IN CMR-FLD TO CMR-NUM-DCMR IN CMR.
           MOVE CMR-NUM-MCMR IN CMR-FLD TO CMR-NUM-MCMR IN CMR.
           MOVE CMR-NUM-SCMR IN CMR-FLD TO CMR-NUM-SCMR IN CMR.
           MOVE CMR-NUM-ACMR IN CMR-FLD TO CMR-NUM-ACMR IN CMR.
           MOVE SPACES                  TO CMR-COD-OFIC IN CMR.
           MOVE CMR-COD-VCAM IN CMR-FLD TO CMR-COD-VCAM IN CMR.
           MOVE LOW-VALUES              TO CMR-COD-COPD IN CMR.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM DAP-FIO-CMR.
           IF FIO-STAT-OKS                                  AND
              CMR-NUM-DCMR IN CMR-FLD = CMR-NUM-DCMR IN CMR AND
              CMR-NUM-MCMR IN CMR-FLD = CMR-NUM-MCMR IN CMR AND
              CMR-NUM-SCMR IN CMR-FLD = CMR-NUM-SCMR IN CMR AND
              CMR-NUM-ACMR IN CMR-FLD = CMR-NUM-ACMR IN CMR AND
              CMR-COD-VCAM IN CMR-FLD = CMR-COD-VCAM IN CMR
                 MOVE '00' TO FIO-STAT
                              PGM-STAT-CMR
           ELSE
                 MOVE '23' TO FIO-STAT
                 MOVE FIO-STAT TO PGM-STAT-CMR.

           IF NOT FIO-STAT-OKS
               MOVE 'CMR    NEX' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           MOVE FIO-END-BRW TO FIO-CMND.
           PERFORM DAP-FIO-CMR.

           MOVE CMR-KEY-IPAD IN CMR TO CMR-KEY-IPAD
                                        IN CMA-VARI.
           MOVE CMR-KEY-IPAD IN CMR TO CMR-KEY-IPAD-INI
                                        IN CMA-VARI.

           MOVE CMR-KEY-IPAD IN CMR TO CMR-KEY-IPAD IN WSS-VARI.
           MOVE LOW-VALUES            TO CMR-COD-COPD
                                        IN CMR-KEY-ICMR IN WSS-VARI.
           MOVE CMR-KEY-ICMR IN WSS-VARI TO CMR-KEY-ICMR IN CMR.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LEE-CMR.
           PERFORM DAP-FIO-CMR.
           MOVE CMR-KEY-ICMR IN CMR TO CMR-KEY-ICMR IN WSS-VARI.
           IF NOT FIO-STAT-OKS OR
              CMR-KEY-IPAD IN WSS-VARI NOT = CMR-KEY-IPAD IN CMA-VARI
               IF WSS-POS-ACT = ZEROES
                   MOVE 'CMR    NEX' TO MSG-COD-MENS
                   GO TO ERR-FND-KEY
               ELSE
                   IF FRM-FFLD = FRM-FFLD-PF5
                       MOVE 'CMR    NOPRV' TO MSG-COD-MENS
                       GO TO ERR-FND-KEY
                   ELSE
                       MOVE 'CMR    NONXT' TO MSG-COD-MENS
                       GO TO ERR-FND-KEY.
       CARGA-CMR.
      *    INICIALIZA POSICION DEL INDICE DEL GRUPO DE OCURRENCIAS
           IF FRM-FFLD = FRM-FFLD-PF6
               MOVE ZEROES TO FRM-IFLD
           ELSE
               ADD 1 , WSS-IMAX GIVING FRM-IFLD.

           MOVE SPACES TO MSG-COD-MENS.
           PERFORM PUT-TAB-CMR.

           MOVE WSS-YA-ACUMULO TO WSS-IND-ACUM.
           IF FRM-FFLD = FRM-FFLD-PF5
               MOVE WSS-IMAX TO WSS-POS-ACT
           ELSE
           IF FRM-FFLD = FRM-FFLD-PF6
               ADD 1 TO FRM-IFLD
               PERFORM LIM-RES-LIN UNTIL FRM-IFLD > WSS-IMAX
               IF WSS-POS-ACT > WSS-IMAX
                   MOVE WSS-IMAX TO WSS-POS-ACT.

      * MUEVE ACUMULADORES A CMR-FLD

           IF MSG-COD-MENS > SPACES
               MOVE 'DAP' TO FIO-SIST
               MOVE SPACES TO FIO-AKEY
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS.

           MOVE '00' TO FIO-STAT.
           GO TO FIN-FND-KEY.

       ERR-FND-KEY.
               MOVE 'DAP' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE SCR-STAT-CON TO SCR-STAT.
           MOVE '00' TO FIO-STAT.
           GO TO FIN-FND-KEY.
      *>>>>
*% END
*% IF PFS_GET_CON OR PFS_GET_ACC
      *<<<< PFS_GET_CON OR PFS_GET_ACC
           IF NOT ( FRM-FFLD = FRM-FFLD-PF6
                          OR   FRM-FFLD-PF5
                  )
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       RST-STAT SECTION.
       INI-RST-STAT.
           MOVE SCR-STPP     TO SCR-STAT.
           MOVE SCR-MFLD-NOT TO SCR-MFLD.
       FIN-RST-STAT.
           EXIT.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       PUT-TAB-CMR SECTION.
       INI-PUT-TAB-CMR.

           IF FRM-FFLD = FRM-FFLD-PF5
               SUBTRACT 1 FROM FRM-IFLD
               IF FRM-IFLD = 1
                   MOVE CMR-COD-COPD IN CMR TO
                        CMR-COD-COPD-INI IN WSS-CLV-INI
               ELSE
               IF FRM-IFLD = WSS-IMAX
                   MOVE CMR-COD-COPD IN CMR TO
                        CMR-COD-COPD-FIN IN WSS-CLV-FIN
               ELSE
                   NEXT SENTENCE
           ELSE
               ADD 1 TO WSS-POS-ACT
               IF ACUMULA AND WSS-POS-ACT > WSS-IMAX
      *        SOLO ACUMULA, SIN DESPLEGAR
                   GO TO DSPL-O-ACUM
               ELSE
                   ADD 1 TO FRM-IFLD
                   IF FRM-IFLD = 1
                       MOVE CMR-COD-COPD IN CMR TO
                            CMR-COD-COPD-INI IN WSS-CLV-INI
                       MOVE CMR-COD-COPD IN CMR TO
                            CMR-COD-COPD-FIN IN WSS-CLV-FIN
                   ELSE
                   IF FRM-IFLD NOT > WSS-IMAX
                       MOVE CMR-COD-COPD IN CMR TO
                            CMR-COD-COPD-FIN IN WSS-CLV-FIN.

           MOVE CMR-VAL-CAPT IN CMR TO FRM-VAL-CAPI IN
                                                CMR-FLD (FRM-IFLD).
           MOVE CMR-NUM-TDOC IN CMR TO FRM-NUM-CDOC IN
                                                CMR-FLD (FRM-IFLD).
           MOVE CMR-VAL-INTE IN CMR TO FRM-VAL-INTE IN
                                                CMR-FLD (FRM-IFLD).


      *BUS-TAB busca glosa de codigo en tabla
           MOVE 'TAB'               TO FIO-SIST.
           MOVE 'TIO'               TO TAB-COD-TTAB IN TAB.
           MOVE CMR-COD-TOPD IN CMR TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO WSS-GLS-ABR1 IN WSS-VARI
           ELSE
               MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-ABR1 IN WSS-VARI.

           MOVE 'TAB'               TO FIO-SIST.
           MOVE 'AUX'               TO TAB-COD-TTAB IN TAB.
           MOVE CMR-COD-COPD IN CMR TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE SPACES TO WSS-GLS-ABR2 IN WSS-VARI
           ELSE
               MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-ABR2 IN WSS-VARI.

           MOVE WSS-GLS-COPD IN WSS-VARI TO FRM-GLS-DESC IN
                                                CMR-FLD (FRM-IFLD).

       DSPL-O-ACUM.

       NXT-PUT-TAB-CMR.
           IF FRM-FFLD = FRM-FFLD-PF5
               IF FRM-IFLD > 1
                   MOVE FIO-GET-PRV TO FIO-CMND
                   MOVE 'CMR-KEY-ICMR' TO FIO-AKEY
               ELSE
                   GO TO FIN-PUT-TAB-CMR
           ELSE
           IF YA-ACUMULO
               IF FRM-IFLD < WSS-IMAX
                   MOVE 'CMR-KEY-ICMR' TO FIO-AKEY
                   MOVE FIO-GET-NXT TO FIO-CMND
               ELSE
                   GO TO FIN-PUT-TAB-CMR
           ELSE
               MOVE 'CMR-KEY-ICMR' TO FIO-AKEY
               MOVE FIO-GET-NXT TO FIO-CMND.

           PERFORM DAP-FIO-CMR.
           MOVE CMR-KEY-ICMR IN CMR TO CMR-KEY-ICMR IN WSS-VARI.
           IF FIO-STAT-OKS AND
               CMR-KEY-IPAD IN CMA-VARI = CMR-KEY-IPAD IN WSS-VARI
               GO TO INI-PUT-TAB-CMR.

       FIN-PUT-TAB-CMR.
           EXIT.

       LIM-RES-LIN SECTION.
       INI-LIM-RES-LIN.

           MOVE SPACES TO FRM-GLS-DESC IN CMR-FLD(FRM-IFLD).

           MOVE ZEROES TO FRM-VAL-CAPI IN CMR-FLD (FRM-IFLD),
                          FRM-NUM-CDOC IN CMR-FLD (FRM-IFLD),
                          FRM-VAL-INTE IN CMR-FLD (FRM-IFLD).
           ADD 1 TO FRM-IFLD.
       FIN-LIM-RES-LIN.
           EXIT.

       COPY GNSBGVSM.
       COPY GNSBHVSM.
      *>>>>
*% END
*% IF PFS_SCR_GIKY
      *<<<<
               MOVE 'PFSINV    ' TO MSG-COD-MENS                        
               MOVE 'GNS' TO MSG-COD-SIST                               
               PERFORM GET-MSG                                          
               MOVE MSG-GLS-DESC TO FRM-MENS                            
               PERFORM FST-KEY-CMR                                      
               PERFORM SCR-MSSG                                         
               PERFORM SCR-PUTA                                         
               PERFORM SCR-EXIT.                                        
           MOVE FRM-DFLD TO CMR-FLD.                                    
           IF FRM-STAT-ABT                                              
               GO TO FIN-SCR-GIKY.                                      
           MOVE FRM-SUAR-OKS TO FRM-SUAR.                               
           PERFORM VAL-NUM-IKY-CMR.                                     
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR               
               PERFORM SCR-MSSG                                         
               PERFORM EDT-IKY-CMR                                      
               PERFORM SCR-PUTA                                         
               PERFORM SCR-EXIT.                                        
      *JSS                                                              
           PERFORM CLR-FLD-CMR.                                         
           PERFORM VAL-IKY-CMR.                                         
           IF FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR               
               GO TO ERR-SCR-GIKY.                                      
           PERFORM VAL-CON-IKY-CMR.                                     
           IF NOT ( FRM-SUAR EQUAL FRM-SUAR-MAL OR FRM-SUAR-CLR )       
               GO TO FIN-SCR-GIKY.                                      
           IF FRM-UCUR NOT > SPACES                                     
               PERFORM FST-KEY-CMR.                                     
       ERR-SCR-GIKY.                                                    
           PERFORM SCR-MSSG.                                            
           PERFORM EDT-IKY-CMR.                                         
           PERFORM SCR-PUTA.                                            
           PERFORM SCR-EXIT.                                            
           GO TO FIN-SCR-GIKY.
      *>>>>
*% END
*% IF INI_HBL_IKY
      *<<<<
           IF SCR-DESDE-CMN                                             
               MOVE CMR-GLS-MENS TO FRM-MENS                            
               MOVE LOW-VALUES TO CMR-FLD                               
               MOVE FRM-MENS TO CMR-GLS-MENS.                           
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.                           
           PERFORM PRO-MKY-CMR.                                         
           PERFORM PRO-AKY-CMR.                                         
           PERFORM UNP-IKY-CMR.                                         
           PERFORM FST-KEY-CMR.                                         
           MOVE '1' TO FRM-CPIM-AEY.                                    
           GO TO FIN-HBL-IKY.
      *>>>>
*% END
*% IF INI_HBL_KEY
      *<<<<
           IF SCR-DESDE-CMN                                             
               MOVE CMR-GLS-MENS TO FRM-MENS                            
               MOVE LOW-VALUES TO CMR-FLD                               
               MOVE FRM-MENS TO CMR-GLS-MENS.                           
           MOVE FRM-CPSF-AEY TO FRM-CPIM-AEY.                           
           PERFORM UNP-KEY-CMR.                                         
           PERFORM FST-KEY-CMR.                                         
           MOVE '1' TO FRM-CPIM-AEY.                                    
           GO TO FIN-HBL-KEY.
      *>>>>
*% END
