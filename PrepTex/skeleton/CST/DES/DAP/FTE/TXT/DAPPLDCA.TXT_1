*%! Codigo adicional para archivo DCA
*% IF CMT_ID
      *<<<< CMT_ID
      * JVM:01/10/92 Se elimino Ind. Renovabilidad 
      *              Se ordena informe por Serial  
      *              Se incorpora Tasa Periodo y PLazo OPD
      * ==>>  13-APR-1993 14:04:17 APARICION DE RENOVABLES
      *                   RENOVADOS POR BGEN
      * ==>>  17-APR-1993 17:28:19 VENCIDOS EN UF, DEBEN APARECER EN$ A
      *                   FECHA DE VENCIMIENTO
      * ==>>   5-MAY-1993 17:34:22 VENCIDOS EN UF, DEBEN APARECER EN$ A
      *                   FECHA DE VENCIMIENTO
      *        SACO TODAS LAS OPD MULTIPLICANDOLAS, MULTIPLICABA SIEMPRE
      * ==>>   28-JUL-1993 10:33:00 SE ELIMINAN DISPLAY INFORMATIVOS
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
      *Entidades de GNS
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGCPT.
       COPY GNSWGPES.
      *Entidades de TAB
       COPY TABBRCAM.
       COPY TABBROFI.
       COPY TABBRVLR.
      *Entidades de DAP
       COPY DAPBRRCC.
       COPY DAPBRVEN.
       COPY DAPBRLIQ.
      *Entidades de SGC
       COPY SGCBRDBC.

       01  SCR-VARI.
           02 SCR-SON-S                              PIC X(01).
       01  WSS-VARI.
           03  WSS-FEC-FPRI.
               05  WSS-NUM-DPRI                      PIC 9(02).
               05  WSS-NUM-MPRI                      PIC 9(02).
               05  WSS-NUM-SPRI                      PIC 9(02).
               05  WSS-NUM-APRI                      PIC 9(02).

      * RESPLADA LLAVE DE OPD Y SU SEWRIAL
           03  BKP-CIC-ISER  VALUE SPACES            PIC X(12).
           03  BKP-CIC-IOPD  VALUE SPACES            PIC X(12).
           03  WSS-OPD-VAL-CAPT                    PIC S9(11)V9(4).

      * FECHA DE INICIO DE RECORRIDO
           03  WSS-FEC-FIRE.
               05  WSS-NUM-DIRE                      PIC 9(02).
               05  WSS-NUM-MIRE                      PIC 9(02).
               05  WSS-NUM-SIRE                      PIC 9(02).
               05  WSS-NUM-AIRE                      PIC 9(02).

      * FECHA DE TERMINO DE RECORRIDO
           03  WSS-FEC-FTRE.
               05  WSS-NUM-STRE                      PIC 9(02).
               05  WSS-NUM-ATRE                      PIC 9(02).
               05  WSS-NUM-MTRE                      PIC 9(02).
               05  WSS-NUM-DTRE                      PIC 9(02).

      * FECHA DE PROCESO
           03  WSS-FEC-FPRO.
               05  WSS-NUM-SPRO                      PIC 9(02).
               05  WSS-NUM-APRO                      PIC 9(02).
               05  WSS-NUM-MPRO                      PIC 9(02).
               05  WSS-NUM-DPRO                      PIC 9(02).


      *     03  WSS-FEC-FFIN.
      *         05  WSS-NUM-DFIN                      PIC 9(02).
      *         05  WSS-NUM-MFIN                      PIC 9(02).
      *         05  WSS-NUM-SFIN                      PIC 9(02).
      *         05  WSS-NUM-AFIN                      PIC 9(02).

             03  WSS-COD-0999        VALUE SPACES    PIC X(06).
             03  WSS-COD-0998        VALUE SPACES    PIC X(06).
             03  WSS-COD-OFIC                        PIC X(03).
             03  WSS-COD-COPD                        PIC X(06).
             03  WSS-COD-VCAM                        PIC X(06).
             03  WSS-COD-VIGE                        PIC X(01).
             03  WSS-NUM-NOPO        VALUE ZEROES    PIC 9(05).
             03  WSS-NUM-NOPM        VALUE ZEROES    PIC 9(05).
             03  WSS-NUM-NOPC        VALUE ZEROES    PIC 9(05).
             03  WSS-GLS-DEST.
               05  WSS-GLS-DES1                      PIC X(20).
               05  WSS-GLS-DES2                      PIC X(20).
           03  WSS-COD-IPER.
               05  WSS-IND-IPE1                      PIC X(04).
               05  WSS-IND-IPE2                      PIC X(08).
           03  WSS-SGV-VCAM-FREA VALUE ZEROES        PIC S9(11)V9(4).
           03  WSS-SGV-VCAM-FVEN VALUE ZEROES        PIC S9(11)V9(4).
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
      *Entidades de TAB
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *Entidades de DAP
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==AUX-OPD-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-RCC-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-VEN-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-LIQ-REQA==.
      *Entidades de SGC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-DBC-REQA==.
      *>>>>
*% END
*% IF INI
      *<<<< INI
      * Captura codigo de oficina
           DISPLAY ' '.
           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.
           DISPLAY ' '.
           DISPLAY 'INGRESE FECHA DE PROCESO (DDMMSSAA) : '.
           ACCEPT  WSS-FEC-FPRI IN WSS-VARI.
           DISPLAY WSS-FEC-FPRI IN WSS-VARI.

           DISPLAY 'INGRESE COD. DE OFICINA (XXX/*)     : '.
           ACCEPT  WSS-COD-OFIC IN WSS-VARI.
           DISPLAY WSS-COD-OFIC IN WSS-VARI.

           DISPLAY 'INGRESE CODIGO MONEDA   (X(06)/*)   :  '.
           ACCEPT WSS-COD-VCAM IN WSS-VARI.
           DISPLAY WSS-COD-VCAM IN WSS-VARI.

           DISPLAY 'INGRESE CLASE OPERACION (X(06)/*)   : '.
           ACCEPT WSS-COD-COPD IN WSS-VARI.
           DISPLAY WSS-COD-COPD IN WSS-VARI.

           DISPLAY 'INGRESE COD. VIGENCIA    (S/N)      : '.
           ACCEPT WSS-COD-VIGE IN WSS-VARI.
           DISPLAY WSS-COD-VIGE IN WSS-VARI.

           DISPLAY 'FIN    CAPTURA    DE PARAMETROS'.
           DISPLAY ' '.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

      *VAL-FEC Valida Fecha de Proceso
           DISPLAY WSS-FEC-FPRI IN WSS-VARI.
           MOVE WSS-FEC-FPRI IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR VALIDACION EN FECHA DE PROCESO: '
                         WSS-FEC-FPRI '  ' FEC-MENS
               PERFORM GNS-PRO-ABT.

      * DEJA FECHA DE PROCESO EN FORMA ( SSAAMMDD )
           MOVE WSS-NUM-DPRI TO WSS-NUM-DPRO.
           MOVE WSS-NUM-MPRI TO WSS-NUM-MPRO.
           MOVE WSS-NUM-SPRI TO WSS-NUM-SPRO.
           MOVE WSS-NUM-APRI TO WSS-NUM-APRO.

      *VAL-OFI Valida Codigo de oficina
           IF WSS-COD-OFIC IN WSS-VARI > SPACES AND
              WSS-COD-OFIC IN WSS-VARI NOT = '*'
              DISPLAY WSS-COD-OFIC IN WSS-VARI
              MOVE WSS-COD-OFIC IN WSS-VARI TO OFI-COD-OFIC IN OFI
              PERFORM VAL-OFI
              IF MSG-GLS-MENS = 'COD    NEX'
                  DISPLAY ' '
                  DISPLAY ' PROCESO CANCELADO '
                  DISPLAY ' ERROR VALIDACION OFICINA: ' WSS-COD-OFIC
                  PERFORM GNS-PRO-ABT.

      *VAL-TAB Valida Codigo de moneda
           IF WSS-COD-VCAM IN WSS-VARI > SPACES AND
              WSS-COD-VCAM IN WSS-VARI NOT = '*'
              DISPLAY WSS-COD-VCAM IN WSS-VARI
              MOVE 'TAB'               TO TAB-COD-SIST
              MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
              MOVE WSS-COD-VCAM IN WSS-VARI TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              IF MSG-GLS-MENS = 'COD    NEX'
                 DISPLAY ' '
                 DISPLAY ' PROCESO CANCELADO '
                 DISPLAY ' ERROR VALIDACION COD. MONEDA: ' WSS-COD-VCAM
                 PERFORM GNS-PRO-ABT.

      *VAL-TAB Valida Clase de operacion
           IF WSS-COD-COPD IN WSS-VARI > SPACES AND
              WSS-COD-COPD IN WSS-VARI NOT = '*'
              DISPLAY WSS-COD-COPD IN WSS-VARI
              MOVE 'TAB'               TO TAB-COD-SIST
              MOVE 'AUX'               TO TAB-COD-TTAB IN TAB
              MOVE WSS-COD-COPD IN WSS-VARI TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              IF MSG-GLS-MENS = 'COD    NEX'
                 DISPLAY ' '
                 DISPLAY ' PROCESO CANCELADO '
                 DISPLAY ' ERROR VALIDACION CLASE OPER.: ' WSS-COD-COPD
                 PERFORM GNS-PRO-ABT.

      *Obtiene Codigo de SI/NO
           PERFORM GET-SON.
      *Valida Codigo de Vigencia
           IF WSS-COD-VIGE IN WSS-VARI = 'S' OR 'N'
               DISPLAY WSS-COD-VIGE IN WSS-VARI
           ELSE
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR VALIDACION COD. VIGENCIA: ' WSS-COD-VIGE
               PERFORM GNS-PRO-ABT.

      * Obtiene Codigo Valor de Cambio de UF Mediante CIC de la Moneda '0998'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE PDB-CIC-0998   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0998  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
               PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-0998.

      * Obtiene Codigo Valor de Cambio de Pesos Mediante CIC de la Moneda '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE PDB-CIC-0999   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
               PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-0999.

           DISPLAY 'FIN VALIDACION PARAMETROS'.

           IF WSS-COD-VIGE IN WSS-VARI = SCR-SON-S
              MOVE 'DOCUMENTOS VIGENTES' TO 
                                          WSS-GLS-DESC IN WSS-DCA
           ELSE
              MOVE 'DOCUMENTOS NO VIGENTES' TO 
                                          WSS-GLS-DESC IN WSS-DCA.

           MOVE WSS-NUM-DPRI TO WSS-NUM-DTRE IN WSS-VARI.
           MOVE WSS-NUM-MPRI TO WSS-NUM-MTRE IN WSS-VARI.
           MOVE WSS-NUM-SPRI TO WSS-NUM-STRE IN WSS-VARI.
           MOVE WSS-NUM-APRI TO WSS-NUM-ATRE IN WSS-VARI.
      *
           MOVE ZEROES TO WSS-NUM-DIRE IN WSS-VARI.
           MOVE ZEROES TO WSS-NUM-MIRE IN WSS-VARI.
           MOVE ZEROES TO WSS-NUM-SIRE IN WSS-VARI.
           MOVE ZEROES TO WSS-NUM-AIRE IN WSS-VARI.

      *     MOVE 1 TO WSS-NUM-NOPD.
      *>>>>
*% END
*% IF CF_DCA_OPD_COD_OFIC
      *<<<< CF_DCA_OPD_COD_OFIC
           MOVE WSS-NUM-NOPO IN WSS-VARI TO 
                                WSS-NUM-NOPO IN WSS-DCA.   
           MOVE ZEROES TO WSS-NUM-NOPO IN WSS-VARI. 
      *>>>>
*% END
*% IF CF_DCA_OPD_COD_COPD
      *<<<< CF_DCA_OPD_COD_COPD
           MOVE WSS-NUM-NOPC IN WSS-VARI TO 
                                WSS-NUM-NOPC IN WSS-DCA.   
           MOVE ZEROES TO WSS-NUM-NOPC IN WSS-VARI. 
      *>>>>
*% END
*% IF CF_DCA_OPD_COD_VCAM
      *<<<< CF_DCA_OPD_COD_VCAM
           MOVE WSS-NUM-NOPM IN WSS-VARI TO 
                                WSS-NUM-NOPM IN WSS-DCA.   
           MOVE ZEROES TO WSS-NUM-NOPM IN WSS-VARI. 
      *>>>>
*% END
*% IF PH_DCA
      *<<<< IF PH_DCA
      *Recupera glosa de oficina
           MOVE OPD-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI.
           PERFORM BUS-OFI.

      *Recupera glosa de moneda
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'VLR' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-VCAM IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-VCAM IN WSS-DCA.

      *Recupera glosa de operacion
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'TIO' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-TOPD IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-DES1 IN WSS-VARI.
      *
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-COPD IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-DES2 IN WSS-VARI.
           MOVE WSS-GLS-DEST IN WSS-VARI TO
                                        WSS-GLS-COPD IN WSS-DCA.
      *>>>>
*% END
*% IF FIN_FST_INP
      *<<<< FIN_FST_INP
           IF NOT FIO-STAT-OKS
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR AL ACCESAR PRIMER OPD ' FIO-STAT
               MOVE PGM-SMAL TO PGM-STAT-SRT
               GO TO FIN-INP-SRT.
      *>>>>
*% END
*% IF INI_FST_INP
      *<<<< INI_FST_INP
      *Abre otros archivos del PGM.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-DBC.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM DAP-FIO-RCC.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM DAP-FIO-VEN.

      *Genera registros en archivo SORT.
           MOVE WSS-NUM-DIRE IN WSS-VARI TO OPD-NUM-DREA IN OPD.
           MOVE WSS-NUM-MIRE IN WSS-VARI TO OPD-NUM-MREA IN OPD.
           MOVE WSS-NUM-SIRE IN WSS-VARI TO OPD-NUM-SREA IN OPD.
           MOVE WSS-NUM-AIRE IN WSS-VARI TO OPD-NUM-AREA IN OPD.

           MOVE WSS-NUM-DPRI IN WSS-VARI TO WSS-NUM-DFIN IN WSS-DCA.
           MOVE WSS-NUM-MPRI IN WSS-VARI TO WSS-NUM-MFIN IN WSS-DCA.
           MOVE WSS-NUM-SPRI IN WSS-VARI TO WSS-NUM-SFIN IN WSS-DCA.
           MOVE WSS-NUM-APRI IN WSS-VARI TO WSS-NUM-AFIN IN WSS-DCA.

      *JVM: Accesa archivo OPD por llave alternativa.
      *     MOVE 'OPD-FEC-FREA' TO FIO-AKEY.
      *     MOVE FIO-GET-NLS TO FIO-CMND.
      *     PERFORM DAP-FIO-OPD.
      *     IF NOT FIO-STAT-OKS
      *         DISPLAY ' '
      *         DISPLAY ' PROCESO CANCELADO '
      *         DISPLAY ' ERROR AL ACCESAR OPD POR OPD-FEC-FREA : '
      *                                               FIO-STAT
      *         MOVE PGM-SMAL TO PGM-STAT-SRT
      *         GO TO FIN-INP-SRT.

      *     IF OPD-FEC-FREA IN OPD > WSS-FEC-FTRE IN WSS-VARI
      *         DISPLAY ' '
      *         DISPLAY 'NO EXISTEN REGISTROS A FECHA : '
      *                              WSS-FEC-FTRE IN WSS-VARI
      *         GO TO FIN-INP-SRT
      *     ELSE
      *         GO TO LUP-INP-SRT.
      *>>>>
*% END
*% IF LUP_INP
      *<<<< LUP_INP
      *Controla ingreso de regs. vigentes o no vigentes validos
           IF WSS-COD-OFIC IN WSS-VARI > SPACES AND
              WSS-COD-OFIC IN WSS-VARI NOT = '*'
              IF WSS-COD-OFIC IN WSS-VARI NOT = OPD-COD-OFIC IN OPD
                 GO TO NXT-INP-SRT.

           IF WSS-COD-COPD IN WSS-VARI > SPACES AND
              WSS-COD-COPD IN WSS-VARI NOT = '*'
              IF WSS-COD-COPD IN WSS-VARI NOT = OPD-COD-COPD IN OPD
                 GO TO NXT-INP-SRT.

           IF WSS-COD-VCAM IN WSS-VARI > SPACES AND
              WSS-COD-VCAM IN WSS-VARI NOT = '*'
              IF WSS-COD-VCAM IN WSS-VARI NOT = OPD-COD-VCAM IN OPD
                 GO TO NXT-INP-SRT.

      * DEJA AFUERA LAS '1XXX' Y LAS RENOVABLES LIQUIDADAS
           IF OPD-COD-STAT IN OPD = 'L' AND
              OPD-COD-RENO = SCR-SON-S 
      *          DISPLAY OPD-CIC-IOPD IN OPD ' '
      *                  'OPD RECHAZADA: RENOVABLE LIQUIDADO'
                GO TO NXT-INP-SRT.

      * OPERACIONES FIJAS PAGADAS
           IF OPD-COD-STAT IN OPD = 'L' AND
              OPD-COD-SCTB IN OPD = 'CAN'
      *          DISPLAY OPD-CIC-IOPD IN OPD ' '
      *                  'OPD RECHAZADA: PAGADO'
                GO TO NXT-INP-SRT.

      * OPERACIONES VIGENTES EN BUSQUEDA DE VENCIDOS
           IF OPD-COD-STAT IN OPD = 'G' AND
              WSS-COD-VIGE IN WSS-VARI NOT = SCR-SON-S
      *          DISPLAY OPD-CIC-IOPD IN OPD ' '
      *                  'OPD RECHAZADA: VIGENTE EN PROCESO DE VENCIDOS'
                GO TO NXT-INP-SRT.

      * OPERACIONES CON ESTADO INVALIDO
           IF OPD-COD-STAT IN OPD NOT = 'G' AND
              OPD-COD-STAT IN OPD NOT = 'L'
      *          DISPLAY OPD-CIC-IOPD IN OPD ' '
      *                  'OPD RECHAZADA: ESTADO '
      *                   OPD-COD-STAT IN OPD ' INVALIDO'
                GO TO NXT-INP-SRT.

      *Obtiene Valor Final,Capital y f. Vencto desde VEN
           MOVE OPD-CIC-IOPD IN OPD TO VEN-CIC-IOPD IN VEN.
           MOVE '001'               TO VEN-NUM-IVEN IN VEN.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM DAP-FIO-VEN.
           IF NOT FIO-STAT-OKS
              MOVE ZEROES TO WSS-VAL-CAPI IN WSS-DCA
              MOVE ZEROES TO WSS-VAL-FINA IN WSS-DCA
              MOVE ZEROES TO WSS-VAL-INTE IN WSS-DCA
              MOVE ZEROES TO WSS-NUM-DVEN IN WSS-DCA
              MOVE ZEROES TO WSS-NUM-MVEN IN WSS-DCA
              MOVE ZEROES TO WSS-NUM-SVEN IN WSS-DCA
              MOVE ZEROES TO WSS-NUM-AVEN IN WSS-DCA
      *          DISPLAY OPD-CIC-IOPD IN OPD ' '
      *                  'OPD RECHAZADA: NO EXISTE VENCIMIENTO '
                GO TO NXT-INP-SRT.

           IF VEN-COD-STAT IN VEN = 'N'
      *         DISPLAY OPD-CIC-IOPD ' REVERSA RENOVABLE'
               MOVE OPD-CIC-IOPD IN OPD TO BKP-CIC-IOPD
               MOVE OPD-CIC-ISER IN OPD TO BKP-CIC-ISER
               MOVE OPD-VAL-CAPT IN OPD TO WSS-OPD-VAL-CAPT
               MOVE OPD-CIC-GREN IN OPD TO OPD-CIC-IOPD IN OPD
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM DAP-FIO-OPD
               IF NOT FIO-STAT-OKS
                   DISPLAY ' '
                   DISPLAY ' PROCESO CANCELADO '
                   DISPLAY ' NO EXISTE OPD PARA VEN-RENOVABLE : '
                        VEN-CIC-IOPD IN VEN ' FS: '  FIO-STAT
                   PERFORM GNS-PRO-ABT
               ELSE
                   MOVE BKP-CIC-IOPD TO OPD-CIC-IOPD IN OPD
                   MOVE BKP-CIC-ISER TO OPD-CIC-ISER IN OPD

                   MOVE OPD-VAL-CAPT IN OPD TO OPD-VAL-SCAP IN OPD
                                               VEN-VAL-CAPI IN VEN
                                               VEN-VAL-SCAP IN VEN

                   MOVE WSS-OPD-VAL-CAPT    TO VEN-VAL-FINA IN VEN
                                               VEN-VAL-SFIN IN VEN

                   MOVE 'G' TO OPD-COD-STAT IN OPD.


           IF OPD-COD-STAT IN OPD = 'L'
               MOVE OPD-CIC-IOPD IN OPD TO LIQ-CIC-IOPD IN LIQ
               MOVE '001' TO LIQ-NUM-ILIQ IN LIQ
               MOVE FIO-GET-KEY TO FIO-CMND
               PERFORM DAP-FIO-LIQ
               IF NOT FIO-STAT-OKS
      *             DISPLAY OPD-CIC-IOPD IN OPD ' '
      *                  'OPD RECHAZADA: FIJO LIQUIDADO SIN LIQ'
                   GO TO NXT-INP-SRT
               ELSE
               IF OPD-FEC-FTER IN OPD > WSS-FEC-FPRO
      *             DISPLAY OPD-CIC-IOPD ' REVERSA FIJO'
                   MOVE 'G' TO OPD-COD-STAT IN OPD
                   MOVE OPD-VAL-CAPT TO OPD-VAL-SCAP IN OPD
                   MOVE VEN-VAL-FINA IN VEN TO VEN-VAL-SFIN IN VEN
                   MOVE VEN-VAL-CAPI IN VEN TO VEN-VAL-SCAP IN VEN.

           IF OPD-COD-STAT IN OPD = 'G' AND
              WSS-COD-VIGE IN WSS-VARI NOT = SCR-SON-S
      *        DISPLAY OPD-CIC-IOPD ' OPERACION RECHAZADA ESTADO G '
      *                             ' Y REPORTE NO VIGENTES'
              GO TO NXT-INP-SRT
           ELSE
           IF OPD-COD-STAT IN OPD = 'L' AND
              WSS-COD-VIGE IN WSS-VARI = SCR-SON-S
      *        DISPLAY OPD-CIC-IOPD ' OPERACION RECHAZADA ESTADO L '
      *                             ' Y REPORTE VIGENTES'
              GO TO NXT-INP-SRT.

           MOVE 1      TO SRT-NUM-NOPD IN SRT.
           IF WSS-COD-VIGE IN WSS-VARI = SCR-SON-S
               MOVE OPD-VAL-SCAP IN OPD TO WSS-VAL-CAPI IN WSS-DCA
               MOVE VEN-VAL-SFIN IN VEN TO WSS-VAL-FINA IN WSS-DCA
               MOVE VEN-NUM-DVEN IN VEN TO WSS-NUM-DVEN IN WSS-DCA
               MOVE VEN-NUM-MVEN IN VEN TO WSS-NUM-MVEN IN WSS-DCA
               MOVE VEN-NUM-SVEN IN VEN TO WSS-NUM-SVEN IN WSS-DCA
               MOVE VEN-NUM-AVEN IN VEN TO WSS-NUM-AVEN IN WSS-DCA
               IF VEN-VAL-IDNI IN VEN > ZEROES
                  ADD VEN-VAL-IDNI IN VEN  VEN-VAL-SFIN IN VEN
                      GIVING WSS-VAL-INTE IN WSS-DCA
                  MOVE 1      TO SRT-NUM-NOPD IN SRT
               ELSE
                  SUBTRACT VEN-VAL-SFIN IN VEN FROM 
                  VEN-VAL-SCAP IN VEN GIVING WSS-VAL-INTE IN WSS-DCA
                  MOVE 1      TO SRT-NUM-NOPD IN SRT
           ELSE
               MOVE LIQ-SGV-CAPI IN LIQ TO WSS-VAL-CAPI IN WSS-DCA
               MOVE LIQ-SGV-TPAG IN LIQ TO WSS-VAL-FINA IN WSS-DCA
               MOVE LIQ-NUM-DREA IN LIQ TO WSS-NUM-DVEN IN WSS-DCA
               MOVE LIQ-NUM-MREA IN LIQ TO WSS-NUM-MVEN IN WSS-DCA
               MOVE LIQ-NUM-SREA IN LIQ TO WSS-NUM-SVEN IN WSS-DCA
               MOVE LIQ-NUM-AREA IN LIQ TO WSS-NUM-AVEN IN WSS-DCA
               SUBTRACT LIQ-SGV-TPAG IN LIQ FROM 
                   LIQ-SGV-CAPI IN LIQ GIVING WSS-VAL-INTE IN WSS-DCA
               PERFORM VCD-VCAM.

      *     IF WSS-COD-VIGE = SCR-SON-S AND
      *        VEN-COD-STAT IN VEN = 'N'
      *        IF VEN-FEC-FVEN IN VEN NOT < WSS-FEC-FTRE IN WSS-VARI
      *           PERFORM BUS-OPD-HST
      *           GO TO MOV-INP-SRT
      *        ELSE
      *           DISPLAY ' '
      *           DISPLAY 'FALTA PROCESAR BGEN PARA REGISTRO ' 
      *                                   VEN-KEY-IVEN IN VEN
      *           GO TO NXT-INP-SRT. 

      *>>>>
*% END
*% IF INI_NXT_INP
      *<<<< INI_NXT_INP
      *Ubica registro en OPD por fecha
      *     DISPLAY 'ISP 1 OPERACION : ' OPD-CIC-IOPD IN OPD.
           PERFORM REC-OPD.
      *     DISPLAY 'ISP 2 OPERACION : ' OPD-CIC-IOPD IN OPD.
      *     MOVE 'OPD-FEC-FREA' TO FIO-AKEY.
      *>>>>
*% END
*% IF FIN_NXT_INP
      *<<<< FIN_NXT_INP
      *Controla ingreso de registros por fecha termino
      *     IF OPD-FEC-FREA IN OPD > WSS-FEC-FTRE IN WSS-VARI
      *        GO TO FIN-INP-SRT.
      *>>>>
*% END
*% IF LUP_OUT
      *<<<< LUP_OUT
      *Limpia FIO-AKEY para lectura de otros archivos
           MOVE SPACES TO FIO-AKEY.
      *Genera glosas,datos de clientes y tasa de interes  

      *     DISPLAY 'ISP 3 OPERACION : ' OPD-CAI-IOPD IN SRT
      *                                  OPD-IIC-IOPD IN SRT.
           MOVE OPD-CAI-IOPD IN SRT TO RCC-CAI-IOPD IN RCC.
           MOVE OPD-IIC-IOPD IN SRT TO RCC-IIC-IOPD IN RCC.
           MOVE 'RCC-KEY-IOPD' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM DAP-FIO-RCC.
           IF FIO-STAT-OKS
              PERFORM GET-RCC-DBC
           ELSE
              PERFORM RST-DBC.

      *Recupera glosa de tasa
           MOVE 'TAB'        TO TAB-COD-SIST.
           MOVE 'INT'        TO TAB-COD-TTAB IN TAB.            
           MOVE OPD-COD-TINT IN SRT  TO TAB-COD-CTAB IN TAB.            
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-TINT IN WSS-DCA.

      *Carga Tasa del Periodo
           MOVE OPD-VAL-SINT IN SRT TO WSS-SGV-TPER IN WSS-DCA.           

      *Recupera glosa de Plazo 
           MOVE SPACES TO WSS-GLS-PLZO IN WSS-DCA.
           IF OPD-IND-DURV IN SRT > SPACES
              MOVE 'TAB' TO TAB-COD-SIST
              MOVE 'MSC' TO TAB-COD-TTAB IN TAB
              MOVE 'IPER'              TO WSS-IND-IPE1 IN WSS-VARI
              MOVE OPD-IND-DURV IN SRT TO WSS-IND-IPE2 IN WSS-VARI 
              MOVE WSS-COD-IPER IN WSS-VARI TO TAB-COD-CTAB IN TAB
              PERFORM BUS-TAB
              MOVE TAB-GLS-ABRV IN TAB TO WSS-GLS-PLZO IN WSS-DCA.
      *     DISPLAY 'ISP 4 OPERACION : ' OPD-CAI-IOPD IN SRT
      *                                  OPD-IIC-IOPD IN SRT.
      *>>>>
*% END
*% IF FIN_GEN_OUT
      *<<<< FIN_GEN_OUT
      *     DISPLAY 'ISP 5 OPERACION : ' OPD-CAI-IOPD IN SRT
      *                                  OPD-IIC-IOPD IN SRT.
      * Acumula numero de operaciones y totales.
           ADD SRT-NUM-NOPD IN SRT TO WSS-NUM-NOPC IN WSS-VARI
                                      WSS-NUM-NOPM IN WSS-VARI
                                      WSS-NUM-NOPO IN WSS-VARI.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       VCD-VCAM SECTION.
       INI-VCD-VCAM.
           IF OPD-COD-VCAM IN OPD = WSS-COD-0998
      * Obtiene Valor de Cambio de la UF a Fecha Ultimo dia del mes.
                MOVE VEN-FEC-FVEN IN VEN TO CAM-FEC-FCAM IN CAM(1)
                MOVE VEN-FEC-FVEN IN VEN TO CAM-FEC-FCAM IN CAM(2)
                MOVE WSS-COD-0998        TO CAM-COD-VCAM IN CAM(1)
                MOVE WSS-COD-0999        TO CAM-COD-VCAM IN CAM(2)
                MOVE FIO-GET-KEY TO FIO-CMND
                PERFORM TAB-FIO-CAM
                IF NOT FIO-STAT-OKS
                    DISPLAY ' '
                    DISPLAY OPD-CIC-IOPD IN OPD ' PARA ESTA OPERACION '
                            'NO EXISTE VALOR DE CAMBIO A FECHA : '
                         VEN-NUM-DVEN IN VEN
                         VEN-NUM-MVEN IN VEN
                         VEN-NUM-SVEN IN VEN
                         VEN-NUM-AVEN IN VEN ' PARA LA UF.'
                ELSE
                IF CAM-IND-VIGE NOT = 'S'
                    DISPLAY ' '
                    DISPLAY OPD-CIC-IOPD IN OPD ' PARA ESTA OPERACION '
                            'NO VIGENTE VALOR DE CAMBIO A FECHA : '
                         VEN-NUM-DVEN IN VEN
                         VEN-NUM-MVEN IN VEN
                         VEN-NUM-SVEN IN VEN
                         VEN-NUM-AVEN IN VEN ' PARA LA UF.'
                    DISPLAY ' '
                ELSE
                    MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-VCAM-FVEN.

           IF OPD-COD-VCAM IN OPD = WSS-COD-0998
      * Obtiene Valor de Cambio de la UF a Fecha Ultimo dia del mes.
                MOVE OPD-FEC-FREA IN OPD TO CAM-FEC-FCAM IN CAM(1)
                MOVE OPD-FEC-FREA IN OPD TO CAM-FEC-FCAM IN CAM(2)
                MOVE WSS-COD-0998        TO CAM-COD-VCAM IN CAM(1)
                MOVE WSS-COD-0999        TO CAM-COD-VCAM IN CAM(2)
                MOVE FIO-GET-KEY TO FIO-CMND
                PERFORM TAB-FIO-CAM
                IF NOT FIO-STAT-OKS
                    DISPLAY ' '
                    DISPLAY OPD-CIC-IOPD IN OPD ' PARA ESTA OPERACION '
                            'NO EXISTE VALOR DE CAMBIO A FECHA : '
                         OPD-NUM-DREA IN OPD
                         OPD-NUM-MREA IN OPD
                         OPD-NUM-SREA IN OPD
                         OPD-NUM-AREA IN OPD ' PARA LA UF.'
                ELSE
                IF CAM-IND-VIGE NOT = 'S'
                    DISPLAY ' '
                    DISPLAY OPD-CIC-IOPD IN OPD ' PARA ESTA OPERACION '
                            'NO VIGENTE VALOR DE CAMBIO A FECHA : '
                         OPD-NUM-DREA IN OPD
                         OPD-NUM-MREA IN OPD
                         OPD-NUM-SREA IN OPD
                         OPD-NUM-AREA IN OPD ' PARA LA UF.'
                    DISPLAY ' '
                ELSE
                    MOVE CAM-SGV-VCAM IN CAM TO WSS-SGV-VCAM-FREA.


           IF OPD-COD-VCAM IN OPD = WSS-COD-0998
               MULTIPLY WSS-SGV-VCAM-FVEN BY
                          WSS-VAL-CAPI  IN WSS-DCA GIVING
                          WSS-VAL-CAPI  IN WSS-DCA ROUNDED
                    MOVE WSS-VAL-CAPI  IN WSS-DCA TO PES-SGV-DECI
                    PERFORM PES-SCTV
                    MOVE PES-SGV-ENTE TO  WSS-VAL-CAPI IN WSS-DCA.
 
           IF OPD-COD-VCAM IN OPD = WSS-COD-0998
               MULTIPLY WSS-SGV-VCAM-FVEN BY
                          WSS-VAL-FINA  IN WSS-DCA GIVING
                          WSS-VAL-FINA  IN WSS-DCA ROUNDED
                    MOVE WSS-VAL-FINA  IN WSS-DCA TO PES-SGV-DECI
                    PERFORM PES-SCTV
                    MOVE PES-SGV-ENTE TO WSS-VAL-FINA IN WSS-DCA.

           IF OPD-COD-VCAM IN OPD = WSS-COD-0998
               MULTIPLY WSS-SGV-VCAM-FVEN BY
                          WSS-VAL-INTE  IN WSS-DCA GIVING
                          WSS-VAL-INTE  IN WSS-DCA ROUNDED
                    MOVE WSS-VAL-INTE  IN WSS-DCA TO PES-SGV-DECI
                    PERFORM PES-SCTV
                    MOVE PES-SGV-ENTE TO WSS-VAL-INTE IN WSS-DCA.
       FIN-VCD-VCAM.
           EXIT.

       REC-OPD SECTION.
       INI-REC-OPD.
           IF BKP-CIC-IOPD > SPACES
                MOVE BKP-CIC-IOPD TO OPD-CIC-IOPD
                MOVE FIO-GET-KEY TO FIO-CMND
                PERFORM DAP-FIO-OPD
                MOVE SPACES TO BKP-CIC-IOPD.
       FIN-REC-OPD.
           EXIT.

      * Lee con CIC CLIENTE archivo DBC
       GET-RCC-DBC SECTION.
       INI-GET-RCC-DBC.
           MOVE RCC-CIC-ICLI IN RCC TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM SGC-FIO-DBC.
           IF NOT FIO-STAT-OKS
              PERFORM RST-DBC
           ELSE
              MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
              PERFORM CPT-BLKS
              MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC. 
       FIN-GET-RCC-DBC.
           EXIT.

      * Limpia datos cliente
       RST-DBC SECTION.
       INI-RST-DBC.
           MOVE 'CLIENTE INEXISTENTE' TO DBC-GLS-NOMC IN DBC.
           MOVE SPACES TO DBC-NUM-ICLI IN DBC.
           MOVE SPACES TO DBC-VRF-ICLI IN DBC.
       FIN-RST-DBC.
           EXIT.

      * BUS-OPD-HST SECTION.
      * INI-BUS-OPD-HST.
      *     MOVE ADR-OPD-REQA TO AUX-OPD-REQA.

      *     MOVE OPD-CAI-GREN IN OPD TO OPD-CAI-IOPD IN OPD.
      *     MOVE OPD-IIC-GREN IN OPD TO OPD-IIC-IOPD IN OPD.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM DAP-FIO-OPD.
      *     IF NOT FIO-STAT-OKS 
      *        DISPLAY ' '
      *        DISPLAY 'NO EXISTE OPD QUE RENUEVA ' 
      *                 OPD-CIC-IOPD IN OPD ' ' FIO-STAT
      *        GO TO NXT-BUS-OPD-HST.

      *     MOVE OPD-CIC-IOPD IN OPD TO VEN-CIC-IOPD IN VEN.
      *     MOVE '001'               TO VEN-NUM-IVEN IN VEN.
      *     MOVE FIO-GET-KEY TO FIO-CMND.
      *     PERFORM DAP-FIO-VEN.
      *     IF NOT FIO-STAT-OKS 
      *        DISPLAY ' '
      *        DISPLAY 'NO EXISTE VEN PARA OPD QUE RENUEVA ' 
      *                 OPD-CIC-IOPD IN OPD ' ' FIO-STAT
      *        GO TO NXT-BUS-OPD-HST.

      * Documentos vigentes
      *     MOVE VEN-VAL-CAPI IN VEN TO
      *                             WSS-VAL-CAPI IN WSS-DCA.
      *     MOVE VEN-VAL-FINA IN VEN TO
      *                             WSS-VAL-FINA IN WSS-DCA.
      *     MOVE VEN-NUM-DVEN IN VEN TO
      *                             WSS-NUM-DVEN IN WSS-DCA.
      *     MOVE VEN-NUM-MVEN IN VEN TO
      *                             WSS-NUM-MVEN IN WSS-DCA.
      *     MOVE VEN-NUM-SVEN IN VEN TO
      *                             WSS-NUM-SVEN IN WSS-DCA.
      *     MOVE VEN-NUM-AVEN IN VEN TO
      *                             WSS-NUM-AVEN IN WSS-DCA.
      *     SUBTRACT VEN-VAL-FINA IN VEN FROM 
      *              VEN-VAL-CAPI IN VEN GIVING 
      *                             WSS-VAL-INTE IN WSS-DCA.
      *     MOVE 1      TO SRT-NUM-NOPD IN SRT.
 
      * NXT-BUS-OPD-HST.
      *      MOVE AUX-OPD-REQA   TO ADR-OPD-REQA.
      *     MOVE FIO-KDEF-S     TO FIO-KDEF.
      * FIN-BUS-OPD-HST.
      *     EXIT.

       GET-SON SECTION.
       INI-GET-SON.
           MOVE 'GNS' TO TAB-COD-SIST.
           MOVE 'SON' TO TAB-CIC-TTAB IN TAB.
           MOVE 'S'   TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           PERFORM VAL-TAB.
           IF MSG-COD-MENS > SPACES
               DISPLAY ' '
               DISPLAY ' PROCESO CANCELADO '
               DISPLAY ' ERROR VALIDACION GET-SON ' 
                         TAB-COD-CTAB IN TAB
               PERFORM GNS-PRO-ABT
           ELSE
               MOVE TAB-COD-CTAB IN TAB TO SCR-SON-S.
       FIN-GET-SON.
           EXIT.

      *Entidades  de GNS
       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBBMSG.
       COPY GNSBVTAB.
       COPY GNSBBTAB.
       COPY GNSBGCPT.
       COPY GNSBGPES.

      *Entidades  de SGC
       COPY SGCBFDBC.

      *Entidades  de DAP
       COPY DAPBFRCC.
       COPY DAPBFVEN.
       COPY DAPBFLIQ.

      *Entidades  de TAB
       COPY TABBFCAM.
       COPY TABBFOFI.
       COPY TABBBOFI.
       COPY TABBVOFI.
      *>>>>
*% END
