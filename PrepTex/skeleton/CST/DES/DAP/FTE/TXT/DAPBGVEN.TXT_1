       GEN-PRX-RTR SECTION.
       INI-GEN-PRX-RTR.
      *     DISPLAY '                *****************' FIO-CMND.
      *     DISPLAY 'DAPBGVEN INICIO *****************'.
      * POR DEFAULT
           MOVE SPACES TO MSG-COD-MENS.
      
           MOVE DAP-VEN-SOKS TO DAP-VEN-STAT.
      *     DISPLAY 'DAPBGVEN 01'.
      
           IF FIO-CMND = FIO-GET-KEY AND
              OPD-NUM-IVEN IN OPD = 1
                MOVE FIO-GET-FST TO FIO-CMND.
      
      
           IF FIO-CMND = FIO-GET-FST
                MOVE OPD-FEC-FREA IN OPD TO VEN-FEC-FVEN IN VEN.
      
           IF FIO-CMND = FIO-GET-FST
                COMPUTE OPD-NUM-VNLQ IN OPD =
                        OPD-NUM-VNLQ IN OPD +
                        OPD-NUM-VSLQ IN OPD
                MOVE ZEROES TO OPD-NUM-VSLQ.
      
      *     DISPLAY 'DAPBGVEN 02'.
      
           COMPUTE DAP-VEN-VCTO =
                OPD-NUM-VNLQ IN OPD +
                OPD-NUM-VSLQ IN OPD.
      
           IF FIO-CMND = FIO-GET-FST
                MOVE 1 TO OPD-NUM-IVEN IN OPD
           ELSE
           IF FIO-CMND = FIO-GET-KEY
                SUBTRACT 1 FROM OPD-NUM-IVEN IN OPD
           ELSE
           IF FIO-CMND = FIO-GET-NXT
               ADD 1 TO OPD-NUM-IVEN IN OPD
               IF OPD-NUM-IVEN IN OPD > DAP-VEN-VCTO
                   MOVE DAP-VEN-SEOF TO DAP-VEN-STAT
                   GO TO FIN-GEN-PRX-RTR.
      *           DISPLAY 'DAPBGVEN 03'.
      * VENCIMIENTO A GENERAR ES EL PRIMERO
           IF FIO-CMND = FIO-GET-FST
                MOVE OPD-NUM-DREA IN OPD TO FEC-ITM1
                MOVE OPD-NUM-MREA IN OPD TO FEC-ITM2
                MOVE OPD-NUM-SREA IN OPD TO FEC-ITM3
                MOVE OPD-NUM-AREA IN OPD TO FEC-ITM4
      
                MOVE OPD-IND-PVEN IN OPD TO MSC-COD-CMSC IN MSC
                PERFORM DAP-OBT-CIC-PER
                MOVE OPD-NUM-PVEN IN OPD TO DAP-VEN-NPER
                PERFORM DAP-SEL-PER
                PERFORM FPVC-RET-1
                MOVE FEC-ITM1 TO DAP-VEN-DVEN
                MOVE FEC-ITM2 TO DAP-VEN-MVEN
                MOVE FEC-ITM3 TO DAP-VEN-SVEN
                MOVE FEC-ITM4 TO DAP-VEN-AVEN
      
      *          MOVE OPD-FEC-FPVC IN OPD TO DAP-VEN-FVEN
                GO TO BUS-TINT
           ELSE
      * VENCIMIENTO A GENERAR ES EL VIGENTE
           IF FIO-CMND = FIO-GET-KEY
                MOVE VEN-FEC-FVEN IN VEN TO DAP-VEN-FVEN
           ELSE
      * VENCIMIENTO A GENERAR ES EL ULTIMO ?
           IF OPD-NUM-VNLQ IN OPD = 1
                MOVE OPD-FEC-FTER IN OPD TO DAP-VEN-FVEN
                GO TO BUS-TINT.
      *     DISPLAY 'DAPBGVEN 04'.
      * FEC-FVEN(I+1) = SEVE * ( TVEN - 1 ) + FEC-PVEN
      
           MOVE OPD-NUM-DREA IN OPD TO FEC-ITM1.
           MOVE OPD-NUM-MREA IN OPD TO FEC-ITM2.
           MOVE OPD-NUM-SREA IN OPD TO FEC-ITM3.
           MOVE OPD-NUM-AREA IN OPD TO FEC-ITM4.
      
           MOVE OPD-IND-PVEN IN OPD TO MSC-COD-CMSC IN MSC.
           PERFORM DAP-OBT-CIC-PER.
           MOVE OPD-NUM-PVEN IN OPD TO DAP-VEN-NPER.
           PERFORM DAP-SEL-PER.
      *     DISPLAY 'DAPBGVEN 05'.
      * EN ESTE PUNTO TENEMOS FECHA PRIMER VCTO EN FEC-FECH
      
           SUBTRACT 1 FROM OPD-NUM-IVEN IN OPD GIVING DAP-VEN-TVEN-1.
           MULTIPLY DAP-VEN-TVEN-1 BY OPD-NUM-SEVE IN OPD
                                               GIVING DAP-VEN-DURV-1.
      
           MOVE OPD-IND-SEVE IN OPD TO MSC-COD-CMSC IN MSC.
           PERFORM DAP-OBT-CIC-PER.
           MOVE DAP-VEN-DURV-1      TO DAP-VEN-NPER.
           PERFORM DAP-SEL-PER.
      *     DISPLAY 'DAPBGVEN 06'.
           IF OPD-COD-AFER IN OPD NOT = 'S'
              GO TO SET-FVEN.
      *     DISPLAY 'DAPBGVEN 07'.
      * BUSCA HABIL SIGUIENTE
      
       CIC-GEN-PRX-RTR.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-HBL
               MOVE FEC-FORM-FEC TO FEC-FORM
               MOVE FEC-SUM-DIA  TO FEC-CMND
               MOVE 1            TO FEC-NDIA
               PERFORM CAL-FEC
               GO TO CIC-GEN-PRX-RTR.
      
       SET-FVEN.
           MOVE FEC-ITM1 TO DAP-VEN-DVEN.
           MOVE FEC-ITM2 TO DAP-VEN-MVEN.
           MOVE FEC-ITM3 TO DAP-VEN-SVEN.
           MOVE FEC-ITM4 TO DAP-VEN-AVEN.
      *     DISPLAY 'DAPBGVEN 08'.
       BUS-TINT.
      *     DISPLAY 'DAPBGVEN 09'.
           MOVE VEN-NUM-DVEN IN VEN TO INT-DUNO.
           MOVE VEN-NUM-MVEN IN VEN TO INT-MUNO.
           MOVE VEN-NUM-SVEN IN VEN TO INT-SUNO.
           MOVE VEN-NUM-AVEN IN VEN TO INT-AUNO.
      
           MOVE DAP-VEN-DVEN        TO INT-DDOS.
           MOVE DAP-VEN-MVEN        TO INT-MDOS.
           MOVE DAP-VEN-SVEN        TO INT-SDOS.
           MOVE DAP-VEN-AVEN        TO INT-ADOS.
      
           MOVE OPD-COD-VCAM IN OPD TO INT-VCAM.
      
           MOVE OPD-NUM-DREA IN OPD TO INT-DCOL.
           MOVE OPD-NUM-MREA IN OPD TO INT-MCOL.
           MOVE OPD-NUM-SREA IN OPD TO INT-SCOL.
           MOVE OPD-NUM-AREA IN OPD TO INT-ACOL.
      
           MOVE OPD-NUM-DREA IN OPD TO INT-DBTV.
           MOVE OPD-NUM-DREA IN OPD TO INT-MBTV.
           MOVE OPD-NUM-DREA IN OPD TO INT-SBTV.
           MOVE OPD-NUM-DREA IN OPD TO INT-ABTV.
      
           MOVE OPD-SGV-TINT IN OPD TO INT-TINT.
      
           MOVE OPD-COD-TINT IN OPD TO INT-TIPT.
      *     DISPLAY 'DAPBGVEN 10'.
           PERFORM GNS-CAL-INT.
           IF INT-CMSG > SPACES
      *          DISPLAY 'DAPBGVEN GNS-CAL-INT 1 INT-CMSG ' INT-CMSG
      *          DISPLAY 'VEN-FEC-FVEN ' VEN-FEC-FVEN IN VEN
      *          DISPLAY 'OPD-FEC-FREA ' OPD-FEC-FREA IN OPD
      *          DISPLAY 'DAP-VEN-FVEN ' DAP-VEN-FVEN
      
      
      
      *         MOVE 'CALINTER' TO QUE-COLA
      *         MOVE +100 TO QUE-LITM
      *         MOVE INT-CMSG     TO QUE-ITEM
      *         MOVE QUE-PUT TO QUE-CMND
      *         PERFORM GNS-PRO-QUE
      
      
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE INT-CMSG TO MSG-COD-MENS
               PERFORM GET-MSG
               GO TO FIN-GEN-PRX-RTR.
      
      *    MOVE 0,00300000          TO INT-TIPE.
           MOVE INT-TIPE TO DAP-INT-TIPE.
      *     DISPLAY 'DAPBGVEN 12'.
      
           MOVE OPD-SGV-TCAS IN OPD TO INT-TINT.
      *     DISPLAY 'DAPBGVEN 13'.
           PERFORM GNS-CAL-INT.
           IF INT-CMSG > SPACES
      
      *          DISPLAY 'DAPBGVEN GNS-CAL-INT 2 INT-CMSG ' INT-CMSG
      
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE INT-CMSG TO MSG-COD-MENS
               PERFORM GET-MSG
               GO TO FIN-GEN-PRX-RTR.
      
           COMPUTE INT-TIPE ROUNDED = OPD-SGV-TCAS IN OPD / 100.
           MOVE INT-TIPE            TO DAP-INT-CAST.
      
           MOVE DAP-INT-CAST TO WSS-VAL-EDIT.
      *     DISPLAY 'DAPBGVEN : DAP-INT-CAST ' WSS-VAL-EDIT.
      
      
           MOVE SPACES TO MSG-COD-MENS.
           MOVE ZEROES TO DAP-VEN-CAPI
                          DAP-VEN-INTE
                          DAP-VEN-IDNI.
      
           MOVE OPD-VAL-SCAP IN OPD TO DAP-VEN-CAPI.
      
      
      * CALCULA CAPITAL E INTERESES
           PERFORM CAL-CAP-INT-PI.
           IF MSG-COD-MENS > SPACES
      
               MOVE 'DAP' TO MSG-COD-SIST
               PERFORM GET-MSG
               GO TO FIN-GEN-PRX-RTR.
      
       BUS-VFIN.
           MOVE ZEROES TO DAP-VEN-FINA.
      *
      
      *     MOVE DAP-VEN-INTE TO WSS-VAL-EDIT.
      *     DISPLAY 'DAPBGVEN : DAP-VEN-INTE ' WSS-VAL-EDIT.
      
           ADD DAP-VEN-INTE TO DAP-VEN-FINA.
           ADD DAP-VEN-CAPI TO DAP-VEN-FINA.
      
           MOVE DAP-VEN-IDNI TO VEN-VAL-IDNI IN VEN.
      
           MOVE DAP-VEN-CAPI TO VEN-VAL-CAPI IN VEN
                                VEN-VAL-SCAP IN VEN.
           MOVE DAP-VEN-FINA TO VEN-VAL-FINA IN VEN.
      
      *    aproximaciones de cantidades en pesos
            MOVE VEN-VAL-FINA IN VEN TO PES-SGV-DECI.
            MOVE DAP-VEN-CIC-VCAM TO PES-CIC-VCAM.
            PERFORM PES-SCTV.
            MOVE PES-SGV-ENTE TO VEN-VAL-FINA IN VEN.
      
           MOVE VEN-VAL-FINA IN VEN TO VEN-VAL-SFIN IN VEN.
      
           MOVE DAP-VEN-DVEN TO VEN-NUM-DVEN IN VEN.
           MOVE DAP-VEN-MVEN TO VEN-NUM-MVEN IN VEN.
           MOVE DAP-VEN-SVEN TO VEN-NUM-SVEN IN VEN.
           MOVE DAP-VEN-AVEN TO VEN-NUM-AVEN IN VEN.
      
           ADD 1 TO OPD-NUM-VSLQ IN OPD.
           SUBTRACT 1 FROM OPD-NUM-VNLQ IN OPD.
           ADD VEN-VAL-IDNI IN VEN TO OPD-VAL-SCAP IN OPD.
      *     DISPLAY 'DAPBGVEN : OPD-VAL-SCAP ' OPD-VAL-SCAP IN OPD.
      
       FIN-GEN-PRX-RTR.
           EXIT.
      
       CAL-CAP-INT-PI SECTION.
       INI-CAL-CAP-INT-PI.
      
      *     DISPLAY 'CAL-CAP-INT-PI OPD-NUM-VNLQ ' OPD-NUM-VNLQ IN OPD.
           IF OPD-NUM-VNLQ IN OPD = 1
               MOVE OPD-VAL-SCAP IN OPD TO DAP-VEN-CAPI
           ELSE
               MOVE ZEROES              TO DAP-VEN-CAPI.
      
      
      * CALCULO % INTERESES
      
      *     DISPLAY 'CAL-CAP-INT-PI 001 '.
      
           IF WSS-SWI-RENT-1 = 'S'
               MOVE 'N' TO WSS-SWI-RENT-1
               MOVE ZEROES TO WSS-SGV-INT-VEN-1
               MOVE ZEROES TO DAP-WSS-SGV-INTE-1
           ELSE
               MOVE DAP-WSS-SGV-INTE TO DAP-WSS-SGV-INTE-1
               MOVE DAP-VEN-INTE-1 TO WSS-SGV-INT-VEN-1.
      
      *     DISPLAY 'CAL-CAP-INT-PI 002 '.
      
           IF WSS-SWI-SOPD-1 = 'S'
               MOVE 'N' TO WSS-SWI-SOPD-1
               MOVE OPD-VAL-SCAP IN OPD TO DAP-OPD-SCAP-1
               MOVE OPD-VAL-SCAP IN OPD TO WSS-SGV-SCAP-1
           ELSE
               MOVE WSS-SGV-SCAP-1 TO DAP-OPD-SCAP-1
               MOVE OPD-VAL-SCAP IN OPD TO WSS-SGV-SCAP-1.
      
      *     DISPLAY 'CAL-CAP-INT-PI 003 '.
      
      
           IF DAP-VEN-CIC-MORE = 'PI'
      
              MULTIPLY OPD-VAL-SCAP IN OPD BY DAP-INT-TIPE
                                GIVING DAP-VEN-INTE ROUNDED
      
              MOVE DAP-VEN-INTE TO PES-SGV-DECI
              MOVE DAP-VEN-CIC-VCAM TO PES-CIC-VCAM
              PERFORM PES-SCTV
              MOVE PES-SGV-ENTE TO DAP-VEN-INTE.
      
      *     DISPLAY 'CAL-CAP-INT-PI 004 '.
      
           MOVE DAP-VEN-CAPI       TO  WSS-VAL-EDIT.
      *     DISPLAY '1 DAP-VEN-CAPI:'   WSS-VAL-EDIT ':'.
      
           MOVE DAP-VEN-INTE       TO  WSS-VAL-EDIT.
      *     DISPLAY '1 DAP-VEN-INTE:'  OPD-NUM-IVEN IN OPD ' '
      *              WSS-VAL-EDIT ':'.
           MOVE DAP-VEN-INTE TO DAP-WSS-SGV-INTE-0.
      
           MOVE OPD-VAL-SCAP IN OPD TO WSS-VAL-EDIT.
      *     DISPLAY '1 OPD-VAL-SCAP:'   WSS-VAL-EDIT ':'.
      
           MOVE DAP-VEN-INTE TO DAP-VEN-INTE-1.
      
      *     DISPLAY 'CAL-CAP-INT-PI 005 '.
      
           IF OPD-SGV-MPRE IN OPD = ZEROES
               ADD DAP-VEN-INTE TO OPD-VAL-SCAP IN OPD
               IF OPD-NUM-VNLQ IN OPD NOT = 1
                    MOVE ZEROES TO DAP-VEN-INTE.
      
      *     MOVE OPD-SGV-MPRE IN OPD       TO  WSS-VAL-EDIT.
      *     DISPLAY 'OPD-SGV-MPRE :'   WSS-VAL-EDIT ':'.
      
      *     MOVE DAP-VEN-INTE       TO  WSS-VAL-EDIT.
      *     DISPLAY '2 DAP-VEN-INTE:'   WSS-VAL-EDIT ':'.
      
      *     DISPLAY 'CAL-CAP-INT-PI 006 '.
      
           IF OPD-NUM-VNLQ IN OPD = 1
      *         ADD OPD-VAL-SCAP IN OPD TO DAP-VEN-CAPI
               MOVE ZEROES TO OPD-VAL-SCAP IN OPD.
      
      
           MOVE DAP-VEN-CAPI       TO WSS-VAL-EDIT.
      *     DISPLAY '2 DAP-VEN-CAPI:' WSS-VAL-EDIT ':'.
      
      *     DISPLAY 'CAL-CAP-INT-PI 007 '.
      
           MOVE DAP-VEN-INTE       TO WSS-VAL-EDIT.
      *     DISPLAY '2 DAP-VEN-INTE:' WSS-VAL-EDIT ':'.
      
      *     DISPLAY 'CAL-CAP-INT-PI 008 '.
      
           MOVE OPD-VAL-SCAP IN OPD TO WSS-VAL-EDIT.
      *     DISPLAY '2 OPD-VAL-SCAP:' WSS-VAL-EDIT ':'.
      
      *     DISPLAY 'CAL-CAP-INT-PI 009 '.
      
      
               IF DAP-VEN-CIC-CCDR = 'T'
                   PERFORM CAL-CAST
                   PERFORM CAL-RENT
               ELSE
      
      *             DISPLAY 'CAL-CAP-INT-PI 010 '
      
                   MOVE DAP-VEN-INTE TO DAP-VEN-IDNI
      
      *             DISPLAY 'CAL-CAP-INT-PI 011 '
      
                   MULTIPLY DAP-VEN-INTE BY OPD-SGV-MPRE IN OPD
                      GIVING DAP-VEN-INTE ROUNDED
      
      *             DISPLAY 'CAL-CAP-INT-PI 012 '
      
                   DIVIDE DAP-VEN-INTE BY 100 GIVING DAP-VEN-INTE
                     ROUNDED
      
      *             DISPLAY 'CAL-CAP-INT-PI 013 '
      
                     SUBTRACT DAP-VEN-INTE FROM DAP-VEN-IDNI GIVING
                                      DAP-VEN-IDNI
      
      
                   IF DAP-VEN-CIC-VCAM = PDB-CIC-0999
      *    aproximaciones de cantidades en pesos
                     MOVE DAP-VEN-IDNI TO PES-SGV-DECI
                     PERFORM PES-SCTV
                     MOVE PES-SGV-ENTE TO DAP-VEN-IDNI.
      
      *     DISPLAY 'CAL-CAP-INT-PI 014 '.
      
       FIN-CAL-CAP-INT-PI.
           EXIT.
      
       DAP-SEL-PER SECTION.
       INI-DAP-SEL-PER.
      * OBTIENE EN FEC-FECH LA SUMA DE UNA FECHA CARGADA EN FEC-FEC
      * + UN PERIODO ( DAP-VEN-CIC-PER Y DAP-VEN-NPER )
           IF DAP-VEN-CIC-PER = 'D'
               MOVE FEC-SUM-DIA TO FEC-CMND
               MOVE DAP-VEN-NPER TO FEC-NDIA
           ELSE
           IF DAP-VEN-CIC-PER = 'M'
               MOVE FEC-SUM-MES TO FEC-CMND
               MOVE DAP-VEN-NPER TO FEC-NMES
           ELSE
           IF DAP-VEN-CIC-PER = 'A'
               MOVE FEC-SUM-ANO TO FEC-CMND
               MOVE DAP-VEN-NPER TO FEC-NANO.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           PERFORM CAL-FEC.
       FIN-DAP-SEL-PER.
           EXIT.
      
       DAP-OBT-CIC-PER SECTION.
       INI-DAP-OBT-CIC-PER.
      * OBTIENE CIC DE UN CODIGO DE PERIODO CARGADO EN MSC-COD-CMSC
      * Y LO ENTREGA EN DAP-VEN-CIC-PER
           MOVE 'TAB'                   TO MSC-COD-SIST.
           MOVE 'IPER'                  TO MSC-COD-TMSC IN MSC.
           PERFORM BUS-MSC.
           MOVE MSC-CIC-CMSC IN MSC     TO DAP-VEN-CIC-PER.
       FIN-DAP-OBT-CIC-PER.
           EXIT.
      
       GET-COD-CIC-OPD SECTION.
       INI-GET-COD-CIC-OPD.
      *    OBTIENE VALOR VALOR DE CAMBIO PARA POSIBLE MONEDA REAJUSTABLE
      *    ES DECIR, CHILENA Y NO PESOS
           MOVE 'TAB'               TO TAB-COD-SIST.
           MOVE 'VLR'               TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-VCAM IN OPD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-TAB.
      *SE DEBE VERIFICAR QUE BUSQUEDA DE CODIGO DE MONEDA SEA EXITOSO
      *EXISTENTE Y VIGENTE
           IF MSG-COD-MENS > SPACES
               GO TO FIN-GET-COD-CIC-OPD.
      
           MOVE TAB-CIC-CTAB IN TAB TO DAP-VEN-CIC-VCAM.
      
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'MDR' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-MORE IN OPD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-TAB.
           IF MSG-COD-MENS > SPACES
               GO TO FIN-GET-COD-CIC-OPD.
      
           MOVE TAB-CIC-CTAB IN TAB TO DAP-VEN-CIC-MORE.
      
           MOVE 'DAP' TO TAB-COD-SIST.
           MOVE 'CDR' TO TAB-COD-TTAB IN TAB.
           MOVE OPD-COD-RESC IN OPD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-TAB.
           IF MSG-COD-MENS > SPACES
               GO TO FIN-GET-COD-CIC-OPD.
      
           MOVE TAB-CIC-CTAB IN TAB TO DAP-VEN-CIC-CCDR.
      *     MOVE 'T' TO DAP-VEN-CIC-CCDR.
       FIN-GET-COD-CIC-OPD.
           EXIT.
      
      
       CAL-CAST SECTION.
       INI-CAL-CAST.
      
      *    COMPUTE DAP-INT-EFEC = DAP-INT-TIPE -
      *                           DAP-INT-CAST.
      
           COMPUTE DAP-INT-EFEC = ( OPD-SGV-TINT IN OPD / 100 ) -
                                  DAP-INT-CAST.
      
      *    MOVE DAP-INT-TIPE TO    WSS-VAL-EDIT.
      *     DISPLAY 'DAP-INT-TIPE:' WSS-VAL-EDIT ':'.
      
           MOVE DAP-INT-CAST       TO WSS-VAL-EDIT1.
      *     DISPLAY 'DAP-INT-CAST:' WSS-VAL-EDIT ':'.
      
           MOVE DAP-INT-EFEC       TO WSS-VAL-EDIT2.
      
      *     DISPLAY 'PACT CAST EFEC:' WSS-VAL-EDIT ':'
      *     WSS-VAL-EDIT1 ':' WSS-VAL-EDIT2.
      
           COMPUTE WSS-TOT-CUO = OPD-NUM-VNLQ IN OPD +
                                 OPD-NUM-VSLQ IN OPD.
      
           COMPUTE WSS-TOT-CUO-M1 = WSS-TOT-CUO - 1.
           MOVE    WSS-TOT-CUO-M1 TO WSS-VAL-EDIT.
      *     DISPLAY 'OPD-TOT-CUO-M1 ' WSS-VAL-EDIT.
      
      
           MOVE OPD-VAL-SCAP IN OPD TO WSS-VAL-EDIT.
      *     DISPLAY 'OPD-VAL-SCAP ' WSS-VAL-EDIT.
      
           MOVE OPD-NUM-IVEN IN OPD TO WSS-VAL-EDIT.
      *     DISPLAY 'OPD-NUM-IVEN ' WSS-VAL-EDIT.
      
           MOVE WSS-TOT-CUO  TO WSS-VAL-EDIT.
      *     DISPLAY 'OPD-TOT-CUO ' WSS-VAL-EDIT.
      
      
           COMPUTE WSS-SGV-TASA = WSS-TOT-CUO - OPD-NUM-IVEN.
           MOVE WSS-SGV-TASA TO WSS-VAL-EDIT.
      *     DISPLAY ' '.
      *     DISPLAY ' TOTVEN-VLIQ               ' WSS-VAL-EDIT.
      
           COMPUTE WSS-SGV-TASA = WSS-SGV-TASA / WSS-TOT-CUO-M1.
           MOVE WSS-SGV-TASA TO WSS-VAL-EDIT.
      *     DISPLAY ' ANTER / (TVEN-1)          ' WSS-VAL-EDIT.
      
           COMPUTE WSS-SGV-TASA = WSS-SGV-TASA * DAP-INT-CAST.
           MOVE WSS-SGV-TASA TO WSS-VAL-EDIT.
      *     DISPLAY ' ANTER * TCAS              ' WSS-VAL-EDIT.
      
      
      *    COMPUTE WSS-SGV-TASA-4 ROUNDED = DAP-INT-TIPE -
      *                                     WSS-SGV-TASA.
           COMPUTE WSS-SGV-TASA-4 ROUNDED =
                                        ( OPD-SGV-TINT IN OPD / 100 ) -
                                            WSS-SGV-TASA.
           MOVE WSS-SGV-TASA-4 TO WSS-VAL-EDIT.
      *     DISPLAY ' TINT -ANTER               ' WSS-VAL-EDIT.
           MOVE WSS-SGV-TASA-4 TO WSS-SGV-TEFEC.
      
           COMPUTE WSS-SGV-TEFEC-DSP ROUNDED = ( 100 * WSS-SGV-TEFEC ).
           MOVE WSS-SGV-TEFEC-DSP TO WSS-VAL-EDIT.
      *      DISPLAY ' TASA EFECTIVA DESPLIEGUE ' WSS-VAL-EDIT.
      
      
           COMPUTE WSS-SGV-TASA = 1 + WSS-SGV-TASA-4.
           MOVE WSS-SGV-TASA TO WSS-VAL-EDIT.
      *     DISPLAY ' T1 + ANTER                ' WSS-VAL-EDIT.
      
           COMPUTE  WSS-SGV-TASA-4 ROUNDED = DAP-INT-TIPE  -
                                             WSS-SGV-TEFEC.
           MOVE WSS-SGV-TASA-4 TO WSS-SGV-TAJUS.
           MOVE WSS-SGV-TAJUS TO WSS-VAL-EDIT.
      *     DISPLAY ' TASA AJUSTE CALCULO       ' WSS-VAL-EDIT.
      
      
      
           COMPUTE  WSS-SGV-TASA-4 ROUNDED =   ( OPD-SGV-TINT IN OPD ) -
                                               ( WSS-SGV-TEFEC-DSP ).
           MOVE WSS-SGV-TASA-4 TO WSS-SGV-TAJUS-DSP.
           MOVE WSS-SGV-TAJUS-DSP TO WSS-VAL-EDIT.
      *     DISPLAY ' TASA AJUSTE DESPLIEGUE ' WSS-VAL-EDIT.
      
      
      
      
      
      *     DISPLAY 'OPD-NUM-IVEN ' OPD-NUM-IVEN IN OPD.
      
           COMPUTE DAP-WSS-SGV-INTE  ROUNDED = OPD-VAL-CAPT IN  OPD *
                                           WSS-SGV-TASA **
                                         ( OPD-NUM-IVEN IN OPD ).
           IF DAP-VEN-CIC-VCAM = PDB-CIC-0999
                MOVE DAP-WSS-SGV-INTE TO PES-SGV-DECI
                PERFORM PES-SCTV
                MOVE PES-SGV-ENTE TO DAP-WSS-SGV-INTE.
      
           MOVE DAP-WSS-SGV-INTE TO WSS-VAL-EDIT.
      *     DISPLAY ' K * ANTER ** VLIQ         ' WSS-VAL-EDIT.
      
           MOVE OPD-VAL-SCAP IN OPD TO WSS-VAL-EDIT.
      *     DISPLAY ' OPD-VAL-SCAP              ' WSS-VAL-EDIT.
      
           COMPUTE DAP-WSS-SGV-INTE =
                DAP-WSS-SGV-INTE - OPD-VAL-CAPT IN OPD.
           MOVE DAP-WSS-SGV-INTE TO WSS-VAL-EDIT.
      *     DISPLAY ' ANTER - K                 ' WSS-VAL-EDIT.
      
      
      * CALCULO MONTO CASTIGO
      
           MOVE OPD-SGV-MPRE IN OPD TO WSS-VAL-EDIT.
      *     DISPLAY 'CAL-CAST OPD-SGV-MPRE      ' WSS-VAL-EDIT.
      
           MOVE DAP-INT-CAST TO WSS-VAL-EDIT.
      *     DISPLAY 'CAL-CAST DAP-INT-CAST      ' WSS-VAL-EDIT.
      
           MOVE OPD-NUM-VNLQ IN OPD TO WSS-VAL-EDIT.
      *     DISPLAY 'CAL-CAST OPD-NUM-VNLQ      ' WSS-VAL-EDIT.
      
           MOVE OPD-NUM-VSLQ IN OPD TO WSS-VAL-EDIT.
      *     DISPLAY 'CAL-CAST OPD-NUM-VSLQ      ' WSS-VAL-EDIT.
      
           MOVE OPD-NUM-IVEN IN OPD TO WSS-VAL-EDIT.
      *     DISPLAY 'CAL-CAST OPD-NUM-IVEN      ' WSS-VAL-EDIT.
      
             IF OPD-SGV-MPRE IN OPD = ZEROES
                 MOVE ZEROES TO DAP-MTO-CAST
             ELSE
      
               COMPUTE DAP-MTO-CAST ROUNDED =
                 ( DAP-INT-CAST * (  ( OPD-NUM-VNLQ IN OPD +
                                       OPD-NUM-VSLQ IN OPD
                                     )
                                     -
                                     ( OPD-NUM-IVEN IN OPD - 1
                                     )
      
                                   )
                                   /
                                  ( ( OPD-NUM-VNLQ IN OPD +
                                      OPD-NUM-VSLQ IN OPD
                                    )
                                  -
                                     1
                                  )
                               * ( OPD-NUM-IVEN IN OPD - 1)
      *                        * DAP-OPD-SCAP-1
                               * OPD-VAL-CAPT IN OPD
                 )
               IF DAP-VEN-CIC-VCAM = PDB-CIC-0999
                   MOVE DAP-MTO-CAST TO PES-SGV-DECI
                   PERFORM PES-SCTV
                   MOVE PES-SGV-ENTE TO DAP-MTO-CAST.
      
           MOVE DAP-MTO-CAST TO WSS-VAL-EDIT.
      *     DISPLAY ' DAPBGVEN : DAP-MTO-CAST  ' WSS-VAL-EDIT.
      
             IF OPD-SGV-MPRE IN OPD = 100
                  COMPUTE DAP-MTO-LIQU =
                     OPD-VAL-CAPT IN OPD -
                     DAP-MTO-CAST
               ELSE
               COMPUTE DAP-MTO-LIQU =
                  OPD-VAL-CAPT IN OPD +
                  DAP-WSS-SGV-INTE-1.
      *             ( WSS-SGV-IACU + WSS-SGV-INT-VEN-1 -
      *               DAP-MTO-CAST ).
      *
      *            DAP-OPD-SCAP-1 + WSS-RENT-REAL-ACUM.
      *            DAP-MTO-CAST.
      *       ELSE
      *           MOVE DAP-OPD-SCAP-1 TO DAP-MTO-LIQU.
      
      *     MOVE DAP-MTO-LIQU TO WSS-VAL-EDIT.
      *     DISPLAY ' DAPBGVEN : DAP-MTO-LIQU  ' WSS-VAL-EDIT.
      
       FIN-CAL-CAST.
           EXIT.
      
       CAL-RENT SECTION.
       INI-CAL-RENT.
      *     MOVE DAP-WSS-SGV-INTE-1 TO WSS-VAL-EDIT.
      *     DISPLAY 'VEN-1 ' WSS-VAL-EDIT.
      
           COMPUTE WSS-SGV-IACU  =
                   WSS-SGV-IACU + WSS-SGV-INT-VEN-1.
      
      
      
           IF OPD-SGV-MPRE IN OPD = ZEROES
               MOVE DAP-WSS-SGV-INTE-1 TO WSS-RENT-REAL-ACUM
           ELSE
               COMPUTE WSS-RENT-REAL-ACUM  =
                   WSS-SGV-IACU -
                   DAP-MTO-CAST.
       FIN-CAL-RENT.
           EXIT.
      
       FPVC-RET-1 SECTION.
       INI-FPVC-RET-1.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-N   TO FEC-CHOY.
           MOVE FEC-VHBL-S   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-HBL
               MOVE FEC-FORM-FEC TO FEC-FORM
               MOVE FEC-SUM-DIA  TO FEC-CMND
               MOVE 1            TO FEC-NDIA
               PERFORM CAL-FEC
               GO TO INI-FPVC-RET-1.
       FIN-FPVC-RET-1.
           EXIT.
