*%! Codigo adicional programa DAPPAPOD
*% GEN_MFC = TRUE
*% IF PGM_PQ
*% CLRMFC = "DAPZQPOD"
*% ELSE
*% CLRMFC = "DAPZUPOD"
*% END
*% IF SETTAG
*% FNCPQ = "MK2MT1"
*% VSNPQ = "08.01.10"
*% FNCPU = "MK2MT1"
*% VSNPU = "08.01.10"
*% END
*% NO_HDR_CST = TRUE
*% PGM_PTC = TRUE
*% IF CMT_ID
*% IF PGM_PU
      *-----------------------------------------------------------------
      * MANTENCIONES
      *-----------------------------------------------------------------
      * PROYECTO     : BALANCE OPTIMO DAP
      * MODIFICACION : ENVIAR INFORMACION A MC2 PARA ACTUALIZACION DE
      *                PPD
      * FECHA        : ENERO 2017
      * ETIQUETA     : *OGB-INI 13-ENE-2017 BALANCE OPTIMO DAP
      *-----------------------------------------------------------------
      * PROYECTO     : ELIMINACION DEPENDENCIA PROD
      * MODIFICACION : IMPLEMENTACION COMANDO VERIFICACION (VRF)
      *
      * FECHA        : MAYO 2018
      * ETIQUETA     : *OGB-INI 28-MAY-2018 COMANDO VERIFICACION
      *-----------------------------------------------------------------
*% END
*% END
*% IF INI_FIO
      *<<<< INI_FIO
      * ISP-INI 31-07-1998 INICIALIZA CAMPOS DE REGISTROS
           PERFORM CLR-REG-JPO.
           PERFORM CLR-REG-POD.
      * ISP-FIN 31-07-1998 INICIALIZA CAMPOS DE REGISTROS
      *>>>> END INI_FIO
*% END
*% IF FND_KEY_NO_INCLUIR_POR_AHORA
      *<<<< FND_KEY_NO_INCLUIR_POR_AHORA
           IF POD-COD-CEQP IN POD-FLD > SPACES AND
              POD-COD-VCAM IN POD-FLD NOT > SPACES AND
              POD-COD-TOPD IN POD-FLD NOT > SPACES AND
              POD-COD-AOPD IN POD-FLD NOT > SPACES
                 MOVE POD-COD-CEQP IN POD-FLD TO POD-COD-CEQP IN POD
                 MOVE 'POD-COD-CEQP' TO FIO-AKEY
                 MOVE FIO-GET-KEY TO FIO-CMND
                 PERFORM DAP-FIO-POD
                 IF FIO-STAT-OKS
                     MOVE FIO-STAT TO PGM-STAT-POD
                     GO TO FIN-FND-KEY
                 ELSE
                     MOVE 'DAP' TO MSG-COD-SIST
                     MOVE 'CODCEQPNEX' TO MSG-COD-MENS
                     PERFORM GET-MSG
                     MOVE MSG-GLS-DESC TO FRM-MENS
                     MOVE SCR-STAT-CON TO SCR-STAT
                     GO TO FIN-FND-KEY.
      *<<<< FND_KEY
*% END
*% IF EOF
      *<<<< EOF
      * ISP-INI 31-07-1998 INICIALIZA CAMPOS DE REGISTROS
       COPY DAPBCJPO.
       COPY DAPBCPOD.
      * ISP-FIN 31-07-1998 INICIALIZA CAMPOS DE REGISTROS
       COPY GNSBBTAB.
       COPY GNSBVCOD.
       COPY GNSBVTAB.
       COPY GNSBBMSC.
       COPY GNSBVIND.
       COPY GNSBVMSC.
       COPY GNSBFMSC.
      *>>>> END EOF
*% END
*% IF WSS
      *<<<< WSS
*% IF PGM_PU
      *OGB-INI 13-ENE-2017 BALANCE OPTIMO DAP
       COPY MC2WGPPD.
       COPY GNSWGTSK.
      *OGB-FIN 13-ENE-2017 BALANCE OPTIMO DAP
*% END
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-MSC-REQA==.
       COPY GNSBRMSC.      
       COPY GNSWGHOY.
       COPY GNSWGFEC.
       COPY DAPBRJPO.
*% IF PGM_PU
      *OGB-INI 28-MAY-2018 COMANDO VERIFICACION
       COPY DAPWGVCP.
      *OGB-FIN 28-MAY-2018 COMANDO VERIFICACION

      *OGB-INI 13-ENE-2017 BALANCE OPTIMO DAP
       01 MPC-MOD          VALUE 'MOD'      PIC X(03).
       01 MPC-ING          VALUE 'ING'      PIC X(03).
       01 MPC-VARI.
          03 SYS-CMMA-AUX.
             05 SYS-SCR-MENS-AUX                  PIC X(79).
             05 SYS-SCR-VARI-AUX                  PIC X(3421).
          03 SYS-CMND-AUX             VALUE 0     PIC 9(02).
      *    PROGRAMA
          03 SYS-PROG-AUX                         PIC X(08).
          03 SYS-PROG-RED-AUX REDEFINES SYS-PROG-AUX
                                                  OCCURS 8 PIC X(01).
          03 SYS-TCMA-AUX  COMP                   PIC S9(4).
      *OGB-FIN 13-ENE-2017 BALANCE OPTIMO DAP


*% END       
       01  WSS-VARI.
*% IF PGM_PU
      *OGB-INI 28-MAY-2018 COMANDO VERIFICACION
           03 WSS-CT-VRF   VALUE 'VRF'             PIC X(03).
           03 WSS-CT-VRFOK VALUE 'VERIFICACION OK' PIC X(15).
      *OGB-FIN 28-MAY-2018 COMANDO VERIFICACION
*% END       
*% IF PGM_PQ
      *OGB-INI 28-MAY-2018 COMANDO VERIFICACION
           03 WSS-CT-VRF   VALUE 'VRF'             PIC X(03).
      *OGB-FIN 28-MAY-2018 COMANDO VERIFICACION
*% END       
      *       var para validacion de plazos min/max
           03 WSS-CIC-PER                         PIC X(01).
           03 WSS-NUM-PER                         PIC 9(05).
           03 WSS-FEC-FUNO.
              05 WSS-NUM-SUNO                     PIC 9(02).
              05 WSS-NUM-AUNO                     PIC 9(02).
              05 WSS-NUM-MUNO                     PIC 9(02).
              05 WSS-NUM-DUNO                     PIC 9(02).

           03 WSS-FEC-FDOS.
              05 WSS-NUM-SDOS                     PIC 9(02).
              05 WSS-NUM-ADOS                     PIC 9(02).
              05 WSS-NUM-MDOS                     PIC 9(02).
              05 WSS-NUM-DDOS                     PIC 9(02).

      *       auxiliar para validacion de POD-COD-CVTI
           03 WSS-CVTI.
              05 WSS-GLS-CVTI              PIC X(01).
              05 WSS-COD-CVTI              PIC X(03).
              05 WSS-COD-PBTI              PIC X(01).
      *       auxiliar para validacion sobre TAB-INT
           03 WSS-INTE.
              05 WSS-INT-COD-BCTI          PIC X(01).
              05 WSS-INT-COD-PBTI          PIC X(01).
              05 WSS-INT-COD-BPBT          PIC X(01).
              05 WSS-INT-COD-SPBT          PIC X(01).
              05 WSS-INT-COD-CVTI          PIC X(03).
              05 WSS-INT-COD-TFPR          PIC X(01).
              05 WSS-INT-NUM-PREP          PIC 9(03).
              05 WSS-INT-IND-PREP          PIC X(01).
      *>>>> 
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-JPO-REQA==.
      *>>>>
*% END
*% IF FIN_SCR_TRL
      *<<<< FIN_SCR_TRL
           MOVE 'V' TO POD-COD-BCTI IN POD-FLD.
           MOVE 'S' TO POD-COD-SPBT IN POD-FLD.
      *     MOVE 1   TO POD-NUM-VMIN IN POD-FLD.
      *     MOVE 1   TO POD-NUM-VMAX IN POD-FLD.
      *     MOVE 'N' TO POD-COD-MORE IN POD-FLD.
      *>>>>
*% END
*% IF FIN_HBL_FLD
      *<<<<
           IF SCR-CMND = 'COP'
               PERFORM UNP-IKY-POD
               PERFORM FST-KEY-POD.
      *>>>>
*% END
*% IF ABT_CMN_ACC
      *<<<< ABT_CMN_ACC
               IF SCR-CMND = 'COP'
                   MOVE 'REGISTRO NO FUE COPIADO' TO FRM-MENS
                   GO TO FIN-CMN-ACC
               ELSE
      *>>>>
*% END
*% IF INI_CMN_ACC
      *<<<< INI_CMN_ACC
           IF SCR-CMND = 'COP'
               PERFORM RET-ALL-POD
               PERFORM RET-HDR
               MOVE FIO-PUT  TO FIO-CMND
               PERFORM DAP-FIO-POD
               IF FIO-STAT-OKS
                   MOVE 'REGISTRO FUE COPIADO' TO FRM-MENS
      *OGB-INI 13-ENE-2017 BALANCE OPTIMO DAP
                   MOVE MPC-ING TO MC2POD-IND-CMND
                   PERFORM POD-TO-PPD
      *OGB-FIN 13-ENE-2017 BALANCE OPTIMO DAP
               ELSE
                   MOVE 'ERROR : REGISTRO NO COPIADO' TO FRM-MENS
           ELSE
      *OGB-INI 28-MAY-2018 COMANDO VERIFICACION
           IF SCR-CMND = WSS-CT-VRF
              MOVE POD-COD-VCAM IN POD-FLD TO DAPVCP-COD-VCAM
              MOVE POD-COD-TOPD IN POD-FLD TO DAPVCP-COD-TOPD
              MOVE POD-COD-AOPD IN POD-FLD TO DAPVCP-COD-AOPD
              PERFORM DAP-LNK-VCP
              IF DAPVCP-COD-MENS IN DAPVCP-VARI > SPACES
                 MOVE 'DAP'           TO MSG-COD-SIST
                 MOVE DAPVCP-COD-MENS TO MSG-COD-MENS
                 PERFORM GET-MSG
                 MOVE MSG-GLS-DESC TO FRM-MENS
               ELSE
                 MOVE WSS-CT-VRFOK TO FRM-MENS
                 GO TO FIN-CMN-ACC
           ELSE
      *OGB-FIN 28-MAY-2018 COMANDO VERIFICACION
               MOVE 'COMANDO NO IMPLEMENTADO' TO FRM-MENS.
           GO TO FIN-CMN-ACC.
      *>>>>
*% END
*% IF CMN_ING OR CMN_MOD 
      *<<<< CMN_ING OR CMN_MOD 
           PERFORM RET-HDR.
      *>>>>
*% END
*% IF FIN_CMN_MOD 
      *<<<< FIN_CMN_ING OR FIN_CMN_MOD OR FIN_CMN_ELI OR CMN_ACC
           PERFORM PRO-JPO.
      *OGB-INI 13-ENE-2017 BALANCE OPTIMO DAP
           IF FIO-STAT-OKS
              MOVE MPC-MOD TO MC2POD-IND-CMND
              PERFORM POD-TO-PPD.
      *OGB-FIN 13-ENE-2017 BALANCE OPTIMO DAP
      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING OR FIN_CMN_MOD OR FIN_CMN_ELI OR CMN_ACC
           PERFORM PRO-JPO.
      *OGB-INI 13-ENE-2017 BALANCE OPTIMO DAP
           IF FIO-STAT-OKS
              MOVE MPC-ING TO MC2POD-IND-CMND
              PERFORM POD-TO-PPD.
      *OGB-FIN 13-ENE-2017 BALANCE OPTIMO DAP
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
      *>>>>
*% END
*% IF CMN_ACC OR FIN_CMN_ELI 
      *<<<< FIN_CMN_ING OR FIN_CMN_MOD OR FIN_CMN_ELI OR CMN_ACC
           PERFORM PRO-JPO.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       COPY DAPBFJPO.
       COPY GNSBGHOY.
       COPY GNSBGFEC.
       COPY GNSBPFEC.
      *>>>> EOF
*% END
*% IF EOF_PU
      *<<<< EOF_PU

       RET-HDR SECTION.
       INI-RET-HDR.
           PERFORM GET-FHOY.
      *    Fecha Transaccion
           MOVE HOY-FHOY TO POD-FEC-FTRN IN POD.
      *    Hora Transaccion
           MOVE HOY-HHOY TO POD-HRA-HRTR IN POD.
      *    Codigo Origen transaccion
           MOVE SCR-OTRN TO POD-COD-OTRN IN POD.
      *    Autor Transaccion
           MOVE SCR-USER TO POD-COD-ATRN IN POD.
           IF SCR-CCPP = 'ING'
               MOVE 'I' TO POD-COD-TACC IN POD
           ELSE
           IF SCR-CCPP = 'MOD'
               MOVE 'M' TO POD-COD-TACC IN POD
           ELSE
           IF SCR-CMND = 'COP'
               MOVE 'C' TO POD-COD-TACC IN POD.
       FIN-RET-HDR.
           EXIT.

      * proceso journal POD
       PRO-JPO SECTION.
       INI-PRO-JPO.
           MOVE POD TO JPO.
           PERFORM GET-FHOY.
      *    Fecha Transaccion
           MOVE HOY-FHOY TO JPO-FEC-FTRN IN JPO.
      *    Hora Transaccion
           MOVE HOY-HHOY TO JPO-HRA-HRTR IN JPO.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM DAP-FIO-JPO.
           IF NOT FIO-STAT-OKS
      *        Error al grabar el journal
               MOVE 'DAP' TO MSG-COD-SIST
               MOVE 'JPO    ERR' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
      *PTC-INI PENTA
               MOVE 'S' TO SCR-IERR
      *PTC-FIN PENTA
               MOVE FIO-MENS TO FRM-MENS.
       FIN-PRO-JPO.
           EXIT.

      *OGB-INI 13-ENE-2017 BALANCE OPTIMO DAP
        COPY MC2BKPPD.
        COPY GNSBGQUE.
        COPY GNSBGTSK.

        POD-TO-PPD SECTION.
        INI-POD-TO-PPD.

            MOVE SYS-CMMA TO SYS-CMMA-AUX.
            MOVE SYS-CMND TO SYS-CMND-AUX.
            MOVE SYS-PROG TO SYS-PROG-AUX.
            MOVE SYS-TCMA TO SYS-TCMA-AUX.
            MOVE POD TO MC2POD.
            PERFORM MC2-LNK-PPD.
            MOVE SYS-CMMA-AUX TO SYS-CMMA.
            MOVE SYS-CMND-AUX TO SYS-CMND.
            MOVE SYS-PROG-AUX TO SYS-PROG.
            MOVE SYS-TCMA-AUX TO SYS-TCMA.
            MOVE MC2POD-GLS-MEN2 TO FRM-MEN2.
        FIN-POD-TO-PPD.
            EXIT.
      *OGB-FIN 13-ENE-2017 BALANCE OPTIMO DAP
      *OGB-INI 28-MAY-2018 COMANDO VERIFICACION
       COPY DAPBKVCP.
      *OGB-FIN 28-MAY-2018 COMANDO VERIFICACION
      *>>>> EOF_PU
*% END
