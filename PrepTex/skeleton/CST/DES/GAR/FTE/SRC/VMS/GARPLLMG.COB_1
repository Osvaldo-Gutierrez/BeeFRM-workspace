       IDENTIFICATION DIVISION.
      *=======================
       PROGRAM-ID.      GARPLLMG.
       AUTHOR.          CONSIST.
       DATE-WRITTEN.    17-Jul-91 01:00 PM.

      * Programa Listador de Reporte LMG con Sort.

       ENVIRONMENT DIVISION.
      *====================
       CONFIGURATION SECTION.
      *---------------------
       SPECIAL-NAMES.
            DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
      *--------------------
       FILE-CONTROL.
           SELECT GNSSRT         ASSIGN TO 'SYS$DISK:'.
           SELECT RPTLMG	   ASSIGN TO RPTLMG.
      *<<<< IOS
           SELECT RPTMCT       ASSIGN TO RPTMCT.
      *>>>>


       DATA DIVISION.
      *=============
       FILE SECTION.
      *------------
       SD  GNSSRT.
       COPY GARRRLMG.

       FD  RPTLMG LABEL RECORDS OMITTED
           REPORT IS RPT-LMG

           .
      *<<<< FLS
       FD  RPTMCT LABEL RECORDS OMITTED
           REPORT IS RPT-MCT.
      *>>>>


       WORKING-STORAGE SECTION.
      *-----------------------
       COPY GARBRGMO.
       COPY GNSWCFIO.
       COPY GNSWVFIO.
       COPY GNSWGRPT.
       COPY GNSBRTAB.
       COPY GNSBRMSG.
       COPY GARRWLMG.
      *<<<< RW
       COPY TABRWMCT.
      *>>>>

       COPY GNSWGSYS.
       01  PGM-STAT.
           03 PGM-STAT-SRT            VALUE ' ' PIC X(01).
              88 PGM-STAT-SRT-OKS     VALUE ' '.
              88 PGM-STAT-SRT-MAL     VALUE 'M'.
           03 PGM-SOKS                VALUE ' ' PIC X(01).
           03 PGM-SMAL                VALUE 'M' PIC X(01).
      *<<<< WSS
       COPY GARBRGDG.
       COPY GARBRTAG.
       COPY GARBRGVT.
       COPY GARBRGDD.

       COPY TABBRMCT.
       COPY TABBROFI.
       COPY TABBRCAM.

       COPY GNSBRCIC.
       COPY SGCBRDBC.
       COPY GNSWGFEC.
       COPY GNSWGHOY.
       COPY GNSWGCPT.
       COPY GNSWGCIC.
       COPY GNSWCVRF.
       COPY GNSWVVRF.
       01  WSS-VARI.
           03 WSS-FEC-FINI.
              05 WSS-NUM-DINI                     PIC 9(02).
              05 WSS-NUM-MINI                     PIC 9(02).
              05 WSS-NUM-SINI                     PIC 9(02).
              05 WSS-NUM-AINI                     PIC 9(02).
           03 WSS-FEC-FTER.
              05 WSS-NUM-DTER                     PIC 9(02).
              05 WSS-NUM-MTER                     PIC 9(02).
              05 WSS-NUM-STER                     PIC 9(02).
              05 WSS-NUM-ATER                     PIC 9(02).
           03 WSS-FEC-FFEC.
              05 WSS-NUM-SFEC                     PIC 9(02).
              05 WSS-NUM-AFEC                     PIC 9(02).
              05 WSS-NUM-MFEC                     PIC 9(02).
              05 WSS-NUM-DFEC                     PIC 9(02).
           03 WSS-FEC-FFET.
              05 WSS-NUM-SFET                     PIC 9(02).
              05 WSS-NUM-AFET                     PIC 9(02).
              05 WSS-NUM-MFET                     PIC 9(02).
              05 WSS-NUM-DFET                     PIC 9(02).
           03 WSS-FEC-FREG.
              05 WSS-NUM-SREG                     PIC 9(02).
              05 WSS-NUM-AREG                     PIC 9(02).
              05 WSS-NUM-MREG                     PIC 9(02).
              05 WSS-NUM-DREG                     PIC 9(02).
           03 WSS-FEC-CNT                         PIC X(08).
           03 WSS-VAL-CNT                         PIC S9(11)V9(04).
           03 WSS-COD-PESO                        PIC X(06).
           03 WSS-VAL-PESO                        PIC S9(11).
           03 WSS-IND-NEXT                        PIC 9(01).
           03 WSS-IND-ERRO                        PIC 9(01).
           03 WSS-NUM-TDEB        VALUE ZEROES    PIC 9(03).
           03 WSS-NUM-THAB        VALUE ZEROES    PIC 9(03).
           03 WSS-IND-GET-MSG                     PIC 9(01).
           03 WSS-NO-BUSCA-MSG-ERROR VALUE 1      PIC 9(01).
           03 WSS-BUSCA-MSG-ERROR    VALUE 0      PIC 9(01).
           03 WSS-IND-SORT           VALUE 0      PIC 9(06).
           03 WSS-IND-RCNS           VALUE 0      PIC 9(06).
           03 WSS-IND-RALZ           VALUE 0      PIC 9(06).
           03 WSS-IND-RMOD           VALUE 0      PIC 9(06).
           03 WSS-IND-RPRO           VALUE 0      PIC 9(06).
           03 WSS-IND-RBAD           VALUE 0      PIC 9(06).
           03 WSS-IND-ROKS           VALUE 0      PIC 9(06).
           03 WSS-IND-RERR           VALUE 0      PIC 9(06).
           03 WSS-GLS-CCSB.
              05 WSS-GLS-DESC                     PIC X(40).
              05 WSS-GLS-DATA.
                 07 FILLER                        PIC X(59).
                 07 WSS-GLS-DVRF                  PIC X(01).
      *>>>>


       REPORT SECTION.
      *--------------
       COPY GARRFLMG.

           .
       COPY GARRTLMG.
      *<<<< RT
       COPY TABRFMCT.
           .
       COPY TABRTMCT.
      *>>>>


       PROCEDURE DIVISION.
      *==================
       DECLARATIVES.
       DEC-CF-LMG-SRT-COD-OFIC SECTION.
           USE BEFORE REPORTING CF-LMG-SRT-COD-OFIC.
       INI-CF-LMG-SRT-COD-OFIC.
      *<<<< CF_LMG_SRT_COD_OFIC
       CF-OFIC.
           MOVE ZEROES TO PAGE-COUNTER IN RPT-LMG.
      *>>>>

       FIN-CF-LMG-SRT-COD-OFIC.
           EXIT.
       DEC-CF-LMG-SRT-CIC-CCSB SECTION.
           USE BEFORE REPORTING CF-LMG-SRT-CIC-CCSB.
       INI-CF-LMG-SRT-CIC-CCSB.
      *<<<< CF_LMG_SRT_CIC_CCSB
       CF-CCSB.
           MOVE WSS-NUM-TDEB IN WSS-VARI TO WSS-NUM-TDEB IN WSS-LMG.
           MOVE WSS-NUM-THAB IN WSS-VARI TO WSS-NUM-THAB IN WSS-LMG.
           MOVE ZEROES TO WSS-NUM-TDEB IN WSS-VARI
                          WSS-NUM-THAB IN WSS-VARI.

      *     MOVE SRT-CIC-CCSB IN SRT TO 
      * Mediante BUS-TAB Busca Cuenta Contable de Tabla PCC
           IF SRT-CIC-CCSB IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'PCC'               TO TAB-COD-TTAB IN TAB
               MOVE SRT-CIC-CCSB IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-DESC IN WSS-VARI
               MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-DATA IN WSS-VARI
               MOVE WSS-GLS-CCSB IN WSS-VARI TO WSS-GLS-CCSB IN WSS-MCT
               MOVE WSS-GLS-DVRF IN WSS-VARI TO WSS-GLS-DVRF IN WSS-MCT
           ELSE
               MOVE SPACES TO WSS-GLS-CCSB IN WSS-MCT
               MOVE SPACES TO WSS-GLS-DVRF IN WSS-MCT.
           MOVE SUM-VAL-TDEB IN CF-LMG-SRT-CIC-CCSB TO WSS-MCT-DEBE.
           MOVE SUM-VAL-THAB IN CF-LMG-SRT-CIC-CCSB TO WSS-MCT-HABE.
           GENERATE DL-MCT.
      *>>>>

       FIN-CF-LMG-SRT-CIC-CCSB.
           EXIT.
       DEC-CF-LMG-SRT-COD-VCAM SECTION.
           USE BEFORE REPORTING CF-LMG-SRT-COD-VCAM.
       INI-CF-LMG-SRT-COD-VCAM.
      *<<<< CF_LMG_SRT_COD_VCAM
      *>>>>

       FIN-CF-LMG-SRT-COD-VCAM.
           EXIT.
       DEC-CF-LMG-SRT-IND-DBHB SECTION.
           USE BEFORE REPORTING CF-LMG-SRT-IND-DBHB.
       INI-CF-LMG-SRT-IND-DBHB.
      *<<<< CF_LMG_SRT_IND_DBHB
           PERFORM ESC-REG-MCT.

      *>>>>

       FIN-CF-LMG-SRT-IND-DBHB.
           EXIT.
       DEC-DL-LMG SECTION.
           USE BEFORE REPORTING DL-LMG.
       INI-DL-LMG.

       FIN-DL-LMG.
           EXIT.
      *<<<< END_DCL
       DEC-PH-LMG SECTION.
           USE BEFORE REPORTING PH-LMG.
       INI-DEC-PH-LMG.
      *<<<< PH_LMG

       PH-VCAM.
      * Mediante BUS-TAB Busca Tipo de Moneda de Tabla VLR
           IF SRT-COD-VCAM IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE SRT-COD-VCAM IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-DCOR IN WSS-LMG
           ELSE
               MOVE SPACES TO WSS-GLS-DCOR IN WSS-LMG.

      * Mediante BUS-OFI Obtiene Nombre y Direccion Oficina de Tabla OFI
       PH-OFIC.
           IF SRT-COD-OFIC IN SRT > SPACES
               MOVE SRT-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI.

       PH-CCSB.
      * Mediante BUS-TAB Busca Cuenta Contable de Tabla PCC
           IF SRT-CIC-CCSB IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'PCC'               TO TAB-COD-TTAB IN TAB
               MOVE SRT-CIC-CCSB IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-DESC IN WSS-VARI
               MOVE TAB-GLS-DATA IN TAB TO WSS-GLS-DATA IN WSS-VARI
               MOVE WSS-GLS-CCSB IN WSS-VARI TO WSS-GLS-CCSB IN WSS-LMG
               MOVE WSS-GLS-DVRF IN WSS-VARI TO WSS-GLS-DVRF IN WSS-LMG
           ELSE
               MOVE SPACES TO WSS-GLS-CCSB IN WSS-LMG
               MOVE SPACES TO WSS-GLS-DVRF IN WSS-LMG.
       PH-CIC
      *     MOVE ZEROES TO WSS-NUM-FOLO IN WSS-LMG.
           MOVE  0  TO WSS-IND-NEXT IN WSS-VARI.
      *CIC-GET Obtener CIC
           MOVE 'G'                 TO CIC-COD-TCIC IN CIC.
           MOVE SRT-COD-OFIC IN SRT TO CIC-COD-CCIC IN CIC.
           MOVE CIC-GET TO CIC-CMND.
           PERFORM PRO-CIC THRU ERR-PRO-CIC.
           IF CIC-STAT NOT = CIC-STAT-OKS
               MOVE  1  TO WSS-IND-NEXT IN WSS-VARI
               DISPLAY CIC-MENS     IN CIC-VARI ' EN CODIGO : '
                       CIC-CIC-ICIC IN CIC
               GO TO FIN-DEC-PH-LMG.
           MOVE CIC-NUM-ICIC IN CIC TO WSS-NUM-FOLO IN WSS-LMG.

      *>>>>
       FIN-DEC-PH-LMG.
           EXIT.

       DEC-CF-MCT-SRT-COD-OFIC SECTION.
           USE BEFORE REPORTING CF-MCT-SRT-COD-OFIC.
       INI-DEC-CF-MCT-SRT-COD-OFIC.
      *<<<< CF_MCT_SRT_COD_OFIC
           MOVE ZEROES TO PAGE-COUNTER IN RPT-MCT.
      *>>>>
       FIN-DEC-CF-MCT-SRT-COD-OFIC.
           EXIT.

       DEC-CF-MCT-SRT-FEC-FMOV SECTION.
           USE BEFORE REPORTING CF-MCT-SRT-FEC-FMOV.
       INI-DEC-CF-MCT-SRT-FEC-FMOV.
      *<<<< CF_MCT_SRT_FEC_FMOV
           MOVE SRT-FEC-FMOV IN SRT      TO WSS-FEC-FREG IN WSS-VARI.
           MOVE WSS-NUM-DREG IN WSS-VARI TO WSS-NUM-DMOV IN WSS-MCT.
           MOVE WSS-NUM-MREG IN WSS-VARI TO WSS-NUM-MMOV IN WSS-MCT.
           MOVE WSS-NUM-SREG IN WSS-VARI TO WSS-NUM-SMOV IN WSS-MCT.
           MOVE WSS-NUM-AREG IN WSS-VARI TO WSS-NUM-AMOV IN WSS-MCT.
      *>>>>
       FIN-DEC-CF-MCT-SRT-FEC-FMOV.
           EXIT.

       DEC-PH-MCT SECTION.
           USE BEFORE REPORTING PH-MCT.
       INI-DEC-PH-MCT.
      *<<<< PH_MCT
      * Mediante BUS-TAB Busca Tipo de Moneda de Tabla VLR
           IF SRT-COD-VCAM IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE SRT-COD-VCAM IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-GLS-DCOR IN TAB TO WSS-GLS-VCAM IN WSS-MCT
           ELSE
               MOVE SPACES TO WSS-GLS-VCAM IN WSS-MCT.

      * Mediante BUS-OFI Obtiene Nombre y Direccion Oficina de Tabla OFI
           IF SRT-COD-OFIC IN SRT > SPACES
               MOVE SRT-COD-OFIC IN SRT TO OFI-COD-OFIC IN OFI
               PERFORM BUS-OFI.
      *>>>>
       FIN-DEC-PH-MCT.
           EXIT.

       AUX-VAX SECTION.
           USE BEFORE REPORTING CF-MCT-SRT-COD-VCAM.
       INI-AUX-VAX.
      *<<<< INI_AUX_VAX
           GO TO FIN-AUX-VAX.

      * Impresion Linea MCT y Grabacion del Registro MCT
       ESC-REG-MCT.
      * Formacion del Registro MCT
           MOVE SRT-CIC-CCSB IN SRT TO MCT-GLS-ICTA IN MCT.

           IF SRT-COD-VCAM IN SRT > SPACES
               MOVE 'TAB'               TO TAB-COD-SIST
               MOVE 'VLR'               TO TAB-COD-TTAB IN TAB
               MOVE SRT-COD-VCAM IN SRT TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               STRING TAB-COD-DAT1 IN TAB(7)
                      TAB-COD-DAT1 IN TAB(8)
                   DELIMITED BY SIZE INTO MCT-COD-MONE IN MCT
           ELSE
               MOVE 'ZZ' TO MCT-COD-MONE IN MCT.

           MOVE SRT-COD-OFIC IN SRT TO MCT-COD-OFIC IN MCT.

           MOVE SPACES              TO MCT-GLS-FILL IN MCT
                                       MCT-GLS-IDOC IN MCT
                                       MCT-GLS-MOVI IN MCT
                                       MCT-GLS-DISP IN MCT.
           IF SRT-IND-DBHB IN SRT = 'D'
               MOVE  1  TO MCT-IND-TDOC IN MCT
               MOVE SUM-VAL-TDEB TO MCT-VAL-MOVI IN MCT
           ELSE
           IF SRT-IND-DBHB IN SRT = 'H'
               MOVE  2  TO MCT-IND-TDOC IN MCT
               MOVE SUM-VAL-THAB TO MCT-VAL-MOVI IN MCT
           ELSE
               MOVE  0  TO MCT-IND-TDOC IN MCT
               MOVE ZEROES TO MCT-VAL-MOVI IN MCT.

      * Genera el Registro del Archivo MCT.
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM TAB-FIO-MCT.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'MCT    NOPUT' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC
               DISPLAY 'REGISTRO MCT : ' MCT
               ADD 1 TO WSS-IND-RERR IN WSS-VARI
           ELSE
               ADD 1 TO WSS-IND-ROKS IN WSS-VARI.

       TAB-FIO-MCT.
           CALL 'TABPFMCT' USING FIO-VARI MCT.

      * Busca Glosa de Codigo Oficina
       BUS-OFI.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-OFI.
           IF NOT FIO-STAT-OKS
                MOVE 'COD    NEX' TO MSG-COD-MENS
                MOVE 'GNS' TO MSG-COD-SIST
                PERFORM GET-MSG
                MOVE MSG-GLS-DESC TO OFI-GLS-DESC IN OFI
           ELSE
                MOVE SPACES TO MSG-COD-MENS.

      * Modulo FIO para archivo RMS TABOFI,  4-MAR-1991 10:11:11.98
       TAB-FIO-OFI.
           CALL 'TABPFOFI' USING FIO-VARI OFI.
       
      * Modulo FIO para archivo RMS GNSCIC, 12-MAR-1991 13:25:36.30
       GNS-FIO-CIC.
           CALL 'GNSPFCIC' USING FIO-VARI CIC.
       
      * Procesa Codigo Interno Computacional
       PRO-CIC.
           MOVE CIC-STAT-OKS TO CIC-STAT.
           MOVE SPACES TO CIC-MENS.
           IF CIC-CMND = CIC-GET
               PERFORM CIC-OGET THRU FIN-CIC-OGET
           ELSE
           IF CIC-CMND = CIC-INI
               PERFORM CIC-OINI
           ELSE
           IF CIC-CMND = CIC-FIN
               PERFORM CIC-OFIN
           ELSE
               MOVE CIC-STAT-CNV TO CIC-STAT.
       ERR-PRO-CIC.
           IF CIC-STAT NOT = CIC-STAT-OKS
               MOVE 'GNS'     TO MSG-COD-SIST
               MOVE 'CICSTAT' TO MSG-COD-TMSG
               MOVE CIC-STAT  TO MSG-COD-CMSG
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC IN MSG TO CIC-MENS.
       CIC-OGET.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM GNS-FIO-CIC.
           IF NOT FIO-STAT-OKS
               MOVE CIC-STAT-NEX TO CIC-STAT
               GO TO FIN-CIC-OGET
           ELSE
               IF CIC-IND-VIGE = 'N'
                   MOVE CIC-STAT-NVG TO CIC-STAT
                   GO TO FIN-CIC-OGET.
           ADD 1 TO CIC-NUM-ICIC.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM GNS-FIO-CIC.
           IF NOT FIO-STAT-OKS
               MOVE CIC-STAT-ERR TO CIC-STAT
               GO TO FIN-CIC-OGET.
           MOVE VRF-SVRF-0 TO VRF-SVRF.
           MOVE 7 TO VRF-LMAX.
           MOVE CIC-NUM-ICIC TO VRF-NUME.
           MOVE VRF-GET TO VRF-CMND.
           MOVE ZEROES TO VRF-STAT.
           CALL 'GNSPPVRF' USING VRF-VARI.
           MOVE VRF-DVRF TO CIC-DVRF.
       FIN-CIC-OGET.
           EXIT.
       CIC-OINI.
      *-----------------
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GNS-FIO-CIC.
           IF NOT FIO-STAT-OKS
               MOVE FIO-STAT TO CIC-STAT.
       CIC-OFIN.
      *-----------------
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GNS-FIO-CIC.
           IF NOT FIO-STAT-OKS
               MOVE FIO-STAT TO CIC-STAT.

      * Obtencion de Mensaje
       GET-MSG.
           MOVE MSG-COD-SIST TO FIO-SIST.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-MSG-AUX.
           IF NOT FIO-STAT-OKS
               MOVE MSG-COD-MENS           TO MSG-GLS-DES1
               MOVE ' MENSAJE INEXISTENTE' TO MSG-GLS-DES2
           ELSE
               IF MSG-IND-VIGE = 'N'
                   MOVE MSG-COD-MENS          TO MSG-GLS-DES1
                   MOVE ' MENSAJE NO VIGENTE' TO MSG-GLS-DES2.

      * Modulo FIO para archivo GNSTAB ( MSG )
       GNS-FIO-MSG-AUX.
      *JSS
           MOVE FIO-SIST TO MSG-COD-SIST.
           MOVE 'MSG'    TO MSG-COD-TTAB IN MSG.
           IF FIO-CMND = FIO-PUT OR FIO-MOD
               MOVE MSG-COD-TTAB IN MSG TO MSG-CIC-TTAB IN MSG
                                           MSG-EXT-TTAB IN MSG
                                           MSG-SNX-TTAB IN MSG.
           CALL MSG-GLS-FMSG USING FIO-CMND MSG.
           MOVE FIO-SIST TO FIO-MENS-SIS.
           MOVE 'MSG'    TO FIO-MENS-REG.

      * Busca Glosa de Codigo en Tabla
       BUS-TAB.
           MOVE TAB-COD-SIST TO FIO-SIST.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB-AUX.
           IF NOT FIO-STAT-OKS
               MOVE 'COD    NEX' TO MSG-COD-MENS
               MOVE 'GNS' TO MSG-COD-SIST
               PERFORM GET-MSG
               MOVE MSG-GLS-ABRV TO TAB-GLS-ABRV IN TAB
               MOVE MSG-GLS-DCOR TO TAB-GLS-DCOR IN TAB
               MOVE MSG-GLS-DESC TO TAB-GLS-DESC IN TAB
           ELSE
               MOVE SPACES TO MSG-COD-MENS.

      * Modulo FIO para archivo GNSTAB
       GNS-FIO-TAB-AUX.
      *JSS
           MOVE FIO-SIST TO TAB-COD-SIST.
           IF FIO-CMND = FIO-PUT OR FIO-MOD
               MOVE TAB-COD-TTAB IN TAB TO TAB-CIC-TTAB IN TAB
                                           TAB-EXT-TTAB IN TAB
                                           TAB-SNX-TTAB IN TAB.
           CALL TAB-GLS-FTAB USING FIO-CMND TAB.
           MOVE FIO-SIST TO FIO-MENS-SIS.
           MOVE 'TAB'    TO FIO-MENS-REG.

       FIN-AUX-VAX.
           EXIT.

       END DECLARATIVES.

       MAIN SECTION.
      *------------
       INI-MAIN.
           MOVE 'GARPLLMG' TO FIO-PROG.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
            MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-INP      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           SORT GNSSRT
       COPY GARRSLMG.

           INPUT  PROCEDURE IS INP-SRT
           OUTPUT PROCEDURE IS OUT-SRT.
       FIN-MAIN.

           PERFORM GNS-PRO-END.

       INP-SRT SECTION.
      *---------------
       INI-INP-SRT.
      *<<<< INI_INP
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GNS'        TO FIO-SIST.
           PERFORM GNS-FIO-CIC.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GNS-FIO-CIC.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           DISPLAY 'INICIO CAPTURA DE PARAMETROS'.

      *Captura Fecha de Inicio
           DISPLAY 'FECHA DE INICIO ( DDMMAAAA ) : '.
           ACCEPT  WSS-FEC-FINI IN WSS-VARI.
           DISPLAY WSS-FEC-FINI IN WSS-VARI.
      *Captura Fecha de Termino
           DISPLAY 'FECHA DE TERMINO ( DDMMAAAA ) : '
           ACCEPT  WSS-FEC-FTER IN WSS-VARI.
           DISPLAY WSS-FEC-FTER IN WSS-VARI.

           DISPLAY 'FIN    CAPTURA    DE PARAMETROS'.
           DISPLAY 'INICIO VALIDACION DE PARAMETROS'.

      *VAL-FEC Valida Fecha de Inicio
           DISPLAY WSS-FEC-FINI IN WSS-VARI.
           MOVE WSS-FEC-FINI    IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-END.

      *VAL-FEC Valida Fecha de Termino
           DISPLAY WSS-FEC-FTER IN WSS-VARI.
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FECH.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-FBLK-N   TO FEC-FBLK.
           MOVE FEC-CHOY-LE  TO FEC-CHOY.
           MOVE FEC-VHBL-N   TO FEC-VHBL.
           MOVE FEC-VAL-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF NOT FEC-STAT-OKS
               DISPLAY FEC-MENS
               PERFORM GNS-PRO-END.

      *CMP-FEC Compara Fecha de Inicio con Fecha de Termino
           MOVE WSS-FEC-FINI IN WSS-VARI TO FEC-FEC1.
           MOVE WSS-FEC-FTER IN WSS-VARI TO FEC-FEC2.
           MOVE FEC-FORM-FEC TO FEC-FORM.
           MOVE FEC-CMP-FEC  TO FEC-CMND.
           PERFORM PRO-FEC.
           IF FEC-STAT-GRT
               MOVE 'TAB'         TO MSG-COD-SIST
               MOVE 'FECFINIFTER' TO MSG-COD-MENS IN MSG
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC IN MSG
               PERFORM GNS-PRO-END.

           MOVE WSS-NUM-DINI IN WSS-VARI TO WSS-NUM-DINI IN WSS-LMG
                                            WSS-NUM-DINI IN WSS-MCT
                                            WSS-NUM-DFEC IN WSS-VARI.
           MOVE WSS-NUM-MINI IN WSS-VARI TO WSS-NUM-MINI IN WSS-LMG
                                            WSS-NUM-MINI IN WSS-MCT
                                            WSS-NUM-MFEC IN WSS-VARI.
           MOVE WSS-NUM-SINI IN WSS-VARI TO WSS-NUM-SINI IN WSS-LMG
                                            WSS-NUM-SINI IN WSS-MCT
                                            WSS-NUM-SFEC IN WSS-VARI.
           MOVE WSS-NUM-AINI IN WSS-VARI TO WSS-NUM-AINI IN WSS-LMG
                                            WSS-NUM-AINI IN WSS-MCT
                                            WSS-NUM-AFEC IN WSS-VARI.
           MOVE WSS-NUM-DTER IN WSS-VARI TO WSS-NUM-DTER IN WSS-LMG
                                            WSS-NUM-DTER IN WSS-MCT
                                            WSS-NUM-DFET IN WSS-VARI.
           MOVE WSS-NUM-MTER IN WSS-VARI TO WSS-NUM-MTER IN WSS-LMG
                                            WSS-NUM-MTER IN WSS-MCT
                                            WSS-NUM-MFET IN WSS-VARI.
           MOVE WSS-NUM-STER IN WSS-VARI TO WSS-NUM-STER IN WSS-LMG
                                            WSS-NUM-STER IN WSS-MCT
                                            WSS-NUM-SFET IN WSS-VARI.
           MOVE WSS-NUM-ATER IN WSS-VARI TO WSS-NUM-ATER IN WSS-LMG
                                            WSS-NUM-ATER IN WSS-MCT
                                            WSS-NUM-AFET IN WSS-VARI.

           DISPLAY 'FIN VALIDACION DE PARAMETROS'.

       OPE-GDG.
           MOVE 'GAR'        TO FIO-SIST.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-GDG.

       OPE-GVT.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM GAR-FIO-GVT.

       OPE-TAG.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           PERFORM GAR-FIO-TAG.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-TAG.

       OPE-GDD.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           PERFORM GAR-FIO-GDD.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-GDD.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-CAM.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-CAM.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-OFI.

       OPE-SGC.
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'SGC'        TO FIO-SIST.
           PERFORM SGC-FIO-DBC.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-DBC.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'SGC'        TO FIO-SIST.
           PERFORM SGC-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM SGC-FIO-TAB.

      * Obtiene Codigo Valor de Cambio de Pesos Mediante CIC de la Moneda '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
               PERFORM GNS-PRO-END.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS-VARI.

      *>>>>

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
       FST-INP-SRT.
      *<<<< INI_FST_INP
           MOVE SPACES TO GAR-CLV-GMO-1 IN GMO.
           MOVE WSS-FEC-FFEC IN WSS-VARI TO GAR-FEC-MOV IN GMO.
           MOVE 'GAR-CLV-GMO-1' TO FIO-AKEY.
           MOVE FIO-GET-NLS    TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
           IF NOT FIO-STAT-OKS OR
              GAR-FEC-MOV IN GMO > WSS-FEC-FFET IN WSS-VARI
               DISPLAY 'NO HAY REGISTROS GMO EN RANGO DE FECHAS : '
                       'DESDE ' WSS-FEC-FINI IN WSS-VARI ' A '
                       WSS-FEC-FTER IN WSS-VARI
               GO TO FIN-INP-SRT.
           GO TO LUP-INP-SRT.
      *>>>>

           MOVE FIO-GET-FST TO FIO-CMND.
           PERFORM GAR-FIO-GMO.

       LUP-INP-SRT.
           IF NOT FIO-STAT-OKS
              GO TO FIN-INP-SRT.
      *<<<< LUP_INP
      * Proceso de Seleccion a Partir del Registro GMO

           IF GAR-COD-MOV IN GMO = '1' AND
              GAR-COD-CPO IN GMO = 'GVT005'
      *        GAR-COD-CPO IN GMO = 'GDG001'
               MOVE WSS-BUSCA-MSG-ERROR TO WSS-IND-GET-MSG
               PERFORM BUS-GDG
               PERFORM BUS-TAG
               PERFORM BUS-OFI-CNT
               MOVE GAR-FEC-MOV     IN GMO TO SRT-FEC-FMOV IN SRT
               MOVE GAR-COD-TSN     IN GMO TO SRT-COD-TSN IN SRT

               MOVE GAR-GLS-CPO-NVO IN GMO TO WSS-FEC-CNT
               MOVE GAR-VAL-CPO-NVO IN GMO TO WSS-VAL-CNT
               PERFORM DET-VAL-PESO
               PERFORM ING-CTA-DEB
               PERFORM ING-CTA-HAB
               IF MSG-COD-MENS > SPACES
                   PERFORM ERR-INP
               ELSE
                   ADD  1  TO WSS-IND-RPRO IN WSS-VARI
                   ADD  1  TO WSS-IND-RCNS IN WSS-VARI
           ELSE
           IF GAR-COD-MOV IN GMO = '2' AND
              GAR-COD-CPO IN GMO = 'GVT005'
               MOVE GAR-FEC-MOV IN GMO TO SRT-FEC-FMOV IN SRT
               MOVE GAR-COD-TSN IN GMO TO SRT-COD-TSN  IN SRT
               MOVE WSS-BUSCA-MSG-ERROR TO WSS-IND-GET-MSG
               PERFORM BUS-GDG
               PERFORM BUS-TAG
               PERFORM BUS-OFI-CNT
      * Llena la parte Salida de la Modificacion
               MOVE GAR-GLS-CPO-ANT IN GMO TO WSS-FEC-CNT
               MOVE GAR-VAL-CPO-ANT IN GMO TO WSS-VAL-CNT
               PERFORM DET-VAL-PESO
               PERFORM EGR-CTA-DEB
               PERFORM EGR-CTA-HAB

      * Llena la parte Ingreso de la Modificacion
               ADD 1, GAR-COD-TSN IN GMO GIVING SRT-COD-TSN  IN SRT
               MOVE GAR-GLS-CPO-NVO IN GMO TO WSS-FEC-CNT
               MOVE GAR-VAL-CPO-NVO IN GMO TO WSS-VAL-CNT
               PERFORM DET-VAL-PESO
               PERFORM ING-CTA-DEB
               PERFORM ING-CTA-HAB

               IF MSG-COD-MENS > SPACES
                   PERFORM ERR-INP
               ELSE
                   ADD  1  TO WSS-IND-RPRO IN WSS-VARI
                   ADD  1  TO WSS-IND-RMOD IN WSS-VARI
           ELSE
           IF GAR-COD-MOV IN GMO = '3' AND
              GAR-COD-CPO IN GMO = 'GDG001'
               MOVE WSS-BUSCA-MSG-ERROR TO WSS-IND-GET-MSG
               PERFORM BUS-GDG
               PERFORM BUS-GVT
               PERFORM BUS-TAG
               PERFORM BUS-OFI-CNT
               MOVE GAR-FEC-MOV     IN GMO TO SRT-FEC-FMOV IN SRT
               MOVE GAR-COD-TSN     IN GVT TO SRT-COD-TSN  IN SRT
               MOVE GAR-FEC-RVL     IN GVT TO WSS-FEC-CNT
               MOVE GAR-VAL-AJT-SUP IN GVT TO WSS-VAL-CNT
               PERFORM DET-VAL-PESO
               PERFORM EGR-CTA-DEB
               PERFORM EGR-CTA-HAB
               IF MSG-COD-MENS > SPACES
                   PERFORM ERR-INP
               ELSE
                   ADD  1  TO WSS-IND-RPRO IN WSS-VARI
                   ADD  1  TO WSS-IND-RALZ IN WSS-VARI
           ELSE
      * Se salta el registro GMO, solo es informativo
               GO TO NXT-INP-SRT.

      * Se enviaron al SORT con PERFORM MOV-INP-SRT
           GO TO NXT-INP-SRT.
      *>>>>

       MOV-INP-SRT.
       COPY GARRMLMG.
      *<<<< RM
           ADD 1 TO WSS-IND-SORT.
      *>>>>

           RELEASE SRT.
       NXT-INP-SRT.
      *<<<< INI_NXT_INP
           MOVE 'GAR-CLV-GMO-1' TO FIO-AKEY.
      *>>>>

           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
      *<<<< FIN_NXT_INP
           IF GAR-FEC-MOV IN GMO > WSS-FEC-FFET IN WSS-VARI
               GO TO FIN-INP-SRT.
      *>>>>

           GO TO LUP-INP-SRT.
       FIN-INP-SRT.
      *<<<< FIN_INP
      *>>>>

           MOVE FIO-CLO TO FIO-CMND.
           PERFORM GAR-FIO-GMO.

       OUT-SRT SECTION.
      *---------------
       INI-OUT-SRT.
           IF PGM-STAT-SRT-MAL
               GO TO EXT-OUT-SRT.
      *<<<< INI_OUT
      * Efectua la Apertura del Archivo SAM de Salida
           MOVE FIO-OUT TO FIO-CMND.
           PERFORM TAB-FIO-MCT-AUX.
           IF NOT FIO-STAT-OKS
               DISPLAY 'ERROR AL ABRIR ARCHIVO MCT DE OUTPUT' FIO-STAT
               PERFORM GNS-PRO-END.

      * Despliega Contadores
           DISPLAY 'INGRESOS LEIDOS           : '
                    WSS-IND-RCNS IN WSS-VARI.
           DISPLAY 'CAMBIOS DE VALORES LEIDOS : '
                    WSS-IND-RMOD IN WSS-VARI.
           DISPLAY 'ALZAMIENTOS LEIDOS        : '
                    WSS-IND-RALZ IN WSS-VARI.
           DISPLAY 'REGISTROS PROCESADOS   : ' WSS-IND-RPRO IN WSS-VARI.
           DISPLAY 'REGISTROS RECHAZADOS   : ' WSS-IND-RBAD IN WSS-VARI.
           DISPLAY 'REGISTROS AL SORT      : ' WSS-IND-SORT IN WSS-VARI.
           OPEN OUTPUT RPTMCT.
           INITIATE RPT-MCT.
      *>>>>

           OPEN OUTPUT RPTLMG.
           CALL 'GNSPLHDR' USING RPT-VARI.
           INITIATE RPT-LMG.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.

       LUP-OUT-SRT.
      *<<<< LUP_OUT
           PERFORM BUS-REG-CLI.
      *>>>>

       GEN-OUT-SRT.
           GENERATE DL-LMG.
      *<<<< FIN_GEN_OUT
            IF WSS-IND-NEXT IN WSS-VARI = 1
                DISPLAY 'PROCESO CON ERROR : ABORTO'
                GO TO FIN-OUT-SRT.
           MOVE SRT-FEC-FMOV IN SRT      TO WSS-FEC-FREG IN WSS-VARI.
           MOVE WSS-NUM-DREG IN WSS-VARI TO WSS-NUM-DMOV IN WSS-LMG.
           MOVE WSS-NUM-MREG IN WSS-VARI TO WSS-NUM-MMOV IN WSS-LMG.
           MOVE WSS-NUM-SREG IN WSS-VARI TO WSS-NUM-SMOV IN WSS-LMG.
           MOVE WSS-NUM-AREG IN WSS-VARI TO WSS-NUM-AMOV IN WSS-LMG.

           IF SRT-VAL-DEBE IN SRT NOT = 0
               ADD 1 TO WSS-NUM-TDEB IN WSS-VARI.
           IF SRT-VAL-HABE IN SRT NOT = 0
               ADD 1 TO WSS-NUM-THAB IN WSS-VARI.

      *>>>>

       NXT-OUT-SRT.
           RETURN GNSSRT AT END
                GO TO FIN-OUT-SRT.
           GO TO LUP-OUT-SRT.
       FIN-OUT-SRT.

           TERMINATE RPT-LMG.
      *<<<< FIN_TMT
           TERMINATE RPT-MCT.
           CLOSE RPTMCT.
           DISPLAY 'REGISTROS MCT GRABADOS : ' WSS-IND-ROKS IN WSS-VARI.
           DISPLAY 'REGISTROS NO GRABADOS  : ' WSS-IND-RERR IN WSS-VARI.
           MOVE FIO-CLO TO FIO-CMND.
           PERFORM TAB-FIO-MCT-AUX.
      *>>>>

           CLOSE RPTLMG.
       EXT-OUT-SRT.
           EXIT.

       COPY GARBFGMO.
       COPY GNSBBSYS.
       COPY GNSBFTAB.
       COPY GNSBFMSG.

       GNS-PRO-END SECTION.
       INI-GNS-PRO-END.
           STOP RUN.
       FIN-GNS-PRO-END.
           EXIT.

      *<<<< EOF
      **************************************************************************
       BUS-GDG SECTION.
       INI-BUS-GDG.

      * Busca la Garantia
           MOVE SPACES TO MSG-COD-MENS.
           MOVE GAR-NUM-SIS IN GMO TO GAR-NUM-SIS IN GDG.
           MOVE GAR-COD-CRR IN GMO TO GAR-COD-CRR IN GDG.
           MOVE 'GAR-CLV-GDG-1' TO FIO-AKEY.
           MOVE FIO-GET-NLS  TO FIO-CMND.
           PERFORM GAR-FIO-GDG.
           IF NOT (
              FIO-STAT-OKS AND
              GAR-NUM-SIS IN GDG = GAR-NUM-SIS IN GMO AND
              GAR-COD-CRR IN GDG = GAR-COD-CRR IN GMO )
               MOVE 'GAR'          TO MSG-COD-SIST
               MOVE 'GDG    NEX' TO MSG-COD-MENS
               GO TO FIN-BUS-GDG.

           IF GAR-IND-CPL IN GDG NOT = 'S'
               MOVE 'GDG    CPLNO' TO MSG-COD-MENS.

       FIN-BUS-GDG.
           EXIT.

       BUS-GVT SECTION.
       INI-BUS-GVT.

           IF MSG-COD-MENS > SPACES
               GO TO FIN-BUS-GVT.

      * Busca el Valor Contabilizado en la Tasacion Vigente
           MOVE GAR-NUM-SIS IN GMO TO GAR-NUM-SIS IN GVT.
           MOVE GAR-COD-CRR IN GMO TO GAR-COD-CRR IN GVT.
           MOVE GAR-COD-TSN IN GMO TO GAR-COD-TSN IN GVT
           MOVE 'GAR-CLV-GVT-1' TO FIO-AKEY.
           MOVE FIO-GET-KEY     TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           IF NOT FIO-STAT-OKS 
               MOVE 'GAR'        TO MSG-COD-SIST
               MOVE 'GVT    NEX' TO MSG-COD-MENS.
       FIN-BUS-GVT.
           EXIT.

       BUS-TAG SECTION.
       INI-BUS-TAG.

           IF MSG-COD-MENS > SPACES
               GO TO FIN-BUS-TAG.

      * Busca Tabla TAG
           MOVE GAR-TIP-OPE IN GDG TO GAR-TIP-OPE IN TAG.
           MOVE GAR-STP-OPE IN GDG TO GAR-STP-OPE IN TAG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-TAG.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'        TO MSG-COD-SIST
               MOVE 'TAG    NEX' TO MSG-COD-MENS.
       FIN-BUS-TAG.
           EXIT.

      **************************************************************************
       BUS-OFI-CNT SECTION.
       INI-BUS-OFI-CNT.
      * Carga oficina contable en SRT

           IF MSG-COD-MENS > SPACES
               GO TO FIN-BUS-OFI-CNT.

           MOVE GAR-COD-OFI-MOV IN GMO TO OFI-COD-OFIC IN OFI.
           PERFORM BUS-OFI.
      *     MOVE OFI-COD-OFCO IN OFI TO SRT-COD-OFIC IN SRT.
           MOVE GAR-COD-OFI-MOV IN GMO TO SRT-COD-OFIC IN SRT.
       FIN-BUS-OFI-CNT.
           EXIT.

      **************************************************************************
      * Obtiene Valor de Cambio en Pesos para Moneda Nacional
        DET-VAL-PESO SECTION.
        INI-DET-VAL-PESO.
      * Obtiene Valor de Cambio en Pesos a Fecha Contabilizacion
      *
           IF MSG-COD-MENS > SPACES
               GO TO FIN-DET-VAL-PESO.

           IF NOT (
              GAR-TIP-VCB IN GDG = '0' AND
              GAR-VCB IN GDG NOT = WSS-COD-PESO IN WSS-VARI
              )
               MOVE GAR-VCB IN GDG TO SRT-COD-VCAM IN SRT
               GO TO FIN-DET-VAL-PESO.

           MOVE WSS-COD-PESO IN WSS-VARI TO SRT-COD-VCAM IN SRT.
           MOVE WSS-FEC-CNT TO CAM-FEC-FCAM IN CAM(1).
           MOVE WSS-FEC-CNT TO CAM-FEC-FCAM IN CAM(2).
           MOVE GAR-VCB     IN GDG       TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT (
              FIO-STAT-OKS AND CAM-IND-VIGE IN CAM = 'S'
              )
               MOVE 'CAM    NEX' TO MSG-COD-MENS
               STRING  'VCAM NO EXISTE O NO ESTA VIGENTE A FECHA : '
                        GAR-FEC-MOV IN GMO ' PARA : '
                        GAR-VCB IN GDG ' EN OPERACION : '
                        GAR-CLV-GDG-1 IN GDG
                  DELIMITED BY SIZE INTO MSG-GLS-DESC
               MOVE WSS-NO-BUSCA-MSG-ERROR TO WSS-IND-GET-MSG
               GO TO FIN-DET-VAL-PESO
           ELSE
               MULTIPLY WSS-VAL-CNT BY CAM-SGV-VCAM GIVING
                        WSS-VAL-PESO ROUNDED
               MOVE WSS-VAL-PESO TO WSS-VAL-CNT.
       FIN-DET-VAL-PESO.
           EXIT.

      **************************************************************************
       ING-CTA-DEB SECTION.
       INI-ING-CTA-DEB.
      * Entra la cuenta
           IF MSG-COD-MENS = SPACES
               MOVE GAR-CTA-CTB-DEB IN TAG TO SRT-CIC-CCSB IN SRT
               MOVE 'D' TO SRT-IND-DBHB IN SRT
               MOVE WSS-VAL-CNT TO SRT-VAL-DEBE IN SRT
               MOVE ZEROES      TO SRT-VAL-HABE IN SRT
               PERFORM MOV-INP-SRT.
       FIN-ING-CTA-DEB.
           EXIT.
                   
       ING-CTA-HAB SECTION.
       INI-ING-CTA-HAB.
      * Entra la contracuenta
           IF MSG-COD-MENS = SPACES
               MOVE GAR-CTA-CTB-HAB IN TAG TO SRT-CIC-CCSB IN SRT
               MOVE 'H' TO SRT-IND-DBHB IN SRT
               MOVE SRT-VAL-DEBE IN SRT TO SRT-VAL-HABE IN SRT
               MOVE ZEROES              TO SRT-VAL-DEBE IN SRT
               PERFORM MOV-INP-SRT.
       FIN-ING-CTA-HAB.
           EXIT.

       EGR-CTA-DEB SECTION.
       INI-EGR-CTA-DEB.
      * Sale la cuenta
           IF MSG-COD-MENS = SPACES
               MOVE GAR-CTA-CTB-DEB IN TAG TO SRT-CIC-CCSB IN SRT
               MOVE 'H' TO SRT-IND-DBHB IN SRT
               MOVE WSS-VAL-CNT TO SRT-VAL-HABE IN SRT
               MOVE ZEROES      TO SRT-VAL-DEBE IN SRT
               PERFORM MOV-INP-SRT.
       INI-EGR-CTA-DEB.
           EXIT.

       EGR-CTA-HAB SECTION.
       EGR-ING-CTA-HAB.
      * Sale la contracuenta
           IF MSG-COD-MENS = SPACES
               MOVE GAR-CTA-CTB-HAB IN TAG TO SRT-CIC-CCSB IN SRT
               MOVE 'D' TO SRT-IND-DBHB IN SRT
               MOVE SRT-VAL-HABE IN SRT TO SRT-VAL-DEBE IN SRT
               MOVE ZEROES              TO SRT-VAL-HABE IN SRT
               PERFORM MOV-INP-SRT.
       INI-EGR-CTA-HAB.
           EXIT.

      **************************************************************************
      * Despliega mensaje error en la entrada
       ERR-INP SECTION.
       INI-ERR-INP.
           IF WSS-IND-GET-MSG = WSS-BUSCA-MSG-ERROR
               PERFORM GET-MSG.
           DISPLAY MSG-COD-MENS ' : ' GAR-CLV-GMO-1 IN GMO
                  ' CON ID GARANTIA : ' GAR-CLV-GDG-1 IN GDG
                  ' Y TSN : ' GAR-COD-TSN IN GVT.
           ADD 1 TO WSS-IND-RBAD IN WSS-VARI.
       INI-ERR-INP.
           EXIT.

      **************************************************************************
      * Busca Datos Cliente por Medio del CIC de Operaciones en Registro RDC
       BUS-REG-CLI SECTION.
       INI-BUS-REG-CLI.
      * Busca CIC del Cliente con el CIC de Garantias en GDD
           MOVE GDG-NUM-SIS IN SRT TO GAR-NUM-SIS IN GDD.
           MOVE GDG-COD-CRR IN SRT TO GAR-COD-CRR IN GDD.
           MOVE 'GAR-CLV-GDD-2'     TO FIO-AKEY.
           MOVE FIO-GET-KEY         TO FIO-CMND.
           PERFORM GAR-FIO-GDD.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'        TO MSG-COD-SIST
               MOVE 'GDD    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC ' ' GAR-ID IN GDD.
      *        GO TO FIN-BUS-REG-CLI.

      *CIC-CLI Busca Datos del Cliente Mediante su CIC
           MOVE GDD-CIC-ICLI IN GDD TO DBC-CIC-ICLI IN DBC.
           MOVE FIO-GET-KEY  TO FIO-CMND.
           PERFORM GET-CLI.
           IF MSG-COD-MENS > SPACES
               MOVE SPACES TO DBC-NUM-ICLI IN DBC
                              DBC-VRF-ICLI IN DBC
                              DBC-IND-ICLI IN DBC
                              WSS-GLS-AUXI IN WSS-LMG
                              DBC-GLS-ICLI IN DBC
           ELSE
               MOVE DBC-GLS-NOMC IN DBC TO CPT-STRN
               PERFORM CPT-BLKS
               MOVE CPT-STRN TO DBC-GLS-NOMC IN DBC
               IF DBC-GLS-ICLI IN DBC > SPACES
                   MOVE '-'    TO WSS-GLS-AUXI IN WSS-LMG
               ELSE
                   MOVE SPACES TO WSS-GLS-AUXI IN WSS-LMG.
       FIN-BUS-REG-CLI.
           EXIT.
      **************************************************************************

       COPY GARBFGDG.
       COPY GARBFTAG.
       COPY GARBFGVT.
       COPY GARBFGDD.

       COPY SGCBFDBC.

       COPY TABBFCAM.

      * Modulo FIO para archivo RMS TABMCT,  7-JUN-1991 11:54:05.87
       TAB-FIO-MCT-AUX SECTION.
       INI-TAB-FIO-MCT-AUX.
           CALL 'TABPFMCT' USING FIO-VARI MCT.
       FIN-TAB-FIO-MCT-AUX.
           EXIT.

       COPY GNSBGFEC.
       COPY GNSBGHOY.
       COPY GNSBGCPT.
       COPY SGCBGCLI.
       COPY SGCBFTAB.
      *>>>>

