*% FRM = 'GTP'
*% REG = 'GTP'
*% IF FIN_PUT_GTP_GTP
      *<<<< FIN_PUT_GTP_GTP
           MOVE GAR-COD-EST-ITM IN GTP TO WSS-EST-ANT.

      *BUS-TAB busca glosa de codigo en tabla
           IF GTP-COD-EST-ITM IN GTP-FLD > SPACES
               MOVE 'GAR' TO TAB-COD-SIST
               MOVE 'ES1' TO TAB-COD-TTAB IN TAB
               MOVE GTP-COD-EST-ITM IN GTP-FLD TO TAB-COD-CTAB IN TAB
               PERFORM BUS-TAB
               MOVE TAB-COD-DAT2 IN TAB(1) TO WSS-ES1-1
               MOVE TAB-COD-DAT2 IN TAB(2) TO WSS-ES1-2
               MOVE TAB-COD-DAT2 IN TAB(3) TO WSS-ES1-3
               MOVE TAB-COD-DAT2 IN TAB(4) TO WSS-ES1-4
               MOVE TAB-GLS-DCOR IN TAB TO
                    FRM-GLS-EST-ITM IN GTP-FLD.

      *>>>>
*% END
*% IF GTP_FEC_CMB_EST
      *<<<< GTP_FEC_CMB_EST

      *VAL-FEC valida que fec. cambio sea mayor o igual a fec. tasacion 
           MOVE GTP-NUM-SIS IN GTP-FLD TO GAR-NUM-SIS IN GVT.
           MOVE GTP-COD-CRR IN GTP-FLD TO GAR-COD-CRR IN GVT.
           MOVE GTP-COD-TSN IN GTP-FLD TO GAR-COD-TSN IN GVT.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           IF FIO-STAT-OKS 
                  MOVE GAR-FD-TSN IN GVT TO FEC-DEC1
                  MOVE GAR-FM-TSN IN GVT TO FEC-MEC1
                  MOVE GAR-FA-TSN IN GVT TO FEC-FSA1
      *     
                  MOVE GTP-FD-CMB-EST IN GTP-FLD TO FEC-DEC2
                  MOVE GTP-FM-CMB-EST IN GTP-FLD TO FEC-MEC2
                  MOVE GTP-FA-CMB-EST IN GTP-FLD TO FEC-FSA2
                  MOVE FEC-FORM-FEC TO FEC-FORM
                  MOVE FEC-CMP-FEC  TO FEC-CMND
                  PERFORM PRO-FEC
                  IF FEC-STAT-GRT
                      MOVE 'GAR' TO MSG-COD-SIST
                      MOVE 'GTPCMB<TSN' TO MSG-COD-MENS
                      PERFORM GET-MSG
                      MOVE MSG-GLS-DESC TO FRM-MENS
                      MOVE FRM-SUAR-MAL TO FRM-SUAR
                      GO TO FIN-VAL-GTP-FEC-CMB-EST
                  ELSE
                      NEXT SENTENCE
           ELSE
               MOVE 'GTPKEYMALGDG' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
               GO TO FIN-VAL-GTP-FEC-CMB-EST.

      *>>>>
*% END
*% IF GTP_COD_EST_ITM
      *<<<< GTP_COD_EST_ITM
      *VAL-COD Valida codigo de tabla
           MOVE 'GAR' TO TAB-COD-SIST.
           MOVE 'ES1' TO TAB-COD-TTAB IN TAB.
           MOVE GTP-COD-EST-ITM IN {FRM}-FLD TO TAB-COD-CTAB IN TAB.
           PERFORM VAL-COD.
           IF MSG-COD-MENS = 'COD    NEX' OR
              GTP-COD-EST-ITM IN {FRM}-FLD NOT > SPACES
               MOVE SPACES TO FRM-GLS-EST-ITM IN {FRM}-FLD
               GO TO FIN-VAL-GTP-COD-EST-ITM
           ELSE
               MOVE TAB-GLS-DCOR IN TAB TO
                    FRM-GLS-EST-ITM IN {FRM}-FLD.

           IF SCR-CCPP = 'ING'  

               IF GTP-COD-EST-ITM IN {FRM}-FLD > '10'
                   MOVE 'EST-ITM>10' TO MSG-COD-MENS
                   GO TO ERR-VAL-GTP-COD-EST-ITM
               ELSE
                   GO TO FIN-VAL-GTP-COD-EST-ITM.

      * CAMBIOS DE ESTADO
           IF GTP-COD-EST-ITM IN {FRM}-FLD NOT = WSS-EST-ANT
               IF NOT (GTP-COD-EST-ITM IN {FRM}-FLD = WSS-ES1-1 OR
                       GTP-COD-EST-ITM IN {FRM}-FLD = WSS-ES1-2 OR
                       GTP-COD-EST-ITM IN {FRM}-FLD = WSS-ES1-3 OR
                       GTP-COD-EST-ITM IN {FRM}-FLD = WSS-ES1-4)
                   MOVE 'ESTITMNVOANT' TO MSG-COD-MENS
                   GO TO ERR-VAL-GTP-COD-EST-ITM.
           GO TO FIN-VAL-GTP-COD-EST-ITM.

       ERR-VAL-GTP-COD-EST-ITM.
           MOVE 'GAR' TO MSG-COD-SIST.
           PERFORM GET-MSG.
           MOVE MSG-GLS-DESC TO FRM-MENS.
           MOVE FRM-SUAR-MAL TO FRM-SUAR.
      *>>>>
*% END
*% IF GTP_VAL_UNT_ITM
      *<<<< GTP_VAL_UNT_ITM

      * Obtiene Codigo Valor de Cambio de Pesos Mediante CIC de la Moneda '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC TO FRM-MENS
               MOVE FRM-SUAR-MAL TO FRM-SUAR
           ELSE
           IF GDG-VCB IN GTP-FLD = TAB-COD-CTAB IN TAB
               MOVE GTP-VAL-UNT-ITM IN GTP-FLD TO 
                    PES-SGV-DECI IN PES-VARI
               PERFORM PES-SCTV
               MOVE PES-SGV-ENTE IN PES-VARI TO
                    GTP-VAL-UNT-ITM IN GTP-FLD.
      *>>>>
*% END
