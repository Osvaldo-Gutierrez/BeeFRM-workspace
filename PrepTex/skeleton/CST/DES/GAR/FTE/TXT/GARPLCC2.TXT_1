*% REG = 'GDG'
*% RPT = 'CC2'
*% IF WSS
      *<<<< WSS
       COPY TABBROFI.
       COPY TABBRCAM.

       COPY GARBRGVT.
       COPY GARBRTAG.

       01  WSS-VARI.
      * Fecha de Proceso que es leida de tabla TFP
           03 WSS-FEC-FPRO.
              05 WSS-NUM-SPRO                     PIC 9(02).
              05 WSS-NUM-APRO                     PIC 9(02).
              05 WSS-NUM-MPRO                     PIC 9(02).
              05 WSS-NUM-DPRO                     PIC 9(02).
           03 WSS-COD-PESO.
              05 WSS-TIP-VCB-PESO                 PIC X(01).
              05 FILLER	                          PIC X(05).
           03 WSS-COD-CTA.
              05 WSS-CLA-OPE-SUP                  PIC X(03).
              05 WSS-VCB                          PIC X(06).
           03 WSS-GLS-MSGE.
              05 WSS-GLS-MSG1        VALUE SPACES PIC X(20).
              05 WSS-GLS-MSG2        VALUE SPACES PIC X(22).
              05 WSS-GLS-MSG3        VALUE SPACES PIC X(08).
              05 WSS-GLS-MSG4        VALUE SPACES PIC X(08).
              05 WSS-GLS-MSG5        VALUE SPACES PIC X(08).
              05 WSS-GLS-MSG6        VALUE SPACES PIC X(13).
              05 WSS-GLS-MSG7        VALUE SPACES PIC X(12).
           03 WSS-VAL-PESO                        PIC S9(11).
           03 VEC-MES OCCURS 12.
              05 WSS-VEC-DMES                     PIC X(10).
           03 WSS-TIP-STP.
              05 WSS-TIP-OPE                      PIC X(03).
              05 WSS-STP-OPE                      PIC X(03).
      *>>>>
*% END
*% IF WSS_DTC
      *<<<< WSS_DTC
      *Entidades de TAB
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-OFI-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *Entidades de GAR
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
      *>>>>
*% END
*% IF CF_{RPT}_GDG_VCB
      *<<<< CF_{RPT}_GDG_VCB
*% IF PGM_VMS
      *<<<< PGM_VMS
*% INCLUDE 'GARSRC:BUSVLRLIS.SRC'
      *>>>>
*% END
      *>>>>
*% END
*% IF CF_{RPT}_GDG_COD_OFI
      *<<<< CF_{RPT}_GDG_COD_OFI
*% IF PGM_VMS
      *<<<< PGM_VMS
*% INCLUDE 'GARSRC:BUSOFILIS.SRC'
      *>>>>
*% END
*% IF PGM_VMS
      *<<<< PGM_VMS
*% FLD = 'GDG-COD-OFI'
*% INCLUDE 'GARSRC:BUSTABVAX.SRC'
*% INCLUDE 'GARSRC:BUSOFIVAX.SRC'
      *>>>>
*% END
      *>>>>
*% END
*% IF FIN_DEC AND PGM_VMS
      *<<<< FIN_DEC PGM_VMS
*% IF PGM_VMS
      *<<<< PGM_VMS
       DEC-PH-{RPT} SECTION.
           USE BEFORE REPORTING PH-{RPT}.
       INI-DEC-PH-{RPT}.
      *<<<< PH_GDG
       PH-VCAM.
      *BUS-TAB Busca Glosa de Valor de Cambio
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'VLR' TO TAB-COD-TTAB IN TAB.
           MOVE SPACES TO TAB-COD-CTAB IN TAB.
           MOVE GDG-VCB IN SRT TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           MOVE TAB-GLS-DESC IN TAB TO WSS-GLS-VCB IN WSS-{RPT}.

      * Mediante BUS-OFI Obtiene Nombre y Direccion Oficina de Tabla OFI
       PH-OFIC.
      *BUS-OFI Busca Codigo de Tabla
           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'OFI' TO TAB-COD-TTAB IN TAB.
           MOVE SPACES TO OFI-GLS-DESC IN OFI.
           MOVE GDG-COD-OFI IN SRT TO OFI-COD-OFIC IN OFI.
           PERFORM BUS-OFI.
           MOVE OFI-GLS-DESC IN OFI TO WSS-GLS-OFI IN WSS-{RPT}.
       FIN-DEC-PH-{RPT}.
           EXIT.
      *>>>> END_PGM_VMS
*% END
      *>>>> END_FIN_DEC
*% END
*% IF PH_{RPT} AND ( PGM_DOS OR PGM_MVS )
      *<<<< PH_{RPT} AND ( PGM_DOS OR PGM_MVS )
*% LRG = 12
*% INCLUDE 'GARSRC:BUSVLRLIS.SRC'
*% INCLUDE 'GARSRC:BUSOFILIS.SRC'
      *>>>>
*% END
*% IF INI
      *<<<< INI
           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'TAB'   TO FIO-SIST.
           PERFORM TAB-FIO-OFI.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-CAM.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'TAB'   TO FIO-SIST.
           PERFORM TAB-FIO-CAM.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'TAB'   TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-GVT.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-GVT.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GAR-FIO-TAG.
           MOVE FIO-INP TO FIO-CMND.
           MOVE 'GAR'   TO FIO-SIST.
           PERFORM GAR-FIO-TAG.

      * OBTIENE CODIGO VALOR DE CAMBIO DE PESOS MEDIANTE CIC DE LA MONEDA '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY MSG-GLS-DESC   TAB-CIC-CTAB
               PERFORM CLO-FIL
               PERFORM GNS-PRO-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN WSS-VARI.

      *Lee Tabla de Fechas de Proceso
           MOVE 'GAR' TO TAB-COD-SIST.
           MOVE 'GAR' TO FIO-SIST.
           MOVE 'TFP' TO TAB-COD-TTAB IN TAB.
           MOVE '01'  TO TAB-COD-CTAB IN TAB.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF FIO-STAT-OKS
               MOVE TAB-GLS-DAT1 TO WSS-FEC-FPRO IN WSS-VARI
               DISPLAY 'FECHA DE PROCESO : ' TAB-GLS-DAT1
           ELSE
              DISPLAY 'ERROR EN LECTURA FECHA DE PROCESO COD 01'
               PERFORM CLO-FIL
               PERFORM GNS-PRO-ABT.

           MOVE 'ENERO'      TO WSS-VEC-DMES IN VEC-MES(1).
           MOVE 'FEBRERO'    TO WSS-VEC-DMES IN VEC-MES(2).
           MOVE 'MARZO'      TO WSS-VEC-DMES IN VEC-MES(3).
           MOVE 'ABRIL'      TO WSS-VEC-DMES IN VEC-MES(4).
           MOVE 'MAYO'       TO WSS-VEC-DMES IN VEC-MES(5).
           MOVE 'JUNIO'      TO WSS-VEC-DMES IN VEC-MES(6).
           MOVE 'JULIO'      TO WSS-VEC-DMES IN VEC-MES(7).
           MOVE 'AGOSTO'     TO WSS-VEC-DMES IN VEC-MES(8).
           MOVE 'SEPTIEMBRE' TO WSS-VEC-DMES IN VEC-MES(9).
           MOVE 'OCTUBRE'    TO WSS-VEC-DMES IN VEC-MES(10).
           MOVE 'NOVIEMBRE'  TO WSS-VEC-DMES IN VEC-MES(11).
           MOVE 'DICIEMBRE'  TO WSS-VEC-DMES IN VEC-MES(11).

           MOVE WSS-VEC-DMES IN VEC-MES(WSS-NUM-MPRO) TO WSS-GLS-DMES.

      *>>>>
*% END
*% IF LUP_INP
      *<<<< LUP_INP
           IF GAR-IND-CPL IN GDG NOT = 'S' OR 
              GAR-FEC-ALZ > ZEROES OR
              GAR-TIP-VCB IN GDG NOT = '0'
               GO TO NXT-INP-SRT.

      *Lee Registro Tag
           MOVE GAR-TIP-OPE IN GDG TO GAR-TIP-OPE IN TAG.
           MOVE GAR-STP-OPE IN GDG TO GAR-STP-OPE IN TAG.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-TAG.
           IF NOT FIO-STAT-OKS
               MOVE 'GAR'        TO MSG-COD-SIST
               MOVE 'TAG    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY 'TAG : ' GAR-CLV-TAG-1 IN TAG ' '
                       MSG-GLS-DESC
               GO TO NXT-INP-SRT.

      * Busca Codigo Cuenta Contable en Tabla DCC de GAR
           MOVE 'GAR'                  TO TAB-COD-SIST.
           MOVE 'DCC'                  TO TAB-COD-TTAB IN TAB.
           MOVE GAR-CLA-OPE-SUP IN TAG TO WSS-CLA-OPE-SUP.
           MOVE GAR-VCB         IN GDG TO WSS-VCB.
           MOVE WSS-COD-CTA            TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               MOVE 'GAR'        TO MSG-COD-SIST
               MOVE 'DCC    NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               DISPLAY 'DCC : ' TAB-COD-CTAB IN TAB ' '
                       MSG-GLS-DESC
               GO TO NXT-INP-SRT.
           MOVE TAB-GLS-DATA IN TAB TO SRT-CIC-CCSB.

           MOVE 'TAB' TO TAB-COD-SIST.
           MOVE 'AUX' TO TAB-COD-TTAB IN TAB.
           MOVE GAR-TIP-OPE IN GDG TO WSS-TIP-OPE.
           MOVE GAR-STP-OPE IN GDG TO WSS-STP-OPE.
           MOVE WSS-TIP-STP TO TAB-COD-CTAB IN TAB.
           PERFORM BUS-TAB.
           IF MSG-COD-MENS > SPACES
               MOVE SPACES TO MSG-COD-MENS
           ELSE
               MOVE TAB-GLS-DESC IN TAB      TO SRT-GLS-DESC IN SRT.

*% INCLUDE 'GARSRC:BUSGVTLIS.SRC'
           IF NOT FIO-STAT-OKS
               MOVE ZEROES TO GAR-FEC-TSN IN GVT
                              GAR-FEC-RVL IN GVT
                              GAR-VAL-CML-TSN IN GVT
                              GAR-VAL-AJT-SUP IN GVT.

           IF GAR-VCB IN GDG NOT = WSS-COD-PESO
               PERFORM BUS-VCAM
               IF MSG-COD-MENS > SPACES
                   MOVE SPACES TO MSG-COD-MENS
                   MOVE ZEROES TO SRT-VAL-UCON IN SRT
               ELSE
                   MULTIPLY GAR-VAL-AJT-SUP IN GVT BY 
                            CAM-SGV-VCAM IN CAM GIVING
                        WSS-VAL-PESO ROUNDED
                   MOVE WSS-VAL-PESO TO SRT-VAL-UCON IN SRT 
           ELSE
               MOVE GAR-VAL-AJT-SUP IN GVT TO SRT-VAL-UCON IN SRT.

      *>>>>
*% END
*% IF FIN
      *<<<< FIN
           PERFORM CLO-FIL.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
      * OBTIENE VALOR DE CAMBIO EN PESOS PARA MONEDA NACIONAL
        BUS-VCAM SECTION.
        INI-BUS-VCAM.
      * OBTIENE VALOR DE CAMBIO EN PESOS A FECHA CONTABILIZACION
      *
           MOVE GAR-FEC-RVL IN GVT TO CAM-FEC-FCAM IN CAM(1).
           MOVE GAR-FEC-RVL IN GVT TO CAM-FEC-FCAM IN CAM(2).
           MOVE GAR-VCB     IN GDG       TO CAM-COD-VCAM IN CAM(1).
           MOVE WSS-COD-PESO IN WSS-VARI TO CAM-COD-VCAM IN CAM(2).
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM TAB-FIO-CAM.
           IF NOT (
              FIO-STAT-OKS AND CAM-IND-VIGE IN CAM = 'S'
              )
               MOVE 'CAM    NEX' TO MSG-COD-MENS
      *RVM:
               MOVE 'VCAM NO EXISTE O NO '   TO WSS-GLS-MSG1
               MOVE 'ESTA VIGTE. A FECHA : ' TO WSS-GLS-MSG2
               MOVE GAR-FEC-RVL IN GVT       TO WSS-GLS-MSG3
               MOVE ' PARA : '               TO WSS-GLS-MSG4
               MOVE GAR-VCB IN GDG           TO WSS-GLS-MSG5
               MOVE ' EN OPERC. : '          TO WSS-GLS-MSG6 
               MOVE GAR-CLV-GDG-1 IN GDG     TO WSS-GLS-MSG7
               MOVE WSS-GLS-MSGE IN WSS-VARI TO MSG-GLS-DESC IN MSG
               DISPLAY MSG-GLS-DESC IN MSG
               GO TO FIN-BUS-VCAM.
       FIN-BUS-VCAM.
           EXIT.

       COPY GARBFGVT.
       COPY GARBFTAG.

       COPY TABBFCAM.
*% IF NOT PGM_VMS
      *>>>> NOT PGM_VMS
       COPY TABBFOFI.
       COPY TABBBOFI.

       COPY GNSBBTAB.
       COPY GNSBBMSG.
      *>>>>
*% END
       CLO-FIL SECTION.
       INI-CLO-FIL.
           MOVE FIO-CLO      TO FIO-CMND.
           PERFORM TAB-FIO-OFI.
           PERFORM TAB-FIO-CAM.

           MOVE FIO-CLO      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE 'GAR'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-CLO      TO FIO-CMND.
           PERFORM GAR-FIO-GVT.
           PERFORM GAR-FIO-TAG.
       FIN-CLO-FIL.
           EXIT.
      *>>>>
*% END
