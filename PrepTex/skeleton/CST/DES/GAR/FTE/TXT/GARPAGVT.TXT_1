*% NO_HDR_CST = TRUE
*%! IF PGM_DTC
*%! INCLUDE 'GARSRC:GNSVSIDTC.SRC'
*%! END
*%! HASTA AQUI PARA MANEJAR VSAM EN AMBIENTE DTC
*% FRM = "GVT"
*% PGM_GVT = TRUE
*% GRA_GMO = TRUE
*%! CODIGO ADICIONAL PARA FUNCION GARPPVCG = PF5 DESDE GARPAGVT
*% INCLUDE 'GARSRC:PFALL5.SRC'
*%! CODIGO ADICIONAL PROGRAMA GARPAGVT
*% MOD_ADI_GVT = TRUE
*% REG = 'GVT'
*% HIJ = 'GDG'
*% CAIREG = 'GAR-NUM-SIS'
*% IICREG = 'GAR-COD-CRR'
*% CAIFLD = 'GVT-NUM-SIS'
*% IICFLD = 'GVT-COD-CRR'
*% SISREG = 'GAR'
*% IF FIN_SCR_VARI
           03 CMA-VARI.
              05 {CAIREG}                      PIC X(04).
              05 {IICREG}                      PIC X(08).
              05 GAR-IND-OBL-CEM                  PIC X(01).
              05 GAR-IND-OBL-MCT                  PIC X(01).
              05 GAR-PCT-PON     COMP-3           PIC 9(03)V9(2).
              05 GAR-PCT-AJT-SUP COMP-3           PIC 9(03)V9(2).
              05 GAR-PDO-VIG-TSN                  PIC 9(03).
              05 GAR-UTP-VIG-TSN                  PIC X(01).
              05 GAR-IND-CPL                      PIC X(01). 
              05 GAR-COD-TSN                      PIC 9(03). 
*% IF PGM_ARG
      *<<<< PGM_ARG
              05 WSS-VAL-CML-TSN COMP-3           PIC S9(13)V9(2). 
              05 WSS-VAL-LIQ-TSN COMP-3           PIC S9(13)V9(2). 
              05 WSS-VAL-PON     COMP-3           PIC S9(13)V9(2). 
              05 WSS-VAL-AJT-SUP COMP-3           PIC S9(13)V9(2). 
      *>>>>
*% ELSE
      *<<<< NOT PGM_ARG
              05 WSS-VAL-CML-TSN COMP-3           PIC S9(11)V9(4). 
              05 WSS-VAL-LIQ-TSN COMP-3           PIC S9(11)V9(4). 
              05 WSS-VAL-PON     COMP-3           PIC S9(11)V9(4). 
              05 WSS-VAL-AJT-SUP COMP-3           PIC S9(11)V9(4). 
      *>>>>
*% END
              05 WSS-FEC-RVL                      PIC X(08).
              05 WSS-FEC-TSN                      PIC X(08).
              05 WSS-LIQ-CML     COMP-3           PIC S9(1)V9(14). 
      *>>>>
*% END
*% IF WSS
      *<<<< WSS
       COPY {SISREG}BRGDG.
       COPY {SISREG}BRGDP.
*% IF PGM_PQ
      *<<<< PGM_PQ
       COPY {SISREG}BRGES.
      *>>>>
*% END
*% IF PGM_PU
      *<<<< PGM_PU
       COPY {SISREG}BRGMO.
      *>>>>
*% END
       COPY {SISREG}BRGSE.
       COPY {SISREG}BRGTP.
       COPY {SISREG}BRTAG.

       COPY TABBRCAM.

      *
*% IF PGM_CHI AND PGM_PQ
      *<<<< PGM_CHI AND PGM_PQ
           COPY USPC113.
      *>>>>
*% END
       01  WSS-VARI.
           03 WSS-COD-PESO.
              05 WSS-IND-TMON                  PIC X(01).
              05 WSS-COD-REST                  PIC X(05).
*% IF PGM_ARG
      *<<<< PGM_ARG
           03 WSS-COD-PESO-1.
              05 WSS-IND-TMON-1                PIC X(01).
              05 WSS-COD-REST-1                PIC X(05).
           03 WSS-VAL-PESO                     PIC S9(13)V9(02).
           03 WSS-VAL-CML-AUX COMP-3           PIC S9(13)V9(02). 
      *>>>>
*% ELSE
      *<<<< NOT PGM_ARG
           03 WSS-VAL-PESO                     PIC S9(11).
           03 WSS-VAL-CML-AUX COMP-3           PIC S9(11)V9(4). 
      *>>>>
*% END
           03 GAR-COD-ITM-TSN                  PIC 9(03).
           03 WSS-AUX         COMP-3           PIC S9(03)V9(12). 
           03 WSS-IMAL                         PIC 9(01).
      * Variables para determinar vigencia de Tasacion
      *    deben estar bajo WSS-VARI
       COPY GARWGEXV.

       COPY GARWGVCG.
*% IF PGM_VAX
      *<<<< PGM_VAX
           03 WSS-REG                          PIC X(03).
      *
      *>>>>
*% END

       COPY GNSWGPES.
*% IF PGM_DTC
      *<<<< PGM_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GDP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GES-REQA==.
*% IF PGM_PU
      *<<<< PGM_PU
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GMO-REQA==.
      *>>>>
*% END
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GSE-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GTP-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-CAM-REQA==.
      *>>>>
*% END
      *>>>>
*% END
*% CMA_USR = TRUE
*% IF CMA AND PGM_IBM
      *<<<< CMA AND PGM_IBM
           02 FILLER                       PIC X(360).
      *>>>>
*% END
*% IF INI_FIO AND PGM_IBM
      *<<<< INI_FIO
           MOVE +360 TO SCR-TCMA.
           IF SCR-DESDE-CMN
               MOVE ZEROES TO WSS-FEC-TSN IN CMA-VARI, 
                              WSS-FEC-RVL IN CMA-VARI,
                              WSS-LIQ-CML IN CMA-VARI.
      *>>>>
*% END
*% IF INI_FIO AND PGM_VAX
      *<<<< INI_FIO

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-OFI.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-CAM.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-CAM.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISREG}'        TO FIO-SIST.
           PERFORM {SISREG}-FIO-TAG.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM {SISREG}-FIO-TAG.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISREG}'        TO FIO-SIST.
           PERFORM {SISREG}-FIO-GDG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM {SISREG}-FIO-GDG.

           MOVE FIO-INP TO FIO-CMND.
           PERFORM {SISREG}-FIO-GDO.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISREG}'        TO FIO-SIST.
           PERFORM {SISREG}-FIO-GDP.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM {SISREG}-FIO-GDP.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISREG}'        TO FIO-SIST.
           PERFORM {SISREG}-FIO-GES.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM {SISREG}-FIO-GES.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISREG}'        TO FIO-SIST.
           PERFORM {SISREG}-FIO-GMO.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM {SISREG}-FIO-GMO.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISREG}'        TO FIO-SIST.
           PERFORM {SISREG}-FIO-GSE.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM {SISREG}-FIO-GSE.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISREG}'        TO FIO-SIST.
           PERFORM {SISREG}-FIO-GTP.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM {SISREG}-FIO-GTP.

           MOVE ZEROES TO WSS-FEC-TSN IN CMA-VARI, 
                          WSS-FEC-RVL IN CMA-VARI,
                          WSS-LIQ-CML IN CMA-VARI.
      *>>>> INI_FIO
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
*% FIN_BUS_HIJ = TRUE
*% INCLUDE 'GARSRC:INIFNDKE1.SRC'
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
       EXA-COM-STAT.
      * EXAMINA RELACION COMANDO ESTADO DE GVT

      * COMANDO CONSULTA ERROR LO TRATA EL GENESIS
           IF SCR-CCPP = 'ACC' AND SCR-STPP = SCR-STAT-CON
               GO TO FIN-FND-KEY.

      * GARANTIA ALZADA
           IF GAR-ES1 IN GDG > '19'
               MOVE 'GDGALZ' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      * COMANDO INGRESO SE VALIDO EN FIN-VAL-CON-IKY
      * ERROR LO TRATA EL GENESIS
           IF SCR-CCPP = 'ING'
               GO TO FIN-FND-KEY.

      * COMANDOS NO INGRESO, NO ENCONTRO REGISTRO
      * ERROR LO TRATA EL GENESIS
           IF NOT FIO-STAT-OKS
               GO TO FIN-FND-KEY.

      * COMANDO MODIFICACION DATOS INFORMATIVOS ULTIMA TASACION
           IF SCR-CMND = 'MTA' AND
              GVT-COD-TSN IN GVT-FLD = GAR-COD-TSN IN GDG
               GO TO FIN-FND-KEY.

      *    NO PERMITE ACTUAR SOBRE TASACION ANTIGUA
           IF GVT-COD-TSN IN GVT-FLD < GAR-COD-TSN IN GDG
               MOVE 'TSNNOVIG' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      *    SE INTENTA MODIFICAR, NO ACTIVAR
           IF SCR-CCPP = 'MOD' AND SCR-CMND = 'MOD'
               IF GAR-IND-CPL IN GDG NOT = 'S'
      *            SE PERMITE MODIFICAR GARANTIA NO ACTIVADA
                   GO TO FIN-FND-KEY
               ELSE
                   MOVE 'GDG    AGAYA' TO MSG-COD-MENS
                   GO TO ERR-FND-KEY.

           IF SCR-CMND = 'RTA' OR SCR-CMND = 'RVL'
      *        IMPIDE SI TASACION NO ESTA ACTIVADA
               IF GVT-MSC-STAT IN GVT NOT = 'A'
                   MOVE 'ATANO' TO MSG-COD-MENS
                   GO TO ERR-FND-KEY
               ELSE
      *        PERMITE RETASAR ULTIMA TASACION DE GARANTIA COMPLETA
      *        PERMITE REVALORIZAR ULTIMA TASACION DE GARANTIA COMPLETA

               IF GAR-IND-CPL IN GDG = 'S'
                   PERFORM SLV-VAL-ANT
                   GO TO FIN-FND-KEY
               ELSE
                   MOVE 'GDG    NOAGA' TO MSG-COD-MENS
                   GO TO ERR-FND-KEY.

      * EXAMINA SI TIENE TASACIONES PARCIALES
           IF FRM-IND-GTP IN GVT-FLD = 'S'
               GO TO EXA-SI-GTP.

      * NO TIENE TASACIONES PARCIALES YA INGRESADAS

      *    SE INTENTA ACTIVAR
           IF SCR-CMND = 'ATA'
      *        COMANDO SOLO PARA TASACIONES PARCIALES
               MOVE 'ATASINGTP' TO MSG-COD-MENS
               GO TO ERR-FND-KEY
           ELSE
      *    SE INTENTA ELIMINAR
           IF SCR-CMND = 'ELI'
               IF GAR-IND-CPL IN GDG NOT = 'S'
      *        SE PERMITE ELIMINAR, GARANTIA NO ACTIVADA
                   GO TO FIN-FND-KEY
               ELSE
                   MOVE 'GDG    AGAYA' TO MSG-COD-MENS
                   GO TO ERR-FND-KEY
           ELSE
      *        COMANDO DESCONOCIDO
               MOVE 'CMNOSITNEX' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      * SI TIENE TASACIONES PARCIALES
       EXA-SI-GTP.

      *    SE INTENTA ACTIVAR
           IF SCR-CMND = 'ATA'

      *        SE PERMITE ACTIVAR, TASACION NO ACTIVADA
               IF GVT-MSC-STAT IN GVT NOT = 'A'

      *            SI GARANTIA COMPLETA SE SALVA CAMPOS ANTERIORES
                   IF GAR-IND-CPL IN GDG = 'S'
                       PERFORM SLV-VAL-ANT
                       GO TO FIN-FND-KEY
                   ELSE
                       GO TO FIN-FND-KEY
               ELSE
                   MOVE 'ATAYA' TO MSG-COD-MENS
                   GO TO ERR-FND-KEY
           ELSE
           IF SCR-CMND = 'ELI'
               IF GAR-IND-CPL IN GDG NOT = 'S'
      *            SE PERMITE ELIMINAR, GARANTIA NO ACTIVADA
                   GO TO FIN-FND-KEY
               ELSE
      *            NO PERMITE ELIMINAR POR GARANTIA Y TASACION ACTIVADAS
                   MOVE 'ATAYA' TO MSG-COD-MENS
                   GO TO ERR-FND-KEY
           ELSE
      *        COMANDO DESCONOCIDO
               MOVE 'CMNOSITNEX' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

       ERR-CMN-STAT.   
           MOVE 'CMNOSITNEX' TO MSG-COD-MENS.
           GO TO ERR-FND-KEY.

*% INCLUDE 'GARSRC:FINFNDKE1.SRC'
      *>>>>
*% END
*% IF ABT_CMN_ACC
      *<<<< ABT_CMN_ACC
               IF SCR-CCPP = 'ACC' AND SCR-STPP NOT = SCR-STAT-CON
                   MOVE 'GAR'        TO MSG-COD-SIST
                   MOVE 'RTARVL NO'  TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-CMN-ACC
               ELSE
      *>>>>
*% END
*% IF INI_CMN_ACC
      *<<<< INI_CMN_ACC
           IF SCR-CCPP = 'ACC' AND SCR-STPP NOT = SCR-STAT-CON
               PERFORM CMN-ING
               IF FIO-STAT-OKS
                   MOVE 'GAR'        TO MSG-COD-SIST
                   MOVE 'RTARVL SI'  TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC TO FRM-MENS
                   GO TO FIN-CMN-ACC
               ELSE
                   MOVE 'GNS'          TO MSG-COD-SIST
                   MOVE 'REG    ERCOP' TO MSG-COD-MENS
                   PERFORM GET-MSG
                   MOVE MSG-GLS-DESC   TO FRM-MENS
                   GO TO FIN-CMN-ACC
           ELSE
               MOVE 'GNS'          TO MSG-COD-SIST
               MOVE 'REG    ERCOP' TO MSG-COD-MENS
               PERFORM GET-MSG
               MOVE MSG-GLS-DESC   TO FRM-MENS
               GO TO FIN-CMN-ACC.
      *>>>>
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
*% IF PGM_ARG
      *<<<< PGM_ARG
           MOVE ZEROES TO GAR-VAL-MCOM IN GVT.
           MOVE ZEROES TO GAR-VAL-MIMP IN GVT.
           MOVE ZEROES TO GAR-VAL-MGTO IN GVT.
      *>>>>
*% END
*% INCLUDE 'GARSRC:LIMFLD.SRC'

      *>>>>
*% END
*% IF CMN_ING OR CMN_MOD
      *<<<< INI_CMN_ING OR INI_CMN_MOD
*% INCLUDE 'GARSRC:STDFLD.SRC'
      *>>>>
*% END
*% IF CMN_ING
      *<<<< CMN_ING
           IF SCR-CCPP = 'ING'
               IF FRM-IND-GTP IN GVT-FLD = 'S'
                   MOVE 'I' TO GVT-MSC-STAT IN GVT
               ELSE
                   MOVE 'A' TO GVT-MSC-STAT IN GVT
           ELSE
      *    COMANDOS RVL Y RTA
               MOVE 'A' TO GVT-MSC-STAT IN GVT
               ADD 1    TO GVT-COD-TSN  IN GVT-FLD
               MOVE GVT-COD-TSN IN GVT-FLD TO GAR-COD-TSN IN GVT
               PERFORM COP-GTP
               IF MSG-COD-MENS = SPACES
                   PERFORM ESC-MOD-GVT
                   IF MSG-COD-MENS > SPACES
                       GO TO FIN-CMN-ING
                   ELSE
                       NEXT SENTENCE
               ELSE
                   GO TO FIN-CMN-ING.
      *>>>>
*% END
*% INI_GMO = TRUE
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING

*% INCLUDE 'GARSRC:FINCMNING.SRC'
      *>>>>
*% END
*% IF CMN_MOD
      *<<<< CMN_MOD

           IF SCR-CMND = 'ATA'
               MOVE 'A' TO GVT-MSC-STAT IN GVT
               IF GAR-IND-CPL IN CMA-VARI = 'S'
                   PERFORM ESC-MOD-GVT
                   IF MSG-COD-MENS > SPACES
                       GO TO FIN-CMN-MOD.
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
           IF NOT FIO-STAT-OKS                                                  
      *        ERROR INCONSISTENCIA EN LA MODIFICACION : INFORMAR               
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-MOD.

           IF SCR-CMND = 'ATA'
               MOVE {CAIREG} IN {REG} TO {CAIREG} IN {HIJ}
               MOVE {IICREG} IN {REG} TO {IICREG} IN {HIJ}
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM {SISREG}-FIO-{HIJ}
               IF FIO-STAT-OKS
                   MOVE 'S' TO GAR-IND-EXI-GVT IN {HIJ}
                   MOVE 'S' TO GAR-IND-EXI-GTP IN {HIJ}
                   MOVE  GAR-COD-TSN IN GVT TO GAR-COD-TSN IN {HIJ}
                   MOVE FIO-MOD TO FIO-CMND
                   PERFORM {SISREG}-FIO-{HIJ}.

      *>>>>
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI
           IF NOT FIO-STAT-OKS
      *        ERROR INCONSISTENCIA EN LA ELIMINACION : INFORMAR
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.

           IF FRM-IND-GTP IN GVT-FLD = 'S'
               PERFORM ELI-GTP.

           MOVE {CAIREG} IN CMA-VARI TO {CAIREG} IN {HIJ}.
           MOVE {IICREG} IN CMA-VARI TO {IICREG} IN {HIJ}.
           MOVE FIO-GET-KEY-UPD TO FIO-CMND.
           PERFORM {SISREG}-FIO-{HIJ}.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ELI.

      * Para saber si queda o no un hijo y grabar el Indicador en {HIJ}
           MOVE SPACES TO GAR-CLV-{REG}-1 IN {REG}.
           MOVE {CAIREG} IN CMA-VARI TO {CAIREG} IN {REG}.
           MOVE {IICREG} IN CMA-VARI TO {IICREG} IN {REG}.
           MOVE FIO-GET-NLS TO FIO-CMND.
           MOVE '{SISREG}-CLV-{REG}-1' TO FIO-AKEY.
           PERFORM {SISREG}-FIO-{REG}.
           IF NOT (
                   FIO-STAT-OKS AND
                   {CAIREG} IN {REG} = {CAIREG} IN CMA-VARI AND
                   {IICREG} IN {REG} = {IICREG} IN CMA-VARI
                  )
      *        No quedo ningun hijo
               MOVE ' ' TO GAR-IND-EXI-{REG} IN {HIJ}.

           SUBTRACT 1 FROM GVT-COD-TSN IN GVT-FLD GIVING
                           GAR-COD-TSN IN GDG.
           MOVE FIO-MOD TO FIO-CMND.
           PERFORM {SISREG}-FIO-{HIJ}.
           IF NOT FIO-STAT-OKS
               MOVE FIO-MENS TO FRM-MENS.
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
*% IF PGM_PQ
      *<<<< PGM_PQ
*% INCLUDE 'GARSRC:BUSULTGTP.SRC'

       SLV-VAL-ANT SECTION.
       INI-SLV-VAL-ANT.
           MOVE GAR-VAL-LIQ-TSN IN GVT TO 
                                 WSS-VAL-LIQ-TSN IN CMA-VARI.
           MOVE GAR-VAL-CML-TSN IN GVT TO
                                 WSS-VAL-CML-TSN IN CMA-VARI.
           MOVE GAR-VAL-PON     IN GVT TO 
                                 WSS-VAL-PON     IN CMA-VARI.
           MOVE GAR-FEC-RVL     IN GVT TO
                                 WSS-FEC-RVL     IN CMA-VARI.
           MOVE GAR-VAL-AJT-SUP IN GVT TO
                                 WSS-VAL-AJT-SUP IN CMA-VARI.
           MOVE GAR-FEC-TSN     IN GVT TO 
                                 WSS-FEC-TSN     IN CMA-VARI.
       FIN-SLV-VAL-ANT.
           EXIT.

      *>>>>
*% END
*% IF PGM_PU
      *<<<< PGM_PU
       ESC-MOD-GVT SECTION.
       INI-ESC-MOD-GVT.
      * SI LA GARANTIA ESTA INCOMPLETA SE ESCRIBE EN RUTINA QUE MARCA
      *    GARANTIA COMPLETA
      * SI ESTA COMPLETA, SE ESCRIBE GMO AQUI

      *          RELACION (LOGICA) CON CONTABILIZACION
      * INGRESO SE HACE EN RUTINA GARPPVCG
      * ING   COD-TSN = 1	COD-MOV = '1'
      *                         ESCRIBIR GMO
      *                         	FEC CALCULO = FEC-RVL
      *                         ESCRIBIR GVT
      *                         	FEC-RVL     = FEC-TSN
      *                         CONTABILIZAR
      *                         	VAL-CNT     = VAL-AJT

      * COMANDOS RTA RVL Y ATA SE EFECTUAN AQUI
      * RTA   COD-TSN > 1       COD-MOV = '2'
      * RVL                     ESCRIBIR GMO PARTE ANT
      * ATA                        	FEC-CNT     = FEC-RVL GVT ANT
      *                         	VAL-CNT     = VAL-AJT GVT ANT
      *                         ESCRIBIR GMO PARTE NVO
      *                         	FEC-CNT     = FEC-RVL GVT NVO
      *                         	VAL-CNT     = VAL-AJT GVT NVO
      *                         ESCRIBIR GVT
      *                         	FEC-RVL DE PANTALLA
      *                         CONTABILIZAR GMO PARTE ANT
      *                         	FEC-CNT     = FEC-RVL GVT ANT
      *                         	VAL-CNT     = VAL-AJT GVT ANT
      *                         CONTABILIZAR GMO PARTE NVO
      *                         	FEC-CNT     = FEC-RVL
      *                         	VAL-CNT     = VAL-AJT GVT NVO

           MOVE ZEROES TO GAR-CRR-MOV IN GMO.
           PERFORM INI-GMO.
           SUBTRACT 1 FROM GAR-COD-TSN IN GVT GIVING
                       GAR-COD-TSN IN GMO.
           MOVE '2' TO GAR-COD-MOV IN GMO.
           IF SCR-CMND = 'RTA'
               MOVE 'R' TO GAR-TIP-MOV IN GMO
           ELSE
           IF SCR-CMND = 'RVL'
               MOVE 'V' TO GAR-TIP-MOV IN GMO
           ELSE
           IF SCR-CMND = 'ATA'
               MOVE 'A' TO GAR-TIP-MOV IN GMO
           ELSE
               MOVE SPACES TO GAR-TIP-MOV IN GMO.

           MOVE FIO-PUT TO FIO-CMND.

           IF GAR-VAL-LIQ-TSN IN GVT NOT = WSS-VAL-LIQ-TSN
               MOVE 'GVT001'               TO GAR-COD-CPO     IN GMO
               MOVE WSS-VAL-LIQ-TSN        TO GAR-VAL-CPO-ANT IN GMO
               MOVE GAR-VAL-LIQ-TSN IN GVT TO GAR-VAL-CPO-NVO IN GMO
               PERFORM GAR-FIO-GMO
               IF NOT FIO-STAT-OKS
                   MOVE 'GMOMODGVT' TO MSG-COD-MENS
                   GO TO FIN-ESC-MOD-GVT.

           IF GAR-VAL-CML-TSN IN GVT NOT = WSS-VAL-CML-TSN
               MOVE 'GVT002'               TO GAR-COD-CPO     IN GMO
               MOVE WSS-VAL-CML-TSN        TO GAR-VAL-CPO-ANT IN GMO
               MOVE GAR-VAL-CML-TSN IN GVT TO GAR-VAL-CPO-NVO IN GMO
               ADD 1                       TO GAR-CRR-MOV     IN GMO
               PERFORM GAR-FIO-GMO
               IF NOT FIO-STAT-OKS
                   MOVE 'GMOMODGVT' TO MSG-COD-MENS
                   GO TO FIN-ESC-MOD-GVT.

           IF GAR-VAL-PON IN GVT NOT = WSS-VAL-PON
               MOVE 'GVT003'           TO GAR-COD-CPO     IN GMO
               MOVE WSS-VAL-PON        TO GAR-VAL-CPO-ANT IN GMO
               MOVE GAR-VAL-PON IN GVT TO GAR-VAL-CPO-NVO IN GMO
               ADD 1                   TO GAR-CRR-MOV     IN GMO
               PERFORM GAR-FIO-GMO
               IF NOT FIO-STAT-OKS
                   MOVE 'GMOMODGVT' TO MSG-COD-MENS
                   GO TO FIN-ESC-MOD-GVT.

           IF GAR-FEC-TSN IN GVT NOT = WSS-FEC-TSN
               MOVE 'GVT004'           TO GAR-COD-CPO     IN GMO
               MOVE 'N'                TO GAR-IND-VAL     IN GMO
               MOVE ZEROES             TO GAR-VAL-CPO-ANT IN GMO
               MOVE ZEROES             TO GAR-VAL-CPO-NVO IN GMO
               MOVE WSS-FEC-RVL        TO GAR-GLS-CPO-ANT IN GMO
               MOVE GAR-FEC-RVL IN GVT TO GAR-GLS-CPO-NVO IN GMO
               ADD 1                   TO GAR-CRR-MOV     IN GMO
               PERFORM GAR-FIO-GMO
               IF NOT FIO-STAT-OKS
                   MOVE 'GMOMODGVT' TO MSG-COD-MENS
                   GO TO FIN-ESC-MOD-GVT.

      *    Se escribe siempre para reflejar contablemente la accion

           MOVE 'GVT005'               TO GAR-COD-CPO     IN GMO.
           MOVE 'S'                    TO GAR-IND-VAL     IN GMO.
           MOVE WSS-FEC-RVL            TO GAR-GLS-CPO-ANT IN GMO.
           MOVE GAR-FEC-RVL IN GVT     TO GAR-GLS-CPO-NVO IN GMO.
           MOVE WSS-VAL-AJT-SUP        TO GAR-VAL-CPO-ANT IN GMO.
           MOVE GAR-VAL-AJT-SUP IN GVT TO GAR-VAL-CPO-NVO IN GMO.
           ADD 1                       TO GAR-CRR-MOV     IN GMO.
           PERFORM GAR-FIO-GMO.
           IF NOT FIO-STAT-OKS
               MOVE 'GMOMODGVT' TO MSG-COD-MENS
               GO TO FIN-ESC-MOD-GVT.

       FIN-ESC-MOD-GVT.
           EXIT.

*% INCLUDE 'GARSRC:INIGMO.SRC'

       ELI-GTP SECTION.
       INI-ELI-GTP.
           MOVE GVT-NUM-SIS IN GVT-FLD TO GAR-NUM-SIS     IN GTP.
           MOVE GVT-COD-CRR IN GVT-FLD TO GAR-COD-CRR     IN GTP.
           MOVE GVT-COD-TSN IN GVT-FLD TO GAR-COD-TSN     IN GTP.
           MOVE 1                      TO GAR-COD-ITM-TSN IN GTP.
           MOVE FIO-GET-NLS TO FIO-CMND.
       LUP-ELI-GTP.
           PERFORM GAR-FIO-GTP.
           IF FIO-STAT-OKS AND 
              GVT-NUM-SIS IN GVT-FLD = GAR-NUM-SIS IN GTP AND
              GVT-COD-CRR IN GVT-FLD = GAR-COD-CRR IN GTP AND
              GVT-COD-TSN IN GVT-FLD = GAR-COD-TSN IN GTP
*% IF PGM_VSI
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM GAR-FIO-GTP
*% END
               MOVE FIO-GET-KEY-UPD TO FIO-CMND
               PERFORM GAR-FIO-GTP
               MOVE FIO-DEL TO FIO-CMND
               PERFORM GAR-FIO-GTP
*% IF PGM_VSI
               MOVE FIO-GET-NLS TO FIO-CMND
*% ELSE
               MOVE FIO-GET-NXT TO FIO-CMND
*% END
               GO TO LUP-ELI-GTP.               
       FIN-ELI-GTP.
           EXIT.

       COP-GTP SECTION.
       INI-COP-GTP.
           MOVE SPACES TO MSG-COD-MENS.
           IF FRM-IND-GTP IN GVT-FLD NOT = 'S'
               GO TO FIN-COP-GTP.

           MOVE GVT-NUM-SIS IN GVT-FLD TO GAR-NUM-SIS     IN GTP.
           MOVE GVT-COD-CRR IN GVT-FLD TO GAR-COD-CRR     IN GTP.
           SUBTRACT 1 FROM GVT-COD-TSN IN GVT-FLD GIVING
                          GAR-COD-TSN     IN GTP.
           MOVE 1      TO GAR-COD-ITM-TSN IN GTP.
           MOVE FIO-GET-KEY TO FIO-CMND.
       LUP-COP-GTP.
           PERFORM GAR-FIO-GTP.
           IF FIO-STAT-OKS AND
              GVT-NUM-SIS IN GVT-FLD = GAR-NUM-SIS IN GTP AND
              GVT-COD-CRR IN GVT-FLD = GAR-COD-CRR IN GTP AND
              ( GVT-COD-TSN IN GVT-FLD - 1 ) = GAR-COD-TSN IN GTP

               MOVE GVT-COD-TSN IN GVT-FLD TO GAR-COD-TSN IN GTP
               MOVE FIO-PUT TO FIO-CMND
               PERFORM GAR-FIO-GTP
               IF NOT FIO-STAT-OKS
                   MOVE 'GTP    PUTNO' TO MSG-COD-MENS
                   MOVE FIO-MENS       TO FRM-MENS
               ELSE
                   SUBTRACT 1 FROM GVT-COD-TSN IN GVT-FLD GIVING
                            GAR-COD-TSN     IN GTP
                   ADD 1 TO GAR-COD-ITM-TSN IN GTP
                   MOVE FIO-GET-KEY TO FIO-CMND
                   GO TO LUP-COP-GTP.               
       FIN-COP-GTP.
           EXIT.

      *>>>>
*% END
       COPY {SISREG}BFGDG.
       COPY {SISREG}BFGDP.
*% IF PGM_PQ
      *<<<< PGM_PQ
       COPY {SISREG}BFGES.
      *>>>>
*% END
*% IF PGM_PU
      *<<<< PGM_PU
       COPY {SISREG}BFGMO.
      *>>>>
*% END
       COPY {SISREG}BFGSE.
       COPY {SISREG}BFGTP.
       COPY {SISREG}BFTAG.

       COPY GARBGVCG.
       COPY GARBKVCG.

       COPY TABBFCAM.
       COPY GNSBGPES.
*% IF PGM_PQ
      *<<<< PGM_PQ

       EXA-VEN-TSN SECTION.
       INI-EXA-VEN-TSN.
  
      * Se determina si la tasacion esta vencida o no

*% FIN_EXA_VTO_TAS = 'EXA-VEN-SEG'
*% FEC_FVTA = 'WSS-FEC-FVTA'
*% FEC_DVTA = 'WSS-FEC-DVTA'
*% FEC_MVTA = 'WSS-FEC-MVTA'
*% FEC_AVTA = 'WSS-FEC-AVTA'
*% FEC_SVTA = 'WSS-FEC-SVTA'
*% FEC_FCTA = 'HOY-FHOY'
*% VTA_LIN = TRUE
*% INCLUDE 'GARSRC:EXAVENTSN.SRC'
           MOVE GAR-NUM-SIS IN GDG TO GAR-NUM-SIS IN GSE.
           MOVE GAR-COD-CRR IN GDG TO GAR-COD-CRR IN GSE.
           MOVE FIO-GET-KEY TO FIO-CMND.
           PERFORM GAR-FIO-GSE.
           IF NOT FIO-STAT-OKS
               GO TO FIN-EXA-VEN-SEG.

      * Se determina si el seguro esta vencido o no

*% FIN_EXA_VTO_SEG = 'FIN-EXA-VEN-SEG'
*% FEC_FCSE = 'HOY-FHOY'
*% INCLUDE 'GARSRC:EXAVENSEG.SRC'
       FIN-EXA-VEN-TSN.
           EXIT.

      *>>>>
*% END
*% IF (PGM_MVS OR PGM_DOS) AND PGM_PQ
      *<<<< (PGM_MVS OR PGM_DOS) AND PGM_PQ
       PRO-FLD-GVT SECTION.
       INI-PRO-FLD-GVT.
           MOVE FRM-CPIM-AEY TO FRM-IND-GTP-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-FEC-TSN-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-VAL-CML-TSN-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-VAL-LIQ-TSN-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-PCT-PON-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-PCT-AJT-SUP-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-IIV-TSD-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-IIV-SVS-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-TIP-CTR-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-M2-TRR-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-COD-UMD-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-FEC-RVL-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-M2-CTR-ATR IN GVT-FLD.
           MOVE FRM-CPIM-AEY TO GVT-TIP-MAQ-EQP-ATR IN GVT-FLD.
       FIN-PRO-FLD-GVT.
           EXIT.
       
*% END
       COPY GNSBPFEC.
*% IF PGM_VMS
      *<<<< PGM_VMS
           COPY GNSBBMSC.
      *>>>>
*% END
      *>>>>
*% END
