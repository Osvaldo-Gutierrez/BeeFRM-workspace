*% NO_HDR_CST = TRUE
*%! IF PGM_DTC
*%! INCLUDE 'GARSRC:GNSVSIDTC.SRC'
*%! END
*%! HASTA AQUI PARA MANEJAR VSAM EN AMBIENTE DTC
*% PGM_GTP = TRUE
*% NOT_PRO_VCG = TRUE
*% FRM = 'GTP'
*% REG = 'GTP'
*% HIJ = 'GDG'
*% CAIREG = 'GAR-NUM-SIS'
*% IICREG = 'GAR-COD-CRR'
*% CAIFLD = 'GTP-NUM-SIS'
*% IICFLD = 'GTP-COD-CRR'
*% SISREG = 'GAR'
*%! Codigo adicional para archivo
*% IF FIN_SCR_VARI
           03 CMA-VARI.
              05 {CAIREG}                     PIC X(04).
              05 {IICREG}                     PIC X(08).
              05 GAR-IND-CPL                     PIC X(01).
              05 GAR-COD-TSN                     PIC 9(03).
              05 WSS-EST-ANT                     PIC X(02).
              05 WSS-ES1-1                       PIC X(02).
              05 WSS-ES1-2                       PIC X(02).
              05 WSS-ES1-3                       PIC X(02).
              05 WSS-ES1-4                       PIC X(02).
      *>>>>
*% END
*% IF WSS
       COPY {SISREG}BR{HIJ}.
       COPY {SISREG}BRTAG.
       COPY {SISREG}BRGVT.

       COPY GNSWGPES.
*% IF PGM_CHI AND PGM_PQ
      *<<<< PGM_CHI AND PGM_PQ
           COPY USPC113.
      *>>>>
*% END
       01  WSS-VARI.
           03 GAR-VCB			       PIC X(06).
              88 MONEDA-SIN-DECIMALES VALUE '0999  '.
           03 GAR-COD-ITM-TSN                  PIC 9(03).
*% IF PGM_DTC
      *<<<< WSS AND PGM_DTC
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-{HIJ}-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GVT-REQA==.
      *>>>>
*% END
*% END
*% CMA_USR = TRUE
*% IF CMA AND PGM_IBM
           02 FILLER                       PIC X(277).
*% END
*% IF INI_FIO AND PGM_IBM
      *<<<< INI_FIO
           MOVE +277 TO SCR-TCMA.
      *>>>>
*% END
*% IF INI_FIO AND PGM_VAX
      *<<<< INI_FIO

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-OFI.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISREG}'        TO FIO-SIST.
           PERFORM {SISREG}-FIO-{HIJ}.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM {SISREG}-FIO-{HIJ}.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISREG}'        TO FIO-SIST.
           PERFORM {SISREG}-FIO-TAG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM {SISREG}-FIO-TAG.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISREG}'        TO FIO-SIST.
           PERFORM {SISREG}-FIO-GVT.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM {SISREG}-FIO-GVT.

      *>>>>
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
*% FIN_BUS_HIJ = TRUE
*% INCLUDE 'GARSRC:INIFNDKE1.SRC'
      *>>>>
*% END
*% IF FIN_FND_KEY
      *<<<< FIN_FND_KEY
      * EXAMINA RELACION COMANDO STATUS DE REGISTRO GTP

       EXA-COM-STAT.

      * Comando Consulta Error lo trata el GENESIS
           IF SCR-CCPP = 'ACC'
               GO TO FIN-FND-KEY.

      * Garantia Alzada
           IF GAR-ES1 IN GDG > '19'
               MOVE 'GDGALZ' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      *FLB CST 14-OCT-1993 
      * Item alzado
           IF GAR-COD-EST-ITM IN GTP > '19'
               MOVE 'ITEMALZ' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

      * Comando Ingreso
           IF SCR-CCPP = 'ING'
      *        Error lo trata el GENESIS
               IF FIO-STAT-OKS OR
                  GTP-COD-ITM-TSN IN GTP-FLD NOT > 1
                   GO TO FIN-FND-KEY
               ELSE
      *            Ingresa Item siguientes al primero
                   SUBTRACT 1 FROM GTP-COD-ITM-TSN IN GTP-FLD
                       GIVING GAR-COD-ITM-TSN IN WSS-VARI
                   MOVE GAR-COD-ITM-TSN IN WSS-VARI TO
                        GAR-COD-ITM-TSN IN GTP
                   MOVE 'GAR-CLV-GTP-1' TO FIO-AKEY
                   MOVE FIO-GET-KEY TO FIO-CMND
                   PERFORM GAR-FIO-GTP
                   IF NOT FIO-STAT-OKS
                       MOVE 'IKYANTNEX' TO MSG-COD-MENS
                       GO TO ERR-FND-KEY
                   ELSE
                      MOVE PGM-STAT-GTP TO FIO-STAT
                      GO TO FIN-FND-KEY
               ELSE
                   GO TO FIN-FND-KEY.

      * Comandos no Ingreso, Registro debe existir
           IF NOT FIO-STAT-OKS
      *        Error lo trata el GENESIS
               GO TO FIN-FND-KEY.

           IF GTP-MSC-STAT IN GTP = 'E'
               MOVE 'GTP   EXTING' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           MOVE GAR-COD-EST-ITM IN GTP TO WSS-EST-ANT IN CMA-VARI.

           IF GAR-IND-CPL IN GDG NOT = 'S' AND
              SCR-CMND NOT = 'ALZ'
               GO TO FIN-FND-KEY.

           IF GAR-IND-CPL IN GDG = 'S' AND
              GVT-MSC-STAT IN GVT = 'I' AND
              SCR-CMND NOT = 'ALZ' AND (
              SCR-CCPP NOT = 'ELI' OR
              SCR-CCPP = 'ELI' AND GTP-COD-TSN IN GTP-FLD >
                                   GAR-COD-TSN IN GDG )
               GO TO FIN-FND-KEY.

           IF GAR-IND-CPL IN GDG = 'S' AND
              GVT-MSC-STAT IN GVT = 'A' AND
              SCR-CCPP NOT = 'ELI'
               GO TO FIN-FND-KEY.

           IF GAR-IND-CPL IN GDG NOT = 'S' AND
              SCR-CMND = 'ALZ'
               MOVE 'GTP    NOAGA' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           IF GAR-IND-CPL IN GDG = 'S' AND
              GVT-MSC-STAT IN GVT = 'I' AND
              SCR-CMND = 'ALZ'
               MOVE 'GTP    NOAGA' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           IF GAR-IND-CPL IN GDG = 'S' AND
              GVT-MSC-STAT IN GVT = 'I' AND (
              SCR-CCPP = 'ELI' AND GTP-COD-TSN IN GTP-FLD NOT >
                                   GAR-COD-TSN IN GDG )
               MOVE 'GTP    AGAYA' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           IF GAR-IND-CPL IN GDG = 'S' AND
              GVT-MSC-STAT IN GVT = 'A' AND
              SCR-CCPP = 'ELI'
               MOVE 'GTP    AGAYA' TO MSG-COD-MENS
               GO TO ERR-FND-KEY.

           MOVE 'GTPCMNSTA' TO MSG-COD-MENS.
           GO TO ERR-FND-KEY.

*% INCLUDE 'GARSRC:FINFNDKE1.SRC'
      *>>>>
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
*% INCLUDE 'GARSRC:LIMFLD.SRC'

      *>>>>
*% END
*% IF CMN_ING OR CMN_MOD
      *<<<< INI_CMN_ING OR INI_CMN_MOD
*% INCLUDE 'GARSRC:STDFLD.SRC'
      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en el comando : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-ING. 

           PERFORM MOD-GVT.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-ING.
      *>>>>
*% END
*% IF CMN_MOD
      *<<<< CMN_MOD
      *    En Tramite Alzamiento se considera alzado para fines
      *       operacionales
           IF GTP-COD-EST-ITM IN GTP-FLD > '14'
               MOVE 'E' TO GTP-MSC-STAT IN GTP.
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
           IF NOT FIO-STAT-OKS
      *        Error inconsistencia en el comando : informar
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-MOD. 

           PERFORM MOD-GVT.
           IF NOT FIO-STAT-OKS
               GO TO FIN-CMN-MOD.
      *>>>>
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI

*% INCLUDE 'GARSRC:CMNELIMUL.SRC'
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
*% INCLUDE 'GARSRC:BUSULTGTP.SRC'

       MOD-GVT SECTION.
       INI-MOD-GVT.
           MOVE GTP-NUM-SIS IN GTP-FLD TO {CAIREG} IN GVT
           MOVE GTP-COD-CRR IN GTP-FLD TO {IICREG} IN GVT
           MOVE GTP-COD-TSN IN GTP-FLD TO GAR-COD-TSN IN GVT
           MOVE 'GAR-CLV-GVT-1' TO FIO-AKEY
           MOVE FIO-GET-KEY-UPD TO FIO-CMND
           PERFORM GAR-FIO-GVT
           IF FIO-STAT-OKS
               MOVE 'I' TO GVT-MSC-STAT IN GVT 
               MOVE FIO-MOD TO FIO-CMND
               PERFORM GAR-FIO-GVT
               IF NOT FIO-STAT-OKS
                   MOVE FIO-MENS TO FRM-MENS
               ELSE
                   NEXT SENTENCE
           ELSE
               MOVE FIO-MENS TO FRM-MENS.
       FIN-MOD-GVT.
           EXIT.

       COPY {SISREG}BF{HIJ}.
       COPY {SISREG}BFTAG.
       COPY {SISREG}BFGVT.

       COPY GNSBGPES.
*% IF PGM_IBM AND PGM_PU
      *<<<< PGM_IBM AND PGM_PU

       COPY GNSBVCOD.
       COPY GNSBVTAB.
      *>>>>
*% END
      *>>>>
*% END
