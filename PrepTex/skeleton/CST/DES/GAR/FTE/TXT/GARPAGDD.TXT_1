*% NO_HDR_CST = TRUE
*% IF PGM_DTC AND PGM_UVS
*% INCLUDE 'GARSRC:GNSVSIDTC.SRC'
*% END
*%! HASTA AQUI PARA MANEJAR VSAM EN AMBIENTE DTC
*% INCLUDE 'GARSRC:PFSALLRPH.SRC'
*% FRM = 'GDD'
*%! Codigo adicional generico
*% PGM_HIJ = FALSE
*% PAD = 'DBC'
*% RPH = 'GDD'
*% HIJ = 'GDG'
*% KEYHIJ = 'GDG-COD-CRR'
*% PICHIJ = 'ZEROES'
*% CAIHIJHIJ = 'GAR-NUM-SIS'
*% CAIHIJFLD = 'GDD-NUM-SIS'
*% IICHIJHIJ = 'GAR-COD-CRR'
*% IICHIJFLD = 'GDD-COD-CRR'
*% KEYHIJHIJ = 'GAR-CLV-GDG-1'
*% KEYHIJRPH = 'GAR-CLV-GDD-2'
*% CAIHIJRPH = 'GAR-NUM-SIS'
*% IICHIJRPH = 'GAR-COD-CRR'
*% KEYRPHRPH = 'GAR-CLV-GDD-1'
*% KEYPADRPH = 'GDD-CIC-ICLI'
*% CAIPADRPH = 'GDD-CAI-ICLI'
*% IICPADRPH = 'GDD-IIC-ICLI'
*% KEYPADPAD = 'DBC-KEY-IDBC'
*% CAIPADPAD = 'DBC-CAI-ICLI'
*% IICPADPAD = 'DBC-IIC-ICLI'
*% KEYPADALT = 'DBC-GLS-NOMC'
*% SISPAD = 'SGC'
*% SISHIJ = 'GAR'
*% SISREG = 'GAR'
*% KEYPAD = 'DBC-IDC-ICLI'
*% MNECORPAD = 'CLI'
*% UNS_FLD = TRUE 
*% PAD_CLI = TRUE 
*%! Codigo adicional no generico
*% PGM_GDD = TRUE
*% GRA_GMO = TRUE
*% KEY_2 = TRUE
*% CMA_USR = TRUE
*% FLDPAD = 'DBC-NUM-ICLI'
*% CAIREG = 'GAR-NUM-SIS'
*% IICREG = 'GAR-COD-CRR'
*% REG = 'GDD'
*% IF FIN_SCR_VARI
      *<<<< FIN_SCR_VARI
*% INCLUDE CMAVARI OF 'GARSRC:PGMRPH.SRC'
              05 WSS-COD-PESO                        PIC X(06).
              05 {CAIREG}                         PIC X(04).
              05 {IICREG}                         PIC X(08).
              05 GAR-IND-CPL                         PIC X(01). 
      *>>>>
*% END
*% IF WSS
*% INCLUDE WSS OF 'GARSRC:PGMRPH.SRC'

       COPY {SISREG}BRTAG.
       COPY {SISREG}BRGMO.

*% IF PGM_DTC
      *<<<< PGM_DTC AND WSS
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-GMO-REQA==.
       COPY GNSWGRQA REPLACING ==ADR-REQA== BY ==ADR-TAG-REQA==.
      *>>>>
*% END
*% IF NOT PGM_PQ
      *<<<< NOT PGM_PQ
       COPY GNSWGHOY.
       COPY GNSWGPES.

      *>>>>
*% END
*% IF PGM_CHI AND PGM_PQ
      *<<<< PGM_CHI AND PGM_PQ
       COPY USPC113.
      *>>>>
*% END

       01  WSS-VARI.
           03 WSS-CPO.
*% IF PGM_ARG
      *<<<< PGM_ARG
              05 DBC-GLS-ICLI                     PIC X(02).
              05 DBC-NUM-ICLI                     PIC 9(11).
              05 DBC-VRF-ICLI                     PIC X(01).
              05 DBC-IND-ICLI                     PIC X(01).
      *>>>>
*% ELSE
      *<<<< NOT PGM_ARG
              05 DBC-NUM-ICLI                     PIC 9(08).
              05 DBC-VRF-ICLI                     PIC X(01).
              05 DBC-IND-ICLI                     PIC X(01).
              05 DBC-GLS-ICLI                     PIC X(03).
      *>>>>
*% END
*% END
*% CMA_USR = TRUE
*% IF CMA AND ( PGM_MVS OR PGM_DOS )
           02 FILLER                              PIC X(400).
*% END
*% IF INI_FIO
      *<<<< INI_FIO
*% IF PGM_MVS OR PGM_DOS 
      *<<<< PGM_MVS OR PGM_DOS 
           MOVE +400 TO SCR-TCMA.
      *>>>>
*% END
*% IF PGM_VMS
      *<<<< PGM_VMS

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM GNS-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM GNS-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-OFI.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-OFI.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE 'TAB'        TO FIO-SIST.
           PERFORM TAB-FIO-USR.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM TAB-FIO-USR.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISPAD}'        TO FIO-SIST.
           PERFORM {SISPAD}-FIO-{PAD}.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM {SISPAD}-FIO-{PAD}.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISPAD}'        TO FIO-SIST.
           PERFORM {SISPAD}-FIO-TAB.
           MOVE FIO-INP TO FIO-CMND.
           PERFORM {SISPAD}-FIO-TAB.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISREG}'        TO FIO-SIST.
           PERFORM {SISREG}-FIO-{HIJ}.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM {SISREG}-FIO-{HIJ}.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISREG}'        TO FIO-SIST.
           PERFORM {SISREG}-FIO-TAG.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM {SISREG}-FIO-TAG.

           MOVE FIO-ACCS-UPD TO FIO-ACCS.
           MOVE FIO-ACC      TO FIO-CMND.
           MOVE '{SISREG}'        TO FIO-SIST.
           PERFORM {SISREG}-FIO-GMO.
           MOVE FIO-UPD TO FIO-CMND.
           PERFORM {SISREG}-FIO-GMO.
*% END

      * OBTIENE CODIGO VALOR DE CAMBIO DE PESOS MEDIANTE CIC DE LA MONEDA '0999'
           MOVE 'TAB'          TO FIO-SIST.
           MOVE 'VLR'          TO TAB-CIC-TTAB IN TAB.
           MOVE '0999  '       TO TAB-CIC-CTAB IN TAB.
           MOVE 'TAB-CIC-TABL' TO FIO-AKEY.
           MOVE FIO-GET-KEY    TO FIO-CMND.
           PERFORM GNS-FIO-TAB.
           IF NOT FIO-STAT-OKS
               MOVE 'TAB'          TO MSG-COD-SIST
               MOVE 'CIC0999  NEX' TO MSG-COD-MENS
               PERFORM GET-MSG
               PERFORM PRG-ABT.
           MOVE TAB-COD-CTAB IN TAB TO WSS-COD-PESO IN CMA-VARI.
      *>>>> INI_FIO
*% END
*% IF INI_FND_KEY
      *<<<< INI_FND_KEY
      *
*% FIN_BUS_HIJ = TRUE
*% INCLUDE BUSNXTPRV OF 'GARSRC:PGMRPH.SRC'
*% INCLUDE INIFNDKEY OF 'GARSRC:PGMRPH.SRC'
*% END
*% IF FIN_FND_KEY
*% INCLUDE FINFNDKEY OF 'GARSRC:PGMRPH.SRC'
*% INCLUDE ERRFNDKEY OF 'GARSRC:PGMRPH.SRC'
*% END
*% IF INI_CMN_ING
      *<<<< INI_CMN_ING
*% INCLUDE 'GARSRC:LIMFLD.SRC'
      *>>>>
*% END
*% IF CMN_ING OR CMN_MOD
      *<<<< INI_CMN_ING OR INI_CMN_MOD
*% INCLUDE 'GARSRC:STDFLD.SRC'
*% IF PGM_VMS
           MOVE GAR-CLV-GDD-1 IN GDD TO GDD-KEY-PRV IN GDD.
*% END
      *>>>>
*% END
*% IF FIN_CMN_ING
      *<<<< FIN_CMN_ING
*% INCLUDE 'GARSRC:CMNINGGMO.SRC'
*% INCLUDE 'GARSRC:FINCMNING.SRC'
      *>>>>
*% END
*% IF FIN_CMN_MOD
      *<<<< FIN_CMN_MOD
           IF NOT FIO-STAT-OKS                                                  
      *        Error inconsistencia en la modificacion : informar               
               MOVE FIO-MENS TO FRM-MENS
               GO TO FIN-CMN-MOD.
      *>>>>
*% END
*% IF FIN_CMN_ELI
      *<<<< FIN_CMN_ELI
*% INCLUDE 'GARSRC:CMNELIGMO.SRC'
*% INCLUDE 'GARSRC:CMNELIMUL.SRC'
      *>>>>
*% END
*% IF EOF
      *<<<< EOF
       COPY GARBFTAG.
       COPY GNSBVCOD.
*% IF PGM_DOS OR PGM_MVS
       COPY GNSBVTAB.

*% END
*% INCLUDE EOFPQPU OF 'GARSRC:PGMRPH.SRC'
*% IF EOF AND PGM_PQ
      *<<<< EOF AND PGM_PQ
*% INCLUDE EOFPQ OF 'GARSRC:PGMRPH.SRC'

       CUENTA-GDD SECTION.
       INI-CUENTA-GDD.
           MOVE ZEROES TO FRM-NUM-QDEU IN GDD-FLD.
           MOVE 'GAR-CLV-GDD-2' TO FIO-AKEY.
           MOVE FIO-GET-NLS TO FIO-CMND.
           PERFORM GAR-FIO-GDD.
       LUP-CUENTA-GDD.
           IF NOT ( FIO-STAT-OKS AND
              GAR-NUM-SIS IN GDD = GDD-NUM-SIS IN GDD-FLD AND
              GAR-COD-CRR IN GDD = GDD-COD-CRR IN GDD-FLD )
               GO TO BRW-CUENTA-GDD.

           ADD 1 TO FRM-NUM-QDEU IN GDD-FLD.

       NXT-CUENTA-GDD.
           MOVE 'GAR-CLV-GDD-2' TO FIO-AKEY.
           MOVE FIO-GET-NXT TO FIO-CMND.
           PERFORM GAR-FIO-GDD.
           GO TO LUP-CUENTA-GDD.
       BRW-CUENTA-GDD.
           IF FIO-STAT-OKS
               MOVE 'GAR-CLV-GDD-2' TO FIO-AKEY
               MOVE FIO-END-BRW TO FIO-CMND
               PERFORM GAR-FIO-GDD.
       FIN-CUENTA-GDD.
           EXIT.
      *>>>>
*% END
*% IF EOF AND NOT PGM_PQ
      *<<<< EOF AND NOT PGM_PQ
       COPY GNSBGHOY.
       COPY GNSBGPES.

       ESC-GMO-GDD SECTION.
       INI-ESC-GMO-GDD.
           MOVE ZEROES TO GAR-CRR-MOV IN GMO.
           PERFORM INI-GMO.
           MOVE 'GDD001' TO GAR-COD-CPO IN GMO.
           MOVE 'N' TO GAR-IND-VAL IN GMO.
           MOVE 'N' TO GAR-IND-CLV IN GMO.
           MOVE DBC-NUM-ICLI IN GDD-FLD TO 
                DBC-NUM-ICLI IN WSS-CPO.
           MOVE DBC-VRF-ICLI IN GDD-FLD TO
                DBC-VRF-ICLI IN WSS-CPO.
           MOVE DBC-IND-ICLI IN GDD-FLD TO
                DBC-IND-ICLI IN WSS-CPO.
           MOVE DBC-GLS-ICLI IN GDD-FLD TO
                DBC-GLS-ICLI IN WSS-CPO.
           IF GAR-COD-MOV IN GMO = '1'
              MOVE WSS-CPO TO GAR-GLS-CPO-NVO IN GMO
           ELSE
           IF GAR-COD-MOV IN GMO = '3'
              MOVE WSS-CPO TO GAR-GLS-CPO-ANT IN GMO.
               
           MOVE FIO-PUT TO FIO-CMND.
           PERFORM GAR-FIO-GMO.
           IF NOT FIO-STAT-OKS
               MOVE 'GMO   PUT' TO MSG-COD-MENS.
       FIN-ESC-GMO-GDD.
           EXIT.   

*% INCLUDE 'GARSRC:INIGMO.SRC'

       COPY {SISREG}BFGMO.
      *>>>>
*% END
      *>>>>
*% END
